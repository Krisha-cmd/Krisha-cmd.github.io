(function(){const _e=document.createElement("link").relList;if(_e&&_e.supports&&_e.supports("modulepreload"))return;for(const vt of document.querySelectorAll('link[rel="modulepreload"]'))dt(vt);new MutationObserver(vt=>{for(const Et of vt)if(Et.type==="childList")for(const Pt of Et.addedNodes)Pt.tagName==="LINK"&&Pt.rel==="modulepreload"&&dt(Pt)}).observe(document,{childList:!0,subtree:!0});function _(vt){const Et={};return vt.integrity&&(Et.integrity=vt.integrity),vt.referrerPolicy&&(Et.referrerPolicy=vt.referrerPolicy),vt.crossOrigin==="use-credentials"?Et.credentials="include":vt.crossOrigin==="anonymous"?Et.credentials="omit":Et.credentials="same-origin",Et}function dt(vt){if(vt.ep)return;vt.ep=!0;const Et=_(vt);fetch(vt.href,Et)}})();function getDefaultExportFromCjs($){return $&&$.__esModule&&Object.prototype.hasOwnProperty.call($,"default")?$.default:$}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w$1=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1($){return $===null||typeof $!="object"?null:($=z$1&&$[z$1]||$["@@iterator"],typeof $=="function"?$:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1($,_e,_){this.props=$,this.context=_e,this.refs=D$1,this.updater=_||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function($,_e){if(typeof $!="object"&&typeof $!="function"&&$!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,$,_e,"setState")};E$1.prototype.forceUpdate=function($){this.updater.enqueueForceUpdate(this,$,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1($,_e,_){this.props=$,this.context=_e,this.refs=D$1,this.updater=_||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1($,_e,_){var dt,vt={},Et=null,Pt=null;if(_e!=null)for(dt in _e.ref!==void 0&&(Pt=_e.ref),_e.key!==void 0&&(Et=""+_e.key),_e)J.call(_e,dt)&&!L$1.hasOwnProperty(dt)&&(vt[dt]=_e[dt]);var Ut=arguments.length-2;if(Ut===1)vt.children=_;else if(1<Ut){for(var Ft=Array(Ut),Yt=0;Yt<Ut;Yt++)Ft[Yt]=arguments[Yt+2];vt.children=Ft}if($&&$.defaultProps)for(dt in Ut=$.defaultProps,Ut)vt[dt]===void 0&&(vt[dt]=Ut[dt]);return{$$typeof:l$1,type:$,key:Et,ref:Pt,props:vt,_owner:K$1.current}}function N$1($,_e){return{$$typeof:l$1,type:$.type,key:_e,ref:$.ref,props:$.props,_owner:$._owner}}function O$1($){return typeof $=="object"&&$!==null&&$.$$typeof===l$1}function escape$1($){var _e={"=":"=0",":":"=2"};return"$"+$.replace(/[=:]/g,function(_){return _e[_]})}var P$1=/\/+/g;function Q$1($,_e){return typeof $=="object"&&$!==null&&$.key!=null?escape$1(""+$.key):_e.toString(36)}function R$1($,_e,_,dt,vt){var Et=typeof $;(Et==="undefined"||Et==="boolean")&&($=null);var Pt=!1;if($===null)Pt=!0;else switch(Et){case"string":case"number":Pt=!0;break;case"object":switch($.$$typeof){case l$1:case n$1:Pt=!0}}if(Pt)return Pt=$,vt=vt(Pt),$=dt===""?"."+Q$1(Pt,0):dt,I$1(vt)?(_="",$!=null&&(_=$.replace(P$1,"$&/")+"/"),R$1(vt,_e,_,"",function(Yt){return Yt})):vt!=null&&(O$1(vt)&&(vt=N$1(vt,_+(!vt.key||Pt&&Pt.key===vt.key?"":(""+vt.key).replace(P$1,"$&/")+"/")+$)),_e.push(vt)),1;if(Pt=0,dt=dt===""?".":dt+":",I$1($))for(var Ut=0;Ut<$.length;Ut++){Et=$[Ut];var Ft=dt+Q$1(Et,Ut);Pt+=R$1(Et,_e,_,Ft,vt)}else if(Ft=A$1($),typeof Ft=="function")for($=Ft.call($),Ut=0;!(Et=$.next()).done;)Et=Et.value,Ft=dt+Q$1(Et,Ut++),Pt+=R$1(Et,_e,_,Ft,vt);else if(Et==="object")throw _e=String($),Error("Objects are not valid as a React child (found: "+(_e==="[object Object]"?"object with keys {"+Object.keys($).join(", ")+"}":_e)+"). If you meant to render a collection of children, use an array instead.");return Pt}function S$1($,_e,_){if($==null)return $;var dt=[],vt=0;return R$1($,dt,"","",function(Et){return _e.call(_,Et,vt++)}),dt}function T$1($){if($._status===-1){var _e=$._result;_e=_e(),_e.then(function(_){($._status===0||$._status===-1)&&($._status=1,$._result=_)},function(_){($._status===0||$._status===-1)&&($._status=2,$._result=_)}),$._status===-1&&($._status=0,$._result=_e)}if($._status===1)return $._result.default;throw $._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};react_production_min.Children={map:S$1,forEach:function($,_e,_){S$1($,function(){_e.apply(this,arguments)},_)},count:function($){var _e=0;return S$1($,function(){_e++}),_e},toArray:function($){return S$1($,function(_e){return _e})||[]},only:function($){if(!O$1($))throw Error("React.Children.only expected to receive a single React element child.");return $}};react_production_min.Component=E$1;react_production_min.Fragment=p$3;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w$1;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.cloneElement=function($,_e,_){if($==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+$+".");var dt=C$1({},$.props),vt=$.key,Et=$.ref,Pt=$._owner;if(_e!=null){if(_e.ref!==void 0&&(Et=_e.ref,Pt=K$1.current),_e.key!==void 0&&(vt=""+_e.key),$.type&&$.type.defaultProps)var Ut=$.type.defaultProps;for(Ft in _e)J.call(_e,Ft)&&!L$1.hasOwnProperty(Ft)&&(dt[Ft]=_e[Ft]===void 0&&Ut!==void 0?Ut[Ft]:_e[Ft])}var Ft=arguments.length-2;if(Ft===1)dt.children=_;else if(1<Ft){Ut=Array(Ft);for(var Yt=0;Yt<Ft;Yt++)Ut[Yt]=arguments[Yt+2];dt.children=Ut}return{$$typeof:l$1,type:$.type,key:vt,ref:Et,props:dt,_owner:Pt}};react_production_min.createContext=function($){return $={$$typeof:u,_currentValue:$,_currentValue2:$,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},$.Provider={$$typeof:t,_context:$},$.Consumer=$};react_production_min.createElement=M$1;react_production_min.createFactory=function($){var _e=M$1.bind(null,$);return _e.type=$,_e};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function($){return{$$typeof:v$1,render:$}};react_production_min.isValidElement=O$1;react_production_min.lazy=function($){return{$$typeof:y,_payload:{_status:-1,_result:$},_init:T$1}};react_production_min.memo=function($,_e){return{$$typeof:x,type:$,compare:_e===void 0?null:_e}};react_production_min.startTransition=function($){var _e=V$1.transition;V$1.transition={};try{$()}finally{V$1.transition=_e}};react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};react_production_min.useCallback=function($,_e){return U$1.current.useCallback($,_e)};react_production_min.useContext=function($){return U$1.current.useContext($)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function($){return U$1.current.useDeferredValue($)};react_production_min.useEffect=function($,_e){return U$1.current.useEffect($,_e)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function($,_e,_){return U$1.current.useImperativeHandle($,_e,_)};react_production_min.useInsertionEffect=function($,_e){return U$1.current.useInsertionEffect($,_e)};react_production_min.useLayoutEffect=function($,_e){return U$1.current.useLayoutEffect($,_e)};react_production_min.useMemo=function($,_e){return U$1.current.useMemo($,_e)};react_production_min.useReducer=function($,_e,_){return U$1.current.useReducer($,_e,_)};react_production_min.useRef=function($){return U$1.current.useRef($)};react_production_min.useState=function($){return U$1.current.useState($)};react_production_min.useSyncExternalStore=function($,_e,_){return U$1.current.useSyncExternalStore($,_e,_)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.2.0";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q($,_e,_){var dt,vt={},Et=null,Pt=null;_!==void 0&&(Et=""+_),_e.key!==void 0&&(Et=""+_e.key),_e.ref!==void 0&&(Pt=_e.ref);for(dt in _e)m$1.call(_e,dt)&&!p$2.hasOwnProperty(dt)&&(vt[dt]=_e[dt]);if($&&$.defaultProps)for(dt in _e=$.defaultProps,_e)vt[dt]===void 0&&(vt[dt]=_e[dt]);return{$$typeof:k,type:$,key:Et,ref:Pt,props:vt,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function($){function _e(Wn,ir){var zn=Wn.length;Wn.push(ir);e:for(;0<zn;){var cr=zn-1>>>1,ur=Wn[cr];if(0<vt(ur,ir))Wn[cr]=ir,Wn[zn]=ur,zn=cr;else break e}}function _(Wn){return Wn.length===0?null:Wn[0]}function dt(Wn){if(Wn.length===0)return null;var ir=Wn[0],zn=Wn.pop();if(zn!==ir){Wn[0]=zn;e:for(var cr=0,ur=Wn.length,Sr=ur>>>1;cr<Sr;){var _i=2*(cr+1)-1,rn=Wn[_i],Dn=_i+1,Qn=Wn[Dn];if(0>vt(rn,zn))Dn<ur&&0>vt(Qn,rn)?(Wn[cr]=Qn,Wn[Dn]=zn,cr=Dn):(Wn[cr]=rn,Wn[_i]=zn,cr=_i);else if(Dn<ur&&0>vt(Qn,zn))Wn[cr]=Qn,Wn[Dn]=zn,cr=Dn;else break e}}return ir}function vt(Wn,ir){var zn=Wn.sortIndex-ir.sortIndex;return zn!==0?zn:Wn.id-ir.id}if(typeof performance=="object"&&typeof performance.now=="function"){var Et=performance;$.unstable_now=function(){return Et.now()}}else{var Pt=Date,Ut=Pt.now();$.unstable_now=function(){return Pt.now()-Ut}}var Ft=[],Yt=[],hn=1,_n=null,pn=3,ln=!1,Pn=!1,nn=!1,Hn=typeof setTimeout=="function"?setTimeout:null,tn=typeof clearTimeout=="function"?clearTimeout:null,Xt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function dn(Wn){for(var ir=_(Yt);ir!==null;){if(ir.callback===null)dt(Yt);else if(ir.startTime<=Wn)dt(Yt),ir.sortIndex=ir.expirationTime,_e(Ft,ir);else break;ir=_(Yt)}}function Nn(Wn){if(nn=!1,dn(Wn),!Pn)if(_(Ft)!==null)Pn=!0,rr(An);else{var ir=_(Yt);ir!==null&&vr(Nn,ir.startTime-Wn)}}function An(Wn,ir){Pn=!1,nn&&(nn=!1,tn(Wt),Wt=-1),ln=!0;var zn=pn;try{for(dn(ir),_n=_(Ft);_n!==null&&(!(_n.expirationTime>ir)||Wn&&!Qt());){var cr=_n.callback;if(typeof cr=="function"){_n.callback=null,pn=_n.priorityLevel;var ur=cr(_n.expirationTime<=ir);ir=$.unstable_now(),typeof ur=="function"?_n.callback=ur:_n===_(Ft)&&dt(Ft),dn(ir)}else dt(Ft);_n=_(Ft)}if(_n!==null)var Sr=!0;else{var _i=_(Yt);_i!==null&&vr(Nn,_i.startTime-ir),Sr=!1}return Sr}finally{_n=null,pn=zn,ln=!1}}var kn=!1,jt=null,Wt=-1,Zt=5,Bn=-1;function Qt(){return!($.unstable_now()-Bn<Zt)}function Kt(){if(jt!==null){var Wn=$.unstable_now();Bn=Wn;var ir=!0;try{ir=jt(!0,Wn)}finally{ir?an():(kn=!1,jt=null)}}else kn=!1}var an;if(typeof Xt=="function")an=function(){Xt(Kt)};else if(typeof MessageChannel<"u"){var yn=new MessageChannel,Xn=yn.port2;yn.port1.onmessage=Kt,an=function(){Xn.postMessage(null)}}else an=function(){Hn(Kt,0)};function rr(Wn){jt=Wn,kn||(kn=!0,an())}function vr(Wn,ir){Wt=Hn(function(){Wn($.unstable_now())},ir)}$.unstable_IdlePriority=5,$.unstable_ImmediatePriority=1,$.unstable_LowPriority=4,$.unstable_NormalPriority=3,$.unstable_Profiling=null,$.unstable_UserBlockingPriority=2,$.unstable_cancelCallback=function(Wn){Wn.callback=null},$.unstable_continueExecution=function(){Pn||ln||(Pn=!0,rr(An))},$.unstable_forceFrameRate=function(Wn){0>Wn||125<Wn?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Zt=0<Wn?Math.floor(1e3/Wn):5},$.unstable_getCurrentPriorityLevel=function(){return pn},$.unstable_getFirstCallbackNode=function(){return _(Ft)},$.unstable_next=function(Wn){switch(pn){case 1:case 2:case 3:var ir=3;break;default:ir=pn}var zn=pn;pn=ir;try{return Wn()}finally{pn=zn}},$.unstable_pauseExecution=function(){},$.unstable_requestPaint=function(){},$.unstable_runWithPriority=function(Wn,ir){switch(Wn){case 1:case 2:case 3:case 4:case 5:break;default:Wn=3}var zn=pn;pn=Wn;try{return ir()}finally{pn=zn}},$.unstable_scheduleCallback=function(Wn,ir,zn){var cr=$.unstable_now();switch(typeof zn=="object"&&zn!==null?(zn=zn.delay,zn=typeof zn=="number"&&0<zn?cr+zn:cr):zn=cr,Wn){case 1:var ur=-1;break;case 2:ur=250;break;case 5:ur=1073741823;break;case 4:ur=1e4;break;default:ur=5e3}return ur=zn+ur,Wn={id:hn++,callback:ir,priorityLevel:Wn,startTime:zn,expirationTime:ur,sortIndex:-1},zn>cr?(Wn.sortIndex=zn,_e(Yt,Wn),_(Ft)===null&&Wn===_(Yt)&&(nn?(tn(Wt),Wt=-1):nn=!0,vr(Nn,zn-cr))):(Wn.sortIndex=ur,_e(Ft,Wn),Pn||ln||(Pn=!0,rr(An))),Wn},$.unstable_shouldYield=Qt,$.unstable_wrapCallback=function(Wn){var ir=pn;return function(){var zn=pn;pn=ir;try{return Wn.apply(this,arguments)}finally{pn=zn}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$1($){for(var _e="https://reactjs.org/docs/error-decoder.html?invariant="+$,_=1;_<arguments.length;_++)_e+="&args[]="+encodeURIComponent(arguments[_]);return"Minified React error #"+$+"; visit "+_e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa($,_e){ha($,_e),ha($+"Capture",_e)}function ha($,_e){for(ea[$]=_e,$=0;$<_e.length;$++)da.add(_e[$])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa($){return ja.call(ma,$)?!0:ja.call(la,$)?!1:ka.test($)?ma[$]=!0:(la[$]=!0,!1)}function pa($,_e,_,dt){if(_!==null&&_.type===0)return!1;switch(typeof _e){case"function":case"symbol":return!0;case"boolean":return dt?!1:_!==null?!_.acceptsBooleans:($=$.toLowerCase().slice(0,5),$!=="data-"&&$!=="aria-");default:return!1}}function qa($,_e,_,dt){if(_e===null||typeof _e>"u"||pa($,_e,_,dt))return!0;if(dt)return!1;if(_!==null)switch(_.type){case 3:return!_e;case 4:return _e===!1;case 5:return isNaN(_e);case 6:return isNaN(_e)||1>_e}return!1}function v($,_e,_,dt,vt,Et,Pt){this.acceptsBooleans=_e===2||_e===3||_e===4,this.attributeName=dt,this.attributeNamespace=vt,this.mustUseProperty=_,this.propertyName=$,this.type=_e,this.sanitizeURL=Et,this.removeEmptyString=Pt}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function($){z[$]=new v($,0,!1,$,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function($){var _e=$[0];z[_e]=new v(_e,1,!1,$[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function($){z[$]=new v($,2,!1,$.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function($){z[$]=new v($,2,!1,$,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function($){z[$]=new v($,3,!1,$.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function($){z[$]=new v($,3,!0,$,null,!1,!1)});["capture","download"].forEach(function($){z[$]=new v($,4,!1,$,null,!1,!1)});["cols","rows","size","span"].forEach(function($){z[$]=new v($,6,!1,$,null,!1,!1)});["rowSpan","start"].forEach(function($){z[$]=new v($,5,!1,$.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa($){return $[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function($){var _e=$.replace(ra,sa);z[_e]=new v(_e,1,!1,$,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function($){var _e=$.replace(ra,sa);z[_e]=new v(_e,1,!1,$,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function($){var _e=$.replace(ra,sa);z[_e]=new v(_e,1,!1,$,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function($){z[$]=new v($,1,!1,$.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function($){z[$]=new v($,1,!1,$.toLowerCase(),null,!0,!0)});function ta($,_e,_,dt){var vt=z.hasOwnProperty(_e)?z[_e]:null;(vt!==null?vt.type!==0:dt||!(2<_e.length)||_e[0]!=="o"&&_e[0]!=="O"||_e[1]!=="n"&&_e[1]!=="N")&&(qa(_e,_,vt,dt)&&(_=null),dt||vt===null?oa(_e)&&(_===null?$.removeAttribute(_e):$.setAttribute(_e,""+_)):vt.mustUseProperty?$[vt.propertyName]=_===null?vt.type===3?!1:"":_:(_e=vt.attributeName,dt=vt.attributeNamespace,_===null?$.removeAttribute(_e):(vt=vt.type,_=vt===3||vt===4&&_===!0?"":""+_,dt?$.setAttributeNS(dt,_e,_):$.setAttribute(_e,_))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka($){return $===null||typeof $!="object"?null:($=Ja&&$[Ja]||$["@@iterator"],typeof $=="function"?$:null)}var A=Object.assign,La;function Ma($){if(La===void 0)try{throw Error()}catch(_){var _e=_.stack.trim().match(/\n( *(at )?)/);La=_e&&_e[1]||""}return`
`+La+$}var Na=!1;function Oa($,_e){if(!$||Na)return"";Na=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_e)if(_e=function(){throw Error()},Object.defineProperty(_e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_e,[])}catch(Yt){var dt=Yt}Reflect.construct($,[],_e)}else{try{_e.call()}catch(Yt){dt=Yt}$.call(_e.prototype)}else{try{throw Error()}catch(Yt){dt=Yt}$()}}catch(Yt){if(Yt&&dt&&typeof Yt.stack=="string"){for(var vt=Yt.stack.split(`
`),Et=dt.stack.split(`
`),Pt=vt.length-1,Ut=Et.length-1;1<=Pt&&0<=Ut&&vt[Pt]!==Et[Ut];)Ut--;for(;1<=Pt&&0<=Ut;Pt--,Ut--)if(vt[Pt]!==Et[Ut]){if(Pt!==1||Ut!==1)do if(Pt--,Ut--,0>Ut||vt[Pt]!==Et[Ut]){var Ft=`
`+vt[Pt].replace(" at new "," at ");return $.displayName&&Ft.includes("<anonymous>")&&(Ft=Ft.replace("<anonymous>",$.displayName)),Ft}while(1<=Pt&&0<=Ut);break}}}finally{Na=!1,Error.prepareStackTrace=_}return($=$?$.displayName||$.name:"")?Ma($):""}function Pa($){switch($.tag){case 5:return Ma($.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return $=Oa($.type,!1),$;case 11:return $=Oa($.type.render,!1),$;case 1:return $=Oa($.type,!0),$;default:return""}}function Qa($){if($==null)return null;if(typeof $=="function")return $.displayName||$.name||null;if(typeof $=="string")return $;switch($){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof $=="object")switch($.$$typeof){case Ca:return($.displayName||"Context")+".Consumer";case Ba:return($._context.displayName||"Context")+".Provider";case Da:var _e=$.render;return $=$.displayName,$||($=_e.displayName||_e.name||"",$=$!==""?"ForwardRef("+$+")":"ForwardRef"),$;case Ga:return _e=$.displayName||null,_e!==null?_e:Qa($.type)||"Memo";case Ha:_e=$._payload,$=$._init;try{return Qa($(_e))}catch{}}return null}function Ra($){var _e=$.type;switch($.tag){case 24:return"Cache";case 9:return(_e.displayName||"Context")+".Consumer";case 10:return(_e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return $=_e.render,$=$.displayName||$.name||"",_e.displayName||($!==""?"ForwardRef("+$+")":"ForwardRef");case 7:return"Fragment";case 5:return _e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(_e);case 8:return _e===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _e=="function")return _e.displayName||_e.name||null;if(typeof _e=="string")return _e}return null}function Sa($){switch(typeof $){case"boolean":case"number":case"string":case"undefined":return $;case"object":return $;default:return""}}function Ta($){var _e=$.type;return($=$.nodeName)&&$.toLowerCase()==="input"&&(_e==="checkbox"||_e==="radio")}function Ua($){var _e=Ta($)?"checked":"value",_=Object.getOwnPropertyDescriptor($.constructor.prototype,_e),dt=""+$[_e];if(!$.hasOwnProperty(_e)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var vt=_.get,Et=_.set;return Object.defineProperty($,_e,{configurable:!0,get:function(){return vt.call(this)},set:function(Pt){dt=""+Pt,Et.call(this,Pt)}}),Object.defineProperty($,_e,{enumerable:_.enumerable}),{getValue:function(){return dt},setValue:function(Pt){dt=""+Pt},stopTracking:function(){$._valueTracker=null,delete $[_e]}}}}function Va($){$._valueTracker||($._valueTracker=Ua($))}function Wa($){if(!$)return!1;var _e=$._valueTracker;if(!_e)return!0;var _=_e.getValue(),dt="";return $&&(dt=Ta($)?$.checked?"true":"false":$.value),$=dt,$!==_?(_e.setValue($),!0):!1}function Xa($){if($=$||(typeof document<"u"?document:void 0),typeof $>"u")return null;try{return $.activeElement||$.body}catch{return $.body}}function Ya($,_e){var _=_e.checked;return A({},_e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:_??$._wrapperState.initialChecked})}function Za($,_e){var _=_e.defaultValue==null?"":_e.defaultValue,dt=_e.checked!=null?_e.checked:_e.defaultChecked;_=Sa(_e.value!=null?_e.value:_),$._wrapperState={initialChecked:dt,initialValue:_,controlled:_e.type==="checkbox"||_e.type==="radio"?_e.checked!=null:_e.value!=null}}function ab($,_e){_e=_e.checked,_e!=null&&ta($,"checked",_e,!1)}function bb($,_e){ab($,_e);var _=Sa(_e.value),dt=_e.type;if(_!=null)dt==="number"?(_===0&&$.value===""||$.value!=_)&&($.value=""+_):$.value!==""+_&&($.value=""+_);else if(dt==="submit"||dt==="reset"){$.removeAttribute("value");return}_e.hasOwnProperty("value")?cb($,_e.type,_):_e.hasOwnProperty("defaultValue")&&cb($,_e.type,Sa(_e.defaultValue)),_e.checked==null&&_e.defaultChecked!=null&&($.defaultChecked=!!_e.defaultChecked)}function db($,_e,_){if(_e.hasOwnProperty("value")||_e.hasOwnProperty("defaultValue")){var dt=_e.type;if(!(dt!=="submit"&&dt!=="reset"||_e.value!==void 0&&_e.value!==null))return;_e=""+$._wrapperState.initialValue,_||_e===$.value||($.value=_e),$.defaultValue=_e}_=$.name,_!==""&&($.name=""),$.defaultChecked=!!$._wrapperState.initialChecked,_!==""&&($.name=_)}function cb($,_e,_){(_e!=="number"||Xa($.ownerDocument)!==$)&&(_==null?$.defaultValue=""+$._wrapperState.initialValue:$.defaultValue!==""+_&&($.defaultValue=""+_))}var eb=Array.isArray;function fb($,_e,_,dt){if($=$.options,_e){_e={};for(var vt=0;vt<_.length;vt++)_e["$"+_[vt]]=!0;for(_=0;_<$.length;_++)vt=_e.hasOwnProperty("$"+$[_].value),$[_].selected!==vt&&($[_].selected=vt),vt&&dt&&($[_].defaultSelected=!0)}else{for(_=""+Sa(_),_e=null,vt=0;vt<$.length;vt++){if($[vt].value===_){$[vt].selected=!0,dt&&($[vt].defaultSelected=!0);return}_e!==null||$[vt].disabled||(_e=$[vt])}_e!==null&&(_e.selected=!0)}}function gb($,_e){if(_e.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A({},_e,{value:void 0,defaultValue:void 0,children:""+$._wrapperState.initialValue})}function hb($,_e){var _=_e.value;if(_==null){if(_=_e.children,_e=_e.defaultValue,_!=null){if(_e!=null)throw Error(p$1(92));if(eb(_)){if(1<_.length)throw Error(p$1(93));_=_[0]}_e=_}_e==null&&(_e=""),_=_e}$._wrapperState={initialValue:Sa(_)}}function ib($,_e){var _=Sa(_e.value),dt=Sa(_e.defaultValue);_!=null&&(_=""+_,_!==$.value&&($.value=_),_e.defaultValue==null&&$.defaultValue!==_&&($.defaultValue=_)),dt!=null&&($.defaultValue=""+dt)}function jb($){var _e=$.textContent;_e===$._wrapperState.initialValue&&_e!==""&&_e!==null&&($.value=_e)}function kb($){switch($){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb($,_e){return $==null||$==="http://www.w3.org/1999/xhtml"?kb(_e):$==="http://www.w3.org/2000/svg"&&_e==="foreignObject"?"http://www.w3.org/1999/xhtml":$}var mb,nb=function($){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_e,_,dt,vt){MSApp.execUnsafeLocalFunction(function(){return $(_e,_,dt,vt)})}:$}(function($,_e){if($.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in $)$.innerHTML=_e;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+_e.valueOf().toString()+"</svg>",_e=mb.firstChild;$.firstChild;)$.removeChild($.firstChild);for(;_e.firstChild;)$.appendChild(_e.firstChild)}});function ob($,_e){if(_e){var _=$.firstChild;if(_&&_===$.lastChild&&_.nodeType===3){_.nodeValue=_e;return}}$.textContent=_e}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function($){qb.forEach(function(_e){_e=_e+$.charAt(0).toUpperCase()+$.substring(1),pb[_e]=pb[$]})});function rb($,_e,_){return _e==null||typeof _e=="boolean"||_e===""?"":_||typeof _e!="number"||_e===0||pb.hasOwnProperty($)&&pb[$]?(""+_e).trim():_e+"px"}function sb($,_e){$=$.style;for(var _ in _e)if(_e.hasOwnProperty(_)){var dt=_.indexOf("--")===0,vt=rb(_,_e[_],dt);_==="float"&&(_="cssFloat"),dt?$.setProperty(_,vt):$[_]=vt}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub($,_e){if(_e){if(tb[$]&&(_e.children!=null||_e.dangerouslySetInnerHTML!=null))throw Error(p$1(137,$));if(_e.dangerouslySetInnerHTML!=null){if(_e.children!=null)throw Error(p$1(60));if(typeof _e.dangerouslySetInnerHTML!="object"||!("__html"in _e.dangerouslySetInnerHTML))throw Error(p$1(61))}if(_e.style!=null&&typeof _e.style!="object")throw Error(p$1(62))}}function vb($,_e){if($.indexOf("-")===-1)return typeof _e.is=="string";switch($){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb($){return $=$.target||$.srcElement||window,$.correspondingUseElement&&($=$.correspondingUseElement),$.nodeType===3?$.parentNode:$}var yb=null,zb=null,Ab=null;function Bb($){if($=Cb($)){if(typeof yb!="function")throw Error(p$1(280));var _e=$.stateNode;_e&&(_e=Db(_e),yb($.stateNode,$.type,_e))}}function Eb($){zb?Ab?Ab.push($):Ab=[$]:zb=$}function Fb(){if(zb){var $=zb,_e=Ab;if(Ab=zb=null,Bb($),_e)for($=0;$<_e.length;$++)Bb(_e[$])}}function Gb($,_e){return $(_e)}function Hb(){}var Ib=!1;function Jb($,_e,_){if(Ib)return $(_e,_);Ib=!0;try{return Gb($,_e,_)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb($,_e){var _=$.stateNode;if(_===null)return null;var dt=Db(_);if(dt===null)return null;_=dt[_e];e:switch(_e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(dt=!dt.disabled)||($=$.type,dt=!($==="button"||$==="input"||$==="select"||$==="textarea")),$=!dt;break e;default:$=!1}if($)return null;if(_&&typeof _!="function")throw Error(p$1(231,_e,typeof _));return _}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb($,_e,_,dt,vt,Et,Pt,Ut,Ft){var Yt=Array.prototype.slice.call(arguments,3);try{_e.apply(_,Yt)}catch(hn){this.onError(hn)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function($){Ob=!0,Pb=$}};function Tb($,_e,_,dt,vt,Et,Pt,Ut,Ft){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub($,_e,_,dt,vt,Et,Pt,Ut,Ft){if(Tb.apply(this,arguments),Ob){if(Ob){var Yt=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=Yt)}}function Vb($){var _e=$,_=$;if($.alternate)for(;_e.return;)_e=_e.return;else{$=_e;do _e=$,_e.flags&4098&&(_=_e.return),$=_e.return;while($)}return _e.tag===3?_:null}function Wb($){if($.tag===13){var _e=$.memoizedState;if(_e===null&&($=$.alternate,$!==null&&(_e=$.memoizedState)),_e!==null)return _e.dehydrated}return null}function Xb($){if(Vb($)!==$)throw Error(p$1(188))}function Yb($){var _e=$.alternate;if(!_e){if(_e=Vb($),_e===null)throw Error(p$1(188));return _e!==$?null:$}for(var _=$,dt=_e;;){var vt=_.return;if(vt===null)break;var Et=vt.alternate;if(Et===null){if(dt=vt.return,dt!==null){_=dt;continue}break}if(vt.child===Et.child){for(Et=vt.child;Et;){if(Et===_)return Xb(vt),$;if(Et===dt)return Xb(vt),_e;Et=Et.sibling}throw Error(p$1(188))}if(_.return!==dt.return)_=vt,dt=Et;else{for(var Pt=!1,Ut=vt.child;Ut;){if(Ut===_){Pt=!0,_=vt,dt=Et;break}if(Ut===dt){Pt=!0,dt=vt,_=Et;break}Ut=Ut.sibling}if(!Pt){for(Ut=Et.child;Ut;){if(Ut===_){Pt=!0,_=Et,dt=vt;break}if(Ut===dt){Pt=!0,dt=Et,_=vt;break}Ut=Ut.sibling}if(!Pt)throw Error(p$1(189))}}if(_.alternate!==dt)throw Error(p$1(190))}if(_.tag!==3)throw Error(p$1(188));return _.stateNode.current===_?$:_e}function Zb($){return $=Yb($),$!==null?$b($):null}function $b($){if($.tag===5||$.tag===6)return $;for($=$.child;$!==null;){var _e=$b($);if(_e!==null)return _e;$=$.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc($){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,$,void 0,($.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc($){return $>>>=0,$===0?32:31-(pc($)/qc|0)|0}var rc=64,sc=4194304;function tc($){switch($&-$){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return $&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return $&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return $}}function uc($,_e){var _=$.pendingLanes;if(_===0)return 0;var dt=0,vt=$.suspendedLanes,Et=$.pingedLanes,Pt=_&268435455;if(Pt!==0){var Ut=Pt&~vt;Ut!==0?dt=tc(Ut):(Et&=Pt,Et!==0&&(dt=tc(Et)))}else Pt=_&~vt,Pt!==0?dt=tc(Pt):Et!==0&&(dt=tc(Et));if(dt===0)return 0;if(_e!==0&&_e!==dt&&!(_e&vt)&&(vt=dt&-dt,Et=_e&-_e,vt>=Et||vt===16&&(Et&4194240)!==0))return _e;if(dt&4&&(dt|=_&16),_e=$.entangledLanes,_e!==0)for($=$.entanglements,_e&=dt;0<_e;)_=31-oc(_e),vt=1<<_,dt|=$[_],_e&=~vt;return dt}function vc($,_e){switch($){case 1:case 2:case 4:return _e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc($,_e){for(var _=$.suspendedLanes,dt=$.pingedLanes,vt=$.expirationTimes,Et=$.pendingLanes;0<Et;){var Pt=31-oc(Et),Ut=1<<Pt,Ft=vt[Pt];Ft===-1?(!(Ut&_)||Ut&dt)&&(vt[Pt]=vc(Ut,_e)):Ft<=_e&&($.expiredLanes|=Ut),Et&=~Ut}}function xc($){return $=$.pendingLanes&-1073741825,$!==0?$:$&1073741824?1073741824:0}function yc(){var $=rc;return rc<<=1,!(rc&4194240)&&(rc=64),$}function zc($){for(var _e=[],_=0;31>_;_++)_e.push($);return _e}function Ac($,_e,_){$.pendingLanes|=_e,_e!==536870912&&($.suspendedLanes=0,$.pingedLanes=0),$=$.eventTimes,_e=31-oc(_e),$[_e]=_}function Bc($,_e){var _=$.pendingLanes&~_e;$.pendingLanes=_e,$.suspendedLanes=0,$.pingedLanes=0,$.expiredLanes&=_e,$.mutableReadLanes&=_e,$.entangledLanes&=_e,_e=$.entanglements;var dt=$.eventTimes;for($=$.expirationTimes;0<_;){var vt=31-oc(_),Et=1<<vt;_e[vt]=0,dt[vt]=-1,$[vt]=-1,_&=~Et}}function Cc($,_e){var _=$.entangledLanes|=_e;for($=$.entanglements;_;){var dt=31-oc(_),vt=1<<dt;vt&_e|$[dt]&_e&&($[dt]|=_e),_&=~vt}}var C=0;function Dc($){return $&=-$,1<$?4<$?$&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc($,_e){switch($){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(_e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(_e.pointerId)}}function Tc($,_e,_,dt,vt,Et){return $===null||$.nativeEvent!==Et?($={blockedOn:_e,domEventName:_,eventSystemFlags:dt,nativeEvent:Et,targetContainers:[vt]},_e!==null&&(_e=Cb(_e),_e!==null&&Fc(_e)),$):($.eventSystemFlags|=dt,_e=$.targetContainers,vt!==null&&_e.indexOf(vt)===-1&&_e.push(vt),$)}function Uc($,_e,_,dt,vt){switch(_e){case"focusin":return Lc=Tc(Lc,$,_e,_,dt,vt),!0;case"dragenter":return Mc=Tc(Mc,$,_e,_,dt,vt),!0;case"mouseover":return Nc=Tc(Nc,$,_e,_,dt,vt),!0;case"pointerover":var Et=vt.pointerId;return Oc.set(Et,Tc(Oc.get(Et)||null,$,_e,_,dt,vt)),!0;case"gotpointercapture":return Et=vt.pointerId,Pc.set(Et,Tc(Pc.get(Et)||null,$,_e,_,dt,vt)),!0}return!1}function Vc($){var _e=Wc($.target);if(_e!==null){var _=Vb(_e);if(_!==null){if(_e=_.tag,_e===13){if(_e=Wb(_),_e!==null){$.blockedOn=_e,Ic($.priority,function(){Gc(_)});return}}else if(_e===3&&_.stateNode.current.memoizedState.isDehydrated){$.blockedOn=_.tag===3?_.stateNode.containerInfo:null;return}}}$.blockedOn=null}function Xc($){if($.blockedOn!==null)return!1;for(var _e=$.targetContainers;0<_e.length;){var _=Yc($.domEventName,$.eventSystemFlags,_e[0],$.nativeEvent);if(_===null){_=$.nativeEvent;var dt=new _.constructor(_.type,_);wb=dt,_.target.dispatchEvent(dt),wb=null}else return _e=Cb(_),_e!==null&&Fc(_e),$.blockedOn=_,!1;_e.shift()}return!0}function Zc($,_e,_){Xc($)&&_.delete(_e)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad($,_e){$.blockedOn===_e&&($.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd($){function _e(vt){return ad(vt,$)}if(0<Kc.length){ad(Kc[0],$);for(var _=1;_<Kc.length;_++){var dt=Kc[_];dt.blockedOn===$&&(dt.blockedOn=null)}}for(Lc!==null&&ad(Lc,$),Mc!==null&&ad(Mc,$),Nc!==null&&ad(Nc,$),Oc.forEach(_e),Pc.forEach(_e),_=0;_<Qc.length;_++)dt=Qc[_],dt.blockedOn===$&&(dt.blockedOn=null);for(;0<Qc.length&&(_=Qc[0],_.blockedOn===null);)Vc(_),_.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed($,_e,_,dt){var vt=C,Et=cd.transition;cd.transition=null;try{C=1,fd($,_e,_,dt)}finally{C=vt,cd.transition=Et}}function gd($,_e,_,dt){var vt=C,Et=cd.transition;cd.transition=null;try{C=4,fd($,_e,_,dt)}finally{C=vt,cd.transition=Et}}function fd($,_e,_,dt){if(dd){var vt=Yc($,_e,_,dt);if(vt===null)hd($,_e,dt,id,_),Sc($,dt);else if(Uc(vt,$,_e,_,dt))dt.stopPropagation();else if(Sc($,dt),_e&4&&-1<Rc.indexOf($)){for(;vt!==null;){var Et=Cb(vt);if(Et!==null&&Ec(Et),Et=Yc($,_e,_,dt),Et===null&&hd($,_e,dt,id,_),Et===vt)break;vt=Et}vt!==null&&dt.stopPropagation()}else hd($,_e,dt,null,_)}}var id=null;function Yc($,_e,_,dt){if(id=null,$=xb(dt),$=Wc($),$!==null)if(_e=Vb($),_e===null)$=null;else if(_=_e.tag,_===13){if($=Wb(_e),$!==null)return $;$=null}else if(_===3){if(_e.stateNode.current.memoizedState.isDehydrated)return _e.tag===3?_e.stateNode.containerInfo:null;$=null}else _e!==$&&($=null);return id=$,null}function jd($){switch($){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var $,_e=ld,_=_e.length,dt,vt="value"in kd?kd.value:kd.textContent,Et=vt.length;for($=0;$<_&&_e[$]===vt[$];$++);var Pt=_-$;for(dt=1;dt<=Pt&&_e[_-dt]===vt[Et-dt];dt++);return md=vt.slice($,1<dt?1-dt:void 0)}function od($){var _e=$.keyCode;return"charCode"in $?($=$.charCode,$===0&&_e===13&&($=13)):$=_e,$===10&&($=13),32<=$||$===13?$:0}function pd(){return!0}function qd(){return!1}function rd($){function _e(_,dt,vt,Et,Pt){this._reactName=_,this._targetInst=vt,this.type=dt,this.nativeEvent=Et,this.target=Pt,this.currentTarget=null;for(var Ut in $)$.hasOwnProperty(Ut)&&(_=$[Ut],this[Ut]=_?_(Et):Et[Ut]);return this.isDefaultPrevented=(Et.defaultPrevented!=null?Et.defaultPrevented:Et.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(_e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var _=this.nativeEvent;_&&(_.preventDefault?_.preventDefault():typeof _.returnValue!="unknown"&&(_.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var _=this.nativeEvent;_&&(_.stopPropagation?_.stopPropagation():typeof _.cancelBubble!="unknown"&&(_.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),_e}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function($){return $.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function($){return $.relatedTarget===void 0?$.fromElement===$.srcElement?$.toElement:$.fromElement:$.relatedTarget},movementX:function($){return"movementX"in $?$.movementX:($!==yd&&(yd&&$.type==="mousemove"?(wd=$.screenX-yd.screenX,xd=$.screenY-yd.screenY):xd=wd=0,yd=$),wd)},movementY:function($){return"movementY"in $?$.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function($){return"clipboardData"in $?$.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd($){var _e=this.nativeEvent;return _e.getModifierState?_e.getModifierState($):($=Od[$])?!!_e[$]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function($){if($.key){var _e=Md[$.key]||$.key;if(_e!=="Unidentified")return _e}return $.type==="keypress"?($=od($),$===13?"Enter":String.fromCharCode($)):$.type==="keydown"||$.type==="keyup"?Nd[$.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function($){return $.type==="keypress"?od($):0},keyCode:function($){return $.type==="keydown"||$.type==="keyup"?$.keyCode:0},which:function($){return $.type==="keypress"?od($):$.type==="keydown"||$.type==="keyup"?$.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function($){return"deltaX"in $?$.deltaX:"wheelDeltaX"in $?-$.wheelDeltaX:0},deltaY:function($){return"deltaY"in $?$.deltaY:"wheelDeltaY"in $?-$.wheelDeltaY:"wheelDelta"in $?-$.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=" ",fe=!1;function ge($,_e){switch($){case"keyup":return $d.indexOf(_e.keyCode)!==-1;case"keydown":return _e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he($){return $=$.detail,typeof $=="object"&&"data"in $?$.data:null}var ie=!1;function je($,_e){switch($){case"compositionend":return he(_e);case"keypress":return _e.which!==32?null:(fe=!0,ee);case"textInput":return $=_e.data,$===ee&&fe?null:$;default:return null}}function ke($,_e){if(ie)return $==="compositionend"||!ae&&ge($,_e)?($=nd(),md=ld=kd=null,ie=!1,$):null;switch($){case"paste":return null;case"keypress":if(!(_e.ctrlKey||_e.altKey||_e.metaKey)||_e.ctrlKey&&_e.altKey){if(_e.char&&1<_e.char.length)return _e.char;if(_e.which)return String.fromCharCode(_e.which)}return null;case"compositionend":return de&&_e.locale!=="ko"?null:_e.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me($){var _e=$&&$.nodeName&&$.nodeName.toLowerCase();return _e==="input"?!!le[$.type]:_e==="textarea"}function ne($,_e,_,dt){Eb(dt),_e=oe(_e,"onChange"),0<_e.length&&(_=new td("onChange","change",null,_,dt),$.push({event:_,listeners:_e}))}var pe=null,qe=null;function re($){se($,0)}function te($){var _e=ue($);if(Wa(_e))return $}function ve($,_e){if($==="change")return _e}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be($){if($.propertyName==="value"&&te(qe)){var _e=[];ne(_e,qe,$,xb($)),Jb(re,_e)}}function Ce($,_e,_){$==="focusin"?(Ae(),pe=_e,qe=_,pe.attachEvent("onpropertychange",Be)):$==="focusout"&&Ae()}function De($){if($==="selectionchange"||$==="keyup"||$==="keydown")return te(qe)}function Ee($,_e){if($==="click")return te(_e)}function Fe($,_e){if($==="input"||$==="change")return te(_e)}function Ge($,_e){return $===_e&&($!==0||1/$===1/_e)||$!==$&&_e!==_e}var He=typeof Object.is=="function"?Object.is:Ge;function Ie($,_e){if(He($,_e))return!0;if(typeof $!="object"||$===null||typeof _e!="object"||_e===null)return!1;var _=Object.keys($),dt=Object.keys(_e);if(_.length!==dt.length)return!1;for(dt=0;dt<_.length;dt++){var vt=_[dt];if(!ja.call(_e,vt)||!He($[vt],_e[vt]))return!1}return!0}function Je($){for(;$&&$.firstChild;)$=$.firstChild;return $}function Ke($,_e){var _=Je($);$=0;for(var dt;_;){if(_.nodeType===3){if(dt=$+_.textContent.length,$<=_e&&dt>=_e)return{node:_,offset:_e-$};$=dt}e:{for(;_;){if(_.nextSibling){_=_.nextSibling;break e}_=_.parentNode}_=void 0}_=Je(_)}}function Le($,_e){return $&&_e?$===_e?!0:$&&$.nodeType===3?!1:_e&&_e.nodeType===3?Le($,_e.parentNode):"contains"in $?$.contains(_e):$.compareDocumentPosition?!!($.compareDocumentPosition(_e)&16):!1:!1}function Me(){for(var $=window,_e=Xa();_e instanceof $.HTMLIFrameElement;){try{var _=typeof _e.contentWindow.location.href=="string"}catch{_=!1}if(_)$=_e.contentWindow;else break;_e=Xa($.document)}return _e}function Ne($){var _e=$&&$.nodeName&&$.nodeName.toLowerCase();return _e&&(_e==="input"&&($.type==="text"||$.type==="search"||$.type==="tel"||$.type==="url"||$.type==="password")||_e==="textarea"||$.contentEditable==="true")}function Oe($){var _e=Me(),_=$.focusedElem,dt=$.selectionRange;if(_e!==_&&_&&_.ownerDocument&&Le(_.ownerDocument.documentElement,_)){if(dt!==null&&Ne(_)){if(_e=dt.start,$=dt.end,$===void 0&&($=_e),"selectionStart"in _)_.selectionStart=_e,_.selectionEnd=Math.min($,_.value.length);else if($=(_e=_.ownerDocument||document)&&_e.defaultView||window,$.getSelection){$=$.getSelection();var vt=_.textContent.length,Et=Math.min(dt.start,vt);dt=dt.end===void 0?Et:Math.min(dt.end,vt),!$.extend&&Et>dt&&(vt=dt,dt=Et,Et=vt),vt=Ke(_,Et);var Pt=Ke(_,dt);vt&&Pt&&($.rangeCount!==1||$.anchorNode!==vt.node||$.anchorOffset!==vt.offset||$.focusNode!==Pt.node||$.focusOffset!==Pt.offset)&&(_e=_e.createRange(),_e.setStart(vt.node,vt.offset),$.removeAllRanges(),Et>dt?($.addRange(_e),$.extend(Pt.node,Pt.offset)):(_e.setEnd(Pt.node,Pt.offset),$.addRange(_e)))}}for(_e=[],$=_;$=$.parentNode;)$.nodeType===1&&_e.push({element:$,left:$.scrollLeft,top:$.scrollTop});for(typeof _.focus=="function"&&_.focus(),_=0;_<_e.length;_++)$=_e[_],$.element.scrollLeft=$.left,$.element.scrollTop=$.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue($,_e,_){var dt=_.window===_?_.document:_.nodeType===9?_:_.ownerDocument;Te||Qe==null||Qe!==Xa(dt)||(dt=Qe,"selectionStart"in dt&&Ne(dt)?dt={start:dt.selectionStart,end:dt.selectionEnd}:(dt=(dt.ownerDocument&&dt.ownerDocument.defaultView||window).getSelection(),dt={anchorNode:dt.anchorNode,anchorOffset:dt.anchorOffset,focusNode:dt.focusNode,focusOffset:dt.focusOffset}),Se&&Ie(Se,dt)||(Se=dt,dt=oe(Re,"onSelect"),0<dt.length&&(_e=new td("onSelect","select",null,_e,_),$.push({event:_e,listeners:dt}),_e.target=Qe)))}function Ve($,_e){var _={};return _[$.toLowerCase()]=_e.toLowerCase(),_["Webkit"+$]="webkit"+_e,_["Moz"+$]="moz"+_e,_}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze($){if(Xe[$])return Xe[$];if(!We[$])return $;var _e=We[$],_;for(_ in _e)if(_e.hasOwnProperty(_)&&_ in Ye)return Xe[$]=_e[_];return $}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff($,_e){df.set($,_e),fa(_e,[$])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf($,_e,_){var dt=$.type||"unknown-event";$.currentTarget=_,Ub(dt,_e,void 0,$),$.currentTarget=null}function se($,_e){_e=(_e&4)!==0;for(var _=0;_<$.length;_++){var dt=$[_],vt=dt.event;dt=dt.listeners;e:{var Et=void 0;if(_e)for(var Pt=dt.length-1;0<=Pt;Pt--){var Ut=dt[Pt],Ft=Ut.instance,Yt=Ut.currentTarget;if(Ut=Ut.listener,Ft!==Et&&vt.isPropagationStopped())break e;nf(vt,Ut,Yt),Et=Ft}else for(Pt=0;Pt<dt.length;Pt++){if(Ut=dt[Pt],Ft=Ut.instance,Yt=Ut.currentTarget,Ut=Ut.listener,Ft!==Et&&vt.isPropagationStopped())break e;nf(vt,Ut,Yt),Et=Ft}}}if(Qb)throw $=Rb,Qb=!1,Rb=null,$}function D($,_e){var _=_e[of];_===void 0&&(_=_e[of]=new Set);var dt=$+"__bubble";_.has(dt)||(pf(_e,$,2,!1),_.add(dt))}function qf($,_e,_){var dt=0;_e&&(dt|=4),pf(_,$,dt,_e)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf($){if(!$[rf]){$[rf]=!0,da.forEach(function(_){_!=="selectionchange"&&(mf.has(_)||qf(_,!1,$),qf(_,!0,$))});var _e=$.nodeType===9?$:$.ownerDocument;_e===null||_e[rf]||(_e[rf]=!0,qf("selectionchange",!1,_e))}}function pf($,_e,_,dt){switch(jd(_e)){case 1:var vt=ed;break;case 4:vt=gd;break;default:vt=fd}_=vt.bind(null,_e,_,$),vt=void 0,!Lb||_e!=="touchstart"&&_e!=="touchmove"&&_e!=="wheel"||(vt=!0),dt?vt!==void 0?$.addEventListener(_e,_,{capture:!0,passive:vt}):$.addEventListener(_e,_,!0):vt!==void 0?$.addEventListener(_e,_,{passive:vt}):$.addEventListener(_e,_,!1)}function hd($,_e,_,dt,vt){var Et=dt;if(!(_e&1)&&!(_e&2)&&dt!==null)e:for(;;){if(dt===null)return;var Pt=dt.tag;if(Pt===3||Pt===4){var Ut=dt.stateNode.containerInfo;if(Ut===vt||Ut.nodeType===8&&Ut.parentNode===vt)break;if(Pt===4)for(Pt=dt.return;Pt!==null;){var Ft=Pt.tag;if((Ft===3||Ft===4)&&(Ft=Pt.stateNode.containerInfo,Ft===vt||Ft.nodeType===8&&Ft.parentNode===vt))return;Pt=Pt.return}for(;Ut!==null;){if(Pt=Wc(Ut),Pt===null)return;if(Ft=Pt.tag,Ft===5||Ft===6){dt=Et=Pt;continue e}Ut=Ut.parentNode}}dt=dt.return}Jb(function(){var Yt=Et,hn=xb(_),_n=[];e:{var pn=df.get($);if(pn!==void 0){var ln=td,Pn=$;switch($){case"keypress":if(od(_)===0)break e;case"keydown":case"keyup":ln=Rd;break;case"focusin":Pn="focus",ln=Fd;break;case"focusout":Pn="blur",ln=Fd;break;case"beforeblur":case"afterblur":ln=Fd;break;case"click":if(_.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ln=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ln=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ln=Vd;break;case $e:case af:case bf:ln=Hd;break;case cf:ln=Xd;break;case"scroll":ln=vd;break;case"wheel":ln=Zd;break;case"copy":case"cut":case"paste":ln=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ln=Td}var nn=(_e&4)!==0,Hn=!nn&&$==="scroll",tn=nn?pn!==null?pn+"Capture":null:pn;nn=[];for(var Xt=Yt,dn;Xt!==null;){dn=Xt;var Nn=dn.stateNode;if(dn.tag===5&&Nn!==null&&(dn=Nn,tn!==null&&(Nn=Kb(Xt,tn),Nn!=null&&nn.push(tf(Xt,Nn,dn)))),Hn)break;Xt=Xt.return}0<nn.length&&(pn=new ln(pn,Pn,null,_,hn),_n.push({event:pn,listeners:nn}))}}if(!(_e&7)){e:{if(pn=$==="mouseover"||$==="pointerover",ln=$==="mouseout"||$==="pointerout",pn&&_!==wb&&(Pn=_.relatedTarget||_.fromElement)&&(Wc(Pn)||Pn[uf]))break e;if((ln||pn)&&(pn=hn.window===hn?hn:(pn=hn.ownerDocument)?pn.defaultView||pn.parentWindow:window,ln?(Pn=_.relatedTarget||_.toElement,ln=Yt,Pn=Pn?Wc(Pn):null,Pn!==null&&(Hn=Vb(Pn),Pn!==Hn||Pn.tag!==5&&Pn.tag!==6)&&(Pn=null)):(ln=null,Pn=Yt),ln!==Pn)){if(nn=Bd,Nn="onMouseLeave",tn="onMouseEnter",Xt="mouse",($==="pointerout"||$==="pointerover")&&(nn=Td,Nn="onPointerLeave",tn="onPointerEnter",Xt="pointer"),Hn=ln==null?pn:ue(ln),dn=Pn==null?pn:ue(Pn),pn=new nn(Nn,Xt+"leave",ln,_,hn),pn.target=Hn,pn.relatedTarget=dn,Nn=null,Wc(hn)===Yt&&(nn=new nn(tn,Xt+"enter",Pn,_,hn),nn.target=dn,nn.relatedTarget=Hn,Nn=nn),Hn=Nn,ln&&Pn)t:{for(nn=ln,tn=Pn,Xt=0,dn=nn;dn;dn=vf(dn))Xt++;for(dn=0,Nn=tn;Nn;Nn=vf(Nn))dn++;for(;0<Xt-dn;)nn=vf(nn),Xt--;for(;0<dn-Xt;)tn=vf(tn),dn--;for(;Xt--;){if(nn===tn||tn!==null&&nn===tn.alternate)break t;nn=vf(nn),tn=vf(tn)}nn=null}else nn=null;ln!==null&&wf(_n,pn,ln,nn,!1),Pn!==null&&Hn!==null&&wf(_n,Hn,Pn,nn,!0)}}e:{if(pn=Yt?ue(Yt):window,ln=pn.nodeName&&pn.nodeName.toLowerCase(),ln==="select"||ln==="input"&&pn.type==="file")var An=ve;else if(me(pn))if(we)An=Fe;else{An=De;var kn=Ce}else(ln=pn.nodeName)&&ln.toLowerCase()==="input"&&(pn.type==="checkbox"||pn.type==="radio")&&(An=Ee);if(An&&(An=An($,Yt))){ne(_n,An,_,hn);break e}kn&&kn($,pn,Yt),$==="focusout"&&(kn=pn._wrapperState)&&kn.controlled&&pn.type==="number"&&cb(pn,"number",pn.value)}switch(kn=Yt?ue(Yt):window,$){case"focusin":(me(kn)||kn.contentEditable==="true")&&(Qe=kn,Re=Yt,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(_n,_,hn);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(_n,_,hn)}var jt;if(ae)e:{switch($){case"compositionstart":var Wt="onCompositionStart";break e;case"compositionend":Wt="onCompositionEnd";break e;case"compositionupdate":Wt="onCompositionUpdate";break e}Wt=void 0}else ie?ge($,_)&&(Wt="onCompositionEnd"):$==="keydown"&&_.keyCode===229&&(Wt="onCompositionStart");Wt&&(de&&_.locale!=="ko"&&(ie||Wt!=="onCompositionStart"?Wt==="onCompositionEnd"&&ie&&(jt=nd()):(kd=hn,ld="value"in kd?kd.value:kd.textContent,ie=!0)),kn=oe(Yt,Wt),0<kn.length&&(Wt=new Ld(Wt,$,null,_,hn),_n.push({event:Wt,listeners:kn}),jt?Wt.data=jt:(jt=he(_),jt!==null&&(Wt.data=jt)))),(jt=ce?je($,_):ke($,_))&&(Yt=oe(Yt,"onBeforeInput"),0<Yt.length&&(hn=new Ld("onBeforeInput","beforeinput",null,_,hn),_n.push({event:hn,listeners:Yt}),hn.data=jt))}se(_n,_e)})}function tf($,_e,_){return{instance:$,listener:_e,currentTarget:_}}function oe($,_e){for(var _=_e+"Capture",dt=[];$!==null;){var vt=$,Et=vt.stateNode;vt.tag===5&&Et!==null&&(vt=Et,Et=Kb($,_),Et!=null&&dt.unshift(tf($,Et,vt)),Et=Kb($,_e),Et!=null&&dt.push(tf($,Et,vt))),$=$.return}return dt}function vf($){if($===null)return null;do $=$.return;while($&&$.tag!==5);return $||null}function wf($,_e,_,dt,vt){for(var Et=_e._reactName,Pt=[];_!==null&&_!==dt;){var Ut=_,Ft=Ut.alternate,Yt=Ut.stateNode;if(Ft!==null&&Ft===dt)break;Ut.tag===5&&Yt!==null&&(Ut=Yt,vt?(Ft=Kb(_,Et),Ft!=null&&Pt.unshift(tf(_,Ft,Ut))):vt||(Ft=Kb(_,Et),Ft!=null&&Pt.push(tf(_,Ft,Ut)))),_=_.return}Pt.length!==0&&$.push({event:_e,listeners:Pt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf($){return(typeof $=="string"?$:""+$).replace(xf,`
`).replace(yf,"")}function Af($,_e,_){if(_e=zf(_e),zf($)!==_e&&_)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef($,_e){return $==="textarea"||$==="noscript"||typeof _e.children=="string"||typeof _e.children=="number"||typeof _e.dangerouslySetInnerHTML=="object"&&_e.dangerouslySetInnerHTML!==null&&_e.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function($){return Hf.resolve(null).then($).catch(If)}:Ff;function If($){setTimeout(function(){throw $})}function Kf($,_e){var _=_e,dt=0;do{var vt=_.nextSibling;if($.removeChild(_),vt&&vt.nodeType===8)if(_=vt.data,_==="/$"){if(dt===0){$.removeChild(vt),bd(_e);return}dt--}else _!=="$"&&_!=="$?"&&_!=="$!"||dt++;_=vt}while(_);bd(_e)}function Lf($){for(;$!=null;$=$.nextSibling){var _e=$.nodeType;if(_e===1||_e===3)break;if(_e===8){if(_e=$.data,_e==="$"||_e==="$!"||_e==="$?")break;if(_e==="/$")return null}}return $}function Mf($){$=$.previousSibling;for(var _e=0;$;){if($.nodeType===8){var _=$.data;if(_==="$"||_==="$!"||_==="$?"){if(_e===0)return $;_e--}else _==="/$"&&_e++}$=$.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc($){var _e=$[Of];if(_e)return _e;for(var _=$.parentNode;_;){if(_e=_[uf]||_[Of]){if(_=_e.alternate,_e.child!==null||_!==null&&_.child!==null)for($=Mf($);$!==null;){if(_=$[Of])return _;$=Mf($)}return _e}$=_,_=$.parentNode}return null}function Cb($){return $=$[Of]||$[uf],!$||$.tag!==5&&$.tag!==6&&$.tag!==13&&$.tag!==3?null:$}function ue($){if($.tag===5||$.tag===6)return $.stateNode;throw Error(p$1(33))}function Db($){return $[Pf]||null}var Sf=[],Tf=-1;function Uf($){return{current:$}}function E($){0>Tf||($.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G($,_e){Tf++,Sf[Tf]=$.current,$.current=_e}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf($,_e){var _=$.type.contextTypes;if(!_)return Vf;var dt=$.stateNode;if(dt&&dt.__reactInternalMemoizedUnmaskedChildContext===_e)return dt.__reactInternalMemoizedMaskedChildContext;var vt={},Et;for(Et in _)vt[Et]=_e[Et];return dt&&($=$.stateNode,$.__reactInternalMemoizedUnmaskedChildContext=_e,$.__reactInternalMemoizedMaskedChildContext=vt),vt}function Zf($){return $=$.childContextTypes,$!=null}function $f(){E(Wf),E(H)}function ag($,_e,_){if(H.current!==Vf)throw Error(p$1(168));G(H,_e),G(Wf,_)}function bg($,_e,_){var dt=$.stateNode;if(_e=_e.childContextTypes,typeof dt.getChildContext!="function")return _;dt=dt.getChildContext();for(var vt in dt)if(!(vt in _e))throw Error(p$1(108,Ra($)||"Unknown",vt));return A({},_,dt)}function cg($){return $=($=$.stateNode)&&$.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,$),G(Wf,Wf.current),!0}function dg($,_e,_){var dt=$.stateNode;if(!dt)throw Error(p$1(169));_?($=bg($,_e,Xf),dt.__reactInternalMemoizedMergedChildContext=$,E(Wf),E(H),G(H,$)):E(Wf),G(Wf,_)}var eg=null,fg=!1,gg=!1;function hg($){eg===null?eg=[$]:eg.push($)}function ig($){fg=!0,hg($)}function jg(){if(!gg&&eg!==null){gg=!0;var $=0,_e=C;try{var _=eg;for(C=1;$<_.length;$++){var dt=_[$];do dt=dt(!0);while(dt!==null)}eg=null,fg=!1}catch(vt){throw eg!==null&&(eg=eg.slice($+1)),ac(fc,jg),vt}finally{C=_e,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg($,_e){kg[lg++]=ng,kg[lg++]=mg,mg=$,ng=_e}function ug($,_e,_){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=$;var dt=rg;$=sg;var vt=32-oc(dt)-1;dt&=~(1<<vt),_+=1;var Et=32-oc(_e)+vt;if(30<Et){var Pt=vt-vt%5;Et=(dt&(1<<Pt)-1).toString(32),dt>>=Pt,vt-=Pt,rg=1<<32-oc(_e)+vt|_<<vt|dt,sg=Et+$}else rg=1<<Et|_<<vt|dt,sg=$}function vg($){$.return!==null&&(tg($,1),ug($,1,0))}function wg($){for(;$===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;$===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag($,_e){var _=Bg(5,null,null,0);_.elementType="DELETED",_.stateNode=_e,_.return=$,_e=$.deletions,_e===null?($.deletions=[_],$.flags|=16):_e.push(_)}function Cg($,_e){switch($.tag){case 5:var _=$.type;return _e=_e.nodeType!==1||_.toLowerCase()!==_e.nodeName.toLowerCase()?null:_e,_e!==null?($.stateNode=_e,xg=$,yg=Lf(_e.firstChild),!0):!1;case 6:return _e=$.pendingProps===""||_e.nodeType!==3?null:_e,_e!==null?($.stateNode=_e,xg=$,yg=null,!0):!1;case 13:return _e=_e.nodeType!==8?null:_e,_e!==null?(_=qg!==null?{id:rg,overflow:sg}:null,$.memoizedState={dehydrated:_e,treeContext:_,retryLane:1073741824},_=Bg(18,null,null,0),_.stateNode=_e,_.return=$,$.child=_,xg=$,yg=null,!0):!1;default:return!1}}function Dg($){return($.mode&1)!==0&&($.flags&128)===0}function Eg($){if(I){var _e=yg;if(_e){var _=_e;if(!Cg($,_e)){if(Dg($))throw Error(p$1(418));_e=Lf(_.nextSibling);var dt=xg;_e&&Cg($,_e)?Ag(dt,_):($.flags=$.flags&-4097|2,I=!1,xg=$)}}else{if(Dg($))throw Error(p$1(418));$.flags=$.flags&-4097|2,I=!1,xg=$}}}function Fg($){for($=$.return;$!==null&&$.tag!==5&&$.tag!==3&&$.tag!==13;)$=$.return;xg=$}function Gg($){if($!==xg)return!1;if(!I)return Fg($),I=!0,!1;var _e;if((_e=$.tag!==3)&&!(_e=$.tag!==5)&&(_e=$.type,_e=_e!=="head"&&_e!=="body"&&!Ef($.type,$.memoizedProps)),_e&&(_e=yg)){if(Dg($))throw Hg(),Error(p$1(418));for(;_e;)Ag($,_e),_e=Lf(_e.nextSibling)}if(Fg($),$.tag===13){if($=$.memoizedState,$=$!==null?$.dehydrated:null,!$)throw Error(p$1(317));e:{for($=$.nextSibling,_e=0;$;){if($.nodeType===8){var _=$.data;if(_==="/$"){if(_e===0){yg=Lf($.nextSibling);break e}_e--}else _!=="$"&&_!=="$!"&&_!=="$?"||_e++}$=$.nextSibling}yg=null}}else yg=xg?Lf($.stateNode.nextSibling):null;return!0}function Hg(){for(var $=yg;$;)$=Lf($.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg($){zg===null?zg=[$]:zg.push($)}var Kg=ua.ReactCurrentBatchConfig;function Lg($,_e){if($&&$.defaultProps){_e=A({},_e),$=$.defaultProps;for(var _ in $)_e[_]===void 0&&(_e[_]=$[_]);return _e}return _e}var Mg=Uf(null),Ng=null,Og=null,Pg=null;function Qg(){Pg=Og=Ng=null}function Rg($){var _e=Mg.current;E(Mg),$._currentValue=_e}function Sg($,_e,_){for(;$!==null;){var dt=$.alternate;if(($.childLanes&_e)!==_e?($.childLanes|=_e,dt!==null&&(dt.childLanes|=_e)):dt!==null&&(dt.childLanes&_e)!==_e&&(dt.childLanes|=_e),$===_)break;$=$.return}}function Tg($,_e){Ng=$,Pg=Og=null,$=$.dependencies,$!==null&&$.firstContext!==null&&($.lanes&_e&&(Ug=!0),$.firstContext=null)}function Vg($){var _e=$._currentValue;if(Pg!==$)if($={context:$,memoizedValue:_e,next:null},Og===null){if(Ng===null)throw Error(p$1(308));Og=$,Ng.dependencies={lanes:0,firstContext:$}}else Og=Og.next=$;return _e}var Wg=null;function Xg($){Wg===null?Wg=[$]:Wg.push($)}function Yg($,_e,_,dt){var vt=_e.interleaved;return vt===null?(_.next=_,Xg(_e)):(_.next=vt.next,vt.next=_),_e.interleaved=_,Zg($,dt)}function Zg($,_e){$.lanes|=_e;var _=$.alternate;for(_!==null&&(_.lanes|=_e),_=$,$=$.return;$!==null;)$.childLanes|=_e,_=$.alternate,_!==null&&(_.childLanes|=_e),_=$,$=$.return;return _.tag===3?_.stateNode:null}var $g=!1;function ah($){$.updateQueue={baseState:$.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bh($,_e){$=$.updateQueue,_e.updateQueue===$&&(_e.updateQueue={baseState:$.baseState,firstBaseUpdate:$.firstBaseUpdate,lastBaseUpdate:$.lastBaseUpdate,shared:$.shared,effects:$.effects})}function ch($,_e){return{eventTime:$,lane:_e,tag:0,payload:null,callback:null,next:null}}function dh($,_e,_){var dt=$.updateQueue;if(dt===null)return null;if(dt=dt.shared,K&2){var vt=dt.pending;return vt===null?_e.next=_e:(_e.next=vt.next,vt.next=_e),dt.pending=_e,Zg($,_)}return vt=dt.interleaved,vt===null?(_e.next=_e,Xg(dt)):(_e.next=vt.next,vt.next=_e),dt.interleaved=_e,Zg($,_)}function eh($,_e,_){if(_e=_e.updateQueue,_e!==null&&(_e=_e.shared,(_&4194240)!==0)){var dt=_e.lanes;dt&=$.pendingLanes,_|=dt,_e.lanes=_,Cc($,_)}}function fh($,_e){var _=$.updateQueue,dt=$.alternate;if(dt!==null&&(dt=dt.updateQueue,_===dt)){var vt=null,Et=null;if(_=_.firstBaseUpdate,_!==null){do{var Pt={eventTime:_.eventTime,lane:_.lane,tag:_.tag,payload:_.payload,callback:_.callback,next:null};Et===null?vt=Et=Pt:Et=Et.next=Pt,_=_.next}while(_!==null);Et===null?vt=Et=_e:Et=Et.next=_e}else vt=Et=_e;_={baseState:dt.baseState,firstBaseUpdate:vt,lastBaseUpdate:Et,shared:dt.shared,effects:dt.effects},$.updateQueue=_;return}$=_.lastBaseUpdate,$===null?_.firstBaseUpdate=_e:$.next=_e,_.lastBaseUpdate=_e}function gh($,_e,_,dt){var vt=$.updateQueue;$g=!1;var Et=vt.firstBaseUpdate,Pt=vt.lastBaseUpdate,Ut=vt.shared.pending;if(Ut!==null){vt.shared.pending=null;var Ft=Ut,Yt=Ft.next;Ft.next=null,Pt===null?Et=Yt:Pt.next=Yt,Pt=Ft;var hn=$.alternate;hn!==null&&(hn=hn.updateQueue,Ut=hn.lastBaseUpdate,Ut!==Pt&&(Ut===null?hn.firstBaseUpdate=Yt:Ut.next=Yt,hn.lastBaseUpdate=Ft))}if(Et!==null){var _n=vt.baseState;Pt=0,hn=Yt=Ft=null,Ut=Et;do{var pn=Ut.lane,ln=Ut.eventTime;if((dt&pn)===pn){hn!==null&&(hn=hn.next={eventTime:ln,lane:0,tag:Ut.tag,payload:Ut.payload,callback:Ut.callback,next:null});e:{var Pn=$,nn=Ut;switch(pn=_e,ln=_,nn.tag){case 1:if(Pn=nn.payload,typeof Pn=="function"){_n=Pn.call(ln,_n,pn);break e}_n=Pn;break e;case 3:Pn.flags=Pn.flags&-65537|128;case 0:if(Pn=nn.payload,pn=typeof Pn=="function"?Pn.call(ln,_n,pn):Pn,pn==null)break e;_n=A({},_n,pn);break e;case 2:$g=!0}}Ut.callback!==null&&Ut.lane!==0&&($.flags|=64,pn=vt.effects,pn===null?vt.effects=[Ut]:pn.push(Ut))}else ln={eventTime:ln,lane:pn,tag:Ut.tag,payload:Ut.payload,callback:Ut.callback,next:null},hn===null?(Yt=hn=ln,Ft=_n):hn=hn.next=ln,Pt|=pn;if(Ut=Ut.next,Ut===null){if(Ut=vt.shared.pending,Ut===null)break;pn=Ut,Ut=pn.next,pn.next=null,vt.lastBaseUpdate=pn,vt.shared.pending=null}}while(!0);if(hn===null&&(Ft=_n),vt.baseState=Ft,vt.firstBaseUpdate=Yt,vt.lastBaseUpdate=hn,_e=vt.shared.interleaved,_e!==null){vt=_e;do Pt|=vt.lane,vt=vt.next;while(vt!==_e)}else Et===null&&(vt.shared.lanes=0);hh|=Pt,$.lanes=Pt,$.memoizedState=_n}}function ih($,_e,_){if($=_e.effects,_e.effects=null,$!==null)for(_e=0;_e<$.length;_e++){var dt=$[_e],vt=dt.callback;if(vt!==null){if(dt.callback=null,dt=_,typeof vt!="function")throw Error(p$1(191,vt));vt.call(dt)}}}var jh=new aa.Component().refs;function kh($,_e,_,dt){_e=$.memoizedState,_=_(dt,_e),_=_==null?_e:A({},_e,_),$.memoizedState=_,$.lanes===0&&($.updateQueue.baseState=_)}var nh={isMounted:function($){return($=$._reactInternals)?Vb($)===$:!1},enqueueSetState:function($,_e,_){$=$._reactInternals;var dt=L(),vt=lh($),Et=ch(dt,vt);Et.payload=_e,_!=null&&(Et.callback=_),_e=dh($,Et,vt),_e!==null&&(mh(_e,$,vt,dt),eh(_e,$,vt))},enqueueReplaceState:function($,_e,_){$=$._reactInternals;var dt=L(),vt=lh($),Et=ch(dt,vt);Et.tag=1,Et.payload=_e,_!=null&&(Et.callback=_),_e=dh($,Et,vt),_e!==null&&(mh(_e,$,vt,dt),eh(_e,$,vt))},enqueueForceUpdate:function($,_e){$=$._reactInternals;var _=L(),dt=lh($),vt=ch(_,dt);vt.tag=2,_e!=null&&(vt.callback=_e),_e=dh($,vt,dt),_e!==null&&(mh(_e,$,dt,_),eh(_e,$,dt))}};function oh($,_e,_,dt,vt,Et,Pt){return $=$.stateNode,typeof $.shouldComponentUpdate=="function"?$.shouldComponentUpdate(dt,Et,Pt):_e.prototype&&_e.prototype.isPureReactComponent?!Ie(_,dt)||!Ie(vt,Et):!0}function ph($,_e,_){var dt=!1,vt=Vf,Et=_e.contextType;return typeof Et=="object"&&Et!==null?Et=Vg(Et):(vt=Zf(_e)?Xf:H.current,dt=_e.contextTypes,Et=(dt=dt!=null)?Yf($,vt):Vf),_e=new _e(_,Et),$.memoizedState=_e.state!==null&&_e.state!==void 0?_e.state:null,_e.updater=nh,$.stateNode=_e,_e._reactInternals=$,dt&&($=$.stateNode,$.__reactInternalMemoizedUnmaskedChildContext=vt,$.__reactInternalMemoizedMaskedChildContext=Et),_e}function qh($,_e,_,dt){$=_e.state,typeof _e.componentWillReceiveProps=="function"&&_e.componentWillReceiveProps(_,dt),typeof _e.UNSAFE_componentWillReceiveProps=="function"&&_e.UNSAFE_componentWillReceiveProps(_,dt),_e.state!==$&&nh.enqueueReplaceState(_e,_e.state,null)}function rh($,_e,_,dt){var vt=$.stateNode;vt.props=_,vt.state=$.memoizedState,vt.refs=jh,ah($);var Et=_e.contextType;typeof Et=="object"&&Et!==null?vt.context=Vg(Et):(Et=Zf(_e)?Xf:H.current,vt.context=Yf($,Et)),vt.state=$.memoizedState,Et=_e.getDerivedStateFromProps,typeof Et=="function"&&(kh($,_e,Et,_),vt.state=$.memoizedState),typeof _e.getDerivedStateFromProps=="function"||typeof vt.getSnapshotBeforeUpdate=="function"||typeof vt.UNSAFE_componentWillMount!="function"&&typeof vt.componentWillMount!="function"||(_e=vt.state,typeof vt.componentWillMount=="function"&&vt.componentWillMount(),typeof vt.UNSAFE_componentWillMount=="function"&&vt.UNSAFE_componentWillMount(),_e!==vt.state&&nh.enqueueReplaceState(vt,vt.state,null),gh($,_,vt,dt),vt.state=$.memoizedState),typeof vt.componentDidMount=="function"&&($.flags|=4194308)}function sh($,_e,_){if($=_.ref,$!==null&&typeof $!="function"&&typeof $!="object"){if(_._owner){if(_=_._owner,_){if(_.tag!==1)throw Error(p$1(309));var dt=_.stateNode}if(!dt)throw Error(p$1(147,$));var vt=dt,Et=""+$;return _e!==null&&_e.ref!==null&&typeof _e.ref=="function"&&_e.ref._stringRef===Et?_e.ref:(_e=function(Pt){var Ut=vt.refs;Ut===jh&&(Ut=vt.refs={}),Pt===null?delete Ut[Et]:Ut[Et]=Pt},_e._stringRef=Et,_e)}if(typeof $!="string")throw Error(p$1(284));if(!_._owner)throw Error(p$1(290,$))}return $}function th($,_e){throw $=Object.prototype.toString.call(_e),Error(p$1(31,$==="[object Object]"?"object with keys {"+Object.keys(_e).join(", ")+"}":$))}function uh($){var _e=$._init;return _e($._payload)}function vh($){function _e(tn,Xt){if($){var dn=tn.deletions;dn===null?(tn.deletions=[Xt],tn.flags|=16):dn.push(Xt)}}function _(tn,Xt){if(!$)return null;for(;Xt!==null;)_e(tn,Xt),Xt=Xt.sibling;return null}function dt(tn,Xt){for(tn=new Map;Xt!==null;)Xt.key!==null?tn.set(Xt.key,Xt):tn.set(Xt.index,Xt),Xt=Xt.sibling;return tn}function vt(tn,Xt){return tn=wh(tn,Xt),tn.index=0,tn.sibling=null,tn}function Et(tn,Xt,dn){return tn.index=dn,$?(dn=tn.alternate,dn!==null?(dn=dn.index,dn<Xt?(tn.flags|=2,Xt):dn):(tn.flags|=2,Xt)):(tn.flags|=1048576,Xt)}function Pt(tn){return $&&tn.alternate===null&&(tn.flags|=2),tn}function Ut(tn,Xt,dn,Nn){return Xt===null||Xt.tag!==6?(Xt=xh(dn,tn.mode,Nn),Xt.return=tn,Xt):(Xt=vt(Xt,dn),Xt.return=tn,Xt)}function Ft(tn,Xt,dn,Nn){var An=dn.type;return An===ya?hn(tn,Xt,dn.props.children,Nn,dn.key):Xt!==null&&(Xt.elementType===An||typeof An=="object"&&An!==null&&An.$$typeof===Ha&&uh(An)===Xt.type)?(Nn=vt(Xt,dn.props),Nn.ref=sh(tn,Xt,dn),Nn.return=tn,Nn):(Nn=yh(dn.type,dn.key,dn.props,null,tn.mode,Nn),Nn.ref=sh(tn,Xt,dn),Nn.return=tn,Nn)}function Yt(tn,Xt,dn,Nn){return Xt===null||Xt.tag!==4||Xt.stateNode.containerInfo!==dn.containerInfo||Xt.stateNode.implementation!==dn.implementation?(Xt=zh(dn,tn.mode,Nn),Xt.return=tn,Xt):(Xt=vt(Xt,dn.children||[]),Xt.return=tn,Xt)}function hn(tn,Xt,dn,Nn,An){return Xt===null||Xt.tag!==7?(Xt=Ah(dn,tn.mode,Nn,An),Xt.return=tn,Xt):(Xt=vt(Xt,dn),Xt.return=tn,Xt)}function _n(tn,Xt,dn){if(typeof Xt=="string"&&Xt!==""||typeof Xt=="number")return Xt=xh(""+Xt,tn.mode,dn),Xt.return=tn,Xt;if(typeof Xt=="object"&&Xt!==null){switch(Xt.$$typeof){case va:return dn=yh(Xt.type,Xt.key,Xt.props,null,tn.mode,dn),dn.ref=sh(tn,null,Xt),dn.return=tn,dn;case wa:return Xt=zh(Xt,tn.mode,dn),Xt.return=tn,Xt;case Ha:var Nn=Xt._init;return _n(tn,Nn(Xt._payload),dn)}if(eb(Xt)||Ka(Xt))return Xt=Ah(Xt,tn.mode,dn,null),Xt.return=tn,Xt;th(tn,Xt)}return null}function pn(tn,Xt,dn,Nn){var An=Xt!==null?Xt.key:null;if(typeof dn=="string"&&dn!==""||typeof dn=="number")return An!==null?null:Ut(tn,Xt,""+dn,Nn);if(typeof dn=="object"&&dn!==null){switch(dn.$$typeof){case va:return dn.key===An?Ft(tn,Xt,dn,Nn):null;case wa:return dn.key===An?Yt(tn,Xt,dn,Nn):null;case Ha:return An=dn._init,pn(tn,Xt,An(dn._payload),Nn)}if(eb(dn)||Ka(dn))return An!==null?null:hn(tn,Xt,dn,Nn,null);th(tn,dn)}return null}function ln(tn,Xt,dn,Nn,An){if(typeof Nn=="string"&&Nn!==""||typeof Nn=="number")return tn=tn.get(dn)||null,Ut(Xt,tn,""+Nn,An);if(typeof Nn=="object"&&Nn!==null){switch(Nn.$$typeof){case va:return tn=tn.get(Nn.key===null?dn:Nn.key)||null,Ft(Xt,tn,Nn,An);case wa:return tn=tn.get(Nn.key===null?dn:Nn.key)||null,Yt(Xt,tn,Nn,An);case Ha:var kn=Nn._init;return ln(tn,Xt,dn,kn(Nn._payload),An)}if(eb(Nn)||Ka(Nn))return tn=tn.get(dn)||null,hn(Xt,tn,Nn,An,null);th(Xt,Nn)}return null}function Pn(tn,Xt,dn,Nn){for(var An=null,kn=null,jt=Xt,Wt=Xt=0,Zt=null;jt!==null&&Wt<dn.length;Wt++){jt.index>Wt?(Zt=jt,jt=null):Zt=jt.sibling;var Bn=pn(tn,jt,dn[Wt],Nn);if(Bn===null){jt===null&&(jt=Zt);break}$&&jt&&Bn.alternate===null&&_e(tn,jt),Xt=Et(Bn,Xt,Wt),kn===null?An=Bn:kn.sibling=Bn,kn=Bn,jt=Zt}if(Wt===dn.length)return _(tn,jt),I&&tg(tn,Wt),An;if(jt===null){for(;Wt<dn.length;Wt++)jt=_n(tn,dn[Wt],Nn),jt!==null&&(Xt=Et(jt,Xt,Wt),kn===null?An=jt:kn.sibling=jt,kn=jt);return I&&tg(tn,Wt),An}for(jt=dt(tn,jt);Wt<dn.length;Wt++)Zt=ln(jt,tn,Wt,dn[Wt],Nn),Zt!==null&&($&&Zt.alternate!==null&&jt.delete(Zt.key===null?Wt:Zt.key),Xt=Et(Zt,Xt,Wt),kn===null?An=Zt:kn.sibling=Zt,kn=Zt);return $&&jt.forEach(function(Qt){return _e(tn,Qt)}),I&&tg(tn,Wt),An}function nn(tn,Xt,dn,Nn){var An=Ka(dn);if(typeof An!="function")throw Error(p$1(150));if(dn=An.call(dn),dn==null)throw Error(p$1(151));for(var kn=An=null,jt=Xt,Wt=Xt=0,Zt=null,Bn=dn.next();jt!==null&&!Bn.done;Wt++,Bn=dn.next()){jt.index>Wt?(Zt=jt,jt=null):Zt=jt.sibling;var Qt=pn(tn,jt,Bn.value,Nn);if(Qt===null){jt===null&&(jt=Zt);break}$&&jt&&Qt.alternate===null&&_e(tn,jt),Xt=Et(Qt,Xt,Wt),kn===null?An=Qt:kn.sibling=Qt,kn=Qt,jt=Zt}if(Bn.done)return _(tn,jt),I&&tg(tn,Wt),An;if(jt===null){for(;!Bn.done;Wt++,Bn=dn.next())Bn=_n(tn,Bn.value,Nn),Bn!==null&&(Xt=Et(Bn,Xt,Wt),kn===null?An=Bn:kn.sibling=Bn,kn=Bn);return I&&tg(tn,Wt),An}for(jt=dt(tn,jt);!Bn.done;Wt++,Bn=dn.next())Bn=ln(jt,tn,Wt,Bn.value,Nn),Bn!==null&&($&&Bn.alternate!==null&&jt.delete(Bn.key===null?Wt:Bn.key),Xt=Et(Bn,Xt,Wt),kn===null?An=Bn:kn.sibling=Bn,kn=Bn);return $&&jt.forEach(function(Kt){return _e(tn,Kt)}),I&&tg(tn,Wt),An}function Hn(tn,Xt,dn,Nn){if(typeof dn=="object"&&dn!==null&&dn.type===ya&&dn.key===null&&(dn=dn.props.children),typeof dn=="object"&&dn!==null){switch(dn.$$typeof){case va:e:{for(var An=dn.key,kn=Xt;kn!==null;){if(kn.key===An){if(An=dn.type,An===ya){if(kn.tag===7){_(tn,kn.sibling),Xt=vt(kn,dn.props.children),Xt.return=tn,tn=Xt;break e}}else if(kn.elementType===An||typeof An=="object"&&An!==null&&An.$$typeof===Ha&&uh(An)===kn.type){_(tn,kn.sibling),Xt=vt(kn,dn.props),Xt.ref=sh(tn,kn,dn),Xt.return=tn,tn=Xt;break e}_(tn,kn);break}else _e(tn,kn);kn=kn.sibling}dn.type===ya?(Xt=Ah(dn.props.children,tn.mode,Nn,dn.key),Xt.return=tn,tn=Xt):(Nn=yh(dn.type,dn.key,dn.props,null,tn.mode,Nn),Nn.ref=sh(tn,Xt,dn),Nn.return=tn,tn=Nn)}return Pt(tn);case wa:e:{for(kn=dn.key;Xt!==null;){if(Xt.key===kn)if(Xt.tag===4&&Xt.stateNode.containerInfo===dn.containerInfo&&Xt.stateNode.implementation===dn.implementation){_(tn,Xt.sibling),Xt=vt(Xt,dn.children||[]),Xt.return=tn,tn=Xt;break e}else{_(tn,Xt);break}else _e(tn,Xt);Xt=Xt.sibling}Xt=zh(dn,tn.mode,Nn),Xt.return=tn,tn=Xt}return Pt(tn);case Ha:return kn=dn._init,Hn(tn,Xt,kn(dn._payload),Nn)}if(eb(dn))return Pn(tn,Xt,dn,Nn);if(Ka(dn))return nn(tn,Xt,dn,Nn);th(tn,dn)}return typeof dn=="string"&&dn!==""||typeof dn=="number"?(dn=""+dn,Xt!==null&&Xt.tag===6?(_(tn,Xt.sibling),Xt=vt(Xt,dn),Xt.return=tn,tn=Xt):(_(tn,Xt),Xt=xh(dn,tn.mode,Nn),Xt.return=tn,tn=Xt),Pt(tn)):_(tn,Xt)}return Hn}var Bh=vh(!0),Ch=vh(!1),Dh={},Eh=Uf(Dh),Fh=Uf(Dh),Gh=Uf(Dh);function Hh($){if($===Dh)throw Error(p$1(174));return $}function Ih($,_e){switch(G(Gh,_e),G(Fh,$),G(Eh,Dh),$=_e.nodeType,$){case 9:case 11:_e=(_e=_e.documentElement)?_e.namespaceURI:lb(null,"");break;default:$=$===8?_e.parentNode:_e,_e=$.namespaceURI||null,$=$.tagName,_e=lb(_e,$)}E(Eh),G(Eh,_e)}function Jh(){E(Eh),E(Fh),E(Gh)}function Kh($){Hh(Gh.current);var _e=Hh(Eh.current),_=lb(_e,$.type);_e!==_&&(G(Fh,$),G(Eh,_))}function Lh($){Fh.current===$&&(E(Eh),E(Fh))}var M=Uf(0);function Mh($){for(var _e=$;_e!==null;){if(_e.tag===13){var _=_e.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||_.data==="$?"||_.data==="$!"))return _e}else if(_e.tag===19&&_e.memoizedProps.revealOrder!==void 0){if(_e.flags&128)return _e}else if(_e.child!==null){_e.child.return=_e,_e=_e.child;continue}if(_e===$)break;for(;_e.sibling===null;){if(_e.return===null||_e.return===$)return null;_e=_e.return}_e.sibling.return=_e.return,_e=_e.sibling}return null}var Nh=[];function Oh(){for(var $=0;$<Nh.length;$++)Nh[$]._workInProgressVersionPrimary=null;Nh.length=0}var Ph=ua.ReactCurrentDispatcher,Qh=ua.ReactCurrentBatchConfig,Rh=0,N=null,O=null,P=null,Sh=!1,Th=!1,Uh=0,Vh=0;function Q(){throw Error(p$1(321))}function Wh($,_e){if(_e===null)return!1;for(var _=0;_<_e.length&&_<$.length;_++)if(!He($[_],_e[_]))return!1;return!0}function Xh($,_e,_,dt,vt,Et){if(Rh=Et,N=_e,_e.memoizedState=null,_e.updateQueue=null,_e.lanes=0,Ph.current=$===null||$.memoizedState===null?Yh:Zh,$=_(dt,vt),Th){Et=0;do{if(Th=!1,Uh=0,25<=Et)throw Error(p$1(301));Et+=1,P=O=null,_e.updateQueue=null,Ph.current=$h,$=_(dt,vt)}while(Th)}if(Ph.current=ai,_e=O!==null&&O.next!==null,Rh=0,P=O=N=null,Sh=!1,_e)throw Error(p$1(300));return $}function bi(){var $=Uh!==0;return Uh=0,$}function ci(){var $={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return P===null?N.memoizedState=P=$:P=P.next=$,P}function di(){if(O===null){var $=N.alternate;$=$!==null?$.memoizedState:null}else $=O.next;var _e=P===null?N.memoizedState:P.next;if(_e!==null)P=_e,O=$;else{if($===null)throw Error(p$1(310));O=$,$={memoizedState:O.memoizedState,baseState:O.baseState,baseQueue:O.baseQueue,queue:O.queue,next:null},P===null?N.memoizedState=P=$:P=P.next=$}return P}function ei($,_e){return typeof _e=="function"?_e($):_e}function fi($){var _e=di(),_=_e.queue;if(_===null)throw Error(p$1(311));_.lastRenderedReducer=$;var dt=O,vt=dt.baseQueue,Et=_.pending;if(Et!==null){if(vt!==null){var Pt=vt.next;vt.next=Et.next,Et.next=Pt}dt.baseQueue=vt=Et,_.pending=null}if(vt!==null){Et=vt.next,dt=dt.baseState;var Ut=Pt=null,Ft=null,Yt=Et;do{var hn=Yt.lane;if((Rh&hn)===hn)Ft!==null&&(Ft=Ft.next={lane:0,action:Yt.action,hasEagerState:Yt.hasEagerState,eagerState:Yt.eagerState,next:null}),dt=Yt.hasEagerState?Yt.eagerState:$(dt,Yt.action);else{var _n={lane:hn,action:Yt.action,hasEagerState:Yt.hasEagerState,eagerState:Yt.eagerState,next:null};Ft===null?(Ut=Ft=_n,Pt=dt):Ft=Ft.next=_n,N.lanes|=hn,hh|=hn}Yt=Yt.next}while(Yt!==null&&Yt!==Et);Ft===null?Pt=dt:Ft.next=Ut,He(dt,_e.memoizedState)||(Ug=!0),_e.memoizedState=dt,_e.baseState=Pt,_e.baseQueue=Ft,_.lastRenderedState=dt}if($=_.interleaved,$!==null){vt=$;do Et=vt.lane,N.lanes|=Et,hh|=Et,vt=vt.next;while(vt!==$)}else vt===null&&(_.lanes=0);return[_e.memoizedState,_.dispatch]}function gi($){var _e=di(),_=_e.queue;if(_===null)throw Error(p$1(311));_.lastRenderedReducer=$;var dt=_.dispatch,vt=_.pending,Et=_e.memoizedState;if(vt!==null){_.pending=null;var Pt=vt=vt.next;do Et=$(Et,Pt.action),Pt=Pt.next;while(Pt!==vt);He(Et,_e.memoizedState)||(Ug=!0),_e.memoizedState=Et,_e.baseQueue===null&&(_e.baseState=Et),_.lastRenderedState=Et}return[Et,dt]}function hi(){}function ii($,_e){var _=N,dt=di(),vt=_e(),Et=!He(dt.memoizedState,vt);if(Et&&(dt.memoizedState=vt,Ug=!0),dt=dt.queue,ji(ki.bind(null,_,dt,$),[$]),dt.getSnapshot!==_e||Et||P!==null&&P.memoizedState.tag&1){if(_.flags|=2048,li(9,mi.bind(null,_,dt,vt,_e),void 0,null),R===null)throw Error(p$1(349));Rh&30||ni(_,_e,vt)}return vt}function ni($,_e,_){$.flags|=16384,$={getSnapshot:_e,value:_},_e=N.updateQueue,_e===null?(_e={lastEffect:null,stores:null},N.updateQueue=_e,_e.stores=[$]):(_=_e.stores,_===null?_e.stores=[$]:_.push($))}function mi($,_e,_,dt){_e.value=_,_e.getSnapshot=dt,oi(_e)&&pi($)}function ki($,_e,_){return _(function(){oi(_e)&&pi($)})}function oi($){var _e=$.getSnapshot;$=$.value;try{var _=_e();return!He($,_)}catch{return!0}}function pi($){var _e=Zg($,1);_e!==null&&mh(_e,$,1,-1)}function qi($){var _e=ci();return typeof $=="function"&&($=$()),_e.memoizedState=_e.baseState=$,$={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:$},_e.queue=$,$=$.dispatch=ri.bind(null,N,$),[_e.memoizedState,$]}function li($,_e,_,dt){return $={tag:$,create:_e,destroy:_,deps:dt,next:null},_e=N.updateQueue,_e===null?(_e={lastEffect:null,stores:null},N.updateQueue=_e,_e.lastEffect=$.next=$):(_=_e.lastEffect,_===null?_e.lastEffect=$.next=$:(dt=_.next,_.next=$,$.next=dt,_e.lastEffect=$)),$}function si(){return di().memoizedState}function ti($,_e,_,dt){var vt=ci();N.flags|=$,vt.memoizedState=li(1|_e,_,void 0,dt===void 0?null:dt)}function ui($,_e,_,dt){var vt=di();dt=dt===void 0?null:dt;var Et=void 0;if(O!==null){var Pt=O.memoizedState;if(Et=Pt.destroy,dt!==null&&Wh(dt,Pt.deps)){vt.memoizedState=li(_e,_,Et,dt);return}}N.flags|=$,vt.memoizedState=li(1|_e,_,Et,dt)}function vi($,_e){return ti(8390656,8,$,_e)}function ji($,_e){return ui(2048,8,$,_e)}function wi($,_e){return ui(4,2,$,_e)}function xi($,_e){return ui(4,4,$,_e)}function yi($,_e){if(typeof _e=="function")return $=$(),_e($),function(){_e(null)};if(_e!=null)return $=$(),_e.current=$,function(){_e.current=null}}function zi($,_e,_){return _=_!=null?_.concat([$]):null,ui(4,4,yi.bind(null,_e,$),_)}function Ai(){}function Bi($,_e){var _=di();_e=_e===void 0?null:_e;var dt=_.memoizedState;return dt!==null&&_e!==null&&Wh(_e,dt[1])?dt[0]:(_.memoizedState=[$,_e],$)}function Ci($,_e){var _=di();_e=_e===void 0?null:_e;var dt=_.memoizedState;return dt!==null&&_e!==null&&Wh(_e,dt[1])?dt[0]:($=$(),_.memoizedState=[$,_e],$)}function Di($,_e,_){return Rh&21?(He(_,_e)||(_=yc(),N.lanes|=_,hh|=_,$.baseState=!0),_e):($.baseState&&($.baseState=!1,Ug=!0),$.memoizedState=_)}function Ei($,_e){var _=C;C=_!==0&&4>_?_:4,$(!0);var dt=Qh.transition;Qh.transition={};try{$(!1),_e()}finally{C=_,Qh.transition=dt}}function Fi(){return di().memoizedState}function Gi($,_e,_){var dt=lh($);if(_={lane:dt,action:_,hasEagerState:!1,eagerState:null,next:null},Hi($))Ii(_e,_);else if(_=Yg($,_e,_,dt),_!==null){var vt=L();mh(_,$,dt,vt),Ji(_,_e,dt)}}function ri($,_e,_){var dt=lh($),vt={lane:dt,action:_,hasEagerState:!1,eagerState:null,next:null};if(Hi($))Ii(_e,vt);else{var Et=$.alternate;if($.lanes===0&&(Et===null||Et.lanes===0)&&(Et=_e.lastRenderedReducer,Et!==null))try{var Pt=_e.lastRenderedState,Ut=Et(Pt,_);if(vt.hasEagerState=!0,vt.eagerState=Ut,He(Ut,Pt)){var Ft=_e.interleaved;Ft===null?(vt.next=vt,Xg(_e)):(vt.next=Ft.next,Ft.next=vt),_e.interleaved=vt;return}}catch{}finally{}_=Yg($,_e,vt,dt),_!==null&&(vt=L(),mh(_,$,dt,vt),Ji(_,_e,dt))}}function Hi($){var _e=$.alternate;return $===N||_e!==null&&_e===N}function Ii($,_e){Th=Sh=!0;var _=$.pending;_===null?_e.next=_e:(_e.next=_.next,_.next=_e),$.pending=_e}function Ji($,_e,_){if(_&4194240){var dt=_e.lanes;dt&=$.pendingLanes,_|=dt,_e.lanes=_,Cc($,_)}}var ai={readContext:Vg,useCallback:Q,useContext:Q,useEffect:Q,useImperativeHandle:Q,useInsertionEffect:Q,useLayoutEffect:Q,useMemo:Q,useReducer:Q,useRef:Q,useState:Q,useDebugValue:Q,useDeferredValue:Q,useTransition:Q,useMutableSource:Q,useSyncExternalStore:Q,useId:Q,unstable_isNewReconciler:!1},Yh={readContext:Vg,useCallback:function($,_e){return ci().memoizedState=[$,_e===void 0?null:_e],$},useContext:Vg,useEffect:vi,useImperativeHandle:function($,_e,_){return _=_!=null?_.concat([$]):null,ti(4194308,4,yi.bind(null,_e,$),_)},useLayoutEffect:function($,_e){return ti(4194308,4,$,_e)},useInsertionEffect:function($,_e){return ti(4,2,$,_e)},useMemo:function($,_e){var _=ci();return _e=_e===void 0?null:_e,$=$(),_.memoizedState=[$,_e],$},useReducer:function($,_e,_){var dt=ci();return _e=_!==void 0?_(_e):_e,dt.memoizedState=dt.baseState=_e,$={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$,lastRenderedState:_e},dt.queue=$,$=$.dispatch=Gi.bind(null,N,$),[dt.memoizedState,$]},useRef:function($){var _e=ci();return $={current:$},_e.memoizedState=$},useState:qi,useDebugValue:Ai,useDeferredValue:function($){return ci().memoizedState=$},useTransition:function(){var $=qi(!1),_e=$[0];return $=Ei.bind(null,$[1]),ci().memoizedState=$,[_e,$]},useMutableSource:function(){},useSyncExternalStore:function($,_e,_){var dt=N,vt=ci();if(I){if(_===void 0)throw Error(p$1(407));_=_()}else{if(_=_e(),R===null)throw Error(p$1(349));Rh&30||ni(dt,_e,_)}vt.memoizedState=_;var Et={value:_,getSnapshot:_e};return vt.queue=Et,vi(ki.bind(null,dt,Et,$),[$]),dt.flags|=2048,li(9,mi.bind(null,dt,Et,_,_e),void 0,null),_},useId:function(){var $=ci(),_e=R.identifierPrefix;if(I){var _=sg,dt=rg;_=(dt&~(1<<32-oc(dt)-1)).toString(32)+_,_e=":"+_e+"R"+_,_=Uh++,0<_&&(_e+="H"+_.toString(32)),_e+=":"}else _=Vh++,_e=":"+_e+"r"+_.toString(32)+":";return $.memoizedState=_e},unstable_isNewReconciler:!1},Zh={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:fi,useRef:si,useState:function(){return fi(ei)},useDebugValue:Ai,useDeferredValue:function($){var _e=di();return Di(_e,O.memoizedState,$)},useTransition:function(){var $=fi(ei)[0],_e=di().memoizedState;return[$,_e]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1},$h={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:gi,useRef:si,useState:function(){return gi(ei)},useDebugValue:Ai,useDeferredValue:function($){var _e=di();return O===null?_e.memoizedState=$:Di(_e,O.memoizedState,$)},useTransition:function(){var $=gi(ei)[0],_e=di().memoizedState;return[$,_e]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1};function Ki($,_e){try{var _="",dt=_e;do _+=Pa(dt),dt=dt.return;while(dt);var vt=_}catch(Et){vt=`
Error generating stack: `+Et.message+`
`+Et.stack}return{value:$,source:_e,stack:vt,digest:null}}function Li($,_e,_){return{value:$,source:null,stack:_??null,digest:_e??null}}function Mi($,_e){try{console.error(_e.value)}catch(_){setTimeout(function(){throw _})}}var Ni=typeof WeakMap=="function"?WeakMap:Map;function Oi($,_e,_){_=ch(-1,_),_.tag=3,_.payload={element:null};var dt=_e.value;return _.callback=function(){Pi||(Pi=!0,Qi=dt),Mi($,_e)},_}function Ri($,_e,_){_=ch(-1,_),_.tag=3;var dt=$.type.getDerivedStateFromError;if(typeof dt=="function"){var vt=_e.value;_.payload=function(){return dt(vt)},_.callback=function(){Mi($,_e)}}var Et=$.stateNode;return Et!==null&&typeof Et.componentDidCatch=="function"&&(_.callback=function(){Mi($,_e),typeof dt!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var Pt=_e.stack;this.componentDidCatch(_e.value,{componentStack:Pt!==null?Pt:""})}),_}function Ti($,_e,_){var dt=$.pingCache;if(dt===null){dt=$.pingCache=new Ni;var vt=new Set;dt.set(_e,vt)}else vt=dt.get(_e),vt===void 0&&(vt=new Set,dt.set(_e,vt));vt.has(_)||(vt.add(_),$=Ui.bind(null,$,_e,_),_e.then($,$))}function Vi($){do{var _e;if((_e=$.tag===13)&&(_e=$.memoizedState,_e=_e!==null?_e.dehydrated!==null:!0),_e)return $;$=$.return}while($!==null);return null}function Wi($,_e,_,dt,vt){return $.mode&1?($.flags|=65536,$.lanes=vt,$):($===_e?$.flags|=65536:($.flags|=128,_.flags|=131072,_.flags&=-52805,_.tag===1&&(_.alternate===null?_.tag=17:(_e=ch(-1,1),_e.tag=2,dh(_,_e,1))),_.lanes|=1),$)}var Xi=ua.ReactCurrentOwner,Ug=!1;function Yi($,_e,_,dt){_e.child=$===null?Ch(_e,null,_,dt):Bh(_e,$.child,_,dt)}function Zi($,_e,_,dt,vt){_=_.render;var Et=_e.ref;return Tg(_e,vt),dt=Xh($,_e,_,dt,Et,vt),_=bi(),$!==null&&!Ug?(_e.updateQueue=$.updateQueue,_e.flags&=-2053,$.lanes&=~vt,$i($,_e,vt)):(I&&_&&vg(_e),_e.flags|=1,Yi($,_e,dt,vt),_e.child)}function aj($,_e,_,dt,vt){if($===null){var Et=_.type;return typeof Et=="function"&&!bj(Et)&&Et.defaultProps===void 0&&_.compare===null&&_.defaultProps===void 0?(_e.tag=15,_e.type=Et,cj($,_e,Et,dt,vt)):($=yh(_.type,null,dt,_e,_e.mode,vt),$.ref=_e.ref,$.return=_e,_e.child=$)}if(Et=$.child,!($.lanes&vt)){var Pt=Et.memoizedProps;if(_=_.compare,_=_!==null?_:Ie,_(Pt,dt)&&$.ref===_e.ref)return $i($,_e,vt)}return _e.flags|=1,$=wh(Et,dt),$.ref=_e.ref,$.return=_e,_e.child=$}function cj($,_e,_,dt,vt){if($!==null){var Et=$.memoizedProps;if(Ie(Et,dt)&&$.ref===_e.ref)if(Ug=!1,_e.pendingProps=dt=Et,($.lanes&vt)!==0)$.flags&131072&&(Ug=!0);else return _e.lanes=$.lanes,$i($,_e,vt)}return dj($,_e,_,dt,vt)}function ej($,_e,_){var dt=_e.pendingProps,vt=dt.children,Et=$!==null?$.memoizedState:null;if(dt.mode==="hidden")if(!(_e.mode&1))_e.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(fj,gj),gj|=_;else{if(!(_&1073741824))return $=Et!==null?Et.baseLanes|_:_,_e.lanes=_e.childLanes=1073741824,_e.memoizedState={baseLanes:$,cachePool:null,transitions:null},_e.updateQueue=null,G(fj,gj),gj|=$,null;_e.memoizedState={baseLanes:0,cachePool:null,transitions:null},dt=Et!==null?Et.baseLanes:_,G(fj,gj),gj|=dt}else Et!==null?(dt=Et.baseLanes|_,_e.memoizedState=null):dt=_,G(fj,gj),gj|=dt;return Yi($,_e,vt,_),_e.child}function hj($,_e){var _=_e.ref;($===null&&_!==null||$!==null&&$.ref!==_)&&(_e.flags|=512,_e.flags|=2097152)}function dj($,_e,_,dt,vt){var Et=Zf(_)?Xf:H.current;return Et=Yf(_e,Et),Tg(_e,vt),_=Xh($,_e,_,dt,Et,vt),dt=bi(),$!==null&&!Ug?(_e.updateQueue=$.updateQueue,_e.flags&=-2053,$.lanes&=~vt,$i($,_e,vt)):(I&&dt&&vg(_e),_e.flags|=1,Yi($,_e,_,vt),_e.child)}function ij($,_e,_,dt,vt){if(Zf(_)){var Et=!0;cg(_e)}else Et=!1;if(Tg(_e,vt),_e.stateNode===null)jj($,_e),ph(_e,_,dt),rh(_e,_,dt,vt),dt=!0;else if($===null){var Pt=_e.stateNode,Ut=_e.memoizedProps;Pt.props=Ut;var Ft=Pt.context,Yt=_.contextType;typeof Yt=="object"&&Yt!==null?Yt=Vg(Yt):(Yt=Zf(_)?Xf:H.current,Yt=Yf(_e,Yt));var hn=_.getDerivedStateFromProps,_n=typeof hn=="function"||typeof Pt.getSnapshotBeforeUpdate=="function";_n||typeof Pt.UNSAFE_componentWillReceiveProps!="function"&&typeof Pt.componentWillReceiveProps!="function"||(Ut!==dt||Ft!==Yt)&&qh(_e,Pt,dt,Yt),$g=!1;var pn=_e.memoizedState;Pt.state=pn,gh(_e,dt,Pt,vt),Ft=_e.memoizedState,Ut!==dt||pn!==Ft||Wf.current||$g?(typeof hn=="function"&&(kh(_e,_,hn,dt),Ft=_e.memoizedState),(Ut=$g||oh(_e,_,Ut,dt,pn,Ft,Yt))?(_n||typeof Pt.UNSAFE_componentWillMount!="function"&&typeof Pt.componentWillMount!="function"||(typeof Pt.componentWillMount=="function"&&Pt.componentWillMount(),typeof Pt.UNSAFE_componentWillMount=="function"&&Pt.UNSAFE_componentWillMount()),typeof Pt.componentDidMount=="function"&&(_e.flags|=4194308)):(typeof Pt.componentDidMount=="function"&&(_e.flags|=4194308),_e.memoizedProps=dt,_e.memoizedState=Ft),Pt.props=dt,Pt.state=Ft,Pt.context=Yt,dt=Ut):(typeof Pt.componentDidMount=="function"&&(_e.flags|=4194308),dt=!1)}else{Pt=_e.stateNode,bh($,_e),Ut=_e.memoizedProps,Yt=_e.type===_e.elementType?Ut:Lg(_e.type,Ut),Pt.props=Yt,_n=_e.pendingProps,pn=Pt.context,Ft=_.contextType,typeof Ft=="object"&&Ft!==null?Ft=Vg(Ft):(Ft=Zf(_)?Xf:H.current,Ft=Yf(_e,Ft));var ln=_.getDerivedStateFromProps;(hn=typeof ln=="function"||typeof Pt.getSnapshotBeforeUpdate=="function")||typeof Pt.UNSAFE_componentWillReceiveProps!="function"&&typeof Pt.componentWillReceiveProps!="function"||(Ut!==_n||pn!==Ft)&&qh(_e,Pt,dt,Ft),$g=!1,pn=_e.memoizedState,Pt.state=pn,gh(_e,dt,Pt,vt);var Pn=_e.memoizedState;Ut!==_n||pn!==Pn||Wf.current||$g?(typeof ln=="function"&&(kh(_e,_,ln,dt),Pn=_e.memoizedState),(Yt=$g||oh(_e,_,Yt,dt,pn,Pn,Ft)||!1)?(hn||typeof Pt.UNSAFE_componentWillUpdate!="function"&&typeof Pt.componentWillUpdate!="function"||(typeof Pt.componentWillUpdate=="function"&&Pt.componentWillUpdate(dt,Pn,Ft),typeof Pt.UNSAFE_componentWillUpdate=="function"&&Pt.UNSAFE_componentWillUpdate(dt,Pn,Ft)),typeof Pt.componentDidUpdate=="function"&&(_e.flags|=4),typeof Pt.getSnapshotBeforeUpdate=="function"&&(_e.flags|=1024)):(typeof Pt.componentDidUpdate!="function"||Ut===$.memoizedProps&&pn===$.memoizedState||(_e.flags|=4),typeof Pt.getSnapshotBeforeUpdate!="function"||Ut===$.memoizedProps&&pn===$.memoizedState||(_e.flags|=1024),_e.memoizedProps=dt,_e.memoizedState=Pn),Pt.props=dt,Pt.state=Pn,Pt.context=Ft,dt=Yt):(typeof Pt.componentDidUpdate!="function"||Ut===$.memoizedProps&&pn===$.memoizedState||(_e.flags|=4),typeof Pt.getSnapshotBeforeUpdate!="function"||Ut===$.memoizedProps&&pn===$.memoizedState||(_e.flags|=1024),dt=!1)}return kj($,_e,_,dt,Et,vt)}function kj($,_e,_,dt,vt,Et){hj($,_e);var Pt=(_e.flags&128)!==0;if(!dt&&!Pt)return vt&&dg(_e,_,!1),$i($,_e,Et);dt=_e.stateNode,Xi.current=_e;var Ut=Pt&&typeof _.getDerivedStateFromError!="function"?null:dt.render();return _e.flags|=1,$!==null&&Pt?(_e.child=Bh(_e,$.child,null,Et),_e.child=Bh(_e,null,Ut,Et)):Yi($,_e,Ut,Et),_e.memoizedState=dt.state,vt&&dg(_e,_,!0),_e.child}function lj($){var _e=$.stateNode;_e.pendingContext?ag($,_e.pendingContext,_e.pendingContext!==_e.context):_e.context&&ag($,_e.context,!1),Ih($,_e.containerInfo)}function mj($,_e,_,dt,vt){return Ig(),Jg(vt),_e.flags|=256,Yi($,_e,_,dt),_e.child}var nj={dehydrated:null,treeContext:null,retryLane:0};function oj($){return{baseLanes:$,cachePool:null,transitions:null}}function pj($,_e,_){var dt=_e.pendingProps,vt=M.current,Et=!1,Pt=(_e.flags&128)!==0,Ut;if((Ut=Pt)||(Ut=$!==null&&$.memoizedState===null?!1:(vt&2)!==0),Ut?(Et=!0,_e.flags&=-129):($===null||$.memoizedState!==null)&&(vt|=1),G(M,vt&1),$===null)return Eg(_e),$=_e.memoizedState,$!==null&&($=$.dehydrated,$!==null)?(_e.mode&1?$.data==="$!"?_e.lanes=8:_e.lanes=1073741824:_e.lanes=1,null):(Pt=dt.children,$=dt.fallback,Et?(dt=_e.mode,Et=_e.child,Pt={mode:"hidden",children:Pt},!(dt&1)&&Et!==null?(Et.childLanes=0,Et.pendingProps=Pt):Et=qj(Pt,dt,0,null),$=Ah($,dt,_,null),Et.return=_e,$.return=_e,Et.sibling=$,_e.child=Et,_e.child.memoizedState=oj(_),_e.memoizedState=nj,$):rj(_e,Pt));if(vt=$.memoizedState,vt!==null&&(Ut=vt.dehydrated,Ut!==null))return sj($,_e,Pt,dt,Ut,vt,_);if(Et){Et=dt.fallback,Pt=_e.mode,vt=$.child,Ut=vt.sibling;var Ft={mode:"hidden",children:dt.children};return!(Pt&1)&&_e.child!==vt?(dt=_e.child,dt.childLanes=0,dt.pendingProps=Ft,_e.deletions=null):(dt=wh(vt,Ft),dt.subtreeFlags=vt.subtreeFlags&14680064),Ut!==null?Et=wh(Ut,Et):(Et=Ah(Et,Pt,_,null),Et.flags|=2),Et.return=_e,dt.return=_e,dt.sibling=Et,_e.child=dt,dt=Et,Et=_e.child,Pt=$.child.memoizedState,Pt=Pt===null?oj(_):{baseLanes:Pt.baseLanes|_,cachePool:null,transitions:Pt.transitions},Et.memoizedState=Pt,Et.childLanes=$.childLanes&~_,_e.memoizedState=nj,dt}return Et=$.child,$=Et.sibling,dt=wh(Et,{mode:"visible",children:dt.children}),!(_e.mode&1)&&(dt.lanes=_),dt.return=_e,dt.sibling=null,$!==null&&(_=_e.deletions,_===null?(_e.deletions=[$],_e.flags|=16):_.push($)),_e.child=dt,_e.memoizedState=null,dt}function rj($,_e){return _e=qj({mode:"visible",children:_e},$.mode,0,null),_e.return=$,$.child=_e}function tj($,_e,_,dt){return dt!==null&&Jg(dt),Bh(_e,$.child,null,_),$=rj(_e,_e.pendingProps.children),$.flags|=2,_e.memoizedState=null,$}function sj($,_e,_,dt,vt,Et,Pt){if(_)return _e.flags&256?(_e.flags&=-257,dt=Li(Error(p$1(422))),tj($,_e,Pt,dt)):_e.memoizedState!==null?(_e.child=$.child,_e.flags|=128,null):(Et=dt.fallback,vt=_e.mode,dt=qj({mode:"visible",children:dt.children},vt,0,null),Et=Ah(Et,vt,Pt,null),Et.flags|=2,dt.return=_e,Et.return=_e,dt.sibling=Et,_e.child=dt,_e.mode&1&&Bh(_e,$.child,null,Pt),_e.child.memoizedState=oj(Pt),_e.memoizedState=nj,Et);if(!(_e.mode&1))return tj($,_e,Pt,null);if(vt.data==="$!"){if(dt=vt.nextSibling&&vt.nextSibling.dataset,dt)var Ut=dt.dgst;return dt=Ut,Et=Error(p$1(419)),dt=Li(Et,dt,void 0),tj($,_e,Pt,dt)}if(Ut=(Pt&$.childLanes)!==0,Ug||Ut){if(dt=R,dt!==null){switch(Pt&-Pt){case 4:vt=2;break;case 16:vt=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:vt=32;break;case 536870912:vt=268435456;break;default:vt=0}vt=vt&(dt.suspendedLanes|Pt)?0:vt,vt!==0&&vt!==Et.retryLane&&(Et.retryLane=vt,Zg($,vt),mh(dt,$,vt,-1))}return uj(),dt=Li(Error(p$1(421))),tj($,_e,Pt,dt)}return vt.data==="$?"?(_e.flags|=128,_e.child=$.child,_e=vj.bind(null,$),vt._reactRetry=_e,null):($=Et.treeContext,yg=Lf(vt.nextSibling),xg=_e,I=!0,zg=null,$!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=$.id,sg=$.overflow,qg=_e),_e=rj(_e,dt.children),_e.flags|=4096,_e)}function wj($,_e,_){$.lanes|=_e;var dt=$.alternate;dt!==null&&(dt.lanes|=_e),Sg($.return,_e,_)}function xj($,_e,_,dt,vt){var Et=$.memoizedState;Et===null?$.memoizedState={isBackwards:_e,rendering:null,renderingStartTime:0,last:dt,tail:_,tailMode:vt}:(Et.isBackwards=_e,Et.rendering=null,Et.renderingStartTime=0,Et.last=dt,Et.tail=_,Et.tailMode=vt)}function yj($,_e,_){var dt=_e.pendingProps,vt=dt.revealOrder,Et=dt.tail;if(Yi($,_e,dt.children,_),dt=M.current,dt&2)dt=dt&1|2,_e.flags|=128;else{if($!==null&&$.flags&128)e:for($=_e.child;$!==null;){if($.tag===13)$.memoizedState!==null&&wj($,_,_e);else if($.tag===19)wj($,_,_e);else if($.child!==null){$.child.return=$,$=$.child;continue}if($===_e)break e;for(;$.sibling===null;){if($.return===null||$.return===_e)break e;$=$.return}$.sibling.return=$.return,$=$.sibling}dt&=1}if(G(M,dt),!(_e.mode&1))_e.memoizedState=null;else switch(vt){case"forwards":for(_=_e.child,vt=null;_!==null;)$=_.alternate,$!==null&&Mh($)===null&&(vt=_),_=_.sibling;_=vt,_===null?(vt=_e.child,_e.child=null):(vt=_.sibling,_.sibling=null),xj(_e,!1,vt,_,Et);break;case"backwards":for(_=null,vt=_e.child,_e.child=null;vt!==null;){if($=vt.alternate,$!==null&&Mh($)===null){_e.child=vt;break}$=vt.sibling,vt.sibling=_,_=vt,vt=$}xj(_e,!0,_,null,Et);break;case"together":xj(_e,!1,null,null,void 0);break;default:_e.memoizedState=null}return _e.child}function jj($,_e){!(_e.mode&1)&&$!==null&&($.alternate=null,_e.alternate=null,_e.flags|=2)}function $i($,_e,_){if($!==null&&(_e.dependencies=$.dependencies),hh|=_e.lanes,!(_&_e.childLanes))return null;if($!==null&&_e.child!==$.child)throw Error(p$1(153));if(_e.child!==null){for($=_e.child,_=wh($,$.pendingProps),_e.child=_,_.return=_e;$.sibling!==null;)$=$.sibling,_=_.sibling=wh($,$.pendingProps),_.return=_e;_.sibling=null}return _e.child}function zj($,_e,_){switch(_e.tag){case 3:lj(_e),Ig();break;case 5:Kh(_e);break;case 1:Zf(_e.type)&&cg(_e);break;case 4:Ih(_e,_e.stateNode.containerInfo);break;case 10:var dt=_e.type._context,vt=_e.memoizedProps.value;G(Mg,dt._currentValue),dt._currentValue=vt;break;case 13:if(dt=_e.memoizedState,dt!==null)return dt.dehydrated!==null?(G(M,M.current&1),_e.flags|=128,null):_&_e.child.childLanes?pj($,_e,_):(G(M,M.current&1),$=$i($,_e,_),$!==null?$.sibling:null);G(M,M.current&1);break;case 19:if(dt=(_&_e.childLanes)!==0,$.flags&128){if(dt)return yj($,_e,_);_e.flags|=128}if(vt=_e.memoizedState,vt!==null&&(vt.rendering=null,vt.tail=null,vt.lastEffect=null),G(M,M.current),dt)break;return null;case 22:case 23:return _e.lanes=0,ej($,_e,_)}return $i($,_e,_)}var Aj,Bj,Cj,Dj;Aj=function($,_e){for(var _=_e.child;_!==null;){if(_.tag===5||_.tag===6)$.appendChild(_.stateNode);else if(_.tag!==4&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===_e)break;for(;_.sibling===null;){if(_.return===null||_.return===_e)return;_=_.return}_.sibling.return=_.return,_=_.sibling}};Bj=function(){};Cj=function($,_e,_,dt){var vt=$.memoizedProps;if(vt!==dt){$=_e.stateNode,Hh(Eh.current);var Et=null;switch(_){case"input":vt=Ya($,vt),dt=Ya($,dt),Et=[];break;case"select":vt=A({},vt,{value:void 0}),dt=A({},dt,{value:void 0}),Et=[];break;case"textarea":vt=gb($,vt),dt=gb($,dt),Et=[];break;default:typeof vt.onClick!="function"&&typeof dt.onClick=="function"&&($.onclick=Bf)}ub(_,dt);var Pt;_=null;for(Yt in vt)if(!dt.hasOwnProperty(Yt)&&vt.hasOwnProperty(Yt)&&vt[Yt]!=null)if(Yt==="style"){var Ut=vt[Yt];for(Pt in Ut)Ut.hasOwnProperty(Pt)&&(_||(_={}),_[Pt]="")}else Yt!=="dangerouslySetInnerHTML"&&Yt!=="children"&&Yt!=="suppressContentEditableWarning"&&Yt!=="suppressHydrationWarning"&&Yt!=="autoFocus"&&(ea.hasOwnProperty(Yt)?Et||(Et=[]):(Et=Et||[]).push(Yt,null));for(Yt in dt){var Ft=dt[Yt];if(Ut=vt!=null?vt[Yt]:void 0,dt.hasOwnProperty(Yt)&&Ft!==Ut&&(Ft!=null||Ut!=null))if(Yt==="style")if(Ut){for(Pt in Ut)!Ut.hasOwnProperty(Pt)||Ft&&Ft.hasOwnProperty(Pt)||(_||(_={}),_[Pt]="");for(Pt in Ft)Ft.hasOwnProperty(Pt)&&Ut[Pt]!==Ft[Pt]&&(_||(_={}),_[Pt]=Ft[Pt])}else _||(Et||(Et=[]),Et.push(Yt,_)),_=Ft;else Yt==="dangerouslySetInnerHTML"?(Ft=Ft?Ft.__html:void 0,Ut=Ut?Ut.__html:void 0,Ft!=null&&Ut!==Ft&&(Et=Et||[]).push(Yt,Ft)):Yt==="children"?typeof Ft!="string"&&typeof Ft!="number"||(Et=Et||[]).push(Yt,""+Ft):Yt!=="suppressContentEditableWarning"&&Yt!=="suppressHydrationWarning"&&(ea.hasOwnProperty(Yt)?(Ft!=null&&Yt==="onScroll"&&D("scroll",$),Et||Ut===Ft||(Et=[])):(Et=Et||[]).push(Yt,Ft))}_&&(Et=Et||[]).push("style",_);var Yt=Et;(_e.updateQueue=Yt)&&(_e.flags|=4)}};Dj=function($,_e,_,dt){_!==dt&&(_e.flags|=4)};function Ej($,_e){if(!I)switch($.tailMode){case"hidden":_e=$.tail;for(var _=null;_e!==null;)_e.alternate!==null&&(_=_e),_e=_e.sibling;_===null?$.tail=null:_.sibling=null;break;case"collapsed":_=$.tail;for(var dt=null;_!==null;)_.alternate!==null&&(dt=_),_=_.sibling;dt===null?_e||$.tail===null?$.tail=null:$.tail.sibling=null:dt.sibling=null}}function S($){var _e=$.alternate!==null&&$.alternate.child===$.child,_=0,dt=0;if(_e)for(var vt=$.child;vt!==null;)_|=vt.lanes|vt.childLanes,dt|=vt.subtreeFlags&14680064,dt|=vt.flags&14680064,vt.return=$,vt=vt.sibling;else for(vt=$.child;vt!==null;)_|=vt.lanes|vt.childLanes,dt|=vt.subtreeFlags,dt|=vt.flags,vt.return=$,vt=vt.sibling;return $.subtreeFlags|=dt,$.childLanes=_,_e}function Fj($,_e,_){var dt=_e.pendingProps;switch(wg(_e),_e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(_e),null;case 1:return Zf(_e.type)&&$f(),S(_e),null;case 3:return dt=_e.stateNode,Jh(),E(Wf),E(H),Oh(),dt.pendingContext&&(dt.context=dt.pendingContext,dt.pendingContext=null),($===null||$.child===null)&&(Gg(_e)?_e.flags|=4:$===null||$.memoizedState.isDehydrated&&!(_e.flags&256)||(_e.flags|=1024,zg!==null&&(Gj(zg),zg=null))),Bj($,_e),S(_e),null;case 5:Lh(_e);var vt=Hh(Gh.current);if(_=_e.type,$!==null&&_e.stateNode!=null)Cj($,_e,_,dt,vt),$.ref!==_e.ref&&(_e.flags|=512,_e.flags|=2097152);else{if(!dt){if(_e.stateNode===null)throw Error(p$1(166));return S(_e),null}if($=Hh(Eh.current),Gg(_e)){dt=_e.stateNode,_=_e.type;var Et=_e.memoizedProps;switch(dt[Of]=_e,dt[Pf]=Et,$=(_e.mode&1)!==0,_){case"dialog":D("cancel",dt),D("close",dt);break;case"iframe":case"object":case"embed":D("load",dt);break;case"video":case"audio":for(vt=0;vt<lf.length;vt++)D(lf[vt],dt);break;case"source":D("error",dt);break;case"img":case"image":case"link":D("error",dt),D("load",dt);break;case"details":D("toggle",dt);break;case"input":Za(dt,Et),D("invalid",dt);break;case"select":dt._wrapperState={wasMultiple:!!Et.multiple},D("invalid",dt);break;case"textarea":hb(dt,Et),D("invalid",dt)}ub(_,Et),vt=null;for(var Pt in Et)if(Et.hasOwnProperty(Pt)){var Ut=Et[Pt];Pt==="children"?typeof Ut=="string"?dt.textContent!==Ut&&(Et.suppressHydrationWarning!==!0&&Af(dt.textContent,Ut,$),vt=["children",Ut]):typeof Ut=="number"&&dt.textContent!==""+Ut&&(Et.suppressHydrationWarning!==!0&&Af(dt.textContent,Ut,$),vt=["children",""+Ut]):ea.hasOwnProperty(Pt)&&Ut!=null&&Pt==="onScroll"&&D("scroll",dt)}switch(_){case"input":Va(dt),db(dt,Et,!0);break;case"textarea":Va(dt),jb(dt);break;case"select":case"option":break;default:typeof Et.onClick=="function"&&(dt.onclick=Bf)}dt=vt,_e.updateQueue=dt,dt!==null&&(_e.flags|=4)}else{Pt=vt.nodeType===9?vt:vt.ownerDocument,$==="http://www.w3.org/1999/xhtml"&&($=kb(_)),$==="http://www.w3.org/1999/xhtml"?_==="script"?($=Pt.createElement("div"),$.innerHTML="<script><\/script>",$=$.removeChild($.firstChild)):typeof dt.is=="string"?$=Pt.createElement(_,{is:dt.is}):($=Pt.createElement(_),_==="select"&&(Pt=$,dt.multiple?Pt.multiple=!0:dt.size&&(Pt.size=dt.size))):$=Pt.createElementNS($,_),$[Of]=_e,$[Pf]=dt,Aj($,_e,!1,!1),_e.stateNode=$;e:{switch(Pt=vb(_,dt),_){case"dialog":D("cancel",$),D("close",$),vt=dt;break;case"iframe":case"object":case"embed":D("load",$),vt=dt;break;case"video":case"audio":for(vt=0;vt<lf.length;vt++)D(lf[vt],$);vt=dt;break;case"source":D("error",$),vt=dt;break;case"img":case"image":case"link":D("error",$),D("load",$),vt=dt;break;case"details":D("toggle",$),vt=dt;break;case"input":Za($,dt),vt=Ya($,dt),D("invalid",$);break;case"option":vt=dt;break;case"select":$._wrapperState={wasMultiple:!!dt.multiple},vt=A({},dt,{value:void 0}),D("invalid",$);break;case"textarea":hb($,dt),vt=gb($,dt),D("invalid",$);break;default:vt=dt}ub(_,vt),Ut=vt;for(Et in Ut)if(Ut.hasOwnProperty(Et)){var Ft=Ut[Et];Et==="style"?sb($,Ft):Et==="dangerouslySetInnerHTML"?(Ft=Ft?Ft.__html:void 0,Ft!=null&&nb($,Ft)):Et==="children"?typeof Ft=="string"?(_!=="textarea"||Ft!=="")&&ob($,Ft):typeof Ft=="number"&&ob($,""+Ft):Et!=="suppressContentEditableWarning"&&Et!=="suppressHydrationWarning"&&Et!=="autoFocus"&&(ea.hasOwnProperty(Et)?Ft!=null&&Et==="onScroll"&&D("scroll",$):Ft!=null&&ta($,Et,Ft,Pt))}switch(_){case"input":Va($),db($,dt,!1);break;case"textarea":Va($),jb($);break;case"option":dt.value!=null&&$.setAttribute("value",""+Sa(dt.value));break;case"select":$.multiple=!!dt.multiple,Et=dt.value,Et!=null?fb($,!!dt.multiple,Et,!1):dt.defaultValue!=null&&fb($,!!dt.multiple,dt.defaultValue,!0);break;default:typeof vt.onClick=="function"&&($.onclick=Bf)}switch(_){case"button":case"input":case"select":case"textarea":dt=!!dt.autoFocus;break e;case"img":dt=!0;break e;default:dt=!1}}dt&&(_e.flags|=4)}_e.ref!==null&&(_e.flags|=512,_e.flags|=2097152)}return S(_e),null;case 6:if($&&_e.stateNode!=null)Dj($,_e,$.memoizedProps,dt);else{if(typeof dt!="string"&&_e.stateNode===null)throw Error(p$1(166));if(_=Hh(Gh.current),Hh(Eh.current),Gg(_e)){if(dt=_e.stateNode,_=_e.memoizedProps,dt[Of]=_e,(Et=dt.nodeValue!==_)&&($=xg,$!==null))switch($.tag){case 3:Af(dt.nodeValue,_,($.mode&1)!==0);break;case 5:$.memoizedProps.suppressHydrationWarning!==!0&&Af(dt.nodeValue,_,($.mode&1)!==0)}Et&&(_e.flags|=4)}else dt=(_.nodeType===9?_:_.ownerDocument).createTextNode(dt),dt[Of]=_e,_e.stateNode=dt}return S(_e),null;case 13:if(E(M),dt=_e.memoizedState,$===null||$.memoizedState!==null&&$.memoizedState.dehydrated!==null){if(I&&yg!==null&&_e.mode&1&&!(_e.flags&128))Hg(),Ig(),_e.flags|=98560,Et=!1;else if(Et=Gg(_e),dt!==null&&dt.dehydrated!==null){if($===null){if(!Et)throw Error(p$1(318));if(Et=_e.memoizedState,Et=Et!==null?Et.dehydrated:null,!Et)throw Error(p$1(317));Et[Of]=_e}else Ig(),!(_e.flags&128)&&(_e.memoizedState=null),_e.flags|=4;S(_e),Et=!1}else zg!==null&&(Gj(zg),zg=null),Et=!0;if(!Et)return _e.flags&65536?_e:null}return _e.flags&128?(_e.lanes=_,_e):(dt=dt!==null,dt!==($!==null&&$.memoizedState!==null)&&dt&&(_e.child.flags|=8192,_e.mode&1&&($===null||M.current&1?T===0&&(T=3):uj())),_e.updateQueue!==null&&(_e.flags|=4),S(_e),null);case 4:return Jh(),Bj($,_e),$===null&&sf(_e.stateNode.containerInfo),S(_e),null;case 10:return Rg(_e.type._context),S(_e),null;case 17:return Zf(_e.type)&&$f(),S(_e),null;case 19:if(E(M),Et=_e.memoizedState,Et===null)return S(_e),null;if(dt=(_e.flags&128)!==0,Pt=Et.rendering,Pt===null)if(dt)Ej(Et,!1);else{if(T!==0||$!==null&&$.flags&128)for($=_e.child;$!==null;){if(Pt=Mh($),Pt!==null){for(_e.flags|=128,Ej(Et,!1),dt=Pt.updateQueue,dt!==null&&(_e.updateQueue=dt,_e.flags|=4),_e.subtreeFlags=0,dt=_,_=_e.child;_!==null;)Et=_,$=dt,Et.flags&=14680066,Pt=Et.alternate,Pt===null?(Et.childLanes=0,Et.lanes=$,Et.child=null,Et.subtreeFlags=0,Et.memoizedProps=null,Et.memoizedState=null,Et.updateQueue=null,Et.dependencies=null,Et.stateNode=null):(Et.childLanes=Pt.childLanes,Et.lanes=Pt.lanes,Et.child=Pt.child,Et.subtreeFlags=0,Et.deletions=null,Et.memoizedProps=Pt.memoizedProps,Et.memoizedState=Pt.memoizedState,Et.updateQueue=Pt.updateQueue,Et.type=Pt.type,$=Pt.dependencies,Et.dependencies=$===null?null:{lanes:$.lanes,firstContext:$.firstContext}),_=_.sibling;return G(M,M.current&1|2),_e.child}$=$.sibling}Et.tail!==null&&B()>Hj&&(_e.flags|=128,dt=!0,Ej(Et,!1),_e.lanes=4194304)}else{if(!dt)if($=Mh(Pt),$!==null){if(_e.flags|=128,dt=!0,_=$.updateQueue,_!==null&&(_e.updateQueue=_,_e.flags|=4),Ej(Et,!0),Et.tail===null&&Et.tailMode==="hidden"&&!Pt.alternate&&!I)return S(_e),null}else 2*B()-Et.renderingStartTime>Hj&&_!==1073741824&&(_e.flags|=128,dt=!0,Ej(Et,!1),_e.lanes=4194304);Et.isBackwards?(Pt.sibling=_e.child,_e.child=Pt):(_=Et.last,_!==null?_.sibling=Pt:_e.child=Pt,Et.last=Pt)}return Et.tail!==null?(_e=Et.tail,Et.rendering=_e,Et.tail=_e.sibling,Et.renderingStartTime=B(),_e.sibling=null,_=M.current,G(M,dt?_&1|2:_&1),_e):(S(_e),null);case 22:case 23:return Ij(),dt=_e.memoizedState!==null,$!==null&&$.memoizedState!==null!==dt&&(_e.flags|=8192),dt&&_e.mode&1?gj&1073741824&&(S(_e),_e.subtreeFlags&6&&(_e.flags|=8192)):S(_e),null;case 24:return null;case 25:return null}throw Error(p$1(156,_e.tag))}function Jj($,_e){switch(wg(_e),_e.tag){case 1:return Zf(_e.type)&&$f(),$=_e.flags,$&65536?(_e.flags=$&-65537|128,_e):null;case 3:return Jh(),E(Wf),E(H),Oh(),$=_e.flags,$&65536&&!($&128)?(_e.flags=$&-65537|128,_e):null;case 5:return Lh(_e),null;case 13:if(E(M),$=_e.memoizedState,$!==null&&$.dehydrated!==null){if(_e.alternate===null)throw Error(p$1(340));Ig()}return $=_e.flags,$&65536?(_e.flags=$&-65537|128,_e):null;case 19:return E(M),null;case 4:return Jh(),null;case 10:return Rg(_e.type._context),null;case 22:case 23:return Ij(),null;case 24:return null;default:return null}}var Kj=!1,U=!1,Lj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Mj($,_e){var _=$.ref;if(_!==null)if(typeof _=="function")try{_(null)}catch(dt){W($,_e,dt)}else _.current=null}function Nj($,_e,_){try{_()}catch(dt){W($,_e,dt)}}var Oj=!1;function Pj($,_e){if(Cf=dd,$=Me(),Ne($)){if("selectionStart"in $)var _={start:$.selectionStart,end:$.selectionEnd};else e:{_=(_=$.ownerDocument)&&_.defaultView||window;var dt=_.getSelection&&_.getSelection();if(dt&&dt.rangeCount!==0){_=dt.anchorNode;var vt=dt.anchorOffset,Et=dt.focusNode;dt=dt.focusOffset;try{_.nodeType,Et.nodeType}catch{_=null;break e}var Pt=0,Ut=-1,Ft=-1,Yt=0,hn=0,_n=$,pn=null;t:for(;;){for(var ln;_n!==_||vt!==0&&_n.nodeType!==3||(Ut=Pt+vt),_n!==Et||dt!==0&&_n.nodeType!==3||(Ft=Pt+dt),_n.nodeType===3&&(Pt+=_n.nodeValue.length),(ln=_n.firstChild)!==null;)pn=_n,_n=ln;for(;;){if(_n===$)break t;if(pn===_&&++Yt===vt&&(Ut=Pt),pn===Et&&++hn===dt&&(Ft=Pt),(ln=_n.nextSibling)!==null)break;_n=pn,pn=_n.parentNode}_n=ln}_=Ut===-1||Ft===-1?null:{start:Ut,end:Ft}}else _=null}_=_||{start:0,end:0}}else _=null;for(Df={focusedElem:$,selectionRange:_},dd=!1,V=_e;V!==null;)if(_e=V,$=_e.child,(_e.subtreeFlags&1028)!==0&&$!==null)$.return=_e,V=$;else for(;V!==null;){_e=V;try{var Pn=_e.alternate;if(_e.flags&1024)switch(_e.tag){case 0:case 11:case 15:break;case 1:if(Pn!==null){var nn=Pn.memoizedProps,Hn=Pn.memoizedState,tn=_e.stateNode,Xt=tn.getSnapshotBeforeUpdate(_e.elementType===_e.type?nn:Lg(_e.type,nn),Hn);tn.__reactInternalSnapshotBeforeUpdate=Xt}break;case 3:var dn=_e.stateNode.containerInfo;dn.nodeType===1?dn.textContent="":dn.nodeType===9&&dn.documentElement&&dn.removeChild(dn.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(Nn){W(_e,_e.return,Nn)}if($=_e.sibling,$!==null){$.return=_e.return,V=$;break}V=_e.return}return Pn=Oj,Oj=!1,Pn}function Qj($,_e,_){var dt=_e.updateQueue;if(dt=dt!==null?dt.lastEffect:null,dt!==null){var vt=dt=dt.next;do{if((vt.tag&$)===$){var Et=vt.destroy;vt.destroy=void 0,Et!==void 0&&Nj(_e,_,Et)}vt=vt.next}while(vt!==dt)}}function Rj($,_e){if(_e=_e.updateQueue,_e=_e!==null?_e.lastEffect:null,_e!==null){var _=_e=_e.next;do{if((_.tag&$)===$){var dt=_.create;_.destroy=dt()}_=_.next}while(_!==_e)}}function Sj($){var _e=$.ref;if(_e!==null){var _=$.stateNode;switch($.tag){case 5:$=_;break;default:$=_}typeof _e=="function"?_e($):_e.current=$}}function Tj($){var _e=$.alternate;_e!==null&&($.alternate=null,Tj(_e)),$.child=null,$.deletions=null,$.sibling=null,$.tag===5&&(_e=$.stateNode,_e!==null&&(delete _e[Of],delete _e[Pf],delete _e[of],delete _e[Qf],delete _e[Rf])),$.stateNode=null,$.return=null,$.dependencies=null,$.memoizedProps=null,$.memoizedState=null,$.pendingProps=null,$.stateNode=null,$.updateQueue=null}function Uj($){return $.tag===5||$.tag===3||$.tag===4}function Vj($){e:for(;;){for(;$.sibling===null;){if($.return===null||Uj($.return))return null;$=$.return}for($.sibling.return=$.return,$=$.sibling;$.tag!==5&&$.tag!==6&&$.tag!==18;){if($.flags&2||$.child===null||$.tag===4)continue e;$.child.return=$,$=$.child}if(!($.flags&2))return $.stateNode}}function Wj($,_e,_){var dt=$.tag;if(dt===5||dt===6)$=$.stateNode,_e?_.nodeType===8?_.parentNode.insertBefore($,_e):_.insertBefore($,_e):(_.nodeType===8?(_e=_.parentNode,_e.insertBefore($,_)):(_e=_,_e.appendChild($)),_=_._reactRootContainer,_!=null||_e.onclick!==null||(_e.onclick=Bf));else if(dt!==4&&($=$.child,$!==null))for(Wj($,_e,_),$=$.sibling;$!==null;)Wj($,_e,_),$=$.sibling}function Xj($,_e,_){var dt=$.tag;if(dt===5||dt===6)$=$.stateNode,_e?_.insertBefore($,_e):_.appendChild($);else if(dt!==4&&($=$.child,$!==null))for(Xj($,_e,_),$=$.sibling;$!==null;)Xj($,_e,_),$=$.sibling}var X=null,Yj=!1;function Zj($,_e,_){for(_=_.child;_!==null;)ak($,_e,_),_=_.sibling}function ak($,_e,_){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,_)}catch{}switch(_.tag){case 5:U||Mj(_,_e);case 6:var dt=X,vt=Yj;X=null,Zj($,_e,_),X=dt,Yj=vt,X!==null&&(Yj?($=X,_=_.stateNode,$.nodeType===8?$.parentNode.removeChild(_):$.removeChild(_)):X.removeChild(_.stateNode));break;case 18:X!==null&&(Yj?($=X,_=_.stateNode,$.nodeType===8?Kf($.parentNode,_):$.nodeType===1&&Kf($,_),bd($)):Kf(X,_.stateNode));break;case 4:dt=X,vt=Yj,X=_.stateNode.containerInfo,Yj=!0,Zj($,_e,_),X=dt,Yj=vt;break;case 0:case 11:case 14:case 15:if(!U&&(dt=_.updateQueue,dt!==null&&(dt=dt.lastEffect,dt!==null))){vt=dt=dt.next;do{var Et=vt,Pt=Et.destroy;Et=Et.tag,Pt!==void 0&&(Et&2||Et&4)&&Nj(_,_e,Pt),vt=vt.next}while(vt!==dt)}Zj($,_e,_);break;case 1:if(!U&&(Mj(_,_e),dt=_.stateNode,typeof dt.componentWillUnmount=="function"))try{dt.props=_.memoizedProps,dt.state=_.memoizedState,dt.componentWillUnmount()}catch(Ut){W(_,_e,Ut)}Zj($,_e,_);break;case 21:Zj($,_e,_);break;case 22:_.mode&1?(U=(dt=U)||_.memoizedState!==null,Zj($,_e,_),U=dt):Zj($,_e,_);break;default:Zj($,_e,_)}}function bk($){var _e=$.updateQueue;if(_e!==null){$.updateQueue=null;var _=$.stateNode;_===null&&(_=$.stateNode=new Lj),_e.forEach(function(dt){var vt=ck.bind(null,$,dt);_.has(dt)||(_.add(dt),dt.then(vt,vt))})}}function dk($,_e){var _=_e.deletions;if(_!==null)for(var dt=0;dt<_.length;dt++){var vt=_[dt];try{var Et=$,Pt=_e,Ut=Pt;e:for(;Ut!==null;){switch(Ut.tag){case 5:X=Ut.stateNode,Yj=!1;break e;case 3:X=Ut.stateNode.containerInfo,Yj=!0;break e;case 4:X=Ut.stateNode.containerInfo,Yj=!0;break e}Ut=Ut.return}if(X===null)throw Error(p$1(160));ak(Et,Pt,vt),X=null,Yj=!1;var Ft=vt.alternate;Ft!==null&&(Ft.return=null),vt.return=null}catch(Yt){W(vt,_e,Yt)}}if(_e.subtreeFlags&12854)for(_e=_e.child;_e!==null;)ek(_e,$),_e=_e.sibling}function ek($,_e){var _=$.alternate,dt=$.flags;switch($.tag){case 0:case 11:case 14:case 15:if(dk(_e,$),fk($),dt&4){try{Qj(3,$,$.return),Rj(3,$)}catch(nn){W($,$.return,nn)}try{Qj(5,$,$.return)}catch(nn){W($,$.return,nn)}}break;case 1:dk(_e,$),fk($),dt&512&&_!==null&&Mj(_,_.return);break;case 5:if(dk(_e,$),fk($),dt&512&&_!==null&&Mj(_,_.return),$.flags&32){var vt=$.stateNode;try{ob(vt,"")}catch(nn){W($,$.return,nn)}}if(dt&4&&(vt=$.stateNode,vt!=null)){var Et=$.memoizedProps,Pt=_!==null?_.memoizedProps:Et,Ut=$.type,Ft=$.updateQueue;if($.updateQueue=null,Ft!==null)try{Ut==="input"&&Et.type==="radio"&&Et.name!=null&&ab(vt,Et),vb(Ut,Pt);var Yt=vb(Ut,Et);for(Pt=0;Pt<Ft.length;Pt+=2){var hn=Ft[Pt],_n=Ft[Pt+1];hn==="style"?sb(vt,_n):hn==="dangerouslySetInnerHTML"?nb(vt,_n):hn==="children"?ob(vt,_n):ta(vt,hn,_n,Yt)}switch(Ut){case"input":bb(vt,Et);break;case"textarea":ib(vt,Et);break;case"select":var pn=vt._wrapperState.wasMultiple;vt._wrapperState.wasMultiple=!!Et.multiple;var ln=Et.value;ln!=null?fb(vt,!!Et.multiple,ln,!1):pn!==!!Et.multiple&&(Et.defaultValue!=null?fb(vt,!!Et.multiple,Et.defaultValue,!0):fb(vt,!!Et.multiple,Et.multiple?[]:"",!1))}vt[Pf]=Et}catch(nn){W($,$.return,nn)}}break;case 6:if(dk(_e,$),fk($),dt&4){if($.stateNode===null)throw Error(p$1(162));vt=$.stateNode,Et=$.memoizedProps;try{vt.nodeValue=Et}catch(nn){W($,$.return,nn)}}break;case 3:if(dk(_e,$),fk($),dt&4&&_!==null&&_.memoizedState.isDehydrated)try{bd(_e.containerInfo)}catch(nn){W($,$.return,nn)}break;case 4:dk(_e,$),fk($);break;case 13:dk(_e,$),fk($),vt=$.child,vt.flags&8192&&(Et=vt.memoizedState!==null,vt.stateNode.isHidden=Et,!Et||vt.alternate!==null&&vt.alternate.memoizedState!==null||(gk=B())),dt&4&&bk($);break;case 22:if(hn=_!==null&&_.memoizedState!==null,$.mode&1?(U=(Yt=U)||hn,dk(_e,$),U=Yt):dk(_e,$),fk($),dt&8192){if(Yt=$.memoizedState!==null,($.stateNode.isHidden=Yt)&&!hn&&$.mode&1)for(V=$,hn=$.child;hn!==null;){for(_n=V=hn;V!==null;){switch(pn=V,ln=pn.child,pn.tag){case 0:case 11:case 14:case 15:Qj(4,pn,pn.return);break;case 1:Mj(pn,pn.return);var Pn=pn.stateNode;if(typeof Pn.componentWillUnmount=="function"){dt=pn,_=pn.return;try{_e=dt,Pn.props=_e.memoizedProps,Pn.state=_e.memoizedState,Pn.componentWillUnmount()}catch(nn){W(dt,_,nn)}}break;case 5:Mj(pn,pn.return);break;case 22:if(pn.memoizedState!==null){hk(_n);continue}}ln!==null?(ln.return=pn,V=ln):hk(_n)}hn=hn.sibling}e:for(hn=null,_n=$;;){if(_n.tag===5){if(hn===null){hn=_n;try{vt=_n.stateNode,Yt?(Et=vt.style,typeof Et.setProperty=="function"?Et.setProperty("display","none","important"):Et.display="none"):(Ut=_n.stateNode,Ft=_n.memoizedProps.style,Pt=Ft!=null&&Ft.hasOwnProperty("display")?Ft.display:null,Ut.style.display=rb("display",Pt))}catch(nn){W($,$.return,nn)}}}else if(_n.tag===6){if(hn===null)try{_n.stateNode.nodeValue=Yt?"":_n.memoizedProps}catch(nn){W($,$.return,nn)}}else if((_n.tag!==22&&_n.tag!==23||_n.memoizedState===null||_n===$)&&_n.child!==null){_n.child.return=_n,_n=_n.child;continue}if(_n===$)break e;for(;_n.sibling===null;){if(_n.return===null||_n.return===$)break e;hn===_n&&(hn=null),_n=_n.return}hn===_n&&(hn=null),_n.sibling.return=_n.return,_n=_n.sibling}}break;case 19:dk(_e,$),fk($),dt&4&&bk($);break;case 21:break;default:dk(_e,$),fk($)}}function fk($){var _e=$.flags;if(_e&2){try{e:{for(var _=$.return;_!==null;){if(Uj(_)){var dt=_;break e}_=_.return}throw Error(p$1(160))}switch(dt.tag){case 5:var vt=dt.stateNode;dt.flags&32&&(ob(vt,""),dt.flags&=-33);var Et=Vj($);Xj($,Et,vt);break;case 3:case 4:var Pt=dt.stateNode.containerInfo,Ut=Vj($);Wj($,Ut,Pt);break;default:throw Error(p$1(161))}}catch(Ft){W($,$.return,Ft)}$.flags&=-3}_e&4096&&($.flags&=-4097)}function ik($,_e,_){V=$,jk($)}function jk($,_e,_){for(var dt=($.mode&1)!==0;V!==null;){var vt=V,Et=vt.child;if(vt.tag===22&&dt){var Pt=vt.memoizedState!==null||Kj;if(!Pt){var Ut=vt.alternate,Ft=Ut!==null&&Ut.memoizedState!==null||U;Ut=Kj;var Yt=U;if(Kj=Pt,(U=Ft)&&!Yt)for(V=vt;V!==null;)Pt=V,Ft=Pt.child,Pt.tag===22&&Pt.memoizedState!==null?kk(vt):Ft!==null?(Ft.return=Pt,V=Ft):kk(vt);for(;Et!==null;)V=Et,jk(Et),Et=Et.sibling;V=vt,Kj=Ut,U=Yt}lk($)}else vt.subtreeFlags&8772&&Et!==null?(Et.return=vt,V=Et):lk($)}}function lk($){for(;V!==null;){var _e=V;if(_e.flags&8772){var _=_e.alternate;try{if(_e.flags&8772)switch(_e.tag){case 0:case 11:case 15:U||Rj(5,_e);break;case 1:var dt=_e.stateNode;if(_e.flags&4&&!U)if(_===null)dt.componentDidMount();else{var vt=_e.elementType===_e.type?_.memoizedProps:Lg(_e.type,_.memoizedProps);dt.componentDidUpdate(vt,_.memoizedState,dt.__reactInternalSnapshotBeforeUpdate)}var Et=_e.updateQueue;Et!==null&&ih(_e,Et,dt);break;case 3:var Pt=_e.updateQueue;if(Pt!==null){if(_=null,_e.child!==null)switch(_e.child.tag){case 5:_=_e.child.stateNode;break;case 1:_=_e.child.stateNode}ih(_e,Pt,_)}break;case 5:var Ut=_e.stateNode;if(_===null&&_e.flags&4){_=Ut;var Ft=_e.memoizedProps;switch(_e.type){case"button":case"input":case"select":case"textarea":Ft.autoFocus&&_.focus();break;case"img":Ft.src&&(_.src=Ft.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_e.memoizedState===null){var Yt=_e.alternate;if(Yt!==null){var hn=Yt.memoizedState;if(hn!==null){var _n=hn.dehydrated;_n!==null&&bd(_n)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U||_e.flags&512&&Sj(_e)}catch(pn){W(_e,_e.return,pn)}}if(_e===$){V=null;break}if(_=_e.sibling,_!==null){_.return=_e.return,V=_;break}V=_e.return}}function hk($){for(;V!==null;){var _e=V;if(_e===$){V=null;break}var _=_e.sibling;if(_!==null){_.return=_e.return,V=_;break}V=_e.return}}function kk($){for(;V!==null;){var _e=V;try{switch(_e.tag){case 0:case 11:case 15:var _=_e.return;try{Rj(4,_e)}catch(Ft){W(_e,_,Ft)}break;case 1:var dt=_e.stateNode;if(typeof dt.componentDidMount=="function"){var vt=_e.return;try{dt.componentDidMount()}catch(Ft){W(_e,vt,Ft)}}var Et=_e.return;try{Sj(_e)}catch(Ft){W(_e,Et,Ft)}break;case 5:var Pt=_e.return;try{Sj(_e)}catch(Ft){W(_e,Pt,Ft)}}}catch(Ft){W(_e,_e.return,Ft)}if(_e===$){V=null;break}var Ut=_e.sibling;if(Ut!==null){Ut.return=_e.return,V=Ut;break}V=_e.return}}var mk=Math.ceil,nk=ua.ReactCurrentDispatcher,ok=ua.ReactCurrentOwner,pk=ua.ReactCurrentBatchConfig,K=0,R=null,Y=null,Z=0,gj=0,fj=Uf(0),T=0,qk=null,hh=0,rk=0,sk=0,tk=null,uk=null,gk=0,Hj=1/0,vk=null,Pi=!1,Qi=null,Si=null,wk=!1,xk=null,yk=0,zk=0,Ak=null,Bk=-1,Ck=0;function L(){return K&6?B():Bk!==-1?Bk:Bk=B()}function lh($){return $.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Ck===0&&(Ck=yc()),Ck):($=C,$!==0||($=window.event,$=$===void 0?16:jd($.type)),$):1}function mh($,_e,_,dt){if(50<zk)throw zk=0,Ak=null,Error(p$1(185));Ac($,_,dt),(!(K&2)||$!==R)&&($===R&&(!(K&2)&&(rk|=_),T===4&&Dk($,Z)),Ek($,dt),_===1&&K===0&&!(_e.mode&1)&&(Hj=B()+500,fg&&jg()))}function Ek($,_e){var _=$.callbackNode;wc($,_e);var dt=uc($,$===R?Z:0);if(dt===0)_!==null&&bc(_),$.callbackNode=null,$.callbackPriority=0;else if(_e=dt&-dt,$.callbackPriority!==_e){if(_!=null&&bc(_),_e===1)$.tag===0?ig(Fk.bind(null,$)):hg(Fk.bind(null,$)),Jf(function(){!(K&6)&&jg()}),_=null;else{switch(Dc(dt)){case 1:_=fc;break;case 4:_=gc;break;case 16:_=hc;break;case 536870912:_=jc;break;default:_=hc}_=Gk(_,Hk.bind(null,$))}$.callbackPriority=_e,$.callbackNode=_}}function Hk($,_e){if(Bk=-1,Ck=0,K&6)throw Error(p$1(327));var _=$.callbackNode;if(Ik()&&$.callbackNode!==_)return null;var dt=uc($,$===R?Z:0);if(dt===0)return null;if(dt&30||dt&$.expiredLanes||_e)_e=Jk($,dt);else{_e=dt;var vt=K;K|=2;var Et=Kk();(R!==$||Z!==_e)&&(vk=null,Hj=B()+500,Lk($,_e));do try{Mk();break}catch(Ut){Nk($,Ut)}while(!0);Qg(),nk.current=Et,K=vt,Y!==null?_e=0:(R=null,Z=0,_e=T)}if(_e!==0){if(_e===2&&(vt=xc($),vt!==0&&(dt=vt,_e=Ok($,vt))),_e===1)throw _=qk,Lk($,0),Dk($,dt),Ek($,B()),_;if(_e===6)Dk($,dt);else{if(vt=$.current.alternate,!(dt&30)&&!Pk(vt)&&(_e=Jk($,dt),_e===2&&(Et=xc($),Et!==0&&(dt=Et,_e=Ok($,Et))),_e===1))throw _=qk,Lk($,0),Dk($,dt),Ek($,B()),_;switch($.finishedWork=vt,$.finishedLanes=dt,_e){case 0:case 1:throw Error(p$1(345));case 2:Qk($,uk,vk);break;case 3:if(Dk($,dt),(dt&130023424)===dt&&(_e=gk+500-B(),10<_e)){if(uc($,0)!==0)break;if(vt=$.suspendedLanes,(vt&dt)!==dt){L(),$.pingedLanes|=$.suspendedLanes&vt;break}$.timeoutHandle=Ff(Qk.bind(null,$,uk,vk),_e);break}Qk($,uk,vk);break;case 4:if(Dk($,dt),(dt&4194240)===dt)break;for(_e=$.eventTimes,vt=-1;0<dt;){var Pt=31-oc(dt);Et=1<<Pt,Pt=_e[Pt],Pt>vt&&(vt=Pt),dt&=~Et}if(dt=vt,dt=B()-dt,dt=(120>dt?120:480>dt?480:1080>dt?1080:1920>dt?1920:3e3>dt?3e3:4320>dt?4320:1960*mk(dt/1960))-dt,10<dt){$.timeoutHandle=Ff(Qk.bind(null,$,uk,vk),dt);break}Qk($,uk,vk);break;case 5:Qk($,uk,vk);break;default:throw Error(p$1(329))}}}return Ek($,B()),$.callbackNode===_?Hk.bind(null,$):null}function Ok($,_e){var _=tk;return $.current.memoizedState.isDehydrated&&(Lk($,_e).flags|=256),$=Jk($,_e),$!==2&&(_e=uk,uk=_,_e!==null&&Gj(_e)),$}function Gj($){uk===null?uk=$:uk.push.apply(uk,$)}function Pk($){for(var _e=$;;){if(_e.flags&16384){var _=_e.updateQueue;if(_!==null&&(_=_.stores,_!==null))for(var dt=0;dt<_.length;dt++){var vt=_[dt],Et=vt.getSnapshot;vt=vt.value;try{if(!He(Et(),vt))return!1}catch{return!1}}}if(_=_e.child,_e.subtreeFlags&16384&&_!==null)_.return=_e,_e=_;else{if(_e===$)break;for(;_e.sibling===null;){if(_e.return===null||_e.return===$)return!0;_e=_e.return}_e.sibling.return=_e.return,_e=_e.sibling}}return!0}function Dk($,_e){for(_e&=~sk,_e&=~rk,$.suspendedLanes|=_e,$.pingedLanes&=~_e,$=$.expirationTimes;0<_e;){var _=31-oc(_e),dt=1<<_;$[_]=-1,_e&=~dt}}function Fk($){if(K&6)throw Error(p$1(327));Ik();var _e=uc($,0);if(!(_e&1))return Ek($,B()),null;var _=Jk($,_e);if($.tag!==0&&_===2){var dt=xc($);dt!==0&&(_e=dt,_=Ok($,dt))}if(_===1)throw _=qk,Lk($,0),Dk($,_e),Ek($,B()),_;if(_===6)throw Error(p$1(345));return $.finishedWork=$.current.alternate,$.finishedLanes=_e,Qk($,uk,vk),Ek($,B()),null}function Rk($,_e){var _=K;K|=1;try{return $(_e)}finally{K=_,K===0&&(Hj=B()+500,fg&&jg())}}function Sk($){xk!==null&&xk.tag===0&&!(K&6)&&Ik();var _e=K;K|=1;var _=pk.transition,dt=C;try{if(pk.transition=null,C=1,$)return $()}finally{C=dt,pk.transition=_,K=_e,!(K&6)&&jg()}}function Ij(){gj=fj.current,E(fj)}function Lk($,_e){$.finishedWork=null,$.finishedLanes=0;var _=$.timeoutHandle;if(_!==-1&&($.timeoutHandle=-1,Gf(_)),Y!==null)for(_=Y.return;_!==null;){var dt=_;switch(wg(dt),dt.tag){case 1:dt=dt.type.childContextTypes,dt!=null&&$f();break;case 3:Jh(),E(Wf),E(H),Oh();break;case 5:Lh(dt);break;case 4:Jh();break;case 13:E(M);break;case 19:E(M);break;case 10:Rg(dt.type._context);break;case 22:case 23:Ij()}_=_.return}if(R=$,Y=$=wh($.current,null),Z=gj=_e,T=0,qk=null,sk=rk=hh=0,uk=tk=null,Wg!==null){for(_e=0;_e<Wg.length;_e++)if(_=Wg[_e],dt=_.interleaved,dt!==null){_.interleaved=null;var vt=dt.next,Et=_.pending;if(Et!==null){var Pt=Et.next;Et.next=vt,dt.next=Pt}_.pending=dt}Wg=null}return $}function Nk($,_e){do{var _=Y;try{if(Qg(),Ph.current=ai,Sh){for(var dt=N.memoizedState;dt!==null;){var vt=dt.queue;vt!==null&&(vt.pending=null),dt=dt.next}Sh=!1}if(Rh=0,P=O=N=null,Th=!1,Uh=0,ok.current=null,_===null||_.return===null){T=1,qk=_e,Y=null;break}e:{var Et=$,Pt=_.return,Ut=_,Ft=_e;if(_e=Z,Ut.flags|=32768,Ft!==null&&typeof Ft=="object"&&typeof Ft.then=="function"){var Yt=Ft,hn=Ut,_n=hn.tag;if(!(hn.mode&1)&&(_n===0||_n===11||_n===15)){var pn=hn.alternate;pn?(hn.updateQueue=pn.updateQueue,hn.memoizedState=pn.memoizedState,hn.lanes=pn.lanes):(hn.updateQueue=null,hn.memoizedState=null)}var ln=Vi(Pt);if(ln!==null){ln.flags&=-257,Wi(ln,Pt,Ut,Et,_e),ln.mode&1&&Ti(Et,Yt,_e),_e=ln,Ft=Yt;var Pn=_e.updateQueue;if(Pn===null){var nn=new Set;nn.add(Ft),_e.updateQueue=nn}else Pn.add(Ft);break e}else{if(!(_e&1)){Ti(Et,Yt,_e),uj();break e}Ft=Error(p$1(426))}}else if(I&&Ut.mode&1){var Hn=Vi(Pt);if(Hn!==null){!(Hn.flags&65536)&&(Hn.flags|=256),Wi(Hn,Pt,Ut,Et,_e),Jg(Ki(Ft,Ut));break e}}Et=Ft=Ki(Ft,Ut),T!==4&&(T=2),tk===null?tk=[Et]:tk.push(Et),Et=Pt;do{switch(Et.tag){case 3:Et.flags|=65536,_e&=-_e,Et.lanes|=_e;var tn=Oi(Et,Ft,_e);fh(Et,tn);break e;case 1:Ut=Ft;var Xt=Et.type,dn=Et.stateNode;if(!(Et.flags&128)&&(typeof Xt.getDerivedStateFromError=="function"||dn!==null&&typeof dn.componentDidCatch=="function"&&(Si===null||!Si.has(dn)))){Et.flags|=65536,_e&=-_e,Et.lanes|=_e;var Nn=Ri(Et,Ut,_e);fh(Et,Nn);break e}}Et=Et.return}while(Et!==null)}Tk(_)}catch(An){_e=An,Y===_&&_!==null&&(Y=_=_.return);continue}break}while(!0)}function Kk(){var $=nk.current;return nk.current=ai,$===null?ai:$}function uj(){(T===0||T===3||T===2)&&(T=4),R===null||!(hh&268435455)&&!(rk&268435455)||Dk(R,Z)}function Jk($,_e){var _=K;K|=2;var dt=Kk();(R!==$||Z!==_e)&&(vk=null,Lk($,_e));do try{Uk();break}catch(vt){Nk($,vt)}while(!0);if(Qg(),K=_,nk.current=dt,Y!==null)throw Error(p$1(261));return R=null,Z=0,T}function Uk(){for(;Y!==null;)Vk(Y)}function Mk(){for(;Y!==null&&!cc();)Vk(Y)}function Vk($){var _e=Wk($.alternate,$,gj);$.memoizedProps=$.pendingProps,_e===null?Tk($):Y=_e,ok.current=null}function Tk($){var _e=$;do{var _=_e.alternate;if($=_e.return,_e.flags&32768){if(_=Jj(_,_e),_!==null){_.flags&=32767,Y=_;return}if($!==null)$.flags|=32768,$.subtreeFlags=0,$.deletions=null;else{T=6,Y=null;return}}else if(_=Fj(_,_e,gj),_!==null){Y=_;return}if(_e=_e.sibling,_e!==null){Y=_e;return}Y=_e=$}while(_e!==null);T===0&&(T=5)}function Qk($,_e,_){var dt=C,vt=pk.transition;try{pk.transition=null,C=1,Xk($,_e,_,dt)}finally{pk.transition=vt,C=dt}return null}function Xk($,_e,_,dt){do Ik();while(xk!==null);if(K&6)throw Error(p$1(327));_=$.finishedWork;var vt=$.finishedLanes;if(_===null)return null;if($.finishedWork=null,$.finishedLanes=0,_===$.current)throw Error(p$1(177));$.callbackNode=null,$.callbackPriority=0;var Et=_.lanes|_.childLanes;if(Bc($,Et),$===R&&(Y=R=null,Z=0),!(_.subtreeFlags&2064)&&!(_.flags&2064)||wk||(wk=!0,Gk(hc,function(){return Ik(),null})),Et=(_.flags&15990)!==0,_.subtreeFlags&15990||Et){Et=pk.transition,pk.transition=null;var Pt=C;C=1;var Ut=K;K|=4,ok.current=null,Pj($,_),ek(_,$),Oe(Df),dd=!!Cf,Df=Cf=null,$.current=_,ik(_),dc(),K=Ut,C=Pt,pk.transition=Et}else $.current=_;if(wk&&(wk=!1,xk=$,yk=vt),Et=$.pendingLanes,Et===0&&(Si=null),mc(_.stateNode),Ek($,B()),_e!==null)for(dt=$.onRecoverableError,_=0;_<_e.length;_++)vt=_e[_],dt(vt.value,{componentStack:vt.stack,digest:vt.digest});if(Pi)throw Pi=!1,$=Qi,Qi=null,$;return yk&1&&$.tag!==0&&Ik(),Et=$.pendingLanes,Et&1?$===Ak?zk++:(zk=0,Ak=$):zk=0,jg(),null}function Ik(){if(xk!==null){var $=Dc(yk),_e=pk.transition,_=C;try{if(pk.transition=null,C=16>$?16:$,xk===null)var dt=!1;else{if($=xk,xk=null,yk=0,K&6)throw Error(p$1(331));var vt=K;for(K|=4,V=$.current;V!==null;){var Et=V,Pt=Et.child;if(V.flags&16){var Ut=Et.deletions;if(Ut!==null){for(var Ft=0;Ft<Ut.length;Ft++){var Yt=Ut[Ft];for(V=Yt;V!==null;){var hn=V;switch(hn.tag){case 0:case 11:case 15:Qj(8,hn,Et)}var _n=hn.child;if(_n!==null)_n.return=hn,V=_n;else for(;V!==null;){hn=V;var pn=hn.sibling,ln=hn.return;if(Tj(hn),hn===Yt){V=null;break}if(pn!==null){pn.return=ln,V=pn;break}V=ln}}}var Pn=Et.alternate;if(Pn!==null){var nn=Pn.child;if(nn!==null){Pn.child=null;do{var Hn=nn.sibling;nn.sibling=null,nn=Hn}while(nn!==null)}}V=Et}}if(Et.subtreeFlags&2064&&Pt!==null)Pt.return=Et,V=Pt;else e:for(;V!==null;){if(Et=V,Et.flags&2048)switch(Et.tag){case 0:case 11:case 15:Qj(9,Et,Et.return)}var tn=Et.sibling;if(tn!==null){tn.return=Et.return,V=tn;break e}V=Et.return}}var Xt=$.current;for(V=Xt;V!==null;){Pt=V;var dn=Pt.child;if(Pt.subtreeFlags&2064&&dn!==null)dn.return=Pt,V=dn;else e:for(Pt=Xt;V!==null;){if(Ut=V,Ut.flags&2048)try{switch(Ut.tag){case 0:case 11:case 15:Rj(9,Ut)}}catch(An){W(Ut,Ut.return,An)}if(Ut===Pt){V=null;break e}var Nn=Ut.sibling;if(Nn!==null){Nn.return=Ut.return,V=Nn;break e}V=Ut.return}}if(K=vt,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,$)}catch{}dt=!0}return dt}finally{C=_,pk.transition=_e}}return!1}function Yk($,_e,_){_e=Ki(_,_e),_e=Oi($,_e,1),$=dh($,_e,1),_e=L(),$!==null&&(Ac($,1,_e),Ek($,_e))}function W($,_e,_){if($.tag===3)Yk($,$,_);else for(;_e!==null;){if(_e.tag===3){Yk(_e,$,_);break}else if(_e.tag===1){var dt=_e.stateNode;if(typeof _e.type.getDerivedStateFromError=="function"||typeof dt.componentDidCatch=="function"&&(Si===null||!Si.has(dt))){$=Ki(_,$),$=Ri(_e,$,1),_e=dh(_e,$,1),$=L(),_e!==null&&(Ac(_e,1,$),Ek(_e,$));break}}_e=_e.return}}function Ui($,_e,_){var dt=$.pingCache;dt!==null&&dt.delete(_e),_e=L(),$.pingedLanes|=$.suspendedLanes&_,R===$&&(Z&_)===_&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-gk?Lk($,0):sk|=_),Ek($,_e)}function Zk($,_e){_e===0&&($.mode&1?(_e=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):_e=1);var _=L();$=Zg($,_e),$!==null&&(Ac($,_e,_),Ek($,_))}function vj($){var _e=$.memoizedState,_=0;_e!==null&&(_=_e.retryLane),Zk($,_)}function ck($,_e){var _=0;switch($.tag){case 13:var dt=$.stateNode,vt=$.memoizedState;vt!==null&&(_=vt.retryLane);break;case 19:dt=$.stateNode;break;default:throw Error(p$1(314))}dt!==null&&dt.delete(_e),Zk($,_)}var Wk;Wk=function($,_e,_){if($!==null)if($.memoizedProps!==_e.pendingProps||Wf.current)Ug=!0;else{if(!($.lanes&_)&&!(_e.flags&128))return Ug=!1,zj($,_e,_);Ug=!!($.flags&131072)}else Ug=!1,I&&_e.flags&1048576&&ug(_e,ng,_e.index);switch(_e.lanes=0,_e.tag){case 2:var dt=_e.type;jj($,_e),$=_e.pendingProps;var vt=Yf(_e,H.current);Tg(_e,_),vt=Xh(null,_e,dt,$,vt,_);var Et=bi();return _e.flags|=1,typeof vt=="object"&&vt!==null&&typeof vt.render=="function"&&vt.$$typeof===void 0?(_e.tag=1,_e.memoizedState=null,_e.updateQueue=null,Zf(dt)?(Et=!0,cg(_e)):Et=!1,_e.memoizedState=vt.state!==null&&vt.state!==void 0?vt.state:null,ah(_e),vt.updater=nh,_e.stateNode=vt,vt._reactInternals=_e,rh(_e,dt,$,_),_e=kj(null,_e,dt,!0,Et,_)):(_e.tag=0,I&&Et&&vg(_e),Yi(null,_e,vt,_),_e=_e.child),_e;case 16:dt=_e.elementType;e:{switch(jj($,_e),$=_e.pendingProps,vt=dt._init,dt=vt(dt._payload),_e.type=dt,vt=_e.tag=$k(dt),$=Lg(dt,$),vt){case 0:_e=dj(null,_e,dt,$,_);break e;case 1:_e=ij(null,_e,dt,$,_);break e;case 11:_e=Zi(null,_e,dt,$,_);break e;case 14:_e=aj(null,_e,dt,Lg(dt.type,$),_);break e}throw Error(p$1(306,dt,""))}return _e;case 0:return dt=_e.type,vt=_e.pendingProps,vt=_e.elementType===dt?vt:Lg(dt,vt),dj($,_e,dt,vt,_);case 1:return dt=_e.type,vt=_e.pendingProps,vt=_e.elementType===dt?vt:Lg(dt,vt),ij($,_e,dt,vt,_);case 3:e:{if(lj(_e),$===null)throw Error(p$1(387));dt=_e.pendingProps,Et=_e.memoizedState,vt=Et.element,bh($,_e),gh(_e,dt,null,_);var Pt=_e.memoizedState;if(dt=Pt.element,Et.isDehydrated)if(Et={element:dt,isDehydrated:!1,cache:Pt.cache,pendingSuspenseBoundaries:Pt.pendingSuspenseBoundaries,transitions:Pt.transitions},_e.updateQueue.baseState=Et,_e.memoizedState=Et,_e.flags&256){vt=Ki(Error(p$1(423)),_e),_e=mj($,_e,dt,_,vt);break e}else if(dt!==vt){vt=Ki(Error(p$1(424)),_e),_e=mj($,_e,dt,_,vt);break e}else for(yg=Lf(_e.stateNode.containerInfo.firstChild),xg=_e,I=!0,zg=null,_=Ch(_e,null,dt,_),_e.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling;else{if(Ig(),dt===vt){_e=$i($,_e,_);break e}Yi($,_e,dt,_)}_e=_e.child}return _e;case 5:return Kh(_e),$===null&&Eg(_e),dt=_e.type,vt=_e.pendingProps,Et=$!==null?$.memoizedProps:null,Pt=vt.children,Ef(dt,vt)?Pt=null:Et!==null&&Ef(dt,Et)&&(_e.flags|=32),hj($,_e),Yi($,_e,Pt,_),_e.child;case 6:return $===null&&Eg(_e),null;case 13:return pj($,_e,_);case 4:return Ih(_e,_e.stateNode.containerInfo),dt=_e.pendingProps,$===null?_e.child=Bh(_e,null,dt,_):Yi($,_e,dt,_),_e.child;case 11:return dt=_e.type,vt=_e.pendingProps,vt=_e.elementType===dt?vt:Lg(dt,vt),Zi($,_e,dt,vt,_);case 7:return Yi($,_e,_e.pendingProps,_),_e.child;case 8:return Yi($,_e,_e.pendingProps.children,_),_e.child;case 12:return Yi($,_e,_e.pendingProps.children,_),_e.child;case 10:e:{if(dt=_e.type._context,vt=_e.pendingProps,Et=_e.memoizedProps,Pt=vt.value,G(Mg,dt._currentValue),dt._currentValue=Pt,Et!==null)if(He(Et.value,Pt)){if(Et.children===vt.children&&!Wf.current){_e=$i($,_e,_);break e}}else for(Et=_e.child,Et!==null&&(Et.return=_e);Et!==null;){var Ut=Et.dependencies;if(Ut!==null){Pt=Et.child;for(var Ft=Ut.firstContext;Ft!==null;){if(Ft.context===dt){if(Et.tag===1){Ft=ch(-1,_&-_),Ft.tag=2;var Yt=Et.updateQueue;if(Yt!==null){Yt=Yt.shared;var hn=Yt.pending;hn===null?Ft.next=Ft:(Ft.next=hn.next,hn.next=Ft),Yt.pending=Ft}}Et.lanes|=_,Ft=Et.alternate,Ft!==null&&(Ft.lanes|=_),Sg(Et.return,_,_e),Ut.lanes|=_;break}Ft=Ft.next}}else if(Et.tag===10)Pt=Et.type===_e.type?null:Et.child;else if(Et.tag===18){if(Pt=Et.return,Pt===null)throw Error(p$1(341));Pt.lanes|=_,Ut=Pt.alternate,Ut!==null&&(Ut.lanes|=_),Sg(Pt,_,_e),Pt=Et.sibling}else Pt=Et.child;if(Pt!==null)Pt.return=Et;else for(Pt=Et;Pt!==null;){if(Pt===_e){Pt=null;break}if(Et=Pt.sibling,Et!==null){Et.return=Pt.return,Pt=Et;break}Pt=Pt.return}Et=Pt}Yi($,_e,vt.children,_),_e=_e.child}return _e;case 9:return vt=_e.type,dt=_e.pendingProps.children,Tg(_e,_),vt=Vg(vt),dt=dt(vt),_e.flags|=1,Yi($,_e,dt,_),_e.child;case 14:return dt=_e.type,vt=Lg(dt,_e.pendingProps),vt=Lg(dt.type,vt),aj($,_e,dt,vt,_);case 15:return cj($,_e,_e.type,_e.pendingProps,_);case 17:return dt=_e.type,vt=_e.pendingProps,vt=_e.elementType===dt?vt:Lg(dt,vt),jj($,_e),_e.tag=1,Zf(dt)?($=!0,cg(_e)):$=!1,Tg(_e,_),ph(_e,dt,vt),rh(_e,dt,vt,_),kj(null,_e,dt,!0,$,_);case 19:return yj($,_e,_);case 22:return ej($,_e,_)}throw Error(p$1(156,_e.tag))};function Gk($,_e){return ac($,_e)}function al($,_e,_,dt){this.tag=$,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=dt,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg($,_e,_,dt){return new al($,_e,_,dt)}function bj($){return $=$.prototype,!(!$||!$.isReactComponent)}function $k($){if(typeof $=="function")return bj($)?1:0;if($!=null){if($=$.$$typeof,$===Da)return 11;if($===Ga)return 14}return 2}function wh($,_e){var _=$.alternate;return _===null?(_=Bg($.tag,_e,$.key,$.mode),_.elementType=$.elementType,_.type=$.type,_.stateNode=$.stateNode,_.alternate=$,$.alternate=_):(_.pendingProps=_e,_.type=$.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=$.flags&14680064,_.childLanes=$.childLanes,_.lanes=$.lanes,_.child=$.child,_.memoizedProps=$.memoizedProps,_.memoizedState=$.memoizedState,_.updateQueue=$.updateQueue,_e=$.dependencies,_.dependencies=_e===null?null:{lanes:_e.lanes,firstContext:_e.firstContext},_.sibling=$.sibling,_.index=$.index,_.ref=$.ref,_}function yh($,_e,_,dt,vt,Et){var Pt=2;if(dt=$,typeof $=="function")bj($)&&(Pt=1);else if(typeof $=="string")Pt=5;else e:switch($){case ya:return Ah(_.children,vt,Et,_e);case za:Pt=8,vt|=8;break;case Aa:return $=Bg(12,_,_e,vt|2),$.elementType=Aa,$.lanes=Et,$;case Ea:return $=Bg(13,_,_e,vt),$.elementType=Ea,$.lanes=Et,$;case Fa:return $=Bg(19,_,_e,vt),$.elementType=Fa,$.lanes=Et,$;case Ia:return qj(_,vt,Et,_e);default:if(typeof $=="object"&&$!==null)switch($.$$typeof){case Ba:Pt=10;break e;case Ca:Pt=9;break e;case Da:Pt=11;break e;case Ga:Pt=14;break e;case Ha:Pt=16,dt=null;break e}throw Error(p$1(130,$==null?$:typeof $,""))}return _e=Bg(Pt,_,_e,vt),_e.elementType=$,_e.type=dt,_e.lanes=Et,_e}function Ah($,_e,_,dt){return $=Bg(7,$,dt,_e),$.lanes=_,$}function qj($,_e,_,dt){return $=Bg(22,$,dt,_e),$.elementType=Ia,$.lanes=_,$.stateNode={isHidden:!1},$}function xh($,_e,_){return $=Bg(6,$,null,_e),$.lanes=_,$}function zh($,_e,_){return _e=Bg(4,$.children!==null?$.children:[],$.key,_e),_e.lanes=_,_e.stateNode={containerInfo:$.containerInfo,pendingChildren:null,implementation:$.implementation},_e}function bl($,_e,_,dt,vt){this.tag=_e,this.containerInfo=$,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=dt,this.onRecoverableError=vt,this.mutableSourceEagerHydrationData=null}function cl($,_e,_,dt,vt,Et,Pt,Ut,Ft){return $=new bl($,_e,_,Ut,Ft),_e===1?(_e=1,Et===!0&&(_e|=8)):_e=0,Et=Bg(3,null,null,_e),$.current=Et,Et.stateNode=$,Et.memoizedState={element:dt,isDehydrated:_,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah(Et),$}function dl($,_e,_){var dt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:dt==null?null:""+dt,children:$,containerInfo:_e,implementation:_}}function el($){if(!$)return Vf;$=$._reactInternals;e:{if(Vb($)!==$||$.tag!==1)throw Error(p$1(170));var _e=$;do{switch(_e.tag){case 3:_e=_e.stateNode.context;break e;case 1:if(Zf(_e.type)){_e=_e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_e=_e.return}while(_e!==null);throw Error(p$1(171))}if($.tag===1){var _=$.type;if(Zf(_))return bg($,_,_e)}return _e}function fl($,_e,_,dt,vt,Et,Pt,Ut,Ft){return $=cl(_,dt,!0,$,vt,Et,Pt,Ut,Ft),$.context=el(null),_=$.current,dt=L(),vt=lh(_),Et=ch(dt,vt),Et.callback=_e??null,dh(_,Et,vt),$.current.lanes=vt,Ac($,vt,dt),Ek($,dt),$}function gl($,_e,_,dt){var vt=_e.current,Et=L(),Pt=lh(vt);return _=el(_),_e.context===null?_e.context=_:_e.pendingContext=_,_e=ch(Et,Pt),_e.payload={element:$},dt=dt===void 0?null:dt,dt!==null&&(_e.callback=dt),$=dh(vt,_e,Pt),$!==null&&(mh($,vt,Pt,Et),eh($,vt,Pt)),Pt}function hl($){if($=$.current,!$.child)return null;switch($.child.tag){case 5:return $.child.stateNode;default:return $.child.stateNode}}function il($,_e){if($=$.memoizedState,$!==null&&$.dehydrated!==null){var _=$.retryLane;$.retryLane=_!==0&&_<_e?_:_e}}function jl($,_e){il($,_e),($=$.alternate)&&il($,_e)}function kl(){return null}var ll=typeof reportError=="function"?reportError:function($){console.error($)};function ml($){this._internalRoot=$}nl.prototype.render=ml.prototype.render=function($){var _e=this._internalRoot;if(_e===null)throw Error(p$1(409));gl($,_e,null,null)};nl.prototype.unmount=ml.prototype.unmount=function(){var $=this._internalRoot;if($!==null){this._internalRoot=null;var _e=$.containerInfo;Sk(function(){gl(null,$,null,null)}),_e[uf]=null}};function nl($){this._internalRoot=$}nl.prototype.unstable_scheduleHydration=function($){if($){var _e=Hc();$={blockedOn:null,target:$,priority:_e};for(var _=0;_<Qc.length&&_e!==0&&_e<Qc[_].priority;_++);Qc.splice(_,0,$),_===0&&Vc($)}};function ol($){return!(!$||$.nodeType!==1&&$.nodeType!==9&&$.nodeType!==11)}function pl($){return!(!$||$.nodeType!==1&&$.nodeType!==9&&$.nodeType!==11&&($.nodeType!==8||$.nodeValue!==" react-mount-point-unstable "))}function ql(){}function rl($,_e,_,dt,vt){if(vt){if(typeof dt=="function"){var Et=dt;dt=function(){var Yt=hl(Pt);Et.call(Yt)}}var Pt=fl(_e,dt,$,0,null,!1,!1,"",ql);return $._reactRootContainer=Pt,$[uf]=Pt.current,sf($.nodeType===8?$.parentNode:$),Sk(),Pt}for(;vt=$.lastChild;)$.removeChild(vt);if(typeof dt=="function"){var Ut=dt;dt=function(){var Yt=hl(Ft);Ut.call(Yt)}}var Ft=cl($,0,!1,null,null,!1,!1,"",ql);return $._reactRootContainer=Ft,$[uf]=Ft.current,sf($.nodeType===8?$.parentNode:$),Sk(function(){gl(_e,Ft,_,dt)}),Ft}function sl($,_e,_,dt,vt){var Et=_._reactRootContainer;if(Et){var Pt=Et;if(typeof vt=="function"){var Ut=vt;vt=function(){var Ft=hl(Pt);Ut.call(Ft)}}gl(_e,Pt,$,vt)}else Pt=rl(_,_e,$,vt,dt);return hl(Pt)}Ec=function($){switch($.tag){case 3:var _e=$.stateNode;if(_e.current.memoizedState.isDehydrated){var _=tc(_e.pendingLanes);_!==0&&(Cc(_e,_|1),Ek(_e,B()),!(K&6)&&(Hj=B()+500,jg()))}break;case 13:Sk(function(){var dt=Zg($,1);if(dt!==null){var vt=L();mh(dt,$,1,vt)}}),jl($,1)}};Fc=function($){if($.tag===13){var _e=Zg($,134217728);if(_e!==null){var _=L();mh(_e,$,134217728,_)}jl($,134217728)}};Gc=function($){if($.tag===13){var _e=lh($),_=Zg($,_e);if(_!==null){var dt=L();mh(_,$,_e,dt)}jl($,_e)}};Hc=function(){return C};Ic=function($,_e){var _=C;try{return C=$,_e()}finally{C=_}};yb=function($,_e,_){switch(_e){case"input":if(bb($,_),_e=_.name,_.type==="radio"&&_e!=null){for(_=$;_.parentNode;)_=_.parentNode;for(_=_.querySelectorAll("input[name="+JSON.stringify(""+_e)+'][type="radio"]'),_e=0;_e<_.length;_e++){var dt=_[_e];if(dt!==$&&dt.form===$.form){var vt=Db(dt);if(!vt)throw Error(p$1(90));Wa(dt),bb(dt,vt)}}}break;case"textarea":ib($,_);break;case"select":_e=_.value,_e!=null&&fb($,!!_.multiple,_e,!1)}};Gb=Rk;Hb=Sk;var tl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Rk]},ul={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},vl={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function($){return $=Zb($),$===null?null:$.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||kl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wl.isDisabled&&wl.supportsFiber)try{kc=wl.inject(vl),lc=wl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl;reactDom_production_min.createPortal=function($,_e){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ol(_e))throw Error(p$1(200));return dl($,_e,null,_)};reactDom_production_min.createRoot=function($,_e){if(!ol($))throw Error(p$1(299));var _=!1,dt="",vt=ll;return _e!=null&&(_e.unstable_strictMode===!0&&(_=!0),_e.identifierPrefix!==void 0&&(dt=_e.identifierPrefix),_e.onRecoverableError!==void 0&&(vt=_e.onRecoverableError)),_e=cl($,1,!1,null,null,_,!1,dt,vt),$[uf]=_e.current,sf($.nodeType===8?$.parentNode:$),new ml(_e)};reactDom_production_min.findDOMNode=function($){if($==null)return null;if($.nodeType===1)return $;var _e=$._reactInternals;if(_e===void 0)throw typeof $.render=="function"?Error(p$1(188)):($=Object.keys($).join(","),Error(p$1(268,$)));return $=Zb(_e),$=$===null?null:$.stateNode,$};reactDom_production_min.flushSync=function($){return Sk($)};reactDom_production_min.hydrate=function($,_e,_){if(!pl(_e))throw Error(p$1(200));return sl(null,$,_e,!0,_)};reactDom_production_min.hydrateRoot=function($,_e,_){if(!ol($))throw Error(p$1(405));var dt=_!=null&&_.hydratedSources||null,vt=!1,Et="",Pt=ll;if(_!=null&&(_.unstable_strictMode===!0&&(vt=!0),_.identifierPrefix!==void 0&&(Et=_.identifierPrefix),_.onRecoverableError!==void 0&&(Pt=_.onRecoverableError)),_e=fl(_e,null,$,1,_??null,vt,!1,Et,Pt),$[uf]=_e.current,sf($),dt)for($=0;$<dt.length;$++)_=dt[$],vt=_._getVersion,vt=vt(_._source),_e.mutableSourceEagerHydrationData==null?_e.mutableSourceEagerHydrationData=[_,vt]:_e.mutableSourceEagerHydrationData.push(_,vt);return new nl(_e)};reactDom_production_min.render=function($,_e,_){if(!pl(_e))throw Error(p$1(200));return sl(null,$,_e,!1,_)};reactDom_production_min.unmountComponentAtNode=function($){if(!pl($))throw Error(p$1(40));return $._reactRootContainer?(Sk(function(){sl(null,null,$,!1,function(){$._reactRootContainer=null,$[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Rk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function($,_e,_,dt){if(!pl(_))throw Error(p$1(200));if($==null||$._reactInternals===void 0)throw Error(p$1(38));return sl($,_e,_,!1,dt)};reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch($){console.error($)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,m=reactDomExports;client.createRoot=m.createRoot,client.hydrateRoot=m.hydrateRoot;var faK={prefix:"fas",iconName:"k",icon:[320,512,[107],"4b","M311 86.3c12.3-12.7 12-32.9-.7-45.2s-32.9-12-45.2 .7l-155.2 160L64 249V64c0-17.7-14.3-32-32-32S0 46.3 0 64V328 448c0 17.7 14.3 32 32 32s32-14.3 32-32V341l64.7-66.7 133 192c10.1 14.5 30 18.1 44.5 8.1s18.1-30 8.1-44.5L174.1 227.4 311 86.3z"]};function ownKeys$1($,_e){var _=Object.keys($);if(Object.getOwnPropertySymbols){var dt=Object.getOwnPropertySymbols($);_e&&(dt=dt.filter(function(vt){return Object.getOwnPropertyDescriptor($,vt).enumerable})),_.push.apply(_,dt)}return _}function _objectSpread2$1($){for(var _e=1;_e<arguments.length;_e++){var _=arguments[_e]!=null?arguments[_e]:{};_e%2?ownKeys$1(Object(_),!0).forEach(function(dt){_defineProperty$1($,dt,_[dt])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(_)):ownKeys$1(Object(_)).forEach(function(dt){Object.defineProperty($,dt,Object.getOwnPropertyDescriptor(_,dt))})}return $}function _typeof$1($){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_e){return typeof _e}:function(_e){return _e&&typeof Symbol=="function"&&_e.constructor===Symbol&&_e!==Symbol.prototype?"symbol":typeof _e},_typeof$1($)}function _classCallCheck($,_e){if(!($ instanceof _e))throw new TypeError("Cannot call a class as a function")}function _defineProperties($,_e){for(var _=0;_<_e.length;_++){var dt=_e[_];dt.enumerable=dt.enumerable||!1,dt.configurable=!0,"value"in dt&&(dt.writable=!0),Object.defineProperty($,dt.key,dt)}}function _createClass($,_e,_){return _e&&_defineProperties($.prototype,_e),_&&_defineProperties($,_),Object.defineProperty($,"prototype",{writable:!1}),$}function _defineProperty$1($,_e,_){return _e in $?Object.defineProperty($,_e,{value:_,enumerable:!0,configurable:!0,writable:!0}):$[_e]=_,$}function _slicedToArray($,_e){return _arrayWithHoles($)||_iterableToArrayLimit($,_e)||_unsupportedIterableToArray$1($,_e)||_nonIterableRest()}function _toConsumableArray$1($){return _arrayWithoutHoles$1($)||_iterableToArray$1($)||_unsupportedIterableToArray$1($)||_nonIterableSpread$1()}function _arrayWithoutHoles$1($){if(Array.isArray($))return _arrayLikeToArray$1($)}function _arrayWithHoles($){if(Array.isArray($))return $}function _iterableToArray$1($){if(typeof Symbol<"u"&&$[Symbol.iterator]!=null||$["@@iterator"]!=null)return Array.from($)}function _iterableToArrayLimit($,_e){var _=$==null?null:typeof Symbol<"u"&&$[Symbol.iterator]||$["@@iterator"];if(_!=null){var dt=[],vt=!0,Et=!1,Pt,Ut;try{for(_=_.call($);!(vt=(Pt=_.next()).done)&&(dt.push(Pt.value),!(_e&&dt.length===_e));vt=!0);}catch(Ft){Et=!0,Ut=Ft}finally{try{!vt&&_.return!=null&&_.return()}finally{if(Et)throw Ut}}return dt}}function _unsupportedIterableToArray$1($,_e){if($){if(typeof $=="string")return _arrayLikeToArray$1($,_e);var _=Object.prototype.toString.call($).slice(8,-1);if(_==="Object"&&$.constructor&&(_=$.constructor.name),_==="Map"||_==="Set")return Array.from($);if(_==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_))return _arrayLikeToArray$1($,_e)}}function _arrayLikeToArray$1($,_e){(_e==null||_e>$.length)&&(_e=$.length);for(var _=0,dt=new Array(_e);_<_e;_++)dt[_]=$[_];return dt}function _nonIterableSpread$1(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var noop=function(){},_WINDOW={},_DOCUMENT={},_MUTATION_OBSERVER=null,_PERFORMANCE={mark:noop,measure:noop};try{typeof window<"u"&&(_WINDOW=window),typeof document<"u"&&(_DOCUMENT=document),typeof MutationObserver<"u"&&(_MUTATION_OBSERVER=MutationObserver),typeof performance<"u"&&(_PERFORMANCE=performance)}catch{}var _ref=_WINDOW.navigator||{},_ref$userAgent=_ref.userAgent,userAgent=_ref$userAgent===void 0?"":_ref$userAgent,WINDOW=_WINDOW,DOCUMENT=_DOCUMENT,MUTATION_OBSERVER=_MUTATION_OBSERVER,PERFORMANCE=_PERFORMANCE;WINDOW.document;var IS_DOM=!!DOCUMENT.documentElement&&!!DOCUMENT.head&&typeof DOCUMENT.addEventListener=="function"&&typeof DOCUMENT.createElement=="function",IS_IE=~userAgent.indexOf("MSIE")||~userAgent.indexOf("Trident/"),_familyProxy,_familyProxy2,_familyProxy3,_familyProxy4,_familyProxy5,NAMESPACE_IDENTIFIER="___FONT_AWESOME___",UNITS_IN_GRID=16,DEFAULT_CSS_PREFIX="fa",DEFAULT_REPLACEMENT_CLASS="svg-inline--fa",DATA_FA_I2SVG="data-fa-i2svg",DATA_FA_PSEUDO_ELEMENT="data-fa-pseudo-element",DATA_FA_PSEUDO_ELEMENT_PENDING="data-fa-pseudo-element-pending",DATA_PREFIX="data-prefix",DATA_ICON="data-icon",HTML_CLASS_I2SVG_BASE_CLASS="fontawesome-i2svg",MUTATION_APPROACH_ASYNC="async",TAGNAMES_TO_SKIP_FOR_PSEUDOELEMENTS=["HTML","HEAD","STYLE","SCRIPT"],PRODUCTION$1=function(){try{return!0}catch{return!1}}(),FAMILY_CLASSIC="classic",FAMILY_SHARP="sharp",FAMILIES=[FAMILY_CLASSIC,FAMILY_SHARP];function familyProxy($){return new Proxy($,{get:function(_,dt){return dt in _?_[dt]:_[FAMILY_CLASSIC]}})}var PREFIX_TO_STYLE=familyProxy((_familyProxy={},_defineProperty$1(_familyProxy,FAMILY_CLASSIC,{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fad:"duotone","fa-duotone":"duotone",fab:"brands","fa-brands":"brands",fak:"kit",fakd:"kit","fa-kit":"kit","fa-kit-duotone":"kit"}),_defineProperty$1(_familyProxy,FAMILY_SHARP,{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"}),_familyProxy)),STYLE_TO_PREFIX=familyProxy((_familyProxy2={},_defineProperty$1(_familyProxy2,FAMILY_CLASSIC,{solid:"fas",regular:"far",light:"fal",thin:"fat",duotone:"fad",brands:"fab",kit:"fak"}),_defineProperty$1(_familyProxy2,FAMILY_SHARP,{solid:"fass",regular:"fasr",light:"fasl",thin:"fast"}),_familyProxy2)),PREFIX_TO_LONG_STYLE=familyProxy((_familyProxy3={},_defineProperty$1(_familyProxy3,FAMILY_CLASSIC,{fab:"fa-brands",fad:"fa-duotone",fak:"fa-kit",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"}),_defineProperty$1(_familyProxy3,FAMILY_SHARP,{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"}),_familyProxy3)),LONG_STYLE_TO_PREFIX=familyProxy((_familyProxy4={},_defineProperty$1(_familyProxy4,FAMILY_CLASSIC,{"fa-brands":"fab","fa-duotone":"fad","fa-kit":"fak","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"}),_defineProperty$1(_familyProxy4,FAMILY_SHARP,{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"}),_familyProxy4)),ICON_SELECTION_SYNTAX_PATTERN=/fa(s|r|l|t|d|b|k|ss|sr|sl|st)?[\-\ ]/,LAYERS_TEXT_CLASSNAME="fa-layers-text",FONT_FAMILY_PATTERN=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp|Kit)?.*/i,FONT_WEIGHT_TO_PREFIX=familyProxy((_familyProxy5={},_defineProperty$1(_familyProxy5,FAMILY_CLASSIC,{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"}),_defineProperty$1(_familyProxy5,FAMILY_SHARP,{900:"fass",400:"fasr",300:"fasl",100:"fast"}),_familyProxy5)),oneToTen=[1,2,3,4,5,6,7,8,9,10],oneToTwenty=oneToTen.concat([11,12,13,14,15,16,17,18,19,20]),ATTRIBUTES_WATCHED_FOR_MUTATION=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],DUOTONE_CLASSES={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},prefixes=new Set;Object.keys(STYLE_TO_PREFIX[FAMILY_CLASSIC]).map(prefixes.add.bind(prefixes));Object.keys(STYLE_TO_PREFIX[FAMILY_SHARP]).map(prefixes.add.bind(prefixes));var RESERVED_CLASSES=[].concat(FAMILIES,_toConsumableArray$1(prefixes),["2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",DUOTONE_CLASSES.GROUP,DUOTONE_CLASSES.SWAP_OPACITY,DUOTONE_CLASSES.PRIMARY,DUOTONE_CLASSES.SECONDARY]).concat(oneToTen.map(function($){return"".concat($,"x")})).concat(oneToTwenty.map(function($){return"w-".concat($)})),initial=WINDOW.FontAwesomeConfig||{};function getAttrConfig($){var _e=DOCUMENT.querySelector("script["+$+"]");if(_e)return _e.getAttribute($)}function coerce($){return $===""?!0:$==="false"?!1:$==="true"?!0:$}if(DOCUMENT&&typeof DOCUMENT.querySelector=="function"){var attrs=[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]];attrs.forEach(function($){var _e=_slicedToArray($,2),_=_e[0],dt=_e[1],vt=coerce(getAttrConfig(_));vt!=null&&(initial[dt]=vt)})}var _default={styleDefault:"solid",familyDefault:"classic",cssPrefix:DEFAULT_CSS_PREFIX,replacementClass:DEFAULT_REPLACEMENT_CLASS,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};initial.familyPrefix&&(initial.cssPrefix=initial.familyPrefix);var _config=_objectSpread2$1(_objectSpread2$1({},_default),initial);_config.autoReplaceSvg||(_config.observeMutations=!1);var config={};Object.keys(_default).forEach(function($){Object.defineProperty(config,$,{enumerable:!0,set:function(_){_config[$]=_,_onChangeCb.forEach(function(dt){return dt(config)})},get:function(){return _config[$]}})});Object.defineProperty(config,"familyPrefix",{enumerable:!0,set:function(_e){_config.cssPrefix=_e,_onChangeCb.forEach(function(_){return _(config)})},get:function(){return _config.cssPrefix}});WINDOW.FontAwesomeConfig=config;var _onChangeCb=[];function onChange($){return _onChangeCb.push($),function(){_onChangeCb.splice(_onChangeCb.indexOf($),1)}}var d=UNITS_IN_GRID,meaninglessTransform={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function insertCss($){if(!(!$||!IS_DOM)){var _e=DOCUMENT.createElement("style");_e.setAttribute("type","text/css"),_e.innerHTML=$;for(var _=DOCUMENT.head.childNodes,dt=null,vt=_.length-1;vt>-1;vt--){var Et=_[vt],Pt=(Et.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(Pt)>-1&&(dt=Et)}return DOCUMENT.head.insertBefore(_e,dt),$}}var idPool="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function nextUniqueId(){for(var $=12,_e="";$-- >0;)_e+=idPool[Math.random()*62|0];return _e}function toArray($){for(var _e=[],_=($||[]).length>>>0;_--;)_e[_]=$[_];return _e}function classArray($){return $.classList?toArray($.classList):($.getAttribute("class")||"").split(" ").filter(function(_e){return _e})}function htmlEscape($){return"".concat($).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function joinAttributes($){return Object.keys($||{}).reduce(function(_e,_){return _e+"".concat(_,'="').concat(htmlEscape($[_]),'" ')},"").trim()}function joinStyles($){return Object.keys($||{}).reduce(function(_e,_){return _e+"".concat(_,": ").concat($[_].trim(),";")},"")}function transformIsMeaningful($){return $.size!==meaninglessTransform.size||$.x!==meaninglessTransform.x||$.y!==meaninglessTransform.y||$.rotate!==meaninglessTransform.rotate||$.flipX||$.flipY}function transformForSvg($){var _e=$.transform,_=$.containerWidth,dt=$.iconWidth,vt={transform:"translate(".concat(_/2," 256)")},Et="translate(".concat(_e.x*32,", ").concat(_e.y*32,") "),Pt="scale(".concat(_e.size/16*(_e.flipX?-1:1),", ").concat(_e.size/16*(_e.flipY?-1:1),") "),Ut="rotate(".concat(_e.rotate," 0 0)"),Ft={transform:"".concat(Et," ").concat(Pt," ").concat(Ut)},Yt={transform:"translate(".concat(dt/2*-1," -256)")};return{outer:vt,inner:Ft,path:Yt}}function transformForCss($){var _e=$.transform,_=$.width,dt=_===void 0?UNITS_IN_GRID:_,vt=$.height,Et=vt===void 0?UNITS_IN_GRID:vt,Pt=$.startCentered,Ut=Pt===void 0?!1:Pt,Ft="";return Ut&&IS_IE?Ft+="translate(".concat(_e.x/d-dt/2,"em, ").concat(_e.y/d-Et/2,"em) "):Ut?Ft+="translate(calc(-50% + ".concat(_e.x/d,"em), calc(-50% + ").concat(_e.y/d,"em)) "):Ft+="translate(".concat(_e.x/d,"em, ").concat(_e.y/d,"em) "),Ft+="scale(".concat(_e.size/d*(_e.flipX?-1:1),", ").concat(_e.size/d*(_e.flipY?-1:1),") "),Ft+="rotate(".concat(_e.rotate,"deg) "),Ft}var baseStyles=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Solid";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Regular";
  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Light";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Thin";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 6 Sharp";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
}

svg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {
  overflow: visible;
  box-sizing: content-box;
}

.svg-inline--fa {
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285705em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  top: 0.25em;
}
.svg-inline--fa.fa-fw {
  width: var(--fa-fw-width, 1.25em);
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  -webkit-transform: scale(var(--fa-counter-scale, 0.25));
          transform: scale(var(--fa-counter-scale, 0.25));
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: bottom right;
          transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: bottom left;
          transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: top left;
          transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: 0.625em;
  line-height: 0.1em;
  vertical-align: 0.225em;
}

.fa-xs {
  font-size: 0.75em;
  line-height: 0.0833333337em;
  vertical-align: 0.125em;
}

.fa-sm {
  font-size: 0.875em;
  line-height: 0.0714285718em;
  vertical-align: 0.0535714295em;
}

.fa-lg {
  font-size: 1.25em;
  line-height: 0.05em;
  vertical-align: -0.075em;
}

.fa-xl {
  font-size: 1.5em;
  line-height: 0.0416666682em;
  vertical-align: -0.125em;
}

.fa-2xl {
  font-size: 2em;
  line-height: 0.03125em;
  vertical-align: -0.1875em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: var(--fa-li-margin, 2.5em);
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: calc(var(--fa-li-width, 2em) * -1);
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.08em);
  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);
}

.fa-pull-left {
  float: left;
  margin-right: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right {
  float: right;
  margin-left: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  -webkit-animation-name: fa-beat;
          animation-name: fa-beat;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, ease-in-out);
          animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  -webkit-animation-name: fa-bounce;
          animation-name: fa-bounce;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  -webkit-animation-name: fa-fade;
          animation-name: fa-fade;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  -webkit-animation-name: fa-beat-fade;
          animation-name: fa-beat-fade;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  -webkit-animation-name: fa-flip;
          animation-name: fa-flip;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, ease-in-out);
          animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  -webkit-animation-name: fa-shake;
          animation-name: fa-shake;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, linear);
          animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  -webkit-animation-name: fa-spin;
          animation-name: fa-spin;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 2s);
          animation-duration: var(--fa-animation-duration, 2s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, linear);
          animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  -webkit-animation-name: fa-spin;
          animation-name: fa-spin;
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, steps(8));
          animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
.fa-bounce,
.fa-fade,
.fa-beat-fade,
.fa-flip,
.fa-pulse,
.fa-shake,
.fa-spin,
.fa-spin-pulse {
    -webkit-animation-delay: -1ms;
            animation-delay: -1ms;
    -webkit-animation-duration: 1ms;
            animation-duration: 1ms;
    -webkit-animation-iteration-count: 1;
            animation-iteration-count: 1;
    -webkit-transition-delay: 0s;
            transition-delay: 0s;
    -webkit-transition-duration: 0s;
            transition-duration: 0s;
  }
}
@-webkit-keyframes fa-beat {
  0%, 90% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  45% {
    -webkit-transform: scale(var(--fa-beat-scale, 1.25));
            transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-beat {
  0%, 90% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  45% {
    -webkit-transform: scale(var(--fa-beat-scale, 1.25));
            transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@-webkit-keyframes fa-bounce {
  0% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  10% {
    -webkit-transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
            transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    -webkit-transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
            transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    -webkit-transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
            transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    -webkit-transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
            transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  100% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-bounce {
  0% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  10% {
    -webkit-transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
            transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    -webkit-transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
            transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    -webkit-transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
            transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    -webkit-transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
            transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  100% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
}
@-webkit-keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@-webkit-keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  50% {
    opacity: 1;
    -webkit-transform: scale(var(--fa-beat-fade-scale, 1.125));
            transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  50% {
    opacity: 1;
    -webkit-transform: scale(var(--fa-beat-fade-scale, 1.125));
            transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@-webkit-keyframes fa-flip {
  50% {
    -webkit-transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
            transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-flip {
  50% {
    -webkit-transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
            transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@-webkit-keyframes fa-shake {
  0% {
    -webkit-transform: rotate(-15deg);
            transform: rotate(-15deg);
  }
  4% {
    -webkit-transform: rotate(15deg);
            transform: rotate(15deg);
  }
  8%, 24% {
    -webkit-transform: rotate(-18deg);
            transform: rotate(-18deg);
  }
  12%, 28% {
    -webkit-transform: rotate(18deg);
            transform: rotate(18deg);
  }
  16% {
    -webkit-transform: rotate(-22deg);
            transform: rotate(-22deg);
  }
  20% {
    -webkit-transform: rotate(22deg);
            transform: rotate(22deg);
  }
  32% {
    -webkit-transform: rotate(-12deg);
            transform: rotate(-12deg);
  }
  36% {
    -webkit-transform: rotate(12deg);
            transform: rotate(12deg);
  }
  40%, 100% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
}
@keyframes fa-shake {
  0% {
    -webkit-transform: rotate(-15deg);
            transform: rotate(-15deg);
  }
  4% {
    -webkit-transform: rotate(15deg);
            transform: rotate(15deg);
  }
  8%, 24% {
    -webkit-transform: rotate(-18deg);
            transform: rotate(-18deg);
  }
  12%, 28% {
    -webkit-transform: rotate(18deg);
            transform: rotate(18deg);
  }
  16% {
    -webkit-transform: rotate(-22deg);
            transform: rotate(-22deg);
  }
  20% {
    -webkit-transform: rotate(22deg);
            transform: rotate(22deg);
  }
  32% {
    -webkit-transform: rotate(-12deg);
            transform: rotate(-12deg);
  }
  36% {
    -webkit-transform: rotate(12deg);
            transform: rotate(12deg);
  }
  40%, 100% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
}
@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  -webkit-transform: rotate(90deg);
          transform: rotate(90deg);
}

.fa-rotate-180 {
  -webkit-transform: rotate(180deg);
          transform: rotate(180deg);
}

.fa-rotate-270 {
  -webkit-transform: rotate(270deg);
          transform: rotate(270deg);
}

.fa-flip-horizontal {
  -webkit-transform: scale(-1, 1);
          transform: scale(-1, 1);
}

.fa-flip-vertical {
  -webkit-transform: scale(1, -1);
          transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  -webkit-transform: scale(-1, -1);
          transform: scale(-1, -1);
}

.fa-rotate-by {
  -webkit-transform: rotate(var(--fa-rotate-angle, none));
          transform: rotate(var(--fa-rotate-angle, none));
}

.fa-stack {
  display: inline-block;
  vertical-align: middle;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
  z-index: var(--fa-stack-z-index, auto);
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.sr-only,
.fa-sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.sr-only-focusable:not(:focus),
.fa-sr-only-focusable:not(:focus) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse,
.fa-duotone.fa-inverse {
  color: var(--fa-inverse, #fff);
}`;function css(){var $=DEFAULT_CSS_PREFIX,_e=DEFAULT_REPLACEMENT_CLASS,_=config.cssPrefix,dt=config.replacementClass,vt=baseStyles;if(_!==$||dt!==_e){var Et=new RegExp("\\.".concat($,"\\-"),"g"),Pt=new RegExp("\\--".concat($,"\\-"),"g"),Ut=new RegExp("\\.".concat(_e),"g");vt=vt.replace(Et,".".concat(_,"-")).replace(Pt,"--".concat(_,"-")).replace(Ut,".".concat(dt))}return vt}var _cssInserted=!1;function ensureCss(){config.autoAddCss&&!_cssInserted&&(insertCss(css()),_cssInserted=!0)}var InjectCSS={mixout:function(){return{dom:{css,insertCss:ensureCss}}},hooks:function(){return{beforeDOMElementCreation:function(){ensureCss()},beforeI2svg:function(){ensureCss()}}}},w=WINDOW||{};w[NAMESPACE_IDENTIFIER]||(w[NAMESPACE_IDENTIFIER]={});w[NAMESPACE_IDENTIFIER].styles||(w[NAMESPACE_IDENTIFIER].styles={});w[NAMESPACE_IDENTIFIER].hooks||(w[NAMESPACE_IDENTIFIER].hooks={});w[NAMESPACE_IDENTIFIER].shims||(w[NAMESPACE_IDENTIFIER].shims=[]);var namespace=w[NAMESPACE_IDENTIFIER],functions=[],listener=function $(){DOCUMENT.removeEventListener("DOMContentLoaded",$),loaded=1,functions.map(function(_e){return _e()})},loaded=!1;IS_DOM&&(loaded=(DOCUMENT.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(DOCUMENT.readyState),loaded||DOCUMENT.addEventListener("DOMContentLoaded",listener));function domready($){IS_DOM&&(loaded?setTimeout($,0):functions.push($))}function toHtml($){var _e=$.tag,_=$.attributes,dt=_===void 0?{}:_,vt=$.children,Et=vt===void 0?[]:vt;return typeof $=="string"?htmlEscape($):"<".concat(_e," ").concat(joinAttributes(dt),">").concat(Et.map(toHtml).join(""),"</").concat(_e,">")}function iconFromMapping($,_e,_){if($&&$[_e]&&$[_e][_])return{prefix:_e,iconName:_,icon:$[_e][_]}}var bindInternal4=function(_e,_){return function(dt,vt,Et,Pt){return _e.call(_,dt,vt,Et,Pt)}},reduce=function(_e,_,dt,vt){var Et=Object.keys(_e),Pt=Et.length,Ut=vt!==void 0?bindInternal4(_,vt):_,Ft,Yt,hn;for(dt===void 0?(Ft=1,hn=_e[Et[0]]):(Ft=0,hn=dt);Ft<Pt;Ft++)Yt=Et[Ft],hn=Ut(hn,_e[Yt],Yt,_e);return hn};function ucs2decode($){for(var _e=[],_=0,dt=$.length;_<dt;){var vt=$.charCodeAt(_++);if(vt>=55296&&vt<=56319&&_<dt){var Et=$.charCodeAt(_++);(Et&64512)==56320?_e.push(((vt&1023)<<10)+(Et&1023)+65536):(_e.push(vt),_--)}else _e.push(vt)}return _e}function toHex($){var _e=ucs2decode($);return _e.length===1?_e[0].toString(16):null}function codePointAt($,_e){var _=$.length,dt=$.charCodeAt(_e),vt;return dt>=55296&&dt<=56319&&_>_e+1&&(vt=$.charCodeAt(_e+1),vt>=56320&&vt<=57343)?(dt-55296)*1024+vt-56320+65536:dt}function normalizeIcons($){return Object.keys($).reduce(function(_e,_){var dt=$[_],vt=!!dt.icon;return vt?_e[dt.iconName]=dt.icon:_e[_]=dt,_e},{})}function defineIcons($,_e){var _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},dt=_.skipHooks,vt=dt===void 0?!1:dt,Et=normalizeIcons(_e);typeof namespace.hooks.addPack=="function"&&!vt?namespace.hooks.addPack($,normalizeIcons(_e)):namespace.styles[$]=_objectSpread2$1(_objectSpread2$1({},namespace.styles[$]||{}),Et),$==="fas"&&defineIcons("fa",_e)}var _LONG_STYLE,_PREFIXES,_PREFIXES_FOR_FAMILY,styles=namespace.styles,shims=namespace.shims,LONG_STYLE=(_LONG_STYLE={},_defineProperty$1(_LONG_STYLE,FAMILY_CLASSIC,Object.values(PREFIX_TO_LONG_STYLE[FAMILY_CLASSIC])),_defineProperty$1(_LONG_STYLE,FAMILY_SHARP,Object.values(PREFIX_TO_LONG_STYLE[FAMILY_SHARP])),_LONG_STYLE),_defaultUsablePrefix=null,_byUnicode={},_byLigature={},_byOldName={},_byOldUnicode={},_byAlias={},PREFIXES=(_PREFIXES={},_defineProperty$1(_PREFIXES,FAMILY_CLASSIC,Object.keys(PREFIX_TO_STYLE[FAMILY_CLASSIC])),_defineProperty$1(_PREFIXES,FAMILY_SHARP,Object.keys(PREFIX_TO_STYLE[FAMILY_SHARP])),_PREFIXES);function isReserved($){return~RESERVED_CLASSES.indexOf($)}function getIconName($,_e){var _=_e.split("-"),dt=_[0],vt=_.slice(1).join("-");return dt===$&&vt!==""&&!isReserved(vt)?vt:null}var build=function(){var _e=function(Et){return reduce(styles,function(Pt,Ut,Ft){return Pt[Ft]=reduce(Ut,Et,{}),Pt},{})};_byUnicode=_e(function(vt,Et,Pt){if(Et[3]&&(vt[Et[3]]=Pt),Et[2]){var Ut=Et[2].filter(function(Ft){return typeof Ft=="number"});Ut.forEach(function(Ft){vt[Ft.toString(16)]=Pt})}return vt}),_byLigature=_e(function(vt,Et,Pt){if(vt[Pt]=Pt,Et[2]){var Ut=Et[2].filter(function(Ft){return typeof Ft=="string"});Ut.forEach(function(Ft){vt[Ft]=Pt})}return vt}),_byAlias=_e(function(vt,Et,Pt){var Ut=Et[2];return vt[Pt]=Pt,Ut.forEach(function(Ft){vt[Ft]=Pt}),vt});var _="far"in styles||config.autoFetchSvg,dt=reduce(shims,function(vt,Et){var Pt=Et[0],Ut=Et[1],Ft=Et[2];return Ut==="far"&&!_&&(Ut="fas"),typeof Pt=="string"&&(vt.names[Pt]={prefix:Ut,iconName:Ft}),typeof Pt=="number"&&(vt.unicodes[Pt.toString(16)]={prefix:Ut,iconName:Ft}),vt},{names:{},unicodes:{}});_byOldName=dt.names,_byOldUnicode=dt.unicodes,_defaultUsablePrefix=getCanonicalPrefix(config.styleDefault,{family:config.familyDefault})};onChange(function($){_defaultUsablePrefix=getCanonicalPrefix($.styleDefault,{family:config.familyDefault})});build();function byUnicode($,_e){return(_byUnicode[$]||{})[_e]}function byLigature($,_e){return(_byLigature[$]||{})[_e]}function byAlias($,_e){return(_byAlias[$]||{})[_e]}function byOldName($){return _byOldName[$]||{prefix:null,iconName:null}}function byOldUnicode($){var _e=_byOldUnicode[$],_=byUnicode("fas",$);return _e||(_?{prefix:"fas",iconName:_}:null)||{prefix:null,iconName:null}}function getDefaultUsablePrefix(){return _defaultUsablePrefix}var emptyCanonicalIcon=function(){return{prefix:null,iconName:null,rest:[]}};function getCanonicalPrefix($){var _e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=_e.family,dt=_===void 0?FAMILY_CLASSIC:_,vt=PREFIX_TO_STYLE[dt][$],Et=STYLE_TO_PREFIX[dt][$]||STYLE_TO_PREFIX[dt][vt],Pt=$ in namespace.styles?$:null;return Et||Pt||null}var PREFIXES_FOR_FAMILY=(_PREFIXES_FOR_FAMILY={},_defineProperty$1(_PREFIXES_FOR_FAMILY,FAMILY_CLASSIC,Object.keys(PREFIX_TO_LONG_STYLE[FAMILY_CLASSIC])),_defineProperty$1(_PREFIXES_FOR_FAMILY,FAMILY_SHARP,Object.keys(PREFIX_TO_LONG_STYLE[FAMILY_SHARP])),_PREFIXES_FOR_FAMILY);function getCanonicalIcon($){var _e,_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},dt=_.skipLookups,vt=dt===void 0?!1:dt,Et=(_e={},_defineProperty$1(_e,FAMILY_CLASSIC,"".concat(config.cssPrefix,"-").concat(FAMILY_CLASSIC)),_defineProperty$1(_e,FAMILY_SHARP,"".concat(config.cssPrefix,"-").concat(FAMILY_SHARP)),_e),Pt=null,Ut=FAMILY_CLASSIC;($.includes(Et[FAMILY_CLASSIC])||$.some(function(Yt){return PREFIXES_FOR_FAMILY[FAMILY_CLASSIC].includes(Yt)}))&&(Ut=FAMILY_CLASSIC),($.includes(Et[FAMILY_SHARP])||$.some(function(Yt){return PREFIXES_FOR_FAMILY[FAMILY_SHARP].includes(Yt)}))&&(Ut=FAMILY_SHARP);var Ft=$.reduce(function(Yt,hn){var _n=getIconName(config.cssPrefix,hn);if(styles[hn]?(hn=LONG_STYLE[Ut].includes(hn)?LONG_STYLE_TO_PREFIX[Ut][hn]:hn,Pt=hn,Yt.prefix=hn):PREFIXES[Ut].indexOf(hn)>-1?(Pt=hn,Yt.prefix=getCanonicalPrefix(hn,{family:Ut})):_n?Yt.iconName=_n:hn!==config.replacementClass&&hn!==Et[FAMILY_CLASSIC]&&hn!==Et[FAMILY_SHARP]&&Yt.rest.push(hn),!vt&&Yt.prefix&&Yt.iconName){var pn=Pt==="fa"?byOldName(Yt.iconName):{},ln=byAlias(Yt.prefix,Yt.iconName);pn.prefix&&(Pt=null),Yt.iconName=pn.iconName||ln||Yt.iconName,Yt.prefix=pn.prefix||Yt.prefix,Yt.prefix==="far"&&!styles.far&&styles.fas&&!config.autoFetchSvg&&(Yt.prefix="fas")}return Yt},emptyCanonicalIcon());return($.includes("fa-brands")||$.includes("fab"))&&(Ft.prefix="fab"),($.includes("fa-duotone")||$.includes("fad"))&&(Ft.prefix="fad"),!Ft.prefix&&Ut===FAMILY_SHARP&&(styles.fass||config.autoFetchSvg)&&(Ft.prefix="fass",Ft.iconName=byAlias(Ft.prefix,Ft.iconName)||Ft.iconName),(Ft.prefix==="fa"||Pt==="fa")&&(Ft.prefix=getDefaultUsablePrefix()||"fas"),Ft}var Library=function(){function $(){_classCallCheck(this,$),this.definitions={}}return _createClass($,[{key:"add",value:function(){for(var _=this,dt=arguments.length,vt=new Array(dt),Et=0;Et<dt;Et++)vt[Et]=arguments[Et];var Pt=vt.reduce(this._pullDefinitions,{});Object.keys(Pt).forEach(function(Ut){_.definitions[Ut]=_objectSpread2$1(_objectSpread2$1({},_.definitions[Ut]||{}),Pt[Ut]),defineIcons(Ut,Pt[Ut]);var Ft=PREFIX_TO_LONG_STYLE[FAMILY_CLASSIC][Ut];Ft&&defineIcons(Ft,Pt[Ut]),build()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(_,dt){var vt=dt.prefix&&dt.iconName&&dt.icon?{0:dt}:dt;return Object.keys(vt).map(function(Et){var Pt=vt[Et],Ut=Pt.prefix,Ft=Pt.iconName,Yt=Pt.icon,hn=Yt[2];_[Ut]||(_[Ut]={}),hn.length>0&&hn.forEach(function(_n){typeof _n=="string"&&(_[Ut][_n]=Yt)}),_[Ut][Ft]=Yt}),_}}]),$}(),_plugins=[],_hooks={},providers={},defaultProviderKeys=Object.keys(providers);function registerPlugins($,_e){var _=_e.mixoutsTo;return _plugins=$,_hooks={},Object.keys(providers).forEach(function(dt){defaultProviderKeys.indexOf(dt)===-1&&delete providers[dt]}),_plugins.forEach(function(dt){var vt=dt.mixout?dt.mixout():{};if(Object.keys(vt).forEach(function(Pt){typeof vt[Pt]=="function"&&(_[Pt]=vt[Pt]),_typeof$1(vt[Pt])==="object"&&Object.keys(vt[Pt]).forEach(function(Ut){_[Pt]||(_[Pt]={}),_[Pt][Ut]=vt[Pt][Ut]})}),dt.hooks){var Et=dt.hooks();Object.keys(Et).forEach(function(Pt){_hooks[Pt]||(_hooks[Pt]=[]),_hooks[Pt].push(Et[Pt])})}dt.provides&&dt.provides(providers)}),_}function chainHooks($,_e){for(var _=arguments.length,dt=new Array(_>2?_-2:0),vt=2;vt<_;vt++)dt[vt-2]=arguments[vt];var Et=_hooks[$]||[];return Et.forEach(function(Pt){_e=Pt.apply(null,[_e].concat(dt))}),_e}function callHooks($){for(var _e=arguments.length,_=new Array(_e>1?_e-1:0),dt=1;dt<_e;dt++)_[dt-1]=arguments[dt];var vt=_hooks[$]||[];vt.forEach(function(Et){Et.apply(null,_)})}function callProvided(){var $=arguments[0],_e=Array.prototype.slice.call(arguments,1);return providers[$]?providers[$].apply(null,_e):void 0}function findIconDefinition($){$.prefix==="fa"&&($.prefix="fas");var _e=$.iconName,_=$.prefix||getDefaultUsablePrefix();if(_e)return _e=byAlias(_,_e)||_e,iconFromMapping(library.definitions,_,_e)||iconFromMapping(namespace.styles,_,_e)}var library=new Library,noAuto=function(){config.autoReplaceSvg=!1,config.observeMutations=!1,callHooks("noAuto")},dom={i2svg:function(){var _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return IS_DOM?(callHooks("beforeI2svg",_e),callProvided("pseudoElements2svg",_e),callProvided("i2svg",_e)):Promise.reject("Operation requires a DOM of some kind.")},watch:function(){var _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=_e.autoReplaceSvgRoot;config.autoReplaceSvg===!1&&(config.autoReplaceSvg=!0),config.observeMutations=!0,domready(function(){autoReplace({autoReplaceSvgRoot:_}),callHooks("watch",_e)})}},parse={icon:function(_e){if(_e===null)return null;if(_typeof$1(_e)==="object"&&_e.prefix&&_e.iconName)return{prefix:_e.prefix,iconName:byAlias(_e.prefix,_e.iconName)||_e.iconName};if(Array.isArray(_e)&&_e.length===2){var _=_e[1].indexOf("fa-")===0?_e[1].slice(3):_e[1],dt=getCanonicalPrefix(_e[0]);return{prefix:dt,iconName:byAlias(dt,_)||_}}if(typeof _e=="string"&&(_e.indexOf("".concat(config.cssPrefix,"-"))>-1||_e.match(ICON_SELECTION_SYNTAX_PATTERN))){var vt=getCanonicalIcon(_e.split(" "),{skipLookups:!0});return{prefix:vt.prefix||getDefaultUsablePrefix(),iconName:byAlias(vt.prefix,vt.iconName)||vt.iconName}}if(typeof _e=="string"){var Et=getDefaultUsablePrefix();return{prefix:Et,iconName:byAlias(Et,_e)||_e}}}},api={noAuto,config,dom,parse,library,findIconDefinition,toHtml},autoReplace=function(){var _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=_e.autoReplaceSvgRoot,dt=_===void 0?DOCUMENT:_;(Object.keys(namespace.styles).length>0||config.autoFetchSvg)&&IS_DOM&&config.autoReplaceSvg&&api.dom.i2svg({node:dt})};function domVariants($,_e){return Object.defineProperty($,"abstract",{get:_e}),Object.defineProperty($,"html",{get:function(){return $.abstract.map(function(dt){return toHtml(dt)})}}),Object.defineProperty($,"node",{get:function(){if(IS_DOM){var dt=DOCUMENT.createElement("div");return dt.innerHTML=$.html,dt.children}}}),$}function asIcon($){var _e=$.children,_=$.main,dt=$.mask,vt=$.attributes,Et=$.styles,Pt=$.transform;if(transformIsMeaningful(Pt)&&_.found&&!dt.found){var Ut=_.width,Ft=_.height,Yt={x:Ut/Ft/2,y:.5};vt.style=joinStyles(_objectSpread2$1(_objectSpread2$1({},Et),{},{"transform-origin":"".concat(Yt.x+Pt.x/16,"em ").concat(Yt.y+Pt.y/16,"em")}))}return[{tag:"svg",attributes:vt,children:_e}]}function asSymbol($){var _e=$.prefix,_=$.iconName,dt=$.children,vt=$.attributes,Et=$.symbol,Pt=Et===!0?"".concat(_e,"-").concat(config.cssPrefix,"-").concat(_):Et;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:_objectSpread2$1(_objectSpread2$1({},vt),{},{id:Pt}),children:dt}]}]}function makeInlineSvgAbstract($){var _e=$.icons,_=_e.main,dt=_e.mask,vt=$.prefix,Et=$.iconName,Pt=$.transform,Ut=$.symbol,Ft=$.title,Yt=$.maskId,hn=$.titleId,_n=$.extra,pn=$.watchable,ln=pn===void 0?!1:pn,Pn=dt.found?dt:_,nn=Pn.width,Hn=Pn.height,tn=vt==="fak",Xt=[config.replacementClass,Et?"".concat(config.cssPrefix,"-").concat(Et):""].filter(function(Zt){return _n.classes.indexOf(Zt)===-1}).filter(function(Zt){return Zt!==""||!!Zt}).concat(_n.classes).join(" "),dn={children:[],attributes:_objectSpread2$1(_objectSpread2$1({},_n.attributes),{},{"data-prefix":vt,"data-icon":Et,class:Xt,role:_n.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(nn," ").concat(Hn)})},Nn=tn&&!~_n.classes.indexOf("fa-fw")?{width:"".concat(nn/Hn*16*.0625,"em")}:{};ln&&(dn.attributes[DATA_FA_I2SVG]=""),Ft&&(dn.children.push({tag:"title",attributes:{id:dn.attributes["aria-labelledby"]||"title-".concat(hn||nextUniqueId())},children:[Ft]}),delete dn.attributes.title);var An=_objectSpread2$1(_objectSpread2$1({},dn),{},{prefix:vt,iconName:Et,main:_,mask:dt,maskId:Yt,transform:Pt,symbol:Ut,styles:_objectSpread2$1(_objectSpread2$1({},Nn),_n.styles)}),kn=dt.found&&_.found?callProvided("generateAbstractMask",An)||{children:[],attributes:{}}:callProvided("generateAbstractIcon",An)||{children:[],attributes:{}},jt=kn.children,Wt=kn.attributes;return An.children=jt,An.attributes=Wt,Ut?asSymbol(An):asIcon(An)}function makeLayersTextAbstract($){var _e=$.content,_=$.width,dt=$.height,vt=$.transform,Et=$.title,Pt=$.extra,Ut=$.watchable,Ft=Ut===void 0?!1:Ut,Yt=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},Pt.attributes),Et?{title:Et}:{}),{},{class:Pt.classes.join(" ")});Ft&&(Yt[DATA_FA_I2SVG]="");var hn=_objectSpread2$1({},Pt.styles);transformIsMeaningful(vt)&&(hn.transform=transformForCss({transform:vt,startCentered:!0,width:_,height:dt}),hn["-webkit-transform"]=hn.transform);var _n=joinStyles(hn);_n.length>0&&(Yt.style=_n);var pn=[];return pn.push({tag:"span",attributes:Yt,children:[_e]}),Et&&pn.push({tag:"span",attributes:{class:"sr-only"},children:[Et]}),pn}function makeLayersCounterAbstract($){var _e=$.content,_=$.title,dt=$.extra,vt=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},dt.attributes),_?{title:_}:{}),{},{class:dt.classes.join(" ")}),Et=joinStyles(dt.styles);Et.length>0&&(vt.style=Et);var Pt=[];return Pt.push({tag:"span",attributes:vt,children:[_e]}),_&&Pt.push({tag:"span",attributes:{class:"sr-only"},children:[_]}),Pt}var styles$1=namespace.styles;function asFoundIcon($){var _e=$[0],_=$[1],dt=$.slice(4),vt=_slicedToArray(dt,1),Et=vt[0],Pt=null;return Array.isArray(Et)?Pt={tag:"g",attributes:{class:"".concat(config.cssPrefix,"-").concat(DUOTONE_CLASSES.GROUP)},children:[{tag:"path",attributes:{class:"".concat(config.cssPrefix,"-").concat(DUOTONE_CLASSES.SECONDARY),fill:"currentColor",d:Et[0]}},{tag:"path",attributes:{class:"".concat(config.cssPrefix,"-").concat(DUOTONE_CLASSES.PRIMARY),fill:"currentColor",d:Et[1]}}]}:Pt={tag:"path",attributes:{fill:"currentColor",d:Et}},{found:!0,width:_e,height:_,icon:Pt}}var missingIconResolutionMixin={found:!1,width:512,height:512};function maybeNotifyMissing($,_e){!PRODUCTION$1&&!config.showMissingIcons&&$&&console.error('Icon with name "'.concat($,'" and prefix "').concat(_e,'" is missing.'))}function findIcon($,_e){var _=_e;return _e==="fa"&&config.styleDefault!==null&&(_e=getDefaultUsablePrefix()),new Promise(function(dt,vt){if(callProvided("missingIconAbstract"),_==="fa"){var Et=byOldName($)||{};$=Et.iconName||$,_e=Et.prefix||_e}if($&&_e&&styles$1[_e]&&styles$1[_e][$]){var Pt=styles$1[_e][$];return dt(asFoundIcon(Pt))}maybeNotifyMissing($,_e),dt(_objectSpread2$1(_objectSpread2$1({},missingIconResolutionMixin),{},{icon:config.showMissingIcons&&$?callProvided("missingIconAbstract")||{}:{}}))})}var noop$1=function(){},p=config.measurePerformance&&PERFORMANCE&&PERFORMANCE.mark&&PERFORMANCE.measure?PERFORMANCE:{mark:noop$1,measure:noop$1},preamble='FA "6.5.1"',begin=function(_e){return p.mark("".concat(preamble," ").concat(_e," begins")),function(){return end(_e)}},end=function(_e){p.mark("".concat(preamble," ").concat(_e," ends")),p.measure("".concat(preamble," ").concat(_e),"".concat(preamble," ").concat(_e," begins"),"".concat(preamble," ").concat(_e," ends"))},perf={begin,end},noop$2=function(){};function isWatched($){var _e=$.getAttribute?$.getAttribute(DATA_FA_I2SVG):null;return typeof _e=="string"}function hasPrefixAndIcon($){var _e=$.getAttribute?$.getAttribute(DATA_PREFIX):null,_=$.getAttribute?$.getAttribute(DATA_ICON):null;return _e&&_}function hasBeenReplaced($){return $&&$.classList&&$.classList.contains&&$.classList.contains(config.replacementClass)}function getMutator(){if(config.autoReplaceSvg===!0)return mutators.replace;var $=mutators[config.autoReplaceSvg];return $||mutators.replace}function createElementNS($){return DOCUMENT.createElementNS("http://www.w3.org/2000/svg",$)}function createElement($){return DOCUMENT.createElement($)}function convertSVG($){var _e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=_e.ceFn,dt=_===void 0?$.tag==="svg"?createElementNS:createElement:_;if(typeof $=="string")return DOCUMENT.createTextNode($);var vt=dt($.tag);Object.keys($.attributes||[]).forEach(function(Pt){vt.setAttribute(Pt,$.attributes[Pt])});var Et=$.children||[];return Et.forEach(function(Pt){vt.appendChild(convertSVG(Pt,{ceFn:dt}))}),vt}function nodeAsComment($){var _e=" ".concat($.outerHTML," ");return _e="".concat(_e,"Font Awesome fontawesome.com "),_e}var mutators={replace:function(_e){var _=_e[0];if(_.parentNode)if(_e[1].forEach(function(vt){_.parentNode.insertBefore(convertSVG(vt),_)}),_.getAttribute(DATA_FA_I2SVG)===null&&config.keepOriginalSource){var dt=DOCUMENT.createComment(nodeAsComment(_));_.parentNode.replaceChild(dt,_)}else _.remove()},nest:function(_e){var _=_e[0],dt=_e[1];if(~classArray(_).indexOf(config.replacementClass))return mutators.replace(_e);var vt=new RegExp("".concat(config.cssPrefix,"-.*"));if(delete dt[0].attributes.id,dt[0].attributes.class){var Et=dt[0].attributes.class.split(" ").reduce(function(Ut,Ft){return Ft===config.replacementClass||Ft.match(vt)?Ut.toSvg.push(Ft):Ut.toNode.push(Ft),Ut},{toNode:[],toSvg:[]});dt[0].attributes.class=Et.toSvg.join(" "),Et.toNode.length===0?_.removeAttribute("class"):_.setAttribute("class",Et.toNode.join(" "))}var Pt=dt.map(function(Ut){return toHtml(Ut)}).join(`
`);_.setAttribute(DATA_FA_I2SVG,""),_.innerHTML=Pt}};function performOperationSync($){$()}function perform($,_e){var _=typeof _e=="function"?_e:noop$2;if($.length===0)_();else{var dt=performOperationSync;config.mutateApproach===MUTATION_APPROACH_ASYNC&&(dt=WINDOW.requestAnimationFrame||performOperationSync),dt(function(){var vt=getMutator(),Et=perf.begin("mutate");$.map(vt),Et(),_()})}}var disabled=!1;function disableObservation(){disabled=!0}function enableObservation(){disabled=!1}var mo=null;function observe($){if(MUTATION_OBSERVER&&config.observeMutations){var _e=$.treeCallback,_=_e===void 0?noop$2:_e,dt=$.nodeCallback,vt=dt===void 0?noop$2:dt,Et=$.pseudoElementsCallback,Pt=Et===void 0?noop$2:Et,Ut=$.observeMutationsRoot,Ft=Ut===void 0?DOCUMENT:Ut;mo=new MUTATION_OBSERVER(function(Yt){if(!disabled){var hn=getDefaultUsablePrefix();toArray(Yt).forEach(function(_n){if(_n.type==="childList"&&_n.addedNodes.length>0&&!isWatched(_n.addedNodes[0])&&(config.searchPseudoElements&&Pt(_n.target),_(_n.target)),_n.type==="attributes"&&_n.target.parentNode&&config.searchPseudoElements&&Pt(_n.target.parentNode),_n.type==="attributes"&&isWatched(_n.target)&&~ATTRIBUTES_WATCHED_FOR_MUTATION.indexOf(_n.attributeName))if(_n.attributeName==="class"&&hasPrefixAndIcon(_n.target)){var pn=getCanonicalIcon(classArray(_n.target)),ln=pn.prefix,Pn=pn.iconName;_n.target.setAttribute(DATA_PREFIX,ln||hn),Pn&&_n.target.setAttribute(DATA_ICON,Pn)}else hasBeenReplaced(_n.target)&&vt(_n.target)})}}),IS_DOM&&mo.observe(Ft,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}}function disconnect(){mo&&mo.disconnect()}function styleParser($){var _e=$.getAttribute("style"),_=[];return _e&&(_=_e.split(";").reduce(function(dt,vt){var Et=vt.split(":"),Pt=Et[0],Ut=Et.slice(1);return Pt&&Ut.length>0&&(dt[Pt]=Ut.join(":").trim()),dt},{})),_}function classParser($){var _e=$.getAttribute("data-prefix"),_=$.getAttribute("data-icon"),dt=$.innerText!==void 0?$.innerText.trim():"",vt=getCanonicalIcon(classArray($));return vt.prefix||(vt.prefix=getDefaultUsablePrefix()),_e&&_&&(vt.prefix=_e,vt.iconName=_),vt.iconName&&vt.prefix||(vt.prefix&&dt.length>0&&(vt.iconName=byLigature(vt.prefix,$.innerText)||byUnicode(vt.prefix,toHex($.innerText))),!vt.iconName&&config.autoFetchSvg&&$.firstChild&&$.firstChild.nodeType===Node.TEXT_NODE&&(vt.iconName=$.firstChild.data)),vt}function attributesParser($){var _e=toArray($.attributes).reduce(function(vt,Et){return vt.name!=="class"&&vt.name!=="style"&&(vt[Et.name]=Et.value),vt},{}),_=$.getAttribute("title"),dt=$.getAttribute("data-fa-title-id");return config.autoA11y&&(_?_e["aria-labelledby"]="".concat(config.replacementClass,"-title-").concat(dt||nextUniqueId()):(_e["aria-hidden"]="true",_e.focusable="false")),_e}function blankMeta(){return{iconName:null,title:null,titleId:null,prefix:null,transform:meaninglessTransform,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function parseMeta($){var _e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0},_=classParser($),dt=_.iconName,vt=_.prefix,Et=_.rest,Pt=attributesParser($),Ut=chainHooks("parseNodeAttributes",{},$),Ft=_e.styleParser?styleParser($):[];return _objectSpread2$1({iconName:dt,title:$.getAttribute("title"),titleId:$.getAttribute("data-fa-title-id"),prefix:vt,transform:meaninglessTransform,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:Et,styles:Ft,attributes:Pt}},Ut)}var styles$2=namespace.styles;function generateMutation($){var _e=config.autoReplaceSvg==="nest"?parseMeta($,{styleParser:!1}):parseMeta($);return~_e.extra.classes.indexOf(LAYERS_TEXT_CLASSNAME)?callProvided("generateLayersText",$,_e):callProvided("generateSvgReplacementMutation",$,_e)}var knownPrefixes=new Set;FAMILIES.map(function($){knownPrefixes.add("fa-".concat($))});Object.keys(PREFIX_TO_STYLE[FAMILY_CLASSIC]).map(knownPrefixes.add.bind(knownPrefixes));Object.keys(PREFIX_TO_STYLE[FAMILY_SHARP]).map(knownPrefixes.add.bind(knownPrefixes));knownPrefixes=_toConsumableArray$1(knownPrefixes);function onTree($){var _e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!IS_DOM)return Promise.resolve();var _=DOCUMENT.documentElement.classList,dt=function(_n){return _.add("".concat(HTML_CLASS_I2SVG_BASE_CLASS,"-").concat(_n))},vt=function(_n){return _.remove("".concat(HTML_CLASS_I2SVG_BASE_CLASS,"-").concat(_n))},Et=config.autoFetchSvg?knownPrefixes:FAMILIES.map(function(hn){return"fa-".concat(hn)}).concat(Object.keys(styles$2));Et.includes("fa")||Et.push("fa");var Pt=[".".concat(LAYERS_TEXT_CLASSNAME,":not([").concat(DATA_FA_I2SVG,"])")].concat(Et.map(function(hn){return".".concat(hn,":not([").concat(DATA_FA_I2SVG,"])")})).join(", ");if(Pt.length===0)return Promise.resolve();var Ut=[];try{Ut=toArray($.querySelectorAll(Pt))}catch{}if(Ut.length>0)dt("pending"),vt("complete");else return Promise.resolve();var Ft=perf.begin("onTree"),Yt=Ut.reduce(function(hn,_n){try{var pn=generateMutation(_n);pn&&hn.push(pn)}catch(ln){PRODUCTION$1||ln.name==="MissingIcon"&&console.error(ln)}return hn},[]);return new Promise(function(hn,_n){Promise.all(Yt).then(function(pn){perform(pn,function(){dt("active"),dt("complete"),vt("pending"),typeof _e=="function"&&_e(),Ft(),hn()})}).catch(function(pn){Ft(),_n(pn)})})}function onNode($){var _e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;generateMutation($).then(function(_){_&&perform([_],_e)})}function resolveIcons($){return function(_e){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},dt=(_e||{}).icon?_e:findIconDefinition(_e||{}),vt=_.mask;return vt&&(vt=(vt||{}).icon?vt:findIconDefinition(vt||{})),$(dt,_objectSpread2$1(_objectSpread2$1({},_),{},{mask:vt}))}}var render=function(_e){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},dt=_.transform,vt=dt===void 0?meaninglessTransform:dt,Et=_.symbol,Pt=Et===void 0?!1:Et,Ut=_.mask,Ft=Ut===void 0?null:Ut,Yt=_.maskId,hn=Yt===void 0?null:Yt,_n=_.title,pn=_n===void 0?null:_n,ln=_.titleId,Pn=ln===void 0?null:ln,nn=_.classes,Hn=nn===void 0?[]:nn,tn=_.attributes,Xt=tn===void 0?{}:tn,dn=_.styles,Nn=dn===void 0?{}:dn;if(_e){var An=_e.prefix,kn=_e.iconName,jt=_e.icon;return domVariants(_objectSpread2$1({type:"icon"},_e),function(){return callHooks("beforeDOMElementCreation",{iconDefinition:_e,params:_}),config.autoA11y&&(pn?Xt["aria-labelledby"]="".concat(config.replacementClass,"-title-").concat(Pn||nextUniqueId()):(Xt["aria-hidden"]="true",Xt.focusable="false")),makeInlineSvgAbstract({icons:{main:asFoundIcon(jt),mask:Ft?asFoundIcon(Ft.icon):{found:!1,width:null,height:null,icon:{}}},prefix:An,iconName:kn,transform:_objectSpread2$1(_objectSpread2$1({},meaninglessTransform),vt),symbol:Pt,title:pn,maskId:hn,titleId:Pn,extra:{attributes:Xt,styles:Nn,classes:Hn}})})}},ReplaceElements={mixout:function(){return{icon:resolveIcons(render)}},hooks:function(){return{mutationObserverCallbacks:function(_){return _.treeCallback=onTree,_.nodeCallback=onNode,_}}},provides:function(_e){_e.i2svg=function(_){var dt=_.node,vt=dt===void 0?DOCUMENT:dt,Et=_.callback,Pt=Et===void 0?function(){}:Et;return onTree(vt,Pt)},_e.generateSvgReplacementMutation=function(_,dt){var vt=dt.iconName,Et=dt.title,Pt=dt.titleId,Ut=dt.prefix,Ft=dt.transform,Yt=dt.symbol,hn=dt.mask,_n=dt.maskId,pn=dt.extra;return new Promise(function(ln,Pn){Promise.all([findIcon(vt,Ut),hn.iconName?findIcon(hn.iconName,hn.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(function(nn){var Hn=_slicedToArray(nn,2),tn=Hn[0],Xt=Hn[1];ln([_,makeInlineSvgAbstract({icons:{main:tn,mask:Xt},prefix:Ut,iconName:vt,transform:Ft,symbol:Yt,maskId:_n,title:Et,titleId:Pt,extra:pn,watchable:!0})])}).catch(Pn)})},_e.generateAbstractIcon=function(_){var dt=_.children,vt=_.attributes,Et=_.main,Pt=_.transform,Ut=_.styles,Ft=joinStyles(Ut);Ft.length>0&&(vt.style=Ft);var Yt;return transformIsMeaningful(Pt)&&(Yt=callProvided("generateAbstractTransformGrouping",{main:Et,transform:Pt,containerWidth:Et.width,iconWidth:Et.width})),dt.push(Yt||Et.icon),{children:dt,attributes:vt}}}},Layers={mixout:function(){return{layer:function(_){var dt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},vt=dt.classes,Et=vt===void 0?[]:vt;return domVariants({type:"layer"},function(){callHooks("beforeDOMElementCreation",{assembler:_,params:dt});var Pt=[];return _(function(Ut){Array.isArray(Ut)?Ut.map(function(Ft){Pt=Pt.concat(Ft.abstract)}):Pt=Pt.concat(Ut.abstract)}),[{tag:"span",attributes:{class:["".concat(config.cssPrefix,"-layers")].concat(_toConsumableArray$1(Et)).join(" ")},children:Pt}]})}}}},LayersCounter={mixout:function(){return{counter:function(_){var dt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},vt=dt.title,Et=vt===void 0?null:vt,Pt=dt.classes,Ut=Pt===void 0?[]:Pt,Ft=dt.attributes,Yt=Ft===void 0?{}:Ft,hn=dt.styles,_n=hn===void 0?{}:hn;return domVariants({type:"counter",content:_},function(){return callHooks("beforeDOMElementCreation",{content:_,params:dt}),makeLayersCounterAbstract({content:_.toString(),title:Et,extra:{attributes:Yt,styles:_n,classes:["".concat(config.cssPrefix,"-layers-counter")].concat(_toConsumableArray$1(Ut))}})})}}}},LayersText={mixout:function(){return{text:function(_){var dt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},vt=dt.transform,Et=vt===void 0?meaninglessTransform:vt,Pt=dt.title,Ut=Pt===void 0?null:Pt,Ft=dt.classes,Yt=Ft===void 0?[]:Ft,hn=dt.attributes,_n=hn===void 0?{}:hn,pn=dt.styles,ln=pn===void 0?{}:pn;return domVariants({type:"text",content:_},function(){return callHooks("beforeDOMElementCreation",{content:_,params:dt}),makeLayersTextAbstract({content:_,transform:_objectSpread2$1(_objectSpread2$1({},meaninglessTransform),Et),title:Ut,extra:{attributes:_n,styles:ln,classes:["".concat(config.cssPrefix,"-layers-text")].concat(_toConsumableArray$1(Yt))}})})}}},provides:function(_e){_e.generateLayersText=function(_,dt){var vt=dt.title,Et=dt.transform,Pt=dt.extra,Ut=null,Ft=null;if(IS_IE){var Yt=parseInt(getComputedStyle(_).fontSize,10),hn=_.getBoundingClientRect();Ut=hn.width/Yt,Ft=hn.height/Yt}return config.autoA11y&&!vt&&(Pt.attributes["aria-hidden"]="true"),Promise.resolve([_,makeLayersTextAbstract({content:_.innerHTML,width:Ut,height:Ft,transform:Et,title:vt,extra:Pt,watchable:!0})])}}},CLEAN_CONTENT_PATTERN=new RegExp('"',"ug"),SECONDARY_UNICODE_RANGE=[1105920,1112319];function hexValueFromContent($){var _e=$.replace(CLEAN_CONTENT_PATTERN,""),_=codePointAt(_e,0),dt=_>=SECONDARY_UNICODE_RANGE[0]&&_<=SECONDARY_UNICODE_RANGE[1],vt=_e.length===2?_e[0]===_e[1]:!1;return{value:toHex(vt?_e[0]:_e),isSecondary:dt||vt}}function replaceForPosition($,_e){var _="".concat(DATA_FA_PSEUDO_ELEMENT_PENDING).concat(_e.replace(":","-"));return new Promise(function(dt,vt){if($.getAttribute(_)!==null)return dt();var Et=toArray($.children),Pt=Et.filter(function(jt){return jt.getAttribute(DATA_FA_PSEUDO_ELEMENT)===_e})[0],Ut=WINDOW.getComputedStyle($,_e),Ft=Ut.getPropertyValue("font-family").match(FONT_FAMILY_PATTERN),Yt=Ut.getPropertyValue("font-weight"),hn=Ut.getPropertyValue("content");if(Pt&&!Ft)return $.removeChild(Pt),dt();if(Ft&&hn!=="none"&&hn!==""){var _n=Ut.getPropertyValue("content"),pn=~["Sharp"].indexOf(Ft[2])?FAMILY_SHARP:FAMILY_CLASSIC,ln=~["Solid","Regular","Light","Thin","Duotone","Brands","Kit"].indexOf(Ft[2])?STYLE_TO_PREFIX[pn][Ft[2].toLowerCase()]:FONT_WEIGHT_TO_PREFIX[pn][Yt],Pn=hexValueFromContent(_n),nn=Pn.value,Hn=Pn.isSecondary,tn=Ft[0].startsWith("FontAwesome"),Xt=byUnicode(ln,nn),dn=Xt;if(tn){var Nn=byOldUnicode(nn);Nn.iconName&&Nn.prefix&&(Xt=Nn.iconName,ln=Nn.prefix)}if(Xt&&!Hn&&(!Pt||Pt.getAttribute(DATA_PREFIX)!==ln||Pt.getAttribute(DATA_ICON)!==dn)){$.setAttribute(_,dn),Pt&&$.removeChild(Pt);var An=blankMeta(),kn=An.extra;kn.attributes[DATA_FA_PSEUDO_ELEMENT]=_e,findIcon(Xt,ln).then(function(jt){var Wt=makeInlineSvgAbstract(_objectSpread2$1(_objectSpread2$1({},An),{},{icons:{main:jt,mask:emptyCanonicalIcon()},prefix:ln,iconName:dn,extra:kn,watchable:!0})),Zt=DOCUMENT.createElementNS("http://www.w3.org/2000/svg","svg");_e==="::before"?$.insertBefore(Zt,$.firstChild):$.appendChild(Zt),Zt.outerHTML=Wt.map(function(Bn){return toHtml(Bn)}).join(`
`),$.removeAttribute(_),dt()}).catch(vt)}else dt()}else dt()})}function replace2($){return Promise.all([replaceForPosition($,"::before"),replaceForPosition($,"::after")])}function processable($){return $.parentNode!==document.head&&!~TAGNAMES_TO_SKIP_FOR_PSEUDOELEMENTS.indexOf($.tagName.toUpperCase())&&!$.getAttribute(DATA_FA_PSEUDO_ELEMENT)&&(!$.parentNode||$.parentNode.tagName!=="svg")}function searchPseudoElements($){if(IS_DOM)return new Promise(function(_e,_){var dt=toArray($.querySelectorAll("*")).filter(processable).map(replace2),vt=perf.begin("searchPseudoElements");disableObservation(),Promise.all(dt).then(function(){vt(),enableObservation(),_e()}).catch(function(){vt(),enableObservation(),_()})})}var PseudoElements={hooks:function(){return{mutationObserverCallbacks:function(_){return _.pseudoElementsCallback=searchPseudoElements,_}}},provides:function(_e){_e.pseudoElements2svg=function(_){var dt=_.node,vt=dt===void 0?DOCUMENT:dt;config.searchPseudoElements&&searchPseudoElements(vt)}}},_unwatched=!1,MutationObserver$1={mixout:function(){return{dom:{unwatch:function(){disableObservation(),_unwatched=!0}}}},hooks:function(){return{bootstrap:function(){observe(chainHooks("mutationObserverCallbacks",{}))},noAuto:function(){disconnect()},watch:function(_){var dt=_.observeMutationsRoot;_unwatched?enableObservation():observe(chainHooks("mutationObserverCallbacks",{observeMutationsRoot:dt}))}}}},parseTransformString=function(_e){var _={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return _e.toLowerCase().split(" ").reduce(function(dt,vt){var Et=vt.toLowerCase().split("-"),Pt=Et[0],Ut=Et.slice(1).join("-");if(Pt&&Ut==="h")return dt.flipX=!0,dt;if(Pt&&Ut==="v")return dt.flipY=!0,dt;if(Ut=parseFloat(Ut),isNaN(Ut))return dt;switch(Pt){case"grow":dt.size=dt.size+Ut;break;case"shrink":dt.size=dt.size-Ut;break;case"left":dt.x=dt.x-Ut;break;case"right":dt.x=dt.x+Ut;break;case"up":dt.y=dt.y-Ut;break;case"down":dt.y=dt.y+Ut;break;case"rotate":dt.rotate=dt.rotate+Ut;break}return dt},_)},PowerTransforms={mixout:function(){return{parse:{transform:function(_){return parseTransformString(_)}}}},hooks:function(){return{parseNodeAttributes:function(_,dt){var vt=dt.getAttribute("data-fa-transform");return vt&&(_.transform=parseTransformString(vt)),_}}},provides:function(_e){_e.generateAbstractTransformGrouping=function(_){var dt=_.main,vt=_.transform,Et=_.containerWidth,Pt=_.iconWidth,Ut={transform:"translate(".concat(Et/2," 256)")},Ft="translate(".concat(vt.x*32,", ").concat(vt.y*32,") "),Yt="scale(".concat(vt.size/16*(vt.flipX?-1:1),", ").concat(vt.size/16*(vt.flipY?-1:1),") "),hn="rotate(".concat(vt.rotate," 0 0)"),_n={transform:"".concat(Ft," ").concat(Yt," ").concat(hn)},pn={transform:"translate(".concat(Pt/2*-1," -256)")},ln={outer:Ut,inner:_n,path:pn};return{tag:"g",attributes:_objectSpread2$1({},ln.outer),children:[{tag:"g",attributes:_objectSpread2$1({},ln.inner),children:[{tag:dt.icon.tag,children:dt.icon.children,attributes:_objectSpread2$1(_objectSpread2$1({},dt.icon.attributes),ln.path)}]}]}}}},ALL_SPACE={x:0,y:0,width:"100%",height:"100%"};function fillBlack($){var _e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return $.attributes&&($.attributes.fill||_e)&&($.attributes.fill="black"),$}function deGroup($){return $.tag==="g"?$.children:[$]}var Masks={hooks:function(){return{parseNodeAttributes:function(_,dt){var vt=dt.getAttribute("data-fa-mask"),Et=vt?getCanonicalIcon(vt.split(" ").map(function(Pt){return Pt.trim()})):emptyCanonicalIcon();return Et.prefix||(Et.prefix=getDefaultUsablePrefix()),_.mask=Et,_.maskId=dt.getAttribute("data-fa-mask-id"),_}}},provides:function(_e){_e.generateAbstractMask=function(_){var dt=_.children,vt=_.attributes,Et=_.main,Pt=_.mask,Ut=_.maskId,Ft=_.transform,Yt=Et.width,hn=Et.icon,_n=Pt.width,pn=Pt.icon,ln=transformForSvg({transform:Ft,containerWidth:_n,iconWidth:Yt}),Pn={tag:"rect",attributes:_objectSpread2$1(_objectSpread2$1({},ALL_SPACE),{},{fill:"white"})},nn=hn.children?{children:hn.children.map(fillBlack)}:{},Hn={tag:"g",attributes:_objectSpread2$1({},ln.inner),children:[fillBlack(_objectSpread2$1({tag:hn.tag,attributes:_objectSpread2$1(_objectSpread2$1({},hn.attributes),ln.path)},nn))]},tn={tag:"g",attributes:_objectSpread2$1({},ln.outer),children:[Hn]},Xt="mask-".concat(Ut||nextUniqueId()),dn="clip-".concat(Ut||nextUniqueId()),Nn={tag:"mask",attributes:_objectSpread2$1(_objectSpread2$1({},ALL_SPACE),{},{id:Xt,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[Pn,tn]},An={tag:"defs",children:[{tag:"clipPath",attributes:{id:dn},children:deGroup(pn)},Nn]};return dt.push(An,{tag:"rect",attributes:_objectSpread2$1({fill:"currentColor","clip-path":"url(#".concat(dn,")"),mask:"url(#".concat(Xt,")")},ALL_SPACE)}),{children:dt,attributes:vt}}}},MissingIconIndicator={provides:function(_e){var _=!1;WINDOW.matchMedia&&(_=WINDOW.matchMedia("(prefers-reduced-motion: reduce)").matches),_e.missingIconAbstract=function(){var dt=[],vt={fill:"currentColor"},Et={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};dt.push({tag:"path",attributes:_objectSpread2$1(_objectSpread2$1({},vt),{},{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"})});var Pt=_objectSpread2$1(_objectSpread2$1({},Et),{},{attributeName:"opacity"}),Ut={tag:"circle",attributes:_objectSpread2$1(_objectSpread2$1({},vt),{},{cx:"256",cy:"364",r:"28"}),children:[]};return _||Ut.children.push({tag:"animate",attributes:_objectSpread2$1(_objectSpread2$1({},Et),{},{attributeName:"r",values:"28;14;28;28;14;28;"})},{tag:"animate",attributes:_objectSpread2$1(_objectSpread2$1({},Pt),{},{values:"1;0;1;1;0;1;"})}),dt.push(Ut),dt.push({tag:"path",attributes:_objectSpread2$1(_objectSpread2$1({},vt),{},{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),children:_?[]:[{tag:"animate",attributes:_objectSpread2$1(_objectSpread2$1({},Pt),{},{values:"1;0;0;0;0;1;"})}]}),_||dt.push({tag:"path",attributes:_objectSpread2$1(_objectSpread2$1({},vt),{},{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),children:[{tag:"animate",attributes:_objectSpread2$1(_objectSpread2$1({},Pt),{},{values:"0;0;1;1;0;0;"})}]}),{tag:"g",attributes:{class:"missing"},children:dt}}}},SvgSymbols={hooks:function(){return{parseNodeAttributes:function(_,dt){var vt=dt.getAttribute("data-fa-symbol"),Et=vt===null?!1:vt===""?!0:vt;return _.symbol=Et,_}}}},plugins=[InjectCSS,ReplaceElements,Layers,LayersCounter,LayersText,PseudoElements,MutationObserver$1,PowerTransforms,Masks,MissingIconIndicator,SvgSymbols];registerPlugins(plugins,{mixoutsTo:api});api.noAuto;api.config;api.library;api.dom;var parse$1=api.parse;api.findIconDefinition;api.toHtml;var icon2=api.icon;api.layer;api.text;api.counter;var propTypes={exports:{}},ReactPropTypesSecret$1="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",ReactPropTypesSecret_1=ReactPropTypesSecret$1,ReactPropTypesSecret=ReactPropTypesSecret_1;function emptyFunction(){}function emptyFunctionWithReset(){}emptyFunctionWithReset.resetWarningCache=emptyFunction;var factoryWithThrowingShims=function(){function $(dt,vt,Et,Pt,Ut,Ft){if(Ft!==ReactPropTypesSecret){var Yt=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw Yt.name="Invariant Violation",Yt}}$.isRequired=$;function _e(){return $}var _={array:$,bigint:$,bool:$,func:$,number:$,object:$,string:$,symbol:$,any:$,arrayOf:_e,element:$,elementType:$,instanceOf:_e,node:$,objectOf:_e,oneOf:_e,oneOfType:_e,shape:_e,exact:_e,checkPropTypes:emptyFunctionWithReset,resetWarningCache:emptyFunction};return _.PropTypes=_,_};propTypes.exports=factoryWithThrowingShims();var propTypesExports=propTypes.exports;const PropTypes=getDefaultExportFromCjs(propTypesExports);function ownKeys($,_e){var _=Object.keys($);if(Object.getOwnPropertySymbols){var dt=Object.getOwnPropertySymbols($);_e&&(dt=dt.filter(function(vt){return Object.getOwnPropertyDescriptor($,vt).enumerable})),_.push.apply(_,dt)}return _}function _objectSpread2($){for(var _e=1;_e<arguments.length;_e++){var _=arguments[_e]!=null?arguments[_e]:{};_e%2?ownKeys(Object(_),!0).forEach(function(dt){_defineProperty($,dt,_[dt])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(_)):ownKeys(Object(_)).forEach(function(dt){Object.defineProperty($,dt,Object.getOwnPropertyDescriptor(_,dt))})}return $}function _typeof($){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_e){return typeof _e}:function(_e){return _e&&typeof Symbol=="function"&&_e.constructor===Symbol&&_e!==Symbol.prototype?"symbol":typeof _e},_typeof($)}function _defineProperty($,_e,_){return _e in $?Object.defineProperty($,_e,{value:_,enumerable:!0,configurable:!0,writable:!0}):$[_e]=_,$}function _objectWithoutPropertiesLoose($,_e){if($==null)return{};var _={},dt=Object.keys($),vt,Et;for(Et=0;Et<dt.length;Et++)vt=dt[Et],!(_e.indexOf(vt)>=0)&&(_[vt]=$[vt]);return _}function _objectWithoutProperties($,_e){if($==null)return{};var _=_objectWithoutPropertiesLoose($,_e),dt,vt;if(Object.getOwnPropertySymbols){var Et=Object.getOwnPropertySymbols($);for(vt=0;vt<Et.length;vt++)dt=Et[vt],!(_e.indexOf(dt)>=0)&&Object.prototype.propertyIsEnumerable.call($,dt)&&(_[dt]=$[dt])}return _}function _toConsumableArray($){return _arrayWithoutHoles($)||_iterableToArray($)||_unsupportedIterableToArray($)||_nonIterableSpread()}function _arrayWithoutHoles($){if(Array.isArray($))return _arrayLikeToArray($)}function _iterableToArray($){if(typeof Symbol<"u"&&$[Symbol.iterator]!=null||$["@@iterator"]!=null)return Array.from($)}function _unsupportedIterableToArray($,_e){if($){if(typeof $=="string")return _arrayLikeToArray($,_e);var _=Object.prototype.toString.call($).slice(8,-1);if(_==="Object"&&$.constructor&&(_=$.constructor.name),_==="Map"||_==="Set")return Array.from($);if(_==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_))return _arrayLikeToArray($,_e)}}function _arrayLikeToArray($,_e){(_e==null||_e>$.length)&&(_e=$.length);for(var _=0,dt=new Array(_e);_<_e;_++)dt[_]=$[_];return dt}function _nonIterableSpread(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function classList($){var _e,_=$.beat,dt=$.fade,vt=$.beatFade,Et=$.bounce,Pt=$.shake,Ut=$.flash,Ft=$.spin,Yt=$.spinPulse,hn=$.spinReverse,_n=$.pulse,pn=$.fixedWidth,ln=$.inverse,Pn=$.border,nn=$.listItem,Hn=$.flip,tn=$.size,Xt=$.rotation,dn=$.pull,Nn=(_e={"fa-beat":_,"fa-fade":dt,"fa-beat-fade":vt,"fa-bounce":Et,"fa-shake":Pt,"fa-flash":Ut,"fa-spin":Ft,"fa-spin-reverse":hn,"fa-spin-pulse":Yt,"fa-pulse":_n,"fa-fw":pn,"fa-inverse":ln,"fa-border":Pn,"fa-li":nn,"fa-flip":Hn===!0,"fa-flip-horizontal":Hn==="horizontal"||Hn==="both","fa-flip-vertical":Hn==="vertical"||Hn==="both"},_defineProperty(_e,"fa-".concat(tn),typeof tn<"u"&&tn!==null),_defineProperty(_e,"fa-rotate-".concat(Xt),typeof Xt<"u"&&Xt!==null&&Xt!==0),_defineProperty(_e,"fa-pull-".concat(dn),typeof dn<"u"&&dn!==null),_defineProperty(_e,"fa-swap-opacity",$.swapOpacity),_e);return Object.keys(Nn).map(function(An){return Nn[An]?An:null}).filter(function(An){return An})}function _isNumerical($){return $=$-0,$===$}function camelize($){return _isNumerical($)?$:($=$.replace(/[\-_\s]+(.)?/g,function(_e,_){return _?_.toUpperCase():""}),$.substr(0,1).toLowerCase()+$.substr(1))}var _excluded=["style"];function capitalize($){return $.charAt(0).toUpperCase()+$.slice(1)}function styleToObject($){return $.split(";").map(function(_e){return _e.trim()}).filter(function(_e){return _e}).reduce(function(_e,_){var dt=_.indexOf(":"),vt=camelize(_.slice(0,dt)),Et=_.slice(dt+1).trim();return vt.startsWith("webkit")?_e[capitalize(vt)]=Et:_e[vt]=Et,_e},{})}function convert($,_e){var _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof _e=="string")return _e;var dt=(_e.children||[]).map(function(Ft){return convert($,Ft)}),vt=Object.keys(_e.attributes||{}).reduce(function(Ft,Yt){var hn=_e.attributes[Yt];switch(Yt){case"class":Ft.attrs.className=hn,delete _e.attributes.class;break;case"style":Ft.attrs.style=styleToObject(hn);break;default:Yt.indexOf("aria-")===0||Yt.indexOf("data-")===0?Ft.attrs[Yt.toLowerCase()]=hn:Ft.attrs[camelize(Yt)]=hn}return Ft},{attrs:{}}),Et=_.style,Pt=Et===void 0?{}:Et,Ut=_objectWithoutProperties(_,_excluded);return vt.attrs.style=_objectSpread2(_objectSpread2({},vt.attrs.style),Pt),$.apply(void 0,[_e.tag,_objectSpread2(_objectSpread2({},vt.attrs),Ut)].concat(_toConsumableArray(dt)))}var PRODUCTION=!1;try{PRODUCTION=!0}catch{}function log(){if(!PRODUCTION&&console&&typeof console.error=="function"){var $;($=console).error.apply($,arguments)}}function normalizeIconArgs($){if($&&_typeof($)==="object"&&$.prefix&&$.iconName&&$.icon)return $;if(parse$1.icon)return parse$1.icon($);if($===null)return null;if($&&_typeof($)==="object"&&$.prefix&&$.iconName)return $;if(Array.isArray($)&&$.length===2)return{prefix:$[0],iconName:$[1]};if(typeof $=="string")return{prefix:"fas",iconName:$}}function objectWithKey($,_e){return Array.isArray(_e)&&_e.length>0||!Array.isArray(_e)&&_e?_defineProperty({},$,_e):{}}var FontAwesomeIcon=React.forwardRef(function($,_e){var _=$.icon,dt=$.mask,vt=$.symbol,Et=$.className,Pt=$.title,Ut=$.titleId,Ft=$.maskId,Yt=normalizeIconArgs(_),hn=objectWithKey("classes",[].concat(_toConsumableArray(classList($)),_toConsumableArray(Et.split(" ")))),_n=objectWithKey("transform",typeof $.transform=="string"?parse$1.transform($.transform):$.transform),pn=objectWithKey("mask",normalizeIconArgs(dt)),ln=icon2(Yt,_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2({},hn),_n),pn),{},{symbol:vt,title:Pt,titleId:Ut,maskId:Ft}));if(!ln)return log("Could not find icon",Yt),null;var Pn=ln.abstract,nn={ref:_e};return Object.keys($).forEach(function(Hn){FontAwesomeIcon.defaultProps.hasOwnProperty(Hn)||(nn[Hn]=$[Hn])}),convertCurry(Pn[0],nn)});FontAwesomeIcon.displayName="FontAwesomeIcon";FontAwesomeIcon.propTypes={beat:PropTypes.bool,border:PropTypes.bool,beatFade:PropTypes.bool,bounce:PropTypes.bool,className:PropTypes.string,fade:PropTypes.bool,flash:PropTypes.bool,mask:PropTypes.oneOfType([PropTypes.object,PropTypes.array,PropTypes.string]),maskId:PropTypes.string,fixedWidth:PropTypes.bool,inverse:PropTypes.bool,flip:PropTypes.oneOf([!0,!1,"horizontal","vertical","both"]),icon:PropTypes.oneOfType([PropTypes.object,PropTypes.array,PropTypes.string]),listItem:PropTypes.bool,pull:PropTypes.oneOf(["right","left"]),pulse:PropTypes.bool,rotation:PropTypes.oneOf([0,90,180,270]),shake:PropTypes.bool,size:PropTypes.oneOf(["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"]),spin:PropTypes.bool,spinPulse:PropTypes.bool,spinReverse:PropTypes.bool,symbol:PropTypes.oneOfType([PropTypes.bool,PropTypes.string]),title:PropTypes.string,titleId:PropTypes.string,transform:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),swapOpacity:PropTypes.bool};FontAwesomeIcon.defaultProps={border:!1,className:"",mask:null,maskId:null,fixedWidth:!1,inverse:!1,flip:!1,icon:null,listItem:!1,pull:null,pulse:!1,rotation:null,size:null,spin:!1,spinPulse:!1,spinReverse:!1,beat:!1,fade:!1,beatFade:!1,bounce:!1,shake:!1,symbol:!1,title:"",titleId:null,transform:null,swapOpacity:!1};var convertCurry=convert.bind(null,React.createElement),faStackOverflow={prefix:"fab",iconName:"stack-overflow",icon:[384,512,[],"f16c","M290.7 311L95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"]},faDiscord={prefix:"fab",iconName:"discord",icon:[640,512,[],"f392","M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"]},faLinkedin={prefix:"fab",iconName:"linkedin",icon:[448,512,[],"f08c","M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"]},faGithub={prefix:"fab",iconName:"github",icon:[496,512,[],"f09b","M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"]};function Nav(){return jsxRuntimeExports.jsx("nav",{className:"nav-wrapper",children:jsxRuntimeExports.jsx("div",{className:"nav-content",children:jsxRuntimeExports.jsxs("ul",{className:"list-styled",children:[jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx(FontAwesomeIcon,{className:"icon k",icon:faK})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Experience"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Resume"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Skills"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Projects"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Roles"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Achievements"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Certificates"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Education"})}),jsxRuntimeExports.jsxs("ul",{className:"icon-list",children:[jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled icon ",children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faGithub})})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled icon",children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faLinkedin})})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled icon",children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faStackOverflow})})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled icon",children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faDiscord})})})]})]})})})}/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={109:function($,_e,_){var dt=_(352),vt=_.n(dt)()(function(Et){return Et[1]});vt.push([$.id,'.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(0.54, 1.5, 0.38, 1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:rgba(0,0,0,0);border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',""]),_e.Z=vt},356:function($,_e,_){var dt=_(352),vt=_.n(dt)()(function(Et){return Et[1]});vt.push([$.id,".loader{width:48px;height:48px;border:5px solid #333;border-bottom-color:rgba(0,0,0,0);border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}",""]),_e.Z=vt},44:function($,_e,_){var dt=_(352),vt=_.n(dt)()(function(Et){return Et[1]});vt.push([$.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:rgba(0,0,0,0);height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:rgba(34,34,34,.6666666667);text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),_e.Z=vt},27:function($,_e,_){var dt=_(352),vt=_.n(dt)()(function(Et){return Et[1]});vt.push([$.id,'#assetManagerLoadingScreen{z-index:300;position:absolute;bottom:0;right:0;min-width:100%;min-height:100%;color:#333;font-size:1rem;gap:1rem;display:flex;align-content:center;justify-content:center;align-items:center;flex-direction:column;opacity:1;transition:opacity .5s ease-in-out,min-width .5s,min-height .5s,bottom .5s,right .5s;overflow:hidden;background:rgba(0,0,0,0);-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;--b-opacity: 0.8;--b-background: #ffffff}#assetManagerLoadingScreen::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;opacity:var(--b-opacity);background:var(--b-background)}#assetManagerLoadingScreenContent{padding-top:.5rem}.loadingScreenProcessState{font-weight:bold}#assetManagerLoadingScreen.minimizedLoadingScreen{top:unset;left:unset;bottom:2rem;right:2rem;min-width:0;min-height:0;max-width:80vw;max-height:80vh;width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content;padding:1.5rem;border-radius:.5rem}.loadingScreenFilesElement{min-height:4rem}.loadingScreenLogoElement{margin-bottom:.5rem}.loadingScreenLogoElement img{min-height:3rem;max-height:6rem}.loadingScreenLogoImage{width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content}.minimizedLoadingScreen .loadingScreenLoadingElement{display:none}.minimizedLoadingScreen .loadingScreenFilesElement{min-height:0}.minimizedLoadingScreen .loadingScreenLogoImage{min-height:0}.minimizedLoadingScreen #assetManagerLoadingScreenContent{display:none}',""]),_e.Z=vt},798:function($,_e,_){var dt=_(352),vt=_.n(dt)()(function(Et){return Et[1]});vt.push([$.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;color:#fff;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;background-color:rgba(40,34,60,.6666666667);padding:1.5rem;font-size:1rem;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),_e.Z=vt},729:function($,_e,_){var dt=_(352),vt=_.n(dt)()(function(Et){return Et[1]});vt.push([$.id,'.button-bar{background:var(--tp-base-background-color);border:1px solid #8f949c;width:fit-content;width:-moz-fit-content;height:auto;display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;z-index:200;padding:.25rem .5rem .5rem;border-radius:.5rem;pointer-events:auto;box-shadow:0 2px 4px var(--tp-base-shadow-color);gap:8px;font-size:.85rem;line-height:130%;font-family:Inter,"Roboto Mono","Source Code Pro",Menlo,Courier,monospace;opacity:1;transition:all .25s}.button-bar-button{background-color:rgba(0,0,0,0);cursor:pointer;width:auto;height:auto;font-weight:400;padding:.35rem .5rem;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;color:#ccc;transition:color .25s}.button-bar-button:hover{color:#eee}.button-bar-selected{color:#fff}.button-bar-selected-box{color:#fff}.button-bar>.button-bar-button:not(:last-child)::after{content:"";position:absolute;right:-5px;top:20%;width:2px;height:60%;border-radius:1px;background-color:#413762}.button-bar-button:before{left:50%;width:0;content:"";position:absolute}.button-bar-selected:before{left:25%;width:50%;bottom:0;height:2px;border-radius:1px;background-color:#ccc;transition:width .25s,left .25s}.button-bar-selected-box{background-color:rgba(238,238,238,.3333333333);border-radius:.25rem;transition:all .25s}.round-button{width:1rem;height:1rem;padding:.6rem;background-color:var(--tp-base-background-color);border-radius:1.2rem;color:#ccc;cursor:pointer;box-shadow:0 2px 4px var(--tp-base-shadow-color);transition:all .25s}.round-button:hover{color:#fff}.util-buttons-container{bottom:1.25rem;right:1.25rem;position:absolute;gap:8px;padding:.25rem}.util-button{position:relative;width:auto;height:1.2rem}.mode-buttons-container{border-top:0;top:0;left:0;right:0;margin-left:auto;margin-right:auto;position:absolute;min-width:6rem;border-radius:0 0 .5rem .5rem;gap:8px}.mode-button{font-weight:400}#webgi-logo{background-image:url("https://webgi.xyz/img/logo.svg");background-size:contain;background-repeat:no-repeat;background-position:center;bottom:1.25rem;left:1rem;z-index:100;width:2.5rem;height:2.5rem;position:absolute;cursor:pointer}#webgi-logo:hover{filter:grayscale(100%)}#fsToggle{position:absolute;right:1.25rem;top:1.25rem}#assetManagerPopup{position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;color:#fff;padding:1.5rem;font-size:.85rem;overflow-y:scroll;background-color:var(--tp-base-background-color)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:rgba(40,34,60,.8) !important;border-radius:6px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.4);border-radius:6px}::-webkit-scrollbar-corner{background:rgba(0,0,0,.5)}.tippy-box[data-theme~=editor]{margin:.25rem !important;background-color:var(--tp-base-background-color) !important;font-size:.8rem !important;color:#ddd !important}#tweakpaneUiContainer{margin-top:7.5rem}@media only screen and (min-width: 480px){#tweakpaneUiContainer{margin-top:5.5rem}}#canvasContainer{display:flex;justify-content:center;align-items:center}@media only screen and (min-width: 920px){#canvasContainer{width:calc(min(100% - 3rem,100% - var(--tweakpane-ui-container-width, 300px)) - 3.5rem) !important;height:calc(100% - 5rem);margin:3.5rem 1.5rem 1.5rem 1.5rem;border-radius:.5rem;box-shadow:rgba(0,0,0,.25) 0px 25px 50px -12px}#mcanvas{border-radius:.5rem}#tweakpaneUiContainer{margin-top:3.5rem}}body{background-color:#d1d4e7}',""]),_e.Z=vt},898:function($,_e,_){var dt=_(352),vt=_.n(dt)()(function(Et){return Et[1]});vt.push([$.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-moz-min-content;height:min-content;background:rgba(0,0,0,0);color:#eee;border:none}',""]),_e.Z=vt},513:function($,_e,_){var dt=_(352),vt=_.n(dt)()(function(Et){return Et[1]});vt.push([$.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),_e.Z=vt},476:function($){var _e;_e=function(){return function(_){var dt={};function vt(Et){if(dt[Et])return dt[Et].exports;var Pt=dt[Et]={i:Et,l:!1,exports:{}};return _[Et].call(Pt.exports,Pt,Pt.exports,vt),Pt.l=!0,Pt.exports}return vt.m=_,vt.c=dt,vt.i=function(Et){return Et},vt.d=function(Et,Pt,Ut){vt.o(Et,Pt)||Object.defineProperty(Et,Pt,{configurable:!1,enumerable:!0,get:Ut})},vt.n=function(Et){var Pt=Et&&Et.__esModule?function(){return Et.default}:function(){return Et};return vt.d(Pt,"a",Pt),Pt},vt.o=function(Et,Pt){return Object.prototype.hasOwnProperty.call(Et,Pt)},vt.p="",vt(vt.s=5)}([function(_,dt,vt){Object.defineProperty(dt,"__esModule",{value:!0});var Et={convertToObject:function(Pt){var Ut=Pt.substring(Pt.indexOf("{")+1).trim().slice(0,-1),Ft={};return Ut.split(";").map(function(Yt){if(Yt=Yt.trim()){var hn=Yt.split(":");Ft[hn[0].trim()]=hn[1].trim()}}),Ft},getFromSheets:function(Pt){var Ut=document.styleSheets;for(var Ft in Ut){var Yt=null;try{Yt=Ut[Ft].rules||Ut[Ft].cssRules}catch{}if(Yt){for(var hn in Yt)if(Yt[hn].selectorText&&Yt[hn].selectorText.split(",").indexOf(Pt)!=-1)return Yt[hn].cssText?Et.convertToObject(Yt[hn].cssText):Et.convertToObject(Yt[hn].style.cssText)}}return{}},getPropertyDefault:function(Pt){return Pt=="timing-function"?"ease":Pt=="iteration-count"?1:Pt=="direction"?"normal":Pt=="fill-mode"?"none":null}};dt.default=Et},function(_,dt,vt){Object.defineProperty(dt,"__esModule",{value:!0});var Et={generateId:function(){for(var Pt="",Ut="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Ft=0;Ft<8;++Ft)Pt+=Ut.charAt(Math.floor(Math.random()*Ut.length));return Pt},frameToString:function(Pt){var Ut="";for(var Ft in Pt)Ut+=Ft+":"+Pt[Ft]+";";return Ut},convertTimeToMs:function(Pt){if(!Pt)return 0;if(typeof Pt=="number")return Pt;var Ut=parseFloat(Pt);return Pt.indexOf("ms")!=-1?Ut:1e3*Ut},prefixes:["","-webkit-","-moz-","-o-"]};dt.default=Et},function(_,dt,vt){Object.defineProperty(dt,"__esModule",{value:!0});var Et,Pt=(Et=vt(0))&&Et.__esModule?Et:{default:Et};dt.default=function Ut(Ft,Yt){if(function(pn,ln){if(!(pn instanceof ln))throw new TypeError("Cannot call a class as a function")}(this,Ut),this.styles=typeof Ft=="string"?Pt.default.getFromSheets(Ft):Ft,typeof Yt=="string"){var hn=Pt.default.getFromSheets(Yt);for(var _n in this.options={},hn)this.options[_n.replace("animation-","")]=hn[_n]}else this.options=typeof Yt=="number"?{duration:Yt}:Yt}},function(_,dt,vt){Object.defineProperty(dt,"__esModule",{value:!0});var Et=function(){function _n(pn,ln){for(var Pn=0;Pn<ln.length;Pn++){var nn=ln[Pn];nn.enumerable=nn.enumerable||!1,nn.configurable=!0,"value"in nn&&(nn.writable=!0),Object.defineProperty(pn,nn.key,nn)}}return function(pn,ln,Pn){return ln&&_n(pn.prototype,ln),Pn&&_n(pn,Pn),pn}}(),Pt=Yt(vt(4)),Ut=Yt(vt(1)),Ft=Yt(vt(0));function Yt(_n){return _n&&_n.__esModule?_n:{default:_n}}var hn=function(){function _n(pn,ln,Pn,nn){if(function(Xt,dn){if(!(Xt instanceof dn))throw new TypeError("Cannot call a class as a function")}(this,_n),pn.constructor===Array?this.doms=pn:this.doms=[pn],ln.constructor===Array?this.frames=ln:this.frames=[ln],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},Pn!=null&&Pn!=null)if(typeof Pn=="boolean")this.options.instant=Pn;else if(typeof Pn=="number")this.options.count=Pn,typeof nn=="boolean"&&(this.options.instant=nn);else for(var Hn in Pn)Hn=="pauseAt"&&Pn.pauseAt.constructor!==Array?this.options[Hn]=[Pn[Hn]]:this.options[Hn]=Pn[Hn];for(var tn in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=Ut.default.prefixes:this.prefixes=[""],pn)this.countRemainder[tn]=this.options.count-1;this.options.instant&&this.play()}return Et(_n,[{key:"play",value:function(){var pn=this;for(var ln in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(nn){pn.promiseResolve=nn})),this.doms){var Pn=this.makeAnimation(this.doms[ln]);this.animations[ln]=Pn.names,this.styleDoms[ln]=Pn.styleDom,this.superSets[ln]=this.makeSuperSet(this.doms[ln],this.animations[ln]),this.playAnimation(this.doms[ln],this.superSets[ln]),this.eventHandler[ln]=this.handleAnimationEnd.bind(this,ln),this.doms[ln].addEventListener("animationend",this.eventHandler[ln])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(pn){if(!pn){for(var ln in this.doms)this.clear(ln);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var Pn=this.styleDoms[pn];for(var nn in Pn&&Pn.parentNode&&Pn.parentNode.removeChild(Pn),this.superSets[pn])for(var Hn in this.prefixes)this.doms[pn].style[this.prefixes[Hn]+"animation-"+nn]=null;for(var tn in this.prefixes)this.doms[pn].style[this.prefixes[tn]+"animation-play-state"]=null;this.doms[pn].removeEventListener("animationend",this.eventHandler[pn]),this.countRemainder[pn]=this.options.count-1}},{key:"replay",value:function(pn){var ln=this.doms[pn],Pn=ln.cloneNode(!0);ln.parentNode.replaceChild(Pn,ln),this.doms[pn].removeEventListener("animationend",this.eventHandler[pn]),this.doms[pn]=Pn,this.doms[pn].addEventListener("animationend",this.eventHandler[pn])}},{key:"pause",value:function(){for(var pn in this.doms)this.pauseDom(this.doms[pn])}},{key:"resume",value:function(){for(var pn in this.doms)this.resumeDom(this.doms[pn])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(pn,ln){var Pn=ln.animationName,nn=Pn.substring(Pn.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(nn))&&this.pauseDom(this.doms[pn]),nn==this.frames.length&&(this.countRemainder[pn]==-1?this.replay(pn):this.countRemainder[pn]>0?(this.countRemainder[pn]--,this.replay(pn)):(this.options.applyOnEnd&&this.applyOnEnd(pn),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(pn){for(var ln in this.prefixes)pn.style[this.prefixes[ln]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(pn){for(var ln in this.prefixes)pn.style[this.prefixes[ln]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(pn){var ln=this.newFrames[this.frames.length];for(var Pn in ln)this.doms[pn].style[Pn]=ln[Pn]}},{key:"makeAnimation",value:function(pn){var ln={},Pn=[],nn={};for(var Hn in this.frames)for(var tn in Pn.push(this.frames[Hn].styles),Pn[Hn])nn[tn]=!0;var Xt=window.getComputedStyle(pn);for(var dn in nn)ln[dn]=Xt[dn];Pn.unshift(ln);for(var Nn=[Pn[0]],An=1;An<Pn.length;++An){var kn=JSON.parse(JSON.stringify(Nn[An-1]));for(var jt in Pn[An])kn[jt]=Pn[An][jt];Nn.push(kn)}return this.newFrames=Nn,Pt.default.make(Nn,this.prefixes)}},{key:"makeSuperSet",value:function(pn,ln){var Pn=0,nn={};for(var Hn in this.frames)for(var tn in this.frames[Hn].options)nn[tn]="";nn.name="",nn.duration="",nn.delay="";for(var Xt=0;Xt<this.frames.length;++Xt){if(Xt)for(var dn in nn)nn[dn]+=",";var Nn=Ut.default.convertTimeToMs(this.frames[Xt].options.duration),An=Ut.default.convertTimeToMs(this.frames[Xt].options.delay);for(var kn in Xt<this.options.startFrom&&(Nn=0,An=0),nn.name+=ln[Xt],nn.duration+=Nn+"ms",nn.delay+=Pn+An+"ms",nn)kn!="name"&&kn!="duration"&&kn!="delay"&&(nn[kn]+=this.frames[Xt].options[kn]?this.frames[Xt].options[kn]:Ft.default.getPropertyDefault(kn));var jt=this.frames[Xt].options["iteration-count"];Pn+=Nn*parseInt(jt||1)+An}return nn}},{key:"playAnimation",value:function(pn,ln){for(var Pn in ln)for(var nn in this.prefixes)pn.style[this.prefixes[nn]+"animation-"+Pn]=ln[Pn];this.options.pauseAt.includes(0)&&this.pauseDom(pn)}}]),_n}();dt.default=hn},function(_,dt,vt){Object.defineProperty(dt,"__esModule",{value:!0});var Et,Pt=(Et=vt(1))&&Et.__esModule?Et:{default:Et},Ut={make:function(Ft,Yt){for(var hn=[],_n="",pn="atr-"+Pt.default.generateId(),ln=document.createElement("style"),Pn=0;Pn<Ft.length-1;++Pn)hn.push(pn+"-"+(Pn+1)),_n+=Ut.makeFromTwoFrames(Ft[Pn],Ft[Pn+1],hn[Pn],Yt);return ln.innerHTML=_n,ln.class="foo",document.getElementsByTagName("head")[0].appendChild(ln),{names:hn,styleDom:ln}},makeFromTwoFrames:function(Ft,Yt,hn,_n){var pn="";for(var ln in _n)pn+="@"+_n[ln]+"keyframes "+hn+" {",pn+="0%",pn+="{"+Pt.default.frameToString(Ft)+"}",pn+="100%",pn+="{"+Pt.default.frameToString(Yt)+"}",pn+="}";return pn}};dt.default=Ut},function(_,dt,vt){Object.defineProperty(dt,"__esModule",{value:!0}),dt.Queue=dt.Frame=void 0;var Et=Ut(vt(2)),Pt=Ut(vt(3));function Ut(Ft){return Ft&&Ft.__esModule?Ft:{default:Ft}}dt.Frame=Et.default,dt.Queue=Pt.default}])},$.exports=_e()},352:function($){$.exports=function(_e){var _=[];return _.toString=function(){return this.map(function(dt){var vt=_e(dt);return dt[2]?"@media ".concat(dt[2]," {").concat(vt,"}"):vt}).join("")},_.i=function(dt,vt,Et){typeof dt=="string"&&(dt=[[null,dt,""]]);var Pt={};if(Et)for(var Ut=0;Ut<this.length;Ut++){var Ft=this[Ut][0];Ft!=null&&(Pt[Ft]=!0)}for(var Yt=0;Yt<dt.length;Yt++){var hn=[].concat(dt[Yt]);Et&&Pt[hn[0]]||(vt&&(hn[2]?hn[2]="".concat(vt," and ").concat(hn[2]):hn[2]=vt),_.push(hn))}},_}},388:function($){$.exports=function _e(_,dt,vt){function Et(Ft,Yt){if(!dt[Ft]){if(!_[Ft]){if(Pt)return Pt(Ft,!0);throw new Error("Cannot find module '"+Ft+"'")}var hn=dt[Ft]={exports:{}};_[Ft][0].call(hn.exports,function(_n){return Et(_[Ft][1][_n]||_n)},hn,hn.exports,_e,_,dt,vt)}return dt[Ft].exports}for(var Pt=void 0,Ut=0;Ut<vt.length;Ut++)Et(vt[Ut]);return Et}({1:[function(_e,_,dt){(function(vt,Et,Pt,Ut,Ft,Yt,hn,_n,pn){var ln=_e("crypto");function Pn(An,kn){return function(jt,Wt){var Zt;if((Zt=Wt.algorithm!=="passthrough"?ln.createHash(Wt.algorithm):new Nn).write===void 0&&(Zt.write=Zt.update,Zt.end=Zt.update),dn(Wt,Zt).dispatch(jt),Zt.update||Zt.end(""),Zt.digest)return Zt.digest(Wt.encoding==="buffer"?void 0:Wt.encoding);var Bn=Zt.read();return Wt.encoding!=="buffer"?Bn.toString(Wt.encoding):Bn}(An,kn=tn(An,kn))}(dt=_.exports=Pn).sha1=function(An){return Pn(An)},dt.keys=function(An){return Pn(An,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},dt.MD5=function(An){return Pn(An,{algorithm:"md5",encoding:"hex"})},dt.keysMD5=function(An){return Pn(An,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var nn=ln.getHashes?ln.getHashes().slice():["sha1","md5"];nn.push("passthrough");var Hn=["buffer","hex","binary","base64"];function tn(An,kn){kn=kn||{};var jt={};if(jt.algorithm=kn.algorithm||"sha1",jt.encoding=kn.encoding||"hex",jt.excludeValues=!!kn.excludeValues,jt.algorithm=jt.algorithm.toLowerCase(),jt.encoding=jt.encoding.toLowerCase(),jt.ignoreUnknown=kn.ignoreUnknown===!0,jt.respectType=kn.respectType!==!1,jt.respectFunctionNames=kn.respectFunctionNames!==!1,jt.respectFunctionProperties=kn.respectFunctionProperties!==!1,jt.unorderedArrays=kn.unorderedArrays===!0,jt.unorderedSets=kn.unorderedSets!==!1,jt.unorderedObjects=kn.unorderedObjects!==!1,jt.replacer=kn.replacer||void 0,jt.excludeKeys=kn.excludeKeys||void 0,An===void 0)throw new Error("Object argument required.");for(var Wt=0;Wt<nn.length;++Wt)nn[Wt].toLowerCase()===jt.algorithm.toLowerCase()&&(jt.algorithm=nn[Wt]);if(nn.indexOf(jt.algorithm)===-1)throw new Error('Algorithm "'+jt.algorithm+'"  not supported. supported values: '+nn.join(", "));if(Hn.indexOf(jt.encoding)===-1&&jt.algorithm!=="passthrough")throw new Error('Encoding "'+jt.encoding+'"  not supported. supported values: '+Hn.join(", "));return jt}function Xt(An){if(typeof An=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(An))!=null}function dn(An,kn,jt){function Wt(Zt){return kn.update?kn.update(Zt,"utf8"):kn.write(Zt,"utf8")}return jt=jt||[],{dispatch:function(Zt){return An.replacer&&(Zt=An.replacer(Zt)),this["_"+(Zt===null?"null":typeof Zt)](Zt)},_object:function(Zt){var Bn,Qt=Object.prototype.toString.call(Zt),Kt=/\[object (.*)\]/i.exec(Qt);if(Kt=(Kt=Kt?Kt[1]:"unknown:["+Qt+"]").toLowerCase(),0<=(Bn=jt.indexOf(Zt)))return this.dispatch("[CIRCULAR:"+Bn+"]");if(jt.push(Zt),Pt!==void 0&&Pt.isBuffer&&Pt.isBuffer(Zt))return Wt("buffer:"),Wt(Zt);if(Kt==="object"||Kt==="function"||Kt==="asyncfunction"){var an=Object.keys(Zt);An.unorderedObjects&&(an=an.sort()),An.respectType===!1||Xt(Zt)||an.splice(0,0,"prototype","__proto__","constructor"),An.excludeKeys&&(an=an.filter(function(Xn){return!An.excludeKeys(Xn)})),Wt("object:"+an.length+":");var yn=this;return an.forEach(function(Xn){yn.dispatch(Xn),Wt(":"),An.excludeValues||yn.dispatch(Zt[Xn]),Wt(",")})}if(!this["_"+Kt]){if(An.ignoreUnknown)return Wt("["+Kt+"]");throw new Error('Unknown object type "'+Kt+'"')}this["_"+Kt](Zt)},_array:function(Zt,Bn){Bn=Bn!==void 0?Bn:An.unorderedArrays!==!1;var Qt=this;if(Wt("array:"+Zt.length+":"),!Bn||Zt.length<=1)return Zt.forEach(function(yn){return Qt.dispatch(yn)});var Kt=[],an=Zt.map(function(yn){var Xn=new Nn,rr=jt.slice();return dn(An,Xn,rr).dispatch(yn),Kt=Kt.concat(rr.slice(jt.length)),Xn.read().toString()});return jt=jt.concat(Kt),an.sort(),this._array(an,!1)},_date:function(Zt){return Wt("date:"+Zt.toJSON())},_symbol:function(Zt){return Wt("symbol:"+Zt.toString())},_error:function(Zt){return Wt("error:"+Zt.toString())},_boolean:function(Zt){return Wt("bool:"+Zt.toString())},_string:function(Zt){Wt("string:"+Zt.length+":"),Wt(Zt.toString())},_function:function(Zt){Wt("fn:"),Xt(Zt)?this.dispatch("[native]"):this.dispatch(Zt.toString()),An.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(Zt.name)),An.respectFunctionProperties&&this._object(Zt)},_number:function(Zt){return Wt("number:"+Zt.toString())},_xml:function(Zt){return Wt("xml:"+Zt.toString())},_null:function(){return Wt("Null")},_undefined:function(){return Wt("Undefined")},_regexp:function(Zt){return Wt("regex:"+Zt.toString())},_uint8array:function(Zt){return Wt("uint8array:"),this.dispatch(Array.prototype.slice.call(Zt))},_uint8clampedarray:function(Zt){return Wt("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(Zt))},_int8array:function(Zt){return Wt("uint8array:"),this.dispatch(Array.prototype.slice.call(Zt))},_uint16array:function(Zt){return Wt("uint16array:"),this.dispatch(Array.prototype.slice.call(Zt))},_int16array:function(Zt){return Wt("uint16array:"),this.dispatch(Array.prototype.slice.call(Zt))},_uint32array:function(Zt){return Wt("uint32array:"),this.dispatch(Array.prototype.slice.call(Zt))},_int32array:function(Zt){return Wt("uint32array:"),this.dispatch(Array.prototype.slice.call(Zt))},_float32array:function(Zt){return Wt("float32array:"),this.dispatch(Array.prototype.slice.call(Zt))},_float64array:function(Zt){return Wt("float64array:"),this.dispatch(Array.prototype.slice.call(Zt))},_arraybuffer:function(Zt){return Wt("arraybuffer:"),this.dispatch(new Uint8Array(Zt))},_url:function(Zt){return Wt("url:"+Zt.toString())},_map:function(Zt){Wt("map:");var Bn=Array.from(Zt);return this._array(Bn,An.unorderedSets!==!1)},_set:function(Zt){Wt("set:");var Bn=Array.from(Zt);return this._array(Bn,An.unorderedSets!==!1)},_file:function(Zt){return Wt("file:"),this.dispatch([Zt.name,Zt.size,Zt.type,Zt.lastModfied])},_blob:function(){if(An.ignoreUnknown)return Wt("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return Wt("domwindow")},_bigint:function(Zt){return Wt("bigint:"+Zt.toString())},_process:function(){return Wt("process")},_timer:function(){return Wt("timer")},_pipe:function(){return Wt("pipe")},_tcp:function(){return Wt("tcp")},_udp:function(){return Wt("udp")},_tty:function(){return Wt("tty")},_statwatcher:function(){return Wt("statwatcher")},_securecontext:function(){return Wt("securecontext")},_connection:function(){return Wt("connection")},_zlib:function(){return Wt("zlib")},_context:function(){return Wt("context")},_nodescript:function(){return Wt("nodescript")},_httpparser:function(){return Wt("httpparser")},_dataview:function(){return Wt("dataview")},_signal:function(){return Wt("signal")},_fsevent:function(){return Wt("fsevent")},_tlswrap:function(){return Wt("tlswrap")}}}function Nn(){return{buf:"",write:function(An){this.buf+=An},end:function(An){this.buf+=An},read:function(){return this.buf}}}dt.writeToStream=function(An,kn,jt){return jt===void 0&&(jt=kn,kn={}),dn(kn=tn(An,kn),jt).dispatch(An)}}).call(this,_e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(_e,_,dt){(function(vt,Et,Pt,Ut,Ft,Yt,hn,_n,pn){(function(ln){var Pn=typeof Uint8Array<"u"?Uint8Array:Array,nn=43,Hn=47,tn=48,Xt=97,dn=65,Nn=45,An=95;function kn(jt){var Wt=jt.charCodeAt(0);return Wt===nn||Wt===Nn?62:Wt===Hn||Wt===An?63:Wt<tn?-1:Wt<tn+10?Wt-tn+26+26:Wt<dn+26?Wt-dn:Wt<Xt+26?Wt-Xt+26:void 0}ln.toByteArray=function(jt){var Wt,Zt;if(0<jt.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var Bn=jt.length,Qt=jt.charAt(Bn-2)==="="?2:jt.charAt(Bn-1)==="="?1:0,Kt=new Pn(3*jt.length/4-Qt),an=0<Qt?jt.length-4:jt.length,yn=0;function Xn(rr){Kt[yn++]=rr}for(Wt=0;Wt<an;Wt+=4,0)Xn((16711680&(Zt=kn(jt.charAt(Wt))<<18|kn(jt.charAt(Wt+1))<<12|kn(jt.charAt(Wt+2))<<6|kn(jt.charAt(Wt+3))))>>16),Xn((65280&Zt)>>8),Xn(255&Zt);return Qt==2?Xn(255&(Zt=kn(jt.charAt(Wt))<<2|kn(jt.charAt(Wt+1))>>4)):Qt==1&&(Xn((Zt=kn(jt.charAt(Wt))<<10|kn(jt.charAt(Wt+1))<<4|kn(jt.charAt(Wt+2))>>2)>>8&255),Xn(255&Zt)),Kt},ln.fromByteArray=function(jt){var Wt,Zt,Bn,Qt,Kt=jt.length%3,an="";function yn(Xn){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(Xn)}for(Wt=0,Bn=jt.length-Kt;Wt<Bn;Wt+=3)an+=yn((Qt=Zt=(jt[Wt]<<16)+(jt[Wt+1]<<8)+jt[Wt+2])>>18&63)+yn(Qt>>12&63)+yn(Qt>>6&63)+yn(63&Qt);switch(Kt){case 1:an+=yn((Zt=jt[jt.length-1])>>2),an+=yn(Zt<<4&63),an+="==";break;case 2:an+=yn((Zt=(jt[jt.length-2]<<8)+jt[jt.length-1])>>10),an+=yn(Zt>>4&63),an+=yn(Zt<<2&63),an+="="}return an}})(dt===void 0?this.base64js={}:dt)}).call(this,_e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(_e,_,dt){(function(vt,Et,nn,Ut,Ft,Yt,hn,_n,pn){var ln=_e("base64-js"),Pn=_e("ieee754");function nn(rn,Dn,Qn){if(!(this instanceof nn))return new nn(rn,Dn,Qn);var jr,hr,Kr,Js,fo,no=typeof rn;if(Dn==="base64"&&no=="string")for(rn=(jr=rn).trim?jr.trim():jr.replace(/^\s+|\s+$/g,"");rn.length%4!=0;)rn+="=";if(no=="number")hr=yn(rn);else if(no=="string")hr=nn.byteLength(rn,Dn);else{if(no!="object")throw new Error("First argument needs to be a number, array or string.");hr=yn(rn.length)}if(nn._useTypedArrays?Kr=nn._augment(new Uint8Array(hr)):((Kr=this).length=hr,Kr._isBuffer=!0),nn._useTypedArrays&&typeof rn.byteLength=="number")Kr._set(rn);else if(Xn(fo=rn)||nn.isBuffer(fo)||fo&&typeof fo=="object"&&typeof fo.length=="number")for(Js=0;Js<hr;Js++)nn.isBuffer(rn)?Kr[Js]=rn.readUInt8(Js):Kr[Js]=rn[Js];else if(no=="string")Kr.write(rn,0,Dn);else if(no=="number"&&!nn._useTypedArrays&&!Qn)for(Js=0;Js<hr;Js++)Kr[Js]=0;return Kr}function Hn(rn,Dn,Qn,jr){jr||(_i(typeof Qn=="boolean","missing or invalid endian"),_i(Dn!=null,"missing offset"),_i(Dn+1<rn.length,"Trying to read beyond buffer length"));var hr,Kr=rn.length;if(!(Kr<=Dn))return Qn?(hr=rn[Dn],Dn+1<Kr&&(hr|=rn[Dn+1]<<8)):(hr=rn[Dn]<<8,Dn+1<Kr&&(hr|=rn[Dn+1])),hr}function tn(rn,Dn,Qn,jr){jr||(_i(typeof Qn=="boolean","missing or invalid endian"),_i(Dn!=null,"missing offset"),_i(Dn+3<rn.length,"Trying to read beyond buffer length"));var hr,Kr=rn.length;if(!(Kr<=Dn))return Qn?(Dn+2<Kr&&(hr=rn[Dn+2]<<16),Dn+1<Kr&&(hr|=rn[Dn+1]<<8),hr|=rn[Dn],Dn+3<Kr&&(hr+=rn[Dn+3]<<24>>>0)):(Dn+1<Kr&&(hr=rn[Dn+1]<<16),Dn+2<Kr&&(hr|=rn[Dn+2]<<8),Dn+3<Kr&&(hr|=rn[Dn+3]),hr+=rn[Dn]<<24>>>0),hr}function Xt(rn,Dn,Qn,jr){if(jr||(_i(typeof Qn=="boolean","missing or invalid endian"),_i(Dn!=null,"missing offset"),_i(Dn+1<rn.length,"Trying to read beyond buffer length")),!(rn.length<=Dn)){var hr=Hn(rn,Dn,Qn,!0);return 32768&hr?-1*(65535-hr+1):hr}}function dn(rn,Dn,Qn,jr){if(jr||(_i(typeof Qn=="boolean","missing or invalid endian"),_i(Dn!=null,"missing offset"),_i(Dn+3<rn.length,"Trying to read beyond buffer length")),!(rn.length<=Dn)){var hr=tn(rn,Dn,Qn,!0);return 2147483648&hr?-1*(4294967295-hr+1):hr}}function Nn(rn,Dn,Qn,jr){return jr||(_i(typeof Qn=="boolean","missing or invalid endian"),_i(Dn+3<rn.length,"Trying to read beyond buffer length")),Pn.read(rn,Dn,Qn,23,4)}function An(rn,Dn,Qn,jr){return jr||(_i(typeof Qn=="boolean","missing or invalid endian"),_i(Dn+7<rn.length,"Trying to read beyond buffer length")),Pn.read(rn,Dn,Qn,52,8)}function kn(rn,Dn,Qn,jr,hr){hr||(_i(Dn!=null,"missing value"),_i(typeof jr=="boolean","missing or invalid endian"),_i(Qn!=null,"missing offset"),_i(Qn+1<rn.length,"trying to write beyond buffer length"),cr(Dn,65535));var Kr=rn.length;if(!(Kr<=Qn))for(var Js=0,fo=Math.min(Kr-Qn,2);Js<fo;Js++)rn[Qn+Js]=(Dn&255<<8*(jr?Js:1-Js))>>>8*(jr?Js:1-Js)}function jt(rn,Dn,Qn,jr,hr){hr||(_i(Dn!=null,"missing value"),_i(typeof jr=="boolean","missing or invalid endian"),_i(Qn!=null,"missing offset"),_i(Qn+3<rn.length,"trying to write beyond buffer length"),cr(Dn,4294967295));var Kr=rn.length;if(!(Kr<=Qn))for(var Js=0,fo=Math.min(Kr-Qn,4);Js<fo;Js++)rn[Qn+Js]=Dn>>>8*(jr?Js:3-Js)&255}function Wt(rn,Dn,Qn,jr,hr){hr||(_i(Dn!=null,"missing value"),_i(typeof jr=="boolean","missing or invalid endian"),_i(Qn!=null,"missing offset"),_i(Qn+1<rn.length,"Trying to write beyond buffer length"),ur(Dn,32767,-32768)),rn.length<=Qn||kn(rn,0<=Dn?Dn:65535+Dn+1,Qn,jr,hr)}function Zt(rn,Dn,Qn,jr,hr){hr||(_i(Dn!=null,"missing value"),_i(typeof jr=="boolean","missing or invalid endian"),_i(Qn!=null,"missing offset"),_i(Qn+3<rn.length,"Trying to write beyond buffer length"),ur(Dn,2147483647,-2147483648)),rn.length<=Qn||jt(rn,0<=Dn?Dn:4294967295+Dn+1,Qn,jr,hr)}function Bn(rn,Dn,Qn,jr,hr){hr||(_i(Dn!=null,"missing value"),_i(typeof jr=="boolean","missing or invalid endian"),_i(Qn!=null,"missing offset"),_i(Qn+3<rn.length,"Trying to write beyond buffer length"),Sr(Dn,34028234663852886e22,-34028234663852886e22)),rn.length<=Qn||Pn.write(rn,Dn,Qn,jr,23,4)}function Qt(rn,Dn,Qn,jr,hr){hr||(_i(Dn!=null,"missing value"),_i(typeof jr=="boolean","missing or invalid endian"),_i(Qn!=null,"missing offset"),_i(Qn+7<rn.length,"Trying to write beyond buffer length"),Sr(Dn,17976931348623157e292,-17976931348623157e292)),rn.length<=Qn||Pn.write(rn,Dn,Qn,jr,52,8)}dt.Buffer=nn,dt.SlowBuffer=nn,dt.INSPECT_MAX_BYTES=50,nn.poolSize=8192,nn._useTypedArrays=function(){try{var rn=new ArrayBuffer(0),Dn=new Uint8Array(rn);return Dn.foo=function(){return 42},Dn.foo()===42&&typeof Dn.subarray=="function"}catch{return!1}}(),nn.isEncoding=function(rn){switch(String(rn).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},nn.isBuffer=function(rn){return!(rn==null||!rn._isBuffer)},nn.byteLength=function(rn,Dn){var Qn;switch(rn+="",Dn||"utf8"){case"hex":Qn=rn.length/2;break;case"utf8":case"utf-8":Qn=vr(rn).length;break;case"ascii":case"binary":case"raw":Qn=rn.length;break;case"base64":Qn=Wn(rn).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Qn=2*rn.length;break;default:throw new Error("Unknown encoding")}return Qn},nn.concat=function(rn,Dn){if(_i(Xn(rn),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),rn.length===0)return new nn(0);if(rn.length===1)return rn[0];if(typeof Dn!="number")for(hr=Dn=0;hr<rn.length;hr++)Dn+=rn[hr].length;for(var Qn=new nn(Dn),jr=0,hr=0;hr<rn.length;hr++){var Kr=rn[hr];Kr.copy(Qn,jr),jr+=Kr.length}return Qn},nn.prototype.write=function(rn,Dn,Qn,jr){var hr;isFinite(Dn)?isFinite(Qn)||(jr=Qn,Qn=void 0):(hr=jr,jr=Dn,Dn=Qn,Qn=hr),Dn=Number(Dn)||0;var Kr,Js,fo,no,ba,Mo,_c,Cl=this.length-Dn;switch((!Qn||Cl<(Qn=Number(Qn)))&&(Qn=Cl),jr=String(jr||"utf8").toLowerCase()){case"hex":Kr=function($a,Jp,bm,Hl){bm=Number(bm)||0;var Ql=$a.length-bm;(!Hl||Ql<(Hl=Number(Hl)))&&(Hl=Ql);var Ml=Jp.length;_i(Ml%2==0,"Invalid hex string"),Ml/2<Hl&&(Hl=Ml/2);for(var Ll=0;Ll<Hl;Ll++){var _l=parseInt(Jp.substr(2*Ll,2),16);_i(!isNaN(_l),"Invalid hex string"),$a[bm+Ll]=_l}return nn._charsWritten=2*Ll,Ll}(this,rn,Dn,Qn);break;case"utf8":case"utf-8":ba=rn,Mo=Dn,_c=Qn,Kr=nn._charsWritten=ir(vr(ba),this,Mo,_c);break;case"ascii":case"binary":Kr=function($a,Jp,bm,Hl){return nn._charsWritten=ir(function(Ql){for(var Ml=[],Ll=0;Ll<Ql.length;Ll++)Ml.push(255&Ql.charCodeAt(Ll));return Ml}(Jp),$a,bm,Hl)}(this,rn,Dn,Qn);break;case"base64":Js=rn,fo=Dn,no=Qn,Kr=nn._charsWritten=ir(Wn(Js),this,fo,no);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Kr=function($a,Jp,bm,Hl){return nn._charsWritten=ir(function(Ql){for(var Ml,Ll,_l,Np=[],wm=0;wm<Ql.length;wm++)Ll=(Ml=Ql.charCodeAt(wm))>>8,_l=Ml%256,Np.push(_l),Np.push(Ll);return Np}(Jp),$a,bm,Hl)}(this,rn,Dn,Qn);break;default:throw new Error("Unknown encoding")}return Kr},nn.prototype.toString=function(rn,Dn,Qn){var jr,hr,Kr,Js,fo=this;if(rn=String(rn||"utf8").toLowerCase(),Dn=Number(Dn)||0,(Qn=Qn!==void 0?Number(Qn):Qn=fo.length)===Dn)return"";switch(rn){case"hex":jr=function(no,ba,Mo){var _c=no.length;(!ba||ba<0)&&(ba=0),(!Mo||Mo<0||_c<Mo)&&(Mo=_c);for(var Cl="",$a=ba;$a<Mo;$a++)Cl+=rr(no[$a]);return Cl}(fo,Dn,Qn);break;case"utf8":case"utf-8":jr=function(no,ba,Mo){var _c="",Cl="";Mo=Math.min(no.length,Mo);for(var $a=ba;$a<Mo;$a++)no[$a]<=127?(_c+=zn(Cl)+String.fromCharCode(no[$a]),Cl=""):Cl+="%"+no[$a].toString(16);return _c+zn(Cl)}(fo,Dn,Qn);break;case"ascii":case"binary":jr=function(no,ba,Mo){var _c="";Mo=Math.min(no.length,Mo);for(var Cl=ba;Cl<Mo;Cl++)_c+=String.fromCharCode(no[Cl]);return _c}(fo,Dn,Qn);break;case"base64":hr=fo,Js=Qn,jr=(Kr=Dn)===0&&Js===hr.length?ln.fromByteArray(hr):ln.fromByteArray(hr.slice(Kr,Js));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":jr=function(no,ba,Mo){for(var _c=no.slice(ba,Mo),Cl="",$a=0;$a<_c.length;$a+=2)Cl+=String.fromCharCode(_c[$a]+256*_c[$a+1]);return Cl}(fo,Dn,Qn);break;default:throw new Error("Unknown encoding")}return jr},nn.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},nn.prototype.copy=function(rn,Dn,Qn,jr){if(Qn=Qn||0,jr||jr===0||(jr=this.length),Dn=Dn||0,jr!==Qn&&rn.length!==0&&this.length!==0){_i(Qn<=jr,"sourceEnd < sourceStart"),_i(0<=Dn&&Dn<rn.length,"targetStart out of bounds"),_i(0<=Qn&&Qn<this.length,"sourceStart out of bounds"),_i(0<=jr&&jr<=this.length,"sourceEnd out of bounds"),jr>this.length&&(jr=this.length),rn.length-Dn<jr-Qn&&(jr=rn.length-Dn+Qn);var hr=jr-Qn;if(hr<100||!nn._useTypedArrays)for(var Kr=0;Kr<hr;Kr++)rn[Kr+Dn]=this[Kr+Qn];else rn._set(this.subarray(Qn,Qn+hr),Dn)}},nn.prototype.slice=function(rn,Dn){var Qn=this.length;if(rn=an(rn,Qn,0),Dn=an(Dn,Qn,Qn),nn._useTypedArrays)return nn._augment(this.subarray(rn,Dn));for(var jr=Dn-rn,hr=new nn(jr,void 0,!0),Kr=0;Kr<jr;Kr++)hr[Kr]=this[Kr+rn];return hr},nn.prototype.get=function(rn){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(rn)},nn.prototype.set=function(rn,Dn){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(rn,Dn)},nn.prototype.readUInt8=function(rn,Dn){if(Dn||(_i(rn!=null,"missing offset"),_i(rn<this.length,"Trying to read beyond buffer length")),!(rn>=this.length))return this[rn]},nn.prototype.readUInt16LE=function(rn,Dn){return Hn(this,rn,!0,Dn)},nn.prototype.readUInt16BE=function(rn,Dn){return Hn(this,rn,!1,Dn)},nn.prototype.readUInt32LE=function(rn,Dn){return tn(this,rn,!0,Dn)},nn.prototype.readUInt32BE=function(rn,Dn){return tn(this,rn,!1,Dn)},nn.prototype.readInt8=function(rn,Dn){if(Dn||(_i(rn!=null,"missing offset"),_i(rn<this.length,"Trying to read beyond buffer length")),!(rn>=this.length))return 128&this[rn]?-1*(255-this[rn]+1):this[rn]},nn.prototype.readInt16LE=function(rn,Dn){return Xt(this,rn,!0,Dn)},nn.prototype.readInt16BE=function(rn,Dn){return Xt(this,rn,!1,Dn)},nn.prototype.readInt32LE=function(rn,Dn){return dn(this,rn,!0,Dn)},nn.prototype.readInt32BE=function(rn,Dn){return dn(this,rn,!1,Dn)},nn.prototype.readFloatLE=function(rn,Dn){return Nn(this,rn,!0,Dn)},nn.prototype.readFloatBE=function(rn,Dn){return Nn(this,rn,!1,Dn)},nn.prototype.readDoubleLE=function(rn,Dn){return An(this,rn,!0,Dn)},nn.prototype.readDoubleBE=function(rn,Dn){return An(this,rn,!1,Dn)},nn.prototype.writeUInt8=function(rn,Dn,Qn){Qn||(_i(rn!=null,"missing value"),_i(Dn!=null,"missing offset"),_i(Dn<this.length,"trying to write beyond buffer length"),cr(rn,255)),Dn>=this.length||(this[Dn]=rn)},nn.prototype.writeUInt16LE=function(rn,Dn,Qn){kn(this,rn,Dn,!0,Qn)},nn.prototype.writeUInt16BE=function(rn,Dn,Qn){kn(this,rn,Dn,!1,Qn)},nn.prototype.writeUInt32LE=function(rn,Dn,Qn){jt(this,rn,Dn,!0,Qn)},nn.prototype.writeUInt32BE=function(rn,Dn,Qn){jt(this,rn,Dn,!1,Qn)},nn.prototype.writeInt8=function(rn,Dn,Qn){Qn||(_i(rn!=null,"missing value"),_i(Dn!=null,"missing offset"),_i(Dn<this.length,"Trying to write beyond buffer length"),ur(rn,127,-128)),Dn>=this.length||(0<=rn?this.writeUInt8(rn,Dn,Qn):this.writeUInt8(255+rn+1,Dn,Qn))},nn.prototype.writeInt16LE=function(rn,Dn,Qn){Wt(this,rn,Dn,!0,Qn)},nn.prototype.writeInt16BE=function(rn,Dn,Qn){Wt(this,rn,Dn,!1,Qn)},nn.prototype.writeInt32LE=function(rn,Dn,Qn){Zt(this,rn,Dn,!0,Qn)},nn.prototype.writeInt32BE=function(rn,Dn,Qn){Zt(this,rn,Dn,!1,Qn)},nn.prototype.writeFloatLE=function(rn,Dn,Qn){Bn(this,rn,Dn,!0,Qn)},nn.prototype.writeFloatBE=function(rn,Dn,Qn){Bn(this,rn,Dn,!1,Qn)},nn.prototype.writeDoubleLE=function(rn,Dn,Qn){Qt(this,rn,Dn,!0,Qn)},nn.prototype.writeDoubleBE=function(rn,Dn,Qn){Qt(this,rn,Dn,!1,Qn)},nn.prototype.fill=function(rn,Dn,Qn){if(rn=rn||0,Dn=Dn||0,Qn=Qn||this.length,typeof rn=="string"&&(rn=rn.charCodeAt(0)),_i(typeof rn=="number"&&!isNaN(rn),"value is not a number"),_i(Dn<=Qn,"end < start"),Qn!==Dn&&this.length!==0){_i(0<=Dn&&Dn<this.length,"start out of bounds"),_i(0<=Qn&&Qn<=this.length,"end out of bounds");for(var jr=Dn;jr<Qn;jr++)this[jr]=rn}},nn.prototype.inspect=function(){for(var rn=[],Dn=this.length,Qn=0;Qn<Dn;Qn++)if(rn[Qn]=rr(this[Qn]),Qn===dt.INSPECT_MAX_BYTES){rn[Qn+1]="...";break}return"<Buffer "+rn.join(" ")+">"},nn.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(nn._useTypedArrays)return new nn(this).buffer;for(var rn=new Uint8Array(this.length),Dn=0,Qn=rn.length;Dn<Qn;Dn+=1)rn[Dn]=this[Dn];return rn.buffer};var Kt=nn.prototype;function an(rn,Dn,Qn){return typeof rn!="number"?Qn:Dn<=(rn=~~rn)?Dn:0<=rn||0<=(rn+=Dn)?rn:0}function yn(rn){return(rn=~~Math.ceil(+rn))<0?0:rn}function Xn(rn){return(Array.isArray||function(Dn){return Object.prototype.toString.call(Dn)==="[object Array]"})(rn)}function rr(rn){return rn<16?"0"+rn.toString(16):rn.toString(16)}function vr(rn){for(var Dn=[],Qn=0;Qn<rn.length;Qn++){var jr=rn.charCodeAt(Qn);if(jr<=127)Dn.push(rn.charCodeAt(Qn));else{var hr=Qn;55296<=jr&&jr<=57343&&Qn++;for(var Kr=encodeURIComponent(rn.slice(hr,Qn+1)).substr(1).split("%"),Js=0;Js<Kr.length;Js++)Dn.push(parseInt(Kr[Js],16))}}return Dn}function Wn(rn){return ln.toByteArray(rn)}function ir(rn,Dn,Qn,jr){for(var hr=0;hr<jr&&!(hr+Qn>=Dn.length||hr>=rn.length);hr++)Dn[hr+Qn]=rn[hr];return hr}function zn(rn){try{return decodeURIComponent(rn)}catch{return""}}function cr(rn,Dn){_i(typeof rn=="number","cannot write a non-number as a number"),_i(0<=rn,"specified a negative value for writing an unsigned value"),_i(rn<=Dn,"value is larger than maximum value for type"),_i(Math.floor(rn)===rn,"value has a fractional component")}function ur(rn,Dn,Qn){_i(typeof rn=="number","cannot write a non-number as a number"),_i(rn<=Dn,"value larger than maximum allowed value"),_i(Qn<=rn,"value smaller than minimum allowed value"),_i(Math.floor(rn)===rn,"value has a fractional component")}function Sr(rn,Dn,Qn){_i(typeof rn=="number","cannot write a non-number as a number"),_i(rn<=Dn,"value larger than maximum allowed value"),_i(Qn<=rn,"value smaller than minimum allowed value")}function _i(rn,Dn){if(!rn)throw new Error(Dn||"Failed assertion")}nn._augment=function(rn){return rn._isBuffer=!0,rn._get=rn.get,rn._set=rn.set,rn.get=Kt.get,rn.set=Kt.set,rn.write=Kt.write,rn.toString=Kt.toString,rn.toLocaleString=Kt.toString,rn.toJSON=Kt.toJSON,rn.copy=Kt.copy,rn.slice=Kt.slice,rn.readUInt8=Kt.readUInt8,rn.readUInt16LE=Kt.readUInt16LE,rn.readUInt16BE=Kt.readUInt16BE,rn.readUInt32LE=Kt.readUInt32LE,rn.readUInt32BE=Kt.readUInt32BE,rn.readInt8=Kt.readInt8,rn.readInt16LE=Kt.readInt16LE,rn.readInt16BE=Kt.readInt16BE,rn.readInt32LE=Kt.readInt32LE,rn.readInt32BE=Kt.readInt32BE,rn.readFloatLE=Kt.readFloatLE,rn.readFloatBE=Kt.readFloatBE,rn.readDoubleLE=Kt.readDoubleLE,rn.readDoubleBE=Kt.readDoubleBE,rn.writeUInt8=Kt.writeUInt8,rn.writeUInt16LE=Kt.writeUInt16LE,rn.writeUInt16BE=Kt.writeUInt16BE,rn.writeUInt32LE=Kt.writeUInt32LE,rn.writeUInt32BE=Kt.writeUInt32BE,rn.writeInt8=Kt.writeInt8,rn.writeInt16LE=Kt.writeInt16LE,rn.writeInt16BE=Kt.writeInt16BE,rn.writeInt32LE=Kt.writeInt32LE,rn.writeInt32BE=Kt.writeInt32BE,rn.writeFloatLE=Kt.writeFloatLE,rn.writeFloatBE=Kt.writeFloatBE,rn.writeDoubleLE=Kt.writeDoubleLE,rn.writeDoubleBE=Kt.writeDoubleBE,rn.fill=Kt.fill,rn.inspect=Kt.inspect,rn.toArrayBuffer=Kt.toArrayBuffer,rn}}).call(this,_e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(_e,_,dt){(function(vt,Et,Pt,Ut,Ft,Yt,hn,_n,pn){Pt=_e("buffer").Buffer;var ln=new Pt(4);ln.fill(0),_.exports={hash:function(Pn,nn,Hn,tn){return Pt.isBuffer(Pn)||(Pn=new Pt(Pn)),function(Xt,dn,Nn){for(var An=new Pt(dn),kn=Nn?An.writeInt32BE:An.writeInt32LE,jt=0;jt<Xt.length;jt++)kn.call(An,Xt[jt],4*jt,!0);return An}(nn(function(Xt,dn){var Nn;Xt.length%4!=0&&(Nn=Xt.length+(4-Xt.length%4),Xt=Pt.concat([Xt,ln],Nn));for(var An=[],kn=dn?Xt.readInt32BE:Xt.readInt32LE,jt=0;jt<Xt.length;jt+=4)An.push(kn.call(Xt,jt));return An}(Pn,tn),8*Pn.length),Hn,tn)}}}).call(this,_e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(_e,_,dt){(function(vt,Et,Pt,Ut,Ft,Yt,hn,_n,pn){Pt=_e("buffer").Buffer;var ln=_e("./sha"),Pn=_e("./sha256"),nn=_e("./rng"),Hn={sha1:ln,sha256:Pn,md5:_e("./md5")},tn=64,Xt=new Pt(tn);function dn(An,kn){var jt=Hn[An=An||"sha1"],Wt=[];return jt||Nn("algorithm:",An,"is not yet supported"),{update:function(Zt){return Pt.isBuffer(Zt)||(Zt=new Pt(Zt)),Wt.push(Zt),Zt.length,this},digest:function(Zt){var Bn=Pt.concat(Wt),Qt=kn?function(Kt,an,yn){Pt.isBuffer(an)||(an=new Pt(an)),Pt.isBuffer(yn)||(yn=new Pt(yn)),an.length>tn?an=Kt(an):an.length<tn&&(an=Pt.concat([an,Xt],tn));for(var Xn=new Pt(tn),rr=new Pt(tn),vr=0;vr<tn;vr++)Xn[vr]=54^an[vr],rr[vr]=92^an[vr];var Wn=Kt(Pt.concat([Xn,yn]));return Kt(Pt.concat([rr,Wn]))}(jt,kn,Bn):jt(Bn);return Wt=null,Zt?Qt.toString(Zt):Qt}}}function Nn(){var An=[].slice.call(arguments).join(" ");throw new Error([An,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}Xt.fill(0),dt.createHash=function(An){return dn(An)},dt.createHmac=dn,dt.randomBytes=function(An,kn){if(!kn||!kn.call)return new Pt(nn(An));try{kn.call(this,void 0,new Pt(nn(An)))}catch(jt){kn(jt)}},function(An,kn){for(var jt in An)kn(An[jt])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(An){dt[An]=function(){Nn("sorry,",An,"is not implemented yet")}})}).call(this,_e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(_e,_,dt){(function(vt,Et,Pt,Ut,Ft,Yt,hn,_n,pn){var ln=_e("./helpers");function Pn(An,kn){An[kn>>5]|=128<<kn%32,An[14+(kn+64>>>9<<4)]=kn;for(var jt=1732584193,Wt=-271733879,Zt=-1732584194,Bn=271733878,Qt=0;Qt<An.length;Qt+=16){var Kt=jt,an=Wt,yn=Zt,Xn=Bn;jt=Hn(jt,Wt,Zt,Bn,An[Qt+0],7,-680876936),Bn=Hn(Bn,jt,Wt,Zt,An[Qt+1],12,-389564586),Zt=Hn(Zt,Bn,jt,Wt,An[Qt+2],17,606105819),Wt=Hn(Wt,Zt,Bn,jt,An[Qt+3],22,-1044525330),jt=Hn(jt,Wt,Zt,Bn,An[Qt+4],7,-176418897),Bn=Hn(Bn,jt,Wt,Zt,An[Qt+5],12,1200080426),Zt=Hn(Zt,Bn,jt,Wt,An[Qt+6],17,-1473231341),Wt=Hn(Wt,Zt,Bn,jt,An[Qt+7],22,-45705983),jt=Hn(jt,Wt,Zt,Bn,An[Qt+8],7,1770035416),Bn=Hn(Bn,jt,Wt,Zt,An[Qt+9],12,-1958414417),Zt=Hn(Zt,Bn,jt,Wt,An[Qt+10],17,-42063),Wt=Hn(Wt,Zt,Bn,jt,An[Qt+11],22,-1990404162),jt=Hn(jt,Wt,Zt,Bn,An[Qt+12],7,1804603682),Bn=Hn(Bn,jt,Wt,Zt,An[Qt+13],12,-40341101),Zt=Hn(Zt,Bn,jt,Wt,An[Qt+14],17,-1502002290),jt=tn(jt,Wt=Hn(Wt,Zt,Bn,jt,An[Qt+15],22,1236535329),Zt,Bn,An[Qt+1],5,-165796510),Bn=tn(Bn,jt,Wt,Zt,An[Qt+6],9,-1069501632),Zt=tn(Zt,Bn,jt,Wt,An[Qt+11],14,643717713),Wt=tn(Wt,Zt,Bn,jt,An[Qt+0],20,-373897302),jt=tn(jt,Wt,Zt,Bn,An[Qt+5],5,-701558691),Bn=tn(Bn,jt,Wt,Zt,An[Qt+10],9,38016083),Zt=tn(Zt,Bn,jt,Wt,An[Qt+15],14,-660478335),Wt=tn(Wt,Zt,Bn,jt,An[Qt+4],20,-405537848),jt=tn(jt,Wt,Zt,Bn,An[Qt+9],5,568446438),Bn=tn(Bn,jt,Wt,Zt,An[Qt+14],9,-1019803690),Zt=tn(Zt,Bn,jt,Wt,An[Qt+3],14,-187363961),Wt=tn(Wt,Zt,Bn,jt,An[Qt+8],20,1163531501),jt=tn(jt,Wt,Zt,Bn,An[Qt+13],5,-1444681467),Bn=tn(Bn,jt,Wt,Zt,An[Qt+2],9,-51403784),Zt=tn(Zt,Bn,jt,Wt,An[Qt+7],14,1735328473),jt=Xt(jt,Wt=tn(Wt,Zt,Bn,jt,An[Qt+12],20,-1926607734),Zt,Bn,An[Qt+5],4,-378558),Bn=Xt(Bn,jt,Wt,Zt,An[Qt+8],11,-2022574463),Zt=Xt(Zt,Bn,jt,Wt,An[Qt+11],16,1839030562),Wt=Xt(Wt,Zt,Bn,jt,An[Qt+14],23,-35309556),jt=Xt(jt,Wt,Zt,Bn,An[Qt+1],4,-1530992060),Bn=Xt(Bn,jt,Wt,Zt,An[Qt+4],11,1272893353),Zt=Xt(Zt,Bn,jt,Wt,An[Qt+7],16,-155497632),Wt=Xt(Wt,Zt,Bn,jt,An[Qt+10],23,-1094730640),jt=Xt(jt,Wt,Zt,Bn,An[Qt+13],4,681279174),Bn=Xt(Bn,jt,Wt,Zt,An[Qt+0],11,-358537222),Zt=Xt(Zt,Bn,jt,Wt,An[Qt+3],16,-722521979),Wt=Xt(Wt,Zt,Bn,jt,An[Qt+6],23,76029189),jt=Xt(jt,Wt,Zt,Bn,An[Qt+9],4,-640364487),Bn=Xt(Bn,jt,Wt,Zt,An[Qt+12],11,-421815835),Zt=Xt(Zt,Bn,jt,Wt,An[Qt+15],16,530742520),jt=dn(jt,Wt=Xt(Wt,Zt,Bn,jt,An[Qt+2],23,-995338651),Zt,Bn,An[Qt+0],6,-198630844),Bn=dn(Bn,jt,Wt,Zt,An[Qt+7],10,1126891415),Zt=dn(Zt,Bn,jt,Wt,An[Qt+14],15,-1416354905),Wt=dn(Wt,Zt,Bn,jt,An[Qt+5],21,-57434055),jt=dn(jt,Wt,Zt,Bn,An[Qt+12],6,1700485571),Bn=dn(Bn,jt,Wt,Zt,An[Qt+3],10,-1894986606),Zt=dn(Zt,Bn,jt,Wt,An[Qt+10],15,-1051523),Wt=dn(Wt,Zt,Bn,jt,An[Qt+1],21,-2054922799),jt=dn(jt,Wt,Zt,Bn,An[Qt+8],6,1873313359),Bn=dn(Bn,jt,Wt,Zt,An[Qt+15],10,-30611744),Zt=dn(Zt,Bn,jt,Wt,An[Qt+6],15,-1560198380),Wt=dn(Wt,Zt,Bn,jt,An[Qt+13],21,1309151649),jt=dn(jt,Wt,Zt,Bn,An[Qt+4],6,-145523070),Bn=dn(Bn,jt,Wt,Zt,An[Qt+11],10,-1120210379),Zt=dn(Zt,Bn,jt,Wt,An[Qt+2],15,718787259),Wt=dn(Wt,Zt,Bn,jt,An[Qt+9],21,-343485551),jt=Nn(jt,Kt),Wt=Nn(Wt,an),Zt=Nn(Zt,yn),Bn=Nn(Bn,Xn)}return Array(jt,Wt,Zt,Bn)}function nn(An,kn,jt,Wt,Zt,Bn){return Nn((Qt=Nn(Nn(kn,An),Nn(Wt,Bn)))<<(Kt=Zt)|Qt>>>32-Kt,jt);var Qt,Kt}function Hn(An,kn,jt,Wt,Zt,Bn,Qt){return nn(kn&jt|~kn&Wt,An,kn,Zt,Bn,Qt)}function tn(An,kn,jt,Wt,Zt,Bn,Qt){return nn(kn&Wt|jt&~Wt,An,kn,Zt,Bn,Qt)}function Xt(An,kn,jt,Wt,Zt,Bn,Qt){return nn(kn^jt^Wt,An,kn,Zt,Bn,Qt)}function dn(An,kn,jt,Wt,Zt,Bn,Qt){return nn(jt^(kn|~Wt),An,kn,Zt,Bn,Qt)}function Nn(An,kn){var jt=(65535&An)+(65535&kn);return(An>>16)+(kn>>16)+(jt>>16)<<16|65535&jt}_.exports=function(An){return ln.hash(An,Pn,16)}}).call(this,_e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(_e,_,dt){(function(vt,Et,Pt,Ut,Ft,Yt,hn,_n,pn){var ln;ln=function(Pn){for(var nn,Hn=new Array(Pn),tn=0;tn<Pn;tn++)!(3&tn)&&(nn=4294967296*Math.random()),Hn[tn]=nn>>>((3&tn)<<3)&255;return Hn},_.exports=ln}).call(this,_e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(_e,_,dt){(function(vt,Et,Pt,Ut,Ft,Yt,hn,_n,pn){var ln=_e("./helpers");function Pn(tn,Xt){tn[Xt>>5]|=128<<24-Xt%32,tn[15+(Xt+64>>9<<4)]=Xt;for(var dn,Nn,An,kn,jt,Wt=Array(80),Zt=1732584193,Bn=-271733879,Qt=-1732584194,Kt=271733878,an=-1009589776,yn=0;yn<tn.length;yn+=16){for(var Xn=Zt,rr=Bn,vr=Qt,Wn=Kt,ir=an,zn=0;zn<80;zn++){Wt[zn]=zn<16?tn[yn+zn]:Hn(Wt[zn-3]^Wt[zn-8]^Wt[zn-14]^Wt[zn-16],1);var cr=nn(nn(Hn(Zt,5),(An=Bn,kn=Qt,jt=Kt,(Nn=zn)<20?An&kn|~An&jt:!(Nn<40)&&Nn<60?An&kn|An&jt|kn&jt:An^kn^jt)),nn(nn(an,Wt[zn]),(dn=zn)<20?1518500249:dn<40?1859775393:dn<60?-1894007588:-899497514));an=Kt,Kt=Qt,Qt=Hn(Bn,30),Bn=Zt,Zt=cr}Zt=nn(Zt,Xn),Bn=nn(Bn,rr),Qt=nn(Qt,vr),Kt=nn(Kt,Wn),an=nn(an,ir)}return Array(Zt,Bn,Qt,Kt,an)}function nn(tn,Xt){var dn=(65535&tn)+(65535&Xt);return(tn>>16)+(Xt>>16)+(dn>>16)<<16|65535&dn}function Hn(tn,Xt){return tn<<Xt|tn>>>32-Xt}_.exports=function(tn){return ln.hash(tn,Pn,20,!0)}}).call(this,_e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(_e,_,dt){(function(vt,Et,Pt,Ut,Ft,Yt,hn,_n,pn){function ln(tn,Xt){var dn=(65535&tn)+(65535&Xt);return(tn>>16)+(Xt>>16)+(dn>>16)<<16|65535&dn}function Pn(tn,Xt){return tn>>>Xt|tn<<32-Xt}function nn(tn,Xt){var dn,Nn,An,kn,jt,Wt,Zt,Bn,Qt,Kt,an=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),yn=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),Xn=new Array(64);tn[Xt>>5]|=128<<24-Xt%32,tn[15+(Xt+64>>9<<4)]=Xt;for(var rr,vr,Wn,ir,zn,cr,ur,Sr,_i=0;_i<tn.length;_i+=16){dn=yn[0],Nn=yn[1],An=yn[2],kn=yn[3],jt=yn[4],Wt=yn[5],Zt=yn[6],Bn=yn[7];for(var rn=0;rn<64;rn++)Xn[rn]=rn<16?tn[rn+_i]:ln(ln(ln(Pn(Sr=Xn[rn-2],17)^Pn(Sr,19)^Sr>>>10,Xn[rn-7]),Pn(ur=Xn[rn-15],7)^Pn(ur,18)^ur>>>3),Xn[rn-16]),Qt=ln(ln(ln(ln(Bn,Pn(cr=jt,6)^Pn(cr,11)^Pn(cr,25)),(zn=jt)&Wt^~zn&Zt),an[rn]),Xn[rn]),Kt=ln(Pn(ir=dn,2)^Pn(ir,13)^Pn(ir,22),(rr=dn)&(vr=Nn)^rr&(Wn=An)^vr&Wn),Bn=Zt,Zt=Wt,Wt=jt,jt=ln(kn,Qt),kn=An,An=Nn,Nn=dn,dn=ln(Qt,Kt);yn[0]=ln(dn,yn[0]),yn[1]=ln(Nn,yn[1]),yn[2]=ln(An,yn[2]),yn[3]=ln(kn,yn[3]),yn[4]=ln(jt,yn[4]),yn[5]=ln(Wt,yn[5]),yn[6]=ln(Zt,yn[6]),yn[7]=ln(Bn,yn[7])}return yn}var Hn=_e("./helpers");_.exports=function(tn){return Hn.hash(tn,nn,32,!0)}}).call(this,_e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(_e,_,dt){(function(vt,Et,Pt,Ut,Ft,Yt,hn,_n,pn){function ln(){}(vt=_.exports={}).nextTick=function(){var Pn=typeof window<"u"&&window.setImmediate,nn=typeof window<"u"&&window.postMessage&&window.addEventListener;if(Pn)return function(tn){return window.setImmediate(tn)};if(nn){var Hn=[];return window.addEventListener("message",function(tn){var Xt=tn.source;Xt!==window&&Xt!==null||tn.data!=="process-tick"||(tn.stopPropagation(),0<Hn.length&&Hn.shift()())},!0),function(tn){Hn.push(tn),window.postMessage("process-tick","*")}}return function(tn){setTimeout(tn,0)}}(),vt.title="browser",vt.browser=!0,vt.env={},vt.argv=[],vt.on=ln,vt.addListener=ln,vt.once=ln,vt.off=ln,vt.removeListener=ln,vt.removeAllListeners=ln,vt.emit=ln,vt.binding=function(Pn){throw new Error("process.binding is not supported")},vt.cwd=function(){return"/"},vt.chdir=function(Pn){throw new Error("process.chdir is not supported")}}).call(this,_e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(_e,_,dt){(function(vt,Et,Pt,Ut,Ft,Yt,hn,_n,pn){dt.read=function(ln,Pn,nn,Hn,tn){var Xt,dn,Nn=8*tn-Hn-1,An=(1<<Nn)-1,kn=An>>1,jt=-7,Wt=nn?tn-1:0,Zt=nn?-1:1,Bn=ln[Pn+Wt];for(Wt+=Zt,Xt=Bn&(1<<-jt)-1,Bn>>=-jt,jt+=Nn;0<jt;Xt=256*Xt+ln[Pn+Wt],Wt+=Zt,jt-=8);for(dn=Xt&(1<<-jt)-1,Xt>>=-jt,jt+=Hn;0<jt;dn=256*dn+ln[Pn+Wt],Wt+=Zt,jt-=8);if(Xt===0)Xt=1-kn;else{if(Xt===An)return dn?NaN:1/0*(Bn?-1:1);dn+=Math.pow(2,Hn),Xt-=kn}return(Bn?-1:1)*dn*Math.pow(2,Xt-Hn)},dt.write=function(ln,Pn,nn,Hn,tn,Xt){var dn,Nn,An,kn=8*Xt-tn-1,jt=(1<<kn)-1,Wt=jt>>1,Zt=tn===23?Math.pow(2,-24)-Math.pow(2,-77):0,Bn=Hn?0:Xt-1,Qt=Hn?1:-1,Kt=Pn<0||Pn===0&&1/Pn<0?1:0;for(Pn=Math.abs(Pn),isNaN(Pn)||Pn===1/0?(Nn=isNaN(Pn)?1:0,dn=jt):(dn=Math.floor(Math.log(Pn)/Math.LN2),Pn*(An=Math.pow(2,-dn))<1&&(dn--,An*=2),2<=(Pn+=1<=dn+Wt?Zt/An:Zt*Math.pow(2,1-Wt))*An&&(dn++,An/=2),jt<=dn+Wt?(Nn=0,dn=jt):1<=dn+Wt?(Nn=(Pn*An-1)*Math.pow(2,tn),dn+=Wt):(Nn=Pn*Math.pow(2,Wt-1)*Math.pow(2,tn),dn=0));8<=tn;ln[nn+Bn]=255&Nn,Bn+=Qt,Nn/=256,tn-=8);for(dn=dn<<tn|Nn,kn+=tn;0<kn;ln[nn+Bn]=255&dn,Bn+=Qt,dn/=256,kn-=8);ln[nn+Bn-Qt]|=128*Kt}}).call(this,_e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function($){var _e=function(){function _(nn){return hn(nn,_n(Yt(pn(nn.length),nn),1/nn.length))}function dt(nn){return Yt(ln(nn),nn)}function vt(nn,Hn){return _n(nn,Hn?1/(nn.length-1):1/nn.length)}function Et(nn){var Hn=function(Xt){var dn,Nn=Math.pow(2,-52),An=1e-64/Nn,kn=0,jt=0,Wt=0,Zt=0,Bn=0,Qt=Pn(Xt),Kt=Qt.length,an=Qt[0].length;if(Kt<an)throw"Need more rows than columns";var yn=new Array(an),Xn=new Array(an);for(jt=0;jt<an;jt++)yn[jt]=Xn[jt]=0;var rr=function jr(hr,Kr,Js){Js===void 0&&(Js=0);var fo,no=hr[Js],ba=Array(no);if(Js===hr.length-1){for(fo=no-2;fo>=0;fo-=2)ba[fo+1]=Kr,ba[fo]=Kr;return fo===-1&&(ba[0]=Kr),ba}for(fo=no-1;fo>=0;fo--)ba[fo]=jr(hr,Kr,Js+1);return ba}([an,an],0);function vr(jr,hr){return(jr=Math.abs(jr))>(hr=Math.abs(hr))?jr*Math.sqrt(1+hr*hr/jr/jr):hr==0?jr:hr*Math.sqrt(1+jr*jr/hr/hr)}var Wn=0,ir=0,zn=0,cr=0,ur=0,Sr=0,_i=0;for(jt=0;jt<an;jt++){for(yn[jt]=ir,_i=0,Bn=jt+1,Wt=jt;Wt<Kt;Wt++)_i+=Qt[Wt][jt]*Qt[Wt][jt];if(_i<=An)ir=0;else for(Wn=Qt[jt][jt],ir=Math.sqrt(_i),Wn>=0&&(ir=-ir),zn=Wn*ir-_i,Qt[jt][jt]=Wn-ir,Wt=Bn;Wt<an;Wt++){for(_i=0,Zt=jt;Zt<Kt;Zt++)_i+=Qt[Zt][jt]*Qt[Zt][Wt];for(Wn=_i/zn,Zt=jt;Zt<Kt;Zt++)Qt[Zt][Wt]+=Wn*Qt[Zt][jt]}for(Xn[jt]=ir,_i=0,Wt=Bn;Wt<an;Wt++)_i+=Qt[jt][Wt]*Qt[jt][Wt];if(_i<=An)ir=0;else{for(Wn=Qt[jt][jt+1],ir=Math.sqrt(_i),Wn>=0&&(ir=-ir),zn=Wn*ir-_i,Qt[jt][jt+1]=Wn-ir,Wt=Bn;Wt<an;Wt++)yn[Wt]=Qt[jt][Wt]/zn;for(Wt=Bn;Wt<Kt;Wt++){for(_i=0,Zt=Bn;Zt<an;Zt++)_i+=Qt[Wt][Zt]*Qt[jt][Zt];for(Zt=Bn;Zt<an;Zt++)Qt[Wt][Zt]+=_i*yn[Zt]}}(ur=Math.abs(Xn[jt])+Math.abs(yn[jt]))>cr&&(cr=ur)}for(jt=an-1;jt!=-1;jt+=-1){if(ir!=0){for(zn=ir*Qt[jt][jt+1],Wt=Bn;Wt<an;Wt++)rr[Wt][jt]=Qt[jt][Wt]/zn;for(Wt=Bn;Wt<an;Wt++){for(_i=0,Zt=Bn;Zt<an;Zt++)_i+=Qt[jt][Zt]*rr[Zt][Wt];for(Zt=Bn;Zt<an;Zt++)rr[Zt][Wt]+=_i*rr[Zt][jt]}}for(Wt=Bn;Wt<an;Wt++)rr[jt][Wt]=0,rr[Wt][jt]=0;rr[jt][jt]=1,ir=yn[jt],Bn=jt}for(jt=an-1;jt!=-1;jt+=-1){for(Bn=jt+1,ir=Xn[jt],Wt=Bn;Wt<an;Wt++)Qt[jt][Wt]=0;if(ir!=0){for(zn=Qt[jt][jt]*ir,Wt=Bn;Wt<an;Wt++){for(_i=0,Zt=Bn;Zt<Kt;Zt++)_i+=Qt[Zt][jt]*Qt[Zt][Wt];for(Wn=_i/zn,Zt=jt;Zt<Kt;Zt++)Qt[Zt][Wt]+=Wn*Qt[Zt][jt]}for(Wt=jt;Wt<Kt;Wt++)Qt[Wt][jt]=Qt[Wt][jt]/ir}else for(Wt=jt;Wt<Kt;Wt++)Qt[Wt][jt]=0;Qt[jt][jt]+=1}for(Nn*=cr,Zt=an-1;Zt!=-1;Zt+=-1)for(var rn=0;rn<50;rn++){var Dn=!1;for(Bn=Zt;Bn!=-1;Bn+=-1){if(Math.abs(yn[Bn])<=Nn){Dn=!0;break}if(Math.abs(Xn[Bn-1])<=Nn)break}if(!Dn){kn=0,_i=1;var Qn=Bn-1;for(jt=Bn;jt<Zt+1&&(Wn=_i*yn[jt],yn[jt]=kn*yn[jt],!(Math.abs(Wn)<=Nn));jt++)for(zn=vr(Wn,ir=Xn[jt]),Xn[jt]=zn,kn=ir/zn,_i=-Wn/zn,Wt=0;Wt<Kt;Wt++)ur=Qt[Wt][Qn],Sr=Qt[Wt][jt],Qt[Wt][Qn]=ur*kn+Sr*_i,Qt[Wt][jt]=-ur*_i+Sr*kn}if(Sr=Xn[Zt],Bn==Zt){if(Sr<0)for(Xn[Zt]=-Sr,Wt=0;Wt<an;Wt++)rr[Wt][Zt]=-rr[Wt][Zt];break}if(rn>=49)throw"Error: no convergence.";for(cr=Xn[Bn],ir=vr(Wn=(((ur=Xn[Zt-1])-Sr)*(ur+Sr)+((ir=yn[Zt-1])-(zn=yn[Zt]))*(ir+zn))/(2*zn*ur),1),Wn=Wn<0?((cr-Sr)*(cr+Sr)+zn*(ur/(Wn-ir)-zn))/cr:((cr-Sr)*(cr+Sr)+zn*(ur/(Wn+ir)-zn))/cr,kn=1,_i=1,jt=Bn+1;jt<Zt+1;jt++){for(ir=yn[jt],ur=Xn[jt],zn=_i*ir,ir*=kn,Sr=vr(Wn,zn),yn[jt-1]=Sr,Wn=cr*(kn=Wn/Sr)+ir*(_i=zn/Sr),ir=-cr*_i+ir*kn,zn=ur*_i,ur*=kn,Wt=0;Wt<an;Wt++)cr=rr[Wt][jt-1],Sr=rr[Wt][jt],rr[Wt][jt-1]=cr*kn+Sr*_i,rr[Wt][jt]=-cr*_i+Sr*kn;for(Sr=vr(Wn,zn),Xn[jt-1]=Sr,Wn=(kn=Wn/Sr)*ir+(_i=zn/Sr)*ur,cr=-_i*ir+kn*ur,Wt=0;Wt<Kt;Wt++)ur=Qt[Wt][jt-1],Sr=Qt[Wt][jt],Qt[Wt][jt-1]=ur*kn+Sr*_i,Qt[Wt][jt]=-ur*_i+Sr*kn}yn[Bn]=0,yn[Zt]=Wn,Xn[Zt]=cr}for(jt=0;jt<Xn.length;jt++)Xn[jt]<Nn&&(Xn[jt]=0);for(jt=0;jt<an;jt++)for(Wt=jt-1;Wt>=0;Wt--)if(Xn[Wt]<Xn[jt]){for(kn=Xn[Wt],Xn[Wt]=Xn[jt],Xn[jt]=kn,Zt=0;Zt<Qt.length;Zt++)dn=Qt[Zt][jt],Qt[Zt][jt]=Qt[Zt][Wt],Qt[Zt][Wt]=dn;for(Zt=0;Zt<rr.length;Zt++)dn=rr[Zt][jt],rr[Zt][jt]=rr[Zt][Wt],rr[Zt][Wt]=dn;jt=Wt}return{U:Qt,S:Xn,V:rr}}(nn);console.log(Hn);var tn=Hn.U;return Hn.S.map(function(Xt,dn){var Nn={};return Nn.eigenvalue=Xt,Nn.vector=tn.map(function(An,kn){return-1*An[dn]}),Nn})}function Pt(nn,...Hn){var tn=Hn.map(function(Nn){return Nn.vector}),Xt=Yt(tn,ln(_(nn))),dn=_n(Yt(pn(nn.length),nn),-1/nn.length);return{adjustedData:Xt,formattedAdjustedData:Ft(Xt,2),avgData:dn,selectedVectors:tn}}function Ut(nn){return Et(vt(dt(_(nn)),!1))}function Ft(nn,Hn){var tn=Math.pow(10,Hn||2);return nn.map(function(Xt,dn){return Xt.map(function(Nn){return Math.round(Nn*tn)/tn})})}function Yt(nn,Hn){if(!(nn[0]&&Hn[0]&&nn.length&&Hn.length))throw new Error("Both A and B should be matrices");if(Hn.length!==nn[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var tn=[],Xt=0;Xt<nn.length;Xt++){tn[Xt]=[];for(var dn=0;dn<Hn[0].length;dn++)for(var Nn=0;Nn<nn[0].length;Nn++)tn[Xt][dn]=tn[Xt][dn]?tn[Xt][dn]+nn[Xt][Nn]*Hn[Nn][dn]:nn[Xt][Nn]*Hn[Nn][dn]}return tn}function hn(nn,Hn){if(nn.length!==Hn.length||nn[0].length!==Hn[0].length)throw new Error("Both A and B should have the same dimensions");for(var tn=[],Xt=0;Xt<nn.length;Xt++){tn[Xt]=[];for(var dn=0;dn<Hn[0].length;dn++)tn[Xt][dn]=nn[Xt][dn]-Hn[Xt][dn]}return tn}function _n(nn,Hn){for(var tn=[],Xt=0;Xt<nn.length;Xt++){tn[Xt]=[];for(var dn=0;dn<nn[0].length;dn++)tn[Xt][dn]=nn[Xt][dn]*Hn}return tn}function pn(nn){for(var Hn=[],tn=0;tn<nn;tn++){Hn[tn]=[];for(var Xt=0;Xt<nn;Xt++)Hn[tn][Xt]=1}return Hn}function ln(nn){return Pn(nn)[0].map(function(Hn,tn){return nn.map(function(Xt){return Xt[tn]})})}function Pn(nn){var Hn=JSON.stringify(nn);return JSON.parse(Hn)}return{computeDeviationScores:dt,computeDeviationMatrix:_,computeSVD:Et,computePercentageExplained:function(nn,...Hn){var tn=nn.map(function(Xt){return Xt.eigenvalue}).reduce(function(Xt,dn){return Xt+dn});return Hn.map(function(Xt){return Xt.eigenvalue}).reduce(function(Xt,dn){return Xt+dn})/tn},computeOriginalData:function(nn,Hn,tn){var Xt=hn(ln(Yt(ln(Hn),nn)),tn);return{originalData:Xt,formattedOriginalData:Ft(Xt,2)}},computeVarianceCovariance:vt,computeAdjustedData:Pt,getEigenVectors:Ut,analyseTopResult:function(nn){var Hn=Ut(nn).sort(function(tn,Xt){return Xt.eigenvalue-tn.eigenvalue});return console.log("Sorted Vectors",Hn),Pt(nn,Hn[0].vector)},transpose:ln,multiply:Yt,clone:Pn,scale:_n}}();$.exports=_e},701:function($){var _e=[];function _(Et){for(var Pt=-1,Ut=0;Ut<_e.length;Ut++)if(_e[Ut].identifier===Et){Pt=Ut;break}return Pt}function dt(Et,Pt){for(var Ut={},Ft=[],Yt=0;Yt<Et.length;Yt++){var hn=Et[Yt],_n=Pt.base?hn[0]+Pt.base:hn[0],pn=Ut[_n]||0,ln="".concat(_n," ").concat(pn);Ut[_n]=pn+1;var Pn=_(ln),nn={css:hn[1],media:hn[2],sourceMap:hn[3],supports:hn[4],layer:hn[5]};if(Pn!==-1)_e[Pn].references++,_e[Pn].updater(nn);else{var Hn=vt(nn,Pt);Pt.byIndex=Yt,_e.splice(Yt,0,{identifier:ln,updater:Hn,references:1})}Ft.push(ln)}return Ft}function vt(Et,Pt){var Ut=Pt.domAPI(Pt);return Ut.update(Et),function(Ft){if(Ft){if(Ft.css===Et.css&&Ft.media===Et.media&&Ft.sourceMap===Et.sourceMap&&Ft.supports===Et.supports&&Ft.layer===Et.layer)return;Ut.update(Et=Ft)}else Ut.remove()}}$.exports=function(Et,Pt){var Ut=dt(Et=Et||[],Pt=Pt||{});return function(Ft){Ft=Ft||[];for(var Yt=0;Yt<Ut.length;Yt++){var hn=_(Ut[Yt]);_e[hn].references--}for(var _n=dt(Ft,Pt),pn=0;pn<Ut.length;pn++){var ln=_(Ut[pn]);_e[ln].references===0&&(_e[ln].updater(),_e.splice(ln,1))}Ut=_n}}},182:function($){$.exports=function(_e){var _=document.createElement("style");return _e.setAttributes(_,_e.attributes),_e.insert(_,_e.options),_}},850:function($,_e,_){$.exports=function(dt){var vt=_.nc;vt&&dt.setAttribute("nonce",vt)}},236:function($){$.exports=function(_e){var _=_e.insertStyleElement(_e);return{update:function(dt){(function(vt,Et,Pt){var Ut="";Pt.supports&&(Ut+="@supports (".concat(Pt.supports,") {")),Pt.media&&(Ut+="@media ".concat(Pt.media," {"));var Ft=Pt.layer!==void 0;Ft&&(Ut+="@layer".concat(Pt.layer.length>0?" ".concat(Pt.layer):""," {")),Ut+=Pt.css,Ft&&(Ut+="}"),Pt.media&&(Ut+="}"),Pt.supports&&(Ut+="}");var Yt=Pt.sourceMap;Yt&&typeof btoa<"u"&&(Ut+=`
/`,Ut+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(Yt))))," *"),Ut+="/"),Et.styleTagTransform(Ut,vt,Et.options)})(_,_e,dt)},remove:function(){(function(dt){if(dt.parentNode===null)return!1;dt.parentNode.removeChild(dt)})(_)}}}},213:function($){$.exports=function(_e,_){if(_.styleSheet)_.styleSheet.cssText=_e;else{for(;_.firstChild;)_.removeChild(_.firstChild);_.appendChild(document.createTextNode(_e))}}},1:function($){$.exports=function(){var _e={820:function(Et,Pt,Ut){var Ft=Ut(537),Yt=Ut.n(Ft),hn=Ut(645),_n=Ut.n(hn)()(Yt());_n.push([Et.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),Pt.Z=_n},645:function(Et){Et.exports=function(Pt){var Ut=[];return Ut.toString=function(){return this.map(function(Ft){var Yt="",hn=Ft[5]!==void 0;return Ft[4]&&(Yt+="@supports (".concat(Ft[4],") {")),Ft[2]&&(Yt+="@media ".concat(Ft[2]," {")),hn&&(Yt+="@layer".concat(Ft[5].length>0?" ".concat(Ft[5]):""," {")),Yt+=Pt(Ft),hn&&(Yt+="}"),Ft[2]&&(Yt+="}"),Ft[4]&&(Yt+="}"),Yt}).join("")},Ut.i=function(Ft,Yt,hn,_n,pn){typeof Ft=="string"&&(Ft=[[null,Ft,void 0]]);var ln={};if(hn)for(var Pn=0;Pn<this.length;Pn++){var nn=this[Pn][0];nn!=null&&(ln[nn]=!0)}for(var Hn=0;Hn<Ft.length;Hn++){var tn=[].concat(Ft[Hn]);hn&&ln[tn[0]]||(pn!==void 0&&(tn[5]===void 0||(tn[1]="@layer".concat(tn[5].length>0?" ".concat(tn[5]):""," {").concat(tn[1],"}")),tn[5]=pn),Yt&&(tn[2]&&(tn[1]="@media ".concat(tn[2]," {").concat(tn[1],"}")),tn[2]=Yt),_n&&(tn[4]?(tn[1]="@supports (".concat(tn[4],") {").concat(tn[1],"}"),tn[4]=_n):tn[4]="".concat(_n)),Ut.push(tn))}},Ut}},537:function(Et){Et.exports=function(Pt){var Ut=Pt[1],Ft=Pt[3];if(!Ft)return Ut;if(typeof btoa=="function"){var Yt=btoa(unescape(encodeURIComponent(JSON.stringify(Ft)))),hn="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(Yt),_n="/*# ".concat(hn," */"),pn=Ft.sources.map(function(ln){return"/*# sourceURL=".concat(Ft.sourceRoot||"").concat(ln," */")});return[Ut].concat(pn).concat([_n]).join(`
`)}return[Ut].join(`
`)}},379:function(Et){var Pt=[];function Ut(hn){for(var _n=-1,pn=0;pn<Pt.length;pn++)if(Pt[pn].identifier===hn){_n=pn;break}return _n}function Ft(hn,_n){for(var pn={},ln=[],Pn=0;Pn<hn.length;Pn++){var nn=hn[Pn],Hn=_n.base?nn[0]+_n.base:nn[0],tn=pn[Hn]||0,Xt="".concat(Hn," ").concat(tn);pn[Hn]=tn+1;var dn=Ut(Xt),Nn={css:nn[1],media:nn[2],sourceMap:nn[3],supports:nn[4],layer:nn[5]};if(dn!==-1)Pt[dn].references++,Pt[dn].updater(Nn);else{var An=Yt(Nn,_n);_n.byIndex=Pn,Pt.splice(Pn,0,{identifier:Xt,updater:An,references:1})}ln.push(Xt)}return ln}function Yt(hn,_n){var pn=_n.domAPI(_n);return pn.update(hn),function(ln){if(ln){if(ln.css===hn.css&&ln.media===hn.media&&ln.sourceMap===hn.sourceMap&&ln.supports===hn.supports&&ln.layer===hn.layer)return;pn.update(hn=ln)}else pn.remove()}}Et.exports=function(hn,_n){var pn=Ft(hn=hn||[],_n=_n||{});return function(ln){ln=ln||[];for(var Pn=0;Pn<pn.length;Pn++){var nn=Ut(pn[Pn]);Pt[nn].references--}for(var Hn=Ft(ln,_n),tn=0;tn<pn.length;tn++){var Xt=Ut(pn[tn]);Pt[Xt].references===0&&(Pt[Xt].updater(),Pt.splice(Xt,1))}pn=Hn}}},216:function(Et){Et.exports=function(Pt){var Ut=document.createElement("style");return Pt.setAttributes(Ut,Pt.attributes),Pt.insert(Ut,Pt.options),Ut}},636:function(Et,Pt,Ut){Et.exports=function(Ft){var Yt=Ut.nc;Yt&&Ft.setAttribute("nonce",Yt)}},795:function(Et){Et.exports=function(Pt){var Ut=Pt.insertStyleElement(Pt);return{update:function(Ft){(function(Yt,hn,_n){var pn="";_n.supports&&(pn+="@supports (".concat(_n.supports,") {")),_n.media&&(pn+="@media ".concat(_n.media," {"));var ln=_n.layer!==void 0;ln&&(pn+="@layer".concat(_n.layer.length>0?" ".concat(_n.layer):""," {")),pn+=_n.css,ln&&(pn+="}"),_n.media&&(pn+="}"),_n.supports&&(pn+="}");var Pn=_n.sourceMap;Pn&&typeof btoa<"u"&&(pn+=`
/`,pn+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(Pn))))," *"),pn+="/"),hn.styleTagTransform(pn,Yt,hn.options)})(Ut,Pt,Ft)},remove:function(){(function(Ft){if(Ft.parentNode===null)return!1;Ft.parentNode.removeChild(Ft)})(Ut)}}}},589:function(Et){Et.exports=function(Pt,Ut){if(Ut.styleSheet)Ut.styleSheet.cssText=Pt;else{for(;Ut.firstChild;)Ut.removeChild(Ut.firstChild);Ut.appendChild(document.createTextNode(Pt))}}}},_={};function dt(Et){var Pt=_[Et];if(Pt!==void 0)return Pt.exports;var Ut=_[Et]={id:Et,exports:{}};return _e[Et](Ut,Ut.exports,dt),Ut.exports}dt.n=function(Et){var Pt=Et&&Et.__esModule?function(){return Et.default}:function(){return Et};return dt.d(Pt,{a:Pt}),Pt},dt.d=function(Et,Pt){for(var Ut in Pt)dt.o(Pt,Ut)&&!dt.o(Et,Ut)&&Object.defineProperty(Et,Ut,{enumerable:!0,get:Pt[Ut]})},dt.o=function(Et,Pt){return Object.prototype.hasOwnProperty.call(Et,Pt)},dt.nc=void 0;var vt={};return function(){dt.d(vt,{default:function(){return Xn}});var Et=dt(379),Pt=dt.n(Et),Ut=dt(795),Ft=dt.n(Ut),Yt=dt(636),hn=dt.n(Yt),_n=dt(216),pn=dt.n(_n),ln=dt(589),Pn=dt.n(ln),nn=dt(820),Hn={};nn.Z&&nn.Z.locals&&(Hn.locals=nn.Z.locals);var tn,Xt=0,dn={};dn.styleTagTransform=Pn(),dn.setAttributes=hn(),dn.insert=function(rr,vr){(vr.target||document.head).appendChild(rr)},dn.domAPI=Ft(),dn.insertStyleElement=pn(),Hn.use=function(rr){return dn.options=rr||{},Xt++||(tn=Pt()(nn.Z,dn)),Hn},Hn.unuse=function(){Xt>0&&!--Xt&&(tn(),tn=null)};var Nn=Hn;function An(rr,vr){return function(Wn){if(Array.isArray(Wn))return Wn}(rr)||function(Wn,ir){var zn=Wn==null?null:typeof Symbol<"u"&&Wn[Symbol.iterator]||Wn["@@iterator"];if(zn!=null){var cr,ur,Sr=[],_i=!0,rn=!1;try{for(zn=zn.call(Wn);!(_i=(cr=zn.next()).done)&&(Sr.push(cr.value),!ir||Sr.length!==ir);_i=!0);}catch(Dn){rn=!0,ur=Dn}finally{try{_i||zn.return==null||zn.return()}finally{if(rn)throw ur}}return Sr}}(rr,vr)||function(Wn,ir){if(Wn){if(typeof Wn=="string")return kn(Wn,ir);var zn=Object.prototype.toString.call(Wn).slice(8,-1);return zn==="Object"&&Wn.constructor&&(zn=Wn.constructor.name),zn==="Map"||zn==="Set"?Array.from(Wn):zn==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(zn)?kn(Wn,ir):void 0}}(rr,vr)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function kn(rr,vr){(vr==null||vr>rr.length)&&(vr=rr.length);for(var Wn=0,ir=new Array(vr);Wn<vr;Wn++)ir[Wn]=rr[Wn];return ir}function jt(rr,vr){var Wn=Object.keys(rr);if(Object.getOwnPropertySymbols){var ir=Object.getOwnPropertySymbols(rr);vr&&(ir=ir.filter(function(zn){return Object.getOwnPropertyDescriptor(rr,zn).enumerable})),Wn.push.apply(Wn,ir)}return Wn}function Wt(rr){for(var vr=1;vr<arguments.length;vr++){var Wn=arguments[vr]!=null?arguments[vr]:{};vr%2?jt(Object(Wn),!0).forEach(function(ir){Zt(rr,ir,Wn[ir])}):Object.getOwnPropertyDescriptors?Object.defineProperties(rr,Object.getOwnPropertyDescriptors(Wn)):jt(Object(Wn)).forEach(function(ir){Object.defineProperty(rr,ir,Object.getOwnPropertyDescriptor(Wn,ir))})}return rr}function Zt(rr,vr,Wn){return vr in rr?Object.defineProperty(rr,vr,{value:Wn,enumerable:!0,configurable:!0,writable:!0}):rr[vr]=Wn,rr}function Bn(rr,vr){for(var Wn=0;Wn<vr.length;Wn++){var ir=vr[Wn];ir.enumerable=ir.enumerable||!1,ir.configurable=!0,"value"in ir&&(ir.writable=!0),Object.defineProperty(rr,ir.key,ir)}}function Qt(rr){var vr={};return rr.reduce(function(Wn,ir){return vr[ir]||(vr[ir]=!0,Wn.push(ir)),Wn},[])}function Kt(rr,vr){requestAnimationFrame(function(){vr.enter(),requestAnimationFrame(function(){vr.active(),setTimeout(function(){vr.leave()},rr)})})}function an(rr,vr){try{var Wn=rr.liElementsById[vr.parent.id];Wn.classList.contains("treejs-node__close")||Wn.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(vr,"parent")&&an(rr,vr.parent)}function yn(rr,vr){var Wn=rr.liElementsById[vr.id];Wn.classList.contains("treejs-node__close")&&Wn.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(vr,"children")&&vr.children.forEach(function(ir){return yn(rr,ir)})}var Xn=function(){function rr(zn,cr){(function(ur,Sr){if(!(ur instanceof Sr))throw new TypeError("Cannot call a class as a function")})(this,rr),Nn.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=zn,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},cr),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(ur){this.setValues(Qt(ur))}},disables:{get:function(){return this.getDisables()},set:function(ur){this.setDisables(Qt(ur))}},selectedNodes:{get:function(){var ur=[],Sr=this.nodesById;return Object.keys(Sr).forEach(function(_i){if(Object.prototype.hasOwnProperty.call(Sr,_i)&&(Sr[_i].status===1||Sr[_i].status===2)){var rn=Wt({},Sr[_i]);delete rn.parent,delete rn.children,ur.push(rn)}}),ur}},disabledNodes:{get:function(){var ur=[],Sr=this.nodesById;return Object.keys(Sr).forEach(function(_i){if(Object.prototype.hasOwnProperty.call(Sr,_i)&&Sr[_i].disabled){var rn=Wt({},Sr[_i]);delete rn.parent,ur.push(rn)}}),ur}}}),this.init(this.options.data)}var vr,Wn,ir;return vr=rr,ir=[{key:"onSwitcherClick",value:function(zn){var cr=zn.parentNode,ur=cr.lastChild,Sr=ur.scrollHeight;cr.classList.contains("treejs-node__close")?Kt(150,{enter:function(){ur.style.height=0,ur.style.opacity=0},active:function(){ur.style.height="".concat(Sr,"px"),ur.style.opacity=1},leave:function(){ur.style.height="",ur.style.opacity="",cr.classList.remove("treejs-node__close")}}):Kt(150,{enter:function(){ur.style.height="".concat(Sr,"px"),ur.style.opacity=1},active:function(){ur.style.height=0,ur.style.opacity=0},leave:function(){ur.style.height="",ur.style.opacity="",cr.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(zn){var cr,ur=(cr=zn,JSON.parse(JSON.stringify(cr))),Sr={},_i={},rn=[],Dn=[];return function Qn(jr,hr){jr.forEach(function(Kr){Sr[Kr.id]=Kr,Kr.checked&&rn.push(Kr.id),Kr.disabled&&Dn.push(Kr.id),hr&&(Kr.parent=hr),Kr.children&&Kr.children.length?Qn(Kr.children,Kr):_i[Kr.id]=Kr})}(ur),{treeNodes:ur,nodesById:Sr,leafNodesById:_i,defaultValues:rn,defaultDisables:Dn}}},{key:"createRootEle",value:function(){var zn=document.createElement("div");return zn.classList.add("treejs"),zn}},{key:"createUlEle",value:function(){var zn=document.createElement("ul");return zn.classList.add("treejs-nodes"),zn}},{key:"createLiEle",value:function(zn,cr){var ur=document.createElement("li");if(ur.classList.add("treejs-node"),cr&&ur.classList.add("treejs-node__close"),zn.children&&zn.children.length){var Sr=document.createElement("span");Sr.classList.add("treejs-switcher"),ur.appendChild(Sr)}else ur.classList.add("treejs-placeholder");var _i=document.createElement("span");_i.classList.add("treejs-checkbox"),ur.appendChild(_i);var rn=document.createElement("span");rn.classList.add("treejs-label");var Dn=document.createTextNode(zn.text);return rn.appendChild(Dn),ur.appendChild(rn),ur.nodeId=zn.id,ur}}],(Wn=[{key:"init",value:function(zn){var cr=rr.parseTreeData(zn),ur=cr.treeNodes,Sr=cr.nodesById,_i=cr.leafNodesById,rn=cr.defaultValues,Dn=cr.defaultDisables;this.treeNodes=ur,this.nodesById=Sr,this.leafNodesById=_i,this.render(this.treeNodes);var Qn=this.options,jr=Qn.values,hr=Qn.disables,Kr=Qn.loaded;jr&&jr.length?this.setValues(jr):rn&&rn.length&&this.setValues(rn),hr&&hr.length?this.setDisables(hr):Dn&&Dn.length&&this.setDisables(Dn),typeof Kr=="function"&&Kr.call(this)}},{key:"render",value:function(zn){var cr=rr.createRootEle();cr.appendChild(this.buildTree(zn,0)),this.bindEvent(cr);var ur=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(Sr){for(;Sr.firstChild;)Sr.removeChild(Sr.firstChild)})(ur),ur.appendChild(cr)}},{key:"buildTree",value:function(zn,cr){var ur=this,Sr=rr.createUlEle();return zn&&zn.length&&zn.forEach(function(_i){var rn=rr.createLiEle(_i,cr===ur.options.closeDepth-1);ur.liElementsById[_i.id]=rn;var Dn=null;_i.children&&_i.children.length&&(Dn=ur.buildTree(_i.children,cr+1)),Dn&&rn.appendChild(Dn),Sr.appendChild(rn)}),Sr}},{key:"bindEvent",value:function(zn){var cr=this;zn.addEventListener("click",function(ur){var Sr=ur.target;Sr.nodeName==="SPAN"&&Sr.classList.contains("treejs-checkbox")?cr.onItemClick(Sr.parentNode.nodeId):Sr.nodeName==="SPAN"&&Sr.classList.contains("treejs-label")?cr.onItemLabelClick(Sr.parentNode.nodeId):Sr.nodeName==="LI"&&Sr.classList.contains("treejs-node")?cr.onItemClick(Sr.nodeId):Sr.nodeName==="SPAN"&&Sr.classList.contains("treejs-switcher")&&rr.onSwitcherClick(Sr)},!1)}},{key:"onItemClick",value:function(zn){var cr=this.nodesById[zn],ur=this.options.onChange;cr.disabled||(this.setValue(zn),this.updateLiElements()),ur&&ur.call(this)}},{key:"onItemLabelClick",value:function(zn){var cr=this.options.onItemLabelClick;cr&&cr.call(this,zn)}},{key:"setValue",value:function(zn){var cr=this.nodesById[zn];if(cr){var ur=cr.status,Sr=ur===1||ur===2?0:2;cr.status=Sr,this.markWillUpdateNode(cr),this.walkUp(cr,"status"),this.walkDown(cr,"status")}}},{key:"getValues",value:function(){var zn=this,cr=[];return Object.keys(this.leafNodesById).forEach(function(ur){Object.prototype.hasOwnProperty.call(zn.leafNodesById,ur)&&(zn.leafNodesById[ur].status!==1&&zn.leafNodesById[ur].status!==2||cr.push(ur))}),cr}},{key:"setValues",value:function(zn){var cr=this;this.emptyNodesCheckStatus(),zn.forEach(function(Sr){cr.setValue(Sr)}),this.updateLiElements();var ur=this.options.onChange;ur&&ur.call(this)}},{key:"setDisable",value:function(zn){var cr=this.nodesById[zn];cr&&(cr.disabled||(cr.disabled=!0,this.markWillUpdateNode(cr),this.walkUp(cr,"disabled"),this.walkDown(cr,"disabled")))}},{key:"getDisables",value:function(){var zn=this,cr=[];return Object.keys(this.leafNodesById).forEach(function(ur){Object.prototype.hasOwnProperty.call(zn.leafNodesById,ur)&&zn.leafNodesById[ur].disabled&&cr.push(ur)}),cr}},{key:"setDisables",value:function(zn){var cr=this;this.emptyNodesDisable(),zn.forEach(function(ur){cr.setDisable(ur)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(zn){zn.disabled||(zn.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(zn){zn.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(zn,cr){var ur=An(cr,2),Sr=ur[0],_i=ur[1];return _i.status!==1&&_i.status!==2||(zn[Sr]=_i),zn},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(zn,cr){var ur=An(cr,2),Sr=ur[0],_i=ur[1];return _i.disabled&&(zn[Sr]=_i),zn},{})}},{key:"updateLiElements",value:function(){var zn=this;Object.values(this.willUpdateNodesById).forEach(function(cr){zn.updateLiElement(cr)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(zn){this.willUpdateNodesById[zn.id]=zn}},{key:"walkUp",value:function(zn,cr){var ur=zn.parent;if(ur){if(cr==="status"){var Sr,_i=ur.children.reduce(function(Dn,Qn){return Number.isNaN(Qn.status)?Dn:Dn+Qn.status},0);if(Sr=_i?_i===2*ur.children.length?2:1:0,ur.status===Sr)return;ur.status=Sr}else{var rn=ur.children.reduce(function(Dn,Qn){return Dn&&Qn.disabled},!0);if(ur.disabled===rn)return;ur.disabled=rn}this.markWillUpdateNode(ur),this.walkUp(ur,cr)}}},{key:"walkDown",value:function(zn,cr){var ur=this;zn.children&&zn.children.length&&zn.children.forEach(function(Sr){cr==="status"&&Sr.disabled||(Sr[cr]=zn[cr],ur.markWillUpdateNode(Sr),ur.walkDown(Sr,cr))})}},{key:"updateLiElement",value:function(zn){var cr=this.liElementsById[zn.id].classList;switch(zn.status){case 0:cr.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:cr.remove("treejs-node__checked"),cr.add("treejs-node__halfchecked");break;case 2:cr.remove("treejs-node__halfchecked"),cr.add("treejs-node__checked")}switch(zn.disabled){case!0:cr.contains("treejs-node__disabled")||cr.add("treejs-node__disabled");break;case!1:cr.contains("treejs-node__disabled")&&cr.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var zn=this;Object.keys(this.leafNodesById).forEach(function(cr){var ur=zn.leafNodesById[cr];an(zn,ur)})}},{key:"expandAll",value:function(){yn(this,this.treeNodes[0])}}])&&Bn(vr.prototype,Wn),ir&&Bn(vr,ir),Object.defineProperty(vr,"prototype",{writable:!1}),rr}()}(),vt.default}()},8:function($,_e){(function(_){class dt{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(Kt,an){const yn=this._eventListeners;yn[Kt]===void 0&&(yn[Kt]=[]),yn[Kt].includes(an)||yn[Kt].push(an)}hasEventListener(Kt,an){const yn=this._eventListeners;return yn[Kt]!==void 0&&yn[Kt].includes(an)}removeEventListener(Kt,an){const yn=this._eventListeners[Kt];if(yn!==void 0){const Xn=yn.indexOf(an);Xn!==-1&&yn.splice(Xn,1)}}dispatchEvent(Kt){const an=this._eventListeners[Kt.type];if(an!==void 0){Kt.target=this;const yn=an.slice(0);for(let Xn=0,rr=yn.length;Xn<rr;Xn++)yn[Xn].call(this,Kt)}}}function vt(){return(typeof performance>"u"?Date:performance).now()}class Et{constructor(Kt=Et.DECAY_MILLISECONDS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(Kt)}setDecayTime(Kt){this.naturalFrequency=1/Math.max(Et.MIN_DECAY_MILLISECONDS,Kt)}update(Kt,an,yn,Xn){const rr=2e-4*this.naturalFrequency;if(Kt==null||Xn===0||Kt===an&&this.velocity===0)return an;if(yn<0)return Kt;const vr=Kt-an,Wn=this.velocity+this.naturalFrequency*vr,ir=vr+yn*Wn,zn=Math.exp(-this.naturalFrequency*yn),cr=(Wn-this.naturalFrequency*ir)*zn,ur=-this.naturalFrequency*(cr+Wn*zn);return Math.abs(cr)<rr*Math.abs(Xn)&&ur*vr>=0?(this.velocity=0,an):(this.velocity=cr,an+ir*zn)}}async function Pt(Qt){return new Promise((Kt,an)=>{const yn=new Image;yn.onload=()=>Kt(yn),yn.onerror=an,yn.crossOrigin="anonymous",yn.decoding="sync",yn.src=Qt})}function Ut(Qt,Kt=document.head){const an=document.createElement("style");return an.type="text/css",an.innerText=Qt,Kt==null||Kt.appendChild(an),an}Et.SETTLING_TIME=1e4,Et.MIN_DECAY_MILLISECONDS=.001,Et.DECAY_MILLISECONDS=50;const Ft={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Yt(Qt){return Qt.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function hn(Qt,Kt,an){return Qt.replace(new RegExp(Yt(Kt),"g"),an)}const _n=(Qt,...Kt)=>String.raw({raw:Qt},...Kt),pn=(Qt,...Kt)=>{let an=String.raw({raw:Qt},...Kt);return an=hn(an,"%","%25"),an=hn(an,"> <","><"),an=hn(an,"; }",";}"),an=hn(an,"<","%3c"),an=hn(an,">","%3e"),an=hn(an,'"',"'"),an=hn(an,"#","%23"),an=hn(an,"{","%7b"),an=hn(an,"}","%7d"),an=hn(an,"|","%7c"),an=hn(an,"^","%5e"),an=hn(an,"`","%60"),an=hn(an,"@","%40"),an=hn(an,"&","&amp;"),an=hn(an,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+an};function ln(Qt,Kt){const an=window.URL.createObjectURL(Qt),yn=document.createElement("a");yn.style.display="none",yn.href=an,yn.download=Kt,document.body.appendChild(yn),yn.click(),setTimeout(()=>{document.body.removeChild(yn),window.URL.revokeObjectURL(an)},1e3)}async function Pn(Qt){return new Promise((Kt,an)=>{const yn=new FileReader;yn.onload=Xn=>Kt(yn.result),yn.onerror=Xn=>an(yn.error),yn.onabort=Xn=>an(new Error("Read aborted")),yn.readAsDataURL(Qt)})}function nn(Qt,Kt){let an;do an=Object.getOwnPropertyDescriptor(Qt,Kt);while(!an&&(Qt=Object.getPrototypeOf(Qt)));return an}function Hn(Qt,Kt,an=!0,yn=!1){const Xn=nn(Qt,Kt);return!!(Xn!=null&&Xn.set)||an&&(Xn==null?void 0:Xn.writable)!==!1&&(Xn==null?void 0:Xn.get)===void 0||yn&&!Xn}function tn(Qt,Kt,an,yn=!0,Xn=!1){return!(!Qt||!Hn(Qt,Kt,yn,Xn)||(Qt[Kt]=an,0))}function Xt(Qt,Kt){for(let an=Qt.length-1;an>=0;an--)if(Kt(Qt[an]))return an;return-1}const dn={priority:1/0,serialize:(Qt,Kt)=>Object.fromEntries(Object.entries(Qt).map(([an,yn])=>[an,Nn.Serialize(yn,Kt,!1)])),deserialize:(Qt,Kt,an)=>Object.assign(Kt||{},Object.fromEntries(Object.entries(Qt).map(([yn,Xn])=>[yn,Nn.Deserialize(Xn,Kt==null?void 0:Kt[yn],an,!1)]))),isType:Qt=>(Qt.constructor||Object)===Object};class Nn{static GetSerializer(Kt){return Nn.Serializers.find(an=>an.isType(Kt))}static RegisterSerializer(...Kt){var an;for(const yn of Kt){const Xn=(an=yn.priority)!==null&&an!==void 0?an:1e10,rr=Xt(Nn.Serializers,vr=>vr.priority!==void 0&&vr.priority<Xn);rr>=0?Nn.Serializers.splice(rr+1,0,yn):Nn.Serializers.push(yn)}}static UnregisterSerializer(...Kt){for(const an of Kt){const yn=Nn.Serializers.indexOf(an);yn>=0&&Nn.Serializers.splice(yn,1)}}static Serialize(Kt,an,yn=!1){var Xn,rr;if(typeof Kt=="function")return;if(!yn){const ir=Nn.GetSerializer(Kt);if(ir)return ir.serialize(Kt,an);if(typeof Kt.toJSON=="function"){const zn=Kt.toJSON(an);return Kt.serializableClassId&&zn&&(zn.serializableClassId=Kt.serializableClassId),zn}}let vr=(Xn=Kt.constructor)!==null&&Xn!==void 0?Xn:Object;const Wn={};for(;vr&&vr!==Object;){const ir=(rr=Nn.TypeMap.get(vr))!==null&&rr!==void 0?rr:[];for(const[zn,cr]of ir)Wn[zn]=Nn.Serialize(Kt[cr],an,!1);vr=Object.getPrototypeOf(vr)}return Kt.serializableClassId&&(Wn.serializableClassId=Kt.serializableClassId),Wn}static Deserialize(Kt,an,yn,Xn=!1){var rr,vr;if(Kt===void 0||an===Kt)return an;if(Kt&&typeof Kt=="object"&&(Kt.constructor||Object)===Object&&Kt.resource&&typeof Kt.resource=="string"&&Kt.uuid){const ir=yn==null?void 0:yn[Kt.resource];if(!ir)return console.warn(`Resource ${Kt.resource} not found`),an;if(typeof(Kt=ir[Kt.uuid])=="object"&&(Kt.__useCount=Kt.__useCount?Kt.__useCount+1:1),Kt||console.warn(`Resource ${Kt.resource} with uuid ${Kt.uuid} not found`),an===Kt)return an;if(Kt&&typeof Kt=="object"){if((Kt.constructor||Object)!==Object)return an&&console.warn("replacing object",an,"with deserialized object from meta",Kt),Kt;console.error("Deserialize; meta should only have class instances, not js objects",Kt,an,yn)}}if(Kt&&typeof Kt=="object"&&(Kt.constructor||Object)!==Object&&!Array.isArray(Kt)&&console.warn("Data might already be deserialized. It will be cloned, or copied to source",Kt,"source",an,Kt.constructor,Kt.constructor!==Object),Kt&&typeof Kt=="object")if(!Kt.serializableClassId||an&&an.serializableClassId===Kt.serializableClassId)(Kt.constructor||Object)!==Object||an?Array.isArray(Kt)&&!an&&(an=[]):an={};else{const ir=Nn.SerializableClasses.get(Kt.serializableClassId);ir&&(an=ir.DataInConstructor?new ir(Kt):new ir)}if(typeof an=="function")return console.error("cannot deserialize over function",an,Kt),an;if(!Xn){const ir=Nn.GetSerializer(Kt);if(ir&&ir!==dn)return ir.deserialize(Kt,an,yn)}if(!Kt||an==null||typeof an!="object")return Kt;if(!Xn&&typeof(an==null?void 0:an.fromJSON)=="function")return an.fromJSON(Kt,yn),an;let Wn=(rr=an.constructor)!==null&&rr!==void 0?rr:Object;if(Wn===Object)return dn.deserialize(Kt,an,yn);for(;Wn&&Wn!==Object;){const ir=(vr=Nn.TypeMap.get(Wn))!==null&&vr!==void 0?vr:[];for(const[zn,cr]of ir){const ur=an[cr],Sr=Nn.Deserialize(Kt[zn],ur,yn,!1);Sr!==ur&&tn(an,cr,Sr,!0)}Wn=Object.getPrototypeOf(Wn)}return an}}function An(Qt,Kt="param"){if(!Qt)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(an,yn)=>{Object.defineProperty(an,yn,{get(){return this[`_oc_${yn}`]},set(Xn){var rr;const vr=this[`_oc_${yn}`];if(vr===Xn)return;this[`_oc_${yn}`]=Xn;const Wn=Kt==="param"?[yn,Xn,vr]:Kt==="object"?[{key:yn,value:Xn,oldValue:vr}]:"";if(typeof Qt=="string")(rr=this[Qt])===null||rr===void 0||rr.call(this,...Wn);else if(typeof Qt=="function"){let ir=!1;if(Qt.name){let zn=this;for(;zn;){if(zn[Qt.name]===Qt){Qt.call(this,...Wn),ir=!0;break}zn=Object.getPrototypeOf(zn)}}ir||(Qt.name&&this[Qt.name].name===`bound ${Qt.name}`?this[Qt.name](...Wn):Qt(...Wn))}}})}}function kn(Qt,{backgroundColor:Kt="",scale:an=1,width:yn=512,height:Xn=512}){const rr=document.createElement("canvas"),vr=rr.getContext("2d"),Wn=an,ir=yn,zn=Xn;return rr.width=ir*Wn,rr.height=zn*Wn,rr.style.width=`${ir}`,rr.style.height=`${zn}`,(Kt==null?void 0:Kt.length)>0&&(vr.fillStyle=Kt,vr.fillRect(0,0,rr.width,rr.height)),vr.drawImage(Qt,0,0,rr.width,rr.height),rr}Nn.TypeMap=new Map,Nn.SerializableClasses=new Map,Nn.Serializers=[{priority:0,isType:Qt=>Array.isArray(Qt),serialize:(Qt,Kt)=>Qt.map(an=>Nn.Serialize(an,Kt,!1)),deserialize:(Qt,Kt,an)=>{const yn=Qt.length;Array.isArray(Kt)||(Kt=[]);for(let Xn=0;Xn<yn;Xn++){const rr=Qt[Xn],vr=Kt.length>Xn?Nn.Deserialize(rr,Kt[Xn],an,!1):Nn.Deserialize(rr,void 0,an,!1);Kt.length<=Xn?Kt.push(vr):Kt[Xn]=vr}return Kt}},{priority:0,isType:Qt=>!Qt||typeof Qt!="object",serialize:Qt=>{if(Qt&&typeof Qt=="number"){if(Qt===1/0)return"Infinity";if(Qt===-1/0)return"-Infinity";if(isNaN(Qt))return"NaN"}return Qt},deserialize:(Qt,Kt)=>{if(typeof Kt=="number"){if(Qt==="Infinity")return 1/0;if(Qt==="-Infinity")return-1/0;if(Qt==="NaN")return NaN;if(typeof Qt=="number"||!Qt)return Qt}return Qt}},dn];const jt=async(Qt,Kt)=>kn(await Pt(Qt),Kt),Wt=async(Qt,Kt)=>await jt(Qt,Kt).then(an=>an.toDataURL("image/png")),Zt=async Qt=>Pn(await(await fetch(Qt)).blob());function Bn(Qt,Kt,{width:an,height:yn},Xn=!0){const rr=`
<svg viewBox="0 0 ${an} ${yn}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${Kt}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${Qt}
        </div>
    </foreignObject>
</svg>
    `;return Xn?pn(rr):rr}_.Damper=Et,_.LinearToSRGB=function(Qt){return Qt<.0031308?12.92*Qt:1.055*Math.pow(Qt,.41666)-.055},_.PointerDragHelper=class extends dt{constructor(){super(...arguments),this._onPointerDown=Qt=>{if(Qt.button!==0||!this._element)return;this._pointerUp=void 0;const Kt=Qt.clientX/this._element.clientWidth*2-1,an=-Qt.clientY/this._element.clientHeight*2+1,yn=vt();this._pointerDown={x:Kt,y:an,time:yn},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=Qt=>{if(!this._pointerDown||!this._pointer||!this._element)return;const Kt=Qt.clientX/this._element.clientWidth*2-1,an=-Qt.clientY/this._element.clientHeight*2+1,yn=vt();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:Kt-this._pointerDown.x,y:an-this._pointerDown.y,time:yn-this._pointerDown.time},delta:{x:Kt-this._pointer.x,y:an-this._pointer.y,time:yn-this._pointer.time}}),this._pointer={x:Kt,y:an,time:vt()},Qt.buttons%2==0&&this._onPointerUp(Qt)},this._onPointerUp=Qt=>{if(Qt.button!==0||!this._pointerDown||!this._element)return;const Kt=Qt.clientX/this._element.clientWidth*2-1,an=-Qt.clientY/this._element.clientHeight*2+1,yn=vt();this._pointerUp={x:Kt,y:an,time:yn},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(Qt){this._element!==Qt&&(this._element&&this._removeElement(),this._element=Qt,this._element&&this._addElement())}_removeElement(){var Qt,Kt,an,yn,Xn;(Qt=this._element)===null||Qt===void 0||Qt.removeEventListener("pointerdown",this._onPointerDown),(Kt=this._element)===null||Kt===void 0||Kt.removeEventListener("pointermove",this._onPointerMove),(an=this._element)===null||an===void 0||an.removeEventListener("pointerup",this._onPointerUp),(yn=this._element)===null||yn===void 0||yn.removeEventListener("pointercancel",this._onPointerUp),(Xn=this._element)===null||Xn===void 0||Xn.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var Qt,Kt,an,yn,Xn;(Qt=this._element)===null||Qt===void 0||Qt.addEventListener("pointerdown",this._onPointerDown),(Kt=this._element)===null||Kt===void 0||Kt.addEventListener("pointermove",this._onPointerMove),(an=this._element)===null||an===void 0||an.addEventListener("pointerup",this._onPointerUp),(yn=this._element)===null||yn===void 0||yn.addEventListener("pointercancel",this._onPointerUp),(Xn=this._element)===null||Xn===void 0||Xn.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}},_.SRGBToLinear=function(Qt){return Qt<.04045?.0773993808*Qt:Math.pow(.9478672986*Qt+.0521327014,2.4)},_.Serialization=Nn,_.SimpleEventDispatcher=dt,_.TYPED_ARRAYS=Ft,_.absMax=function(Qt,Kt){return Math.abs(Qt)>Math.abs(Kt)?Qt:Kt},_.aesGcmDecrypt=async function(Qt,Kt){const an=typeof Kt=="string"?new TextEncoder().encode(Kt):Kt,yn=await crypto.subtle.digest("SHA-256",an),Xn=Qt.slice(0,12),rr={name:"AES-GCM",iv:typeof Xn=="string"?new Uint8Array(Array.from(Xn).map(zn=>zn.charCodeAt(0))):Xn},vr=await crypto.subtle.importKey("raw",yn,rr,!1,["decrypt"]),Wn=Qt.slice(12),ir=typeof Wn=="string"?new Uint8Array(Array.from(Wn).map(zn=>zn.charCodeAt(0))):Wn;try{const zn=await crypto.subtle.decrypt(rr,vr,ir);return typeof Qt=="string"?new TextDecoder().decode(zn):new Uint8Array(zn)}catch{throw new Error("Decrypt failed")}},_.aesGcmEncrypt=async function(Qt,Kt,an){const yn=typeof Kt=="string"?new TextEncoder().encode(Kt):Kt,Xn=await crypto.subtle.digest("SHA-256",yn),rr=crypto.getRandomValues(new Uint8Array(12)),vr=Array.from(rr).map(Qn=>String.fromCharCode(Qn)).join(""),Wn={name:"AES-GCM",iv:rr},ir=await crypto.subtle.importKey("raw",Xn,Wn,!1,["encrypt"]),zn=typeof Qt=="string"?new TextEncoder().encode(Qt):Qt,cr=await crypto.subtle.encrypt(Wn,ir,zn),ur=new Uint8Array(cr),Sr=Array.from(ur),_i=Sr.map(Qn=>String.fromCharCode(Qn)).join(""),rn=an?typeof an=="string"?an:new TextDecoder().decode(an):"",Dn=an?typeof an=="string"?new TextEncoder().encode(an):Array.from(an):[];return typeof Qt=="string"?rn+vr+_i:new Uint8Array([...Dn,...rr,...Sr])},_.arrayBufferToBase64=function(Qt){if(!window)return console.warn("window is required"),"";let Kt="";const an=new Uint8Array(Qt),yn=an.byteLength;for(let Xn=0;Xn<yn;Xn++)Kt+=String.fromCharCode(an[Xn]);return window.btoa(Kt)},_.base64ToArrayBuffer=function(Qt){if(!window)return console.warn("window is required"),new Uint8Array(0);const Kt=window.atob(Qt),an=Kt.length,yn=new Uint8Array(an);for(let Xn=0;Xn<an;Xn++)yn[Xn]=Kt.charCodeAt(Xn);return yn.buffer},_.blobToDataURL=Pn,_.canvasFlipY=function(Qt){const Kt=document.createElement("canvas");Kt.width=Qt.width,Kt.height=Qt.height;const an=Kt.getContext("2d");if(!an)throw new Error("Unable to get 2d context");return an.translate(0,Qt.height),an.scale(1,-1),an.drawImage(Qt,0,0),Kt},_.clearBit=function(Qt,Kt){return Qt&~(1<<Kt)},_.colorToDataUrl=function(Qt,Kt=1,an=1){const yn=document.createElement("canvas");yn.width=Kt,yn.height=an;const Xn=yn.getContext("2d");Xn.fillStyle="#"+Qt,Xn.fillRect(0,0,Kt,an);const rr=yn.toDataURL();return yn.remove(),rr},_.copyProps=function(Qt,Kt,an){for(const yn of an){const Xn=Qt[yn];Xn!==void 0&&tn(Kt,yn,Xn,!0)}return Kt},_.createCanvasElement=function(){const Qt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return Qt.style.display="block",Qt},_.createDiv=function({innerHTML:Qt="",id:Kt,classList:an,addToBody:yn=!0,elementTag:Xn="div"}){const rr=document.createElement(Xn);return Kt&&(rr.id=Kt),rr.innerHTML=Qt,an&&rr.classList.add(...an),yn&&document.body.appendChild(rr),rr},_.createImage=Pt,_.createScriptFromURL=async function(Qt,Kt=document.head){return new Promise((an,yn)=>{const Xn=document.createElement("script");Xn.setAttribute("src",Qt),Xn.addEventListener("load",()=>an(Xn)),Xn.addEventListener("error",yn),Kt.appendChild(Xn)})},_.createStyles=Ut,_.css=_n,_.deepAccessObject=function(Qt,Kt,an=!1){for(typeof Qt=="string"&&(Qt=Qt.split("."));Qt.length>0;){if(!Kt)return;const yn=Qt.splice(0,1)[0];if(!(yn.length<1)){if(!(yn in Kt)){if(an)throw new Error("invalid access, check "+yn+" in "+Kt);return}Kt=Kt[yn]}}return Kt},_.downloadBlob=ln,_.downloadFile=function(Qt,Kt){return ln(Qt,Kt??Qt.name)},_.embedUrlRefs=async function(Qt,Kt=Zt){const an=Qt.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(an)for(const yn of an){const Xn=await Kt(yn);Qt=Qt.replace(yn,Xn)}return Qt},_.escapeRegExp=Yt,_.getFileHandle=function(){return"showOpenFilePicker"in window?window.showOpenFilePicker().then(Qt=>Qt[0]):window.chooseFileSystemEntries()},_.getFilenameFromPath=function(Qt){return Qt.substring(Qt.lastIndexOf("/")+1)},_.getKeyByValue=function(Qt,Kt){return Object.keys(Qt).find(an=>Qt[an]===Kt)},_.getNewFileHandle=function(){if("showSaveFilePicker"in window){const Qt={types:[{description:"Text file",accept:{"text/plain":[".txt"]}}]};return window.showSaveFilePicker(Qt)}return window.chooseFileSystemEntries({type:"save-file",accepts:[{description:"Text file",extensions:["txt"],mimeTypes:["text/plain"]}]})},_.getOrCall=function(Qt,...Kt){return typeof Qt=="function"&&(Qt=Qt(...Kt)),Qt},_.getPropertyDescriptor=nn,_.getTypedArray=function(Qt,Kt){return new Ft[Qt](Kt)},_.getUrlQueryParam=function(Qt,Kt=null){var an;return(an=new URL(window.location.href).searchParams.get(Qt))!==null&&an!==void 0?an:Kt},_.glsl=(Qt,...Kt)=>String.raw({raw:Qt},...Kt),_.html=(Qt,...Kt)=>String.raw({raw:Qt},...Kt),_.htmlToCanvas=async function(Qt,Kt,an){const yn=Bn(Qt,Kt,an);return await jt(yn,an)},_.htmlToPng=async function(Qt,Kt,an){const yn=Bn(Qt,Kt,an);return await Wt(yn,an)},_.htmlToSvg=Bn,_.imageBitmapToBase64=function(Qt,Kt=8192,an=!1){var yn;if(!Qt.width||!Qt.height)return"";const Xn=document.createElement("canvas");Xn.width=Math.min(Kt,Qt.width),Xn.height=Math.floor(1+Xn.width*Qt.height/Qt.width);const rr=Qt instanceof ImageBitmap,vr=rr&&an&&Math.abs(Xn.width-Qt.width)<.5?Xn.getContext("bitmaprenderer"):void 0;vr?vr.transferFromImageBitmap(Qt):(yn=Xn.getContext("2d"))===null||yn===void 0||yn.drawImage(Qt,0,0,Xn.width,Xn.height);const Wn=Xn.toDataURL("image/png");return Xn.remove(),rr&&an&&Qt.close(),Wn},_.imageDataToCanvas=function(Qt){const Kt=document.createElement("canvas");return Kt.width=Qt.width,Kt.height=Qt.height,Kt.getContext("2d").putImageData(Qt,0,0),Kt},_.imageToCanvas=kn,_.imageUrlToImageData=async function(Qt){return new Promise((Kt,an)=>{const yn=new Image;yn.addEventListener("load",()=>{const Xn=document.createElement("canvas");Xn.width=yn.width,Xn.height=yn.height;const rr=Xn.getContext("2d");if(!rr)return void an(new Error("Could not get 2d context"));rr.drawImage(yn,0,0,Xn.width,Xn.height);const vr=rr.getImageData(0,0,Xn.width,Xn.height);Kt(vr),Xn.remove(),yn.remove()},!1),yn.addEventListener("error",Xn=>{yn.remove(),an(Xn)},!1),yn.src=Qt})},_.includesAll=function(Qt,Kt){for(const an of Kt)if(!Qt.includes(an))return!1;return!0},_.isPropertyWritable=Hn,_.isWebpExportSupported=function(){const Qt=document.createElement("canvas");return!(!Qt.getContext||!Qt.getContext("2d"))&&Qt.toDataURL("image/webp").startsWith("data:image/webp")},_.longestCommonPrefix=function(Qt){return Qt.sort(),Qt[0].split("").map((Kt,an)=>Qt[Qt.length-1][an]===Kt?Kt:"\0").join("").split("\0").at(0)||""},_.makeColorSvg=Qt=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${Qt}'/%3E%3C/svg%3E%0A`,_.makeColorSvgCircle=Qt=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${Qt}'/%3E%3C/svg%3E%0A`,_.makeTextSvg=Qt=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${Qt}%3C/text%3E%3C/svg%3E%0A`,_.mobileAndTabletCheck=function(){let Qt=!1;var Kt;return Kt=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(Kt)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(Kt.substr(0,4)))&&(Qt=!0),Qt},_.now=vt,_.objectHasOwn=function(Qt,Kt){return Object.hasOwn?Object.hasOwn(Qt,Kt):Qt.hasOwnProperty(Kt)},_.onChange=An,_.onChange2=function(Qt,Kt="void"){if(!Qt)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return An(Qt,Kt)},_.onChange3=function(Qt,Kt="object"){if(!Qt)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return An(Qt,Kt)},_.parseFileExtension=function(Qt){var Kt;if(!Qt||Qt===""||Qt.match(/__MACOSX\/.*\._/))return"";const an=(Kt=(Qt=Qt.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&Kt!==void 0?Kt:"",yn=an.lastIndexOf(".");return an===""||yn<1?"":an.slice(yn+1)},_.pathJoin=function(Qt,Kt="/"){return Qt.join(Kt)},_.prettyScrollbar=function(Qt=document.head){return Ut(_n`
      ::-webkit-scrollbar
      {
        width: 8px;  /* for vertical scrollbars */
        height: 8px; /* for horizontal scrollbars */
      }
      ::-webkit-scrollbar-track
      {
        background: rgba(64, 64, 64, 0.4);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-thumb
      {
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}
    `,Qt)},_.readFile=function(Qt){return Qt.text?Qt.text():function(Kt){return new Promise(an=>{const yn=new FileReader;yn.addEventListener("loadend",Xn=>{const rr=Xn.srcElement.result;an(rr)}),yn.readAsText(Kt)})}(Qt)},_.remoteWorkerURL=function(Qt,Kt){const an=(Kt?`var Module = { locateFile: function(s) { return "${Kt}"; } }; 
`:"")+`importScripts( "${Qt}" );`;return URL.createObjectURL(new Blob([an],{type:"text/javascript"}))},_.replaceAll=hn,_.safeSetProperty=tn,_.serializable=function(Qt){return Kt=>(Kt=class extends Kt{constructor(){super(...arguments),this.serializableClassId=Qt}},Nn.SerializableClasses.set(Qt,Kt),Kt)},_.serialize=function(Qt){return(Kt,an)=>{const yn=Kt.constructor;if(yn===Object)throw new Error("All properties in an object are serialized by default");Nn.TypeMap.has(yn)||Nn.TypeMap.set(yn,[]),Nn.TypeMap.get(yn).push([Qt||an,an])}},_.setUrlQueryParam=function(Qt,Kt,an=!1){const yn=new URLSearchParams(location.search);Kt==null?yn.has(Qt)&&yn.delete(Qt):yn.set(Qt,Kt),an?window.location.search=yn.toString():window.history.replaceState({},"","?"+yn.toString())},_.svgToCanvas=jt,_.svgToPng=Wt,_.svgUrl=pn,_.timeout=async function(Qt){return new Promise(Kt=>setTimeout(Kt,Math.max(0,Qt)))},_.toTitleCase=function(Qt){return Qt.replace(/\w\S*/g,function(Kt){return Kt.charAt(0).toUpperCase()+Kt.substr(1).toLowerCase()})},_.updateBit=function(Qt,Kt,an){return Qt&~(1<<Kt)|(an?1:0)<<Kt},_.uploadFile=async function(Qt=!1,Kt=!1,an){const yn=document.createElement("input");yn.type="file",yn.multiple=Qt,yn.accept=an||"*",yn.webkitdirectory=Kt,yn.style.display="none",document.body.appendChild(yn),yn.click();const Xn=await new Promise(rr=>{yn.onchange=vr=>{rr(Array.from(yn.files||[]))}});return document.body.removeChild(yn),Xn},_.verifyPermission=async function(Qt,Kt){const an={};return Kt&&(an.writable=!0,an.mode="readwrite"),await Qt.queryPermission(an)==="granted"||await Qt.requestPermission(an)==="granted"},_.writeFile=async function(Qt,Kt){if(Qt.createWriter){const yn=await Qt.createWriter();return await yn.write(0,Kt),void await yn.close()}const an=await Qt.createWritable();await an.write(Kt),await an.close()}})(_e)},819:function($,_e){(function(_){const dt="tp";function vt(kn){return jt=>Wt=>{if(!jt&&Wt===void 0)return{succeeded:!1,value:void 0};if(jt&&Wt===void 0)return{succeeded:!0,value:void 0};const Zt=kn(Wt);return Zt!==void 0?{succeeded:!0,value:Zt}:{succeeded:!1,value:void 0}}}function Et(kn){return{custom:jt=>vt(jt)(kn),boolean:vt(jt=>typeof jt=="boolean"?jt:void 0)(kn),number:vt(jt=>typeof jt=="number"?jt:void 0)(kn),string:vt(jt=>typeof jt=="string"?jt:void 0)(kn),function:vt(jt=>typeof jt=="function"?jt:void 0)(kn),constant:jt=>vt(Wt=>Wt===jt?jt:void 0)(kn),raw:vt(jt=>jt)(kn),object:jt=>vt(Wt=>{if((Zt=Wt)!==null&&typeof Zt=="object")return function(Bn,Qt){return Object.keys(Qt).reduce((Kt,an)=>{if(Kt===void 0)return;const yn=(0,Qt[an])(Bn[an]);return yn.succeeded?Object.assign(Object.assign({},Kt),{[an]:yn.value}):void 0},{})}(Wt,jt);var Zt})(kn),array:jt=>vt(Wt=>{if(Array.isArray(Wt))return Zt=jt,Wt.reduce((Bn,Qt)=>{if(Bn===void 0)return;const Kt=Zt(Qt);return Kt.succeeded&&Kt.value!==void 0?[...Bn,Kt.value]:void 0},[]);var Zt})(kn)}}const Pt={optional:Et(!0),required:Et(!1)};function Ut(kn){return jt=>jt.toFixed(Math.max(Math.min(kn,20),0))}function Ft(kn){return[kn[0],kn[1],kn[2]]}function Yt(kn){return jt=>function(Wt,Zt){const Bn=Ut(Zt==="float"?2:0);return`rgb(${Ft(Wt.getComponents("rgb",Zt)).map(Qt=>Bn(Qt)).join(", ")})`}(jt,kn)}function hn(kn){return jt=>function(Wt,Zt){const Bn=Ut(2),Qt=Ut(Zt==="float"?2:0);return`rgba(${Wt.getComponents("rgb",Zt).map((Kt,an)=>(an===3?Bn:Qt)(Kt)).join(", ")})`}(jt,kn)}function _n(kn){return jt=>function(Wt,Zt){const Bn=Ut(Zt==="float"?2:0),Qt=["r","g","b"];return`{${Ft(Wt.getComponents("rgb",Zt)).map((Kt,an)=>`${Qt[an]}: ${Bn(Kt)}`).join(", ")}}`}(jt,kn)}function pn(kn){return jt=>function(Wt,Zt){const Bn=Ut(2),Qt=Ut(Zt==="float"?2:0),Kt=["r","g","b","a"];return`{${Wt.getComponents("rgb",Zt).map((an,yn)=>`${Kt[yn]}: ${(yn===3?Bn:Qt)(an)}`).join(", ")}}`}(jt,kn)}function ln(kn,jt,Wt,Zt){return new(Wt||(Wt=Promise))(function(Bn,Qt){function Kt(Xn){try{yn(Zt.next(Xn))}catch(rr){Qt(rr)}}function an(Xn){try{yn(Zt.throw(Xn))}catch(rr){Qt(rr)}}function yn(Xn){var rr;Xn.done?Bn(Xn.value):(rr=Xn.value,rr instanceof Wt?rr:new Wt(function(vr){vr(rr)})).then(Kt,an)}yn((Zt=Zt.apply(kn,jt||[])).next())})}function Pn(kn){return ln(this,void 0,void 0,function*(){const jt=new Image;return jt.crossOrigin="anonymous",new Promise((Wt,Zt)=>{jt.src=kn,jt.onload=()=>{Wt(jt)},jt.onerror=Zt})})}["int","float"].reduce((kn,jt)=>[...kn,{format:{alpha:!1,mode:"rgb",notation:"func",type:jt},stringifier:Yt(jt)},{format:{alpha:!0,mode:"rgb",notation:"func",type:jt},stringifier:hn(jt)},{format:{alpha:!1,mode:"rgb",notation:"object",type:jt},stringifier:_n(jt)},{format:{alpha:!0,mode:"rgb",notation:"object",type:jt},stringifier:pn(jt)}],[]);const nn=(Hn="img",(kn,jt)=>[dt,"-",Hn,"v",kn?`_${kn}`:"",jt?`-${jt}`:""].join(""));var Hn;class tn{constructor(jt,Wt){this.element=jt.createElement("div"),this.element.classList.add(nn()),Wt.viewProps.bindClassModifiers(this.element),this.input=jt.createElement("input"),this.input.classList.add(nn("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",Wt.extensions.join(",")),this.image_=jt.createElement("img"),this.image_.classList.add(nn("image")),this.image_.classList.add(nn(`image_${Wt.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=Zt=>{Wt.clickCallback?Wt.clickCallback(Zt,this.input):this.input.click()},this.element.classList.add(nn("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(jt){this.image_.src=jt}changeDraggingState(jt){const Wt=this.element;jt?Wt==null||Wt.classList.add(nn("area_dragging")):Wt==null||Wt.classList.remove(nn("area_dragging"))}}let Xt=null;class dn{constructor(jt,Wt){this.value=Wt.value,this.viewProps=Wt.viewProps,this.view=new tn(jt,{viewProps:this.viewProps,extensions:Wt.extensions,imageFit:Wt.imageFit,clickCallback:Wt.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(jt){const Wt=(jt==null?void 0:jt.target).files;if(!Wt||!Wt.length)return;const Zt=Wt[0];this.setValue(Zt)}onDrop(jt){return ln(this,void 0,void 0,function*(){jt.preventDefault();try{const{dataTransfer:Wt}=jt,Zt=Wt==null?void 0:Wt.files[0];if(Zt)this.setValue(Zt);else{const Bn=Wt==null?void 0:Wt.getData("url");if(!Bn)throw new Error("No url");this.setValue(Bn)}}catch(Wt){console.error("Could not parse the dropped image",Wt)}finally{this.view.changeDraggingState(!1)}})}onDragOver(jt){jt.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(jt){return ln(this,void 0,void 0,function*(){jt instanceof HTMLImageElement?this.updateImage(jt.src):typeof jt!="string"&&jt?yield this.setValue(jt):(jt!=="placeholder"&&jt||(jt=(yield this.handlePlaceholderImage()).src),this.updateImage(jt))})}updateImage(jt){this.view.changeImage(jt)}setValue(jt){return ln(this,void 0,void 0,function*(){if(jt instanceof HTMLImageElement)this.value.setRawValue(jt);else if(jt instanceof File){const Wt=URL.createObjectURL(jt)+"#"+jt.name;jt.src=Wt;const Zt=yield Pn(Wt).catch(()=>{});this.value.setRawValue(Zt||jt)}else jt?this.value.setRawValue(yield Pn(jt)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return ln(this,void 0,void 0,function*(){return Xt||(Xt=yield function(){const jt=document.createElement("canvas");jt.width=320,jt.height=50;const Wt=jt.getContext("2d");return Wt.fillStyle="#00000004",Wt.fillRect(0,0,jt.width,jt.height),Wt.fillStyle="#eee",Wt.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',Wt.textAlign="center",Wt.textBaseline="middle",Wt.fillText("No image",.5*jt.width,.5*jt.height),new Promise(Zt=>{jt.toBlob(Bn=>{const Qt=new Image;Qt.src=URL.createObjectURL(Bn),Qt.isPlaceholder=!0,Qt.onload=()=>{Zt(Qt)}})})}()),Xt})}}const Nn=[".jpg",".png",".gif"],An={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us)*3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us)*3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity .16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:.6}",accept(kn,jt){if(!(kn instanceof HTMLImageElement||typeof kn=="string"))return null;const Wt=Pt,Zt=function(Bn,Qt){const Kt=Pt.required.object(Qt)(Bn);return Kt.succeeded?Kt.value:void 0}(jt,{view:Wt.required.constant("input-image"),acceptUrl:Wt.optional.boolean,clickCallback:Wt.optional.function,imageFit:Wt.optional.custom(Bn=>Bn==="contain"||Bn==="cover"?Bn:void 0),extensions:Wt.optional.array(Wt.required.string)});return Zt?{initialValue:kn,params:Zt}:null},binding:{reader(kn){return jt=>jt.src!==void 0?jt.src===""?"placeholder":jt.src:jt},writer(kn){return(jt,Wt)=>{jt.write(Wt)}}},controller(kn){var jt,Wt;return new dn(kn.document,{value:kn.value,imageFit:(jt=kn.params.imageFit)!==null&&jt!==void 0?jt:"cover",clickCallback:kn.params.clickCallback,viewProps:kn.viewProps,extensions:(Wt=kn.params.extensions)!==null&&Wt!==void 0?Wt:Nn})}};_.plugin=An,Object.defineProperty(_,"__esModule",{value:!0})})(_e)},665:function($,_e){(function(_){class dt{constructor(lt){this.controller_=lt}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(lt){this.controller_.viewProps.set("disabled",lt)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(lt){this.controller_.viewProps.set("hidden",lt)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class vt{constructor(lt){this.target=lt}}class Et extends vt{constructor(lt,mt,Tt,Vt){super(lt),this.value=mt,this.presetKey=Tt,this.last=Vt==null||Vt}}class Pt extends vt{constructor(lt,mt,Tt){super(lt),this.value=mt,this.presetKey=Tt}}class Ut extends vt{constructor(lt,mt){super(lt),this.expanded=mt}}class Ft extends vt{constructor(lt,mt){super(lt),this.index=mt}}function Yt(Ct){return Ct==null}function hn(Ct,lt){if(Ct.length!==lt.length)return!1;for(let mt=0;mt<Ct.length;mt++)if(Ct[mt]!==lt[mt])return!1;return!0}function _n(Ct,lt){let mt=Ct;do{const Tt=Object.getOwnPropertyDescriptor(mt,lt);if(Tt&&(Tt.set!==void 0||Tt.writable===!0))return!0;mt=Object.getPrototypeOf(mt)}while(mt!==null);return!1}const pn={alreadydisposed:()=>"View has been already disposed",invalidparams:Ct=>`Invalid parameters for '${Ct.name}'`,nomatchingcontroller:Ct=>`No matching controller for '${Ct.key}'`,nomatchingview:Ct=>`No matching view for '${JSON.stringify(Ct.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:Ct=>`Property '${Ct.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class ln{static alreadyDisposed(){return new ln({type:"alreadydisposed"})}static notBindable(){return new ln({type:"notbindable"})}static propertyNotFound(lt){return new ln({type:"propertynotfound",context:{name:lt}})}static shouldNeverHappen(){return new ln({type:"shouldneverhappen"})}constructor(lt){var mt;this.message=(mt=pn[lt.type](lt.context))!==null&&mt!==void 0?mt:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=lt.type}}class Pn{constructor(lt,mt,Tt){this.obj_=lt,this.key_=mt,this.presetKey_=Tt??mt}static isBindable(lt){return lt!==null&&typeof lt=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(lt){this.obj_[this.key_]=lt}writeProperty(lt,mt){const Tt=this.read();if(!Pn.isBindable(Tt))throw ln.notBindable();if(!(lt in Tt))throw ln.propertyNotFound(lt);Tt[lt]=mt}}class nn extends dt{get label(){return this.controller_.props.get("label")}set label(lt){this.controller_.props.set("label",lt)}get title(){var lt;return(lt=this.controller_.valueController.props.get("title"))!==null&&lt!==void 0?lt:""}set title(lt){this.controller_.valueController.props.set("title",lt)}on(lt,mt){const Tt=mt.bind(this);return this.controller_.valueController.emitter.on(lt,()=>{Tt(new vt(this))}),this}}class Hn{constructor(){this.observers_={}}on(lt,mt){let Tt=this.observers_[lt];return Tt||(Tt=this.observers_[lt]=[]),Tt.push({handler:mt}),this}off(lt,mt){const Tt=this.observers_[lt];return Tt&&(this.observers_[lt]=Tt.filter(Vt=>Vt.handler!==mt)),this}emit(lt,mt){const Tt=this.observers_[lt];Tt&&Tt.forEach(Vt=>{Vt.handler(mt)})}}const tn="tp";function Xt(Ct){return(lt,mt)=>[tn,"-",Ct,"v",lt?`_${lt}`:"",mt?`-${mt}`:""].join("")}function dn(Ct){return Ct.rawValue}function Nn(Ct,lt){var mt,Tt;Ct.emitter.on("change",(mt=dn,Tt=lt,Vt=>Tt(mt(Vt)))),lt(Ct.rawValue)}function An(Ct,lt,mt){Nn(Ct.value(lt),mt)}function kn(Ct,lt){return mt=>{(function(Tt,Vt,wn){wn?Tt.classList.add(Vt):Tt.classList.remove(Vt)})(Ct,lt,mt)}}function jt(Ct,lt){Nn(Ct,mt=>{lt.textContent=mt??""})}const Wt=Xt("btn");class Zt{constructor(lt,mt){this.element=lt.createElement("div"),this.element.classList.add(Wt()),mt.viewProps.bindClassModifiers(this.element);const Tt=lt.createElement("button");Tt.classList.add(Wt("b")),mt.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.buttonElement=Tt;const Vt=lt.createElement("div");Vt.classList.add(Wt("t")),jt(mt.props.value("title"),Vt),this.buttonElement.appendChild(Vt)}}class Bn{constructor(lt,mt){this.emitter=new Hn,this.onClick_=this.onClick_.bind(this),this.props=mt.props,this.viewProps=mt.viewProps,this.view=new Zt(lt,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Qt{constructor(lt,mt){var Tt;this.constraint_=mt==null?void 0:mt.constraint,this.equals_=(Tt=mt==null?void 0:mt.equals)!==null&&Tt!==void 0?Tt:(Vt,wn)=>Vt===wn,this.emitter=new Hn,this.rawValue_=lt}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(lt){this.setRawValue(lt,{forceEmit:!1,last:!0})}setRawValue(lt,mt){const Tt=mt??{forceEmit:!1,last:!0},Vt=this.constraint_?this.constraint_.constrain(lt):lt,wn=this.rawValue_;(!this.equals_(wn,Vt)||Tt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=Vt,this.emitter.emit("change",{options:Tt,previousRawValue:wn,rawValue:Vt,sender:this}))}}class Kt{constructor(lt){this.emitter=new Hn,this.value_=lt}get rawValue(){return this.value_}set rawValue(lt){this.setRawValue(lt,{forceEmit:!1,last:!0})}setRawValue(lt,mt){const Tt=mt??{forceEmit:!1,last:!0},Vt=this.value_;(Vt!==lt||Tt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=lt,this.emitter.emit("change",{options:Tt,previousRawValue:Vt,rawValue:this.value_,sender:this}))}}function an(Ct,lt){const mt=lt==null?void 0:lt.constraint,Tt=lt==null?void 0:lt.equals;return mt||Tt?new Qt(Ct,lt):new Kt(Ct)}class yn{constructor(lt){this.emitter=new Hn,this.valMap_=lt;for(const mt in this.valMap_)this.valMap_[mt].emitter.on("change",()=>{this.emitter.emit("change",{key:mt,sender:this})})}static createCore(lt){return Object.keys(lt).reduce((mt,Tt)=>Object.assign(mt,{[Tt]:an(lt[Tt])}),{})}static fromObject(lt){const mt=this.createCore(lt);return new yn(mt)}get(lt){return this.valMap_[lt].rawValue}set(lt,mt){this.valMap_[lt].rawValue=mt}value(lt){return this.valMap_[lt]}}function Xn(Ct){return lt=>mt=>{if(!lt&&mt===void 0)return{succeeded:!1,value:void 0};if(lt&&mt===void 0)return{succeeded:!0,value:void 0};const Tt=Ct(mt);return Tt!==void 0?{succeeded:!0,value:Tt}:{succeeded:!1,value:void 0}}}function rr(Ct){return{custom:lt=>Xn(lt)(Ct),boolean:Xn(lt=>typeof lt=="boolean"?lt:void 0)(Ct),number:Xn(lt=>typeof lt=="number"?lt:void 0)(Ct),string:Xn(lt=>typeof lt=="string"?lt:void 0)(Ct),function:Xn(lt=>typeof lt=="function"?lt:void 0)(Ct),constant:lt=>Xn(mt=>mt===lt?lt:void 0)(Ct),raw:Xn(lt=>lt)(Ct),object:lt=>Xn(mt=>{if((Tt=mt)!==null&&typeof Tt=="object")return function(Vt,wn){return Object.keys(wn).reduce((Tn,or)=>{if(Tn===void 0)return;const Mr=(0,wn[or])(Vt[or]);return Mr.succeeded?Object.assign(Object.assign({},Tn),{[or]:Mr.value}):void 0},{})}(mt,lt);var Tt})(Ct),array:lt=>Xn(mt=>{if(Array.isArray(mt))return Tt=lt,mt.reduce((Vt,wn)=>{if(Vt===void 0)return;const Tn=Tt(wn);return Tn.succeeded&&Tn.value!==void 0?[...Vt,Tn.value]:void 0},[]);var Tt})(Ct)}}const vr={optional:rr(!0),required:rr(!1)};function Wn(Ct,lt){const mt=vr.required.object(lt)(Ct);return mt.succeeded?mt.value:void 0}function ir(Ct){console.warn([`Missing '${Ct.key}' of ${Ct.target} in ${Ct.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}class zn{constructor(lt){this.value_=lt}static create(lt){return[new zn(lt),(mt,Tt)=>{lt.setRawValue(mt,Tt)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const cr=Xt("");function ur(Ct,lt){return kn(Ct,cr(void 0,lt))}class Sr extends yn{constructor(lt){var mt;super(lt),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=zn.create(an(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(mt=this.get("parent"))===null||mt===void 0||mt.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(lt){var mt,Tt,Vt;const wn=lt??{};return new Sr(yn.createCore({disabled:(mt=wn.disabled)!==null&&mt!==void 0&&mt,disposed:!1,hidden:(Tt=wn.hidden)!==null&&Tt!==void 0&&Tt,parent:(Vt=wn.parent)!==null&&Vt!==void 0?Vt:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(lt){Nn(this.globalDisabled_,ur(lt,"disabled")),An(this,"hidden",ur(lt,"hidden"))}bindDisabled(lt){Nn(this.globalDisabled_,mt=>{lt.disabled=mt})}bindTabIndex(lt){Nn(this.globalDisabled_,mt=>{lt.tabIndex=mt?-1:0})}handleDispose(lt){this.value("disposed").emitter.on("change",mt=>{mt&&lt()})}getGlobalDisabled_(){const lt=this.get("parent");return!!lt&&lt.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(lt){var mt;const Tt=lt.previousRawValue;Tt==null||Tt.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(mt=this.get("parent"))===null||mt===void 0||mt.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const _i=Xt(""),rn={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Dn{constructor(lt){this.parent_=null,this.blade=lt.blade,this.view=lt.view,this.viewProps=lt.viewProps;const mt=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(Tt=>{mt.classList.remove(_i(void 0,rn[Tt]))}),this.blade.get("positions").forEach(Tt=>{mt.classList.add(_i(void 0,rn[Tt]))})}),this.viewProps.handleDispose(()=>{(function(Tt){Tt&&Tt.parentElement&&Tt.parentElement.removeChild(Tt)})(mt)})}get parent(){return this.parent_}set parent(lt){this.parent_=lt,"parent"in this.viewProps.valMap_?this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null):ir({key:"parent",target:Sr.name,place:"BladeController.parent"})}}const Qn="http://www.w3.org/2000/svg";function jr(Ct){Ct.offsetHeight}function hr(Ct){return Ct.ontouchstart!==void 0}function Kr(){return globalThis.document}const Js={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function fo(Ct,lt){const mt=Ct.createElementNS(Qn,"svg");return mt.innerHTML=Js[lt],mt}function no(Ct,lt,mt){Ct.insertBefore(lt,Ct.children[mt])}function ba(Ct){Ct.parentElement&&Ct.parentElement.removeChild(Ct)}function Mo(Ct){for(;Ct.children.length>0;)Ct.removeChild(Ct.children[0])}function _c(Ct){return Ct.relatedTarget?Ct.relatedTarget:"explicitOriginalTarget"in Ct?Ct.explicitOriginalTarget:null}const Cl=Xt("lbl");class $a{constructor(lt,mt){this.element=lt.createElement("div"),this.element.classList.add(Cl()),mt.viewProps.bindClassModifiers(this.element);const Tt=lt.createElement("div");Tt.classList.add(Cl("l")),An(mt.props,"label",wn=>{Yt(wn)?this.element.classList.add(Cl(void 0,"nol")):(this.element.classList.remove(Cl(void 0,"nol")),function(Tn){for(;Tn.childNodes.length>0;)Tn.removeChild(Tn.childNodes[0])}(Tt),Tt.appendChild(function(Tn,or){const Mr=Tn.createDocumentFragment();return or.split(`
`).map(as=>Tn.createTextNode(as)).forEach((as,Gs)=>{Gs>0&&Mr.appendChild(Tn.createElement("br")),Mr.appendChild(as)}),Mr}(lt,wn)))}),this.element.appendChild(Tt),this.labelElement=Tt;const Vt=lt.createElement("div");Vt.classList.add(Cl("v")),this.element.appendChild(Vt),this.valueElement=Vt}}class Jp extends Dn{constructor(lt,mt){const Tt=mt.valueController.viewProps;super(Object.assign(Object.assign({},mt),{view:new $a(lt,{props:mt.props,viewProps:Tt}),viewProps:Tt})),this.props=mt.props,this.valueController=mt.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const bm={id:"button",type:"blade",accept(Ct){const lt=vr,mt=Wn(Ct,{title:lt.required.string,view:lt.required.constant("button"),label:lt.optional.string});return mt?{params:mt}:null},controller(Ct){return new Jp(Ct.document,{blade:Ct.blade,props:yn.fromObject({label:Ct.params.label}),valueController:new Bn(Ct.document,{props:yn.fromObject({title:Ct.params.title}),viewProps:Ct.viewProps})})},api(Ct){return Ct.controller instanceof Jp&&Ct.controller.valueController instanceof Bn?new nn(Ct.controller):null}};class Hl extends Dn{constructor(lt){super(lt),this.value=lt.value}}function Ql(){return new yn({positions:an([],{equals:hn})})}class Ml extends yn{constructor(lt){super(lt)}static create(lt){const mt={completed:!0,expanded:lt,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},Tt=yn.createCore(mt);return new Ml(Tt)}get styleExpanded(){var lt;return(lt=this.get("temporaryExpanded"))!==null&&lt!==void 0?lt:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const lt=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Yt(lt)?`${lt}px`:"auto"}bindExpandedClass(lt,mt){const Tt=()=>{this.styleExpanded?lt.classList.add(mt):lt.classList.remove(mt)};An(this,"expanded",Tt),An(this,"temporaryExpanded",Tt)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Ll(Ct,lt){lt.style.height=Ct.styleHeight}function _l(Ct,lt){Ct.value("expanded").emitter.on("beforechange",()=>{if(Ct.set("completed",!1),Yt(Ct.get("expandedHeight"))){const mt=function(Tt,Vt){let wn=0;return function(Tn,or){const Mr=Tn.style.transition;Tn.style.transition="none",or(),Tn.style.transition=Mr}(Vt,()=>{Tt.set("expandedHeight",null),Tt.set("temporaryExpanded",!0),jr(Vt),wn=Vt.clientHeight,Tt.set("temporaryExpanded",null),jr(Vt)}),wn}(Ct,lt);mt>0&&Ct.set("expandedHeight",mt)}Ct.set("shouldFixHeight",!0),jr(lt)}),Ct.emitter.on("change",()=>{Ll(Ct,lt)}),Ll(Ct,lt),lt.addEventListener("transitionend",mt=>{mt.propertyName==="height"&&Ct.cleanUpTransition()})}class Np extends dt{constructor(lt,mt){super(lt),this.rackApi_=mt}}class wm{constructor(lt){this.emitter=new Hn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=lt}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(lt){for(const mt of this.allItems())if(lt(mt))return mt;return null}includes(lt){return this.cache_.has(lt)}add(lt,mt){if(this.includes(lt))throw ln.shouldNeverHappen();const Tt=mt!==void 0?mt:this.items_.length;this.items_.splice(Tt,0,lt),this.cache_.add(lt);const Vt=this.extract_(lt);Vt&&(Vt.emitter.on("add",this.onSubListAdd_),Vt.emitter.on("remove",this.onSubListRemove_),Vt.allItems().forEach(wn=>{this.cache_.add(wn)})),this.emitter.emit("add",{index:Tt,item:lt,root:this,target:this})}remove(lt){const mt=this.items_.indexOf(lt);if(mt<0)return;this.items_.splice(mt,1),this.cache_.delete(lt);const Tt=this.extract_(lt);Tt&&(Tt.emitter.off("add",this.onSubListAdd_),Tt.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:mt,item:lt,root:this,target:this})}onSubListAdd_(lt){this.cache_.add(lt.item),this.emitter.emit("add",{index:lt.index,item:lt.item,root:this,target:lt.target})}onSubListRemove_(lt){this.cache_.delete(lt.item),this.emitter.emit("remove",{index:lt.index,item:lt.item,root:this,target:lt.target})}}class Tl extends dt{constructor(lt){super(lt),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new Hn,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(lt){this.controller_.props.set("label",lt)}on(lt,mt){const Tt=mt.bind(this);return this.emitter_.on(lt,Vt=>{Tt(Vt.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(lt){const mt=lt.sender.target.read();this.emitter_.emit("change",{event:new Et(this,mt,this.controller_.binding.target.presetKey,lt.options.last)})}}class tp extends Jp{constructor(lt,mt){super(lt,mt),this.binding=mt.binding}}class Yo extends dt{constructor(lt){super(lt),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new Hn,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(lt){this.controller_.props.set("label",lt)}on(lt,mt){const Tt=mt.bind(this);return this.emitter_.on(lt,Vt=>{Tt(Vt.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(lt){const mt=lt.sender.target.read();this.emitter_.emit("update",{event:new Pt(this,mt,this.controller_.binding.target.presetKey)})}}class $p extends Jp{constructor(lt,mt){super(lt,mt),this.binding=mt.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function UM(Ct){return Ct instanceof Il?Ct.apiSet_:Ct instanceof Np?Ct.rackApi_.apiSet_:null}function n_(Ct,lt){const mt=Ct.find(Tt=>Tt.controller_===lt);if(!mt)throw ln.shouldNeverHappen();return mt}function TS(Ct,lt,mt){if(!Pn.isBindable(Ct))throw ln.notBindable();return new Pn(Ct,lt,mt)}class Il extends dt{constructor(lt,mt){super(lt),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new Hn,this.apiSet_=new wm(UM),this.pool_=mt;const Tt=this.controller_.rack;Tt.emitter.on("add",this.onRackAdd_),Tt.emitter.on("remove",this.onRackRemove_),Tt.emitter.on("inputchange",this.onRackInputChange_),Tt.emitter.on("monitorupdate",this.onRackMonitorUpdate_),Tt.children.forEach(Vt=>{this.setUpApi_(Vt)})}get children(){return this.controller_.rack.children.map(lt=>n_(this.apiSet_,lt))}addInput(lt,mt,Tt){const Vt=Tt??{},wn=this.controller_.view.element.ownerDocument,Tn=this.pool_.createInput(wn,TS(lt,mt,Vt.presetKey),Vt),or=new Tl(Tn);return this.add(or,Vt.index)}addMonitor(lt,mt,Tt){const Vt=Tt??{},wn=this.controller_.view.element.ownerDocument,Tn=this.pool_.createMonitor(wn,TS(lt,mt),Vt),or=new Yo(Tn);return this.add(or,Vt.index)}addFolder(lt){return function(mt,Tt){return mt.addBlade(Object.assign(Object.assign({},Tt),{view:"folder"}))}(this,lt)}addButton(lt){return function(mt,Tt){return mt.addBlade(Object.assign(Object.assign({},Tt),{view:"button"}))}(this,lt)}addSeparator(lt){return function(mt,Tt){const Vt=Tt??{};return mt.addBlade(Object.assign(Object.assign({},Vt),{view:"separator"}))}(this,lt)}addTab(lt){return function(mt,Tt){return mt.addBlade(Object.assign(Object.assign({},Tt),{view:"tab"}))}(this,lt)}add(lt,mt){this.controller_.rack.add(lt.controller_,mt);const Tt=this.apiSet_.find(Vt=>Vt.controller_===lt.controller_);return Tt&&this.apiSet_.remove(Tt),this.apiSet_.add(lt),lt}remove(lt){this.controller_.rack.remove(lt.controller_)}addBlade(lt){const mt=this.controller_.view.element.ownerDocument,Tt=this.pool_.createBlade(mt,lt),Vt=this.pool_.createBladeApi(Tt);return this.add(Vt,lt.index)}on(lt,mt){const Tt=mt.bind(this);return this.emitter_.on(lt,Vt=>{Tt(Vt.event)}),this}setUpApi_(lt){this.apiSet_.find(mt=>mt.controller_===lt)||this.apiSet_.add(this.pool_.createBladeApi(lt))}onRackAdd_(lt){this.setUpApi_(lt.bladeController)}onRackRemove_(lt){if(lt.isRoot){const mt=n_(this.apiSet_,lt.bladeController);this.apiSet_.remove(mt)}}onRackInputChange_(lt){const mt=lt.bladeController;if(mt instanceof tp){const Tt=n_(this.apiSet_,mt),Vt=mt.binding;this.emitter_.emit("change",{event:new Et(Tt,Vt.target.read(),Vt.target.presetKey,lt.options.last)})}else if(mt instanceof Hl){const Tt=n_(this.apiSet_,mt);this.emitter_.emit("change",{event:new Et(Tt,mt.value.rawValue,void 0,lt.options.last)})}}onRackMonitorUpdate_(lt){if(!(lt.bladeController instanceof $p))throw ln.shouldNeverHappen();const mt=n_(this.apiSet_,lt.bladeController),Tt=lt.bladeController.binding;this.emitter_.emit("update",{event:new Pt(mt,Tt.target.read(),Tt.target.presetKey)})}}class yp extends Np{constructor(lt,mt){super(lt,new Il(lt.rackController,mt)),this.emitter_=new Hn,this.controller_.foldable.value("expanded").emitter.on("change",Tt=>{this.emitter_.emit("fold",{event:new Ut(this,Tt.sender.rawValue)})}),this.rackApi_.on("change",Tt=>{this.emitter_.emit("change",{event:Tt})}),this.rackApi_.on("update",Tt=>{this.emitter_.emit("update",{event:Tt})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(lt){this.controller_.foldable.set("expanded",lt)}get title(){return this.controller_.props.get("title")}set title(lt){this.controller_.props.set("title",lt)}get children(){return this.rackApi_.children}addInput(lt,mt,Tt){return this.rackApi_.addInput(lt,mt,Tt)}addMonitor(lt,mt,Tt){return this.rackApi_.addMonitor(lt,mt,Tt)}addFolder(lt){return this.rackApi_.addFolder(lt)}addButton(lt){return this.rackApi_.addButton(lt)}addSeparator(lt){return this.rackApi_.addSeparator(lt)}addTab(lt){return this.rackApi_.addTab(lt)}add(lt,mt){return this.rackApi_.add(lt,mt)}remove(lt){this.rackApi_.remove(lt)}addBlade(lt){return this.rackApi_.addBlade(lt)}on(lt,mt){const Tt=mt.bind(this);return this.emitter_.on(lt,Vt=>{Tt(Vt.event)}),this}}class nx extends Dn{constructor(lt){super({blade:lt.blade,view:lt.view,viewProps:lt.rackController.viewProps}),this.rackController=lt.rackController}}class Au{constructor(lt,mt){const Tt=Xt(mt.viewName);this.element=lt.createElement("div"),this.element.classList.add(Tt()),mt.viewProps.bindClassModifiers(this.element)}}function my(Ct){return Ct instanceof eu?Ct.rack:Ct instanceof nx?Ct.rackController.rack:null}function _v(Ct){const lt=my(Ct);return lt?lt.bcSet_:null}class zo{constructor(lt){var mt,Tt;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new Hn,this.blade_=(mt=lt.blade)!==null&&mt!==void 0?mt:null,(Tt=this.blade_)===null||Tt===void 0||Tt.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=lt.viewProps,this.bcSet_=new wm(_v),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(lt,mt){var Tt;(Tt=lt.parent)===null||Tt===void 0||Tt.remove(lt),_n(lt,"parent")?lt.parent=this:(lt.parent_=this,ir({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(lt,mt)}remove(lt){_n(lt,"parent")?lt.parent=null:(lt.parent_=null,ir({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(lt)}find(lt){return this.bcSet_.allItems().filter(mt=>mt instanceof lt)}onSetAdd_(lt){this.updatePositions_();const mt=lt.target===lt.root;if(this.emitter.emit("add",{bladeController:lt.item,index:lt.index,isRoot:mt,sender:this}),!mt)return;const Tt=lt.item;if(Tt.viewProps.emitter.on("change",this.onChildViewPropsChange_),Tt.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),Tt.viewProps.handleDispose(this.onChildDispose_),Tt instanceof tp)Tt.binding.emitter.on("change",this.onChildInputChange_);else if(Tt instanceof $p)Tt.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(Tt instanceof Hl)Tt.value.emitter.on("change",this.onChildValueChange_);else{const Vt=my(Tt);if(Vt){const wn=Vt.emitter;wn.on("layout",this.onDescendantLayout_),wn.on("inputchange",this.onDescendantInputChange_),wn.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(lt){this.updatePositions_();const mt=lt.target===lt.root;if(this.emitter.emit("remove",{bladeController:lt.item,isRoot:mt,sender:this}),!mt)return;const Tt=lt.item;if(Tt instanceof tp)Tt.binding.emitter.off("change",this.onChildInputChange_);else if(Tt instanceof $p)Tt.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(Tt instanceof Hl)Tt.value.emitter.off("change",this.onChildValueChange_);else{const Vt=my(Tt);if(Vt){const wn=Vt.emitter;wn.off("layout",this.onDescendantLayout_),wn.off("inputchange",this.onDescendantInputChange_),wn.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const lt=this.bcSet_.items.filter(Vt=>!Vt.viewProps.get("hidden")),mt=lt[0],Tt=lt[lt.length-1];this.bcSet_.items.forEach(Vt=>{const wn=[];Vt===mt&&(wn.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||wn.push("veryfirst")),Vt===Tt&&(wn.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||wn.push("verylast")),Vt.blade.set("positions",wn)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(lt){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(lt=>lt.viewProps.get("disposed")).forEach(lt=>{this.bcSet_.remove(lt)})}onChildInputChange_(lt){const mt=function(Tt,Vt){for(let wn=0;wn<Tt.length;wn++){const Tn=Tt[wn];if(Tn instanceof tp&&Tn.binding===Vt)return Tn}return null}(this.find(tp),lt.sender);if(!mt)throw ln.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:mt,options:lt.options,sender:this})}onChildMonitorUpdate_(lt){const mt=function(Tt,Vt){for(let wn=0;wn<Tt.length;wn++){const Tn=Tt[wn];if(Tn instanceof $p&&Tn.binding===Vt)return Tn}return null}(this.find($p),lt.sender);if(!mt)throw ln.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:mt,sender:this})}onChildValueChange_(lt){const mt=function(Tt,Vt){for(let wn=0;wn<Tt.length;wn++){const Tn=Tt[wn];if(Tn instanceof Hl&&Tn.value===Vt)return Tn}return null}(this.find(Hl),lt.sender);if(!mt)throw ln.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:mt,options:lt.options,sender:this})}onDescendantLayout_(lt){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(lt){this.emitter.emit("inputchange",{bladeController:lt.bladeController,options:lt.options,sender:this})}onDescendantMonitorUpdate_(lt){this.emitter.emit("monitorupdate",{bladeController:lt.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class eu extends Dn{constructor(lt,mt){super(Object.assign(Object.assign({},mt),{view:new Au(lt,{viewName:"brk",viewProps:mt.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const Tt=new zo({blade:mt.root?void 0:mt.blade,viewProps:mt.viewProps});Tt.emitter.on("add",this.onRackAdd_),Tt.emitter.on("remove",this.onRackRemove_),this.rack=Tt,this.viewProps.handleDispose(()=>{for(let Vt=this.rack.children.length-1;Vt>=0;Vt--)this.rack.children[Vt].viewProps.set("disposed",!0)})}onRackAdd_(lt){lt.isRoot&&no(this.view.element,lt.bladeController.view.element,lt.index)}onRackRemove_(lt){lt.isRoot&&ba(lt.bladeController.view.element)}}const Ko=Xt("cnt");class DA{constructor(lt,mt){var Tt;this.className_=Xt((Tt=mt.viewName)!==null&&Tt!==void 0?Tt:"fld"),this.element=lt.createElement("div"),this.element.classList.add(this.className_(),Ko()),mt.viewProps.bindClassModifiers(this.element),this.foldable_=mt.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),An(this.foldable_,"completed",kn(this.element,this.className_(void 0,"cpl")));const Vt=lt.createElement("button");Vt.classList.add(this.className_("b")),An(mt.props,"title",as=>{Yt(as)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),mt.viewProps.bindDisabled(Vt),this.element.appendChild(Vt),this.buttonElement=Vt;const wn=lt.createElement("div");wn.classList.add(this.className_("i")),this.element.appendChild(wn);const Tn=lt.createElement("div");Tn.classList.add(this.className_("t")),jt(mt.props.value("title"),Tn),this.buttonElement.appendChild(Tn),this.titleElement=Tn;const or=lt.createElement("div");or.classList.add(this.className_("m")),this.buttonElement.appendChild(or);const Mr=mt.containerElement;Mr.classList.add(this.className_("c")),this.element.appendChild(Mr),this.containerElement=Mr}}class Pu extends nx{constructor(lt,mt){var Tt;const Vt=Ml.create((Tt=mt.expanded)===null||Tt===void 0||Tt),wn=new eu(lt,{blade:mt.blade,root:mt.root,viewProps:mt.viewProps});super(Object.assign(Object.assign({},mt),{rackController:wn,view:new DA(lt,{containerElement:wn.view.element,foldable:Vt,props:mt.props,viewName:mt.root?"rot":void 0,viewProps:mt.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=mt.props,this.foldable=Vt,_l(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const yv={id:"folder",type:"blade",accept(Ct){const lt=vr,mt=Wn(Ct,{title:lt.required.string,view:lt.required.constant("folder"),expanded:lt.optional.boolean});return mt?{params:mt}:null},controller(Ct){return new Pu(Ct.document,{blade:Ct.blade,expanded:Ct.params.expanded,props:yn.fromObject({title:Ct.params.title}),viewProps:Ct.viewProps})},api(Ct){return Ct.controller instanceof Pu?new yp(Ct.controller,Ct.pool):null}};class Zp extends Hl{constructor(lt,mt){const Tt=mt.valueController.viewProps;super(Object.assign(Object.assign({},mt),{value:mt.valueController.value,view:new $a(lt,{props:mt.props,viewProps:Tt}),viewProps:Tt})),this.props=mt.props,this.valueController=mt.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class gy extends dt{}const vy=Xt("spr");class O_{constructor(lt,mt){this.element=lt.createElement("div"),this.element.classList.add(vy()),mt.viewProps.bindClassModifiers(this.element);const Tt=lt.createElement("hr");Tt.classList.add(vy("r")),this.element.appendChild(Tt)}}class P1 extends Dn{constructor(lt,mt){super(Object.assign(Object.assign({},mt),{view:new O_(lt,{viewProps:mt.viewProps})}))}}const Hu={id:"separator",type:"blade",accept(Ct){const lt=Wn(Ct,{view:vr.required.constant("separator")});return lt?{params:lt}:null},controller(Ct){return new P1(Ct.document,{blade:Ct.blade,viewProps:Ct.viewProps})},api(Ct){return Ct.controller instanceof P1?new gy(Ct.controller):null}},Mn=Xt("tbi");class Wm{constructor(lt,mt){this.element=lt.createElement("div"),this.element.classList.add(Mn()),mt.viewProps.bindClassModifiers(this.element),An(mt.props,"selected",wn=>{wn?this.element.classList.add(Mn(void 0,"sel")):this.element.classList.remove(Mn(void 0,"sel"))});const Tt=lt.createElement("button");Tt.classList.add(Mn("b")),mt.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.buttonElement=Tt;const Vt=lt.createElement("div");Vt.classList.add(Mn("t")),jt(mt.props.value("title"),Vt),this.buttonElement.appendChild(Vt),this.titleElement=Vt}}class xm{constructor(lt,mt){this.emitter=new Hn,this.onClick_=this.onClick_.bind(this),this.props=mt.props,this.viewProps=mt.viewProps,this.view=new Wm(lt,{props:mt.props,viewProps:mt.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Up{constructor(lt,mt){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new xm(lt,{props:mt.itemProps,viewProps:Sr.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new eu(lt,{blade:Ql(),viewProps:Sr.create()}),this.props=mt.props,An(this.props,"selected",Tt=>{this.itemController.props.set("selected",Tt),this.contentController.viewProps.set("hidden",!Tt)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class To{constructor(lt,mt){this.controller_=lt,this.rackApi_=mt}get title(){var lt;return(lt=this.controller_.itemController.props.get("title"))!==null&&lt!==void 0?lt:""}set title(lt){this.controller_.itemController.props.set("title",lt)}get selected(){return this.controller_.props.get("selected")}set selected(lt){this.controller_.props.set("selected",lt)}get children(){return this.rackApi_.children}addButton(lt){return this.rackApi_.addButton(lt)}addFolder(lt){return this.rackApi_.addFolder(lt)}addSeparator(lt){return this.rackApi_.addSeparator(lt)}addTab(lt){return this.rackApi_.addTab(lt)}add(lt,mt){this.rackApi_.add(lt,mt)}remove(lt){this.rackApi_.remove(lt)}addInput(lt,mt,Tt){return this.rackApi_.addInput(lt,mt,Tt)}addMonitor(lt,mt,Tt){return this.rackApi_.addMonitor(lt,mt,Tt)}addBlade(lt){return this.rackApi_.addBlade(lt)}}class Oo extends Np{constructor(lt,mt){super(lt,new Il(lt.rackController,mt)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new Hn,this.pageApiMap_=new Map,this.rackApi_.on("change",Tt=>{this.emitter_.emit("change",{event:Tt})}),this.rackApi_.on("update",Tt=>{this.emitter_.emit("update",{event:Tt})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(Tt=>{this.setUpPageApi_(Tt)})}get pages(){return this.controller_.pageSet.items.map(lt=>{const mt=this.pageApiMap_.get(lt);if(!mt)throw ln.shouldNeverHappen();return mt})}addPage(lt){const mt=this.controller_.view.element.ownerDocument,Tt=new Up(mt,{itemProps:yn.fromObject({selected:!1,title:lt.title}),props:yn.fromObject({selected:!1})});this.controller_.add(Tt,lt.index);const Vt=this.pageApiMap_.get(Tt);if(!Vt)throw ln.shouldNeverHappen();return Vt}removePage(lt){this.controller_.remove(lt)}on(lt,mt){const Tt=mt.bind(this);return this.emitter_.on(lt,Vt=>{Tt(Vt.event)}),this}setUpPageApi_(lt){const mt=this.rackApi_.apiSet_.find(Vt=>Vt.controller_===lt.contentController);if(!mt)throw ln.shouldNeverHappen();const Tt=new To(lt,mt);this.pageApiMap_.set(lt,Tt)}onPageAdd_(lt){this.setUpPageApi_(lt.item)}onPageRemove_(lt){if(!this.pageApiMap_.get(lt.item))throw ln.shouldNeverHappen();this.pageApiMap_.delete(lt.item)}onSelect_(lt){this.emitter_.emit("select",{event:new Ft(this,lt.rawValue)})}}class R1{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=an(!0),this.selectedIndex=an(-1),this.items_=[]}add(lt,mt){const Tt=mt??this.items_.length;this.items_.splice(Tt,0,lt),lt.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(lt){const mt=this.items_.indexOf(lt);mt<0||(this.items_.splice(mt,1),lt.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const lt=this.items_.findIndex(mt=>mt.rawValue);lt<0?(this.items_.forEach((mt,Tt)=>{mt.rawValue=Tt===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((mt,Tt)=>{mt.rawValue=Tt===lt}),this.selectedIndex.rawValue=lt),this.empty.rawValue=!1}onItemSelectedChange_(lt){if(lt.rawValue){const mt=this.items_.findIndex(Tt=>Tt===lt.sender);this.items_.forEach((Tt,Vt)=>{Tt.rawValue=Vt===mt}),this.selectedIndex.rawValue=mt}else this.keepSelection_()}}const qm=Xt("tab");class ix{constructor(lt,mt){this.element=lt.createElement("div"),this.element.classList.add(qm(),Ko()),mt.viewProps.bindClassModifiers(this.element),Nn(mt.empty,kn(this.element,qm(void 0,"nop")));const Tt=lt.createElement("div");Tt.classList.add(qm("t")),this.element.appendChild(Tt),this.itemsElement=Tt;const Vt=lt.createElement("div");Vt.classList.add(qm("i")),this.element.appendChild(Vt);const wn=mt.contentsElement;wn.classList.add(qm("c")),this.element.appendChild(wn),this.contentsElement=wn}}class d0 extends nx{constructor(lt,mt){const Tt=new eu(lt,{blade:mt.blade,viewProps:mt.viewProps}),Vt=new R1;super({blade:mt.blade,rackController:Tt,view:new ix(lt,{contentsElement:Tt.view.element,empty:Vt.empty,viewProps:mt.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new wm(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=Vt}get pageSet(){return this.pageSet_}add(lt,mt){this.pageSet_.add(lt,mt)}remove(lt){this.pageSet_.remove(this.pageSet_.items[lt])}onPageAdd_(lt){const mt=lt.item;no(this.view.itemsElement,mt.itemController.view.element,lt.index),mt.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(mt.contentController,lt.index),this.tab.add(mt.props.value("selected"))}onPageRemove_(lt){const mt=lt.item;ba(mt.itemController.view.element),mt.itemController.viewProps.set("parent",null),this.rackController.rack.remove(mt.contentController),this.tab.remove(mt.props.value("selected"))}}const Av={id:"tab",type:"blade",accept(Ct){const lt=vr,mt=Wn(Ct,{pages:lt.required.array(lt.required.object({title:lt.required.string})),view:lt.required.constant("tab")});return mt&&mt.pages.length!==0?{params:mt}:null},controller(Ct){const lt=new d0(Ct.document,{blade:Ct.blade,viewProps:Ct.viewProps});return Ct.params.pages.forEach(mt=>{const Tt=new Up(Ct.document,{itemProps:yn.fromObject({selected:!1,title:mt.title}),props:yn.fromObject({selected:!1})});lt.add(Tt)}),lt},api(Ct){return Ct.controller instanceof d0?new Oo(Ct.controller,Ct.pool):null}};class kA{constructor(){this.disabled=!1,this.emitter=new Hn}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class p0{constructor(lt,mt){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=lt,this.emitter=new Hn,this.interval_=mt,this.setTimer_()}get disabled(){return this.disabled_}set disabled(lt){this.disabled_=lt,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const lt=this.doc_.defaultView;lt&&lt.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const lt=this.doc_.defaultView;lt&&(this.timerId_=lt.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class rx{constructor(lt){this.onValueChange_=this.onValueChange_.bind(this),this.reader=lt.reader,this.writer=lt.writer,this.emitter=new Hn,this.value=lt.value,this.value.emitter.on("change",this.onValueChange_),this.target=lt.target,this.read()}read(){const lt=this.target.read();lt!==void 0&&(this.value.rawValue=this.reader(lt))}write_(lt){this.writer(this.target,lt)}onValueChange_(lt){this.write_(lt.rawValue),this.emitter.emit("change",{options:lt.options,rawValue:lt.rawValue,sender:this})}}function BA(Ct,lt){for(;Ct.length<lt;)Ct.push(void 0)}function Em(Ct){const lt=[];return BA(lt,Ct),an(lt)}function sx(Ct){const lt=Ct.indexOf(void 0);return lt<0?Ct:Ct.slice(0,lt)}class D1{constructor(lt){this.onTick_=this.onTick_.bind(this),this.reader_=lt.reader,this.target=lt.target,this.emitter=new Hn,this.value=lt.value,this.ticker=lt.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const lt=this.target.read();if(lt===void 0)return;const mt=this.value.rawValue,Tt=this.reader_(lt);this.value.rawValue=function(Vt,wn){const Tn=[...sx(Vt),wn];return Tn.length>Vt.length?Tn.splice(0,Tn.length-Vt.length):BA(Tn,Vt.length),Tn}(mt,Tt),this.emitter.emit("update",{rawValue:Tt,sender:this})}onTick_(lt){this.read()}}class L_{constructor(lt){this.constraints=lt}constrain(lt){return this.constraints.reduce((mt,Tt)=>Tt.constrain(mt),lt)}}function _f(Ct,lt){if(Ct instanceof lt)return Ct;if(Ct instanceof L_){const mt=Ct.constraints.reduce((Tt,Vt)=>Tt||(Vt instanceof lt?Vt:null),null);if(mt)return mt}return null}class tu{constructor(lt){this.values=yn.fromObject({max:lt.max,min:lt.min})}constrain(lt){const mt=this.values.get("max"),Tt=this.values.get("min");return Math.min(Math.max(lt,Tt),mt)}}class i_{constructor(lt){this.values=yn.fromObject({options:lt})}get options(){return this.values.get("options")}constrain(lt){const mt=this.values.get("options");return mt.length===0||mt.filter(Tt=>Tt.value===lt).length>0?lt:mt[0].value}}class ox{constructor(lt){this.values=yn.fromObject({max:lt.max,min:lt.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(lt){const mt=this.values.get("max"),Tt=this.values.get("min");let Vt=lt;return Yt(Tt)||(Vt=Math.max(Vt,Tt)),Yt(mt)||(Vt=Math.min(Vt,mt)),Vt}}class _y{constructor(lt,mt=0){this.step=lt,this.origin=mt}constrain(lt){const mt=this.origin%this.step;return mt+Math.round((lt-mt)/this.step)*this.step}}const OA=Xt("lst");class bu{constructor(lt,mt){this.onValueChange_=this.onValueChange_.bind(this),this.props_=mt.props,this.element=lt.createElement("div"),this.element.classList.add(OA()),mt.viewProps.bindClassModifiers(this.element);const Tt=lt.createElement("select");Tt.classList.add(OA("s")),An(this.props_,"options",wn=>{Mo(Tt),wn.forEach((Tn,or)=>{const Mr=lt.createElement("option");Mr.dataset.index=String(or),Mr.textContent=Tn.text,Mr.value=String(Tn.value),Tt.appendChild(Mr)})}),mt.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.selectElement=Tt;const Vt=lt.createElement("div");Vt.classList.add(OA("m")),Vt.appendChild(fo(lt,"dropdown")),this.element.appendChild(Vt),mt.value.emitter.on("change",this.onValueChange_),this.value_=mt.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class r_{constructor(lt,mt){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=mt.props,this.value=mt.value,this.viewProps=mt.viewProps,this.view=new bu(lt,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(lt){const mt=lt.currentTarget.selectedOptions.item(0);if(!mt)return;const Tt=Number(mt.dataset.index);this.value.rawValue=this.props.get("options")[Tt].value}}const ax=Xt("pop");class np{constructor(lt,mt){this.element=lt.createElement("div"),this.element.classList.add(ax()),mt.viewProps.bindClassModifiers(this.element),Nn(mt.shows,kn(this.element,ax(void 0,"v")))}}class f0{constructor(lt,mt){this.shows=an(!1),this.viewProps=mt.viewProps,this.view=new np(lt,{shows:this.shows,viewProps:this.viewProps})}}const Ap=Xt("txt");class Nr{constructor(lt,mt){this.onChange_=this.onChange_.bind(this),this.element=lt.createElement("div"),this.element.classList.add(Ap()),mt.viewProps.bindClassModifiers(this.element),this.props_=mt.props,this.props_.emitter.on("change",this.onChange_);const Tt=lt.createElement("input");Tt.classList.add(Ap("i")),Tt.type="text",mt.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.inputElement=Tt,mt.value.emitter.on("change",this.onChange_),this.value_=mt.value,this.refresh()}refresh(){const lt=this.props_.get("formatter");this.inputElement.value=lt(this.value_.rawValue)}onChange_(){this.refresh()}}class Xm{constructor(lt,mt){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=mt.parser,this.props=mt.props,this.value=mt.value,this.viewProps=mt.viewProps,this.view=new Nr(lt,{props:mt.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(lt){const mt=lt.currentTarget.value,Tt=this.parser_(mt);Yt(Tt)||(this.value.rawValue=Tt),this.view.refresh()}}function es(Ct){return Ct!=="false"&&!!Ct}function ip(Ct){return function(lt){return String(lt)}(Ct)}class em{constructor(lt){this.text=lt}evaluate(){return Number(this.text)}toString(){return this.text}}const go={"**":(Ct,lt)=>Math.pow(Ct,lt),"*":(Ct,lt)=>Ct*lt,"/":(Ct,lt)=>Ct/lt,"%":(Ct,lt)=>Ct%lt,"+":(Ct,lt)=>Ct+lt,"-":(Ct,lt)=>Ct-lt,"<<":(Ct,lt)=>Ct<<lt,">>":(Ct,lt)=>Ct>>lt,">>>":(Ct,lt)=>Ct>>>lt,"&":(Ct,lt)=>Ct&lt,"^":(Ct,lt)=>Ct^lt,"|":(Ct,lt)=>Ct|lt};class js{constructor(lt,mt,Tt){this.left=mt,this.operator=lt,this.right=Tt}evaluate(){const lt=go[this.operator];if(!lt)throw new Error(`unexpected binary operator: '${this.operator}`);return lt(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const s_={"+":Ct=>Ct,"-":Ct=>-Ct,"~":Ct=>~Ct};class yy{constructor(lt,mt){this.operator=lt,this.expression=mt}evaluate(){const lt=s_[this.operator];if(!lt)throw new Error(`unexpected unary operator: '${this.operator}`);return lt(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function bv(Ct){return(lt,mt)=>{for(let Tt=0;Tt<Ct.length;Tt++){const Vt=Ct[Tt](lt,mt);if(Vt!=="")return Vt}return""}}function tm(Ct,lt){var mt;const Tt=Ct.substr(lt).match(/^\s+/);return(mt=Tt&&Tt[0])!==null&&mt!==void 0?mt:""}function Ms(Ct,lt){var mt;const Tt=Ct.substr(lt).match(/^[0-9]+/);return(mt=Tt&&Tt[0])!==null&&mt!==void 0?mt:""}function wv(Ct,lt){const mt=Ct.substr(lt,1);if(lt+=1,mt.toLowerCase()!=="e")return"";const Tt=function(Vt,wn){const Tn=Ms(Vt,wn);if(Tn!=="")return Tn;const or=Vt.substr(wn,1);if(or!=="-"&&or!=="+")return"";const Mr=Ms(Vt,wn+=1);return Mr===""?"":or+Mr}(Ct,lt);return Tt===""?"":mt+Tt}function m0(Ct,lt){const mt=Ct.substr(lt,1);if(mt==="0")return mt;const Tt=function(Vt,wn){const Tn=Vt.substr(wn,1);return Tn.match(/^[1-9]$/)?Tn:""}(Ct,lt);return lt+=Tt.length,Tt===""?"":Tt+Ms(Ct,lt)}const N_=bv([function(Ct,lt){const mt=m0(Ct,lt);if(lt+=mt.length,mt==="")return"";const Tt=Ct.substr(lt,1);if(lt+=Tt.length,Tt!==".")return"";const Vt=Ms(Ct,lt);return mt+Tt+Vt+wv(Ct,lt+=Vt.length)},function(Ct,lt){const mt=Ct.substr(lt,1);if(lt+=mt.length,mt!==".")return"";const Tt=Ms(Ct,lt);return lt+=Tt.length,Tt===""?"":mt+Tt+wv(Ct,lt)},function(Ct,lt){const mt=m0(Ct,lt);return lt+=mt.length,mt===""?"":mt+wv(Ct,lt)}]),o_=bv([function(Ct,lt){const mt=Ct.substr(lt,2);if(lt+=mt.length,mt.toLowerCase()!=="0b")return"";const Tt=function(Vt,wn){var Tn;const or=Vt.substr(wn).match(/^[01]+/);return(Tn=or&&or[0])!==null&&Tn!==void 0?Tn:""}(Ct,lt);return Tt===""?"":mt+Tt},function(Ct,lt){const mt=Ct.substr(lt,2);if(lt+=mt.length,mt.toLowerCase()!=="0o")return"";const Tt=function(Vt,wn){var Tn;const or=Vt.substr(wn).match(/^[0-7]+/);return(Tn=or&&or[0])!==null&&Tn!==void 0?Tn:""}(Ct,lt);return Tt===""?"":mt+Tt},function(Ct,lt){const mt=Ct.substr(lt,2);if(lt+=mt.length,mt.toLowerCase()!=="0x")return"";const Tt=function(Vt,wn){var Tn;const or=Vt.substr(wn).match(/^[0-9a-f]+/i);return(Tn=or&&or[0])!==null&&Tn!==void 0?Tn:""}(Ct,lt);return Tt===""?"":mt+Tt}]),Ay=bv([o_,N_]);function lx(Ct,lt){var mt;return(mt=function(Tt,Vt){const wn=Ay(Tt,Vt);return Vt+=wn.length,wn===""?null:{evaluable:new em(wn),cursor:Vt}}(Ct,lt))!==null&&mt!==void 0?mt:function(Tt,Vt){const wn=Tt.substr(Vt,1);if(Vt+=wn.length,wn!=="(")return null;const Tn=g0(Tt,Vt);if(!Tn)return null;Vt=Tn.cursor,Vt+=tm(Tt,Vt).length;const or=Tt.substr(Vt,1);return Vt+=or.length,or!==")"?null:{evaluable:Tn.evaluable,cursor:Vt}}(Ct,lt)}function Lo(Ct,lt,mt){mt+=tm(lt,mt).length;const Tt=Ct.filter(Vt=>lt.startsWith(Vt,mt))[0];return Tt?(mt+=Tt.length,{cursor:mt+=tm(lt,mt).length,operator:Tt}):null}const ko=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((Ct,lt)=>function(mt,Tt){return(Vt,wn)=>{const Tn=mt(Vt,wn);if(!Tn)return null;wn=Tn.cursor;let or=Tn.evaluable;for(;;){const Mr=Lo(Tt,Vt,wn);if(!Mr)break;wn=Mr.cursor;const as=mt(Vt,wn);if(!as)return null;wn=as.cursor,or=new js(Mr.operator,or,as.evaluable)}return or?{cursor:wn,evaluable:or}:null}}(Ct,lt),function Ct(lt,mt){const Tt=lx(lt,mt);if(Tt)return Tt;const Vt=lt.substr(mt,1);if(mt+=Vt.length,Vt!=="+"&&Vt!=="-"&&Vt!=="~")return null;const wn=Ct(lt,mt);return wn?{cursor:mt=wn.cursor,evaluable:new yy(Vt,wn.evaluable)}:null});function g0(Ct,lt){return lt+=tm(Ct,lt).length,ko(Ct,lt)}function hu(Ct){var lt;const mt=function(Tt){const Vt=g0(Tt,0);return Vt?Vt.cursor+tm(Tt,Vt.cursor).length!==Tt.length?null:Vt.evaluable:null}(Ct);return(lt=mt==null?void 0:mt.evaluate())!==null&&lt!==void 0?lt:null}function Ym(Ct){if(typeof Ct=="number")return Ct;if(typeof Ct=="string"){const lt=hu(Ct);if(!Yt(lt))return lt}return 0}function Nl(Ct){return String(Ct)}function rs(Ct){return lt=>lt.toFixed(Math.max(Math.min(Ct,20),0))}const wu=rs(0);function Sm(Ct){return wu(Ct)+"%"}function U_(Ct){return String(Ct)}function Cm(Ct){return Ct}function Bs({primary:Ct,secondary:lt,forward:mt,backward:Tt}){let Vt=!1;function wn(Tn){Vt||(Vt=!0,Tn(),Vt=!1)}Ct.emitter.on("change",Tn=>{wn(()=>{lt.setRawValue(mt(Ct,lt),Tn.options)})}),lt.emitter.on("change",Tn=>{wn(()=>{Ct.setRawValue(Tt(Ct,lt),Tn.options)}),wn(()=>{lt.setRawValue(mt(Ct,lt),Tn.options)})}),wn(()=>{lt.setRawValue(mt(Ct,lt),{forceEmit:!1,last:!0})})}function io(Ct,lt){const mt=Ct*(lt.altKey?.1:1)*(lt.shiftKey?10:1);return lt.upKey?+mt:lt.downKey?-mt:0}function Km(Ct){return{altKey:Ct.altKey,downKey:Ct.key==="ArrowDown",shiftKey:Ct.shiftKey,upKey:Ct.key==="ArrowUp"}}function Mm(Ct){return{altKey:Ct.altKey,downKey:Ct.key==="ArrowLeft",shiftKey:Ct.shiftKey,upKey:Ct.key==="ArrowRight"}}function IS(Ct){return function(lt){return lt==="ArrowUp"||lt==="ArrowDown"}(Ct)||Ct==="ArrowLeft"||Ct==="ArrowRight"}function bp(Ct,lt){var mt,Tt;const Vt=lt.ownerDocument.defaultView,wn=lt.getBoundingClientRect();return{x:Ct.pageX-(((mt=Vt&&Vt.scrollX)!==null&&mt!==void 0?mt:0)+wn.left),y:Ct.pageY-(((Tt=Vt&&Vt.scrollY)!==null&&Tt!==void 0?Tt:0)+wn.top)}}class hs{constructor(lt){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=lt,this.emitter=new Hn,lt.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),lt.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),lt.addEventListener("touchend",this.onTouchEnd_),lt.addEventListener("mousedown",this.onMouseDown_)}computePosition_(lt){const mt=this.elem_.getBoundingClientRect();return{bounds:{width:mt.width,height:mt.height},point:lt?{x:lt.x,y:lt.y}:null}}onMouseDown_(lt){var mt;lt.preventDefault(),(mt=lt.currentTarget)===null||mt===void 0||mt.focus();const Tt=this.elem_.ownerDocument;Tt.addEventListener("mousemove",this.onDocumentMouseMove_),Tt.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:lt.altKey,data:this.computePosition_(bp(lt,this.elem_)),sender:this,shiftKey:lt.shiftKey})}onDocumentMouseMove_(lt){this.emitter.emit("move",{altKey:lt.altKey,data:this.computePosition_(bp(lt,this.elem_)),sender:this,shiftKey:lt.shiftKey})}onDocumentMouseUp_(lt){const mt=this.elem_.ownerDocument;mt.removeEventListener("mousemove",this.onDocumentMouseMove_),mt.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:lt.altKey,data:this.computePosition_(bp(lt,this.elem_)),sender:this,shiftKey:lt.shiftKey})}onTouchStart_(lt){lt.preventDefault();const mt=lt.targetTouches.item(0),Tt=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:lt.altKey,data:this.computePosition_(mt?{x:mt.clientX-Tt.left,y:mt.clientY-Tt.top}:void 0),sender:this,shiftKey:lt.shiftKey}),this.lastTouch_=mt}onTouchMove_(lt){const mt=lt.targetTouches.item(0),Tt=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:lt.altKey,data:this.computePosition_(mt?{x:mt.clientX-Tt.left,y:mt.clientY-Tt.top}:void 0),sender:this,shiftKey:lt.shiftKey}),this.lastTouch_=mt}onTouchEnd_(lt){var mt;const Tt=(mt=lt.targetTouches.item(0))!==null&&mt!==void 0?mt:this.lastTouch_,Vt=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:lt.altKey,data:this.computePosition_(Tt?{x:Tt.clientX-Vt.left,y:Tt.clientY-Vt.top}:void 0),sender:this,shiftKey:lt.shiftKey})}}function Vo(Ct,lt,mt,Tt,Vt){return Tt+(Ct-lt)/(mt-lt)*(Vt-Tt)}function Tm(Ct){return String(Ct.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function nu(Ct,lt,mt){return Math.min(Math.max(Ct,lt),mt)}function cx(Ct,lt){return(Ct%lt+lt)%lt}const nm=Xt("txt");class bo{constructor(lt,mt){this.onChange_=this.onChange_.bind(this),this.props_=mt.props,this.props_.emitter.on("change",this.onChange_),this.element=lt.createElement("div"),this.element.classList.add(nm(),nm(void 0,"num")),mt.arrayPosition&&this.element.classList.add(nm(void 0,mt.arrayPosition)),mt.viewProps.bindClassModifiers(this.element);const Tt=lt.createElement("input");Tt.classList.add(nm("i")),Tt.type="text",mt.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.inputElement=Tt,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=mt.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(nm()),this.inputElement.classList.add(nm("i"));const Vt=lt.createElement("div");Vt.classList.add(nm("k")),this.element.appendChild(Vt),this.knobElement=Vt;const wn=lt.createElementNS(Qn,"svg");wn.classList.add(nm("g")),this.knobElement.appendChild(wn);const Tn=lt.createElementNS(Qn,"path");Tn.classList.add(nm("gb")),wn.appendChild(Tn),this.guideBodyElem_=Tn;const or=lt.createElementNS(Qn,"path");or.classList.add(nm("gh")),wn.appendChild(or),this.guideHeadElem_=or;const Mr=lt.createElement("div");Mr.classList.add(Xt("tt")()),this.knobElement.appendChild(Mr),this.tooltipElem_=Mr,mt.value.emitter.on("change",this.onChange_),this.value=mt.value,this.refresh()}onDraggingChange_(lt){if(lt.rawValue===null)return void this.element.classList.remove(nm(void 0,"drg"));this.element.classList.add(nm(void 0,"drg"));const mt=lt.rawValue/this.props_.get("draggingScale"),Tt=mt+(mt>0?-1:mt<0?1:0),Vt=nu(-Tt,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${Tt+Vt},0 L${Tt},4 L${Tt+Vt},8`,`M ${mt},-1 L${mt},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${mt},4`);const wn=this.props_.get("formatter");this.tooltipElem_.textContent=wn(this.value.rawValue),this.tooltipElem_.style.left=`${mt}px`}refresh(){const lt=this.props_.get("formatter");this.inputElement.value=lt(this.value.rawValue)}onChange_(){this.refresh()}}class LA{constructor(lt,mt){var Tt;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=mt.baseStep,this.parser_=mt.parser,this.props=mt.props,this.sliderProps_=(Tt=mt.sliderProps)!==null&&Tt!==void 0?Tt:null,this.value=mt.value,this.viewProps=mt.viewProps,this.dragging_=an(null),this.view=new bo(lt,{arrayPosition:mt.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const Vt=new hs(this.view.knobElement);Vt.emitter.on("down",this.onPointerDown_),Vt.emitter.on("move",this.onPointerMove_),Vt.emitter.on("up",this.onPointerUp_)}constrainValue_(lt){var mt,Tt;const Vt=(mt=this.sliderProps_)===null||mt===void 0?void 0:mt.get("minValue"),wn=(Tt=this.sliderProps_)===null||Tt===void 0?void 0:Tt.get("maxValue");let Tn=lt;return Vt!==void 0&&(Tn=Math.max(Tn,Vt)),wn!==void 0&&(Tn=Math.min(Tn,wn)),Tn}onInputChange_(lt){const mt=lt.currentTarget.value,Tt=this.parser_(mt);Yt(Tt)||(this.value.rawValue=this.constrainValue_(Tt)),this.view.refresh()}onInputKeyDown_(lt){const mt=io(this.baseStep_,Km(lt));mt!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+mt),{forceEmit:!1,last:!1})}onInputKeyUp_(lt){io(this.baseStep_,Km(lt))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(lt){if(!lt.point)return null;const mt=lt.point.x-lt.bounds.width/2;return this.constrainValue_(this.originRawValue_+mt*this.props.get("draggingScale"))}onPointerMove_(lt){const mt=this.computeDraggingValue_(lt.data);mt!==null&&(this.value.setRawValue(mt,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(lt){const mt=this.computeDraggingValue_(lt.data);mt!==null&&(this.value.setRawValue(mt,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const ux=Xt("sld");class PS{constructor(lt,mt){this.onChange_=this.onChange_.bind(this),this.props_=mt.props,this.props_.emitter.on("change",this.onChange_),this.element=lt.createElement("div"),this.element.classList.add(ux()),mt.viewProps.bindClassModifiers(this.element);const Tt=lt.createElement("div");Tt.classList.add(ux("t")),mt.viewProps.bindTabIndex(Tt),this.element.appendChild(Tt),this.trackElement=Tt;const Vt=lt.createElement("div");Vt.classList.add(ux("k")),this.trackElement.appendChild(Vt),this.knobElement=Vt,mt.value.emitter.on("change",this.onChange_),this.value=mt.value,this.update_()}update_(){const lt=nu(Vo(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${lt}%`}onChange_(){this.update_()}}class RS{constructor(lt,mt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=mt.baseStep,this.value=mt.value,this.viewProps=mt.viewProps,this.props=mt.props,this.view=new PS(lt,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new hs(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(lt,mt){lt.point&&this.value.setRawValue(Vo(nu(lt.point.x,0,lt.bounds.width),0,lt.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),mt)}onPointerDownOrMove_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!1,last:!1})}onPointerUp_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!0,last:!0})}onKeyDown_(lt){const mt=io(this.baseStep_,Mm(lt));mt!==0&&this.value.setRawValue(this.value.rawValue+mt,{forceEmit:!1,last:!1})}onKeyUp_(lt){io(this.baseStep_,Mm(lt))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const k1=Xt("sldtxt");class B1{constructor(lt,mt){this.element=lt.createElement("div"),this.element.classList.add(k1());const Tt=lt.createElement("div");Tt.classList.add(k1("s")),this.sliderView_=mt.sliderView,Tt.appendChild(this.sliderView_.element),this.element.appendChild(Tt);const Vt=lt.createElement("div");Vt.classList.add(k1("t")),this.textView_=mt.textView,Vt.appendChild(this.textView_.element),this.element.appendChild(Vt)}}class by{constructor(lt,mt){this.value=mt.value,this.viewProps=mt.viewProps,this.sliderC_=new RS(lt,{baseStep:mt.baseStep,props:mt.sliderProps,value:mt.value,viewProps:this.viewProps}),this.textC_=new LA(lt,{baseStep:mt.baseStep,parser:mt.parser,props:mt.textProps,sliderProps:mt.sliderProps,value:mt.value,viewProps:mt.viewProps}),this.view=new B1(lt,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Jm(Ct,lt){Ct.write(lt)}function Qu(Ct){const lt=vr;return Array.isArray(Ct)?lt.required.array(lt.required.object({text:lt.required.string,value:lt.required.raw}))(Ct).value:typeof Ct=="object"?lt.required.raw(Ct).value:void 0}function hx(Ct){if(Ct==="inline"||Ct==="popup")return Ct}function Wu(Ct){const lt=vr;return lt.required.object({max:lt.optional.number,min:lt.optional.number,step:lt.optional.number})(Ct).value}function NA(Ct){if(Array.isArray(Ct))return Ct;const lt=[];return Object.keys(Ct).forEach(mt=>{lt.push({text:mt,value:Ct[mt]})}),lt}function UA(Ct){return Yt(Ct)?null:new i_(NA(Ct))}function dx(Ct,lt){const mt=Ct&&_f(Ct,_y);return mt?Tm(mt.step):Math.max(Tm(lt),2)}function v0(Ct){const lt=function(mt){const Tt=mt?_f(mt,_y):null;return Tt?Tt.step:null}(Ct);return lt??1}function _0(Ct,lt){var mt;const Tt=Ct&&_f(Ct,_y),Vt=Math.abs((mt=Tt==null?void 0:Tt.step)!==null&&mt!==void 0?mt:lt);return Vt===0?.1:Math.pow(10,Math.floor(Math.log10(Vt))-1)}const yl=Xt("ckb");class wy{constructor(lt,mt){this.onValueChange_=this.onValueChange_.bind(this),this.element=lt.createElement("div"),this.element.classList.add(yl()),mt.viewProps.bindClassModifiers(this.element);const Tt=lt.createElement("label");Tt.classList.add(yl("l")),this.element.appendChild(Tt);const Vt=lt.createElement("input");Vt.classList.add(yl("i")),Vt.type="checkbox",Tt.appendChild(Vt),this.inputElement=Vt,mt.viewProps.bindDisabled(this.inputElement);const wn=lt.createElement("div");wn.classList.add(yl("w")),Tt.appendChild(wn);const Tn=fo(lt,"check");wn.appendChild(Tn),mt.value.emitter.on("change",this.onValueChange_),this.value=mt.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class FA{constructor(lt,mt){this.onInputChange_=this.onInputChange_.bind(this),this.value=mt.value,this.viewProps=mt.viewProps,this.view=new wy(lt,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(lt){const mt=lt.currentTarget;this.value.rawValue=mt.checked}}const $m={id:"input-bool",type:"input",accept:(Ct,lt)=>{if(typeof Ct!="boolean")return null;const mt=Wn(lt,{options:vr.optional.custom(Qu)});return mt?{initialValue:Ct,params:mt}:null},binding:{reader:Ct=>es,constraint:Ct=>function(lt){const mt=[],Tt=UA(lt.options);return Tt&&mt.push(Tt),new L_(mt)}(Ct.params),writer:Ct=>Jm},controller:Ct=>{const lt=Ct.document,mt=Ct.value,Tt=Ct.constraint,Vt=Tt&&_f(Tt,i_);return Vt?new r_(lt,{props:new yn({options:Vt.values.value("options")}),value:mt,viewProps:Ct.viewProps}):new FA(lt,{value:mt,viewProps:Ct.viewProps})}},Al=Xt("col");class DS{constructor(lt,mt){this.element=lt.createElement("div"),this.element.classList.add(Al()),mt.foldable.bindExpandedClass(this.element,Al(void 0,"expanded")),An(mt.foldable,"completed",kn(this.element,Al(void 0,"cpl")));const Tt=lt.createElement("div");Tt.classList.add(Al("h")),this.element.appendChild(Tt);const Vt=lt.createElement("div");Vt.classList.add(Al("s")),Tt.appendChild(Vt),this.swatchElement=Vt;const wn=lt.createElement("div");if(wn.classList.add(Al("t")),Tt.appendChild(wn),this.textElement=wn,mt.pickerLayout==="inline"){const Tn=lt.createElement("div");Tn.classList.add(Al("p")),this.element.appendChild(Tn),this.pickerElement=Tn}else this.pickerElement=null}}function a_(Ct,lt,mt){const Tt=cx(Ct,360),Vt=nu(lt/100,0,1),wn=nu(mt/100,0,1),Tn=wn*Vt,or=Tn*(1-Math.abs(Tt/60%2-1)),Mr=wn-Tn;let as,Gs,Wo;return[as,Gs,Wo]=Tt>=0&&Tt<60?[Tn,or,0]:Tt>=60&&Tt<120?[or,Tn,0]:Tt>=120&&Tt<180?[0,Tn,or]:Tt>=180&&Tt<240?[0,or,Tn]:Tt>=240&&Tt<300?[or,0,Tn]:[Tn,0,or],[255*(as+Mr),255*(Gs+Mr),255*(Wo+Mr)]}function Im(Ct){return[Ct[0],Ct[1],Ct[2]]}function Fp(Ct,lt){return[Ct[0],Ct[1],Ct[2],lt]}const Is={hsl:{hsl:(Ct,lt,mt)=>[Ct,lt,mt],hsv:function(Ct,lt,mt){const Tt=mt+lt*(100-Math.abs(2*mt-100))/200;return[Ct,Tt!==0?lt*(100-Math.abs(2*mt-100))/Tt:0,mt+lt*(100-Math.abs(2*mt-100))/200]},rgb:function(Ct,lt,mt){const Tt=(Ct%360+360)%360,Vt=nu(lt/100,0,1),wn=nu(mt/100,0,1),Tn=(1-Math.abs(2*wn-1))*Vt,or=Tn*(1-Math.abs(Tt/60%2-1)),Mr=wn-Tn/2;let as,Gs,Wo;return[as,Gs,Wo]=Tt>=0&&Tt<60?[Tn,or,0]:Tt>=60&&Tt<120?[or,Tn,0]:Tt>=120&&Tt<180?[0,Tn,or]:Tt>=180&&Tt<240?[0,or,Tn]:Tt>=240&&Tt<300?[or,0,Tn]:[Tn,0,or],[255*(as+Mr),255*(Gs+Mr),255*(Wo+Mr)]}},hsv:{hsl:function(Ct,lt,mt){const Tt=100-Math.abs(mt*(200-lt)/100-100);return[Ct,Tt!==0?lt*mt/Tt:0,mt*(200-lt)/200]},hsv:(Ct,lt,mt)=>[Ct,lt,mt],rgb:a_},rgb:{hsl:function(Ct,lt,mt){const Tt=nu(Ct/255,0,1),Vt=nu(lt/255,0,1),wn=nu(mt/255,0,1),Tn=Math.max(Tt,Vt,wn),or=Math.min(Tt,Vt,wn),Mr=Tn-or;let as=0,Gs=0;const Wo=(or+Tn)/2;return Mr!==0&&(Gs=Mr/(1-Math.abs(Tn+or-1)),as=Tt===Tn?(Vt-wn)/Mr:Vt===Tn?2+(wn-Tt)/Mr:4+(Tt-Vt)/Mr,as=as/6+(as<0?1:0)),[360*as,100*Gs,100*Wo]},hsv:function(Ct,lt,mt){const Tt=nu(Ct/255,0,1),Vt=nu(lt/255,0,1),wn=nu(mt/255,0,1),Tn=Math.max(Tt,Vt,wn),or=Tn-Math.min(Tt,Vt,wn);let Mr;return Mr=or===0?0:Tn===Tt?((Vt-wn)/or%6+6)%6*60:Tn===Vt?60*((wn-Tt)/or+2):60*((Tt-Vt)/or+4),[Mr,100*(Tn===0?0:or/Tn),100*Tn]},rgb:(Ct,lt,mt)=>[Ct,lt,mt]}};function xy(Ct,lt){return[lt==="float"?1:Ct==="rgb"?255:360,lt==="float"?1:Ct==="rgb"?255:100,lt==="float"?1:Ct==="rgb"?255:100]}function Ey(Ct,lt,mt,Tt){const Vt=xy(lt,mt),wn=xy(lt,Tt);return Ct.map((Tn,or)=>Tn/Vt[or]*wn[or])}function Sy(Ct,lt){return typeof Ct=="object"&&!Yt(Ct)&&lt in Ct&&typeof Ct[lt]=="number"}class Ao{static black(lt="int"){return new Ao([0,0,0],"rgb",lt)}static fromObject(lt,mt="int"){const Tt="a"in lt?[lt.r,lt.g,lt.b,lt.a]:[lt.r,lt.g,lt.b];return new Ao(Tt,"rgb",mt)}static toRgbaObject(lt,mt="int"){return lt.toRgbaObject(mt)}static isRgbColorObject(lt){return Sy(lt,"r")&&Sy(lt,"g")&&Sy(lt,"b")}static isRgbaColorObject(lt){return this.isRgbColorObject(lt)&&Sy(lt,"a")}static isColorObject(lt){return this.isRgbColorObject(lt)}static equals(lt,mt){if(lt.mode!==mt.mode)return!1;const Tt=lt.comps_,Vt=mt.comps_;for(let wn=0;wn<Tt.length;wn++)if(Tt[wn]!==Vt[wn])return!1;return!0}constructor(lt,mt,Tt="int"){this.mode=mt,this.type=Tt,this.comps_=function(Vt,wn,Tn){var or;const Mr=xy(wn,Tn);return[wn==="rgb"?nu(Vt[0],0,Mr[0]):(as=Vt[0],Gs=Mr[0],as===Gs?Gs:cx(as,Gs)),nu(Vt[1],0,Mr[1]),nu(Vt[2],0,Mr[2]),nu((or=Vt[3])!==null&&or!==void 0?or:1,0,1)];var as,Gs}(lt,mt,Tt)}getComponents(lt,mt="int"){return Fp(function(Tt,Vt,wn){const Tn=Ey(Tt,Vt.mode,Vt.type,"int");return Ey(Is[Vt.mode][wn.mode](...Tn),wn.mode,"int",wn.type)}(Im(this.comps_),{mode:this.mode,type:this.type},{mode:lt??this.mode,type:mt}),this.comps_[3])}toRgbaObject(lt="int"){const mt=this.getComponents("rgb",lt);return{r:mt[0],g:mt[1],b:mt[2],a:mt[3]}}}const l_=Xt("colp");class im{constructor(lt,mt){this.alphaViews_=null,this.element=lt.createElement("div"),this.element.classList.add(l_()),mt.viewProps.bindClassModifiers(this.element);const Tt=lt.createElement("div");Tt.classList.add(l_("hsv"));const Vt=lt.createElement("div");Vt.classList.add(l_("sv")),this.svPaletteView_=mt.svPaletteView,Vt.appendChild(this.svPaletteView_.element),Tt.appendChild(Vt);const wn=lt.createElement("div");wn.classList.add(l_("h")),this.hPaletteView_=mt.hPaletteView,wn.appendChild(this.hPaletteView_.element),Tt.appendChild(wn),this.element.appendChild(Tt);const Tn=lt.createElement("div");if(Tn.classList.add(l_("rgb")),this.textView_=mt.textView,Tn.appendChild(this.textView_.element),this.element.appendChild(Tn),mt.alphaViews){this.alphaViews_={palette:mt.alphaViews.palette,text:mt.alphaViews.text};const or=lt.createElement("div");or.classList.add(l_("a"));const Mr=lt.createElement("div");Mr.classList.add(l_("ap")),Mr.appendChild(this.alphaViews_.palette.element),or.appendChild(Mr);const as=lt.createElement("div");as.classList.add(l_("at")),as.appendChild(this.alphaViews_.text.element),or.appendChild(as),this.element.appendChild(or)}}get allFocusableElements(){const lt=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(mt=>mt.inputElement)];return this.alphaViews_&&lt.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),lt}}function ho(Ct){return Ct==="int"?"int":Ct==="float"?"float":void 0}function O1(Ct){const lt=vr;return Wn(Ct,{alpha:lt.optional.boolean,color:lt.optional.object({alpha:lt.optional.boolean,type:lt.optional.custom(ho)}),expanded:lt.optional.boolean,picker:lt.optional.custom(hx)})}function Br(Ct){return Ct?.1:1}function oo(Ct){var lt;return(lt=Ct.color)===null||lt===void 0?void 0:lt.type}function jp(Ct,lt){const mt=Ct.match(/^(.+)%$/);return Math.min(mt?.01*parseFloat(mt[1])*lt:parseFloat(Ct),lt)}const kS={deg:Ct=>Ct,grad:Ct=>360*Ct/400,rad:Ct=>360*Ct/(2*Math.PI),turn:Ct=>360*Ct};function BS(Ct){const lt=Ct.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!lt)return parseFloat(Ct);const mt=parseFloat(lt[1]),Tt=lt[2];return kS[Tt](mt)}function y0(Ct){const lt=Ct.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!lt)return null;const mt=[jp(lt[1],255),jp(lt[2],255),jp(lt[3],255)];return isNaN(mt[0])||isNaN(mt[1])||isNaN(mt[2])?null:mt}function Cy(Ct){return lt=>{const mt=y0(lt);return mt?new Ao(mt,"rgb",Ct):null}}function px(Ct){const lt=Ct.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!lt)return null;const mt=[jp(lt[1],255),jp(lt[2],255),jp(lt[3],255),jp(lt[4],1)];return isNaN(mt[0])||isNaN(mt[1])||isNaN(mt[2])||isNaN(mt[3])?null:mt}function A0(Ct){return lt=>{const mt=px(lt);return mt?new Ao(mt,"rgb",Ct):null}}function b0(Ct){const lt=Ct.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!lt)return null;const mt=[BS(lt[1]),jp(lt[2],100),jp(lt[3],100)];return isNaN(mt[0])||isNaN(mt[1])||isNaN(mt[2])?null:mt}function fx(Ct){return lt=>{const mt=b0(lt);return mt?new Ao(mt,"hsl",Ct):null}}function OS(Ct){const lt=Ct.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!lt)return null;const mt=[BS(lt[1]),jp(lt[2],100),jp(lt[3],100),jp(lt[4],1)];return isNaN(mt[0])||isNaN(mt[1])||isNaN(mt[2])||isNaN(mt[3])?null:mt}function L1(Ct){return lt=>{const mt=OS(lt);return mt?new Ao(mt,"hsl",Ct):null}}function LS(Ct){const lt=Ct.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(lt)return[parseInt(lt[1]+lt[1],16),parseInt(lt[2]+lt[2],16),parseInt(lt[3]+lt[3],16)];const mt=Ct.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return mt?[parseInt(mt[1],16),parseInt(mt[2],16),parseInt(mt[3],16)]:null}function NS(Ct){const lt=Ct.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(lt)return[parseInt(lt[1]+lt[1],16),parseInt(lt[2]+lt[2],16),parseInt(lt[3]+lt[3],16),Vo(parseInt(lt[4]+lt[4],16),0,255,0,1)];const mt=Ct.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return mt?[parseInt(mt[1],16),parseInt(mt[2],16),parseInt(mt[3],16),Vo(parseInt(mt[4],16),0,255,0,1)]:null}function Pl(Ct){const lt=Ct.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!lt)return null;const mt=[parseFloat(lt[1]),parseFloat(lt[2]),parseFloat(lt[3])];return isNaN(mt[0])||isNaN(mt[1])||isNaN(mt[2])?null:mt}function Pm(Ct){return lt=>{const mt=Pl(lt);return mt?new Ao(mt,"rgb",Ct):null}}function jA(Ct){const lt=Ct.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!lt)return null;const mt=[parseFloat(lt[1]),parseFloat(lt[2]),parseFloat(lt[3]),parseFloat(lt[4])];return isNaN(mt[0])||isNaN(mt[1])||isNaN(mt[2])||isNaN(mt[3])?null:mt}function c_(Ct){return lt=>{const mt=jA(lt);return mt?new Ao(mt,"rgb",Ct):null}}const zA=[{parser:LS,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:NS,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:y0,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:px,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:b0,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:OS,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Pl,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:jA,result:{alpha:!0,mode:"rgb",notation:"object"}}];function VA(Ct,lt="int"){const mt=function(Tt){return zA.reduce((Vt,{parser:wn,result:Tn})=>Vt||(wn(Tt)?Tn:null),null)}(Ct);return mt?mt.notation==="hex"&&lt!=="float"?Object.assign(Object.assign({},mt),{type:"int"}):mt.notation==="func"?Object.assign(Object.assign({},mt),{type:lt}):null:null}const ga={int:[function(Ct){const lt=LS(Ct);return lt?new Ao(lt,"rgb","int"):null},function(Ct){const lt=NS(Ct);return lt?new Ao(lt,"rgb","int"):null},Cy("int"),A0("int"),fx("int"),L1("int"),Pm("int"),c_("int")],float:[Cy("float"),A0("float"),fx("float"),L1("float"),Pm("float"),c_("float")]};function No(Ct){const lt=ga[Ct];return mt=>lt.reduce((Tt,Vt)=>Tt||Vt(mt),null)}function xu(Ct){const lt=nu(Math.floor(Ct),0,255).toString(16);return lt.length===1?`0${lt}`:lt}function rm(Ct,lt="#"){return`${lt}${Im(Ct.getComponents("rgb")).map(xu).join("")}`}function N1(Ct,lt="#"){const mt=Ct.getComponents("rgb");return`${lt}${[mt[0],mt[1],mt[2],255*mt[3]].map(xu).join("")}`}function mx(Ct,lt){const mt=rs(lt==="float"?2:0);return`rgb(${Im(Ct.getComponents("rgb",lt)).map(Tt=>mt(Tt)).join(", ")})`}function US(Ct){return lt=>mx(lt,Ct)}function My(Ct,lt){const mt=rs(2),Tt=rs(lt==="float"?2:0);return`rgba(${Ct.getComponents("rgb",lt).map((Vt,wn)=>(wn===3?mt:Tt)(Vt)).join(", ")})`}function zp(Ct){return lt=>My(lt,Ct)}function Rn(Ct,lt){const mt=rs(lt==="float"?2:0),Tt=["r","g","b"];return`{${Im(Ct.getComponents("rgb",lt)).map((Vt,wn)=>`${Tt[wn]}: ${mt(Vt)}`).join(", ")}}`}function gx(Ct){return lt=>Rn(lt,Ct)}function vx(Ct,lt){const mt=rs(2),Tt=rs(lt==="float"?2:0),Vt=["r","g","b","a"];return`{${Ct.getComponents("rgb",lt).map((wn,Tn)=>`${Vt[Tn]}: ${(Tn===3?mt:Tt)(wn)}`).join(", ")}}`}function Zm(Ct){return lt=>vx(lt,Ct)}const xv=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:rm},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:N1},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(Ct){const lt=[rs(0),Sm,Sm];return`hsl(${Im(Ct.getComponents("hsl")).map((mt,Tt)=>lt[Tt](mt)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(Ct){const lt=[rs(0),Sm,Sm,rs(2)];return`hsla(${Ct.getComponents("hsl").map((mt,Tt)=>lt[Tt](mt)).join(", ")})`}},...["int","float"].reduce((Ct,lt)=>[...Ct,{format:{alpha:!1,mode:"rgb",notation:"func",type:lt},stringifier:US(lt)},{format:{alpha:!0,mode:"rgb",notation:"func",type:lt},stringifier:zp(lt)},{format:{alpha:!1,mode:"rgb",notation:"object",type:lt},stringifier:gx(lt)},{format:{alpha:!0,mode:"rgb",notation:"object",type:lt},stringifier:Zm(lt)}],[])];function rp(Ct){return xv.reduce((lt,mt)=>{return lt||(Tt=mt.format,Vt=Ct,Tt.alpha===Vt.alpha&&Tt.mode===Vt.mode&&Tt.notation===Vt.notation&&Tt.type===Vt.type?mt.stringifier:null);var Tt,Vt},null)}const iu=Xt("apl");class w0{constructor(lt,mt){this.onValueChange_=this.onValueChange_.bind(this),this.value=mt.value,this.value.emitter.on("change",this.onValueChange_),this.element=lt.createElement("div"),this.element.classList.add(iu()),mt.viewProps.bindClassModifiers(this.element),mt.viewProps.bindTabIndex(this.element);const Tt=lt.createElement("div");Tt.classList.add(iu("b")),this.element.appendChild(Tt);const Vt=lt.createElement("div");Vt.classList.add(iu("c")),Tt.appendChild(Vt),this.colorElem_=Vt;const wn=lt.createElement("div");wn.classList.add(iu("m")),this.element.appendChild(wn),this.markerElem_=wn;const Tn=lt.createElement("div");Tn.classList.add(iu("p")),this.markerElem_.appendChild(Tn),this.previewElem_=Tn,this.update_()}update_(){const lt=this.value.rawValue,mt=lt.getComponents("rgb"),Tt=new Ao([mt[0],mt[1],mt[2],0],"rgb"),Vt=new Ao([mt[0],mt[1],mt[2],255],"rgb"),wn=["to right",My(Tt),My(Vt)];this.colorElem_.style.background=`linear-gradient(${wn.join(",")})`,this.previewElem_.style.backgroundColor=My(lt);const Tn=Vo(mt[3],0,1,0,100);this.markerElem_.style.left=`${Tn}%`}onValueChange_(){this.update_()}}class Rm{constructor(lt,mt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=mt.value,this.viewProps=mt.viewProps,this.view=new w0(lt,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new hs(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(lt,mt){if(!lt.point)return;const Tt=lt.point.x/lt.bounds.width,Vt=this.value.rawValue,[wn,Tn,or]=Vt.getComponents("hsv");this.value.setRawValue(new Ao([wn,Tn,or,Tt],"hsv"),mt)}onPointerDown_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!1,last:!1})}onPointerMove_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!1,last:!1})}onPointerUp_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!0,last:!0})}onKeyDown_(lt){const mt=io(Br(!0),Mm(lt));if(mt===0)return;const Tt=this.value.rawValue,[Vt,wn,Tn,or]=Tt.getComponents("hsv");this.value.setRawValue(new Ao([Vt,wn,Tn,or+mt],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(lt){io(Br(!0),Mm(lt))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const qu=Xt("coltxt");class Ru{constructor(lt,mt){this.element=lt.createElement("div"),this.element.classList.add(qu()),mt.viewProps.bindClassModifiers(this.element);const Tt=lt.createElement("div");Tt.classList.add(qu("m")),this.modeElem_=function(Tn){const or=Tn.createElement("select");return or.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((Mr,as)=>{const Gs=Tn.createElement("option");return Gs.textContent=as.text,Gs.value=as.value,Mr.appendChild(Gs),Mr},Tn.createDocumentFragment())),or}(lt),this.modeElem_.classList.add(qu("ms")),Tt.appendChild(this.modeSelectElement),mt.viewProps.bindDisabled(this.modeElem_);const Vt=lt.createElement("div");Vt.classList.add(qu("mm")),Vt.appendChild(fo(lt,"dropdown")),Tt.appendChild(Vt),this.element.appendChild(Tt);const wn=lt.createElement("div");wn.classList.add(qu("w")),this.element.appendChild(wn),this.textsElem_=wn,this.textViews_=mt.textViews,this.applyTextViews_(),Nn(mt.colorMode,Tn=>{this.modeElem_.value=Tn})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(lt){this.textViews_=lt,this.applyTextViews_()}applyTextViews_(){Mo(this.textsElem_);const lt=this.element.ownerDocument;this.textViews_.forEach(mt=>{const Tt=lt.createElement("div");Tt.classList.add(qu("c")),Tt.appendChild(mt.element),this.textsElem_.appendChild(Tt)})}}function F_(Ct,lt,mt){const Tt=xy(Ct,lt)[mt];return new tu({min:0,max:Tt})}function u_(Ct,lt,mt){return new LA(Ct,{arrayPosition:mt===0?"fst":mt===2?"lst":"mid",baseStep:Br(!1),parser:lt.parser,props:yn.fromObject({draggingScale:lt.colorType==="float"?.01:1,formatter:(Tt=lt.colorType,rs(Tt==="float"?2:0))}),value:an(0,{constraint:F_(lt.colorMode,lt.colorType,mt)}),viewProps:lt.viewProps});var Tt}class GA{constructor(lt,mt){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=mt.colorType,this.parser_=mt.parser,this.value=mt.value,this.viewProps=mt.viewProps,this.colorMode=an(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(lt),this.view=new Ru(lt,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(lt){const mt={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},Tt=[u_(lt,mt,0),u_(lt,mt,1),u_(lt,mt,2)];return Tt.forEach((Vt,wn)=>{Bs({primary:this.value,secondary:Vt.value,forward:Tn=>Tn.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[wn],backward:(Tn,or)=>{const Mr=this.colorMode.rawValue,as=Tn.rawValue.getComponents(Mr,this.colorType_);return as[wn]=or.rawValue,new Ao(Fp(Im(as),as[3]),Mr,this.colorType_)}})}),Tt}onModeSelectChange_(lt){const mt=lt.currentTarget;this.colorMode.rawValue=mt.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const x0=Xt("hpl");class E0{constructor(lt,mt){this.onValueChange_=this.onValueChange_.bind(this),this.value=mt.value,this.value.emitter.on("change",this.onValueChange_),this.element=lt.createElement("div"),this.element.classList.add(x0()),mt.viewProps.bindClassModifiers(this.element),mt.viewProps.bindTabIndex(this.element);const Tt=lt.createElement("div");Tt.classList.add(x0("c")),this.element.appendChild(Tt);const Vt=lt.createElement("div");Vt.classList.add(x0("m")),this.element.appendChild(Vt),this.markerElem_=Vt,this.update_()}update_(){const lt=this.value.rawValue,[mt]=lt.getComponents("hsv");this.markerElem_.style.backgroundColor=mx(new Ao([mt,100,100],"hsv"));const Tt=Vo(mt,0,360,0,100);this.markerElem_.style.left=`${Tt}%`}onValueChange_(){this.update_()}}class Ev{constructor(lt,mt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=mt.value,this.viewProps=mt.viewProps,this.view=new E0(lt,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new hs(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(lt,mt){if(!lt.point)return;const Tt=Vo(nu(lt.point.x,0,lt.bounds.width),0,lt.bounds.width,0,360),Vt=this.value.rawValue,[,wn,Tn,or]=Vt.getComponents("hsv");this.value.setRawValue(new Ao([Tt,wn,Tn,or],"hsv"),mt)}onPointerDown_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!1,last:!1})}onPointerMove_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!1,last:!1})}onPointerUp_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!0,last:!0})}onKeyDown_(lt){const mt=io(Br(!1),Mm(lt));if(mt===0)return;const Tt=this.value.rawValue,[Vt,wn,Tn,or]=Tt.getComponents("hsv");this.value.setRawValue(new Ao([Vt+mt,wn,Tn,or],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(lt){io(Br(!1),Mm(lt))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const j_=Xt("svp");class _x{constructor(lt,mt){this.onValueChange_=this.onValueChange_.bind(this),this.value=mt.value,this.value.emitter.on("change",this.onValueChange_),this.element=lt.createElement("div"),this.element.classList.add(j_()),mt.viewProps.bindClassModifiers(this.element),mt.viewProps.bindTabIndex(this.element);const Tt=lt.createElement("canvas");Tt.height=64,Tt.width=64,Tt.classList.add(j_("c")),this.element.appendChild(Tt),this.canvasElement=Tt;const Vt=lt.createElement("div");Vt.classList.add(j_("m")),this.element.appendChild(Vt),this.markerElem_=Vt,this.update_()}update_(){const lt=function(as){const Gs=as.ownerDocument.defaultView;return Gs&&"document"in Gs?as.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!lt)return;const mt=this.value.rawValue.getComponents("hsv"),Tt=this.canvasElement.width,Vt=this.canvasElement.height,wn=lt.getImageData(0,0,Tt,Vt),Tn=wn.data;for(let as=0;as<Vt;as++)for(let Gs=0;Gs<Tt;Gs++){const Wo=Vo(Gs,0,Tt,0,100),Ku=Vo(as,0,Vt,100,0),Bu=a_(mt[0],Wo,Ku),Om=4*(as*Tt+Gs);Tn[Om]=Bu[0],Tn[Om+1]=Bu[1],Tn[Om+2]=Bu[2],Tn[Om+3]=255}lt.putImageData(wn,0,0);const or=Vo(mt[1],0,100,0,100);this.markerElem_.style.left=`${or}%`;const Mr=Vo(mt[2],0,100,100,0);this.markerElem_.style.top=`${Mr}%`}onValueChange_(){this.update_()}}class HA{constructor(lt,mt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=mt.value,this.viewProps=mt.viewProps,this.view=new _x(lt,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new hs(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(lt,mt){if(!lt.point)return;const Tt=Vo(lt.point.x,0,lt.bounds.width,0,100),Vt=Vo(lt.point.y,0,lt.bounds.height,100,0),[wn,,,Tn]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Ao([wn,Tt,Vt,Tn],"hsv"),mt)}onPointerDown_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!1,last:!1})}onPointerMove_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!1,last:!1})}onPointerUp_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!0,last:!0})}onKeyDown_(lt){IS(lt.key)&&lt.preventDefault();const[mt,Tt,Vt,wn]=this.value.rawValue.getComponents("hsv"),Tn=Br(!1),or=io(Tn,Mm(lt)),Mr=io(Tn,Km(lt));or===0&&Mr===0||this.value.setRawValue(new Ao([mt,Tt+or,Vt+Mr,wn],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(lt){const mt=Br(!1),Tt=io(mt,Mm(lt)),Vt=io(mt,Km(lt));Tt===0&&Vt===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class U1{constructor(lt,mt){this.value=mt.value,this.viewProps=mt.viewProps,this.hPaletteC_=new Ev(lt,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new HA(lt,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=mt.supportsAlpha?{palette:new Rm(lt,{value:this.value,viewProps:this.viewProps}),text:new LA(lt,{parser:hu,baseStep:.1,props:yn.fromObject({draggingScale:.01,formatter:rs(2)}),value:an(0,{constraint:new tu({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Bs({primary:this.value,secondary:this.alphaIcs_.text.value,forward:Tt=>Tt.rawValue.getComponents()[3],backward:(Tt,Vt)=>{const wn=Tt.rawValue.getComponents();return wn[3]=Vt.rawValue,new Ao(wn,Tt.rawValue.mode)}}),this.textC_=new GA(lt,{colorType:mt.colorType,parser:hu,value:this.value,viewProps:this.viewProps}),this.view=new im(lt,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:mt.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const Dm=Xt("colsw");class h_{constructor(lt,mt){this.onValueChange_=this.onValueChange_.bind(this),mt.value.emitter.on("change",this.onValueChange_),this.value=mt.value,this.element=lt.createElement("div"),this.element.classList.add(Dm()),mt.viewProps.bindClassModifiers(this.element);const Tt=lt.createElement("div");Tt.classList.add(Dm("sw")),this.element.appendChild(Tt),this.swatchElem_=Tt;const Vt=lt.createElement("button");Vt.classList.add(Dm("b")),mt.viewProps.bindDisabled(Vt),this.element.appendChild(Vt),this.buttonElement=Vt,this.update_()}update_(){const lt=this.value.rawValue;this.swatchElem_.style.backgroundColor=N1(lt)}onValueChange_(){this.update_()}}class yx{constructor(lt,mt){this.value=mt.value,this.viewProps=mt.viewProps,this.view=new h_(lt,{value:this.value,viewProps:this.viewProps})}}class S0{constructor(lt,mt){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=mt.value,this.viewProps=mt.viewProps,this.foldable_=Ml.create(mt.expanded),this.swatchC_=new yx(lt,{value:this.value,viewProps:this.viewProps});const Tt=this.swatchC_.view.buttonElement;Tt.addEventListener("blur",this.onButtonBlur_),Tt.addEventListener("click",this.onButtonClick_),this.textC_=new Xm(lt,{parser:mt.parser,props:yn.fromObject({formatter:mt.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new DS(lt,{foldable:this.foldable_,pickerLayout:mt.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=mt.pickerLayout==="popup"?new f0(lt,{viewProps:this.viewProps}):null;const Vt=new U1(lt,{colorType:mt.colorType,supportsAlpha:mt.supportsAlpha,value:this.value,viewProps:this.viewProps});Vt.view.allFocusableElements.forEach(wn=>{wn.addEventListener("blur",this.onPopupChildBlur_),wn.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=Vt,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(Vt.view.element),Bs({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:wn=>wn.rawValue,backward:(wn,Tn)=>Tn.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),_l(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(lt){if(!this.popC_)return;const mt=this.view.element,Tt=lt.relatedTarget;Tt&&mt.contains(Tt)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(lt){if(!this.popC_)return;const mt=this.popC_.view.element,Tt=_c(lt);Tt&&mt.contains(Tt)||Tt&&Tt===this.swatchC_.view.buttonElement&&!hr(mt.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(lt){this.popC_?lt.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&lt.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function _g(Ct){return Im(Ct.getComponents("rgb")).reduce((lt,mt)=>lt<<8|255&Math.floor(mt),0)}function QA(Ct){return Ct.getComponents("rgb").reduce((lt,mt,Tt)=>lt<<8|255&Math.floor(Tt===3?255*mt:mt),0)>>>0}function Ty(Ct){return typeof Ct!="number"?Ao.black():new Ao([(lt=Ct)>>16&255,lt>>8&255,255&lt],"rgb");var lt}function WA(Ct){return typeof Ct!="number"?Ao.black():new Ao([(lt=Ct)>>24&255,lt>>16&255,lt>>8&255,Vo(255&lt,0,255,0,1)],"rgb");var lt}function C0(Ct){var lt;return!(!(Ct!=null&&Ct.alpha)&&!(!((lt=Ct==null?void 0:Ct.color)===null||lt===void 0)&&lt.alpha))}function ro(Ct){return Ct?lt=>N1(lt,"0x"):lt=>rm(lt,"0x")}const Iy={id:"input-color-number",type:"input",accept:(Ct,lt)=>{if(typeof Ct!="number"||!function(Tt){return"color"in Tt||"view"in Tt&&Tt.view==="color"}(lt))return null;const mt=O1(lt);return mt?{initialValue:Ct,params:mt}:null},binding:{reader:Ct=>C0(Ct.params)?WA:Ty,equals:Ao.equals,writer:Ct=>function(lt){const mt=lt?QA:_g;return(Tt,Vt)=>{Jm(Tt,mt(Vt))}}(C0(Ct.params))},controller:Ct=>{const lt=C0(Ct.params),mt="expanded"in Ct.params?Ct.params.expanded:void 0,Tt="picker"in Ct.params?Ct.params.picker:void 0;return new S0(Ct.document,{colorType:"int",expanded:mt!=null&&mt,formatter:ro(lt),parser:No("int"),pickerLayout:Tt??"popup",supportsAlpha:lt,value:Ct.value,viewProps:Ct.viewProps})}};function km(Ct){return lt=>function(mt,Tt){return Ao.isColorObject(mt)?Ao.fromObject(mt,Tt):Ao.black(Tt)}(lt,Ct)}function xo(Ct,lt){return mt=>Ct?vx(mt,lt):Rn(mt,lt)}const Du={id:"input-color-object",type:"input",accept:(Ct,lt)=>{if(!Ao.isColorObject(Ct))return null;const mt=O1(lt);return mt?{initialValue:Ct,params:mt}:null},binding:{reader:Ct=>km(oo(Ct.params)),equals:Ao.equals,writer:Ct=>{return Tt=Ct.initialValue,lt=Ao.isRgbaColorObject(Tt),mt=oo(Ct.params),(Vt,wn)=>{lt?function(Tn,or,Mr){const as=or.toRgbaObject(Mr);Tn.writeProperty("r",as.r),Tn.writeProperty("g",as.g),Tn.writeProperty("b",as.b),Tn.writeProperty("a",as.a)}(Vt,wn,mt):function(Tn,or,Mr){const as=or.toRgbaObject(Mr);Tn.writeProperty("r",as.r),Tn.writeProperty("g",as.g),Tn.writeProperty("b",as.b)}(Vt,wn,mt)};var lt,mt,Tt}},controller:Ct=>{var lt;const mt=Ao.isRgbaColorObject(Ct.initialValue),Tt="expanded"in Ct.params?Ct.params.expanded:void 0,Vt="picker"in Ct.params?Ct.params.picker:void 0,wn=(lt=oo(Ct.params))!==null&&lt!==void 0?lt:"int";return new S0(Ct.document,{colorType:wn,expanded:Tt!=null&&Tt,formatter:xo(mt,wn),parser:No(wn),pickerLayout:Vt??"popup",supportsAlpha:mt,value:Ct.value,viewProps:Ct.viewProps})}},wp={id:"input-color-string",type:"input",accept:(Ct,lt)=>{if(typeof Ct!="string"||"view"in lt&&lt.view==="text")return null;const mt=VA(Ct,oo(lt));if(!mt||!rp(mt))return null;const Tt=O1(lt);return Tt?{initialValue:Ct,params:Tt}:null},binding:{reader:Ct=>{var lt;return function(mt){const Tt=ga[mt];return Vt=>{if(typeof Vt!="string")return Ao.black(mt);const wn=Tt.reduce((Tn,or)=>Tn||or(Vt),null);return wn??Ao.black(mt)}}((lt=oo(Ct.params))!==null&&lt!==void 0?lt:"int")},equals:Ao.equals,writer:Ct=>{const lt=VA(Ct.initialValue,oo(Ct.params));if(!lt)throw ln.shouldNeverHappen();const mt=function(Tt){const Vt=rp(Tt);return Vt?(wn,Tn)=>{Jm(wn,Vt(Tn))}:null}(lt);if(!mt)throw ln.notBindable();return mt}},controller:Ct=>{const lt=VA(Ct.initialValue,oo(Ct.params));if(!lt)throw ln.shouldNeverHappen();const mt=rp(lt);if(!mt)throw ln.shouldNeverHappen();const Tt="expanded"in Ct.params?Ct.params.expanded:void 0,Vt="picker"in Ct.params?Ct.params.picker:void 0;return new S0(Ct.document,{colorType:lt.type,expanded:Tt!=null&&Tt,formatter:mt,parser:No(lt.type),pickerLayout:Vt??"popup",supportsAlpha:lt.alpha,value:Ct.value,viewProps:Ct.viewProps})}};class sp{constructor(lt){this.components=lt.components,this.asm_=lt.assembly}constrain(lt){const mt=this.asm_.toComponents(lt).map((Tt,Vt)=>{var wn,Tn;return(Tn=(wn=this.components[Vt])===null||wn===void 0?void 0:wn.constrain(Tt))!==null&&Tn!==void 0?Tn:Tt});return this.asm_.fromComponents(mt)}}const Eu=Xt("pndtxt");class Py{constructor(lt,mt){this.textViews=mt.textViews,this.element=lt.createElement("div"),this.element.classList.add(Eu()),this.textViews.forEach(Tt=>{const Vt=lt.createElement("div");Vt.classList.add(Eu("a")),Vt.appendChild(Tt.element),this.element.appendChild(Vt)})}}class qA{constructor(lt,mt){this.value=mt.value,this.viewProps=mt.viewProps,this.acs_=mt.axes.map((Tt,Vt)=>function(wn,Tn,or){return new LA(wn,{arrayPosition:or===0?"fst":or===Tn.axes.length-1?"lst":"mid",baseStep:Tn.axes[or].baseStep,parser:Tn.parser,props:Tn.axes[or].textProps,value:an(0,{constraint:Tn.axes[or].constraint}),viewProps:Tn.viewProps})}(lt,mt,Vt)),this.acs_.forEach((Tt,Vt)=>{Bs({primary:this.value,secondary:Tt.value,forward:wn=>mt.assembly.toComponents(wn.rawValue)[Vt],backward:(wn,Tn)=>{const or=mt.assembly.toComponents(wn.rawValue);return or[Vt]=Tn.rawValue,mt.assembly.fromComponents(or)}})}),this.view=new Py(lt,{textViews:this.acs_.map(Tt=>Tt.view)})}}function M0(Ct,lt){return"step"in Ct&&!Yt(Ct.step)?new _y(Ct.step,lt):null}function T0(Ct){return Yt(Ct.max)||Yt(Ct.min)?Yt(Ct.max)&&Yt(Ct.min)?null:new ox({max:Ct.max,min:Ct.min}):new tu({max:Ct.max,min:Ct.min})}const Ax={id:"input-number",type:"input",accept:(Ct,lt)=>{if(typeof Ct!="number")return null;const mt=vr,Tt=Wn(lt,{format:mt.optional.function,max:mt.optional.number,min:mt.optional.number,options:mt.optional.custom(Qu),step:mt.optional.number});return Tt?{initialValue:Ct,params:Tt}:null},binding:{reader:Ct=>Ym,constraint:Ct=>function(lt,mt){const Tt=[],Vt=M0(lt,mt);Vt&&Tt.push(Vt);const wn=T0(lt);wn&&Tt.push(wn);const Tn=UA(lt.options);return Tn&&Tt.push(Tn),new L_(Tt)}(Ct.params,Ct.initialValue),writer:Ct=>Jm},controller:Ct=>{var lt;const mt=Ct.value,Tt=Ct.constraint,Vt=Tt&&_f(Tt,i_);if(Vt)return new r_(Ct.document,{props:new yn({options:Vt.values.value("options")}),value:mt,viewProps:Ct.viewProps});const wn=(lt="format"in Ct.params?Ct.params.format:void 0)!==null&&lt!==void 0?lt:rs(dx(Tt,mt.rawValue)),Tn=Tt&&_f(Tt,tu);return Tn?new by(Ct.document,{baseStep:v0(Tt),parser:hu,sliderProps:new yn({maxValue:Tn.values.value("max"),minValue:Tn.values.value("min")}),textProps:yn.fromObject({draggingScale:_0(Tt,mt.rawValue),formatter:wn}),value:mt,viewProps:Ct.viewProps}):new LA(Ct.document,{baseStep:v0(Tt),parser:hu,props:yn.fromObject({draggingScale:_0(Tt,mt.rawValue),formatter:wn}),value:mt,viewProps:Ct.viewProps})}};class Sv{constructor(lt=0,mt=0){this.x=lt,this.y=mt}getComponents(){return[this.x,this.y]}static isObject(lt){if(Yt(lt))return!1;const mt=lt.x,Tt=lt.y;return typeof mt=="number"&&typeof Tt=="number"}static equals(lt,mt){return lt.x===mt.x&&lt.y===mt.y}toObject(){return{x:this.x,y:this.y}}}const z_={toComponents:Ct=>Ct.getComponents(),fromComponents:Ct=>new Sv(...Ct)},op=Xt("p2d");class V_{constructor(lt,mt){this.element=lt.createElement("div"),this.element.classList.add(op()),mt.viewProps.bindClassModifiers(this.element),Nn(mt.expanded,kn(this.element,op(void 0,"expanded")));const Tt=lt.createElement("div");Tt.classList.add(op("h")),this.element.appendChild(Tt);const Vt=lt.createElement("button");Vt.classList.add(op("b")),Vt.appendChild(fo(lt,"p2dpad")),mt.viewProps.bindDisabled(Vt),Tt.appendChild(Vt),this.buttonElement=Vt;const wn=lt.createElement("div");if(wn.classList.add(op("t")),Tt.appendChild(wn),this.textElement=wn,mt.pickerLayout==="inline"){const Tn=lt.createElement("div");Tn.classList.add(op("p")),this.element.appendChild(Tn),this.pickerElement=Tn}else this.pickerElement=null}}const Eo=Xt("p2dp");class I0{constructor(lt,mt){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=mt.invertsY,this.maxValue_=mt.maxValue,this.element=lt.createElement("div"),this.element.classList.add(Eo()),mt.layout==="popup"&&this.element.classList.add(Eo(void 0,"p")),mt.viewProps.bindClassModifiers(this.element);const Tt=lt.createElement("div");Tt.classList.add(Eo("p")),mt.viewProps.bindTabIndex(Tt),this.element.appendChild(Tt),this.padElement=Tt;const Vt=lt.createElementNS(Qn,"svg");Vt.classList.add(Eo("g")),this.padElement.appendChild(Vt),this.svgElem_=Vt;const wn=lt.createElementNS(Qn,"line");wn.classList.add(Eo("ax")),wn.setAttributeNS(null,"x1","0"),wn.setAttributeNS(null,"y1","50%"),wn.setAttributeNS(null,"x2","100%"),wn.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(wn);const Tn=lt.createElementNS(Qn,"line");Tn.classList.add(Eo("ax")),Tn.setAttributeNS(null,"x1","50%"),Tn.setAttributeNS(null,"y1","0"),Tn.setAttributeNS(null,"x2","50%"),Tn.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(Tn);const or=lt.createElementNS(Qn,"line");or.classList.add(Eo("l")),or.setAttributeNS(null,"x1","50%"),or.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(or),this.lineElem_=or;const Mr=lt.createElement("div");Mr.classList.add(Eo("m")),this.padElement.appendChild(Mr),this.markerElem_=Mr,mt.value.emitter.on("change",this.onValueChange_),this.value=mt.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[lt,mt]=this.value.rawValue.getComponents(),Tt=this.maxValue_,Vt=Vo(lt,-Tt,+Tt,0,100),wn=Vo(mt,-Tt,+Tt,0,100),Tn=this.invertsY_?100-wn:wn;this.lineElem_.setAttributeNS(null,"x2",`${Vt}%`),this.lineElem_.setAttributeNS(null,"y2",`${Tn}%`),this.markerElem_.style.left=`${Vt}%`,this.markerElem_.style.top=`${Tn}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function sm(Ct,lt,mt){return[io(lt[0],Mm(Ct)),io(lt[1],Km(Ct))*(mt?1:-1)]}class Cv{constructor(lt,mt){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=mt.value,this.viewProps=mt.viewProps,this.baseSteps_=mt.baseSteps,this.maxValue_=mt.maxValue,this.invertsY_=mt.invertsY,this.view=new I0(lt,{invertsY:this.invertsY_,layout:mt.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new hs(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(lt,mt){if(!lt.point)return;const Tt=this.maxValue_,Vt=Vo(lt.point.x,0,lt.bounds.width,-Tt,+Tt),wn=Vo(this.invertsY_?lt.bounds.height-lt.point.y:lt.point.y,0,lt.bounds.height,-Tt,+Tt);this.value.setRawValue(new Sv(Vt,wn),mt)}onPointerDown_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!1,last:!1})}onPointerMove_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!1,last:!1})}onPointerUp_(lt){this.handlePointerEvent_(lt.data,{forceEmit:!0,last:!0})}onPadKeyDown_(lt){IS(lt.key)&&lt.preventDefault();const[mt,Tt]=sm(lt,this.baseSteps_,this.invertsY_);mt===0&&Tt===0||this.value.setRawValue(new Sv(this.value.rawValue.x+mt,this.value.rawValue.y+Tt),{forceEmit:!1,last:!1})}onPadKeyUp_(lt){const[mt,Tt]=sm(lt,this.baseSteps_,this.invertsY_);mt===0&&Tt===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class P0{constructor(lt,mt){var Tt,Vt;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=mt.value,this.viewProps=mt.viewProps,this.foldable_=Ml.create(mt.expanded),this.popC_=mt.pickerLayout==="popup"?new f0(lt,{viewProps:this.viewProps}):null;const wn=new Cv(lt,{baseSteps:[mt.axes[0].baseStep,mt.axes[1].baseStep],invertsY:mt.invertsY,layout:mt.pickerLayout,maxValue:mt.maxValue,value:this.value,viewProps:this.viewProps});wn.view.allFocusableElements.forEach(Tn=>{Tn.addEventListener("blur",this.onPopupChildBlur_),Tn.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=wn,this.textC_=new qA(lt,{assembly:z_,axes:mt.axes,parser:mt.parser,value:this.value,viewProps:this.viewProps}),this.view=new V_(lt,{expanded:this.foldable_.value("expanded"),pickerLayout:mt.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(Tt=this.view.buttonElement)===null||Tt===void 0||Tt.addEventListener("blur",this.onPadButtonBlur_),(Vt=this.view.buttonElement)===null||Vt===void 0||Vt.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Bs({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Tn=>Tn.rawValue,backward:(Tn,or)=>or.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),_l(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(lt){if(!this.popC_)return;const mt=this.view.element,Tt=lt.relatedTarget;Tt&&mt.contains(Tt)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(lt){if(!this.popC_)return;const mt=this.popC_.view.element,Tt=_c(lt);Tt&&mt.contains(Tt)||Tt&&Tt===this.view.buttonElement&&!hr(mt.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(lt){this.popC_?lt.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&lt.key==="Escape"&&this.view.buttonElement.focus()}}class G_{constructor(lt=0,mt=0,Tt=0){this.x=lt,this.y=mt,this.z=Tt}getComponents(){return[this.x,this.y,this.z]}static isObject(lt){if(Yt(lt))return!1;const mt=lt.x,Tt=lt.y,Vt=lt.z;return typeof mt=="number"&&typeof Tt=="number"&&typeof Vt=="number"}static equals(lt,mt){return lt.x===mt.x&&lt.y===mt.y&&lt.z===mt.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const F1={toComponents:Ct=>Ct.getComponents(),fromComponents:Ct=>new G_(...Ct)};function j1(Ct){return G_.isObject(Ct)?new G_(Ct.x,Ct.y,Ct.z):new G_}function Po(Ct,lt){Ct.writeProperty("x",lt.x),Ct.writeProperty("y",lt.y),Ct.writeProperty("z",lt.z)}function ap(Ct,lt){return{baseStep:v0(lt),constraint:lt,textProps:yn.fromObject({draggingScale:_0(lt,Ct),formatter:rs(dx(lt,Ct))})}}const du={id:"input-point3d",type:"input",accept:(Ct,lt)=>{if(!G_.isObject(Ct))return null;const mt=vr,Tt=Wn(lt,{x:mt.optional.custom(Wu),y:mt.optional.custom(Wu),z:mt.optional.custom(Wu)});return Tt?{initialValue:Ct,params:Tt}:null},binding:{reader:Ct=>j1,constraint:Ct=>{return lt=Ct.params,mt=Ct.initialValue,new sp({assembly:F1,components:[Qo("x"in lt?lt.x:void 0,mt.x),Qo("y"in lt?lt.y:void 0,mt.y),Qo("z"in lt?lt.z:void 0,mt.z)]});var lt,mt},equals:G_.equals,writer:Ct=>Po},controller:Ct=>{const lt=Ct.value,mt=Ct.constraint;if(!(mt instanceof sp))throw ln.shouldNeverHappen();return new qA(Ct.document,{assembly:F1,axes:[ap(lt.rawValue.x,mt.components[0]),ap(lt.rawValue.y,mt.components[1]),ap(lt.rawValue.z,mt.components[2])],parser:hu,value:lt,viewProps:Ct.viewProps})}};class ev{constructor(lt=0,mt=0,Tt=0,Vt=0){this.x=lt,this.y=mt,this.z=Tt,this.w=Vt}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(lt){if(Yt(lt))return!1;const mt=lt.x,Tt=lt.y,Vt=lt.z,wn=lt.w;return typeof mt=="number"&&typeof Tt=="number"&&typeof Vt=="number"&&typeof wn=="number"}static equals(lt,mt){return lt.x===mt.x&&lt.y===mt.y&&lt.z===mt.z&&lt.w===mt.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Vp={toComponents:Ct=>Ct.getComponents(),fromComponents:Ct=>new ev(...Ct)};function Xu(Ct){return ev.isObject(Ct)?new ev(Ct.x,Ct.y,Ct.z,Ct.w):new ev}function Mv(Ct,lt){Ct.writeProperty("x",lt.x),Ct.writeProperty("y",lt.y),Ct.writeProperty("z",lt.z),Ct.writeProperty("w",lt.w)}const tv={id:"input-point4d",type:"input",accept:(Ct,lt)=>{if(!ev.isObject(Ct))return null;const mt=vr,Tt=Wn(lt,{x:mt.optional.custom(Wu),y:mt.optional.custom(Wu),z:mt.optional.custom(Wu),w:mt.optional.custom(Wu)});return Tt?{initialValue:Ct,params:Tt}:null},binding:{reader:Ct=>Xu,constraint:Ct=>{return lt=Ct.params,mt=Ct.initialValue,new sp({assembly:Vp,components:[Qo("x"in lt?lt.x:void 0,mt.x),Qo("y"in lt?lt.y:void 0,mt.y),Qo("z"in lt?lt.z:void 0,mt.z),Qo("w"in lt?lt.w:void 0,mt.w)]});var lt,mt},equals:ev.equals,writer:Ct=>Mv},controller:Ct=>{const lt=Ct.value,mt=Ct.constraint;if(!(mt instanceof sp))throw ln.shouldNeverHappen();return new qA(Ct.document,{assembly:Vp,axes:lt.rawValue.getComponents().map((Tt,Vt)=>{return wn=Tt,{baseStep:v0(Tn=mt.components[Vt]),constraint:Tn,textProps:yn.fromObject({draggingScale:_0(Tn,wn),formatter:rs(dx(Tn,wn))})};var wn,Tn}),parser:hu,value:lt,viewProps:Ct.viewProps})}},H_={id:"input-string",type:"input",accept:(Ct,lt)=>{if(typeof Ct!="string")return null;const mt=Wn(lt,{options:vr.optional.custom(Qu)});return mt?{initialValue:Ct,params:mt}:null},binding:{reader:Ct=>U_,constraint:Ct=>function(lt){const mt=[],Tt=UA(lt.options);return Tt&&mt.push(Tt),new L_(mt)}(Ct.params),writer:Ct=>Jm},controller:Ct=>{const lt=Ct.document,mt=Ct.value,Tt=Ct.constraint,Vt=Tt&&_f(Tt,i_);return Vt?new r_(lt,{props:new yn({options:Vt.values.value("options")}),value:mt,viewProps:Ct.viewProps}):new Xm(lt,{parser:wn=>wn,props:yn.fromObject({formatter:Cm}),value:mt,viewProps:Ct.viewProps})}},Tv={monitor:{defaultInterval:200,defaultLineCount:3}},R0=Xt("mll");class Ry{constructor(lt,mt){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=mt.formatter,this.element=lt.createElement("div"),this.element.classList.add(R0()),mt.viewProps.bindClassModifiers(this.element);const Tt=lt.createElement("textarea");Tt.classList.add(R0("i")),Tt.style.height=`calc(var(--bld-us) * ${mt.lineCount})`,Tt.readOnly=!0,mt.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.textareaElem_=Tt,mt.value.emitter.on("change",this.onValueUpdate_),this.value=mt.value,this.update_()}update_(){const lt=this.textareaElem_,mt=lt.scrollTop===lt.scrollHeight-lt.clientHeight,Tt=[];this.value.rawValue.forEach(Vt=>{Vt!==void 0&&Tt.push(this.formatter_(Vt))}),lt.textContent=Tt.join(`
`),mt&&(lt.scrollTop=lt.scrollHeight)}onValueUpdate_(){this.update_()}}class ru{constructor(lt,mt){this.value=mt.value,this.viewProps=mt.viewProps,this.view=new Ry(lt,{formatter:mt.formatter,lineCount:mt.lineCount,value:this.value,viewProps:this.viewProps})}}const Dy=Xt("sgl");class ku{constructor(lt,mt){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=mt.formatter,this.element=lt.createElement("div"),this.element.classList.add(Dy()),mt.viewProps.bindClassModifiers(this.element);const Tt=lt.createElement("input");Tt.classList.add(Dy("i")),Tt.readOnly=!0,Tt.type="text",mt.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.inputElement=Tt,mt.value.emitter.on("change",this.onValueUpdate_),this.value=mt.value,this.update_()}update_(){const lt=this.value.rawValue,mt=lt[lt.length-1];this.inputElement.value=mt!==void 0?this.formatter_(mt):""}onValueUpdate_(){this.update_()}}class XA{constructor(lt,mt){this.value=mt.value,this.viewProps=mt.viewProps,this.view=new ku(lt,{formatter:mt.formatter,value:this.value,viewProps:this.viewProps})}}const Iv={id:"monitor-bool",type:"monitor",accept:(Ct,lt)=>{if(typeof Ct!="boolean")return null;const mt=Wn(lt,{lineCount:vr.optional.number});return mt?{initialValue:Ct,params:mt}:null},binding:{reader:Ct=>es},controller:Ct=>{var lt;return Ct.value.rawValue.length===1?new XA(Ct.document,{formatter:ip,value:Ct.value,viewProps:Ct.viewProps}):new ru(Ct.document,{formatter:ip,lineCount:(lt=Ct.params.lineCount)!==null&&lt!==void 0?lt:Tv.monitor.defaultLineCount,value:Ct.value,viewProps:Ct.viewProps})}},Su=Xt("grl");class YA{constructor(lt,mt){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=lt.createElement("div"),this.element.classList.add(Su()),mt.viewProps.bindClassModifiers(this.element),this.formatter_=mt.formatter,this.props_=mt.props,this.cursor_=mt.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const Tt=lt.createElementNS(Qn,"svg");Tt.classList.add(Su("g")),Tt.style.height=`calc(var(--bld-us) * ${mt.lineCount})`,this.element.appendChild(Tt),this.svgElem_=Tt;const Vt=lt.createElementNS(Qn,"polyline");this.svgElem_.appendChild(Vt),this.lineElem_=Vt;const wn=lt.createElement("div");wn.classList.add(Su("t"),Xt("tt")()),this.element.appendChild(wn),this.tooltipElem_=wn,mt.value.emitter.on("change",this.onValueUpdate_),this.value=mt.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const lt=this.svgElem_.getBoundingClientRect(),mt=this.value.rawValue.length-1,Tt=this.props_.get("minValue"),Vt=this.props_.get("maxValue"),wn=[];this.value.rawValue.forEach((Gs,Wo)=>{if(Gs===void 0)return;const Ku=Vo(Wo,0,mt,0,lt.width),Bu=Vo(Gs,Tt,Vt,lt.height,0);wn.push([Ku,Bu].join(","))}),this.lineElem_.setAttributeNS(null,"points",wn.join(" "));const Tn=this.tooltipElem_,or=this.value.rawValue[this.cursor_.rawValue];if(or===void 0)return void Tn.classList.remove(Su("t","a"));const Mr=Vo(this.cursor_.rawValue,0,mt,0,lt.width),as=Vo(or,Tt,Vt,lt.height,0);Tn.style.left=`${Mr}px`,Tn.style.top=`${as}px`,Tn.textContent=`${this.formatter_(or)}`,Tn.classList.contains(Su("t","a"))||(Tn.classList.add(Su("t","a"),Su("t","in")),jr(Tn),Tn.classList.remove(Su("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Q_{constructor(lt,mt){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=mt.props,this.value=mt.value,this.viewProps=mt.viewProps,this.cursor_=an(-1),this.view=new YA(lt,{cursor:this.cursor_,formatter:mt.formatter,lineCount:mt.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),hr(lt)){const Tt=new hs(this.view.element);Tt.emitter.on("down",this.onGraphPointerDown_),Tt.emitter.on("move",this.onGraphPointerMove_),Tt.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(lt){const mt=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Vo(lt.offsetX,0,mt.width,0,this.value.rawValue.length))}onGraphPointerDown_(lt){this.onGraphPointerMove_(lt)}onGraphPointerMove_(lt){lt.data.point?this.cursor_.rawValue=Math.floor(Vo(lt.data.point.x,0,lt.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function us(Ct){return"format"in Ct&&!Yt(Ct.format)?Ct.format:rs(2)}function Ul(Ct){return"view"in Ct&&Ct.view==="graph"}const Bm={id:"monitor-number",type:"monitor",accept:(Ct,lt)=>{if(typeof Ct!="number")return null;const mt=vr,Tt=Wn(lt,{format:mt.optional.function,lineCount:mt.optional.number,max:mt.optional.number,min:mt.optional.number,view:mt.optional.string});return Tt?{initialValue:Ct,params:Tt}:null},binding:{defaultBufferSize:Ct=>Ul(Ct)?64:1,reader:Ct=>Ym},controller:Ct=>Ul(Ct.params)?function(lt){var mt,Tt,Vt;return new Q_(lt.document,{formatter:us(lt.params),lineCount:(mt=lt.params.lineCount)!==null&&mt!==void 0?mt:Tv.monitor.defaultLineCount,props:yn.fromObject({maxValue:(Tt="max"in lt.params?lt.params.max:null)!==null&&Tt!==void 0?Tt:100,minValue:(Vt="min"in lt.params?lt.params.min:null)!==null&&Vt!==void 0?Vt:0}),value:lt.value,viewProps:lt.viewProps})}(Ct):function(lt){var mt;return lt.value.rawValue.length===1?new XA(lt.document,{formatter:us(lt.params),value:lt.value,viewProps:lt.viewProps}):new ru(lt.document,{formatter:us(lt.params),lineCount:(mt=lt.params.lineCount)!==null&&mt!==void 0?mt:Tv.monitor.defaultLineCount,value:lt.value,viewProps:lt.viewProps})}(Ct)},Pv={id:"monitor-string",type:"monitor",accept:(Ct,lt)=>{if(typeof Ct!="string")return null;const mt=vr,Tt=Wn(lt,{lineCount:mt.optional.number,multiline:mt.optional.boolean});return Tt?{initialValue:Ct,params:Tt}:null},binding:{reader:Ct=>U_},controller:Ct=>{var lt;const mt=Ct.value;return mt.rawValue.length>1||"multiline"in Ct.params&&Ct.params.multiline?new ru(Ct.document,{formatter:Cm,lineCount:(lt=Ct.params.lineCount)!==null&&lt!==void 0?lt:Tv.monitor.defaultLineCount,value:mt,viewProps:Ct.viewProps}):new XA(Ct.document,{formatter:Cm,value:mt,viewProps:Ct.viewProps})}};function bx(Ct,lt){return lt===0?new kA:new p0(Ct,lt??Tv.monitor.defaultInterval)}class xp{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(lt){lt.type==="blade"?this.pluginsMap_.blades.unshift(lt):lt.type==="input"?this.pluginsMap_.inputs.unshift(lt):lt.type==="monitor"&&this.pluginsMap_.monitors.unshift(lt)}createInput(lt,mt,Tt){if(Yt(mt.read()))throw new ln({context:{key:mt.key},type:"nomatchingcontroller"});const Vt=this.pluginsMap_.inputs.reduce((wn,Tn)=>wn??function(or,Mr){const as=or.accept(Mr.target.read(),Mr.params);if(Yt(as))return null;const Gs=vr,Wo={target:Mr.target,initialValue:as.initialValue,params:as.params},Ku=or.binding.reader(Wo),Bu=or.binding.constraint?or.binding.constraint(Wo):void 0,Om=an(Ku(as.initialValue),{constraint:Bu,equals:or.binding.equals}),Dv=new rx({reader:Ku,target:Mr.target,value:Om,writer:or.binding.writer(Wo)}),d_=Gs.optional.boolean(Mr.params.disabled).value,KA=Gs.optional.boolean(Mr.params.hidden).value,Oy=or.controller({constraint:Bu,document:Mr.document,initialValue:as.initialValue,params:as.params,value:Dv.value,viewProps:Sr.create({disabled:d_,hidden:KA})}),q_=Gs.optional.string(Mr.params.label).value;return new tp(Mr.document,{binding:Dv,blade:Ql(),props:yn.fromObject({label:q_??Mr.target.key}),valueController:Oy})}(Tn,{document:lt,target:mt,params:Tt}),null);if(Vt)return Vt;throw new ln({context:{key:mt.key},type:"nomatchingcontroller"})}createMonitor(lt,mt,Tt){const Vt=this.pluginsMap_.monitors.reduce((wn,Tn)=>wn??function(or,Mr){var as,Gs,Wo;const Ku=vr,Bu=or.accept(Mr.target.read(),Mr.params);if(Yt(Bu))return null;const Om={target:Mr.target,initialValue:Bu.initialValue,params:Bu.params},Dv=or.binding.reader(Om),d_=(Gs=(as=Ku.optional.number(Mr.params.bufferSize).value)!==null&&as!==void 0?as:or.binding.defaultBufferSize&&or.binding.defaultBufferSize(Bu.params))!==null&&Gs!==void 0?Gs:1,KA=Ku.optional.number(Mr.params.interval).value,Oy=new D1({reader:Dv,target:Mr.target,ticker:bx(Mr.document,KA),value:Em(d_)}),q_=Ku.optional.boolean(Mr.params.disabled).value,Ly=Ku.optional.boolean(Mr.params.hidden).value,xx=or.controller({document:Mr.document,params:Bu.params,value:Oy.value,viewProps:Sr.create({disabled:q_,hidden:Ly})}),Ou=(Wo=Ku.optional.string(Mr.params.label).value)!==null&&Wo!==void 0?Wo:Mr.target.key;return new $p(Mr.document,{binding:Oy,blade:Ql(),props:yn.fromObject({label:Ou}),valueController:xx})}(Tn,{document:lt,params:Tt,target:mt}),null);if(Vt)return Vt;throw new ln({context:{key:mt.key},type:"nomatchingcontroller"})}createBlade(lt,mt){const Tt=this.pluginsMap_.blades.reduce((Vt,wn)=>Vt??function(Tn,or){const Mr=Tn.accept(or.params);if(!Mr)return null;const as=vr.optional.boolean(or.params.disabled).value,Gs=vr.optional.boolean(or.params.hidden).value;return Tn.controller({blade:Ql(),document:or.document,params:Object.assign(Object.assign({},Mr.params),{disabled:as,hidden:Gs}),viewProps:Sr.create({disabled:as,hidden:Gs})})}(wn,{document:lt,params:mt}),null);if(!Tt)throw new ln({type:"nomatchingview",context:{params:mt}});return Tt}createBladeApi(lt){if(lt instanceof tp)return new Tl(lt);if(lt instanceof $p)return new Yo(lt);if(lt instanceof eu)return new Il(lt,this);const mt=this.pluginsMap_.blades.reduce((Tt,Vt)=>Tt??Vt.api({controller:lt,pool:this}),null);if(!mt)throw ln.shouldNeverHappen();return mt}}function Rv(Ct){return Sv.isObject(Ct)?new Sv(Ct.x,Ct.y):new Sv}function ky(Ct,lt){Ct.writeProperty("x",lt.x),Ct.writeProperty("y",lt.y)}function Qo(Ct,lt){if(!Ct)return;const mt=[],Tt=M0(Ct,lt);Tt&&mt.push(Tt);const Vt=T0(Ct);return Vt&&mt.push(Vt),new L_(mt)}function By(Ct,lt){const[mt,Tt]=Ct?function(wn){const Tn=_f(wn,tu);if(Tn)return[Tn.values.get("min"),Tn.values.get("max")];const or=_f(wn,ox);return or?[or.minValue,or.maxValue]:[void 0,void 0]}(Ct):[];if(!Yt(mt)||!Yt(Tt))return Math.max(Math.abs(mt??0),Math.abs(Tt??0));const Vt=v0(Ct);return Math.max(10*Math.abs(Vt),10*Math.abs(lt))}function Jo(Ct,lt){const mt=lt instanceof sp?lt.components[0]:void 0,Tt=lt instanceof sp?lt.components[1]:void 0,Vt=By(mt,Ct.x),wn=By(Tt,Ct.y);return Math.max(Vt,wn)}function z1(Ct,lt){return{baseStep:v0(lt),constraint:lt,textProps:yn.fromObject({draggingScale:_0(lt,Ct),formatter:rs(dx(lt,Ct))})}}function W_(Ct){if(!("y"in Ct))return!1;const lt=Ct.y;return!!lt&&"inverted"in lt&&!!lt.inverted}const V1={id:"input-point2d",type:"input",accept:(Ct,lt)=>{if(!Sv.isObject(Ct))return null;const mt=vr,Tt=Wn(lt,{expanded:mt.optional.boolean,picker:mt.optional.custom(hx),x:mt.optional.custom(Wu),y:mt.optional.object({inverted:mt.optional.boolean,max:mt.optional.number,min:mt.optional.number,step:mt.optional.number})});return Tt?{initialValue:Ct,params:Tt}:null},binding:{reader:Ct=>Rv,constraint:Ct=>{return lt=Ct.params,mt=Ct.initialValue,new sp({assembly:z_,components:[Qo("x"in lt?lt.x:void 0,mt.x),Qo("y"in lt?lt.y:void 0,mt.y)]});var lt,mt},equals:Sv.equals,writer:Ct=>ky},controller:Ct=>{const lt=Ct.document,mt=Ct.value,Tt=Ct.constraint;if(!(Tt instanceof sp))throw ln.shouldNeverHappen();const Vt="expanded"in Ct.params?Ct.params.expanded:void 0,wn="picker"in Ct.params?Ct.params.picker:void 0;return new P0(lt,{axes:[z1(mt.rawValue.x,Tt.components[0]),z1(mt.rawValue.y,Tt.components[1])],expanded:Vt!=null&&Vt,invertsY:W_(Ct.params),maxValue:Jo(mt.rawValue,Tt),parser:hu,pickerLayout:wn??"popup",value:mt,viewProps:Ct.viewProps})}};class D0 extends dt{constructor(lt){super(lt),this.emitter_=new Hn,this.controller_.valueController.value.emitter.on("change",mt=>{this.emitter_.emit("change",{event:new Et(this,mt.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(lt){this.controller_.props.set("label",lt)}get options(){return this.controller_.valueController.props.get("options")}set options(lt){this.controller_.valueController.props.set("options",lt)}get value(){return this.controller_.valueController.value.rawValue}set value(lt){this.controller_.valueController.value.rawValue=lt}on(lt,mt){const Tt=mt.bind(this);return this.emitter_.on(lt,Vt=>{Tt(Vt.event)}),this}}class Ep extends dt{constructor(lt){super(lt),this.emitter_=new Hn,this.controller_.valueController.value.emitter.on("change",mt=>{this.emitter_.emit("change",{event:new Et(this,mt.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(lt){this.controller_.props.set("label",lt)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(lt){this.controller_.valueController.sliderController.props.set("maxValue",lt)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(lt){this.controller_.valueController.sliderController.props.set("minValue",lt)}get value(){return this.controller_.valueController.value.rawValue}set value(lt){this.controller_.valueController.value.rawValue=lt}on(lt,mt){const Tt=mt.bind(this);return this.emitter_.on(lt,Vt=>{Tt(Vt.event)}),this}}class k0 extends dt{constructor(lt){super(lt),this.emitter_=new Hn,this.controller_.valueController.value.emitter.on("change",mt=>{this.emitter_.emit("change",{event:new Et(this,mt.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(lt){this.controller_.props.set("label",lt)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(lt){this.controller_.valueController.props.set("formatter",lt)}get value(){return this.controller_.valueController.value.rawValue}set value(lt){this.controller_.valueController.value.rawValue=lt}on(lt,mt){const Tt=mt.bind(this);return this.emitter_.on(lt,Vt=>{Tt(Vt.event)}),this}}const Yu={id:"list",type:"blade",accept(Ct){const lt=vr,mt=Wn(Ct,{options:lt.required.custom(Qu),value:lt.required.raw,view:lt.required.constant("list"),label:lt.optional.string});return mt?{params:mt}:null},controller(Ct){const lt=new i_(NA(Ct.params.options)),mt=an(Ct.params.value,{constraint:lt}),Tt=new r_(Ct.document,{props:new yn({options:lt.values.value("options")}),value:mt,viewProps:Ct.viewProps});return new Zp(Ct.document,{blade:Ct.blade,props:yn.fromObject({label:Ct.params.label}),valueController:Tt})},api(Ct){return Ct.controller instanceof Zp&&Ct.controller.valueController instanceof r_?new D0(Ct.controller):null}};class su extends yp{constructor(lt,mt){super(lt,mt)}get element(){return this.controller_.view.element}importPreset(lt){(function(mt,Tt){mt.forEach(Vt=>{const wn=Tt[Vt.target.presetKey];wn!==void 0&&Vt.writer(Vt.target,Vt.reader(wn))})})(this.controller_.rackController.rack.find(tp).map(mt=>mt.binding),lt),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(tp).map(lt=>lt.binding.target).reduce((lt,mt)=>Object.assign(lt,{[mt.presetKey]:mt.read()}),{})}refresh(){this.controller_.rackController.rack.find(tp).forEach(lt=>{lt.binding.read()}),this.controller_.rackController.rack.find($p).forEach(lt=>{lt.binding.read()})}}class fs extends Pu{constructor(lt,mt){super(lt,{expanded:mt.expanded,blade:mt.blade,props:mt.props,root:!0,viewProps:mt.viewProps})}}const Go={id:"slider",type:"blade",accept(Ct){const lt=vr,mt=Wn(Ct,{max:lt.required.number,min:lt.required.number,view:lt.required.constant("slider"),format:lt.optional.function,label:lt.optional.string,value:lt.optional.number});return mt?{params:mt}:null},controller(Ct){var lt,mt;const Tt=(lt=Ct.params.value)!==null&&lt!==void 0?lt:0,Vt=new tu({max:Ct.params.max,min:Ct.params.min}),wn=new by(Ct.document,{baseStep:1,parser:hu,sliderProps:new yn({maxValue:Vt.values.value("max"),minValue:Vt.values.value("min")}),textProps:yn.fromObject({draggingScale:_0(void 0,Tt),formatter:(mt=Ct.params.format)!==null&&mt!==void 0?mt:Nl}),value:an(Tt,{constraint:Vt}),viewProps:Ct.viewProps});return new Zp(Ct.document,{blade:Ct.blade,props:yn.fromObject({label:Ct.params.label}),valueController:wn})},api(Ct){return Ct.controller instanceof Zp&&Ct.controller.valueController instanceof by?new Ep(Ct.controller):null}},G1={id:"text",type:"blade",accept(Ct){const lt=vr,mt=Wn(Ct,{parse:lt.required.function,value:lt.required.raw,view:lt.required.constant("text"),format:lt.optional.function,label:lt.optional.string});return mt?{params:mt}:null},controller(Ct){var lt;const mt=new Xm(Ct.document,{parser:Ct.params.parse,props:yn.fromObject({formatter:(lt=Ct.params.format)!==null&&lt!==void 0?lt:Tt=>String(Tt)}),value:an(Ct.params.value),viewProps:Ct.viewProps});return new Zp(Ct.document,{blade:Ct.blade,props:yn.fromObject({label:Ct.params.label}),valueController:mt})},api(Ct){return Ct.controller instanceof Zp&&Ct.controller.valueController instanceof Xm?new k0(Ct.controller):null}};function Sp(Ct,lt,mt){if(Ct.querySelector(`style[data-tp-style=${lt}]`))return;const Tt=Ct.createElement("style");Tt.dataset.tpStyle=lt,Tt.textContent=mt,Ct.head.appendChild(Tt)}const wx=new class{constructor(Ct){const[lt,mt]=Ct.split("-"),Tt=lt.split(".");this.major=parseInt(Tt[0],10),this.minor=parseInt(Tt[1],10),this.patch=parseInt(Tt[2],10),this.prerelease=mt??null}toString(){const Ct=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[Ct,this.prerelease].join("-"):Ct}}("3.1.6");_.BladeApi=dt,_.ButtonApi=nn,_.FolderApi=yp,_.InputBindingApi=Tl,_.ListApi=D0,_.MonitorBindingApi=Yo,_.Pane=class extends su{constructor(Ct){var lt,mt;const Tt=Ct??{},Vt=(lt=Tt.document)!==null&&lt!==void 0?lt:Kr(),wn=function(){const Tn=new xp;return[V1,du,tv,H_,Ax,wp,Du,Iy,$m,Iv,Pv,Bm,bm,yv,Hu,Av].forEach(or=>{Tn.register(or)}),Tn}();super(new fs(Vt,{expanded:Tt.expanded,blade:Ql(),props:yn.fromObject({title:Tt.title}),viewProps:Sr.create()}),wn),this.pool_=wn,this.containerElem_=(mt=Tt.container)!==null&&mt!==void 0?mt:function(Tn){const or=Tn.createElement("div");return or.classList.add(Xt("dfw")()),Tn.body&&Tn.body.appendChild(or),or}(Vt),this.containerElem_.appendChild(this.element),this.doc_=Vt,this.usesDefaultWrapper_=!Tt.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw ln.alreadyDisposed();return this.doc_}dispose(){const Ct=this.containerElem_;if(!Ct)throw ln.alreadyDisposed();if(this.usesDefaultWrapper_){const lt=Ct.parentElement;lt&&lt.removeChild(Ct)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(Ct){("plugin"in Ct?[Ct.plugin]:"plugins"in Ct?Ct.plugins:[]).forEach(lt=>{this.pool_.register(lt),this.embedPluginStyle_(lt)})}embedPluginStyle_(Ct){Ct.css&&Sp(this.document,`plugin-${Ct.id}`,Ct.css)}setUpDefaultPlugins_(){Sp(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(Ct=>{this.embedPluginStyle_(Ct)}),this.registerPlugin({plugins:[Go,Yu,Av,G1]})}},_.SeparatorApi=gy,_.SliderApi=Ep,_.TabApi=Oo,_.TabPageApi=To,_.TextApi=k0,_.TpChangeEvent=Et,_.VERSION=wx,Object.defineProperty(_,"__esModule",{value:!0})})(_e)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor($){super($),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}transform($,_e){return $?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0($,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload($=!0,_e=!1){return $&&super.preload(),_e&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var $;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),($=eval(jsContent+`
DracoEncoderModule;`))==null?void 0:$()}),this.encoderPending}async initDecoder(){var $;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async _e=>_e.text()).then(_e=>{const _=_e.indexOf("/* worker */");if(_<1)throw new Error("unable to load decoder module");return _e.substring(0,_-1)});return($=eval(jsContent+`
DracoDecoderModule;`))==null?void 0:$()}async _loadLibrary($,_e){return DRACOLoader2.LibraryValueMap[$]?DRACOLoader2.LibraryValueMap[$]:DRACOLoader2.LibraryValueMap[$]=await super._loadLibrary($,_e)}static SetDecoderJsString($){this.LibraryValueMap["draco_decoder.js"]=$}}DRACOLoader2.LibraryValueMap={}},988:function($,_e,_){_.d(_e,{$TI:function(){return mP},$V:function(){return vP},$Vf:function(){return PB},$YQ:function(){return F0},A5E:function(){return ky},AXT:function(){return dT},Aip:function(){return gu},B02:function(){return Yt},BFQ:function(){return Av},BG$:function(){return bu},BKK:function(){return xP},BVF:function(){return _i},BVQ:function(){return mw},BbS:function(){return uP},Bf4:function(){return _l},BtG:function(){return JA},CJI:function(){return ru},CP7:function(){return Dx},CaW:function(){return sx},CdI:function(){return Cl},Cne:function(){return OB},CtA:function(){return qm},CtF:function(){return fu},D1R:function(){return Au},D9w:function(){return Oo},DT1:function(){return IB},Djp:function(){return OA},DqL:function(){return ST},DvJ:function(){return kv},E2K:function(){return ix},EB7:function(){return dE},EJi:function(){return J2},EoG:function(){return _c},F5T:function(){return ku},FDw:function(){return my},FE5:function(){return Qx},FIo:function(){return SC},FM8:function(){return Br},FT0:function(){return xT},FUD:function(){return Nr},FvO:function(){return VT},GG6:function(){return f0},GQ:function(){return SB},GUF:function(){return io},GVz:function(){return N1},GZb:function(){return RE},G_r:function(){return Mm},Gih:function(){return Ap},Gql:function(){return vB},H$k:function(){return Hx},HTd:function(){return UM},HW6:function(){return So},HdW:function(){return em},HgB:function(){return dx},HkE:function(){return iE},Hmr:function(){return DT},Hw6:function(){return c_},Hy8:function(){return zn},Hyl:function(){return jm},IEO:function(){return Ox},IFH:function(){return lx},IKL:function(){return bT},ILR:function(){return p0},IOt:function(){return Sm},Ilk:function(){return us},Ir4:function(){return UA},JOQ:function(){return Mp},JQ4:function(){return Pu},JUT:function(){return mx},JWc:function(){return Wu},KI_:function(){return Bs},Kgo:function(){return gw},KhW:function(){return Xn},Kj0:function(){return Ou},Kz5:function(){return DA},L5g:function(){return fm},L5s:function(){return b_},LBq:function(){return jT},LSk:function(){return wy},LY2:function(){return Jp},L_r:function(){return FA},Lcc:function(){return NB},LgZ:function(){return Wn},LsT:function(){return Ko},Ltg:function(){return No},Lun:function(){return ow},M5h:function(){return kn},M6v:function(){return Js},M8C:function(){return O1},Mig:function(){return SE},MyG:function(){return bo},N$j:function(){return hp},N4l:function(){return An},NDo:function(){return ba},NMF:function(){return wv},NYV:function(){return r_},Ns1:function(){return fo},NwF:function(){return n0},Ny0:function(){return pE},O7d:function(){return yw},OAl:function(){return RS},OM3:function(){return Go},OTo:function(){return P1},OdW:function(){return Qy},OoA:function(){return tp},Ox3:function(){return IT},PA7:function(){return U_},PMe:function(){return TT},Pa4:function(){return Rn},PeU:function(){return Pt},Pnf:function(){return N_},PpQ:function(){return jA},QM0:function(){return NA},QRU:function(){return w_},QZ1:function(){return hx},QmN:function(){return Et},Qpg:function(){return Sw},R2R:function(){return ET},REq:function(){return DB},RNb:function(){return z1},ROQ:function(){return G2},RSm:function(){return Z2},Rki:function(){return x_},RlZ:function(){return Sr},RsA:function(){return vt},RvT:function(){return k1},S2y:function(){return Ft},S3k:function(){return mu},S9g:function(){return T0},SJI:function(){return BT},SPe:function(){return j2},SUY:function(){return Zx},Se2:function(){return rn},Sm8:function(){return Kt},So8:function(){return zv},SvJ:function(){return es},Syv:function(){return Ms},T95:function(){return zo},TOt:function(){return yC},TUj:function(){return pm},TUv:function(){return Fm},T_1:function(){return HC},T_J:function(){return cx},T__:function(){return uT},T_f:function(){return PT},TlE:function(){return Jo},Tme:function(){return Po},Tn7:function(){return wE},TyD:function(){return Yo},U7:function(){return Q2},USm:function(){return M0},UY4:function(){return dw},UZH:function(){return dt},Uk6:function(){return Wx},UlW:function(){return g0},Uol:function(){return Fv},V1s:function(){return FS},V4E:function(){return BB},VLJ:function(){return s0},VYz:function(){return r0},Vdb:function(){return cr},Vj0:function(){return lp},Vkp:function(){return oo},VzW:function(){return yv},W2J:function(){return Jm},WMw:function(){return Nn},WTc:function(){return W_},WXh:function(){return ww},Wbm:function(){return Zt},WdD:function(){return ao},Wid:function(){return AT},Wjw:function(){return RB},Wl3:function(){return Pn},Wpd:function(){return ur},Wqd:function(){return gT},WwZ:function(){return ko},Wzm:function(){return lT},XZw:function(){return LB},Xaj:function(){return jt},Xcj:function(){return wB},XvJ:function(){return bE},Y8D:function(){return Mn},YBo:function(){return wT},YGz:function(){return $a},YKA:function(){return bv},YLQ:function(){return $p},YN5:function(){return CB},YT8:function(){return hT},Ywn:function(){return US},Z6B:function(){return _0},ZAu:function(){return Nu},ZQ6:function(){return pT},ZRs:function(){return Vo},ZTh:function(){return js},ZZA:function(){return Xx},Z_g:function(){return cT},Zp0:function(){return $x},Zr5:function(){return Dn},ZzF:function(){return Zm},Zzh:function(){return FC},_12:function(){return nv},_3:function(){return MB},_AM:function(){return rx},_C8:function(){return El},_Li:function(){return nn},_MY:function(){return hn},_YM:function(){return y_},_YX:function(){return GT},_am:function(){return jM},_fP:function(){return zp},_iA:function(){return _n},_kC:function(){return um},_lf:function(){return o_},_sL:function(){return Ay},a$l:function(){return fs},aCh:function(){return Cm},aH4:function(){return n_},aLr:function(){return Dm},aNw:function(){return lv},aVm:function(){return D0},ad5:function(){return IS},anP:function(){return Lr},aq0:function(){return oA},av9:function(){return R1},b5g:function(){return rC},bBp:function(){return pP},bGH:function(){return Wt},b_z:function(){return H0},bdR:function(){return dn},blk:function(){return Uv},bnF:function(){return Jy},brP:function(){return Up},bsb:function(){return ip},c8b:function(){return an},cBI:function(){return EB},cBK:function(){return CT},cJO:function(){return Aw},cLu:function(){return Zp},cPb:function(){return Cp},cRx:function(){return Wm},cU9:function(){return qo},ce8:function(){return hs},cek:function(){return xw},cum:function(){return by},dSO:function(){return Ll},dUE:function(){return Yx},dYG:function(){return tP},dZ3:function(){return bm},dd2:function(){return xu},dj0:function(){return Qu},dpR:function(){return IC},dwk:function(){return ln},e62:function(){return su},eD:function(){return jr},eMJ:function(){return nm},eaV:function(){return Em},ehD:function(){return Hn},ejS:function(){return Nv},ekQ:function(){return _f},epp:function(){return Pl},fHI:function(){return Yy},fO1:function(){return V2},fQA:function(){return AP},fQK:function(){return nC},fSK:function(){return ir},fY$:function(){return Ql},fto:function(){return D1},g8_:function(){return Np},gH0:function(){return UT},gSk:function(){return Lo},g_z:function(){return vC},ghN:function(){return yn},gi4:function(){return _y},gti:function(){return fT},hEm:function(){return To},hH6:function(){return Wp},iAb:function(){return eu},iDF:function(){return __},iKG:function(){return VS},iLg:function(){return t0},iMs:function(){return Vv},iUV:function(){return Fo},iWC:function(){return rr},iWj:function(){return W1},i_9:function(){return kT},iiP:function(){return Xm},irR:function(){return vy},j4z:function(){return B1},j87:function(){return k0},jAl:function(){return yy},jFi:function(){return Xt},jZA:function(){return i_},jfJ:function(){return Tm},jwo:function(){return ux},jyi:function(){return z0},jyz:function(){return p_},k0A:function(){return gy},k74:function(){return vr},kB5:function(){return j0},kFz:function(){return My},kaV:function(){return eP},knz:function(){return Nl},kqm:function(){return hP},ksN:function(){return hr},l0P:function(){return L_},l8J:function(){return v0},lCJ:function(){return Yu},lDi:function(){return DC},lGU:function(){return s_},lLk:function(){return TC},lRF:function(){return sw},lRj:function(){return nx},lb7:function(){return Qp},lfu:function(){return dp},lk7:function(){return i0},m7l:function(){return q0},mSO:function(){return wu},mTL:function(){return aP},mXe:function(){return fE},m_w:function(){return TB},mzJ:function(){return AB},nls:function(){return lm},ntZ:function(){return pn},ntt:function(){return Km},nvb:function(){return wP},o8S:function(){return W0},oAp:function(){return zM},oa8:function(){return Gx},oqc:function(){return nu},p3g:function(){return rm},p7y:function(){return fw},pBf:function(){return $m},pIN:function(){return m0},pKu:function(){return np},pQR:function(){return Vx},ptH:function(){return tu},qhX:function(){return no},qkB:function(){return xm},qlB:function(){return Ep},qyh:function(){return yp},rAo:function(){return V1},rBU:function(){return ls},rDY:function(){return FM},rOj:function(){return Bn},r_:function(){return Qt},rnI:function(){return Ym},rpg:function(){return wm},s4_:function(){return sP},sYA:function(){return X0},tEQ:function(){return EE},tGC:function(){return bP},tJx:function(){return ey},tUh:function(){return cm},tf:function(){return NC},tm_:function(){return Ut},trn:function(){return QT},u37:function(){return _B},u7G:function(){return Jx},u9r:function(){return Vt},uEv:function(){return tm},uL9:function(){return Mo},uWy:function(){return Tl},uXU:function(){return LA},ub3:function(){return tn},ujx:function(){return kB},v3W:function(){return kA},v9Y:function(){return yl},vBJ:function(){return Bm},vCF:function(){return Qn},vCx:function(){return BA},vZf:function(){return TS},vmT:function(){return hm},vpT:function(){return Hp},vuL:function(){return go},vxC:function(){return Ml},w$m:function(){return Kr},wJv:function(){return O_},wem:function(){return Il},wk1:function(){return Hu},woe:function(){return dC},wuA:function(){return d0},x12:function(){return Uo},x5V:function(){return bp},xEZ:function(){return ga},xG9:function(){return xB},xJs:function(){return ax},xWb:function(){return UC},xeV:function(){return sT},xfE:function(){return Hl},xo$:function(){return bw},xoR:function(){return $2},xsS:function(){return ov},y$t:function(){return Xy},y2t:function(){return ox},y8_:function(){return PE},yC1:function(){return A_},yGw:function(){return ro},ybr:function(){return lw},yj7:function(){return H2},ylh:function(){return gP},yo9:function(){return aw},yt0:function(){return PS},ywz:function(){return _v},yxD:function(){return iP},z$h:function(){return hu},z81:function(){return rs},z8B:function(){return Bx},zHn:function(){return C0},zbs:function(){return nP},zf8:function(){return G0}});const dt="152",vt={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Et={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Pt=0,Ut=1,Ft=2,Yt=3,hn=0,_n=1,pn=2,ln=3,Pn=0,nn=1,Hn=2,tn=2,Xt=0,dn=1,Nn=2,An=3,kn=4,jt=5,Wt=100,Zt=101,Bn=102,Qt=103,Kt=104,an=200,yn=201,Xn=202,rr=203,vr=204,Wn=205,ir=206,zn=207,cr=208,ur=209,Sr=210,_i=0,rn=1,Dn=2,Qn=3,jr=4,hr=5,Kr=6,Js=7,fo=0,no=1,ba=2,Mo=0,_c=1,Cl=2,$a=3,Jp=4,bm=5,Hl=300,Ql=301,Ml=302,Ll=303,_l=304,Np=306,wm=1e3,Tl=1001,tp=1002,Yo=1003,$p=1004,UM=1004,n_=1005,TS=1005,Il=1006,yp=1007,nx=1007,Au=1008,my=1008,_v=1009,zo=1010,eu=1011,Ko=1012,DA=1013,Pu=1014,yv=1015,Zp=1016,gy=1017,vy=1018,O_=1020,P1=1021,Hu=1023,Mn=1024,Wm=1025,xm=1026,Up=1027,To=1028,Oo=1029,R1=1030,qm=1031,ix=1033,d0=33776,Av=33777,kA=33778,p0=33779,rx=35840,BA=35841,Em=35842,sx=35843,D1=36196,L_=37492,_f=37496,tu=37808,i_=37809,ox=37810,_y=37811,OA=37812,bu=37813,r_=37814,ax=37815,np=37816,f0=37817,Ap=37818,Nr=37819,Xm=37820,es=37821,ip=36492,em=36283,go=36284,js=36285,s_=36286,yy=2200,bv=2201,tm=2202,Ms=2300,wv=2301,m0=2302,N_=2400,o_=2401,Ay=2402,lx=2500,Lo=2501,ko=0,g0=1,hu=2,Ym=3e3,Nl=3001,rs=3200,wu=3201,Sm=0,U_=1,Cm="",Bs="srgb",io="srgb-linear",Km="display-p3",Mm="rgbm-16",IS=0,bp=7680,hs=7681,Vo=7682,Tm=7683,nu=34055,cx=34056,nm=5386,bo=512,LA=513,ux=514,PS=515,RS=516,k1=517,B1=518,by=519,Jm=35044,Qu=35048,hx=35040,Wu=35045,NA=35049,UA=35041,dx=35046,v0=35050,_0=35042,yl="100",wy="300 es",FA=1035;class $m{addEventListener(a,j){this._listeners===void 0&&(this._listeners={});const nt=this._listeners;nt[a]===void 0&&(nt[a]=[]),nt[a].indexOf(j)===-1&&nt[a].push(j)}hasEventListener(a,j){if(this._listeners===void 0)return!1;const nt=this._listeners;return nt[a]!==void 0&&nt[a].indexOf(j)!==-1}removeEventListener(a,j){if(this._listeners===void 0)return;const nt=this._listeners[a];if(nt!==void 0){const it=nt.indexOf(j);it!==-1&&nt.splice(it,1)}}dispatchEvent(a){if(this._listeners===void 0)return;const j=this._listeners[a.type];if(j!==void 0){a.target=this;const nt=j.slice(0);for(let it=0,ot=nt.length;it<ot;it++)nt[it].call(this,a);a.target=null}}}const Al=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let DS=1234567;const a_=Math.PI/180,Im=180/Math.PI;function Fp(){const ut=4294967295*Math.random()|0,a=4294967295*Math.random()|0,j=4294967295*Math.random()|0,nt=4294967295*Math.random()|0;return(Al[255&ut]+Al[ut>>8&255]+Al[ut>>16&255]+Al[ut>>24&255]+"-"+Al[255&a]+Al[a>>8&255]+"-"+Al[a>>16&15|64]+Al[a>>24&255]+"-"+Al[63&j|128]+Al[j>>8&255]+"-"+Al[j>>16&255]+Al[j>>24&255]+Al[255&nt]+Al[nt>>8&255]+Al[nt>>16&255]+Al[nt>>24&255]).toLowerCase()}function Is(ut,a,j){return Math.max(a,Math.min(j,ut))}function xy(ut,a){return(ut%a+a)%a}function Ey(ut,a,j){return(1-j)*ut+j*a}function Sy(ut){return(ut&ut-1)==0&&ut!==0}function Ao(ut){return Math.pow(2,Math.ceil(Math.log(ut)/Math.LN2))}function l_(ut){return Math.pow(2,Math.floor(Math.log(ut)/Math.LN2))}function im(ut,a){switch(a.constructor){case Float32Array:return ut;case Uint16Array:return ut/65535;case Uint8Array:return ut/255;case Int16Array:return Math.max(ut/32767,-1);case Int8Array:return Math.max(ut/127,-1);default:throw new Error("Invalid component type.")}}function ho(ut,a){switch(a.constructor){case Float32Array:return ut;case Uint16Array:return Math.round(65535*ut);case Uint8Array:return Math.round(255*ut);case Int16Array:return Math.round(32767*ut);case Int8Array:return Math.round(127*ut);default:throw new Error("Invalid component type.")}}const O1={DEG2RAD:a_,RAD2DEG:Im,generateUUID:Fp,clamp:Is,euclideanModulo:xy,mapLinear:function(ut,a,j,nt,it){return nt+(ut-a)*(it-nt)/(j-a)},inverseLerp:function(ut,a,j){return ut!==a?(j-ut)/(a-ut):0},lerp:Ey,damp:function(ut,a,j,nt){return Ey(ut,a,1-Math.exp(-j*nt))},pingpong:function(ut,a=1){return a-Math.abs(xy(ut,2*a)-a)},smoothstep:function(ut,a,j){return ut<=a?0:ut>=j?1:(ut=(ut-a)/(j-a))*ut*(3-2*ut)},smootherstep:function(ut,a,j){return ut<=a?0:ut>=j?1:(ut=(ut-a)/(j-a))*ut*ut*(ut*(6*ut-15)+10)},randInt:function(ut,a){return ut+Math.floor(Math.random()*(a-ut+1))},randFloat:function(ut,a){return ut+Math.random()*(a-ut)},randFloatSpread:function(ut){return ut*(.5-Math.random())},seededRandom:function(ut){ut!==void 0&&(DS=ut);let a=DS+=1831565813;return a=Math.imul(a^a>>>15,1|a),a^=a+Math.imul(a^a>>>7,61|a),((a^a>>>14)>>>0)/4294967296},degToRad:function(ut){return ut*a_},radToDeg:function(ut){return ut*Im},isPowerOfTwo:Sy,ceilPowerOfTwo:Ao,floorPowerOfTwo:l_,setQuaternionFromProperEuler:function(ut,a,j,nt,it){const ot=Math.cos,ht=Math.sin,ft=ot(j/2),wt=ht(j/2),bt=ot((a+nt)/2),St=ht((a+nt)/2),Dt=ot((a-nt)/2),Rt=ht((a-nt)/2),kt=ot((nt-a)/2),Ot=ht((nt-a)/2);switch(it){case"XYX":ut.set(ft*St,wt*Dt,wt*Rt,ft*bt);break;case"YZY":ut.set(wt*Rt,ft*St,wt*Dt,ft*bt);break;case"ZXZ":ut.set(wt*Dt,wt*Rt,ft*St,ft*bt);break;case"XZX":ut.set(ft*St,wt*Ot,wt*kt,ft*bt);break;case"YXY":ut.set(wt*kt,ft*St,wt*Ot,ft*bt);break;case"ZYZ":ut.set(wt*Ot,wt*kt,ft*St,ft*bt);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+it)}},normalize:ho,denormalize:im};class Br{constructor(a=0,j=0){Br.prototype.isVector2=!0,this.x=a,this.y=j}get width(){return this.x}set width(a){this.x=a}get height(){return this.y}set height(a){this.y=a}set(a,j){return this.x=a,this.y=j,this}setScalar(a){return this.x=a,this.y=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setComponent(a,j){switch(a){case 0:this.x=j;break;case 1:this.y=j;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y)}copy(a){return this.x=a.x,this.y=a.y,this}add(a){return this.x+=a.x,this.y+=a.y,this}addScalar(a){return this.x+=a,this.y+=a,this}addVectors(a,j){return this.x=a.x+j.x,this.y=a.y+j.y,this}addScaledVector(a,j){return this.x+=a.x*j,this.y+=a.y*j,this}sub(a){return this.x-=a.x,this.y-=a.y,this}subScalar(a){return this.x-=a,this.y-=a,this}subVectors(a,j){return this.x=a.x-j.x,this.y=a.y-j.y,this}multiply(a){return this.x*=a.x,this.y*=a.y,this}multiplyScalar(a){return this.x*=a,this.y*=a,this}divide(a){return this.x/=a.x,this.y/=a.y,this}divideScalar(a){return this.multiplyScalar(1/a)}applyMatrix3(a){const j=this.x,nt=this.y,it=a.elements;return this.x=it[0]*j+it[3]*nt+it[6],this.y=it[1]*j+it[4]*nt+it[7],this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this}clamp(a,j){return this.x=Math.max(a.x,Math.min(j.x,this.x)),this.y=Math.max(a.y,Math.min(j.y,this.y)),this}clampScalar(a,j){return this.x=Math.max(a,Math.min(j,this.x)),this.y=Math.max(a,Math.min(j,this.y)),this}clampLength(a,j){const nt=this.length();return this.divideScalar(nt||1).multiplyScalar(Math.max(a,Math.min(j,nt)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(a){return this.x*a.x+this.y*a.y}cross(a){return this.x*a.y-this.y*a.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(a){const j=Math.sqrt(this.lengthSq()*a.lengthSq());if(j===0)return Math.PI/2;const nt=this.dot(a)/j;return Math.acos(Is(nt,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const j=this.x-a.x,nt=this.y-a.y;return j*j+nt*nt}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,j){return this.x+=(a.x-this.x)*j,this.y+=(a.y-this.y)*j,this}lerpVectors(a,j,nt){return this.x=a.x+(j.x-a.x)*nt,this.y=a.y+(j.y-a.y)*nt,this}equals(a){return a.x===this.x&&a.y===this.y}fromArray(a,j=0){return this.x=a[j],this.y=a[j+1],this}toArray(a=[],j=0){return a[j]=this.x,a[j+1]=this.y,a}fromBufferAttribute(a,j){return this.x=a.getX(j),this.y=a.getY(j),this}rotateAround(a,j){const nt=Math.cos(j),it=Math.sin(j),ot=this.x-a.x,ht=this.y-a.y;return this.x=ot*nt-ht*it+a.x,this.y=ot*it+ht*nt+a.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class oo{constructor(){oo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(a,j,nt,it,ot,ht,ft,wt,bt){const St=this.elements;return St[0]=a,St[1]=it,St[2]=ft,St[3]=j,St[4]=ot,St[5]=wt,St[6]=nt,St[7]=ht,St[8]=bt,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(a){const j=this.elements,nt=a.elements;return j[0]=nt[0],j[1]=nt[1],j[2]=nt[2],j[3]=nt[3],j[4]=nt[4],j[5]=nt[5],j[6]=nt[6],j[7]=nt[7],j[8]=nt[8],this}extractBasis(a,j,nt){return a.setFromMatrix3Column(this,0),j.setFromMatrix3Column(this,1),nt.setFromMatrix3Column(this,2),this}setFromMatrix4(a){const j=a.elements;return this.set(j[0],j[4],j[8],j[1],j[5],j[9],j[2],j[6],j[10]),this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,j){const nt=a.elements,it=j.elements,ot=this.elements,ht=nt[0],ft=nt[3],wt=nt[6],bt=nt[1],St=nt[4],Dt=nt[7],Rt=nt[2],kt=nt[5],Ot=nt[8],Gt=it[0],Nt=it[3],zt=it[6],qt=it[1],$t=it[4],En=it[7],gn=it[2],vn=it[5],Un=it[8];return ot[0]=ht*Gt+ft*qt+wt*gn,ot[3]=ht*Nt+ft*$t+wt*vn,ot[6]=ht*zt+ft*En+wt*Un,ot[1]=bt*Gt+St*qt+Dt*gn,ot[4]=bt*Nt+St*$t+Dt*vn,ot[7]=bt*zt+St*En+Dt*Un,ot[2]=Rt*Gt+kt*qt+Ot*gn,ot[5]=Rt*Nt+kt*$t+Ot*vn,ot[8]=Rt*zt+kt*En+Ot*Un,this}multiplyScalar(a){const j=this.elements;return j[0]*=a,j[3]*=a,j[6]*=a,j[1]*=a,j[4]*=a,j[7]*=a,j[2]*=a,j[5]*=a,j[8]*=a,this}determinant(){const a=this.elements,j=a[0],nt=a[1],it=a[2],ot=a[3],ht=a[4],ft=a[5],wt=a[6],bt=a[7],St=a[8];return j*ht*St-j*ft*bt-nt*ot*St+nt*ft*wt+it*ot*bt-it*ht*wt}invert(){const a=this.elements,j=a[0],nt=a[1],it=a[2],ot=a[3],ht=a[4],ft=a[5],wt=a[6],bt=a[7],St=a[8],Dt=St*ht-ft*bt,Rt=ft*wt-St*ot,kt=bt*ot-ht*wt,Ot=j*Dt+nt*Rt+it*kt;if(Ot===0)return this.set(0,0,0,0,0,0,0,0,0);const Gt=1/Ot;return a[0]=Dt*Gt,a[1]=(it*bt-St*nt)*Gt,a[2]=(ft*nt-it*ht)*Gt,a[3]=Rt*Gt,a[4]=(St*j-it*wt)*Gt,a[5]=(it*ot-ft*j)*Gt,a[6]=kt*Gt,a[7]=(nt*wt-bt*j)*Gt,a[8]=(ht*j-nt*ot)*Gt,this}transpose(){let a;const j=this.elements;return a=j[1],j[1]=j[3],j[3]=a,a=j[2],j[2]=j[6],j[6]=a,a=j[5],j[5]=j[7],j[7]=a,this}getNormalMatrix(a){return this.setFromMatrix4(a).invert().transpose()}transposeIntoArray(a){const j=this.elements;return a[0]=j[0],a[1]=j[3],a[2]=j[6],a[3]=j[1],a[4]=j[4],a[5]=j[7],a[6]=j[2],a[7]=j[5],a[8]=j[8],this}setUvTransform(a,j,nt,it,ot,ht,ft){const wt=Math.cos(ot),bt=Math.sin(ot);return this.set(nt*wt,nt*bt,-nt*(wt*ht+bt*ft)+ht+a,-it*bt,it*wt,-it*(-bt*ht+wt*ft)+ft+j,0,0,1),this}scale(a,j){return this.premultiply(jp.makeScale(a,j)),this}rotate(a){return this.premultiply(jp.makeRotation(-a)),this}translate(a,j){return this.premultiply(jp.makeTranslation(a,j)),this}makeTranslation(a,j){return this.set(1,0,a,0,1,j,0,0,1),this}makeRotation(a){const j=Math.cos(a),nt=Math.sin(a);return this.set(j,-nt,0,nt,j,0,0,0,1),this}makeScale(a,j){return this.set(a,0,0,0,j,0,0,0,1),this}equals(a){const j=this.elements,nt=a.elements;for(let it=0;it<9;it++)if(j[it]!==nt[it])return!1;return!0}fromArray(a,j=0){for(let nt=0;nt<9;nt++)this.elements[nt]=a[nt+j];return this}toArray(a=[],j=0){const nt=this.elements;return a[j]=nt[0],a[j+1]=nt[1],a[j+2]=nt[2],a[j+3]=nt[3],a[j+4]=nt[4],a[j+5]=nt[5],a[j+6]=nt[6],a[j+7]=nt[7],a[j+8]=nt[8],a}clone(){return new this.constructor().fromArray(this.elements)}}const jp=new oo;function kS(ut){for(let a=ut.length-1;a>=0;--a)if(ut[a]>=65535)return!0;return!1}const BS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function y0(ut,a){return new BS[ut](a)}function Cy(ut){return document.createElementNS("http://www.w3.org/1999/xhtml",ut)}const px={};function A0(ut){ut in px||(px[ut]=!0,console.warn(ut))}function b0(ut){return ut<.04045?.0773993808*ut:Math.pow(.9478672986*ut+.0521327014,2.4)}function fx(ut){return ut<.0031308?12.92*ut:1.055*Math.pow(ut,.41666)-.055}const OS=new oo().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),L1=new oo().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),LS={[io]:ut=>ut,[Bs]:ut=>ut.convertSRGBToLinear(),[Km]:function(ut){return ut.convertSRGBToLinear().applyMatrix3(L1)}},NS={[io]:ut=>ut,[Bs]:ut=>ut.convertLinearToSRGB(),[Km]:function(ut){return ut.applyMatrix3(OS).convertLinearToSRGB()}},Pl={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(ut){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!ut},get workingColorSpace(){return io},set workingColorSpace(ut){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(ut,a,j){if(this.enabled===!1||a===j||!a||!j)return ut;const nt=LS[a],it=NS[j];if(nt===void 0||it===void 0)throw new Error(`Unsupported color space conversion, "${a}" to "${j}".`);return it(nt(ut))},fromWorkingColorSpace:function(ut,a){return this.convert(ut,this.workingColorSpace,a)},toWorkingColorSpace:function(ut,a){return this.convert(ut,a,this.workingColorSpace)}};let Pm;class jA{static getDataURL(a,j=!1){if(/^data:/i.test(a.src)||typeof HTMLCanvasElement>"u")return a.src;let nt;if(a instanceof HTMLCanvasElement)nt=a;else{Pm===void 0&&(Pm=Cy("canvas")),Pm.width=a.width,Pm.height=a.height;const it=Pm.getContext("2d");a instanceof ImageData?it.putImageData(a,0,0):it.drawImage(a,0,0,a.width,a.height),nt=Pm}return!j&&(nt.width>2048||nt.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",a),nt.toDataURL("image/jpeg",.6)):nt.toDataURL("image/png")}static sRGBToLinear(a){if(typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap){const j=Cy("canvas");j.width=a.width,j.height=a.height;const nt=j.getContext("2d");nt.drawImage(a,0,0,a.width,a.height);const it=nt.getImageData(0,0,a.width,a.height),ot=it.data;for(let ht=0;ht<ot.length;ht++)ot[ht]=255*b0(ot[ht]/255);return nt.putImageData(it,0,0),j}if(a.data){const j=a.data.slice(0);for(let nt=0;nt<j.length;nt++)j instanceof Uint8Array||j instanceof Uint8ClampedArray?j[nt]=Math.floor(255*b0(j[nt]/255)):j[nt]=b0(j[nt]);return{data:j,width:a.width,height:a.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),a}}class c_{constructor(a=null){this.isSource=!0,this.uuid=Fp(),this.data=a,this.version=0}set needsUpdate(a){a===!0&&this.version++}toJSON(a){const j=a===void 0||typeof a=="string";if(!j&&a.images[this.uuid]!==void 0)return a.images[this.uuid];const nt={uuid:this.uuid,url:""},it=this.data;if(it!==null){let ot;if(Array.isArray(it)){ot=[];for(let ht=0,ft=it.length;ht<ft;ht++)it[ht].isDataTexture?ot.push(zA(it[ht].image)):ot.push(zA(it[ht]))}else ot=zA(it);nt.url=ot}return j||(a.images[this.uuid]=nt),nt}}function zA(ut){if(typeof HTMLImageElement<"u"&&ut instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ut instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ut instanceof ImageBitmap)return jA.getDataURL(ut);if(ut.data){let a=[];try{a=Array.from(ut.data)}catch(j){j.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(j),a=ut.data}return{data:a,width:ut.width,height:ut.height,type:ut.data.constructor.name}}return ut.url!==void 0?ut.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let VA=0;class ga extends $m{constructor(a=ga.DEFAULT_IMAGE,j=ga.DEFAULT_MAPPING,nt=Tl,it=Tl,ot=Il,ht=Au,ft=Hu,wt=_v,bt=ga.DEFAULT_ANISOTROPY,St=Cm){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:VA++}),this.uuid=Fp(),this.name="",this.source=new c_(a),this.mipmaps=[],this.mapping=j,this.channel=0,this.wrapS=nt,this.wrapT=it,this.magFilter=ot,this.minFilter=ht,this.anisotropy=bt,this.format=ft,this.internalFormat=null,this.type=wt,this.offset=new Br(0,0),this.repeat=new Br(1,1),this.center=new Br(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new oo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof St=="string"?this.colorSpace=St:(A0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=St===Nl?Bs:Cm),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(a=null){this.source.data=a}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(a){return this.name=a.name,this.source=a.source,this.mipmaps=a.mipmaps.slice(0),this.mapping=a.mapping,this.channel=a.channel,this.wrapS=a.wrapS,this.wrapT=a.wrapT,this.magFilter=a.magFilter,this.minFilter=a.minFilter,this.anisotropy=a.anisotropy,this.format=a.format,this.internalFormat=a.internalFormat,this.type=a.type,this.offset.copy(a.offset),this.repeat.copy(a.repeat),this.center.copy(a.center),this.rotation=a.rotation,this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrix.copy(a.matrix),this.generateMipmaps=a.generateMipmaps,this.premultiplyAlpha=a.premultiplyAlpha,this.flipY=a.flipY,this.unpackAlignment=a.unpackAlignment,this.colorSpace=a.colorSpace,this.userData=JSON.parse(JSON.stringify(a.userData)),this.needsUpdate=!0,this}toJSON(a){const j=a===void 0||typeof a=="string";if(!j&&a.textures[this.uuid]!==void 0)return a.textures[this.uuid];const nt={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(a).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===Bs?Nl:Ym,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(nt.userData=this.userData),j||(a.textures[this.uuid]=nt),nt}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(a){if(this.mapping!==Hl)return a;if(a.applyMatrix3(this.matrix),a.x<0||a.x>1)switch(this.wrapS){case wm:a.x=a.x-Math.floor(a.x);break;case Tl:a.x=a.x<0?0:1;break;case tp:Math.abs(Math.floor(a.x)%2)===1?a.x=Math.ceil(a.x)-a.x:a.x=a.x-Math.floor(a.x)}if(a.y<0||a.y>1)switch(this.wrapT){case wm:a.y=a.y-Math.floor(a.y);break;case Tl:a.y=a.y<0?0:1;break;case tp:Math.abs(Math.floor(a.y)%2)===1?a.y=Math.ceil(a.y)-a.y:a.y=a.y-Math.floor(a.y)}return this.flipY&&(a.y=1-a.y),a}set needsUpdate(a){a===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return A0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Bs?Nl:Ym}set encoding(a){A0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=a===Nl?Bs:Cm}}ga.DEFAULT_IMAGE=null,ga.DEFAULT_MAPPING=Hl,ga.DEFAULT_ANISOTROPY=1;class No{constructor(a=0,j=0,nt=0,it=1){No.prototype.isVector4=!0,this.x=a,this.y=j,this.z=nt,this.w=it}get width(){return this.z}set width(a){this.z=a}get height(){return this.w}set height(a){this.w=a}set(a,j,nt,it){return this.x=a,this.y=j,this.z=nt,this.w=it,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this.w=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setW(a){return this.w=a,this}setComponent(a,j){switch(a){case 0:this.x=j;break;case 1:this.y=j;break;case 2:this.z=j;break;case 3:this.w=j;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w!==void 0?a.w:1,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this}addVectors(a,j){return this.x=a.x+j.x,this.y=a.y+j.y,this.z=a.z+j.z,this.w=a.w+j.w,this}addScaledVector(a,j){return this.x+=a.x*j,this.y+=a.y*j,this.z+=a.z*j,this.w+=a.w*j,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this.w-=a,this}subVectors(a,j){return this.x=a.x-j.x,this.y=a.y-j.y,this.z=a.z-j.z,this.w=a.w-j.w,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this}applyMatrix4(a){const j=this.x,nt=this.y,it=this.z,ot=this.w,ht=a.elements;return this.x=ht[0]*j+ht[4]*nt+ht[8]*it+ht[12]*ot,this.y=ht[1]*j+ht[5]*nt+ht[9]*it+ht[13]*ot,this.z=ht[2]*j+ht[6]*nt+ht[10]*it+ht[14]*ot,this.w=ht[3]*j+ht[7]*nt+ht[11]*it+ht[15]*ot,this}divideScalar(a){return this.multiplyScalar(1/a)}setAxisAngleFromQuaternion(a){this.w=2*Math.acos(a.w);const j=Math.sqrt(1-a.w*a.w);return j<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/j,this.y=a.y/j,this.z=a.z/j),this}setAxisAngleFromRotationMatrix(a){let j,nt,it,ot;const wt=a.elements,bt=wt[0],St=wt[4],Dt=wt[8],Rt=wt[1],kt=wt[5],Ot=wt[9],Gt=wt[2],Nt=wt[6],zt=wt[10];if(Math.abs(St-Rt)<.01&&Math.abs(Dt-Gt)<.01&&Math.abs(Ot-Nt)<.01){if(Math.abs(St+Rt)<.1&&Math.abs(Dt+Gt)<.1&&Math.abs(Ot+Nt)<.1&&Math.abs(bt+kt+zt-3)<.1)return this.set(1,0,0,0),this;j=Math.PI;const $t=(bt+1)/2,En=(kt+1)/2,gn=(zt+1)/2,vn=(St+Rt)/4,Un=(Dt+Gt)/4,$n=(Ot+Nt)/4;return $t>En&&$t>gn?$t<.01?(nt=0,it=.707106781,ot=.707106781):(nt=Math.sqrt($t),it=vn/nt,ot=Un/nt):En>gn?En<.01?(nt=.707106781,it=0,ot=.707106781):(it=Math.sqrt(En),nt=vn/it,ot=$n/it):gn<.01?(nt=.707106781,it=.707106781,ot=0):(ot=Math.sqrt(gn),nt=Un/ot,it=$n/ot),this.set(nt,it,ot,j),this}let qt=Math.sqrt((Nt-Ot)*(Nt-Ot)+(Dt-Gt)*(Dt-Gt)+(Rt-St)*(Rt-St));return Math.abs(qt)<.001&&(qt=1),this.x=(Nt-Ot)/qt,this.y=(Dt-Gt)/qt,this.z=(Rt-St)/qt,this.w=Math.acos((bt+kt+zt-1)/2),this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this.w=Math.min(this.w,a.w),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this.w=Math.max(this.w,a.w),this}clamp(a,j){return this.x=Math.max(a.x,Math.min(j.x,this.x)),this.y=Math.max(a.y,Math.min(j.y,this.y)),this.z=Math.max(a.z,Math.min(j.z,this.z)),this.w=Math.max(a.w,Math.min(j.w,this.w)),this}clampScalar(a,j){return this.x=Math.max(a,Math.min(j,this.x)),this.y=Math.max(a,Math.min(j,this.y)),this.z=Math.max(a,Math.min(j,this.z)),this.w=Math.max(a,Math.min(j,this.w)),this}clampLength(a,j){const nt=this.length();return this.divideScalar(nt||1).multiplyScalar(Math.max(a,Math.min(j,nt)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,j){return this.x+=(a.x-this.x)*j,this.y+=(a.y-this.y)*j,this.z+=(a.z-this.z)*j,this.w+=(a.w-this.w)*j,this}lerpVectors(a,j,nt){return this.x=a.x+(j.x-a.x)*nt,this.y=a.y+(j.y-a.y)*nt,this.z=a.z+(j.z-a.z)*nt,this.w=a.w+(j.w-a.w)*nt,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w}fromArray(a,j=0){return this.x=a[j],this.y=a[j+1],this.z=a[j+2],this.w=a[j+3],this}toArray(a=[],j=0){return a[j]=this.x,a[j+1]=this.y,a[j+2]=this.z,a[j+3]=this.w,a}fromBufferAttribute(a,j){return this.x=a.getX(j),this.y=a.getY(j),this.z=a.getZ(j),this.w=a.getW(j),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class xu extends $m{constructor(a=1,j=1,nt={}){super(),this.isWebGLRenderTarget=!0,this.width=a,this.height=j,this.depth=1,this.scissor=new No(0,0,a,j),this.scissorTest=!1,this.viewport=new No(0,0,a,j);const it={width:a,height:j,depth:1};nt.encoding!==void 0&&(A0("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),nt.colorSpace=nt.encoding===Nl?Bs:Cm),this.texture=new ga(it,nt.mapping,nt.wrapS,nt.wrapT,nt.magFilter,nt.minFilter,nt.format,nt.type,nt.anisotropy,nt.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=nt.generateMipmaps!==void 0&&nt.generateMipmaps,this.texture.internalFormat=nt.internalFormat!==void 0?nt.internalFormat:null,this.texture.minFilter=nt.minFilter!==void 0?nt.minFilter:Il,this.depthBuffer=nt.depthBuffer===void 0||nt.depthBuffer,this.stencilBuffer=nt.stencilBuffer!==void 0&&nt.stencilBuffer,this.depthTexture=nt.depthTexture!==void 0?nt.depthTexture:null,this.samples=nt.samples!==void 0?nt.samples:0}setSize(a,j,nt=1){this.width===a&&this.height===j&&this.depth===nt||(this.width=a,this.height=j,this.depth=nt,this.texture.image.width=a,this.texture.image.height=j,this.texture.image.depth=nt,this.dispose()),this.viewport.set(0,0,a,j),this.scissor.set(0,0,a,j)}clone(){return new this.constructor().copy(this)}copy(a){this.width=a.width,this.height=a.height,this.depth=a.depth,this.scissor.copy(a.scissor),this.scissorTest=a.scissorTest,this.viewport.copy(a.viewport),this.texture=a.texture.clone(),this.texture.isRenderTargetTexture=!0;const j=Object.assign({},a.texture.image);return this.texture.source=new c_(j),this.depthBuffer=a.depthBuffer,this.stencilBuffer=a.stencilBuffer,a.depthTexture!==null&&(this.depthTexture=a.depthTexture.clone()),this.samples=a.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class rm extends ga{constructor(a=null,j=1,nt=1,it=1){super(null),this.isDataArrayTexture=!0,this.image={data:a,width:j,height:nt,depth:it},this.magFilter=Yo,this.minFilter=Yo,this.wrapR=Tl,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class N1 extends xu{constructor(a=1,j=1,nt=1){super(a,j),this.isWebGLArrayRenderTarget=!0,this.depth=nt,this.texture=new rm(null,a,j,nt),this.texture.isRenderTargetTexture=!0}}class mx extends ga{constructor(a=null,j=1,nt=1,it=1){super(null),this.isData3DTexture=!0,this.image={data:a,width:j,height:nt,depth:it},this.magFilter=Yo,this.minFilter=Yo,this.wrapR=Tl,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class US extends xu{constructor(a=1,j=1,nt=1){super(a,j),this.isWebGL3DRenderTarget=!0,this.depth=nt,this.texture=new mx(null,a,j,nt),this.texture.isRenderTargetTexture=!0}}class My extends xu{constructor(a=1,j=1,nt=1,it={}){super(a,j,it),this.isWebGLMultipleRenderTargets=!0;const ot=this.texture;this.texture=[];for(let ht=0;ht<nt;ht++)this.texture[ht]=ot.clone(),this.texture[ht].isRenderTargetTexture=!0}setSize(a,j,nt=1){if(this.width!==a||this.height!==j||this.depth!==nt){this.width=a,this.height=j,this.depth=nt;for(let it=0,ot=this.texture.length;it<ot;it++)this.texture[it].image.width=a,this.texture[it].image.height=j,this.texture[it].image.depth=nt;this.dispose()}return this.viewport.set(0,0,a,j),this.scissor.set(0,0,a,j),this}copy(a){this.dispose(),this.width=a.width,this.height=a.height,this.depth=a.depth,this.scissor.copy(a.scissor),this.scissorTest=a.scissorTest,this.viewport.copy(a.viewport),this.depthBuffer=a.depthBuffer,this.stencilBuffer=a.stencilBuffer,a.depthTexture!==null&&(this.depthTexture=a.depthTexture.clone()),this.texture.length=0;for(let j=0,nt=a.texture.length;j<nt;j++)this.texture[j]=a.texture[j].clone(),this.texture[j].isRenderTargetTexture=!0;return this}}class zp{constructor(a=0,j=0,nt=0,it=1){this.isQuaternion=!0,this._x=a,this._y=j,this._z=nt,this._w=it}static slerpFlat(a,j,nt,it,ot,ht,ft){let wt=nt[it+0],bt=nt[it+1],St=nt[it+2],Dt=nt[it+3];const Rt=ot[ht+0],kt=ot[ht+1],Ot=ot[ht+2],Gt=ot[ht+3];if(ft===0)return a[j+0]=wt,a[j+1]=bt,a[j+2]=St,void(a[j+3]=Dt);if(ft===1)return a[j+0]=Rt,a[j+1]=kt,a[j+2]=Ot,void(a[j+3]=Gt);if(Dt!==Gt||wt!==Rt||bt!==kt||St!==Ot){let Nt=1-ft;const zt=wt*Rt+bt*kt+St*Ot+Dt*Gt,qt=zt>=0?1:-1,$t=1-zt*zt;if($t>Number.EPSILON){const gn=Math.sqrt($t),vn=Math.atan2(gn,zt*qt);Nt=Math.sin(Nt*vn)/gn,ft=Math.sin(ft*vn)/gn}const En=ft*qt;if(wt=wt*Nt+Rt*En,bt=bt*Nt+kt*En,St=St*Nt+Ot*En,Dt=Dt*Nt+Gt*En,Nt===1-ft){const gn=1/Math.sqrt(wt*wt+bt*bt+St*St+Dt*Dt);wt*=gn,bt*=gn,St*=gn,Dt*=gn}}a[j]=wt,a[j+1]=bt,a[j+2]=St,a[j+3]=Dt}static multiplyQuaternionsFlat(a,j,nt,it,ot,ht){const ft=nt[it],wt=nt[it+1],bt=nt[it+2],St=nt[it+3],Dt=ot[ht],Rt=ot[ht+1],kt=ot[ht+2],Ot=ot[ht+3];return a[j]=ft*Ot+St*Dt+wt*kt-bt*Rt,a[j+1]=wt*Ot+St*Rt+bt*Dt-ft*kt,a[j+2]=bt*Ot+St*kt+ft*Rt-wt*Dt,a[j+3]=St*Ot-ft*Dt-wt*Rt-bt*kt,a}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get w(){return this._w}set w(a){this._w=a,this._onChangeCallback()}set(a,j,nt,it){return this._x=a,this._y=j,this._z=nt,this._w=it,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this._onChangeCallback(),this}setFromEuler(a,j){const nt=a._x,it=a._y,ot=a._z,ht=a._order,ft=Math.cos,wt=Math.sin,bt=ft(nt/2),St=ft(it/2),Dt=ft(ot/2),Rt=wt(nt/2),kt=wt(it/2),Ot=wt(ot/2);switch(ht){case"XYZ":this._x=Rt*St*Dt+bt*kt*Ot,this._y=bt*kt*Dt-Rt*St*Ot,this._z=bt*St*Ot+Rt*kt*Dt,this._w=bt*St*Dt-Rt*kt*Ot;break;case"YXZ":this._x=Rt*St*Dt+bt*kt*Ot,this._y=bt*kt*Dt-Rt*St*Ot,this._z=bt*St*Ot-Rt*kt*Dt,this._w=bt*St*Dt+Rt*kt*Ot;break;case"ZXY":this._x=Rt*St*Dt-bt*kt*Ot,this._y=bt*kt*Dt+Rt*St*Ot,this._z=bt*St*Ot+Rt*kt*Dt,this._w=bt*St*Dt-Rt*kt*Ot;break;case"ZYX":this._x=Rt*St*Dt-bt*kt*Ot,this._y=bt*kt*Dt+Rt*St*Ot,this._z=bt*St*Ot-Rt*kt*Dt,this._w=bt*St*Dt+Rt*kt*Ot;break;case"YZX":this._x=Rt*St*Dt+bt*kt*Ot,this._y=bt*kt*Dt+Rt*St*Ot,this._z=bt*St*Ot-Rt*kt*Dt,this._w=bt*St*Dt-Rt*kt*Ot;break;case"XZY":this._x=Rt*St*Dt-bt*kt*Ot,this._y=bt*kt*Dt-Rt*St*Ot,this._z=bt*St*Ot+Rt*kt*Dt,this._w=bt*St*Dt+Rt*kt*Ot;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+ht)}return j!==!1&&this._onChangeCallback(),this}setFromAxisAngle(a,j){const nt=j/2,it=Math.sin(nt);return this._x=a.x*it,this._y=a.y*it,this._z=a.z*it,this._w=Math.cos(nt),this._onChangeCallback(),this}setFromRotationMatrix(a){const j=a.elements,nt=j[0],it=j[4],ot=j[8],ht=j[1],ft=j[5],wt=j[9],bt=j[2],St=j[6],Dt=j[10],Rt=nt+ft+Dt;if(Rt>0){const kt=.5/Math.sqrt(Rt+1);this._w=.25/kt,this._x=(St-wt)*kt,this._y=(ot-bt)*kt,this._z=(ht-it)*kt}else if(nt>ft&&nt>Dt){const kt=2*Math.sqrt(1+nt-ft-Dt);this._w=(St-wt)/kt,this._x=.25*kt,this._y=(it+ht)/kt,this._z=(ot+bt)/kt}else if(ft>Dt){const kt=2*Math.sqrt(1+ft-nt-Dt);this._w=(ot-bt)/kt,this._x=(it+ht)/kt,this._y=.25*kt,this._z=(wt+St)/kt}else{const kt=2*Math.sqrt(1+Dt-nt-ft);this._w=(ht-it)/kt,this._x=(ot+bt)/kt,this._y=(wt+St)/kt,this._z=.25*kt}return this._onChangeCallback(),this}setFromUnitVectors(a,j){let nt=a.dot(j)+1;return nt<Number.EPSILON?(nt=0,Math.abs(a.x)>Math.abs(a.z)?(this._x=-a.y,this._y=a.x,this._z=0,this._w=nt):(this._x=0,this._y=-a.z,this._z=a.y,this._w=nt)):(this._x=a.y*j.z-a.z*j.y,this._y=a.z*j.x-a.x*j.z,this._z=a.x*j.y-a.y*j.x,this._w=nt),this.normalize()}angleTo(a){return 2*Math.acos(Math.abs(Is(this.dot(a),-1,1)))}rotateTowards(a,j){const nt=this.angleTo(a);if(nt===0)return this;const it=Math.min(1,j/nt);return this.slerp(a,it),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let a=this.length();return a===0?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this._onChangeCallback(),this}multiply(a){return this.multiplyQuaternions(this,a)}premultiply(a){return this.multiplyQuaternions(a,this)}multiplyQuaternions(a,j){const nt=a._x,it=a._y,ot=a._z,ht=a._w,ft=j._x,wt=j._y,bt=j._z,St=j._w;return this._x=nt*St+ht*ft+it*bt-ot*wt,this._y=it*St+ht*wt+ot*ft-nt*bt,this._z=ot*St+ht*bt+nt*wt-it*ft,this._w=ht*St-nt*ft-it*wt-ot*bt,this._onChangeCallback(),this}slerp(a,j){if(j===0)return this;if(j===1)return this.copy(a);const nt=this._x,it=this._y,ot=this._z,ht=this._w;let ft=ht*a._w+nt*a._x+it*a._y+ot*a._z;if(ft<0?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,ft=-ft):this.copy(a),ft>=1)return this._w=ht,this._x=nt,this._y=it,this._z=ot,this;const wt=1-ft*ft;if(wt<=Number.EPSILON){const kt=1-j;return this._w=kt*ht+j*this._w,this._x=kt*nt+j*this._x,this._y=kt*it+j*this._y,this._z=kt*ot+j*this._z,this.normalize(),this._onChangeCallback(),this}const bt=Math.sqrt(wt),St=Math.atan2(bt,ft),Dt=Math.sin((1-j)*St)/bt,Rt=Math.sin(j*St)/bt;return this._w=ht*Dt+this._w*Rt,this._x=nt*Dt+this._x*Rt,this._y=it*Dt+this._y*Rt,this._z=ot*Dt+this._z*Rt,this._onChangeCallback(),this}slerpQuaternions(a,j,nt){return this.copy(a).slerp(j,nt)}random(){const a=Math.random(),j=Math.sqrt(1-a),nt=Math.sqrt(a),it=2*Math.PI*Math.random(),ot=2*Math.PI*Math.random();return this.set(j*Math.cos(it),nt*Math.sin(ot),nt*Math.cos(ot),j*Math.sin(it))}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w}fromArray(a,j=0){return this._x=a[j],this._y=a[j+1],this._z=a[j+2],this._w=a[j+3],this._onChangeCallback(),this}toArray(a=[],j=0){return a[j]=this._x,a[j+1]=this._y,a[j+2]=this._z,a[j+3]=this._w,a}fromBufferAttribute(a,j){return this._x=a.getX(j),this._y=a.getY(j),this._z=a.getZ(j),this._w=a.getW(j),this}toJSON(){return this.toArray()}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Rn{constructor(a=0,j=0,nt=0){Rn.prototype.isVector3=!0,this.x=a,this.y=j,this.z=nt}set(a,j,nt){return nt===void 0&&(nt=this.z),this.x=a,this.y=j,this.z=nt,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setComponent(a,j){switch(a){case 0:this.x=j;break;case 1:this.y=j;break;case 2:this.z=j;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this}addVectors(a,j){return this.x=a.x+j.x,this.y=a.y+j.y,this.z=a.z+j.z,this}addScaledVector(a,j){return this.x+=a.x*j,this.y+=a.y*j,this.z+=a.z*j,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this}subVectors(a,j){return this.x=a.x-j.x,this.y=a.y-j.y,this.z=a.z-j.z,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this}multiplyVectors(a,j){return this.x=a.x*j.x,this.y=a.y*j.y,this.z=a.z*j.z,this}applyEuler(a){return this.applyQuaternion(vx.setFromEuler(a))}applyAxisAngle(a,j){return this.applyQuaternion(vx.setFromAxisAngle(a,j))}applyMatrix3(a){const j=this.x,nt=this.y,it=this.z,ot=a.elements;return this.x=ot[0]*j+ot[3]*nt+ot[6]*it,this.y=ot[1]*j+ot[4]*nt+ot[7]*it,this.z=ot[2]*j+ot[5]*nt+ot[8]*it,this}applyNormalMatrix(a){return this.applyMatrix3(a).normalize()}applyMatrix4(a){const j=this.x,nt=this.y,it=this.z,ot=a.elements,ht=1/(ot[3]*j+ot[7]*nt+ot[11]*it+ot[15]);return this.x=(ot[0]*j+ot[4]*nt+ot[8]*it+ot[12])*ht,this.y=(ot[1]*j+ot[5]*nt+ot[9]*it+ot[13])*ht,this.z=(ot[2]*j+ot[6]*nt+ot[10]*it+ot[14])*ht,this}applyQuaternion(a){const j=this.x,nt=this.y,it=this.z,ot=a.x,ht=a.y,ft=a.z,wt=a.w,bt=wt*j+ht*it-ft*nt,St=wt*nt+ft*j-ot*it,Dt=wt*it+ot*nt-ht*j,Rt=-ot*j-ht*nt-ft*it;return this.x=bt*wt+Rt*-ot+St*-ft-Dt*-ht,this.y=St*wt+Rt*-ht+Dt*-ot-bt*-ft,this.z=Dt*wt+Rt*-ft+bt*-ht-St*-ot,this}project(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)}unproject(a){return this.applyMatrix4(a.projectionMatrixInverse).applyMatrix4(a.matrixWorld)}transformDirection(a){const j=this.x,nt=this.y,it=this.z,ot=a.elements;return this.x=ot[0]*j+ot[4]*nt+ot[8]*it,this.y=ot[1]*j+ot[5]*nt+ot[9]*it,this.z=ot[2]*j+ot[6]*nt+ot[10]*it,this.normalize()}divide(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this}divideScalar(a){return this.multiplyScalar(1/a)}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this}clamp(a,j){return this.x=Math.max(a.x,Math.min(j.x,this.x)),this.y=Math.max(a.y,Math.min(j.y,this.y)),this.z=Math.max(a.z,Math.min(j.z,this.z)),this}clampScalar(a,j){return this.x=Math.max(a,Math.min(j,this.x)),this.y=Math.max(a,Math.min(j,this.y)),this.z=Math.max(a,Math.min(j,this.z)),this}clampLength(a,j){const nt=this.length();return this.divideScalar(nt||1).multiplyScalar(Math.max(a,Math.min(j,nt)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,j){return this.x+=(a.x-this.x)*j,this.y+=(a.y-this.y)*j,this.z+=(a.z-this.z)*j,this}lerpVectors(a,j,nt){return this.x=a.x+(j.x-a.x)*nt,this.y=a.y+(j.y-a.y)*nt,this.z=a.z+(j.z-a.z)*nt,this}cross(a){return this.crossVectors(this,a)}crossVectors(a,j){const nt=a.x,it=a.y,ot=a.z,ht=j.x,ft=j.y,wt=j.z;return this.x=it*wt-ot*ft,this.y=ot*ht-nt*wt,this.z=nt*ft-it*ht,this}projectOnVector(a){const j=a.lengthSq();if(j===0)return this.set(0,0,0);const nt=a.dot(this)/j;return this.copy(a).multiplyScalar(nt)}projectOnPlane(a){return gx.copy(this).projectOnVector(a),this.sub(gx)}reflect(a){return this.sub(gx.copy(a).multiplyScalar(2*this.dot(a)))}angleTo(a){const j=Math.sqrt(this.lengthSq()*a.lengthSq());if(j===0)return Math.PI/2;const nt=this.dot(a)/j;return Math.acos(Is(nt,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const j=this.x-a.x,nt=this.y-a.y,it=this.z-a.z;return j*j+nt*nt+it*it}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)}setFromSpherical(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)}setFromSphericalCoords(a,j,nt){const it=Math.sin(j)*a;return this.x=it*Math.sin(nt),this.y=Math.cos(j)*a,this.z=it*Math.cos(nt),this}setFromCylindrical(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)}setFromCylindricalCoords(a,j,nt){return this.x=a*Math.sin(j),this.y=nt,this.z=a*Math.cos(j),this}setFromMatrixPosition(a){const j=a.elements;return this.x=j[12],this.y=j[13],this.z=j[14],this}setFromMatrixScale(a){const j=this.setFromMatrixColumn(a,0).length(),nt=this.setFromMatrixColumn(a,1).length(),it=this.setFromMatrixColumn(a,2).length();return this.x=j,this.y=nt,this.z=it,this}setFromMatrixColumn(a,j){return this.fromArray(a.elements,4*j)}setFromMatrix3Column(a,j){return this.fromArray(a.elements,3*j)}setFromEuler(a){return this.x=a._x,this.y=a._y,this.z=a._z,this}setFromColor(a){return this.x=a.r,this.y=a.g,this.z=a.b,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z}fromArray(a,j=0){return this.x=a[j],this.y=a[j+1],this.z=a[j+2],this}toArray(a=[],j=0){return a[j]=this.x,a[j+1]=this.y,a[j+2]=this.z,a}fromBufferAttribute(a,j){return this.x=a.getX(j),this.y=a.getY(j),this.z=a.getZ(j),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const a=2*(Math.random()-.5),j=Math.random()*Math.PI*2,nt=Math.sqrt(1-a**2);return this.x=nt*Math.cos(j),this.y=nt*Math.sin(j),this.z=a,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const gx=new Rn,vx=new zp;class Zm{constructor(a=new Rn(1/0,1/0,1/0),j=new Rn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=a,this.max=j}set(a,j){return this.min.copy(a),this.max.copy(j),this}setFromArray(a){this.makeEmpty();for(let j=0,nt=a.length;j<nt;j+=3)this.expandByPoint(rp.fromArray(a,j));return this}setFromBufferAttribute(a){this.makeEmpty();for(let j=0,nt=a.count;j<nt;j++)this.expandByPoint(rp.fromBufferAttribute(a,j));return this}setFromPoints(a){this.makeEmpty();for(let j=0,nt=a.length;j<nt;j++)this.expandByPoint(a[j]);return this}setFromCenterAndSize(a,j){const nt=rp.copy(j).multiplyScalar(.5);return this.min.copy(a).sub(nt),this.max.copy(a).add(nt),this}setFromObject(a,j=!1){return this.makeEmpty(),this.expandByObject(a,j)}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(a){return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}expandByObject(a,j=!1){if(a.updateWorldMatrix(!1,!1),a.boundingBox!==void 0)a.boundingBox===null&&a.computeBoundingBox(),iu.copy(a.boundingBox),iu.applyMatrix4(a.matrixWorld),this.union(iu);else{const it=a.geometry;if(it!==void 0)if(j&&it.attributes!==void 0&&it.attributes.position!==void 0){const ot=it.attributes.position;for(let ht=0,ft=ot.count;ht<ft;ht++)rp.fromBufferAttribute(ot,ht).applyMatrix4(a.matrixWorld),this.expandByPoint(rp)}else it.boundingBox===null&&it.computeBoundingBox(),iu.copy(it.boundingBox),iu.applyMatrix4(a.matrixWorld),this.union(iu)}const nt=a.children;for(let it=0,ot=nt.length;it<ot;it++)this.expandByObject(nt[it],j);return this}containsPoint(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z)}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z}getParameter(a,j){return j.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)}intersectsSphere(a){return this.clampPoint(a.center,rp),rp.distanceToSquared(a.center)<=a.radius*a.radius}intersectsPlane(a){let j,nt;return a.normal.x>0?(j=a.normal.x*this.min.x,nt=a.normal.x*this.max.x):(j=a.normal.x*this.max.x,nt=a.normal.x*this.min.x),a.normal.y>0?(j+=a.normal.y*this.min.y,nt+=a.normal.y*this.max.y):(j+=a.normal.y*this.max.y,nt+=a.normal.y*this.min.y),a.normal.z>0?(j+=a.normal.z*this.min.z,nt+=a.normal.z*this.max.z):(j+=a.normal.z*this.max.z,nt+=a.normal.z*this.min.z),j<=-a.constant&&nt>=-a.constant}intersectsTriangle(a){if(this.isEmpty())return!1;this.getCenter(GA),x0.subVectors(this.max,GA),w0.subVectors(a.a,GA),Rm.subVectors(a.b,GA),qu.subVectors(a.c,GA),Ru.subVectors(Rm,w0),F_.subVectors(qu,Rm),u_.subVectors(w0,qu);let j=[0,-Ru.z,Ru.y,0,-F_.z,F_.y,0,-u_.z,u_.y,Ru.z,0,-Ru.x,F_.z,0,-F_.x,u_.z,0,-u_.x,-Ru.y,Ru.x,0,-F_.y,F_.x,0,-u_.y,u_.x,0];return!!j_(j,w0,Rm,qu,x0)&&(j=[1,0,0,0,1,0,0,0,1],!!j_(j,w0,Rm,qu,x0)&&(E0.crossVectors(Ru,F_),j=[E0.x,E0.y,E0.z],j_(j,w0,Rm,qu,x0)))}clampPoint(a,j){return j.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,rp).distanceTo(a)}getBoundingSphere(a){return this.isEmpty()?a.makeEmpty():(this.getCenter(a.center),a.radius=.5*this.getSize(rp).length()),a}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}applyMatrix4(a){return this.isEmpty()||(xv[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a),xv[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a),xv[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a),xv[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a),xv[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a),xv[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a),xv[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a),xv[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a),this.setFromPoints(xv)),this}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}const xv=[new Rn,new Rn,new Rn,new Rn,new Rn,new Rn,new Rn,new Rn],rp=new Rn,iu=new Zm,w0=new Rn,Rm=new Rn,qu=new Rn,Ru=new Rn,F_=new Rn,u_=new Rn,GA=new Rn,x0=new Rn,E0=new Rn,Ev=new Rn;function j_(ut,a,j,nt,it){for(let ot=0,ht=ut.length-3;ot<=ht;ot+=3){Ev.fromArray(ut,ot);const ft=it.x*Math.abs(Ev.x)+it.y*Math.abs(Ev.y)+it.z*Math.abs(Ev.z),wt=a.dot(Ev),bt=j.dot(Ev),St=nt.dot(Ev);if(Math.max(-Math.max(wt,bt,St),Math.min(wt,bt,St))>ft)return!1}return!0}const _x=new Zm,HA=new Rn,U1=new Rn;class Dm{constructor(a=new Rn,j=-1){this.center=a,this.radius=j}set(a,j){return this.center.copy(a),this.radius=j,this}setFromPoints(a,j){const nt=this.center;j!==void 0?nt.copy(j):_x.setFromPoints(a).getCenter(nt);let it=0;for(let ot=0,ht=a.length;ot<ht;ot++)it=Math.max(it,nt.distanceToSquared(a[ot]));return this.radius=Math.sqrt(it),this}copy(a){return this.center.copy(a.center),this.radius=a.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(a){return a.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(a){return a.distanceTo(this.center)-this.radius}intersectsSphere(a){const j=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=j*j}intersectsBox(a){return a.intersectsSphere(this)}intersectsPlane(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius}clampPoint(a,j){const nt=this.center.distanceToSquared(a);return j.copy(a),nt>this.radius*this.radius&&(j.sub(this.center).normalize(),j.multiplyScalar(this.radius).add(this.center)),j}getBoundingBox(a){return this.isEmpty()?(a.makeEmpty(),a):(a.set(this.center,this.center),a.expandByScalar(this.radius),a)}applyMatrix4(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this}translate(a){return this.center.add(a),this}expandByPoint(a){if(this.isEmpty())return this.center.copy(a),this.radius=0,this;HA.subVectors(a,this.center);const j=HA.lengthSq();if(j>this.radius*this.radius){const nt=Math.sqrt(j),it=.5*(nt-this.radius);this.center.addScaledVector(HA,it/nt),this.radius+=it}return this}union(a){return a.isEmpty()?this:this.isEmpty()?(this.copy(a),this):(this.center.equals(a.center)===!0?this.radius=Math.max(this.radius,a.radius):(U1.subVectors(a.center,this.center).setLength(a.radius),this.expandByPoint(HA.copy(a.center).add(U1)),this.expandByPoint(HA.copy(a.center).sub(U1))),this)}equals(a){return a.center.equals(this.center)&&a.radius===this.radius}clone(){return new this.constructor().copy(this)}}const h_=new Rn,yx=new Rn,S0=new Rn,_g=new Rn,QA=new Rn,Ty=new Rn,WA=new Rn;class C0{constructor(a=new Rn,j=new Rn(0,0,-1)){this.origin=a,this.direction=j}set(a,j){return this.origin.copy(a),this.direction.copy(j),this}copy(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this}at(a,j){return j.copy(this.origin).addScaledVector(this.direction,a)}lookAt(a){return this.direction.copy(a).sub(this.origin).normalize(),this}recast(a){return this.origin.copy(this.at(a,h_)),this}closestPointToPoint(a,j){j.subVectors(a,this.origin);const nt=j.dot(this.direction);return nt<0?j.copy(this.origin):j.copy(this.origin).addScaledVector(this.direction,nt)}distanceToPoint(a){return Math.sqrt(this.distanceSqToPoint(a))}distanceSqToPoint(a){const j=h_.subVectors(a,this.origin).dot(this.direction);return j<0?this.origin.distanceToSquared(a):(h_.copy(this.origin).addScaledVector(this.direction,j),h_.distanceToSquared(a))}distanceSqToSegment(a,j,nt,it){yx.copy(a).add(j).multiplyScalar(.5),S0.copy(j).sub(a).normalize(),_g.copy(this.origin).sub(yx);const ot=.5*a.distanceTo(j),ht=-this.direction.dot(S0),ft=_g.dot(this.direction),wt=-_g.dot(S0),bt=_g.lengthSq(),St=Math.abs(1-ht*ht);let Dt,Rt,kt,Ot;if(St>0)if(Dt=ht*wt-ft,Rt=ht*ft-wt,Ot=ot*St,Dt>=0)if(Rt>=-Ot)if(Rt<=Ot){const Gt=1/St;Dt*=Gt,Rt*=Gt,kt=Dt*(Dt+ht*Rt+2*ft)+Rt*(ht*Dt+Rt+2*wt)+bt}else Rt=ot,Dt=Math.max(0,-(ht*Rt+ft)),kt=-Dt*Dt+Rt*(Rt+2*wt)+bt;else Rt=-ot,Dt=Math.max(0,-(ht*Rt+ft)),kt=-Dt*Dt+Rt*(Rt+2*wt)+bt;else Rt<=-Ot?(Dt=Math.max(0,-(-ht*ot+ft)),Rt=Dt>0?-ot:Math.min(Math.max(-ot,-wt),ot),kt=-Dt*Dt+Rt*(Rt+2*wt)+bt):Rt<=Ot?(Dt=0,Rt=Math.min(Math.max(-ot,-wt),ot),kt=Rt*(Rt+2*wt)+bt):(Dt=Math.max(0,-(ht*ot+ft)),Rt=Dt>0?ot:Math.min(Math.max(-ot,-wt),ot),kt=-Dt*Dt+Rt*(Rt+2*wt)+bt);else Rt=ht>0?-ot:ot,Dt=Math.max(0,-(ht*Rt+ft)),kt=-Dt*Dt+Rt*(Rt+2*wt)+bt;return nt&&nt.copy(this.origin).addScaledVector(this.direction,Dt),it&&it.copy(yx).addScaledVector(S0,Rt),kt}intersectSphere(a,j){h_.subVectors(a.center,this.origin);const nt=h_.dot(this.direction),it=h_.dot(h_)-nt*nt,ot=a.radius*a.radius;if(it>ot)return null;const ht=Math.sqrt(ot-it),ft=nt-ht,wt=nt+ht;return wt<0?null:ft<0?this.at(wt,j):this.at(ft,j)}intersectsSphere(a){return this.distanceSqToPoint(a.center)<=a.radius*a.radius}distanceToPlane(a){const j=a.normal.dot(this.direction);if(j===0)return a.distanceToPoint(this.origin)===0?0:null;const nt=-(this.origin.dot(a.normal)+a.constant)/j;return nt>=0?nt:null}intersectPlane(a,j){const nt=this.distanceToPlane(a);return nt===null?null:this.at(nt,j)}intersectsPlane(a){const j=a.distanceToPoint(this.origin);return j===0||a.normal.dot(this.direction)*j<0}intersectBox(a,j){let nt,it,ot,ht,ft,wt;const bt=1/this.direction.x,St=1/this.direction.y,Dt=1/this.direction.z,Rt=this.origin;return bt>=0?(nt=(a.min.x-Rt.x)*bt,it=(a.max.x-Rt.x)*bt):(nt=(a.max.x-Rt.x)*bt,it=(a.min.x-Rt.x)*bt),St>=0?(ot=(a.min.y-Rt.y)*St,ht=(a.max.y-Rt.y)*St):(ot=(a.max.y-Rt.y)*St,ht=(a.min.y-Rt.y)*St),nt>ht||ot>it?null:((ot>nt||isNaN(nt))&&(nt=ot),(ht<it||isNaN(it))&&(it=ht),Dt>=0?(ft=(a.min.z-Rt.z)*Dt,wt=(a.max.z-Rt.z)*Dt):(ft=(a.max.z-Rt.z)*Dt,wt=(a.min.z-Rt.z)*Dt),nt>wt||ft>it?null:((ft>nt||nt!=nt)&&(nt=ft),(wt<it||it!=it)&&(it=wt),it<0?null:this.at(nt>=0?nt:it,j)))}intersectsBox(a){return this.intersectBox(a,h_)!==null}intersectTriangle(a,j,nt,it,ot){QA.subVectors(j,a),Ty.subVectors(nt,a),WA.crossVectors(QA,Ty);let ht,ft=this.direction.dot(WA);if(ft>0){if(it)return null;ht=1}else{if(!(ft<0))return null;ht=-1,ft=-ft}_g.subVectors(this.origin,a);const wt=ht*this.direction.dot(Ty.crossVectors(_g,Ty));if(wt<0)return null;const bt=ht*this.direction.dot(QA.cross(_g));if(bt<0||wt+bt>ft)return null;const St=-ht*_g.dot(WA);return St<0?null:this.at(St/ft,ot)}applyMatrix4(a){return this.origin.applyMatrix4(a),this.direction.transformDirection(a),this}equals(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ro{constructor(){ro.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(a,j,nt,it,ot,ht,ft,wt,bt,St,Dt,Rt,kt,Ot,Gt,Nt){const zt=this.elements;return zt[0]=a,zt[4]=j,zt[8]=nt,zt[12]=it,zt[1]=ot,zt[5]=ht,zt[9]=ft,zt[13]=wt,zt[2]=bt,zt[6]=St,zt[10]=Dt,zt[14]=Rt,zt[3]=kt,zt[7]=Ot,zt[11]=Gt,zt[15]=Nt,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ro().fromArray(this.elements)}copy(a){const j=this.elements,nt=a.elements;return j[0]=nt[0],j[1]=nt[1],j[2]=nt[2],j[3]=nt[3],j[4]=nt[4],j[5]=nt[5],j[6]=nt[6],j[7]=nt[7],j[8]=nt[8],j[9]=nt[9],j[10]=nt[10],j[11]=nt[11],j[12]=nt[12],j[13]=nt[13],j[14]=nt[14],j[15]=nt[15],this}copyPosition(a){const j=this.elements,nt=a.elements;return j[12]=nt[12],j[13]=nt[13],j[14]=nt[14],this}setFromMatrix3(a){const j=a.elements;return this.set(j[0],j[3],j[6],0,j[1],j[4],j[7],0,j[2],j[5],j[8],0,0,0,0,1),this}extractBasis(a,j,nt){return a.setFromMatrixColumn(this,0),j.setFromMatrixColumn(this,1),nt.setFromMatrixColumn(this,2),this}makeBasis(a,j,nt){return this.set(a.x,j.x,nt.x,0,a.y,j.y,nt.y,0,a.z,j.z,nt.z,0,0,0,0,1),this}extractRotation(a){const j=this.elements,nt=a.elements,it=1/Iy.setFromMatrixColumn(a,0).length(),ot=1/Iy.setFromMatrixColumn(a,1).length(),ht=1/Iy.setFromMatrixColumn(a,2).length();return j[0]=nt[0]*it,j[1]=nt[1]*it,j[2]=nt[2]*it,j[3]=0,j[4]=nt[4]*ot,j[5]=nt[5]*ot,j[6]=nt[6]*ot,j[7]=0,j[8]=nt[8]*ht,j[9]=nt[9]*ht,j[10]=nt[10]*ht,j[11]=0,j[12]=0,j[13]=0,j[14]=0,j[15]=1,this}makeRotationFromEuler(a){const j=this.elements,nt=a.x,it=a.y,ot=a.z,ht=Math.cos(nt),ft=Math.sin(nt),wt=Math.cos(it),bt=Math.sin(it),St=Math.cos(ot),Dt=Math.sin(ot);if(a.order==="XYZ"){const Rt=ht*St,kt=ht*Dt,Ot=ft*St,Gt=ft*Dt;j[0]=wt*St,j[4]=-wt*Dt,j[8]=bt,j[1]=kt+Ot*bt,j[5]=Rt-Gt*bt,j[9]=-ft*wt,j[2]=Gt-Rt*bt,j[6]=Ot+kt*bt,j[10]=ht*wt}else if(a.order==="YXZ"){const Rt=wt*St,kt=wt*Dt,Ot=bt*St,Gt=bt*Dt;j[0]=Rt+Gt*ft,j[4]=Ot*ft-kt,j[8]=ht*bt,j[1]=ht*Dt,j[5]=ht*St,j[9]=-ft,j[2]=kt*ft-Ot,j[6]=Gt+Rt*ft,j[10]=ht*wt}else if(a.order==="ZXY"){const Rt=wt*St,kt=wt*Dt,Ot=bt*St,Gt=bt*Dt;j[0]=Rt-Gt*ft,j[4]=-ht*Dt,j[8]=Ot+kt*ft,j[1]=kt+Ot*ft,j[5]=ht*St,j[9]=Gt-Rt*ft,j[2]=-ht*bt,j[6]=ft,j[10]=ht*wt}else if(a.order==="ZYX"){const Rt=ht*St,kt=ht*Dt,Ot=ft*St,Gt=ft*Dt;j[0]=wt*St,j[4]=Ot*bt-kt,j[8]=Rt*bt+Gt,j[1]=wt*Dt,j[5]=Gt*bt+Rt,j[9]=kt*bt-Ot,j[2]=-bt,j[6]=ft*wt,j[10]=ht*wt}else if(a.order==="YZX"){const Rt=ht*wt,kt=ht*bt,Ot=ft*wt,Gt=ft*bt;j[0]=wt*St,j[4]=Gt-Rt*Dt,j[8]=Ot*Dt+kt,j[1]=Dt,j[5]=ht*St,j[9]=-ft*St,j[2]=-bt*St,j[6]=kt*Dt+Ot,j[10]=Rt-Gt*Dt}else if(a.order==="XZY"){const Rt=ht*wt,kt=ht*bt,Ot=ft*wt,Gt=ft*bt;j[0]=wt*St,j[4]=-Dt,j[8]=bt*St,j[1]=Rt*Dt+Gt,j[5]=ht*St,j[9]=kt*Dt-Ot,j[2]=Ot*Dt-kt,j[6]=ft*St,j[10]=Gt*Dt+Rt}return j[3]=0,j[7]=0,j[11]=0,j[12]=0,j[13]=0,j[14]=0,j[15]=1,this}makeRotationFromQuaternion(a){return this.compose(xo,a,Du)}lookAt(a,j,nt){const it=this.elements;return Eu.subVectors(a,j),Eu.lengthSq()===0&&(Eu.z=1),Eu.normalize(),wp.crossVectors(nt,Eu),wp.lengthSq()===0&&(Math.abs(nt.z)===1?Eu.x+=1e-4:Eu.z+=1e-4,Eu.normalize(),wp.crossVectors(nt,Eu)),wp.normalize(),sp.crossVectors(Eu,wp),it[0]=wp.x,it[4]=sp.x,it[8]=Eu.x,it[1]=wp.y,it[5]=sp.y,it[9]=Eu.y,it[2]=wp.z,it[6]=sp.z,it[10]=Eu.z,this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,j){const nt=a.elements,it=j.elements,ot=this.elements,ht=nt[0],ft=nt[4],wt=nt[8],bt=nt[12],St=nt[1],Dt=nt[5],Rt=nt[9],kt=nt[13],Ot=nt[2],Gt=nt[6],Nt=nt[10],zt=nt[14],qt=nt[3],$t=nt[7],En=nt[11],gn=nt[15],vn=it[0],Un=it[4],$n=it[8],jn=it[12],sr=it[1],Vn=it[5],_r=it[9],xr=it[13],Gr=it[2],ns=it[6],Vr=it[10],Tr=it[14],Yr=it[3],ts=it[7],mr=it[11],Dr=it[15];return ot[0]=ht*vn+ft*sr+wt*Gr+bt*Yr,ot[4]=ht*Un+ft*Vn+wt*ns+bt*ts,ot[8]=ht*$n+ft*_r+wt*Vr+bt*mr,ot[12]=ht*jn+ft*xr+wt*Tr+bt*Dr,ot[1]=St*vn+Dt*sr+Rt*Gr+kt*Yr,ot[5]=St*Un+Dt*Vn+Rt*ns+kt*ts,ot[9]=St*$n+Dt*_r+Rt*Vr+kt*mr,ot[13]=St*jn+Dt*xr+Rt*Tr+kt*Dr,ot[2]=Ot*vn+Gt*sr+Nt*Gr+zt*Yr,ot[6]=Ot*Un+Gt*Vn+Nt*ns+zt*ts,ot[10]=Ot*$n+Gt*_r+Nt*Vr+zt*mr,ot[14]=Ot*jn+Gt*xr+Nt*Tr+zt*Dr,ot[3]=qt*vn+$t*sr+En*Gr+gn*Yr,ot[7]=qt*Un+$t*Vn+En*ns+gn*ts,ot[11]=qt*$n+$t*_r+En*Vr+gn*mr,ot[15]=qt*jn+$t*xr+En*Tr+gn*Dr,this}multiplyScalar(a){const j=this.elements;return j[0]*=a,j[4]*=a,j[8]*=a,j[12]*=a,j[1]*=a,j[5]*=a,j[9]*=a,j[13]*=a,j[2]*=a,j[6]*=a,j[10]*=a,j[14]*=a,j[3]*=a,j[7]*=a,j[11]*=a,j[15]*=a,this}determinant(){const a=this.elements,j=a[0],nt=a[4],it=a[8],ot=a[12],ht=a[1],ft=a[5],wt=a[9],bt=a[13],St=a[2],Dt=a[6],Rt=a[10],kt=a[14];return a[3]*(+ot*wt*Dt-it*bt*Dt-ot*ft*Rt+nt*bt*Rt+it*ft*kt-nt*wt*kt)+a[7]*(+j*wt*kt-j*bt*Rt+ot*ht*Rt-it*ht*kt+it*bt*St-ot*wt*St)+a[11]*(+j*bt*Dt-j*ft*kt-ot*ht*Dt+nt*ht*kt+ot*ft*St-nt*bt*St)+a[15]*(-it*ft*St-j*wt*Dt+j*ft*Rt+it*ht*Dt-nt*ht*Rt+nt*wt*St)}transpose(){const a=this.elements;let j;return j=a[1],a[1]=a[4],a[4]=j,j=a[2],a[2]=a[8],a[8]=j,j=a[6],a[6]=a[9],a[9]=j,j=a[3],a[3]=a[12],a[12]=j,j=a[7],a[7]=a[13],a[13]=j,j=a[11],a[11]=a[14],a[14]=j,this}setPosition(a,j,nt){const it=this.elements;return a.isVector3?(it[12]=a.x,it[13]=a.y,it[14]=a.z):(it[12]=a,it[13]=j,it[14]=nt),this}invert(){const a=this.elements,j=a[0],nt=a[1],it=a[2],ot=a[3],ht=a[4],ft=a[5],wt=a[6],bt=a[7],St=a[8],Dt=a[9],Rt=a[10],kt=a[11],Ot=a[12],Gt=a[13],Nt=a[14],zt=a[15],qt=Dt*Nt*bt-Gt*Rt*bt+Gt*wt*kt-ft*Nt*kt-Dt*wt*zt+ft*Rt*zt,$t=Ot*Rt*bt-St*Nt*bt-Ot*wt*kt+ht*Nt*kt+St*wt*zt-ht*Rt*zt,En=St*Gt*bt-Ot*Dt*bt+Ot*ft*kt-ht*Gt*kt-St*ft*zt+ht*Dt*zt,gn=Ot*Dt*wt-St*Gt*wt-Ot*ft*Rt+ht*Gt*Rt+St*ft*Nt-ht*Dt*Nt,vn=j*qt+nt*$t+it*En+ot*gn;if(vn===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Un=1/vn;return a[0]=qt*Un,a[1]=(Gt*Rt*ot-Dt*Nt*ot-Gt*it*kt+nt*Nt*kt+Dt*it*zt-nt*Rt*zt)*Un,a[2]=(ft*Nt*ot-Gt*wt*ot+Gt*it*bt-nt*Nt*bt-ft*it*zt+nt*wt*zt)*Un,a[3]=(Dt*wt*ot-ft*Rt*ot-Dt*it*bt+nt*Rt*bt+ft*it*kt-nt*wt*kt)*Un,a[4]=$t*Un,a[5]=(St*Nt*ot-Ot*Rt*ot+Ot*it*kt-j*Nt*kt-St*it*zt+j*Rt*zt)*Un,a[6]=(Ot*wt*ot-ht*Nt*ot-Ot*it*bt+j*Nt*bt+ht*it*zt-j*wt*zt)*Un,a[7]=(ht*Rt*ot-St*wt*ot+St*it*bt-j*Rt*bt-ht*it*kt+j*wt*kt)*Un,a[8]=En*Un,a[9]=(Ot*Dt*ot-St*Gt*ot-Ot*nt*kt+j*Gt*kt+St*nt*zt-j*Dt*zt)*Un,a[10]=(ht*Gt*ot-Ot*ft*ot+Ot*nt*bt-j*Gt*bt-ht*nt*zt+j*ft*zt)*Un,a[11]=(St*ft*ot-ht*Dt*ot-St*nt*bt+j*Dt*bt+ht*nt*kt-j*ft*kt)*Un,a[12]=gn*Un,a[13]=(St*Gt*it-Ot*Dt*it+Ot*nt*Rt-j*Gt*Rt-St*nt*Nt+j*Dt*Nt)*Un,a[14]=(Ot*ft*it-ht*Gt*it-Ot*nt*wt+j*Gt*wt+ht*nt*Nt-j*ft*Nt)*Un,a[15]=(ht*Dt*it-St*ft*it+St*nt*wt-j*Dt*wt-ht*nt*Rt+j*ft*Rt)*Un,this}scale(a){const j=this.elements,nt=a.x,it=a.y,ot=a.z;return j[0]*=nt,j[4]*=it,j[8]*=ot,j[1]*=nt,j[5]*=it,j[9]*=ot,j[2]*=nt,j[6]*=it,j[10]*=ot,j[3]*=nt,j[7]*=it,j[11]*=ot,this}getMaxScaleOnAxis(){const a=this.elements,j=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],nt=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],it=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(j,nt,it))}makeTranslation(a,j,nt){return this.set(1,0,0,a,0,1,0,j,0,0,1,nt,0,0,0,1),this}makeRotationX(a){const j=Math.cos(a),nt=Math.sin(a);return this.set(1,0,0,0,0,j,-nt,0,0,nt,j,0,0,0,0,1),this}makeRotationY(a){const j=Math.cos(a),nt=Math.sin(a);return this.set(j,0,nt,0,0,1,0,0,-nt,0,j,0,0,0,0,1),this}makeRotationZ(a){const j=Math.cos(a),nt=Math.sin(a);return this.set(j,-nt,0,0,nt,j,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(a,j){const nt=Math.cos(j),it=Math.sin(j),ot=1-nt,ht=a.x,ft=a.y,wt=a.z,bt=ot*ht,St=ot*ft;return this.set(bt*ht+nt,bt*ft-it*wt,bt*wt+it*ft,0,bt*ft+it*wt,St*ft+nt,St*wt-it*ht,0,bt*wt-it*ft,St*wt+it*ht,ot*wt*wt+nt,0,0,0,0,1),this}makeScale(a,j,nt){return this.set(a,0,0,0,0,j,0,0,0,0,nt,0,0,0,0,1),this}makeShear(a,j,nt,it,ot,ht){return this.set(1,nt,ot,0,a,1,ht,0,j,it,1,0,0,0,0,1),this}compose(a,j,nt){const it=this.elements,ot=j._x,ht=j._y,ft=j._z,wt=j._w,bt=ot+ot,St=ht+ht,Dt=ft+ft,Rt=ot*bt,kt=ot*St,Ot=ot*Dt,Gt=ht*St,Nt=ht*Dt,zt=ft*Dt,qt=wt*bt,$t=wt*St,En=wt*Dt,gn=nt.x,vn=nt.y,Un=nt.z;return it[0]=(1-(Gt+zt))*gn,it[1]=(kt+En)*gn,it[2]=(Ot-$t)*gn,it[3]=0,it[4]=(kt-En)*vn,it[5]=(1-(Rt+zt))*vn,it[6]=(Nt+qt)*vn,it[7]=0,it[8]=(Ot+$t)*Un,it[9]=(Nt-qt)*Un,it[10]=(1-(Rt+Gt))*Un,it[11]=0,it[12]=a.x,it[13]=a.y,it[14]=a.z,it[15]=1,this}decompose(a,j,nt){const it=this.elements;let ot=Iy.set(it[0],it[1],it[2]).length();const ht=Iy.set(it[4],it[5],it[6]).length(),ft=Iy.set(it[8],it[9],it[10]).length();this.determinant()<0&&(ot=-ot),a.x=it[12],a.y=it[13],a.z=it[14],km.copy(this);const wt=1/ot,bt=1/ht,St=1/ft;return km.elements[0]*=wt,km.elements[1]*=wt,km.elements[2]*=wt,km.elements[4]*=bt,km.elements[5]*=bt,km.elements[6]*=bt,km.elements[8]*=St,km.elements[9]*=St,km.elements[10]*=St,j.setFromRotationMatrix(km),nt.x=ot,nt.y=ht,nt.z=ft,this}makePerspective(a,j,nt,it,ot,ht){const ft=this.elements,wt=2*ot/(j-a),bt=2*ot/(nt-it),St=(j+a)/(j-a),Dt=(nt+it)/(nt-it),Rt=-(ht+ot)/(ht-ot),kt=-2*ht*ot/(ht-ot);return ft[0]=wt,ft[4]=0,ft[8]=St,ft[12]=0,ft[1]=0,ft[5]=bt,ft[9]=Dt,ft[13]=0,ft[2]=0,ft[6]=0,ft[10]=Rt,ft[14]=kt,ft[3]=0,ft[7]=0,ft[11]=-1,ft[15]=0,this}makeOrthographic(a,j,nt,it,ot,ht){const ft=this.elements,wt=1/(j-a),bt=1/(nt-it),St=1/(ht-ot),Dt=(j+a)*wt,Rt=(nt+it)*bt,kt=(ht+ot)*St;return ft[0]=2*wt,ft[4]=0,ft[8]=0,ft[12]=-Dt,ft[1]=0,ft[5]=2*bt,ft[9]=0,ft[13]=-Rt,ft[2]=0,ft[6]=0,ft[10]=-2*St,ft[14]=-kt,ft[3]=0,ft[7]=0,ft[11]=0,ft[15]=1,this}equals(a){const j=this.elements,nt=a.elements;for(let it=0;it<16;it++)if(j[it]!==nt[it])return!1;return!0}fromArray(a,j=0){for(let nt=0;nt<16;nt++)this.elements[nt]=a[nt+j];return this}toArray(a=[],j=0){const nt=this.elements;return a[j]=nt[0],a[j+1]=nt[1],a[j+2]=nt[2],a[j+3]=nt[3],a[j+4]=nt[4],a[j+5]=nt[5],a[j+6]=nt[6],a[j+7]=nt[7],a[j+8]=nt[8],a[j+9]=nt[9],a[j+10]=nt[10],a[j+11]=nt[11],a[j+12]=nt[12],a[j+13]=nt[13],a[j+14]=nt[14],a[j+15]=nt[15],a}}const Iy=new Rn,km=new ro,xo=new Rn(0,0,0),Du=new Rn(1,1,1),wp=new Rn,sp=new Rn,Eu=new Rn,Py=new ro,qA=new zp;class M0{constructor(a=0,j=0,nt=0,it=M0.DEFAULT_ORDER){this.isEuler=!0,this._x=a,this._y=j,this._z=nt,this._order=it}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get order(){return this._order}set order(a){this._order=a,this._onChangeCallback()}set(a,j,nt,it=this._order){return this._x=a,this._y=j,this._z=nt,this._order=it,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this._onChangeCallback(),this}setFromRotationMatrix(a,j=this._order,nt=!0){const it=a.elements,ot=it[0],ht=it[4],ft=it[8],wt=it[1],bt=it[5],St=it[9],Dt=it[2],Rt=it[6],kt=it[10];switch(j){case"XYZ":this._y=Math.asin(Is(ft,-1,1)),Math.abs(ft)<.9999999?(this._x=Math.atan2(-St,kt),this._z=Math.atan2(-ht,ot)):(this._x=Math.atan2(Rt,bt),this._z=0);break;case"YXZ":this._x=Math.asin(-Is(St,-1,1)),Math.abs(St)<.9999999?(this._y=Math.atan2(ft,kt),this._z=Math.atan2(wt,bt)):(this._y=Math.atan2(-Dt,ot),this._z=0);break;case"ZXY":this._x=Math.asin(Is(Rt,-1,1)),Math.abs(Rt)<.9999999?(this._y=Math.atan2(-Dt,kt),this._z=Math.atan2(-ht,bt)):(this._y=0,this._z=Math.atan2(wt,ot));break;case"ZYX":this._y=Math.asin(-Is(Dt,-1,1)),Math.abs(Dt)<.9999999?(this._x=Math.atan2(Rt,kt),this._z=Math.atan2(wt,ot)):(this._x=0,this._z=Math.atan2(-ht,bt));break;case"YZX":this._z=Math.asin(Is(wt,-1,1)),Math.abs(wt)<.9999999?(this._x=Math.atan2(-St,bt),this._y=Math.atan2(-Dt,ot)):(this._x=0,this._y=Math.atan2(ft,kt));break;case"XZY":this._z=Math.asin(-Is(ht,-1,1)),Math.abs(ht)<.9999999?(this._x=Math.atan2(Rt,bt),this._y=Math.atan2(ft,ot)):(this._x=Math.atan2(-St,kt),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+j)}return this._order=j,nt===!0&&this._onChangeCallback(),this}setFromQuaternion(a,j,nt){return Py.makeRotationFromQuaternion(a),this.setFromRotationMatrix(Py,j,nt)}setFromVector3(a,j=this._order){return this.set(a.x,a.y,a.z,j)}reorder(a){return qA.setFromEuler(this),this.setFromQuaternion(qA,a)}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order}fromArray(a){return this._x=a[0],this._y=a[1],this._z=a[2],a[3]!==void 0&&(this._order=a[3]),this._onChangeCallback(),this}toArray(a=[],j=0){return a[j]=this._x,a[j+1]=this._y,a[j+2]=this._z,a[j+3]=this._order,a}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}M0.DEFAULT_ORDER="XYZ";class T0{constructor(){this.mask=1}set(a){this.mask=(1<<a|0)>>>0}enable(a){this.mask|=1<<a|0}enableAll(){this.mask=-1}toggle(a){this.mask^=1<<a|0}disable(a){this.mask&=~(1<<a|0)}disableAll(){this.mask=0}test(a){return(this.mask&a.mask)!=0}isEnabled(a){return(this.mask&(1<<a|0))!=0}}let Ax=0;const Sv=new Rn,z_=new zp,op=new ro,V_=new Rn,Eo=new Rn,I0=new Rn,sm=new zp,Cv=new Rn(1,0,0),P0=new Rn(0,1,0),G_=new Rn(0,0,1),F1={type:"added"},j1={type:"removed"};class Po extends $m{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ax++}),this.uuid=Fp(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Po.DEFAULT_UP.clone();const a=new Rn,j=new M0,nt=new zp,it=new Rn(1,1,1);j._onChange(function(){nt.setFromEuler(j,!1)}),nt._onChange(function(){j.setFromQuaternion(nt,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:a},rotation:{configurable:!0,enumerable:!0,value:j},quaternion:{configurable:!0,enumerable:!0,value:nt},scale:{configurable:!0,enumerable:!0,value:it},modelViewMatrix:{value:new ro},normalMatrix:{value:new oo}}),this.matrix=new ro,this.matrixWorld=new ro,this.matrixAutoUpdate=Po.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Po.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new T0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(a,j,nt,it,ot,ht){this.dispatchEvent({type:"beforeRender",renderer:a,scene:j,camera:nt,geometry:it,material:ot,group:ht})}onAfterRender(){}applyMatrix4(a){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(a),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(a){return this.quaternion.premultiply(a),this}setRotationFromAxisAngle(a,j){this.quaternion.setFromAxisAngle(a,j)}setRotationFromEuler(a){this.quaternion.setFromEuler(a,!0)}setRotationFromMatrix(a){this.quaternion.setFromRotationMatrix(a)}setRotationFromQuaternion(a){this.quaternion.copy(a)}rotateOnAxis(a,j){return z_.setFromAxisAngle(a,j),this.quaternion.multiply(z_),this}rotateOnWorldAxis(a,j){return z_.setFromAxisAngle(a,j),this.quaternion.premultiply(z_),this}rotateX(a){return this.rotateOnAxis(Cv,a)}rotateY(a){return this.rotateOnAxis(P0,a)}rotateZ(a){return this.rotateOnAxis(G_,a)}translateOnAxis(a,j){return Sv.copy(a).applyQuaternion(this.quaternion),this.position.add(Sv.multiplyScalar(j)),this}translateX(a){return this.translateOnAxis(Cv,a)}translateY(a){return this.translateOnAxis(P0,a)}translateZ(a){return this.translateOnAxis(G_,a)}localToWorld(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(this.matrixWorld)}worldToLocal(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(op.copy(this.matrixWorld).invert())}lookAt(a,j,nt){a.isVector3?V_.copy(a):V_.set(a,j,nt);const it=this.parent;this.updateWorldMatrix(!0,!1),Eo.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?op.lookAt(Eo,V_,this.up):op.lookAt(V_,Eo,this.up),this.quaternion.setFromRotationMatrix(op),it&&(op.extractRotation(it.matrixWorld),z_.setFromRotationMatrix(op),this.quaternion.premultiply(z_.invert()))}add(a){if(arguments.length>1){for(let j=0;j<arguments.length;j++)this.add(arguments[j]);return this}return a===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this):(a&&a.isObject3D?(a.parent!==null&&a.parent.remove(a),a.parent=this,this.children.push(a),a.dispatchEvent(F1)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a),this)}remove(a){if(arguments.length>1){for(let nt=0;nt<arguments.length;nt++)this.remove(arguments[nt]);return this}const j=this.children.indexOf(a);return j!==-1&&(a.parent=null,this.children.splice(j,1),a.dispatchEvent(j1)),this}removeFromParent(){const a=this.parent;return a!==null&&a.remove(this),this}clear(){for(let a=0;a<this.children.length;a++){const j=this.children[a];j.parent=null,j.dispatchEvent(j1)}return this.children.length=0,this}attach(a){return this.updateWorldMatrix(!0,!1),op.copy(this.matrixWorld).invert(),a.parent!==null&&(a.parent.updateWorldMatrix(!0,!1),op.multiply(a.parent.matrixWorld)),a.applyMatrix4(op),this.add(a),a.updateWorldMatrix(!1,!0),this}getObjectById(a){return this.getObjectByProperty("id",a)}getObjectByName(a){return this.getObjectByProperty("name",a)}getObjectByProperty(a,j){if(this[a]===j)return this;for(let nt=0,it=this.children.length;nt<it;nt++){const ot=this.children[nt].getObjectByProperty(a,j);if(ot!==void 0)return ot}}getObjectsByProperty(a,j){let nt=[];this[a]===j&&nt.push(this);for(let it=0,ot=this.children.length;it<ot;it++){const ht=this.children[it].getObjectsByProperty(a,j);ht.length>0&&(nt=nt.concat(ht))}return nt}getWorldPosition(a){return this.updateWorldMatrix(!0,!1),a.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Eo,a,I0),a}getWorldScale(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Eo,sm,a),a}getWorldDirection(a){this.updateWorldMatrix(!0,!1);const j=this.matrixWorld.elements;return a.set(j[8],j[9],j[10]).normalize()}raycast(){}traverse(a){a(this);const j=this.children;for(let nt=0,it=j.length;nt<it;nt++)j[nt].traverse(a)}traverseVisible(a){if(this.visible===!1)return;a(this);const j=this.children;for(let nt=0,it=j.length;nt<it;nt++)j[nt].traverseVisible(a)}traverseAncestors(a){const j=this.parent;j!==null&&(a(j),j.traverseAncestors(a))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);const j=this.children;for(let nt=0,it=j.length;nt<it;nt++){const ot=j[nt];ot.matrixWorldAutoUpdate!==!0&&a!==!0||ot.updateMatrixWorld(a)}}updateWorldMatrix(a,j){const nt=this.parent;if(a===!0&&nt!==null&&nt.matrixWorldAutoUpdate===!0&&nt.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),j===!0){const it=this.children;for(let ot=0,ht=it.length;ot<ht;ot++){const ft=it[ot];ft.matrixWorldAutoUpdate===!0&&ft.updateWorldMatrix(!1,!0)}}}toJSON(a){const j=a===void 0||typeof a=="string",nt={};j&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},nt.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const it={};function ot(ft,wt){return ft[wt.uuid]===void 0&&(ft[wt.uuid]=wt.toJSON(a)),wt.uuid}if(it.uuid=this.uuid,it.type=this.type,this.name!==""&&(it.name=this.name),this.castShadow===!0&&(it.castShadow=!0),this.receiveShadow===!0&&(it.receiveShadow=!0),this.visible===!1&&(it.visible=!1),this.frustumCulled===!1&&(it.frustumCulled=!1),this.renderOrder!==0&&(it.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(it.userData=this.userData),it.layers=this.layers.mask,it.matrix=this.matrix.toArray(),it.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(it.matrixAutoUpdate=!1),this.isInstancedMesh&&(it.type="InstancedMesh",it.count=this.count,it.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(it.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?it.background=this.background.toJSON():this.background.isTexture&&(it.background=this.background.toJSON(a).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(it.environment=this.environment.toJSON(a).uuid);else if(this.isMesh||this.isLine||this.isPoints){it.geometry=ot(a.geometries,this.geometry);const ft=this.geometry.parameters;if(ft!==void 0&&ft.shapes!==void 0){const wt=ft.shapes;if(Array.isArray(wt))for(let bt=0,St=wt.length;bt<St;bt++){const Dt=wt[bt];ot(a.shapes,Dt)}else ot(a.shapes,wt)}}if(this.isSkinnedMesh&&(it.bindMode=this.bindMode,it.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(ot(a.skeletons,this.skeleton),it.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const ft=[];for(let wt=0,bt=this.material.length;wt<bt;wt++)ft.push(ot(a.materials,this.material[wt]));it.material=ft}else it.material=ot(a.materials,this.material);if(this.children.length>0){it.children=[];for(let ft=0;ft<this.children.length;ft++)it.children.push(this.children[ft].toJSON(a).object)}if(this.animations.length>0){it.animations=[];for(let ft=0;ft<this.animations.length;ft++){const wt=this.animations[ft];it.animations.push(ot(a.animations,wt))}}if(j){const ft=ht(a.geometries),wt=ht(a.materials),bt=ht(a.textures),St=ht(a.images),Dt=ht(a.shapes),Rt=ht(a.skeletons),kt=ht(a.animations),Ot=ht(a.nodes);ft.length>0&&(nt.geometries=ft),wt.length>0&&(nt.materials=wt),bt.length>0&&(nt.textures=bt),St.length>0&&(nt.images=St),Dt.length>0&&(nt.shapes=Dt),Rt.length>0&&(nt.skeletons=Rt),kt.length>0&&(nt.animations=kt),Ot.length>0&&(nt.nodes=Ot)}return nt.object=it,nt;function ht(ft){const wt=[];for(const bt in ft){const St=ft[bt];delete St.metadata,wt.push(St)}return wt}}clone(a){return new this.constructor().copy(this,a)}copy(a,j=!0){this.name=a.name,this.up.copy(a.up),this.position.copy(a.position),this.rotation.order=a.rotation.order,this.quaternion.copy(a.quaternion),this.scale.copy(a.scale),this.matrix.copy(a.matrix),this.matrixWorld.copy(a.matrixWorld),this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=a.matrixWorldAutoUpdate,this.layers.mask=a.layers.mask,this.visible=a.visible,this.castShadow=a.castShadow,this.receiveShadow=a.receiveShadow,this.frustumCulled=a.frustumCulled,this.renderOrder=a.renderOrder,this.animations=a.animations,this.userData={};for(const[nt,it]of Object.entries(a.userData))this.userData[nt]=!it||it&&(it.isTexture||it.isObject3D)?it:JSON.parse(JSON.stringify(it));if(j===!0)for(let nt=0;nt<a.children.length;nt++){const it=a.children[nt];this.add(it.clone())}return this}}Po.DEFAULT_UP=new Rn(0,1,0),Po.DEFAULT_MATRIX_AUTO_UPDATE=!0,Po.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ap=new Rn,du=new Rn,ev=new Rn,Vp=new Rn,Xu=new Rn,Mv=new Rn,tv=new Rn,H_=new Rn,Tv=new Rn,R0=new Rn;let Ry=!1;class ru{constructor(a=new Rn,j=new Rn,nt=new Rn){this.a=a,this.b=j,this.c=nt}static getNormal(a,j,nt,it){it.subVectors(nt,j),ap.subVectors(a,j),it.cross(ap);const ot=it.lengthSq();return ot>0?it.multiplyScalar(1/Math.sqrt(ot)):it.set(0,0,0)}static getBarycoord(a,j,nt,it,ot){ap.subVectors(it,j),du.subVectors(nt,j),ev.subVectors(a,j);const ht=ap.dot(ap),ft=ap.dot(du),wt=ap.dot(ev),bt=du.dot(du),St=du.dot(ev),Dt=ht*bt-ft*ft;if(Dt===0)return ot.set(-2,-1,-1);const Rt=1/Dt,kt=(bt*wt-ft*St)*Rt,Ot=(ht*St-ft*wt)*Rt;return ot.set(1-kt-Ot,Ot,kt)}static containsPoint(a,j,nt,it){return this.getBarycoord(a,j,nt,it,Vp),Vp.x>=0&&Vp.y>=0&&Vp.x+Vp.y<=1}static getUV(a,j,nt,it,ot,ht,ft,wt){return Ry===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Ry=!0),this.getInterpolation(a,j,nt,it,ot,ht,ft,wt)}static getInterpolation(a,j,nt,it,ot,ht,ft,wt){return this.getBarycoord(a,j,nt,it,Vp),wt.setScalar(0),wt.addScaledVector(ot,Vp.x),wt.addScaledVector(ht,Vp.y),wt.addScaledVector(ft,Vp.z),wt}static isFrontFacing(a,j,nt,it){return ap.subVectors(nt,j),du.subVectors(a,j),ap.cross(du).dot(it)<0}set(a,j,nt){return this.a.copy(a),this.b.copy(j),this.c.copy(nt),this}setFromPointsAndIndices(a,j,nt,it){return this.a.copy(a[j]),this.b.copy(a[nt]),this.c.copy(a[it]),this}setFromAttributeAndIndices(a,j,nt,it){return this.a.fromBufferAttribute(a,j),this.b.fromBufferAttribute(a,nt),this.c.fromBufferAttribute(a,it),this}clone(){return new this.constructor().copy(this)}copy(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this}getArea(){return ap.subVectors(this.c,this.b),du.subVectors(this.a,this.b),.5*ap.cross(du).length()}getMidpoint(a){return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(a){return ru.getNormal(this.a,this.b,this.c,a)}getPlane(a){return a.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(a,j){return ru.getBarycoord(a,this.a,this.b,this.c,j)}getUV(a,j,nt,it,ot){return Ry===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Ry=!0),ru.getInterpolation(a,this.a,this.b,this.c,j,nt,it,ot)}getInterpolation(a,j,nt,it,ot){return ru.getInterpolation(a,this.a,this.b,this.c,j,nt,it,ot)}containsPoint(a){return ru.containsPoint(a,this.a,this.b,this.c)}isFrontFacing(a){return ru.isFrontFacing(this.a,this.b,this.c,a)}intersectsBox(a){return a.intersectsTriangle(this)}closestPointToPoint(a,j){const nt=this.a,it=this.b,ot=this.c;let ht,ft;Xu.subVectors(it,nt),Mv.subVectors(ot,nt),H_.subVectors(a,nt);const wt=Xu.dot(H_),bt=Mv.dot(H_);if(wt<=0&&bt<=0)return j.copy(nt);Tv.subVectors(a,it);const St=Xu.dot(Tv),Dt=Mv.dot(Tv);if(St>=0&&Dt<=St)return j.copy(it);const Rt=wt*Dt-St*bt;if(Rt<=0&&wt>=0&&St<=0)return ht=wt/(wt-St),j.copy(nt).addScaledVector(Xu,ht);R0.subVectors(a,ot);const kt=Xu.dot(R0),Ot=Mv.dot(R0);if(Ot>=0&&kt<=Ot)return j.copy(ot);const Gt=kt*bt-wt*Ot;if(Gt<=0&&bt>=0&&Ot<=0)return ft=bt/(bt-Ot),j.copy(nt).addScaledVector(Mv,ft);const Nt=St*Ot-kt*Dt;if(Nt<=0&&Dt-St>=0&&kt-Ot>=0)return tv.subVectors(ot,it),ft=(Dt-St)/(Dt-St+(kt-Ot)),j.copy(it).addScaledVector(tv,ft);const zt=1/(Nt+Gt+Rt);return ht=Gt*zt,ft=Rt*zt,j.copy(nt).addScaledVector(Xu,ht).addScaledVector(Mv,ft)}equals(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}}let Dy=0;class ku extends $m{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Dy++}),this.uuid=Fp(),this.name="",this.type="Material",this.blending=dn,this.side=Pn,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=vr,this.blendDst=Wn,this.blendEquation=Wt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Qn,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=by,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=bp,this.stencilZFail=bp,this.stencilZPass=bp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(a){this._alphaTest>0!=a>0&&this.version++,this._alphaTest=a}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(a){if(a!==void 0)for(const j in a){const nt=a[j];if(nt===void 0){console.warn(`THREE.Material: parameter '${j}' has value of undefined.`);continue}const it=this[j];it!==void 0&&(it&&it.isColor?it.set(nt):it&&it.isVector3&&nt&&nt.isVector3?it.copy(nt):Array.isArray(nt)&&it&&typeof it.fromArray=="function"?it.fromArray(nt):this[j]=nt)}}toJSON(a){const j=a===void 0||typeof a=="string";j&&(a={textures:{},images:{}});const nt={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function it(ot){const ht=[];for(const ft in ot){const wt=ot[ft];delete wt.metadata,ht.push(wt)}return ht}if(nt.uuid=this.uuid,nt.type=this.type,this.name!==""&&(nt.name=this.name),this.color&&this.color.isColor&&(nt.color=this.color.getHex()),this.roughness!==void 0&&(nt.roughness=this.roughness),this.metalness!==void 0&&(nt.metalness=this.metalness),this.sheen!==void 0&&(nt.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(nt.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(nt.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(nt.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(nt.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(nt.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(nt.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(nt.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(nt.shininess=this.shininess),this.clearcoat!==void 0&&(nt.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(nt.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(nt.clearcoatMap=this.clearcoatMap.toJSON(a).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(nt.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(a).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(nt.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(a).uuid,nt.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(nt.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(nt.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(nt.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(nt.iridescenceMap=this.iridescenceMap.toJSON(a).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(nt.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(a).uuid),this.map&&this.map.isTexture&&(nt.map=this.map.toJSON(a).uuid),this.matcap&&this.matcap.isTexture&&(nt.matcap=this.matcap.toJSON(a).uuid),this.alphaMap&&this.alphaMap.isTexture&&(nt.alphaMap=this.alphaMap.toJSON(a).uuid),this.lightMap&&this.lightMap.isTexture&&(nt.lightMap=this.lightMap.toJSON(a).uuid,nt.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(nt.aoMap=this.aoMap.toJSON(a).uuid,nt.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(nt.bumpMap=this.bumpMap.toJSON(a).uuid,nt.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(nt.normalMap=this.normalMap.toJSON(a).uuid,nt.normalMapType=this.normalMapType,nt.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(nt.displacementMap=this.displacementMap.toJSON(a).uuid,nt.displacementScale=this.displacementScale,nt.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(nt.roughnessMap=this.roughnessMap.toJSON(a).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(nt.metalnessMap=this.metalnessMap.toJSON(a).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(nt.emissiveMap=this.emissiveMap.toJSON(a).uuid),this.specularMap&&this.specularMap.isTexture&&(nt.specularMap=this.specularMap.toJSON(a).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(nt.specularIntensityMap=this.specularIntensityMap.toJSON(a).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(nt.specularColorMap=this.specularColorMap.toJSON(a).uuid),this.envMap&&this.envMap.isTexture&&(nt.envMap=this.envMap.toJSON(a).uuid,this.combine!==void 0&&(nt.combine=this.combine)),this.envMapIntensity!==void 0&&(nt.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(nt.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(nt.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(nt.gradientMap=this.gradientMap.toJSON(a).uuid),this.transmission!==void 0&&(nt.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(nt.transmissionMap=this.transmissionMap.toJSON(a).uuid),this.thickness!==void 0&&(nt.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(nt.thicknessMap=this.thicknessMap.toJSON(a).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(nt.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(nt.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(nt.size=this.size),this.shadowSide!==null&&(nt.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(nt.sizeAttenuation=this.sizeAttenuation),this.blending!==dn&&(nt.blending=this.blending),this.side!==Pn&&(nt.side=this.side),this.vertexColors&&(nt.vertexColors=!0),this.opacity<1&&(nt.opacity=this.opacity),this.transparent===!0&&(nt.transparent=this.transparent),nt.depthFunc=this.depthFunc,nt.depthTest=this.depthTest,nt.depthWrite=this.depthWrite,nt.colorWrite=this.colorWrite,nt.stencilWrite=this.stencilWrite,nt.stencilWriteMask=this.stencilWriteMask,nt.stencilFunc=this.stencilFunc,nt.stencilRef=this.stencilRef,nt.stencilFuncMask=this.stencilFuncMask,nt.stencilFail=this.stencilFail,nt.stencilZFail=this.stencilZFail,nt.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(nt.rotation=this.rotation),this.polygonOffset===!0&&(nt.polygonOffset=!0),this.polygonOffsetFactor!==0&&(nt.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(nt.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(nt.linewidth=this.linewidth),this.dashSize!==void 0&&(nt.dashSize=this.dashSize),this.gapSize!==void 0&&(nt.gapSize=this.gapSize),this.scale!==void 0&&(nt.scale=this.scale),this.dithering===!0&&(nt.dithering=!0),this.alphaTest>0&&(nt.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(nt.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(nt.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(nt.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(nt.wireframe=this.wireframe),this.wireframeLinewidth>1&&(nt.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(nt.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(nt.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(nt.flatShading=this.flatShading),this.visible===!1&&(nt.visible=!1),this.toneMapped===!1&&(nt.toneMapped=!1),this.fog===!1&&(nt.fog=!1),Object.keys(this.userData).length>0&&(nt.userData=this.userData),j){const ot=it(a.textures),ht=it(a.images);ot.length>0&&(nt.textures=ot),ht.length>0&&(nt.images=ht)}return nt}clone(){return new this.constructor().copy(this)}copy(a){this.name=a.name,this.blending=a.blending,this.side=a.side,this.vertexColors=a.vertexColors,this.opacity=a.opacity,this.transparent=a.transparent,this.blendSrc=a.blendSrc,this.blendDst=a.blendDst,this.blendEquation=a.blendEquation,this.blendSrcAlpha=a.blendSrcAlpha,this.blendDstAlpha=a.blendDstAlpha,this.blendEquationAlpha=a.blendEquationAlpha,this.depthFunc=a.depthFunc,this.depthTest=a.depthTest,this.depthWrite=a.depthWrite,this.stencilWriteMask=a.stencilWriteMask,this.stencilFunc=a.stencilFunc,this.stencilRef=a.stencilRef,this.stencilFuncMask=a.stencilFuncMask,this.stencilFail=a.stencilFail,this.stencilZFail=a.stencilZFail,this.stencilZPass=a.stencilZPass,this.stencilWrite=a.stencilWrite;const j=a.clippingPlanes;let nt=null;if(j!==null){const it=j.length;nt=new Array(it);for(let ot=0;ot!==it;++ot)nt[ot]=j[ot].clone()}return this.clippingPlanes=nt,this.clipIntersection=a.clipIntersection,this.clipShadows=a.clipShadows,this.shadowSide=a.shadowSide,this.colorWrite=a.colorWrite,this.precision=a.precision,this.polygonOffset=a.polygonOffset,this.polygonOffsetFactor=a.polygonOffsetFactor,this.polygonOffsetUnits=a.polygonOffsetUnits,this.dithering=a.dithering,this.alphaTest=a.alphaTest,this.alphaToCoverage=a.alphaToCoverage,this.premultipliedAlpha=a.premultipliedAlpha,this.forceSinglePass=a.forceSinglePass,this.visible=a.visible,this.toneMapped=a.toneMapped,this.userData=XA({},a.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(a){a===!0&&this.version++}}function XA(ut,a){if(!a)return ut;for(const j of Object.keys(a)){if(j.startsWith("__")||typeof ut[j]=="function"||typeof a[j]=="function")continue;const nt=a[j],it=!nt||nt.isTexture||nt.isObject3D||nt.isMaterial;it||typeof a[j].clone!="function"?it||typeof a[j]!="object"&&!Array.isArray(a[j])?ut[j]=a[j]:ut[j]=XA(Array.isArray(a[j])?[]:{},a[j]):ut[j]=a[j].clone()}return ut}const Iv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Su={h:0,s:0,l:0},YA={h:0,s:0,l:0};function Q_(ut,a,j){return j<0&&(j+=1),j>1&&(j-=1),j<1/6?ut+6*(a-ut)*j:j<.5?a:j<2/3?ut+6*(a-ut)*(2/3-j):ut}class us{constructor(a,j,nt){return this.isColor=!0,this.r=1,this.g=1,this.b=1,j===void 0&&nt===void 0?this.set(a):this.setRGB(a,j,nt)}set(a){return a&&a.isColor?this.copy(a):typeof a=="number"?this.setHex(a):typeof a=="string"&&this.setStyle(a),this}setScalar(a){return this.r=a,this.g=a,this.b=a,this}setHex(a,j=Bs){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,Pl.toWorkingColorSpace(this,j),this}setRGB(a,j,nt,it=Pl.workingColorSpace){return this.r=a,this.g=j,this.b=nt,Pl.toWorkingColorSpace(this,it),this}setHSL(a,j,nt,it=Pl.workingColorSpace){if(a=xy(a,1),j=Is(j,0,1),nt=Is(nt,0,1),j===0)this.r=this.g=this.b=nt;else{const ot=nt<=.5?nt*(1+j):nt+j-nt*j,ht=2*nt-ot;this.r=Q_(ht,ot,a+1/3),this.g=Q_(ht,ot,a),this.b=Q_(ht,ot,a-1/3)}return Pl.toWorkingColorSpace(this,it),this}setStyle(a,j=Bs){function nt(ot){ot!==void 0&&parseFloat(ot)<1&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}let it;if(it=/^(\w+)\(([^\)]*)\)/.exec(a)){let ot;const ht=it[1],ft=it[2];switch(ht){case"rgb":case"rgba":if(ot=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ft))return nt(ot[4]),this.setRGB(Math.min(255,parseInt(ot[1],10))/255,Math.min(255,parseInt(ot[2],10))/255,Math.min(255,parseInt(ot[3],10))/255,j);if(ot=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ft))return nt(ot[4]),this.setRGB(Math.min(100,parseInt(ot[1],10))/100,Math.min(100,parseInt(ot[2],10))/100,Math.min(100,parseInt(ot[3],10))/100,j);break;case"hsl":case"hsla":if(ot=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ft))return nt(ot[4]),this.setHSL(parseFloat(ot[1])/360,parseFloat(ot[2])/100,parseFloat(ot[3])/100,j);break;default:console.warn("THREE.Color: Unknown color model "+a)}}else if(it=/^\#([A-Fa-f\d]+)$/.exec(a)){const ot=it[1],ht=ot.length;if(ht===3)return this.setRGB(parseInt(ot.charAt(0),16)/15,parseInt(ot.charAt(1),16)/15,parseInt(ot.charAt(2),16)/15,j);if(ht===6)return this.setHex(parseInt(ot,16),j);console.warn("THREE.Color: Invalid hex color "+a)}else if(a&&a.length>0)return this.setColorName(a,j);return this}setColorName(a,j=Bs){const nt=Iv[a.toLowerCase()];return nt!==void 0?this.setHex(nt,j):console.warn("THREE.Color: Unknown color "+a),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(a){return this.r=a.r,this.g=a.g,this.b=a.b,this}copySRGBToLinear(a){return this.r=b0(a.r),this.g=b0(a.g),this.b=b0(a.b),this}copyLinearToSRGB(a){return this.r=fx(a.r),this.g=fx(a.g),this.b=fx(a.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(a=Bs){return Pl.fromWorkingColorSpace(Ul.copy(this),a),65536*Math.round(Is(255*Ul.r,0,255))+256*Math.round(Is(255*Ul.g,0,255))+Math.round(Is(255*Ul.b,0,255))}getHexString(a=Bs){return("000000"+this.getHex(a).toString(16)).slice(-6)}getHSL(a,j=Pl.workingColorSpace){Pl.fromWorkingColorSpace(Ul.copy(this),j);const nt=Ul.r,it=Ul.g,ot=Ul.b,ht=Math.max(nt,it,ot),ft=Math.min(nt,it,ot);let wt,bt;const St=(ft+ht)/2;if(ft===ht)wt=0,bt=0;else{const Dt=ht-ft;switch(bt=St<=.5?Dt/(ht+ft):Dt/(2-ht-ft),ht){case nt:wt=(it-ot)/Dt+(it<ot?6:0);break;case it:wt=(ot-nt)/Dt+2;break;case ot:wt=(nt-it)/Dt+4}wt/=6}return a.h=wt,a.s=bt,a.l=St,a}getRGB(a,j=Pl.workingColorSpace){return Pl.fromWorkingColorSpace(Ul.copy(this),j),a.r=Ul.r,a.g=Ul.g,a.b=Ul.b,a}getStyle(a=Bs){Pl.fromWorkingColorSpace(Ul.copy(this),a);const j=Ul.r,nt=Ul.g,it=Ul.b;return a!==Bs?`color(${a} ${j.toFixed(3)} ${nt.toFixed(3)} ${it.toFixed(3)})`:`rgb(${Math.round(255*j)},${Math.round(255*nt)},${Math.round(255*it)})`}offsetHSL(a,j,nt){return this.getHSL(Su),Su.h+=a,Su.s+=j,Su.l+=nt,this.setHSL(Su.h,Su.s,Su.l),this}add(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this}addColors(a,j){return this.r=a.r+j.r,this.g=a.g+j.g,this.b=a.b+j.b,this}addScalar(a){return this.r+=a,this.g+=a,this.b+=a,this}sub(a){return this.r=Math.max(0,this.r-a.r),this.g=Math.max(0,this.g-a.g),this.b=Math.max(0,this.b-a.b),this}multiply(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this}multiplyScalar(a){return this.r*=a,this.g*=a,this.b*=a,this}lerp(a,j){return this.r+=(a.r-this.r)*j,this.g+=(a.g-this.g)*j,this.b+=(a.b-this.b)*j,this}lerpColors(a,j,nt){return this.r=a.r+(j.r-a.r)*nt,this.g=a.g+(j.g-a.g)*nt,this.b=a.b+(j.b-a.b)*nt,this}lerpHSL(a,j){this.getHSL(Su),a.getHSL(YA);const nt=Ey(Su.h,YA.h,j),it=Ey(Su.s,YA.s,j),ot=Ey(Su.l,YA.l,j);return this.setHSL(nt,it,ot),this}setFromVector3(a){return this.r=a.x,this.g=a.y,this.b=a.z,this}applyMatrix3(a){const j=this.r,nt=this.g,it=this.b,ot=a.elements;return this.r=ot[0]*j+ot[3]*nt+ot[6]*it,this.g=ot[1]*j+ot[4]*nt+ot[7]*it,this.b=ot[2]*j+ot[5]*nt+ot[8]*it,this}equals(a){return a.r===this.r&&a.g===this.g&&a.b===this.b}fromArray(a,j=0){return this.r=a[j],this.g=a[j+1],this.b=a[j+2],this}toArray(a=[],j=0){return a[j]=this.r,a[j+1]=this.g,a[j+2]=this.b,a}fromBufferAttribute(a,j){return this.r=a.getX(j),this.g=a.getY(j),this.b=a.getZ(j),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ul=new us;us.NAMES=Iv;class Bm extends ku{constructor(a){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new us(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=fo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}}const Pv=bx();function bx(){const ut=new ArrayBuffer(4),a=new Float32Array(ut),j=new Uint32Array(ut),nt=new Uint32Array(512),it=new Uint32Array(512);for(let wt=0;wt<256;++wt){const bt=wt-127;bt<-27?(nt[wt]=0,nt[256|wt]=32768,it[wt]=24,it[256|wt]=24):bt<-14?(nt[wt]=1024>>-bt-14,nt[256|wt]=1024>>-bt-14|32768,it[wt]=-bt-1,it[256|wt]=-bt-1):bt<=15?(nt[wt]=bt+15<<10,nt[256|wt]=bt+15<<10|32768,it[wt]=13,it[256|wt]=13):bt<128?(nt[wt]=31744,nt[256|wt]=64512,it[wt]=24,it[256|wt]=24):(nt[wt]=31744,nt[256|wt]=64512,it[wt]=13,it[256|wt]=13)}const ot=new Uint32Array(2048),ht=new Uint32Array(64),ft=new Uint32Array(64);for(let wt=1;wt<1024;++wt){let bt=wt<<13,St=0;for(;!(8388608&bt);)bt<<=1,St-=8388608;bt&=-8388609,St+=947912704,ot[wt]=bt|St}for(let wt=1024;wt<2048;++wt)ot[wt]=939524096+(wt-1024<<13);for(let wt=1;wt<31;++wt)ht[wt]=wt<<23;ht[31]=1199570944,ht[32]=2147483648;for(let wt=33;wt<63;++wt)ht[wt]=2147483648+(wt-32<<23);ht[63]=3347054592;for(let wt=1;wt<64;++wt)wt!==32&&(ft[wt]=1024);return{floatView:a,uint32View:j,baseTable:nt,shiftTable:it,mantissaTable:ot,exponentTable:ht,offsetTable:ft}}function xp(ut){Math.abs(ut)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),ut=Is(ut,-65504,65504),Pv.floatView[0]=ut;const a=Pv.uint32View[0],j=a>>23&511;return Pv.baseTable[j]+((8388607&a)>>Pv.shiftTable[j])}function Rv(ut){const a=ut>>10;return Pv.uint32View[0]=Pv.mantissaTable[Pv.offsetTable[a]+(1023&ut)]+Pv.exponentTable[a],Pv.floatView[0]}const ky={toHalfFloat:xp,fromHalfFloat:Rv},Qo=new Rn,By=new Br;class Jo{constructor(a,j,nt=!1){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=a,this.itemSize=j,this.count=a!==void 0?a.length/j:0,this.normalized=nt,this.usage=Jm,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(a){a===!0&&this.version++}setUsage(a){return this.usage=a,this}copy(a){return this.name=a.name,this.array=new a.array.constructor(a.array),this.itemSize=a.itemSize,this.count=a.count,this.normalized=a.normalized,this.usage=a.usage,this}copyAt(a,j,nt){a*=this.itemSize,nt*=j.itemSize;for(let it=0,ot=this.itemSize;it<ot;it++)this.array[a+it]=j.array[nt+it];return this}copyArray(a){return this.array.set(a),this}applyMatrix3(a){if(this.itemSize===2)for(let j=0,nt=this.count;j<nt;j++)By.fromBufferAttribute(this,j),By.applyMatrix3(a),this.setXY(j,By.x,By.y);else if(this.itemSize===3)for(let j=0,nt=this.count;j<nt;j++)Qo.fromBufferAttribute(this,j),Qo.applyMatrix3(a),this.setXYZ(j,Qo.x,Qo.y,Qo.z);return this}applyMatrix4(a){for(let j=0,nt=this.count;j<nt;j++)Qo.fromBufferAttribute(this,j),Qo.applyMatrix4(a),this.setXYZ(j,Qo.x,Qo.y,Qo.z);return this}applyNormalMatrix(a){for(let j=0,nt=this.count;j<nt;j++)Qo.fromBufferAttribute(this,j),Qo.applyNormalMatrix(a),this.setXYZ(j,Qo.x,Qo.y,Qo.z);return this}transformDirection(a){for(let j=0,nt=this.count;j<nt;j++)Qo.fromBufferAttribute(this,j),Qo.transformDirection(a),this.setXYZ(j,Qo.x,Qo.y,Qo.z);return this}set(a,j=0){return this.array.set(a,j),this}getX(a){let j=this.array[a*this.itemSize];return this.normalized&&(j=im(j,this.array)),j}setX(a,j){return this.normalized&&(j=ho(j,this.array)),this.array[a*this.itemSize]=j,this}getY(a){let j=this.array[a*this.itemSize+1];return this.normalized&&(j=im(j,this.array)),j}setY(a,j){return this.normalized&&(j=ho(j,this.array)),this.array[a*this.itemSize+1]=j,this}getZ(a){let j=this.array[a*this.itemSize+2];return this.normalized&&(j=im(j,this.array)),j}setZ(a,j){return this.normalized&&(j=ho(j,this.array)),this.array[a*this.itemSize+2]=j,this}getW(a){let j=this.array[a*this.itemSize+3];return this.normalized&&(j=im(j,this.array)),j}setW(a,j){return this.normalized&&(j=ho(j,this.array)),this.array[a*this.itemSize+3]=j,this}setXY(a,j,nt){return a*=this.itemSize,this.normalized&&(j=ho(j,this.array),nt=ho(nt,this.array)),this.array[a+0]=j,this.array[a+1]=nt,this}setXYZ(a,j,nt,it){return a*=this.itemSize,this.normalized&&(j=ho(j,this.array),nt=ho(nt,this.array),it=ho(it,this.array)),this.array[a+0]=j,this.array[a+1]=nt,this.array[a+2]=it,this}setXYZW(a,j,nt,it,ot){return a*=this.itemSize,this.normalized&&(j=ho(j,this.array),nt=ho(nt,this.array),it=ho(it,this.array),ot=ho(ot,this.array)),this.array[a+0]=j,this.array[a+1]=nt,this.array[a+2]=it,this.array[a+3]=ot,this}onUpload(a){return this.onUploadCallback=a,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const a={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(a.name=this.name),this.usage!==Jm&&(a.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(a.updateRange=this.updateRange),a}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class z1 extends Jo{constructor(a,j,nt){super(new Int8Array(a),j,nt)}}class W_ extends Jo{constructor(a,j,nt){super(new Uint8Array(a),j,nt)}}class V1 extends Jo{constructor(a,j,nt){super(new Uint8ClampedArray(a),j,nt)}}class D0 extends Jo{constructor(a,j,nt){super(new Int16Array(a),j,nt)}}class Ep extends Jo{constructor(a,j,nt){super(new Uint16Array(a),j,nt)}}class k0 extends Jo{constructor(a,j,nt){super(new Int32Array(a),j,nt)}}class Yu extends Jo{constructor(a,j,nt){super(new Uint32Array(a),j,nt)}}class su extends Jo{constructor(a,j,nt){super(new Uint16Array(a),j,nt),this.isFloat16BufferAttribute=!0}getX(a){let j=Rv(this.array[a*this.itemSize]);return this.normalized&&(j=im(j,this.array)),j}setX(a,j){return this.normalized&&(j=ho(j,this.array)),this.array[a*this.itemSize]=xp(j),this}getY(a){let j=Rv(this.array[a*this.itemSize+1]);return this.normalized&&(j=im(j,this.array)),j}setY(a,j){return this.normalized&&(j=ho(j,this.array)),this.array[a*this.itemSize+1]=xp(j),this}getZ(a){let j=Rv(this.array[a*this.itemSize+2]);return this.normalized&&(j=im(j,this.array)),j}setZ(a,j){return this.normalized&&(j=ho(j,this.array)),this.array[a*this.itemSize+2]=xp(j),this}getW(a){let j=Rv(this.array[a*this.itemSize+3]);return this.normalized&&(j=im(j,this.array)),j}setW(a,j){return this.normalized&&(j=ho(j,this.array)),this.array[a*this.itemSize+3]=xp(j),this}setXY(a,j,nt){return a*=this.itemSize,this.normalized&&(j=ho(j,this.array),nt=ho(nt,this.array)),this.array[a+0]=xp(j),this.array[a+1]=xp(nt),this}setXYZ(a,j,nt,it){return a*=this.itemSize,this.normalized&&(j=ho(j,this.array),nt=ho(nt,this.array),it=ho(it,this.array)),this.array[a+0]=xp(j),this.array[a+1]=xp(nt),this.array[a+2]=xp(it),this}setXYZW(a,j,nt,it,ot){return a*=this.itemSize,this.normalized&&(j=ho(j,this.array),nt=ho(nt,this.array),it=ho(it,this.array),ot=ho(ot,this.array)),this.array[a+0]=xp(j),this.array[a+1]=xp(nt),this.array[a+2]=xp(it),this.array[a+3]=xp(ot),this}}class fs extends Jo{constructor(a,j,nt){super(new Float32Array(a),j,nt)}}class Go extends Jo{constructor(a,j,nt){super(new Float64Array(a),j,nt)}}let G1=0;const Sp=new ro,wx=new Po,Ct=new Rn,lt=new Zm,mt=new Zm,Tt=new Rn;class Vt extends $m{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:G1++}),this.uuid=Fp(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(a){return Array.isArray(a)?this.index=new(kS(a)?Yu:Ep)(a,1):this.index=a,this}getAttribute(a){return this.attributes[a]}setAttribute(a,j){return this.attributes[a]=j,this}deleteAttribute(a){return delete this.attributes[a],this}hasAttribute(a){return this.attributes[a]!==void 0}addGroup(a,j,nt=0){this.groups.push({start:a,count:j,materialIndex:nt})}clearGroups(){this.groups=[]}setDrawRange(a,j){this.drawRange.start=a,this.drawRange.count=j}applyMatrix4(a){const j=this.attributes.position;j!==void 0&&(j.applyMatrix4(a),j.needsUpdate=!0);const nt=this.attributes.normal;if(nt!==void 0){const ot=new oo().getNormalMatrix(a);nt.applyNormalMatrix(ot),nt.needsUpdate=!0}const it=this.attributes.tangent;return it!==void 0&&(it.transformDirection(a),it.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(a){return Sp.makeRotationFromQuaternion(a),this.applyMatrix4(Sp),this}rotateX(a){return Sp.makeRotationX(a),this.applyMatrix4(Sp),this}rotateY(a){return Sp.makeRotationY(a),this.applyMatrix4(Sp),this}rotateZ(a){return Sp.makeRotationZ(a),this.applyMatrix4(Sp),this}translate(a,j,nt){return Sp.makeTranslation(a,j,nt),this.applyMatrix4(Sp),this}scale(a,j,nt){return Sp.makeScale(a,j,nt),this.applyMatrix4(Sp),this}lookAt(a){return wx.lookAt(a),wx.updateMatrix(),this.applyMatrix4(wx.matrix),this}center(a=void 0){return this.computeBoundingBox(),this.boundingBox.getCenter(Ct).negate(),this.translate(Ct.x,Ct.y,Ct.z),a&&a.copy(Ct),this}setFromPoints(a){const j=[];for(let nt=0,it=a.length;nt<it;nt++){const ot=a[nt];j.push(ot.x,ot.y,ot.z||0)}return this.setAttribute("position",new fs(j,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Zm);const a=this.attributes.position,j=this.morphAttributes.position;if(a&&a.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Rn(-1/0,-1/0,-1/0),new Rn(1/0,1/0,1/0));if(a!==void 0){if(this.boundingBox.setFromBufferAttribute(a),j)for(let nt=0,it=j.length;nt<it;nt++){const ot=j[nt];lt.setFromBufferAttribute(ot),this.morphTargetsRelative?(Tt.addVectors(this.boundingBox.min,lt.min),this.boundingBox.expandByPoint(Tt),Tt.addVectors(this.boundingBox.max,lt.max),this.boundingBox.expandByPoint(Tt)):(this.boundingBox.expandByPoint(lt.min),this.boundingBox.expandByPoint(lt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Dm);const a=this.attributes.position,j=this.morphAttributes.position;if(a&&a.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Rn,1/0);if(a){const nt=this.boundingSphere.center;if(lt.setFromBufferAttribute(a),j)for(let ot=0,ht=j.length;ot<ht;ot++){const ft=j[ot];mt.setFromBufferAttribute(ft),this.morphTargetsRelative?(Tt.addVectors(lt.min,mt.min),lt.expandByPoint(Tt),Tt.addVectors(lt.max,mt.max),lt.expandByPoint(Tt)):(lt.expandByPoint(mt.min),lt.expandByPoint(mt.max))}lt.getCenter(nt);let it=0;for(let ot=0,ht=a.count;ot<ht;ot++)Tt.fromBufferAttribute(a,ot),it=Math.max(it,nt.distanceToSquared(Tt));if(j)for(let ot=0,ht=j.length;ot<ht;ot++){const ft=j[ot],wt=this.morphTargetsRelative;for(let bt=0,St=ft.count;bt<St;bt++)Tt.fromBufferAttribute(ft,bt),wt&&(Ct.fromBufferAttribute(a,bt),Tt.add(Ct)),it=Math.max(it,nt.distanceToSquared(Tt))}this.boundingSphere.radius=Math.sqrt(it),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const a=this.index,j=this.attributes;if(a===null||j.position===void 0||j.normal===void 0||j.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const nt=a.array,it=j.position.array,ot=j.normal.array,ht=j.uv.array,ft=it.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Jo(new Float32Array(4*ft),4));const wt=this.getAttribute("tangent").array,bt=[],St=[];for(let sr=0;sr<ft;sr++)bt[sr]=new Rn,St[sr]=new Rn;const Dt=new Rn,Rt=new Rn,kt=new Rn,Ot=new Br,Gt=new Br,Nt=new Br,zt=new Rn,qt=new Rn;function $t(sr,Vn,_r){Dt.fromArray(it,3*sr),Rt.fromArray(it,3*Vn),kt.fromArray(it,3*_r),Ot.fromArray(ht,2*sr),Gt.fromArray(ht,2*Vn),Nt.fromArray(ht,2*_r),Rt.sub(Dt),kt.sub(Dt),Gt.sub(Ot),Nt.sub(Ot);const xr=1/(Gt.x*Nt.y-Nt.x*Gt.y);isFinite(xr)&&(zt.copy(Rt).multiplyScalar(Nt.y).addScaledVector(kt,-Gt.y).multiplyScalar(xr),qt.copy(kt).multiplyScalar(Gt.x).addScaledVector(Rt,-Nt.x).multiplyScalar(xr),bt[sr].add(zt),bt[Vn].add(zt),bt[_r].add(zt),St[sr].add(qt),St[Vn].add(qt),St[_r].add(qt))}let En=this.groups;En.length===0&&(En=[{start:0,count:nt.length}]);for(let sr=0,Vn=En.length;sr<Vn;++sr){const _r=En[sr],xr=_r.start;for(let Gr=xr,ns=xr+_r.count;Gr<ns;Gr+=3)$t(nt[Gr+0],nt[Gr+1],nt[Gr+2])}const gn=new Rn,vn=new Rn,Un=new Rn,$n=new Rn;function jn(sr){Un.fromArray(ot,3*sr),$n.copy(Un);const Vn=bt[sr];gn.copy(Vn),gn.sub(Un.multiplyScalar(Un.dot(Vn))).normalize(),vn.crossVectors($n,Vn);const _r=vn.dot(St[sr])<0?-1:1;wt[4*sr]=gn.x,wt[4*sr+1]=gn.y,wt[4*sr+2]=gn.z,wt[4*sr+3]=_r}for(let sr=0,Vn=En.length;sr<Vn;++sr){const _r=En[sr],xr=_r.start;for(let Gr=xr,ns=xr+_r.count;Gr<ns;Gr+=3)jn(nt[Gr+0]),jn(nt[Gr+1]),jn(nt[Gr+2])}}computeVertexNormals(){const a=this.index,j=this.getAttribute("position");if(j!==void 0){let nt=this.getAttribute("normal");if(nt===void 0)nt=new Jo(new Float32Array(3*j.count),3),this.setAttribute("normal",nt);else for(let Rt=0,kt=nt.count;Rt<kt;Rt++)nt.setXYZ(Rt,0,0,0);const it=new Rn,ot=new Rn,ht=new Rn,ft=new Rn,wt=new Rn,bt=new Rn,St=new Rn,Dt=new Rn;if(a)for(let Rt=0,kt=a.count;Rt<kt;Rt+=3){const Ot=a.getX(Rt+0),Gt=a.getX(Rt+1),Nt=a.getX(Rt+2);it.fromBufferAttribute(j,Ot),ot.fromBufferAttribute(j,Gt),ht.fromBufferAttribute(j,Nt),St.subVectors(ht,ot),Dt.subVectors(it,ot),St.cross(Dt),ft.fromBufferAttribute(nt,Ot),wt.fromBufferAttribute(nt,Gt),bt.fromBufferAttribute(nt,Nt),ft.add(St),wt.add(St),bt.add(St),nt.setXYZ(Ot,ft.x,ft.y,ft.z),nt.setXYZ(Gt,wt.x,wt.y,wt.z),nt.setXYZ(Nt,bt.x,bt.y,bt.z)}else for(let Rt=0,kt=j.count;Rt<kt;Rt+=3)it.fromBufferAttribute(j,Rt+0),ot.fromBufferAttribute(j,Rt+1),ht.fromBufferAttribute(j,Rt+2),St.subVectors(ht,ot),Dt.subVectors(it,ot),St.cross(Dt),nt.setXYZ(Rt+0,St.x,St.y,St.z),nt.setXYZ(Rt+1,St.x,St.y,St.z),nt.setXYZ(Rt+2,St.x,St.y,St.z);this.normalizeNormals(),nt.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const a=this.attributes.normal;for(let j=0,nt=a.count;j<nt;j++)Tt.fromBufferAttribute(a,j),Tt.normalize(),a.setXYZ(j,Tt.x,Tt.y,Tt.z)}toNonIndexed(){function a(ft,wt){const bt=ft.array,St=ft.itemSize,Dt=ft.normalized,Rt=new bt.constructor(wt.length*St);let kt=0,Ot=0;for(let Gt=0,Nt=wt.length;Gt<Nt;Gt++){kt=ft.isInterleavedBufferAttribute?wt[Gt]*ft.data.stride+ft.offset:wt[Gt]*St;for(let zt=0;zt<St;zt++)Rt[Ot++]=bt[kt++]}return new Jo(Rt,St,Dt)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const j=new Vt,nt=this.index.array,it=this.attributes;for(const ft in it){const wt=a(it[ft],nt);j.setAttribute(ft,wt)}const ot=this.morphAttributes;for(const ft in ot){const wt=[],bt=ot[ft];for(let St=0,Dt=bt.length;St<Dt;St++){const Rt=a(bt[St],nt);wt.push(Rt)}j.morphAttributes[ft]=wt}j.morphTargetsRelative=this.morphTargetsRelative;const ht=this.groups;for(let ft=0,wt=ht.length;ft<wt;ft++){const bt=ht[ft];j.addGroup(bt.start,bt.count,bt.materialIndex)}return j}toJSON(){const a={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,this.name!==""&&(a.name=this.name),Object.keys(this.userData).length>0&&(a.userData=this.userData),this.parameters!==void 0){const wt=this.parameters;for(const bt in wt)wt[bt]!==void 0&&(a[bt]=wt[bt]);return a}a.data={attributes:{}};const j=this.index;j!==null&&(a.data.index={type:j.array.constructor.name,array:Array.prototype.slice.call(j.array)});const nt=this.attributes;for(const wt in nt){const bt=nt[wt];a.data.attributes[wt]=bt.toJSON(a.data)}const it={};let ot=!1;for(const wt in this.morphAttributes){const bt=this.morphAttributes[wt],St=[];for(let Dt=0,Rt=bt.length;Dt<Rt;Dt++){const kt=bt[Dt];St.push(kt.toJSON(a.data))}St.length>0&&(it[wt]=St,ot=!0)}ot&&(a.data.morphAttributes=it,a.data.morphTargetsRelative=this.morphTargetsRelative);const ht=this.groups;ht.length>0&&(a.data.groups=JSON.parse(JSON.stringify(ht)));const ft=this.boundingSphere;return ft!==null&&(a.data.boundingSphere={center:ft.center.toArray(),radius:ft.radius}),a}clone(){return new this.constructor().copy(this)}copy(a){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const j={};this.name=a.name;const nt=a.index;nt!==null&&this.setIndex(nt.clone(j));const it=a.attributes;for(const bt in it){const St=it[bt];this.setAttribute(bt,St.clone(j))}const ot=a.morphAttributes;for(const bt in ot){const St=[],Dt=ot[bt];for(let Rt=0,kt=Dt.length;Rt<kt;Rt++)St.push(Dt[Rt].clone(j));this.morphAttributes[bt]=St}this.morphTargetsRelative=a.morphTargetsRelative;const ht=a.groups;for(let bt=0,St=ht.length;bt<St;bt++){const Dt=ht[bt];this.addGroup(Dt.start,Dt.count,Dt.materialIndex)}const ft=a.boundingBox;ft!==null&&(this.boundingBox=ft.clone());const wt=a.boundingSphere;return wt!==null&&(this.boundingSphere=wt.clone()),this.drawRange.start=a.drawRange.start,this.drawRange.count=a.drawRange.count,this.userData=a.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const wn=new ro,Tn=new C0,or=new Dm,Mr=new Rn,as=new Rn,Gs=new Rn,Wo=new Rn,Ku=new Rn,Bu=new Rn,Om=new Br,Dv=new Br,d_=new Br,KA=new Rn,Oy=new Rn,q_=new Rn,Ly=new Rn,xx=new Rn;class Ou extends Po{constructor(a=new Vt,j=new Bm){super(),this.isMesh=!0,this.type="Mesh",this.geometry=a,this.material=j,this.updateMorphTargets()}copy(a,j){return super.copy(a,j),a.isMesh?(a.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=a.morphTargetInfluences.slice()),a.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary)),this.material=a.material,this.geometry=a.geometry,this):this}updateMorphTargets(){const a=this.geometry.morphAttributes,j=Object.keys(a);if(j.length>0){const nt=a[j[0]];if(nt!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let it=0,ot=nt.length;it<ot;it++){const ht=nt[it].name||String(it);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ht]=it}}}}getVertexPosition(a,j){const nt=this.geometry,it=nt.attributes.position,ot=nt.morphAttributes.position,ht=nt.morphTargetsRelative;j.fromBufferAttribute(it,a);const ft=this.morphTargetInfluences;if(ot&&ft){Bu.set(0,0,0);for(let wt=0,bt=ot.length;wt<bt;wt++){const St=ft[wt],Dt=ot[wt];St!==0&&(Ku.fromBufferAttribute(Dt,a),ht?Bu.addScaledVector(Ku,St):Bu.addScaledVector(Ku.sub(j),St))}j.add(Bu)}return j}raycast(a,j){const nt=this.geometry,it=this.material,ot=this.matrixWorld;if(it!==void 0){if(nt.boundingSphere===null&&nt.computeBoundingSphere(),or.copy(nt.boundingSphere),or.applyMatrix4(ot),Tn.copy(a.ray).recast(a.near),or.containsPoint(Tn.origin)===!1&&(Tn.intersectSphere(or,Mr)===null||Tn.origin.distanceToSquared(Mr)>(a.far-a.near)**2))return;wn.copy(ot).invert(),Tn.copy(a.ray).applyMatrix4(wn),nt.boundingBox!==null&&Tn.intersectsBox(nt.boundingBox)===!1||this._computeIntersections(a,j)}}_computeIntersections(a,j){let nt;const it=this.geometry,ot=this.material,ht=it.index,ft=it.attributes.position,wt=it.attributes.uv,bt=it.attributes.uv1,St=it.attributes.normal,Dt=it.groups,Rt=it.drawRange;if(ht!==null)if(Array.isArray(ot))for(let kt=0,Ot=Dt.length;kt<Ot;kt++){const Gt=Dt[kt],Nt=ot[Gt.materialIndex];for(let zt=Math.max(Gt.start,Rt.start),qt=Math.min(ht.count,Math.min(Gt.start+Gt.count,Rt.start+Rt.count));zt<qt;zt+=3){const $t=ht.getX(zt),En=ht.getX(zt+1),gn=ht.getX(zt+2);nt=Ex(this,Nt,a,Tn,wt,bt,St,$t,En,gn),nt&&(nt.faceIndex=Math.floor(zt/3),nt.face.materialIndex=Gt.materialIndex,j.push(nt))}}else for(let kt=Math.max(0,Rt.start),Ot=Math.min(ht.count,Rt.start+Rt.count);kt<Ot;kt+=3){const Gt=ht.getX(kt),Nt=ht.getX(kt+1),zt=ht.getX(kt+2);nt=Ex(this,ot,a,Tn,wt,bt,St,Gt,Nt,zt),nt&&(nt.faceIndex=Math.floor(kt/3),j.push(nt))}else if(ft!==void 0)if(Array.isArray(ot))for(let kt=0,Ot=Dt.length;kt<Ot;kt++){const Gt=Dt[kt],Nt=ot[Gt.materialIndex];for(let zt=Math.max(Gt.start,Rt.start),qt=Math.min(ft.count,Math.min(Gt.start+Gt.count,Rt.start+Rt.count));zt<qt;zt+=3)nt=Ex(this,Nt,a,Tn,wt,bt,St,zt,zt+1,zt+2),nt&&(nt.faceIndex=Math.floor(zt/3),nt.face.materialIndex=Gt.materialIndex,j.push(nt))}else for(let kt=Math.max(0,Rt.start),Ot=Math.min(ft.count,Rt.start+Rt.count);kt<Ot;kt+=3)nt=Ex(this,ot,a,Tn,wt,bt,St,kt,kt+1,kt+2),nt&&(nt.faceIndex=Math.floor(kt/3),j.push(nt))}}function Ex(ut,a,j,nt,it,ot,ht,ft,wt,bt){ut.getVertexPosition(ft,as),ut.getVertexPosition(wt,Gs),ut.getVertexPosition(bt,Wo);const St=function(Dt,Rt,kt,Ot,Gt,Nt,zt,qt){let $t;if($t=Rt.side===nn?Ot.intersectTriangle(zt,Nt,Gt,!0,qt):Ot.intersectTriangle(Gt,Nt,zt,Rt.side===Pn,qt),$t===null)return null;xx.copy(qt),xx.applyMatrix4(Dt.matrixWorld);const En=kt.ray.origin.distanceTo(xx);return En<kt.near||En>kt.far?null:{distance:En,point:xx.clone(),object:Dt}}(ut,a,j,nt,as,Gs,Wo,Ly);if(St){it&&(Om.fromBufferAttribute(it,ft),Dv.fromBufferAttribute(it,wt),d_.fromBufferAttribute(it,bt),St.uv=ru.getInterpolation(Ly,as,Gs,Wo,Om,Dv,d_,new Br)),ot&&(Om.fromBufferAttribute(ot,ft),Dv.fromBufferAttribute(ot,wt),d_.fromBufferAttribute(ot,bt),St.uv1=ru.getInterpolation(Ly,as,Gs,Wo,Om,Dv,d_,new Br),St.uv2=St.uv1),ht&&(KA.fromBufferAttribute(ht,ft),Oy.fromBufferAttribute(ht,wt),q_.fromBufferAttribute(ht,bt),St.normal=ru.getInterpolation(Ly,as,Gs,Wo,KA,Oy,q_,new Rn),St.normal.dot(nt.direction)>0&&St.normal.multiplyScalar(-1));const Dt={a:ft,b:wt,c:bt,normal:new Rn,materialIndex:0};ru.getNormal(as,Gs,Wo,Dt.normal),St.face=Dt}return St}class kv extends Vt{constructor(a=1,j=1,nt=1,it=1,ot=1,ht=1){super(),this.type="BoxGeometry",this.parameters={width:a,height:j,depth:nt,widthSegments:it,heightSegments:ot,depthSegments:ht};const ft=this;it=Math.floor(it),ot=Math.floor(ot),ht=Math.floor(ht);const wt=[],bt=[],St=[],Dt=[];let Rt=0,kt=0;function Ot(Gt,Nt,zt,qt,$t,En,gn,vn,Un,$n,jn){const sr=En/Un,Vn=gn/$n,_r=En/2,xr=gn/2,Gr=vn/2,ns=Un+1,Vr=$n+1;let Tr=0,Yr=0;const ts=new Rn;for(let mr=0;mr<Vr;mr++){const Dr=mr*Vn-xr;for(let $r=0;$r<ns;$r++){const Ur=$r*sr-_r;ts[Gt]=Ur*qt,ts[Nt]=Dr*$t,ts[zt]=Gr,bt.push(ts.x,ts.y,ts.z),ts[Gt]=0,ts[Nt]=0,ts[zt]=vn>0?1:-1,St.push(ts.x,ts.y,ts.z),Dt.push($r/Un),Dt.push(1-mr/$n),Tr+=1}}for(let mr=0;mr<$n;mr++)for(let Dr=0;Dr<Un;Dr++){const $r=Rt+Dr+ns*mr,Ur=Rt+Dr+ns*(mr+1),ss=Rt+(Dr+1)+ns*(mr+1),Hs=Rt+(Dr+1)+ns*mr;wt.push($r,Ur,Hs),wt.push(Ur,ss,Hs),Yr+=6}ft.addGroup(kt,Yr,jn),kt+=Yr,Rt+=Tr}Ot("z","y","x",-1,-1,nt,j,a,ht,ot,0),Ot("z","y","x",1,-1,nt,j,-a,ht,ot,1),Ot("x","z","y",1,1,a,nt,j,it,ht,2),Ot("x","z","y",1,-1,a,nt,-j,it,ht,3),Ot("x","y","z",1,-1,a,j,nt,it,ot,4),Ot("x","y","z",-1,-1,a,j,-nt,it,ot,5),this.setIndex(wt),this.setAttribute("position",new fs(bt,3)),this.setAttribute("normal",new fs(St,3)),this.setAttribute("uv",new fs(Dt,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new kv(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments)}}function Ny(ut){const a={};for(const j in ut){a[j]={};for(const nt in ut[j]){const it=ut[j][nt];it&&(it.isColor||it.isMatrix3||it.isMatrix4||it.isVector2||it.isVector3||it.isVector4||it.isTexture||it.isQuaternion)?it.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),a[j][nt]=null):a[j][nt]=it.clone():Array.isArray(it)?a[j][nt]=it.slice():a[j][nt]=it}}return a}function Gp(ut){const a={};for(let j=0;j<ut.length;j++){const nt=Ny(ut[j]);for(const it in nt)a[it]=nt[it]}return a}function H1(ut){return ut.getRenderTarget()===null?ut.outputColorSpace:io}const FM={clone:Ny,merge:Gp};class p_ extends ku{constructor(a){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,a!==void 0&&this.setValues(a)}copy(a){return super.copy(a),this.fragmentShader=a.fragmentShader,this.vertexShader=a.vertexShader,this.uniforms=Ny(a.uniforms),this.uniformsGroups=function(j){const nt=[];for(let it=0;it<j.length;it++)nt.push(j[it].clone());return nt}(a.uniformsGroups),this.defines=Object.assign({},a.defines),this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.fog=a.fog,this.lights=a.lights,this.clipping=a.clipping,this.extensions=Object.assign({},a.extensions),this.glslVersion=a.glslVersion,this}toJSON(a){const j=super.toJSON(a);j.glslVersion=this.glslVersion,j.uniforms={};for(const it in this.uniforms){const ot=this.uniforms[it].value;ot&&ot.isTexture?j.uniforms[it]={type:"t",value:ot.toJSON(a).uuid}:ot&&ot.isColor?j.uniforms[it]={type:"c",value:ot.getHex()}:ot&&ot.isVector2?j.uniforms[it]={type:"v2",value:ot.toArray()}:ot&&ot.isVector3?j.uniforms[it]={type:"v3",value:ot.toArray()}:ot&&ot.isVector4?j.uniforms[it]={type:"v4",value:ot.toArray()}:ot&&ot.isMatrix3?j.uniforms[it]={type:"m3",value:ot.toArray()}:ot&&ot.isMatrix4?j.uniforms[it]={type:"m4",value:ot.toArray()}:j.uniforms[it]={value:ot}}Object.keys(this.defines).length>0&&(j.defines=this.defines),j.vertexShader=this.vertexShader,j.fragmentShader=this.fragmentShader,j.lights=this.lights,j.clipping=this.clipping;const nt={};for(const it in this.extensions)this.extensions[it]===!0&&(nt[it]=!0);return Object.keys(nt).length>0&&(j.extensions=nt),j}}class FS extends Po{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ro,this.projectionMatrix=new ro,this.projectionMatrixInverse=new ro}copy(a,j){return super.copy(a,j),this.matrixWorldInverse.copy(a.matrixWorldInverse),this.projectionMatrix.copy(a.projectionMatrix),this.projectionMatrixInverse.copy(a.projectionMatrixInverse),this}getWorldDirection(a){this.updateWorldMatrix(!0,!1);const j=this.matrixWorld.elements;return a.set(-j[8],-j[9],-j[10]).normalize()}updateMatrixWorld(a){super.updateMatrixWorld(a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(a,j){super.updateWorldMatrix(a,j),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Cp extends FS{constructor(a=50,j=1,nt=.1,it=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=a,this.zoom=1,this.near=nt,this.far=it,this.focus=10,this.aspect=j,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(a,j){return super.copy(a,j),this.fov=a.fov,this.zoom=a.zoom,this.near=a.near,this.far=a.far,this.focus=a.focus,this.aspect=a.aspect,this.view=a.view===null?null:Object.assign({},a.view),this.filmGauge=a.filmGauge,this.filmOffset=a.filmOffset,this}setFocalLength(a){const j=.5*this.getFilmHeight()/a;this.fov=2*Im*Math.atan(j),this.updateProjectionMatrix()}getFocalLength(){const a=Math.tan(.5*a_*this.fov);return .5*this.getFilmHeight()/a}getEffectiveFOV(){return 2*Im*Math.atan(Math.tan(.5*a_*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(a,j,nt,it,ot,ht){this.aspect=a/j,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=j,this.view.offsetX=nt,this.view.offsetY=it,this.view.width=ot,this.view.height=ht,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const a=this.near;let j=a*Math.tan(.5*a_*this.fov)/this.zoom,nt=2*j,it=this.aspect*nt,ot=-.5*it;const ht=this.view;if(this.view!==null&&this.view.enabled){const wt=ht.fullWidth,bt=ht.fullHeight;ot+=ht.offsetX*it/wt,j-=ht.offsetY*nt/bt,it*=ht.width/wt,nt*=ht.height/bt}const ft=this.filmOffset;ft!==0&&(ot+=a*ft/this.getFilmWidth()),this.projectionMatrix.makePerspective(ot,ot+it,j,j-nt,a,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){const j=super.toJSON(a);return j.object.fov=this.fov,j.object.zoom=this.zoom,j.object.near=this.near,j.object.far=this.far,j.object.focus=this.focus,j.object.aspect=this.aspect,this.view!==null&&(j.object.view=Object.assign({},this.view)),j.object.filmGauge=this.filmGauge,j.object.filmOffset=this.filmOffset,j}}const Uy=-90;class jM extends Po{constructor(a,j,nt){super(),this.type="CubeCamera",this.renderTarget=nt;const it=new Cp(Uy,1,a,j);it.layers=this.layers,it.up.set(0,1,0),it.lookAt(1,0,0),this.add(it);const ot=new Cp(Uy,1,a,j);ot.layers=this.layers,ot.up.set(0,1,0),ot.lookAt(-1,0,0),this.add(ot);const ht=new Cp(Uy,1,a,j);ht.layers=this.layers,ht.up.set(0,0,-1),ht.lookAt(0,1,0),this.add(ht);const ft=new Cp(Uy,1,a,j);ft.layers=this.layers,ft.up.set(0,0,1),ft.lookAt(0,-1,0),this.add(ft);const wt=new Cp(Uy,1,a,j);wt.layers=this.layers,wt.up.set(0,1,0),wt.lookAt(0,0,1),this.add(wt);const bt=new Cp(Uy,1,a,j);bt.layers=this.layers,bt.up.set(0,1,0),bt.lookAt(0,0,-1),this.add(bt)}update(a,j){this.parent===null&&this.updateMatrixWorld();const nt=this.renderTarget,[it,ot,ht,ft,wt,bt]=this.children,St=a.getRenderTarget(),Dt=a.toneMapping,Rt=a.xr.enabled;a.toneMapping=Mo,a.xr.enabled=!1;const kt=nt.texture.generateMipmaps;nt.texture.generateMipmaps=!1,a.setRenderTarget(nt,0),a.render(j,it),a.setRenderTarget(nt,1),a.render(j,ot),a.setRenderTarget(nt,2),a.render(j,ht),a.setRenderTarget(nt,3),a.render(j,ft),a.setRenderTarget(nt,4),a.render(j,wt),nt.texture.generateMipmaps=kt,a.setRenderTarget(nt,5),a.render(j,bt),a.setRenderTarget(St),a.toneMapping=Dt,a.xr.enabled=Rt,nt.texture.needsPMREMUpdate=!0}}class JA extends ga{constructor(a,j,nt,it,ot,ht,ft,wt,bt,St){super(a=a!==void 0?a:[],j=j!==void 0?j:Ql,nt,it,ot,ht,ft,wt,bt,St),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(a){this.image=a}}class zM extends xu{constructor(a=1,j={}){super(a,a,j),this.isWebGLCubeRenderTarget=!0;const nt={width:a,height:a,depth:1},it=[nt,nt,nt,nt,nt,nt];j.encoding!==void 0&&(A0("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),j.colorSpace=j.encoding===Nl?Bs:Cm),this.texture=new JA(it,j.mapping,j.wrapS,j.wrapT,j.magFilter,j.minFilter,j.format,j.type,j.anisotropy,j.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=j.generateMipmaps!==void 0&&j.generateMipmaps,this.texture.minFilter=j.minFilter!==void 0?j.minFilter:Il}fromEquirectangularTexture(a,j){this.texture.type=j.type,this.texture.colorSpace=j.colorSpace,this.texture.generateMipmaps=j.generateMipmaps,this.texture.minFilter=j.minFilter,this.texture.magFilter=j.magFilter;const nt={tEquirect:{value:null}},it=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,ot=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,ht=new kv(5,5,5),ft=new p_({name:"CubemapFromEquirect",uniforms:Ny(nt),vertexShader:it,fragmentShader:ot,side:nn,blending:Xt});ft.uniforms.tEquirect.value=j;const wt=new Ou(ht,ft),bt=j.minFilter;return j.minFilter===Au&&(j.minFilter=Il),new jM(1,10,this).update(a,wt),j.minFilter=bt,wt.geometry.dispose(),wt.material.dispose(),this}clear(a,j,nt,it){const ot=a.getRenderTarget();for(let ht=0;ht<6;ht++)a.setRenderTarget(this,ht),a.clear(j,nt,it);a.setRenderTarget(ot)}}const jS=new Rn,QD=new Rn,WD=new oo;class Mp{constructor(a=new Rn(1,0,0),j=0){this.isPlane=!0,this.normal=a,this.constant=j}set(a,j){return this.normal.copy(a),this.constant=j,this}setComponents(a,j,nt,it){return this.normal.set(a,j,nt),this.constant=it,this}setFromNormalAndCoplanarPoint(a,j){return this.normal.copy(a),this.constant=-j.dot(this.normal),this}setFromCoplanarPoints(a,j,nt){const it=jS.subVectors(nt,j).cross(QD.subVectors(a,j)).normalize();return this.setFromNormalAndCoplanarPoint(it,a),this}copy(a){return this.normal.copy(a.normal),this.constant=a.constant,this}normalize(){const a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(a){return this.normal.dot(a)+this.constant}distanceToSphere(a){return this.distanceToPoint(a.center)-a.radius}projectPoint(a,j){return j.copy(a).addScaledVector(this.normal,-this.distanceToPoint(a))}intersectLine(a,j){const nt=a.delta(jS),it=this.normal.dot(nt);if(it===0)return this.distanceToPoint(a.start)===0?j.copy(a.start):null;const ot=-(a.start.dot(this.normal)+this.constant)/it;return ot<0||ot>1?null:j.copy(a.start).addScaledVector(nt,ot)}intersectsLine(a){const j=this.distanceToPoint(a.start),nt=this.distanceToPoint(a.end);return j<0&&nt>0||nt<0&&j>0}intersectsBox(a){return a.intersectsPlane(this)}intersectsSphere(a){return a.intersectsPlane(this)}coplanarPoint(a){return a.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(a,j){const nt=j||WD.getNormalMatrix(a),it=this.coplanarPoint(jS).applyMatrix4(a),ot=this.normal.applyMatrix3(nt).normalize();return this.constant=-it.dot(ot),this}translate(a){return this.constant-=a.dot(this.normal),this}equals(a){return a.normal.equals(this.normal)&&a.constant===this.constant}clone(){return new this.constructor().copy(this)}}const X_=new Dm,Q1=new Rn;class W1{constructor(a=new Mp,j=new Mp,nt=new Mp,it=new Mp,ot=new Mp,ht=new Mp){this.planes=[a,j,nt,it,ot,ht]}set(a,j,nt,it,ot,ht){const ft=this.planes;return ft[0].copy(a),ft[1].copy(j),ft[2].copy(nt),ft[3].copy(it),ft[4].copy(ot),ft[5].copy(ht),this}copy(a){const j=this.planes;for(let nt=0;nt<6;nt++)j[nt].copy(a.planes[nt]);return this}setFromProjectionMatrix(a){const j=this.planes,nt=a.elements,it=nt[0],ot=nt[1],ht=nt[2],ft=nt[3],wt=nt[4],bt=nt[5],St=nt[6],Dt=nt[7],Rt=nt[8],kt=nt[9],Ot=nt[10],Gt=nt[11],Nt=nt[12],zt=nt[13],qt=nt[14],$t=nt[15];return j[0].setComponents(ft-it,Dt-wt,Gt-Rt,$t-Nt).normalize(),j[1].setComponents(ft+it,Dt+wt,Gt+Rt,$t+Nt).normalize(),j[2].setComponents(ft+ot,Dt+bt,Gt+kt,$t+zt).normalize(),j[3].setComponents(ft-ot,Dt-bt,Gt-kt,$t-zt).normalize(),j[4].setComponents(ft-ht,Dt-St,Gt-Ot,$t-qt).normalize(),j[5].setComponents(ft+ht,Dt+St,Gt+Ot,$t+qt).normalize(),this}intersectsObject(a){if(a.boundingSphere!==void 0)a.boundingSphere===null&&a.computeBoundingSphere(),X_.copy(a.boundingSphere).applyMatrix4(a.matrixWorld);else{const j=a.geometry;j.boundingSphere===null&&j.computeBoundingSphere(),X_.copy(j.boundingSphere).applyMatrix4(a.matrixWorld)}return this.intersectsSphere(X_)}intersectsSprite(a){return X_.center.set(0,0,0),X_.radius=.7071067811865476,X_.applyMatrix4(a.matrixWorld),this.intersectsSphere(X_)}intersectsSphere(a){const j=this.planes,nt=a.center,it=-a.radius;for(let ot=0;ot<6;ot++)if(j[ot].distanceToPoint(nt)<it)return!1;return!0}intersectsBox(a){const j=this.planes;for(let nt=0;nt<6;nt++){const it=j[nt];if(Q1.x=it.normal.x>0?a.max.x:a.min.x,Q1.y=it.normal.y>0?a.max.y:a.min.y,Q1.z=it.normal.z>0?a.max.z:a.min.z,it.distanceToPoint(Q1)<0)return!1}return!0}containsPoint(a){const j=this.planes;for(let nt=0;nt<6;nt++)if(j[nt].distanceToPoint(a)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function VM(){let ut=null,a=!1,j=null,nt=null;function it(ot,ht){j(ot,ht),nt=ut.requestAnimationFrame(it)}return{start:function(){a!==!0&&j!==null&&(nt=ut.requestAnimationFrame(it),a=!0)},stop:function(){ut.cancelAnimationFrame(nt),a=!1},setAnimationLoop:function(ot){j=ot},setContext:function(ot){ut=ot}}}function u2(ut,a){const j=a.isWebGL2,nt=new WeakMap;return{get:function(it){return it.isInterleavedBufferAttribute&&(it=it.data),nt.get(it)},remove:function(it){it.isInterleavedBufferAttribute&&(it=it.data);const ot=nt.get(it);ot&&(ut.deleteBuffer(ot.buffer),nt.delete(it))},update:function(it,ot){if(it.isGLBufferAttribute){const ft=nt.get(it);return void((!ft||ft.version<it.version)&&nt.set(it,{buffer:it.buffer,type:it.type,bytesPerElement:it.elementSize,version:it.version}))}it.isInterleavedBufferAttribute&&(it=it.data);const ht=nt.get(it);ht===void 0?nt.set(it,function(ft,wt){const bt=ft.array,St=ft.usage,Dt=ut.createBuffer();let Rt;if(ut.bindBuffer(wt,Dt),ut.bufferData(wt,bt,St),ft.onUploadCallback(),bt instanceof Float32Array)Rt=ut.FLOAT;else if(bt instanceof Uint16Array)if(ft.isFloat16BufferAttribute){if(!j)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");Rt=ut.HALF_FLOAT}else Rt=ut.UNSIGNED_SHORT;else if(bt instanceof Int16Array)Rt=ut.SHORT;else if(bt instanceof Uint32Array)Rt=ut.UNSIGNED_INT;else if(bt instanceof Int32Array)Rt=ut.INT;else if(bt instanceof Int8Array)Rt=ut.BYTE;else if(bt instanceof Uint8Array)Rt=ut.UNSIGNED_BYTE;else{if(!(bt instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+bt);Rt=ut.UNSIGNED_BYTE}return{buffer:Dt,type:Rt,bytesPerElement:bt.BYTES_PER_ELEMENT,version:ft.version}}(it,ot)):ht.version<it.version&&(function(ft,wt,bt){const St=wt.array,Dt=wt.updateRange;ut.bindBuffer(bt,ft),Dt.count===-1?ut.bufferSubData(bt,0,St):(j?ut.bufferSubData(bt,Dt.offset*St.BYTES_PER_ELEMENT,St,Dt.offset,Dt.count):ut.bufferSubData(bt,Dt.offset*St.BYTES_PER_ELEMENT,St.subarray(Dt.offset,Dt.offset+Dt.count)),Dt.count=-1),wt.onUploadCallback()}(ht.buffer,it,ot),ht.version=it.version)}}}class nv extends Vt{constructor(a=1,j=1,nt=1,it=1){super(),this.type="PlaneGeometry",this.parameters={width:a,height:j,widthSegments:nt,heightSegments:it};const ot=a/2,ht=j/2,ft=Math.floor(nt),wt=Math.floor(it),bt=ft+1,St=wt+1,Dt=a/ft,Rt=j/wt,kt=[],Ot=[],Gt=[],Nt=[];for(let zt=0;zt<St;zt++){const qt=zt*Rt-ht;for(let $t=0;$t<bt;$t++){const En=$t*Dt-ot;Ot.push(En,-qt,0),Gt.push(0,0,1),Nt.push($t/ft),Nt.push(1-zt/wt)}}for(let zt=0;zt<wt;zt++)for(let qt=0;qt<ft;qt++){const $t=qt+bt*zt,En=qt+bt*(zt+1),gn=qt+1+bt*(zt+1),vn=qt+1+bt*zt;kt.push($t,En,vn),kt.push(En,gn,vn)}this.setIndex(kt),this.setAttribute("position",new fs(Ot,3)),this.setAttribute("normal",new fs(Gt,3)),this.setAttribute("uv",new fs(Nt,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new nv(a.width,a.height,a.widthSegments,a.heightSegments)}}const ao={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vAlphaMapUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
		#if defined( FIX_ENV_DIRECTION )
			vec3 worldNormal = normal;
		#else
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#endif
			worldNormal = transformDirection(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#if !defined( FIX_ENV_DIRECTION )
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			#endif
			reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#ifdef USE_NORMALMAP_TANGENTSPACE
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	#ifndef WebGL2Context
	#define textureLod texture2DLodEXT
	#define textureSize(s, lod) vec2(1024./pow(2.,float(lod)),1024./pow(2.,float(lod)))
	#define isinf(x) (x > 1e20 || x < -1e20)
	#endif
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		if(roughness == 0.0) return transmissionSamplerMapTexelToLinear( texture2D( transmissionSamplerMap, fragCoord.xy ) );
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return transmissionSamplerMapTexelToLinear( textureBicubic( transmissionSamplerMap, fragCoord.xy, lod ) );
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) || attenuationDistance == 0.0) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`#ifdef HAS_TEXTURE
varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
#endif
void main() {
#ifdef HAS_TEXTURE
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
#endif
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`#ifdef HAS_TEXTURE
uniform sampler2D t2D;
varying vec2 vUv;
#endif
uniform float backgroundIntensity;
uniform vec3 backgroundColor;
void main() {
#ifdef HAS_TEXTURE
	vec4 texColor = texture2D( t2D, vUv );
#else
	vec4 texColor = vec4( 1.0 );
#endif
	texColor.rgb *= backgroundColor * backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#include <envmap_common_pars_fragment>
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
void main() {
	vec3 vReflect = vWorldDirection;
	vReflect = transformDirection(vReflect, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vReflect, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	texColor.rgb *= envMapIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},ls={common:{diffuse:{value:new us(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new oo},alphaMap:{value:null},alphaMapTransform:{value:new oo},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new oo}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new oo}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new oo}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new oo},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new oo},normalScale:{value:new Br(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new oo},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new oo}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new oo}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new oo}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new us(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new us(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new oo}},sprite:{diffuse:{value:new us(16777215)},opacity:{value:1},center:{value:new Br(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new oo},alphaMap:{value:null},alphaTest:{value:0}}},lp={basic:{uniforms:Gp([ls.common,ls.specularmap,ls.envmap,ls.aomap,ls.lightmap,ls.fog]),vertexShader:ao.meshbasic_vert,fragmentShader:ao.meshbasic_frag},lambert:{uniforms:Gp([ls.common,ls.specularmap,ls.envmap,ls.aomap,ls.lightmap,ls.emissivemap,ls.bumpmap,ls.normalmap,ls.displacementmap,ls.fog,ls.lights,{emissive:{value:new us(0)}}]),vertexShader:ao.meshlambert_vert,fragmentShader:ao.meshlambert_frag},phong:{uniforms:Gp([ls.common,ls.specularmap,ls.envmap,ls.aomap,ls.lightmap,ls.emissivemap,ls.bumpmap,ls.normalmap,ls.displacementmap,ls.fog,ls.lights,{emissive:{value:new us(0)},specular:{value:new us(1118481)},shininess:{value:30}}]),vertexShader:ao.meshphong_vert,fragmentShader:ao.meshphong_frag},standard:{uniforms:Gp([ls.common,ls.envmap,ls.aomap,ls.lightmap,ls.emissivemap,ls.bumpmap,ls.normalmap,ls.displacementmap,ls.roughnessmap,ls.metalnessmap,ls.fog,ls.lights,{emissive:{value:new us(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ao.meshphysical_vert,fragmentShader:ao.meshphysical_frag},toon:{uniforms:Gp([ls.common,ls.aomap,ls.lightmap,ls.emissivemap,ls.bumpmap,ls.normalmap,ls.displacementmap,ls.gradientmap,ls.fog,ls.lights,{emissive:{value:new us(0)}}]),vertexShader:ao.meshtoon_vert,fragmentShader:ao.meshtoon_frag},matcap:{uniforms:Gp([ls.common,ls.bumpmap,ls.normalmap,ls.displacementmap,ls.fog,{matcap:{value:null}}]),vertexShader:ao.meshmatcap_vert,fragmentShader:ao.meshmatcap_frag},points:{uniforms:Gp([ls.points,ls.fog]),vertexShader:ao.points_vert,fragmentShader:ao.points_frag},dashed:{uniforms:Gp([ls.common,ls.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ao.linedashed_vert,fragmentShader:ao.linedashed_frag},depth:{uniforms:Gp([ls.common,ls.displacementmap]),vertexShader:ao.depth_vert,fragmentShader:ao.depth_frag},normal:{uniforms:Gp([ls.common,ls.bumpmap,ls.normalmap,ls.displacementmap,{opacity:{value:1}}]),vertexShader:ao.meshnormal_vert,fragmentShader:ao.meshnormal_frag},sprite:{uniforms:Gp([ls.sprite,ls.fog]),vertexShader:ao.sprite_vert,fragmentShader:ao.sprite_frag},background:{uniforms:{uvTransform:{value:new oo},t2D:{value:null},backgroundIntensity:{value:1},backgroundColor:{value:new us(16777215)},flipX:{value:!1},flipY:{value:!1}},vertexShader:ao.background_vert,fragmentShader:ao.background_frag},backgroundCube:{uniforms:{envMap:{value:null},envMapRotation:{value:0},envMapIntensity:{value:1},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ao.backgroundCube_vert,fragmentShader:ao.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ao.cube_vert,fragmentShader:ao.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ao.equirect_vert,fragmentShader:ao.equirect_frag},distanceRGBA:{uniforms:Gp([ls.common,ls.displacementmap,{referencePosition:{value:new Rn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ao.distanceRGBA_vert,fragmentShader:ao.distanceRGBA_frag},shadow:{uniforms:Gp([ls.lights,ls.fog,{color:{value:new us(0)},opacity:{value:1}}]),vertexShader:ao.shadow_vert,fragmentShader:ao.shadow_frag}};lp.physical={uniforms:Gp([lp.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new oo},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new oo},clearcoatNormalScale:{value:new Br(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new oo},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new oo},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new oo},sheen:{value:0},sheenColor:{value:new us(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new oo},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new oo},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new oo},transmissionSamplerSize:{value:new Br},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new oo},attenuationDistance:{value:0},attenuationColor:{value:new us(0)},specularColor:{value:new us(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new oo},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new oo}}]),vertexShader:ao.meshphysical_vert,fragmentShader:ao.meshphysical_frag};const zS={r:0,b:0,g:0};function qD(ut,a,j,nt,it,ot,ht){const ft=new us(0);let wt,bt,St=ot===!0?0:1,Dt=null,Rt=0,kt=null;function Ot(Gt,Nt){Gt.getRGB(zS,H1(ut)),nt.buffers.color.setClear(zS.r,zS.g,zS.b,Nt,ht)}return{getClearColor:function(){return ft},setClearColor:function(Gt,Nt=1){ft.set(Gt),St=Nt,Ot(ft,St)},getClearAlpha:function(){return St},setClearAlpha:function(Gt){St=Gt,Ot(ft,St)},getPlaneMesh:function(){return wt},getBoxMesh:function(){return bt},getBoxMesh2:function(){return bt===void 0&&(bt=new Ou(new kv(1,1,1),new p_({name:"BackgroundCubeMaterial",uniforms:Ny(lp.backgroundCube.uniforms),vertexShader:lp.backgroundCube.vertexShader,fragmentShader:lp.backgroundCube.fragmentShader,side:nn,depthTest:!1,depthWrite:!1,fog:!1})),bt.geometry.deleteAttribute("normal"),bt.geometry.deleteAttribute("uv"),bt.onBeforeRender=function(Gt,Nt,zt){this.matrixWorld.copyPosition(zt.matrixWorld)},Object.defineProperty(bt.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),it.update(bt)),bt},render:function(Gt,Nt){let zt=!1,qt=Nt.isScene===!0?Nt.background:null;const $t=Nt.isScene&&Nt.backgroundColor!==void 0?Nt.backgroundColor:null;switch(qt==="environment"&&(qt=Nt.environment),qt&&qt.isTexture&&(qt=(Nt.backgroundBlurriness>0?j:a).get(qt)),qt===null?Ot(ft,St):qt&&qt.isColor&&(Ot(qt,1),zt=!0),ut.xr.getEnvironmentBlendMode()){case"opaque":zt=!0;break;case"additive":nt.buffers.color.setClear(0,0,0,1,ht),zt=!0;break;case"alpha-blend":nt.buffers.color.setClear(0,0,0,0,ht),zt=!0}if((ut.autoClear||zt)&&ut.clear(ut.autoClearColor,ut.autoClearDepth,ut.autoClearStencil),qt&&(qt.isCubeTexture||qt.mapping===Np))bt===void 0&&(bt=new Ou(new kv(1,1,1),new p_({name:"BackgroundCubeMaterial",uniforms:Ny(lp.backgroundCube.uniforms),vertexShader:lp.backgroundCube.vertexShader,fragmentShader:lp.backgroundCube.fragmentShader,side:nn,depthTest:!1,depthWrite:!1,fog:!1})),bt.geometry.deleteAttribute("normal"),bt.geometry.deleteAttribute("uv"),bt.onBeforeRender=function(En,gn,vn){this.matrixWorld.copyPosition(vn.matrixWorld)},Object.defineProperty(bt.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),it.update(bt)),bt.material.uniforms.envMap.value=qt,bt.material.uniforms.envMapRotation.value=qt&&qt.rotation||0,bt.material.uniforms.envMapIntensity.value=qt===Nt.environment&&Nt.envMapIntensity||1,bt.material.uniforms.flipEnvMap.value=qt.isCubeTexture&&qt.isRenderTargetTexture===!1?-1:1,bt.material.uniforms.backgroundBlurriness.value=Nt.backgroundBlurriness,bt.material.uniforms.backgroundIntensity.value=Nt.backgroundIntensity,bt.material.toneMapped=qt.colorSpace!==Bs,Dt===qt&&Rt===qt.version&&kt===ut.toneMapping||(bt.material.needsUpdate=!0,Dt=qt,Rt=qt.version,kt=ut.toneMapping),bt.layers.enableAll(),Gt.unshift(bt,bt.geometry,bt.material,0,0,null);else if(qt&&qt.isTexture||!qt&&$t){wt===void 0&&(wt=new Ou(new nv(2,2),new p_({name:"BackgroundMaterial",uniforms:Ny(lp.background.uniforms),vertexShader:lp.background.vertexShader,fragmentShader:lp.background.fragmentShader,side:Pn,depthTest:!1,depthWrite:!1,fog:!1})),wt.geometry.deleteAttribute("normal"),Object.defineProperty(wt.material,"map",{get:function(){return this.uniforms.t2D.value}}),it.update(wt)),wt.material.uniforms.backgroundColor.value.set($t||16777215),wt.material.uniforms.t2D.value=qt,wt.material.uniforms.backgroundIntensity.value=Nt.backgroundIntensity,qt?(wt.material.toneMapped=qt.colorSpace!==Bs,wt.material.uniforms.flipX.value=qt.userData.flipX||!1,wt.material.uniforms.flipY.value=qt.userData.flipY||!1,qt.matrixAutoUpdate===!0&&qt.updateMatrix(),wt.material.uniforms.uvTransform.value.copy(qt.matrix),wt.material.defines.HAS_TEXTURE="1"):wt.material.defines.HAS_TEXTURE&&delete wt.material.defines.HAS_TEXTURE;const En=qt?qt.version:-1;Dt===qt&&Rt===En&&kt===ut.toneMapping||(wt.material.needsUpdate=!0,Dt=qt,Rt=En,kt=ut.toneMapping),wt.layers.enableAll(),Gt.unshift(wt,wt.geometry,wt.material,0,0,null)}}}}function XD(ut,a,j,nt){const it=ut.getParameter(ut.MAX_VERTEX_ATTRIBS),ot=nt.isWebGL2?null:a.get("OES_vertex_array_object"),ht=nt.isWebGL2||ot!==null,ft={},wt=kt(null);let bt=wt,St=!1;function Dt(gn){return nt.isWebGL2?ut.bindVertexArray(gn):ot.bindVertexArrayOES(gn)}function Rt(gn){return nt.isWebGL2?ut.deleteVertexArray(gn):ot.deleteVertexArrayOES(gn)}function kt(gn){const vn=[],Un=[],$n=[];for(let jn=0;jn<it;jn++)vn[jn]=0,Un[jn]=0,$n[jn]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:vn,enabledAttributes:Un,attributeDivisors:$n,object:gn,attributes:{},index:null}}function Ot(){const gn=bt.newAttributes;for(let vn=0,Un=gn.length;vn<Un;vn++)gn[vn]=0}function Gt(gn){Nt(gn,0)}function Nt(gn,vn){const Un=bt.newAttributes,$n=bt.enabledAttributes,jn=bt.attributeDivisors;Un[gn]=1,$n[gn]===0&&(ut.enableVertexAttribArray(gn),$n[gn]=1),jn[gn]!==vn&&((nt.isWebGL2?ut:a.get("ANGLE_instanced_arrays"))[nt.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](gn,vn),jn[gn]=vn)}function zt(){const gn=bt.newAttributes,vn=bt.enabledAttributes;for(let Un=0,$n=vn.length;Un<$n;Un++)vn[Un]!==gn[Un]&&(ut.disableVertexAttribArray(Un),vn[Un]=0)}function qt(gn,vn,Un,$n,jn,sr){nt.isWebGL2!==!0||Un!==ut.INT&&Un!==ut.UNSIGNED_INT?ut.vertexAttribPointer(gn,vn,Un,$n,jn,sr):ut.vertexAttribIPointer(gn,vn,Un,jn,sr)}function $t(){En(),St=!0,bt!==wt&&(bt=wt,Dt(bt.object))}function En(){wt.geometry=null,wt.program=null,wt.wireframe=!1}return{setup:function(gn,vn,Un,$n,jn){let sr=!1;if(ht){const Vn=function(_r,xr,Gr){const ns=Gr.wireframe===!0;let Vr=ft[_r.id];Vr===void 0&&(Vr={},ft[_r.id]=Vr);let Tr=Vr[xr.id];Tr===void 0&&(Tr={},Vr[xr.id]=Tr);let Yr=Tr[ns];return Yr===void 0&&(Yr=kt(nt.isWebGL2?ut.createVertexArray():ot.createVertexArrayOES()),Tr[ns]=Yr),Yr}($n,Un,vn);bt!==Vn&&(bt=Vn,Dt(bt.object)),sr=function(_r,xr,Gr,ns){const Vr=bt.attributes,Tr=xr.attributes;let Yr=0;const ts=Gr.getAttributes();for(const mr in ts)if(ts[mr].location>=0){const Dr=Vr[mr];let $r=Tr[mr];if($r===void 0&&(mr==="instanceMatrix"&&_r.instanceMatrix&&($r=_r.instanceMatrix),mr==="instanceColor"&&_r.instanceColor&&($r=_r.instanceColor)),Dr===void 0||Dr.attribute!==$r||$r&&Dr.data!==$r.data)return!0;Yr++}return bt.attributesNum!==Yr||bt.index!==ns}(gn,$n,Un,jn),sr&&function(_r,xr,Gr,ns){const Vr={},Tr=xr.attributes;let Yr=0;const ts=Gr.getAttributes();for(const mr in ts)if(ts[mr].location>=0){let Dr=Tr[mr];Dr===void 0&&(mr==="instanceMatrix"&&_r.instanceMatrix&&(Dr=_r.instanceMatrix),mr==="instanceColor"&&_r.instanceColor&&(Dr=_r.instanceColor));const $r={};$r.attribute=Dr,Dr&&Dr.data&&($r.data=Dr.data),Vr[mr]=$r,Yr++}bt.attributes=Vr,bt.attributesNum=Yr,bt.index=ns}(gn,$n,Un,jn)}else{const Vn=vn.wireframe===!0;bt.geometry===$n.id&&bt.program===Un.id&&bt.wireframe===Vn||(bt.geometry=$n.id,bt.program=Un.id,bt.wireframe=Vn,sr=!0)}jn!==null&&j.update(jn,ut.ELEMENT_ARRAY_BUFFER),(sr||St)&&(St=!1,function(Vn,_r,xr,Gr){if(nt.isWebGL2===!1&&(Vn.isInstancedMesh||Gr.isInstancedBufferGeometry)&&a.get("ANGLE_instanced_arrays")===null)return;Ot();const ns=Gr.attributes,Vr=xr.getAttributes(),Tr=_r.defaultAttributeValues;for(const Yr in Vr){const ts=Vr[Yr];if(ts.location>=0){let mr=ns[Yr];if(mr===void 0&&(Yr==="instanceMatrix"&&Vn.instanceMatrix&&(mr=Vn.instanceMatrix),Yr==="instanceColor"&&Vn.instanceColor&&(mr=Vn.instanceColor)),mr!==void 0){const Dr=mr.normalized,$r=mr.itemSize,Ur=j.get(mr);if(Ur===void 0)continue;const ss=Ur.buffer,Hs=Ur.type,Fn=Ur.bytesPerElement;if(mr.isInterleavedBufferAttribute){const Sn=mr.data,lr=Sn.stride,Yn=mr.offset;if(Sn.isInstancedInterleavedBuffer){for(let On=0;On<ts.locationSize;On++)Nt(ts.location+On,Sn.meshPerAttribute);Vn.isInstancedMesh!==!0&&Gr._maxInstanceCount===void 0&&(Gr._maxInstanceCount=Sn.meshPerAttribute*Sn.count)}else for(let On=0;On<ts.locationSize;On++)Gt(ts.location+On);ut.bindBuffer(ut.ARRAY_BUFFER,ss);for(let On=0;On<ts.locationSize;On++)qt(ts.location+On,$r/ts.locationSize,Hs,Dr,lr*Fn,(Yn+$r/ts.locationSize*On)*Fn)}else{if(mr.isInstancedBufferAttribute){for(let Sn=0;Sn<ts.locationSize;Sn++)Nt(ts.location+Sn,mr.meshPerAttribute);Vn.isInstancedMesh!==!0&&Gr._maxInstanceCount===void 0&&(Gr._maxInstanceCount=mr.meshPerAttribute*mr.count)}else for(let Sn=0;Sn<ts.locationSize;Sn++)Gt(ts.location+Sn);ut.bindBuffer(ut.ARRAY_BUFFER,ss);for(let Sn=0;Sn<ts.locationSize;Sn++)qt(ts.location+Sn,$r/ts.locationSize,Hs,Dr,$r*Fn,$r/ts.locationSize*Sn*Fn)}}else if(Tr!==void 0){const Dr=Tr[Yr];if(Dr!==void 0)switch(Dr.length){case 2:ut.vertexAttrib2fv(ts.location,Dr);break;case 3:ut.vertexAttrib3fv(ts.location,Dr);break;case 4:ut.vertexAttrib4fv(ts.location,Dr);break;default:ut.vertexAttrib1fv(ts.location,Dr)}}}}zt()}(gn,vn,Un,$n),jn!==null&&ut.bindBuffer(ut.ELEMENT_ARRAY_BUFFER,j.get(jn).buffer))},reset:$t,resetDefaultState:En,dispose:function(){$t();for(const gn in ft){const vn=ft[gn];for(const Un in vn){const $n=vn[Un];for(const jn in $n)Rt($n[jn].object),delete $n[jn];delete vn[Un]}delete ft[gn]}},releaseStatesOfGeometry:function(gn){if(ft[gn.id]===void 0)return;const vn=ft[gn.id];for(const Un in vn){const $n=vn[Un];for(const jn in $n)Rt($n[jn].object),delete $n[jn];delete vn[Un]}delete ft[gn.id]},releaseStatesOfProgram:function(gn){for(const vn in ft){const Un=ft[vn];if(Un[gn.id]===void 0)continue;const $n=Un[gn.id];for(const jn in $n)Rt($n[jn].object),delete $n[jn];delete Un[gn.id]}},initAttributes:Ot,enableAttribute:Gt,disableUnusedAttributes:zt}}function YD(ut,a,j,nt){const it=nt.isWebGL2;let ot;this.setMode=function(ht){ot=ht},this.render=function(ht,ft){ut.drawArrays(ot,ht,ft),j.update(ft,ot,1)},this.renderInstances=function(ht,ft,wt){if(wt===0)return;let bt,St;if(it)bt=ut,St="drawArraysInstanced";else if(bt=a.get("ANGLE_instanced_arrays"),St="drawArraysInstancedANGLE",bt===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");bt[St](ot,ht,ft,wt),j.update(ft,ot,wt)}}function GM(ut,a,j){let nt;function it(En){if(En==="highp"){if(ut.getShaderPrecisionFormat(ut.VERTEX_SHADER,ut.HIGH_FLOAT).precision>0&&ut.getShaderPrecisionFormat(ut.FRAGMENT_SHADER,ut.HIGH_FLOAT).precision>0)return"highp";En="mediump"}return En==="mediump"&&ut.getShaderPrecisionFormat(ut.VERTEX_SHADER,ut.MEDIUM_FLOAT).precision>0&&ut.getShaderPrecisionFormat(ut.FRAGMENT_SHADER,ut.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const ot=typeof WebGL2RenderingContext<"u"&&ut.constructor.name==="WebGL2RenderingContext";let ht=j.precision!==void 0?j.precision:"highp";const ft=it(ht);ft!==ht&&(console.warn("THREE.WebGLRenderer:",ht,"not supported, using",ft,"instead."),ht=ft);const wt=ot||a.has("WEBGL_draw_buffers"),bt=j.logarithmicDepthBuffer===!0,St=ut.getParameter(ut.MAX_TEXTURE_IMAGE_UNITS),Dt=ut.getParameter(ut.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Rt=ut.getParameter(ut.MAX_TEXTURE_SIZE),kt=ut.getParameter(ut.MAX_CUBE_MAP_TEXTURE_SIZE),Ot=ut.getParameter(ut.MAX_VERTEX_ATTRIBS),Gt=ut.getParameter(ut.MAX_VERTEX_UNIFORM_VECTORS),Nt=ut.getParameter(ut.MAX_VARYING_VECTORS),zt=ut.getParameter(ut.MAX_FRAGMENT_UNIFORM_VECTORS),qt=Dt>0,$t=ot||a.has("OES_texture_float");return{isWebGL2:ot,drawBuffers:wt,getMaxAnisotropy:function(){if(nt!==void 0)return nt;if(a.has("EXT_texture_filter_anisotropic")===!0){const En=a.get("EXT_texture_filter_anisotropic");nt=ut.getParameter(En.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else nt=0;return nt},getMaxPrecision:it,precision:ht,logarithmicDepthBuffer:bt,maxTextures:St,maxVertexTextures:Dt,maxTextureSize:Rt,maxCubemapSize:kt,maxAttributes:Ot,maxVertexUniforms:Gt,maxVaryings:Nt,maxFragmentUniforms:zt,vertexTextures:qt,floatFragmentTextures:$t,floatVertexTextures:qt&&$t,maxSamples:ot?ut.getParameter(ut.MAX_SAMPLES):0}}function h2(ut){const a=this;let j=null,nt=0,it=!1,ot=!1;const ht=new Mp,ft=new oo,wt={value:null,needsUpdate:!1};function bt(St,Dt,Rt,kt){const Ot=St!==null?St.length:0;let Gt=null;if(Ot!==0){if(Gt=wt.value,kt!==!0||Gt===null){const Nt=Rt+4*Ot,zt=Dt.matrixWorldInverse;ft.getNormalMatrix(zt),(Gt===null||Gt.length<Nt)&&(Gt=new Float32Array(Nt));for(let qt=0,$t=Rt;qt!==Ot;++qt,$t+=4)ht.copy(St[qt]).applyMatrix4(zt,ft),ht.normal.toArray(Gt,$t),Gt[$t+3]=ht.constant}wt.value=Gt,wt.needsUpdate=!0}return a.numPlanes=Ot,a.numIntersection=0,Gt}this.uniform=wt,this.numPlanes=0,this.numIntersection=0,this.init=function(St,Dt){const Rt=St.length!==0||Dt||nt!==0||it;return it=Dt,nt=St.length,Rt},this.beginShadows=function(){ot=!0,bt(null)},this.endShadows=function(){ot=!1},this.setGlobalState=function(St,Dt){j=bt(St,Dt,0)},this.setState=function(St,Dt,Rt){const kt=St.clippingPlanes,Ot=St.clipIntersection,Gt=St.clipShadows,Nt=ut.get(St);if(!it||kt===null||kt.length===0||ot&&!Gt)ot?bt(null):(wt.value!==j&&(wt.value=j,wt.needsUpdate=nt>0),a.numPlanes=nt,a.numIntersection=0);else{const zt=ot?0:nt,qt=4*zt;let $t=Nt.clippingState||null;wt.value=$t,$t=bt(kt,Dt,qt,Rt);for(let En=0;En!==qt;++En)$t[En]=j[En];Nt.clippingState=$t,this.numIntersection=Ot?this.numPlanes:0,this.numPlanes+=zt}}}function KD(ut){let a=new WeakMap;function j(it,ot){return ot===Ll?it.mapping=Ql:ot===_l&&(it.mapping=Ml),it}function nt(it){const ot=it.target;ot.removeEventListener("dispose",nt);const ht=a.get(ot);ht!==void 0&&(a.delete(ot),ht.dispose())}return{get:function(it){if(it&&it.isTexture&&it.isRenderTargetTexture===!1){const ot=it.mapping;if(ot===Ll||ot===_l){if(a.has(it)){const ht=a.get(it).texture;return ht.rotation=it.rotation,j(ht,it.mapping)}{const ht=it.image;if(ht&&ht.height>0){const ft=new zM(ht.height/2);return ft.fromEquirectangularTexture(ut,it),ft.texture.rotation=it.rotation,a.set(it,ft),it.addEventListener("dispose",nt),j(ft.texture,it.mapping)}return null}}}return it},dispose:function(){a=new WeakMap}}}class VS extends FS{constructor(a=-1,j=1,nt=1,it=-1,ot=.1,ht=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=a,this.right=j,this.top=nt,this.bottom=it,this.near=ot,this.far=ht,this.updateProjectionMatrix()}copy(a,j){return super.copy(a,j),this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this.near=a.near,this.far=a.far,this.zoom=a.zoom,this.view=a.view===null?null:Object.assign({},a.view),this}setViewOffset(a,j,nt,it,ot,ht){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=j,this.view.offsetX=nt,this.view.offsetY=it,this.view.width=ot,this.view.height=ht,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const a=(this.right-this.left)/(2*this.zoom),j=(this.top-this.bottom)/(2*this.zoom),nt=(this.right+this.left)/2,it=(this.top+this.bottom)/2;let ot=nt-a,ht=nt+a,ft=it+j,wt=it-j;if(this.view!==null&&this.view.enabled){const bt=(this.right-this.left)/this.view.fullWidth/this.zoom,St=(this.top-this.bottom)/this.view.fullHeight/this.zoom;ot+=bt*this.view.offsetX,ht=ot+bt*this.view.width,ft-=St*this.view.offsetY,wt=ft-St*this.view.height}this.projectionMatrix.makeOrthographic(ot,ht,ft,wt,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){const j=super.toJSON(a);return j.object.zoom=this.zoom,j.object.left=this.left,j.object.right=this.right,j.object.top=this.top,j.object.bottom=this.bottom,j.object.near=this.near,j.object.far=this.far,this.view!==null&&(j.object.view=Object.assign({},this.view)),j}}const d2=[.125,.215,.35,.446,.526,.582],q1=20,$A=new VS,GS=new us;let HS=null;const B0=(1+Math.sqrt(5))/2,ZA=1/B0,HM=[new Rn(1,1,1),new Rn(-1,1,1),new Rn(1,1,-1),new Rn(-1,1,-1),new Rn(0,B0,ZA),new Rn(0,B0,-ZA),new Rn(ZA,0,B0),new Rn(-ZA,0,B0),new Rn(B0,ZA,0),new Rn(-B0,ZA,0)];class Lr{constructor(a){this._renderer=a,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(a,j=0,nt=.1,it=100){HS=this._renderer.getRenderTarget(),this._setSize(256);const ot=this._allocateTargets();return ot.depthBuffer=!0,this._sceneToCubeUV(a,nt,it,ot),j>0&&this._blur(ot,0,0,j),this._applyPMREM(ot),this._cleanup(ot),ot}fromEquirectangular(a,j=null){return this._fromTexture(a,j)}fromCubemap(a,j=null){return this._fromTexture(a,j)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_b(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=QS(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(a){this._lodMax=Math.floor(Math.log2(a)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let a=0;a<this._lodPlanes.length;a++)this._lodPlanes[a].dispose()}_cleanup(a){this._renderer.setRenderTarget(HS),a.scissorTest=!1,Y_(a,0,0,a.width,a.height)}_fromTexture(a,j){a.mapping===Ql||a.mapping===Ml?this._setSize(a.image.length===0?16:a.image[0].width||a.image[0].image.width):this._setSize(a.image.width/4),HS=this._renderer.getRenderTarget();const nt=j||this._allocateTargets();return this._textureToCubeUV(a,nt),this._applyPMREM(nt),this._cleanup(nt),nt}_allocateTargets(){const a=3*Math.max(this._cubeSize,112),j=4*this._cubeSize,nt={magFilter:Il,minFilter:Il,generateMipmaps:!1,type:Zp,format:Hu,colorSpace:io,depthBuffer:!1},it=QM(a,j,nt);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==a||this._pingPongRenderTarget.height!==j){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=QM(a,j,nt);const{_lodMax:ot}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(ht){const ft=[],wt=[],bt=[];let St=ht;const Dt=ht-4+1+d2.length;for(let Rt=0;Rt<Dt;Rt++){const kt=Math.pow(2,St);wt.push(kt);let Ot=1/kt;Rt>ht-4?Ot=d2[Rt-ht+4-1]:Rt===0&&(Ot=0),bt.push(Ot);const Gt=1/(kt-2),Nt=-Gt,zt=1+Gt,qt=[Nt,Nt,zt,Nt,zt,zt,Nt,Nt,zt,zt,Nt,zt],$t=6,En=6,gn=3,vn=2,Un=1,$n=new Float32Array(gn*En*$t),jn=new Float32Array(vn*En*$t),sr=new Float32Array(Un*En*$t);for(let _r=0;_r<$t;_r++){const xr=_r%3*2/3-1,Gr=_r>2?0:-1,ns=[xr,Gr,0,xr+2/3,Gr,0,xr+2/3,Gr+1,0,xr,Gr,0,xr+2/3,Gr+1,0,xr,Gr+1,0];$n.set(ns,gn*En*_r),jn.set(qt,vn*En*_r);const Vr=[_r,_r,_r,_r,_r,_r];sr.set(Vr,Un*En*_r)}const Vn=new Vt;Vn.setAttribute("position",new Jo($n,gn)),Vn.setAttribute("uv",new Jo(jn,vn)),Vn.setAttribute("faceIndex",new Jo(sr,Un)),ft.push(Vn),St>4&&St--}return{lodPlanes:ft,sizeLods:wt,sigmas:bt}}(ot)),this._blurMaterial=function(ht,ft,wt){const bt=new Float32Array(q1),St=new Rn(0,1,0);return new p_({name:"SphericalGaussianBlur",defines:{n:q1,CUBEUV_TEXEL_WIDTH:1/ft,CUBEUV_TEXEL_HEIGHT:1/wt,CUBEUV_MAX_MIP:`${ht}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:bt},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:St}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Xt,depthTest:!1,depthWrite:!1})}(ot,a,j)}return it}_compileMaterial(a){const j=new Ou(this._lodPlanes[0],a);this._renderer.compile(j,$A)}_sceneToCubeUV(a,j,nt,it){const ot=new Cp(90,1,j,nt),ht=[1,-1,1,1,1,1],ft=[1,1,1,-1,-1,-1],wt=this._renderer,bt=wt.autoClear,St=wt.toneMapping;wt.getClearColor(GS),wt.toneMapping=Mo,wt.autoClear=!1;const Dt=new Bm({name:"PMREM.Background",side:nn,depthWrite:!1,depthTest:!1}),Rt=new Ou(new kv,Dt);let kt=!1;const Ot=a.background;Ot?Ot.isColor&&(Dt.color.copy(Ot),a.background=null,kt=!0):(Dt.color.copy(GS),kt=!0);for(let Gt=0;Gt<6;Gt++){const Nt=Gt%3;Nt===0?(ot.up.set(0,ht[Gt],0),ot.lookAt(ft[Gt],0,0)):Nt===1?(ot.up.set(0,0,ht[Gt]),ot.lookAt(0,ft[Gt],0)):(ot.up.set(0,ht[Gt],0),ot.lookAt(0,0,ft[Gt]));const zt=this._cubeSize;Y_(it,Nt*zt,Gt>2?zt:0,zt,zt),wt.setRenderTarget(it),kt&&wt.render(Rt,ot),wt.render(a,ot)}Rt.geometry.dispose(),Rt.material.dispose(),wt.toneMapping=St,wt.autoClear=bt,a.background=Ot}_textureToCubeUV(a,j){const nt=this._renderer,it=a.mapping===Ql||a.mapping===Ml;it?(this._cubemapMaterial===null&&(this._cubemapMaterial=_b()),this._cubemapMaterial.uniforms.flipEnvMap.value=a.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=QS());const ot=it?this._cubemapMaterial:this._equirectMaterial,ht=new Ou(this._lodPlanes[0],ot);ot.uniforms.envMap.value=a;const ft=this._cubeSize;Y_(j,0,0,3*ft,2*ft),nt.setRenderTarget(j),nt.render(ht,$A)}_applyPMREM(a){const j=this._renderer,nt=j.autoClear;j.autoClear=!1;for(let it=1;it<this._lodPlanes.length;it++){const ot=Math.sqrt(this._sigmas[it]*this._sigmas[it]-this._sigmas[it-1]*this._sigmas[it-1]),ht=HM[(it-1)%HM.length];this._blur(a,it-1,it,ot,ht)}j.autoClear=nt}_blur(a,j,nt,it,ot){const ht=this._pingPongRenderTarget;this._halfBlur(a,ht,j,nt,it,"latitudinal",ot),this._halfBlur(ht,a,nt,nt,it,"longitudinal",ot)}_halfBlur(a,j,nt,it,ot,ht,ft){const wt=this._renderer,bt=this._blurMaterial;ht!=="latitudinal"&&ht!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const St=new Ou(this._lodPlanes[it],bt),Dt=bt.uniforms,Rt=this._sizeLods[nt]-1,kt=isFinite(ot)?Math.PI/(2*Rt):2*Math.PI/39,Ot=ot/kt,Gt=isFinite(ot)?1+Math.floor(3*Ot):q1;Gt>q1&&console.warn(`sigmaRadians, ${ot}, is too large and will clip, as it requested ${Gt} samples when the maximum is set to 20`);const Nt=[];let zt=0;for(let En=0;En<q1;++En){const gn=En/Ot,vn=Math.exp(-gn*gn/2);Nt.push(vn),En===0?zt+=vn:En<Gt&&(zt+=2*vn)}for(let En=0;En<Nt.length;En++)Nt[En]=Nt[En]/zt;Dt.envMap.value=a.texture,Dt.samples.value=Gt,Dt.weights.value=Nt,Dt.latitudinal.value=ht==="latitudinal",ft&&(Dt.poleAxis.value=ft);const{_lodMax:qt}=this;Dt.dTheta.value=kt,Dt.mipInt.value=qt-nt;const $t=this._sizeLods[it];Y_(j,3*$t*(it>qt-4?it-qt+4:0),4*(this._cubeSize-$t),3*$t,2*$t),wt.setRenderTarget(j),wt.render(St,$A)}}function QM(ut,a,j){const nt=new xu(ut,a,j);return nt.texture.mapping=Np,nt.texture.name="PMREM.cubeUv",nt.scissorTest=!0,nt}function Y_(ut,a,j,nt,it){ut.viewport.set(a,j,nt,it),ut.scissor.set(a,j,nt,it)}function QS(){return new p_({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Xt,depthTest:!1,depthWrite:!1})}function _b(){return new p_({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Xt,depthTest:!1,depthWrite:!1})}function iv(ut){let a=new WeakMap,j=null;function nt(it){const ot=it.target;ot.removeEventListener("dispose",nt);const ht=a.get(ot);ht!==void 0&&(a.delete(ot),ht.dispose())}return{get:function(it){if(it&&it.isTexture){const ot=it.mapping,ht=ot===Ll||ot===_l,ft=ot===Ql||ot===Ml;if(ht||ft){if(it.isRenderTargetTexture&&it.needsPMREMUpdate===!0){it.needsPMREMUpdate=!1;let wt=a.get(it);return j===null&&(j=new Lr(ut)),wt=ht?j.fromEquirectangular(it,wt):j.fromCubemap(it,wt),a.set(it,wt),wt.texture}if(a.has(it))return a.get(it).texture;{const wt=it.image;if(ht&&wt&&wt.height>0||ft&&wt&&function(bt){let St=0;for(let Dt=0;Dt<6;Dt++)bt[Dt]!==void 0&&St++;return St===6}(wt)){j===null&&(j=new Lr(ut));const bt=ht?j.fromEquirectangular(it):j.fromCubemap(it);return a.set(it,bt),it.addEventListener("dispose",nt),bt.texture}return null}}}return it},dispose:function(){a=new WeakMap,j!==null&&(j.dispose(),j=null)}}}function WS(ut){const a={};function j(nt){if(a[nt]!==void 0)return a[nt];let it;switch(nt){case"WEBGL_depth_texture":it=ut.getExtension("WEBGL_depth_texture")||ut.getExtension("MOZ_WEBGL_depth_texture")||ut.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":it=ut.getExtension("EXT_texture_filter_anisotropic")||ut.getExtension("MOZ_EXT_texture_filter_anisotropic")||ut.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":it=ut.getExtension("WEBGL_compressed_texture_s3tc")||ut.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||ut.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":it=ut.getExtension("WEBGL_compressed_texture_pvrtc")||ut.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:it=ut.getExtension(nt)}return a[nt]=it,it}return{has:function(nt){return j(nt)!==null},init:function(nt){nt.isWebGL2?j("EXT_color_buffer_float"):(j("WEBGL_depth_texture"),j("OES_texture_float"),j("OES_texture_half_float"),j("OES_texture_half_float_linear"),j("OES_standard_derivatives"),j("OES_element_index_uint"),j("OES_vertex_array_object"),j("ANGLE_instanced_arrays")),j("OES_texture_float_linear"),j("EXT_color_buffer_half_float"),j("WEBGL_multisampled_render_to_texture")},get:function(nt){const it=j(nt);return it===null&&console.warn("THREE.WebGLRenderer: "+nt+" extension not supported."),it}}}function JD(ut,a,j,nt){const it={},ot=new WeakMap;function ht(wt){const bt=wt.target;bt.index!==null&&a.remove(bt.index);for(const Dt in bt.attributes)a.remove(bt.attributes[Dt]);bt.removeEventListener("dispose",ht),delete it[bt.id];const St=ot.get(bt);St&&(a.remove(St),ot.delete(bt)),nt.releaseStatesOfGeometry(bt),bt.isInstancedBufferGeometry===!0&&delete bt._maxInstanceCount,j.memory.geometries--}function ft(wt){const bt=[],St=wt.index,Dt=wt.attributes.position;let Rt=0;if(St!==null){const Gt=St.array;Rt=St.version;for(let Nt=0,zt=Gt.length;Nt<zt;Nt+=3){const qt=Gt[Nt+0],$t=Gt[Nt+1],En=Gt[Nt+2];bt.push(qt,$t,$t,En,En,qt)}}else{const Gt=Dt.array;Rt=Dt.version;for(let Nt=0,zt=Gt.length/3-1;Nt<zt;Nt+=3){const qt=Nt+0,$t=Nt+1,En=Nt+2;bt.push(qt,$t,$t,En,En,qt)}}const kt=new(kS(bt)?Yu:Ep)(bt,1);kt.version=Rt;const Ot=ot.get(wt);Ot&&a.remove(Ot),ot.set(wt,kt)}return{get:function(wt,bt){return it[bt.id]===!0||(bt.addEventListener("dispose",ht),it[bt.id]=!0,j.memory.geometries++),bt},update:function(wt){const bt=wt.attributes;for(const Dt in bt)a.update(bt[Dt],ut.ARRAY_BUFFER);const St=wt.morphAttributes;for(const Dt in St){const Rt=St[Dt];for(let kt=0,Ot=Rt.length;kt<Ot;kt++)a.update(Rt[kt],ut.ARRAY_BUFFER)}},getWireframeAttribute:function(wt){const bt=ot.get(wt);if(bt){const St=wt.index;St!==null&&bt.version<St.version&&ft(wt)}else ft(wt);return ot.get(wt)}}}function $D(ut,a,j,nt){const it=nt.isWebGL2;let ot,ht,ft;this.setMode=function(wt){ot=wt},this.setIndex=function(wt){ht=wt.type,ft=wt.bytesPerElement},this.render=function(wt,bt){ut.drawElements(ot,bt,ht,wt*ft),j.update(bt,ot,1)},this.renderInstances=function(wt,bt,St){if(St===0)return;let Dt,Rt;if(it)Dt=ut,Rt="drawElementsInstanced";else if(Dt=a.get("ANGLE_instanced_arrays"),Rt="drawElementsInstancedANGLE",Dt===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Dt[Rt](ot,bt,ht,wt*ft,St),j.update(bt,ot,St)}}function f_(ut){const a={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:a,programs:null,autoReset:!0,reset:function(){a.frame++,a.calls=0,a.triangles=0,a.points=0,a.lines=0},update:function(j,nt,it){switch(a.calls++,nt){case ut.TRIANGLES:a.triangles+=it*(j/3);break;case ut.LINES:a.lines+=it*(j/2);break;case ut.LINE_STRIP:a.lines+=it*(j-1);break;case ut.LINE_LOOP:a.lines+=it*j;break;case ut.POINTS:a.points+=it*j;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",nt)}}}}function p2(ut,a){return ut[0]-a[0]}function O0(ut,a){return Math.abs(a[1])-Math.abs(ut[1])}function qS(ut,a,j){const nt={},it=new Float32Array(8),ot=new WeakMap,ht=new No,ft=[];for(let wt=0;wt<8;wt++)ft[wt]=[wt,0];return{update:function(wt,bt,St){const Dt=wt.morphTargetInfluences;if(a.isWebGL2===!0){const Rt=bt.morphAttributes.position||bt.morphAttributes.normal||bt.morphAttributes.color,kt=Rt!==void 0?Rt.length:0;let Ot=ot.get(bt);if(Ot===void 0||Ot.count!==kt){Ot!==void 0&&Ot.texture.dispose();const zt=bt.morphAttributes.position!==void 0,qt=bt.morphAttributes.normal!==void 0,$t=bt.morphAttributes.color!==void 0,En=bt.morphAttributes.position||[],gn=bt.morphAttributes.normal||[],vn=bt.morphAttributes.color||[];let Un=0;zt===!0&&(Un=1),qt===!0&&(Un=2),$t===!0&&(Un=3);let $n=bt.attributes.position.count*Un,jn=1;$n>a.maxTextureSize&&(jn=Math.ceil($n/a.maxTextureSize),$n=a.maxTextureSize);const sr=new Float32Array($n*jn*4*kt),Vn=new rm(sr,$n,jn,kt);Vn.type=yv,Vn.needsUpdate=!0;const _r=4*Un;for(let xr=0;xr<kt;xr++){const Gr=En[xr],ns=gn[xr],Vr=vn[xr],Tr=$n*jn*4*xr;for(let Yr=0;Yr<Gr.count;Yr++){const ts=Yr*_r;zt===!0&&(ht.fromBufferAttribute(Gr,Yr),sr[Tr+ts+0]=ht.x,sr[Tr+ts+1]=ht.y,sr[Tr+ts+2]=ht.z,sr[Tr+ts+3]=0),qt===!0&&(ht.fromBufferAttribute(ns,Yr),sr[Tr+ts+4]=ht.x,sr[Tr+ts+5]=ht.y,sr[Tr+ts+6]=ht.z,sr[Tr+ts+7]=0),$t===!0&&(ht.fromBufferAttribute(Vr,Yr),sr[Tr+ts+8]=ht.x,sr[Tr+ts+9]=ht.y,sr[Tr+ts+10]=ht.z,sr[Tr+ts+11]=Vr.itemSize===4?ht.w:1)}}Ot={count:kt,texture:Vn,size:new Br($n,jn)},ot.set(bt,Ot),bt.addEventListener("dispose",function xr(){Vn.dispose(),ot.delete(bt),bt.removeEventListener("dispose",xr)})}let Gt=0;for(let zt=0;zt<Dt.length;zt++)Gt+=Dt[zt];const Nt=bt.morphTargetsRelative?1:1-Gt;St.getUniforms().setValue(ut,"morphTargetBaseInfluence",Nt),St.getUniforms().setValue(ut,"morphTargetInfluences",Dt),St.getUniforms().setValue(ut,"morphTargetsTexture",Ot.texture,j),St.getUniforms().setValue(ut,"morphTargetsTextureSize",Ot.size)}else{const Rt=Dt===void 0?0:Dt.length;let kt=nt[bt.id];if(kt===void 0||kt.length!==Rt){kt=[];for(let qt=0;qt<Rt;qt++)kt[qt]=[qt,0];nt[bt.id]=kt}for(let qt=0;qt<Rt;qt++){const $t=kt[qt];$t[0]=qt,$t[1]=Dt[qt]}kt.sort(O0);for(let qt=0;qt<8;qt++)qt<Rt&&kt[qt][1]?(ft[qt][0]=kt[qt][0],ft[qt][1]=kt[qt][1]):(ft[qt][0]=Number.MAX_SAFE_INTEGER,ft[qt][1]=0);ft.sort(p2);const Ot=bt.morphAttributes.position,Gt=bt.morphAttributes.normal;let Nt=0;for(let qt=0;qt<8;qt++){const $t=ft[qt],En=$t[0],gn=$t[1];En!==Number.MAX_SAFE_INTEGER&&gn?(Ot&&bt.getAttribute("morphTarget"+qt)!==Ot[En]&&bt.setAttribute("morphTarget"+qt,Ot[En]),Gt&&bt.getAttribute("morphNormal"+qt)!==Gt[En]&&bt.setAttribute("morphNormal"+qt,Gt[En]),it[qt]=gn,Nt+=gn):(Ot&&bt.hasAttribute("morphTarget"+qt)===!0&&bt.deleteAttribute("morphTarget"+qt),Gt&&bt.hasAttribute("morphNormal"+qt)===!0&&bt.deleteAttribute("morphNormal"+qt),it[qt]=0)}const zt=bt.morphTargetsRelative?1:1-Nt;St.getUniforms().setValue(ut,"morphTargetBaseInfluence",zt),St.getUniforms().setValue(ut,"morphTargetInfluences",it)}}}}function f2(ut,a,j,nt){let it=new WeakMap;function ot(ht){const ft=ht.target;ft.removeEventListener("dispose",ot),j.remove(ft.instanceMatrix),ft.instanceColor!==null&&j.remove(ft.instanceColor)}return{update:function(ht){const ft=nt.render.frame,wt=ht.geometry,bt=a.get(ht,wt);return it.get(bt)!==ft&&(a.update(bt),it.set(bt,ft)),ht.isInstancedMesh&&(ht.hasEventListener("dispose",ot)===!1&&ht.addEventListener("dispose",ot),j.update(ht.instanceMatrix,ut.ARRAY_BUFFER),ht.instanceColor!==null&&j.update(ht.instanceColor,ut.ARRAY_BUFFER)),bt},dispose:function(){it=new WeakMap}}}const K_=new ga,L0=new rm,WM=new mx,Bv=new JA,Sx=[],X1=[],XS=new Float32Array(16),ew=new Float32Array(9),Cx=new Float32Array(4);function J_(ut,a,j){const nt=ut[0];if(nt<=0||nt>0)return ut;const it=a*j;let ot=Sx[it];if(ot===void 0&&(ot=new Float32Array(it),Sx[it]=ot),a!==0){nt.toArray(ot,0);for(let ht=1,ft=0;ht!==a;++ht)ft+=j,ut[ht].toArray(ot,ft)}return ot}function Lu(ut,a){if(ut.length!==a.length)return!1;for(let j=0,nt=ut.length;j<nt;j++)if(ut[j]!==a[j])return!1;return!0}function pu(ut,a){for(let j=0,nt=a.length;j<nt;j++)ut[j]=a[j]}function om(ut,a){let j=X1[a];j===void 0&&(j=new Int32Array(a),X1[a]=j);for(let nt=0;nt!==a;++nt)j[nt]=ut.allocateTextureUnit();return j}function m_(ut,a){const j=this.cache;j[0]!==a&&(ut.uniform1f(this.addr,a),j[0]=a)}function Y1(ut,a){const j=this.cache;if(a.x!==void 0)j[0]===a.x&&j[1]===a.y||(ut.uniform2f(this.addr,a.x,a.y),j[0]=a.x,j[1]=a.y);else{if(Lu(j,a))return;ut.uniform2fv(this.addr,a),pu(j,a)}}function m2(ut,a){const j=this.cache;if(a.x!==void 0)j[0]===a.x&&j[1]===a.y&&j[2]===a.z||(ut.uniform3f(this.addr,a.x,a.y,a.z),j[0]=a.x,j[1]=a.y,j[2]=a.z);else if(a.r!==void 0)j[0]===a.r&&j[1]===a.g&&j[2]===a.b||(ut.uniform3f(this.addr,a.r,a.g,a.b),j[0]=a.r,j[1]=a.g,j[2]=a.b);else{if(Lu(j,a))return;ut.uniform3fv(this.addr,a),pu(j,a)}}function qM(ut,a){const j=this.cache;if(a.x!==void 0)j[0]===a.x&&j[1]===a.y&&j[2]===a.z&&j[3]===a.w||(ut.uniform4f(this.addr,a.x,a.y,a.z,a.w),j[0]=a.x,j[1]=a.y,j[2]=a.z,j[3]=a.w);else{if(Lu(j,a))return;ut.uniform4fv(this.addr,a),pu(j,a)}}function K1(ut,a){const j=this.cache,nt=a.elements;if(nt===void 0){if(Lu(j,a))return;ut.uniformMatrix2fv(this.addr,!1,a),pu(j,a)}else{if(Lu(j,nt))return;Cx.set(nt),ut.uniformMatrix2fv(this.addr,!1,Cx),pu(j,nt)}}function tw(ut,a){const j=this.cache,nt=a.elements;if(nt===void 0){if(Lu(j,a))return;ut.uniformMatrix3fv(this.addr,!1,a),pu(j,a)}else{if(Lu(j,nt))return;ew.set(nt),ut.uniformMatrix3fv(this.addr,!1,ew),pu(j,nt)}}function N0(ut,a){const j=this.cache,nt=a.elements;if(nt===void 0){if(Lu(j,a))return;ut.uniformMatrix4fv(this.addr,!1,a),pu(j,a)}else{if(Lu(j,nt))return;XS.set(nt),ut.uniformMatrix4fv(this.addr,!1,XS),pu(j,nt)}}function g_(ut,a){const j=this.cache;j[0]!==a&&(ut.uniform1i(this.addr,a),j[0]=a)}function g2(ut,a){const j=this.cache;if(a.x!==void 0)j[0]===a.x&&j[1]===a.y||(ut.uniform2i(this.addr,a.x,a.y),j[0]=a.x,j[1]=a.y);else{if(Lu(j,a))return;ut.uniform2iv(this.addr,a),pu(j,a)}}function rv(ut,a){const j=this.cache;if(a.x!==void 0)j[0]===a.x&&j[1]===a.y&&j[2]===a.z||(ut.uniform3i(this.addr,a.x,a.y,a.z),j[0]=a.x,j[1]=a.y,j[2]=a.z);else{if(Lu(j,a))return;ut.uniform3iv(this.addr,a),pu(j,a)}}function v2(ut,a){const j=this.cache;if(a.x!==void 0)j[0]===a.x&&j[1]===a.y&&j[2]===a.z&&j[3]===a.w||(ut.uniform4i(this.addr,a.x,a.y,a.z,a.w),j[0]=a.x,j[1]=a.y,j[2]=a.z,j[3]=a.w);else{if(Lu(j,a))return;ut.uniform4iv(this.addr,a),pu(j,a)}}function Mx(ut,a){const j=this.cache;j[0]!==a&&(ut.uniform1ui(this.addr,a),j[0]=a)}function _2(ut,a){const j=this.cache;if(a.x!==void 0)j[0]===a.x&&j[1]===a.y||(ut.uniform2ui(this.addr,a.x,a.y),j[0]=a.x,j[1]=a.y);else{if(Lu(j,a))return;ut.uniform2uiv(this.addr,a),pu(j,a)}}function ZD(ut,a){const j=this.cache;if(a.x!==void 0)j[0]===a.x&&j[1]===a.y&&j[2]===a.z||(ut.uniform3ui(this.addr,a.x,a.y,a.z),j[0]=a.x,j[1]=a.y,j[2]=a.z);else{if(Lu(j,a))return;ut.uniform3uiv(this.addr,a),pu(j,a)}}function Fy(ut,a){const j=this.cache;if(a.x!==void 0)j[0]===a.x&&j[1]===a.y&&j[2]===a.z&&j[3]===a.w||(ut.uniform4ui(this.addr,a.x,a.y,a.z,a.w),j[0]=a.x,j[1]=a.y,j[2]=a.z,j[3]=a.w);else{if(Lu(j,a))return;ut.uniform4uiv(this.addr,a),pu(j,a)}}function XM(ut,a,j){const nt=this.cache,it=j.allocateTextureUnit();nt[0]!==it&&(ut.uniform1i(this.addr,it),nt[0]=it),j.setTexture2D(a||K_,it)}function y2(ut,a,j){const nt=this.cache,it=j.allocateTextureUnit();nt[0]!==it&&(ut.uniform1i(this.addr,it),nt[0]=it),j.setTexture3D(a||WM,it)}function YM(ut,a,j){const nt=this.cache,it=j.allocateTextureUnit();nt[0]!==it&&(ut.uniform1i(this.addr,it),nt[0]=it),j.setTextureCube(a||Bv,it)}function cp(ut,a,j){const nt=this.cache,it=j.allocateTextureUnit();nt[0]!==it&&(ut.uniform1i(this.addr,it),nt[0]=it),j.setTexture2DArray(a||L0,it)}function U0(ut,a){ut.uniform1fv(this.addr,a)}function KM(ut,a){const j=J_(a,this.size,2);ut.uniform2fv(this.addr,j)}function jy(ut,a){const j=J_(a,this.size,3);ut.uniform3fv(this.addr,j)}function A2(ut,a){const j=J_(a,this.size,4);ut.uniform4fv(this.addr,j)}function sv(ut,a){const j=J_(a,this.size,4);ut.uniformMatrix2fv(this.addr,!1,j)}function JM(ut,a){const j=J_(a,this.size,9);ut.uniformMatrix3fv(this.addr,!1,j)}function _k(ut,a){const j=J_(a,this.size,16);ut.uniformMatrix4fv(this.addr,!1,j)}function eB(ut,a){ut.uniform1iv(this.addr,a)}function J1(ut,a){ut.uniform2iv(this.addr,a)}function b2(ut,a){ut.uniform3iv(this.addr,a)}function w2(ut,a){ut.uniform4iv(this.addr,a)}function x2(ut,a){ut.uniform1uiv(this.addr,a)}function $1(ut,a){ut.uniform2uiv(this.addr,a)}function E2(ut,a){ut.uniform3uiv(this.addr,a)}function nw(ut,a){ut.uniform4uiv(this.addr,a)}function Tx(ut,a,j){const nt=this.cache,it=a.length,ot=om(j,it);Lu(nt,ot)||(ut.uniform1iv(this.addr,ot),pu(nt,ot));for(let ht=0;ht!==it;++ht)j.setTexture2D(a[ht]||K_,ot[ht])}function Z1(ut,a,j){const nt=this.cache,it=a.length,ot=om(j,it);Lu(nt,ot)||(ut.uniform1iv(this.addr,ot),pu(nt,ot));for(let ht=0;ht!==it;++ht)j.setTexture3D(a[ht]||WM,ot[ht])}function YS(ut,a,j){const nt=this.cache,it=a.length,ot=om(j,it);Lu(nt,ot)||(ut.uniform1iv(this.addr,ot),pu(nt,ot));for(let ht=0;ht!==it;++ht)j.setTextureCube(a[ht]||Bv,ot[ht])}function Ix(ut,a,j){const nt=this.cache,it=a.length,ot=om(j,it);Lu(nt,ot)||(ut.uniform1iv(this.addr,ot),pu(nt,ot));for(let ht=0;ht!==it;++ht)j.setTexture2DArray(a[ht]||L0,ot[ht])}class eE{constructor(a,j,nt){this.id=a,this.addr=nt,this.cache=[],this.setValue=function(it){switch(it){case 5126:return m_;case 35664:return Y1;case 35665:return m2;case 35666:return qM;case 35674:return K1;case 35675:return tw;case 35676:return N0;case 5124:case 35670:return g_;case 35667:case 35671:return g2;case 35668:case 35672:return rv;case 35669:case 35673:return v2;case 5125:return Mx;case 36294:return _2;case 36295:return ZD;case 36296:return Fy;case 35678:case 36198:case 36298:case 36306:case 35682:return XM;case 35679:case 36299:case 36307:return y2;case 35680:case 36300:case 36308:case 36293:return YM;case 36289:case 36303:case 36311:case 36292:return cp}}(j.type)}}class S2{constructor(a,j,nt){this.id=a,this.addr=nt,this.cache=[],this.size=j.size,this.setValue=function(it){switch(it){case 5126:return U0;case 35664:return KM;case 35665:return jy;case 35666:return A2;case 35674:return sv;case 35675:return JM;case 35676:return _k;case 5124:case 35670:return eB;case 35667:case 35671:return J1;case 35668:case 35672:return b2;case 35669:case 35673:return w2;case 5125:return x2;case 36294:return $1;case 36295:return E2;case 36296:return nw;case 35678:case 36198:case 36298:case 36306:case 35682:return Tx;case 35679:case 36299:case 36307:return Z1;case 35680:case 36300:case 36308:case 36293:return YS;case 36289:case 36303:case 36311:case 36292:return Ix}}(j.type)}}class C2{constructor(a){this.id=a,this.seq=[],this.map={}}setValue(a,j,nt){const it=this.seq;for(let ot=0,ht=it.length;ot!==ht;++ot){const ft=it[ot];ft.setValue(a,j[ft.id],nt)}}}const Px=/(\w+)(\])?(\[|\.)?/g;function zy(ut,a){ut.seq.push(a),ut.map[a.id]=a}function $M(ut,a,j){const nt=ut.name,it=nt.length;for(Px.lastIndex=0;;){const ot=Px.exec(nt),ht=Px.lastIndex;let ft=ot[1];const wt=ot[2]==="]",bt=ot[3];if(wt&&(ft|=0),bt===void 0||bt==="["&&ht+2===it){zy(j,bt===void 0?new eE(ft,ut,a):new S2(ft,ut,a));break}{let St=j.map[ft];St===void 0&&(St=new C2(ft),zy(j,St)),j=St}}}class Ov{constructor(a,j){this.seq=[],this.map={};const nt=a.getProgramParameter(j,a.ACTIVE_UNIFORMS);for(let it=0;it<nt;++it){const ot=a.getActiveUniform(j,it);$M(ot,a.getUniformLocation(j,ot.name),this)}}setValue(a,j,nt,it){const ot=this.map[j];ot!==void 0&&ot.setValue(a,nt,it)}setOptional(a,j,nt){const it=j[nt];it!==void 0&&this.setValue(a,nt,it)}static upload(a,j,nt,it){for(let ot=0,ht=j.length;ot!==ht;++ot){const ft=j[ot],wt=nt[ft.id];wt.needsUpdate!==!1&&ft.setValue(a,wt.value,it)}}static seqWithValue(a,j){const nt=[];for(let it=0,ot=a.length;it!==ot;++it){const ht=a[it];ht.id in j&&nt.push(ht)}return nt}}function ZM(ut,a,j){const nt=ut.createShader(a);return ut.shaderSource(nt,j),ut.compileShader(nt),nt}let M2=0;function KS(ut){switch(ut){case Cm:case io:return["Linear","( value )"];case Bs:return["sRGB","( value )"];case Mm:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",ut),["Linear","( value )"]}}function JS(ut,a,j){const nt=ut.getShaderParameter(a,ut.COMPILE_STATUS),it=ut.getShaderInfoLog(a).trim();if(nt&&it==="")return"";const ot=/ERROR: 0:(\d+)/.exec(it);if(ot){const ht=parseInt(ot[1]);return j.toUpperCase()+`

`+it+`

`+function(ft,wt){const bt=ft.split(`
`),St=[],Dt=Math.max(wt-6,0),Rt=Math.min(wt+6,bt.length);for(let kt=Dt;kt<Rt;kt++){const Ot=kt+1;St.push(`${Ot===wt?">":" "} ${Ot}: ${bt[kt]}`)}return St.join(`
`)}(ut.getShaderSource(a),ht)}return it}function eT(ut,a){const j=KS(a);return"vec4 "+ut+"( vec4 value ) { return "+j[0]+"ToLinear"+j[1]+"; }"}function iw(ut,a){const j=KS(a);return"vec4 "+ut+"( vec4 value ) { return LinearTo"+j[0]+j[1]+"; }"}function Lm(ut,a){let j;switch(a){case _c:j="Linear";break;case Cl:j="Reinhard";break;case $a:j="OptimizedCineon";break;case Jp:j="ACESFilmic";break;case bm:j="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",a),j="Linear"}return"vec3 "+ut+"( vec3 color ) { return "+j+"ToneMapping( color ); }"}function Lv(ut){return ut!==""}function Fl(ut,a){const j=a.numSpotLightShadows+a.numSpotLightMaps-a.numSpotLightShadowsWithMaps;return ut.replace(/NUM_DIR_LIGHTS/g,a.numDirLights).replace(/NUM_SPOT_LIGHTS/g,a.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,a.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,j).replace(/NUM_RECT_AREA_LIGHTS/g,a.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,a.numPointLights).replace(/NUM_HEMI_LIGHTS/g,a.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,a.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,a.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,a.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,a.numPointLightShadows)}function tT(ut,a){return ut.replace(/NUM_CLIPPING_PLANES/g,a.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,a.numClippingPlanes-a.numClipIntersection)}const nT=/^[ \t]*#include +<([\w\d./]+)>/gm;function $S(ut){return ut.replace(nT,T2)}function T2(ut,a){const j=ao[a];if(j===void 0)throw new Error("Can not resolve #include <"+a+">");return $S(j)}const I2=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function P2(ut){return ut.replace(I2,tB)}function tB(ut,a,j,nt){let it="";for(let ot=parseInt(a);ot<parseInt(j);ot++)it+=nt.replace(/\[\s*i\s*\]/g,"[ "+ot+" ]").replace(/UNROLLED_LOOP_INDEX/g,ot);return it}function R2(ut){let a="precision "+ut.precision+` float;
precision `+ut.precision+" int;";return ut.precision==="highp"?a+=`
#define HIGH_PRECISION`:ut.precision==="mediump"?a+=`
#define MEDIUM_PRECISION`:ut.precision==="lowp"&&(a+=`
#define LOW_PRECISION`),a}function nB(ut,a,j,nt){const it=ut.getContext(),ot=j.defines;let ht=j.vertexShader,ft=j.fragmentShader;const wt=function(jn){let sr="SHADOWMAP_TYPE_BASIC";return jn.shadowMapType===_n?sr="SHADOWMAP_TYPE_PCF":jn.shadowMapType===pn?sr="SHADOWMAP_TYPE_PCF_SOFT":jn.shadowMapType===ln&&(sr="SHADOWMAP_TYPE_VSM"),sr}(j),bt=function(jn){let sr="ENVMAP_TYPE_CUBE";if(jn.envMap)switch(jn.envMapMode){case Ql:case Ml:sr="ENVMAP_TYPE_CUBE";break;case Np:sr="ENVMAP_TYPE_CUBE_UV"}return sr}(j),St=function(jn){let sr="ENVMAP_MODE_REFLECTION";return jn.envMap&&jn.envMapMode===Ml&&(sr="ENVMAP_MODE_REFRACTION"),sr}(j),Dt=function(jn){let sr="ENVMAP_BLENDING_NONE";if(jn.envMap)switch(jn.combine){case fo:sr="ENVMAP_BLENDING_MULTIPLY";break;case no:sr="ENVMAP_BLENDING_MIX";break;case ba:sr="ENVMAP_BLENDING_ADD"}return sr}(j),Rt=function(jn){const sr=jn.envMapCubeUVHeight;if(sr===null)return null;const Vn=Math.log2(sr)-2,_r=1/sr;return{texelWidth:1/(3*Math.max(Math.pow(2,Vn),112)),texelHeight:_r,maxMip:Vn}}(j),kt=j.isWebGL2?"":function(jn){return[jn.extensionDerivatives||jn.envMapCubeUVHeight||jn.bumpMap||jn.normalMapTangentSpace||jn.clearcoatNormalMap||jn.flatShading||jn.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(jn.extensionFragDepth||jn.logarithmicDepthBuffer)&&jn.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",jn.extensionDrawBuffers&&jn.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(jn.extensionShaderTextureLOD||jn.envMap||jn.transmission)&&jn.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Lv).join(`
`)}(j),Ot=function(jn){const sr=[];for(const Vn in jn){const _r=jn[Vn];_r!==!1&&sr.push("#define "+Vn+" "+_r)}return sr.join(`
`)}(ot),Gt=it.createProgram();let Nt,zt,qt=j.glslVersion?"#version "+j.glslVersion+`
`:"";j.isRawShaderMaterial?(Nt=[Ot].filter(Lv).join(`
`),Nt.length>0&&(Nt+=`
`),zt=[kt,Ot].filter(Lv).join(`
`),zt.length>0&&(zt+=`
`)):(Nt=[R2(j),"#define SHADER_NAME "+j.shaderName,Ot,j.instancing?"#define USE_INSTANCING":"",j.instancingColor?"#define USE_INSTANCING_COLOR":"",j.useFog&&j.fog?"#define USE_FOG":"",j.useFog&&j.fogExp2?"#define FOG_EXP2":"",j.map?"#define USE_MAP":"",j.envMap?"#define USE_ENVMAP":"",j.envMap?"#define "+St:"",j.lightMap?"#define USE_LIGHTMAP":"",j.aoMap?"#define USE_AOMAP":"",j.bumpMap?"#define USE_BUMPMAP":"",j.normalMap?"#define USE_NORMALMAP":"",j.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",j.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",j.displacementMap?"#define USE_DISPLACEMENTMAP":"",j.emissiveMap?"#define USE_EMISSIVEMAP":"",j.clearcoatMap?"#define USE_CLEARCOATMAP":"",j.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",j.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",j.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",j.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",j.specularMap?"#define USE_SPECULARMAP":"",j.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",j.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",j.roughnessMap?"#define USE_ROUGHNESSMAP":"",j.metalnessMap?"#define USE_METALNESSMAP":"",j.alphaMap?"#define USE_ALPHAMAP":"",j.transmission?"#define USE_TRANSMISSION":"",j.transmissionMap?"#define USE_TRANSMISSIONMAP":"",j.thicknessMap?"#define USE_THICKNESSMAP":"",j.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",j.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",j.mapUv?"#define MAP_UV "+j.mapUv:"",j.alphaMapUv?"#define ALPHAMAP_UV "+j.alphaMapUv:"",j.lightMapUv?"#define LIGHTMAP_UV "+j.lightMapUv:"",j.aoMapUv?"#define AOMAP_UV "+j.aoMapUv:"",j.emissiveMapUv?"#define EMISSIVEMAP_UV "+j.emissiveMapUv:"",j.bumpMapUv?"#define BUMPMAP_UV "+j.bumpMapUv:"",j.normalMapUv?"#define NORMALMAP_UV "+j.normalMapUv:"",j.displacementMapUv?"#define DISPLACEMENTMAP_UV "+j.displacementMapUv:"",j.metalnessMapUv?"#define METALNESSMAP_UV "+j.metalnessMapUv:"",j.roughnessMapUv?"#define ROUGHNESSMAP_UV "+j.roughnessMapUv:"",j.clearcoatMapUv?"#define CLEARCOATMAP_UV "+j.clearcoatMapUv:"",j.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+j.clearcoatNormalMapUv:"",j.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+j.clearcoatRoughnessMapUv:"",j.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+j.iridescenceMapUv:"",j.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+j.iridescenceThicknessMapUv:"",j.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+j.sheenColorMapUv:"",j.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+j.sheenRoughnessMapUv:"",j.specularMapUv?"#define SPECULARMAP_UV "+j.specularMapUv:"",j.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+j.specularColorMapUv:"",j.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+j.specularIntensityMapUv:"",j.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+j.transmissionMapUv:"",j.thicknessMapUv?"#define THICKNESSMAP_UV "+j.thicknessMapUv:"",j.vertexTangents?"#define USE_TANGENT":"",j.vertexColors?"#define USE_COLOR":"",j.vertexAlphas?"#define USE_COLOR_ALPHA":"",j.vertexUv1s?"#define USE_UV1":"",j.vertexUv2s?"#define USE_UV2":"",j.vertexUv3s?"#define USE_UV3":"",j.pointsUvs?"#define USE_POINTS_UV":"",j.flatShading?"#define FLAT_SHADED":"",j.skinning?"#define USE_SKINNING":"",j.morphTargets?"#define USE_MORPHTARGETS":"",j.morphNormals&&j.flatShading===!1?"#define USE_MORPHNORMALS":"",j.morphColors&&j.isWebGL2?"#define USE_MORPHCOLORS":"",j.morphTargetsCount>0&&j.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",j.morphTargetsCount>0&&j.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+j.morphTextureStride:"",j.morphTargetsCount>0&&j.isWebGL2?"#define MORPHTARGETS_COUNT "+j.morphTargetsCount:"",j.doubleSided?"#define DOUBLE_SIDED":"",j.flipSided?"#define FLIP_SIDED":"",j.shadowMapEnabled?"#define USE_SHADOWMAP":"",j.shadowMapEnabled?"#define "+wt:"",j.sizeAttenuation?"#define USE_SIZEATTENUATION":"",j.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",j.logarithmicDepthBuffer&&j.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Lv).join(`
`),zt=[kt,R2(j),"#define SHADER_NAME "+j.shaderName,Ot,j.instancing?"#define USE_INSTANCING":"",j.instancingColor?"#define USE_INSTANCING_COLOR":"",j.useFog&&j.fog?"#define USE_FOG":"",j.useFog&&j.fogExp2?"#define FOG_EXP2":"",j.map?"#define USE_MAP":"",j.matcap?"#define USE_MATCAP":"",j.envMap?"#define USE_ENVMAP":"",j.envMap?"#define "+bt:"",j.envMap?"#define "+St:"",j.envMap?"#define "+Dt:"",Rt?"#define CUBEUV_TEXEL_WIDTH "+Rt.texelWidth:"",Rt?"#define CUBEUV_TEXEL_HEIGHT "+Rt.texelHeight:"",Rt?"#define CUBEUV_MAX_MIP "+Rt.maxMip+".0":"",j.lightMap?"#define USE_LIGHTMAP":"",j.aoMap?"#define USE_AOMAP":"",j.bumpMap?"#define USE_BUMPMAP":"",j.normalMap?"#define USE_NORMALMAP":"",j.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",j.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",j.emissiveMap?"#define USE_EMISSIVEMAP":"",j.clearcoat?"#define USE_CLEARCOAT":"",j.clearcoatMap?"#define USE_CLEARCOATMAP":"",j.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",j.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",j.iridescence?"#define USE_IRIDESCENCE":"",j.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",j.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",j.specularMap?"#define USE_SPECULARMAP":"",j.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",j.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",j.roughnessMap?"#define USE_ROUGHNESSMAP":"",j.metalnessMap?"#define USE_METALNESSMAP":"",j.alphaMap?"#define USE_ALPHAMAP":"",j.alphaTest?"#define USE_ALPHATEST":"",j.sheen?"#define USE_SHEEN":"",j.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",j.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",j.transmission?"#define USE_TRANSMISSION":"",j.transmissionMap?"#define USE_TRANSMISSIONMAP":"",j.thicknessMap?"#define USE_THICKNESSMAP":"",j.vertexTangents?"#define USE_TANGENT":"",j.vertexColors||j.instancingColor?"#define USE_COLOR":"",j.vertexAlphas?"#define USE_COLOR_ALPHA":"",j.vertexUv1s?"#define USE_UV1":"",j.vertexUv2s?"#define USE_UV2":"",j.vertexUv3s?"#define USE_UV3":"",j.pointsUvs?"#define USE_POINTS_UV":"",j.gradientMap?"#define USE_GRADIENTMAP":"",j.flatShading?"#define FLAT_SHADED":"",j.doubleSided?"#define DOUBLE_SIDED":"",j.flipSided?"#define FLIP_SIDED":"",j.shadowMapEnabled?"#define USE_SHADOWMAP":"",j.shadowMapEnabled?"#define "+wt:"",j.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",j.useLegacyLights?"#define LEGACY_LIGHTS":"",j.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",j.logarithmicDepthBuffer&&j.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",j.toneMapping!==Mo?"#define TONE_MAPPING":"",j.toneMapping!==Mo?ao.tonemapping_pars_fragment:"",j.toneMapping!==Mo?Lm("toneMapping",j.toneMapping):"",j.dithering?"#define DITHERING":"",j.opaque?"#define OPAQUE":"",ao.encodings_pars_fragment,iw("linearToOutputTexel",j.outputColorSpace),j.transmissionSamplerMapEncoding?eT("transmissionSamplerMapTexelToLinear",j.transmissionSamplerMapEncoding):"",j.useDepthPacking?"#define DEPTH_PACKING "+j.depthPacking:"",`
`].filter(Lv).join(`
`)),ht=$S(ht),ht=Fl(ht,j),ht=tT(ht,j),ft=$S(ft),ft=Fl(ft,j),ft=tT(ft,j),ht=P2(ht),ft=P2(ft),j.isWebGL2&&j.isRawShaderMaterial!==!0&&(qt=`#version 300 es
`,Nt=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Nt,zt=["#define varying in",j.glslVersion===wy?"":"layout(location = 0) out highp vec4 pc_fragColor;",j.glslVersion===wy?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad","#define WebGL2Context 1"].join(`
`)+`
`+zt);const $t=qt+Nt+ht,En=qt+zt+ft,gn=ZM(it,it.VERTEX_SHADER,$t),vn=ZM(it,it.FRAGMENT_SHADER,En);if(it.attachShader(Gt,gn),it.attachShader(Gt,vn),j.index0AttributeName!==void 0?it.bindAttribLocation(Gt,0,j.index0AttributeName):j.morphTargets===!0&&it.bindAttribLocation(Gt,0,"position"),it.linkProgram(Gt),ut.debug.checkShaderErrors){const jn=it.getProgramInfoLog(Gt).trim(),sr=it.getShaderInfoLog(gn).trim(),Vn=it.getShaderInfoLog(vn).trim();let _r=!0,xr=!0;if(it.getProgramParameter(Gt,it.LINK_STATUS)===!1)if(_r=!1,typeof ut.debug.onShaderError=="function")ut.debug.onShaderError(it,Gt,gn,vn);else{const Gr=JS(it,gn,"vertex"),ns=JS(it,vn,"fragment");console.error("THREE.WebGLProgram: Shader Error "+it.getError()+" - VALIDATE_STATUS "+it.getProgramParameter(Gt,it.VALIDATE_STATUS)+`

Program Info Log: `+jn+`
`+Gr+`
`+ns)}else jn!==""?console.warn("THREE.WebGLProgram: Program Info Log:",jn):sr!==""&&Vn!==""||(xr=!1);xr&&(this.diagnostics={runnable:_r,programLog:jn,vertexShader:{log:sr,prefix:Nt},fragmentShader:{log:Vn,prefix:zt}})}let Un,$n;return it.deleteShader(gn),it.deleteShader(vn),this.getUniforms=function(){return Un===void 0&&(Un=new Ov(it,Gt)),Un},this.getAttributes=function(){return $n===void 0&&($n=function(jn,sr){const Vn={},_r=jn.getProgramParameter(sr,jn.ACTIVE_ATTRIBUTES);for(let xr=0;xr<_r;xr++){const Gr=jn.getActiveAttrib(sr,xr),ns=Gr.name;let Vr=1;Gr.type===jn.FLOAT_MAT2&&(Vr=2),Gr.type===jn.FLOAT_MAT3&&(Vr=3),Gr.type===jn.FLOAT_MAT4&&(Vr=4),Vn[ns]={type:Gr.type,location:jn.getAttribLocation(sr,ns),locationSize:Vr}}return Vn}(it,Gt)),$n},this.destroy=function(){nt.releaseStatesOfProgram(this),it.deleteProgram(Gt),this.program=void 0},this.name=j.shaderName,this.id=M2++,this.cacheKey=a,this.usedTimes=1,this.program=Gt,this.vertexShader=gn,this.fragmentShader=vn,this}let iB=0;class rB{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(a){const j=a.vertexShader,nt=a.fragmentShader,it=this._getShaderStage(j),ot=this._getShaderStage(nt),ht=this._getShaderCacheForMaterial(a);return ht.has(it)===!1&&(ht.add(it),it.usedTimes++),ht.has(ot)===!1&&(ht.add(ot),ot.usedTimes++),this}remove(a){const j=this.materialCache.get(a);for(const nt of j)nt.usedTimes--,nt.usedTimes===0&&this.shaderCache.delete(nt.code);return this.materialCache.delete(a),this}getVertexShaderID(a){return this._getShaderStage(a.vertexShader).id}getFragmentShaderID(a){return this._getShaderStage(a.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(a){const j=this.materialCache;let nt=j.get(a);return nt===void 0&&(nt=new Set,j.set(a,nt)),nt}_getShaderStage(a){const j=this.shaderCache;let nt=j.get(a);return nt===void 0&&(nt=new iT(a),j.set(a,nt)),nt}}class iT{constructor(a){this.id=iB++,this.code=a,this.usedTimes=0}}function ZS(ut,a,j,nt,it,ot,ht){const ft=new T0,wt=new rB,bt=[],St=it.isWebGL2,Dt=it.logarithmicDepthBuffer,Rt=it.vertexTextures;let kt=it.precision;const Ot={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function Gt(Nt){return Nt===1?"uv1":Nt===2?"uv2":Nt===3?"uv3":"uv"}return{getParameters:function(Nt,zt,qt,$t,En){const gn=$t.fog,vn=En.geometry,Un=Nt.isMeshStandardMaterial?$t.environment:null,$n=(Nt.isMeshStandardMaterial?j:a).get(Nt.envMap||Un),jn=$n&&$n.mapping===Np?$n.image.height:null,sr=Ot[Nt.type];Nt.precision!==null&&(kt=it.getMaxPrecision(Nt.precision),kt!==Nt.precision&&console.warn("THREE.WebGLProgram.getParameters:",Nt.precision,"not supported, using",kt,"instead."));const Vn=vn.morphAttributes.position||vn.morphAttributes.normal||vn.morphAttributes.color,_r=Vn!==void 0?Vn.length:0;let xr,Gr,ns,Vr,Tr=0;if(vn.morphAttributes.position!==void 0&&(Tr=1),vn.morphAttributes.normal!==void 0&&(Tr=2),vn.morphAttributes.color!==void 0&&(Tr=3),sr){const r1=lp[sr];xr=r1.vertexShader,Gr=r1.fragmentShader}else xr=Nt.vertexShader,Gr=Nt.fragmentShader,wt.update(Nt),ns=wt.getVertexShaderID(Nt),Vr=wt.getFragmentShaderID(Nt);const Yr=ut.getRenderTarget(),ts=ut.userData&&ut.userData.transmissionRenderTarget,mr=Yr?Array.isArray(Yr.texture)?Yr.texture[0]:Yr.texture:null,Dr=En.isInstancedMesh===!0,$r=!!Nt.map,Ur=!!Nt.matcap,ss=!!$n,Hs=!!Nt.aoMap,Fn=!!Nt.lightMap,Sn=!!Nt.bumpMap,lr=!!Nt.normalMap,Yn=!!Nt.displacementMap,On=!!Nt.emissiveMap,Zn=!!Nt.metalnessMap,fn=!!Nt.roughnessMap,Gn=Nt.clearcoat>0,qn=Nt.iridescence>0,Er=Nt.sheen>0,br=Nt.transmission>0,Rr=Gn&&!!Nt.clearcoatMap,is=Gn&&!!Nt.clearcoatNormalMap,ms=Gn&&!!Nt.clearcoatRoughnessMap,Ps=qn&&!!Nt.iridescenceMap,ds=qn&&!!Nt.iridescenceThicknessMap,Ys=Er&&!!Nt.sheenColorMap,qs=Er&&!!Nt.sheenRoughnessMap,Rs=!!Nt.specularMap,Zo=!!Nt.specularColorMap,Pp=!!Nt.specularIntensityMap,lo=br&&!!Nt.transmissionMap,Bo=br&&!!Nt.thicknessMap,jo=!!Nt.gradientMap,ty=!!Nt.alphaMap,yr=Nt.alphaTest>0,aA=!!Nt.extensions,DE=!!vn.attributes.uv1,mm=!!vn.attributes.uv2,kE=!!vn.attributes.uv3;return{isWebGL2:St,shaderID:sr,shaderName:Nt.type,vertexShader:xr,fragmentShader:Gr,defines:Nt.defines,customVertexShaderID:ns,customFragmentShaderID:Vr,isRawShaderMaterial:Nt.isRawShaderMaterial===!0,glslVersion:Nt.glslVersion,precision:kt,instancing:Dr,instancingColor:Dr&&En.instanceColor!==null,supportsVertexTextures:Rt,outputColorSpace:Yr===null?ut.outputColorSpace:Yr.isXRRenderTarget===!0||mr.colorSpace&&mr.colorSpace!==Bs?mr.colorSpace:io,map:$r,matcap:Ur,envMap:ss,envMapMode:ss&&$n.mapping,envMapCubeUVHeight:jn,aoMap:Hs,lightMap:Fn,bumpMap:Sn,normalMap:lr,displacementMap:Rt&&Yn,emissiveMap:On,normalMapObjectSpace:lr&&Nt.normalMapType===U_,normalMapTangentSpace:lr&&Nt.normalMapType===Sm,metalnessMap:Zn,roughnessMap:fn,clearcoat:Gn,clearcoatMap:Rr,clearcoatNormalMap:is,clearcoatRoughnessMap:ms,iridescence:qn,iridescenceMap:Ps,iridescenceThicknessMap:ds,sheen:Er,sheenColorMap:Ys,sheenRoughnessMap:qs,specularMap:Rs,specularColorMap:Zo,specularIntensityMap:Pp,transmission:br,transmissionMap:lo,thicknessMap:Bo,transmissionSamplerMapEncoding:ts&&ts.texture.colorSpace||io,gradientMap:jo,opaque:Nt.transparent===!1&&Nt.blending===dn&&!(Nt.transmission>0),alphaMap:ty,alphaTest:yr,combine:Nt.combine,mapUv:$r&&Gt(Nt.map.channel),aoMapUv:Hs&&Gt(Nt.aoMap.channel),lightMapUv:Fn&&Gt(Nt.lightMap.channel),bumpMapUv:Sn&&Gt(Nt.bumpMap.channel),normalMapUv:lr&&Gt(Nt.normalMap.channel),displacementMapUv:Yn&&Gt(Nt.displacementMap.channel),emissiveMapUv:On&&Gt(Nt.emissiveMap.channel),metalnessMapUv:Zn&&Gt(Nt.metalnessMap.channel),roughnessMapUv:fn&&Gt(Nt.roughnessMap.channel),clearcoatMapUv:Rr&&Gt(Nt.clearcoatMap.channel),clearcoatNormalMapUv:is&&Gt(Nt.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ms&&Gt(Nt.clearcoatRoughnessMap.channel),iridescenceMapUv:Ps&&Gt(Nt.iridescenceMap.channel),iridescenceThicknessMapUv:ds&&Gt(Nt.iridescenceThicknessMap.channel),sheenColorMapUv:Ys&&Gt(Nt.sheenColorMap.channel),sheenRoughnessMapUv:qs&&Gt(Nt.sheenRoughnessMap.channel),specularMapUv:Rs&&Gt(Nt.specularMap.channel),specularColorMapUv:Zo&&Gt(Nt.specularColorMap.channel),specularIntensityMapUv:Pp&&Gt(Nt.specularIntensityMap.channel),transmissionMapUv:lo&&Gt(Nt.transmissionMap.channel),thicknessMapUv:Bo&&Gt(Nt.thicknessMap.channel),alphaMapUv:ty&&Gt(Nt.alphaMap.channel),vertexTangents:lr&&!!vn.attributes.tangent,vertexColors:Nt.vertexColors,vertexAlphas:Nt.vertexColors===!0&&!!vn.attributes.color&&vn.attributes.color.itemSize===4,vertexUv1s:DE,vertexUv2s:mm,vertexUv3s:kE,pointsUvs:En.isPoints===!0&&!!vn.attributes.uv&&($r||ty),fog:!!gn,useFog:Nt.fog===!0,fogExp2:gn&&gn.isFogExp2,flatShading:Nt.flatShading===!0,sizeAttenuation:Nt.sizeAttenuation===!0,logarithmicDepthBuffer:Dt,skinning:En.isSkinnedMesh===!0,morphTargets:vn.morphAttributes.position!==void 0,morphNormals:vn.morphAttributes.normal!==void 0,morphColors:vn.morphAttributes.color!==void 0,morphTargetsCount:_r,morphTextureStride:Tr,numDirLights:zt.directional.length,numPointLights:zt.point.length,numSpotLights:zt.spot.length,numSpotLightMaps:zt.spotLightMap.length,numRectAreaLights:zt.rectArea.length,numHemiLights:zt.hemi.length,numDirLightShadows:zt.directionalShadowMap.length,numPointLightShadows:zt.pointShadowMap.length,numSpotLightShadows:zt.spotShadowMap.length,numSpotLightShadowsWithMaps:zt.numSpotLightShadowsWithMaps,numClippingPlanes:ht.numPlanes,numClipIntersection:ht.numIntersection,dithering:Nt.dithering,shadowMapEnabled:ut.shadowMap.enabled&&qt.length>0,shadowMapType:ut.shadowMap.type,toneMapping:Nt.toneMapped?ut.toneMapping:Mo,useLegacyLights:ut.useLegacyLights,premultipliedAlpha:Nt.premultipliedAlpha,doubleSided:Nt.side===Hn,flipSided:Nt.side===nn,useDepthPacking:Nt.depthPacking>=0,depthPacking:Nt.depthPacking||0,index0AttributeName:Nt.index0AttributeName,extensionDerivatives:aA&&Nt.extensions.derivatives===!0,extensionFragDepth:aA&&Nt.extensions.fragDepth===!0,extensionDrawBuffers:aA&&Nt.extensions.drawBuffers===!0,extensionShaderTextureLOD:aA&&Nt.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:St||nt.has("EXT_frag_depth"),rendererExtensionDrawBuffers:St||nt.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:St||nt.has("EXT_shader_texture_lod"),customProgramCacheKey:Nt.customProgramCacheKey()}},getProgramCacheKey:function(Nt){const zt=[];if(Nt.shaderID?zt.push(Nt.shaderID):(zt.push(Nt.customVertexShaderID),zt.push(Nt.customFragmentShaderID)),Nt.defines!==void 0)for(const qt in Nt.defines)zt.push(qt),zt.push(Nt.defines[qt]);return Nt.isRawShaderMaterial===!1&&(function(qt,$t){qt.push($t.precision),qt.push($t.outputColorSpace),qt.push($t.envMapMode),qt.push($t.envMapCubeUVHeight),qt.push($t.mapUv),qt.push($t.alphaMapUv),qt.push($t.lightMapUv),qt.push($t.aoMapUv),qt.push($t.bumpMapUv),qt.push($t.normalMapUv),qt.push($t.displacementMapUv),qt.push($t.emissiveMapUv),qt.push($t.metalnessMapUv),qt.push($t.roughnessMapUv),qt.push($t.clearcoatMapUv),qt.push($t.clearcoatNormalMapUv),qt.push($t.clearcoatRoughnessMapUv),qt.push($t.iridescenceMapUv),qt.push($t.iridescenceThicknessMapUv),qt.push($t.sheenColorMapUv),qt.push($t.sheenRoughnessMapUv),qt.push($t.specularMapUv),qt.push($t.specularColorMapUv),qt.push($t.specularIntensityMapUv),qt.push($t.transmissionMapUv),qt.push($t.thicknessMapUv),qt.push($t.combine),qt.push($t.fogExp2),qt.push($t.sizeAttenuation),qt.push($t.morphTargetsCount),qt.push($t.morphAttributeCount),qt.push($t.numDirLights),qt.push($t.numPointLights),qt.push($t.numSpotLights),qt.push($t.numSpotLightMaps),qt.push($t.numHemiLights),qt.push($t.numRectAreaLights),qt.push($t.numDirLightShadows),qt.push($t.numPointLightShadows),qt.push($t.numSpotLightShadows),qt.push($t.numSpotLightShadowsWithMaps),qt.push($t.shadowMapType),qt.push($t.toneMapping),qt.push($t.numClippingPlanes),qt.push($t.numClipIntersection),qt.push($t.depthPacking)}(zt,Nt),function(qt,$t){ft.disableAll(),$t.isWebGL2&&ft.enable(0),$t.supportsVertexTextures&&ft.enable(1),$t.instancing&&ft.enable(2),$t.instancingColor&&ft.enable(3),$t.matcap&&ft.enable(4),$t.envMap&&ft.enable(5),$t.normalMapObjectSpace&&ft.enable(6),$t.normalMapTangentSpace&&ft.enable(7),$t.clearcoat&&ft.enable(8),$t.iridescence&&ft.enable(9),$t.alphaTest&&ft.enable(10),$t.vertexColors&&ft.enable(11),$t.vertexAlphas&&ft.enable(12),$t.vertexUv1s&&ft.enable(13),$t.vertexUv2s&&ft.enable(14),$t.vertexUv3s&&ft.enable(15),$t.vertexTangents&&ft.enable(16),qt.push(ft.mask),ft.disableAll(),$t.fog&&ft.enable(0),$t.useFog&&ft.enable(1),$t.flatShading&&ft.enable(2),$t.logarithmicDepthBuffer&&ft.enable(3),$t.skinning&&ft.enable(4),$t.morphTargets&&ft.enable(5),$t.morphNormals&&ft.enable(6),$t.morphColors&&ft.enable(7),$t.premultipliedAlpha&&ft.enable(8),$t.shadowMapEnabled&&ft.enable(9),$t.useLegacyLights&&ft.enable(10),$t.doubleSided&&ft.enable(11),$t.flipSided&&ft.enable(12),$t.useDepthPacking&&ft.enable(13),$t.dithering&&ft.enable(14),$t.transmission&&ft.enable(15),$t.sheen&&ft.enable(16),$t.opaque&&ft.enable(17),$t.pointsUvs&&ft.enable(18),qt.push(ft.mask)}(zt,Nt),zt.push(ut.outputColorSpace)),zt.push(Nt.customProgramCacheKey),zt.join()},getUniforms:function(Nt){const zt=Ot[Nt.type];let qt;if(zt){const $t=lp[zt];qt=FM.clone($t.uniforms)}else qt=Nt.uniforms;return qt},acquireProgram:function(Nt,zt){let qt;for(let $t=0,En=bt.length;$t<En;$t++){const gn=bt[$t];if(gn.cacheKey===zt){qt=gn,++qt.usedTimes;break}}return qt===void 0&&(qt=new nB(ut,zt,Nt,ot),bt.push(qt)),qt},releaseProgram:function(Nt){if(--Nt.usedTimes==0){const zt=bt.indexOf(Nt);bt[zt]=bt[bt.length-1],bt.pop(),Nt.destroy()}},releaseShaderCache:function(Nt){wt.remove(Nt)},programs:bt,dispose:function(){wt.dispose()}}}function xl(){let ut=new WeakMap;return{get:function(a){let j=ut.get(a);return j===void 0&&(j={},ut.set(a,j)),j},remove:function(a){ut.delete(a)},update:function(a,j,nt){ut.get(a)[j]=nt},dispose:function(){ut=new WeakMap}}}function D2(ut,a){return ut.groupOrder!==a.groupOrder?ut.groupOrder-a.groupOrder:ut.renderOrder!==a.renderOrder?ut.renderOrder-a.renderOrder:ut.material.id!==a.material.id?ut.material.id-a.material.id:ut.z!==a.z?ut.z-a.z:ut.id-a.id}function rT(ut,a){return ut.groupOrder!==a.groupOrder?ut.groupOrder-a.groupOrder:ut.renderOrder!==a.renderOrder?ut.renderOrder-a.renderOrder:ut.z!==a.z?a.z-ut.z:ut.id-a.id}function tE(){const ut=[];let a=0;const j=[],nt=[],it=[];function ot(ht,ft,wt,bt,St,Dt){let Rt=ut[a];return Rt===void 0?(Rt={id:ht.id,object:ht,geometry:ft,material:wt,groupOrder:bt,renderOrder:ht.renderOrder,z:St,group:Dt},ut[a]=Rt):(Rt.id=ht.id,Rt.object=ht,Rt.geometry=ft,Rt.material=wt,Rt.groupOrder=bt,Rt.renderOrder=ht.renderOrder,Rt.z=St,Rt.group=Dt),a++,Rt}return{opaque:j,transmissive:nt,transparent:it,init:function(){a=0,j.length=0,nt.length=0,it.length=0},push:function(ht,ft,wt,bt,St,Dt){const Rt=ot(ht,ft,wt,bt,St,Dt);wt.transmission>0?nt.push(Rt):wt.transparent===!0?it.push(Rt):j.push(Rt)},unshift:function(ht,ft,wt,bt,St,Dt){const Rt=ot(ht,ft,wt,bt,St,Dt);wt.transmission>0?nt.unshift(Rt):wt.transparent===!0?it.unshift(Rt):j.unshift(Rt)},finish:function(){for(let ht=a,ft=ut.length;ht<ft;ht++){const wt=ut[ht];if(wt.id===null)break;wt.id=null,wt.object=null,wt.geometry=null,wt.material=null,wt.group=null}},sort:function(ht,ft){j.length>1&&j.sort(ht||D2),nt.length>1&&nt.sort(ft||rT),it.length>1&&it.sort(ft||rT)}}}function eC(){let ut=new WeakMap;return{get:function(a,j){const nt=ut.get(a);let it;return nt===void 0?(it=new tE,ut.set(a,[it])):j>=nt.length?(it=new tE,nt.push(it)):it=nt[j],it},dispose:function(){ut=new WeakMap}}}function $_(){const ut={};return{get:function(a){if(ut[a.id]!==void 0)return ut[a.id];let j;switch(a.type){case"DirectionalLight":j={direction:new Rn,color:new us};break;case"SpotLight":j={position:new Rn,direction:new Rn,color:new us,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":j={position:new Rn,color:new us,distance:0,decay:0};break;case"HemisphereLight":j={direction:new Rn,skyColor:new us,groundColor:new us};break;case"RectAreaLight":j={color:new us,position:new Rn,halfWidth:new Rn,halfHeight:new Rn}}return ut[a.id]=j,j}}}let k2=0;function nE(ut,a){return(a.castShadow?2:0)-(ut.castShadow?2:0)+(a.map?1:0)-(ut.map?1:0)}function rw(ut,a){const j=new $_,nt=function(){const wt={};return{get:function(bt){if(wt[bt.id]!==void 0)return wt[bt.id];let St;switch(bt.type){case"DirectionalLight":case"SpotLight":St={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Br};break;case"PointLight":St={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Br,shadowCameraNear:1,shadowCameraFar:1e3}}return wt[bt.id]=St,St}}}(),it={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let wt=0;wt<9;wt++)it.probe.push(new Rn);const ot=new Rn,ht=new ro,ft=new ro;return{setup:function(wt,bt){let St=0,Dt=0,Rt=0;for(let jn=0;jn<9;jn++)it.probe[jn].set(0,0,0);let kt=0,Ot=0,Gt=0,Nt=0,zt=0,qt=0,$t=0,En=0,gn=0,vn=0;wt.sort(nE);const Un=bt===!0?Math.PI:1;for(let jn=0,sr=wt.length;jn<sr;jn++){const Vn=wt[jn],_r=Vn.color,xr=Vn.intensity,Gr=Vn.distance,ns=Vn.shadow&&Vn.shadow.map?Vn.shadow.map.texture:null;if(Vn.isAmbientLight)St+=_r.r*xr*Un,Dt+=_r.g*xr*Un,Rt+=_r.b*xr*Un;else if(Vn.isLightProbe)for(let Vr=0;Vr<9;Vr++)it.probe[Vr].addScaledVector(Vn.sh.coefficients[Vr],xr);else if(Vn.isDirectionalLight){const Vr=j.get(Vn);if(Vr.color.copy(Vn.color).multiplyScalar(Vn.intensity*Un),Vn.castShadow){const Tr=Vn.shadow,Yr=nt.get(Vn);Yr.shadowBias=Tr.bias,Yr.shadowNormalBias=Tr.normalBias,Yr.shadowRadius=Tr.radius,Yr.shadowMapSize=Tr.mapSize,it.directionalShadow[kt]=Yr,it.directionalShadowMap[kt]=ns,it.directionalShadowMatrix[kt]=Vn.shadow.matrix,qt++}it.directional[kt]=Vr,kt++}else if(Vn.isSpotLight){const Vr=j.get(Vn);Vr.position.setFromMatrixPosition(Vn.matrixWorld),Vr.color.copy(_r).multiplyScalar(xr*Un),Vr.distance=Gr,Vr.coneCos=Math.cos(Vn.angle),Vr.penumbraCos=Math.cos(Vn.angle*(1-Vn.penumbra)),Vr.decay=Vn.decay,it.spot[Gt]=Vr;const Tr=Vn.shadow;if(Vn.map&&(it.spotLightMap[gn]=Vn.map,gn++,Tr.updateMatrices(Vn),Vn.castShadow&&vn++),it.spotLightMatrix[Gt]=Tr.matrix,Vn.castShadow){const Yr=nt.get(Vn);Yr.shadowBias=Tr.bias,Yr.shadowNormalBias=Tr.normalBias,Yr.shadowRadius=Tr.radius,Yr.shadowMapSize=Tr.mapSize,it.spotShadow[Gt]=Yr,it.spotShadowMap[Gt]=ns,En++}Gt++}else if(Vn.isRectAreaLight){const Vr=j.get(Vn);Vr.color.copy(_r).multiplyScalar(xr),Vr.halfWidth.set(.5*Vn.width,0,0),Vr.halfHeight.set(0,.5*Vn.height,0),it.rectArea[Nt]=Vr,Nt++}else if(Vn.isPointLight){const Vr=j.get(Vn);if(Vr.color.copy(Vn.color).multiplyScalar(Vn.intensity*Un),Vr.distance=Vn.distance,Vr.decay=Vn.decay,Vn.castShadow){const Tr=Vn.shadow,Yr=nt.get(Vn);Yr.shadowBias=Tr.bias,Yr.shadowNormalBias=Tr.normalBias,Yr.shadowRadius=Tr.radius,Yr.shadowMapSize=Tr.mapSize,Yr.shadowCameraNear=Tr.camera.near,Yr.shadowCameraFar=Tr.camera.far,it.pointShadow[Ot]=Yr,it.pointShadowMap[Ot]=ns,it.pointShadowMatrix[Ot]=Vn.shadow.matrix,$t++}it.point[Ot]=Vr,Ot++}else if(Vn.isHemisphereLight){const Vr=j.get(Vn);Vr.skyColor.copy(Vn.color).multiplyScalar(xr*Un),Vr.groundColor.copy(Vn.groundColor).multiplyScalar(xr*Un),it.hemi[zt]=Vr,zt++}}Nt>0&&(a.isWebGL2||ut.has("OES_texture_float_linear")===!0?(it.rectAreaLTC1=ls.LTC_FLOAT_1,it.rectAreaLTC2=ls.LTC_FLOAT_2):ut.has("OES_texture_half_float_linear")===!0?(it.rectAreaLTC1=ls.LTC_HALF_1,it.rectAreaLTC2=ls.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),it.ambient[0]=St,it.ambient[1]=Dt,it.ambient[2]=Rt;const $n=it.hash;$n.directionalLength===kt&&$n.pointLength===Ot&&$n.spotLength===Gt&&$n.rectAreaLength===Nt&&$n.hemiLength===zt&&$n.numDirectionalShadows===qt&&$n.numPointShadows===$t&&$n.numSpotShadows===En&&$n.numSpotMaps===gn||(it.directional.length=kt,it.spot.length=Gt,it.rectArea.length=Nt,it.point.length=Ot,it.hemi.length=zt,it.directionalShadow.length=qt,it.directionalShadowMap.length=qt,it.pointShadow.length=$t,it.pointShadowMap.length=$t,it.spotShadow.length=En,it.spotShadowMap.length=En,it.directionalShadowMatrix.length=qt,it.pointShadowMatrix.length=$t,it.spotLightMatrix.length=En+gn-vn,it.spotLightMap.length=gn,it.numSpotLightShadowsWithMaps=vn,$n.directionalLength=kt,$n.pointLength=Ot,$n.spotLength=Gt,$n.rectAreaLength=Nt,$n.hemiLength=zt,$n.numDirectionalShadows=qt,$n.numPointShadows=$t,$n.numSpotShadows=En,$n.numSpotMaps=gn,it.version=k2++)},setupView:function(wt,bt){let St=0,Dt=0,Rt=0,kt=0,Ot=0;const Gt=bt.matrixWorldInverse;for(let Nt=0,zt=wt.length;Nt<zt;Nt++){const qt=wt[Nt];if(qt.isDirectionalLight){const $t=it.directional[St];$t.direction.setFromMatrixPosition(qt.matrixWorld),ot.setFromMatrixPosition(qt.target.matrixWorld),$t.direction.sub(ot),$t.direction.transformDirection(Gt),St++}else if(qt.isSpotLight){const $t=it.spot[Rt];$t.position.setFromMatrixPosition(qt.matrixWorld),$t.position.applyMatrix4(Gt),$t.direction.setFromMatrixPosition(qt.matrixWorld),ot.setFromMatrixPosition(qt.target.matrixWorld),$t.direction.sub(ot),$t.direction.transformDirection(Gt),Rt++}else if(qt.isRectAreaLight){const $t=it.rectArea[kt];$t.position.setFromMatrixPosition(qt.matrixWorld),$t.position.applyMatrix4(Gt),ft.identity(),ht.copy(qt.matrixWorld),ht.premultiply(Gt),ft.extractRotation(ht),$t.halfWidth.set(.5*qt.width,0,0),$t.halfHeight.set(0,.5*qt.height,0),$t.halfWidth.applyMatrix4(ft),$t.halfHeight.applyMatrix4(ft),kt++}else if(qt.isPointLight){const $t=it.point[Dt];$t.position.setFromMatrixPosition(qt.matrixWorld),$t.position.applyMatrix4(Gt),Dt++}else if(qt.isHemisphereLight){const $t=it.hemi[Ot];$t.direction.setFromMatrixPosition(qt.matrixWorld),$t.direction.transformDirection(Gt),Ot++}}},state:it}}function Rx(ut,a){const j=new rw(ut,a),nt=[],it=[];return{init:function(){nt.length=0,it.length=0},state:{lightsArray:nt,shadowsArray:it,lights:j},setupLights:function(ot){j.setup(nt,ot)},setupLightsView:function(ot){j.setupView(nt,ot)},pushLight:function(ot){nt.push(ot)},pushShadow:function(ot){it.push(ot)}}}function tC(ut,a){let j=new WeakMap;return{get:function(nt,it=0){const ot=j.get(nt);let ht;return ot===void 0?(ht=new Rx(ut,a),j.set(nt,[ht])):it>=ot.length?(ht=new Rx(ut,a),ot.push(ht)):ht=ot[it],ht},dispose:function(){j=new WeakMap}}}class sw extends ku{constructor(a){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=rs,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(a)}copy(a){return super.copy(a),this.depthPacking=a.depthPacking,this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this}}class ow extends ku{constructor(a){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(a)}copy(a){return super.copy(a),this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this}}const sB=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,oB=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function B2(ut,a,j){let nt=new W1;const it=new Br,ot=new Br,ht=new No,ft=new sw({depthPacking:wu}),wt=new ow,bt={},St=j.maxTextureSize,Dt={[Pn]:nn,[nn]:Pn,[Hn]:Hn},Rt=new p_({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Br},radius:{value:4}},vertexShader:sB,fragmentShader:oB}),kt=Rt.clone();kt.defines.HORIZONTAL_PASS=1;const Ot=new Vt;Ot.setAttribute("position",new Jo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Gt=new Ou(Ot,Rt),Nt=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_n;let zt=this.type;function qt(gn,vn){const Un=a.update(Gt);Rt.defines.VSM_SAMPLES!==gn.blurSamples&&(Rt.defines.VSM_SAMPLES=gn.blurSamples,kt.defines.VSM_SAMPLES=gn.blurSamples,Rt.needsUpdate=!0,kt.needsUpdate=!0),gn.mapPass===null&&(gn.mapPass=new xu(it.x,it.y)),Rt.uniforms.shadow_pass.value=gn.map.texture,Rt.uniforms.resolution.value=gn.mapSize,Rt.uniforms.radius.value=gn.radius,ut.setRenderTarget(gn.mapPass),ut.clear(),ut.renderBufferDirect(vn,null,Un,Rt,Gt,null),kt.uniforms.shadow_pass.value=gn.mapPass.texture,kt.uniforms.resolution.value=gn.mapSize,kt.uniforms.radius.value=gn.radius,ut.setRenderTarget(gn.map),ut.clear(),ut.renderBufferDirect(vn,null,Un,kt,Gt,null)}function $t(gn,vn,Un,$n){let jn=null;const sr=Un.isPointLight===!0?gn.customDistanceMaterial:gn.customDepthMaterial;if(sr!==void 0)jn=sr;else if(jn=Un.isPointLight===!0?wt:ft,ut.localClippingEnabled&&vn.clipShadows===!0&&Array.isArray(vn.clippingPlanes)&&vn.clippingPlanes.length!==0||vn.displacementMap&&vn.displacementScale!==0||vn.alphaMap&&vn.alphaTest>0||vn.map&&vn.alphaTest>0){const Vn=jn.uuid,_r=vn.uuid;let xr=bt[Vn];xr===void 0&&(xr={},bt[Vn]=xr);let Gr=xr[_r];Gr===void 0&&(Gr=jn.clone(),xr[_r]=Gr),jn=Gr}return jn.visible=vn.visible,jn.wireframe=vn.wireframe,jn.side=$n===ln?vn.shadowSide!==null?vn.shadowSide:vn.side:vn.shadowSide!==null?vn.shadowSide:Dt[vn.side],jn.alphaMap=vn.alphaMap,jn.alphaTest=vn.alphaTest,jn.map=vn.map,jn.clipShadows=vn.clipShadows,jn.clippingPlanes=vn.clippingPlanes,jn.clipIntersection=vn.clipIntersection,jn.displacementMap=vn.displacementMap,jn.displacementScale=vn.displacementScale,jn.displacementBias=vn.displacementBias,jn.wireframeLinewidth=vn.wireframeLinewidth,jn.linewidth=vn.linewidth,Un.isPointLight===!0&&jn.isMeshDistanceMaterial===!0&&(ut.properties.get(jn).light=Un),jn}function En(gn,vn,Un,$n,jn){if(gn.visible===!1)return;if(gn.layers.test(vn.layers)&&(gn.isMesh||gn.isLine||gn.isPoints)&&(gn.castShadow||gn.receiveShadow&&jn===ln)&&(!gn.frustumCulled||nt.intersectsObject(gn))){gn.modelViewMatrix.multiplyMatrices(Un.matrixWorldInverse,gn.matrixWorld);const Vn=a.update(gn),_r=gn.material;if(Array.isArray(_r)){const xr=Vn.groups;for(let Gr=0,ns=xr.length;Gr<ns;Gr++){const Vr=xr[Gr],Tr=_r[Vr.materialIndex];if(Tr&&Tr.visible){const Yr=$t(gn,Tr,$n,jn);ut.renderBufferDirect(Un,null,Vn,Yr,gn,Vr)}}}else if(_r.visible){const xr=$t(gn,_r,$n,jn);ut.renderBufferDirect(Un,null,Vn,xr,gn,null)}}const sr=gn.children;for(let Vn=0,_r=sr.length;Vn<_r;Vn++)En(sr[Vn],vn,Un,$n,jn)}this.render=function(gn,vn,Un){if(Nt.enabled===!1||Nt.autoUpdate===!1&&Nt.needsUpdate===!1||gn.length===0)return;const $n=ut.getRenderTarget(),jn=ut.getActiveCubeFace(),sr=ut.getActiveMipmapLevel(),Vn=ut.state;Vn.setBlending(Xt),Vn.buffers.color.setClear(1,1,1,1),Vn.buffers.depth.setTest(!0),Vn.setScissorTest(!1);const _r=zt!==ln&&this.type===ln,xr=zt===ln&&this.type!==ln;for(let Gr=0,ns=gn.length;Gr<ns;Gr++){const Vr=gn[Gr],Tr=Vr.shadow;if(Tr===void 0){console.warn("THREE.WebGLShadowMap:",Vr,"has no shadow.");continue}if(Tr.autoUpdate===!1&&Tr.needsUpdate===!1)continue;it.copy(Tr.mapSize);const Yr=Tr.getFrameExtents();if(it.multiply(Yr),ot.copy(Tr.mapSize),(it.x>St||it.y>St)&&(it.x>St&&(ot.x=Math.floor(St/Yr.x),it.x=ot.x*Yr.x,Tr.mapSize.x=ot.x),it.y>St&&(ot.y=Math.floor(St/Yr.y),it.y=ot.y*Yr.y,Tr.mapSize.y=ot.y)),Tr.map===null||_r===!0||xr===!0){const mr=this.type!==ln?{minFilter:Yo,magFilter:Yo}:{};Tr.map!==null&&Tr.map.dispose(),Tr.map=new xu(it.x,it.y,mr),Tr.map.texture.name=Vr.name+".shadowMap",Tr.camera.updateProjectionMatrix()}ut.setRenderTarget(Tr.map),ut.clear();const ts=Tr.getViewportCount();for(let mr=0;mr<ts;mr++){const Dr=Tr.getViewport(mr);ht.set(ot.x*Dr.x,ot.y*Dr.y,ot.x*Dr.z,ot.y*Dr.w),Vn.viewport(ht),Tr.updateMatrices(Vr,mr),nt=Tr.getFrustum(),En(vn,Un,Tr.camera,Vr,this.type)}Tr.isPointLightShadow!==!0&&this.type===ln&&qt(Tr,Un),Tr.needsUpdate=!1}zt=this.type,Nt.needsUpdate=!1,ut.setRenderTarget($n,jn,sr)}}function O2(ut,a,j){const nt=j.isWebGL2,it=new function(){let fn=!1;const Gn=new No;let qn=null;const Er=new No(0,0,0,0);return{setMask:function(br){qn===br||fn||(ut.colorMask(br,br,br,br),qn=br)},setLocked:function(br){fn=br},setClear:function(br,Rr,is,ms,Ps){Ps===!0&&(br*=ms,Rr*=ms,is*=ms),Gn.set(br,Rr,is,ms),Er.equals(Gn)===!1&&(ut.clearColor(br,Rr,is,ms),Er.copy(Gn))},reset:function(){fn=!1,qn=null,Er.set(-1,0,0,0)}}},ot=new function(){let fn=!1,Gn=null,qn=null,Er=null;return{setTest:function(br){br?ss(ut.DEPTH_TEST):Hs(ut.DEPTH_TEST)},setMask:function(br){Gn===br||fn||(ut.depthMask(br),Gn=br)},setFunc:function(br){if(qn!==br){switch(br){case _i:ut.depthFunc(ut.NEVER);break;case rn:ut.depthFunc(ut.ALWAYS);break;case Dn:ut.depthFunc(ut.LESS);break;case Qn:ut.depthFunc(ut.LEQUAL);break;case jr:ut.depthFunc(ut.EQUAL);break;case hr:ut.depthFunc(ut.GEQUAL);break;case Kr:ut.depthFunc(ut.GREATER);break;case Js:ut.depthFunc(ut.NOTEQUAL);break;default:ut.depthFunc(ut.LEQUAL)}qn=br}},setLocked:function(br){fn=br},setClear:function(br){Er!==br&&(ut.clearDepth(br),Er=br)},reset:function(){fn=!1,Gn=null,qn=null,Er=null}}},ht=new function(){let fn=!1,Gn=null,qn=null,Er=null,br=null,Rr=null,is=null,ms=null,Ps=null;return{setTest:function(ds){fn||(ds?ss(ut.STENCIL_TEST):Hs(ut.STENCIL_TEST))},setMask:function(ds){Gn===ds||fn||(ut.stencilMask(ds),Gn=ds)},setFunc:function(ds,Ys,qs){qn===ds&&Er===Ys&&br===qs||(ut.stencilFunc(ds,Ys,qs),qn=ds,Er=Ys,br=qs)},setOp:function(ds,Ys,qs){Rr===ds&&is===Ys&&ms===qs||(ut.stencilOp(ds,Ys,qs),Rr=ds,is=Ys,ms=qs)},setLocked:function(ds){fn=ds},setClear:function(ds){Ps!==ds&&(ut.clearStencil(ds),Ps=ds)},reset:function(){fn=!1,Gn=null,qn=null,Er=null,br=null,Rr=null,is=null,ms=null,Ps=null}}},ft=new WeakMap,wt=new WeakMap;let bt={},St={},Dt=new WeakMap,Rt=[],kt=null,Ot=!1,Gt=null,Nt=null,zt=null,qt=null,$t=null,En=null,gn=null,vn=!1,Un=null,$n=null,jn=null,sr=null,Vn=null;const _r=ut.getParameter(ut.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let xr=!1,Gr=0;const ns=ut.getParameter(ut.VERSION);ns.indexOf("WebGL")!==-1?(Gr=parseFloat(/^WebGL (\d)/.exec(ns)[1]),xr=Gr>=1):ns.indexOf("OpenGL ES")!==-1&&(Gr=parseFloat(/^OpenGL ES (\d)/.exec(ns)[1]),xr=Gr>=2);let Vr=null,Tr={};const Yr=ut.getParameter(ut.SCISSOR_BOX),ts=ut.getParameter(ut.VIEWPORT),mr=new No().fromArray(Yr),Dr=new No().fromArray(ts);function $r(fn,Gn,qn,Er){const br=new Uint8Array(4),Rr=ut.createTexture();ut.bindTexture(fn,Rr),ut.texParameteri(fn,ut.TEXTURE_MIN_FILTER,ut.NEAREST),ut.texParameteri(fn,ut.TEXTURE_MAG_FILTER,ut.NEAREST);for(let is=0;is<qn;is++)!nt||fn!==ut.TEXTURE_3D&&fn!==ut.TEXTURE_2D_ARRAY?ut.texImage2D(Gn+is,0,ut.RGBA,1,1,0,ut.RGBA,ut.UNSIGNED_BYTE,br):ut.texImage3D(Gn,0,ut.RGBA,1,1,Er,0,ut.RGBA,ut.UNSIGNED_BYTE,br);return Rr}const Ur={};function ss(fn){bt[fn]!==!0&&(ut.enable(fn),bt[fn]=!0)}function Hs(fn){bt[fn]!==!1&&(ut.disable(fn),bt[fn]=!1)}Ur[ut.TEXTURE_2D]=$r(ut.TEXTURE_2D,ut.TEXTURE_2D,1),Ur[ut.TEXTURE_CUBE_MAP]=$r(ut.TEXTURE_CUBE_MAP,ut.TEXTURE_CUBE_MAP_POSITIVE_X,6),nt&&(Ur[ut.TEXTURE_2D_ARRAY]=$r(ut.TEXTURE_2D_ARRAY,ut.TEXTURE_2D_ARRAY,1,1),Ur[ut.TEXTURE_3D]=$r(ut.TEXTURE_3D,ut.TEXTURE_3D,1,1)),it.setClear(0,0,0,1),ot.setClear(1),ht.setClear(0),ss(ut.DEPTH_TEST),ot.setFunc(Qn),Yn(!1),On(Ut),ss(ut.CULL_FACE),lr(Xt);const Fn={[Wt]:ut.FUNC_ADD,[Zt]:ut.FUNC_SUBTRACT,[Bn]:ut.FUNC_REVERSE_SUBTRACT};if(nt)Fn[Qt]=ut.MIN,Fn[Kt]=ut.MAX;else{const fn=a.get("EXT_blend_minmax");fn!==null&&(Fn[Qt]=fn.MIN_EXT,Fn[Kt]=fn.MAX_EXT)}const Sn={[an]:ut.ZERO,[yn]:ut.ONE,[Xn]:ut.SRC_COLOR,[vr]:ut.SRC_ALPHA,[Sr]:ut.SRC_ALPHA_SATURATE,[cr]:ut.DST_COLOR,[ir]:ut.DST_ALPHA,[rr]:ut.ONE_MINUS_SRC_COLOR,[Wn]:ut.ONE_MINUS_SRC_ALPHA,[ur]:ut.ONE_MINUS_DST_COLOR,[zn]:ut.ONE_MINUS_DST_ALPHA};function lr(fn,Gn,qn,Er,br,Rr,is,ms){if(fn!==Xt){if(Ot===!1&&(ss(ut.BLEND),Ot=!0),fn===jt)br=br||Gn,Rr=Rr||qn,is=is||Er,Gn===Nt&&br===$t||(ut.blendEquationSeparate(Fn[Gn],Fn[br]),Nt=Gn,$t=br),qn===zt&&Er===qt&&Rr===En&&is===gn||(ut.blendFuncSeparate(Sn[qn],Sn[Er],Sn[Rr],Sn[is]),zt=qn,qt=Er,En=Rr,gn=is),Gt=fn,vn=!1;else if(fn!==Gt||ms!==vn){if(Nt===Wt&&$t===Wt||(ut.blendEquation(ut.FUNC_ADD),Nt=Wt,$t=Wt),ms)switch(fn){case dn:ut.blendFuncSeparate(ut.ONE,ut.ONE_MINUS_SRC_ALPHA,ut.ONE,ut.ONE_MINUS_SRC_ALPHA);break;case Nn:ut.blendFunc(ut.ONE,ut.ONE);break;case An:ut.blendFuncSeparate(ut.ZERO,ut.ONE_MINUS_SRC_COLOR,ut.ZERO,ut.ONE);break;case kn:ut.blendFuncSeparate(ut.ZERO,ut.SRC_COLOR,ut.ZERO,ut.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",fn)}else switch(fn){case dn:ut.blendFuncSeparate(ut.SRC_ALPHA,ut.ONE_MINUS_SRC_ALPHA,ut.ONE,ut.ONE_MINUS_SRC_ALPHA);break;case Nn:ut.blendFunc(ut.SRC_ALPHA,ut.ONE);break;case An:ut.blendFuncSeparate(ut.ZERO,ut.ONE_MINUS_SRC_COLOR,ut.ZERO,ut.ONE);break;case kn:ut.blendFunc(ut.ZERO,ut.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",fn)}zt=null,qt=null,En=null,gn=null,Gt=fn,vn=ms}}else Ot===!0&&(Hs(ut.BLEND),Ot=!1)}function Yn(fn){Un!==fn&&(fn?ut.frontFace(ut.CW):ut.frontFace(ut.CCW),Un=fn)}function On(fn){fn!==Pt?(ss(ut.CULL_FACE),fn!==$n&&(fn===Ut?ut.cullFace(ut.BACK):fn===Ft?ut.cullFace(ut.FRONT):ut.cullFace(ut.FRONT_AND_BACK))):Hs(ut.CULL_FACE),$n=fn}function Zn(fn,Gn,qn){fn?(ss(ut.POLYGON_OFFSET_FILL),sr===Gn&&Vn===qn||(ut.polygonOffset(Gn,qn),sr=Gn,Vn=qn)):Hs(ut.POLYGON_OFFSET_FILL)}return{buffers:{color:it,depth:ot,stencil:ht},enable:ss,disable:Hs,bindFramebuffer:function(fn,Gn){return St[fn]!==Gn&&(ut.bindFramebuffer(fn,Gn),St[fn]=Gn,nt&&(fn===ut.DRAW_FRAMEBUFFER&&(St[ut.FRAMEBUFFER]=Gn),fn===ut.FRAMEBUFFER&&(St[ut.DRAW_FRAMEBUFFER]=Gn)),!0)},drawBuffers:function(fn,Gn){let qn=Rt,Er=!1;if(fn)if(qn=Dt.get(Gn),qn===void 0&&(qn=[],Dt.set(Gn,qn)),fn.isWebGLMultipleRenderTargets){const br=fn.texture;if(qn.length!==br.length||qn[0]!==ut.COLOR_ATTACHMENT0){for(let Rr=0,is=br.length;Rr<is;Rr++)qn[Rr]=ut.COLOR_ATTACHMENT0+Rr;qn.length=br.length,Er=!0}}else qn[0]!==ut.COLOR_ATTACHMENT0&&(qn[0]=ut.COLOR_ATTACHMENT0,Er=!0);else qn[0]!==ut.BACK&&(qn[0]=ut.BACK,Er=!0);Er&&(j.isWebGL2?ut.drawBuffers(qn):a.get("WEBGL_draw_buffers").drawBuffersWEBGL(qn))},useProgram:function(fn){return kt!==fn&&(ut.useProgram(fn),kt=fn,!0)},setBlending:lr,setMaterial:function(fn,Gn){fn.side===Hn?Hs(ut.CULL_FACE):ss(ut.CULL_FACE);let qn=fn.side===nn;Gn&&(qn=!qn),Yn(qn),fn.blending===dn&&fn.transparent===!1?lr(Xt):lr(fn.blending,fn.blendEquation,fn.blendSrc,fn.blendDst,fn.blendEquationAlpha,fn.blendSrcAlpha,fn.blendDstAlpha,fn.premultipliedAlpha),ot.setFunc(fn.depthFunc),ot.setTest(fn.depthTest),ot.setMask(fn.depthWrite),it.setMask(fn.colorWrite);const Er=fn.stencilWrite;ht.setTest(Er),Er&&(ht.setMask(fn.stencilWriteMask),ht.setFunc(fn.stencilFunc,fn.stencilRef,fn.stencilFuncMask),ht.setOp(fn.stencilFail,fn.stencilZFail,fn.stencilZPass)),Zn(fn.polygonOffset,fn.polygonOffsetFactor,fn.polygonOffsetUnits),fn.alphaToCoverage===!0?ss(ut.SAMPLE_ALPHA_TO_COVERAGE):Hs(ut.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Yn,setCullFace:On,setLineWidth:function(fn){fn!==jn&&(xr&&ut.lineWidth(fn),jn=fn)},setPolygonOffset:Zn,setScissorTest:function(fn){fn?ss(ut.SCISSOR_TEST):Hs(ut.SCISSOR_TEST)},activeTexture:function(fn){fn===void 0&&(fn=ut.TEXTURE0+_r-1),Vr!==fn&&(ut.activeTexture(fn),Vr=fn)},bindTexture:function(fn,Gn,qn){qn===void 0&&(qn=Vr===null?ut.TEXTURE0+_r-1:Vr);let Er=Tr[qn];Er===void 0&&(Er={type:void 0,texture:void 0},Tr[qn]=Er),Er.type===fn&&Er.texture===Gn||(Vr!==qn&&(ut.activeTexture(qn),Vr=qn),ut.bindTexture(fn,Gn||Ur[fn]),Er.type=fn,Er.texture=Gn)},unbindTexture:function(){const fn=Tr[Vr];fn!==void 0&&fn.type!==void 0&&(ut.bindTexture(fn.type,null),fn.type=void 0,fn.texture=void 0)},compressedTexImage2D:function(){try{ut.compressedTexImage2D.apply(ut,arguments)}catch(fn){console.error("THREE.WebGLState:",fn)}},compressedTexImage3D:function(){try{ut.compressedTexImage3D.apply(ut,arguments)}catch(fn){console.error("THREE.WebGLState:",fn)}},texImage2D:function(){try{ut.texImage2D.apply(ut,arguments)}catch(fn){console.error("THREE.WebGLState:",fn)}},texImage3D:function(){try{ut.texImage3D.apply(ut,arguments)}catch(fn){console.error("THREE.WebGLState:",fn)}},updateUBOMapping:function(fn,Gn){let qn=wt.get(Gn);qn===void 0&&(qn=new WeakMap,wt.set(Gn,qn));let Er=qn.get(fn);Er===void 0&&(Er=ut.getUniformBlockIndex(Gn,fn.name),qn.set(fn,Er))},uniformBlockBinding:function(fn,Gn){const qn=wt.get(Gn).get(fn);ft.get(Gn)!==qn&&(ut.uniformBlockBinding(Gn,qn,fn.__bindingPointIndex),ft.set(Gn,qn))},texStorage2D:function(){try{ut.texStorage2D.apply(ut,arguments)}catch(fn){console.error("THREE.WebGLState:",fn)}},texStorage3D:function(){try{ut.texStorage3D.apply(ut,arguments)}catch(fn){console.error("THREE.WebGLState:",fn)}},texSubImage2D:function(){try{ut.texSubImage2D.apply(ut,arguments)}catch(fn){console.error("THREE.WebGLState:",fn)}},texSubImage3D:function(){try{ut.texSubImage3D.apply(ut,arguments)}catch(fn){console.error("THREE.WebGLState:",fn)}},compressedTexSubImage2D:function(){try{ut.compressedTexSubImage2D.apply(ut,arguments)}catch(fn){console.error("THREE.WebGLState:",fn)}},compressedTexSubImage3D:function(){try{ut.compressedTexSubImage3D.apply(ut,arguments)}catch(fn){console.error("THREE.WebGLState:",fn)}},scissor:function(fn){mr.equals(fn)===!1&&(ut.scissor(fn.x,fn.y,fn.z,fn.w),mr.copy(fn))},viewport:function(fn){Dr.equals(fn)===!1&&(ut.viewport(fn.x,fn.y,fn.z,fn.w),Dr.copy(fn))},reset:function(){ut.disable(ut.BLEND),ut.disable(ut.CULL_FACE),ut.disable(ut.DEPTH_TEST),ut.disable(ut.POLYGON_OFFSET_FILL),ut.disable(ut.SCISSOR_TEST),ut.disable(ut.STENCIL_TEST),ut.disable(ut.SAMPLE_ALPHA_TO_COVERAGE),ut.blendEquation(ut.FUNC_ADD),ut.blendFunc(ut.ONE,ut.ZERO),ut.blendFuncSeparate(ut.ONE,ut.ZERO,ut.ONE,ut.ZERO),ut.colorMask(!0,!0,!0,!0),ut.clearColor(0,0,0,0),ut.depthMask(!0),ut.depthFunc(ut.LESS),ut.clearDepth(1),ut.stencilMask(4294967295),ut.stencilFunc(ut.ALWAYS,0,4294967295),ut.stencilOp(ut.KEEP,ut.KEEP,ut.KEEP),ut.clearStencil(0),ut.cullFace(ut.BACK),ut.frontFace(ut.CCW),ut.polygonOffset(0,0),ut.activeTexture(ut.TEXTURE0),ut.bindFramebuffer(ut.FRAMEBUFFER,null),nt===!0&&(ut.bindFramebuffer(ut.DRAW_FRAMEBUFFER,null),ut.bindFramebuffer(ut.READ_FRAMEBUFFER,null)),ut.useProgram(null),ut.lineWidth(1),ut.scissor(0,0,ut.canvas.width,ut.canvas.height),ut.viewport(0,0,ut.canvas.width,ut.canvas.height),bt={},Vr=null,Tr={},St={},Dt=new WeakMap,Rt=[],kt=null,Ot=!1,Gt=null,Nt=null,zt=null,qt=null,$t=null,En=null,gn=null,vn=!1,Un=null,$n=null,jn=null,sr=null,Vn=null,mr.set(0,0,ut.canvas.width,ut.canvas.height),Dr.set(0,0,ut.canvas.width,ut.canvas.height),it.reset(),ot.reset(),ht.reset()}}}function vo(ut,a,j,nt,it,ot,ht){const ft=it.isWebGL2,wt=it.maxTextures,bt=it.maxCubemapSize,St=it.maxTextureSize,Dt=it.maxSamples,Rt=a.has("WEBGL_multisampled_render_to_texture")?a.get("WEBGL_multisampled_render_to_texture"):null,kt=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),Ot=new WeakMap;let Gt;const Nt=new WeakMap;let zt=!1;try{zt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function qt(Fn,Sn){return zt?new OffscreenCanvas(Fn,Sn):Cy("canvas")}function $t(Fn,Sn,lr,Yn){let On=1;if((Fn.width>Yn||Fn.height>Yn)&&(On=Yn/Math.max(Fn.width,Fn.height)),On<1||Sn===!0){if(typeof HTMLImageElement<"u"&&Fn instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Fn instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Fn instanceof ImageBitmap){const Zn=Sn?l_:Math.floor,fn=Zn(On*Fn.width),Gn=Zn(On*Fn.height);Gt===void 0&&(Gt=qt(fn,Gn));const qn=lr?qt(fn,Gn):Gt;return qn.width=fn,qn.height=Gn,qn.getContext("2d").drawImage(Fn,0,0,fn,Gn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Fn.width+"x"+Fn.height+") to ("+fn+"x"+Gn+")."),qn}return"data"in Fn&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Fn.width+"x"+Fn.height+")."),Fn}return Fn}function En(Fn){return Sy(Fn.width)&&Sy(Fn.height)}function gn(Fn,Sn){return Fn.generateMipmaps&&Sn&&Fn.minFilter!==Yo&&Fn.minFilter!==Il}function vn(Fn){ut.generateMipmap(Fn)}function Un(Fn,Sn,lr,Yn,On=!1){if(ft===!1)return Sn;if(Fn!==null){if(ut[Fn]!==void 0)return ut[Fn];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Fn+"'")}let Zn=Sn;return Sn===ut.RED&&(lr===ut.FLOAT&&(Zn=ut.R32F),lr===ut.HALF_FLOAT&&(Zn=ut.R16F),lr===ut.UNSIGNED_BYTE&&(Zn=ut.R8)),Sn===ut.RG&&(lr===ut.FLOAT&&(Zn=ut.RG32F),lr===ut.HALF_FLOAT&&(Zn=ut.RG16F),lr===ut.UNSIGNED_BYTE&&(Zn=ut.RG8)),Sn===ut.RGBA&&(lr===ut.FLOAT&&(Zn=ut.RGBA32F),lr===ut.HALF_FLOAT&&(Zn=ut.RGBA16F),lr===ut.UNSIGNED_BYTE&&(Zn=Yn===Bs&&On===!1?ut.SRGB8_ALPHA8:ut.RGBA8),lr===ut.UNSIGNED_SHORT_4_4_4_4&&(Zn=ut.RGBA4),lr===ut.UNSIGNED_SHORT_5_5_5_1&&(Zn=ut.RGB5_A1)),Zn!==ut.R16F&&Zn!==ut.R32F&&Zn!==ut.RG16F&&Zn!==ut.RG32F&&Zn!==ut.RGBA16F&&Zn!==ut.RGBA32F||a.get("EXT_color_buffer_float"),Zn}function $n(Fn,Sn,lr){return gn(Fn,lr)===!0||Fn.isFramebufferTexture&&Fn.minFilter!==Yo&&Fn.minFilter!==Il?Math.log2(Math.max(Sn.width,Sn.height))+1:Fn.mipmaps!==void 0&&Fn.mipmaps.length>0?Fn.mipmaps.length:Fn.isCompressedTexture&&Array.isArray(Fn.image)?Sn.mipmaps.length:1}function jn(Fn){return Fn===Yo||Fn===$p||Fn===n_?ut.NEAREST:ut.LINEAR}function sr(Fn){const Sn=Fn.target;Sn.removeEventListener("dispose",sr),function(lr){const Yn=nt.get(lr);if(Yn.__webglInit===void 0)return;const On=lr.source,Zn=Nt.get(On);if(Zn){const fn=Zn[Yn.__cacheKey];fn.usedTimes--,fn.usedTimes===0&&_r(lr),Object.keys(Zn).length===0&&Nt.delete(On)}nt.remove(lr)}(Sn),Sn.isVideoTexture&&Ot.delete(Sn)}function Vn(Fn){const Sn=Fn.target;Sn.removeEventListener("dispose",Vn),function(lr){const Yn=lr.texture,On=nt.get(lr),Zn=nt.get(Yn);if(Zn.__webglTexture!==void 0&&(ut.deleteTexture(Zn.__webglTexture),ht.memory.textures--),lr.depthTexture&&lr.depthTexture.dispose(),lr.isWebGLCubeRenderTarget)for(let fn=0;fn<6;fn++)ut.deleteFramebuffer(On.__webglFramebuffer[fn]),On.__webglDepthbuffer&&ut.deleteRenderbuffer(On.__webglDepthbuffer[fn]);else{if(ut.deleteFramebuffer(On.__webglFramebuffer),On.__webglDepthbuffer&&ut.deleteRenderbuffer(On.__webglDepthbuffer),On.__webglMultisampledFramebuffer&&ut.deleteFramebuffer(On.__webglMultisampledFramebuffer),On.__webglColorRenderbuffer)for(let fn=0;fn<On.__webglColorRenderbuffer.length;fn++)On.__webglColorRenderbuffer[fn]&&ut.deleteRenderbuffer(On.__webglColorRenderbuffer[fn]);On.__webglDepthRenderbuffer&&ut.deleteRenderbuffer(On.__webglDepthRenderbuffer)}if(lr.isWebGLMultipleRenderTargets)for(let fn=0,Gn=Yn.length;fn<Gn;fn++){const qn=nt.get(Yn[fn]);qn.__webglTexture&&(ut.deleteTexture(qn.__webglTexture),ht.memory.textures--),nt.remove(Yn[fn])}nt.remove(Yn),nt.remove(lr)}(Sn)}function _r(Fn){const Sn=nt.get(Fn);ut.deleteTexture(Sn.__webglTexture);const lr=Fn.source;delete Nt.get(lr)[Sn.__cacheKey],ht.memory.textures--}let xr=0;function Gr(Fn,Sn){const lr=nt.get(Fn);if(Fn.isVideoTexture&&function(Yn){const On=ht.render.frame;Ot.get(Yn)!==On&&(Ot.set(Yn,On),Yn.update())}(Fn),Fn.isRenderTargetTexture===!1&&Fn.version>0&&lr.__version!==Fn.version){const Yn=Fn.image;if(Yn===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(Yn.complete!==!1)return void ts(lr,Fn,Sn);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}j.bindTexture(ut.TEXTURE_2D,lr.__webglTexture,ut.TEXTURE0+Sn)}const ns={[wm]:ut.REPEAT,[Tl]:ut.CLAMP_TO_EDGE,[tp]:ut.MIRRORED_REPEAT},Vr={[Yo]:ut.NEAREST,[$p]:ut.NEAREST_MIPMAP_NEAREST,[n_]:ut.NEAREST_MIPMAP_LINEAR,[Il]:ut.LINEAR,[yp]:ut.LINEAR_MIPMAP_NEAREST,[Au]:ut.LINEAR_MIPMAP_LINEAR};function Tr(Fn,Sn,lr){if(lr?(ut.texParameteri(Fn,ut.TEXTURE_WRAP_S,ns[Sn.wrapS]),ut.texParameteri(Fn,ut.TEXTURE_WRAP_T,ns[Sn.wrapT]),Fn!==ut.TEXTURE_3D&&Fn!==ut.TEXTURE_2D_ARRAY||ut.texParameteri(Fn,ut.TEXTURE_WRAP_R,ns[Sn.wrapR]),ut.texParameteri(Fn,ut.TEXTURE_MAG_FILTER,Vr[Sn.magFilter]),ut.texParameteri(Fn,ut.TEXTURE_MIN_FILTER,Vr[Sn.minFilter])):(ut.texParameteri(Fn,ut.TEXTURE_WRAP_S,ut.CLAMP_TO_EDGE),ut.texParameteri(Fn,ut.TEXTURE_WRAP_T,ut.CLAMP_TO_EDGE),Fn!==ut.TEXTURE_3D&&Fn!==ut.TEXTURE_2D_ARRAY||ut.texParameteri(Fn,ut.TEXTURE_WRAP_R,ut.CLAMP_TO_EDGE),Sn.wrapS===Tl&&Sn.wrapT===Tl||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),ut.texParameteri(Fn,ut.TEXTURE_MAG_FILTER,jn(Sn.magFilter)),ut.texParameteri(Fn,ut.TEXTURE_MIN_FILTER,jn(Sn.minFilter)),Sn.minFilter!==Yo&&Sn.minFilter!==Il&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),a.has("EXT_texture_filter_anisotropic")===!0){const Yn=a.get("EXT_texture_filter_anisotropic");if(Sn.magFilter===Yo||Sn.minFilter!==n_&&Sn.minFilter!==Au||Sn.type===yv&&a.has("OES_texture_float_linear")===!1||ft===!1&&Sn.type===Zp&&a.has("OES_texture_half_float_linear")===!1)return;(Sn.anisotropy>1||nt.get(Sn).__currentAnisotropy)&&(ut.texParameterf(Fn,Yn.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Sn.anisotropy,it.getMaxAnisotropy())),nt.get(Sn).__currentAnisotropy=Sn.anisotropy)}}function Yr(Fn,Sn){let lr=!1;Fn.__webglInit===void 0&&(Fn.__webglInit=!0,Sn.addEventListener("dispose",sr));const Yn=Sn.source;let On=Nt.get(Yn);On===void 0&&(On={},Nt.set(Yn,On));const Zn=function(fn){const Gn=[];return Gn.push(fn.wrapS),Gn.push(fn.wrapT),Gn.push(fn.wrapR||0),Gn.push(fn.magFilter),Gn.push(fn.minFilter),Gn.push(fn.anisotropy),Gn.push(fn.internalFormat),Gn.push(fn.format),Gn.push(fn.type),Gn.push(fn.generateMipmaps),Gn.push(fn.premultiplyAlpha),Gn.push(fn.flipY),Gn.push(fn.unpackAlignment),Gn.push(fn.colorSpace),Gn.join()}(Sn);if(Zn!==Fn.__cacheKey){On[Zn]===void 0&&(On[Zn]={texture:ut.createTexture(),usedTimes:0},ht.memory.textures++,lr=!0),On[Zn].usedTimes++;const fn=On[Fn.__cacheKey];fn!==void 0&&(On[Fn.__cacheKey].usedTimes--,fn.usedTimes===0&&_r(Sn)),Fn.__cacheKey=Zn,Fn.__webglTexture=On[Zn].texture}return lr}function ts(Fn,Sn,lr){let Yn=ut.TEXTURE_2D;(Sn.isDataArrayTexture||Sn.isCompressedArrayTexture)&&(Yn=ut.TEXTURE_2D_ARRAY),Sn.isData3DTexture&&(Yn=ut.TEXTURE_3D);const On=Yr(Fn,Sn),Zn=Sn.source;j.bindTexture(Yn,Fn.__webglTexture,ut.TEXTURE0+lr);const fn=nt.get(Zn);if(Zn.version!==fn.__version||On===!0){j.activeTexture(ut.TEXTURE0+lr),ut.pixelStorei(ut.UNPACK_FLIP_Y_WEBGL,Sn.flipY),ut.pixelStorei(ut.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Sn.premultiplyAlpha),ut.pixelStorei(ut.UNPACK_ALIGNMENT,Sn.unpackAlignment),ut.pixelStorei(ut.UNPACK_COLORSPACE_CONVERSION_WEBGL,ut.NONE);const Gn=function(Rs){return!ft&&(Rs.wrapS!==Tl||Rs.wrapT!==Tl||Rs.minFilter!==Yo&&Rs.minFilter!==Il)}(Sn)&&En(Sn.image)===!1;let qn=$t(Sn.image,Gn,!1,St);qn=Hs(Sn,qn);const Er=En(qn)||ft,br=ot.convert(Sn.format,Sn.colorSpace);let Rr,is=ot.convert(Sn.type),ms=Un(Sn.internalFormat,br,is,Sn.colorSpace);Tr(Yn,Sn,Er);const Ps=Sn.mipmaps,ds=ft&&Sn.isVideoTexture!==!0,Ys=fn.__version===void 0||On===!0,qs=$n(Sn,qn,Er);if(Sn.isDepthTexture)ms=ut.DEPTH_COMPONENT,ft?ms=Sn.type===yv?ut.DEPTH_COMPONENT32F:Sn.type===Pu?ut.DEPTH_COMPONENT24:Sn.type===O_?ut.DEPTH24_STENCIL8:ut.DEPTH_COMPONENT16:Sn.type===yv&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Sn.format===xm&&ms===ut.DEPTH_COMPONENT&&Sn.type!==Ko&&Sn.type!==Pu&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Sn.type=Pu,is=ot.convert(Sn.type)),Sn.format===Up&&ms===ut.DEPTH_COMPONENT&&(ms=ut.DEPTH_STENCIL,Sn.type!==O_&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Sn.type=O_,is=ot.convert(Sn.type))),Ys&&(ds?j.texStorage2D(ut.TEXTURE_2D,1,ms,qn.width,qn.height):j.texImage2D(ut.TEXTURE_2D,0,ms,qn.width,qn.height,0,br,is,null));else if(Sn.isDataTexture)if(Ps.length>0&&Er){ds&&Ys&&j.texStorage2D(ut.TEXTURE_2D,qs,ms,Ps[0].width,Ps[0].height);for(let Rs=0,Zo=Ps.length;Rs<Zo;Rs++)Rr=Ps[Rs],ds?j.texSubImage2D(ut.TEXTURE_2D,Rs,0,0,Rr.width,Rr.height,br,is,Rr.data):j.texImage2D(ut.TEXTURE_2D,Rs,ms,Rr.width,Rr.height,0,br,is,Rr.data);Sn.generateMipmaps=!1}else ds?(Ys&&j.texStorage2D(ut.TEXTURE_2D,qs,ms,qn.width,qn.height),j.texSubImage2D(ut.TEXTURE_2D,0,0,0,qn.width,qn.height,br,is,qn.data)):j.texImage2D(ut.TEXTURE_2D,0,ms,qn.width,qn.height,0,br,is,qn.data);else if(Sn.isCompressedTexture)if(Sn.isCompressedArrayTexture){ds&&Ys&&j.texStorage3D(ut.TEXTURE_2D_ARRAY,qs,ms,Ps[0].width,Ps[0].height,qn.depth);for(let Rs=0,Zo=Ps.length;Rs<Zo;Rs++)Rr=Ps[Rs],Sn.format!==Hu?br!==null?ds?j.compressedTexSubImage3D(ut.TEXTURE_2D_ARRAY,Rs,0,0,0,Rr.width,Rr.height,qn.depth,br,Rr.data,0,0):j.compressedTexImage3D(ut.TEXTURE_2D_ARRAY,Rs,ms,Rr.width,Rr.height,qn.depth,0,Rr.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ds?j.texSubImage3D(ut.TEXTURE_2D_ARRAY,Rs,0,0,0,Rr.width,Rr.height,qn.depth,br,is,Rr.data):j.texImage3D(ut.TEXTURE_2D_ARRAY,Rs,ms,Rr.width,Rr.height,qn.depth,0,br,is,Rr.data)}else{ds&&Ys&&j.texStorage2D(ut.TEXTURE_2D,qs,ms,Ps[0].width,Ps[0].height);for(let Rs=0,Zo=Ps.length;Rs<Zo;Rs++)Rr=Ps[Rs],Sn.format!==Hu?br!==null?ds?j.compressedTexSubImage2D(ut.TEXTURE_2D,Rs,0,0,Rr.width,Rr.height,br,Rr.data):j.compressedTexImage2D(ut.TEXTURE_2D,Rs,ms,Rr.width,Rr.height,0,Rr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ds?j.texSubImage2D(ut.TEXTURE_2D,Rs,0,0,Rr.width,Rr.height,br,is,Rr.data):j.texImage2D(ut.TEXTURE_2D,Rs,ms,Rr.width,Rr.height,0,br,is,Rr.data)}else if(Sn.isDataArrayTexture)ds?(Ys&&j.texStorage3D(ut.TEXTURE_2D_ARRAY,qs,ms,qn.width,qn.height,qn.depth),j.texSubImage3D(ut.TEXTURE_2D_ARRAY,0,0,0,0,qn.width,qn.height,qn.depth,br,is,qn.data)):j.texImage3D(ut.TEXTURE_2D_ARRAY,0,ms,qn.width,qn.height,qn.depth,0,br,is,qn.data);else if(Sn.isData3DTexture)ds?(Ys&&j.texStorage3D(ut.TEXTURE_3D,qs,ms,qn.width,qn.height,qn.depth),j.texSubImage3D(ut.TEXTURE_3D,0,0,0,0,qn.width,qn.height,qn.depth,br,is,qn.data)):j.texImage3D(ut.TEXTURE_3D,0,ms,qn.width,qn.height,qn.depth,0,br,is,qn.data);else if(Sn.isFramebufferTexture){if(Ys)if(ds)j.texStorage2D(ut.TEXTURE_2D,qs,ms,qn.width,qn.height);else{let Rs=qn.width,Zo=qn.height;for(let Pp=0;Pp<qs;Pp++)j.texImage2D(ut.TEXTURE_2D,Pp,ms,Rs,Zo,0,br,is,null),Rs>>=1,Zo>>=1}}else if(Ps.length>0&&Er){ds&&Ys&&j.texStorage2D(ut.TEXTURE_2D,qs,ms,Ps[0].width,Ps[0].height);for(let Rs=0,Zo=Ps.length;Rs<Zo;Rs++)Rr=Ps[Rs],ds?j.texSubImage2D(ut.TEXTURE_2D,Rs,0,0,br,is,Rr):j.texImage2D(ut.TEXTURE_2D,Rs,ms,br,is,Rr);Sn.generateMipmaps=!1}else ds?(Ys&&j.texStorage2D(ut.TEXTURE_2D,qs,ms,qn.width,qn.height),j.texSubImage2D(ut.TEXTURE_2D,0,0,0,br,is,qn)):j.texImage2D(ut.TEXTURE_2D,0,ms,br,is,qn);gn(Sn,Er)&&vn(Yn),fn.__version=Zn.version,Sn.onUpdate&&Sn.onUpdate(Sn)}Fn.__version=Sn.version}function mr(Fn,Sn,lr,Yn,On){const Zn=ot.convert(lr.format,lr.colorSpace),fn=ot.convert(lr.type),Gn=Un(lr.internalFormat,Zn,fn,lr.colorSpace);nt.get(Sn).__hasExternalTextures||(On===ut.TEXTURE_3D||On===ut.TEXTURE_2D_ARRAY?j.texImage3D(On,0,Gn,Sn.width,Sn.height,Sn.depth,0,Zn,fn,null):j.texImage2D(On,0,Gn,Sn.width,Sn.height,0,Zn,fn,null)),j.bindFramebuffer(ut.FRAMEBUFFER,Fn),ss(Sn)?Rt.framebufferTexture2DMultisampleEXT(ut.FRAMEBUFFER,Yn,On,nt.get(lr).__webglTexture,0,Ur(Sn)):(On===ut.TEXTURE_2D||On>=ut.TEXTURE_CUBE_MAP_POSITIVE_X&&On<=ut.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&ut.framebufferTexture2D(ut.FRAMEBUFFER,Yn,On,nt.get(lr).__webglTexture,0),j.bindFramebuffer(ut.FRAMEBUFFER,null)}function Dr(Fn,Sn,lr){if(ut.bindRenderbuffer(ut.RENDERBUFFER,Fn),Sn.depthBuffer&&!Sn.stencilBuffer){let Yn=ut.DEPTH_COMPONENT16;if(lr||ss(Sn)){const On=Sn.depthTexture;On&&On.isDepthTexture&&(On.type===yv?Yn=ut.DEPTH_COMPONENT32F:On.type===Pu&&(Yn=ut.DEPTH_COMPONENT24));const Zn=Ur(Sn);ss(Sn)?Rt.renderbufferStorageMultisampleEXT(ut.RENDERBUFFER,Zn,Yn,Sn.width,Sn.height):ut.renderbufferStorageMultisample(ut.RENDERBUFFER,Zn,Yn,Sn.width,Sn.height)}else ut.renderbufferStorage(ut.RENDERBUFFER,Yn,Sn.width,Sn.height);ut.framebufferRenderbuffer(ut.FRAMEBUFFER,ut.DEPTH_ATTACHMENT,ut.RENDERBUFFER,Fn)}else if(Sn.depthBuffer&&Sn.stencilBuffer){const Yn=Ur(Sn);lr&&ss(Sn)===!1?ut.renderbufferStorageMultisample(ut.RENDERBUFFER,Yn,ut.DEPTH24_STENCIL8,Sn.width,Sn.height):ss(Sn)?Rt.renderbufferStorageMultisampleEXT(ut.RENDERBUFFER,Yn,ut.DEPTH24_STENCIL8,Sn.width,Sn.height):ut.renderbufferStorage(ut.RENDERBUFFER,ut.DEPTH_STENCIL,Sn.width,Sn.height),ut.framebufferRenderbuffer(ut.FRAMEBUFFER,ut.DEPTH_STENCIL_ATTACHMENT,ut.RENDERBUFFER,Fn)}else{const Yn=Sn.isWebGLMultipleRenderTargets===!0?Sn.texture:[Sn.texture];for(let On=0;On<Yn.length;On++){const Zn=Yn[On],fn=ot.convert(Zn.format,Zn.colorSpace),Gn=ot.convert(Zn.type),qn=Un(Zn.internalFormat,fn,Gn,Zn.colorSpace),Er=Ur(Sn);lr&&ss(Sn)===!1?ut.renderbufferStorageMultisample(ut.RENDERBUFFER,Er,qn,Sn.width,Sn.height):ss(Sn)?Rt.renderbufferStorageMultisampleEXT(ut.RENDERBUFFER,Er,qn,Sn.width,Sn.height):ut.renderbufferStorage(ut.RENDERBUFFER,qn,Sn.width,Sn.height)}}ut.bindRenderbuffer(ut.RENDERBUFFER,null)}function $r(Fn){const Sn=nt.get(Fn),lr=Fn.isWebGLCubeRenderTarget===!0;if(Fn.depthTexture&&!Sn.__autoAllocateDepthBuffer){if(lr)throw new Error("target.depthTexture not supported in Cube render targets");(function(Yn,On){if(On&&On.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(j.bindFramebuffer(ut.FRAMEBUFFER,Yn),!On.depthTexture||!On.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");nt.get(On.depthTexture).__webglTexture&&On.depthTexture.image.width===On.width&&On.depthTexture.image.height===On.height||(On.depthTexture.image.width=On.width,On.depthTexture.image.height=On.height,On.depthTexture.needsUpdate=!0),Gr(On.depthTexture,0);const Zn=nt.get(On.depthTexture).__webglTexture,fn=Ur(On);if(On.depthTexture.format===xm)ss(On)?Rt.framebufferTexture2DMultisampleEXT(ut.FRAMEBUFFER,ut.DEPTH_ATTACHMENT,ut.TEXTURE_2D,Zn,0,fn):ut.framebufferTexture2D(ut.FRAMEBUFFER,ut.DEPTH_ATTACHMENT,ut.TEXTURE_2D,Zn,0);else{if(On.depthTexture.format!==Up)throw new Error("Unknown depthTexture format");ss(On)?Rt.framebufferTexture2DMultisampleEXT(ut.FRAMEBUFFER,ut.DEPTH_STENCIL_ATTACHMENT,ut.TEXTURE_2D,Zn,0,fn):ut.framebufferTexture2D(ut.FRAMEBUFFER,ut.DEPTH_STENCIL_ATTACHMENT,ut.TEXTURE_2D,Zn,0)}})(Sn.__webglFramebuffer,Fn)}else if(lr){Sn.__webglDepthbuffer=[];for(let Yn=0;Yn<6;Yn++)j.bindFramebuffer(ut.FRAMEBUFFER,Sn.__webglFramebuffer[Yn]),Sn.__webglDepthbuffer[Yn]=ut.createRenderbuffer(),Dr(Sn.__webglDepthbuffer[Yn],Fn,!1)}else j.bindFramebuffer(ut.FRAMEBUFFER,Sn.__webglFramebuffer),Sn.__webglDepthbuffer=ut.createRenderbuffer(),Dr(Sn.__webglDepthbuffer,Fn,!1);j.bindFramebuffer(ut.FRAMEBUFFER,null)}function Ur(Fn){return Math.min(Dt,Fn.samples)}function ss(Fn){const Sn=nt.get(Fn);return ft&&Fn.samples>0&&a.has("WEBGL_multisampled_render_to_texture")===!0&&Sn.__useRenderToTexture!==!1}function Hs(Fn,Sn){const lr=Fn.colorSpace,Yn=Fn.format,On=Fn.type;return Fn.isCompressedTexture===!0||Fn.format===FA||lr!==io&&lr!==Cm&&(lr===Bs?ft===!1?a.has("EXT_sRGB")===!0&&Yn===Hu?(Fn.format=FA,Fn.minFilter=Il,Fn.generateMipmaps=!1):Sn=jA.sRGBToLinear(Sn):Yn===Hu&&On===_v||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):lr===Mm||console.error("THREE.WebGLTextures: Unsupported texture color space:",lr)),Sn}this.allocateTextureUnit=function(){const Fn=xr;return Fn>=wt&&console.warn("THREE.WebGLTextures: Trying to use "+Fn+" texture units while this GPU supports only "+wt),xr+=1,Fn},this.resetTextureUnits=function(){xr=0},this.setTexture2D=Gr,this.setTexture2DArray=function(Fn,Sn){const lr=nt.get(Fn);Fn.version>0&&lr.__version!==Fn.version?ts(lr,Fn,Sn):j.bindTexture(ut.TEXTURE_2D_ARRAY,lr.__webglTexture,ut.TEXTURE0+Sn)},this.setTexture3D=function(Fn,Sn){const lr=nt.get(Fn);Fn.version>0&&lr.__version!==Fn.version?ts(lr,Fn,Sn):j.bindTexture(ut.TEXTURE_3D,lr.__webglTexture,ut.TEXTURE0+Sn)},this.setTextureCube=function(Fn,Sn){const lr=nt.get(Fn);Fn.version>0&&lr.__version!==Fn.version?function(Yn,On,Zn){if(On.image.length!==6)return;const fn=Yr(Yn,On),Gn=On.source;j.bindTexture(ut.TEXTURE_CUBE_MAP,Yn.__webglTexture,ut.TEXTURE0+Zn);const qn=nt.get(Gn);if(Gn.version!==qn.__version||fn===!0){j.activeTexture(ut.TEXTURE0+Zn),ut.pixelStorei(ut.UNPACK_FLIP_Y_WEBGL,On.flipY),ut.pixelStorei(ut.UNPACK_PREMULTIPLY_ALPHA_WEBGL,On.premultiplyAlpha),ut.pixelStorei(ut.UNPACK_ALIGNMENT,On.unpackAlignment),ut.pixelStorei(ut.UNPACK_COLORSPACE_CONVERSION_WEBGL,ut.NONE);const Er=On.isCompressedTexture||On.image[0].isCompressedTexture,br=On.image[0]&&On.image[0].isDataTexture,Rr=[];for(let lo=0;lo<6;lo++)Rr[lo]=Er||br?br?On.image[lo].image:On.image[lo]:$t(On.image[lo],!1,!0,bt),Rr[lo]=Hs(On,Rr[lo]);const is=Rr[0],ms=En(is)||ft,Ps=ot.convert(On.format,On.colorSpace),ds=ot.convert(On.type),Ys=Un(On.internalFormat,Ps,ds,On.colorSpace),qs=ft&&On.isVideoTexture!==!0,Rs=qn.__version===void 0||fn===!0;let Zo,Pp=$n(On,is,ms);if(Tr(ut.TEXTURE_CUBE_MAP,On,ms),Er){qs&&Rs&&j.texStorage2D(ut.TEXTURE_CUBE_MAP,Pp,Ys,is.width,is.height);for(let lo=0;lo<6;lo++){Zo=Rr[lo].mipmaps;for(let Bo=0;Bo<Zo.length;Bo++){const jo=Zo[Bo];On.format!==Hu?Ps!==null?qs?j.compressedTexSubImage2D(ut.TEXTURE_CUBE_MAP_POSITIVE_X+lo,Bo,0,0,jo.width,jo.height,Ps,jo.data):j.compressedTexImage2D(ut.TEXTURE_CUBE_MAP_POSITIVE_X+lo,Bo,Ys,jo.width,jo.height,0,jo.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):qs?j.texSubImage2D(ut.TEXTURE_CUBE_MAP_POSITIVE_X+lo,Bo,0,0,jo.width,jo.height,Ps,ds,jo.data):j.texImage2D(ut.TEXTURE_CUBE_MAP_POSITIVE_X+lo,Bo,Ys,jo.width,jo.height,0,Ps,ds,jo.data)}}}else{Zo=On.mipmaps,qs&&Rs&&(Zo.length>0&&Pp++,j.texStorage2D(ut.TEXTURE_CUBE_MAP,Pp,Ys,Rr[0].width,Rr[0].height));for(let lo=0;lo<6;lo++)if(br){qs?j.texSubImage2D(ut.TEXTURE_CUBE_MAP_POSITIVE_X+lo,0,0,0,Rr[lo].width,Rr[lo].height,Ps,ds,Rr[lo].data):j.texImage2D(ut.TEXTURE_CUBE_MAP_POSITIVE_X+lo,0,Ys,Rr[lo].width,Rr[lo].height,0,Ps,ds,Rr[lo].data);for(let Bo=0;Bo<Zo.length;Bo++){const jo=Zo[Bo].image[lo].image;qs?j.texSubImage2D(ut.TEXTURE_CUBE_MAP_POSITIVE_X+lo,Bo+1,0,0,jo.width,jo.height,Ps,ds,jo.data):j.texImage2D(ut.TEXTURE_CUBE_MAP_POSITIVE_X+lo,Bo+1,Ys,jo.width,jo.height,0,Ps,ds,jo.data)}}else{qs?j.texSubImage2D(ut.TEXTURE_CUBE_MAP_POSITIVE_X+lo,0,0,0,Ps,ds,Rr[lo]):j.texImage2D(ut.TEXTURE_CUBE_MAP_POSITIVE_X+lo,0,Ys,Ps,ds,Rr[lo]);for(let Bo=0;Bo<Zo.length;Bo++){const jo=Zo[Bo];qs?j.texSubImage2D(ut.TEXTURE_CUBE_MAP_POSITIVE_X+lo,Bo+1,0,0,Ps,ds,jo.image[lo]):j.texImage2D(ut.TEXTURE_CUBE_MAP_POSITIVE_X+lo,Bo+1,Ys,Ps,ds,jo.image[lo])}}}gn(On,ms)&&vn(ut.TEXTURE_CUBE_MAP),qn.__version=Gn.version,On.onUpdate&&On.onUpdate(On)}Yn.__version=On.version}(lr,Fn,Sn):j.bindTexture(ut.TEXTURE_CUBE_MAP,lr.__webglTexture,ut.TEXTURE0+Sn)},this.rebindTextures=function(Fn,Sn,lr){const Yn=nt.get(Fn);Sn!==void 0&&mr(Yn.__webglFramebuffer,Fn,Fn.texture,ut.COLOR_ATTACHMENT0,ut.TEXTURE_2D),lr!==void 0&&$r(Fn)},this.setupRenderTarget=function(Fn){const Sn=Fn.texture,lr=nt.get(Fn),Yn=nt.get(Sn);Fn.addEventListener("dispose",Vn),Fn.isWebGLMultipleRenderTargets!==!0&&(Yn.__webglTexture===void 0&&(Yn.__webglTexture=ut.createTexture()),Yn.__version=Sn.version,ht.memory.textures++);const On=Fn.isWebGLCubeRenderTarget===!0,Zn=Fn.isWebGLMultipleRenderTargets===!0,fn=En(Fn)||ft;if(On){lr.__webglFramebuffer=[];for(let Gn=0;Gn<6;Gn++)lr.__webglFramebuffer[Gn]=ut.createFramebuffer()}else{if(lr.__webglFramebuffer=ut.createFramebuffer(),Zn)if(it.drawBuffers){const Gn=Fn.texture;for(let qn=0,Er=Gn.length;qn<Er;qn++){const br=nt.get(Gn[qn]);br.__webglTexture===void 0&&(br.__webglTexture=ut.createTexture(),ht.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(ft&&Fn.samples>0&&ss(Fn)===!1){const Gn=Zn?Sn:[Sn];lr.__webglMultisampledFramebuffer=ut.createFramebuffer(),lr.__webglColorRenderbuffer=[],j.bindFramebuffer(ut.FRAMEBUFFER,lr.__webglMultisampledFramebuffer);for(let qn=0;qn<Gn.length;qn++){const Er=Gn[qn];lr.__webglColorRenderbuffer[qn]=ut.createRenderbuffer(),ut.bindRenderbuffer(ut.RENDERBUFFER,lr.__webglColorRenderbuffer[qn]);const br=ot.convert(Er.format,Er.colorSpace),Rr=ot.convert(Er.type),is=Un(Er.internalFormat,br,Rr,Er.colorSpace,Fn.isXRRenderTarget===!0),ms=Ur(Fn);ut.renderbufferStorageMultisample(ut.RENDERBUFFER,ms,is,Fn.width,Fn.height),ut.framebufferRenderbuffer(ut.FRAMEBUFFER,ut.COLOR_ATTACHMENT0+qn,ut.RENDERBUFFER,lr.__webglColorRenderbuffer[qn])}ut.bindRenderbuffer(ut.RENDERBUFFER,null),Fn.depthBuffer&&(lr.__webglDepthRenderbuffer=ut.createRenderbuffer(),Dr(lr.__webglDepthRenderbuffer,Fn,!0)),j.bindFramebuffer(ut.FRAMEBUFFER,null)}}if(On){j.bindTexture(ut.TEXTURE_CUBE_MAP,Yn.__webglTexture),Tr(ut.TEXTURE_CUBE_MAP,Sn,fn);for(let Gn=0;Gn<6;Gn++)mr(lr.__webglFramebuffer[Gn],Fn,Sn,ut.COLOR_ATTACHMENT0,ut.TEXTURE_CUBE_MAP_POSITIVE_X+Gn);gn(Sn,fn)&&vn(ut.TEXTURE_CUBE_MAP),j.unbindTexture()}else if(Zn){const Gn=Fn.texture;for(let qn=0,Er=Gn.length;qn<Er;qn++){const br=Gn[qn],Rr=nt.get(br);j.bindTexture(ut.TEXTURE_2D,Rr.__webglTexture),Tr(ut.TEXTURE_2D,br,fn),mr(lr.__webglFramebuffer,Fn,br,ut.COLOR_ATTACHMENT0+qn,ut.TEXTURE_2D),gn(br,fn)&&vn(ut.TEXTURE_2D)}j.unbindTexture()}else{let Gn=ut.TEXTURE_2D;(Fn.isWebGL3DRenderTarget||Fn.isWebGLArrayRenderTarget)&&(ft?Gn=Fn.isWebGL3DRenderTarget?ut.TEXTURE_3D:ut.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),j.bindTexture(Gn,Yn.__webglTexture),Tr(Gn,Sn,fn),mr(lr.__webglFramebuffer,Fn,Sn,ut.COLOR_ATTACHMENT0,Gn),gn(Sn,fn)&&vn(Gn),j.unbindTexture()}Fn.depthBuffer&&$r(Fn)},this.updateRenderTargetMipmap=function(Fn){const Sn=En(Fn)||ft,lr=Fn.isWebGLMultipleRenderTargets===!0?Fn.texture:[Fn.texture],Yn=Fn.isWebGLCubeRenderTarget?ut.TEXTURE_CUBE_MAP:ut.TEXTURE_2D;for(let On=0,Zn=lr.length;On<Zn;On++){const fn=lr[On],Gn=nt.get(fn),qn=Gn.__webglTexture;Gn.__version!==fn.version&&(j.bindTexture(Yn,qn),Tr(Yn,fn,Sn),j.unbindTexture(),Gn.__version=fn.version),gn(fn,Sn)&&(j.bindTexture(Yn,qn),vn(Yn),j.unbindTexture())}},this.updateMultisampleRenderTarget=function(Fn){if(ft&&Fn.samples>0&&ss(Fn)===!1){const Sn=Fn.isWebGLMultipleRenderTargets?Fn.texture:[Fn.texture],lr=Fn.width,Yn=Fn.height;let On=ut.COLOR_BUFFER_BIT;const Zn=[],fn=Fn.stencilBuffer?ut.DEPTH_STENCIL_ATTACHMENT:ut.DEPTH_ATTACHMENT,Gn=nt.get(Fn),qn=Fn.isWebGLMultipleRenderTargets===!0;if(qn)for(let Er=0;Er<Sn.length;Er++)j.bindFramebuffer(ut.FRAMEBUFFER,Gn.__webglMultisampledFramebuffer),ut.framebufferRenderbuffer(ut.FRAMEBUFFER,ut.COLOR_ATTACHMENT0+Er,ut.RENDERBUFFER,null),j.bindFramebuffer(ut.FRAMEBUFFER,Gn.__webglFramebuffer),ut.framebufferTexture2D(ut.DRAW_FRAMEBUFFER,ut.COLOR_ATTACHMENT0+Er,ut.TEXTURE_2D,null,0);j.bindFramebuffer(ut.READ_FRAMEBUFFER,Gn.__webglMultisampledFramebuffer),j.bindFramebuffer(ut.DRAW_FRAMEBUFFER,Gn.__webglFramebuffer);for(let Er=0;Er<Sn.length;Er++){Zn.push(ut.COLOR_ATTACHMENT0+Er),Fn.depthBuffer&&Zn.push(fn);const br=Gn.__ignoreDepthValues!==void 0&&Gn.__ignoreDepthValues;if(br===!1&&(Fn.depthBuffer&&(On|=ut.DEPTH_BUFFER_BIT),Fn.stencilBuffer&&(On|=ut.STENCIL_BUFFER_BIT)),qn&&ut.framebufferRenderbuffer(ut.READ_FRAMEBUFFER,ut.COLOR_ATTACHMENT0,ut.RENDERBUFFER,Gn.__webglColorRenderbuffer[Er]),br===!0&&(ut.invalidateFramebuffer(ut.READ_FRAMEBUFFER,[fn]),ut.invalidateFramebuffer(ut.DRAW_FRAMEBUFFER,[fn])),qn){const Rr=nt.get(Sn[Er]).__webglTexture;ut.framebufferTexture2D(ut.DRAW_FRAMEBUFFER,ut.COLOR_ATTACHMENT0,ut.TEXTURE_2D,Rr,0)}ut.blitFramebuffer(0,0,lr,Yn,0,0,lr,Yn,On,ut.NEAREST),kt&&ut.invalidateFramebuffer(ut.READ_FRAMEBUFFER,Zn)}if(j.bindFramebuffer(ut.READ_FRAMEBUFFER,null),j.bindFramebuffer(ut.DRAW_FRAMEBUFFER,null),qn)for(let Er=0;Er<Sn.length;Er++){j.bindFramebuffer(ut.FRAMEBUFFER,Gn.__webglMultisampledFramebuffer),ut.framebufferRenderbuffer(ut.FRAMEBUFFER,ut.COLOR_ATTACHMENT0+Er,ut.RENDERBUFFER,Gn.__webglColorRenderbuffer[Er]);const br=nt.get(Sn[Er]).__webglTexture;j.bindFramebuffer(ut.FRAMEBUFFER,Gn.__webglFramebuffer),ut.framebufferTexture2D(ut.DRAW_FRAMEBUFFER,ut.COLOR_ATTACHMENT0+Er,ut.TEXTURE_2D,br,0)}j.bindFramebuffer(ut.DRAW_FRAMEBUFFER,Gn.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=$r,this.setupFrameBufferTexture=mr,this.useMultisampledRTT=ss}function nC(ut,a,j){const nt=j.isWebGL2;return{convert:function(it,ot=Cm){let ht;if(it===_v)return ut.UNSIGNED_BYTE;if(it===gy)return ut.UNSIGNED_SHORT_4_4_4_4;if(it===vy)return ut.UNSIGNED_SHORT_5_5_5_1;if(it===zo)return ut.BYTE;if(it===eu)return ut.SHORT;if(it===Ko)return ut.UNSIGNED_SHORT;if(it===DA)return ut.INT;if(it===Pu)return ut.UNSIGNED_INT;if(it===yv)return ut.FLOAT;if(it===Zp)return nt?ut.HALF_FLOAT:(ht=a.get("OES_texture_half_float"),ht!==null?ht.HALF_FLOAT_OES:null);if(it===P1)return ut.ALPHA;if(it===Hu)return ut.RGBA;if(it===Mn)return ut.LUMINANCE;if(it===Wm)return ut.LUMINANCE_ALPHA;if(it===xm)return ut.DEPTH_COMPONENT;if(it===Up)return ut.DEPTH_STENCIL;if(it===FA)return ht=a.get("EXT_sRGB"),ht!==null?ht.SRGB_ALPHA_EXT:null;if(it===To)return ut.RED;if(it===Oo)return ut.RED_INTEGER;if(it===R1)return ut.RG;if(it===qm)return ut.RG_INTEGER;if(it===ix)return ut.RGBA_INTEGER;if(it===d0||it===Av||it===kA||it===p0)if(ot===Bs){if(ht=a.get("WEBGL_compressed_texture_s3tc_srgb"),ht===null)return null;if(it===d0)return ht.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(it===Av)return ht.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(it===kA)return ht.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(it===p0)return ht.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(ht=a.get("WEBGL_compressed_texture_s3tc"),ht===null)return null;if(it===d0)return ht.COMPRESSED_RGB_S3TC_DXT1_EXT;if(it===Av)return ht.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(it===kA)return ht.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(it===p0)return ht.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(it===rx||it===BA||it===Em||it===sx){if(ht=a.get("WEBGL_compressed_texture_pvrtc"),ht===null)return null;if(it===rx)return ht.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(it===BA)return ht.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(it===Em)return ht.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(it===sx)return ht.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(it===D1)return ht=a.get("WEBGL_compressed_texture_etc1"),ht!==null?ht.COMPRESSED_RGB_ETC1_WEBGL:null;if(it===L_||it===_f){if(ht=a.get("WEBGL_compressed_texture_etc"),ht===null)return null;if(it===L_)return ot===Bs?ht.COMPRESSED_SRGB8_ETC2:ht.COMPRESSED_RGB8_ETC2;if(it===_f)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:ht.COMPRESSED_RGBA8_ETC2_EAC}if(it===tu||it===i_||it===ox||it===_y||it===OA||it===bu||it===r_||it===ax||it===np||it===f0||it===Ap||it===Nr||it===Xm||it===es){if(ht=a.get("WEBGL_compressed_texture_astc"),ht===null)return null;if(it===tu)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:ht.COMPRESSED_RGBA_ASTC_4x4_KHR;if(it===i_)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:ht.COMPRESSED_RGBA_ASTC_5x4_KHR;if(it===ox)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:ht.COMPRESSED_RGBA_ASTC_5x5_KHR;if(it===_y)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:ht.COMPRESSED_RGBA_ASTC_6x5_KHR;if(it===OA)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:ht.COMPRESSED_RGBA_ASTC_6x6_KHR;if(it===bu)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:ht.COMPRESSED_RGBA_ASTC_8x5_KHR;if(it===r_)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:ht.COMPRESSED_RGBA_ASTC_8x6_KHR;if(it===ax)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:ht.COMPRESSED_RGBA_ASTC_8x8_KHR;if(it===np)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:ht.COMPRESSED_RGBA_ASTC_10x5_KHR;if(it===f0)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:ht.COMPRESSED_RGBA_ASTC_10x6_KHR;if(it===Ap)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:ht.COMPRESSED_RGBA_ASTC_10x8_KHR;if(it===Nr)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:ht.COMPRESSED_RGBA_ASTC_10x10_KHR;if(it===Xm)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:ht.COMPRESSED_RGBA_ASTC_12x10_KHR;if(it===es)return ot===Bs?ht.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:ht.COMPRESSED_RGBA_ASTC_12x12_KHR}if(it===ip){if(ht=a.get("EXT_texture_compression_bptc"),ht===null)return null;if(it===ip)return ot===Bs?ht.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:ht.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(it===em||it===go||it===js||it===s_){if(ht=a.get("EXT_texture_compression_rgtc"),ht===null)return null;if(it===ip)return ht.COMPRESSED_RED_RGTC1_EXT;if(it===go)return ht.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(it===js)return ht.COMPRESSED_RED_GREEN_RGTC2_EXT;if(it===s_)return ht.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return it===O_?nt?ut.UNSIGNED_INT_24_8:(ht=a.get("WEBGL_depth_texture"),ht!==null?ht.UNSIGNED_INT_24_8_WEBGL:null):ut[it]!==void 0?ut[it]:null}}}class iE extends Cp{constructor(a=[]){super(),this.isArrayCamera=!0,this.cameras=a}}class Nu extends Po{constructor(){super(),this.isGroup=!0,this.type="Group"}}const aB={type:"move"};class iC{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Nu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Nu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Rn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Rn),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Nu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Rn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Rn),this._grip}dispatchEvent(a){return this._targetRay!==null&&this._targetRay.dispatchEvent(a),this._grip!==null&&this._grip.dispatchEvent(a),this._hand!==null&&this._hand.dispatchEvent(a),this}connect(a){if(a&&a.hand){const j=this._hand;if(j)for(const nt of a.hand.values())this._getHandJoint(j,nt)}return this.dispatchEvent({type:"connected",data:a}),this}disconnect(a){return this.dispatchEvent({type:"disconnected",data:a}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(a,j,nt){let it=null,ot=null,ht=null;const ft=this._targetRay,wt=this._grip,bt=this._hand;if(a&&j.session.visibilityState!=="visible-blurred"){if(bt&&a.hand){ht=!0;for(const Gt of a.hand.values()){const Nt=j.getJointPose(Gt,nt),zt=this._getHandJoint(bt,Gt);Nt!==null&&(zt.matrix.fromArray(Nt.transform.matrix),zt.matrix.decompose(zt.position,zt.rotation,zt.scale),zt.matrixWorldNeedsUpdate=!0,zt.jointRadius=Nt.radius),zt.visible=Nt!==null}const St=bt.joints["index-finger-tip"],Dt=bt.joints["thumb-tip"],Rt=St.position.distanceTo(Dt.position),kt=.02,Ot=.005;bt.inputState.pinching&&Rt>kt+Ot?(bt.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:a.handedness,target:this})):!bt.inputState.pinching&&Rt<=kt-Ot&&(bt.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:a.handedness,target:this}))}else wt!==null&&a.gripSpace&&(ot=j.getPose(a.gripSpace,nt),ot!==null&&(wt.matrix.fromArray(ot.transform.matrix),wt.matrix.decompose(wt.position,wt.rotation,wt.scale),wt.matrixWorldNeedsUpdate=!0,ot.linearVelocity?(wt.hasLinearVelocity=!0,wt.linearVelocity.copy(ot.linearVelocity)):wt.hasLinearVelocity=!1,ot.angularVelocity?(wt.hasAngularVelocity=!0,wt.angularVelocity.copy(ot.angularVelocity)):wt.hasAngularVelocity=!1));ft!==null&&(it=j.getPose(a.targetRaySpace,nt),it===null&&ot!==null&&(it=ot),it!==null&&(ft.matrix.fromArray(it.transform.matrix),ft.matrix.decompose(ft.position,ft.rotation,ft.scale),ft.matrixWorldNeedsUpdate=!0,it.linearVelocity?(ft.hasLinearVelocity=!0,ft.linearVelocity.copy(it.linearVelocity)):ft.hasLinearVelocity=!1,it.angularVelocity?(ft.hasAngularVelocity=!0,ft.angularVelocity.copy(it.angularVelocity)):ft.hasAngularVelocity=!1,this.dispatchEvent(aB)))}return ft!==null&&(ft.visible=it!==null),wt!==null&&(wt.visible=ot!==null),bt!==null&&(bt.visible=ht!==null),this}_getHandJoint(a,j){if(a.joints[j.jointName]===void 0){const nt=new Nu;nt.matrixAutoUpdate=!1,nt.visible=!1,a.joints[j.jointName]=nt,a.add(nt)}return a.joints[j.jointName]}}class F0 extends ga{constructor(a,j,nt,it,ot,ht,ft,wt,bt,St){if((St=St!==void 0?St:xm)!==xm&&St!==Up)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");nt===void 0&&St===xm&&(nt=Pu),nt===void 0&&St===Up&&(nt=O_),super(null,it,ot,ht,ft,wt,St,nt,bt),this.isDepthTexture=!0,this.image={width:a,height:j},this.magFilter=ft!==void 0?ft:Yo,this.minFilter=wt!==void 0?wt:Yo,this.flipY=!1,this.generateMipmaps=!1}}class up extends $m{constructor(a,j){super();const nt=this;let it=null,ot=1,ht=null,ft="local-floor",wt=1,bt=null,St=null,Dt=null,Rt=null,kt=null,Ot=null;const Gt=j.getContextAttributes();let Nt=null,zt=null;const qt=[],$t=[],En=new Set,gn=new Map,vn=new Cp;vn.layers.enable(1),vn.viewport=new No;const Un=new Cp;Un.layers.enable(2),Un.viewport=new No;const $n=[vn,Un],jn=new iE;jn.layers.enable(1),jn.layers.enable(2);let sr=null,Vn=null;function _r(mr){const Dr=$t.indexOf(mr.inputSource);if(Dr===-1)return;const $r=qt[Dr];$r!==void 0&&($r.update(mr.inputSource,mr.frame,bt||ht),$r.dispatchEvent({type:mr.type,data:mr.inputSource}))}function xr(){it.removeEventListener("select",_r),it.removeEventListener("selectstart",_r),it.removeEventListener("selectend",_r),it.removeEventListener("squeeze",_r),it.removeEventListener("squeezestart",_r),it.removeEventListener("squeezeend",_r),it.removeEventListener("end",xr),it.removeEventListener("inputsourceschange",Gr);for(let mr=0;mr<qt.length;mr++){const Dr=$t[mr];Dr!==null&&($t[mr]=null,qt[mr].disconnect(Dr))}sr=null,Vn=null,a.setRenderTarget(Nt),kt=null,Rt=null,Dt=null,it=null,zt=null,ts.stop(),nt.isPresenting=!1,nt.dispatchEvent({type:"sessionend"})}function Gr(mr){for(let Dr=0;Dr<mr.removed.length;Dr++){const $r=mr.removed[Dr],Ur=$t.indexOf($r);Ur>=0&&($t[Ur]=null,qt[Ur].disconnect($r))}for(let Dr=0;Dr<mr.added.length;Dr++){const $r=mr.added[Dr];let Ur=$t.indexOf($r);if(Ur===-1){for(let Hs=0;Hs<qt.length;Hs++){if(Hs>=$t.length){$t.push($r),Ur=Hs;break}if($t[Hs]===null){$t[Hs]=$r,Ur=Hs;break}}if(Ur===-1)break}const ss=qt[Ur];ss&&ss.connect($r)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(mr){let Dr=qt[mr];return Dr===void 0&&(Dr=new iC,qt[mr]=Dr),Dr.getTargetRaySpace()},this.getControllerGrip=function(mr){let Dr=qt[mr];return Dr===void 0&&(Dr=new iC,qt[mr]=Dr),Dr.getGripSpace()},this.getHand=function(mr){let Dr=qt[mr];return Dr===void 0&&(Dr=new iC,qt[mr]=Dr),Dr.getHandSpace()},this.setFramebufferScaleFactor=function(mr){ot=mr,nt.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(mr){ft=mr,nt.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return bt||ht},this.setReferenceSpace=function(mr){bt=mr},this.getBaseLayer=function(){return Rt!==null?Rt:kt},this.getBinding=function(){return Dt},this.getFrame=function(){return Ot},this.getSession=function(){return it},this.setSession=async function(mr){if(it=mr,it!==null){if(Nt=a.getRenderTarget(),it.addEventListener("select",_r),it.addEventListener("selectstart",_r),it.addEventListener("selectend",_r),it.addEventListener("squeeze",_r),it.addEventListener("squeezestart",_r),it.addEventListener("squeezeend",_r),it.addEventListener("end",xr),it.addEventListener("inputsourceschange",Gr),Gt.xrCompatible!==!0&&await j.makeXRCompatible(),it.renderState.layers===void 0||a.capabilities.isWebGL2===!1){const Dr={antialias:it.renderState.layers!==void 0||Gt.antialias,alpha:!0,depth:Gt.depth,stencil:Gt.stencil,framebufferScaleFactor:ot};kt=new XRWebGLLayer(it,j,Dr),it.updateRenderState({baseLayer:kt}),zt=new xu(kt.framebufferWidth,kt.framebufferHeight,{format:Hu,type:_v,colorSpace:a.outputColorSpace,stencilBuffer:Gt.stencil})}else{let Dr=null,$r=null,Ur=null;Gt.depth&&(Ur=Gt.stencil?j.DEPTH24_STENCIL8:j.DEPTH_COMPONENT24,Dr=Gt.stencil?Up:xm,$r=Gt.stencil?O_:Pu);const ss={colorFormat:j.RGBA8,depthFormat:Ur,scaleFactor:ot};Dt=new XRWebGLBinding(it,j),Rt=Dt.createProjectionLayer(ss),it.updateRenderState({layers:[Rt]}),zt=new xu(Rt.textureWidth,Rt.textureHeight,{format:Hu,type:_v,depthTexture:new F0(Rt.textureWidth,Rt.textureHeight,$r,void 0,void 0,void 0,void 0,void 0,void 0,Dr),stencilBuffer:Gt.stencil,colorSpace:a.outputColorSpace,samples:Gt.antialias?4:0}),a.properties.get(zt).__ignoreDepthValues=Rt.ignoreDepthValues}zt.isXRRenderTarget=!0,this.setFoveation(wt),bt=null,ht=await it.requestReferenceSpace(ft),ts.setContext(it),ts.start(),nt.isPresenting=!0,nt.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(it!==null)return it.environmentBlendMode};const ns=new Rn,Vr=new Rn;function Tr(mr,Dr){Dr===null?mr.matrixWorld.copy(mr.matrix):mr.matrixWorld.multiplyMatrices(Dr.matrixWorld,mr.matrix),mr.matrixWorldInverse.copy(mr.matrixWorld).invert()}this.updateCamera=function(mr){if(it===null)return;jn.near=Un.near=vn.near=mr.near,jn.far=Un.far=vn.far=mr.far,sr===jn.near&&Vn===jn.far||(it.updateRenderState({depthNear:jn.near,depthFar:jn.far}),sr=jn.near,Vn=jn.far);const Dr=mr.parent,$r=jn.cameras;Tr(jn,Dr);for(let Ur=0;Ur<$r.length;Ur++)Tr($r[Ur],Dr);$r.length===2?function(Ur,ss,Hs){ns.setFromMatrixPosition(ss.matrixWorld),Vr.setFromMatrixPosition(Hs.matrixWorld);const Fn=ns.distanceTo(Vr),Sn=ss.projectionMatrix.elements,lr=Hs.projectionMatrix.elements,Yn=Sn[14]/(Sn[10]-1),On=Sn[14]/(Sn[10]+1),Zn=(Sn[9]+1)/Sn[5],fn=(Sn[9]-1)/Sn[5],Gn=(Sn[8]-1)/Sn[0],qn=(lr[8]+1)/lr[0],Er=Yn*Gn,br=Yn*qn,Rr=Fn/(-Gn+qn),is=Rr*-Gn;ss.matrixWorld.decompose(Ur.position,Ur.quaternion,Ur.scale),Ur.translateX(is),Ur.translateZ(Rr),Ur.matrixWorld.compose(Ur.position,Ur.quaternion,Ur.scale),Ur.matrixWorldInverse.copy(Ur.matrixWorld).invert();const ms=Yn+Rr,Ps=On+Rr,ds=Er-is,Ys=br+(Fn-is),qs=Zn*On/Ps*ms,Rs=fn*On/Ps*ms;Ur.projectionMatrix.makePerspective(ds,Ys,qs,Rs,ms,Ps),Ur.projectionMatrixInverse.copy(Ur.projectionMatrix).invert()}(jn,vn,Un):jn.projectionMatrix.copy(vn.projectionMatrix),function(Ur,ss,Hs){Hs===null?Ur.matrix.copy(ss.matrixWorld):(Ur.matrix.copy(Hs.matrixWorld),Ur.matrix.invert(),Ur.matrix.multiply(ss.matrixWorld)),Ur.matrix.decompose(Ur.position,Ur.quaternion,Ur.scale),Ur.updateMatrixWorld(!0);const Fn=Ur.children;for(let Sn=0,lr=Fn.length;Sn<lr;Sn++)Fn[Sn].updateMatrixWorld(!0);Ur.projectionMatrix.copy(ss.projectionMatrix),Ur.projectionMatrixInverse.copy(ss.projectionMatrixInverse),Ur.isPerspectiveCamera&&(Ur.fov=2*Im*Math.atan(1/Ur.projectionMatrix.elements[5]),Ur.zoom=1)}(mr,jn,Dr)},this.getCamera=function(){return jn},this.getFoveation=function(){if(Rt!==null||kt!==null)return wt},this.setFoveation=function(mr){wt=mr,Rt!==null&&(Rt.fixedFoveation=mr),kt!==null&&kt.fixedFoveation!==void 0&&(kt.fixedFoveation=mr)},this.getPlanes=function(){return En};let Yr=null;this.onPreAnimationFrameCallback=null;const ts=new VM;ts.setAnimationLoop(function(mr,Dr){if(nt.onPreAnimationFrameCallback&&nt.onPreAnimationFrameCallback(mr,Dr),St=Dr.getViewerPose(bt||ht),Ot=Dr,St!==null){const $r=St.views;kt!==null&&(a.setRenderTargetFramebuffer(zt,kt.framebuffer),a.setRenderTarget(zt));let Ur=!1;$r.length!==jn.cameras.length&&(jn.cameras.length=0,Ur=!0);for(let ss=0;ss<$r.length;ss++){const Hs=$r[ss];let Fn=null;if(kt!==null)Fn=kt.getViewport(Hs);else{const lr=Dt.getViewSubImage(Rt,Hs);Fn=lr.viewport,ss===0&&(a.setRenderTargetTextures(zt,lr.colorTexture,Rt.ignoreDepthValues?void 0:lr.depthStencilTexture),a.setRenderTarget(zt))}let Sn=$n[ss];Sn===void 0&&(Sn=new Cp,Sn.layers.enable(ss),Sn.viewport=new No,$n[ss]=Sn),Sn.matrix.fromArray(Hs.transform.matrix),Sn.matrix.decompose(Sn.position,Sn.quaternion,Sn.scale),Sn.projectionMatrix.fromArray(Hs.projectionMatrix),Sn.projectionMatrixInverse.copy(Sn.projectionMatrix).invert(),Sn.viewport.set(Fn.x,Fn.y,Fn.width,Fn.height),ss===0&&(jn.matrix.copy(Sn.matrix),jn.matrix.decompose(jn.position,jn.quaternion,jn.scale)),Ur===!0&&jn.cameras.push(Sn)}}for(let $r=0;$r<qt.length;$r++){const Ur=$t[$r],ss=qt[$r];Ur!==null&&ss!==void 0&&ss.update(Ur,Dr,bt||ht)}if(Yr&&Yr(mr,Dr),Dr.detectedPlanes){nt.dispatchEvent({type:"planesdetected",data:Dr.detectedPlanes});let $r=null;for(const Ur of En)Dr.detectedPlanes.has(Ur)||($r===null&&($r=[]),$r.push(Ur));if($r!==null)for(const Ur of $r)En.delete(Ur),gn.delete(Ur),nt.dispatchEvent({type:"planeremoved",data:Ur});for(const Ur of Dr.detectedPlanes)if(En.has(Ur)){const ss=gn.get(Ur);Ur.lastChangedTime>ss&&(gn.set(Ur,Ur.lastChangedTime),nt.dispatchEvent({type:"planechanged",data:Ur}))}else En.add(Ur),gn.set(Ur,Dr.lastChangedTime),nt.dispatchEvent({type:"planeadded",data:Ur})}Ot=null}),this.setAnimationLoop=function(mr){Yr=mr},this.dispose=function(){}}}function $o(ut,a){function j(it,ot){it.matrixAutoUpdate===!0&&it.updateMatrix(),ot.value.copy(it.matrix)}function nt(it,ot){it.opacity.value=ot.opacity,ot.color&&it.diffuse.value.copy(ot.color),ot.emissive&&it.emissive.value.copy(ot.emissive).multiplyScalar(ot.emissiveIntensity),ot.map&&(it.map.value=ot.map,j(ot.map,it.mapTransform)),ot.alphaMap&&(it.alphaMap.value=ot.alphaMap,j(ot.alphaMap,it.alphaMapTransform)),ot.bumpMap&&(it.bumpMap.value=ot.bumpMap,j(ot.bumpMap,it.bumpMapTransform),it.bumpScale.value=ot.bumpScale,ot.side===nn&&(it.bumpScale.value*=-1)),ot.normalMap&&(it.normalMap.value=ot.normalMap,j(ot.normalMap,it.normalMapTransform),it.normalScale.value.copy(ot.normalScale),ot.side===nn&&it.normalScale.value.negate()),ot.displacementMap&&(it.displacementMap.value=ot.displacementMap,j(ot.displacementMap,it.displacementMapTransform),it.displacementScale.value=ot.displacementScale,it.displacementBias.value=ot.displacementBias),ot.emissiveMap&&(it.emissiveMap.value=ot.emissiveMap,j(ot.emissiveMap,it.emissiveMapTransform)),ot.specularMap&&(it.specularMap.value=ot.specularMap,j(ot.specularMap,it.specularMapTransform)),ot.alphaTest>0&&(it.alphaTest.value=ot.alphaTest);const ht=a.get(ot).envMap;if(ht){it.envMap.value=ht;const ft=a.get(ot).environment||ht;it.envMapRotation.value=ft?ft.rotation:0,it.flipEnvMap.value=ht.isCubeTexture&&ht.isRenderTargetTexture===!1?-1:1,it.reflectivity.value=ot.reflectivity,it.ior.value=ot.ior,it.refractionRatio.value=ot.refractionRatio}if(ot.lightMap){it.lightMap.value=ot.lightMap;const ft=ut.useLegacyLights===!0?Math.PI:1;it.lightMapIntensity.value=ot.lightMapIntensity*ft,j(ot.lightMap,it.lightMapTransform)}ot.aoMap&&(it.aoMap.value=ot.aoMap,it.aoMapIntensity.value=ot.aoMapIntensity,j(ot.aoMap,it.aoMapTransform))}return{refreshTransformUniform:j,refreshFogUniforms:function(it,ot){ot.color.getRGB(it.fogColor.value,H1(ut)),ot.isFog?(it.fogNear.value=ot.near,it.fogFar.value=ot.far):ot.isFogExp2&&(it.fogDensity.value=ot.density)},refreshMaterialUniforms:function(it,ot,ht,ft,wt){ot.isMeshBasicMaterial||ot.isMeshLambertMaterial?nt(it,ot):ot.isMeshToonMaterial?(nt(it,ot),function(bt,St){St.gradientMap&&(bt.gradientMap.value=St.gradientMap)}(it,ot)):ot.isMeshPhongMaterial?(nt(it,ot),function(bt,St){bt.specular.value.copy(St.specular),bt.shininess.value=Math.max(St.shininess,1e-4)}(it,ot)):ot.isMeshStandardMaterial?(nt(it,ot),function(bt,St){bt.metalness.value=St.metalness,St.metalnessMap&&(bt.metalnessMap.value=St.metalnessMap,j(St.metalnessMap,bt.metalnessMapTransform)),bt.roughness.value=St.roughness,St.roughnessMap&&(bt.roughnessMap.value=St.roughnessMap,j(St.roughnessMap,bt.roughnessMapTransform)),a.get(St).envMap&&(bt.envMapIntensity.value=St.envMapIntensity)}(it,ot),ot.isMeshPhysicalMaterial&&function(bt,St,Dt){bt.ior.value=St.ior,St.sheen>0&&(bt.sheenColor.value.copy(St.sheenColor).multiplyScalar(St.sheen),bt.sheenRoughness.value=St.sheenRoughness,St.sheenColorMap&&(bt.sheenColorMap.value=St.sheenColorMap,j(St.sheenColorMap,bt.sheenColorMapTransform)),St.sheenRoughnessMap&&(bt.sheenRoughnessMap.value=St.sheenRoughnessMap,j(St.sheenRoughnessMap,bt.sheenRoughnessMapTransform))),St.clearcoat>0&&(bt.clearcoat.value=St.clearcoat,bt.clearcoatRoughness.value=St.clearcoatRoughness,St.clearcoatMap&&(bt.clearcoatMap.value=St.clearcoatMap,j(St.clearcoatMap,bt.clearcoatMapTransform)),St.clearcoatRoughnessMap&&(bt.clearcoatRoughnessMap.value=St.clearcoatRoughnessMap,j(St.clearcoatRoughnessMap,bt.clearcoatRoughnessMapTransform)),St.clearcoatNormalMap&&(bt.clearcoatNormalMap.value=St.clearcoatNormalMap,j(St.clearcoatNormalMap,bt.clearcoatNormalMapTransform),bt.clearcoatNormalScale.value.copy(St.clearcoatNormalScale),St.side===nn&&bt.clearcoatNormalScale.value.negate())),St.iridescence>0&&(bt.iridescence.value=St.iridescence,bt.iridescenceIOR.value=St.iridescenceIOR,bt.iridescenceThicknessMinimum.value=St.iridescenceThicknessRange[0],bt.iridescenceThicknessMaximum.value=St.iridescenceThicknessRange[1],St.iridescenceMap&&(bt.iridescenceMap.value=St.iridescenceMap,j(St.iridescenceMap,bt.iridescenceMapTransform)),St.iridescenceThicknessMap&&(bt.iridescenceThicknessMap.value=St.iridescenceThicknessMap,j(St.iridescenceThicknessMap,bt.iridescenceThicknessMapTransform))),St.transmission>0&&(bt.transmission.value=St.transmission,bt.transmissionSamplerMap.value=Dt.texture,bt.transmissionSamplerSize.value.set(Dt.width,Dt.height),St.transmissionMap&&(bt.transmissionMap.value=St.transmissionMap,j(St.transmissionMap,bt.transmissionMapTransform)),bt.thickness.value=St.thickness,St.thicknessMap&&(bt.thicknessMap.value=St.thicknessMap,j(St.thicknessMap,bt.thicknessMapTransform)),bt.attenuationDistance.value=St.attenuationDistance,bt.attenuationColor.value.copy(St.attenuationColor)),bt.specularIntensity.value=St.specularIntensity,bt.specularColor.value.copy(St.specularColor),St.specularColorMap&&(bt.specularColorMap.value=St.specularColorMap,j(St.specularColorMap,bt.specularColorMapTransform)),St.specularIntensityMap&&(bt.specularIntensityMap.value=St.specularIntensityMap,j(St.specularIntensityMap,bt.specularIntensityMapTransform))}(it,ot,wt)):ot.isMeshMatcapMaterial?(nt(it,ot),function(bt,St){St.matcap&&(bt.matcap.value=St.matcap)}(it,ot)):ot.isMeshDepthMaterial?nt(it,ot):ot.isMeshDistanceMaterial?(nt(it,ot),function(bt,St){const Dt=a.get(St).light;bt.referencePosition.value.setFromMatrixPosition(Dt.matrixWorld),bt.nearDistance.value=Dt.shadow.camera.near,bt.farDistance.value=Dt.shadow.camera.far}(it,ot)):ot.isMeshNormalMaterial?nt(it,ot):ot.isLineBasicMaterial?(function(bt,St){bt.diffuse.value.copy(St.color),bt.opacity.value=St.opacity,St.map&&(bt.map.value=St.map,j(St.map,bt.mapTransform))}(it,ot),ot.isLineDashedMaterial&&function(bt,St){bt.dashSize.value=St.dashSize,bt.totalSize.value=St.dashSize+St.gapSize,bt.scale.value=St.scale}(it,ot)):ot.isPointsMaterial?function(bt,St,Dt,Rt){bt.diffuse.value.copy(St.color),bt.opacity.value=St.opacity,bt.size.value=St.size*Dt,bt.scale.value=.5*Rt,St.map&&(bt.map.value=St.map,j(St.map,bt.uvTransform)),St.alphaMap&&(bt.alphaMap.value=St.alphaMap),St.alphaTest>0&&(bt.alphaTest.value=St.alphaTest)}(it,ot,ht,ft):ot.isSpriteMaterial?function(bt,St){bt.diffuse.value.copy(St.color),bt.opacity.value=St.opacity,bt.rotation.value=St.rotation,St.map&&(bt.map.value=St.map,j(St.map,bt.mapTransform)),St.alphaMap&&(bt.alphaMap.value=St.alphaMap),St.alphaTest>0&&(bt.alphaTest.value=St.alphaTest)}(it,ot):ot.isShadowMaterial?(it.color.value.copy(ot.color),it.opacity.value=ot.opacity):ot.isShaderMaterial&&(ot.transmission!==void 0&&(it.transmission&&(it.transmission.value=ot.transmission),it.transmissionSamplerMap&&wt&&(it.transmissionSamplerMap.value=wt?wt.texture:null),it.transmissionSamplerSize&&wt&&it.transmissionSamplerSize.value.set(wt.width,wt.height)),ot.uniformsNeedUpdate=!1)}}}function lB(ut,a,j,nt){let it={},ot={},ht=[];const ft=j.isWebGL2?ut.getParameter(ut.MAX_UNIFORM_BUFFER_BINDINGS):0;function wt(Dt,Rt,kt){const Ot=Dt.value;if(kt[Rt]===void 0){if(typeof Ot=="number")kt[Rt]=Ot;else{const Gt=Array.isArray(Ot)?Ot:[Ot],Nt=[];for(let zt=0;zt<Gt.length;zt++)Nt.push(Gt[zt].clone());kt[Rt]=Nt}return!0}if(typeof Ot=="number"){if(kt[Rt]!==Ot)return kt[Rt]=Ot,!0}else{const Gt=Array.isArray(kt[Rt])?kt[Rt]:[kt[Rt]],Nt=Array.isArray(Ot)?Ot:[Ot];for(let zt=0;zt<Gt.length;zt++){const qt=Gt[zt];if(qt.equals(Nt[zt])===!1)return qt.copy(Nt[zt]),!0}}return!1}function bt(Dt){const Rt={boundary:0,storage:0};return typeof Dt=="number"?(Rt.boundary=4,Rt.storage=4):Dt.isVector2?(Rt.boundary=8,Rt.storage=8):Dt.isVector3||Dt.isColor?(Rt.boundary=16,Rt.storage=12):Dt.isVector4?(Rt.boundary=16,Rt.storage=16):Dt.isMatrix3?(Rt.boundary=48,Rt.storage=48):Dt.isMatrix4?(Rt.boundary=64,Rt.storage=64):Dt.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",Dt),Rt}function St(Dt){const Rt=Dt.target;Rt.removeEventListener("dispose",St);const kt=ht.indexOf(Rt.__bindingPointIndex);ht.splice(kt,1),ut.deleteBuffer(it[Rt.id]),delete it[Rt.id],delete ot[Rt.id]}return{bind:function(Dt,Rt){const kt=Rt.program;nt.uniformBlockBinding(Dt,kt)},update:function(Dt,Rt){let kt=it[Dt.id];kt===void 0&&(function(Nt){const zt=Nt.uniforms;let qt=0,$t=0;for(let En=0,gn=zt.length;En<gn;En++){const vn=zt[En],Un={boundary:0,storage:0},$n=Array.isArray(vn.value)?vn.value:[vn.value];for(let jn=0,sr=$n.length;jn<sr;jn++){const Vn=bt($n[jn]);Un.boundary+=Vn.boundary,Un.storage+=Vn.storage}vn.__data=new Float32Array(Un.storage/Float32Array.BYTES_PER_ELEMENT),vn.__offset=qt,En>0&&($t=qt%16,$t!==0&&16-$t-Un.boundary<0&&(qt+=16-$t,vn.__offset=qt)),qt+=Un.storage}$t=qt%16,$t>0&&(qt+=16-$t),Nt.__size=qt,Nt.__cache={}}(Dt),kt=function(Nt){const zt=function(){for(let gn=0;gn<ft;gn++)if(ht.indexOf(gn)===-1)return ht.push(gn),gn;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();Nt.__bindingPointIndex=zt;const qt=ut.createBuffer(),$t=Nt.__size,En=Nt.usage;return ut.bindBuffer(ut.UNIFORM_BUFFER,qt),ut.bufferData(ut.UNIFORM_BUFFER,$t,En),ut.bindBuffer(ut.UNIFORM_BUFFER,null),ut.bindBufferBase(ut.UNIFORM_BUFFER,zt,qt),qt}(Dt),it[Dt.id]=kt,Dt.addEventListener("dispose",St));const Ot=Rt.program;nt.updateUBOMapping(Dt,Ot);const Gt=a.render.frame;ot[Dt.id]!==Gt&&(function(Nt){const zt=it[Nt.id],qt=Nt.uniforms,$t=Nt.__cache;ut.bindBuffer(ut.UNIFORM_BUFFER,zt);for(let En=0,gn=qt.length;En<gn;En++){const vn=qt[En];if(wt(vn,En,$t)===!0){const Un=vn.__offset,$n=Array.isArray(vn.value)?vn.value:[vn.value];let jn=0;for(let sr=0;sr<$n.length;sr++){const Vn=$n[sr],_r=bt(Vn);typeof Vn=="number"?(vn.__data[0]=Vn,ut.bufferSubData(ut.UNIFORM_BUFFER,Un+jn,vn.__data)):Vn.isMatrix3?(vn.__data[0]=Vn.elements[0],vn.__data[1]=Vn.elements[1],vn.__data[2]=Vn.elements[2],vn.__data[3]=Vn.elements[0],vn.__data[4]=Vn.elements[3],vn.__data[5]=Vn.elements[4],vn.__data[6]=Vn.elements[5],vn.__data[7]=Vn.elements[0],vn.__data[8]=Vn.elements[6],vn.__data[9]=Vn.elements[7],vn.__data[10]=Vn.elements[8],vn.__data[11]=Vn.elements[0]):(Vn.toArray(vn.__data,jn),jn+=_r.storage/Float32Array.BYTES_PER_ELEMENT)}ut.bufferSubData(ut.UNIFORM_BUFFER,Un,vn.__data)}}ut.bindBuffer(ut.UNIFORM_BUFFER,null)}(Dt),ot[Dt.id]=Gt)},dispose:function(){for(const Dt in it)ut.deleteBuffer(it[Dt]);ht=[],it={},ot={}}}}function cB(){const ut=Cy("canvas");return ut.style.display="block",ut}class Dx{constructor(a={}){const{canvas:j=cB(),context:nt=null,depth:it=!0,stencil:ot=!0,alpha:ht=!1,antialias:ft=!1,premultipliedAlpha:wt=!0,preserveDrawingBuffer:bt=!1,powerPreference:St="default",failIfMajorPerformanceCaveat:Dt=!1}=a;let Rt;this.isWebGLRenderer=!0,Rt=nt!==null?nt.getContextAttributes().alpha:ht;let kt=null,Ot=null;const Gt=[],Nt=[];this.domElement=j,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=Bs,this.useLegacyLights=!0,this.toneMapping=Mo,this.toneMappingExposure=1,this.userData={},this.onContextLost=()=>{},this.onContextRestore=()=>{},this.onContextCreationError=()=>{};const zt=this;let qt=!1,$t=0,En=0,gn=null,vn=-1,Un=null;const $n=new No,jn=new No;let sr=null,Vn=j.width,_r=j.height,xr=1,Gr=null,ns=null;const Vr=new No(0,0,Vn,_r),Tr=new No(0,0,Vn,_r);let Yr=!1;const ts=new W1;let mr=!1,Dr=!1,$r=null;const Ur=new ro,ss=new Rn,Hs={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Fn(){return gn===null?xr:1}let Sn,lr,Yn,On,Zn,fn,Gn,qn,Er,br,Rr,is,ms,Ps,ds,Ys,qs,Rs,Zo,Pp,lo,Bo,jo,ty,yr=nt;function aA(Ln,wr){for(let kr=0;kr<Ln.length;kr++){const Ir=Ln[kr],Qr=j.getContext(Ir,wr);if(Qr!==null)return Qr}return null}try{const Ln={alpha:!0,depth:it,stencil:ot,antialias:ft,premultipliedAlpha:wt,preserveDrawingBuffer:bt,powerPreference:St,failIfMajorPerformanceCaveat:Dt};if("setAttribute"in j&&j.setAttribute("data-engine",`three.js r${dt}`),j.addEventListener("webglcontextlost",kE,!1),j.addEventListener("webglcontextrestored",r1,!1),j.addEventListener("webglcontextcreationerror",BE,!1),yr===null){const wr=["webgl2","webgl","experimental-webgl"];if(zt.isWebGL1Renderer===!0&&wr.shift(),yr=aA(wr,Ln),yr===null)throw aA(wr)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}yr.getShaderPrecisionFormat===void 0&&(yr.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ln){throw console.error("THREE.WebGLRenderer: "+Ln.message),Ln}function DE(){Sn=new WS(yr),lr=new GM(yr,Sn,a),Sn.init(lr),Bo=new nC(yr,Sn,lr),Yn=new O2(yr,Sn,lr),On=new f_(yr),Zn=new xl,fn=new vo(yr,Sn,Yn,Zn,lr,Bo,On),Gn=new KD(zt),qn=new iv(zt),Er=new u2(yr,lr),jo=new XD(yr,Sn,Er,lr),br=new JD(yr,Er,On,jo),Rr=new f2(yr,br,Er,On),Zo=new qS(yr,lr,fn),Ys=new h2(Zn),is=new ZS(zt,Gn,qn,Sn,lr,jo,Ys),ms=new $o(zt,Zn),Ps=new eC,ds=new tC(Sn,lr),Rs=new qD(zt,Gn,qn,Yn,Rr,Rt,wt),qs=new B2(zt,Rr,lr),ty=new lB(yr,On,lr,Yn),Pp=new YD(yr,Sn,On,lr),lo=new $D(yr,Sn,On,lr),On.programs=is.programs,zt.capabilities=lr,zt.extensions=Sn,zt.properties=Zn,zt.renderLists=Ps,zt.shadowMap=qs,zt.state=Yn,zt.info=On,zt.background=Rs,zt.cubemaps=Gn,zt.cubeuvmaps=qn,zt.materials=ms}DE();const mm=new up(zt,yr);function kE(Ln){Ln.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),qt=!0,zt.onContextLost(Ln)}function r1(){console.log("THREE.WebGLRenderer: Context Restored."),qt=!1;const Ln=zt.info?zt.info.autoReset:void 0,wr=qs.enabled,kr=qs.autoUpdate,Ir=qs.needsUpdate,Qr=qs.type;DE(),zt.info&&Ln!==void 0&&(zt.info.autoReset=Ln),qs.enabled=wr,qs.autoUpdate=kr,qs.needsUpdate=Ir,qs.type=Qr,zt.onContextRestore&&zt.onContextRestore(),console.log("restored")}function BE(Ln){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Ln.statusMessage),zt.onContextCreationError(Ln)}function EP(Ln){const wr=Ln.target;wr.removeEventListener("dispose",EP),function(kr){(function(Ir){const Qr=Zn.get(Ir).programs;Qr!==void 0&&(Qr.forEach(function(ys){is.releaseProgram(ys)}),Ir.isShaderMaterial&&is.releaseShaderCache(Ir))})(kr),Zn.remove(kr)}(wr)}this.xr=mm,this.getContext=function(){return yr},this.getContextAttributes=function(){return yr.getContextAttributes()},this.forceContextLoss=function(){const Ln=Sn.get("WEBGL_lose_context");Ln&&Ln.loseContext()},this.forceContextRestore=function(){const Ln=Sn.get("WEBGL_lose_context");Ln&&Ln.restoreContext()},this.getPixelRatio=function(){return xr},this.setPixelRatio=function(Ln){Ln!==void 0&&(xr=Ln,this.setSize(Vn,_r,!1))},this.getSize=function(Ln){return Ln.set(Vn,_r)},this.setSize=function(Ln,wr,kr=!0){mm.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Vn=Ln,_r=wr,j.width=Math.floor(Ln*xr),j.height=Math.floor(wr*xr),kr===!0&&(j.style.width=Ln+"px",j.style.height=wr+"px"),this.setViewport(0,0,Ln,wr))},this.getDrawingBufferSize=function(Ln){return Ln.set(Vn*xr,_r*xr).floor()},this.setDrawingBufferSize=function(Ln,wr,kr){Vn=Ln,_r=wr,xr=kr,j.width=Math.floor(Ln*kr),j.height=Math.floor(wr*kr),this.setViewport(0,0,Ln,wr)},this.getCurrentViewport=function(Ln){return Ln.copy($n)},this.getViewport=function(Ln){return Ln.copy(Vr)},this.setViewport=function(Ln,wr,kr,Ir){Ln.isVector4?Vr.set(Ln.x,Ln.y,Ln.z,Ln.w):Vr.set(Ln,wr,kr,Ir),Yn.viewport($n.copy(Vr).multiplyScalar(xr).floor())},this.getScissor=function(Ln){return Ln.copy(Tr)},this.setScissor=function(Ln,wr,kr,Ir){Ln.isVector4?Tr.set(Ln.x,Ln.y,Ln.z,Ln.w):Tr.set(Ln,wr,kr,Ir),Yn.scissor(jn.copy(Tr).multiplyScalar(xr).floor())},this.getScissorTest=function(){return Yr},this.setScissorTest=function(Ln){Yn.setScissorTest(Yr=Ln)},this.setOpaqueSort=function(Ln){Gr=Ln},this.setTransparentSort=function(Ln){ns=Ln},this.getClearColor=function(Ln){return Ln.copy(Rs.getClearColor())},this.setClearColor=function(){Rs.setClearColor.apply(Rs,arguments)},this.getClearAlpha=function(){return Rs.getClearAlpha()},this.setClearAlpha=function(){Rs.setClearAlpha.apply(Rs,arguments)},this.clear=function(Ln=!0,wr=!0,kr=!0){let Ir=0;Ln&&(Ir|=yr.COLOR_BUFFER_BIT),wr&&(Ir|=yr.DEPTH_BUFFER_BIT),kr&&(Ir|=yr.STENCIL_BUFFER_BIT),yr.clear(Ir)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){j.removeEventListener("webglcontextlost",kE,!1),j.removeEventListener("webglcontextrestored",r1,!1),j.removeEventListener("webglcontextcreationerror",BE,!1),Ps.dispose(),ds.dispose(),Zn.dispose(),Gn.dispose(),qn.dispose(),Rr.dispose(),jo.dispose(),ty.dispose(),is.dispose(),mm.dispose(),mm.removeEventListener("sessionstart",QC),mm.removeEventListener("sessionend",E_),$r&&($r.dispose(),$r=null),Gv.stop()},this.renderBufferDirect=function(Ln,wr,kr,Ir,Qr,ys){wr===null&&(wr=Hs);const Do=Qr.isMesh&&Qr.matrixWorld.determinant()<0,zs=function(Cu,o0,Uu,$s,Mu){o0.isScene!==!0&&(o0=Hs),fn.resetTextureUnits();const qT=o0.fog,CP=$s.isMeshStandardMaterial?o0.environment:null,MP=gn===null?zt.outputColorSpace:gn.isXRRenderTarget===!0||gn.texture.colorSpace&&gn.texture.colorSpace!==Bs?gn.texture.colorSpace:io,a0=($s.isMeshStandardMaterial?qn:Gn).get($s.envMap||CP),TP=$s.vertexColors===!0&&!!Uu.attributes.color&&Uu.attributes.color.itemSize===4,XT=!!$s.normalMap&&!!Uu.attributes.tangent,YT=!!Uu.morphAttributes.position,IP=!!Uu.morphAttributes.normal,PP=!!Uu.morphAttributes.color,Mw=$s.toneMapped?zt.toneMapping:Mo,KT=Uu.morphAttributes.position||Uu.morphAttributes.normal||Uu.morphAttributes.color,XC=KT!==void 0?KT.length:0,_a=Zn.get($s),a1=Ot.state.lights;if(mr===!0&&(Dr===!0||Cu!==Un)){const Vl=Cu===Un&&$s.id===vn;Ys.setState($s,Cu,Vl)}let Hv=!1;$s.version===_a.__version?_a.needsLights&&_a.lightsStateVersion!==a1.state.version||_a.outputColorSpace!==MP||Mu.isInstancedMesh&&_a.instancing===!1?Hv=!0:Mu.isInstancedMesh||_a.instancing!==!0?Mu.isSkinnedMesh&&_a.skinning===!1?Hv=!0:Mu.isSkinnedMesh||_a.skinning!==!0?_a.envMap!==a0||$s.fog===!0&&_a.fog!==qT?Hv=!0:_a.numClippingPlanes===void 0||_a.numClippingPlanes===Ys.numPlanes&&_a.numIntersection===Ys.numIntersection?(_a.vertexAlphas!==TP||_a.vertexTangents!==XT||_a.morphTargets!==YT||_a.morphNormals!==IP||_a.morphColors!==PP||_a.toneMapping!==Mw||lr.isWebGL2===!0&&_a.morphTargetsCount!==XC)&&(Hv=!0):Hv=!0:Hv=!0:Hv=!0:(Hv=!0,_a.__version=$s.version);let ny=_a.currentProgram;Hv===!0&&(ny=OE($s,o0,Mu));let JT=!1,Tw=!1,YC=!1;const zl=ny.getUniforms(),lA=_a.uniforms;if(Yn.useProgram(ny.program)&&(JT=!0,Tw=!0,YC=!0),$s.id!==vn&&(vn=$s.id,Tw=!0),JT||Un!==Cu){if(zl.setValue(yr,"projectionMatrix",Cu.projectionMatrix),lr.logarithmicDepthBuffer&&zl.setValue(yr,"logDepthBufFC",2/(Math.log(Cu.far+1)/Math.LN2)),Un!==Cu&&(Un=Cu,Tw=!0,YC=!0),$s.isShaderMaterial||$s.isMeshPhongMaterial||$s.isMeshToonMaterial||$s.isMeshStandardMaterial||$s.envMap){const Vl=zl.map.cameraPosition;Vl!==void 0&&Vl.setValue(yr,ss.setFromMatrixPosition(Cu.matrixWorld))}($s.isMeshPhongMaterial||$s.isMeshToonMaterial||$s.isMeshLambertMaterial||$s.isMeshBasicMaterial||$s.isMeshStandardMaterial||$s.isShaderMaterial)&&zl.setValue(yr,"isOrthographic",Cu.isOrthographicCamera===!0),($s.isMeshPhongMaterial||$s.isMeshToonMaterial||$s.isMeshLambertMaterial||$s.isMeshBasicMaterial||$s.isMeshStandardMaterial||$s.isShaderMaterial||$s.isShadowMaterial||Mu.isSkinnedMesh)&&zl.setValue(yr,"viewMatrix",Cu.matrixWorldInverse)}if(Mu.isSkinnedMesh){zl.setOptional(yr,Mu,"bindMatrix"),zl.setOptional(yr,Mu,"bindMatrixInverse");const Vl=Mu.skeleton;Vl&&(lr.floatVertexTextures?(Vl.boneTexture===null&&Vl.computeBoneTexture(),zl.setValue(yr,"boneTexture",Vl.boneTexture,fn),zl.setValue(yr,"boneTextureSize",Vl.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const $T=Uu.morphAttributes;var S_,C_;($T.position!==void 0||$T.normal!==void 0||$T.color!==void 0&&lr.isWebGL2===!0)&&Zo.update(Mu,Uu,ny),(Tw||_a.receiveShadow!==Mu.receiveShadow)&&(_a.receiveShadow=Mu.receiveShadow,zl.setValue(yr,"receiveShadow",Mu.receiveShadow)),$s.isMeshGouraudMaterial&&$s.envMap!==null&&(lA.envMap.value=a0,lA.flipEnvMap.value=a0.isCubeTexture&&a0.isRenderTargetTexture===!1?-1:1),Tw&&(zl.setValue(yr,"toneMappingExposure",zt.toneMappingExposure),_a.needsLights&&(C_=YC,(S_=lA).ambientLightColor.needsUpdate=C_,S_.lightProbe.needsUpdate=C_,S_.directionalLights.needsUpdate=C_,S_.directionalLightShadows.needsUpdate=C_,S_.pointLights.needsUpdate=C_,S_.pointLightShadows.needsUpdate=C_,S_.spotLights.needsUpdate=C_,S_.spotLightShadows.needsUpdate=C_,S_.rectAreaLights.needsUpdate=C_,S_.hemisphereLights.needsUpdate=C_),qT&&$s.fog===!0&&ms.refreshFogUniforms(lA,qT),ms.refreshMaterialUniforms(lA,$s,xr,_r,zt.userData.transmissionRenderTarget||$r),Ov.upload(yr,_a.uniformsList,lA,fn)),$s.isShaderMaterial&&$s.uniformsNeedUpdate===!0&&(Ov.upload(yr,_a.uniformsList,lA,fn),$s.uniformsNeedUpdate=!1),$s.isSpriteMaterial&&zl.setValue(yr,"center",Mu.center),zl.setValue(yr,"modelViewMatrix",Mu.modelViewMatrix),zl.setValue(yr,"normalMatrix",Mu.normalMatrix),zl.setValue(yr,"modelMatrix",Mu.matrixWorld);const RP=$s.extraUniformsToUpload;if(RP&&Object.entries(RP).forEach(([Vl,LE])=>zl.setValue(yr,Vl,LE.value,fn)),$s.isShaderMaterial||$s.isRawShaderMaterial){const Vl=$s.uniformsGroups;for(let LE=0,DP=Vl.length;LE<DP;LE++)if(lr.isWebGL2){const ZT=Vl[LE];ty.update(ZT,ny),ty.bind(ZT,ny)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ny}(Ln,wr,kr,Ir,Qr);Yn.setMaterial(Ir,Do);let wo=kr.index,Xo=1;Ir.wireframe===!0&&(wo=br.getWireframeAttribute(kr),Xo=2);const Co=kr.drawRange,_o=kr.attributes.position;let Rp=Co.start*Xo,pp=(Co.start+Co.count)*Xo;ys!==null&&(Rp=Math.max(Rp,ys.start*Xo),pp=Math.min(pp,(ys.start+ys.count)*Xo)),wo!==null?(Rp=Math.max(Rp,0),pp=Math.min(pp,wo.count)):_o!=null&&(Rp=Math.max(Rp,0),pp=Math.min(pp,_o.count));const vu=pp-Rp;if(vu<0||vu===1/0)return;let Cw;jo.setup(Qr,Ir,zs,kr,wo);let Kl=Pp;if(wo!==null&&(Cw=Er.get(wo),Kl=lo,Kl.setIndex(Cw)),Qr.isMesh)Ir.wireframe===!0?(Yn.setLineWidth(Ir.wireframeLinewidth*Fn()),Kl.setMode(yr.LINES)):Kl.setMode(yr.TRIANGLES);else if(Qr.isLine){let Cu=Ir.linewidth;Cu===void 0&&(Cu=1),Yn.setLineWidth(Cu*Fn()),Qr.isLineSegments?Kl.setMode(yr.LINES):Qr.isLineLoop?Kl.setMode(yr.LINE_LOOP):Kl.setMode(yr.LINE_STRIP)}else Qr.isPoints?Kl.setMode(yr.POINTS):Qr.isSprite&&Kl.setMode(yr.TRIANGLES);if(Qr.isInstancedMesh)Kl.renderInstances(Rp,vu,Qr.count);else if(kr.isInstancedBufferGeometry){const Cu=kr._maxInstanceCount!==void 0?kr._maxInstanceCount:1/0,o0=Math.min(kr.instanceCount,Cu);Kl.renderInstances(Rp,vu,o0)}else Kl.render(Rp,vu)},this.compile=function(Ln,wr){function kr(Ir,Qr,ys){Ir.transparent===!0&&Ir.side===Hn&&Ir.forceSinglePass===!1?(Ir.side=nn,Ir.needsUpdate=!0,OE(Ir,Qr,ys),Ir.side=Pn,Ir.needsUpdate=!0,OE(Ir,Qr,ys),Ir.side=Hn):OE(Ir,Qr,ys)}Ot=ds.get(Ln),Ot.init(),Nt.push(Ot),Ln.traverseVisible(function(Ir){Ir.isLight&&Ir.layers.test(wr.layers)&&(Ot.pushLight(Ir),Ir.castShadow&&Ot.pushShadow(Ir))}),Ot.setupLights(zt.useLegacyLights),Ln.traverse(function(Ir){const Qr=Ir.material;if(Qr)if(Array.isArray(Qr))for(let ys=0;ys<Qr.length;ys++)kr(Qr[ys],Ln,Ir);else kr(Qr,Ln,Ir)}),Nt.pop(),Ot=null};let s1=null;function QC(){Gv.stop()}function E_(){Gv.start()}const Gv=new VM;function WC(Ln,wr,kr,Ir){if(Ln.visible===!1)return;if(Ln.layers.test(wr.layers)){if(Ln.isGroup)kr=Ln.renderOrder;else if(Ln.isLOD)Ln.autoUpdate===!0&&Ln.update(wr);else if(Ln.isLight)Ot.pushLight(Ln),Ln.castShadow&&Ot.pushShadow(Ln);else if(Ln.isSprite){if(!Ln.frustumCulled||ts.intersectsSprite(Ln)){Ir&&ss.setFromMatrixPosition(Ln.matrixWorld).applyMatrix4(Ur);const ys=Rr.update(Ln),Do=Ln.material;Do.visible&&kt.push(Ln,ys,Do,kr,ss.z,null)}}else if((Ln.isMesh||Ln.isLine||Ln.isPoints)&&(!Ln.frustumCulled||ts.intersectsObject(Ln))){Ln.isSkinnedMesh&&Ln.skeleton.frame!==On.render.frame&&(Ln.skeleton.update(),Ln.skeleton.frame=On.render.frame);const ys=Rr.update(Ln),Do=Ln.material;if(Ir&&(ys.boundingSphere===null&&ys.computeBoundingSphere(),ss.copy(ys.boundingSphere.center).applyMatrix4(Ln.matrixWorld).applyMatrix4(Ur)),Array.isArray(Do)){const zs=ys.groups;for(let wo=0,Xo=zs.length;wo<Xo;wo++){const Co=zs[wo],_o=Do[Co.materialIndex];_o&&_o.visible&&kt.push(Ln,ys,_o,kr,ss.z,Co)}}else Do.visible&&kt.push(Ln,ys,Do,kr,ss.z,null)}}const Qr=Ln.children;for(let ys=0,Do=Qr.length;ys<Do;ys++)WC(Qr[ys],wr,kr,Ir)}function WT(Ln,wr,kr,Ir){const Qr=Ln.opaque,ys=Ln.transmissive,Do=Ln.transparent;if(Ot.setupLightsView(kr),mr===!0&&Ys.setGlobalState(zt.clippingPlanes,kr),zt.userData.transmissionRender===void 0&&zt.userData.renderTransmissionPass!==!1&&ys.length>0&&function(zs,wo,Xo,Co){if(console.warn("three.js internal render transmission pass should not be called"),$r===null){const vu=lr.isWebGL2;$r=new xu(1024,1024,{generateMipmaps:!0,type:Sn.has("EXT_color_buffer_half_float")?Zp:_v,minFilter:Au,samples:vu&&ft===!0?4:0})}const _o=zt.getRenderTarget();zt.setRenderTarget($r),zt.clear();const Rp=zt.toneMapping;zt.toneMapping=Mo,o1(zs,Xo,Co),fn.updateMultisampleRenderTarget($r),fn.updateRenderTargetMipmap($r);let pp=!1;for(let vu=0,Cw=wo.length;vu<Cw;vu++){const Kl=wo[vu],Cu=Kl.object,o0=Kl.geometry,Uu=Kl.material,$s=Kl.group;if(Uu.side===Hn&&Cu.layers.test(Co.layers)){const Mu=Uu.side;Uu.side=nn,Uu.needsUpdate=!0,SP(Cu,Xo,Co,o0,Uu,$s),Uu.side=Mu,Uu.needsUpdate=!0,pp=!0}}pp===!0&&(fn.updateMultisampleRenderTarget($r),fn.updateRenderTargetMipmap($r)),zt.setRenderTarget(_o),zt.toneMapping=Rp}([...Qr,...Do],ys,wr,kr),Ir&&Yn.viewport($n.copy(Ir)),zt.userData.opaqueRender!==!1&&Qr.length>0&&o1(Qr,wr,kr),zt.userData.transparentRender!==!1&&Do.length>0&&o1(Do,wr,kr),zt.userData.transmissionRender!==!1&&ys.length>0){$r||($r=new xu(1,1));const zs=(zt.userData.transmissionRenderTarget||$r).texture,wo=lr.isWebGL2,Xo=zs.generateMipmaps,Co=zs.minFilter;wo&&zt.userData.blurTransmissionTarget&&zt.userData.transmissionRenderTarget&&(zs.generateMipmaps=!0,zs.minFilter=Au,zs.needsUpdate=!0,fn.updateMultisampleRenderTarget(zt.userData.transmissionRenderTarget),fn.updateRenderTargetMipmap(zt.userData.transmissionRenderTarget)),o1(ys,wr,kr),wo&&zt.userData.blurTransmissionTarget&&zt.userData.transmissionRenderTarget&&(zs.generateMipmaps=Xo,zs.minFilter=Co,zs.needsUpdate=!0,fn.updateMultisampleRenderTarget(zt.userData.transmissionRenderTarget),fn.updateRenderTargetMipmap(zt.userData.transmissionRenderTarget))}Yn.buffers.depth.setTest(!0),Yn.buffers.depth.setMask(!0),Yn.buffers.color.setMask(!0),Yn.setPolygonOffset(!1)}function o1(Ln,wr,kr){const Ir={...zt.userData};zt.userData.opaqueRender=void 0,zt.userData.transparentRender=void 0,zt.userData.transmissionRender=void 0,zt.userData.backgroundRender=void 0;const Qr=wr.isScene===!0?wr.overrideMaterial:null;for(let ys=0,Do=Ln.length;ys<Do;ys++){const zs=Ln[ys],wo=zs.object,Xo=zs.geometry,Co=Qr===null?zs.material:Qr,_o=zs.group;wo.layers.test(kr.layers)&&SP(wo,wr,kr,Xo,Co,_o)}Object.assign(zt.userData,Ir)}function SP(Ln,wr,kr,Ir,Qr,ys){Ln.onBeforeRender(zt,wr,kr,Ir,Qr,ys),Ln.modelViewMatrix.multiplyMatrices(kr.matrixWorldInverse,Ln.matrixWorld),Ln.normalMatrix.getNormalMatrix(Ln.modelViewMatrix),Qr.onBeforeRender(zt,wr,kr,Ir,Ln,ys),Qr.transparent===!0&&Qr.side===Hn&&Qr.forceSinglePass===!1?(Qr.side=nn,Qr.needsUpdate=!0,zt.renderBufferDirect(kr,wr,Ir,Qr,Ln,ys),Qr.side=Pn,Qr.needsUpdate=!0,zt.renderBufferDirect(kr,wr,Ir,Qr,Ln,ys),Qr.side=Hn):zt.renderBufferDirect(kr,wr,Ir,Qr,Ln,ys),Ln.onAfterRender(zt,wr,kr,Ir,Qr,ys),Qr.onAfterRender(zt,wr,kr,Ir,Ln,ys)}function OE(Ln,wr,kr){wr.isScene!==!0&&(wr=Hs);const Ir=Zn.get(Ln),Qr=Ot.state.lights,ys=Ot.state.shadowsArray,Do=Qr.state.version,zs=is.getParameters(Ln,Qr.state,ys,wr,kr),wo=is.getProgramCacheKey(zs);let Xo=Ir.programs;Ir.environment=Ln.isMeshStandardMaterial?wr.environment:null,Ir.fog=wr.fog,Ir.envMap=(Ln.isMeshStandardMaterial?qn:Gn).get(Ln.envMap||Ir.environment),Xo===void 0&&(Ln.addEventListener("dispose",EP),Xo=new Map,Ir.programs=Xo);let Co=Xo.get(wo);if(Co!==void 0){if(Ir.currentProgram===Co&&Ir.lightsStateVersion===Do)return qC(Ln,zs),Co}else zs.uniforms=is.getUniforms(Ln),Ln.onBuild(kr,zs,zt),Ln.onBeforeCompile(zs,zt),Co=is.acquireProgram(zs,wo),Xo.set(wo,Co),Ir.uniforms=zs.uniforms;const _o=Ir.uniforms;(Ln.isShaderMaterial||Ln.isRawShaderMaterial)&&Ln.clipping!==!0||(_o.clippingPlanes=Ys.uniform),qC(Ln,zs),Ir.needsLights=function(vu){return vu.isMeshLambertMaterial||vu.isMeshToonMaterial||vu.isMeshPhongMaterial||vu.isMeshStandardMaterial||vu.isShadowMaterial||vu.isShaderMaterial&&vu.lights===!0}(Ln),Ir.lightsStateVersion=Do,Ir.needsLights&&(_o.ambientLightColor.value=Qr.state.ambient,_o.lightProbe.value=Qr.state.probe,_o.directionalLights.value=Qr.state.directional,_o.directionalLightShadows.value=Qr.state.directionalShadow,_o.spotLights.value=Qr.state.spot,_o.spotLightShadows.value=Qr.state.spotShadow,_o.rectAreaLights.value=Qr.state.rectArea,_o.ltc_1.value=Qr.state.rectAreaLTC1,_o.ltc_2.value=Qr.state.rectAreaLTC2,_o.pointLights.value=Qr.state.point,_o.pointLightShadows.value=Qr.state.pointShadow,_o.hemisphereLights.value=Qr.state.hemi,_o.directionalShadowMap.value=Qr.state.directionalShadowMap,_o.directionalShadowMatrix.value=Qr.state.directionalShadowMatrix,_o.spotShadowMap.value=Qr.state.spotShadowMap,_o.spotLightMatrix.value=Qr.state.spotLightMatrix,_o.spotLightMap.value=Qr.state.spotLightMap,_o.pointShadowMap.value=Qr.state.pointShadowMap,_o.pointShadowMatrix.value=Qr.state.pointShadowMatrix);const Rp=Co.getUniforms(),pp=Ov.seqWithValue(Rp.seq,_o);return Ir.currentProgram=Co,Ir.uniformsList=pp,Co}function qC(Ln,wr){const kr=Zn.get(Ln);kr.outputColorSpace=wr.outputColorSpace,kr.instancing=wr.instancing,kr.skinning=wr.skinning,kr.morphTargets=wr.morphTargets,kr.morphNormals=wr.morphNormals,kr.morphColors=wr.morphColors,kr.morphTargetsCount=wr.morphTargetsCount,kr.numClippingPlanes=wr.numClippingPlanes,kr.numIntersection=wr.numClipIntersection,kr.vertexAlphas=wr.vertexAlphas,kr.vertexTangents=wr.vertexTangents,kr.toneMapping=wr.toneMapping}Gv.setAnimationLoop(function(Ln){s1&&s1(Ln)}),typeof self<"u"&&Gv.setContext(self),this.setAnimationLoop=function(Ln){s1=Ln,mm.setAnimationLoop(Ln),Ln===null?Gv.stop():Gv.start()},mm.addEventListener("sessionstart",QC),mm.addEventListener("sessionend",E_),this.render=function(Ln,wr){if(wr===void 0||wr.isCamera===!0){if(qt!==!0){if(Ln.matrixWorldAutoUpdate===!0&&Ln.updateMatrixWorld(),wr.parent===null&&wr.matrixWorldAutoUpdate===!0&&wr.updateMatrixWorld(),mm.enabled===!0&&mm.isPresenting===!0&&(mm.cameraAutoUpdate===!0&&mm.updateCamera(wr),wr=mm.getCamera()),Ln.isScene===!0&&Ln.onBeforeRender(zt,Ln,wr,gn),Ot=ds.get(Ln,Nt.length),Ot.init(),Nt.push(Ot),Ur.multiplyMatrices(wr.projectionMatrix,wr.matrixWorldInverse),ts.setFromProjectionMatrix(Ur),Dr=this.localClippingEnabled,mr=Ys.init(this.clippingPlanes,Dr),kt=Ps.get(Ln,Gt.length),kt.init(),Gt.push(kt),WC(Ln,wr,0,zt.sortObjects),kt.finish(),zt.sortObjects===!0&&kt.sort(Gr,ns),zt.userData.shadowMapRender!==!1){mr===!0&&Ys.beginShadows();const kr=Ot.state.shadowsArray;kr.length>0&&qs.render(kr,Ln,wr),mr===!0&&Ys.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),zt.userData.backgroundRender!==!1&&Rs.render(kt,Ln),zt.userData.sceneRender!==!1)if(Ot.setupLights(zt.useLegacyLights),wr.isArrayCamera){const kr=wr.cameras;for(let Ir=0,Qr=kr.length;Ir<Qr;Ir++){const ys=kr[Ir];WT(kt,Ln,ys,ys.viewport)}}else WT(kt,Ln,wr);gn!==null&&(fn.updateMultisampleRenderTarget(gn),fn.updateRenderTargetMipmap(gn)),Ln.isScene===!0&&Ln.onAfterRender(zt,Ln,wr),jo.resetDefaultState(),vn=-1,Un=null,Nt.pop(),Ot=Nt.length>0?Nt[Nt.length-1]:null,Gt.pop(),kt=Gt.length>0?Gt[Gt.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return $t},this.getActiveMipmapLevel=function(){return En},this.getRenderTarget=function(){return gn},this.setRenderTargetTextures=function(Ln,wr,kr){Zn.get(Ln.texture).__webglTexture=wr,Zn.get(Ln.depthTexture).__webglTexture=kr;const Ir=Zn.get(Ln);Ir.__hasExternalTextures=!0,Ir.__hasExternalTextures&&(Ir.__autoAllocateDepthBuffer=kr===void 0,Ir.__autoAllocateDepthBuffer||Sn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ir.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Ln,wr){const kr=Zn.get(Ln);kr.__webglFramebuffer=wr,kr.__useDefaultFramebuffer=wr===void 0},this.setRenderTarget=function(Ln,wr=0,kr=0){gn=Ln,$t=wr,En=kr;let Ir=!0,Qr=null,ys=!1,Do=!1;if(Ln){const zs=Zn.get(Ln);zs.__useDefaultFramebuffer!==void 0?(Yn.bindFramebuffer(yr.FRAMEBUFFER,null),Ir=!1):zs.__webglFramebuffer===void 0?fn.setupRenderTarget(Ln):zs.__hasExternalTextures&&fn.rebindTextures(Ln,Zn.get(Ln.texture).__webglTexture,Zn.get(Ln.depthTexture).__webglTexture);const wo=Ln.texture;(wo.isData3DTexture||wo.isDataArrayTexture||wo.isCompressedArrayTexture)&&(Do=!0);const Xo=Zn.get(Ln).__webglFramebuffer;Ln.isWebGLCubeRenderTarget?(Qr=Xo[wr],ys=!0):Qr=lr.isWebGL2&&Ln.samples>0&&fn.useMultisampledRTT(Ln)===!1?Zn.get(Ln).__webglMultisampledFramebuffer:Xo,$n.copy(Ln.viewport),jn.copy(Ln.scissor),sr=Ln.scissorTest}else $n.copy(Vr).multiplyScalar(xr).floor(),jn.copy(Tr).multiplyScalar(xr).floor(),sr=Yr;if(Yn.bindFramebuffer(yr.FRAMEBUFFER,Qr)&&lr.drawBuffers&&Ir&&Yn.drawBuffers(Ln,Qr),Yn.viewport($n),Yn.scissor(jn),Yn.setScissorTest(sr),ys){const zs=Zn.get(Ln.texture);yr.framebufferTexture2D(yr.FRAMEBUFFER,yr.COLOR_ATTACHMENT0,yr.TEXTURE_CUBE_MAP_POSITIVE_X+wr,zs.__webglTexture,kr)}else if(Do){const zs=Zn.get(Ln.texture),wo=wr||0;yr.framebufferTextureLayer(yr.FRAMEBUFFER,yr.COLOR_ATTACHMENT0,zs.__webglTexture,kr||0,wo)}vn=-1},this.readRenderTargetPixels=function(Ln,wr,kr,Ir,Qr,ys,Do){if(!Ln||!Ln.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let zs=Zn.get(Ln).__webglFramebuffer;if(Ln.isWebGLCubeRenderTarget&&Do!==void 0&&(zs=zs[Do]),zs){Yn.bindFramebuffer(yr.FRAMEBUFFER,zs);try{const wo=Ln.texture,Xo=wo.format,Co=wo.type;if(Xo!==Hu&&Bo.convert(Xo)!==yr.getParameter(yr.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const _o=Co===Zp&&(Sn.has("EXT_color_buffer_half_float")||lr.isWebGL2&&Sn.has("EXT_color_buffer_float"));if(!(Co===_v||Bo.convert(Co)===yr.getParameter(yr.IMPLEMENTATION_COLOR_READ_TYPE)||Co===yv&&(lr.isWebGL2||Sn.has("OES_texture_float")||Sn.has("WEBGL_color_buffer_float"))||_o))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");wr>=0&&wr<=Ln.width-Ir&&kr>=0&&kr<=Ln.height-Qr&&yr.readPixels(wr,kr,Ir,Qr,Bo.convert(Xo),Bo.convert(Co),ys)}finally{const wo=gn?Zn.get(gn).__webglFramebuffer:null;Yn.bindFramebuffer(yr.FRAMEBUFFER,wo)}}},this.copyFramebufferToTexture=function(Ln,wr,kr=0){const Ir=Math.pow(2,-kr),Qr=Math.floor(wr.image.width*Ir),ys=Math.floor(wr.image.height*Ir);fn.setTexture2D(wr,0),yr.copyTexSubImage2D(yr.TEXTURE_2D,kr,0,0,Ln.x,Ln.y,Qr,ys),Yn.unbindTexture()},this.copyTextureToTexture=function(Ln,wr,kr,Ir=0){const Qr=wr.image.width,ys=wr.image.height,Do=Bo.convert(kr.format),zs=Bo.convert(kr.type);fn.setTexture2D(kr,0),yr.pixelStorei(yr.UNPACK_FLIP_Y_WEBGL,kr.flipY),yr.pixelStorei(yr.UNPACK_PREMULTIPLY_ALPHA_WEBGL,kr.premultiplyAlpha),yr.pixelStorei(yr.UNPACK_ALIGNMENT,kr.unpackAlignment),wr.isDataTexture?yr.texSubImage2D(yr.TEXTURE_2D,Ir,Ln.x,Ln.y,Qr,ys,Do,zs,wr.image.data):wr.isCompressedTexture?yr.compressedTexSubImage2D(yr.TEXTURE_2D,Ir,Ln.x,Ln.y,wr.mipmaps[0].width,wr.mipmaps[0].height,Do,wr.mipmaps[0].data):yr.texSubImage2D(yr.TEXTURE_2D,Ir,Ln.x,Ln.y,Do,zs,wr.image),Ir===0&&kr.generateMipmaps&&yr.generateMipmap(yr.TEXTURE_2D),Yn.unbindTexture()},this.copyTextureToTexture3D=function(Ln,wr,kr,Ir,Qr=0){if(zt.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const ys=Ln.max.x-Ln.min.x+1,Do=Ln.max.y-Ln.min.y+1,zs=Ln.max.z-Ln.min.z+1,wo=Bo.convert(Ir.format),Xo=Bo.convert(Ir.type);let Co;if(Ir.isData3DTexture)fn.setTexture3D(Ir,0),Co=yr.TEXTURE_3D;else{if(!Ir.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");fn.setTexture2DArray(Ir,0),Co=yr.TEXTURE_2D_ARRAY}yr.pixelStorei(yr.UNPACK_FLIP_Y_WEBGL,Ir.flipY),yr.pixelStorei(yr.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ir.premultiplyAlpha),yr.pixelStorei(yr.UNPACK_ALIGNMENT,Ir.unpackAlignment);const _o=yr.getParameter(yr.UNPACK_ROW_LENGTH),Rp=yr.getParameter(yr.UNPACK_IMAGE_HEIGHT),pp=yr.getParameter(yr.UNPACK_SKIP_PIXELS),vu=yr.getParameter(yr.UNPACK_SKIP_ROWS),Cw=yr.getParameter(yr.UNPACK_SKIP_IMAGES),Kl=kr.isCompressedTexture?kr.mipmaps[0]:kr.image;yr.pixelStorei(yr.UNPACK_ROW_LENGTH,Kl.width),yr.pixelStorei(yr.UNPACK_IMAGE_HEIGHT,Kl.height),yr.pixelStorei(yr.UNPACK_SKIP_PIXELS,Ln.min.x),yr.pixelStorei(yr.UNPACK_SKIP_ROWS,Ln.min.y),yr.pixelStorei(yr.UNPACK_SKIP_IMAGES,Ln.min.z),kr.isDataTexture||kr.isData3DTexture?yr.texSubImage3D(Co,Qr,wr.x,wr.y,wr.z,ys,Do,zs,wo,Xo,Kl.data):kr.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),yr.compressedTexSubImage3D(Co,Qr,wr.x,wr.y,wr.z,ys,Do,zs,wo,Kl.data)):yr.texSubImage3D(Co,Qr,wr.x,wr.y,wr.z,ys,Do,zs,wo,Xo,Kl),yr.pixelStorei(yr.UNPACK_ROW_LENGTH,_o),yr.pixelStorei(yr.UNPACK_IMAGE_HEIGHT,Rp),yr.pixelStorei(yr.UNPACK_SKIP_PIXELS,pp),yr.pixelStorei(yr.UNPACK_SKIP_ROWS,vu),yr.pixelStorei(yr.UNPACK_SKIP_IMAGES,Cw),Qr===0&&Ir.generateMipmaps&&yr.generateMipmap(Co),Yn.unbindTexture()},this.initTexture=function(Ln){Ln.isCubeTexture?fn.setTextureCube(Ln,0):Ln.isData3DTexture?fn.setTexture3D(Ln,0):Ln.isDataArrayTexture||Ln.isCompressedArrayTexture?fn.setTexture2DArray(Ln,0):fn.setTexture2D(Ln,0),Yn.unbindTexture()},this.resetState=function(){$t=0,En=0,gn=null,Yn.reset(),jo.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(a){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!a}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Bs?Nl:Ym}set outputEncoding(a){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=a===Nl?Bs:io}}class rC extends Dx{}rC.prototype.isWebGL1Renderer=!0;class aw{constructor(a,j=25e-5){this.isFogExp2=!0,this.name="",this.color=new us(a),this.density=j}clone(){return new aw(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class lw{constructor(a,j=1,nt=1e3){this.isFog=!0,this.name="",this.color=new us(a),this.near=j,this.far=nt}clone(){return new lw(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class ov extends Po{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(a,j){return super.copy(a,j),a.background!==null&&(this.background=a.background.clone()),a.environment!==null&&(this.environment=a.environment.clone()),a.fog!==null&&(this.fog=a.fog.clone()),this.backgroundBlurriness=a.backgroundBlurriness,this.backgroundIntensity=a.backgroundIntensity,a.overrideMaterial!==null&&(this.overrideMaterial=a.overrideMaterial.clone()),this.matrixAutoUpdate=a.matrixAutoUpdate,this}toJSON(a){const j=super.toJSON(a);return this.fog!==null&&(j.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(j.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(j.object.backgroundIntensity=this.backgroundIntensity),j}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(a){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=a}}class Hp{constructor(a,j){this.isInterleavedBuffer=!0,this.array=a,this.stride=j,this.count=a!==void 0?a.length/j:0,this.usage=Jm,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Fp()}onUploadCallback(){}set needsUpdate(a){a===!0&&this.version++}setUsage(a){return this.usage=a,this}copy(a){return this.array=new a.array.constructor(a.array),this.count=a.count,this.stride=a.stride,this.usage=a.usage,this}copyAt(a,j,nt){a*=this.stride,nt*=j.stride;for(let it=0,ot=this.stride;it<ot;it++)this.array[a+it]=j.array[nt+it];return this}set(a,j=0){return this.array.set(a,j),this}clone(a){a.arrayBuffers===void 0&&(a.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Fp()),a.arrayBuffers[this.array.buffer._uuid]===void 0&&(a.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const j=new this.array.constructor(a.arrayBuffers[this.array.buffer._uuid]),nt=new this.constructor(j,this.stride);return nt.setUsage(this.usage),nt}onUpload(a){return this.onUploadCallback=a,this}toJSON(a){return a.arrayBuffers===void 0&&(a.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Fp()),a.arrayBuffers[this.array.buffer._uuid]===void 0&&(a.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ju=new Rn;class j0{constructor(a,j,nt,it=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=a,this.itemSize=j,this.offset=nt,this.normalized=it}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(a){this.data.needsUpdate=a}applyMatrix4(a){for(let j=0,nt=this.data.count;j<nt;j++)Ju.fromBufferAttribute(this,j),Ju.applyMatrix4(a),this.setXYZ(j,Ju.x,Ju.y,Ju.z);return this}applyNormalMatrix(a){for(let j=0,nt=this.count;j<nt;j++)Ju.fromBufferAttribute(this,j),Ju.applyNormalMatrix(a),this.setXYZ(j,Ju.x,Ju.y,Ju.z);return this}transformDirection(a){for(let j=0,nt=this.count;j<nt;j++)Ju.fromBufferAttribute(this,j),Ju.transformDirection(a),this.setXYZ(j,Ju.x,Ju.y,Ju.z);return this}setX(a,j){return this.normalized&&(j=ho(j,this.array)),this.data.array[a*this.data.stride+this.offset]=j,this}setY(a,j){return this.normalized&&(j=ho(j,this.array)),this.data.array[a*this.data.stride+this.offset+1]=j,this}setZ(a,j){return this.normalized&&(j=ho(j,this.array)),this.data.array[a*this.data.stride+this.offset+2]=j,this}setW(a,j){return this.normalized&&(j=ho(j,this.array)),this.data.array[a*this.data.stride+this.offset+3]=j,this}getX(a){let j=this.data.array[a*this.data.stride+this.offset];return this.normalized&&(j=im(j,this.array)),j}getY(a){let j=this.data.array[a*this.data.stride+this.offset+1];return this.normalized&&(j=im(j,this.array)),j}getZ(a){let j=this.data.array[a*this.data.stride+this.offset+2];return this.normalized&&(j=im(j,this.array)),j}getW(a){let j=this.data.array[a*this.data.stride+this.offset+3];return this.normalized&&(j=im(j,this.array)),j}setXY(a,j,nt){return a=a*this.data.stride+this.offset,this.normalized&&(j=ho(j,this.array),nt=ho(nt,this.array)),this.data.array[a+0]=j,this.data.array[a+1]=nt,this}setXYZ(a,j,nt,it){return a=a*this.data.stride+this.offset,this.normalized&&(j=ho(j,this.array),nt=ho(nt,this.array),it=ho(it,this.array)),this.data.array[a+0]=j,this.data.array[a+1]=nt,this.data.array[a+2]=it,this}setXYZW(a,j,nt,it,ot){return a=a*this.data.stride+this.offset,this.normalized&&(j=ho(j,this.array),nt=ho(nt,this.array),it=ho(it,this.array),ot=ho(ot,this.array)),this.data.array[a+0]=j,this.data.array[a+1]=nt,this.data.array[a+2]=it,this.data.array[a+3]=ot,this}clone(a){if(a===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const j=[];for(let nt=0;nt<this.count;nt++){const it=nt*this.data.stride+this.offset;for(let ot=0;ot<this.itemSize;ot++)j.push(this.data.array[it+ot])}return new Jo(new this.array.constructor(j),this.itemSize,this.normalized)}return a.interleavedBuffers===void 0&&(a.interleavedBuffers={}),a.interleavedBuffers[this.data.uuid]===void 0&&(a.interleavedBuffers[this.data.uuid]=this.data.clone(a)),new j0(a.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(a){if(a===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const j=[];for(let nt=0;nt<this.count;nt++){const it=nt*this.data.stride+this.offset;for(let ot=0;ot<this.itemSize;ot++)j.push(this.data.array[it+ot])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:j,normalized:this.normalized}}return a.interleavedBuffers===void 0&&(a.interleavedBuffers={}),a.interleavedBuffers[this.data.uuid]===void 0&&(a.interleavedBuffers[this.data.uuid]=this.data.toJSON(a)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class sT extends ku{constructor(a){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new us(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.rotation=a.rotation,this.sizeAttenuation=a.sizeAttenuation,this.fog=a.fog,this}}let av;const cw=new Rn,Vy=new Rn,Gy=new Rn,Hy=new Br,rE=new Br,L2=new ro,sC=new Rn,sE=new Rn,oE=new Rn,kx=new Br,oC=new Br,aC=new Br;class z0 extends Po{constructor(a){if(super(),this.isSprite=!0,this.type="Sprite",av===void 0){av=new Vt;const j=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),nt=new Hp(j,5);av.setIndex([0,1,2,0,2,3]),av.setAttribute("position",new j0(nt,3,0,!1)),av.setAttribute("uv",new j0(nt,2,3,!1))}this.geometry=av,this.material=a!==void 0?a:new sT,this.center=new Br(.5,.5)}raycast(a,j){a.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Vy.setFromMatrixScale(this.matrixWorld),L2.copy(a.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(a.camera.matrixWorldInverse,this.matrixWorld),Gy.setFromMatrixPosition(this.modelViewMatrix),a.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Vy.multiplyScalar(-Gy.z);const nt=this.material.rotation;let it,ot;nt!==0&&(ot=Math.cos(nt),it=Math.sin(nt));const ht=this.center;aE(sC.set(-.5,-.5,0),Gy,ht,Vy,it,ot),aE(sE.set(.5,-.5,0),Gy,ht,Vy,it,ot),aE(oE.set(.5,.5,0),Gy,ht,Vy,it,ot),kx.set(0,0),oC.set(1,0),aC.set(1,1);let ft=a.ray.intersectTriangle(sC,sE,oE,!1,cw);if(ft===null&&(aE(sE.set(-.5,.5,0),Gy,ht,Vy,it,ot),oC.set(0,1),ft=a.ray.intersectTriangle(sC,oE,sE,!1,cw),ft===null))return;const wt=a.ray.origin.distanceTo(cw);wt<a.near||wt>a.far||j.push({distance:wt,point:cw.clone(),uv:ru.getInterpolation(cw,sC,sE,oE,kx,oC,aC,new Br),face:null,object:this})}copy(a,j){return super.copy(a,j),a.center!==void 0&&this.center.copy(a.center),this.material=a.material,this}}function aE(ut,a,j,nt,it,ot){Hy.subVectors(ut,j).addScalar(.5).multiply(nt),it!==void 0?(rE.x=ot*Hy.x-it*Hy.y,rE.y=it*Hy.x+ot*Hy.y):rE.copy(Hy),ut.copy(a),ut.x+=rE.x,ut.y+=rE.y,ut.applyMatrix4(L2)}const Nm=new Rn,Um=new Rn;class Bx extends Po{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(a){super.copy(a,!1);const j=a.levels;for(let nt=0,it=j.length;nt<it;nt++){const ot=j[nt];this.addLevel(ot.object.clone(),ot.distance,ot.hysteresis)}return this.autoUpdate=a.autoUpdate,this}addLevel(a,j=0,nt=0){j=Math.abs(j);const it=this.levels;let ot;for(ot=0;ot<it.length&&!(j<it[ot].distance);ot++);return it.splice(ot,0,{distance:j,hysteresis:nt,object:a}),this.add(a),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(a){const j=this.levels;if(j.length>0){let nt,it;for(nt=1,it=j.length;nt<it;nt++){let ot=j[nt].distance;if(j[nt].object.visible&&(ot-=ot*j[nt].hysteresis),a<ot)break}return j[nt-1].object}return null}raycast(a,j){if(this.levels.length>0){Nm.setFromMatrixPosition(this.matrixWorld);const nt=a.ray.origin.distanceTo(Nm);this.getObjectForDistance(nt).raycast(a,j)}}update(a){const j=this.levels;if(j.length>1){Nm.setFromMatrixPosition(a.matrixWorld),Um.setFromMatrixPosition(this.matrixWorld);const nt=Nm.distanceTo(Um)/a.zoom;let it,ot;for(j[0].object.visible=!0,it=1,ot=j.length;it<ot;it++){let ht=j[it].distance;if(j[it].object.visible&&(ht-=ht*j[it].hysteresis),!(nt>=ht))break;j[it-1].object.visible=!1,j[it].object.visible=!0}for(this._currentLevel=it-1;it<ot;it++)j[it].object.visible=!1}}toJSON(a){const j=super.toJSON(a);this.autoUpdate===!1&&(j.object.autoUpdate=!1),j.object.levels=[];const nt=this.levels;for(let it=0,ot=nt.length;it<ot;it++){const ht=nt[it];j.object.levels.push({object:ht.object.uuid,distance:ht.distance,hysteresis:ht.hysteresis})}return j}}const lC=new Rn,am=new No,N2=new No,uB=new Rn,cC=new ro,uw=new Rn;class Fm extends Ou{constructor(a,j){super(a,j),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ro,this.bindMatrixInverse=new ro,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const a=this.geometry;this.boundingBox===null&&(this.boundingBox=new Zm),this.boundingBox.makeEmpty();const j=a.getAttribute("position");for(let nt=0;nt<j.count;nt++)uw.fromBufferAttribute(j,nt),this.applyBoneTransform(nt,uw),this.boundingBox.expandByPoint(uw)}computeBoundingSphere(){const a=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Dm),this.boundingSphere.makeEmpty();const j=a.getAttribute("position");for(let nt=0;nt<j.count;nt++)uw.fromBufferAttribute(j,nt),this.applyBoneTransform(nt,uw),this.boundingSphere.expandByPoint(uw)}copy(a,j){return super.copy(a,j),this.bindMode=a.bindMode,this.bindMatrix.copy(a.bindMatrix),this.bindMatrixInverse.copy(a.bindMatrixInverse),this.skeleton=a.skeleton,this}getVertexPosition(a,j){return super.getVertexPosition(a,j),this.applyBoneTransform(a,j),j}bind(a,j){this.skeleton=a,j===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),j=this.matrixWorld),this.bindMatrix.copy(j),this.bindMatrixInverse.copy(j).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const a=new No,j=this.geometry.attributes.skinWeight;for(let nt=0,it=j.count;nt<it;nt++){a.fromBufferAttribute(j,nt);const ot=1/a.manhattanLength();ot!==1/0?a.multiplyScalar(ot):a.set(1,0,0,0),j.setXYZW(nt,a.x,a.y,a.z,a.w)}}updateMatrixWorld(a){super.updateMatrixWorld(a),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(a,j){const nt=this.skeleton,it=this.geometry;am.fromBufferAttribute(it.attributes.skinIndex,a),N2.fromBufferAttribute(it.attributes.skinWeight,a),lC.copy(j).applyMatrix4(this.bindMatrix),j.set(0,0,0);for(let ot=0;ot<4;ot++){const ht=N2.getComponent(ot);if(ht!==0){const ft=am.getComponent(ot);cC.multiplyMatrices(nt.bones[ft].matrixWorld,nt.boneInverses[ft]),j.addScaledVector(uB.copy(lC).applyMatrix4(cC),ht)}}return j.applyMatrix4(this.bindMatrixInverse)}boneTransform(a,j){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(a,j)}}class hp extends Po{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Ox extends ga{constructor(a=null,j=1,nt=1,it,ot,ht,ft,wt,bt=Yo,St=Yo,Dt,Rt){super(null,ht,ft,wt,bt,St,it,ot,Dt,Rt),this.isDataTexture=!0,this.image={data:a,width:j,height:nt},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const U2=new ro,Lx=new ro;class Qy{constructor(a=[],j=[]){this.uuid=Fp(),this.bones=a.slice(0),this.boneInverses=j,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const a=this.bones,j=this.boneInverses;if(this.boneMatrices=new Float32Array(16*a.length),j.length===0)this.calculateInverses();else if(a.length!==j.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let nt=0,it=this.bones.length;nt<it;nt++)this.boneInverses.push(new ro)}}calculateInverses(){this.boneInverses.length=0;for(let a=0,j=this.bones.length;a<j;a++){const nt=new ro;this.bones[a]&&nt.copy(this.bones[a].matrixWorld).invert(),this.boneInverses.push(nt)}}pose(){for(let a=0,j=this.bones.length;a<j;a++){const nt=this.bones[a];nt&&nt.matrixWorld.copy(this.boneInverses[a]).invert()}for(let a=0,j=this.bones.length;a<j;a++){const nt=this.bones[a];nt&&(nt.parent&&nt.parent.isBone?(nt.matrix.copy(nt.parent.matrixWorld).invert(),nt.matrix.multiply(nt.matrixWorld)):nt.matrix.copy(nt.matrixWorld),nt.matrix.decompose(nt.position,nt.quaternion,nt.scale))}}update(){const a=this.bones,j=this.boneInverses,nt=this.boneMatrices,it=this.boneTexture;for(let ot=0,ht=a.length;ot<ht;ot++){const ft=a[ot]?a[ot].matrixWorld:Lx;U2.multiplyMatrices(ft,j[ot]),U2.toArray(nt,16*ot)}it!==null&&(it.needsUpdate=!0)}clone(){return new Qy(this.bones,this.boneInverses)}computeBoneTexture(){let a=Math.sqrt(4*this.bones.length);a=Ao(a),a=Math.max(a,4);const j=new Float32Array(a*a*4);j.set(this.boneMatrices);const nt=new Ox(j,a,a,Hu,yv);return nt.needsUpdate=!0,this.boneMatrices=j,this.boneTexture=nt,this.boneTextureSize=a,this}getBoneByName(a){for(let j=0,nt=this.bones.length;j<nt;j++){const it=this.bones[j];if(it.name===a)return it}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(a,j){this.uuid=a.uuid;for(let nt=0,it=a.bones.length;nt<it;nt++){const ot=a.bones[nt];let ht=j[ot];ht===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",ot),ht=new hp),this.bones.push(ht),this.boneInverses.push(new ro().fromArray(a.boneInverses[nt]))}return this.init(),this}toJSON(){const a={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};a.uuid=this.uuid;const j=this.bones,nt=this.boneInverses;for(let it=0,ot=j.length;it<ot;it++){const ht=j[it];a.bones.push(ht.uuid);const ft=nt[it];a.boneInverses.push(ft.toArray())}return a}}class Qp extends Jo{constructor(a,j,nt,it=1){super(a,j,nt),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=it}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}toJSON(){const a=super.toJSON();return a.meshPerAttribute=this.meshPerAttribute,a.isInstancedBufferAttribute=!0,a}}const v_=new ro,Wy=new ro,Tp=[],Nx=new Zm,F2=new ro,lE=new Ou,Ux=new Dm;class j2 extends Ou{constructor(a,j,nt){super(a,j),this.isInstancedMesh=!0,this.instanceMatrix=new Qp(new Float32Array(16*nt),16),this.instanceColor=null,this.sourceTrs=null,this.count=nt,this.boundingBox=null,this.boundingSphere=null;for(let it=0;it<nt;it++)this.setMatrixAt(it,F2)}computeBoundingBox(){const a=this.geometry,j=this.count;this.boundingBox===null&&(this.boundingBox=new Zm),a.boundingBox===null&&a.computeBoundingBox(),this.boundingBox.makeEmpty();for(let nt=0;nt<j;nt++)this.getMatrixAt(nt,v_),Nx.copy(a.boundingBox).applyMatrix4(v_),this.boundingBox.union(Nx)}computeBoundingSphere(){const a=this.geometry,j=this.count;this.boundingSphere===null&&(this.boundingSphere=new Dm),a.boundingSphere===null&&a.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let nt=0;nt<j;nt++)this.getMatrixAt(nt,v_),Ux.copy(a.boundingSphere).applyMatrix4(v_),this.boundingSphere.union(Ux)}copy(a,j){return super.copy(a,j),a.isInstancedMesh?(this.instanceMatrix.copy(a.instanceMatrix),a.instanceColor!==null&&(this.instanceColor=a.instanceColor.clone()),this.count=a.count,this):this}getColorAt(a,j){j.fromArray(this.instanceColor.array,3*a)}getMatrixAt(a,j){j.fromArray(this.instanceMatrix.array,16*a)}raycast(a,j){const nt=this.matrixWorld,it=this.count;if(lE.geometry=this.geometry,lE.material=this.material,lE.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Ux.copy(this.boundingSphere),Ux.applyMatrix4(nt),a.ray.intersectsSphere(Ux)!==!1))for(let ot=0;ot<it;ot++){this.getMatrixAt(ot,v_),Wy.multiplyMatrices(nt,v_),lE.matrixWorld=Wy,lE.raycast(a,Tp);for(let ht=0,ft=Tp.length;ht<ft;ht++){const wt=Tp[ht];wt.instanceId=ot,wt.object=this,j.push(wt)}Tp.length=0}}setColorAt(a,j){this.instanceColor===null&&(this.instanceColor=new Qp(new Float32Array(3*this.instanceMatrix.count),3)),j.toArray(this.instanceColor.array,3*a)}setMatrixAt(a,j){j.toArray(this.instanceMatrix.array,16*a)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class lm extends ku{constructor(a){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new us(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.linewidth=a.linewidth,this.linecap=a.linecap,this.linejoin=a.linejoin,this.fog=a.fog,this}}const oT=new Rn,aT=new Rn,Ip=new ro,Ro=new C0,hw=new Dm;class Uo extends Po{constructor(a=new Vt,j=new lm){super(),this.isLine=!0,this.type="Line",this.geometry=a,this.material=j,this.updateMorphTargets()}copy(a,j){return super.copy(a,j),this.material=a.material,this.geometry=a.geometry,this}computeLineDistances(){const a=this.geometry;if(a.index===null){const j=a.attributes.position,nt=[0];for(let it=1,ot=j.count;it<ot;it++)oT.fromBufferAttribute(j,it-1),aT.fromBufferAttribute(j,it),nt[it]=nt[it-1],nt[it]+=oT.distanceTo(aT);a.setAttribute("lineDistance",new fs(nt,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(a,j){const nt=this.geometry,it=this.matrixWorld,ot=a.params.Line.threshold,ht=nt.drawRange;if(nt.boundingSphere===null&&nt.computeBoundingSphere(),hw.copy(nt.boundingSphere),hw.applyMatrix4(it),hw.radius+=ot,a.ray.intersectsSphere(hw)===!1)return;Ip.copy(it).invert(),Ro.copy(a.ray).applyMatrix4(Ip);const ft=ot/((this.scale.x+this.scale.y+this.scale.z)/3),wt=ft*ft,bt=new Rn,St=new Rn,Dt=new Rn,Rt=new Rn,kt=this.isLineSegments?2:1,Ot=nt.index,Gt=nt.attributes.position;if(Ot!==null)for(let Nt=Math.max(0,ht.start),zt=Math.min(Ot.count,ht.start+ht.count)-1;Nt<zt;Nt+=kt){const qt=Ot.getX(Nt),$t=Ot.getX(Nt+1);if(bt.fromBufferAttribute(Gt,qt),St.fromBufferAttribute(Gt,$t),Ro.distanceSqToSegment(bt,St,Rt,Dt)>wt)continue;Rt.applyMatrix4(this.matrixWorld);const En=a.ray.origin.distanceTo(Rt);En<a.near||En>a.far||j.push({distance:En,point:Dt.clone().applyMatrix4(this.matrixWorld),index:Nt,face:null,faceIndex:null,object:this})}else for(let Nt=Math.max(0,ht.start),zt=Math.min(Gt.count,ht.start+ht.count)-1;Nt<zt;Nt+=kt){if(bt.fromBufferAttribute(Gt,Nt),St.fromBufferAttribute(Gt,Nt+1),Ro.distanceSqToSegment(bt,St,Rt,Dt)>wt)continue;Rt.applyMatrix4(this.matrixWorld);const qt=a.ray.origin.distanceTo(Rt);qt<a.near||qt>a.far||j.push({distance:qt,point:Dt.clone().applyMatrix4(this.matrixWorld),index:Nt,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const a=this.geometry.morphAttributes,j=Object.keys(a);if(j.length>0){const nt=a[j[0]];if(nt!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let it=0,ot=nt.length;it<ot;it++){const ht=nt[it].name||String(it);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ht]=it}}}}}const z2=new Rn,uC=new Rn;class Nv extends Uo{constructor(a,j){super(a,j),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const a=this.geometry;if(a.index===null){const j=a.attributes.position,nt=[];for(let it=0,ot=j.count;it<ot;it+=2)z2.fromBufferAttribute(j,it),uC.fromBufferAttribute(j,it+1),nt[it]=it===0?0:nt[it-1],nt[it+1]=nt[it]+z2.distanceTo(uC);a.setAttribute("lineDistance",new fs(nt,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Uv extends Uo{constructor(a,j){super(a,j),this.isLineLoop=!0,this.type="LineLoop"}}class dw extends ku{constructor(a){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new us(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.size=a.size,this.sizeAttenuation=a.sizeAttenuation,this.fog=a.fog,this}}const cE=new ro,hC=new C0,Fx=new Dm,uE=new Rn;class dC extends Po{constructor(a=new Vt,j=new dw){super(),this.isPoints=!0,this.type="Points",this.geometry=a,this.material=j,this.updateMorphTargets()}copy(a,j){return super.copy(a,j),this.material=a.material,this.geometry=a.geometry,this}raycast(a,j){const nt=this.geometry,it=this.matrixWorld,ot=a.params.Points.threshold,ht=nt.drawRange;if(nt.boundingSphere===null&&nt.computeBoundingSphere(),Fx.copy(nt.boundingSphere),Fx.applyMatrix4(it),Fx.radius+=ot,a.ray.intersectsSphere(Fx)===!1)return;cE.copy(it).invert(),hC.copy(a.ray).applyMatrix4(cE);const ft=ot/((this.scale.x+this.scale.y+this.scale.z)/3),wt=ft*ft,bt=nt.index,St=nt.attributes.position;if(bt!==null)for(let Dt=Math.max(0,ht.start),Rt=Math.min(bt.count,ht.start+ht.count);Dt<Rt;Dt++){const kt=bt.getX(Dt);uE.fromBufferAttribute(St,kt),hE(uE,kt,wt,it,a,j,this)}else for(let Dt=Math.max(0,ht.start),Rt=Math.min(St.count,ht.start+ht.count);Dt<Rt;Dt++)uE.fromBufferAttribute(St,Dt),hE(uE,Dt,wt,it,a,j,this)}updateMorphTargets(){const a=this.geometry.morphAttributes,j=Object.keys(a);if(j.length>0){const nt=a[j[0]];if(nt!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let it=0,ot=nt.length;it<ot;it++){const ht=nt[it].name||String(it);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ht]=it}}}}}function hE(ut,a,j,nt,it,ot,ht){const ft=hC.distanceSqToPoint(ut);if(ft<j){const wt=new Rn;hC.closestPointToPoint(ut,wt),wt.applyMatrix4(nt);const bt=it.ray.origin.distanceTo(wt);if(bt<it.near||bt>it.far)return;ot.push({distance:bt,distanceToRay:Math.sqrt(ft),point:wt,index:a,face:null,object:ht})}}class V2 extends ga{constructor(a,j,nt,it,ot,ht,ft,wt,bt){super(a,j,nt,it,ot,ht,ft,wt,bt),this.isVideoTexture=!0,this.minFilter=ht!==void 0?ht:Il,this.magFilter=ot!==void 0?ot:Il,this.generateMipmaps=!1;const St=this;"requestVideoFrameCallback"in a&&a.requestVideoFrameCallback(function Dt(){St.needsUpdate=!0,a.requestVideoFrameCallback(Dt)})}clone(){return new this.constructor(this.image).copy(this)}update(){const a=this.image;!("requestVideoFrameCallback"in a)&&a.readyState>=a.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class lT extends ga{constructor(a,j,nt){super({width:a,height:j}),this.isFramebufferTexture=!0,this.format=nt,this.magFilter=Yo,this.minFilter=Yo,this.generateMipmaps=!1,this.needsUpdate=!0}}class dE extends ga{constructor(a,j,nt,it,ot,ht,ft,wt,bt,St,Dt,Rt){super(null,ht,ft,wt,bt,St,it,ot,Dt,Rt),this.isCompressedTexture=!0,this.image={width:j,height:nt},this.mipmaps=a,this.flipY=!1,this.generateMipmaps=!1}}class cT extends dE{constructor(a,j,nt,it,ot,ht){super(a,j,nt,ot,ht),this.isCompressedArrayTexture=!0,this.image.depth=it,this.wrapR=Tl}}class G2 extends ga{constructor(a,j,nt,it,ot,ht,ft,wt,bt){super(a,j,nt,it,ot,ht,ft,wt,bt),this.isCanvasTexture=!0,this.needsUpdate=!0}}class jm{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(a,j){const nt=this.getUtoTmapping(a);return this.getPoint(nt,j)}getPoints(a=5){const j=[];for(let nt=0;nt<=a;nt++)j.push(this.getPoint(nt/a));return j}getSpacedPoints(a=5){const j=[];for(let nt=0;nt<=a;nt++)j.push(this.getPointAt(nt/a));return j}getLength(){const a=this.getLengths();return a[a.length-1]}getLengths(a=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const j=[];let nt,it=this.getPoint(0),ot=0;j.push(0);for(let ht=1;ht<=a;ht++)nt=this.getPoint(ht/a),ot+=nt.distanceTo(it),j.push(ot),it=nt;return this.cacheArcLengths=j,j}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(a,j){const nt=this.getLengths();let it=0;const ot=nt.length;let ht;ht=j||a*nt[ot-1];let ft,wt=0,bt=ot-1;for(;wt<=bt;)if(it=Math.floor(wt+(bt-wt)/2),ft=nt[it]-ht,ft<0)wt=it+1;else{if(!(ft>0)){bt=it;break}bt=it-1}if(it=bt,nt[it]===ht)return it/(ot-1);const St=nt[it];return(it+(ht-St)/(nt[it+1]-St))/(ot-1)}getTangent(a,j){let it=a-1e-4,ot=a+1e-4;it<0&&(it=0),ot>1&&(ot=1);const ht=this.getPoint(it),ft=this.getPoint(ot),wt=j||(ht.isVector2?new Br:new Rn);return wt.copy(ft).sub(ht).normalize(),wt}getTangentAt(a,j){const nt=this.getUtoTmapping(a);return this.getTangent(nt,j)}computeFrenetFrames(a,j){const nt=new Rn,it=[],ot=[],ht=[],ft=new Rn,wt=new ro;for(let kt=0;kt<=a;kt++){const Ot=kt/a;it[kt]=this.getTangentAt(Ot,new Rn)}ot[0]=new Rn,ht[0]=new Rn;let bt=Number.MAX_VALUE;const St=Math.abs(it[0].x),Dt=Math.abs(it[0].y),Rt=Math.abs(it[0].z);St<=bt&&(bt=St,nt.set(1,0,0)),Dt<=bt&&(bt=Dt,nt.set(0,1,0)),Rt<=bt&&nt.set(0,0,1),ft.crossVectors(it[0],nt).normalize(),ot[0].crossVectors(it[0],ft),ht[0].crossVectors(it[0],ot[0]);for(let kt=1;kt<=a;kt++){if(ot[kt]=ot[kt-1].clone(),ht[kt]=ht[kt-1].clone(),ft.crossVectors(it[kt-1],it[kt]),ft.length()>Number.EPSILON){ft.normalize();const Ot=Math.acos(Is(it[kt-1].dot(it[kt]),-1,1));ot[kt].applyMatrix4(wt.makeRotationAxis(ft,Ot))}ht[kt].crossVectors(it[kt],ot[kt])}if(j===!0){let kt=Math.acos(Is(ot[0].dot(ot[a]),-1,1));kt/=a,it[0].dot(ft.crossVectors(ot[0],ot[a]))>0&&(kt=-kt);for(let Ot=1;Ot<=a;Ot++)ot[Ot].applyMatrix4(wt.makeRotationAxis(it[Ot],kt*Ot)),ht[Ot].crossVectors(it[Ot],ot[Ot])}return{tangents:it,normals:ot,binormals:ht}}clone(){return new this.constructor().copy(this)}copy(a){return this.arcLengthDivisions=a.arcLengthDivisions,this}toJSON(){const a={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return a.arcLengthDivisions=this.arcLengthDivisions,a.type=this.type,a}fromJSON(a){return this.arcLengthDivisions=a.arcLengthDivisions,this}}class pE extends jm{constructor(a=0,j=0,nt=1,it=1,ot=0,ht=2*Math.PI,ft=!1,wt=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=a,this.aY=j,this.xRadius=nt,this.yRadius=it,this.aStartAngle=ot,this.aEndAngle=ht,this.aClockwise=ft,this.aRotation=wt}getPoint(a,j){const nt=j||new Br,it=2*Math.PI;let ot=this.aEndAngle-this.aStartAngle;const ht=Math.abs(ot)<Number.EPSILON;for(;ot<0;)ot+=it;for(;ot>it;)ot-=it;ot<Number.EPSILON&&(ot=ht?0:it),this.aClockwise!==!0||ht||(ot===it?ot=-it:ot-=it);const ft=this.aStartAngle+a*ot;let wt=this.aX+this.xRadius*Math.cos(ft),bt=this.aY+this.yRadius*Math.sin(ft);if(this.aRotation!==0){const St=Math.cos(this.aRotation),Dt=Math.sin(this.aRotation),Rt=wt-this.aX,kt=bt-this.aY;wt=Rt*St-kt*Dt+this.aX,bt=Rt*Dt+kt*St+this.aY}return nt.set(wt,bt)}copy(a){return super.copy(a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this}toJSON(){const a=super.toJSON();return a.aX=this.aX,a.aY=this.aY,a.xRadius=this.xRadius,a.yRadius=this.yRadius,a.aStartAngle=this.aStartAngle,a.aEndAngle=this.aEndAngle,a.aClockwise=this.aClockwise,a.aRotation=this.aRotation,a}fromJSON(a){return super.fromJSON(a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this}}class uT extends pE{constructor(a,j,nt,it,ot,ht){super(a,j,nt,nt,it,ot,ht),this.isArcCurve=!0,this.type="ArcCurve"}}function pC(){let ut=0,a=0,j=0,nt=0;function it(ot,ht,ft,wt){ut=ot,a=ft,j=-3*ot+3*ht-2*ft-wt,nt=2*ot-2*ht+ft+wt}return{initCatmullRom:function(ot,ht,ft,wt,bt){it(ht,ft,bt*(ft-ot),bt*(wt-ht))},initNonuniformCatmullRom:function(ot,ht,ft,wt,bt,St,Dt){let Rt=(ht-ot)/bt-(ft-ot)/(bt+St)+(ft-ht)/St,kt=(ft-ht)/St-(wt-ht)/(St+Dt)+(wt-ft)/Dt;Rt*=St,kt*=St,it(ht,ft,Rt,kt)},calc:function(ot){const ht=ot*ot;return ut+a*ot+j*ht+nt*(ht*ot)}}}const qy=new Rn,fC=new pC,mC=new pC,Wl=new pC;class hT extends jm{constructor(a=[],j=!1,nt="centripetal",it=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=a,this.closed=j,this.curveType=nt,this.tension=it}getPoint(a,j=new Rn){const nt=j,it=this.points,ot=it.length,ht=(ot-(this.closed?0:1))*a;let ft,wt,bt=Math.floor(ht),St=ht-bt;this.closed?bt+=bt>0?0:(Math.floor(Math.abs(bt)/ot)+1)*ot:St===0&&bt===ot-1&&(bt=ot-2,St=1),this.closed||bt>0?ft=it[(bt-1)%ot]:(qy.subVectors(it[0],it[1]).add(it[0]),ft=qy);const Dt=it[bt%ot],Rt=it[(bt+1)%ot];if(this.closed||bt+2<ot?wt=it[(bt+2)%ot]:(qy.subVectors(it[ot-1],it[ot-2]).add(it[ot-1]),wt=qy),this.curveType==="centripetal"||this.curveType==="chordal"){const kt=this.curveType==="chordal"?.5:.25;let Ot=Math.pow(ft.distanceToSquared(Dt),kt),Gt=Math.pow(Dt.distanceToSquared(Rt),kt),Nt=Math.pow(Rt.distanceToSquared(wt),kt);Gt<1e-4&&(Gt=1),Ot<1e-4&&(Ot=Gt),Nt<1e-4&&(Nt=Gt),fC.initNonuniformCatmullRom(ft.x,Dt.x,Rt.x,wt.x,Ot,Gt,Nt),mC.initNonuniformCatmullRom(ft.y,Dt.y,Rt.y,wt.y,Ot,Gt,Nt),Wl.initNonuniformCatmullRom(ft.z,Dt.z,Rt.z,wt.z,Ot,Gt,Nt)}else this.curveType==="catmullrom"&&(fC.initCatmullRom(ft.x,Dt.x,Rt.x,wt.x,this.tension),mC.initCatmullRom(ft.y,Dt.y,Rt.y,wt.y,this.tension),Wl.initCatmullRom(ft.z,Dt.z,Rt.z,wt.z,this.tension));return nt.set(fC.calc(St),mC.calc(St),Wl.calc(St)),nt}copy(a){super.copy(a),this.points=[];for(let j=0,nt=a.points.length;j<nt;j++){const it=a.points[j];this.points.push(it.clone())}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this}toJSON(){const a=super.toJSON();a.points=[];for(let j=0,nt=this.points.length;j<nt;j++){const it=this.points[j];a.points.push(it.toArray())}return a.closed=this.closed,a.curveType=this.curveType,a.tension=this.tension,a}fromJSON(a){super.fromJSON(a),this.points=[];for(let j=0,nt=a.points.length;j<nt;j++){const it=a.points[j];this.points.push(new Rn().fromArray(it))}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this}}function gC(ut,a,j,nt,it){const ot=.5*(nt-a),ht=.5*(it-j),ft=ut*ut;return(2*j-2*nt+ot+ht)*(ut*ft)+(-3*j+3*nt-2*ot-ht)*ft+ot*ut+j}function V0(ut,a,j,nt){return function(it,ot){const ht=1-it;return ht*ht*ot}(ut,a)+function(it,ot){return 2*(1-it)*it*ot}(ut,j)+function(it,ot){return it*it*ot}(ut,nt)}function pw(ut,a,j,nt,it){return function(ot,ht){const ft=1-ot;return ft*ft*ft*ht}(ut,a)+function(ot,ht){const ft=1-ot;return 3*ft*ft*ot*ht}(ut,j)+function(ot,ht){return 3*(1-ot)*ot*ot*ht}(ut,nt)+function(ot,ht){return ot*ot*ot*ht}(ut,it)}class dT extends jm{constructor(a=new Br,j=new Br,nt=new Br,it=new Br){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=a,this.v1=j,this.v2=nt,this.v3=it}getPoint(a,j=new Br){const nt=j,it=this.v0,ot=this.v1,ht=this.v2,ft=this.v3;return nt.set(pw(a,it.x,ot.x,ht.x,ft.x),pw(a,it.y,ot.y,ht.y,ft.y)),nt}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this}}class H2 extends jm{constructor(a=new Rn,j=new Rn,nt=new Rn,it=new Rn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=a,this.v1=j,this.v2=nt,this.v3=it}getPoint(a,j=new Rn){const nt=j,it=this.v0,ot=this.v1,ht=this.v2,ft=this.v3;return nt.set(pw(a,it.x,ot.x,ht.x,ft.x),pw(a,it.y,ot.y,ht.y,ft.y),pw(a,it.z,ot.z,ht.z,ft.z)),nt}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this}}class vC extends jm{constructor(a=new Br,j=new Br){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=a,this.v2=j}getPoint(a,j=new Br){const nt=j;return a===1?nt.copy(this.v2):(nt.copy(this.v2).sub(this.v1),nt.multiplyScalar(a).add(this.v1)),nt}getPointAt(a,j){return this.getPoint(a,j)}getTangent(a,j=new Br){return j.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,j){return this.getTangent(a,j)}copy(a){return super.copy(a),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class Q2 extends jm{constructor(a=new Rn,j=new Rn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=a,this.v2=j}getPoint(a,j=new Rn){const nt=j;return a===1?nt.copy(this.v2):(nt.copy(this.v2).sub(this.v1),nt.multiplyScalar(a).add(this.v1)),nt}getPointAt(a,j){return this.getPoint(a,j)}getTangent(a,j=new Rn){return j.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,j){return this.getTangent(a,j)}copy(a){return super.copy(a),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class pT extends jm{constructor(a=new Br,j=new Br,nt=new Br){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=a,this.v1=j,this.v2=nt}getPoint(a,j=new Br){const nt=j,it=this.v0,ot=this.v1,ht=this.v2;return nt.set(V0(a,it.x,ot.x,ht.x),V0(a,it.y,ot.y,ht.y)),nt}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class fE extends jm{constructor(a=new Rn,j=new Rn,nt=new Rn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=a,this.v1=j,this.v2=nt}getPoint(a,j=new Rn){const nt=j,it=this.v0,ot=this.v1,ht=this.v2;return nt.set(V0(a,it.x,ot.x,ht.x),V0(a,it.y,ot.y,ht.y),V0(a,it.z,ot.z,ht.z)),nt}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class fT extends jm{constructor(a=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=a}getPoint(a,j=new Br){const nt=j,it=this.points,ot=(it.length-1)*a,ht=Math.floor(ot),ft=ot-ht,wt=it[ht===0?ht:ht-1],bt=it[ht],St=it[ht>it.length-2?it.length-1:ht+1],Dt=it[ht>it.length-3?it.length-1:ht+2];return nt.set(gC(ft,wt.x,bt.x,St.x,Dt.x),gC(ft,wt.y,bt.y,St.y,Dt.y)),nt}copy(a){super.copy(a),this.points=[];for(let j=0,nt=a.points.length;j<nt;j++){const it=a.points[j];this.points.push(it.clone())}return this}toJSON(){const a=super.toJSON();a.points=[];for(let j=0,nt=this.points.length;j<nt;j++){const it=this.points[j];a.points.push(it.toArray())}return a}fromJSON(a){super.fromJSON(a),this.points=[];for(let j=0,nt=a.points.length;j<nt;j++){const it=a.points[j];this.points.push(new Br().fromArray(it))}return this}}var mT=Object.freeze({__proto__:null,ArcCurve:uT,CatmullRomCurve3:hT,CubicBezierCurve:dT,CubicBezierCurve3:H2,EllipseCurve:pE,LineCurve:vC,LineCurve3:Q2,QuadraticBezierCurve:pT,QuadraticBezierCurve3:fE,SplineCurve:fT});class gT extends jm{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(a){this.curves.push(a)}closePath(){const a=this.curves[0].getPoint(0),j=this.curves[this.curves.length-1].getPoint(1);a.equals(j)||this.curves.push(new vC(j,a))}getPoint(a,j){const nt=a*this.getLength(),it=this.getCurveLengths();let ot=0;for(;ot<it.length;){if(it[ot]>=nt){const ht=it[ot]-nt,ft=this.curves[ot],wt=ft.getLength(),bt=wt===0?0:1-ht/wt;return ft.getPointAt(bt,j)}ot++}return null}getLength(){const a=this.getCurveLengths();return a[a.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const a=[];let j=0;for(let nt=0,it=this.curves.length;nt<it;nt++)j+=this.curves[nt].getLength(),a.push(j);return this.cacheLengths=a,a}getSpacedPoints(a=40){const j=[];for(let nt=0;nt<=a;nt++)j.push(this.getPoint(nt/a));return this.autoClose&&j.push(j[0]),j}getPoints(a=12){const j=[];let nt;for(let it=0,ot=this.curves;it<ot.length;it++){const ht=ot[it],ft=ht.isEllipseCurve?2*a:ht.isLineCurve||ht.isLineCurve3?1:ht.isSplineCurve?a*ht.points.length:a,wt=ht.getPoints(ft);for(let bt=0;bt<wt.length;bt++){const St=wt[bt];nt&&nt.equals(St)||(j.push(St),nt=St)}}return this.autoClose&&j.length>1&&!j[j.length-1].equals(j[0])&&j.push(j[0]),j}copy(a){super.copy(a),this.curves=[];for(let j=0,nt=a.curves.length;j<nt;j++){const it=a.curves[j];this.curves.push(it.clone())}return this.autoClose=a.autoClose,this}toJSON(){const a=super.toJSON();a.autoClose=this.autoClose,a.curves=[];for(let j=0,nt=this.curves.length;j<nt;j++){const it=this.curves[j];a.curves.push(it.toJSON())}return a}fromJSON(a){super.fromJSON(a),this.autoClose=a.autoClose,this.curves=[];for(let j=0,nt=a.curves.length;j<nt;j++){const it=a.curves[j];this.curves.push(new mT[it.type]().fromJSON(it))}return this}}class Xy extends gT{constructor(a){super(),this.type="Path",this.currentPoint=new Br,a&&this.setFromPoints(a)}setFromPoints(a){this.moveTo(a[0].x,a[0].y);for(let j=1,nt=a.length;j<nt;j++)this.lineTo(a[j].x,a[j].y);return this}moveTo(a,j){return this.currentPoint.set(a,j),this}lineTo(a,j){const nt=new vC(this.currentPoint.clone(),new Br(a,j));return this.curves.push(nt),this.currentPoint.set(a,j),this}quadraticCurveTo(a,j,nt,it){const ot=new pT(this.currentPoint.clone(),new Br(a,j),new Br(nt,it));return this.curves.push(ot),this.currentPoint.set(nt,it),this}bezierCurveTo(a,j,nt,it,ot,ht){const ft=new dT(this.currentPoint.clone(),new Br(a,j),new Br(nt,it),new Br(ot,ht));return this.curves.push(ft),this.currentPoint.set(ot,ht),this}splineThru(a){const j=[this.currentPoint.clone()].concat(a),nt=new fT(j);return this.curves.push(nt),this.currentPoint.copy(a[a.length-1]),this}arc(a,j,nt,it,ot,ht){const ft=this.currentPoint.x,wt=this.currentPoint.y;return this.absarc(a+ft,j+wt,nt,it,ot,ht),this}absarc(a,j,nt,it,ot,ht){return this.absellipse(a,j,nt,nt,it,ot,ht),this}ellipse(a,j,nt,it,ot,ht,ft,wt){const bt=this.currentPoint.x,St=this.currentPoint.y;return this.absellipse(a+bt,j+St,nt,it,ot,ht,ft,wt),this}absellipse(a,j,nt,it,ot,ht,ft,wt){const bt=new pE(a,j,nt,it,ot,ht,ft,wt);if(this.curves.length>0){const Dt=bt.getPoint(0);Dt.equals(this.currentPoint)||this.lineTo(Dt.x,Dt.y)}this.curves.push(bt);const St=bt.getPoint(1);return this.currentPoint.copy(St),this}copy(a){return super.copy(a),this.currentPoint.copy(a.currentPoint),this}toJSON(){const a=super.toJSON();return a.currentPoint=this.currentPoint.toArray(),a}fromJSON(a){return super.fromJSON(a),this.currentPoint.fromArray(a.currentPoint),this}}class fw extends Vt{constructor(a=[new Br(0,-.5),new Br(.5,0),new Br(0,.5)],j=12,nt=0,it=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:a,segments:j,phiStart:nt,phiLength:it},j=Math.floor(j),it=Is(it,0,2*Math.PI);const ot=[],ht=[],ft=[],wt=[],bt=[],St=1/j,Dt=new Rn,Rt=new Br,kt=new Rn,Ot=new Rn,Gt=new Rn;let Nt=0,zt=0;for(let qt=0;qt<=a.length-1;qt++)switch(qt){case 0:Nt=a[qt+1].x-a[qt].x,zt=a[qt+1].y-a[qt].y,kt.x=1*zt,kt.y=-Nt,kt.z=0*zt,Gt.copy(kt),kt.normalize(),wt.push(kt.x,kt.y,kt.z);break;case a.length-1:wt.push(Gt.x,Gt.y,Gt.z);break;default:Nt=a[qt+1].x-a[qt].x,zt=a[qt+1].y-a[qt].y,kt.x=1*zt,kt.y=-Nt,kt.z=0*zt,Ot.copy(kt),kt.x+=Gt.x,kt.y+=Gt.y,kt.z+=Gt.z,kt.normalize(),wt.push(kt.x,kt.y,kt.z),Gt.copy(Ot)}for(let qt=0;qt<=j;qt++){const $t=nt+qt*St*it,En=Math.sin($t),gn=Math.cos($t);for(let vn=0;vn<=a.length-1;vn++){Dt.x=a[vn].x*En,Dt.y=a[vn].y,Dt.z=a[vn].x*gn,ht.push(Dt.x,Dt.y,Dt.z),Rt.x=qt/j,Rt.y=vn/(a.length-1),ft.push(Rt.x,Rt.y);const Un=wt[3*vn+0]*En,$n=wt[3*vn+1],jn=wt[3*vn+0]*gn;bt.push(Un,$n,jn)}}for(let qt=0;qt<j;qt++)for(let $t=0;$t<a.length-1;$t++){const En=$t+qt*a.length,gn=En,vn=En+a.length,Un=En+a.length+1,$n=En+1;ot.push(gn,vn,$n),ot.push(Un,$n,vn)}this.setIndex(ot),this.setAttribute("position",new fs(ht,3)),this.setAttribute("uv",new fs(ft,2)),this.setAttribute("normal",new fs(bt,3))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new fw(a.points,a.segments,a.phiStart,a.phiLength)}}class mw extends fw{constructor(a=1,j=1,nt=4,it=8){const ot=new Xy;ot.absarc(0,-j/2,a,1.5*Math.PI,0),ot.absarc(0,j/2,a,0,.5*Math.PI),super(ot.getPoints(nt),it),this.type="CapsuleGeometry",this.parameters={radius:a,height:j,capSegments:nt,radialSegments:it}}static fromJSON(a){return new mw(a.radius,a.length,a.capSegments,a.radialSegments)}}class G0 extends Vt{constructor(a=1,j=32,nt=0,it=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:a,segments:j,thetaStart:nt,thetaLength:it},j=Math.max(3,j);const ot=[],ht=[],ft=[],wt=[],bt=new Rn,St=new Br;ht.push(0,0,0),ft.push(0,0,1),wt.push(.5,.5);for(let Dt=0,Rt=3;Dt<=j;Dt++,Rt+=3){const kt=nt+Dt/j*it;bt.x=a*Math.cos(kt),bt.y=a*Math.sin(kt),ht.push(bt.x,bt.y,bt.z),ft.push(0,0,1),St.x=(ht[Rt]/a+1)/2,St.y=(ht[Rt+1]/a+1)/2,wt.push(St.x,St.y)}for(let Dt=1;Dt<=j;Dt++)ot.push(Dt,Dt+1,0);this.setIndex(ot),this.setAttribute("position",new fs(ht,3)),this.setAttribute("normal",new fs(ft,3)),this.setAttribute("uv",new fs(wt,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new G0(a.radius,a.segments,a.thetaStart,a.thetaLength)}}class Yy extends Vt{constructor(a=1,j=1,nt=1,it=32,ot=1,ht=!1,ft=0,wt=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:a,radiusBottom:j,height:nt,radialSegments:it,heightSegments:ot,openEnded:ht,thetaStart:ft,thetaLength:wt};const bt=this;it=Math.floor(it),ot=Math.floor(ot);const St=[],Dt=[],Rt=[],kt=[];let Ot=0;const Gt=[],Nt=nt/2;let zt=0;function qt($t){const En=Ot,gn=new Br,vn=new Rn;let Un=0;const $n=$t===!0?a:j,jn=$t===!0?1:-1;for(let Vn=1;Vn<=it;Vn++)Dt.push(0,Nt*jn,0),Rt.push(0,jn,0),kt.push(.5,.5),Ot++;const sr=Ot;for(let Vn=0;Vn<=it;Vn++){const _r=Vn/it*wt+ft,xr=Math.cos(_r),Gr=Math.sin(_r);vn.x=$n*Gr,vn.y=Nt*jn,vn.z=$n*xr,Dt.push(vn.x,vn.y,vn.z),Rt.push(0,jn,0),gn.x=.5*xr+.5,gn.y=.5*Gr*jn+.5,kt.push(gn.x,gn.y),Ot++}for(let Vn=0;Vn<it;Vn++){const _r=En+Vn,xr=sr+Vn;$t===!0?St.push(xr,xr+1,_r):St.push(xr+1,xr,_r),Un+=3}bt.addGroup(zt,Un,$t===!0?1:2),zt+=Un}(function(){const $t=new Rn,En=new Rn;let gn=0;const vn=(j-a)/nt;for(let Un=0;Un<=ot;Un++){const $n=[],jn=Un/ot,sr=jn*(j-a)+a;for(let Vn=0;Vn<=it;Vn++){const _r=Vn/it,xr=_r*wt+ft,Gr=Math.sin(xr),ns=Math.cos(xr);En.x=sr*Gr,En.y=-jn*nt+Nt,En.z=sr*ns,Dt.push(En.x,En.y,En.z),$t.set(Gr,vn,ns).normalize(),Rt.push($t.x,$t.y,$t.z),kt.push(_r,1-jn),$n.push(Ot++)}Gt.push($n)}for(let Un=0;Un<it;Un++)for(let $n=0;$n<ot;$n++){const jn=Gt[$n][Un],sr=Gt[$n+1][Un],Vn=Gt[$n+1][Un+1],_r=Gt[$n][Un+1];St.push(jn,sr,_r),St.push(sr,Vn,_r),gn+=6}bt.addGroup(zt,gn,0),zt+=gn})(),ht===!1&&(a>0&&qt(!0),j>0&&qt(!1)),this.setIndex(St),this.setAttribute("position",new fs(Dt,3)),this.setAttribute("normal",new fs(Rt,3)),this.setAttribute("uv",new fs(kt,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Yy(a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength)}}class H0 extends Yy{constructor(a=1,j=1,nt=32,it=1,ot=!1,ht=0,ft=2*Math.PI){super(0,a,j,nt,it,ot,ht,ft),this.type="ConeGeometry",this.parameters={radius:a,height:j,radialSegments:nt,heightSegments:it,openEnded:ot,thetaStart:ht,thetaLength:ft}}static fromJSON(a){return new H0(a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength)}}class Fv extends Vt{constructor(a=[],j=[],nt=1,it=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:a,indices:j,radius:nt,detail:it};const ot=[],ht=[];function ft(Rt,kt,Ot,Gt){const Nt=Gt+1,zt=[];for(let qt=0;qt<=Nt;qt++){zt[qt]=[];const $t=Rt.clone().lerp(Ot,qt/Nt),En=kt.clone().lerp(Ot,qt/Nt),gn=Nt-qt;for(let vn=0;vn<=gn;vn++)zt[qt][vn]=vn===0&&qt===Nt?$t:$t.clone().lerp(En,vn/gn)}for(let qt=0;qt<Nt;qt++)for(let $t=0;$t<2*(Nt-qt)-1;$t++){const En=Math.floor($t/2);$t%2==0?(wt(zt[qt][En+1]),wt(zt[qt+1][En]),wt(zt[qt][En])):(wt(zt[qt][En+1]),wt(zt[qt+1][En+1]),wt(zt[qt+1][En]))}}function wt(Rt){ot.push(Rt.x,Rt.y,Rt.z)}function bt(Rt,kt){const Ot=3*Rt;kt.x=a[Ot+0],kt.y=a[Ot+1],kt.z=a[Ot+2]}function St(Rt,kt,Ot,Gt){Gt<0&&Rt.x===1&&(ht[kt]=Rt.x-1),Ot.x===0&&Ot.z===0&&(ht[kt]=Gt/2/Math.PI+.5)}function Dt(Rt){return Math.atan2(Rt.z,-Rt.x)}(function(Rt){const kt=new Rn,Ot=new Rn,Gt=new Rn;for(let Nt=0;Nt<j.length;Nt+=3)bt(j[Nt+0],kt),bt(j[Nt+1],Ot),bt(j[Nt+2],Gt),ft(kt,Ot,Gt,Rt)})(it),function(Rt){const kt=new Rn;for(let Ot=0;Ot<ot.length;Ot+=3)kt.x=ot[Ot+0],kt.y=ot[Ot+1],kt.z=ot[Ot+2],kt.normalize().multiplyScalar(Rt),ot[Ot+0]=kt.x,ot[Ot+1]=kt.y,ot[Ot+2]=kt.z}(nt),function(){const Rt=new Rn;for(let Ot=0;Ot<ot.length;Ot+=3){Rt.x=ot[Ot+0],Rt.y=ot[Ot+1],Rt.z=ot[Ot+2];const Gt=Dt(Rt)/2/Math.PI+.5,Nt=(kt=Rt,Math.atan2(-kt.y,Math.sqrt(kt.x*kt.x+kt.z*kt.z))/Math.PI+.5);ht.push(Gt,1-Nt)}var kt;(function(){const Ot=new Rn,Gt=new Rn,Nt=new Rn,zt=new Rn,qt=new Br,$t=new Br,En=new Br;for(let gn=0,vn=0;gn<ot.length;gn+=9,vn+=6){Ot.set(ot[gn+0],ot[gn+1],ot[gn+2]),Gt.set(ot[gn+3],ot[gn+4],ot[gn+5]),Nt.set(ot[gn+6],ot[gn+7],ot[gn+8]),qt.set(ht[vn+0],ht[vn+1]),$t.set(ht[vn+2],ht[vn+3]),En.set(ht[vn+4],ht[vn+5]),zt.copy(Ot).add(Gt).add(Nt).divideScalar(3);const Un=Dt(zt);St(qt,vn+0,Ot,Un),St($t,vn+2,Gt,Un),St(En,vn+4,Nt,Un)}})(),function(){for(let Ot=0;Ot<ht.length;Ot+=6){const Gt=ht[Ot+0],Nt=ht[Ot+2],zt=ht[Ot+4],qt=Math.max(Gt,Nt,zt),$t=Math.min(Gt,Nt,zt);qt>.9&&$t<.1&&(Gt<.2&&(ht[Ot+0]+=1),Nt<.2&&(ht[Ot+2]+=1),zt<.2&&(ht[Ot+4]+=1))}}()}(),this.setAttribute("position",new fs(ot,3)),this.setAttribute("normal",new fs(ot.slice(),3)),this.setAttribute("uv",new fs(ht,2)),it===0?this.computeVertexNormals():this.normalizeNormals()}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Fv(a.vertices,a.indices,a.radius,a.details)}}class gw extends Fv{constructor(a=1,j=0){const nt=(1+Math.sqrt(5))/2,it=1/nt;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-it,-nt,0,-it,nt,0,it,-nt,0,it,nt,-it,-nt,0,-it,nt,0,it,-nt,0,it,nt,0,-nt,0,-it,nt,0,-it,-nt,0,it,nt,0,it],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,j),this.type="DodecahedronGeometry",this.parameters={radius:a,detail:j}}static fromJSON(a){return new gw(a.radius,a.detail)}}const _C=new Rn,Ky=new Rn,jx=new Rn,mE=new ru;class yC extends Vt{constructor(a=null,j=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:a,thresholdAngle:j},a!==null){const it=Math.pow(10,4),ot=Math.cos(a_*j),ht=a.getIndex(),ft=a.getAttribute("position"),wt=ht?ht.count:ft.count,bt=[0,0,0],St=["a","b","c"],Dt=new Array(3),Rt={},kt=[];for(let Ot=0;Ot<wt;Ot+=3){ht?(bt[0]=ht.getX(Ot),bt[1]=ht.getX(Ot+1),bt[2]=ht.getX(Ot+2)):(bt[0]=Ot,bt[1]=Ot+1,bt[2]=Ot+2);const{a:Gt,b:Nt,c:zt}=mE;if(Gt.fromBufferAttribute(ft,bt[0]),Nt.fromBufferAttribute(ft,bt[1]),zt.fromBufferAttribute(ft,bt[2]),mE.getNormal(jx),Dt[0]=`${Math.round(Gt.x*it)},${Math.round(Gt.y*it)},${Math.round(Gt.z*it)}`,Dt[1]=`${Math.round(Nt.x*it)},${Math.round(Nt.y*it)},${Math.round(Nt.z*it)}`,Dt[2]=`${Math.round(zt.x*it)},${Math.round(zt.y*it)},${Math.round(zt.z*it)}`,Dt[0]!==Dt[1]&&Dt[1]!==Dt[2]&&Dt[2]!==Dt[0])for(let qt=0;qt<3;qt++){const $t=(qt+1)%3,En=Dt[qt],gn=Dt[$t],vn=mE[St[qt]],Un=mE[St[$t]],$n=`${En}_${gn}`,jn=`${gn}_${En}`;jn in Rt&&Rt[jn]?(jx.dot(Rt[jn].normal)<=ot&&(kt.push(vn.x,vn.y,vn.z),kt.push(Un.x,Un.y,Un.z)),Rt[jn]=null):$n in Rt||(Rt[$n]={index0:bt[qt],index1:bt[$t],normal:jx.clone()})}}for(const Ot in Rt)if(Rt[Ot]){const{index0:Gt,index1:Nt}=Rt[Ot];_C.fromBufferAttribute(ft,Gt),Ky.fromBufferAttribute(ft,Nt),kt.push(_C.x,_C.y,_C.z),kt.push(Ky.x,Ky.y,Ky.z)}this.setAttribute("position",new fs(kt,3))}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}}class Jy extends Xy{constructor(a){super(a),this.uuid=Fp(),this.type="Shape",this.holes=[]}getPointsHoles(a){const j=[];for(let nt=0,it=this.holes.length;nt<it;nt++)j[nt]=this.holes[nt].getPoints(a);return j}extractPoints(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}}copy(a){super.copy(a),this.holes=[];for(let j=0,nt=a.holes.length;j<nt;j++){const it=a.holes[j];this.holes.push(it.clone())}return this}toJSON(){const a=super.toJSON();a.uuid=this.uuid,a.holes=[];for(let j=0,nt=this.holes.length;j<nt;j++){const it=this.holes[j];a.holes.push(it.toJSON())}return a}fromJSON(a){super.fromJSON(a),this.uuid=a.uuid,this.holes=[];for(let j=0,nt=a.holes.length;j<nt;j++){const it=a.holes[j];this.holes.push(new Xy().fromJSON(it))}return this}}function W2(ut,a,j,nt,it){let ot,ht;if(it===function(ft,wt,bt,St){let Dt=0;for(let Rt=wt,kt=bt-St;Rt<bt;Rt+=St)Dt+=(ft[kt]-ft[Rt])*(ft[Rt+1]+ft[kt+1]),kt=Rt;return Dt}(ut,a,j,nt)>0)for(ot=a;ot<j;ot+=nt)ht=Y2(ot,ut[ot],ut[ot+1],ht);else for(ot=j-nt;ot>=a;ot-=nt)ht=Y2(ot,ut[ot],ut[ot+1],ht);return ht&&_E(ht,ht.next)&&(_w(ht),ht=ht.next),ht}function Q0(ut,a){if(!ut)return ut;a||(a=ut);let j,nt=ut;do if(j=!1,nt.steiner||!_E(nt,nt.next)&&Xl(nt.prev,nt,nt.next)!==0)nt=nt.next;else{if(_w(nt),nt=a=nt.prev,nt===nt.next)break;j=!0}while(j||nt!==a);return a}function Z_(ut,a,j,nt,it,ot,ht){if(!ut)return;!ht&&ot&&function(St,Dt,Rt,kt){let Ot=St;do Ot.z===0&&(Ot.z=vE(Ot.x,Ot.y,Dt,Rt,kt)),Ot.prevZ=Ot.prev,Ot.nextZ=Ot.next,Ot=Ot.next;while(Ot!==St);Ot.prevZ.nextZ=null,Ot.prevZ=null,function(Gt){let Nt,zt,qt,$t,En,gn,vn,Un,$n=1;do{for(zt=Gt,Gt=null,En=null,gn=0;zt;){for(gn++,qt=zt,vn=0,Nt=0;Nt<$n&&(vn++,qt=qt.nextZ,qt);Nt++);for(Un=$n;vn>0||Un>0&&qt;)vn!==0&&(Un===0||!qt||zt.z<=qt.z)?($t=zt,zt=zt.nextZ,vn--):($t=qt,qt=qt.nextZ,Un--),En?En.nextZ=$t:Gt=$t,$t.prevZ=En,En=$t;zt=qt}En.nextZ=null,$n*=2}while(gn>1)}(Ot)}(ut,nt,it,ot);let ft,wt,bt=ut;for(;ut.prev!==ut.next;)if(ft=ut.prev,wt=ut.next,ot?hB(ut,nt,it,ot):vT(ut))a.push(ft.i/j|0),a.push(ut.i/j|0),a.push(wt.i/j|0),_w(ut),ut=wt.next,bt=wt.next;else if((ut=wt)===bt){ht?ht===1?Z_(ut=gE(Q0(ut),a,j),a,j,nt,it,ot,2):ht===2&&zx(ut,a,j,nt,it,ot):Z_(Q0(ut),a,j,nt,it,ot,1);break}}function vT(ut){const a=ut.prev,j=ut,nt=ut.next;if(Xl(a,j,nt)>=0)return!1;const it=a.x,ot=j.x,ht=nt.x,ft=a.y,wt=j.y,bt=nt.y,St=it<ot?it<ht?it:ht:ot<ht?ot:ht,Dt=ft<wt?ft<bt?ft:bt:wt<bt?wt:bt,Rt=it>ot?it>ht?it:ht:ot>ht?ot:ht,kt=ft>wt?ft>bt?ft:bt:wt>bt?wt:bt;let Ot=nt.next;for(;Ot!==a;){if(Ot.x>=St&&Ot.x<=Rt&&Ot.y>=Dt&&Ot.y<=kt&&vw(it,ft,ot,wt,ht,bt,Ot.x,Ot.y)&&Xl(Ot.prev,Ot,Ot.next)>=0)return!1;Ot=Ot.next}return!0}function hB(ut,a,j,nt){const it=ut.prev,ot=ut,ht=ut.next;if(Xl(it,ot,ht)>=0)return!1;const ft=it.x,wt=ot.x,bt=ht.x,St=it.y,Dt=ot.y,Rt=ht.y,kt=ft<wt?ft<bt?ft:bt:wt<bt?wt:bt,Ot=St<Dt?St<Rt?St:Rt:Dt<Rt?Dt:Rt,Gt=ft>wt?ft>bt?ft:bt:wt>bt?wt:bt,Nt=St>Dt?St>Rt?St:Rt:Dt>Rt?Dt:Rt,zt=vE(kt,Ot,a,j,nt),qt=vE(Gt,Nt,a,j,nt);let $t=ut.prevZ,En=ut.nextZ;for(;$t&&$t.z>=zt&&En&&En.z<=qt;){if($t.x>=kt&&$t.x<=Gt&&$t.y>=Ot&&$t.y<=Nt&&$t!==it&&$t!==ht&&vw(ft,St,wt,Dt,bt,Rt,$t.x,$t.y)&&Xl($t.prev,$t,$t.next)>=0||($t=$t.prevZ,En.x>=kt&&En.x<=Gt&&En.y>=Ot&&En.y<=Nt&&En!==it&&En!==ht&&vw(ft,St,wt,Dt,bt,Rt,En.x,En.y)&&Xl(En.prev,En,En.next)>=0))return!1;En=En.nextZ}for(;$t&&$t.z>=zt;){if($t.x>=kt&&$t.x<=Gt&&$t.y>=Ot&&$t.y<=Nt&&$t!==it&&$t!==ht&&vw(ft,St,wt,Dt,bt,Rt,$t.x,$t.y)&&Xl($t.prev,$t,$t.next)>=0)return!1;$t=$t.prevZ}for(;En&&En.z<=qt;){if(En.x>=kt&&En.x<=Gt&&En.y>=Ot&&En.y<=Nt&&En!==it&&En!==ht&&vw(ft,St,wt,Dt,bt,Rt,En.x,En.y)&&Xl(En.prev,En,En.next)>=0)return!1;En=En.nextZ}return!0}function gE(ut,a,j){let nt=ut;do{const it=nt.prev,ot=nt.next.next;!_E(it,ot)&&_T(it,nt,nt.next,ot)&&AE(it,ot)&&AE(ot,it)&&(a.push(it.i/j|0),a.push(nt.i/j|0),a.push(ot.i/j|0),_w(nt),_w(nt.next),nt=ut=ot),nt=nt.next}while(nt!==ut);return Q0(nt)}function zx(ut,a,j,nt,it,ot){let ht=ut;do{let ft=ht.next.next;for(;ft!==ht.prev;){if(ht.i!==ft.i&&X2(ht,ft)){let wt=wC(ht,ft);return ht=Q0(ht,ht.next),wt=Q0(wt,wt.next),Z_(ht,a,j,nt,it,ot,0),void Z_(wt,a,j,nt,it,ot,0)}ft=ft.next}ht=ht.next}while(ht!==ut)}function dB(ut,a){return ut.x-a.x}function pB(ut,a){const j=function(it,ot){let ht,ft=ot,wt=-1/0;const bt=it.x,St=it.y;do{if(St<=ft.y&&St>=ft.next.y&&ft.next.y!==ft.y){const Nt=ft.x+(St-ft.y)*(ft.next.x-ft.x)/(ft.next.y-ft.y);if(Nt<=bt&&Nt>wt&&(wt=Nt,ht=ft.x<ft.next.x?ft:ft.next,Nt===bt))return ht}ft=ft.next}while(ft!==ot);if(!ht)return null;const Dt=ht,Rt=ht.x,kt=ht.y;let Ot,Gt=1/0;ft=ht;do bt>=ft.x&&ft.x>=Rt&&bt!==ft.x&&vw(St<kt?bt:wt,St,Rt,kt,St<kt?wt:bt,St,ft.x,ft.y)&&(Ot=Math.abs(St-ft.y)/(bt-ft.x),AE(ft,it)&&(Ot<Gt||Ot===Gt&&(ft.x>ht.x||ft.x===ht.x&&q2(ht,ft)))&&(ht=ft,Gt=Ot)),ft=ft.next;while(ft!==Dt);return ht}(ut,a);if(!j)return a;const nt=wC(j,ut);return Q0(nt,nt.next),Q0(j,j.next)}function q2(ut,a){return Xl(ut.prev,ut,a.prev)<0&&Xl(a.next,ut,ut.next)<0}function vE(ut,a,j,nt,it){return(ut=1431655765&((ut=858993459&((ut=252645135&((ut=16711935&((ut=(ut-j)*it|0)|ut<<8))|ut<<4))|ut<<2))|ut<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-nt)*it|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function AC(ut){let a=ut,j=ut;do(a.x<j.x||a.x===j.x&&a.y<j.y)&&(j=a),a=a.next;while(a!==ut);return j}function vw(ut,a,j,nt,it,ot,ht,ft){return(it-ht)*(a-ft)>=(ut-ht)*(ot-ft)&&(ut-ht)*(nt-ft)>=(j-ht)*(a-ft)&&(j-ht)*(ot-ft)>=(it-ht)*(nt-ft)}function X2(ut,a){return ut.next.i!==a.i&&ut.prev.i!==a.i&&!function(j,nt){let it=j;do{if(it.i!==j.i&&it.next.i!==j.i&&it.i!==nt.i&&it.next.i!==nt.i&&_T(it,it.next,j,nt))return!0;it=it.next}while(it!==j);return!1}(ut,a)&&(AE(ut,a)&&AE(a,ut)&&function(j,nt){let it=j,ot=!1;const ht=(j.x+nt.x)/2,ft=(j.y+nt.y)/2;do it.y>ft!=it.next.y>ft&&it.next.y!==it.y&&ht<(it.next.x-it.x)*(ft-it.y)/(it.next.y-it.y)+it.x&&(ot=!ot),it=it.next;while(it!==j);return ot}(ut,a)&&(Xl(ut.prev,ut,a.prev)||Xl(ut,a.prev,a))||_E(ut,a)&&Xl(ut.prev,ut,ut.next)>0&&Xl(a.prev,a,a.next)>0)}function Xl(ut,a,j){return(a.y-ut.y)*(j.x-a.x)-(a.x-ut.x)*(j.y-a.y)}function _E(ut,a){return ut.x===a.x&&ut.y===a.y}function _T(ut,a,j,nt){const it=yE(Xl(ut,a,j)),ot=yE(Xl(ut,a,nt)),ht=yE(Xl(j,nt,ut)),ft=yE(Xl(j,nt,a));return it!==ot&&ht!==ft||!(it!==0||!bC(ut,j,a))||!(ot!==0||!bC(ut,nt,a))||!(ht!==0||!bC(j,ut,nt))||!(ft!==0||!bC(j,a,nt))}function bC(ut,a,j){return a.x<=Math.max(ut.x,j.x)&&a.x>=Math.min(ut.x,j.x)&&a.y<=Math.max(ut.y,j.y)&&a.y>=Math.min(ut.y,j.y)}function yE(ut){return ut>0?1:ut<0?-1:0}function AE(ut,a){return Xl(ut.prev,ut,ut.next)<0?Xl(ut,a,ut.next)>=0&&Xl(ut,ut.prev,a)>=0:Xl(ut,a,ut.prev)<0||Xl(ut,ut.next,a)<0}function wC(ut,a){const j=new xC(ut.i,ut.x,ut.y),nt=new xC(a.i,a.x,a.y),it=ut.next,ot=a.prev;return ut.next=a,a.prev=ut,j.next=it,it.prev=j,nt.next=j,j.prev=nt,ot.next=nt,nt.prev=ot,nt}function Y2(ut,a,j,nt){const it=new xC(ut,a,j);return nt?(it.next=nt.next,it.prev=nt,nt.next.prev=it,nt.next=it):(it.prev=it,it.next=it),it}function _w(ut){ut.next.prev=ut.prev,ut.prev.next=ut.next,ut.prevZ&&(ut.prevZ.nextZ=ut.nextZ),ut.nextZ&&(ut.nextZ.prevZ=ut.prevZ)}function xC(ut,a,j){this.i=ut,this.x=a,this.y=j,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class __{static area(a){const j=a.length;let nt=0;for(let it=j-1,ot=0;ot<j;it=ot++)nt+=a[it].x*a[ot].y-a[ot].x*a[it].y;return .5*nt}static isClockWise(a){return __.area(a)<0}static triangulateShape(a,j){const nt=[],it=[],ot=[];K2(a),yT(nt,a);let ht=a.length;j.forEach(K2);for(let wt=0;wt<j.length;wt++)it.push(ht),ht+=j[wt].length,yT(nt,j[wt]);const ft=function(wt,bt,St=2){const Dt=bt&&bt.length,Rt=Dt?bt[0]*St:wt.length;let kt=W2(wt,0,Rt,St,!0);const Ot=[];if(!kt||kt.next===kt.prev)return Ot;let Gt,Nt,zt,qt,$t,En,gn;if(Dt&&(kt=function(vn,Un,$n,jn){const sr=[];let Vn,_r,xr,Gr,ns;for(Vn=0,_r=Un.length;Vn<_r;Vn++)xr=Un[Vn]*jn,Gr=Vn<_r-1?Un[Vn+1]*jn:vn.length,ns=W2(vn,xr,Gr,jn,!1),ns===ns.next&&(ns.steiner=!0),sr.push(AC(ns));for(sr.sort(dB),Vn=0;Vn<sr.length;Vn++)$n=pB(sr[Vn],$n);return $n}(wt,bt,kt,St)),wt.length>80*St){Gt=zt=wt[0],Nt=qt=wt[1];for(let vn=St;vn<Rt;vn+=St)$t=wt[vn],En=wt[vn+1],$t<Gt&&(Gt=$t),En<Nt&&(Nt=En),$t>zt&&(zt=$t),En>qt&&(qt=En);gn=Math.max(zt-Gt,qt-Nt),gn=gn!==0?32767/gn:0}return Z_(kt,Ot,St,Gt,Nt,gn,0),Ot}(nt,it);for(let wt=0;wt<ft.length;wt+=3)ot.push(ft.slice(wt,wt+3));return ot}}function K2(ut){const a=ut.length;a>2&&ut[a-1].equals(ut[0])&&ut.pop()}function yT(ut,a){for(let j=0;j<a.length;j++)ut.push(a[j].x),ut.push(a[j].y)}class yw extends Vt{constructor(a=new Jy([new Br(.5,.5),new Br(-.5,.5),new Br(-.5,-.5),new Br(.5,-.5)]),j={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:a,options:j},a=Array.isArray(a)?a:[a];const nt=this,it=[],ot=[];for(let ft=0,wt=a.length;ft<wt;ft++)ht(a[ft]);function ht(ft){const wt=[],bt=j.curveSegments!==void 0?j.curveSegments:12,St=j.steps!==void 0?j.steps:1,Dt=j.depth!==void 0?j.depth:1;let Rt=j.bevelEnabled===void 0||j.bevelEnabled,kt=j.bevelThickness!==void 0?j.bevelThickness:.2,Ot=j.bevelSize!==void 0?j.bevelSize:kt-.1,Gt=j.bevelOffset!==void 0?j.bevelOffset:0,Nt=j.bevelSegments!==void 0?j.bevelSegments:3;const zt=j.extrudePath,qt=j.UVGenerator!==void 0?j.UVGenerator:fB;let $t,En,gn,vn,Un,$n=!1;zt&&($t=zt.getSpacedPoints(St),$n=!0,Rt=!1,En=zt.computeFrenetFrames(St,!1),gn=new Rn,vn=new Rn,Un=new Rn),Rt||(Nt=0,kt=0,Ot=0,Gt=0);const jn=ft.extractPoints(bt);let sr=jn.shape;const Vn=jn.holes;if(!__.isClockWise(sr)){sr=sr.reverse();for(let Yn=0,On=Vn.length;Yn<On;Yn++){const Zn=Vn[Yn];__.isClockWise(Zn)&&(Vn[Yn]=Zn.reverse())}}const _r=__.triangulateShape(sr,Vn),xr=sr;for(let Yn=0,On=Vn.length;Yn<On;Yn++){const Zn=Vn[Yn];sr=sr.concat(Zn)}function Gr(Yn,On,Zn){return On||console.error("THREE.ExtrudeGeometry: vec does not exist"),Yn.clone().addScaledVector(On,Zn)}const ns=sr.length,Vr=_r.length;function Tr(Yn,On,Zn){let fn,Gn,qn;const Er=Yn.x-On.x,br=Yn.y-On.y,Rr=Zn.x-Yn.x,is=Zn.y-Yn.y,ms=Er*Er+br*br,Ps=Er*is-br*Rr;if(Math.abs(Ps)>Number.EPSILON){const ds=Math.sqrt(ms),Ys=Math.sqrt(Rr*Rr+is*is),qs=On.x-br/ds,Rs=On.y+Er/ds,Zo=((Zn.x-is/Ys-qs)*is-(Zn.y+Rr/Ys-Rs)*Rr)/(Er*is-br*Rr);fn=qs+Er*Zo-Yn.x,Gn=Rs+br*Zo-Yn.y;const Pp=fn*fn+Gn*Gn;if(Pp<=2)return new Br(fn,Gn);qn=Math.sqrt(Pp/2)}else{let ds=!1;Er>Number.EPSILON?Rr>Number.EPSILON&&(ds=!0):Er<-Number.EPSILON?Rr<-Number.EPSILON&&(ds=!0):Math.sign(br)===Math.sign(is)&&(ds=!0),ds?(fn=-br,Gn=Er,qn=Math.sqrt(ms)):(fn=Er,Gn=br,qn=Math.sqrt(ms/2))}return new Br(fn/qn,Gn/qn)}const Yr=[];for(let Yn=0,On=xr.length,Zn=On-1,fn=Yn+1;Yn<On;Yn++,Zn++,fn++)Zn===On&&(Zn=0),fn===On&&(fn=0),Yr[Yn]=Tr(xr[Yn],xr[Zn],xr[fn]);const ts=[];let mr,Dr=Yr.concat();for(let Yn=0,On=Vn.length;Yn<On;Yn++){const Zn=Vn[Yn];mr=[];for(let fn=0,Gn=Zn.length,qn=Gn-1,Er=fn+1;fn<Gn;fn++,qn++,Er++)qn===Gn&&(qn=0),Er===Gn&&(Er=0),mr[fn]=Tr(Zn[fn],Zn[qn],Zn[Er]);ts.push(mr),Dr=Dr.concat(mr)}for(let Yn=0;Yn<Nt;Yn++){const On=Yn/Nt,Zn=kt*Math.cos(On*Math.PI/2),fn=Ot*Math.sin(On*Math.PI/2)+Gt;for(let Gn=0,qn=xr.length;Gn<qn;Gn++){const Er=Gr(xr[Gn],Yr[Gn],fn);ss(Er.x,Er.y,-Zn)}for(let Gn=0,qn=Vn.length;Gn<qn;Gn++){const Er=Vn[Gn];mr=ts[Gn];for(let br=0,Rr=Er.length;br<Rr;br++){const is=Gr(Er[br],mr[br],fn);ss(is.x,is.y,-Zn)}}}const $r=Ot+Gt;for(let Yn=0;Yn<ns;Yn++){const On=Rt?Gr(sr[Yn],Dr[Yn],$r):sr[Yn];$n?(vn.copy(En.normals[0]).multiplyScalar(On.x),gn.copy(En.binormals[0]).multiplyScalar(On.y),Un.copy($t[0]).add(vn).add(gn),ss(Un.x,Un.y,Un.z)):ss(On.x,On.y,0)}for(let Yn=1;Yn<=St;Yn++)for(let On=0;On<ns;On++){const Zn=Rt?Gr(sr[On],Dr[On],$r):sr[On];$n?(vn.copy(En.normals[Yn]).multiplyScalar(Zn.x),gn.copy(En.binormals[Yn]).multiplyScalar(Zn.y),Un.copy($t[Yn]).add(vn).add(gn),ss(Un.x,Un.y,Un.z)):ss(Zn.x,Zn.y,Dt/St*Yn)}for(let Yn=Nt-1;Yn>=0;Yn--){const On=Yn/Nt,Zn=kt*Math.cos(On*Math.PI/2),fn=Ot*Math.sin(On*Math.PI/2)+Gt;for(let Gn=0,qn=xr.length;Gn<qn;Gn++){const Er=Gr(xr[Gn],Yr[Gn],fn);ss(Er.x,Er.y,Dt+Zn)}for(let Gn=0,qn=Vn.length;Gn<qn;Gn++){const Er=Vn[Gn];mr=ts[Gn];for(let br=0,Rr=Er.length;br<Rr;br++){const is=Gr(Er[br],mr[br],fn);$n?ss(is.x,is.y+$t[St-1].y,$t[St-1].x+Zn):ss(is.x,is.y,Dt+Zn)}}}function Ur(Yn,On){let Zn=Yn.length;for(;--Zn>=0;){const fn=Zn;let Gn=Zn-1;Gn<0&&(Gn=Yn.length-1);for(let qn=0,Er=St+2*Nt;qn<Er;qn++){const br=ns*qn,Rr=ns*(qn+1);Fn(On+fn+br,On+Gn+br,On+Gn+Rr,On+fn+Rr)}}}function ss(Yn,On,Zn){wt.push(Yn),wt.push(On),wt.push(Zn)}function Hs(Yn,On,Zn){Sn(Yn),Sn(On),Sn(Zn);const fn=it.length/3,Gn=qt.generateTopUV(nt,it,fn-3,fn-2,fn-1);lr(Gn[0]),lr(Gn[1]),lr(Gn[2])}function Fn(Yn,On,Zn,fn){Sn(Yn),Sn(On),Sn(fn),Sn(On),Sn(Zn),Sn(fn);const Gn=it.length/3,qn=qt.generateSideWallUV(nt,it,Gn-6,Gn-3,Gn-2,Gn-1);lr(qn[0]),lr(qn[1]),lr(qn[3]),lr(qn[1]),lr(qn[2]),lr(qn[3])}function Sn(Yn){it.push(wt[3*Yn+0]),it.push(wt[3*Yn+1]),it.push(wt[3*Yn+2])}function lr(Yn){ot.push(Yn.x),ot.push(Yn.y)}(function(){const Yn=it.length/3;if(Rt){let On=0,Zn=ns*On;for(let fn=0;fn<Vr;fn++){const Gn=_r[fn];Hs(Gn[2]+Zn,Gn[1]+Zn,Gn[0]+Zn)}On=St+2*Nt,Zn=ns*On;for(let fn=0;fn<Vr;fn++){const Gn=_r[fn];Hs(Gn[0]+Zn,Gn[1]+Zn,Gn[2]+Zn)}}else{for(let On=0;On<Vr;On++){const Zn=_r[On];Hs(Zn[2],Zn[1],Zn[0])}for(let On=0;On<Vr;On++){const Zn=_r[On];Hs(Zn[0]+ns*St,Zn[1]+ns*St,Zn[2]+ns*St)}}nt.addGroup(Yn,it.length/3-Yn,0)})(),function(){const Yn=it.length/3;let On=0;Ur(xr,On),On+=xr.length;for(let Zn=0,fn=Vn.length;Zn<fn;Zn++){const Gn=Vn[Zn];Ur(Gn,On),On+=Gn.length}nt.addGroup(Yn,it.length/3-Yn,1)}()}this.setAttribute("position",new fs(it,3)),this.setAttribute("uv",new fs(ot,2)),this.computeVertexNormals()}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON();return function(j,nt,it){if(it.shapes=[],Array.isArray(j))for(let ot=0,ht=j.length;ot<ht;ot++){const ft=j[ot];it.shapes.push(ft.uuid)}else it.shapes.push(j.uuid);return it.options=Object.assign({},nt),nt.extrudePath!==void 0&&(it.options.extrudePath=nt.extrudePath.toJSON()),it}(this.parameters.shapes,this.parameters.options,a)}static fromJSON(a,j){const nt=[];for(let ot=0,ht=a.shapes.length;ot<ht;ot++){const ft=j[a.shapes[ot]];nt.push(ft)}const it=a.options.extrudePath;return it!==void 0&&(a.options.extrudePath=new mT[it.type]().fromJSON(it)),new yw(nt,a.options)}}const fB={generateTopUV:function(ut,a,j,nt,it){const ot=a[3*j],ht=a[3*j+1],ft=a[3*nt],wt=a[3*nt+1],bt=a[3*it],St=a[3*it+1];return[new Br(ot,ht),new Br(ft,wt),new Br(bt,St)]},generateSideWallUV:function(ut,a,j,nt,it,ot){const ht=a[3*j],ft=a[3*j+1],wt=a[3*j+2],bt=a[3*nt],St=a[3*nt+1],Dt=a[3*nt+2],Rt=a[3*it],kt=a[3*it+1],Ot=a[3*it+2],Gt=a[3*ot],Nt=a[3*ot+1],zt=a[3*ot+2];return Math.abs(ft-St)<Math.abs(ht-bt)?[new Br(ht,1-wt),new Br(bt,1-Dt),new Br(Rt,1-Ot),new Br(Gt,1-zt)]:[new Br(ft,1-wt),new Br(St,1-Dt),new Br(kt,1-Ot),new Br(Nt,1-zt)]}};class Aw extends Fv{constructor(a=1,j=0){const nt=(1+Math.sqrt(5))/2;super([-1,nt,0,1,nt,0,-1,-nt,0,1,-nt,0,0,-1,nt,0,1,nt,0,-1,-nt,0,1,-nt,nt,0,-1,nt,0,1,-nt,0,-1,-nt,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,j),this.type="IcosahedronGeometry",this.parameters={radius:a,detail:j}}static fromJSON(a){return new Aw(a.radius,a.detail)}}class Vx extends Fv{constructor(a=1,j=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,j),this.type="OctahedronGeometry",this.parameters={radius:a,detail:j}}static fromJSON(a){return new Vx(a.radius,a.detail)}}class W0 extends Vt{constructor(a=.5,j=1,nt=32,it=1,ot=0,ht=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:a,outerRadius:j,thetaSegments:nt,phiSegments:it,thetaStart:ot,thetaLength:ht},nt=Math.max(3,nt);const ft=[],wt=[],bt=[],St=[];let Dt=a;const Rt=(j-a)/(it=Math.max(1,it)),kt=new Rn,Ot=new Br;for(let Gt=0;Gt<=it;Gt++){for(let Nt=0;Nt<=nt;Nt++){const zt=ot+Nt/nt*ht;kt.x=Dt*Math.cos(zt),kt.y=Dt*Math.sin(zt),wt.push(kt.x,kt.y,kt.z),bt.push(0,0,1),Ot.x=(kt.x/j+1)/2,Ot.y=(kt.y/j+1)/2,St.push(Ot.x,Ot.y)}Dt+=Rt}for(let Gt=0;Gt<it;Gt++){const Nt=Gt*(nt+1);for(let zt=0;zt<nt;zt++){const qt=zt+Nt,$t=qt,En=qt+nt+1,gn=qt+nt+2,vn=qt+1;ft.push($t,En,vn),ft.push(En,gn,vn)}}this.setIndex(ft),this.setAttribute("position",new fs(wt,3)),this.setAttribute("normal",new fs(bt,3)),this.setAttribute("uv",new fs(St,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new W0(a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength)}}class Gx extends Vt{constructor(a=new Jy([new Br(0,.5),new Br(-.5,-.5),new Br(.5,-.5)]),j=12){super(),this.type="ShapeGeometry",this.parameters={shapes:a,curveSegments:j};const nt=[],it=[],ot=[],ht=[];let ft=0,wt=0;if(Array.isArray(a)===!1)bt(a);else for(let St=0;St<a.length;St++)bt(a[St]),this.addGroup(ft,wt,St),ft+=wt,wt=0;function bt(St){const Dt=it.length/3,Rt=St.extractPoints(j);let kt=Rt.shape;const Ot=Rt.holes;__.isClockWise(kt)===!1&&(kt=kt.reverse());for(let Nt=0,zt=Ot.length;Nt<zt;Nt++){const qt=Ot[Nt];__.isClockWise(qt)===!0&&(Ot[Nt]=qt.reverse())}const Gt=__.triangulateShape(kt,Ot);for(let Nt=0,zt=Ot.length;Nt<zt;Nt++){const qt=Ot[Nt];kt=kt.concat(qt)}for(let Nt=0,zt=kt.length;Nt<zt;Nt++){const qt=kt[Nt];it.push(qt.x,qt.y,0),ot.push(0,0,1),ht.push(qt.x,qt.y)}for(let Nt=0,zt=Gt.length;Nt<zt;Nt++){const qt=Gt[Nt],$t=qt[0]+Dt,En=qt[1]+Dt,gn=qt[2]+Dt;nt.push($t,En,gn),wt+=3}}this.setIndex(nt),this.setAttribute("position",new fs(it,3)),this.setAttribute("normal",new fs(ot,3)),this.setAttribute("uv",new fs(ht,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON();return function(j,nt){if(nt.shapes=[],Array.isArray(j))for(let it=0,ot=j.length;it<ot;it++){const ht=j[it];nt.shapes.push(ht.uuid)}else nt.shapes.push(j.uuid);return nt}(this.parameters.shapes,a)}static fromJSON(a,j){const nt=[];for(let it=0,ot=a.shapes.length;it<ot;it++){const ht=j[a.shapes[it]];nt.push(ht)}return new Gx(nt,a.curveSegments)}}class bw extends Vt{constructor(a=1,j=32,nt=16,it=0,ot=2*Math.PI,ht=0,ft=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:a,widthSegments:j,heightSegments:nt,phiStart:it,phiLength:ot,thetaStart:ht,thetaLength:ft},j=Math.max(3,Math.floor(j)),nt=Math.max(2,Math.floor(nt));const wt=Math.min(ht+ft,Math.PI);let bt=0;const St=[],Dt=new Rn,Rt=new Rn,kt=[],Ot=[],Gt=[],Nt=[];for(let zt=0;zt<=nt;zt++){const qt=[],$t=zt/nt;let En=0;zt===0&&ht===0?En=.5/j:zt===nt&&wt===Math.PI&&(En=-.5/j);for(let gn=0;gn<=j;gn++){const vn=gn/j;Dt.x=-a*Math.cos(it+vn*ot)*Math.sin(ht+$t*ft),Dt.y=a*Math.cos(ht+$t*ft),Dt.z=a*Math.sin(it+vn*ot)*Math.sin(ht+$t*ft),Ot.push(Dt.x,Dt.y,Dt.z),Rt.copy(Dt).normalize(),Gt.push(Rt.x,Rt.y,Rt.z),Nt.push(vn+En,1-$t),qt.push(bt++)}St.push(qt)}for(let zt=0;zt<nt;zt++)for(let qt=0;qt<j;qt++){const $t=St[zt][qt+1],En=St[zt][qt],gn=St[zt+1][qt],vn=St[zt+1][qt+1];(zt!==0||ht>0)&&kt.push($t,En,vn),(zt!==nt-1||wt<Math.PI)&&kt.push(En,gn,vn)}this.setIndex(kt),this.setAttribute("position",new fs(Ot,3)),this.setAttribute("normal",new fs(Gt,3)),this.setAttribute("uv",new fs(Nt,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new bw(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength)}}class Hx extends Fv{constructor(a=1,j=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,j),this.type="TetrahedronGeometry",this.parameters={radius:a,detail:j}}static fromJSON(a){return new Hx(a.radius,a.detail)}}class bE extends Vt{constructor(a=1,j=.4,nt=12,it=48,ot=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:a,tube:j,radialSegments:nt,tubularSegments:it,arc:ot},nt=Math.floor(nt),it=Math.floor(it);const ht=[],ft=[],wt=[],bt=[],St=new Rn,Dt=new Rn,Rt=new Rn;for(let kt=0;kt<=nt;kt++)for(let Ot=0;Ot<=it;Ot++){const Gt=Ot/it*ot,Nt=kt/nt*Math.PI*2;Dt.x=(a+j*Math.cos(Nt))*Math.cos(Gt),Dt.y=(a+j*Math.cos(Nt))*Math.sin(Gt),Dt.z=j*Math.sin(Nt),ft.push(Dt.x,Dt.y,Dt.z),St.x=a*Math.cos(Gt),St.y=a*Math.sin(Gt),Rt.subVectors(Dt,St).normalize(),wt.push(Rt.x,Rt.y,Rt.z),bt.push(Ot/it),bt.push(kt/nt)}for(let kt=1;kt<=nt;kt++)for(let Ot=1;Ot<=it;Ot++){const Gt=(it+1)*kt+Ot-1,Nt=(it+1)*(kt-1)+Ot-1,zt=(it+1)*(kt-1)+Ot,qt=(it+1)*kt+Ot;ht.push(Gt,Nt,qt),ht.push(Nt,zt,qt)}this.setIndex(ht),this.setAttribute("position",new fs(ft,3)),this.setAttribute("normal",new fs(wt,3)),this.setAttribute("uv",new fs(bt,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new bE(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc)}}class Qx extends Vt{constructor(a=1,j=.4,nt=64,it=8,ot=2,ht=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:a,tube:j,tubularSegments:nt,radialSegments:it,p:ot,q:ht},nt=Math.floor(nt),it=Math.floor(it);const ft=[],wt=[],bt=[],St=[],Dt=new Rn,Rt=new Rn,kt=new Rn,Ot=new Rn,Gt=new Rn,Nt=new Rn,zt=new Rn;for(let $t=0;$t<=nt;++$t){const En=$t/nt*ot*Math.PI*2;qt(En,ot,ht,a,kt),qt(En+.01,ot,ht,a,Ot),Nt.subVectors(Ot,kt),zt.addVectors(Ot,kt),Gt.crossVectors(Nt,zt),zt.crossVectors(Gt,Nt),Gt.normalize(),zt.normalize();for(let gn=0;gn<=it;++gn){const vn=gn/it*Math.PI*2,Un=-j*Math.cos(vn),$n=j*Math.sin(vn);Dt.x=kt.x+(Un*zt.x+$n*Gt.x),Dt.y=kt.y+(Un*zt.y+$n*Gt.y),Dt.z=kt.z+(Un*zt.z+$n*Gt.z),wt.push(Dt.x,Dt.y,Dt.z),Rt.subVectors(Dt,kt).normalize(),bt.push(Rt.x,Rt.y,Rt.z),St.push($t/nt),St.push(gn/it)}}for(let $t=1;$t<=nt;$t++)for(let En=1;En<=it;En++){const gn=(it+1)*($t-1)+(En-1),vn=(it+1)*$t+(En-1),Un=(it+1)*$t+En,$n=(it+1)*($t-1)+En;ft.push(gn,vn,$n),ft.push(vn,Un,$n)}function qt($t,En,gn,vn,Un){const $n=Math.cos($t),jn=Math.sin($t),sr=gn/En*$t,Vn=Math.cos(sr);Un.x=vn*(2+Vn)*.5*$n,Un.y=vn*(2+Vn)*jn*.5,Un.z=vn*Math.sin(sr)*.5}this.setIndex(ft),this.setAttribute("position",new fs(wt,3)),this.setAttribute("normal",new fs(bt,3)),this.setAttribute("uv",new fs(St,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Qx(a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q)}}class ww extends Vt{constructor(a=new fE(new Rn(-1,-1,0),new Rn(-1,1,0),new Rn(1,1,0)),j=64,nt=1,it=8,ot=!1){super(),this.type="TubeGeometry",this.parameters={path:a,tubularSegments:j,radius:nt,radialSegments:it,closed:ot};const ht=a.computeFrenetFrames(j,ot);this.tangents=ht.tangents,this.normals=ht.normals,this.binormals=ht.binormals;const ft=new Rn,wt=new Rn,bt=new Br;let St=new Rn;const Dt=[],Rt=[],kt=[],Ot=[];function Gt(Nt){St=a.getPointAt(Nt/j,St);const zt=ht.normals[Nt],qt=ht.binormals[Nt];for(let $t=0;$t<=it;$t++){const En=$t/it*Math.PI*2,gn=Math.sin(En),vn=-Math.cos(En);wt.x=vn*zt.x+gn*qt.x,wt.y=vn*zt.y+gn*qt.y,wt.z=vn*zt.z+gn*qt.z,wt.normalize(),Rt.push(wt.x,wt.y,wt.z),ft.x=St.x+nt*wt.x,ft.y=St.y+nt*wt.y,ft.z=St.z+nt*wt.z,Dt.push(ft.x,ft.y,ft.z)}}(function(){for(let Nt=0;Nt<j;Nt++)Gt(Nt);Gt(ot===!1?j:0),function(){for(let Nt=0;Nt<=j;Nt++)for(let zt=0;zt<=it;zt++)bt.x=Nt/j,bt.y=zt/it,kt.push(bt.x,bt.y)}(),function(){for(let Nt=1;Nt<=j;Nt++)for(let zt=1;zt<=it;zt++){const qt=(it+1)*(Nt-1)+(zt-1),$t=(it+1)*Nt+(zt-1),En=(it+1)*Nt+zt,gn=(it+1)*(Nt-1)+zt;Ot.push(qt,$t,gn),Ot.push($t,En,gn)}}()})(),this.setIndex(Ot),this.setAttribute("position",new fs(Dt,3)),this.setAttribute("normal",new fs(Rt,3)),this.setAttribute("uv",new fs(kt,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON();return a.path=this.parameters.path.toJSON(),a}static fromJSON(a){return new ww(new mT[a.path.type]().fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed)}}class Wx extends Vt{constructor(a=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:a},a!==null){const j=[],nt=new Set,it=new Rn,ot=new Rn;if(a.index!==null){const ht=a.attributes.position,ft=a.index;let wt=a.groups;wt.length===0&&(wt=[{start:0,count:ft.count,materialIndex:0}]);for(let bt=0,St=wt.length;bt<St;++bt){const Dt=wt[bt],Rt=Dt.start;for(let kt=Rt,Ot=Rt+Dt.count;kt<Ot;kt+=3)for(let Gt=0;Gt<3;Gt++){const Nt=ft.getX(kt+Gt),zt=ft.getX(kt+(Gt+1)%3);it.fromBufferAttribute(ht,Nt),ot.fromBufferAttribute(ht,zt),EC(it,ot,nt)===!0&&(j.push(it.x,it.y,it.z),j.push(ot.x,ot.y,ot.z))}}}else{const ht=a.attributes.position;for(let ft=0,wt=ht.count/3;ft<wt;ft++)for(let bt=0;bt<3;bt++){const St=3*ft+bt,Dt=3*ft+(bt+1)%3;it.fromBufferAttribute(ht,St),ot.fromBufferAttribute(ht,Dt),EC(it,ot,nt)===!0&&(j.push(it.x,it.y,it.z),j.push(ot.x,ot.y,ot.z))}}this.setAttribute("position",new fs(j,3))}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}}function EC(ut,a,j){const nt=`${ut.x},${ut.y},${ut.z}-${a.x},${a.y},${a.z}`,it=`${a.x},${a.y},${a.z}-${ut.x},${ut.y},${ut.z}`;return j.has(nt)!==!0&&j.has(it)!==!0&&(j.add(nt),j.add(it),!0)}var qx=Object.freeze({__proto__:null,BoxGeometry:kv,CapsuleGeometry:mw,CircleGeometry:G0,ConeGeometry:H0,CylinderGeometry:Yy,DodecahedronGeometry:gw,EdgesGeometry:yC,ExtrudeGeometry:yw,IcosahedronGeometry:Aw,LatheGeometry:fw,OctahedronGeometry:Vx,PlaneGeometry:nv,PolyhedronGeometry:Fv,RingGeometry:W0,ShapeGeometry:Gx,SphereGeometry:bw,TetrahedronGeometry:Hx,TorusGeometry:bE,TorusKnotGeometry:Qx,TubeGeometry:ww,WireframeGeometry:Wx});class wE extends ku{constructor(a){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new us(0),this.transparent=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.fog=a.fog,this}}class SC extends p_{constructor(a){super(a),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class AT extends ku{constructor(a){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new us(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new us(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sm,this.normalScale=new Br(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.defines={STANDARD:""},this.color.copy(a.color),this.roughness=a.roughness,this.metalness=a.metalness,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.roughnessMap=a.roughnessMap,this.metalnessMap=a.metalnessMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapIntensity=a.envMapIntensity,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class J2 extends AT{constructor(a){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Br(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Is(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(j){this.ior=(1+.4*j)/(1-.4*j)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new us(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new us(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new us(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(a)}get sheen(){return this._sheen}set sheen(a){this._sheen>0!=a>0&&this.version++,this._sheen=a}get clearcoat(){return this._clearcoat}set clearcoat(a){this._clearcoat>0!=a>0&&this.version++,this._clearcoat=a}get iridescence(){return this._iridescence}set iridescence(a){this._iridescence>0!=a>0&&this.version++,this._iridescence=a}get transmission(){return this._transmission}set transmission(a){this._transmission>0!=a>0&&this.version++,this._transmission=a}copy(a){return super.copy(a),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=a.clearcoat,this.clearcoatMap=a.clearcoatMap,this.clearcoatRoughness=a.clearcoatRoughness,this.clearcoatRoughnessMap=a.clearcoatRoughnessMap,this.clearcoatNormalMap=a.clearcoatNormalMap,this.clearcoatNormalScale.copy(a.clearcoatNormalScale),this.ior=a.ior,this.iridescence=a.iridescence,this.iridescenceMap=a.iridescenceMap,this.iridescenceIOR=a.iridescenceIOR,this.iridescenceThicknessRange=[...a.iridescenceThicknessRange],this.iridescenceThicknessMap=a.iridescenceThicknessMap,this.sheen=a.sheen,this.sheenColor.copy(a.sheenColor),this.sheenColorMap=a.sheenColorMap,this.sheenRoughness=a.sheenRoughness,this.sheenRoughnessMap=a.sheenRoughnessMap,this.transmission=a.transmission,this.transmissionMap=a.transmissionMap,this.thickness=a.thickness,this.thicknessMap=a.thicknessMap,this.attenuationDistance=a.attenuationDistance,this.attenuationColor.copy(a.attenuationColor),this.specularIntensity=a.specularIntensity,this.specularIntensityMap=a.specularIntensityMap,this.specularColor.copy(a.specularColor),this.specularColorMap=a.specularColorMap,this}}class $2 extends ku{constructor(a){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new us(16777215),this.specular=new us(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new us(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sm,this.normalScale=new Br(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=fo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.specular.copy(a.specular),this.shininess=a.shininess,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class bT extends ku{constructor(a){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new us(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new us(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sm,this.normalScale=new Br(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.gradientMap=a.gradientMap,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}}class Z2 extends ku{constructor(a){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sm,this.normalScale=new Br(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(a)}copy(a){return super.copy(a),this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.flatShading=a.flatShading,this}}class wT extends ku{constructor(a){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new us(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new us(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sm,this.normalScale=new Br(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=fo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class eP extends ku{constructor(a){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new us(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sm,this.normalScale=new Br(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.defines={MATCAP:""},this.color.copy(a.color),this.matcap=a.matcap,this.map=a.map,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.flatShading=a.flatShading,this.fog=a.fog,this}}class xT extends lm{constructor(a){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(a)}copy(a){return super.copy(a),this.scale=a.scale,this.dashSize=a.dashSize,this.gapSize=a.gapSize,this}}function jv(ut,a,j){return $y(ut)?new ut.constructor(ut.subarray(a,j!==void 0?j:ut.length)):ut.slice(a,j)}function e0(ut,a,j){return!ut||!j&&ut.constructor===a?ut:typeof a.BYTES_PER_ELEMENT=="number"?new a(ut):Array.prototype.slice.call(ut)}function $y(ut){return ArrayBuffer.isView(ut)&&!(ut instanceof DataView)}function CC(ut){const a=ut.length,j=new Array(a);for(let nt=0;nt!==a;++nt)j[nt]=nt;return j.sort(function(nt,it){return ut[nt]-ut[it]}),j}function MC(ut,a,j){const nt=ut.length,it=new ut.constructor(nt);for(let ot=0,ht=0;ht!==nt;++ot){const ft=j[ot]*a;for(let wt=0;wt!==a;++wt)it[ht++]=ut[ft+wt]}return it}function xE(ut,a,j,nt){let it=1,ot=ut[0];for(;ot!==void 0&&ot[nt]===void 0;)ot=ut[it++];if(ot===void 0)return;let ht=ot[nt];if(ht!==void 0)if(Array.isArray(ht))do ht=ot[nt],ht!==void 0&&(a.push(ot.time),j.push.apply(j,ht)),ot=ut[it++];while(ot!==void 0);else if(ht.toArray!==void 0)do ht=ot[nt],ht!==void 0&&(a.push(ot.time),ht.toArray(j,j.length)),ot=ut[it++];while(ot!==void 0);else do ht=ot[nt],ht!==void 0&&(a.push(ot.time),j.push(ht)),ot=ut[it++];while(ot!==void 0)}const Xx={arraySlice:jv,convertArray:e0,isTypedArray:$y,getKeyframeOrder:CC,sortedArray:MC,flattenJSON:xE,subclip:function(ut,a,j,nt,it=30){const ot=ut.clone();ot.name=a;const ht=[];for(let wt=0;wt<ot.tracks.length;++wt){const bt=ot.tracks[wt],St=bt.getValueSize(),Dt=[],Rt=[];for(let kt=0;kt<bt.times.length;++kt){const Ot=bt.times[kt]*it;if(!(Ot<j||Ot>=nt)){Dt.push(bt.times[kt]);for(let Gt=0;Gt<St;++Gt)Rt.push(bt.values[kt*St+Gt])}}Dt.length!==0&&(bt.times=e0(Dt,bt.times.constructor),bt.values=e0(Rt,bt.values.constructor),ht.push(bt))}ot.tracks=ht;let ft=1/0;for(let wt=0;wt<ot.tracks.length;++wt)ft>ot.tracks[wt].times[0]&&(ft=ot.tracks[wt].times[0]);for(let wt=0;wt<ot.tracks.length;++wt)ot.tracks[wt].shift(-1*ft);return ot.resetDuration(),ot},makeClipAdditive:function(ut,a=0,j=ut,nt=30){nt<=0&&(nt=30);const it=j.tracks.length,ot=a/nt;for(let ht=0;ht<it;++ht){const ft=j.tracks[ht],wt=ft.ValueTypeName;if(wt==="bool"||wt==="string")continue;const bt=ut.tracks.find(function(zt){return zt.name===ft.name&&zt.ValueTypeName===wt});if(bt===void 0)continue;let St=0;const Dt=ft.getValueSize();ft.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(St=Dt/3);let Rt=0;const kt=bt.getValueSize();bt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(Rt=kt/3);const Ot=ft.times.length-1;let Gt;if(ot<=ft.times[0]){const zt=St,qt=Dt-St;Gt=jv(ft.values,zt,qt)}else if(ot>=ft.times[Ot]){const zt=Ot*Dt+St,qt=zt+Dt-St;Gt=jv(ft.values,zt,qt)}else{const zt=ft.createInterpolant(),qt=St,$t=Dt-St;zt.evaluate(ot),Gt=jv(zt.resultBuffer,qt,$t)}wt==="quaternion"&&new zp().fromArray(Gt).normalize().conjugate().toArray(Gt);const Nt=bt.times.length;for(let zt=0;zt<Nt;++zt){const qt=zt*kt+Rt;if(wt==="quaternion")zp.multiplyQuaternionsFlat(bt.values,qt,Gt,0,bt.values,qt);else{const $t=kt-2*Rt;for(let En=0;En<$t;++En)bt.values[qt+En]-=Gt[En]}}}return ut.blendMode=Lo,ut}};class El{constructor(a,j,nt,it){this.parameterPositions=a,this._cachedIndex=0,this.resultBuffer=it!==void 0?it:new j.constructor(nt),this.sampleValues=j,this.valueSize=nt,this.settings=null,this.DefaultSettings_={}}evaluate(a){const j=this.parameterPositions;let nt=this._cachedIndex,it=j[nt],ot=j[nt-1];e:{t:{let ht;n:{i:if(!(a<it)){for(let ft=nt+2;;){if(it===void 0){if(a<ot)break i;return nt=j.length,this._cachedIndex=nt,this.copySampleValue_(nt-1)}if(nt===ft)break;if(ot=it,it=j[++nt],a<it)break t}ht=j.length;break n}if(a>=ot)break e;{const ft=j[1];a<ft&&(nt=2,ot=ft);for(let wt=nt-2;;){if(ot===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(nt===wt)break;if(it=ot,ot=j[--nt-1],a>=ot)break t}ht=nt,nt=0}}for(;nt<ht;){const ft=nt+ht>>>1;a<j[ft]?ht=ft:nt=ft+1}if(it=j[nt],ot=j[nt-1],ot===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(it===void 0)return nt=j.length,this._cachedIndex=nt,this.copySampleValue_(nt-1)}this._cachedIndex=nt,this.intervalChanged_(nt,ot,it)}return this.interpolate_(nt,ot,a,it)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(a){const j=this.resultBuffer,nt=this.sampleValues,it=this.valueSize,ot=a*it;for(let ht=0;ht!==it;++ht)j[ht]=nt[ot+ht];return j}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class tP extends El{constructor(a,j,nt,it){super(a,j,nt,it),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:N_,endingEnd:N_}}intervalChanged_(a,j,nt){const it=this.parameterPositions;let ot=a-2,ht=a+1,ft=it[ot],wt=it[ht];if(ft===void 0)switch(this.getSettings_().endingStart){case o_:ot=a,ft=2*j-nt;break;case Ay:ot=it.length-2,ft=j+it[ot]-it[ot+1];break;default:ot=a,ft=nt}if(wt===void 0)switch(this.getSettings_().endingEnd){case o_:ht=a,wt=2*nt-j;break;case Ay:ht=1,wt=nt+it[1]-it[0];break;default:ht=a-1,wt=j}const bt=.5*(nt-j),St=this.valueSize;this._weightPrev=bt/(j-ft),this._weightNext=bt/(wt-nt),this._offsetPrev=ot*St,this._offsetNext=ht*St}interpolate_(a,j,nt,it){const ot=this.resultBuffer,ht=this.sampleValues,ft=this.valueSize,wt=a*ft,bt=wt-ft,St=this._offsetPrev,Dt=this._offsetNext,Rt=this._weightPrev,kt=this._weightNext,Ot=(nt-j)/(it-j),Gt=Ot*Ot,Nt=Gt*Ot,zt=-Rt*Nt+2*Rt*Gt-Rt*Ot,qt=(1+Rt)*Nt+(-1.5-2*Rt)*Gt+(-.5+Rt)*Ot+1,$t=(-1-kt)*Nt+(1.5+kt)*Gt+.5*Ot,En=kt*Nt-kt*Gt;for(let gn=0;gn!==ft;++gn)ot[gn]=zt*ht[St+gn]+qt*ht[bt+gn]+$t*ht[wt+gn]+En*ht[Dt+gn];return ot}}class dp extends El{constructor(a,j,nt,it){super(a,j,nt,it)}interpolate_(a,j,nt,it){const ot=this.resultBuffer,ht=this.sampleValues,ft=this.valueSize,wt=a*ft,bt=wt-ft,St=(nt-j)/(it-j),Dt=1-St;for(let Rt=0;Rt!==ft;++Rt)ot[Rt]=ht[bt+Rt]*Dt+ht[wt+Rt]*St;return ot}}class qo extends El{constructor(a,j,nt,it){super(a,j,nt,it)}interpolate_(a){return this.copySampleValue_(a-1)}}class cm{constructor(a,j,nt,it){if(a===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(j===void 0||j.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+a);this.name=a,this.times=e0(j,this.TimeBufferType),this.values=e0(nt,this.ValueBufferType),this.setInterpolation(it||this.DefaultInterpolation)}static toJSON(a){const j=a.constructor;let nt;if(j.toJSON!==this.toJSON)nt=j.toJSON(a);else{nt={name:a.name,times:e0(a.times,Array),values:e0(a.values,Array)};const it=a.getInterpolation();it!==a.DefaultInterpolation&&(nt.interpolation=it)}return nt.type=a.ValueTypeName,nt}InterpolantFactoryMethodDiscrete(a){return new qo(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodLinear(a){return new dp(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodSmooth(a){return new tP(this.times,this.values,this.getValueSize(),a)}setInterpolation(a){let j;switch(a){case Ms:j=this.InterpolantFactoryMethodDiscrete;break;case wv:j=this.InterpolantFactoryMethodLinear;break;case m0:j=this.InterpolantFactoryMethodSmooth}if(j===void 0){const nt="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(a===this.DefaultInterpolation)throw new Error(nt);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",nt),this}return this.createInterpolant=j,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ms;case this.InterpolantFactoryMethodLinear:return wv;case this.InterpolantFactoryMethodSmooth:return m0}}getValueSize(){return this.values.length/this.times.length}shift(a){if(a!==0){const j=this.times;for(let nt=0,it=j.length;nt!==it;++nt)j[nt]+=a}return this}scale(a){if(a!==1){const j=this.times;for(let nt=0,it=j.length;nt!==it;++nt)j[nt]*=a}return this}trim(a,j){const nt=this.times,it=nt.length;let ot=0,ht=it-1;for(;ot!==it&&nt[ot]<a;)++ot;for(;ht!==-1&&nt[ht]>j;)--ht;if(++ht,ot!==0||ht!==it){ot>=ht&&(ht=Math.max(ht,1),ot=ht-1);const ft=this.getValueSize();this.times=jv(nt,ot,ht),this.values=jv(this.values,ot*ft,ht*ft)}return this}validate(){let a=!0;const j=this.getValueSize();j-Math.floor(j)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),a=!1);const nt=this.times,it=this.values,ot=nt.length;ot===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),a=!1);let ht=null;for(let ft=0;ft!==ot;ft++){const wt=nt[ft];if(typeof wt=="number"&&isNaN(wt)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,ft,wt),a=!1;break}if(ht!==null&&ht>wt){console.error("THREE.KeyframeTrack: Out of order keys.",this,ft,wt,ht),a=!1;break}ht=wt}if(it!==void 0&&$y(it))for(let ft=0,wt=it.length;ft!==wt;++ft){const bt=it[ft];if(isNaN(bt)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,ft,bt),a=!1;break}}return a}optimize(){const a=jv(this.times),j=jv(this.values),nt=this.getValueSize(),it=this.getInterpolation()===m0,ot=a.length-1;let ht=1;for(let ft=1;ft<ot;++ft){let wt=!1;const bt=a[ft];if(bt!==a[ft+1]&&(ft!==1||bt!==a[0]))if(it)wt=!0;else{const St=ft*nt,Dt=St-nt,Rt=St+nt;for(let kt=0;kt!==nt;++kt){const Ot=j[St+kt];if(Ot!==j[Dt+kt]||Ot!==j[Rt+kt]){wt=!0;break}}}if(wt){if(ft!==ht){a[ht]=a[ft];const St=ft*nt,Dt=ht*nt;for(let Rt=0;Rt!==nt;++Rt)j[Dt+Rt]=j[St+Rt]}++ht}}if(ot>0){a[ht]=a[ot];for(let ft=ot*nt,wt=ht*nt,bt=0;bt!==nt;++bt)j[wt+bt]=j[ft+bt];++ht}return ht!==a.length?(this.times=jv(a,0,ht),this.values=jv(j,0,ht*nt)):(this.times=a,this.values=j),this}clone(){const a=jv(this.times,0),j=jv(this.values,0),nt=new this.constructor(this.name,a,j);return nt.createInterpolant=this.createInterpolant,nt}}cm.prototype.TimeBufferType=Float32Array,cm.prototype.ValueBufferType=Float32Array,cm.prototype.DefaultInterpolation=wv;class y_ extends cm{}y_.prototype.ValueTypeName="bool",y_.prototype.ValueBufferType=Array,y_.prototype.DefaultInterpolation=Ms,y_.prototype.InterpolantFactoryMethodLinear=void 0,y_.prototype.InterpolantFactoryMethodSmooth=void 0;class ET extends cm{}ET.prototype.ValueTypeName="color";class Yx extends cm{}Yx.prototype.ValueTypeName="number";class nP extends El{constructor(a,j,nt,it){super(a,j,nt,it)}interpolate_(a,j,nt,it){const ot=this.resultBuffer,ht=this.sampleValues,ft=this.valueSize,wt=(nt-j)/(it-j);let bt=a*ft;for(let St=bt+ft;bt!==St;bt+=4)zp.slerpFlat(ot,0,ht,bt-ft,ht,bt,wt);return ot}}class t0 extends cm{InterpolantFactoryMethodLinear(a){return new nP(this.times,this.values,this.getValueSize(),a)}}t0.prototype.ValueTypeName="quaternion",t0.prototype.DefaultInterpolation=wv,t0.prototype.InterpolantFactoryMethodSmooth=void 0;class n0 extends cm{}n0.prototype.ValueTypeName="string",n0.prototype.ValueBufferType=Array,n0.prototype.DefaultInterpolation=Ms,n0.prototype.InterpolantFactoryMethodLinear=void 0,n0.prototype.InterpolantFactoryMethodSmooth=void 0;class A_ extends cm{}A_.prototype.ValueTypeName="vector";class q0{constructor(a,j=-1,nt,it=lx){this.name=a,this.tracks=nt,this.duration=j,this.blendMode=it,this.uuid=Fp(),this.duration<0&&this.resetDuration()}static parse(a){const j=[],nt=a.tracks,it=1/(a.fps||1);for(let ht=0,ft=nt.length;ht!==ft;++ht)j.push(Zy(nt[ht]).scale(it));const ot=new this(a.name,a.duration,j,a.blendMode);return ot.uuid=a.uuid,ot}static toJSON(a){const j=[],nt=a.tracks,it={name:a.name,duration:a.duration,tracks:j,uuid:a.uuid,blendMode:a.blendMode};for(let ot=0,ht=nt.length;ot!==ht;++ot)j.push(cm.toJSON(nt[ot]));return it}static CreateFromMorphTargetSequence(a,j,nt,it){const ot=j.length,ht=[];for(let ft=0;ft<ot;ft++){let wt=[],bt=[];wt.push((ft+ot-1)%ot,ft,(ft+1)%ot),bt.push(0,1,0);const St=CC(wt);wt=MC(wt,1,St),bt=MC(bt,1,St),it||wt[0]!==0||(wt.push(ot),bt.push(bt[0])),ht.push(new Yx(".morphTargetInfluences["+j[ft].name+"]",wt,bt).scale(1/nt))}return new this(a,-1,ht)}static findByName(a,j){let nt=a;if(!Array.isArray(a)){const it=a;nt=it.geometry&&it.geometry.animations||it.animations}for(let it=0;it<nt.length;it++)if(nt[it].name===j)return nt[it];return null}static CreateClipsFromMorphTargetSequences(a,j,nt){const it={},ot=/^([\w-]*?)([\d]+)$/;for(let ft=0,wt=a.length;ft<wt;ft++){const bt=a[ft],St=bt.name.match(ot);if(St&&St.length>1){const Dt=St[1];let Rt=it[Dt];Rt||(it[Dt]=Rt=[]),Rt.push(bt)}}const ht=[];for(const ft in it)ht.push(this.CreateFromMorphTargetSequence(ft,it[ft],j,nt));return ht}static parseAnimation(a,j){if(!a)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const nt=function(St,Dt,Rt,kt,Ot){if(Rt.length!==0){const Gt=[],Nt=[];xE(Rt,Gt,Nt,kt),Gt.length!==0&&Ot.push(new St(Dt,Gt,Nt))}},it=[],ot=a.name||"default",ht=a.fps||30,ft=a.blendMode;let wt=a.length||-1;const bt=a.hierarchy||[];for(let St=0;St<bt.length;St++){const Dt=bt[St].keys;if(Dt&&Dt.length!==0)if(Dt[0].morphTargets){const Rt={};let kt;for(kt=0;kt<Dt.length;kt++)if(Dt[kt].morphTargets)for(let Ot=0;Ot<Dt[kt].morphTargets.length;Ot++)Rt[Dt[kt].morphTargets[Ot]]=-1;for(const Ot in Rt){const Gt=[],Nt=[];for(let zt=0;zt!==Dt[kt].morphTargets.length;++zt){const qt=Dt[kt];Gt.push(qt.time),Nt.push(qt.morphTarget===Ot?1:0)}it.push(new Yx(".morphTargetInfluence["+Ot+"]",Gt,Nt))}wt=Rt.length*ht}else{const Rt=".bones["+j[St].name+"]";nt(A_,Rt+".position",Dt,"pos",it),nt(t0,Rt+".quaternion",Dt,"rot",it),nt(A_,Rt+".scale",Dt,"scl",it)}}return it.length===0?null:new this(ot,wt,it,ft)}resetDuration(){let a=0;for(let j=0,nt=this.tracks.length;j!==nt;++j){const it=this.tracks[j];a=Math.max(a,it.times[it.times.length-1])}return this.duration=a,this}trim(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this}validate(){let a=!0;for(let j=0;j<this.tracks.length;j++)a=a&&this.tracks[j].validate();return a}optimize(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}clone(){const a=[];for(let j=0;j<this.tracks.length;j++)a.push(this.tracks[j].clone());return new this.constructor(this.name,this.duration,a,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Zy(ut){if(ut.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const a=function(j){switch(j.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Yx;case"vector":case"vector2":case"vector3":case"vector4":return A_;case"color":return ET;case"quaternion":return t0;case"bool":case"boolean":return y_;case"string":return n0}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+j)}(ut.type);if(ut.times===void 0){const j=[],nt=[];xE(ut.keys,j,nt,"value"),ut.times=j,ut.values=nt}return a.parse!==void 0?a.parse(ut):new a(ut.name,ut.times,ut.values,ut.interpolation)}const fu={enabled:!1,files:{},add:function(ut,a){this.enabled!==!1&&(this.files[ut]=a)},get:function(ut,a){return this.enabled===!1?a?Promise.resolve():void 0:a?Promise.resolve(this.files[ut]):this.files[ut]},remove:function(ut){delete this.files[ut]},clear:function(){this.files={}}};class TC{constructor(a,j,nt){const it=this;let ot,ht=!1,ft=0,wt=0;const bt=[];this.onStart=void 0,this.onLoad=a,this.onProgress=j,this.onError=nt,this.itemStart=function(St){wt++,ht===!1&&it.onStart!==void 0&&it.onStart(St,ft,wt),ht=!0},this.itemEnd=function(St){ft++,it.onProgress!==void 0&&it.onProgress(St,ft,wt),ft===wt&&(ht=!1,it.onLoad!==void 0&&it.onLoad())},this.itemError=function(St){it.onError!==void 0&&it.onError(St)},this.resolveURL=function(St){return ot?ot(St):St},this.setURLModifier=function(St){return ot=St,this},this.addHandler=function(St,Dt){return bt.push(St,Dt),this},this.removeHandler=function(St){const Dt=bt.indexOf(St);return Dt!==-1&&bt.splice(Dt,2),this},this.getHandler=function(St){for(let Dt=0,Rt=bt.length;Dt<Rt;Dt+=2){const kt=bt[Dt],Ot=bt[Dt+1];if(kt.global&&(kt.lastIndex=0),kt.test(St))return Ot}return null}}}const EE=new TC;class lv{constructor(a){this.manager=a!==void 0?a:EE,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(a,j){const nt=this;return new Promise(function(it,ot){nt.load(a,it,j,ot)})}parse(){}setCrossOrigin(a){return this.crossOrigin=a,this}setWithCredentials(a){return this.withCredentials=a,this}setPath(a){return this.path=a,this}setResourcePath(a){return this.resourcePath=a,this}setRequestHeader(a){return this.requestHeader=a,this}}const cv={};class eA extends Error{constructor(a,j){super(a),this.response=j}}class Wp extends lv{constructor(a){super(a),this.responseType="text",this.useCache=!0}load(a,j,nt,it){a===void 0&&(a=""),this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a),(this.useCache?fu.get(a,this.responseType,this.mimeType):Promise.resolve(void 0)).then(ot=>{if(ot!==void 0)return this.manager.itemStart(a),setTimeout(()=>{j&&j(ot),this.manager.itemEnd(a)},0),ot;if(cv[a]!==void 0)return void cv[a].push({onLoad:j,onProgress:nt,onError:it});cv[a]=[],cv[a].push({onLoad:j,onProgress:nt,onError:it});const ht=new Request(a,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),ft=this.mimeType,wt=this.responseType;fetch(ht).then(bt=>{if(bt.status===200||bt.status===0){if(bt.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||bt.body===void 0||bt.body.getReader===void 0)return bt;const St=cv[a],Dt=bt.body.getReader(),Rt=bt.headers.get("Content-Length")||bt.headers.get("X-File-Size"),kt=Rt?parseInt(Rt):0,Ot=kt!==0;let Gt=0;const Nt=new ReadableStream({start(zt){(function qt(){Dt.read().then(({done:$t,value:En})=>{if($t)zt.close();else{Gt+=En.byteLength;const gn=new ProgressEvent("progress",{lengthComputable:Ot,loaded:Gt,total:kt});for(let vn=0,Un=St.length;vn<Un;vn++){const $n=St[vn];$n.onProgress&&$n.onProgress(gn)}zt.enqueue(En),qt()}})})()}});return new Response(Nt)}throw new eA(`fetch for "${bt.url}" responded with ${bt.status}: ${bt.statusText}`,bt)}).then(bt=>{switch(wt){case"arraybuffer":return bt.arrayBuffer();case"blob":return bt.blob();case"document":return bt.text().then(St=>new DOMParser().parseFromString(St,ft));case"json":return bt.json();default:if(ft===void 0)return bt.text();{const St=/charset="?([^;"\s]*)"?/i.exec(ft),Dt=St&&St[1]?St[1].toLowerCase():void 0,Rt=new TextDecoder(Dt);return bt.arrayBuffer().then(kt=>Rt.decode(kt))}}}).then(bt=>{this.useCache&&fu.add(a,bt,this.responseType);const St=cv[a];delete cv[a];for(let Dt=0,Rt=St.length;Dt<Rt;Dt++){const kt=St[Dt];kt.onLoad&&kt.onLoad(bt)}}).catch(bt=>{const St=cv[a];if(St===void 0)throw this.manager.itemError(a),bt;delete cv[a];for(let Dt=0,Rt=St.length;Dt<Rt;Dt++){const kt=St[Dt];kt.onError&&kt.onError(bt)}this.manager.itemError(a)}).finally(()=>{this.useCache&&this.manager.itemEnd(a)}),this.useCache&&this.manager.itemStart(a)})}setResponseType(a){return this.responseType=a,this}setMimeType(a){return this.mimeType=a,this}}class X0 extends lv{constructor(a){super(a)}load(a,j,nt,it){const ot=this,ht=new Wp(this.manager);ht.setPath(this.path),ht.setRequestHeader(this.requestHeader),ht.setWithCredentials(this.withCredentials),ht.load(a,function(ft){try{j(ot.parse(JSON.parse(ft)))}catch(wt){it?it(wt):console.error(wt),ot.manager.itemError(a)}},nt,it)}parse(a){const j=[];for(let nt=0;nt<a.length;nt++){const it=q0.parse(a[nt]);j.push(it)}return j}}class ST extends lv{constructor(a){super(a)}load(a,j,nt,it){const ot=this,ht=[],ft=new dE,wt=new Wp(this.manager);wt.setPath(this.path),wt.setResponseType("arraybuffer"),wt.setRequestHeader(this.requestHeader),wt.setWithCredentials(ot.withCredentials);let bt=0;function St(Dt){wt.load(a[Dt],function(Rt){const kt=ot.parse(Rt,!0);ht[Dt]={width:kt.width,height:kt.height,format:kt.format,mipmaps:kt.mipmaps},bt+=1,bt===6&&(kt.mipmapCount===1&&(ft.minFilter=Il),ft.image=ht,ft.format=kt.format,ft.needsUpdate=!0,j&&j(ft))},nt,it)}if(Array.isArray(a))for(let Dt=0,Rt=a.length;Dt<Rt;++Dt)St(Dt);else wt.load(a,function(Dt){const Rt=ot.parse(Dt,!0);if(Rt.isCubemap){const kt=Rt.mipmaps.length/Rt.mipmapCount;for(let Ot=0;Ot<kt;Ot++){ht[Ot]={mipmaps:[]};for(let Gt=0;Gt<Rt.mipmapCount;Gt++)ht[Ot].mipmaps.push(Rt.mipmaps[Ot*Rt.mipmapCount+Gt]),ht[Ot].format=Rt.format,ht[Ot].width=Rt.width,ht[Ot].height=Rt.height}ft.image=ht}else ft.image.width=Rt.width,ft.image.height=Rt.height,ft.mipmaps=Rt.mipmaps;Rt.mipmapCount===1&&(ft.minFilter=Il),ft.format=Rt.format,ft.needsUpdate=!0,j&&j(ft)},nt,it);return ft}}class mu extends lv{constructor(a){super(a)}load(a,j,nt,it){const ot=a;this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const ht=this,ft=fu.get(a);if(ft!==void 0)return ht.manager.itemStart(a),setTimeout(function(){j&&j(ft),ht.manager.itemEnd(a)},0),ft;const wt=Cy("img");function bt(){Dt(),fu.add(a,this),j&&j(this),ht.manager.itemEnd(a)}function St(Rt){Dt(),it&&it(Rt),ht.manager.itemError(a),ht.manager.itemEnd(a)}function Dt(){wt.removeEventListener("load",bt,!1),wt.removeEventListener("error",St,!1)}return wt.addEventListener("load",bt,!1),wt.addEventListener("error",St,!1),a.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(wt.crossOrigin=this.crossOrigin),ht.manager.itemStart(a),fu.get(a,"blob").then(Rt=>{if(Rt!==void 0&&!Rt.type.startsWith("text/plain"))return Rt.type||(a.endsWith(".svg")||a.startsWith("data:image/svg"))&&(Rt=new Blob([Rt],{type:"image/svg+xml"})),void(wt.src=URL.createObjectURL(Rt));const kt=new Wp(this.manager);kt.useCache=!1,kt.setPath(this.path),kt.setCrossOrigin(this.crossOrigin),kt.setResponseType("blob"),kt.load(ot,function(Ot){Ot.type||(a.endsWith(".svg")||a.startsWith("data:image/svg"))&&(Ot=new Blob([Ot],{type:"image/svg+xml"})),fu.add(a,Ot,"blob"),wt.src=URL.createObjectURL(Ot)},nt,Ot=>{Dt(),it&&it(Ot)})}),wt}}class CT extends lv{constructor(a){super(a)}load(a,j,nt,it){const ot=new JA,ht=new mu(this.manager);ht.setCrossOrigin(this.crossOrigin),ht.setPath(this.path);let ft=0;function wt(bt){ht.load(a[bt],function(St){ot.images[bt]=St,ft++,ft===6&&(ot.needsUpdate=!0,j&&j(ot))},void 0,it)}for(let bt=0;bt<a.length;++bt)wt(bt);return ot}}class iP extends lv{constructor(a){super(a)}load(a,j,nt,it){const ot=this,ht=new Ox,ft=new Wp(this.manager);return ft.setResponseType("arraybuffer"),ft.setRequestHeader(this.requestHeader),ft.setPath(this.path),ft.setWithCredentials(ot.withCredentials),ft.load(a,function(wt){const bt=ot.parse(wt);bt&&(bt.image!==void 0?ht.image=bt.image:bt.data!==void 0&&(ht.image.width=bt.width,ht.image.height=bt.height,ht.image.data=bt.data,ht.image.complete=!0),ht.wrapS=bt.wrapS!==void 0?bt.wrapS:Tl,ht.wrapT=bt.wrapT!==void 0?bt.wrapT:Tl,ht.magFilter=bt.magFilter!==void 0?bt.magFilter:Il,ht.minFilter=bt.minFilter!==void 0?bt.minFilter:Il,ht.anisotropy=bt.anisotropy!==void 0?bt.anisotropy:1,bt.colorSpace!==void 0?ht.colorSpace=bt.colorSpace:bt.encoding!==void 0&&(ht.encoding=bt.encoding),bt.flipY!==void 0&&(ht.flipY=bt.flipY),bt.format!==void 0&&(ht.format=bt.format),bt.type!==void 0&&(ht.type=bt.type),bt.mipmaps!==void 0&&(ht.mipmaps=bt.mipmaps,ht.minFilter=Au),bt.mipmapCount===1&&(ht.minFilter=Il),bt.generateMipmaps!==void 0&&(ht.generateMipmaps=bt.generateMipmaps),ht.needsUpdate=!0,j&&j(ht,bt))},nt,it),ht}}class IC extends lv{constructor(a){super(a)}load(a,j,nt,it){const ot=new ga,ht=new mu(this.manager);return ht.setCrossOrigin(this.crossOrigin),ht.setPath(this.path),ht.load(a,function(ft){ot.image=ft,ot.needsUpdate=!0,j!==void 0&&j(ot)},nt,it),ot}}class um extends Po{constructor(a,j=1){super(),this.isLight=!0,this.type="Light",this.color=new us(a),this.intensity=j}dispose(){}copy(a,j){return super.copy(a,j),this.color.copy(a.color),this.intensity=a.intensity,this}toJSON(a){const j=super.toJSON(a);return j.object.color=this.color.getHex(),j.object.intensity=this.intensity,this.groundColor!==void 0&&(j.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(j.object.distance=this.distance),this.angle!==void 0&&(j.object.angle=this.angle),this.decay!==void 0&&(j.object.decay=this.decay),this.penumbra!==void 0&&(j.object.penumbra=this.penumbra),this.shadow!==void 0&&(j.object.shadow=this.shadow.toJSON()),j}}class hm extends um{constructor(a,j,nt){super(a,nt),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Po.DEFAULT_UP),this.updateMatrix(),this.groundColor=new us(j)}copy(a,j){return super.copy(a,j),this.groundColor.copy(a.groundColor),this}}const PC=new ro,zm=new Rn,RC=new Rn;class MT{constructor(a){this.camera=a,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Br(512,512),this.map=null,this.mapPass=null,this.matrix=new ro,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new W1,this._frameExtents=new Br(1,1),this._viewportCount=1,this._viewports=[new No(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(a){const j=this.camera,nt=this.matrix;zm.setFromMatrixPosition(a.matrixWorld),j.position.copy(zm),RC.setFromMatrixPosition(a.target.matrixWorld),j.lookAt(RC),j.updateMatrixWorld(),PC.multiplyMatrices(j.projectionMatrix,j.matrixWorldInverse),this._frustum.setFromProjectionMatrix(PC),nt.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),nt.multiply(PC)}getViewport(a){return this._viewports[a]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(a){return this.camera=a.camera.clone(),this.bias=a.bias,this.normalBias=a.normalBias,this.radius=a.radius,this.mapSize.copy(a.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const a={};return this.bias!==0&&(a.bias=this.bias),this.normalBias!==0&&(a.normalBias=this.normalBias),this.radius!==1&&(a.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(a.mapSize=this.mapSize.toArray()),a.camera=this.camera.toJSON(!1).object,delete a.camera.matrix,a}}class mB extends MT{constructor(){super(new Cp(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(a){const j=this.camera,nt=2*Im*a.angle*this.focus,it=this.mapSize.width/this.mapSize.height,ot=a.distance||j.far;nt===j.fov&&it===j.aspect&&ot===j.far||(j.fov=nt,j.aspect=it,j.far=ot,j.updateProjectionMatrix()),super.updateMatrices(a)}copy(a){return super.copy(a),this.focus=a.focus,this}}class TT extends um{constructor(a,j,nt=0,it=Math.PI/3,ot=0,ht=2){super(a,j),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Po.DEFAULT_UP),this.updateMatrix(),this.target=new Po,this.distance=nt,this.angle=it,this.penumbra=ot,this.decay=ht,this.map=null,this.shadow=new mB}get power(){return this.intensity*Math.PI}set power(a){this.intensity=a/Math.PI}dispose(){this.shadow.dispose()}copy(a,j){return super.copy(a,j),this.distance=a.distance,this.angle=a.angle,this.penumbra=a.penumbra,this.decay=a.decay,this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}const Kx=new ro,tA=new Rn,dm=new Rn;class gB extends MT{constructor(){super(new Cp(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Br(4,2),this._viewportCount=6,this._viewports=[new No(2,1,1,1),new No(0,1,1,1),new No(3,1,1,1),new No(1,1,1,1),new No(3,0,1,1),new No(1,0,1,1)],this._cubeDirections=[new Rn(1,0,0),new Rn(-1,0,0),new Rn(0,0,1),new Rn(0,0,-1),new Rn(0,1,0),new Rn(0,-1,0)],this._cubeUps=[new Rn(0,1,0),new Rn(0,1,0),new Rn(0,1,0),new Rn(0,1,0),new Rn(0,0,1),new Rn(0,0,-1)]}updateMatrices(a,j=0){const nt=this.camera,it=this.matrix,ot=a.distance||nt.far;ot!==nt.far&&(nt.far=ot,nt.updateProjectionMatrix()),tA.setFromMatrixPosition(a.matrixWorld),nt.position.copy(tA),dm.copy(nt.position),dm.add(this._cubeDirections[j]),nt.up.copy(this._cubeUps[j]),nt.lookAt(dm),nt.updateMatrixWorld(),it.makeTranslation(-tA.x,-tA.y,-tA.z),Kx.multiplyMatrices(nt.projectionMatrix,nt.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Kx)}}class xw extends um{constructor(a,j,nt=0,it=2){super(a,j),this.isPointLight=!0,this.type="PointLight",this.distance=nt,this.decay=it,this.shadow=new gB}get power(){return 4*this.intensity*Math.PI}set power(a){this.intensity=a/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(a,j){return super.copy(a,j),this.distance=a.distance,this.decay=a.decay,this.shadow=a.shadow.clone(),this}}class rP extends MT{constructor(){super(new VS(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class IT extends um{constructor(a,j){super(a,j),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Po.DEFAULT_UP),this.updateMatrix(),this.target=new Po,this.shadow=new rP}dispose(){this.shadow.dispose()}copy(a){return super.copy(a),this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}class SE extends um{constructor(a,j){super(a,j),this.isAmbientLight=!0,this.type="AmbientLight"}}class PT extends um{constructor(a,j,nt=10,it=10){super(a,j),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=nt,this.height=it}get power(){return this.intensity*this.width*this.height*Math.PI}set power(a){this.intensity=a/(this.width*this.height*Math.PI)}copy(a){return super.copy(a),this.width=a.width,this.height=a.height,this}toJSON(a){const j=super.toJSON(a);return j.object.width=this.width,j.object.height=this.height,j}}class DC{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let a=0;a<9;a++)this.coefficients.push(new Rn)}set(a){for(let j=0;j<9;j++)this.coefficients[j].copy(a[j]);return this}zero(){for(let a=0;a<9;a++)this.coefficients[a].set(0,0,0);return this}getAt(a,j){const nt=a.x,it=a.y,ot=a.z,ht=this.coefficients;return j.copy(ht[0]).multiplyScalar(.282095),j.addScaledVector(ht[1],.488603*it),j.addScaledVector(ht[2],.488603*ot),j.addScaledVector(ht[3],.488603*nt),j.addScaledVector(ht[4],nt*it*1.092548),j.addScaledVector(ht[5],it*ot*1.092548),j.addScaledVector(ht[6],.315392*(3*ot*ot-1)),j.addScaledVector(ht[7],nt*ot*1.092548),j.addScaledVector(ht[8],.546274*(nt*nt-it*it)),j}getIrradianceAt(a,j){const nt=a.x,it=a.y,ot=a.z,ht=this.coefficients;return j.copy(ht[0]).multiplyScalar(.886227),j.addScaledVector(ht[1],1.023328*it),j.addScaledVector(ht[2],1.023328*ot),j.addScaledVector(ht[3],1.023328*nt),j.addScaledVector(ht[4],.858086*nt*it),j.addScaledVector(ht[5],.858086*it*ot),j.addScaledVector(ht[6],.743125*ot*ot-.247708),j.addScaledVector(ht[7],.858086*nt*ot),j.addScaledVector(ht[8],.429043*(nt*nt-it*it)),j}add(a){for(let j=0;j<9;j++)this.coefficients[j].add(a.coefficients[j]);return this}addScaledSH(a,j){for(let nt=0;nt<9;nt++)this.coefficients[nt].addScaledVector(a.coefficients[nt],j);return this}scale(a){for(let j=0;j<9;j++)this.coefficients[j].multiplyScalar(a);return this}lerp(a,j){for(let nt=0;nt<9;nt++)this.coefficients[nt].lerp(a.coefficients[nt],j);return this}equals(a){for(let j=0;j<9;j++)if(!this.coefficients[j].equals(a.coefficients[j]))return!1;return!0}copy(a){return this.set(a.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(a,j=0){const nt=this.coefficients;for(let it=0;it<9;it++)nt[it].fromArray(a,j+3*it);return this}toArray(a=[],j=0){const nt=this.coefficients;for(let it=0;it<9;it++)nt[it].toArray(a,j+3*it);return a}static getBasisAt(a,j){const nt=a.x,it=a.y,ot=a.z;j[0]=.282095,j[1]=.488603*it,j[2]=.488603*ot,j[3]=.488603*nt,j[4]=1.092548*nt*it,j[5]=1.092548*it*ot,j[6]=.315392*(3*ot*ot-1),j[7]=1.092548*nt*ot,j[8]=.546274*(nt*nt-it*it)}}class i0 extends um{constructor(a=new DC,j=1){super(void 0,j),this.isLightProbe=!0,this.sh=a}copy(a){return super.copy(a),this.sh.copy(a.sh),this}fromJSON(a){return this.intensity=a.intensity,this.sh.fromArray(a.sh),this}toJSON(a){const j=super.toJSON(a);return j.object.sh=this.sh.toArray(),j}}class Jx extends lv{constructor(a){super(a),this.textures={}}load(a,j,nt,it){const ot=this,ht=new Wp(ot.manager);ht.setPath(ot.path),ht.setRequestHeader(ot.requestHeader),ht.setWithCredentials(ot.withCredentials),ht.load(a,function(ft){try{j(ot.parse(JSON.parse(ft)))}catch(wt){it?it(wt):console.error(wt),ot.manager.itemError(a)}},nt,it)}parse(a){const j=this.textures;function nt(ht){return j[ht]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",ht),j[ht]}const it=a.metadata&&a.metadata.version<=4.5?io:void 0,ot=Jx.createMaterialFromType(a.type);if(a.uuid!==void 0&&(ot.uuid=a.uuid),a.name!==void 0&&(ot.name=a.name),a.color!==void 0&&ot.color!==void 0&&ot.color.setHex(a.color,it),a.roughness!==void 0&&(ot.roughness=a.roughness),a.metalness!==void 0&&(ot.metalness=a.metalness),a.sheen!==void 0&&(ot.sheen=a.sheen),a.sheenColor!==void 0&&(ot.sheenColor=new us().setHex(a.sheenColor,it)),a.sheenRoughness!==void 0&&(ot.sheenRoughness=a.sheenRoughness),a.emissive!==void 0&&ot.emissive!==void 0&&ot.emissive.setHex(a.emissive,it),a.specular!==void 0&&ot.specular!==void 0&&ot.specular.setHex(a.specular,it),a.specularIntensity!==void 0&&(ot.specularIntensity=a.specularIntensity),a.specularColor!==void 0&&ot.specularColor!==void 0&&ot.specularColor.setHex(a.specularColor,it),a.shininess!==void 0&&(ot.shininess=a.shininess),a.clearcoat!==void 0&&(ot.clearcoat=a.clearcoat),a.clearcoatRoughness!==void 0&&(ot.clearcoatRoughness=a.clearcoatRoughness),a.iridescence!==void 0&&(ot.iridescence=a.iridescence),a.iridescenceIOR!==void 0&&(ot.iridescenceIOR=a.iridescenceIOR),a.iridescenceThicknessRange!==void 0&&(ot.iridescenceThicknessRange=a.iridescenceThicknessRange),a.transmission!==void 0&&(ot.transmission=a.transmission),a.thickness!==void 0&&(ot.thickness=a.thickness),a.attenuationDistance!==void 0&&(ot.attenuationDistance=a.attenuationDistance),a.attenuationColor!==void 0&&ot.attenuationColor!==void 0&&ot.attenuationColor.setHex(a.attenuationColor,it),a.fog!==void 0&&(ot.fog=a.fog),a.flatShading!==void 0&&(ot.flatShading=a.flatShading),a.blending!==void 0&&(ot.blending=a.blending),a.combine!==void 0&&(ot.combine=a.combine),a.side!==void 0&&(ot.side=a.side),a.shadowSide!==void 0&&(ot.shadowSide=a.shadowSide),a.opacity!==void 0&&(ot.opacity=a.opacity),a.transparent!==void 0&&(ot.transparent=a.transparent),a.alphaTest!==void 0&&(ot.alphaTest=a.alphaTest),a.depthTest!==void 0&&(ot.depthTest=a.depthTest),a.depthWrite!==void 0&&(ot.depthWrite=a.depthWrite),a.colorWrite!==void 0&&(ot.colorWrite=a.colorWrite),a.stencilWrite!==void 0&&(ot.stencilWrite=a.stencilWrite),a.stencilWriteMask!==void 0&&(ot.stencilWriteMask=a.stencilWriteMask),a.stencilFunc!==void 0&&(ot.stencilFunc=a.stencilFunc),a.stencilRef!==void 0&&(ot.stencilRef=a.stencilRef),a.stencilFuncMask!==void 0&&(ot.stencilFuncMask=a.stencilFuncMask),a.stencilFail!==void 0&&(ot.stencilFail=a.stencilFail),a.stencilZFail!==void 0&&(ot.stencilZFail=a.stencilZFail),a.stencilZPass!==void 0&&(ot.stencilZPass=a.stencilZPass),a.wireframe!==void 0&&(ot.wireframe=a.wireframe),a.wireframeLinewidth!==void 0&&(ot.wireframeLinewidth=a.wireframeLinewidth),a.wireframeLinecap!==void 0&&(ot.wireframeLinecap=a.wireframeLinecap),a.wireframeLinejoin!==void 0&&(ot.wireframeLinejoin=a.wireframeLinejoin),a.rotation!==void 0&&(ot.rotation=a.rotation),a.linewidth!==1&&(ot.linewidth=a.linewidth),a.dashSize!==void 0&&(ot.dashSize=a.dashSize),a.gapSize!==void 0&&(ot.gapSize=a.gapSize),a.scale!==void 0&&(ot.scale=a.scale),a.polygonOffset!==void 0&&(ot.polygonOffset=a.polygonOffset),a.polygonOffsetFactor!==void 0&&(ot.polygonOffsetFactor=a.polygonOffsetFactor),a.polygonOffsetUnits!==void 0&&(ot.polygonOffsetUnits=a.polygonOffsetUnits),a.dithering!==void 0&&(ot.dithering=a.dithering),a.alphaToCoverage!==void 0&&(ot.alphaToCoverage=a.alphaToCoverage),a.premultipliedAlpha!==void 0&&(ot.premultipliedAlpha=a.premultipliedAlpha),a.forceSinglePass!==void 0&&(ot.forceSinglePass=a.forceSinglePass),a.visible!==void 0&&(ot.visible=a.visible),a.toneMapped!==void 0&&(ot.toneMapped=a.toneMapped),a.userData!==void 0&&(ot.userData=a.userData),a.vertexColors!==void 0&&(typeof a.vertexColors=="number"?ot.vertexColors=a.vertexColors>0:ot.vertexColors=a.vertexColors),a.uniforms!==void 0)for(const ht in a.uniforms){const ft=a.uniforms[ht];switch(ot.uniforms[ht]={},ft.type){case"t":ot.uniforms[ht].value=nt(ft.value);break;case"c":ot.uniforms[ht].value=new us().setHex(ft.value,it);break;case"v2":ot.uniforms[ht].value=new Br().fromArray(ft.value);break;case"v3":ot.uniforms[ht].value=new Rn().fromArray(ft.value);break;case"v4":ot.uniforms[ht].value=new No().fromArray(ft.value);break;case"m3":ot.uniforms[ht].value=new oo().fromArray(ft.value);break;case"m4":ot.uniforms[ht].value=new ro().fromArray(ft.value);break;default:ot.uniforms[ht].value=ft.value}}if(a.defines!==void 0&&(ot.defines=a.defines),a.vertexShader!==void 0&&(ot.vertexShader=a.vertexShader),a.fragmentShader!==void 0&&(ot.fragmentShader=a.fragmentShader),a.glslVersion!==void 0&&(ot.glslVersion=a.glslVersion),a.extensions!==void 0)for(const ht in a.extensions)ot.extensions[ht]=a.extensions[ht];if(a.lights!==void 0&&(ot.lights=a.lights),a.clipping!==void 0&&(ot.clipping=a.clipping),a.size!==void 0&&(ot.size=a.size),a.sizeAttenuation!==void 0&&(ot.sizeAttenuation=a.sizeAttenuation),a.map!==void 0&&(ot.map=nt(a.map)),a.matcap!==void 0&&(ot.matcap=nt(a.matcap)),a.alphaMap!==void 0&&(ot.alphaMap=nt(a.alphaMap)),a.bumpMap!==void 0&&(ot.bumpMap=nt(a.bumpMap)),a.bumpScale!==void 0&&(ot.bumpScale=a.bumpScale),a.normalMap!==void 0&&(ot.normalMap=nt(a.normalMap)),a.normalMapType!==void 0&&(ot.normalMapType=a.normalMapType),a.normalScale!==void 0){let ht=a.normalScale;Array.isArray(ht)===!1&&(ht=[ht,ht]),ot.normalScale=new Br().fromArray(ht)}return a.displacementMap!==void 0&&(ot.displacementMap=nt(a.displacementMap)),a.displacementScale!==void 0&&(ot.displacementScale=a.displacementScale),a.displacementBias!==void 0&&(ot.displacementBias=a.displacementBias),a.roughnessMap!==void 0&&(ot.roughnessMap=nt(a.roughnessMap)),a.metalnessMap!==void 0&&(ot.metalnessMap=nt(a.metalnessMap)),a.emissiveMap!==void 0&&(ot.emissiveMap=nt(a.emissiveMap)),a.emissiveIntensity!==void 0&&(ot.emissiveIntensity=a.emissiveIntensity),a.specularMap!==void 0&&(ot.specularMap=nt(a.specularMap)),a.specularIntensityMap!==void 0&&(ot.specularIntensityMap=nt(a.specularIntensityMap)),a.specularColorMap!==void 0&&(ot.specularColorMap=nt(a.specularColorMap)),a.envMap!==void 0&&(ot.envMap=nt(a.envMap)),a.envMapIntensity!==void 0&&(ot.envMapIntensity=a.envMapIntensity),a.reflectivity!==void 0&&(ot.reflectivity=a.reflectivity),a.refractionRatio!==void 0&&(ot.refractionRatio=a.refractionRatio),a.lightMap!==void 0&&(ot.lightMap=nt(a.lightMap)),a.lightMapIntensity!==void 0&&(ot.lightMapIntensity=a.lightMapIntensity),a.aoMap!==void 0&&(ot.aoMap=nt(a.aoMap)),a.aoMapIntensity!==void 0&&(ot.aoMapIntensity=a.aoMapIntensity),a.gradientMap!==void 0&&(ot.gradientMap=nt(a.gradientMap)),a.clearcoatMap!==void 0&&(ot.clearcoatMap=nt(a.clearcoatMap)),a.clearcoatRoughnessMap!==void 0&&(ot.clearcoatRoughnessMap=nt(a.clearcoatRoughnessMap)),a.clearcoatNormalMap!==void 0&&(ot.clearcoatNormalMap=nt(a.clearcoatNormalMap)),a.clearcoatNormalScale!==void 0&&(ot.clearcoatNormalScale=new Br().fromArray(a.clearcoatNormalScale)),a.iridescenceMap!==void 0&&(ot.iridescenceMap=nt(a.iridescenceMap)),a.iridescenceThicknessMap!==void 0&&(ot.iridescenceThicknessMap=nt(a.iridescenceThicknessMap)),a.transmissionMap!==void 0&&(ot.transmissionMap=nt(a.transmissionMap)),a.thicknessMap!==void 0&&(ot.thicknessMap=nt(a.thicknessMap)),a.sheenColorMap!==void 0&&(ot.sheenColorMap=nt(a.sheenColorMap)),a.sheenRoughnessMap!==void 0&&(ot.sheenRoughnessMap=nt(a.sheenRoughnessMap)),ot}setTextures(a){return this.textures=a,this}static createMaterialFromType(a){return new{ShadowMaterial:wE,SpriteMaterial:sT,RawShaderMaterial:SC,ShaderMaterial:p_,PointsMaterial:dw,MeshPhysicalMaterial:J2,MeshStandardMaterial:AT,MeshPhongMaterial:$2,MeshToonMaterial:bT,MeshNormalMaterial:Z2,MeshLambertMaterial:wT,MeshDepthMaterial:sw,MeshDistanceMaterial:ow,MeshBasicMaterial:Bm,MeshMatcapMaterial:eP,LineDashedMaterial:xT,LineBasicMaterial:lm,Material:ku}[a]}}class $x{static decodeText(a){if(typeof TextDecoder<"u")return new TextDecoder().decode(a);let j="";for(let nt=0,it=a.length;nt<it;nt++)j+=String.fromCharCode(a[nt]);try{return decodeURIComponent(escape(j))}catch{return j}}static extractUrlBase(a){const j=a.lastIndexOf("/");return j===-1?"./":a.slice(0,j+1)}static resolveURL(a,j){return typeof a!="string"||a===""?"":(/^https?:\/\//i.test(j)&&/^\//.test(a)&&(j=j.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:j+a)}}class b_ extends Vt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(a){return super.copy(a),this.instanceCount=a.instanceCount,this}toJSON(){const a=super.toJSON();return a.instanceCount=this.instanceCount,a.isInstancedBufferGeometry=!0,a}}class sP extends lv{constructor(a){super(a)}load(a,j,nt,it){const ot=this,ht=new Wp(ot.manager);ht.setPath(ot.path),ht.setRequestHeader(ot.requestHeader),ht.setWithCredentials(ot.withCredentials),ht.load(a,function(ft){try{j(ot.parse(JSON.parse(ft)))}catch(wt){it?it(wt):console.error(wt),ot.manager.itemError(a)}},nt,it)}parse(a){const j={},nt={};function it(Dt,Rt){if(j[Rt]!==void 0)return j[Rt];const kt=Dt.interleavedBuffers[Rt],Ot=function(zt,qt){if(nt[qt]!==void 0)return nt[qt];const $t=zt.arrayBuffers[qt],En=new Uint32Array($t).buffer;return nt[qt]=En,En}(Dt,kt.buffer),Gt=y0(kt.type,Ot),Nt=new Hp(Gt,kt.stride);return Nt.uuid=kt.uuid,j[Rt]=Nt,Nt}const ot=a.isInstancedBufferGeometry?new b_:new Vt,ht=a.data.index;if(ht!==void 0){const Dt=y0(ht.type,ht.array);ot.setIndex(new Jo(Dt,1))}const ft=a.data.attributes;for(const Dt in ft){const Rt=ft[Dt];let kt;if(Rt.isInterleavedBufferAttribute){const Ot=it(a.data,Rt.data);kt=new j0(Ot,Rt.itemSize,Rt.offset,Rt.normalized)}else{const Ot=y0(Rt.type,Rt.array);kt=new(Rt.isInstancedBufferAttribute?Qp:Jo)(Ot,Rt.itemSize,Rt.normalized)}Rt.name!==void 0&&(kt.name=Rt.name),Rt.usage!==void 0&&kt.setUsage(Rt.usage),Rt.updateRange!==void 0&&(kt.updateRange.offset=Rt.updateRange.offset,kt.updateRange.count=Rt.updateRange.count),ot.setAttribute(Dt,kt)}const wt=a.data.morphAttributes;if(wt)for(const Dt in wt){const Rt=wt[Dt],kt=[];for(let Ot=0,Gt=Rt.length;Ot<Gt;Ot++){const Nt=Rt[Ot];let zt;if(Nt.isInterleavedBufferAttribute){const qt=it(a.data,Nt.data);zt=new j0(qt,Nt.itemSize,Nt.offset,Nt.normalized)}else{const qt=y0(Nt.type,Nt.array);zt=new Jo(qt,Nt.itemSize,Nt.normalized)}Nt.name!==void 0&&(zt.name=Nt.name),kt.push(zt)}ot.morphAttributes[Dt]=kt}a.data.morphTargetsRelative&&(ot.morphTargetsRelative=!0);const bt=a.data.groups||a.data.drawcalls||a.data.offsets;if(bt!==void 0)for(let Dt=0,Rt=bt.length;Dt!==Rt;++Dt){const kt=bt[Dt];ot.addGroup(kt.start,kt.count,kt.materialIndex)}const St=a.data.boundingSphere;if(St!==void 0){const Dt=new Rn;St.center!==void 0&&Dt.fromArray(St.center),ot.boundingSphere=new Dm(Dt,St.radius)}return a.name&&(ot.name=a.name),a.userData&&(ot.userData=a.userData),ot}}class vB extends lv{constructor(a){super(a)}load(a,j,nt,it){const ot=this,ht=this.path===""?$x.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||ht;const ft=new Wp(this.manager);ft.setPath(this.path),ft.setRequestHeader(this.requestHeader),ft.setWithCredentials(this.withCredentials),ft.load(a,function(wt){let bt=null;try{bt=JSON.parse(wt)}catch(Dt){return it!==void 0&&it(Dt),void console.error("THREE:ObjectLoader: Can't parse "+a+".",Dt.message)}const St=bt.metadata;if(St===void 0||St.type===void 0||St.type.toLowerCase()==="geometry")return it!==void 0&&it(new Error("THREE.ObjectLoader: Can't load "+a)),void console.error("THREE.ObjectLoader: Can't load "+a);ot.parse(bt,j)},nt,it)}async loadAsync(a,j){const nt=this.path===""?$x.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||nt;const it=new Wp(this.manager);it.setPath(this.path),it.setRequestHeader(this.requestHeader),it.setWithCredentials(this.withCredentials);const ot=await it.loadAsync(a,j),ht=JSON.parse(ot),ft=ht.metadata;if(ft===void 0||ft.type===void 0||ft.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+a);return await this.parseAsync(ht)}parse(a,j){const nt=this.parseAnimations(a.animations),it=this.parseShapes(a.shapes),ot=this.parseGeometries(a.geometries,it),ht=this.parseImages(a.images,function(){j!==void 0&&j(bt)}),ft=this.parseTextures(a.textures,ht),wt=this.parseMaterials(a.materials,ft),bt=this.parseObject(a.object,ot,wt,ft,nt),St=this.parseSkeletons(a.skeletons,bt);if(this.bindSkeletons(bt,St),j!==void 0){let Dt=!1;for(const Rt in ht)if(ht[Rt].data instanceof HTMLImageElement){Dt=!0;break}Dt===!1&&j(bt)}return bt}async parseAsync(a){const j=this.parseAnimations(a.animations),nt=this.parseShapes(a.shapes),it=this.parseGeometries(a.geometries,nt),ot=await this.parseImagesAsync(a.images),ht=this.parseTextures(a.textures,ot),ft=this.parseMaterials(a.materials,ht),wt=this.parseObject(a.object,it,ft,ht,j),bt=this.parseSkeletons(a.skeletons,wt);return this.bindSkeletons(wt,bt),wt}parseShapes(a){const j={};if(a!==void 0)for(let nt=0,it=a.length;nt<it;nt++){const ot=new Jy().fromJSON(a[nt]);j[ot.uuid]=ot}return j}parseSkeletons(a,j){const nt={},it={};if(j.traverse(function(ot){ot.isBone&&(it[ot.uuid]=ot)}),a!==void 0)for(let ot=0,ht=a.length;ot<ht;ot++){const ft=new Qy().fromJSON(a[ot],it);nt[ft.uuid]=ft}return nt}parseGeometries(a,j){const nt={};if(a!==void 0){const it=new sP;for(let ot=0,ht=a.length;ot<ht;ot++){let ft;const wt=a[ot];switch(wt.type){case"BufferGeometry":case"InstancedBufferGeometry":ft=it.parse(wt);break;default:wt.type in qx?ft=qx[wt.type].fromJSON(wt,j):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${wt.type}"`)}ft.uuid=wt.uuid,wt.name!==void 0&&(ft.name=wt.name),wt.userData!==void 0&&(ft.userData=wt.userData),nt[wt.uuid]=ft}}return nt}parseMaterials(a,j){const nt={},it={};if(a!==void 0){const ot=new Jx;ot.setTextures(j);for(let ht=0,ft=a.length;ht<ft;ht++){const wt=a[ht];nt[wt.uuid]===void 0&&(nt[wt.uuid]=ot.parse(wt)),it[wt.uuid]=nt[wt.uuid]}}return it}parseAnimations(a){const j={};if(a!==void 0)for(let nt=0;nt<a.length;nt++){const it=a[nt],ot=q0.parse(it);j[ot.uuid]=ot}return j}parseImages(a,j){const nt=this,it={};let ot;function ht(ft){if(typeof ft=="string"){const wt=ft;return function(bt){return nt.manager.itemStart(bt),ot.load(bt,function(){nt.manager.itemEnd(bt)},void 0,function(){nt.manager.itemError(bt),nt.manager.itemEnd(bt)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(wt)?wt:nt.resourcePath+wt)}return ft.data?{data:y0(ft.type,ft.data),width:ft.width,height:ft.height,complete:!0}:null}if(a!==void 0&&a.length>0){const ft=new TC(j);ot=new mu(ft),ot.setCrossOrigin(this.crossOrigin);for(let wt=0,bt=a.length;wt<bt;wt++){const St=a[wt],Dt=St.url;if(Array.isArray(Dt)){const Rt=[];for(let kt=0,Ot=Dt.length;kt<Ot;kt++){const Gt=ht(Dt[kt]);Gt!==null&&(Gt instanceof HTMLImageElement?Rt.push(Gt):Rt.push(new Ox(Gt.data,Gt.width,Gt.height)))}it[St.uuid]=new c_(Rt)}else{const Rt=ht(St.url);it[St.uuid]=new c_(Rt)}}}return it}async parseImagesAsync(a){const j=this,nt={};let it;async function ot(ht){if(typeof ht=="string"){const ft=ht,wt=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ft)?ft:j.resourcePath+ft;return await it.loadAsync(wt)}return ht.data?{data:y0(ht.type,ht.data),width:ht.width,height:ht.height,complete:!0}:null}if(a!==void 0&&a.length>0){it=new mu(this.manager),it.setCrossOrigin(this.crossOrigin);for(let ht=0,ft=a.length;ht<ft;ht++){const wt=a[ht],bt=wt.url;if(Array.isArray(bt)){const St=[];for(let Dt=0,Rt=bt.length;Dt<Rt;Dt++){const kt=bt[Dt],Ot=await ot(kt);Ot!==null&&(Ot instanceof HTMLImageElement?St.push(Ot):St.push(new Ox(Ot.data,Ot.width,Ot.height)))}nt[wt.uuid]=new c_(St)}else{const St=await ot(wt.url);nt[wt.uuid]=new c_(St)}}}return nt}parseTextures(a,j){function nt(ot,ht){return typeof ot=="number"?ot:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",ot),ht[ot])}const it={};if(a!==void 0)for(let ot=0,ht=a.length;ot<ht;ot++){const ft=a[ot];ft.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',ft.uuid),j[ft.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",ft.image);const wt=j[ft.image],bt=wt?wt.data:void 0;let St;Array.isArray(bt)?(St=new JA,bt.length===6&&(St.needsUpdate=!0)):(St=bt&&bt.data?new Ox:new ga,bt&&bt.complete&&(St.needsUpdate=!0)),St.source=wt,St.uuid=ft.uuid,ft.name!==void 0&&(St.name=ft.name),ft.mapping!==void 0&&(St.mapping=nt(ft.mapping,oP)),ft.channel!==void 0&&(St.channel=ft.channel),ft.offset!==void 0&&St.offset.fromArray(ft.offset),ft.repeat!==void 0&&St.repeat.fromArray(ft.repeat),ft.center!==void 0&&St.center.fromArray(ft.center),ft.rotation!==void 0&&(St.rotation=ft.rotation),ft.wrap!==void 0&&(St.wrapS=nt(ft.wrap[0],kC),St.wrapT=nt(ft.wrap[1],kC)),ft.format!==void 0&&(St.format=ft.format),ft.internalFormat!==void 0&&(St.internalFormat=ft.internalFormat),ft.type!==void 0&&(St.type=ft.type),ft.colorSpace!==void 0?St.colorSpace=ft.colorSpace:ft.encoding!==void 0&&(St.encoding=ft.encoding),ft.minFilter!==void 0&&(St.minFilter=nt(ft.minFilter,RT)),ft.magFilter!==void 0&&(St.magFilter=nt(ft.magFilter,RT)),ft.anisotropy!==void 0&&(St.anisotropy=ft.anisotropy),ft.flipY!==void 0&&(St.flipY=ft.flipY),ft.generateMipmaps!==void 0&&(St.generateMipmaps=ft.generateMipmaps),ft.premultiplyAlpha!==void 0&&(St.premultiplyAlpha=ft.premultiplyAlpha),ft.unpackAlignment!==void 0&&(St.unpackAlignment=ft.unpackAlignment),ft.userData!==void 0&&(St.userData=ft.userData),it[ft.uuid]=St}return it}parseObject(a,j,nt,it,ot){let ht;const ft=a.metadata&&a.metadata.version<=4.5?io:void 0;function wt(kt){return j[kt]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",kt),j[kt]}function bt(kt){if(kt!==void 0){if(Array.isArray(kt)){const Ot=[];for(let Gt=0,Nt=kt.length;Gt<Nt;Gt++){const zt=kt[Gt];nt[zt]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",zt),Ot.push(nt[zt])}return Ot}return nt[kt]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",kt),nt[kt]}}function St(kt){return it[kt]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",kt),it[kt]}let Dt,Rt;switch(a.type){case"Scene":ht=new ov,a.background!==void 0&&(Number.isInteger(a.background)?ht.background=new us().setHex(a.background,ft):ht.background=St(a.background)),a.environment!==void 0&&(ht.environment=St(a.environment)),a.fog!==void 0&&(a.fog.type==="Fog"?ht.fog=new lw(a.fog.color,a.fog.near,a.fog.far):a.fog.type==="FogExp2"&&(ht.fog=new aw(a.fog.color,a.fog.density))),a.backgroundBlurriness!==void 0&&(ht.backgroundBlurriness=a.backgroundBlurriness),a.backgroundIntensity!==void 0&&(ht.backgroundIntensity=a.backgroundIntensity);break;case"PerspectiveCamera":ht=new Cp(a.fov,a.aspect,a.near,a.far),a.focus!==void 0&&(ht.focus=a.focus),a.zoom!==void 0&&(ht.zoom=a.zoom),a.filmGauge!==void 0&&(ht.filmGauge=a.filmGauge),a.filmOffset!==void 0&&(ht.filmOffset=a.filmOffset),a.view!==void 0&&(ht.view=Object.assign({},a.view));break;case"OrthographicCamera":ht=new VS(a.left,a.right,a.top,a.bottom,a.near,a.far),a.zoom!==void 0&&(ht.zoom=a.zoom),a.view!==void 0&&(ht.view=Object.assign({},a.view));break;case"AmbientLight":ht=new SE(a.color,a.intensity);break;case"DirectionalLight":ht=new IT(a.color,a.intensity);break;case"PointLight":ht=new xw(a.color,a.intensity,a.distance,a.decay);break;case"RectAreaLight":ht=new PT(a.color,a.intensity,a.width,a.height);break;case"SpotLight":ht=new TT(a.color,a.intensity,a.distance,a.angle,a.penumbra,a.decay);break;case"HemisphereLight":ht=new hm(a.color,a.groundColor,a.intensity);break;case"LightProbe":ht=new i0().fromJSON(a);break;case"SkinnedMesh":Dt=wt(a.geometry),Rt=bt(a.material),ht=new Fm(Dt,Rt),a.bindMode!==void 0&&(ht.bindMode=a.bindMode),a.bindMatrix!==void 0&&ht.bindMatrix.fromArray(a.bindMatrix),a.skeleton!==void 0&&(ht.skeleton=a.skeleton);break;case"Mesh":Dt=wt(a.geometry),Rt=bt(a.material),ht=new Ou(Dt,Rt);break;case"InstancedMesh":Dt=wt(a.geometry),Rt=bt(a.material);const kt=a.count,Ot=a.instanceMatrix,Gt=a.instanceColor;ht=new j2(Dt,Rt,kt),ht.instanceMatrix=new Qp(new Float32Array(Ot.array),16),Gt!==void 0&&(ht.instanceColor=new Qp(new Float32Array(Gt.array),Gt.itemSize));break;case"LOD":ht=new Bx;break;case"Line":ht=new Uo(wt(a.geometry),bt(a.material));break;case"LineLoop":ht=new Uv(wt(a.geometry),bt(a.material));break;case"LineSegments":ht=new Nv(wt(a.geometry),bt(a.material));break;case"PointCloud":case"Points":ht=new dC(wt(a.geometry),bt(a.material));break;case"Sprite":ht=new z0(bt(a.material));break;case"Group":ht=new Nu;break;case"Bone":ht=new hp;break;default:ht=new Po}if(ht.uuid=a.uuid,a.name!==void 0&&(ht.name=a.name),a.matrix!==void 0?(ht.matrix.fromArray(a.matrix),a.matrixAutoUpdate!==void 0&&(ht.matrixAutoUpdate=a.matrixAutoUpdate),ht.matrixAutoUpdate&&ht.matrix.decompose(ht.position,ht.quaternion,ht.scale)):(a.position!==void 0&&ht.position.fromArray(a.position),a.rotation!==void 0&&ht.rotation.fromArray(a.rotation),a.quaternion!==void 0&&ht.quaternion.fromArray(a.quaternion),a.scale!==void 0&&ht.scale.fromArray(a.scale)),a.up!==void 0&&ht.up.fromArray(a.up),a.castShadow!==void 0&&(ht.castShadow=a.castShadow),a.receiveShadow!==void 0&&(ht.receiveShadow=a.receiveShadow),a.shadow&&(a.shadow.bias!==void 0&&(ht.shadow.bias=a.shadow.bias),a.shadow.normalBias!==void 0&&(ht.shadow.normalBias=a.shadow.normalBias),a.shadow.radius!==void 0&&(ht.shadow.radius=a.shadow.radius),a.shadow.mapSize!==void 0&&ht.shadow.mapSize.fromArray(a.shadow.mapSize),a.shadow.camera!==void 0&&(ht.shadow.camera=this.parseObject(a.shadow.camera))),a.visible!==void 0&&(ht.visible=a.visible),a.frustumCulled!==void 0&&(ht.frustumCulled=a.frustumCulled),a.renderOrder!==void 0&&(ht.renderOrder=a.renderOrder),a.userData!==void 0&&(ht.userData=a.userData),a.layers!==void 0&&(ht.layers.mask=a.layers),a.children!==void 0){const kt=a.children;for(let Ot=0;Ot<kt.length;Ot++)ht.add(this.parseObject(kt[Ot],j,nt,it,ot))}if(a.animations!==void 0){const kt=a.animations;for(let Ot=0;Ot<kt.length;Ot++){const Gt=kt[Ot];ht.animations.push(ot[Gt])}}if(a.type==="LOD"){a.autoUpdate!==void 0&&(ht.autoUpdate=a.autoUpdate);const kt=a.levels;for(let Ot=0;Ot<kt.length;Ot++){const Gt=kt[Ot],Nt=ht.getObjectByProperty("uuid",Gt.object);Nt!==void 0&&ht.addLevel(Nt,Gt.distance,Gt.hysteresis)}}return ht}bindSkeletons(a,j){Object.keys(j).length!==0&&a.traverse(function(nt){if(nt.isSkinnedMesh===!0&&nt.skeleton!==void 0){const it=j[nt.skeleton];it===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",nt.skeleton):nt.bind(it,nt.bindMatrix)}})}}const oP={UVMapping:Hl,CubeReflectionMapping:Ql,CubeRefractionMapping:Ml,EquirectangularReflectionMapping:Ll,EquirectangularRefractionMapping:_l,CubeUVReflectionMapping:Np},kC={RepeatWrapping:wm,ClampToEdgeWrapping:Tl,MirroredRepeatWrapping:tp},RT={NearestFilter:Yo,NearestMipmapNearestFilter:$p,NearestMipmapLinearFilter:n_,LinearFilter:Il,LinearMipmapNearestFilter:yp,LinearMipmapLinearFilter:Au};class w_ extends lv{constructor(a){super(a),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(a){return this.options=a,this}load(a,j,nt,it){a===void 0&&(a=""),this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const ot=this;fu.get(a,"blob").then(ht=>{if(ht!==void 0)return ot.manager.itemStart(a),void createImageBitmap(ht,Object.assign(ot.options,{colorSpaceConversion:"none"})).then(function(wt){j&&j(wt),ot.manager.itemEnd(a)}).catch(function(wt){it&&it(wt),ot.manager.itemError(a),ot.manager.itemEnd(a)});const ft={};ft.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",ft.headers=this.requestHeader,fetch(a,ft).then(function(wt){return wt.blob()}).then(function(wt){return fu.add(a,wt,"blob"),createImageBitmap(wt,Object.assign(ot.options,{colorSpaceConversion:"none"}))}).then(function(wt){j&&j(wt),ot.manager.itemEnd(a)}).catch(function(wt){it&&it(wt),ot.manager.itemError(a),ot.manager.itemEnd(a)}),ot.manager.itemStart(a)})}}let BC;class DT{static getContext(){return BC===void 0&&(BC=new(window.AudioContext||window.webkitAudioContext)),BC}static setContext(a){BC=a}}class aP extends lv{constructor(a){super(a)}load(a,j,nt,it){const ot=this,ht=new Wp(this.manager);function ft(wt){it?it(wt):console.error(wt),ot.manager.itemError(a)}ht.setResponseType("arraybuffer"),ht.setPath(this.path),ht.setRequestHeader(this.requestHeader),ht.setWithCredentials(this.withCredentials),ht.load(a,function(wt){try{const bt=wt.slice(0);DT.getContext().decodeAudioData(bt,function(St){j(St)},ft)}catch(bt){ft(bt)}},nt,it)}}class zv extends i0{constructor(a,j,nt=1){super(void 0,nt),this.isHemisphereLightProbe=!0;const it=new us().set(a),ot=new us().set(j),ht=new Rn(it.r,it.g,it.b),ft=new Rn(ot.r,ot.g,ot.b),wt=Math.sqrt(Math.PI),bt=wt*Math.sqrt(.75);this.sh.coefficients[0].copy(ht).add(ft).multiplyScalar(wt),this.sh.coefficients[1].copy(ht).sub(ft).multiplyScalar(bt)}}class kT extends i0{constructor(a,j=1){super(void 0,j),this.isAmbientLightProbe=!0;const nt=new us().set(a);this.sh.coefficients[0].set(nt.r,nt.g,nt.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const lP=new ro,cP=new ro,Ew=new ro;class _B{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Cp,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Cp,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(a){const j=this._cache;if(j.focus!==a.focus||j.fov!==a.fov||j.aspect!==a.aspect*this.aspect||j.near!==a.near||j.far!==a.far||j.zoom!==a.zoom||j.eyeSep!==this.eyeSep){j.focus=a.focus,j.fov=a.fov,j.aspect=a.aspect*this.aspect,j.near=a.near,j.far=a.far,j.zoom=a.zoom,j.eyeSep=this.eyeSep,Ew.copy(a.projectionMatrix);const nt=j.eyeSep/2,it=nt*j.near/j.focus,ot=j.near*Math.tan(a_*j.fov*.5)/j.zoom;let ht,ft;cP.elements[12]=-nt,lP.elements[12]=nt,ht=-ot*j.aspect+it,ft=ot*j.aspect+it,Ew.elements[0]=2*j.near/(ft-ht),Ew.elements[8]=(ft+ht)/(ft-ht),this.cameraL.projectionMatrix.copy(Ew),ht=-ot*j.aspect-it,ft=ot*j.aspect-it,Ew.elements[0]=2*j.near/(ft-ht),Ew.elements[8]=(ft+ht)/(ft-ht),this.cameraR.projectionMatrix.copy(Ew)}this.cameraL.matrixWorld.copy(a.matrixWorld).multiply(cP),this.cameraR.matrixWorld.copy(a.matrixWorld).multiply(lP)}}class Zx{constructor(a=!0){this.autoStart=a,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=qp(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let a=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const j=qp();a=(j-this.oldTime)/1e3,this.oldTime=j,this.elapsedTime+=a}return a}}function qp(){return(typeof performance>"u"?Date:performance).now()}const nA=new Rn,OC=new zp,Y0=new Rn,K0=new Rn;class BT extends Po{constructor(){super(),this.type="AudioListener",this.context=DT.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Zx}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(a){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=a,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(a){return this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01),this}updateMatrixWorld(a){super.updateMatrixWorld(a);const j=this.context.listener,nt=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(nA,OC,Y0),K0.set(0,0,-1).applyQuaternion(OC),j.positionX){const it=this.context.currentTime+this.timeDelta;j.positionX.linearRampToValueAtTime(nA.x,it),j.positionY.linearRampToValueAtTime(nA.y,it),j.positionZ.linearRampToValueAtTime(nA.z,it),j.forwardX.linearRampToValueAtTime(K0.x,it),j.forwardY.linearRampToValueAtTime(K0.y,it),j.forwardZ.linearRampToValueAtTime(K0.z,it),j.upX.linearRampToValueAtTime(nt.x,it),j.upY.linearRampToValueAtTime(nt.y,it),j.upZ.linearRampToValueAtTime(nt.z,it)}else j.setPosition(nA.x,nA.y,nA.z),j.setOrientation(K0.x,K0.y,K0.z,nt.x,nt.y,nt.z)}}class uP extends Po{constructor(a){super(),this.type="Audio",this.listener=a,this.context=a.context,this.gain=this.context.createGain(),this.gain.connect(a.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(a){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=a,this.connect(),this}setMediaElementSource(a){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(a),this.connect(),this}setMediaStreamSource(a){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(a),this.connect(),this}setBuffer(a){return this.buffer=a,this.sourceType="buffer",this.autoplay&&this.play(),this}play(a=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+a;const j=this.context.createBufferSource();return j.buffer=this.buffer,j.loop=this.loop,j.loopStart=this.loopStart,j.loopEnd=this.loopEnd,j.onended=this.onEnded.bind(this),j.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=j,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let a=1,j=this.filters.length;a<j;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let a=1,j=this.filters.length;a<j;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(a){return a||(a=[]),this._connected===!0?(this.disconnect(),this.filters=a.slice(),this.connect()):this.filters=a.slice(),this}setDetune(a){if(this.detune=a,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(a){return this.setFilters(a?[a]:[])}setPlaybackRate(a){if(this.hasPlaybackControl!==!1)return this.playbackRate=a,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(a){if(this.hasPlaybackControl!==!1)return this.loop=a,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(a){return this.loopStart=a,this}setLoopEnd(a){return this.loopEnd=a,this}getVolume(){return this.gain.gain.value}setVolume(a){return this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01),this}}const iA=new Rn,LC=new zp,OT=new Rn,J0=new Rn;class r0 extends uP{constructor(a){super(a),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(a){return this.panner.refDistance=a,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(a){return this.panner.rolloffFactor=a,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(a){return this.panner.distanceModel=a,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(a){return this.panner.maxDistance=a,this}setDirectionalCone(a,j,nt){return this.panner.coneInnerAngle=a,this.panner.coneOuterAngle=j,this.panner.coneOuterGain=nt,this}updateMatrixWorld(a){if(super.updateMatrixWorld(a),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(iA,LC,OT),J0.set(0,0,1).applyQuaternion(LC);const j=this.panner;if(j.positionX){const nt=this.context.currentTime+this.listener.timeDelta;j.positionX.linearRampToValueAtTime(iA.x,nt),j.positionY.linearRampToValueAtTime(iA.y,nt),j.positionZ.linearRampToValueAtTime(iA.z,nt),j.orientationX.linearRampToValueAtTime(J0.x,nt),j.orientationY.linearRampToValueAtTime(J0.y,nt),j.orientationZ.linearRampToValueAtTime(J0.z,nt)}else j.setPosition(iA.x,iA.y,iA.z),j.setOrientation(J0.x,J0.y,J0.z)}}class hP{constructor(a,j=2048){this.analyser=a.context.createAnalyser(),this.analyser.fftSize=j,this.data=new Uint8Array(this.analyser.frequencyBinCount),a.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let a=0;const j=this.getFrequencyData();for(let nt=0;nt<j.length;nt++)a+=j[nt];return a/j.length}}class NC{constructor(a,j,nt){let it,ot,ht;switch(this.binding=a,this.valueSize=nt,j){case"quaternion":it=this._slerp,ot=this._slerpAdditive,ht=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*nt),this._workIndex=5;break;case"string":case"bool":it=this._select,ot=this._select,ht=this._setAdditiveIdentityOther,this.buffer=new Array(5*nt);break;default:it=this._lerp,ot=this._lerpAdditive,ht=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*nt)}this._mixBufferRegion=it,this._mixBufferRegionAdditive=ot,this._setIdentity=ht,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(a,j){const nt=this.buffer,it=this.valueSize,ot=a*it+it;let ht=this.cumulativeWeight;if(ht===0){for(let ft=0;ft!==it;++ft)nt[ot+ft]=nt[ft];ht=j}else{ht+=j;const ft=j/ht;this._mixBufferRegion(nt,ot,0,ft,it)}this.cumulativeWeight=ht}accumulateAdditive(a){const j=this.buffer,nt=this.valueSize,it=nt*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(j,it,0,a,nt),this.cumulativeWeightAdditive+=a}apply(a){const j=this.valueSize,nt=this.buffer,it=a*j+j,ot=this.cumulativeWeight,ht=this.cumulativeWeightAdditive,ft=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,ot<1){const wt=j*this._origIndex;this._mixBufferRegion(nt,it,wt,1-ot,j)}ht>0&&this._mixBufferRegionAdditive(nt,it,this._addIndex*j,1,j);for(let wt=j,bt=j+j;wt!==bt;++wt)if(nt[wt]!==nt[wt+j]){ft.setValue(nt,it);break}}saveOriginalState(){const a=this.binding,j=this.buffer,nt=this.valueSize,it=nt*this._origIndex;a.getValue(j,it);for(let ot=nt,ht=it;ot!==ht;++ot)j[ot]=j[it+ot%nt];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const a=3*this.valueSize;this.binding.setValue(this.buffer,a)}_setAdditiveIdentityNumeric(){const a=this._addIndex*this.valueSize,j=a+this.valueSize;for(let nt=a;nt<j;nt++)this.buffer[nt]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const a=this._origIndex*this.valueSize,j=this._addIndex*this.valueSize;for(let nt=0;nt<this.valueSize;nt++)this.buffer[j+nt]=this.buffer[a+nt]}_select(a,j,nt,it,ot){if(it>=.5)for(let ht=0;ht!==ot;++ht)a[j+ht]=a[nt+ht]}_slerp(a,j,nt,it){zp.slerpFlat(a,j,a,j,a,nt,it)}_slerpAdditive(a,j,nt,it,ot){const ht=this._workIndex*ot;zp.multiplyQuaternionsFlat(a,ht,a,j,a,nt),zp.slerpFlat(a,j,a,j,a,ht,it)}_lerp(a,j,nt,it,ot){const ht=1-it;for(let ft=0;ft!==ot;++ft){const wt=j+ft;a[wt]=a[wt]*ht+a[nt+ft]*it}}_lerpAdditive(a,j,nt,it,ot){for(let ht=0;ht!==ot;++ht){const ft=j+ht;a[ft]=a[ft]+a[nt+ht]*it}}}const LT="\\[\\]\\.:\\/",NT=new RegExp("["+LT+"]","g"),rA="[^"+LT+"]",yB="[^"+LT.replace("\\.","")+"]",$0=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",rA)+/(WCOD+)?/.source.replace("WCOD",yB)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",rA)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",rA)+"$"),dP=["material","materials","bones","map"];class Fo{constructor(a,j,nt){this.path=j,this.parsedPath=nt||Fo.parseTrackName(j),this.node=Fo.findNode(a,this.parsedPath.nodeName),this.rootNode=a,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(a,j,nt){return a&&a.isAnimationObjectGroup?new Fo.Composite(a,j,nt):new Fo(a,j,nt)}static sanitizeNodeName(a){return a.replace(/\s/g,"_").replace(NT,"")}static parseTrackName(a){const j=$0.exec(a);if(j===null)throw new Error("PropertyBinding: Cannot parse trackName: "+a);const nt={nodeName:j[2],objectName:j[3],objectIndex:j[4],propertyName:j[5],propertyIndex:j[6]},it=nt.nodeName&&nt.nodeName.lastIndexOf(".");if(it!==void 0&&it!==-1){const ot=nt.nodeName.substring(it+1);dP.indexOf(ot)!==-1&&(nt.nodeName=nt.nodeName.substring(0,it),nt.objectName=ot)}if(nt.propertyName===null||nt.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+a);return nt}static findNode(a,j){if(j===void 0||j===""||j==="."||j===-1||j===a.name||j===a.uuid)return a;if(a.skeleton){const nt=a.skeleton.getBoneByName(j);if(nt!==void 0)return nt}if(a.children){const nt=function(ot){for(let ht=0;ht<ot.length;ht++){const ft=ot[ht];if(ft.name===j||ft.uuid===j)return ft;const wt=nt(ft.children);if(wt)return wt}return null},it=nt(a.children);if(it)return it}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(a,j){a[j]=this.targetObject[this.propertyName]}_getValue_array(a,j){const nt=this.resolvedProperty;for(let it=0,ot=nt.length;it!==ot;++it)a[j++]=nt[it]}_getValue_arrayElement(a,j){a[j]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(a,j){this.resolvedProperty.toArray(a,j)}_setValue_direct(a,j){this.targetObject[this.propertyName]=a[j]}_setValue_direct_setNeedsUpdate(a,j){this.targetObject[this.propertyName]=a[j],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(a,j){this.targetObject[this.propertyName]=a[j],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(a,j){const nt=this.resolvedProperty;for(let it=0,ot=nt.length;it!==ot;++it)nt[it]=a[j++]}_setValue_array_setNeedsUpdate(a,j){const nt=this.resolvedProperty;for(let it=0,ot=nt.length;it!==ot;++it)nt[it]=a[j++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(a,j){const nt=this.resolvedProperty;for(let it=0,ot=nt.length;it!==ot;++it)nt[it]=a[j++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(a,j){this.resolvedProperty[this.propertyIndex]=a[j]}_setValue_arrayElement_setNeedsUpdate(a,j){this.resolvedProperty[this.propertyIndex]=a[j],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(a,j){this.resolvedProperty[this.propertyIndex]=a[j],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(a,j){this.resolvedProperty.fromArray(a,j)}_setValue_fromArray_setNeedsUpdate(a,j){this.resolvedProperty.fromArray(a,j),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(a,j){this.resolvedProperty.fromArray(a,j),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(a,j){this.bind(),this.getValue(a,j)}_setValue_unbound(a,j){this.bind(),this.setValue(a,j)}bind(){let a=this.node;const j=this.parsedPath,nt=j.objectName,it=j.propertyName;let ot=j.propertyIndex;if(a||(a=Fo.findNode(this.rootNode,j.nodeName),this.node=a),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!a)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(nt){let bt=j.objectIndex;switch(nt){case"materials":if(!a.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!a.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);a=a.material.materials;break;case"bones":if(!a.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);a=a.skeleton.bones;for(let St=0;St<a.length;St++)if(a[St].name===bt){bt=St;break}break;case"map":if("map"in a){a=a.map;break}if(!a.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!a.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);a=a.material.map;break;default:if(a[nt]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);a=a[nt]}if(bt!==void 0){if(a[bt]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,a);a=a[bt]}}const ht=a[it];if(ht===void 0){const bt=j.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+bt+"."+it+" but it wasn't found.",a)}let ft=this.Versioning.None;this.targetObject=a,a.needsUpdate!==void 0?ft=this.Versioning.NeedsUpdate:a.matrixWorldNeedsUpdate!==void 0&&(ft=this.Versioning.MatrixWorldNeedsUpdate);let wt=this.BindingType.Direct;if(ot!==void 0){if(it==="morphTargetInfluences"){if(!a.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!a.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);a.morphTargetDictionary[ot]!==void 0&&(ot=a.morphTargetDictionary[ot])}wt=this.BindingType.ArrayElement,this.resolvedProperty=ht,this.propertyIndex=ot}else ht.fromArray!==void 0&&ht.toArray!==void 0?(wt=this.BindingType.HasFromToArray,this.resolvedProperty=ht):Array.isArray(ht)?(wt=this.BindingType.EntireArray,this.resolvedProperty=ht):this.propertyName=it;this.getValue=this.GetterByBindingType[wt],this.setValue=this.SetterByBindingTypeAndVersioning[wt][ft]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Fo.Composite=class{constructor(ut,a,j){const nt=j||Fo.parseTrackName(a);this._targetGroup=ut,this._bindings=ut.subscribe_(a,nt)}getValue(ut,a){this.bind();const j=this._targetGroup.nCachedObjects_,nt=this._bindings[j];nt!==void 0&&nt.getValue(ut,a)}setValue(ut,a){const j=this._bindings;for(let nt=this._targetGroup.nCachedObjects_,it=j.length;nt!==it;++nt)j[nt].setValue(ut,a)}bind(){const ut=this._bindings;for(let a=this._targetGroup.nCachedObjects_,j=ut.length;a!==j;++a)ut[a].bind()}unbind(){const ut=this._bindings;for(let a=this._targetGroup.nCachedObjects_,j=ut.length;a!==j;++a)ut[a].unbind()}},Fo.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Fo.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Fo.prototype.GetterByBindingType=[Fo.prototype._getValue_direct,Fo.prototype._getValue_array,Fo.prototype._getValue_arrayElement,Fo.prototype._getValue_toArray],Fo.prototype.SetterByBindingTypeAndVersioning=[[Fo.prototype._setValue_direct,Fo.prototype._setValue_direct_setNeedsUpdate,Fo.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Fo.prototype._setValue_array,Fo.prototype._setValue_array_setNeedsUpdate,Fo.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Fo.prototype._setValue_arrayElement,Fo.prototype._setValue_arrayElement_setNeedsUpdate,Fo.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Fo.prototype._setValue_fromArray,Fo.prototype._setValue_fromArray_setNeedsUpdate,Fo.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AB{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Fp(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const a={};this._indicesByUUID=a;for(let nt=0,it=arguments.length;nt!==it;++nt)a[arguments[nt].uuid]=nt;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const j=this;this.stats={objects:{get total(){return j._objects.length},get inUse(){return this.total-j.nCachedObjects_}},get bindingsPerObject(){return j._bindings.length}}}add(){const a=this._objects,j=this._indicesByUUID,nt=this._paths,it=this._parsedPaths,ot=this._bindings,ht=ot.length;let ft,wt=a.length,bt=this.nCachedObjects_;for(let St=0,Dt=arguments.length;St!==Dt;++St){const Rt=arguments[St],kt=Rt.uuid;let Ot=j[kt];if(Ot===void 0){Ot=wt++,j[kt]=Ot,a.push(Rt);for(let Gt=0,Nt=ht;Gt!==Nt;++Gt)ot[Gt].push(new Fo(Rt,nt[Gt],it[Gt]))}else if(Ot<bt){ft=a[Ot];const Gt=--bt,Nt=a[Gt];j[Nt.uuid]=Ot,a[Ot]=Nt,j[kt]=Gt,a[Gt]=Rt;for(let zt=0,qt=ht;zt!==qt;++zt){const $t=ot[zt],En=$t[Gt];let gn=$t[Ot];$t[Ot]=En,gn===void 0&&(gn=new Fo(Rt,nt[zt],it[zt])),$t[Gt]=gn}}else a[Ot]!==ft&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=bt}remove(){const a=this._objects,j=this._indicesByUUID,nt=this._bindings,it=nt.length;let ot=this.nCachedObjects_;for(let ht=0,ft=arguments.length;ht!==ft;++ht){const wt=arguments[ht],bt=wt.uuid,St=j[bt];if(St!==void 0&&St>=ot){const Dt=ot++,Rt=a[Dt];j[Rt.uuid]=St,a[St]=Rt,j[bt]=Dt,a[Dt]=wt;for(let kt=0,Ot=it;kt!==Ot;++kt){const Gt=nt[kt],Nt=Gt[Dt],zt=Gt[St];Gt[St]=Nt,Gt[Dt]=zt}}}this.nCachedObjects_=ot}uncache(){const a=this._objects,j=this._indicesByUUID,nt=this._bindings,it=nt.length;let ot=this.nCachedObjects_,ht=a.length;for(let ft=0,wt=arguments.length;ft!==wt;++ft){const bt=arguments[ft].uuid,St=j[bt];if(St!==void 0)if(delete j[bt],St<ot){const Dt=--ot,Rt=a[Dt],kt=--ht,Ot=a[kt];j[Rt.uuid]=St,a[St]=Rt,j[Ot.uuid]=Dt,a[Dt]=Ot,a.pop();for(let Gt=0,Nt=it;Gt!==Nt;++Gt){const zt=nt[Gt],qt=zt[Dt],$t=zt[kt];zt[St]=qt,zt[Dt]=$t,zt.pop()}}else{const Dt=--ht,Rt=a[Dt];Dt>0&&(j[Rt.uuid]=St),a[St]=Rt,a.pop();for(let kt=0,Ot=it;kt!==Ot;++kt){const Gt=nt[kt];Gt[St]=Gt[Dt],Gt.pop()}}}this.nCachedObjects_=ot}subscribe_(a,j){const nt=this._bindingsIndicesByPath;let it=nt[a];const ot=this._bindings;if(it!==void 0)return ot[it];const ht=this._paths,ft=this._parsedPaths,wt=this._objects,bt=wt.length,St=this.nCachedObjects_,Dt=new Array(bt);it=ot.length,nt[a]=it,ht.push(a),ft.push(j),ot.push(Dt);for(let Rt=St,kt=wt.length;Rt!==kt;++Rt){const Ot=wt[Rt];Dt[Rt]=new Fo(Ot,a,j)}return Dt}unsubscribe_(a){const j=this._bindingsIndicesByPath,nt=j[a];if(nt!==void 0){const it=this._paths,ot=this._parsedPaths,ht=this._bindings,ft=ht.length-1,wt=ht[ft];j[a[ft]]=nt,ht[nt]=wt,ht.pop(),ot[nt]=ot[ft],ot.pop(),it[nt]=it[ft],it.pop()}}}class pP{constructor(a,j,nt=null,it=j.blendMode){this._mixer=a,this._clip=j,this._localRoot=nt,this.blendMode=it;const ot=j.tracks,ht=ot.length,ft=new Array(ht),wt={endingStart:N_,endingEnd:N_};for(let bt=0;bt!==ht;++bt){const St=ot[bt].createInterpolant(null);ft[bt]=St,St.settings=wt}this._interpolantSettings=wt,this._interpolants=ft,this._propertyBindings=new Array(ht),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=bv,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(a){return this._startTime=a,this}setLoop(a,j){return this.loop=a,this.repetitions=j,this}setEffectiveWeight(a){return this.weight=a,this._effectiveWeight=this.enabled?a:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(a){return this._scheduleFading(a,0,1)}fadeOut(a){return this._scheduleFading(a,1,0)}crossFadeFrom(a,j,nt){if(a.fadeOut(j),this.fadeIn(j),nt){const it=this._clip.duration,ot=a._clip.duration,ht=ot/it,ft=it/ot;a.warp(1,ht,j),this.warp(ft,1,j)}return this}crossFadeTo(a,j,nt){return a.crossFadeFrom(this,j,nt)}stopFading(){const a=this._weightInterpolant;return a!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this}setEffectiveTimeScale(a){return this.timeScale=a,this._effectiveTimeScale=this.paused?0:a,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(a){return this.timeScale=this._clip.duration/a,this.stopWarping()}syncWith(a){return this.time=a.time,this.timeScale=a.timeScale,this.stopWarping()}halt(a){return this.warp(this._effectiveTimeScale,0,a)}warp(a,j,nt){const it=this._mixer,ot=it.time,ht=this.timeScale;let ft=this._timeScaleInterpolant;ft===null&&(ft=it._lendControlInterpolant(),this._timeScaleInterpolant=ft);const wt=ft.parameterPositions,bt=ft.sampleValues;return wt[0]=ot,wt[1]=ot+nt,bt[0]=a/ht,bt[1]=j/ht,this}stopWarping(){const a=this._timeScaleInterpolant;return a!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(a,j,nt,it){if(!this.enabled)return void this._updateWeight(a);const ot=this._startTime;if(ot!==null){const wt=(a-ot)*nt;wt<0||nt===0?j=0:(this._startTime=null,j=nt*wt)}j*=this._updateTimeScale(a);const ht=this._updateTime(j),ft=this._updateWeight(a);if(ft>0){const wt=this._interpolants,bt=this._propertyBindings;if(this.blendMode===Lo)for(let St=0,Dt=wt.length;St!==Dt;++St)wt[St].evaluate(ht),bt[St].accumulateAdditive(ft);else for(let St=0,Dt=wt.length;St!==Dt;++St)wt[St].evaluate(ht),bt[St].accumulate(it,ft)}}_updateWeight(a){let j=0;if(this.enabled){j=this.weight;const nt=this._weightInterpolant;if(nt!==null){const it=nt.evaluate(a)[0];j*=it,a>nt.parameterPositions[1]&&(this.stopFading(),it===0&&(this.enabled=!1))}}return this._effectiveWeight=j,j}_updateTimeScale(a){let j=0;if(!this.paused){j=this.timeScale;const nt=this._timeScaleInterpolant;nt!==null&&(j*=nt.evaluate(a)[0],a>nt.parameterPositions[1]&&(this.stopWarping(),j===0?this.paused=!0:this.timeScale=j))}return this._effectiveTimeScale=j,j}_updateTime(a){const j=this._clip.duration,nt=this.loop;let it=this.time+a,ot=this._loopCount;const ht=nt===tm;if(a===0)return ot===-1?it:ht&&(1&ot)==1?j-it:it;if(nt===yy){ot===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(it>=j)it=j;else{if(!(it<0)){this.time=it;break e}it=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=it,this._mixer.dispatchEvent({type:"finished",action:this,direction:a<0?-1:1})}}else{if(ot===-1&&(a>=0?(ot=0,this._setEndings(!0,this.repetitions===0,ht)):this._setEndings(this.repetitions===0,!0,ht)),it>=j||it<0){const ft=Math.floor(it/j);it-=j*ft,ot+=Math.abs(ft);const wt=this.repetitions-ot;if(wt<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,it=a>0?j:0,this.time=it,this._mixer.dispatchEvent({type:"finished",action:this,direction:a>0?1:-1});else{if(wt===1){const bt=a<0;this._setEndings(bt,!bt,ht)}else this._setEndings(!1,!1,ht);this._loopCount=ot,this.time=it,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:ft})}}else this.time=it;if(ht&&(1&ot)==1)return j-it}return it}_setEndings(a,j,nt){const it=this._interpolantSettings;nt?(it.endingStart=o_,it.endingEnd=o_):(it.endingStart=a?this.zeroSlopeAtStart?o_:N_:Ay,it.endingEnd=j?this.zeroSlopeAtEnd?o_:N_:Ay)}_scheduleFading(a,j,nt){const it=this._mixer,ot=it.time;let ht=this._weightInterpolant;ht===null&&(ht=it._lendControlInterpolant(),this._weightInterpolant=ht);const ft=ht.parameterPositions,wt=ht.sampleValues;return ft[0]=ot,wt[0]=j,ft[1]=ot+a,wt[1]=nt,this}}const bB=new Float32Array(1);class wB extends $m{constructor(a){super(),this._root=a,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(a,j){const nt=a._localRoot||this._root,it=a._clip.tracks,ot=it.length,ht=a._propertyBindings,ft=a._interpolants,wt=nt.uuid,bt=this._bindingsByRootAndName;let St=bt[wt];St===void 0&&(St={},bt[wt]=St);for(let Dt=0;Dt!==ot;++Dt){const Rt=it[Dt],kt=Rt.name;let Ot=St[kt];if(Ot!==void 0)++Ot.referenceCount,ht[Dt]=Ot;else{if(Ot=ht[Dt],Ot!==void 0){Ot._cacheIndex===null&&(++Ot.referenceCount,this._addInactiveBinding(Ot,wt,kt));continue}const Gt=j&&j._propertyBindings[Dt].binding.parsedPath;Ot=new NC(Fo.create(nt,kt,Gt),Rt.ValueTypeName,Rt.getValueSize()),++Ot.referenceCount,this._addInactiveBinding(Ot,wt,kt),ht[Dt]=Ot}ft[Dt].resultBuffer=Ot.buffer}}_activateAction(a){if(!this._isActiveAction(a)){if(a._cacheIndex===null){const nt=(a._localRoot||this._root).uuid,it=a._clip.uuid,ot=this._actionsByClip[it];this._bindAction(a,ot&&ot.knownActions[0]),this._addInactiveAction(a,it,nt)}const j=a._propertyBindings;for(let nt=0,it=j.length;nt!==it;++nt){const ot=j[nt];ot.useCount++==0&&(this._lendBinding(ot),ot.saveOriginalState())}this._lendAction(a)}}_deactivateAction(a){if(this._isActiveAction(a)){const j=a._propertyBindings;for(let nt=0,it=j.length;nt!==it;++nt){const ot=j[nt];--ot.useCount==0&&(ot.restoreOriginalState(),this._takeBackBinding(ot))}this._takeBackAction(a)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}}_isActiveAction(a){const j=a._cacheIndex;return j!==null&&j<this._nActiveActions}_addInactiveAction(a,j,nt){const it=this._actions,ot=this._actionsByClip;let ht=ot[j];if(ht===void 0)ht={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,ot[j]=ht;else{const ft=ht.knownActions;a._byClipCacheIndex=ft.length,ft.push(a)}a._cacheIndex=it.length,it.push(a),ht.actionByRoot[nt]=a}_removeInactiveAction(a){const j=this._actions,nt=j[j.length-1],it=a._cacheIndex;nt._cacheIndex=it,j[it]=nt,j.pop(),a._cacheIndex=null;const ot=a._clip.uuid,ht=this._actionsByClip,ft=ht[ot],wt=ft.knownActions,bt=wt[wt.length-1],St=a._byClipCacheIndex;bt._byClipCacheIndex=St,wt[St]=bt,wt.pop(),a._byClipCacheIndex=null,delete ft.actionByRoot[(a._localRoot||this._root).uuid],wt.length===0&&delete ht[ot],this._removeInactiveBindingsForAction(a)}_removeInactiveBindingsForAction(a){const j=a._propertyBindings;for(let nt=0,it=j.length;nt!==it;++nt){const ot=j[nt];--ot.referenceCount==0&&this._removeInactiveBinding(ot)}}_lendAction(a){const j=this._actions,nt=a._cacheIndex,it=this._nActiveActions++,ot=j[it];a._cacheIndex=it,j[it]=a,ot._cacheIndex=nt,j[nt]=ot}_takeBackAction(a){const j=this._actions,nt=a._cacheIndex,it=--this._nActiveActions,ot=j[it];a._cacheIndex=it,j[it]=a,ot._cacheIndex=nt,j[nt]=ot}_addInactiveBinding(a,j,nt){const it=this._bindingsByRootAndName,ot=this._bindings;let ht=it[j];ht===void 0&&(ht={},it[j]=ht),ht[nt]=a,a._cacheIndex=ot.length,ot.push(a)}_removeInactiveBinding(a){const j=this._bindings,nt=a.binding,it=nt.rootNode.uuid,ot=nt.path,ht=this._bindingsByRootAndName,ft=ht[it],wt=j[j.length-1],bt=a._cacheIndex;wt._cacheIndex=bt,j[bt]=wt,j.pop(),delete ft[ot],Object.keys(ft).length===0&&delete ht[it]}_lendBinding(a){const j=this._bindings,nt=a._cacheIndex,it=this._nActiveBindings++,ot=j[it];a._cacheIndex=it,j[it]=a,ot._cacheIndex=nt,j[nt]=ot}_takeBackBinding(a){const j=this._bindings,nt=a._cacheIndex,it=--this._nActiveBindings,ot=j[it];a._cacheIndex=it,j[it]=a,ot._cacheIndex=nt,j[nt]=ot}_lendControlInterpolant(){const a=this._controlInterpolants,j=this._nActiveControlInterpolants++;let nt=a[j];return nt===void 0&&(nt=new dp(new Float32Array(2),new Float32Array(2),1,bB),nt.__cacheIndex=j,a[j]=nt),nt}_takeBackControlInterpolant(a){const j=this._controlInterpolants,nt=a.__cacheIndex,it=--this._nActiveControlInterpolants,ot=j[it];a.__cacheIndex=it,j[it]=a,ot.__cacheIndex=nt,j[nt]=ot}clipAction(a,j,nt){const it=j||this._root,ot=it.uuid;let ht=typeof a=="string"?q0.findByName(it,a):a;const ft=ht!==null?ht.uuid:a,wt=this._actionsByClip[ft];let bt=null;if(nt===void 0&&(nt=ht!==null?ht.blendMode:lx),wt!==void 0){const Dt=wt.actionByRoot[ot];if(Dt!==void 0&&Dt.blendMode===nt)return Dt;bt=wt.knownActions[0],ht===null&&(ht=bt._clip)}if(ht===null)return null;const St=new pP(this,ht,j,nt);return this._bindAction(St,bt),this._addInactiveAction(St,ft,ot),St}existingAction(a,j){const nt=j||this._root,it=nt.uuid,ot=typeof a=="string"?q0.findByName(nt,a):a,ht=ot?ot.uuid:a,ft=this._actionsByClip[ht];return ft!==void 0&&ft.actionByRoot[it]||null}stopAllAction(){const a=this._actions;for(let j=this._nActiveActions-1;j>=0;--j)a[j].stop();return this}update(a){a*=this.timeScale;const j=this._actions,nt=this._nActiveActions,it=this.time+=a,ot=Math.sign(a),ht=this._accuIndex^=1;for(let bt=0;bt!==nt;++bt)j[bt]._update(it,a,ot,ht);const ft=this._bindings,wt=this._nActiveBindings;for(let bt=0;bt!==wt;++bt)ft[bt].apply(ht);return this}setTime(a){this.time=0;for(let j=0;j<this._actions.length;j++)this._actions[j].time=0;return this.update(a)}getRoot(){return this._root}uncacheClip(a){const j=this._actions,nt=a.uuid,it=this._actionsByClip,ot=it[nt];if(ot!==void 0){const ht=ot.knownActions;for(let ft=0,wt=ht.length;ft!==wt;++ft){const bt=ht[ft];this._deactivateAction(bt);const St=bt._cacheIndex,Dt=j[j.length-1];bt._cacheIndex=null,bt._byClipCacheIndex=null,Dt._cacheIndex=St,j[St]=Dt,j.pop(),this._removeInactiveBindingsForAction(bt)}delete it[nt]}}uncacheRoot(a){const j=a.uuid,nt=this._actionsByClip;for(const ot in nt){const ht=nt[ot].actionByRoot[j];ht!==void 0&&(this._deactivateAction(ht),this._removeInactiveAction(ht))}const it=this._bindingsByRootAndName[j];if(it!==void 0)for(const ot in it){const ht=it[ot];ht.restoreOriginalState(),this._removeInactiveBinding(ht)}}uncacheAction(a,j){const nt=this.existingAction(a,j);nt!==null&&(this._deactivateAction(nt),this._removeInactiveAction(nt))}}class UC{constructor(a){this.value=a}clone(){return new UC(this.value.clone===void 0?this.value:this.value.clone())}}let fP=0;class UT extends $m{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:fP++}),this.name="",this.usage=Jm,this.uniforms=[]}add(a){return this.uniforms.push(a),this}remove(a){const j=this.uniforms.indexOf(a);return j!==-1&&this.uniforms.splice(j,1),this}setName(a){return this.name=a,this}setUsage(a){return this.usage=a,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(a){this.name=a.name,this.usage=a.usage;const j=a.uniforms;this.uniforms.length=0;for(let nt=0,it=j.length;nt<it;nt++)this.uniforms.push(j[nt].clone());return this}clone(){return new this.constructor().copy(this)}}class mP extends Hp{constructor(a,j,nt=1){super(a,j),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=nt}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}clone(a){const j=super.clone(a);return j.meshPerAttribute=this.meshPerAttribute,j}toJSON(a){const j=super.toJSON(a);return j.isInstancedInterleavedBuffer=!0,j.meshPerAttribute=this.meshPerAttribute,j}}class gP{constructor(a,j,nt,it,ot){this.isGLBufferAttribute=!0,this.name="",this.buffer=a,this.type=j,this.itemSize=nt,this.elementSize=it,this.count=ot,this.version=0}set needsUpdate(a){a===!0&&this.version++}setBuffer(a){return this.buffer=a,this}setType(a,j){return this.type=a,this.elementSize=j,this}setItemSize(a){return this.itemSize=a,this}setCount(a){return this.count=a,this}}class Vv{constructor(a,j,nt=0,it=1/0){this.ray=new C0(a,j),this.near=nt,this.far=it,this.camera=null,this.layers=new T0,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(a,j){this.ray.set(a,j)}setFromCamera(a,j){j.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(j.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(j).sub(this.ray.origin).normalize(),this.camera=j):j.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(j.near+j.far)/(j.near-j.far)).unproject(j),this.ray.direction.set(0,0,-1).transformDirection(j.matrixWorld),this.camera=j):console.error("THREE.Raycaster: Unsupported camera type: "+j.type)}intersectObject(a,j=!0,nt=[]){return FT(a,this,nt,j),nt.sort(CE),nt}intersectObjects(a,j=!0,nt=[]){for(let it=0,ot=a.length;it<ot;it++)FT(a[it],this,nt,j);return nt.sort(CE),nt}}function CE(ut,a){return ut.distance-a.distance}function FT(ut,a,j,nt){if(ut.layers.test(a.layers)&&ut.raycast(a,j),nt===!0){const it=ut.children;for(let ot=0,ht=it.length;ot<ht;ot++)FT(it[ot],a,j,!0)}}class vP{constructor(a=1,j=0,nt=0){return this.radius=a,this.phi=j,this.theta=nt,this}set(a,j,nt){return this.radius=a,this.phi=j,this.theta=nt,this}copy(a){return this.radius=a.radius,this.phi=a.phi,this.theta=a.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(a){return this.setFromCartesianCoords(a.x,a.y,a.z)}setFromCartesianCoords(a,j,nt){return this.radius=Math.sqrt(a*a+j*j+nt*nt),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(a,nt),this.phi=Math.acos(Is(j/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class jT{constructor(a=1,j=0,nt=0){return this.radius=a,this.theta=j,this.y=nt,this}set(a,j,nt){return this.radius=a,this.theta=j,this.y=nt,this}copy(a){return this.radius=a.radius,this.theta=a.theta,this.y=a.y,this}setFromVector3(a){return this.setFromCartesianCoords(a.x,a.y,a.z)}setFromCartesianCoords(a,j,nt){return this.radius=Math.sqrt(a*a+nt*nt),this.theta=Math.atan2(a,nt),this.y=j,this}clone(){return new this.constructor().copy(this)}}const zT=new Br;class pm{constructor(a=new Br(1/0,1/0),j=new Br(-1/0,-1/0)){this.isBox2=!0,this.min=a,this.max=j}set(a,j){return this.min.copy(a),this.max.copy(j),this}setFromPoints(a){this.makeEmpty();for(let j=0,nt=a.length;j<nt;j++)this.expandByPoint(a[j]);return this}setFromCenterAndSize(a,j){const nt=zT.copy(j).multiplyScalar(.5);return this.min.copy(a).sub(nt),this.max.copy(a).add(nt),this}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(a){return this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}containsPoint(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y)}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y}getParameter(a,j){return j.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y)}clampPoint(a,j){return j.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,zT).distanceTo(a)}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}const Xp=new Rn,sA=new Rn;class FC{constructor(a=new Rn,j=new Rn){this.start=a,this.end=j}set(a,j){return this.start.copy(a),this.end.copy(j),this}copy(a){return this.start.copy(a.start),this.end.copy(a.end),this}getCenter(a){return a.addVectors(this.start,this.end).multiplyScalar(.5)}delta(a){return a.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(a,j){return this.delta(j).multiplyScalar(a).add(this.start)}closestPointToPointParameter(a,j){Xp.subVectors(a,this.start),sA.subVectors(this.end,this.start);const nt=sA.dot(sA);let it=sA.dot(Xp)/nt;return j&&(it=Is(it,0,1)),it}closestPointToPoint(a,j,nt){const it=this.closestPointToPointParameter(a,j);return this.delta(nt).multiplyScalar(it).add(this.start)}applyMatrix4(a){return this.start.applyMatrix4(a),this.end.applyMatrix4(a),this}equals(a){return a.start.equals(this.start)&&a.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const ME=new Rn;class VT extends Po{constructor(a,j){super(),this.light=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=j,this.type="SpotLightHelper";const nt=new Vt,it=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let ht=0,ft=1,wt=32;ht<wt;ht++,ft++){const bt=ht/wt*Math.PI*2,St=ft/wt*Math.PI*2;it.push(Math.cos(bt),Math.sin(bt),1,Math.cos(St),Math.sin(St),1)}nt.setAttribute("position",new fs(it,3));const ot=new lm({fog:!1,toneMapped:!1});this.cone=new Nv(nt,ot),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const a=this.light.distance?this.light.distance:1e3,j=a*Math.tan(this.light.angle);this.cone.scale.set(j,j,a),ME.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ME),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Z0=new Rn,TE=new ro,jC=new ro;class GT extends Nv{constructor(a){const j=HT(a),nt=new Vt,it=[],ot=[],ht=new us(0,0,1),ft=new us(0,1,0);for(let wt=0;wt<j.length;wt++){const bt=j[wt];bt.parent&&bt.parent.isBone&&(it.push(0,0,0),it.push(0,0,0),ot.push(ht.r,ht.g,ht.b),ot.push(ft.r,ft.g,ft.b))}nt.setAttribute("position",new fs(it,3)),nt.setAttribute("color",new fs(ot,3)),super(nt,new lm({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=a,this.bones=j,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(a){const j=this.bones,nt=this.geometry,it=nt.getAttribute("position");jC.copy(this.root.matrixWorld).invert();for(let ot=0,ht=0;ot<j.length;ot++){const ft=j[ot];ft.parent&&ft.parent.isBone&&(TE.multiplyMatrices(jC,ft.matrixWorld),Z0.setFromMatrixPosition(TE),it.setXYZ(ht,Z0.x,Z0.y,Z0.z),TE.multiplyMatrices(jC,ft.parent.matrixWorld),Z0.setFromMatrixPosition(TE),it.setXYZ(ht+1,Z0.x,Z0.y,Z0.z),ht+=2)}nt.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(a)}dispose(){this.geometry.dispose(),this.material.dispose()}}function HT(ut){const a=[];ut.isBone===!0&&a.push(ut);for(let j=0;j<ut.children.length;j++)a.push.apply(a,HT(ut.children[j]));return a}class xB extends Ou{constructor(a,j,nt){super(new bw(j,4,2),new Bm({wireframe:!0,fog:!1,toneMapped:!1})),this.light=a,this.color=nt,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _P=new Rn,zC=new us,Rl=new us;class Sw extends Po{constructor(a,j,nt){super(),this.light=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=nt,this.type="HemisphereLightHelper";const it=new Vx(j);it.rotateY(.5*Math.PI),this.material=new Bm({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const ot=it.getAttribute("position"),ht=new Float32Array(3*ot.count);it.setAttribute("color",new Jo(ht,3)),this.add(new Ou(it,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const a=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const j=a.geometry.getAttribute("color");zC.copy(this.light.color),Rl.copy(this.light.groundColor);for(let nt=0,it=j.count;nt<it;nt++){const ot=nt<it/2?zC:Rl;j.setXYZ(nt,ot.r,ot.g,ot.b)}j.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),a.lookAt(_P.setFromMatrixPosition(this.light.matrixWorld).negate())}}class s0 extends Nv{constructor(a=10,j=10,nt=4473924,it=8947848){nt=new us(nt),it=new us(it);const ot=j/2,ht=a/j,ft=a/2,wt=[],bt=[];for(let Dt=0,Rt=0,kt=-ft;Dt<=j;Dt++,kt+=ht){wt.push(-ft,0,kt,ft,0,kt),wt.push(kt,0,-ft,kt,0,ft);const Ot=Dt===ot?nt:it;Ot.toArray(bt,Rt),Rt+=3,Ot.toArray(bt,Rt),Rt+=3,Ot.toArray(bt,Rt),Rt+=3,Ot.toArray(bt,Rt),Rt+=3}const St=new Vt;St.setAttribute("position",new fs(wt,3)),St.setAttribute("color",new fs(bt,3)),super(St,new lm({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class oA extends Nv{constructor(a=10,j=16,nt=8,it=64,ot=4473924,ht=8947848){ot=new us(ot),ht=new us(ht);const ft=[],wt=[];if(j>1)for(let St=0;St<j;St++){const Dt=St/j*(2*Math.PI),Rt=Math.sin(Dt)*a,kt=Math.cos(Dt)*a;ft.push(0,0,0),ft.push(Rt,0,kt);const Ot=1&St?ot:ht;wt.push(Ot.r,Ot.g,Ot.b),wt.push(Ot.r,Ot.g,Ot.b)}for(let St=0;St<nt;St++){const Dt=1&St?ot:ht,Rt=a-a/nt*St;for(let kt=0;kt<it;kt++){let Ot=kt/it*(2*Math.PI),Gt=Math.sin(Ot)*Rt,Nt=Math.cos(Ot)*Rt;ft.push(Gt,0,Nt),wt.push(Dt.r,Dt.g,Dt.b),Ot=(kt+1)/it*(2*Math.PI),Gt=Math.sin(Ot)*Rt,Nt=Math.cos(Ot)*Rt,ft.push(Gt,0,Nt),wt.push(Dt.r,Dt.g,Dt.b)}}const bt=new Vt;bt.setAttribute("position",new fs(ft,3)),bt.setAttribute("color",new fs(wt,3)),super(bt,new lm({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const e1=new Rn,VC=new Rn,yP=new Rn;class EB extends Po{constructor(a,j,nt){super(),this.light=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=nt,this.type="DirectionalLightHelper",j===void 0&&(j=1);let it=new Vt;it.setAttribute("position",new fs([-j,j,0,j,j,0,j,-j,0,-j,-j,0,-j,j,0],3));const ot=new lm({fog:!1,toneMapped:!1});this.lightPlane=new Uo(it,ot),this.add(this.lightPlane),it=new Vt,it.setAttribute("position",new fs([0,0,0,0,0,1],3)),this.targetLine=new Uo(it,ot),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),e1.setFromMatrixPosition(this.light.matrixWorld),VC.setFromMatrixPosition(this.light.target.matrixWorld),yP.subVectors(VC,e1),this.lightPlane.lookAt(VC),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(VC),this.targetLine.scale.z=yP.length()}}const GC=new Rn,Yl=new FS;class x_ extends Nv{constructor(a){const j=new Vt,nt=new lm({color:16777215,vertexColors:!0,toneMapped:!1}),it=[],ot=[],ht={};function ft(Ot,Gt){wt(Ot),wt(Gt)}function wt(Ot){it.push(0,0,0),ot.push(0,0,0),ht[Ot]===void 0&&(ht[Ot]=[]),ht[Ot].push(it.length/3-1)}ft("n1","n2"),ft("n2","n4"),ft("n4","n3"),ft("n3","n1"),ft("f1","f2"),ft("f2","f4"),ft("f4","f3"),ft("f3","f1"),ft("n1","f1"),ft("n2","f2"),ft("n3","f3"),ft("n4","f4"),ft("p","n1"),ft("p","n2"),ft("p","n3"),ft("p","n4"),ft("u1","u2"),ft("u2","u3"),ft("u3","u1"),ft("c","t"),ft("p","c"),ft("cn1","cn2"),ft("cn3","cn4"),ft("cf1","cf2"),ft("cf3","cf4"),j.setAttribute("position",new fs(it,3)),j.setAttribute("color",new fs(ot,3)),super(j,nt),this.type="CameraHelper",this.camera=a,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=ht,this.update();const bt=new us(16755200),St=new us(16711680),Dt=new us(43775),Rt=new us(16777215),kt=new us(3355443);this.setColors(bt,St,Dt,Rt,kt)}setColors(a,j,nt,it,ot){const ht=this.geometry.getAttribute("color");ht.setXYZ(0,a.r,a.g,a.b),ht.setXYZ(1,a.r,a.g,a.b),ht.setXYZ(2,a.r,a.g,a.b),ht.setXYZ(3,a.r,a.g,a.b),ht.setXYZ(4,a.r,a.g,a.b),ht.setXYZ(5,a.r,a.g,a.b),ht.setXYZ(6,a.r,a.g,a.b),ht.setXYZ(7,a.r,a.g,a.b),ht.setXYZ(8,a.r,a.g,a.b),ht.setXYZ(9,a.r,a.g,a.b),ht.setXYZ(10,a.r,a.g,a.b),ht.setXYZ(11,a.r,a.g,a.b),ht.setXYZ(12,a.r,a.g,a.b),ht.setXYZ(13,a.r,a.g,a.b),ht.setXYZ(14,a.r,a.g,a.b),ht.setXYZ(15,a.r,a.g,a.b),ht.setXYZ(16,a.r,a.g,a.b),ht.setXYZ(17,a.r,a.g,a.b),ht.setXYZ(18,a.r,a.g,a.b),ht.setXYZ(19,a.r,a.g,a.b),ht.setXYZ(20,a.r,a.g,a.b),ht.setXYZ(21,a.r,a.g,a.b),ht.setXYZ(22,a.r,a.g,a.b),ht.setXYZ(23,a.r,a.g,a.b),ht.setXYZ(24,j.r,j.g,j.b),ht.setXYZ(25,j.r,j.g,j.b),ht.setXYZ(26,j.r,j.g,j.b),ht.setXYZ(27,j.r,j.g,j.b),ht.setXYZ(28,j.r,j.g,j.b),ht.setXYZ(29,j.r,j.g,j.b),ht.setXYZ(30,j.r,j.g,j.b),ht.setXYZ(31,j.r,j.g,j.b),ht.setXYZ(32,nt.r,nt.g,nt.b),ht.setXYZ(33,nt.r,nt.g,nt.b),ht.setXYZ(34,nt.r,nt.g,nt.b),ht.setXYZ(35,nt.r,nt.g,nt.b),ht.setXYZ(36,nt.r,nt.g,nt.b),ht.setXYZ(37,nt.r,nt.g,nt.b),ht.setXYZ(38,it.r,it.g,it.b),ht.setXYZ(39,it.r,it.g,it.b),ht.setXYZ(40,ot.r,ot.g,ot.b),ht.setXYZ(41,ot.r,ot.g,ot.b),ht.setXYZ(42,ot.r,ot.g,ot.b),ht.setXYZ(43,ot.r,ot.g,ot.b),ht.setXYZ(44,ot.r,ot.g,ot.b),ht.setXYZ(45,ot.r,ot.g,ot.b),ht.setXYZ(46,ot.r,ot.g,ot.b),ht.setXYZ(47,ot.r,ot.g,ot.b),ht.setXYZ(48,ot.r,ot.g,ot.b),ht.setXYZ(49,ot.r,ot.g,ot.b),ht.needsUpdate=!0}update(){const a=this.geometry,j=this.pointMap;Yl.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ou("c",j,a,Yl,0,0,-1),ou("t",j,a,Yl,0,0,1),ou("n1",j,a,Yl,-1,-1,-1),ou("n2",j,a,Yl,1,-1,-1),ou("n3",j,a,Yl,-1,1,-1),ou("n4",j,a,Yl,1,1,-1),ou("f1",j,a,Yl,-1,-1,1),ou("f2",j,a,Yl,1,-1,1),ou("f3",j,a,Yl,-1,1,1),ou("f4",j,a,Yl,1,1,1),ou("u1",j,a,Yl,.7,1.1,-1),ou("u2",j,a,Yl,-.7,1.1,-1),ou("u3",j,a,Yl,0,2,-1),ou("cf1",j,a,Yl,-1,0,1),ou("cf2",j,a,Yl,1,0,1),ou("cf3",j,a,Yl,0,-1,1),ou("cf4",j,a,Yl,0,1,1),ou("cn1",j,a,Yl,-1,0,-1),ou("cn2",j,a,Yl,1,0,-1),ou("cn3",j,a,Yl,0,-1,-1),ou("cn4",j,a,Yl,0,1,-1),a.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ou(ut,a,j,nt,it,ot,ht){GC.set(it,ot,ht).unproject(nt);const ft=a[ut];if(ft!==void 0){const wt=j.getAttribute("position");for(let bt=0,St=ft.length;bt<St;bt++)wt.setXYZ(ft[bt],GC.x,GC.y,GC.z)}}const t1=new Zm;class AP extends Nv{constructor(a,j=16776960){const nt=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),it=new Float32Array(24),ot=new Vt;ot.setIndex(new Jo(nt,1)),ot.setAttribute("position",new Jo(it,3)),super(ot,new lm({color:j,toneMapped:!1})),this.object=a,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(a){if(a!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&t1.setFromObject(this.object),t1.isEmpty())return;const j=t1.min,nt=t1.max,it=this.geometry.attributes.position,ot=it.array;ot[0]=nt.x,ot[1]=nt.y,ot[2]=nt.z,ot[3]=j.x,ot[4]=nt.y,ot[5]=nt.z,ot[6]=j.x,ot[7]=j.y,ot[8]=nt.z,ot[9]=nt.x,ot[10]=j.y,ot[11]=nt.z,ot[12]=nt.x,ot[13]=nt.y,ot[14]=j.z,ot[15]=j.x,ot[16]=nt.y,ot[17]=j.z,ot[18]=j.x,ot[19]=j.y,ot[20]=j.z,ot[21]=nt.x,ot[22]=j.y,ot[23]=j.z,it.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(a){return this.object=a,this.update(),this}copy(a,j){return super.copy(a,j),this.object=a.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class SB extends Nv{constructor(a,j=16776960){const nt=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),it=new Vt;it.setIndex(new Jo(nt,1)),it.setAttribute("position",new fs([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(it,new lm({color:j,toneMapped:!1})),this.box=a,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(a){const j=this.box;j.isEmpty()||(j.getCenter(this.position),j.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(a))}dispose(){this.geometry.dispose(),this.material.dispose()}}class ey extends Uo{constructor(a,j=1,nt=16776960){const it=nt,ot=new Vt;ot.setAttribute("position",new fs([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),ot.computeBoundingSphere(),super(ot,new lm({color:it,toneMapped:!1})),this.type="PlaneHelper",this.plane=a,this.size=j;const ht=new Vt;ht.setAttribute("position",new fs([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),ht.computeBoundingSphere(),this.add(new Ou(ht,new Bm({color:it,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(a){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(a)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const n1=new Rn;let i1,IE;class bP extends Po{constructor(a=new Rn(0,0,1),j=new Rn(0,0,0),nt=1,it=16776960,ot=.2*nt,ht=.2*ot){super(),this.type="ArrowHelper",i1===void 0&&(i1=new Vt,i1.setAttribute("position",new fs([0,0,0,0,1,0],3)),IE=new Yy(0,.5,1,5,1),IE.translate(0,-.5,0)),this.position.copy(j),this.line=new Uo(i1,new lm({color:it,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ou(IE,new Bm({color:it,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(a),this.setLength(nt,ot,ht)}setDirection(a){if(a.y>.99999)this.quaternion.set(0,0,0,1);else if(a.y<-.99999)this.quaternion.set(1,0,0,0);else{n1.set(a.z,0,-a.x).normalize();const j=Math.acos(a.y);this.quaternion.setFromAxisAngle(n1,j)}}setLength(a,j=.2*a,nt=.2*j){this.line.scale.set(1,Math.max(1e-4,a-j),1),this.line.updateMatrix(),this.cone.scale.set(nt,j,nt),this.cone.position.y=a,this.cone.updateMatrix()}setColor(a){this.line.material.color.set(a),this.cone.material.color.set(a)}copy(a){return super.copy(a,!1),this.line.copy(a.line),this.cone.copy(a.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class PE extends Nv{constructor(a=1){const j=[0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a],nt=new Vt;nt.setAttribute("position",new fs(j,3)),nt.setAttribute("color",new fs([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(nt,new lm({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(a,j,nt){const it=new us,ot=this.geometry.attributes.color.array;return it.set(a),it.toArray(ot,0),it.toArray(ot,3),it.set(j),it.toArray(ot,6),it.toArray(ot,9),it.set(nt),it.toArray(ot,12),it.toArray(ot,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class HC{constructor(){this.type="ShapePath",this.color=new us,this.subPaths=[],this.currentPath=null}moveTo(a,j){return this.currentPath=new Xy,this.subPaths.push(this.currentPath),this.currentPath.moveTo(a,j),this}lineTo(a,j){return this.currentPath.lineTo(a,j),this}quadraticCurveTo(a,j,nt,it){return this.currentPath.quadraticCurveTo(a,j,nt,it),this}bezierCurveTo(a,j,nt,it,ot,ht){return this.currentPath.bezierCurveTo(a,j,nt,it,ot,ht),this}splineThru(a){return this.currentPath.splineThru(a),this}toShapes(a){function j(Nt,zt){const qt=zt.length;let $t=!1;for(let En=qt-1,gn=0;gn<qt;En=gn++){let vn=zt[En],Un=zt[gn],$n=Un.x-vn.x,jn=Un.y-vn.y;if(Math.abs(jn)>Number.EPSILON){if(jn<0&&(vn=zt[gn],$n=-$n,Un=zt[En],jn=-jn),Nt.y<vn.y||Nt.y>Un.y)continue;if(Nt.y===vn.y){if(Nt.x===vn.x)return!0}else{const sr=jn*(Nt.x-vn.x)-$n*(Nt.y-vn.y);if(sr===0)return!0;if(sr<0)continue;$t=!$t}}else{if(Nt.y!==vn.y)continue;if(Un.x<=Nt.x&&Nt.x<=vn.x||vn.x<=Nt.x&&Nt.x<=Un.x)return!0}}return $t}const nt=__.isClockWise,it=this.subPaths;if(it.length===0)return[];let ot,ht,ft;const wt=[];if(it.length===1)return ht=it[0],ft=new Jy,ft.curves=ht.curves,wt.push(ft),wt;let bt=!nt(it[0].getPoints());bt=a?!bt:bt;const St=[],Dt=[];let Rt,kt,Ot=[],Gt=0;Dt[Gt]=void 0,Ot[Gt]=[];for(let Nt=0,zt=it.length;Nt<zt;Nt++)ht=it[Nt],Rt=ht.getPoints(),ot=nt(Rt),ot=a?!ot:ot,ot?(!bt&&Dt[Gt]&&Gt++,Dt[Gt]={s:new Jy,p:Rt},Dt[Gt].s.curves=ht.curves,bt&&Gt++,Ot[Gt]=[]):Ot[Gt].push({h:ht,p:Rt[0]});if(!Dt[0])return function(Nt){const zt=[];for(let qt=0,$t=Nt.length;qt<$t;qt++){const En=Nt[qt],gn=new Jy;gn.curves=En.curves,zt.push(gn)}return zt}(it);if(Dt.length>1){let Nt=!1,zt=0;for(let qt=0,$t=Dt.length;qt<$t;qt++)St[qt]=[];for(let qt=0,$t=Dt.length;qt<$t;qt++){const En=Ot[qt];for(let gn=0;gn<En.length;gn++){const vn=En[gn];let Un=!0;for(let $n=0;$n<Dt.length;$n++)j(vn.p,Dt[$n].p)&&(qt!==$n&&zt++,Un?(Un=!1,St[$n].push(vn)):Nt=!0);Un&&St[qt].push(vn)}}zt>0&&Nt===!1&&(Ot=St)}for(let Nt=0,zt=Dt.length;Nt<zt;Nt++){ft=Dt[Nt].s,wt.push(ft),kt=Ot[Nt];for(let qt=0,$t=kt.length;qt<$t;qt++)ft.holes.push(kt[qt].h)}return wt}}class wP extends kv{constructor(a,j,nt,it,ot,ht){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(a,j,nt,it,ot,ht)}}class CB extends mw{constructor(a,j,nt,it){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(a,j,nt,it)}}class QT extends G0{constructor(a,j,nt,it){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(a,j,nt,it)}}class MB extends H0{constructor(a,j,nt,it,ot,ht,ft){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(a,j,nt,it,ot,ht,ft)}}class TB extends Yy{constructor(a,j,nt,it,ot,ht,ft,wt){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(a,j,nt,it,ot,ht,ft,wt)}}class IB extends gw{constructor(a,j){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(a,j)}}class PB extends yw{constructor(a,j){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(a,j)}}class RB extends Aw{constructor(a,j){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(a,j)}}class RE extends fw{constructor(a,j,nt,it){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(a,j,nt,it)}}class DB extends Vx{constructor(a,j){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(a,j)}}class xP extends nv{constructor(a,j,nt,it){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(a,j,nt,it)}}class kB extends Fv{constructor(a,j,nt,it){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(a,j,nt,it)}}class BB extends W0{constructor(a,j,nt,it,ot,ht){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(a,j,nt,it,ot,ht)}}class So extends Gx{constructor(a,j){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(a,j)}}class gu extends bw{constructor(a,j,nt,it,ot,ht,ft){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(a,j,nt,it,ot,ht,ft)}}class fm extends Hx{constructor(a,j){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(a,j)}}class OB extends bE{constructor(a,j,nt,it,ot){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(a,j,nt,it,ot)}}class LB extends Qx{constructor(a,j,nt,it,ot,ht){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(a,j,nt,it,ot,ht)}}class NB extends ww{constructor(a,j,nt,it,ot){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(a,j,nt,it,ot)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:dt}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=dt)},553:function($,_e,_){_.d(_e,{_:function(){return Et}});var dt=_(988);const vt=new WeakMap;class Et extends dt.aNw{constructor(Ft){super(Ft),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(Ft){return this.decoderPath=Ft,this}setDecoderConfig(Ft){return this.decoderConfig=Ft,this}setWorkerLimit(Ft){return this.workerLimit=Ft,this}load(Ft,Yt,hn,_n){const pn=new dt.hH6(this.manager);pn.setPath(this.path),pn.setResponseType("arraybuffer"),pn.setRequestHeader(this.requestHeader),pn.setWithCredentials(this.withCredentials),pn.load(Ft,ln=>{this.parse(ln,Yt,_n)},hn,_n)}parse(Ft,Yt,hn){this.decodeDracoFile(Ft,Yt,null,null,dt.KI_).catch(hn)}decodeDracoFile(Ft,Yt,hn,_n,pn=dt.GUF){const ln={attributeIDs:hn||this.defaultAttributeIDs,attributeTypes:_n||this.defaultAttributeTypes,useUniqueIDs:!!hn,vertexColorSpace:pn};return this.decodeGeometry(Ft,ln).then(Yt)}decodeGeometry(Ft,Yt){const hn=JSON.stringify(Yt);if(vt.has(Ft)){const nn=vt.get(Ft);if(nn.key===hn)return nn.promise;if(Ft.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let _n;const pn=this.workerNextTaskID++,ln=Ft.byteLength,Pn=this._getWorker(pn,ln).then(nn=>(_n=nn,new Promise((Hn,tn)=>{_n._callbacks[pn]={resolve:Hn,reject:tn},_n.postMessage({type:"decode",id:pn,taskConfig:Yt,buffer:Ft},[Ft])}))).then(nn=>this._createGeometry(nn.geometry));return Pn.catch(()=>!0).then(()=>{_n&&pn&&this._releaseTask(_n,pn)}),vt.set(Ft,{key:hn,promise:Pn}),Pn}_createGeometry(Ft){const Yt=new dt.u9r;Ft.index&&Yt.setIndex(new dt.TlE(Ft.index.array,1));for(let hn=0;hn<Ft.attributes.length;hn++){const _n=Ft.attributes[hn],pn=_n.name,ln=_n.array,Pn=_n.itemSize,nn=new dt.TlE(ln,Pn);pn==="color"&&this._assignVertexColorSpace(nn,_n.vertexColorSpace),Yt.setAttribute(pn,nn)}return Yt}_assignVertexColorSpace(Ft,Yt){if(Yt!==dt.KI_)return;const hn=new dt.Ilk;for(let _n=0,pn=Ft.count;_n<pn;_n++)hn.fromBufferAttribute(Ft,_n).convertSRGBToLinear(),Ft.setXYZ(_n,hn.r,hn.g,hn.b)}_loadLibrary(Ft,Yt){const hn=new dt.hH6(this.manager);return hn.setPath(this.decoderPath),hn.setResponseType(Yt),hn.setWithCredentials(this.withCredentials),new Promise((_n,pn)=>{hn.load(Ft,_n,void 0,pn)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const Ft=typeof WebAssembly!="object"||this.decoderConfig.type==="js",Yt=[];return Ft?Yt.push(this._loadLibrary("draco_decoder.js","text")):(Yt.push(this._loadLibrary("draco_wasm_wrapper.js","text")),Yt.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(Yt).then(hn=>{const _n=hn[0];Ft||(this.decoderConfig.wasmBinary=hn[1]);const pn=Pt,ln=["/* draco decoder */",_n,"","/* worker */",pn.substring(pn.indexOf("{")+1,pn.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([ln]))}),this.decoderPending}_getWorker(Ft,Yt){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const _n=new Worker(this.workerSourceURL);_n._callbacks={},_n._taskCosts={},_n._taskLoad=0,_n.postMessage({type:"init",decoderConfig:this.decoderConfig}),_n.onmessage=function(pn){const ln=pn.data;switch(ln.type){case"decode":_n._callbacks[ln.id].resolve(ln);break;case"error":_n._callbacks[ln.id].reject(ln);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+ln.type+'"')}},this.workerPool.push(_n)}else this.workerPool.sort(function(_n,pn){return _n._taskLoad>pn._taskLoad?-1:1});const hn=this.workerPool[this.workerPool.length-1];return hn._taskCosts[Ft]=Yt,hn._taskLoad+=Yt,hn})}_releaseTask(Ft,Yt){Ft._taskLoad-=Ft._taskCosts[Yt],delete Ft._callbacks[Yt],delete Ft._taskCosts[Yt]}debug(){console.log("Task load: ",this.workerPool.map(Ft=>Ft._taskLoad))}dispose(){for(let Ft=0;Ft<this.workerPool.length;++Ft)this.workerPool[Ft].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}const Pt=`
function DRACOWorker() {

	let decoderConfig;
	let decoderPending;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				decoderConfig = message.decoderConfig;
				decoderPending = new Promise( function ( resolve/*, reject*/ ) {

					decoderConfig.onModuleLoaded = function ( draco ) {

						// Module is Promise-like. Wrap before resolving to avoid loop.
						resolve( { draco: draco } );

					};

					DracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef

				} );
				break;

			case 'decode':
				const buffer = message.buffer;
				const taskConfig = message.taskConfig;
				decoderPending.then( ( module ) => {

					const draco = module.draco;
					const decoder = new draco.Decoder();

					try {

						const geometry = decodeGeometry( draco, decoder, new Int8Array( buffer ), taskConfig );

						const buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );

						if ( geometry.index ) buffers.push( geometry.index.array.buffer );

						self.postMessage( { type: 'decode', id: message.id, geometry }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					} finally {

						draco.destroy( decoder );

					}

				} );
				break;

		}

	};

	function decodeGeometry( draco, decoder, array, taskConfig ) {

		const attributeIDs = taskConfig.attributeIDs;
		const attributeTypes = taskConfig.attributeTypes;

		let dracoGeometry;
		let decodingStatus;

		const geometryType = decoder.GetEncodedGeometryType( array );

		if ( geometryType === draco.TRIANGULAR_MESH ) {

			dracoGeometry = new draco.Mesh();
			decodingStatus = decoder.DecodeArrayToMesh( array, array.byteLength, dracoGeometry );

		} else if ( geometryType === draco.POINT_CLOUD ) {

			dracoGeometry = new draco.PointCloud();
			decodingStatus = decoder.DecodeArrayToPointCloud( array, array.byteLength, dracoGeometry );

		} else {

			throw new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );

		}

		if ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {

			throw new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );

		}

		const geometry = { index: null, attributes: [] };

		// Gather all vertex attributes.
		for ( const attributeName in attributeIDs ) {

			const attributeType = self[ attributeTypes[ attributeName ] ];

			let attribute;
			let attributeID;

			// A Draco file may be created with default vertex attributes, whose attribute IDs
			// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
			// a Draco file may contain a custom set of attributes, identified by known unique
			// IDs. glTF files always do the latter, and .drc files typically do the former.
			if ( taskConfig.useUniqueIDs ) {

				attributeID = attributeIDs[ attributeName ];
				attribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );

			} else {

				attributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );

				if ( attributeID === - 1 ) continue;

				attribute = decoder.GetAttribute( dracoGeometry, attributeID );

			}

			const attributeResult = decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute );

			if ( attributeName === 'color' ) {

				attributeResult.vertexColorSpace = taskConfig.vertexColorSpace;

			}

			geometry.attributes.push( attributeResult );

		}

		// Add index.
		if ( geometryType === draco.TRIANGULAR_MESH ) {

			geometry.index = decodeIndex( draco, decoder, dracoGeometry );

		}

		draco.destroy( dracoGeometry );

		return geometry;

	}

	function decodeIndex( draco, decoder, dracoGeometry ) {

		const numFaces = dracoGeometry.num_faces();
		const numIndices = numFaces * 3;
		const byteLength = numIndices * 4;

		const ptr = draco._malloc( byteLength );
		decoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );
		const index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();
		draco._free( ptr );

		return { array: index, itemSize: 1 };

	}

	function decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {

		const numComponents = attribute.num_components();
		const numPoints = dracoGeometry.num_points();
		const numValues = numPoints * numComponents;
		const byteLength = numValues * attributeType.BYTES_PER_ELEMENT;
		const dataType = getDracoDataType( draco, attributeType );

		const ptr = draco._malloc( byteLength );
		decoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );
		const array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();
		draco._free( ptr );

		return {
			name: attributeName,
			array: array,
			itemSize: numComponents
		};

	}

	function getDracoDataType( draco, attributeType ) {

		switch ( attributeType ) {

			case Float32Array: return draco.DT_FLOAT32;
			case Int8Array: return draco.DT_INT8;
			case Int16Array: return draco.DT_INT16;
			case Int32Array: return draco.DT_INT32;
			case Uint8Array: return draco.DT_UINT8;
			case Uint16Array: return draco.DT_UINT16;
			case Uint32Array: return draco.DT_UINT32;

		}

	}

}
`}},__webpackgi_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpackgi_require__($){var _e=__webpackgi_module_cache__[$];if(_e!==void 0)return _e.exports;var _=__webpackgi_module_cache__[$]={id:$,exports:{}};return __webpackgi_modules__[$].call(_.exports,_,_.exports,__webpackgi_require__),_.exports}__webpackgi_require__.m=__webpackgi_modules__,__webpackgi_require__.n=function($){var _e=$&&$.__esModule?function(){return $.default}:function(){return $};return __webpackgi_require__.d(_e,{a:_e}),_e},getProto=Object.getPrototypeOf?function($){return Object.getPrototypeOf($)}:function($){return $.__proto__},__webpackgi_require__.t=function($,_e){if(1&_e&&($=this($)),8&_e||typeof $=="object"&&$&&(4&_e&&$.__esModule||16&_e&&typeof $.then=="function"))return $;var _=Object.create(null);__webpackgi_require__.r(_);var dt={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var vt=2&_e&&$;typeof vt=="object"&&!~leafPrototypes.indexOf(vt);vt=getProto(vt))Object.getOwnPropertyNames(vt).forEach(function(Et){dt[Et]=function(){return $[Et]}});return dt.default=function(){return $},__webpackgi_require__.d(_,dt),_},__webpackgi_require__.d=function($,_e){for(var _ in _e)__webpackgi_require__.o(_e,_)&&!__webpackgi_require__.o($,_)&&Object.defineProperty($,_,{enumerable:!0,get:_e[_]})},__webpackgi_require__.f={},__webpackgi_require__.e=function($){return Promise.all(Object.keys(__webpackgi_require__.f).reduce(function(_e,_){return __webpackgi_require__.f[_]($,_e),_e},[]))},__webpackgi_require__.u=function($){return $+".mjs"},__webpackgi_require__.o=function($,_e){return Object.prototype.hasOwnProperty.call($,_e)},inProgress={},dataWebpackPrefix="webgi:",__webpackgi_require__.l=function($,_e,_,dt){if(inProgress[$])inProgress[$].push(_e);else{var vt,Et;if(_!==void 0)for(var Pt=document.getElementsByTagName("script"),Ut=0;Ut<Pt.length;Ut++){var Ft=Pt[Ut];if(Ft.getAttribute("src")==$||Ft.getAttribute("data-webpack")==dataWebpackPrefix+_){vt=Ft;break}}vt||(Et=!0,(vt=document.createElement("script")).type="module",vt.charset="utf-8",vt.timeout=120,__webpackgi_require__.nc&&vt.setAttribute("nonce",__webpackgi_require__.nc),vt.setAttribute("data-webpack",dataWebpackPrefix+_),vt.src=$),inProgress[$]=[_e];var Yt=function(_n,pn){vt.onerror=vt.onload=null,clearTimeout(hn);var ln=inProgress[$];if(delete inProgress[$],vt.parentNode&&vt.parentNode.removeChild(vt),ln&&ln.forEach(function(Pn){return Pn(pn)}),_n)return _n(pn)},hn=setTimeout(Yt.bind(null,void 0,{type:"timeout",target:vt}),12e4);vt.onerror=Yt.bind(null,vt.onerror),vt.onload=Yt.bind(null,vt.onload),Et&&document.head.appendChild(vt)}},__webpackgi_require__.r=function($){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty($,Symbol.toStringTag,{value:"Module"}),Object.defineProperty($,"__esModule",{value:!0})},function(){var $;if(typeof import.meta.url=="string"&&($=import.meta.url),!$)throw new Error("Automatic publicPath is not supported in this browser");$=$.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpackgi_require__.p=$+"../../"}(),function(){var $={698:0};__webpackgi_require__.f.j=function(dt,vt){var Et=__webpackgi_require__.o($,dt)?$[dt]:void 0;if(Et!==0)if(Et)vt.push(Et[2]);else{var Pt=new Promise(function(Yt,hn){Et=$[dt]=[Yt,hn]});vt.push(Et[2]=Pt);var Ut=__webpackgi_require__.p+__webpackgi_require__.u(dt),Ft=new Error;__webpackgi_require__.l(Ut,function(Yt){if(__webpackgi_require__.o($,dt)&&((Et=$[dt])!==0&&($[dt]=void 0),Et)){var hn=Yt&&(Yt.type==="load"?"missing":Yt.type),_n=Yt&&Yt.target&&Yt.target.src;Ft.message="Loading chunk "+dt+` failed.
(`+hn+": "+_n+")",Ft.name="ChunkLoadError",Ft.type=hn,Ft.request=_n,Et[1](Ft)}},"chunk-"+dt,dt)}};var _e=function(dt,vt){var Et,Pt,Ut=vt[0],Ft=vt[1],Yt=vt[2],hn=0;if(Ut.some(function(_n){return $[_n]!==0})){for(Et in Ft)__webpackgi_require__.o(Ft,Et)&&(__webpackgi_require__.m[Et]=Ft[Et]);Yt&&Yt(__webpackgi_require__)}for(dt&&dt(vt);hn<Ut.length;hn++)Pt=Ut[hn],__webpackgi_require__.o($,Pt)&&$[Pt]&&$[Pt][0](),$[Pt]=0},_=self.webpackChunkwebgi=self.webpackChunkwebgi||[];_.forEach(_e.bind(null,0)),_.push=_e.bind(null,_.push.bind(_))}(),__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};(function(){var $;__webpackgi_require__.d(__webpackgi_exports__,{MWW:function(){return $C},LY2:function(){return _.LY2},GYo:function(){return tD},GPz:function(){return IR},HRj:function(){return v0},li4:function(){return qN},FO5:function(){return Bw},Nlh:function(){return XN},Mp4:function(){return Sm},QvI:function(){return hs},PrA:function(){return k_},JHp:function(){return XM},bGH:function(){return _.bGH},NDo:function(){return _.NDo},gSk:function(){return _.gSk},WMw:function(){return _.WMw},OTo:function(){return _.OTo},Se2:function(){return _.Se2},cum:function(){return _.cum},Mig:function(){return _.Mig},B$7:function(){return WA},i_9:function(){return _.i_9},bBp:function(){return _.bBp},m7l:function(){return _.m7l},sYA:function(){return _.sYA},Xcj:function(){return _.Xcj},mzJ:function(){return _.mzJ},ZZA:function(){return _.ZZA},$Ph:function(){return am},T__:function(){return _.T__},HkE:function(){return _.HkE},tGC:function(){return _.tGC},g1S:function(){return b3},I$C:function(){return m1},QIH:function(){return HS},_JE:function(){return jP},SwW:function(){return sI},ksm:function(){return Lr},jl_:function(){return Bu},b7R:function(){return p_},BDV:function(){return wn},Ea_:function(){return KA},qff:function(){return Bu},tmC:function(){return as},BON:function(){return VS},P40:function(){return Ny},wLL:function(){return qD},iHO:function(){return xx},BbS:function(){return _.BbS},kqm:function(){return _.kqm},Hmr:function(){return _.Hmr},SJI:function(){return _.SJI},mTL:function(){return _.mTL},y8_:function(){return _.y8_},_Li:function(){return _._Li},w7U:function(){return b2},g56:function(){return Vm},bj3:function(){return Av},z81:function(){return _.z81},_MY:function(){return _._MY},yEv:function(){return O4},dFZ:function(){return rv},N$j:function(){return _.N$j},_YM:function(){return _._YM},TUj:function(){return _.TUj},ZzF:function(){return _.ZzF},qzb:function(){return Xt},GQ:function(){return _.GQ},nvb:function(){return _.nvb},DvJ:function(){return _.DvJ},fQA:function(){return _.fQA},cPz:function(){return eT},TlE:function(){return _.TlE},u9r:function(){return _.u9r},s4_:function(){return _.s4_},T95:function(){return _.T95},F5w:function(){return CI},NlP:function(){return NI},$8Z:function(){return Ow},YYN:function(){return _A},CtF:function(){return _.CtF},V1s:function(){return _.V1s},jOv:function(){return hu},Rki:function(){return _.Rki},pzV:function(){return e2},itZ:function(){return dp},MMq:function(){return SA},qKx:function(){return qo},Hmi:function(){return PA},X4S:function(){return xI},vlJ:function(){return LD},nPO:function(){return oy},zcQ:function(){return uC},GH1:function(){return Uv},ROQ:function(){return _.ROQ},YN5:function(){return _.YN5},BVQ:function(){return _.BVQ},YT8:function(){return _.YT8},_DE:function(){return Cx},YGz:function(){return _.YGz},trn:function(){return _.trn},zf8:function(){return _.zf8},uWy:function(){return _.uWy},wYQ:function(){return zv},SUY:function(){return _.SUY},Ilk:function(){return _.Ilk},R2R:function(){return _.R2R},epp:function(){return _.epp},xmJ:function(){return f_},GD$:function(){return Ku},Z_g:function(){return _.Z_g},EB7:function(){return _.EB7},DqL:function(){return _.DqL},_3:function(){return _._3},b_z:function(){return _.b_z},OCn:function(){return P_},N_j:function(){return _H},hNv:function(){return i3},_am:function(){return _._am},kB7:function(){return Nx},fY$:function(){return _.fY$},vxC:function(){return _.vxC},BtG:function(){return _.BtG},cBK:function(){return _.cBK},g8_:function(){return _.g8_},AXT:function(){return _.AXT},yj7:function(){return _.yj7},dYG:function(){return _.dYG},tm_:function(){return _.tm_},S2y:function(){return _.S2y},B02:function(){return _.B02},PeU:function(){return _.PeU},Hyl:function(){return _.Hyl},Wqd:function(){return _.Wqd},c0Q:function(){return jU},re0:function(){return zU},Xaj:function(){return _.Xaj},DUb:function(){return Nu},dZ3:function(){return _.dZ3},m_w:function(){return _.m_w},fHI:function(){return _.fHI},LBq:function(){return _.LBq},Qww:function(){return yx.Q},CGV:function(){return _e.Damper},JUT:function(){return _.JUT},p3g:function(){return _.p3g},IEO:function(){return _.IEO},yxD:function(){return _.yxD},CUS:function(){return c3},A5E:function(){return _.A5E},zqG:function(){return $0},PfX:function(){return QD},Q1o:function(){return FM},jfJ:function(){return _.jfJ},T_J:function(){return _.T_J},tEQ:function(){return _.tEQ},gb4:function(){return Vt},qkB:function(){return _.qkB},cvk:function(){return Fy},HWo:function(){return jy},brP:function(){return _.brP},$YQ:function(){return _.$YQ},X8d:function(){return UI},Zdt:function(){return sL},yNB:function(){return Ro},h7x:function(){return Uo},Ox3:function(){return _.Ox3},qtn:function(){return _g},cBI:function(){return _.cBI},cU9:function(){return _.cU9},ntt:function(){return _.ntt},DT1:function(){return _.DT1},Kgo:function(){return _.Kgo},ehD:function(){return _.ehD},fhJ:function(){return QM},y1s:function(){return Y_},fSK:function(){return _.fSK},Vdb:function(){return _.Vdb},l8J:function(){return _.l8J},dj0:function(){return _.dj0},QM0:function(){return _.QM0},n94:function(){return qP},OIS:function(){return GB},q8b:function(){return $y},TOt:function(){return _.TOt},xaN:function(){return pn},Ny0:function(){return _.Ny0},NeD:function(){return OO},Zof:function(){return WD},N1Y:function(){return cI},itK:function(){return w2},eD:function(){return _.eD},jwo:function(){return _.jwo},dSO:function(){return _.dSO},Bf4:function(){return _.Bf4},USm:function(){return _.USm},pBf:function(){return _.pBf},eBg:function(){return NL},$Vf:function(){return _.$Vf},O7d:function(){return _.O7d},ksq:function(){return Nt},hFL:function(){return cM},gXf:function(){return VB},hH6:function(){return _.hH6},izP:function(){return FI},kpi:function(){return eE},DwZ:function(){return kp},kN3:function(){return lL},e62:function(){return _.e62},a$l:function(){return _.a$l},OM3:function(){return _.OM3},VzW:function(){return _.VzW},ybr:function(){return _.ybr},yo9:function(){return _.yo9},Dzq:function(){return Fm},zCA:function(){return hp},$Bt:function(){return U0},Wzm:function(){return _.Wzm},Wl3:function(){return _.Wl3},iWj:function(){return _.iWj},DNz:function(){return dm},m1M:function(){return bo},ylh:function(){return _.ylh},v9Y:function(){return _.v9Y},LSk:function(){return _.LSk},LHE:function(){return $o},KE0:function(){return MO},KCF:function(){return jN},a4n:function(){return uO},NKC:function(){return PT},jrv:function(){return i0},zIH:function(){return vx},Hfk:function(){return j_},png:function(){return E0},tAj:function(){return Ev},Eb_:function(){return _x},SJj:function(){return rP},cF0:function(){return rx},BT2:function(){return WB},_8p:function(){return _3},V5Z:function(){return oP},s5b:function(){return kC},BHZ:function(){return x2},hkn:function(){return Mm},GFY:function(){return Tm},w$m:function(){return _.w$m},ksN:function(){return _.ksN},j4z:function(){return _.j4z},OAl:function(){return _.OAl},VLJ:function(){return _.VLJ},C73:function(){return Wv},ZAu:function(){return _.ZAu},ibP:function(){return d_},lth:function(){return CT},_fI:function(){return Ku},hUN:function(){return Qp},cLu:function(){return _.cLu},vmT:function(){return _.vmT},Qpg:function(){return _.Qpg},So8:function(){return _.So8},eOv:function(){return JI},Wjw:function(){return _.Wjw},cJO:function(){return _.cJO},QRU:function(){return _.QRU},S3k:function(){return _.S3k},OPJ:function(){return YN},PpQ:function(){return _.PpQ},q_9:function(){return yl},ZRs:function(){return _.ZRs},oqc:function(){return _.oqc},T_x:function(){return Mr},lb7:function(){return _.lb7},L5s:function(){return _.L5s},$TI:function(){return _.$TI},SPe:function(){return _.SPe},aVm:function(){return _.aVm},j87:function(){return _.j87},RNb:function(){return _.RNb},Kz5:function(){return _.Kz5},vpT:function(){return _.vpT},kB5:function(){return _.kB5},_C8:function(){return _._C8},Syv:function(){return _.Syv},NMF:function(){return _.NMF},pIN:function(){return _.pIN},eMJ:function(){return _.eMJ},rN7:function(){return NT},iUp:function(){return rA},GFd:function(){return rO},x5V:function(){return _.x5V},tUh:function(){return _.tUh},z8B:function(){return _.z8B},vcl:function(){return mu},GZb:function(){return _.GZb},p7y:function(){return _.p7y},S9g:function(){return _.S9g},Zr5:function(){return _.Zr5},vCF:function(){return _.vCF},yt0:function(){return _.yt0},uXU:function(){return _.uXU},_kC:function(){return _._kC},lk7:function(){return _.lk7},USc:function(){return $I},x12:function(){return _.x12},w_R:function(){return iO},Zzh:function(){return _.Zzh},nls:function(){return _.nls},g_z:function(){return _.g_z},U7:function(){return _.U7},FT0:function(){return _.FT0},L1_:function(){return oI},blk:function(){return _.blk},YRm:function(){return Ov},ejS:function(){return _.ejS},wUb:function(){return HP},zOz:function(){return zy},rnI:function(){return _.rnI},wem:function(){return _.wem},lfu:function(){return _.lfu},FDw:function(){return _.FDw},lRj:function(){return _.lRj},D1R:function(){return _.D1R},qyh:function(){return _.qyh},GUF:function(){return _.GUF},EoG:function(){return _.EoG},aNw:function(){return _.aNw},Zp0:function(){return _.Zp0},lLk:function(){return _.lLk},NHT:function(){return xa},jAl:function(){return _.jAl},uEv:function(){return _.uEv},YKA:function(){return _.YKA},cRx:function(){return _.cRx},Y8D:function(){return _.Y8D},RsA:function(){return _.RsA},Y0m:function(){return dP},F5T:function(){return _.F5T},EDU:function(){return En},z$Q:function(){return Iw},KA8:function(){return wu},ZqF:function(){return E2},XUj:function(){return BP},Me$:function(){return cA},u7G:function(){return _.u7G},PEk:function(){return _0},BG4:function(){return $t},M8C:function(){return _.M8C},Vkp:function(){return _.Vkp},yGw:function(){return _.yGw},Sm8:function(){return _.Sm8},Kj0:function(){return _.Kj0},vBJ:function(){return _.vBJ},QfV:function(){return Wu},lRF:function(){return _.lRF},Lun:function(){return _.Lun},YBo:function(){return _.YBo},kaV:function(){return _.kaV},RSm:function(){return _.RSm},xoR:function(){return _.xoR},EJi:function(){return _.EJi},Wid:function(){return _.Wid},iuj:function(){return Qu},IKL:function(){return _.IKL},r_:function(){return _.r_},OoA:function(){return _.OoA},qhX:function(){return _.qhX},CRe:function(){return iP},qPT:function(){return J_},M5h:function(){return _.M5h},Ns1:function(){return _.Ns1},TyD:function(){return _.TyD},vZf:function(){return _.vZf},HTd:function(){return _.HTd},aH4:function(){return _.aH4},YLQ:function(){return _.YLQ},BVF:function(){return _.BVF},MyG:function(){return _.MyG},jFi:function(){return _.jFi},aCh:function(){return _.aCh},uL9:function(){return _.uL9},TNj:function(){return zm},IFH:function(){return _.IFH},bdR:function(){return _.bdR},RPs:function(){return av},kM_:function(){return F2},M6v:function(){return _.M6v},RvT:function(){return _.RvT},dUE:function(){return _.dUE},oe_:function(){return vP},BuN:function(){return jT},Tme:function(){return _.Tme},N9P:function(){return wy},tfP:function(){return ES},Gql:function(){return _.Gql},$XY:function(){return rp},O9d:function(){return S2},zEO:function(){return $m},qfx:function(){return ay},PA7:function(){return _.PA7},REq:function(){return _.REq},pQR:function(){return _.pQR},ghN:function(){return _.ghN},Hy8:function(){return _.Hy8},Wpd:function(){return _.Wpd},LgZ:function(){return _.LgZ},iWC:function(){return _.iWC},mqn:function(){return q8},SKe:function(){return ko},iKG:function(){return _.iKG},rCq:function(){return wI},_iA:function(){return _._iA},ntZ:function(){return _.ntZ},anP:function(){return _.anP},X2e:function(){return VN},oxT:function(){return hm},FCo:function(){return c0},y$t:function(){return _.y$t},cPb:function(){return _.cPb},lmx:function(){return vo},JOQ:function(){return _.JOQ},BKK:function(){return _.BKK},_12:function(){return _._12},tJx:function(){return _.tJx},mjX:function(){return $1},cek:function(){return _.cek},qD0:function(){return Ty},xG9:function(){return _.xG9},eqi:function(){return _e.PointerDragHelper},wI8:function(){return zw},Sgv:function(){return cL},woe:function(){return _.woe},UY4:function(){return _.UY4},aq0:function(){return _.aq0},ujx:function(){return _.ujx},Uol:function(){return _.Uol},JiH:function(){return dM},VYz:function(){return _.VYz},B2H:function(){return J1},_Pm:function(){return nw},EsW:function(){return cp},iUV:function(){return _.iUV},tf:function(){return _.tf},ZQ6:function(){return _.ZQ6},mXe:function(){return _.mXe},_fP:function(){return _._fP},iLg:function(){return _.iLg},zbs:function(){return _.zbs},ZTh:function(){return _.ZTh},HdW:function(){return _.HdW},UZH:function(){return _.UZH},mSO:function(){return _.mSO},wk1:function(){return _.wk1},E2K:function(){return _.E2K},FUD:function(){return _.FUD},pKu:function(){return _.pKu},GG6:function(){return _.GG6},Gih:function(){return _.Gih},iiP:function(){return _.iiP},SvJ:function(){return _.SvJ},ptH:function(){return _.ptH},jZA:function(){return _.jZA},y2t:function(){return _.y2t},gi4:function(){return _.gi4},Djp:function(){return _.Djp},BG$:function(){return _.BG$},NYV:function(){return _.NYV},xJs:function(){return _.xJs},bsb:function(){return _.bsb},ekQ:function(){return _.ekQ},CaW:function(){return _.CaW},eaV:function(){return _.eaV},BFQ:function(){return _.BFQ},v3W:function(){return _.v3W},ILR:function(){return _.ILR},G_r:function(){return _.G_r},N3F:function(){return cr},fto:function(){return _.fto},l0P:function(){return _.l0P},vCx:function(){return _.vCx},_AM:function(){return _._AM},wuA:function(){return _.wuA},av9:function(){return _.av9},CtA:function(){return _.CtA},BvQ:function(){return kx},FZJ:function(){return z0},FIo:function(){return _.FIo},zHn:function(){return _.zHn},iMs:function(){return _.iMs},T_f:function(){return _.T_f},hEm:function(){return _.hEm},D9w:function(){return _.D9w},sHH:function(){return UE},CdI:function(){return _.CdI},rkc:function(){return R_},rpg:function(){return _.rpg},ce8:function(){return _.ce8},rOj:function(){return _.rOj},P6m:function(){return iy},JA6:function(){return fp},V4E:function(){return _.V4E},o8S:function(){return _.o8S},flB:function(){return Nl},lGU:function(){return _.lGU},vuL:function(){return _.vuL},KI_:function(){return _.KI_},iLN:function(){return K1},X6w:function(){return $x},rz_:function(){return b_},jsw:function(){return Tp},srG:function(){return Ju},i6Z:function(){return Bx},vfv:function(){return QB},xsS:function(){return _.xsS},or:function(){return ZI},EQj:function(){return fu},Rnn:function(){return uL},TyN:function(){return S1},ov0:function(){return JS},WdD:function(){return _.WdD},Vj0:function(){return _.Vj0},jyz:function(){return _.jyz},mTM:function(){return U_},Mn1:function(){return Cm},Hlq:function(){return io},Fi7:function(){return Qv},Tn7:function(){return _.Tn7},bnF:function(){return _.bnF},HW6:function(){return _.HW6},oa8:function(){return _.oa8},T_1:function(){return _.T_1},zHJ:function(){return Kv},iDF:function(){return _.iDF},iAb:function(){return _.iAb},d4E:function(){return f1},lBg:function(){return YI},JeJ:function(){return D4},FKY:function(){return _e.SimpleEventDispatcher},zlZ:function(){return u3},vkg:function(){return Al},brh:function(){return h3},kZK:function(){return Jv},puG:function(){return KI},OdW:function(){return _.OdW},_YX:function(){return _._YX},TUv:function(){return _.TUv},Hw6:function(){return _.Hw6},aLr:function(){return _.aLr},Aip:function(){return _.Aip},xo$:function(){return _.xo$},bIn:function(){return X8},$V:function(){return _.$V},lDi:function(){return _.lDi},gti:function(){return _.gti},PMe:function(){return _.PMe},iwP:function(){return QA},FvO:function(){return _.FvO},jyi:function(){return _.jyi},xeV:function(){return _.xeV},k74:function(){return _.k74},RlZ:function(){return _.RlZ},KhW:function(){return _.KhW},HgB:function(){return _.HgB},W2J:function(){return _.W2J},JWc:function(){return _.JWc},u37:function(){return _.u37},Z6B:function(){return _.Z6B},QZ1:function(){return _.QZ1},Ir4:function(){return _.Ir4},NwF:function(){return _.NwF},Wbm:function(){return _.Wbm},N4l:function(){return _.N4l},Jxm:function(){return zB},ej9:function(){return Pw},QmN:function(){return _.QmN},Y4W:function(){return _e.TYPED_ARRAYS},IOt:function(){return _.IOt},NOD:function(){return Kx},L5g:function(){return _.L5g},H$k:function(){return _.H$k},cuP:function(){return gp},xEZ:function(){return _.xEZ},dpR:function(){return _.dpR},wOD:function(){return sv},KNb:function(){return HM},IiN:function(){return Sx},Cne:function(){return _.Cne},XvJ:function(){return _.XvJ},XZw:function(){return _.XZw},FE5:function(){return _.FE5},Mck:function(){return Vw},lVp:function(){return B2},CJI:function(){return _.CJI},z$h:function(){return _.z$h},UlW:function(){return _.UlW},WwZ:function(){return _.WwZ},zG7:function(){return w_},Lcc:function(){return _.Lcc},WXh:function(){return _.WXh},Vjr:function(){return kO},LuM:function(){return CD},LP5:function(){return UF},ub3:function(){return _.ub3},OV:function(){return mv},G_n:function(){return Zv},xfE:function(){return _.xfE},qlB:function(){return _.qlB},lCJ:function(){return _.lCJ},WTc:function(){return _.WTc},rAo:function(){return _.rAo},LZj:function(){return WM},xWb:function(){return _.xWb},gH0:function(){return _.gH0},rBU:function(){return _.rBU},rDY:function(){return _.rDY},ywz:function(){return _.ywz},wJv:function(){return _.wJv},JQ4:function(){return _.JQ4},k0A:function(){return _.k0A},irR:function(){return _.irR},LsT:function(){return _.LsT},q5h:function(){return d2},TKh:function(){return KD},tyg:function(){return h2},Ro5:function(){return kv},dwk:function(){return _.dwk},t0w:function(){return VI},M7$:function(){return TM},ML4:function(){return zI},FM8:function(){return _.FM8},Pa4:function(){return _.Pa4},Ltg:function(){return _.Ltg},yC1:function(){return _.yC1},lHq:function(){return cv},fO1:function(){return _.fO1},oMA:function(){return iv},JzW:function(){return $},QEt:function(){return q0},IFZ:function(){return pS},b5g:function(){return _.b5g},Ywn:function(){return _.Ywn},GVz:function(){return _.GVz},oAp:function(){return _.oAp},kFz:function(){return _.kFz},dd2:function(){return _.dd2},CP7:function(){return _.CP7},fQK:function(){return _.fQK},Wd$:function(){return r3},t1_:function(){return DL},v27:function(){return KS},Uk6:function(){return _.Uk6},H7Z:function(){return $M},_sL:function(){return _._sL},czO:function(){return u0},Pnf:function(){return _.Pnf},c8b:function(){return _.c8b},_lf:function(){return _._lf},ad5:function(){return _.ad5},sZV:function(){return XD},TfA:function(){return zS},sKX:function(){return GS},UdM:function(){return lp},P0y:function(){return Ly},L_r:function(){return _.L_r},zC5:function(){return _e.absMax},Bve:function(){return UP},b5G:function(){return g2},UeO:function(){return S0},qCx:function(){return h4},$nx:function(){return hO},Bk6:function(){return w0},EER:function(){return ST},y4l:function(){return a_},P39:function(){return Jx},HI1:function(){return _e.aesGcmDecrypt},ZYi:function(){return _e.aesGcmEncrypt},wXW:function(){return jo},r5x:function(){return Pp},MSI:function(){return aA},EUu:function(){return tH},jtH:function(){return e0},T0T:function(){return Xx},gAb:function(){return ND},je_:function(){return _j},wBP:function(){return xE},LU2:function(){return pC},wQL:function(){return nH},Zs7:function(){return Ln},sMc:function(){return _e.arrayBufferToBase64},x7s:function(){return Cw},Mnd:function(){return rH},A0_:function(){return sH},d73:function(){return qn},HCD:function(){return ba},YQ8:function(){return p0},RG9:function(){return Mo},G2P:function(){return jm},XLf:function(){return uT},CGN:function(){return pE},RGi:function(){return _e.base64ToArrayBuffer},mvg:function(){return Er},Hiy:function(){return hx},XMc:function(){return lo},N7M:function(){return Rs},iv:function(){return ty},n55:function(){return _e.blobToDataURL},IaC:function(){return Zn},h9t:function(){return fC},yDW:function(){return mC},gJv:function(){return qy},l$g:function(){return ZN},vQi:function(){return OU},$MY:function(){return k1},wJl:function(){return PS},Z7Y:function(){return dE},X7D:function(){return G2},BnX:function(){return cT},uZ5:function(){return V0},zVI:function(){return is},Wz1:function(){return _e.colorToDataUrl},DpF:function(){return _2},nNb:function(){return Om},cqZ:function(){return Dv},pKN:function(){return SR},CN8:function(){return oT},DdI:function(){return TO},rrX:function(){return CR},uqj:function(){return An},Z9P:function(){return Xn},KlC:function(){return Ux},KVn:function(){return zn},oau:function(){return qC},aw9:function(){return Pu},Aap:function(){return tu},Dxg:function(){return _e.copyProps},MjT:function(){return Zp},F7Q:function(){return uE},IFq:function(){return KL},IJl:function(){return Fx},O5A:function(){return _e.createCanvasElement},wCn:function(){return _e.createDiv},gGT:function(){return hC},pEc:function(){return QN},Bi6:function(){return _e.createImage},fi_:function(){return Uu},TT:function(){return EP},q2Z:function(){return V8},NyK:function(){return kA},bgu:function(){return _e.createScriptFromURL},kcS:function(){return _e.createStyles},rRN:function(){return UO},ivY:function(){return _e.css},_s1:function(){return gH},_HO:function(){return Js},tpL:function(){return fo},DMK:function(){return Gx},LjN:function(){return FS},iFs:function(){return Cp},qTg:function(){return _e.deepAccessObject},J4G:function(){return Wt},Zj8:function(){return Z8},Wtl:function(){return Tn},DmK:function(){return or},Htt:function(){return r4},Nv0:function(){return Bn},tCp:function(){return Qt},Hx7:function(){return Oo},imt:function(){return Up},US6:function(){return _o},vZs:function(){return aT},TE$:function(){return oH},lmu:function(){return _e.downloadBlob},SvO:function(){return _e.downloadFile},YQY:function(){return hE},mZN:function(){return lT},VvG:function(){return V2},omp:function(){return _e.embedUrlRefs},utz:function(){return Rr},TFV:function(){return WS},hrz:function(){return _e.escapeRegExp},H$s:function(){return Kt},JKM:function(){return QC},jZf:function(){return WL},RjL:function(){return ED},RRI:function(){return Rp},RUq:function(){return $N},_t4:function(){return bv},YHh:function(){return tm},R8g:function(){return ur},f1L:function(){return _e.getFileHandle},Bbl:function(){return _e.getFilenameFromPath},V9r:function(){return _e.getKeyByValue},a95:function(){return _e.getNewFileHandle},PZ2:function(){return _e.getOrCall},w7A:function(){return _e.getPropertyDescriptor},N6S:function(){return rn},Uxp:function(){return Dn},tAz:function(){return _i},R$F:function(){return jr},N33:function(){return Qn},JFD:function(){return Sr},gw2:function(){return B0},rfc:function(){return _e.getTypedArray},wo6:function(){return _e.getUrlQueryParam},V4T:function(){return Zm},H4P:function(){return _e.glsl},NLp:function(){return DC},swA:function(){return Oy},_Z3:function(){return q_},ivc:function(){return Om},rZ1:function(){return Dv},CpZ:function(){return o0},dyc:function(){return _e.html},MxZ:function(){return _e.htmlToCanvas},btp:function(){return _e.htmlToPng},mXy:function(){return _e.htmlToSvg},Ej0:function(){return L_},ep4:function(){return DA},DQP:function(){return _f},VNr:function(){return yv},V7q:function(){return _e.imageBitmapToBase64},hiB:function(){return _e.imageDataToCanvas},zEk:function(){return _e.imageToCanvas},qfq:function(){return _e.imageUrlToImageData},piB:function(){return _e.includesAll},IIc:function(){return eH},rrF:function(){return Gs},naq:function(){return Wo},zlD:function(){return Zt},sXR:function(){return Aw},p5I:function(){return MC},wps:function(){return UD},wuo:function(){return JL},GpE:function(){return _e.isPropertyWritable},F4b:function(){return W0},NN$:function(){return xw},t$v:function(){return Gn},tdn:function(){return y_},Y9t:function(){return ET},GEo:function(){return dC},GGm:function(){return _e.longestCommonPrefix},DH3:function(){return Bo},uxM:function(){return _e.makeColorSvg},zH3:function(){return _e.makeColorSvgCircle},MLs:function(){return Vo},xXG:function(){return Ko},YM4:function(){return CC},B3r:function(){return qL},iAx:function(){return _e.makeTextSvg},lDn:function(){return Kr},P1O:function(){return jt},iib:function(){return ir},qf5:function(){return Wn},n4s:function(){return kn},fr:function(){return rr},Z9s:function(){return an},oaQ:function(){return cE},CD7:function(){return G0},Rc0:function(){return vE},iPG:function(){return yw},TIc:function(){return _e.mobileAndTabletCheck},xsC:function(){return DE},zOc:function(){return _e.now},i8W:function(){return _e.objectHasOwn},r46:function(){return wr},z2C:function(){return _e.onChange},N4A:function(){return _e.onChange2},hjq:function(){return _e.onChange3},_X$:function(){return _e.parseFileExtension},_yn:function(){return Bs},Dyg:function(){return _e.pathJoin},cUc:function(){return Jm},zGw:function(){return _w},Ctq:function(){return qs},$ch:function(){return aH},k5b:function(){return Ps},kZl:function(){return BE},OCg:function(){return o1},Kd3:function(){return _e.prettyScrollbar},YjH:function(){return vu},Ui8:function(){return A3},YD2:function(){return mw},vi9:function(){return i4},ij3:function(){return Zo},pJq:function(){return _e.readFile},YPW:function(){return ds},_tY:function(){return _e.remoteWorkerURL},Bg1:function(){return Q8},kon:function(){return _e.replaceAll},M3g:function(){return dw},F2z:function(){return fn},pJF:function(){return JN},knz:function(){return _.knz},Ejo:function(){return _e.safeSetProperty},BgY:function(){return qm},qCG:function(){return Mn},HD9:function(){return To},Rgz:function(){return ix},fEB:function(){return Wm},Udc:function(){return D1},ZQg:function(){return sx},ofC:function(){return no},yRy:function(){return _e.setUrlQueryParam},_NL:function(){return AH},LCA:function(){return Em},Sy1:function(){return GF},Vs_:function(){return HF},j1w:function(){return FA},i8J:function(){return yH},p7C:function(){return rs},ZAS:function(){return nP},ipH:function(){return lH},$TF:function(){return o4},uZI:function(){return cH},VWG:function(){return qt},pQ7:function(){return cm},STw:function(){return Xy},jc8:function(){return by},BL_:function(){return br},S6:function(){return vH},T8U:function(){return X_},TD6:function(){return Mp},akS:function(){return _e.svgToCanvas},QKE:function(){return _e.svgToPng},dKx:function(){return _e.svgUrl},OvX:function(){return $j},doP:function(){return O_},$jA:function(){return gy},T99:function(){return vy},LJS:function(){return P1},VsW:function(){return _e.timeout},LZE:function(){return vr},YMc:function(){return s4},aPg:function(){return _c},LFn:function(){return _e.toTitleCase},VsX:function(){return yn},wey:function(){return On},MaE:function(){return go},s4x:function(){return s_},FJA:function(){return Ap},vIA:function(){return em},Spv:function(){return Ms},w8l:function(){return yy},riG:function(){return js},Kbh:function(){return Xm},BFq:function(){return wv},t8K:function(){return es},Q7n:function(){return Nr},KGF:function(){return ip},e5:function(){return hr},Rik:function(){return q1},GZo:function(){return $A},Bds:function(){return Gp},HTu:function(){return H1},cTq:function(){return _e.uploadFile},X_Y:function(){return RS},dA8:function(){return ux},NSm:function(){return m0},bwS:function(){return Ys},Lks:function(){return uH},Rvq:function(){return n4},P4F:function(){return _e.verifyPermission},Pd0:function(){return iu},Pjo:function(){return ms},Tum:function(){return Rm},dRH:function(){return Ru},RX0:function(){return qu},reQ:function(){return hH},cWm:function(){return yr},NC9:function(){return _e.writeFile},$Re:function(){return YD},Xo9:function(){return GM},LNO:function(){return Ou},iZP:function(){return Ex}}),function(h){h[h.Error=-2]="Error",h[h.Destroyed=-1]="Destroyed",h[h.None=0]="None",h[h.Running=1]="Running",h[h.Paused=2]="Paused"}($||($={}));var _e=__webpackgi_require__(8),_=__webpackgi_require__(988);const dt={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class vt{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Et=new _.iKG(-1,1,1,-1,0,1),Pt=new _.u9r;Pt.setAttribute("position",new _.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),Pt.setAttribute("uv",new _.a$l([0,2,0,0,2,0],2));class Ut{constructor(e){this._mesh=new _.Kj0(Pt,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Et)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Ft extends vt{constructor(e,i){super(),this.textureID=i!==void 0?i:"tDiffuse",e instanceof _.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=_.rDY.clone(e.uniforms),this.material=new _.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Ut(this.material),this.useExistingRenderTarget=!1}render(e,i,s){this.uniforms[this.textureID]&&s&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(i||null),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class Yt extends vt{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,i,s){const o=e.getContext(),c=e.state;let g,b;c.buffers.color.setMask(!1),c.buffers.depth.setMask(!1),c.buffers.color.setLocked(!0),c.buffers.depth.setLocked(!0),this.inverse?(g=0,b=1):(g=1,b=0),c.buffers.stencil.setTest(!0),c.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),c.buffers.stencil.setFunc(o.ALWAYS,g,4294967295),c.buffers.stencil.setClear(b),c.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),c.buffers.color.setLocked(!1),c.buffers.depth.setLocked(!1),c.buffers.stencil.setLocked(!1),c.buffers.stencil.setFunc(o.EQUAL,1,4294967295),c.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),c.buffers.stencil.setLocked(!0)}}class hn extends vt{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class _n{constructor(e,i){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),i===void 0){const s=e.getSize(new _.FM8);this._width=s.width,this._height=s.height,(i=new _.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Ft(dt),this.clock=new _.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,i){this.passes.splice(i,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const i=this.passes.indexOf(e);i!==-1&&this.passes.splice(i,1)}isLastEnabledPass(e){for(let i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const i=this.renderer.getRenderTarget();let s=!1;for(let o=0,c=this.passes.length;o<c;o++){const g=this.passes[o];if(g.enabled!==!1){if(g.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(o),g.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),g.needsSwap){if(s){const b=this.renderer.getContext(),et=this.renderer.state.buffers.stencil;et.setFunc(b.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),et.setFunc(b.EQUAL,1,4294967295)}this.swapBuffers()}Yt!==void 0&&(g instanceof Yt?s=!0:g instanceof hn&&(s=!1))}}this.renderer.setRenderTarget(i)}reset(e){if(e===void 0){const i=this.renderer.getSize(new _.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,i){this._width=e,this._height=i;const s=this._width*this._pixelRatio,o=this._height*this._pixelRatio;this.renderTarget1.setSize(s,o),this.renderTarget2.setSize(s,o);for(let c=0;c<this.passes.length;c++)this.passes[c].setSize(s,o)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class pn extends _n{constructor(e,i){super(e,i)}setPixelRatio(e,i=!0){const s=this.setSize;i||(this.setSize=()=>{}),super.setPixelRatio(e),i||(this.setSize=s)}}const ln=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function Pn(){const h=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(ln[255&h]+ln[h>>8&255]+ln[h>>16&255]+ln[h>>24&255]+"-"+ln[255&e]+ln[e>>8&255]+"-"+ln[e>>16&15|64]+ln[e>>24&255]+"-"+ln[63&i|128]+ln[i>>8&255]+"-"+ln[i>>16&255]+ln[i>>24&255]+ln[255&s]+ln[s>>8&255]+ln[s>>16&255]+ln[s>>24&255]).toLowerCase()}function nn(h,e,i){return Math.max(e,Math.min(i,h))}function Hn(h,e,i){return(1-i)*h+i*e}class tn{constructor(e=0,i=0){tn.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,s=this.y,o=e.elements;return this.x=o[0]*i+o[3]*s+o[6],this.y=o[1]*i+o[4]*s+o[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(nn(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y;return i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const s=Math.cos(i),o=Math.sin(i),c=this.x-e.x,g=this.y-e.y;return this.x=c*s-g*o+e.x,this.y=c*o+g*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Xt extends _.ZzF{expandByObject(e,i=!1,s=!1,o){var g;if(((g=e.userData)==null?void 0:g.bboxVisible)===!1)return this;if(!e.visible&&s)return this;if(o&&o(e))return this;if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),dn.copy(e.boundingBox),dn.applyMatrix4(e.matrixWorld),this.union(dn);else{const b=e.geometry;if(b!==void 0)if(i&&b.attributes!=null&&b.attributes.position!==void 0){const et=b.attributes.position;for(let tt=0,rt=et.count;tt<rt;tt++)Nn.fromBufferAttribute(et,tt).applyMatrix4(e.matrixWorld),this.expandByPoint(Nn)}else b.boundingBox===null&&b.computeBoundingBox(),dn.copy(b.boundingBox),dn.applyMatrix4(e.matrixWorld),this.union(dn)}const c=e.children;for(let b=0,et=c.length;b<et;b++)this.expandByObject(c[b],i,s,o);return this}expandByObjects(e,i=!1,s=!1,o){for(let c=0,g=e.length;c<g;c++)this.expandByObject(e[c],i,s,o);return this}getPoints(){return[new _.Pa4(this.min.x,this.min.y,this.min.z),new _.Pa4(this.min.x,this.min.y,this.max.z),new _.Pa4(this.min.x,this.max.y,this.min.z),new _.Pa4(this.min.x,this.max.y,this.max.z),new _.Pa4(this.max.x,this.min.y,this.min.z),new _.Pa4(this.max.x,this.min.y,this.max.z),new _.Pa4(this.max.x,this.max.y,this.min.z),new _.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const i=this.getPoints(),s=new _.TUj;for(const o of i){const c=o.project(e);s.min.min(c),s.max.max(c)}return s}}const dn=new Xt,Nn=new _.Pa4;function An(h,e,i=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!h.hasAttribute("position")||!h.hasAttribute("normal")||!h.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function s(g){if(g.normalized||g.isInterleavedBufferAttribute){const b=new Float32Array(g.count*g.itemSize);for(let et=0,tt=0;et<g.count;et++)b[tt++]=g.getX(et),b[tt++]=g.getY(et),g.itemSize>2&&(b[tt++]=g.getZ(et));return b}return g.array instanceof Float32Array?g.array:new Float32Array(g.array)}const o=h.index?h.toNonIndexed():h,c=e.generateTangents(s(o.attributes.position),s(o.attributes.normal),s(o.attributes.uv));if(i)for(let g=3;g<c.length;g+=4)c[g]*=-1;return o.setAttribute("tangent",new _.TlE(c,4)),h!==o&&h.copy(o),h}function kn(h,e=!1){const i=h[0].index!==null,s=new Set(Object.keys(h[0].attributes)),o=new Set(Object.keys(h[0].morphAttributes)),c={},g={},b=h[0].morphTargetsRelative,et=new _.u9r;let tt=0;for(let rt=0;rt<h.length;++rt){const st=h[rt];let at=0;if(i!==(st.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+rt+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const ct in st.attributes){if(!s.has(ct))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+rt+'. All geometries must have compatible attributes; make sure "'+ct+'" attribute exists among all geometries, or in none of them.'),null;c[ct]===void 0&&(c[ct]=[]),c[ct].push(st.attributes[ct]),at++}if(at!==s.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+rt+". Make sure all geometries have the same number of attributes."),null;if(b!==st.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+rt+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const ct in st.morphAttributes){if(!o.has(ct))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+rt+".  .morphAttributes must be consistent throughout all geometries."),null;g[ct]===void 0&&(g[ct]=[]),g[ct].push(st.morphAttributes[ct])}if(e){let ct;if(i)ct=st.index.count;else{if(st.attributes.position===void 0)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+rt+". The geometry must have either an index or a position attribute"),null;ct=st.attributes.position.count}et.addGroup(tt,ct,rt),tt+=ct}}if(i){let rt=0;const st=[];for(let at=0;at<h.length;++at){const ct=h[at].index;for(let pt=0;pt<ct.count;++pt)st.push(ct.getX(pt)+rt);rt+=h[at].attributes.position.count}et.setIndex(st)}for(const rt in c){const st=jt(c[rt]);if(!st)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+rt+" attribute."),null;et.setAttribute(rt,st)}for(const rt in g){const st=g[rt][0].length;if(st===0)break;et.morphAttributes=et.morphAttributes||{},et.morphAttributes[rt]=[];for(let at=0;at<st;++at){const ct=[];for(let gt=0;gt<g[rt].length;++gt)ct.push(g[rt][gt][at]);const pt=jt(ct);if(!pt)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+rt+" morphAttribute."),null;et.morphAttributes[rt].push(pt)}}return et}function jt(h){let e,i,s,o=0;for(let b=0;b<h.length;++b){const et=h[b];if(et.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=et.array.constructor),e!==et.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=et.itemSize),i!==et.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(s===void 0&&(s=et.normalized),s!==et.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;o+=et.array.length}const c=new e(o);let g=0;for(let b=0;b<h.length;++b)c.set(h[b].array,g),g+=h[b].array.length;return new _.TlE(c,i,s)}function Wt(h){return h.isInstancedInterleavedBufferAttribute||h.isInterleavedBufferAttribute?Bn(h):h.isInstancedBufferAttribute?new _.lb7().copy(h):new _.TlE().copy(h)}function Zt(h){let e,i=0,s=0;for(let tt=0,rt=h.length;tt<rt;++tt){const st=h[tt];if(e===void 0&&(e=st.array.constructor),e!==st.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;i+=st.array.length,s+=st.itemSize}const o=new _.vpT(new e(i),s);let c=0;const g=[],b=["getX","getY","getZ","getW"],et=["setX","setY","setZ","setW"];for(let tt=0,rt=h.length;tt<rt;tt++){const st=h[tt],at=st.itemSize,ct=st.count,pt=new _.kB5(o,at,c,st.normalized);g.push(pt),c+=at;for(let gt=0;gt<ct;gt++)for(let At=0;At<at;At++)pt[et[At]](gt,st[b[At]](gt))}return g}function Bn(h){const e=h.data.array.constructor,i=h.count,s=h.itemSize,o=h.normalized,c=new e(i*s);let g;g=h.isInstancedInterleavedBufferAttribute?new _.lb7(c,s,o,h.meshPerAttribute):new _.TlE(c,s,o);for(let b=0;b<i;b++)g.setX(b,h.getX(b)),s>=2&&g.setY(b,h.getY(b)),s>=3&&g.setZ(b,h.getZ(b)),s>=4&&g.setW(b,h.getW(b));return g}function Qt(h){const e=h.attributes,i=h.morphTargets,s=new Map;for(const o in e){const c=e[o];c.isInterleavedBufferAttribute&&(s.has(c)||s.set(c,Bn(c)),e[o]=s.get(c))}for(const o in i){const c=i[o];c.isInterleavedBufferAttribute&&(s.has(c)||s.set(c,Bn(c)),i[o]=s.get(c))}}function Kt(h){let e=0;for(const s in h.attributes){const o=h.getAttribute(s);e+=o.count*o.itemSize*o.array.BYTES_PER_ELEMENT}const i=h.getIndex();return e+=i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0,e}function an(h,e=1e-4){const i=e>0;e=Math.max(e,Number.EPSILON);const s={},o=h.getIndex(),c=h.getAttribute("position"),g=o?o.count:c.count;let b=0;const et=Object.keys(h.attributes),tt={},rt={},st=[],at=["getX","getY","getZ","getW"],ct=["setX","setY","setZ","setW"];for(let xt=0,yt=et.length;xt<yt;xt++){const _t=et[xt],Mt=h.attributes[_t];tt[_t]=new _.TlE(new Mt.array.constructor(Mt.count*Mt.itemSize),Mt.itemSize,Mt.normalized);const It=h.morphAttributes[_t];It&&(rt[_t]=new _.TlE(new It.array.constructor(It.count*It.itemSize),It.itemSize,It.normalized))}const pt=Math.log10(1/e),gt=Math.pow(10,pt);for(let xt=0;xt<g;xt++){const yt=o?o.getX(xt):xt;let _t="";for(let Mt=0,It=et.length;Mt<It&&i;Mt++){const Bt=et[Mt],Lt=h.getAttribute(Bt),Ht=Lt.itemSize;for(let Jt=0;Jt<Ht;Jt++)_t+=~~(Lt[at[Jt]](yt)*gt)+","}if(i&&_t in s)st.push(s[_t]);else{for(let Mt=0,It=et.length;Mt<It;Mt++){const Bt=et[Mt],Lt=h.getAttribute(Bt),Ht=h.morphAttributes[Bt],Jt=Lt.itemSize,sn=tt[Bt],on=rt[Bt];for(let mn=0;mn<Jt;mn++){const cn=at[mn],un=ct[mn];if(sn[un](b,Lt[cn](yt)),Ht)for(let bn=0,xn=Ht.length;bn<xn;bn++)on[bn][un](b,Ht[bn][cn](yt))}}i&&(s[_t]=b),st.push(b),b++}}const At=h.clone();for(const xt in h.attributes){const yt=tt[xt];if(At.setAttribute(xt,new _.TlE(yt.array.slice(0,b*yt.itemSize),yt.itemSize,yt.normalized)),xt in rt)for(let _t=0;_t<rt[xt].length;_t++){const Mt=rt[xt][_t];At.morphAttributes[xt][_t]=new _.TlE(Mt.array.slice(0,b*Mt.itemSize),Mt.itemSize,Mt.normalized)}}return At.setIndex(st),At}function yn(h,e){if(e===_.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),h;if(e===_.z$h||e===_.UlW){let i=h.getIndex();if(i===null){const g=[],b=h.getAttribute("position");if(b===void 0)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),h;for(let et=0;et<b.count;et++)g.push(et);h.setIndex(g),i=h.getIndex()}const s=i.count-2,o=[];if(e===_.z$h)for(let g=1;g<=s;g++)o.push(i.getX(0)),o.push(i.getX(g)),o.push(i.getX(g+1));else for(let g=0;g<s;g++)g%2==0?(o.push(i.getX(g)),o.push(i.getX(g+1)),o.push(i.getX(g+2))):(o.push(i.getX(g+2)),o.push(i.getX(g+1)),o.push(i.getX(g)));o.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const c=h.clone();return c.setIndex(o),c.clearGroups(),c}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),h}function Xn(h){const e=new _.Pa4,i=new _.Pa4,s=new _.Pa4,o=new _.Pa4,c=new _.Pa4,g=new _.Pa4,b=new _.Pa4,et=new _.Pa4,tt=new _.Pa4;function rt(Cn,Jn,Kn,gr,nr,tr,Cr,Ar){e.fromBufferAttribute(Jn,nr),i.fromBufferAttribute(Jn,tr),s.fromBufferAttribute(Jn,Cr);const Hr=Cn.morphTargetInfluences;if(Kn&&Hr){b.set(0,0,0),et.set(0,0,0),tt.set(0,0,0);for(let Jr=0,cs=Kn.length;Jr<cs;Jr++){const Os=Hr[Jr],Ss=Kn[Jr];Os!==0&&(o.fromBufferAttribute(Ss,nr),c.fromBufferAttribute(Ss,tr),g.fromBufferAttribute(Ss,Cr),gr?(b.addScaledVector(o,Os),et.addScaledVector(c,Os),tt.addScaledVector(g,Os)):(b.addScaledVector(o.sub(e),Os),et.addScaledVector(c.sub(i),Os),tt.addScaledVector(g.sub(s),Os)))}e.add(b),i.add(et),s.add(tt)}Cn.isSkinnedMesh&&(Cn.applyBoneTransform(nr,e),Cn.applyBoneTransform(tr,i),Cn.applyBoneTransform(Cr,s)),Ar[3*nr+0]=e.x,Ar[3*nr+1]=e.y,Ar[3*nr+2]=e.z,Ar[3*tr+0]=i.x,Ar[3*tr+1]=i.y,Ar[3*tr+2]=i.z,Ar[3*Cr+0]=s.x,Ar[3*Cr+1]=s.y,Ar[3*Cr+2]=s.z}const st=h.geometry,at=h.material;let ct,pt,gt;const At=st.index,xt=st.attributes.position,yt=st.morphAttributes.position,_t=st.morphTargetsRelative,Mt=st.attributes.normal,It=st.morphAttributes.position,Bt=st.groups,Lt=st.drawRange;let Ht,Jt,sn,on,mn,cn,un;const bn=new Float32Array(xt.count*xt.itemSize),xn=new Float32Array(Mt.count*Mt.itemSize);if(At!==null)if(Array.isArray(at))for(Ht=0,sn=Bt.length;Ht<sn;Ht++)for(mn=Bt[Ht],cn=Math.max(mn.start,Lt.start),un=Math.min(mn.start+mn.count,Lt.start+Lt.count),Jt=cn,on=un;Jt<on;Jt+=3)ct=At.getX(Jt),pt=At.getX(Jt+1),gt=At.getX(Jt+2),rt(h,xt,yt,_t,ct,pt,gt,bn),rt(h,Mt,It,_t,ct,pt,gt,xn);else for(cn=Math.max(0,Lt.start),un=Math.min(At.count,Lt.start+Lt.count),Ht=cn,sn=un;Ht<sn;Ht+=3)ct=At.getX(Ht),pt=At.getX(Ht+1),gt=At.getX(Ht+2),rt(h,xt,yt,_t,ct,pt,gt,bn),rt(h,Mt,It,_t,ct,pt,gt,xn);else if(Array.isArray(at))for(Ht=0,sn=Bt.length;Ht<sn;Ht++)for(mn=Bt[Ht],cn=Math.max(mn.start,Lt.start),un=Math.min(mn.start+mn.count,Lt.start+Lt.count),Jt=cn,on=un;Jt<on;Jt+=3)ct=Jt,pt=Jt+1,gt=Jt+2,rt(h,xt,yt,_t,ct,pt,gt,bn),rt(h,Mt,It,_t,ct,pt,gt,xn);else for(cn=Math.max(0,Lt.start),un=Math.min(xt.count,Lt.start+Lt.count),Ht=cn,sn=un;Ht<sn;Ht+=3)ct=Ht,pt=Ht+1,gt=Ht+2,rt(h,xt,yt,_t,ct,pt,gt,bn),rt(h,Mt,It,_t,ct,pt,gt,xn);return{positionAttribute:xt,normalAttribute:Mt,morphedPositionAttribute:new _.a$l(bn,3),morphedNormalAttribute:new _.a$l(xn,3)}}function rr(h){if(h.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),h;let e=h.groups;if(e=e.sort((g,b)=>g.materialIndex!==b.materialIndex?g.materialIndex-b.materialIndex:g.start-b.start),h.getIndex()===null){const g=h.getAttribute("position"),b=[];for(let et=0;et<g.count;et+=3)b.push(et,et+1,et+2);h.setIndex(b)}const i=h.getIndex(),s=[];for(let g=0;g<e.length;g++){const b=e[g],et=b.start,tt=et+b.count;for(let rt=et;rt<tt;rt++)s.push(i.getX(rt))}h.dispose(),h.setIndex(s);let o=0;for(let g=0;g<e.length;g++){const b=e[g];b.start=o,o+=b.count}let c=e[0];h.groups=[c];for(let g=1;g<e.length;g++){const b=e[g];c.materialIndex===b.materialIndex?c.count+=b.count:(c=b,h.groups.push(c))}return h}function vr(h,e=Math.PI/3){const i=Math.cos(e),s=100*(1+1e-10),o=[new _.Pa4,new _.Pa4,new _.Pa4],c=new _.Pa4,g=new _.Pa4,b=new _.Pa4,et=new _.Pa4;function tt(gt){return`${~~(gt.x*s)},${~~(gt.y*s)},${~~(gt.z*s)}`}const rt=h.toNonIndexed(),st=rt.attributes.position,at={};for(let gt=0,At=st.count/3;gt<At;gt++){const xt=3*gt,yt=o[0].fromBufferAttribute(st,xt+0),_t=o[1].fromBufferAttribute(st,xt+1),Mt=o[2].fromBufferAttribute(st,xt+2);c.subVectors(Mt,_t),g.subVectors(yt,_t);const It=new _.Pa4().crossVectors(c,g).normalize();for(let Bt=0;Bt<3;Bt++){const Lt=tt(o[Bt]);Lt in at||(at[Lt]=[]),at[Lt].push(It)}}const ct=new Float32Array(3*st.count),pt=new _.TlE(ct,3,!1);for(let gt=0,At=st.count/3;gt<At;gt++){const xt=3*gt,yt=o[0].fromBufferAttribute(st,xt+0),_t=o[1].fromBufferAttribute(st,xt+1),Mt=o[2].fromBufferAttribute(st,xt+2);c.subVectors(Mt,_t),g.subVectors(yt,_t),b.crossVectors(c,g).normalize();for(let It=0;It<3;It++){const Bt=at[tt(o[It])];et.set(0,0,0);for(let Lt=0,Ht=Bt.length;Lt<Ht;Lt++){const Jt=Bt[Lt];b.dot(Jt)>i&&et.add(Jt)}et.normalize(),pt.setXYZ(xt+It,et.x,et.y,et.z)}}return rt.setAttribute("normal",pt),rt}function Wn(h,e=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),kn(h,e)}function ir(h){return console.warn("THREE.BufferGeometryUtils: mergeBufferAttributes() has been renamed to mergeAttributes()."),jt(h)}function zn(h,e){let i,s;if(Array.isArray(h))for(const c of h){const g=zn(c,e);i===void 0||s===void 0?(i=g.min.clone(),s=g.max.clone()):(i.min(g.min),s.max(g.max))}const o=h;if(o.geometry!==void 0){const c=o.geometry.vertices;if(c===void 0&&o.geometry.attributes!==void 0&&"position"in o.geometry.attributes){const g=new _.Pa4,b=o.geometry.attributes.position;for(let et=0;et<b.count*b.itemSize;et+=b.itemSize){g.set(b.array[et],b.array[et+1],b.array[3]);const tt=g.applyMatrix4(h.matrixWorld).project(e),rt=new tn(tt.x,tt.y);i===void 0||s===void 0?(i=rt.clone(),s=rt.clone()):(i.min(rt),s.max(rt))}}else for(const g of c){const b=g.clone().applyMatrix4(h.matrixWorld).project(e),et=new tn(b.x,b.y);i===void 0||s===void 0?(i=et.clone(),s=et.clone()):(i.min(et),s.max(et))}}if(h.children!==void 0)for(const c of h.children){const g=zn(c,e);i===void 0||s===void 0?(i=g.min.clone(),s=g.max.clone()):(i.min(g.min),s.max(g.max))}return new _.TUj(i,s)}const cr="rgbm-16";function ur(h){switch(h){case _.aCh:case _.GUF:return["Linear","( value )"];case _.KI_:return["sRGB","( value )"];case cr:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported colorSpace:",h),["Linear","( value )"]}}function Sr(h,e){let i;return h&&h.isTexture?i=h.colorSpace:h&&h.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=h.texture.colorSpace):i=_.GUF,e&&h&&h.isTexture&&h.format===_.wk1&&h.type===_.ywz&&h.colorSpace===_.KI_&&(i=_.GUF),i}function _i(h,e){const i=ur(e);return"vec4 "+h+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function rn(h,e,i){return _i(h+"TexelToLinear",Sr(e,i))+`
`}function Dn(h,e){return _i(h+"TexelToLinear",e)+`
`}function Qn(h,e){const i=ur(e);return"vec4 "+h+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function jr(h,e,i){return Qn(h,Sr(e,i))}function hr({uniforms:h,propKey:e,thisTarget:i=!1}={}){const s=!!h,o=!!e,c=i;return(g,b)=>{const et=tt=>{const rt=c?tt:s?h:tt.uniforms||tt._uniforms;let st=o?e:b;c&&(st="_"+st);let at=rt[st];return at||(at={value:null},rt[st]=at),at};Object.defineProperty(g,b,{get(){return et(this).value},set(tt){et(this).value=tt,(0,_e.safeSetProperty)(this,"uniformsNeedUpdate",!0,!0)}})}}function Kr(h,e,i=!1,s){const o=!!e,c=!!h;return(g,b)=>{const et=tt=>({t:o?e:tt.defines||tt._defines,p:c?h:b});Object.defineProperty(g,b,{get(){const{t:tt,p:rt}=et(i?this:this.material);return tt[rt]},set(tt){const{t:rt,p:st}=et(i?this:this.material);if((0,_e.safeSetProperty)(rt,st,tt,!0),typeof s=="function"){const at=[st,tt];if(s.name){const ct=this[s.name];ct===s?s.call(this,...at):ct.name===`bound ${s.name}`?ct(...at):s(...at)}else s(...at)}else(0,_e.safeSetProperty)(i?this:this.material,"needsUpdate",!0,!0)}})}}function Js(h){const e=new _.IEO(new Uint8Array([Math.floor(255*h.r),Math.floor(255*h.g),Math.floor(255*h.b),255]),1,1,_.wk1,_.ywz);return e.needsUpdate=!0,e.colorSpace=_.aCh,e}function fo(h){const e=new _.IEO(new Uint8Array([Math.floor(255*h.x),Math.floor(255*h.y),Math.floor(255*h.z),Math.floor(255*h.w)]),1,1,_.wk1,_.ywz);return e.needsUpdate=!0,e}function no(h,e,i){const s=h.userData,{backgroundRender:o,transparentRender:c,shadowMapRender:g,mainRenderPass:b,opaqueRender:et,transmissionRender:tt,sceneRender:rt,screenSpaceRendering:st}=s;e.backgroundRender!==void 0&&(s.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(s.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(s.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(s.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(s.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(s.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(s.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(s.screenSpaceRendering=e.screenSpaceRendering),i(),s.backgroundRender=o,s.transparentRender=c,s.shadowMapRender=g,s.mainRenderPass=b,s.opaqueRender=et,s.sceneRender=rt,s.transmissionRender=tt,s.screenSpaceRendering=st}function ba(h){const e=new Xt().expandByObject(h,!0,!0).getCenter(new _.Pa4);h.position.sub(e),h.updateMatrix(),h.userData.autoCentered=!0,h.userData.isCentered=!0}function Mo(h,e,i){const s=.5*new Xt().expandByObject(h,!0,!0).getSize(new _.Pa4).length();e===void 0&&(e=h.userData.autoScaleRadius||1);const o=e/s;return isFinite(o)&&(h.userData.pseudoCentered?h.children.forEach(c=>{c.scale.multiplyScalar(o)}):h.scale.multiplyScalar(o),(i||h.userData.isCentered)&&h.position.multiplyScalar(o),h.traverse(c=>{var g,b;c.isLight&&((b=(g=c.shadow)==null?void 0:g.camera)!=null&&b.right)&&(c.shadow.camera.right*=o,c.shadow.camera.left*=o,c.shadow.camera.top*=o,c.shadow.camera.bottom*=o),c.isCamera&&c.right&&(c.right*=o,c.left*=o,c.top*=o,c.bottom*=o)}),h.userData.autoScaled=!0,h.userData.autoScaleRadius=e,h.dispatchEvent({type:"objectUpdate"})),h}function _c(h,e=-1){return an(h,e)}const Cl=2,$a=3,Jp=0,bm=1,Hl=3,Ql=4,Ml=1006,Ll=3001,_l="srgb",Np="srgb-linear",wm="display-p3";class Tl{constructor(){Tl.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,i,s,o,c,g,b,et,tt){const rt=this.elements;return rt[0]=e,rt[1]=o,rt[2]=b,rt[3]=i,rt[4]=c,rt[5]=et,rt[6]=s,rt[7]=g,rt[8]=tt,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this}extractBasis(e,i,s){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,o=i.elements,c=this.elements,g=s[0],b=s[3],et=s[6],tt=s[1],rt=s[4],st=s[7],at=s[2],ct=s[5],pt=s[8],gt=o[0],At=o[3],xt=o[6],yt=o[1],_t=o[4],Mt=o[7],It=o[2],Bt=o[5],Lt=o[8];return c[0]=g*gt+b*yt+et*It,c[3]=g*At+b*_t+et*Bt,c[6]=g*xt+b*Mt+et*Lt,c[1]=tt*gt+rt*yt+st*It,c[4]=tt*At+rt*_t+st*Bt,c[7]=tt*xt+rt*Mt+st*Lt,c[2]=at*gt+ct*yt+pt*It,c[5]=at*At+ct*_t+pt*Bt,c[8]=at*xt+ct*Mt+pt*Lt,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[1],o=e[2],c=e[3],g=e[4],b=e[5],et=e[6],tt=e[7],rt=e[8];return i*g*rt-i*b*tt-s*c*rt+s*b*et+o*c*tt-o*g*et}invert(){const e=this.elements,i=e[0],s=e[1],o=e[2],c=e[3],g=e[4],b=e[5],et=e[6],tt=e[7],rt=e[8],st=rt*g-b*tt,at=b*et-rt*c,ct=tt*c-g*et,pt=i*st+s*at+o*ct;if(pt===0)return this.set(0,0,0,0,0,0,0,0,0);const gt=1/pt;return e[0]=st*gt,e[1]=(o*tt-rt*s)*gt,e[2]=(b*s-o*g)*gt,e[3]=at*gt,e[4]=(rt*i-o*et)*gt,e[5]=(o*c-b*i)*gt,e[6]=ct*gt,e[7]=(s*et-tt*i)*gt,e[8]=(g*i-s*c)*gt,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,s,o,c,g,b){const et=Math.cos(c),tt=Math.sin(c);return this.set(s*et,s*tt,-s*(et*g+tt*b)+g+e,-o*tt,o*et,-o*(-tt*g+et*b)+b+i,0,0,1),this}scale(e,i){return this.premultiply(tp.makeScale(e,i)),this}rotate(e){return this.premultiply(tp.makeRotation(-e)),this}translate(e,i){return this.premultiply(tp.makeTranslation(e,i)),this}makeTranslation(e,i){return this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,s,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,s=e.elements;for(let o=0;o<9;o++)if(i[o]!==s[o])return!1;return!0}fromArray(e,i=0){for(let s=0;s<9;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const tp=new Tl;function Yo(h){return h<.04045?.0773993808*h:Math.pow(.9478672986*h+.0521327014,2.4)}function $p(h){return h<.0031308?12.92*h:1.055*Math.pow(h,.41666)-.055}const UM=new Tl().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),n_=new Tl().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),TS={[Np]:h=>h,[_l]:h=>h.convertSRGBToLinear(),[wm]:function(h){return h.convertSRGBToLinear().applyMatrix3(n_)}},Il={[Np]:h=>h,[_l]:h=>h.convertLinearToSRGB(),[wm]:function(h){return h.applyMatrix3(UM).convertLinearToSRGB()}},yp={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(h){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!h},get workingColorSpace(){return Np},set workingColorSpace(h){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(h,e,i){if(this.enabled===!1||e===i||!e||!i)return h;const s=TS[e],o=Il[i];if(s===void 0||o===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${i}".`);return o(s(h))},fromWorkingColorSpace:function(h,e){return this.convert(h,this.workingColorSpace,e)},toWorkingColorSpace:function(h,e){return this.convert(h,e,this.workingColorSpace)}},nx={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Au={h:0,s:0,l:0},my={h:0,s:0,l:0};function _v(h,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?h+6*(e-h)*i:i<.5?e:i<2/3?h+6*(e-h)*(2/3-i):h}class zo{constructor(e,i,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,i===void 0&&s===void 0?this.set(e):this.setRGB(e,i,s)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=_l){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,yp.toWorkingColorSpace(this,i),this}setRGB(e,i,s,o=yp.workingColorSpace){return this.r=e,this.g=i,this.b=s,yp.toWorkingColorSpace(this,o),this}setHSL(e,i,s,o=yp.workingColorSpace){if(e=function(c,g){return(c%g+g)%g}(e,1),i=nn(i,0,1),s=nn(s,0,1),i===0)this.r=this.g=this.b=s;else{const c=s<=.5?s*(1+i):s+i-s*i,g=2*s-c;this.r=_v(g,c,e+1/3),this.g=_v(g,c,e),this.b=_v(g,c,e-1/3)}return yp.toWorkingColorSpace(this,o),this}setStyle(e,i=_l){function s(c){c!==void 0&&parseFloat(c)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let o;if(o=/^(\w+)\(([^\)]*)\)/.exec(e)){let c;const g=o[1],b=o[2];switch(g){case"rgb":case"rgba":if(c=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(b))return s(c[4]),this.setRGB(Math.min(255,parseInt(c[1],10))/255,Math.min(255,parseInt(c[2],10))/255,Math.min(255,parseInt(c[3],10))/255,i);if(c=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(b))return s(c[4]),this.setRGB(Math.min(100,parseInt(c[1],10))/100,Math.min(100,parseInt(c[2],10))/100,Math.min(100,parseInt(c[3],10))/100,i);break;case"hsl":case"hsla":if(c=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(b))return s(c[4]),this.setHSL(parseFloat(c[1])/360,parseFloat(c[2])/100,parseFloat(c[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(e)){const c=o[1],g=c.length;if(g===3)return this.setRGB(parseInt(c.charAt(0),16)/15,parseInt(c.charAt(1),16)/15,parseInt(c.charAt(2),16)/15,i);if(g===6)return this.setHex(parseInt(c,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=_l){const s=nx[e.toLowerCase()];return s!==void 0?this.setHex(s,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Yo(e.r),this.g=Yo(e.g),this.b=Yo(e.b),this}copyLinearToSRGB(e){return this.r=$p(e.r),this.g=$p(e.g),this.b=$p(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=_l){return yp.fromWorkingColorSpace(eu.copy(this),e),65536*Math.round(nn(255*eu.r,0,255))+256*Math.round(nn(255*eu.g,0,255))+Math.round(nn(255*eu.b,0,255))}getHexString(e=_l){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=yp.workingColorSpace){yp.fromWorkingColorSpace(eu.copy(this),i);const s=eu.r,o=eu.g,c=eu.b,g=Math.max(s,o,c),b=Math.min(s,o,c);let et,tt;const rt=(b+g)/2;if(b===g)et=0,tt=0;else{const st=g-b;switch(tt=rt<=.5?st/(g+b):st/(2-g-b),g){case s:et=(o-c)/st+(o<c?6:0);break;case o:et=(c-s)/st+2;break;case c:et=(s-o)/st+4}et/=6}return e.h=et,e.s=tt,e.l=rt,e}getRGB(e,i=yp.workingColorSpace){return yp.fromWorkingColorSpace(eu.copy(this),i),e.r=eu.r,e.g=eu.g,e.b=eu.b,e}getStyle(e=_l){yp.fromWorkingColorSpace(eu.copy(this),e);const i=eu.r,s=eu.g,o=eu.b;return e!==_l?`color(${e} ${i.toFixed(3)} ${s.toFixed(3)} ${o.toFixed(3)})`:`rgb(${Math.round(255*i)},${Math.round(255*s)},${Math.round(255*o)})`}offsetHSL(e,i,s){return this.getHSL(Au),Au.h+=e,Au.s+=i,Au.l+=s,this.setHSL(Au.h,Au.s,Au.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,s){return this.r=e.r+(i.r-e.r)*s,this.g=e.g+(i.g-e.g)*s,this.b=e.b+(i.b-e.b)*s,this}lerpHSL(e,i){this.getHSL(Au),e.getHSL(my);const s=Hn(Au.h,my.h,i),o=Hn(Au.s,my.s,i),c=Hn(Au.l,my.l,i);return this.setHSL(s,o,c),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,s=this.g,o=this.b,c=e.elements;return this.r=c[0]*i+c[3]*s+c[6]*o,this.g=c[1]*i+c[4]*s+c[7]*o,this.b=c[2]*i+c[5]*s+c[8]*o,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const eu=new zo;function Ko(h,e){return{type:"folder",label:e+" Sampler",hidden:()=>!h[e],children:[()=>({type:"vec2",label:"Repeat",bounds:[-100,100],stepSize:.001,property:[h[e],"repeat"],onChange:h==null?void 0:h.setDirty}),()=>({type:"vec2",label:"Offset",bounds:[-2,2],stepSize:.001,property:[h[e],"offset"],onChange:h==null?void 0:h.setDirty}),()=>({type:"vec2",label:"Center",bounds:[-2,2],stepSize:.001,property:[h[e],"center"],onChange:h==null?void 0:h.setDirty}),()=>({type:"input",label:"Rotation",stepSize:.001,bounds:[-Math.PI,Math.PI],property:[h[e],"rotation"],onChange:h==null?void 0:h.setDirty}),()=>({type:"dropdown",label:"Color Space",property:[h[e],"colorSpace"],children:[["Linear",_.GUF],["sRGB",_.KI_]].map(i=>({label:i[0],value:i[1]})),onChange:[()=>{const i=h[e];i&&(i.needsUpdate=!0)},h==null?void 0:h.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var i;return((i=h[e])==null?void 0:i.flipY)??!1},setValue:i=>{var o;const s=h[e];if(s&&s.flipY!==i)if(s.image&&ImageBitmap&&s.image instanceof ImageBitmap){const c=s,g=s.source.data;createImageBitmap(g,{imageOrientation:"flipY"}).then(b=>{var et;g.close&&g.close(),c.flipY=i,c.source.data=b,c.source.needsUpdate=!0,c.needsUpdate=!0,(et=h==null?void 0:h.setDirty)==null||et.call(h)})}else s.flipY=i,s.needsUpdate=!0,(o=h==null?void 0:h.setDirty)==null||o.call(h)}}),()=>({type:"dropdown",label:"Wrap S",property:[h[e],"wrapS"],children:[["ClampToEdge",_.uWy],["MirroredRepeat",_.OoA],["Repeat",_.rpg]].map(i=>({label:i[0],value:i[1]})),onChange:[()=>{h[e]&&(h[e].needsUpdate=!0)},h==null?void 0:h.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[h[e],"wrapT"],children:[["ClampToEdge",_.uWy],["MirroredRepeat",_.OoA],["Repeat",_.rpg]].map(i=>({label:i[0],value:i[1]})),onChange:[()=>{h[e]&&(h[e].needsUpdate=!0)},h==null?void 0:h.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[h[e],"anisotropy"],onChange:[()=>{h[e]&&(h[e].needsUpdate=!0),h.needsUpdate=!0},h==null?void 0:h.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[h[e],"minFilter"],children:[["Linear",Ml],["Nearest",_.TyD],["NearestMipmapNearest",_.YLQ],["NearestMipmapLinear",_.vZf],["LinearMipmapNearest",_.qyh],["LinearMipmapLinear",_.D1R]].map(i=>({label:i[0],value:i[1]})),onChange:[()=>{h[e]&&(h[e].needsUpdate=!0)},h==null?void 0:h.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[h[e],"magFilter"],children:[["Linear",Ml],["Nearest",_.TyD]].map(i=>({label:i[0],value:i[1]})),onChange:[()=>{h[e]&&(h[e].needsUpdate=!0)},h==null?void 0:h.setDirty]})]}}zo.NAMES=nx;const DA=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function Pu(h,e,i=!0){if(!e)return h;for(const s of Object.keys(e)){if(i&&DA.includes(s)||s.startsWith("__"))continue;const o=e[s];if(typeof h[s]=="function"||typeof o=="function")continue;const c=!o||o.isTexture||o.isObject3D||o.isMaterial;c||typeof o.clone!="function"?c||typeof o!="object"&&!Array.isArray(o)?h[s]=o:h[s]=Pu(Array.isArray(o)?[]:{},o,!1):h[s]=o.clone()}return h}const yv=["appliedMaterials","uuid"];function Zp(h,e){if(e)for(const i of Object.keys(e))yv.includes(i)||i.startsWith("__")||typeof h[i]!="function"&&typeof e[i]!="function"&&(h[i]=e[i]);return h}function gy(h,e,i){const s=(i==null?void 0:i.data)??new Uint8ClampedArray(h.height*h.width*4),o=h.data instanceof Float32Array,c=h.data instanceof Uint16Array;for(let g=0;g<s.length;g++)s[g]=o?255*h.data[g]:c?255*_.A5E.fromHalfFloat(h.data[g]):h.data[g],e===_.GUF&&(s[g]=255*(0,_e.LinearToSRGB)(s[g]/255));return i??new ImageData(s,h.width,h.height)}function vy(h,e,i=!1){let s;return s=h.isDataTexture?gy(h.image,h.colorSpace):h.image,O_(s,e,i)}function O_(h,e,i=!1){const s=document.createElement("canvas");s.width=Math.min(e,h.width),s.height=Math.floor(1+s.width*h.height/h.width);const o=s.getContext("2d");if(!o)return console.error("textureToDataUrl: could not get canvas context"),s;i===!0&&(o.translate(0,s.height),o.scale(1,-1));let c=!1;if(h.data!==void 0){const g=h;if(h.width!==s.width||h.height!==s.height){const b=document.createElement("canvas");b.width=h.width,b.height=h.height;const et=b.getContext("2d");et?(et.putImageData(g,0,0),o.drawImage(b,0,0,s.width,s.height)):(console.error("textureToDataUrl: could not get temp canvas context"),o.putImageData(g,0,0))}else o.putImageData(g,0,0),i&&(c=!0)}else o.drawImage(h,0,0,s.width,s.height);return c?(0,_e.canvasFlipY)(s):s}function P1(h,e,i,s,o){return vy(h,e,i).toDataURL(s,o)}String.prototype.replaceAll||(String.prototype.replaceAll=function(h,e){return Object.prototype.toString.call(h).toLowerCase()==="[object regexp]"?this.replace(h,e):this.replace(new RegExp(h,"g"),e)});const Hu=new Map;function Mn(h){return(e,i)=>{const s=e.constructor;if(s===Object)throw new Error("All properties in an object are serialized by default");Hu.has(s)||Hu.set(s,[]),Hu.get(s).push([h||i,i])}}const Wm={obj:(h,e)=>Object.fromEntries(Object.entries(h).map(([i,s])=>[i,To(s,!1,e)])),vec4:h=>({x:h.x,y:h.y,z:h.z,w:h.w,isVector4:!0}),vec3:h=>({x:h.x,y:h.y,z:h.z,isVector3:!0}),vec2:h=>({x:h.x,y:h.y,isVector2:!0}),color:h=>({r:h.r,g:h.g,b:h.b,isColor:!0}),quat:h=>({x:h.x,y:h.y,z:h.z,w:h.w,isQuaternion:!0}),texture:(h,e)=>{var b;if(!(h!=null&&h.isTexture))throw new Error("Expected a texture");if(e!=null&&e.textures[h.uuid])return{uuid:h.uuid,resource:"textures"};if(h.isRenderTargetTexture&&!((b=h.userData)!=null&&b.serializableRenderTarget))return;const i=h.source.data,s=!h.isRenderTargetTexture&&h.userData.rootPath;s&&h.source.data&&(h.userData.__embedUrlImagePreviews?h.source.data=vy(h,16,h.flipY):h.source.data=null);const o=h.userData;h.userData={};const c={images:{}};let g=h.toJSON(e||c);return!e&&g.image&&(g.image=s&&!h.userData.__embedUrlImagePreviews?void 0:c.images[g.image]),h.userData=o,g.userData=To(Zp({},o),!1,e),s&&(e&&!h.userData.__embedUrlImagePreviews&&delete e.images[h.source.uuid],h.source.data=i),e!=null&&e.textures&&!g.resource&&(e.textures[g.uuid]||(e.textures[g.uuid]=g),g={uuid:g.uuid,resource:"textures"}),g},material:(h,e)=>{if(!(h!=null&&h.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[h.uuid])return{uuid:h.uuid,resource:"materials"};h.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const i=e??{textures:{},images:{}},s={},o={};for(const[g,b]of Object.entries(h))if(b!=null&&b.isTexture&&!g.startsWith("__")){const et=Wm.texture(b,i);s[g]=et,o[g]=b,h[g]=et?{isTexture:!0,toJSON:()=>et}:null}let c=h.toJSON(e);for(const[g,b]of Object.entries(o))h[g]=b,delete o[g];if(e){for(const[g,b]of Object.entries(s))b&&(c[g]=b);e!=null&&e.materials&&(e.materials[c.uuid]||(e.materials[c.uuid]=c),c={uuid:c.uuid,resource:"materials"})}else{for(const[g,b]of Object.entries(s))b&&(c[g]=b.uuid);c.textures=Object.values(i.textures),c.images=Object.values(i.images)}return c}},xm=h=>(e,i)=>{var s;return((s=i==null?void 0:i.copy)==null?void 0:s.call(i,e))??new h().copy(e)},Up={obj:(h,e,i)=>Object.assign(e,Object.fromEntries(Object.entries(h).map(([s,o])=>[s,Oo(o,e==null?void 0:e[s],!1,i)]))),vec4:xm(_.Ltg),vec3:xm(_.Pa4),vec2:xm(tn),color:xm(zo),quat:xm(_._fP)};function To(h,e,i){var c;if(typeof h=="function")return;if(Array.isArray(h))return h.map(g=>To(g,!1,i));if(typeof h!="object"){if(typeof h=="number"){if(h===1/0)return"Infinity";if(h===-1/0)return"-Infinity";if(isNaN(h))return"NaN"}return h}if(!h)return h;let s=h.constructor??Object;if(s===Object)return Wm.obj(h,i);if(h.isVector2)return Wm.vec2(h);if(h.isVector3)return Wm.vec3(h);if(h.isVector4)return Wm.vec4(h);if(h.isColor)return Wm.color(h);if(h.isQuaternion)return Wm.quat(h);if(h.isTexture)return Wm.texture(h,i);if(h.isMaterial)return Wm.material(h,i);if(!e&&typeof h.toJSON=="function"){const g=h.toJSON(i);return h.serializableClassId&&g&&(g.serializableClassId=h.serializableClassId),g}const o={};for(;s&&s!==Object;)(c=Hu.get(s))==null||c.forEach(([g,b])=>{const et=h[b];o[g]=To(et,!1,i)}),s=Object.getPrototypeOf(s);return h.serializableClassId&&(o.serializableClassId=h.serializableClassId),o}function Oo(h,e,i,s){var b,et;let o=e;if(h===void 0)return o;if(typeof e=="number"){if(h==="Infinity")return 1/0;if(h==="-Infinity")return-1/0;if(h==="NaN")return NaN;if(typeof h=="number"||!h)return h}if(Array.isArray(h)){const tt=h.length;Array.isArray(o)||(o=[]);for(let rt=0;rt<tt;rt++){const st=h[rt],at=o.length>rt?Oo(st,o[rt],!1,s):Oo(st,void 0,!1,s);o.length<=rt?o.push(at):o[rt]=at}return o}let c=!1;if(h&&h.resource&&typeof h.resource=="string"&&(h=(b=s[h.resource])==null?void 0:b[h.uuid],c=!0),!o&&h&&!c)if(h.serializableClassId){const tt=R1.get(h.serializableClassId);tt&&(o=tt.DataInConstructor?new tt(h):new tt)}else typeof h!="object"||h.constructor&&h.constructor!==Object||(o={});if(typeof o=="function")return console.error("cannot deserialize over function",o,h),o;if(h&&typeof h=="object"&&!c){if(h.isVector2)return Up.vec2(h,o);if(h.isVector3)return Up.vec3(h,o);if(h.isVector4)return Up.vec4(h,o);if(h.isColor)return Up.color(h,o);if(h.isQuaternion)return Up.quat(h,o)}if(h==null||o==null||typeof o!="object"||o.isTexture)return c&&(h?h.__useCount=h.__useCount?h.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),h;let g=o.constructor??Object;if(g===Object)return Up.obj(h,o,s);if(!i&&typeof o.fromJSON=="function")return o.isMaterial&&(Object.entries(h).forEach(([tt,rt])=>{var at;if(!rt||!rt.resource||typeof rt.resource!="string")return;const st=(at=s[rt.resource])==null?void 0:at[rt.uuid];h[tt]=st||null}),h.userData&&(h.userData=Oo(h.userData,void 0,!1,s))),o.fromJSON(h,s),o;for(;g&&g!==Object;)(et=Hu.get(g))==null||et.forEach(([tt,rt])=>{const st=o[rt],at=Oo(h[tt],st,!1,s);at!==st&&(0,_e.safeSetProperty)(o,rt,at,!0)}),g=Object.getPrototypeOf(g);return o}const R1=new Map;function qm(h){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=h}},R1.set(h,e),e)}function ix(h,e,i,s){var g,b,et;if(e!=null&&e.extras[h.uuid])return{uuid:h.uuid,resource:"extras"};let o="";if((g=h.source)!=null&&g._sourceImgBuffer||h.userData.__sourceBuffer){const tt=new Uint8Array(((b=h.source)==null?void 0:b._sourceImgBuffer)||h.userData.__sourceBuffer),rt=s||h.userData.mimeType||"";o={data:Array.from(tt),type:tt.constructor.name,path:((et=h.userData.__sourceBlob)==null?void 0:et.name)||h.userData.rootPath||"file."+rt.split("/")[1]},rt&&(o.mimeType=rt)}else h.userData.rootPath?o=h.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const c={uuid:h.uuid,url:o,userData:Zp({},h.userData),type:h.type,name:i||h.name};return e!=null&&e.extras?(e.extras[h.uuid]=c,{uuid:h.uuid,resource:"extras"}):c}var d0=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let Av=class extends _e.SimpleEventDispatcher{get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(h){h!==this._displayCanvasScaling&&(this._displayCanvasScaling=h,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}get totalFrameCount(){return this._totalFrameCount}set pipeline(h){this._pipeline=h,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){const h=this._passes,e=[],i={};for(const s of h){if(s.enabled===!1)continue;const o={after:s.after??[],before:s.before??[],dependencies:new Set(s.required??[])};i[s.passId]=o}for(const[s,o]of Object.entries(i)){const c=new Set([...o.after,...o.before]);o.dependencies.forEach(g=>c.has(g)&&c.delete(g)),c.forEach(g=>{const b=i[g];if(b){if(b.dependencies.has(s))throw console.error("cyclic",s,g),"Cyclic dependency";o.dependencies.add(g)}})}for(;;){let s=!1;const o=[...Object.entries(i)];for(const[c,g]of o)if(!e.includes(c)&&(0,_e.includesAll)(e,g.dependencies.values())){const b=Math.max(-1,...g.after.map(tt=>e.indexOf(tt))),et=Math.min(e.length,...g.before.map(tt=>{const rt=e.indexOf(tt);return rt<0?e.length:rt}));if(b>=et)throw console.error(g,h,e,b,et),"Not possible";e.splice(g.after.length>0?b+1:et,0,c),s=!0,delete i[c]}if(Object.keys(i).length<1)break;if(!s)throw console.error(o,i,e),"Not possible 2"}return this.pipeline=e,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(h,e){const i=h-this._lastTime;this._lastTime=h,this.frameWaitTime-=i,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:i,time:h,renderer:this,xrFrame:e}))}get clock(){return this._composer.clock}registerPass(h,e=!0){var i;if(e)for(const s of[...this._passes])h.passId===s.passId&&this.unregisterPass(s);this._passes.push(h),(i=h.onRegister)==null||i.call(h,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(h){var i;const e=this._passes.indexOf(h);e>=0&&((i=h.onUnregister)==null||i.call(h,this),this._passes.splice(e,1),this._passesNeedsUpdate=!0,this._updated())}constructor({animationLoop:h,canvas:e,alpha:i=!0,targetOptions:s}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new _.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._totalFrameCount=0,this.stableNoise=!1,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new _.CP7({canvas:e,antialias:!1,alpha:i,premultipliedAlpha:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"}),this._renderer.useLegacyLights=!1,this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderer.onContextLost=o=>{this.dispatchEvent({type:"contextLost",event:o})},this._renderer.onContextRestore=()=>{this.dispatchEvent({type:"contextRestored"})},this._renderSize=new _.FM8(e.clientWidth,e.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=_.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputColorSpace=_.aCh,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=_._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(s,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new pn(this._renderer,this._composerTarget),h&&this.addEventListener("animationLoop",h)}setSize(h,e,i=!1){!i&&(h?Math.abs(h-this._renderSize.width):0)+(e?Math.abs(e-this._renderSize.height):0)<.1||(h&&(this._renderSize.width=h),e&&(this._renderSize.height=e),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(s=>{const o=s,c=o.sizeMultiplier;if(c){const g=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*c);o.setSize(Math.floor(g.width),Math.floor(g.height))}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(h,e,{viewport:i,material:s,shader:o,pass:c,clear:g=!0}={}){const b=this._composer.copyPass,{renderToScreen:et,material:tt,uniforms:rt,clear:st}=b;s&&(b.material=s);const at=this._renderer.getViewport(new _.Ltg),ct=this._renderer.autoClear,pt=this._renderer.getRenderTarget();i&&this._renderer.setViewport(new _.Ltg().fromArray(i)),this._renderer.autoClear=!1,b.uniforms=b.material.uniforms,b.renderToScreen=!1,b.clear=g,no(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{b.render(this._renderer,e??null,{texture:h},0,!1)}),b.renderToScreen=et,b.clear=st,b.material=tt,b.uniforms=rt,this._renderer.autoClear=ct,i&&this._renderer.setViewport(at),this._renderer.setRenderTarget(pt)}clearColor({r:h,g:e,b:i,a:s,target:o,depth:c=!0,stencil:g=!0}){const b=this._renderer.getClearColor(new _.Ilk),et=this._renderer.getClearAlpha();this._renderer.setClearAlpha(s??et),this._renderer.setClearColor(new _.Ilk(h??b.r,e??b.g,i??b.b));const tt=this._renderer.getRenderTarget(),rt=this._renderer.getActiveCubeFace(),st=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget(o??null),this._renderer.clear(!0,c,g),this._renderer.setRenderTarget(tt,rt,st),this._renderer.setClearColor(b),this._renderer.setClearAlpha(et)}renderModel(h,e){this._renderer.render(h.modelObject,e.cameraObject)}renderScene(h){const e=h.activeCamera;e&&this.renderModel(h,e)}_updated(){this.dispatchEvent({type:"update"})}render(h=!0){var e;this._passesNeedsUpdate&&this.refreshPasses();for(const i of this._passes)i.passObject.enabled&&((e=i.update)==null||e.call(i));this._composer.renderToScreen=h,this._composer.render(),this._composer.renderToScreen=!0,h&&(this._frameCount+=1,this._totalFrameCount+=1),this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(h=>h.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const h=[];for(const e of this._pipeline){const i=this._passes.find(s=>s.passId===e);i?h.push(i.passObject):console.warn("Unable to find pass: ",e)}[...this._composer.passes].forEach(e=>this._composer.removePass(e)),h.forEach(e=>this._composer.addPass(e)),this._updated()}dispose(){this._trackedTargets.forEach(h=>h.dispose()),this._trackedTargets=[],this._renderer.dispose()}trackTarget(h){this._trackedTargets.push(h)}removeTrackedTarget(h){const e=this._trackedTargets.indexOf(h);e>=0&&this._trackedTargets.splice(e,1)}createTarget({sizeMultiplier:h,samples:e=0,colorSpace:i=_.aCh,type:s=_.ywz,format:o=_.wk1,depthBuffer:c=!0,depthTexture:g=!1,size:b,textureCount:et=1,...tt}={},rt=!0){this.isWebGL2||(e=0),h!==void 0&&b!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),(b=b||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(h=h||1))).width=Math.floor(b.width),b.height=Math.floor(b.height);const st=g?new _.$YQ(b.width,b.height,_.ywz):void 0,at=this.createTargetCustom(et>1?{width:b.width,height:b.height,count:et}:b,{samples:e,colorSpace:i,type:s,format:o,depthBuffer:c,depthTexture:st},et>1?_.kFz:_.dd2);return this._processNewTarget(at,h,rt),this._setTargetOptions(at,tt),at}_processNewTarget(h,e,i){return e!==void 0&&(h.sizeMultiplier=e),i&&this.trackTarget(h),h}disposeTarget(h){if(h){if(h.isTemporary)return this.releaseTempTarget(h);this.removeTrackedTarget(h),h.dispose()}}createTargetCustom({width:h,height:e,count:i},s={},o){const c=this._processNewTarget,g=this.renderTargetToDataUrl.bind(this);this.renderTargetToBuffer.bind(this);let b=[h,e];if(i&&i>1&&b.push(i),(o==null?void 0:o.prototype)===_.oAp.prototype){if(h!==e)throw"Width and height of cube render target must be equal";b=[h]}s={format:_.wk1,minFilter:_.wem,magFilter:_.wem,generateMipmaps:!1,type:_.ywz,colorSpace:_.aCh,...s};const et=[this,...b,s];return new class extends(o??_.dd2){constructor(tt,...rt){super(...rt),this.renderer=tt,this.assetType="renderTarget",this.name="RenderTarget",Array.isArray(this.texture)?this.texture.forEach(st=>{st.colorSpace=s.colorSpace,st.toJSON=()=>(console.warn("Multiple render target texture.toJSON not supported yet."),{})}):(this.texture.__toJSON=this.texture.toJSON,this.texture.__target=this,this.texture.toJSON=function(st){console.warn("Render target texture.toJSON might be buggy."),this.source.data.url=g(this.__target,"image/png",90);const at=this.__toJSON.call(this,st);return delete this.source.data.url,at.isRenderTargetTexture=!0,at})}setSize(tt,rt,st){super.setSize(Math.floor(tt),Math.floor(rt),st)}clone(tt=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const rt=super.clone();return rt.texture.isRenderTargetTexture=!0,c(rt,this.sizeMultiplier||1,tt)}}(...et)}getTempTarget(h={}){var s;const e=kA(h);let i;return(s=this._tempTargets[e])!=null&&s.length&&(i=this._tempTargets[e].pop()),i?this._setTargetOptions(i,h):(i=this.createTarget(h),this._processNewTempTarget(i,e)),i}_processNewTempTarget(h,e){return h.isTemporary=!0,h.targetKey=e,this._tempTargets[e]===void 0&&(this._tempTargets[e]=[]),h}releaseTempTarget(h){const e=h.targetKey;if(!e||!h.isTemporary)throw"Not a temp target";this._tempTargets[e].length>this.maxTempPerKey?h.dispose():this._tempTargets[e].push(h)}updateShaderProperties(h){return this.stableNoise?h.uniforms.frameCount?h.uniforms.frameCount.value=this._totalFrameCount:console.warn("BaseRenderer: no uniform: frameCount"):h.uniforms.frameCount?h.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),h.uniforms.frameCount2&&(h.uniforms.frameCount2.value=this.frameCount),this}_setTargetOptions(h,e){h.texture.minFilter=e.minFilter??_.wem,h.texture.magFilter=e.magFilter??_.wem,h.texture.generateMipmaps=e.generateMipmaps??!1,h.texture.generateMipmaps&&h.texture.minFilter===_.wem&&(h.texture.minFilter=_.FDw),h.texture.generateMipmaps||h.texture.minFilter!==_.FDw||(h.texture.minFilter=_.wem)}renderTargetToDataUrl(h,e="image/png",i=90){const s=document.createElement("canvas");s.width=h.width,s.height=h.height;const o=s.getContext("2d");if(!o)throw new Error("Unable to get 2d context");const c=o.createImageData(h.width,h.height,{colorSpace:["display-p3","srgb"].includes(h.texture.colorSpace)?h.texture.colorSpace:void 0});if(h.texture.type===_.cLu){const b=new Uint16Array(h.width*h.height*4);this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,b),gy({data:b,width:h.width,height:h.height},h.texture.colorSpace,c)}else if(h.texture.type===_.VzW){const b=new Float32Array(h.width*h.height*4);this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,b),gy({data:b,width:h.width,height:h.height},h.texture.colorSpace,c)}else this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,c.data);o.putImageData(c,0,0);const g=s.toDataURL(e,i);return s.remove(),g}renderTargetToBuffer(h){const e=h.texture.type===_.cLu?new Uint16Array(h.width*h.height*4):new Uint8Array(h.width*h.height*4);return this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,e),e}get useLegacyLights(){return this.rendererObject.useLegacyLights}set useLegacyLights(h){this.rendererObject.useLegacyLights=h,this._updated(),this.resetShadows()}get useTotalFrameCount(){return console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise}set useTotalFrameCount(h){console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise=h}get renderScale(){return this.displayCanvasScaling}set renderScale(h){this.displayCanvasScaling=h}};function kA(h={}){var e,i;return[h.sizeMultiplier,h.samples,h.colorSpace,h.type,h.format,h.depthBuffer,h.depthTexture,(e=h.size)==null?void 0:e.width,(i=h.size)==null?void 0:i.height].join(";")}function p0(h){var c,g,b,et,tt,rt,st,at,ct;if(!h.isMaterial&&!h.isBufferGeometry)return;const e=Array.from(h.userData.__appliedMeshes).filter(pt=>!pt.isInstancedMesh&&!!pt.parent&&pt.children.length===0&&!Array.isArray(pt.material));if(e.length<2)return;const i=new Map;for(const pt of e){const gt=(s=pt).parent.uuid+"_"+s.geometry.uuid+"_"+((c=s.material)==null?void 0:c.uuid);i.has(gt)||i.set(gt,[]),i.get(gt).push(pt),pt.updateMatrix()}var s;const o=i.keys();for(const pt of o){const gt=i.get(pt),At=gt[0];if(!At||gt.length<2)continue;const xt=new _.SPe(At.geometry,At.material,gt.length),yt=At.userData;At.userData={},xt.copy(At),tu(xt.userData,yt);const _t=At.parent;xt.position.set(0,0,0),xt.rotation.set(0,0,0),xt.scale.set(1,1,1),xt.updateMatrix();const Mt=new Float32Array(3*xt.count),It=new Float32Array(4*xt.count),Bt=new Float32Array(3*xt.count);for(let Lt=0;Lt<gt.length;Lt++){const Ht=gt[Lt],Jt=Ht.matrix;Jt.determinant()<0&&(Jt.elements[0]*=-1,Jt.elements[1]*=-1,Jt.elements[2]*=-1),xt.setMatrixAt(Lt,Jt),Ht.position.toArray(Mt,3*Lt),Ht.quaternion.toArray(It,4*Lt),Ht.scale.toArray(Bt,3*Lt),Ht.removeFromParent(),(et=(b=(g=Ht.material)==null?void 0:g.userData)==null?void 0:b.__appliedMeshes)==null||et.delete(Ht),(st=(rt=(tt=Ht.geometry)==null?void 0:tt.userData)==null?void 0:rt.__appliedMeshes)==null||st.delete(Ht)}(ct=(at=xt.material.userData)==null?void 0:at.__appliedMeshes)==null||ct.add(xt),xt.geometry.userData.__appliedMeshes.add(xt),xt.sourceTrs={TRANSLATION:new _.TlE(Mt,3),ROTATION:new _.TlE(It,4),SCALE:new _.TlE(Bt,3)},xt.instanceMatrix.needsUpdate=!0,_t.add(xt),_t.setDirty()}}d0([Mn()],Av.prototype,"stableNoise",void 0),d0([Mn()],Av.prototype,"useLegacyLights",null),Av=d0([qm("RenderManager")],Av);class rx{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,i){if(!e.isInstancedMesh)return;const s=this.writer,o=e;let c=o.sourceTrs;if(!c){const g=new Float32Array(3*o.count),b=new Float32Array(4*o.count),et=new Float32Array(3*o.count),tt=new _.yGw,rt=new _.Pa4,st=new _._fP,at=new _.Pa4;for(let ct=0;ct<o.count;ct++)o.getMatrixAt(ct,tt),tt.decompose(rt,st,at),rt.toArray(g,3*ct),st.toArray(b,4*ct),at.toArray(et,3*ct);c={TRANSLATION:new _.TlE(g,3),ROTATION:new _.TlE(b,4),SCALE:new _.TlE(et,3)}}c={TRANSLATION:s.processAccessor(c.TRANSLATION),ROTATION:s.processAccessor(c.ROTATION),SCALE:s.processAccessor(c.SCALE)},o.instanceColor&&(c.COLOR=s.processAccessor(new _.TlE(o.instanceColor.array,3))),s.extensionsUsed[this.name]=!0,s.extensionsRequired[this.name]=!0,i.extensions=i.extensions||{},i.extensions[this.name]={attributes:c}}}function BA(h,e){if(h.uiConfig)return h.uiConfig;const i={type:"folder",label:()=>h.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[h,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{h.dispatchEvent({type:"select",ui:!0,value:h,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!h.parent,value:()=>{const c=h.parent;c&&c.dispatchEvent({type:"select",ui:!0,value:c})}},{type:"input",label:"Name",property:[h,"name"],onChange:c=>{var g;c.last&&((g=h.setDirty)==null||g.call(h,{sceneUpdate:!0,refreshUi:!0}))}},{type:"checkbox",label:"Casts Shadow",hidden:()=>!h.isMesh,property:[h,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!h.isMesh,property:[h,"receiveShadow"]},{type:"checkbox",label:"Frustum culled",property:[h,"frustumCulled"]},{type:"vec3",label:"Position",property:[h,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[h,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[h,"scale"]},{type:"input",label:"Render Order",property:[h,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",h.userData.autoScaleRadius||"2",!0],value:c=>{if(!c)return;const g=parseFloat(c);Math.abs(g)>0&&Mo(h,g)}},{type:"button",label:"Auto Center",value:()=>{confirm("Auto Center: Object will be centered, are you sure you want to proceed?")&&ba(h)}},{type:"folder",label:"Rotate model",children:["X +","X -","Y +","Y -","Z +","Z -"].map(c=>({type:"button",label:"Rotate "+c+"90",value:()=>{var g;h.rotateOnAxis(new _.Pa4(c.includes("X")?1:0,c.includes("Y")?1:0,c.includes("Z")?1:0),Math.PI/2*(c.includes("-")?-1:1)),(g=h.setDirty)==null||g.call(h,{sceneUpdate:!0,refreshUi:!1})}}))},h.userData.license!==void 0?{type:"input",label:"License/Credits",property:[h.userData,"license"],limitedUi:!0}:{}]},s=h;if(s!=null&&s.isMesh&&e!==!1){const c=[()=>{const g=Object.entries(s.morphTargetDictionary||{});return g.length?{label:"Morph Targets",type:"folder",children:g.map(([b,et])=>({type:"slider",label:b,bounds:[0,1],stepSize:1e-4,property:[s.morphTargetInfluences,et],onChange:tt=>{var rt;(rt=h.setDirty)==null||rt.call(h,{sceneUpdate:tt.last,frameFade:!1,refreshUi:!1})}}))}:void 0},()=>{var g;return(g=s.geometry)==null?void 0:g.uiConfig},()=>{var g;return Array.isArray(s.material)?s.material.length<1?void 0:{label:"Materials",type:"folder",children:s.material.map(b=>b==null?void 0:b.uiConfig).filter(b=>b)}:(g=s.material)==null?void 0:g.uiConfig}];i.children.push(...c)}const o=h;if(o!=null&&o.isCamera){const c=[{type:"button",label:"Set View",value:()=>{var g;h.dispatchEvent({type:"setView",ui:!0,camera:h}),(g=i.uiRefresh)==null||g.call(i,"postFrame",!0)}},{type:"button",label:"Activate main",hidden:()=>{var g;return(g=h.userData.iCamera)==null?void 0:g.isActiveCamera},value:()=>{var g;h.dispatchEvent({type:"activateMain",ui:!0,camera:h}),(g=i.uiRefresh)==null||g.call(i,"postFrame",!0)}},{type:"button",label:"Deactivate main",hidden:()=>{var g;return!((g=h.userData.iCamera)!=null&&g.isActiveCamera)},value:()=>{var g;h.dispatchEvent({type:"activateMain",ui:!0,camera:void 0}),(g=i.uiRefresh)==null||g.call(i,"postFrame",!0)}},{type:"checkbox",label:"Auto LookAt Target",getValue:()=>h.userData.autoLookAtTarget??!1,setValue:g=>{var b;h.userData.autoLookAtTarget=g,(b=i.uiRefresh)==null||b.call(i,"postFrame",!0)}}];i.children.push(...c)}return h.uiConfig=i,i}function Em(h,e,i){if(!h)return void console.warn("setupIModel: object is undefined");if(h.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",h),delete h.__disposed),h.userData||(h.userData={}),h.userData.__iModelSetup&&h.modelObject)return h;h.userData.__iModelSetup=!0;let s=[];s.push(()=>{[...h.children].forEach(rt=>{var st;(st=rt==null?void 0:rt.dispose)==null||st.call(rt),h.add(rt)}),h.parent&&h.removeFromParent()}),h.isLight&&!h.assetType?(h.assetType="light",h.lightObject=h):h.isCamera?(h.assetType="camera",h.cameraObject=h):h.assetType||(h.assetType="model"),h.modelObject||(h.modelObject=h),h.setDirty||(h.setDirty=(rt={})=>{h.dispatchEvent({...rt,type:"objectUpdate",object:h})},h.userData.setDirty&&console.warn("userData.setDirty already defined",h.userData.setDirty,h),h.userData.setDirty=rt=>{var st;console.warn("userData.setDirty is deprecated, use setDirty directly"),(st=h.setDirty)==null||st.call(h,rt)}),h.addEventListener("added",rt=>{var at,ct;const st=((at=h.parent)==null?void 0:at.userData.parentRoot)??h.parent;st!==h.userData.parentRoot&&h.traverse(pt=>{pt.userData.parentRoot=st}),(ct=h.setDirty)==null||ct.call(h,{change:"addedToParent"})}),h.addEventListener("removed",()=>{var rt;(rt=h.setDirty)==null||rt.call(h,{change:"removedFromParent"}),h.userData.parentRoot!==void 0&&h.traverse(st=>{st.userData.parentRoot=void 0})}),s.push(()=>{});const o=h.dispose;h.dispose=()=>{h.dispatchEvent({type:"dispose"}),o==null||o.call(h)},h.userData.dispose&&console.warn("userData.dispose already defined"),h.userData.dispose=()=>{var rt;console.warn("userData.dispose is deprecated, use dispose directly"),(rt=h.dispose)==null||rt.call(h)};const c=h;!c.isMesh&&!c.isLine||c.userData.__meshSetup||(c.userData.__meshSetup=!0,c.setMaterial||(c.setMaterial=rt=>sx(c,rt)),c.setGeometry||(c.setGeometry=(rt,st=!1)=>D1(c,rt,st),c.setGeometry(c.geometry,!0)),h.userData.setMaterial&&console.warn("userData.setMaterial already defined"),h.userData.setMaterial=rt=>{var st;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),(st=h.setMaterial)==null||st.call(h,rt)},h.userData.setGeometry&&console.warn("userData.setGeometry already defined"),h.userData.setGeometry=(rt,...st)=>{var at;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),(at=h.setGeometry)==null||at.call(h,rt,...st)},h.userData.__keepShadowDef||(h.castShadow=!0,h.receiveShadow=!0,h.userData.__keepShadowDef=!0),s.push(()=>{var at,ct,pt,gt,At,xt;const rt=((at=c.setMaterial)==null?void 0:at.call(c,void 0))||[],st=(ct=c.setGeometry)==null?void 0:ct.call(c,void 0);for(const yt of rt)yt&&yt.userData&&((pt=yt.userData.__appliedMeshes)==null?void 0:pt.size)===0&&yt.userData.disposeOnIdle!==!1&&yt.dispose();st&&st.userData&&((gt=st.userData.__appliedMeshes)==null?void 0:gt.size)===0&&st.userData.disposeOnIdle!==!1&&st.dispose(),(At=c.setMaterial)==null||At.call(c,rt),(xt=c.setGeometry)==null||xt.call(c,st)})),h.uiConfig||h.assetType!=="model"&&h.assetType!=="camera"||(BA(h),s.push(()=>{})),h.addEventListener("objectUpdate",({refreshUi:rt})=>{var st,at;return rt!==!1&&((at=(st=h.uiConfig)==null?void 0:st.uiRefresh)==null?void 0:at.call(st,"postFrame",!0,1))}),h.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(h.userData.__autoParentDispatchEvents=h.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select","materialChanged","textureUpdate"],h.isCamera&&h.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(h.userData.parentRoot=e);const g=h.dispatchEvent;h.dispatchEvent=rt=>{var st;(st=h.userData.__autoParentDispatchEvents)!=null&&st.includes(rt.type)&&(rt.parentDispatch=!0),rt.parentDispatch&&(at=>{const ct=h.userData.parentRoot??h.parent;ct!=null&&ct.modelObject&&ct.dispatchEvent(at)})(rt),g.call(h,rt)};const b=h.clone;h.clone=(...rt)=>{const st=h.userData;h.userData={};let at=b.call(h,...rt);h.userData=st,tu(at.userData,st);const ct=h.userData.parentRoot;return ct&&ct.assetType!=="model"&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),at=Em(at,ct,i),at.userData.cloneParent=h.uuid,at};const et=h.copy;h.copy=(rt,...st)=>{const at=rt.userData;rt.userData={};const ct=et.call(h,rt,...st);return rt.userData=at,tu(h.userData,rt),ct};const tt=h.add;return h.add=(...rt)=>(rt.forEach(st=>Em(st,h.userData.parentRoot||h,i)),tt.call(h,...rt)),(h=(i==null?void 0:i(h))??h).addEventListener("dispose",()=>{s.forEach(rt=>rt()),s=[]}),[...h.children].forEach(rt=>Em(rt,h,i)),h}function sx(h,e){var c,g,b,et;const i=(Array.isArray(e)?e:[e]).map(tt=>tt==null?void 0:tt.materialObject).filter(tt=>tt);if(h.material==i||i.length===1&&h.material===i[0])return[];h.userData.__materialUpdater||(h.userData.__materialUpdater=()=>{h.dispatchEvent({type:"materialUpdate"})}),h.userData.__textureUpdater||(h.userData.__textureUpdater=()=>{h.dispatchEvent({type:"textureUpdate"})});const s=Array.isArray(h.material)?[...h.material]:[h.material];for(const tt of s)tt&&(tt.removeEventListener("materialUpdate",h.userData.__materialUpdater),tt.removeEventListener("textureUpdate",h.userData.__textureUpdater),(g=(c=tt.userData)==null?void 0:c.__appliedMeshes)==null||g.delete(h));const o=[];for(const tt of i)tt.userData.__appliedMeshes||(tt.userData.__appliedMeshes=new Set),o.push(tt),tt&&(tt.addEventListener("materialUpdate",h.userData.__materialUpdater),tt.addEventListener("textureUpdate",h.userData.__textureUpdater),tt.userData.__appliedMeshes.add(h));return h.material=o.length!==1?o:o[0]??void 0,h.dispatchEvent({type:"materialChanged",material:e,mesh:h}),(et=(b=h.uiConfig)==null?void 0:b.uiRefresh)==null||et.call(b,"postFrame",!0),s}function D1(h,e,i=!1){var c,g,b,et,tt,rt;h.userData.__objectUpdater||(h.userData.__objectUpdater=st=>{h.dispatchEvent({...st,type:"objectUpdate"})});let s=h.geometry;const o=s;return(s!==e||i)&&(s&&(s.removeEventListener("geometryUpdate",h.userData.__objectUpdater),(g=(c=s.userData)==null?void 0:c.__appliedMeshes)==null||g.delete(h)),s=e,s&&!s.userData.__appliedMeshes&&(s.userData.__appliedMeshes=new Set),h.geometry=s??void 0,s&&(h.updateMorphTargets(),s.addEventListener("geometryUpdate",h.userData.__objectUpdater),(et=(b=s.userData)==null?void 0:b.__appliedMeshes)==null||et.add(h))),e&&!e.uiConfig&&(e.uiConfig=function(st){return{label:"Geometry",type:"folder",children:[{type:"input",property:[st,"uuid"],disabled:!0},{type:"input",property:[st,"name"]},{type:"button",label:"Center Geometry",value:()=>{st.center()}},{type:"button",label:"Center Geometry (keep position)",value:()=>{const at=new _.Pa4;st.center(at),st.userData.__appliedMeshes.forEach(ct=>{ct.position.sub(at),ct.setDirty&&ct.setDirty()})}},{type:"button",label:"Compute vertex normals",value:()=>{st.computeVertexNormals()}},{type:"button",label:"Compute vertex tangents",value:()=>{st.computeTangents()}},{type:"button",label:"Normalize normals",value:()=>{st.normalizeNormals()}},{type:"button",label:"Convert to indexed",hidden:()=>!!st.index,value:()=>{if(st.attributes.index)return;const at=parseFloat(prompt("Tolerance","-1")??"-1");_c(st,at)}},{type:"button",label:"Convert to non-indexed",hidden:()=>!st.index,value:()=>{st.attributes.index&&st.toNonIndexed()}},{type:"button",label:"Create uv1 from uv",value:()=>{st.hasAttribute("uv1")&&!confirm("uv1 already exists, replace with uv data?")||st.setAttribute("uv1",st.getAttribute("uv"))}},{type:"button",label:"Remove vertex color attribute",hidden:()=>!st.hasAttribute("color"),value:()=>{st.hasAttribute("color")?confirm("Remove color attribute?")&&st.deleteAttribute("color"):prompt("No color attribute found")}},{type:"button",label:"Auto GPU Instances",hidden:()=>!st.userData.__appliedMeshes||st.userData.__appliedMeshes.size<2,value:()=>{p0(st)}},{type:"input",label:"Mesh count",get value(){var at,ct;return((ct=(at=st.userData)==null?void 0:at.__appliedMeshes)==null?void 0:ct.size)??0},set value(at){},disabled:!0}]}}(h.geometry)),h.dispatchEvent({type:"geometryChanged",geometry:e}),(rt=(tt=h.uiConfig)==null?void 0:tt.uiRefresh)==null||rt.call(tt,"postFrame",!0),o===s?void 0:o||void 0}const L_=["appliedMeshes"],_f=["parentRoot","iCamera","iModel"];function tu(h,e){if(e)for(const i of Object.keys(e))_f.includes(i)||i.startsWith("__")||typeof h[i]!="function"&&typeof e[i]!="function"&&(h[i]=e[i]);return h}var i_,ox=new Uint8Array(16);function _y(){if(!i_&&!(i_=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i_(ox)}for(var OA=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,bu=[],r_=0;r_<256;++r_)bu.push((r_+256).toString(16).substr(1));var ax=function(h){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=(bu[h[e+0]]+bu[h[e+1]]+bu[h[e+2]]+bu[h[e+3]]+"-"+bu[h[e+4]]+bu[h[e+5]]+"-"+bu[h[e+6]]+bu[h[e+7]]+"-"+bu[h[e+8]]+bu[h[e+9]]+"-"+bu[h[e+10]]+bu[h[e+11]]+bu[h[e+12]]+bu[h[e+13]]+bu[h[e+14]]+bu[h[e+15]]).toLowerCase();if(!function(s){return typeof s=="string"&&OA.test(s)}(i))throw TypeError("Stringified UUID is invalid");return i},np=function(h,e,i){var s=(h=h||{}).random||(h.rng||_y)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(var o=0;o<16;++o)e[i+o]=s[o];return e}return ax(s)};const f0=new Map;function Ap(h,e){return(i,s)=>{const o=i.constructor;if(o===Object)throw new Error("All properties in an object are serialized by default");f0.has(o)||f0.set(o,[]);const c=f0.get(o);if(!(c.findIndex(g=>g.propKey===s)<0))throw new Error(`Property ${s} already has a uiConfig decorator`);c.push({params:e||{},propKey:s,uiType:h})}}function Nr(h,e){return Ap("checkbox",{label:h,params:e})}function Xm(h,e){return Ap("monitor",{label:h,params:e})}function es(h,e,i,s){return Ap("slider",{label:h,bounds:e,stepSize:i,params:s})}function ip(h,e,i,s){return Ap("vec",{label:h,bounds:e,stepSize:i,params:s})}function em(h,e,i){return Ap("dropdown",{label:h,children:e,params:i})}function go(h,e){return Ap("button",{label:h,params:e})}function js(h,e){return Ap("input",{label:h,params:e})}function s_(h,e){return Ap("color",{label:h,params:e})}function yy(h,e){return Ap("image",{label:h,params:e})}function bv(h){let e=h==null?void 0:h.constructor;if(!h||!e)return[];const i=[],s=[];for(;e&&e!==Object;)s.push(e),e=Object.getPrototypeOf(e);if(!s.length){const o=typeof h=="object"?Object.keys(h):Array.isArray(h)?h.map((c,g)=>g):[];for(const c of o){const g=h[c];if(g==null)continue;const b=g==null?void 0:g.uiConfig;if(b)i.push(b);else{const et=m0(g);et==="folder"?i.push(tm(c+"",g)):et&&i.push({type:et,label:c+"",property:[h,c]})}}}return s.reverse().forEach(o=>{var c;(c=f0.get(o))==null||c.forEach(({params:g,propKey:b,uiType:et})=>{let tt;if(!et){const rt=h[b];tt=rt==null?void 0:rt.uiConfig,tt?i.push(tt):rt!=null&&((et=m0(rt))==="folder"?tt=tm(b+"",rt):et&&(tt={type:et,label:b+"",property:[h,b]}))}if(tt||(tt={property:[h,b],type:et||"input"}),g){const rt=typeof g.params=="function"?g.params(h):g.params||{};delete g.params,Object.assign(tt,{...g,...rt})}i.push(tt)})}),i}function tm(h,e,i={},s="folder"){return{type:s,label:h,children:bv(e),uuid:np(),...i}}function Ms(h,e,i="folder"){return s=>class extends s{constructor(){super(...arguments),this.uiConfig=tm(h,this,e||{},i)}}}function wv(h,e){return Ms(h,e,"panel")}function m0(h){return h==null?null:Array.isArray(h)?"folder":typeof h=="boolean"?"checkbox":typeof h=="number"?"number":typeof h=="string"?"input":typeof h=="function"?"button":typeof h.x=="number"?"vec":typeof h.r=="number"?"color":h.isTexture?"image":typeof h=="object"?"folder":null}const N_={type:"change"},o_={type:"start"},Ay={type:"end"};class lx extends _.pBf{constructor(e,i){super(),this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new _.Pa4,this.minDistance=1e-5,this.maxDistance=1/0,this.autoPushTarget=!0,this.autoPullTarget=!0,this.clampMax=new _.Pa4(1/0,1/0,1/0),this.clampMin=new _.Pa4(-1/0,-1/0,-1/0),this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.throttleUpdate=0,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:_.RsA.ROTATE,MIDDLE:_.RsA.DOLLY,RIGHT:_.RsA.PAN},this.touches={ONE:_.QmN.ROTATE,TWO:_.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return b.phi},this.getAzimuthalAngle=function(){return b.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(pr){pr.addEventListener("keydown",cs),this._domElementKeyEvents=pr},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",cs),this._domElementKeyEvents=null},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(N_),s.update(),c=o.NONE},this.update=function(){const pr=new _.Pa4,Pr=new _._fP().setFromUnitVectors(e.up,new _.Pa4(0,1,0)),qr=Pr.clone().invert(),Xs=new _.Pa4,po=new _._fP,eo=2*Math.PI;return function(){if(this.throttleUpdate&&this.throttleUpdate>=1&&Date.now()-0<1e3/this.throttleUpdate)return;const Qs=s.object.position;pr.copy(Qs).sub(s.target),pr.applyQuaternion(Pr),b.setFromVector3(pr),s.autoRotate&&c===o.NONE&&Ht(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(b.theta+=et.theta*s.dampingFactor,b.phi+=et.phi*s.dampingFactor):(b.theta+=et.theta,b.phi+=et.phi);let Ws=s.minAzimuthAngle,_s=s.maxAzimuthAngle;isFinite(Ws)&&isFinite(_s)&&(Ws<-Math.PI?Ws+=eo:Ws>Math.PI&&(Ws-=eo),_s<-Math.PI?_s+=eo:_s>Math.PI&&(_s-=eo),b.theta=Ws<=_s?Math.max(Ws,Math.min(_s,b.theta)):b.theta>(Ws+_s)/2?Math.max(Ws,b.theta):Math.min(_s,b.theta)),b.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,b.phi)),b.makeSafe(),Math.abs(et.radius)>0&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*(1+et.radius*(s.enableDamping?s.dampingFactor:1)))),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&(et.radius=0)),b.radius*=1+et.radius*(s.enableDamping?s.dampingFactor:1)),Math.abs(tt-1)>1e-5&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*tt)),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&(tt=1)),b.radius*=tt);let ar=0;s.autoPushTarget&&b.radius<s.minDistance&&(ar=s.minDistance-b.radius),s.autoPullTarget&&b.radius>s.maxDistance&&(ar=s.maxDistance-b.radius),b.radius=Math.max(s.minDistance,Math.min(s.maxDistance,b.radius)),s.enableDamping===!0?s.target.addScaledVector(rt,s.dampingFactor):s.target.add(rt),pr.setFromSpherical(b),pr.applyQuaternion(qr),Qs.copy(s.target).add(pr),s.target.add(pr.normalize().multiplyScalar(-ar)),Qs.clamp(s.clampMin,s.clampMax),s.target.clamp(s.clampMin,s.clampMax),s.object.lookAt(s.target);let Wr=!1;return s.enableDamping===!0&&Math.abs(et.theta)+Math.abs(et.phi)+Math.abs(et.radius)+rt.length()>.001?(et.theta*=1-s.dampingFactor,et.phi*=1-s.dampingFactor,et.radius*=1-s.dampingFactor,rt.multiplyScalar(1-s.dampingFactor),Wr=!0):(et.set(0,0,0),rt.set(0,0,0)),tt=1,!!(st||Wr||Xs.distanceToSquared(s.object.position)>g||8*(1-po.dot(s.object.quaternion))>g)&&(s.dispatchEvent(N_),Xs.copy(s.object.position),po.copy(s.object.quaternion),st=!1,!0)}}(),this.stopDamping=function(){et.set(0,0,0),rt.set(0,0,0)},this.dispose=function(){s.domElement.removeEventListener("contextmenu",Os),s.domElement.removeEventListener("pointerdown",Cr),s.domElement.removeEventListener("pointercancel",Hr),s.domElement.removeEventListener("wheel",Jr),s.domElement.removeEventListener("pointermove",Ar),s.domElement.removeEventListener("pointerup",Hr),s._domElementKeyEvents!==null&&(s._domElementKeyEvents.removeEventListener("keydown",cs),s._domElementKeyEvents=null)};const s=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=o.NONE;const g=1e-6,b=new _.$V,et=new _.$V(0,0,0);let tt=1;const rt=new _.Pa4;let st=!1;const at=new _.FM8,ct=new _.FM8,pt=new _.FM8,gt=new _.FM8,At=new _.FM8,xt=new _.FM8,yt=new _.FM8,_t=new _.FM8,Mt=new _.FM8,It=[],Bt={};function Lt(){return s.enableDamping?1:Math.pow(.95,s.zoomSpeed)}function Ht(pr){et.theta-=pr}function Jt(pr){et.phi-=pr}this.rotateUp=Jt,this.rotateLeft=Ht;const sn=function(){const pr=new _.Pa4;return function(Pr,qr){pr.setFromMatrixColumn(qr,0),pr.multiplyScalar(-Pr),rt.add(pr)}}(),on=function(){const pr=new _.Pa4;return function(Pr,qr){s.screenSpacePanning===!0?pr.setFromMatrixColumn(qr,1):(pr.setFromMatrixColumn(qr,0),pr.crossVectors(s.object.up,pr)),pr.multiplyScalar(Pr),rt.add(pr)}}(),mn=function(){const pr=new _.Pa4;return function(Pr,qr){const Xs=s.domElement;if(s.object.isPerspectiveCamera){const po=s.object.position;pr.copy(po).sub(s.target);let eo=pr.length();eo*=Math.tan(s.object.fov/2*Math.PI/180),sn(2*Pr*eo/Xs.clientHeight,s.object.matrix),on(2*qr*eo/Xs.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(sn(Pr*(s.object.right-s.object.left)/s.object.zoom/Xs.clientWidth,s.object.matrix),on(qr*(s.object.top-s.object.bottom)/s.object.zoom/Xs.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function cn(pr,Pr=0){s.object.isPerspectiveCamera?(tt/=pr,et.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,et.radius-Pr))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*pr)),s.object.updateProjectionMatrix(),st=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function un(pr,Pr=0){s.object.isPerspectiveCamera?(tt*=pr,et.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,et.radius+Pr))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/pr)),s.object.updateProjectionMatrix(),st=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function bn(pr){at.set(pr.clientX,pr.clientY)}function xn(pr){gt.set(pr.clientX,pr.clientY)}function Cn(){if(It.length===1)at.set(It[0].pageX,It[0].pageY);else{const pr=.5*(It[0].pageX+It[1].pageX),Pr=.5*(It[0].pageY+It[1].pageY);at.set(pr,Pr)}}function Jn(){if(It.length===1)gt.set(It[0].pageX,It[0].pageY);else{const pr=.5*(It[0].pageX+It[1].pageX),Pr=.5*(It[0].pageY+It[1].pageY);gt.set(pr,Pr)}}function Kn(){const pr=It[0].pageX-It[1].pageX,Pr=It[0].pageY-It[1].pageY,qr=Math.sqrt(pr*pr+Pr*Pr);yt.set(0,qr)}function gr(pr){if(It.length==1)ct.set(pr.pageX,pr.pageY);else{const qr=Ts(pr),Xs=.5*(pr.pageX+qr.x),po=.5*(pr.pageY+qr.y);ct.set(Xs,po)}pt.subVectors(ct,at).multiplyScalar(s.rotateSpeed);const Pr=s.domElement;Ht(2*Math.PI*pt.x/Pr.clientHeight),Jt(2*Math.PI*pt.y/Pr.clientHeight),at.copy(ct)}function nr(pr){if(It.length===1)At.set(pr.pageX,pr.pageY);else{const Pr=Ts(pr),qr=.5*(pr.pageX+Pr.x),Xs=.5*(pr.pageY+Pr.y);At.set(qr,Xs)}xt.subVectors(At,gt).multiplyScalar(s.panSpeed),mn(xt.x,xt.y),gt.copy(At)}function tr(pr){const Pr=Ts(pr),qr=pr.pageX-Pr.x,Xs=pr.pageY-Pr.y,po=Math.sqrt(qr*qr+Xs*Xs);_t.set(0,po),Mt.set(0,Math.pow(_t.y/yt.y,6*s.zoomSpeed)),cn(Mt.y),yt.copy(_t)}function Cr(pr){s.enabled!==!1&&(It.length===0&&(s.domElement.setPointerCapture(pr.pointerId),s.domElement.addEventListener("pointermove",Ar),s.domElement.addEventListener("pointerup",Hr)),function(Pr){It.push(Pr)}(pr),pr.pointerType==="touch"?function(Pr){switch(Ss(Pr),It.length){case 1:switch(s.touches.ONE){case _.QmN.ROTATE:if(s.enableRotate===!1)return;Cn(),c=o.TOUCH_ROTATE;break;case _.QmN.PAN:if(s.enablePan===!1)return;Jn(),c=o.TOUCH_PAN;break;default:c=o.NONE}break;case 2:switch(s.touches.TWO){case _.QmN.DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;s.enableZoom&&Kn(),s.enablePan&&Jn(),c=o.TOUCH_DOLLY_PAN;break;case _.QmN.DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;s.enableZoom&&Kn(),s.enableRotate&&Cn(),c=o.TOUCH_DOLLY_ROTATE;break;default:c=o.NONE}break;default:c=o.NONE}c!==o.NONE&&s.dispatchEvent(o_)}(pr):function(Pr){let qr;switch(Pr.button){case 0:qr=s.mouseButtons.LEFT;break;case 1:qr=s.mouseButtons.MIDDLE;break;case 2:qr=s.mouseButtons.RIGHT;break;default:qr=-1}switch(qr){case _.RsA.DOLLY:if(s.enableZoom===!1)return;(function(Xs){yt.set(Xs.clientX,Xs.clientY)})(Pr),c=o.DOLLY;break;case _.RsA.ROTATE:if(Pr.ctrlKey||Pr.metaKey||Pr.shiftKey){if(s.enablePan===!1)return;xn(Pr),c=o.PAN}else{if(s.enableRotate===!1)return;bn(Pr),c=o.ROTATE}break;case _.RsA.PAN:if(Pr.ctrlKey||Pr.metaKey||Pr.shiftKey){if(s.enableRotate===!1)return;bn(Pr),c=o.ROTATE}else{if(s.enablePan===!1)return;xn(Pr),c=o.PAN}break;default:c=o.NONE}c!==o.NONE&&s.dispatchEvent(o_)}(pr))}function Ar(pr){s.enabled!==!1&&(pr.pointerType==="touch"?function(Pr){switch(Ss(Pr),c){case o.TOUCH_ROTATE:if(s.enableRotate===!1)return;gr(Pr),s.update();break;case o.TOUCH_PAN:if(s.enablePan===!1)return;nr(Pr),s.update();break;case o.TOUCH_DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;(function(qr){s.enableZoom&&tr(qr),s.enablePan&&nr(qr)})(Pr),s.update();break;case o.TOUCH_DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;(function(qr){s.enableZoom&&tr(qr),s.enableRotate&&gr(qr)})(Pr),s.update();break;default:c=o.NONE}}(pr):function(Pr){switch(c){case o.ROTATE:if(s.enableRotate===!1)return;(function(qr){ct.set(qr.clientX,qr.clientY),pt.subVectors(ct,at).multiplyScalar(s.rotateSpeed);const Xs=s.domElement;Ht(2*Math.PI*pt.x/Xs.clientHeight),Jt(2*Math.PI*pt.y/Xs.clientHeight),at.copy(ct),s.update()})(Pr);break;case o.DOLLY:if(s.enableZoom===!1)return;(function(qr){_t.set(qr.clientX,qr.clientY),Mt.subVectors(_t,yt),Mt.y>0?cn(Lt()):Mt.y<0&&un(Lt()),yt.copy(_t),s.update()})(Pr);break;case o.PAN:if(s.enablePan===!1)return;(function(qr){At.set(qr.clientX,qr.clientY),xt.subVectors(At,gt).multiplyScalar(s.panSpeed),mn(xt.x,xt.y),gt.copy(At),s.update()})(Pr)}}(pr))}function Hr(pr){(function(Pr){delete Bt[Pr.pointerId];for(let qr=0;qr<It.length;qr++)if(It[qr].pointerId==Pr.pointerId)return void It.splice(qr,1)})(pr),It.length===0&&(s.domElement.releasePointerCapture(pr.pointerId),s.domElement.removeEventListener("pointermove",Ar),s.domElement.removeEventListener("pointerup",Hr)),s.dispatchEvent(Ay),c=o.NONE}function Jr(pr){s.enabled!==!1&&s.enableZoom!==!1&&c===o.NONE&&(pr.preventDefault(),s.dispatchEvent(o_),function(Pr){let qr=0;switch(Pr.deltaMode){case 2:qr+=1*Pr.deltaY;break;case 1:qr+=.4*Pr.deltaY;break;default:qr+=.01*Pr.deltaY}Pr.deltaY<0?un(1,qr*s.zoomSpeed):Pr.deltaY>0&&cn(1,-qr*s.zoomSpeed),s.update()}(pr),s.dispatchEvent(Ay))}function cs(pr){s.enabled!==!1&&s.enablePan!==!1&&function(Pr){let qr=!1;switch(Pr.code){case s.keys.UP:Pr.ctrlKey||Pr.metaKey||Pr.shiftKey?Jt(2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):mn(0,s.keyPanSpeed),qr=!0;break;case s.keys.BOTTOM:Pr.ctrlKey||Pr.metaKey||Pr.shiftKey?Jt(-2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):mn(0,-s.keyPanSpeed),qr=!0;break;case s.keys.LEFT:Pr.ctrlKey||Pr.metaKey||Pr.shiftKey?Ht(2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):mn(s.keyPanSpeed,0),qr=!0;break;case s.keys.RIGHT:Pr.ctrlKey||Pr.metaKey||Pr.shiftKey?Ht(-2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):mn(-s.keyPanSpeed,0),qr=!0}qr&&(Pr.preventDefault(),s.update())}(pr)}function Os(pr){s.enabled!==!1&&pr.preventDefault()}function Ss(pr){let Pr=Bt[pr.pointerId];Pr===void 0&&(Pr=new _.FM8,Bt[pr.pointerId]=Pr),Pr.set(pr.pageX,pr.pageY)}function Ts(pr){const Pr=pr.pointerId===It[0].pointerId?It[1]:It[0];return Bt[Pr.pointerId]}this.zoomIn=function(pr){cn(1,pr*s.zoomSpeed)},this.zoomOut=function(pr){un(1,pr*s.zoomSpeed)},s.domElement.addEventListener("contextmenu",Os),s.domElement.addEventListener("pointerdown",Cr),s.domElement.addEventListener("pointercancel",Hr),s.domElement.addEventListener("wheel",Jr,{passive:!1}),this.update()}}var Lo=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let ko=class extends lx{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.autoPullTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.clampMin=new _.Pa4(-1e4,-1e4,-1e4),this.clampMax=new _.Pa4(1e4,1e4,1e4),this.screenSpacePanning=!0,this.keyPanSpeed=7,this.throttleUpdate=60}zoomIn(h){super.zoomIn(h)}zoomOut(h){super.zoomOut(h)}dispatchEvent(h){super.dispatchEvent(h)}};Lo([Mn()],ko.prototype,"type",void 0),Lo([Nr()],ko.prototype,"enabled",void 0),Lo([Nr(),Mn()],ko.prototype,"dollyZoom",void 0),Lo([Nr(),Mn()],ko.prototype,"enableDamping",void 0),Lo([js(),Mn()],ko.prototype,"dampingFactor",void 0),Lo([Nr(),Mn()],ko.prototype,"autoRotate",void 0),Lo([js(),Mn()],ko.prototype,"autoRotateSpeed",void 0),Lo([Nr(),Mn()],ko.prototype,"enableZoom",void 0),Lo([js(),Mn()],ko.prototype,"zoomSpeed",void 0),Lo([js(),Mn()],ko.prototype,"maxZoomSpeed",void 0),Lo([Nr(),Mn()],ko.prototype,"enableRotate",void 0),Lo([js(),Mn()],ko.prototype,"rotateSpeed",void 0),Lo([Nr(),Mn()],ko.prototype,"enablePan",void 0),Lo([js(),Mn()],ko.prototype,"panSpeed",void 0),Lo([js(),Mn()],ko.prototype,"autoPushTarget",void 0),Lo([js(),Mn()],ko.prototype,"autoPullTarget",void 0),Lo([js(),Mn()],ko.prototype,"minDistance",void 0),Lo([js(),Mn()],ko.prototype,"maxDistance",void 0),Lo([js(),Mn()],ko.prototype,"minZoom",void 0),Lo([js(),Mn()],ko.prototype,"maxZoom",void 0),Lo([js(),Mn()],ko.prototype,"minPolarAngle",void 0),Lo([js(),Mn()],ko.prototype,"maxPolarAngle",void 0),Lo([js(),Mn()],ko.prototype,"minAzimuthAngle",void 0),Lo([js(),Mn()],ko.prototype,"maxAzimuthAngle",void 0),Lo([ip(),Mn()],ko.prototype,"clampMin",void 0),Lo([ip(),Mn()],ko.prototype,"clampMax",void 0),Lo([Mn()],ko.prototype,"screenSpacePanning",void 0),Lo([Mn()],ko.prototype,"keyPanSpeed",void 0),ko=Lo([wv("Orbit Controls")],ko);var g0=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class hu extends _e.SimpleEventDispatcher{get controls(){return this._controls}getControls(){return this._controls}get userData(){return this._camera.modelObject.userData}set userData(e){this._camera.modelObject.userData=e}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const i=this._target.sub(e).length()>0;this._target.copy(e),i&&this.targetUpdated()}get position(){return this._position}set position(e){const i=this._position.sub(e).length()>0;this._position.copy(e),i&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,i=!0){var o,c;const s={...e};(o=s.position)!=null&&o.isVector3&&(s.position=[s.position.x,s.position.y,s.position.z]),(c=s.target)!=null&&c.isVector3&&(s.target=[s.target.x,s.target.y,s.target.z]),Object.keys(s).forEach(g=>g!=="frustumSize"&&s[g]===void 0&&delete s[g]),Object.assign(this._options,s),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),i&&this.setDirty()}_refreshCameraOptions(e=!0){let i=this._camera.modelObject;if(this._options.type!==i.type){const o=this._options.type==="PerspectiveCamera"?new _.cPb:new _.iKG;o.name=this._camera.name,o.near=this._camera.modelObject.near,o.far=this._camera.modelObject.far,o.zoom=this._camera.modelObject.zoom,o.scale.copy(this._camera.modelObject.scale);const c=this._isActiveCamera;c&&this.deactivateMain(),this._camera=this._setCameraObject(o),i=this._camera.modelObject,c&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let s=this._options.aspect;if(s==="auto"&&(s=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionUpdated(!1),this._options.type==="PerspectiveCamera"&&(i.fov=this._options.fov,i.focus=this._options.focus,i.aspect=s),this._options.type==="OrthographicCamera"){const o=this._options.frustumSize;o!==void 0?(i.top=o/2,i.bottom=-o/2,i.left=s*o/2,i.right=-s*o/2):(i.top=this._options.top,i.bottom=this._options.bottom,i.left=this._options.left,i.right=this._options.right)}i.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=Em(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled&&this._options.controlsMode!==""}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}constructor(e,i,s){super(),this._controlsMode="",this._isActiveCamera=!1,this._cameraObjectUpdate=g=>{this.setDirty(g)},this._interactionsEnabled=!0,this.autoLookAtTarget=!1,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new _.Pa4(0,0,10),this._target=new _.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(g,b)=>{const et=new ko(g,b.ownerDocument?b:b.documentElement);return et.screenSpacePanning=!0,et}]]),this._positionWorld=new _.Pa4,this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>this.refreshCameraOptions(),limitedUi:!0},{type:"checkbox",label:"Auto Near far",getValue:()=>this._camera.userData.autoNearFar??!0,setValue:g=>this._camera.userData.autoNearFar=g,onChange:()=>this.setDirty()},{type:"input",label:()=>this._camera.userData.autoNearFar??1?"Min Near":"Near",getValue:()=>this._camera.userData.minNearPlane??.5,setValue:g=>this._camera.userData.minNearPlane=g,onChange:()=>this.setDirty()},{type:"input",label:()=>this._camera.userData.autoNearFar??1?"Max Far":"Far",getValue:()=>this._camera.userData.maxFarPlane??1e3,setValue:g=>this._camera.userData.maxFarPlane=g,onChange:()=>this.setDirty()},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map(g=>({label:g===""?"none":g,value:g})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var g;return(g=this._controls)!=null&&g.zoomIn?{type:"button",label:"Zoom in",value:()=>{var b;(b=this._controls)==null||b.zoomIn(1)}}:{}},()=>{var g;return(g=this._controls)!=null&&g.zoomOut?{type:"button",label:"Zoom out",value:()=>{var b;(b=this._controls)==null||b.zoomOut(1)}}:{}},()=>{var g;return(g=this._controls)==null?void 0:g.uiConfig}]},this.assetType="model",this.uuid=Pn(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=s??document.body;const o={...i};this._camera=this._setCameraObject(e??(o.type==="OrthographicCamera"?new _.iKG(-1,1,1,-1):new _.cPb)),this._camera.modelObject.userData.iCamera=this;const c=e;e&&(c.isPerspectiveCamera?(o.fov=c.fov,o.focus=c.focus,o.aspect=c.aspect<=0||c.userData.autoAspect?"auto":c.aspect,o.zoom=c.zoom):c.isOrthographicCamera&&(o.left=c.left,o.right=c.right,o.top=c.top,o.bottom=c.bottom,o.zoom=c.zoom),this.near=c.near,this.far=c.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),this.setCameraOptions(o)}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(e=4){var i;(i=this._controls)!=null&&i.enabled&&this._controls.target?this._target.copy(this._controls.target):this.cameraObject.getWorldDirection(this._target).multiplyScalar(e).add(this.cameraObject.getWorldPosition(new _.Pa4))}setControlsCtor(e,i,s=!1){s||!this._controlsCtors.has(e)?this._controlsCtors.set(e,i):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var i,s;const e=this._options.controlsMode;this._controls=((i=this._controlsCtors.get(e))==null?void 0:i(this._camera.modelObject,this._container))??void 0,this._controls||e===""||console.error("Unable to create controls with mode "+e+". Are you missing a plugin?"),(s=this._controls)==null||s.addEventListener("change",this.setDirty),this._controlsMode=this._controls?e:""}_disposeCameraControls(){var e,i;this._controlsMode,(e=this._controls)==null||e.removeEventListener("change",this.setDirty),(i=this._controls)==null||i.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var i,s;if(this._options.controlsEnabled){const o=this._options.controlsMode;this._controls?this._controlsMode===o&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=o}if(this._controls){const o=this.interactionsEnabled;this._controls.enabled=o,o&&this._camera.modelObject.up.copy(_.Tme.DEFAULT_UP)}e&&this.setDirty(),(s=(i=this.uiConfig).uiRefresh)==null||s.call(i,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),this.cameraObject.getWorldPosition(this._positionWorld),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)==null?void 0:s.call(i,"postFrame",!1,1)})}activateMain(e=!0){var i,s;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new _.Pa4)),e&&(this.refreshCameraControls(!1),this._refreshCameraOptions(!0)),(s=(i=this._camera).setDirty)==null||s.call(i,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var s,o;const i=this.target;(o=(s=this._controls)==null?void 0:s.target)==null||o.set(i.x,i.y,i.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this._camera.userData.autoLookAtTarget!==void 0&&(this.autoLookAtTarget=this._camera.userData.autoLookAtTarget),this.autoLookAtTarget&&this._camera.modelObject.lookAt(i),e&&this.setDirty())}positionUpdated(e=!0){const i=this.position;this._camera.modelObject.position.set(i.x,i.y,i.z),this.targetUpdated(e)}positionTargetUpdated(e=!0){this.positionUpdated(e)}copyFromCamera(e,i=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(i).add(this._position),this.positionUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var i,s,o,c;return(s=(i=e.uniforms.cameraPositionWorld)==null?void 0:i.value)==null||s.copy(this._positionWorld),(c=(o=e.uniforms.cameraNearFar)==null?void 0:o.value)==null||c.set(this._camera.modelObject.near,this._camera.modelObject.far),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){const i={};return tu(i,this.userData),Object.assign({userData:i},To(this,!0,e))}fromJSON(e,i){return e.userData&&(tu(this.userData,e.userData),delete(e={...e}).userData),Oo(e,this,!0,i),this.positionUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}g0([Mn("camControls")],hu.prototype,"_controls",void 0),g0([(0,_e.onChange)(hu.prototype._nearFarChanged)],hu.prototype,"near",void 0),g0([(0,_e.onChange)(hu.prototype._nearFarChanged)],hu.prototype,"far",void 0),g0([Mn("camOptions")],hu.prototype,"_options",void 0),g0([Mn("position")],hu.prototype,"_position",void 0),g0([Mn("target")],hu.prototype,"_target",void 0);var Ym=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class Nl extends _.xsS{get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const i=this.activeCamera;if(e||(e=this.defaultCamera),i!==e){if(i&&(i.deactivateMain(),i.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let s=this._cameras.indexOf(e);s<0&&(this._cameras.push(e),s=this._cameras.length-1),this._activeCamera=s}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:i,camera:e}),this.setDirty()}}get renderCamera(){return this._renderCamera??this.activeCamera}set renderCamera(e){const i=this._renderCamera;this._renderCamera=e,this.dispatchEvent({type:"renderCameraChange",lastCamera:i,camera:e})}get modelObject(){return this}constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new Xt,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this.fixedEnvMapDirection=!1,this.backgroundIntensity=1,this._dummyCam=new hu(new _.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.backgroundColor=null,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("materialChanged",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=Em(new _.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new _.GQ(this.getBounds())}addModel(e,i={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,i)}addWidget(e,i={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,i={}){return this._addObject3D(e==null?void 0:e.modelObject,i)}addSceneObject(e,i){if(!e)return e;const s=e.assetType;let o=!1;switch(s){case"model":o=e.modelObject.isCamera,o&&(i={...i,autoScale:!1}),this._addModel(e,i);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,i);break;default:console.warn("Unknown asset imported",e,s)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:i=!0,autoScaleRadius:s=2,addToRoot:o=!1}={}){const c=e;c?(i&&!c.userData.autoScaled&&Mo(c,c.userData.autoScaleRadius||s),c.traverse(g=>{g.isMesh&&!g.userData.__keepShadowDef&&(g.castShadow=!0,g.receiveShadow=!0,g.userData.__keepShadowDef=!0)}),o?this.modelObject.add(c):this.modelRoot.add(c),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){[...this.modelRoot.children].forEach(e=>{var i;(e.dispose??((i=e.modelObject)==null?void 0:i.removeFromParent))()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){var e;((e=this.environment)==null?void 0:e.mapping)===_.xfE&&(this.environment.mapping=_.dSO,this.environment.needsUpdate=!0),this.dispatchEvent({type:"environmentChanged",environment:this.environment}),this._onSceneUpdate({geometryChanged:!1})}_onBackgroundChange(){this.dispatchEvent({type:"backgroundChanged",background:this.background,backgroundColor:this.backgroundColor}),this._onSceneUpdate({geometryChanged:!1})}add(...e){return super.add(...e.map(i=>Em(i))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return void(this.environment=null);if(!e.isTexture)return void console.error("Unknown Environment type",e);e.assetType!=="texture"&&console.warn("Environment asset not processed",e);const i=e.textureObject||e;this.environment=i}getEnvironment(){return this.environment}setBackground(e){let i;if(!e||e.assetType==="texture"||e.isTexture||e.isColor||e==="environment")i=((e==null?void 0:e.assetType)==="texture"||e.isTexture)&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);i=new _.Ilk(e)}this.background=i}setBackgroundColor(e){this.backgroundColor=e?new _.Ilk(e):null}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate||e!=null&&e.refreshScene?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var i,s,o;return e.sceneUpdate===!1&&e.refreshScene===!1?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(o=(s=(i=this.boxHelper)==null?void 0:i.box)==null?void 0:s.copy)==null||o.call(s,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new _.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){var e;this.disposeSceneModels(),this.clear(),(e=this.environment)==null||e.dispose()}findObjectsByName(e,i){const s=[];return(i??this.modelObject).traverse(o=>{o.name===e&&s.push(o)}),s}addLight(e,i={}){this.addSceneObject(e,i)}_addLight(e,{addToRoot:i=!1}={}){var o;const s=e.lightObject;s&&((o=s.children)==null||o.length,i?this.add(s):this.modelRoot.add(s))}getBounds(e=!1,i=!0,s=!0,o){return new Xt().expandByObject(this.modelObject,e,i,c=>!(!s||c.assetType!=="widget")||((o==null?void 0:o(c))??!1))}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;if(e.cameraObject.userData.autoNearFar===!1)return e.near=e.cameraObject.userData.minNearPlane??.5,void(e.far=e.cameraObject.userData.maxFarPlane??1e3);const i=this.getBounds(!1),s=e.cameraObject.getWorldPosition(new _.Pa4).sub(i.getCenter(new _.Pa4)),o=1.5*i.getSize(new _.Pa4).length()/2,c=Math.max(.1,-s.clone().normalize().dot(e.cameraObject.getWorldDirection(new _.Pa4))),g=s.length(),b=Math.max(Math.max(e.cameraObject.userData.minNearPlane??.5,.001),c*(g-o)),et=Math.min(Math.max(b+o,c*(g+o)),e.cameraObject.userData.maxFarPlane??1e3);e.near=b,e.far=et}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return To(this,!0,e)}fromJSON(e,i){const s=e.environment;return s!==void 0&&(this.setEnvironment(Oo(s,this.getEnvironment(),!1,i)),delete e.environment),Oo(e,this,!0,i),e.environment=s,this}addEventListener(e,i){super.addEventListener(e,i)}removeEventListener(e,i){super.removeEventListener(e,i)}get minNearDistance(){return console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera.userData.minNearPlane??.5}set minNearDistance(e){console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera&&(this.activeCamera.userData.minNearPlane=e)}}Ym([Mn()],Nl.prototype,"defaultCamera",void 0),Ym([(0,_e.onChange2)(Nl.prototype.setDirty),Mn()],Nl.prototype,"envMapIntensity",void 0),Ym([(0,_e.onChange2)(Nl.prototype.setDirty),Mn()],Nl.prototype,"fixedEnvMapDirection",void 0),Ym([(0,_e.onChange2)(Nl.prototype.setDirty),Mn()],Nl.prototype,"backgroundIntensity",void 0),Ym([Mn(),(0,_e.onChange)(Nl.prototype._onEnvironmentChange.name)],Nl.prototype,"environment",void 0),Ym([Mn(),(0,_e.onChange)(Nl.prototype._onBackgroundChange)],Nl.prototype,"background",void 0),Ym([Mn(),(0,_e.onChange)(Nl.prototype._onBackgroundChange)],Nl.prototype,"backgroundColor",void 0);function rs(h,e,i,{replaceAll:s=!1,prepend:o=!1,append:c=!1}={}){if(!h.includes(e))return console.error(`${e} not found in shader`),h;let g=i;return o?g=i+e:c&&(g=e+i),s?h.replaceAll(e,g):h.replace(e,g)}class wu{static ApplyMaterialExtensions(e,i,s,o){for(const c of s)this.ApplyMaterialExtension(e,i,c,o)}static ApplyMaterialExtension(e,i,s,o){let c=(0,_e.getOrCall)(s.parsFragmentSnippet,o,e)??"";c.length&&(i.fragmentShader=rs(i.fragmentShader,this.VoidMain,`
`+c+`
`,{prepend:!0})),c=(0,_e.getOrCall)(s.parsVertexSnippet,o,e)??"",c.length&&(i.vertexShader=rs(i.vertexShader,this.VoidMain,`
`+c+`
`,{prepend:!0})),s.extraUniforms&&(i.uniforms=Object.assign(i.uniforms,s.extraUniforms)),s.extraDefines&&function(g,b){let et=!1;b.materialObject&&b.materialObject.defines===void 0&&(b.materialObject.defines={});const tt=Object.entries(g);for(const[rt,st]of tt)st===void 0?b.materialObject.defines[rt]!==void 0&&(delete b.materialObject.defines[rt],et=!0):b.materialObject.defines[rt]!==st&&(b.materialObject.defines[rt]=st,et=!0);et&&(b.materialObject.needsUpdate=!0)}(s.extraDefines,e),s.shaderExtender&&s.shaderExtender(i,e,o),e.lastShader=i}static CacheKeyForExtensions(e,i){let s="";for(const o of i)s+=this.CacheKeyForExtension(e,o);return s}static CacheKeyForExtension(e,i){let s="";return i.customCacheKey&&(s+=i.customCacheKey),i.computeCacheKey&&(s+=i.computeCacheKey(e)),i.extraDefines&&Object.values(i.extraDefines).forEach(o=>s+=o),s}static RegisterExtensions(e,i){const s=[];if(i)for(const o of i)o.isCompatible&&o.isCompatible(e)&&(s.push(o),o.uuid||(o.uuid=np()),o.__setDirty||(o.__setDirty=()=>{o.updateVersion||(o.updateVersion=0),o.updateVersion++}),o.setDirty||(o.setDirty=o.__setDirty));return e.materialExtensions=s,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",o=>function(c,{object:g,renderer:b}){var et;if(c.materialExtensions)for(const tt of c.materialExtensions){if((et=tt.onObjectRender)==null||et.call(tt,g,c,b),c.lastShader){const rt=(0,_e.getOrCall)(tt.updaters)||[];for(const st of rt)st&&st.updateShaderProperties(c.lastShader)}tt.updateVersion!==c.materialObject.userData["_"+tt.uuid+"_version"]&&(c.materialObject.userData["_"+tt.uuid+"_version"]=tt.updateVersion,c.materialObject.needsUpdate=!0)}}(e,o))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",o=>function(c,{object:g,renderer:b}){var et;if(c.materialExtensions)for(const tt of c.materialExtensions)(et=tt.onAfterRender)==null||et.call(tt,g,c,b)}(e,o))),s}}wu.VoidMain="void main()";class Sm extends _.jyz{constructor(e,i=!1){super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.isRawShaderMaterial=!1,this.extraUniformsToUpload={},i&&(this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"),this.materialExtensions=wu.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...wu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,i){wu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:i}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+wu.CacheKeyForExtensions(this,this.materialExtensions)}onBeforeRender(e,i,s,o,c){super.onBeforeRender(e,i,s,o,c),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}onAfterRender(e,i,s,o,c){super.onAfterRender(e,i,s,o,c),this.dispatchEvent({type:"afterRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}class U_ extends Sm{constructor(){super(...arguments),this.typeSlug="shaderMat"}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}}class Cm extends U_{constructor(e,i){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(i)}setTextureIds(e){this.textures.map(i=>i.id).join(";")!==e.join(";")&&(this.textures=e.map(i=>({id:i,colorSpace:_.aCh})),this.setDirty())}_setUniformTexSize(e,i){var g,b;if(!i||!e)return;const s=((g=i.image)==null?void 0:g.width)??512,o=((b=i.image)==null?void 0:b.height)??512,c=e.value;c.isVector2||console.warn("uniform is not a Vector2"),c&&Math.abs(c.x-s)+Math.abs(c.y-o)>.1&&(c.x=s,c.y=o,this.uniformsNeedUpdate=!0)}onBeforeRender(e,i,s,o,c){var g,b;this._setUniformTexSize(this.uniforms.screenSize,(g=e.getRenderTarget())==null?void 0:g.texture);for(const et of this.textures){const tt=et.id,rt=(b=this.uniforms[tt])==null?void 0:b.value;rt&&(this._setUniformTexSize(this.uniforms[tt+"Size"],rt),rt.colorSpace!==et.colorSpace&&(et.colorSpace=rt.colorSpace,this.needsUpdate=!0))}super.onBeforeRender(e,i,s,o,c)}onBeforeCompile(e,i){e.fragmentShader=this.textures.map(s=>`uniform sampler2D ${s.id}; 
`+Dn(s.id??"input",s.colorSpace??_.aCh)).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.colorSpace).join(";")}}function Bs(h,...e){const i=h.fragmentShader;return new Cm({defines:Object.assign({},h.defines),uniforms:h.uniforms,vertexShader:h.vertexShader,fragmentShader:i},e)}class io extends Ft{constructor(e,...i){super(e.isMaterial?e:Bs(e,...i),i.length<1?io.DEFAULT_TEX_ID:i[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,i,s,o;(i=(e=this.material)==null?void 0:e.dispose)==null||i.call(e),(o=(s=this.fsQuad)==null?void 0:s.dispose)==null||o.call(s),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(i=>i==null?void 0:i.updateShaderProperties(this.material)))}render(e,i,s,o,c){this.enabled&&super.render(e,i||null,s,o,c)}}io.DEFAULT_TEX_ID="tDiffuse",function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);c>3&&g&&Object.defineProperty(e,i,g)}([Nr("Enabled"),Mn()],io.prototype,"enabled",void 0);class Km extends vt{constructor(e,i,s,o,c){super(),this.scene=e,this.camera=i,this.overrideMaterial=s,this.clearColor=o,this.clearAlpha=c!==void 0?c:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new _.Ilk}render(e,i,s,o,c,g){if(!this.scene||!this.camera)return;const b=e.autoClear;let et,tt;if(e.autoClear=!1,this.overrideMaterial!==void 0&&(tt=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),et=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),g){const rt=e.getContext();rt.framebufferRenderbuffer(rt.FRAMEBUFFER,rt.DEPTH_ATTACHMENT,rt.RENDERBUFFER,g)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),g){const rt=e.getContext();rt.framebufferRenderbuffer(rt.FRAMEBUFFER,rt.DEPTH_ATTACHMENT,rt.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,et),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=tt),e.autoClear=b}}class Mm extends io{constructor(e,i="c = a + b;",s="",o){super({vertexShader:dt.vertexShader,fragmentShader:_e.glsl`
                varying vec2 vUv;
                
                ${s}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${i}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:o},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class IS extends U_{constructor(e=!0){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#if IS_GLSL3 > 0
out vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
uniform float alphaTest;
#endif
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <alphamap_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;
#if IS_GLSL3 > 0
in vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
vec2 pack16(float value){float f=clamp(value,0.,1.)*255.;float digitLow=fract(f);float digitHigh=floor(f)/255.;return vec2(digitHigh,digitLow);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){
#glMarker mainStart
#ifdef USE_ALPHAMAP
#ifdef ALPHA_I_RGBA_PACKING
if(1.-unpackRGBAToDepth(texture2D(alphaMap,vAlphaMapUv))<alphaTest)
#else
if(texture2D(alphaMap,vAlphaMapUv).g<alphaTest)
#endif
discard;
#endif
#include <normal_fragment_begin>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:{cameraNearFar:{value:new _.FM8(.1,1e3)},alphaMap:{value:null},displacementMap:{value:null},displacementScale:{value:null},displacementBias:{value:null},displacementMapTransform:{value:new _.Vkp},alphaTest:{value:0},alphaMapTransform:{value:new _.Vkp},flags:{value:new _.Ltg(255,255,255,255)}},defines:{IS_GLSL3:e?"1":"0"},glslVersion:e?_.LSk:_.v9Y}),this._updaters=[]}onBeforeRender(e,i,s,o,c){super.onBeforeRender(e,i,s,o,c);let g=c.material;Array.isArray(g)&&(g=g[0]),this.uniforms.alphaMap.value=(g==null?void 0:g.alphaMap)??null,this.uniforms.alphaMap.value&&e.materials.refreshTransformUniform(this.uniforms.alphaMap.value,this.uniforms.alphaMapTransform),this.uniforms.alphaTest.value=!g||!g.alphaTest||g.alphaTest<1e-7?.001:g.alphaTest,this.uniforms.displacementMap.value=(g==null?void 0:g.displacementMap)??null,this.uniforms.displacementMap.value&&e.materials.refreshTransformUniform(this.uniforms.displacementMap.value,this.uniforms.displacementMapTransform),this.uniforms.displacementScale.value=(g==null?void 0:g.displacementScale)??1,this.uniforms.displacementBias.value=(g==null?void 0:g.displacementBias)??0,this.uniforms.flags.value.set(255,255,255,255),this.uniforms.flags.value.z=(g!=null&&g.userData.matId?g==null?void 0:g.userData.matId:0)/255,this._updaters.forEach(et=>{et(c,this.uniforms.flags.value)}),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let b=this.uniforms.alphaMap.value?1:void 0;b!==this.defines.USE_ALPHAMAP&&(b===void 0?(delete this.defines.USE_ALPHAMAP,delete this.defines.ALPHAMAP_UV):(this.defines.USE_ALPHAMAP=b,this.defines.ALPHAMAP_UV="uv"),this.needsUpdate=!0),b=this.uniforms.displacementMap.value?1:void 0,b!==this.defines.USE_DISPLACEMENTMAP&&(b===void 0?(delete this.defines.USE_DISPLACEMENTMAP,delete this.defines.DISPLACEMENTMAP_UV):(this.defines.USE_DISPLACEMENTMAP=b,this.defines.DISPLACEMENTMAP_UV="uv"),this.needsUpdate=!0),b=g.userData.ALPHA_I_RGBA_PACKING?1:void 0,b!==this.defines.ALPHA_I_RGBA_PACKING&&(b===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=b,this.needsUpdate=!0),b=g.userData.forcedLinearDepth??void 0,b!==this.defines.FORCED_LINEAR_DEPTH&&(b===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=b,this.needsUpdate=!0),this.side=g.side??_.ehD}addGBufferUpdater(e){this._updaters.push(e)}removeGBufferUpdater(e){const i=this._updaters.indexOf(e);i!==-1&&this._updaters.splice(i,1)}}var bp=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return value.x+value.y/255.;}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
ivec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return ivec4(texture2D(tGBufferFlags,uv)*255.);
#else
return ivec4(1);
#endif
}
#endif
`;class hs extends _e.SimpleEventDispatcher{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this.enabled&&this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const i=To(this,!0,e);return i.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:i}),i}fromJSON(e,i){return e.type!==this.constructor.PluginType?null:(Oo(e,this,!0,i),this.dispatchEvent({type:"deserialize",data:e,meta:i}),this)}_storeKey(e){return(e??"webgi")+"_"+(this.constructor.PluginType||this.constructor.name)}exportState(){var e,i,s;return((i=(e=this._viewer)==null?void 0:e.getPluginByType("AssetManager"))==null?void 0:i.exportPluginPreset(this))??((s=this.toJSON)==null?void 0:s.call(this))}async importState(e){var s,o;const i=(s=this._viewer)==null?void 0:s.getPluginByType("AssetManager");i?await i.importPluginPreset(e,this):(o=this.fromJSON)==null||o.call(this,e)}storeState(e,i,s){(i=i||(window?window.localStorage:void 0))?(s===void 0&&(s=this.exportState()),s&&i.setItem(this._storeKey(e),JSON.stringify(s))):console.warn("Unable to store state")}async loadState(e,i){if(!(i=i||(window?window.localStorage:void 0)))return void console.warn("Unable to load state");const s=i.getItem(this._storeKey(e));s&&await this.importState(JSON.parse(s))}}function Vo(h,e,i){return{...e,get dirty(){return e.dirty||!1},set dirty(s){(0,_e.safeSetProperty)(e,"dirty",s,!0)},update(){var s,o,c;this.passObject.enabled&&((o=(s=this.passObject).updateShaderProperties)==null||o.call(s,(0,_e.getOrCall)(i)),(c=e.update)==null||c.call(this))},onRegister(s){var o,c,g;this.passObject.materialExtension&&((c=(o=h.getPluginByType("AssetManager"))==null?void 0:o.materials)==null||c.registerMaterialExtension(this.passObject.materialExtension)),(g=e.onRegister)==null||g.call(this,s)},onUnregister(s){var o,c,g;this.passObject.materialExtension&&((c=(o=h.getPluginByType("AssetManager"))==null?void 0:o.materials)==null||c.unregisterMaterialExtension(this.passObject.materialExtension)),(g=e.onUnregister)==null||g.call(this,s)},dispose(){var s,o,c;(o=(s=this.passObject).dispose)==null||o.call(s),(c=e.dispose)==null||c.call(this)}}}class Tm extends hs{_update(e){var i;return((i=this._pass)==null?void 0:i.enabled)&&this.enabled||!1}get enabled(){var e,i;return((i=(e=this._pass)==null?void 0:e.passObject)==null?void 0:i.enabled)??this._enabledTemp}set enabled(e){var i;(i=this._pass)!=null&&i.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}constructor(){super(),this._enabledTemp=!0}async onAdded(e){await super.onAdded(e);const i={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(s){s&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=Vo(e,i),i.passObject.onDirty!==void 0&&i.passObject.onDirty.push(()=>i.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var i,s;this._pass&&e.renderer.unregisterPass(this._pass),(s=(i=this._pass)==null?void 0:i.dispose)==null||s.call(i),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){const i=super.toJSON(e);if(!i.type)return i;const s=this.pass;return s&&(i.pass=To((s==null?void 0:s.passObject)??s,!1,e)),i}fromJSON(e,i){if(!super.fromJSON(e,i))return null;if(e.pass){const s=this.pass;s&&Oo(e.pass,(s==null?void 0:s.passObject)??s,!1,i)}return this}}(function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);c>3&&g&&Object.defineProperty(e,i,g)})([Mn()],Tm.prototype,"enabled",null);const nu=new Set,cx=new Set;class nm extends Km{constructor(e,i,s=new zo(1,1,1),o=1){super(void 0,void 0,i,s,o),this.target=e}render(e,i,s,o,c){var tt;const g=e.getRenderTarget(),b=e.getActiveCubeFace(),et=e.getActiveMipmapLevel();(tt=this.scene)==null||tt.traverse(({material:rt})=>{rt&&((rt.transparent&&rt.userData.renderToDepth||!rt.transparent&&rt.transmission===0&&rt.userData.renderToDepth===!1)&&(nu.add(rt),rt.transparent=!rt.transparent),Math.abs(rt.transmission||0)>0&&rt.userData.renderToDepth&&(cx.add([rt,rt.transmission]),rt.transmission=0))}),no(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,i,this.target,o,c)),nu.forEach(rt=>rt.transparent=!rt.transparent),nu.clear(),cx.forEach(([rt,st])=>rt.transmission=st),cx.clear(),e.setRenderTarget(g,b,et)}}class bo extends Tm{get material(){return this._material}passCtor(e){var o,c;const i=((o=this._viewer)==null?void 0:o.renderer.isWebGL2)&&this.renderFlagsBuffer,s=e.renderer.createTarget({depthBuffer:!0,samples:((c=this._viewer)==null?void 0:c.renderer.composerTarget.samples)||0,type:_.ywz,textureCount:i?2:1});return Array.isArray(s.texture)?(s.texture[0].name="gbufferDepthNormal",s.texture[1].name="gbufferFlags",this._gbufferTextures=s.texture):(s.texture.name="gbufferDepthNormal",this._gbufferTextures.push(s.texture)),this._gbufferTarget=s,this._material=new IS(i),this._material.userData.isGBufferMaterial=!0,new nm(s,this._material)}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.renderCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.renderCamera.cameraObject,!0}constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return bp}updateShaderProperties(e){var i;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=this.getDepthNormal()??void 0:(i=this._viewer)==null||i.console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=this.getFlagsTexture()??void 0;const s=e.uniforms.tGBufferFlags.value?1:0;s!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=s,e.needsUpdate=!0)}return this}registerGBufferUpdater(e){this._material&&this._material.addGBufferUpdater(e)}}bo.PluginType="GBuffer";class LA extends Km{get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,colorSpace:_.aCh,type:this._viewer.renderer.rendererObject.extensions.has("EXT_color_buffer_half_float")?_.cLu:_.ywz,format:_.wk1,minFilter:_.wem,magFilter:_.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}constructor(e,i=!0){super(),this.blurTransmissionTarget=!0,this.preserveTransparentTarget=!1,this._viewer=e,this._doTransmissionFix=i,this.clear=!0,this.clearColor=new zo(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new Mm({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}render(e,i,s,o,c){var st;let g=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,i,s,o,c),this.needsSwap=g,void(e.userData.mainRenderPass=void 0);const b=e.userData;b||console.error("threejs is not patched?");const et=this._viewer.useGBufferDepth;let tt;if(et){const at=(st=this._viewer.getPlugin(bo))==null?void 0:st.getTarget();if(at){const ct=e.properties.get(at);tt=ct.__webglDepthRenderbuffer||ct.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let rt=(at=!1)=>{super.render(e,void 0,s,o,c,tt)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(g=!1,e.info&&!e.info.autoReset)throw"renderer.info.autoReset must be true";{const at=e.autoClearDepth;e.autoClearDepth=!et,no(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},rt),e.autoClearDepth=at}if(!et){const at=e.properties.get(s);tt=at.__webglDepthRenderbuffer||at.__webglDepthbuffer}rt=()=>{super.render(e,void 0,this.transparentTarget,o,c,tt)};{const at=this.clear,ct=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,no(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},rt),this.clear=at,e.autoClearDepth=ct}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,o,c),g=!0);{const at=this.clear;this.clear=!1,b.transmissionRenderTarget=g?i:s,b.blurTransmissionTarget=this.blurTransmissionTarget&&b.transmissionRenderTarget.samples===0,no(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},rt),b.blurTransmissionTarget=void 0,b.transmissionRenderTarget=void 0,this.clear=at}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,o,c),g=!0)}}else{{const at=this.clear,ct=e.autoClearDepth;e.autoClearDepth=!et,this.clear=!0,no(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},rt),this.clear=at,e.autoClearDepth=ct}{this._viewer.renderer.blit(s.texture,i,{clear:!0});const at=this.clear;this.clear=!1,b.transmissionRenderTarget=i,b.blurTransmissionTarget=this.blurTransmissionTarget,no(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},rt),b.blurTransmissionTarget=void 0,b.transmissionRenderTarget=void 0,this.clear=at}g=!1}this.preserveTransparentTarget||this._releaseTransparentTarget(),this.needsSwap=g,e.userData.mainRenderPass=void 0}dispose(){this._releaseTransparentTarget(),super.dispose()}}function ux(h,e){return h.multiplyScalar(h.w*e),h.w=1,h}function PS(h,e){return ux(h,e),new zo(h.x,h.y,h.z)}function RS(h,e){const i=Math.max(h.x,Math.max(h.y,h.z));let s=Math.max(Math.min(i/e,1),0);return s=Math.ceil(255*s)/255,h.divideScalar(s*e),h.w=s,h}function k1(h,e){return RS(new _.Ltg(h.r,h.g,h.b,1),e)}const B1={name:"",blending:_.bdR,side:_.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:_.k74,blendDst:_.LgZ,blendEquation:_.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:_.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:_.cum,stencilRef:0,stencilFuncMask:255,stencilFail:_.x5V,stencilZFail:_.x5V,stencilZPass:_.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaToCoverage:!1,premultipliedAlpha:!1,forceSinglePass:!1,visible:!0,toneMapped:!0,userData:{},alphaTest:0},by={...B1,color:"#ffffff",roughness:1,metalness:0,map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,emissive:"#000000",emissiveIntensity:1,emissiveMap:null,bumpMap:null,bumpScale:1,normalMap:null,normalMapType:_.IOt,normalScale:new _.FM8(1,1),displacementMap:null,displacementScale:1,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:1,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",flatShading:!1,fog:!0},Jm={...by,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new _.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,iridescence:0,iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null,sheen:0,sheenColor:new zo(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:1/0,attenuationColor:new zo(1,1,1),specularIntensity:1,specularIntensityMap:null,specularColor:new zo(1,1,1),specularColorMap:null};class Qu extends _.EJi{constructor(e){super(e),this.typeSlug=Qu.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.fog=!1,this.attenuationDistance=0,this.materialExtensions=wu.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)==null?void 0:i.uiRefresh)==null||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...wu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"checkbox",property:[this,"vertexColors"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Ko(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},Ko(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},Ko(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[-.1,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},Ko(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",_.IOt],["ObjectSpace",_.PA7]].map(e=>({label:e[0],value:e[1]}))},Ko(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},Ko(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},Ko(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},Ko(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},Ko(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},Ko(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},Ko(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},Ko(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,4],property:[this,"ior"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},Ko(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},Ko(this,"thicknessMap"),{type:"input",property:[this,"attenuationDistance"]},{type:"color",property:[this,"attenuationColor"]}]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",_.BVF],["Always",_.Se2],["Less",_.Zr5],["LessEqual",_.vCF],["Equal",_.eD],["GreaterEqual",_.ksN],["Greater",_.w$m],["NotEqual",_.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Jp],["Normal",bm],["Additive",_.WMw],["Subtractive",Hl],["Multiply",Ql]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Ko(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Ko(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Ko(this,"lightMap")]},{type:"folder",label:"Iridescence",children:[{type:"slider",bounds:[0,3],label:"Intensity",property:[this,"iridescence"]},{type:"slider",bounds:[0,3],label:"IOR",property:[this,"iridescenceIOR"]},{type:"slider",bounds:[0,500],label:"Thickness0",property:[this.iridescenceThicknessRange,"0"],onChange:this.setDirty},{type:"slider",bounds:[0,500],label:"Thickness1",property:[this.iridescenceThicknessRange,"1"],onChange:this.setDirty},{type:"image",property:[this,"iridescenceMap"]},Ko(this,"iridescenceMap"),{type:"image",property:[this,"iridescenceThicknessMap"]},Ko(this,"iridescenceThicknessMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",_.Wl3],["Back",_._Li],["Double",_.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>{var e,i;return((i=(e=this.userData)==null?void 0:e.__appliedMeshes)==null?void 0:i.size)??0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(To(this,!1),null,2)],{type:"application/json"});(0,_e.downloadBlob)(e,`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)==null?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],o=[["#include <uv_vertex>","mainStart"]];for(const c of o)e.vertexShader=rs(e.vertexShader,c[0],"#glMarker "+c[1]+`
`+c[0]);for(const c of s)e.fragmentShader=rs(e.fragmentShader,c[0],"#glMarker "+c[1]+`
`+c[0]);wu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+wu.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,o,c){super.onBeforeRender(e,i,s,o,c),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||i.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=i.envMapIntensity),this.envMap!==void 0&&i.fixedEnvMapDirection!==void 0&&(i.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:o,object:c});const g=this.userData.inverseAlphaMap?1:0;g!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=g,this.needsUpdate=!0)}onAfterRender(e,i,s,o,c){super.onAfterRender(e,i,s,o,c),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}copyProps(e,i=!1,s=!0){if(!i&&!["MeshStandardMaterial",Qu.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const o={},c=Array.from(Object.keys(Jm));(0,_e.copyProps)(e,o,c);const g=o.userData;delete o.userData;for(const b of Object.keys(o))o[b]===void 0&&delete o[b];if(this.setValues(o),s)for(const b of DA)this.userData[b]!==void 0&&this.userData[b];return g&&Pu(this.userData,g),isFinite(this.attenuationDistance)||(this.attenuationDistance=0),this.setDirty(),this}toJSON(e){var c,g;const i=this.userData;this.userData={};const s=super.toJSON(e);this.userData=i,s.userData={},Pu(s.userData,i),s.userData.uuid=this.userData.uuid;const o=e||{textures:Object.fromEntries(((c=s.textures)==null?void 0:c.map(b=>[b.uuid,b]))||[]),images:Object.fromEntries(((g=s.images)==null?void 0:g.map(b=>[b.uuid,b]))||[])};s.userData=To(s.userData,!1,o),e||(Object.keys(o.textures).length>0&&(s.textures=Object.values(o.textures)),Object.keys(o.images).length>0&&(s.images=Object.values(o.images))),s.type=Qu.TYPE;for(const b of Object.keys(s))s[b]===void 0&&delete s[b];return s}fromJSON(e,i,s=!1){return this.copyProps(e,s)}clone(){return super.clone()}}Qu.TypeSlug="pmat",Qu.TYPE="MeshStandardMaterial2";const hx={...B1,color:"#ffffff",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,specularMap:null,alphaMap:null,envMap:null,combine:_.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",skinning:!1,fog:!0};class Wu extends _.vBJ{constructor(e){super(e),this.typeSlug=Wu.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},!this.defines&&(this.defines={}),this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.materialExtensions=wu.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)==null?void 0:i.uiRefresh)==null||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...wu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Ko(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Jp],["Normal",bm],["Additive",_.WMw],["Subtractive",Hl],["Multiply",Ql]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Ko(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Ko(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Ko(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",_.Wl3],["Back",_._Li],["Double",_.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,i;return((i=(e=this.userData)==null?void 0:e.__appliedMeshes)==null?void 0:i.size)??0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(To(this,!1),null,2)],{type:"application/json"});(0,_e.downloadBlob)(e,`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)==null?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],o=[["#include <uv_vertex>","mainStart"]];for(const c of o)e.vertexShader=rs(e.vertexShader,c[0],"#glMarker "+c[1]+`
`+c[0]);for(const c of s)e.fragmentShader=rs(e.fragmentShader,c[0],"#glMarker "+c[1]+`
`+c[0]);wu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:i}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+wu.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,o,c){super.onBeforeRender(e,i,s,o,c),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}onAfterRender(e,i,s,o,c){super.onAfterRender(e,i,s,o,c),this.dispatchEvent({type:"afterRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}copyProps(e,i=!1){if(!i&&!["MeshBasicMaterial",Wu.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const s={},o=Array.from(Object.keys(hx));(0,_e.copyProps)(e,s,o);const c=s.userData;delete s.userData;for(const g of Object.keys(s))s[g]===void 0&&delete s[g];return this.setValues(s),c&&Pu(this.userData,c),this.setDirty(),this}toJSON(e){var c,g;const i=this.userData;this.userData={};const s=super.toJSON(e);this.userData=i,s.userData={},Pu(s.userData,i),s.userData.uuid=this.userData.uuid;const o=e||{textures:Object.fromEntries(((c=s.textures)==null?void 0:c.map(b=>[b.uuid,b]))||[]),images:Object.fromEntries(((g=s.images)==null?void 0:g.map(b=>[b.uuid,b]))||[])};s.userData=To(s.userData,!1,o),e||(Object.keys(o.textures).length>0&&(s.textures=Object.values(o.textures)),Object.keys(o.images).length>0&&(s.images=Object.values(o.images))),s.type=Wu.TYPE;for(const b of Object.keys(s))s[b]===void 0&&delete s[b];return s}fromJSON(e,i,s=!1){return this.copyProps(e,s)}clone(){return super.clone()}}Wu.TypeSlug="bmat",Wu.TYPE="MeshBasicMaterial2";const NA={materialType:Qu.TYPE,name:"standard",color:"#ffffff"},UA={materialType:Wu.TYPE,name:"basic",color:"#ffffff"},dx={[Qu.TYPE]:NA.name,MeshStandardMaterial:NA.name,MeshPhysicalMaterial:NA.name,[Wu.TYPE]:UA.name,MeshBasicMaterial:UA.name};class v0 extends _e.SimpleEventDispatcher{constructor(){super(),this._templates=[NA,UA],this._materials=[],this._disposeMaterial=e=>{const i=e.target;if(!i||i.assetType!=="material")return;this._refreshTextureRefs();const s=this._getMapsForMaterial(i),o=[];s.forEach(c=>{const g=c.userData.__appliedMaterials;g==null||g.delete(i),g&&c.userData.disposeOnIdle!==!1&&g.size===0&&o.push(c)}),o.forEach(c=>{c.dispose()}),this.unregisterMaterial(i)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,i){let s=this.findMaterial(e);return s||(s=this.generateFromTemplate(e,i)),s}generateFromTemplate(e,i){const s=this.findTemplate(e);if(s)return this._generateFromTemplate(s,i??{})}generateFromTemplateType(e,i){const s=this._templates.find(o=>o.materialType===e);if(s)return this._generateFromTemplate(s,i??{})}findTemplate(e){return this._templates.find(i=>i.name===e)}_refreshTextureRefs(e){(e||this.getAllMaterials()).forEach(i=>{this._getMapsForMaterial(i).forEach(s=>{let o=s.userData.__appliedMaterials;o||(s.userData.__appliedMaterials=o=new Set),s.addEventListener("update",()=>i.dispatchEvent({type:"textureUpdate",texture:s})),o.add(i)})})}_getMapsForMaterial(e){const i=new Set;for(const s of Object.values(e))s&&s.isTexture&&i.add(s);for(const s of Object.values(e.userData??{}))s&&s.isTexture&&i.add(s);return i}registerMaterial(e){if(this._materials.includes(e))return;const i=this.findMaterial(e.uuid);i?console.warn("Material UUID already exists",e,i):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e),this._refreshTextureRefs([e]))}registerMaterialObject(e){const i=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(i),i}unregisterMaterial(e){this._materials=this._materials.filter(i=>i.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=np());const i=this._templates.find(s=>s.templateUUID===e.templateUUID);i?console.warn("MaterialTemplate already exists",e,i):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(i=>i.templateUUID!==e.templateUUID)}dispose(e=!0){const i=this._materials;this._materials=[];for(const s of i)e||!s.userData.runtimeMaterial?s.dispose():this._materials.push(s)}findMaterial(e){return e?this._materials.find(i=>i.uuid===e):void 0}findMaterialsByName(e,i=!1){return this._materials.filter(s=>typeof e!="string"||i?s.name.match(typeof e=="string"?"^"+e+"$":e)!==null:s.name===e)}getMaterialsOfType(e){return e?this._materials.filter(i=>i.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,i){const s=this._processModel(e,i);return(0,_e.safeSetProperty)(e,"modelObject",s),e}_processMaterial(e,i){var o,c;if(!e)return;if((o=e.materialObject)!=null&&o.isMaterial)return e;let s=e.mmMaterial;if(!s){const g=((c=e.userData)==null?void 0:c.uuid)||e.uuid;if(s=this.findMaterial(g),s)s.copyProps(e);else{const b=i.useSourceMaterial===!1||!e.isMaterial,et=i.materialTemplate||(b?"standard":dx[e.type]||"standard");s=this.generateFromTemplate(et,b?{}:e)}e.mmMaterial=s}return s}processMaterial(e,i){return e.materialObject||(e=this._processMaterial(e,{...i,register:!1})),i.register!==!1&&this.registerMaterial(e),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const i=this._materialExtensions.indexOf(e);i>=0&&this._materialExtensions.splice(i,1)}exportMaterial(e,i,s=!0,o=!1){const c=To(e,!1),g=JSON.stringify(c,null,s?0:2),b=(i||e.name||"physical_material")+"."+e.typeSlug,et=new File([g],b,{type:"application/json"});return o&&(0,_e.downloadFile)(et),et}applyMaterial(e,i){var g;const s=Object.getPrototypeOf(e).constructor.TYPE;let o=this.findMaterialsByName(i,!0);(!o||o.length<1)&&(o=[this.findMaterial(i)]);let c=!1;for(const b of o)if(b&&!b.userData.__isVariation&&b!==e)if(Object.getPrototypeOf(b).constructor.TYPE===s){const et=b.name;b.copyProps(e),b.name=et,c=!0}else{const et=b["__"+s]||this.generateFromTemplateType(s);if(!et)continue;const tt=b.name;et.copyProps(e),et.name=tt;const rt=b.userData.__appliedMeshes;for(const st of[...rt??[]])(g=st==null?void 0:st.setMaterial)==null||g.call(st,et),st&&(c=!0);b["__"+s]=et}return c}}class _0 extends v0{_generateFromTemplate(e,i){var b,et,tt,rt,st;let s;const o={...e};o.customMaterialExtensions=[...o.customMaterialExtensions??[],...this._materialExtensions];const c=(i==null?void 0:i.metadata)&&(i==null?void 0:i.metadata.version)<=4.5;c&&(_.epp.enabled=!1);let g={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":i&&(0,_e.copyProps)(i,o,Array.from(Object.keys(Jm))),(i==null?void 0:i.type)==="MeshBasicMaterial"&&(o.roughness=.9,o.metalness=0,(b=o.userData)!=null&&b.uuid&&delete o.userData.uuid),g=(et=o.userData)==null?void 0:et.uuid,g&&delete o.userData.uuid,s=new Qu({customMaterialExtensions:o.customMaterialExtensions}).fromJSON(o,void 0,!0),g&&(s.uuid=g),s.userData.uuid=s.uuid,s.setDirty(),i!=null&&i.isMaterial&&i.userData!==void 0&&(i.userData.iMaterial=s);break;case"MeshBasicMaterial2":case"basic":case"unlit":i&&(0,_e.copyProps)(i,o,Array.from(Object.keys(hx))),g=(tt=o.userData)==null?void 0:tt.uuid,g&&delete o.userData.uuid,s=new Wu({customMaterialExtensions:o.customMaterialExtensions}).fromJSON(o,void 0,!0),g&&(s.uuid=g,o.userData.uuid=g),s.userData.uuid=s.uuid,s.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:g=null,i&&i.userData&&(g=i.userData,delete i.userData),s=((rt=e.generator)==null?void 0:rt.call(e,o,i))||void 0,i&&g&&(i.userData=g),g&&s&&(Pu(s.userData,g),g!=null&&g.uuid&&(s.uuid=g.uuid),g=null),s&&(s.userData.uuid=s.uuid)}if(s){i.runtimeMaterial&&(s.userData.__runtimeMaterial=!0);const at=s;if(s.clone=()=>{at.userData.cloneId||(at.userData.cloneId="0"),at.userData.cloneCount||(at.userData.cloneCount=0),at.userData.cloneCount+=1;const ct=this.generateFromTemplate(e.name);return ct&&(ct.copyProps(at),ct.userData.cloneId=ct.userData.cloneId+"_"+at.userData.cloneCount,ct.userData.cloneCount=0,ct.name=ct.name+"_"+ct.userData.cloneId,ct.userData.uuid=ct.uuid),ct==null?void 0:ct.materialObject},i){let ct=this.findMaterial(i==null?void 0:i.uuid);ct&&this.unregisterMaterial(ct),ct=this.findMaterial((st=i==null?void 0:i.materialObject)==null?void 0:st.uuid),ct&&this.unregisterMaterial(ct)}}return c&&(_.epp.enabled=!0),s?this.registerMaterialObject(s):void 0}_processModel(e,i){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let s=e.material;if(!s&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),s=this._defaultMaterial,e.material=s),s){let o=!0;Array.isArray(s)||(s=[s],o=!1);const c=[];for(const g of s){const b=this._processMaterial(g,i);c.push(b==null?void 0:b.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(o?c:c[0]))}if(i.recursive!==!1)for(let o=0;o<e.modelObject.children.length;o++)e.modelObject.children[o]=this._processModel(e.modelObject.children[o],i);return e}}class yl{ctor(e){const i=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(i,e):i}constructor(e,i,s,o){this.cls=e,this.ext=i,this.root=s,this.onCtor=o}}class wy{get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}constructor(e,{pseudoCenter:i=!1,autoCenter:s=!1,autoScale:o=!1,autoScaleRadius:c=2,license:g=""}={}){if(this.assetType="model",this._modelObject=Em(new _.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!i||e.userData.pseudoCentered||e.userData.isCentered)!s||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?i||s||(e.userData.isCentered=!0):ba(e),this._modelObject=e;else{s&&console.error("cannot use pseudoCenter and autoCenter at the same time");const b=new Xt().expandByObject(e,!0,!0).getCenter(new _.Pa4);this._modelObject.position.copy(b).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,e.userData.iModel=this}o&&!this._modelObject.userData.autoScaled?Mo(this._modelObject,e.userData.autoScaleRadius||c):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=g}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,i){this._modelObject.addEventListener(e,i)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,i){return this._modelObject.hasEventListener(e,i)}removeEventListener(e,i){this._modelObject.removeEventListener(e,i)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var i,s,o,c;(s=(i=this._modelObject)==null?void 0:i.setDirty)==null||s.call(i,e),(c=(o=this._uiConfig)==null?void 0:o.uiRefresh)==null||c.call(o,"postFrame",!0)}setMaterial(e){var i,s;return this._modelObject.isMesh?((s=(i=this._modelObject).setMaterial)==null?void 0:s.call(i,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,i=!1){var s,o;if(this._modelObject.isMesh)return(o=(s=this._modelObject).setGeometry)==null?void 0:o.call(s,e,i);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=BA(this._modelObject,!1)),this._uiConfig}clone(){return new wy(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function FA(h,e){return[h.modelObject,...h.modelObject.children].forEach(i=>{Em(i,i!==h.modelObject?h:void 0,e)}),h}class $m{constructor(){this._processors=new Map}add(e,i){var s;this._processors.has(e)||this._processors.set(e,[]),(s=this._processors.get(e))==null||s.push(i)}remove(e,i){const s=this._processors.get(e),o=(s==null?void 0:s.indexOf(i))||(s==null?void 0:s.findIndex(c=>c.process&&c.process===i.process||c.processAsync&&c.processAsync===i.processAsync));!s||!o||o<0||s.splice(o,1)}get(e){return this._processors.get(e)??[]}async process(e,i,s){var g,b;const o=this.get(e),c=i.assetType;for(const et of o)et.forAssetType===c&&(i=((g=et.process)==null?void 0:g.call(et,i,s))??i,i=await((b=et.processAsync)==null?void 0:b.call(et,i,s))??i);return i}dispose(){this._processors.clear()}}class Al extends _.hH6{load(e,i,s,o){return super.load(e,c=>{try{if(typeof c!="string")throw new Error("Invalid JSON");i==null||i(JSON.parse(c))}catch(g){o==null||o(g)}},s,o)}}class DS extends _.yxD{constructor(e){super(e),this.type=_.cLu}parse(e){const i=function(et,tt){switch(et){case 1:console.error("THREE.RGBELoader Read Error: "+(tt||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(tt||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(tt||""));break;default:console.error("THREE.RGBELoader: Error: "+(tt||""))}return-1},s=function(et,tt,rt){tt=tt||1024;let st=et.pos,at=-1,ct=0,pt="",gt=String.fromCharCode.apply(null,new Uint16Array(et.subarray(st,st+128)));for(;0>(at=gt.indexOf(`
`))&&ct<tt&&st<et.byteLength;)pt+=gt,ct+=gt.length,st+=128,gt+=String.fromCharCode.apply(null,new Uint16Array(et.subarray(st,st+128)));return-1<at&&(rt!==!1&&(et.pos+=ct+at+1),pt+gt.slice(0,at))},o=function(et,tt,rt,st){const at=et[tt+3],ct=Math.pow(2,at-128)/255;rt[st+0]=et[tt+0]*ct,rt[st+1]=et[tt+1]*ct,rt[st+2]=et[tt+2]*ct,rt[st+3]=1},c=function(et,tt,rt,st){const at=et[tt+3],ct=Math.pow(2,at-128)/255;rt[st+0]=_.A5E.toHalfFloat(Math.min(et[tt+0]*ct,65504)),rt[st+1]=_.A5E.toHalfFloat(Math.min(et[tt+1]*ct,65504)),rt[st+2]=_.A5E.toHalfFloat(Math.min(et[tt+2]*ct,65504)),rt[st+3]=_.A5E.toHalfFloat(1)},g=new Uint8Array(e);g.pos=0;const b=function(et){const tt=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,rt=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,st=/^\s*FORMAT=(\S+)\s*$/,at=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,ct={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let pt,gt;if(et.pos>=et.byteLength||!(pt=s(et)))return i(1,"no header found");if(!(gt=pt.match(/^#\?(\S+)/)))return i(3,"bad initial token");for(ct.valid|=1,ct.programtype=gt[1],ct.string+=pt+`
`;pt=s(et),pt!==!1;)if(ct.string+=pt+`
`,pt.charAt(0)!=="#"){if((gt=pt.match(tt))&&(ct.gamma=parseFloat(gt[1])),(gt=pt.match(rt))&&(ct.exposure=parseFloat(gt[1])),(gt=pt.match(st))&&(ct.valid|=2,ct.format=gt[1]),(gt=pt.match(at))&&(ct.valid|=4,ct.height=parseInt(gt[1],10),ct.width=parseInt(gt[2],10)),2&ct.valid&&4&ct.valid)break}else ct.comments+=pt+`
`;return 2&ct.valid?4&ct.valid?ct:i(3,"missing image size specifier"):i(3,"missing format specifier")}(g);if(b!==-1){const et=b.width,tt=b.height,rt=function(st,at,ct){const pt=at;if(pt<8||pt>32767||st[0]!==2||st[1]!==2||128&st[2])return new Uint8Array(st);if(pt!==(st[2]<<8|st[3]))return i(3,"wrong scanline width");const gt=new Uint8Array(4*at*ct);if(!gt.length)return i(4,"unable to allocate buffer space");let At=0,xt=0;const yt=4*pt,_t=new Uint8Array(4),Mt=new Uint8Array(yt);let It=ct;for(;It>0&&xt<st.byteLength;){if(xt+4>st.byteLength)return i(1);if(_t[0]=st[xt++],_t[1]=st[xt++],_t[2]=st[xt++],_t[3]=st[xt++],_t[0]!=2||_t[1]!=2||(_t[2]<<8|_t[3])!=pt)return i(3,"bad rgbe scanline format");let Bt,Lt=0;for(;Lt<yt&&xt<st.byteLength;){Bt=st[xt++];const Jt=Bt>128;if(Jt&&(Bt-=128),Bt===0||Lt+Bt>yt)return i(3,"bad scanline data");if(Jt){const sn=st[xt++];for(let on=0;on<Bt;on++)Mt[Lt++]=sn}else Mt.set(st.subarray(xt,xt+Bt),Lt),Lt+=Bt,xt+=Bt}const Ht=pt;for(let Jt=0;Jt<Ht;Jt++){let sn=0;gt[At]=Mt[Jt+sn],sn+=pt,gt[At+1]=Mt[Jt+sn],sn+=pt,gt[At+2]=Mt[Jt+sn],sn+=pt,gt[At+3]=Mt[Jt+sn],At+=4}It--}return gt}(g.subarray(g.pos),et,tt);if(rt!==-1){let st,at,ct;switch(this.type){case _.VzW:ct=rt.length/4;const pt=new Float32Array(4*ct);for(let At=0;At<ct;At++)o(rt,4*At,pt,4*At);st=pt,at=_.VzW;break;case _.cLu:ct=rt.length/4;const gt=new Uint16Array(4*ct);for(let At=0;At<ct;At++)c(rt,4*At,gt,4*At);st=gt,at=_.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:et,height:tt,data:st,header:b.string,gamma:b.gamma,exposure:b.exposure,type:at}}}return null}setDataType(e){return this.type=e,this}load(e,i,s,o){return super.load(e,function(c,g){switch(c.type){case _.VzW:case _.cLu:c.colorSpace=_.GUF,c.minFilter=_.wem,c.magFilter=_.wem,c.generateMipmaps=!1,c.flipY=!0}i&&i(c,g)},s,o)}}function a_(h){return new yl(class extends DS{constructor(e){super(e),this.setDataType(B0(h.renderer.rendererObject))}},["hdr"],!1)}class Im extends _.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new Ao(i)}),this.register(function(i){return new jp(i)}),this.register(function(i){return new kS(i)}),this.register(function(i){return new BS(i)}),this.register(function(i){return new im(i)}),this.register(function(i){return new ho(i)}),this.register(function(i){return new O1(i)}),this.register(function(i){return new Br(i)}),this.register(function(i){return new Sy(i)}),this.register(function(i){return new oo(i)}),this.register(function(i){return new l_(i)}),this.register(function(i){return new xy(i)}),this.register(function(i){return new y0(i)}),this.register(function(i){return new Cy(i)})}load(e,i,s,o){const c=this;let g;g=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:_.Zp0.extractUrlBase(e),this.manager.itemStart(e);const b=function(tt){o?o(tt):console.error(tt),c.manager.itemError(e),c.manager.itemEnd(e)},et=new _.hH6(this.manager);et.setPath(this.path),et.setResponseType("arraybuffer"),et.setRequestHeader(this.requestHeader),et.setWithCredentials(this.withCredentials),et.load(e,function(tt){try{c.parse(tt,g,function(rt){i(rt),c.manager.itemEnd(e)},b,e)}catch(rt){b(rt)}},s,b)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,o,c){let g;const b={},et={},tt=new TextDecoder;if(typeof e=="string")g=JSON.parse(e);else if(e instanceof ArrayBuffer)if(tt.decode(new Uint8Array(e,0,4))===px){try{b[Is.KHR_BINARY_GLTF]=new A0(e)}catch(st){return void(o&&o(st))}g=JSON.parse(b[Is.KHR_BINARY_GLTF].content)}else g=JSON.parse(tt.decode(e));else g=e;if(g.asset===void 0||g.asset.version[0]<2)return void(o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const rt=new Rn(g,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});rt.fileLoader.setRequestHeader(this.requestHeader);for(let st=0;st<this.pluginCallbacks.length;st++){const at=this.pluginCallbacks[st](rt);et[at.name]=at,b[at.name]=!0}if(g.extensionsUsed)for(let st=0;st<g.extensionsUsed.length;++st){const at=g.extensionsUsed[st],ct=g.extensionsRequired||[];switch(at){case Is.KHR_MATERIALS_UNLIT:b[at]=new Ey;break;case Is.KHR_DRACO_MESH_COMPRESSION:b[at]=new b0(g,this.dracoLoader);break;case Is.KHR_TEXTURE_TRANSFORM:b[at]=new fx;break;case Is.KHR_MESH_QUANTIZATION:b[at]=new OS;break;default:ct.indexOf(at)>=0&&et[at]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+at+'".')}}rt.setExtensions(b),rt.setPlugins(et),rt.parse(s,o)}parseAsync(e,i){const s=this;return new Promise(function(o,c){s.parse(e,i,o,c)})}}function Fp(){let h={};return{get:function(e){return h[e]},add:function(e,i){h[e]=i},remove:function(e){delete h[e]},removeAll:function(){h={}}}}const Is={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class xy{constructor(e){this.parser=e,this.name=Is.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let s=0,o=i.length;s<o;s++){const c=i[s];c.extensions&&c.extensions[this.name]&&c.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,c.extensions[this.name].light)}}_loadLight(e){const i=this.parser,s="light:"+e;let o=i.cache.get(s);if(o)return o;const c=i.json,g=((c.extensions&&c.extensions[this.name]||{}).lights||[])[e];let b;const et=new _.Ilk(16777215);g.color!==void 0&&et.fromArray(g.color);const tt=g.range!==void 0?g.range:0;switch(g.type){case"directional":b=new _.Ox3(et),b.target.position.set(0,0,-1),b.add(b.target);break;case"point":b=new _.cek(et),b.distance=tt;break;case"spot":b=new _.PMe(et),b.distance=tt,g.spot=g.spot||{},g.spot.innerConeAngle=g.spot.innerConeAngle!==void 0?g.spot.innerConeAngle:0,g.spot.outerConeAngle=g.spot.outerConeAngle!==void 0?g.spot.outerConeAngle:Math.PI/4,b.angle=g.spot.outerConeAngle,b.penumbra=1-g.spot.innerConeAngle/g.spot.outerConeAngle,b.target.position.set(0,0,-1),b.add(b.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+g.type)}return b.position.set(0,0,0),b.decay=2,rm(b,g),g.intensity!==void 0&&(b.intensity=g.intensity),b.name=i.createUniqueName(g.name||"light_"+e),o=Promise.resolve(b),i.cache.add(s,o),o}getDependency(e,i){if(e==="light")return this._loadLight(i)}createNodeAttachment(e){const i=this,s=this.parser,o=s.json.nodes[e],c=(o.extensions&&o.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(g){return s._getNodeRef(i.cache,c,g)})}}class Ey{constructor(){this.name=Is.KHR_MATERIALS_UNLIT}getMaterialType(){return _.vBJ}extendParams(e,i,s){const o=[];e.color=new _.Ilk(1,1,1),e.opacity=1;const c=i.pbrMetallicRoughness;if(c){if(Array.isArray(c.baseColorFactor)){const g=c.baseColorFactor;e.color.fromArray(g),e.opacity=g[3]}c.baseColorTexture!==void 0&&o.push(s.assignTexture(e,"map",c.baseColorTexture,_.KI_))}return Promise.all(o)}}class Sy{constructor(e){this.parser=e,this.name=Is.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name].emissiveStrength;return o!==void 0&&(i.emissiveIntensity=o),Promise.resolve()}}class Ao{constructor(e){this.parser=e,this.name=Is.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],g=o.extensions[this.name];if(g.clearcoatFactor!==void 0&&(i.clearcoat=g.clearcoatFactor),g.clearcoatTexture!==void 0&&c.push(s.assignTexture(i,"clearcoatMap",g.clearcoatTexture)),g.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=g.clearcoatRoughnessFactor),g.clearcoatRoughnessTexture!==void 0&&c.push(s.assignTexture(i,"clearcoatRoughnessMap",g.clearcoatRoughnessTexture)),g.clearcoatNormalTexture!==void 0&&(c.push(s.assignTexture(i,"clearcoatNormalMap",g.clearcoatNormalTexture)),g.clearcoatNormalTexture.scale!==void 0)){const b=g.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new _.FM8(b,b)}return Promise.all(c)}}class l_{constructor(e){this.parser=e,this.name=Is.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],g=o.extensions[this.name];return g.iridescenceFactor!==void 0&&(i.iridescence=g.iridescenceFactor),g.iridescenceTexture!==void 0&&c.push(s.assignTexture(i,"iridescenceMap",g.iridescenceTexture)),g.iridescenceIor!==void 0&&(i.iridescenceIOR=g.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),g.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=g.iridescenceThicknessMinimum),g.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=g.iridescenceThicknessMaximum),g.iridescenceThicknessTexture!==void 0&&c.push(s.assignTexture(i,"iridescenceThicknessMap",g.iridescenceThicknessTexture)),Promise.all(c)}}class im{constructor(e){this.parser=e,this.name=Is.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[];i.sheenColor=new _.Ilk(0,0,0),i.sheenRoughness=0,i.sheen=1;const g=o.extensions[this.name];return g.sheenColorFactor!==void 0&&i.sheenColor.fromArray(g.sheenColorFactor),g.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=g.sheenRoughnessFactor),g.sheenColorTexture!==void 0&&c.push(s.assignTexture(i,"sheenColorMap",g.sheenColorTexture,_.KI_)),g.sheenRoughnessTexture!==void 0&&c.push(s.assignTexture(i,"sheenRoughnessMap",g.sheenRoughnessTexture)),o.extras&&o.extras.sheenFactor!==void 0&&(i.sheen=o.extras.sheenFactor,delete o.extras.sheenFactor),Promise.all(c)}}class ho{constructor(e){this.parser=e,this.name=Is.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],g=o.extensions[this.name];return g.transmissionFactor!==void 0&&(i.transmission=g.transmissionFactor),g.transmissionTexture!==void 0&&c.push(s.assignTexture(i,"transmissionMap",g.transmissionTexture)),Promise.all(c)}}class O1{constructor(e){this.parser=e,this.name=Is.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],g=o.extensions[this.name];i.thickness=g.thicknessFactor!==void 0?g.thicknessFactor:0,g.thicknessTexture!==void 0&&c.push(s.assignTexture(i,"thicknessMap",g.thicknessTexture)),i.attenuationDistance=g.attenuationDistance||1/0;const b=g.attenuationColor||[1,1,1];return i.attenuationColor=new _.Ilk(b[0],b[1],b[2]),Promise.all(c)}}class Br{constructor(e){this.parser=e,this.name=Is.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return i.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class oo{constructor(e){this.parser=e,this.name=Is.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],g=o.extensions[this.name];i.specularIntensity=g.specularFactor!==void 0?g.specularFactor:1,g.specularTexture!==void 0&&c.push(s.assignTexture(i,"specularIntensityMap",g.specularTexture));const b=g.specularColorFactor||[1,1,1];return i.specularColor=new _.Ilk(b[0],b[1],b[2]),g.specularColorTexture!==void 0&&c.push(s.assignTexture(i,"specularColorMap",g.specularColorTexture,_.KI_)),Promise.all(c)}}class jp{constructor(e){this.parser=e,this.name=Is.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,s=i.json,o=s.textures[e];if(!o.extensions||!o.extensions[this.name])return null;const c=o.extensions[this.name],g=i.options.ktx2Loader;if(!g){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,c.source,g)}}class kS{constructor(e){this.parser=e,this.name=Is.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const i=this.name,s=this.parser,o=s.json,c=o.textures[e];if(!c.extensions||!c.extensions[i])return null;const g=c.extensions[i],b=o.images[g.source];let et=s.textureLoader;if(b.uri){const tt=s.options.manager.getHandler(b.uri);tt!==null&&(et=tt)}return this.detectSupport().then(function(tt){if(tt)return s.loadTextureImage(e,g.source,et);if(o.extensionsRequired&&o.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class BS{constructor(e){this.parser=e,this.name=Is.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const i=this.name,s=this.parser,o=s.json,c=o.textures[e];if(!c.extensions||!c.extensions[i])return null;const g=c.extensions[i],b=o.images[g.source];let et=s.textureLoader;if(b.uri){const tt=s.options.manager.getHandler(b.uri);tt!==null&&(et=tt)}return this.detectSupport().then(function(tt){if(tt)return s.loadTextureImage(e,g.source,et);if(o.extensionsRequired&&o.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class y0{constructor(e){this.name=Is.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,s=i.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const o=s.extensions[this.name],c=this.parser.getDependency("buffer",o.buffer),g=this.parser.options.meshoptDecoder;if(!g||!g.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return c.then(function(b){const et=o.byteOffset||0,tt=o.byteLength||0,rt=o.count,st=o.byteStride,at=new Uint8Array(b,et,tt);return g.decodeGltfBufferAsync?g.decodeGltfBufferAsync(rt,st,at,o.mode,o.filter).then(function(ct){return ct.buffer}):g.ready.then(function(){const ct=new ArrayBuffer(rt*st);return g.decodeGltfBuffer(new Uint8Array(ct),rt,st,at,o.mode,o.filter),ct})})}return null}}class Cy{constructor(e){this.name=Is.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const i=this.parser.json,s=i.nodes[e];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const o=i.meshes[s.mesh];for(const et of o.primitives)if(et.mode!==Pl.TRIANGLES&&et.mode!==Pl.TRIANGLE_STRIP&&et.mode!==Pl.TRIANGLE_FAN&&et.mode!==void 0)return null;const c=s.extensions[this.name].attributes,g=[],b={};for(const et in c)g.push(this.parser.getDependency("accessor",c[et]).then(tt=>(b[et]=tt,b[et])));return g.length<1?null:(g.push(this.parser.createNodeMesh(e)),Promise.all(g).then(et=>{const tt=et.pop(),rt=tt.isGroup?tt.children:[tt],st=et[0].count,at=[];for(const ct of rt){const pt=new _.yGw,gt=new _.Pa4,At=new _._fP,xt=new _.Pa4(1,1,1),yt=new _.SPe(ct.geometry,ct.material,st);for(let _t=0;_t<st;_t++)b.TRANSLATION&&gt.fromBufferAttribute(b.TRANSLATION,_t),b.ROTATION&&At.fromBufferAttribute(b.ROTATION,_t),b.SCALE&&xt.fromBufferAttribute(b.SCALE,_t),yt.setMatrixAt(_t,pt.compose(gt,At,xt));yt.sourceTrs=b;for(const _t in b)_t!=="TRANSLATION"&&_t!=="ROTATION"&&_t!=="SCALE"&&ct.geometry.setAttribute(_t,b[_t]);_.Tme.prototype.copy.call(yt,ct),this.parser.assignFinalMaterial(yt),at.push(yt)}return tt.isGroup?(tt.clear(),tt.add(...at),tt):at[0]}))}}const px="glTF";class A0{constructor(e){this.name=Is.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,12),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==px)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const o=this.header.length-12,c=new DataView(e,12);let g=0;for(;g<o;){const b=c.getUint32(g,!0);g+=4;const et=c.getUint32(g,!0);if(g+=4,et===1313821514){const tt=new Uint8Array(e,12+g,b);this.content=s.decode(tt)}else if(et===5130562){const tt=12+g;this.body=e.slice(tt,tt+b)}g+=b}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class b0{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Is.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const s=this.json,o=this.dracoLoader,c=e.extensions[this.name].bufferView,g=e.extensions[this.name].attributes,b={},et={},tt={};for(const rt in g){const st=VA[rt]||rt.toLowerCase();b[st]=g[rt]}for(const rt in e.attributes){const st=VA[rt]||rt.toLowerCase();if(g[rt]!==void 0){const at=s.accessors[e.attributes[rt]],ct=Pm[at.componentType];tt[st]=ct.name,et[st]=at.normalized===!0}}return i.getDependency("bufferView",c).then(function(rt){return new Promise(function(st){o.decodeDracoFile(rt,function(at){for(const ct in at.attributes){const pt=at.attributes[ct],gt=et[ct];gt!==void 0&&(pt.normalized=gt)}st(at)},b,tt)})})}}class fx{constructor(){this.name=Is.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return(i.texCoord!==void 0&&i.texCoord!==e.channel||i.offset!==void 0||i.rotation!==void 0||i.scale!==void 0)&&(i.texCoord!==void 0&&(e.channel=i.texCoord),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class OS{constructor(){this.name=Is.KHR_MESH_QUANTIZATION}}class L1 extends _._C8{constructor(e,i,s,o){super(e,i,s,o)}copySampleValue_(e){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,c=e*o*3+o;for(let g=0;g!==o;g++)i[g]=s[c+g];return i}interpolate_(e,i,s,o){const c=this.resultBuffer,g=this.sampleValues,b=this.valueSize,et=2*b,tt=3*b,rt=o-i,st=(s-i)/rt,at=st*st,ct=at*st,pt=e*tt,gt=pt-tt,At=-2*ct+3*at,xt=ct-at,yt=1-At,_t=xt-at+st;for(let Mt=0;Mt!==b;Mt++){const It=g[gt+Mt+b],Bt=g[gt+Mt+et]*rt,Lt=g[pt+Mt+b],Ht=g[pt+Mt]*rt;c[Mt]=yt*It+_t*Bt+At*Lt+xt*Ht}return c}}const LS=new _._fP;class NS extends L1{interpolate_(e,i,s,o){const c=super.interpolate_(e,i,s,o);return LS.fromArray(c).normalize().toArray(c),c}}const Pl={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Pm={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},jA={9728:_.TyD,9729:_.wem,9984:_.YLQ,9985:_.qyh,9986:_.aH4,9987:_.D1R},c_={33071:_.uWy,33648:_.OoA,10497:_.rpg},zA={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},VA={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ga={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},No={CUBICSPLINE:void 0,LINEAR:_.NMF,STEP:_.Syv};function xu(h,e,i){for(const s in i.extensions)h[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=i.extensions[s])}function rm(h,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(h.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function N1(h,e){if(h.updateMorphTargets(),e.weights!==void 0)for(let i=0,s=e.weights.length;i<s;i++)h.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(h.morphTargetInfluences.length===i.length){h.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++)h.morphTargetDictionary[i[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function mx(h){const e=h.extensions&&h.extensions[Is.KHR_DRACO_MESH_COMPRESSION];let i;return i=e?"draco:"+e.bufferView+":"+e.indices+":"+US(e.attributes):h.indices+":"+US(h.attributes)+":"+h.mode,i}function US(h){let e="";const i=Object.keys(h).sort();for(let s=0,o=i.length;s<o;s++)e+=i[s]+":"+h[i[s]]+";";return e}function My(h){switch(h){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const zp=new _.yGw;class Rn{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new Fp,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,o=!1,c=-1;typeof navigator<"u"&&(s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,o=navigator.userAgent.indexOf("Firefox")>-1,c=o?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||s||o&&c<98?this.textureLoader=new _.dpR(this.options.manager):this.textureLoader=new _.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new _.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const s=this,o=this.json,c=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(g){return g._markDefs&&g._markDefs()}),Promise.all(this._invokeAll(function(g){return g.beforeRoot&&g.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(g){const b={scene:g[0][o.scene||0],scenes:g[0],animations:g[1],cameras:g[2],asset:o.asset,parser:s,userData:{}};xu(c,b,o),rm(b,o),Promise.all(s._invokeAll(function(et){return et.afterRoot&&et.afterRoot(b)})).then(function(){e(b)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],s=this.json.meshes||[];for(let o=0,c=i.length;o<c;o++){const g=i[o].joints;for(let b=0,et=g.length;b<et;b++)e[g[b]].isBone=!0}for(let o=0,c=e.length;o<c;o++){const g=e[o];g.mesh!==void 0&&(this._addNodeRef(this.meshCache,g.mesh),g.skin!==void 0&&(s[g.mesh].isSkinnedMesh=!0)),g.camera!==void 0&&this._addNodeRef(this.cameraCache,g.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,s){if(e.refs[i]<=1)return s;const o=s.clone(),c=(g,b)=>{const et=this.associations.get(g);et!=null&&this.associations.set(b,et);for(const[tt,rt]of g.children.entries())c(rt,b.children[tt])};return c(s,o),o.name+="_instance_"+e.uses[i]++,o}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let s=0;s<i.length;s++){const o=e(i[s]);if(o)return o}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const s=[];for(let o=0;o<i.length;o++){const c=e(i[o]);c&&s.push(c)}return s}getDependency(e,i){const s=e+":"+i;let o=this.cache.get(s);if(!o){switch(e){case"scene":o=this.loadScene(i);break;case"node":o=this._invokeOne(function(c){return c.loadNode&&c.loadNode(i)});break;case"mesh":o=this._invokeOne(function(c){return c.loadMesh&&c.loadMesh(i)});break;case"accessor":o=this.loadAccessor(i);break;case"bufferView":o=this._invokeOne(function(c){return c.loadBufferView&&c.loadBufferView(i)});break;case"buffer":o=this.loadBuffer(i);break;case"material":o=this._invokeOne(function(c){return c.loadMaterial&&c.loadMaterial(i)});break;case"texture":o=this._invokeOne(function(c){return c.loadTexture&&c.loadTexture(i)});break;case"skin":o=this.loadSkin(i);break;case"animation":o=this._invokeOne(function(c){return c.loadAnimation&&c.loadAnimation(i)});break;case"camera":o=this.loadCamera(i);break;default:if(o=this._invokeOne(function(c){return c!=this&&c.getDependency&&c.getDependency(e,i)}),!o)throw new Error("Unknown type: "+e)}this.cache.add(s,o)}return o}getDependencies(e){let i=this.cache.get(e);if(!i){const s=this,o=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(o.map(function(c,g){return s.getDependency(e,g)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],s=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[Is.KHR_BINARY_GLTF].body);const o=this.options;return new Promise(function(c,g){s.load(_.Zp0.resolveURL(i.uri,o.path),c,void 0,function(){g(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(s){const o=i.byteLength||0,c=i.byteOffset||0;return s.slice(c,c+o)})}loadAccessor(e){const i=this,s=this.json,o=this.json.accessors[e];if(o.bufferView===void 0&&o.sparse===void 0){const g=zA[o.type],b=Pm[o.componentType],et=o.normalized===!0,tt=new b(o.count*g);return Promise.resolve(new _.TlE(tt,g,et))}const c=[];return o.bufferView!==void 0?c.push(this.getDependency("bufferView",o.bufferView)):c.push(null),o.sparse!==void 0&&(c.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),c.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(c).then(function(g){const b=g[0],et=zA[o.type],tt=Pm[o.componentType],rt=tt.BYTES_PER_ELEMENT,st=rt*et,at=o.byteOffset||0,ct=o.bufferView!==void 0?s.bufferViews[o.bufferView].byteStride:void 0,pt=o.normalized===!0;let gt,At;if(ct&&ct!==st){const xt=Math.floor(at/ct),yt="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+xt+":"+o.count;let _t=i.cache.get(yt);_t||(gt=new tt(b,xt*ct,o.count*ct/rt),_t=new _.vpT(gt,ct/rt),i.cache.add(yt,_t)),At=new _.kB5(_t,et,at%ct/rt,pt)}else gt=b===null?new tt(o.count*et):new tt(b,at,o.count*et),At=new _.TlE(gt,et,pt);if(o.sparse!==void 0){const xt=zA.SCALAR,yt=Pm[o.sparse.indices.componentType],_t=o.sparse.indices.byteOffset||0,Mt=o.sparse.values.byteOffset||0,It=new yt(g[1],_t,o.sparse.count*xt),Bt=new tt(g[2],Mt,o.sparse.count*et);b!==null&&(At=new _.TlE(At.array.slice(),At.itemSize,At.normalized));for(let Lt=0,Ht=It.length;Lt<Ht;Lt++){const Jt=It[Lt];if(At.setX(Jt,Bt[Lt*et]),et>=2&&At.setY(Jt,Bt[Lt*et+1]),et>=3&&At.setZ(Jt,Bt[Lt*et+2]),et>=4&&At.setW(Jt,Bt[Lt*et+3]),et>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return At})}loadTexture(e){const i=this.json,s=this.options,o=i.textures[e].source,c=i.images[o];let g=this.textureLoader;if(c.uri){const b=s.manager.getHandler(c.uri);b!==null&&(g=b)}return this.loadTextureImage(e,o,g)}loadTextureImage(e,i,s){const o=this,c=this.json,g=c.textures[e],b=c.images[i],et=(b.uri||b.bufferView)+":"+g.sampler;if(this.textureCache[et])return this.textureCache[et];const tt=this.loadImageSource(i,s).then(function(rt){rt.name=g.name||b.name||"",rt.name===""&&typeof b.uri=="string"&&b.uri.startsWith("data:image/")===!1&&(rt.name=b.uri);const st=(c.samplers||{})[g.sampler]||{};return rt.magFilter=jA[st.magFilter]||_.wem,rt.minFilter=jA[st.minFilter]||_.D1R,rt.wrapS=c_[st.wrapS]||_.rpg,rt.wrapT=c_[st.wrapT]||_.rpg,st.extras&&st.extras.uuid!==void 0&&(rt.uuid=st.extras.uuid),o.associations.set(rt,{textures:e}),rt}).catch(function(){return null});return this.textureCache[et]=tt,tt}loadImageSource(e,i,s=!1,o=!1){const c=this,g=this.json,b=this.options;if(!o&&this.sourceCache[e]!==void 0)return this.sourceCache[e].then(pt=>pt.clone());const et=g.images[e],tt=self.URL||self.webkitURL;et.uri===void 0&&et.extras&&et.extras.uri&&(et.uri=et.extras.uri);let rt=et.uri||"",st=!1,at=null;if(et.bufferView===void 0||s&&rt){if(et.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView")}else rt=c.getDependency("bufferView",et.bufferView).then(function(pt){st=!0;const gt=new Blob([pt],{type:et.mimeType});return rt=tt.createObjectURL(gt),at=gt,rt});const ct=Promise.resolve(rt).then(function(pt){return new Promise(function(gt,At){let xt=gt;i.isImageBitmapLoader===!0&&(xt=function(yt){const _t=new _.xEZ(yt);_t.needsUpdate=!0,gt(_t)}),i.load(_.Zp0.resolveURL(pt,b.path),xt,void 0,function(yt){i.isImageBitmapLoader===!0?(i=new _.dpR(c.options.manager),xt=gt,i.setCrossOrigin(c.options.crossOrigin),i.setRequestHeader(c.options.requestHeader),i.load(_.Zp0.resolveURL(pt,b.path),xt,void 0,At)):At(yt)})})}).then(function(pt){var gt;if(st===!0&&tt.revokeObjectURL(rt),pt.userData.mimeType=et.mimeType||((gt=et.uri).search(/\.jpe?g($|\?)/i)>0||gt.search(/^data\:image\/jpeg/)===0?"image/jpeg":gt.search(/\.webp($|\?)/i)>0||gt.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),pt.flipY=!1,et.extras){if(et.extras.flipY!==void 0){if(i.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){let At=pt;const xt=et.extras.flipY&&!At.flipY;createImageBitmap(At.source.data,{imageOrientation:xt?"flipY":"none"}).then(function(yt){At._newTex&&(At=At._newTex),At.source.data.close&&At.source.data.close(),At.source.data=yt,At.source.needsUpdate=!0,At.needsUpdate=!0})}pt.flipY=et.extras.flipY,pt.needsUpdate=!0,delete et.extras.flipY}et.extras.uuid!==void 0&&(pt.source.uuid=et.extras.uuid),et.extras.t_uuid!==void 0&&(pt.uuid=et.extras.t_uuid)}return et.uri&&typeof et.uri=="string"&&st===!1&&!et.uri.startsWith("/")&&(pt.userData.rootPath=_.Zp0.resolveURL(et.uri,b.path)),at&&(pt.userData.__sourceBlob=at),!s&&et.uri&&et.uri!==rt&&c.loadImageSource(e,i,!0,!0).then(function(At){pt.source.data&&pt.source.data.close&&pt.source.data.close(),pt.dispose(),pt.source=At.source,pt.source.needsUpdate=!0,pt.needsUpdate=!0,pt.uuid=At.uuid,pt.flipY=At.flipY,pt.userData=At.userData,pt.setDirty&&pt.setDirty(),At._newTex=pt}),pt}).catch(function(pt){throw console.error("THREE.GLTFLoader: Couldn't load texture",rt),pt});return this.sourceCache[e]=ct,ct}assignTexture(e,i,s,o){const c=this;return this.getDependency("texture",s.index).then(function(g){if(!g)return null;if(s.texCoord!==void 0&&s.texCoord>0&&((g=g.clone()).channel=s.texCoord),c.extensions[Is.KHR_TEXTURE_TRANSFORM]){const b=s.extensions!==void 0?s.extensions[Is.KHR_TEXTURE_TRANSFORM]:void 0;if(b){const et=c.associations.get(g);g=c.extensions[Is.KHR_TEXTURE_TRANSFORM].extendTexture(g,b),c.associations.set(g,et)}}return o!==void 0&&(g.colorSpace=o),e[i]=g,g})}assignFinalMaterial(e){const i=e.geometry;let s=e.material;const o=i.attributes.tangent===void 0,c=i.attributes.color!==void 0,g=i.attributes.normal===void 0;if(e.isPoints){const b="PointsMaterial:"+s.uuid;let et=this.cache.get(b);et||(et=new _.UY4,_.F5T.prototype.copy.call(et,s),et.color.copy(s.color),et.map=s.map,et.sizeAttenuation=!1,this.cache.add(b,et)),s=et}else if(e.isLine){const b="LineBasicMaterial:"+s.uuid;let et=this.cache.get(b);et||(et=new _.nls,_.F5T.prototype.copy.call(et,s),et.color.copy(s.color),et.map=s.map,this.cache.add(b,et)),s=et}if(o||c||g){let b="ClonedMaterial:"+s.uuid+":";o&&(b+="derivative-tangents:"),c&&(b+="vertex-colors:"),g&&(b+="flat-shading:");let et=this.cache.get(b);et||(et=s.clone(),c&&(et.vertexColors=!0),g&&(et.flatShading=!0),o&&(et.normalScale&&(et.normalScale.y*=-1),et.clearcoatNormalScale&&(et.clearcoatNormalScale.y*=-1)),this.cache.add(b,et),this.associations.set(et,this.associations.get(s))),s=et}e.material=s}getMaterialType(){return _.Wid}loadMaterial(e){const i=this,s=this.json,o=this.extensions,c=s.materials[e];let g;const b={},et=[];if((c.extensions||{})[Is.KHR_MATERIALS_UNLIT]){const rt=o[Is.KHR_MATERIALS_UNLIT];g=rt.getMaterialType(),et.push(rt.extendParams(b,c,i))}else{const rt=c.pbrMetallicRoughness||{};if(b.color=new _.Ilk(1,1,1),b.opacity=1,Array.isArray(rt.baseColorFactor)){const st=rt.baseColorFactor;b.color.fromArray(st),b.opacity=st[3]}rt.baseColorTexture!==void 0&&et.push(i.assignTexture(b,"map",rt.baseColorTexture,_.KI_)),b.metalness=rt.metallicFactor!==void 0?rt.metallicFactor:1,b.roughness=rt.roughnessFactor!==void 0?rt.roughnessFactor:1,rt.metallicRoughnessTexture!==void 0&&(et.push(i.assignTexture(b,"metalnessMap",rt.metallicRoughnessTexture)),et.push(i.assignTexture(b,"roughnessMap",rt.metallicRoughnessTexture))),g=this._invokeOne(function(st){return st.getMaterialType&&st.getMaterialType(e)}),et.push(Promise.all(this._invokeAll(function(st){return st.extendMaterialParams&&st.extendMaterialParams(e,b)})))}c.doubleSided===!0&&(b.side=_.ehD);const tt=c.alphaMode||"OPAQUE";if(tt==="BLEND"?(b.transparent=!0,b.depthWrite=!1):(b.transparent=!1,tt==="MASK"&&(b.alphaTest=c.alphaCutoff!==void 0?c.alphaCutoff:.5)),c.normalTexture!==void 0&&g!==_.vBJ&&(et.push(i.assignTexture(b,"normalMap",c.normalTexture)),b.normalScale=new _.FM8(1,1),c.normalTexture.scale!==void 0)){const rt=c.normalTexture.scale;b.normalScale.set(rt,rt)}return c.occlusionTexture!==void 0&&g!==_.vBJ&&(et.push(i.assignTexture(b,"aoMap",c.occlusionTexture)),c.occlusionTexture.strength!==void 0&&(b.aoMapIntensity=c.occlusionTexture.strength)),c.emissiveFactor!==void 0&&g!==_.vBJ&&(b.emissive=new _.Ilk().fromArray(c.emissiveFactor)),c.emissiveTexture!==void 0&&g!==_.vBJ&&et.push(i.assignTexture(b,"emissiveMap",c.emissiveTexture,_.KI_)),Promise.all(et).then(function(){const rt=new g(b);return c.name&&(rt.name=c.name),rm(rt,c),i.associations.set(rt,{materials:e}),c.extensions&&xu(o,rt,c),rt})}createUniqueName(e){const i=_.iUV.sanitizeNodeName(e||"");let s=i;for(let o=1;this.nodeNamesUsed[s];++o)s=i+"_"+o;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const i=this,s=this.extensions,o=this.primitiveCache;function c(b){return s[Is.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(b,i).then(function(et){return gx(et,b,i)})}const g=[];for(let b=0,et=e.length;b<et;b++){const tt=e[b],rt=mx(tt),st=o[rt];if(st)g.push(st.promise);else{let at;at=tt.extensions&&tt.extensions[Is.KHR_DRACO_MESH_COMPRESSION]?c(tt):gx(new _.u9r,tt,i),o[rt]={primitive:tt,promise:at},g.push(at)}}return Promise.all(g)}loadMesh(e){const i=this,s=this.json,o=this.extensions,c=s.meshes[e],g=c.primitives,b=[];for(let tt=0,rt=g.length;tt<rt;tt++){const st=g[tt].material===void 0?((et=this.cache).DefaultMaterial===void 0&&(et.DefaultMaterial=new _.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:_.Wl3})),et.DefaultMaterial):this.getDependency("material",g[tt].material);b.push(st)}var et;return b.push(i.loadGeometries(g)),Promise.all(b).then(function(tt){const rt=tt.slice(0,tt.length-1),st=tt[tt.length-1],at=[];for(let pt=0,gt=st.length;pt<gt;pt++){const At=st[pt],xt=g[pt];let yt;const _t=rt[pt];if(xt.mode===Pl.TRIANGLES||xt.mode===Pl.TRIANGLE_STRIP||xt.mode===Pl.TRIANGLE_FAN||xt.mode===void 0)yt=c.isSkinnedMesh===!0?new _.TUv(At,_t):new _.Kj0(At,_t),yt.isSkinnedMesh===!0&&yt.normalizeSkinWeights(),xt.mode===Pl.TRIANGLE_STRIP?yt.geometry=yn(yt.geometry,_.UlW):xt.mode===Pl.TRIANGLE_FAN&&(yt.geometry=yn(yt.geometry,_.z$h));else if(xt.mode===Pl.LINES)yt=new _.ejS(At,_t);else if(xt.mode===Pl.LINE_STRIP)yt=new _.x12(At,_t);else if(xt.mode===Pl.LINE_LOOP)yt=new _.blk(At,_t);else{if(xt.mode!==Pl.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+xt.mode);yt=new _.woe(At,_t)}Object.keys(yt.geometry.morphAttributes).length>0&&N1(yt,c),yt.name=i.createUniqueName(c.name||"mesh_"+e),yt.geometry&&c.extras&&c.extras.isGeometryUserData?(rm(yt.geometry,c),xt.extensions&&xu(o,yt.geometry,xt)):(rm(yt,c),xt.extensions&&xu(o,yt,xt)),i.assignFinalMaterial(yt),at.push(yt)}c.extensions&&at.forEach(pt=>xu(o,pt,c));for(let pt=0,gt=at.length;pt<gt;pt++)i.associations.set(at[pt],{meshes:e,primitives:pt});if(at.length===1)return at[0];const ct=new _.ZAu;i.associations.set(ct,{meshes:e});for(let pt=0,gt=at.length;pt<gt;pt++)ct.add(at[pt]);return ct})}loadCamera(e){let i;const s=this.json.cameras[e],o=s[s.type];if(o)return s.type==="perspective"?i=new _.cPb(_.M8C.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):s.type==="orthographic"&&(i=new _.iKG(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),s.name&&(i.name=this.createUniqueName(s.name)),rm(i,s),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const i=this.json.skins[e],s=[];for(let o=0,c=i.joints.length;o<c;o++)s.push(this._loadNodeShallow(i.joints[o]));return i.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",i.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(o){const c=o.pop(),g=o,b=[],et=[];for(let tt=0,rt=g.length;tt<rt;tt++){const st=g[tt];if(st){b.push(st);const at=new _.yGw;c!==null&&at.fromArray(c.array,16*tt),et.push(at)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[tt])}return new _.OdW(b,et)})}loadAnimation(e){const i=this.json.animations[e],s=i.name?i.name:"animation_"+e,o=[],c=[],g=[],b=[],et=[];for(let tt=0,rt=i.channels.length;tt<rt;tt++){const st=i.channels[tt],at=i.samplers[st.sampler],ct=st.target,pt=ct.node,gt=i.parameters!==void 0?i.parameters[at.input]:at.input,At=i.parameters!==void 0?i.parameters[at.output]:at.output;ct.node!==void 0&&(o.push(this.getDependency("node",pt)),c.push(this.getDependency("accessor",gt)),g.push(this.getDependency("accessor",At)),b.push(at),et.push(ct))}return Promise.all([Promise.all(o),Promise.all(c),Promise.all(g),Promise.all(b),Promise.all(et)]).then(function(tt){const rt=tt[0],st=tt[1],at=tt[2],ct=tt[3],pt=tt[4],gt=[];for(let At=0,xt=rt.length;At<xt;At++){const yt=rt[At],_t=st[At],Mt=at[At],It=ct[At],Bt=pt[At];if(yt===void 0)continue;let Lt;switch(yt.updateMatrix(),ga[Bt.path]){case ga.weights:Lt=_.dUE;break;case ga.rotation:Lt=_.iLg;break;default:Lt=_.yC1}const Ht=yt.name?yt.name:yt.uuid,Jt=It.interpolation!==void 0?No[It.interpolation]:_.NMF,sn=[];ga[Bt.path]===ga.weights?yt.traverse(function(mn){mn.morphTargetInfluences&&sn.push(mn.name?mn.name:mn.uuid)}):sn.push(Ht);let on=Mt.array;if(Mt.normalized){const mn=My(on.constructor),cn=new Float32Array(on.length);for(let un=0,bn=on.length;un<bn;un++)cn[un]=on[un]*mn;on=cn}for(let mn=0,cn=sn.length;mn<cn;mn++){const un=new Lt(sn[mn]+"."+ga[Bt.path],_t.array,on,Jt);It.interpolation==="CUBICSPLINE"&&(un.createInterpolant=function(bn){return new(this instanceof _.iLg?NS:L1)(this.times,this.values,this.getValueSize()/3,bn)},un.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),gt.push(un)}}return new _.m7l(s,void 0,gt)})}createNodeMesh(e){const i=this.json,s=this,o=i.nodes[e];return o.mesh===void 0?null:s.getDependency("mesh",o.mesh).then(function(c){const g=s._getNodeRef(s.meshCache,o.mesh,c);return o.weights!==void 0&&g.traverse(function(b){if(b.isMesh)for(let et=0,tt=o.weights.length;et<tt;et++)b.morphTargetInfluences[et]=o.weights[et]}),g})}loadNode(e){const i=this,s=this.json.nodes[e],o=i._loadNodeShallow(e),c=[],g=s.children||[];for(let et=0,tt=g.length;et<tt;et++)c.push(i.getDependency("node",g[et]));const b=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([o,Promise.all(c),b]).then(function(et){const tt=et[0],rt=et[1],st=et[2];st!==null&&tt.traverse(function(at){at.isSkinnedMesh&&at.bind(st,zp)});for(let at=0,ct=rt.length;at<ct;at++)tt.add(rt[at]);return tt})}_loadNodeShallow(e){const i=this.json,s=this.extensions,o=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const c=i.nodes[e],g=c.name?o.createUniqueName(c.name):"",b=[],et=o._invokeOne(function(tt){return tt.createNodeMesh&&tt.createNodeMesh(e)});return et&&b.push(et),c.camera!==void 0&&b.push(o.getDependency("camera",c.camera).then(function(tt){return o._getNodeRef(o.cameraCache,c.camera,tt)})),o._invokeAll(function(tt){return tt.createNodeAttachment&&tt.createNodeAttachment(e)}).forEach(function(tt){b.push(tt)}),this.nodeCache[e]=Promise.all(b).then(function(tt){let rt;if(rt=c.isBone===!0?new _.N$j:tt.length>1?new _.ZAu:tt.length===1?tt[0]:new _.Tme,rt!==tt[0])for(let st=0,at=tt.length;st<at;st++)rt.add(tt[st]);if(c.name&&(rt.userData.name=c.name,rt.name=g),rm(rt,c),c.extensions&&xu(s,rt,c),c.matrix!==void 0){const st=new _.yGw;st.fromArray(c.matrix),rt.applyMatrix4(st)}else c.translation!==void 0&&rt.position.fromArray(c.translation),c.rotation!==void 0&&rt.quaternion.fromArray(c.rotation),c.scale!==void 0&&rt.scale.fromArray(c.scale);return o.associations.has(rt)||o.associations.set(rt,{}),o.associations.get(rt).nodes=e,rt}),this.nodeCache[e]}loadScene(e){const i=this.extensions,s=this.json.scenes[e],o=this,c=new _.ZAu;s.name&&(c.name=o.createUniqueName(s.name)),rm(c,s),s.extensions&&xu(i,c,s);const g=s.nodes||[],b=[];for(let et=0,tt=g.length;et<tt;et++)b.push(o.getDependency("node",g[et]));return Promise.all(b).then(function(et){for(let tt=0,rt=et.length;tt<rt;tt++)c.add(et[tt]);return o.associations=(tt=>{const rt=new Map;for(const[st,at]of o.associations)(st instanceof _.F5T||st instanceof _.xEZ)&&rt.set(st,at);return tt.traverse(st=>{const at=o.associations.get(st);at!=null&&rt.set(st,at)}),rt})(c),c})}}function gx(h,e,i){const s=e.attributes,o=[];function c(g,b){return i.getDependency("accessor",g).then(function(et){h.setAttribute(b,et)})}for(const g in s){const b=VA[g]||g.toLowerCase();b in h.attributes||o.push(c(s[g],b))}if(e.indices!==void 0&&!h.index){const g=i.getDependency("accessor",e.indices).then(function(b){h.setIndex(b)});o.push(g)}return rm(h,e),function(g,b,et){const tt=b.attributes,rt=new _.ZzF;if(tt.POSITION===void 0)return;{const ct=et.json.accessors[tt.POSITION],pt=ct.min,gt=ct.max;if(pt===void 0||gt===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(rt.set(new _.Pa4(pt[0],pt[1],pt[2]),new _.Pa4(gt[0],gt[1],gt[2])),ct.normalized){const At=My(Pm[ct.componentType]);rt.min.multiplyScalar(At),rt.max.multiplyScalar(At)}}const st=b.targets;if(st!==void 0){const ct=new _.Pa4,pt=new _.Pa4;for(let gt=0,At=st.length;gt<At;gt++){const xt=st[gt];if(xt.POSITION!==void 0){const yt=et.json.accessors[xt.POSITION],_t=yt.min,Mt=yt.max;if(_t!==void 0&&Mt!==void 0){if(pt.setX(Math.max(Math.abs(_t[0]),Math.abs(Mt[0]))),pt.setY(Math.max(Math.abs(_t[1]),Math.abs(Mt[1]))),pt.setZ(Math.max(Math.abs(_t[2]),Math.abs(Mt[2]))),yt.normalized){const It=My(Pm[yt.componentType]);pt.multiplyScalar(It)}ct.max(pt)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}rt.expandByVector(ct)}g.boundingBox=rt;const at=new _.aLr;rt.getCenter(at.center),at.radius=rt.min.distanceTo(rt.max)/2,g.boundingSphere=at}(h,e,i),Promise.all(o).then(function(){return e.targets!==void 0?function(g,b,et){let tt=!1,rt=!1,st=!1;for(let gt=0,At=b.length;gt<At;gt++){const xt=b[gt];if(xt.POSITION!==void 0&&(tt=!0),xt.NORMAL!==void 0&&(rt=!0),xt.COLOR_0!==void 0&&(st=!0),tt&&rt&&st)break}if(!tt&&!rt&&!st)return Promise.resolve(g);const at=[],ct=[],pt=[];for(let gt=0,At=b.length;gt<At;gt++){const xt=b[gt];if(tt){const yt=xt.POSITION!==void 0?et.getDependency("accessor",xt.POSITION):g.attributes.position;at.push(yt)}if(rt){const yt=xt.NORMAL!==void 0?et.getDependency("accessor",xt.NORMAL):g.attributes.normal;ct.push(yt)}if(st){const yt=xt.COLOR_0!==void 0?et.getDependency("accessor",xt.COLOR_0):g.attributes.color;pt.push(yt)}}return Promise.all([Promise.all(at),Promise.all(ct),Promise.all(pt)]).then(function(gt){const At=gt[0],xt=gt[1],yt=gt[2];return tt&&(g.morphAttributes.position=At),rt&&(g.morphAttributes.normal=xt),st&&(g.morphAttributes.color=yt),g.morphTargetsRelative=!0,g})}(h,e.targets,i):h})}class vx extends Im{constructor(e){super(e),this.isGLTFLoader2=!0,this.preparsers=[],this.preparsers.push(Zm)}async preparse(e,i){for(const s of this.preparsers)e=await s.process(e,i);return e}parse(e,i,s,o,c){this.preparse.call(this,e,c||i).then(g=>g?super.parse(g,i,s,o):o&&o(new ErrorEvent("no data"))).catch(g=>{console.error(g),o&&o(g??new ErrorEvent("unknown error"))})}transform(e,i){const s=e?e.scene||(e.scenes&&e.scenes.length>0?e.scenes[0]:void 0):void 0;return s&&e.animations.length>0&&(s.animations=e.animations),s==null||s.traverse(o=>{o.userData.gltfUUID&&(o.uuid=o.userData.gltfUUID,delete o.userData.gltfUUID)}),s}register(e){return super.register(e)}}const Zm={key:(h,e,i)=>h.key||window&&window.prompt&&window.prompt("GLTFEncryption: Please enter the password/key for the model: "+i)||"",async process(h,e){var et;if(typeof h=="string"||!new TextDecoder().decode(new Uint8Array(h,0,100)).includes("WebGiGLBWrapper"))return h;const i=new A0(h),s=JSON.parse(i.content||"{}");let o=i.body||h;const c=(et=s.asset)==null?void 0:et.encryption;if(!c)return o;const g=c.type,b=c.version;if(g==="aesgcm"&&b===1){const tt=await(0,_e.getOrCall)(this.key,c,s,e)||"";try{o=(await(0,_e.aesGcmDecrypt)(new Uint8Array(o),tt)).buffer}catch{throw new ErrorEvent("decryption error")}}return o}};class xv extends _.hH6{constructor(e){super(e),this.type=_.cLu}async loadAsync(e,i){const s=await this.parseAsync(e,i,!1),o=new _.IEO(s.data,s.width,s.height,_.wk1,this.type);return o.needsUpdate=!0,o.flipY=!0,o.colorSpace=_.KI_,o.minFilter=_.wem,o.magFilter=_.wem,o.source.data.complete=!0,o}async parseAsync(e,i,s=!1){let o=!1;if(!e.startsWith("data:")&&!e.startsWith("blob:")){this.responseType="blob";const et=await super.loadAsync(e,i);e=URL.createObjectURL(et),o=!0}const c=await(0,_e.imageUrlToImageData)(e);o&&URL.revokeObjectURL(e);let g=Uint8Array;return this.type===_.cLu?g=Uint16Array:this.type===_.VzW&&(g=Uint32Array),{data:function(et,tt=3,rt=Uint16Array,st=!1){let at;const ct=et.byteLength>>2,pt=new rt(ct*tt);for(let gt=0;gt<ct;gt++)at=Math.pow(2,et[4*gt+3]-136),st?(pt[gt*tt]=Math.min(et[4*gt]*at,65504),pt[gt*tt+1]=Math.min(et[4*gt+1]*at,65504),pt[gt*tt+2]=Math.min(et[4*gt+2]*at,65504)):(pt[gt*tt]=_.A5E.toHalfFloat(Math.min(et[4*gt]*at,65504)),pt[gt*tt+1]=_.A5E.toHalfFloat(Math.min(et[4*gt+1]*at,65504)),pt[gt*tt+2]=_.A5E.toHalfFloat(Math.min(et[4*gt+2]*at,65504))),tt===4&&(pt[gt*tt+3]=_.A5E.toHalfFloat(1));return pt}(c.data,4,g,s),width:c.width,height:c.height}}setDataType(e){return this.type=e,this}}class rp extends _.Gql{constructor(e){super(e),this._imageLoader=new _.S3k(e)}static async LoadRootPathTextures(e,i,s,o=!0){var g;const c=[];for(const b of Array.isArray(e)?e:Object.values(e??{})){const et=(g=b==null?void 0:b.userData)==null?void 0:g.rootPath,tt=o&&b.image&&i[b.image];if(!et)continue;const rt=s.importPath(et,{processImported:!1}).then(st=>{const at=st==null?void 0:st[0],ct=at==null?void 0:at.source;if(!at||!ct)return null;const pt=new _.Hw6(ct.data);return b.image&&(pt.uuid=b.image),b.image=pt.uuid,tt||(i[pt.uuid]=pt),at.dispose(),pt}).catch(st=>(console.error(st),delete b.userData.rootPath,null));tt?b.rootPathPromise=rt:c.push(rt)}await Promise.allSettled(c)}parseTextures2(e,i,s){var g,b;for(const et of e){const tt=(g=et==null?void 0:et.userData)==null?void 0:g.rootPath;if(tt&&(!et.image||!i[et.image])){const rt=new _.Hw6(this._imageLoader.load(tt,s));if(!rt)continue;et.image&&(rt.uuid=et.image),i[rt.uuid]=rt,et.image=rt.uuid}et.userData=Oo(et.userData,void 0,!1,{images:i})}const o=super.parseTextures(e,i),c={...o};for(const et of e)(b=et.rootPathPromise)==null||b.then(tt=>{if(!tt)return;const rt=c[et.uuid];rt.dispose(),rt.source=tt,rt.source.needsUpdate=!0,rt.needsUpdate=!0});return o}parseMaterials2(e,i,s){const o={};return e.forEach(c=>{if(!c)return;const g={...c},b=Object.keys(g);for(const tt of b)if(tt==="map"||tt.endsWith("Map")){const rt=g[tt];typeof rt=="string"&&(i[rt]?g[tt]=i[rt]:(console.warn(`Texture ${rt} not found`),delete g[tt]))}g.userData&&(g.userData=Oo(g.userData,void 0,!1,{textures:i}),g.userData.cloneId&&g.userData.uuid!==c.uuid&&(g.userData.uuid=c.uuid));const et=s.generateFromTemplateType(g.type,g);et&&(o[c.uuid]=et)}),o}}const iu="WEBGI_viewer";function w0(h){return new yl(vx,["gltf","glb","data:model/gltf"],!0,(e,i)=>{if(!e)return e;const s=e,o=new rp(i.loadingManager);return s.register(u_(o,h)),s.register(F_()),s.register(GA(o)),s.register(c=>new HA(c)),s.register(c=>new U1(c)),s.register(c=>new Dm(c)),s.register(c=>new h_(c)),s.register(c=>{var at,ct,pt,gt,At,xt,yt,_t,Mt;const g=c.getDependency;c.getDependency=async(It,Bt)=>{const Lt=await g.call(c,It,Bt);if(Lt.userData){const Ht=Lt.userData.gltfExtensions;delete Lt.userData.gltfExtensions,Lt.userData=Oo(Lt.userData,{},!1,{}),Lt.userData.gltfExtensions=Ht}return Lt};const b=np()+".drc",et=np()+".ktx2",tt=(pt=(ct=(at=c.json)==null?void 0:at.extensionsRequired)==null?void 0:ct.includes)==null?void 0:pt.call(ct,"KHR_draco_mesh_compression");if(tt){const It=i.registerFile(b);It&&s.setDRACOLoader(It)}((xt=(At=(gt=c.json)==null?void 0:gt.extensionsUsed)==null?void 0:At.includes)==null?void 0:xt.call(At,"EXT_meshopt_compression"))&&(window.MeshoptDecoder?(s.setMeshoptDecoder(window.MeshoptDecoder),c.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const st=(Mt=(_t=(yt=c.json)==null?void 0:yt.extensionsUsed)==null?void 0:_t.includes)==null?void 0:Mt.call(_t,"KHR_texture_basisu");if(st){const It=i.registerFile(et);It&&(s.setKTX2Loader(It),c.options.ktx2Loader=It)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async It=>{tt&&i.unregisterFile(b),st&&i.unregisterFile(et);const Bt=await x0(c,h,o);It.scene&&(It.scene.__importedViewerConfig=Bt)}}}),s})}const Rm="WEBGI_light_extras",qu="WEBGI_object3d_extras",Ru="WEBGI_material_extras",F_=h=>e=>({name:"__"+qu,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(o=>{var b,et;if(!o.isObject3D)return;const c=(et=(b=o.userData)==null?void 0:b.gltfExtensions)==null?void 0:et[qu];if(!c)return void(o.isLight&&!o.isAmbientLight&&(o.castShadow=!0));const g=c.castShadow!==void 0||c.receiveShadow!==void 0;c.castShadow!==void 0&&(o.castShadow=c.castShadow),c.receiveShadow!==void 0&&(o.receiveShadow=c.receiveShadow),c.visible!==void 0&&(o.visible=c.visible),c.frustumCulled!==void 0&&(o.frustumCulled=c.frustumCulled),c.renderOrder!==void 0&&(o.renderOrder=c.renderOrder),c.layers!==void 0&&(o.layers.mask=c.layers),g&&(o.userData.__keepShadowDef=!0),delete o.userData.gltfExtensions[qu]})})}}),u_=(h,e)=>i=>({name:"__"+Ru,afterRoot:async s=>{var c,g,b;const o=s.scenes||(s.scene?[s.scene]:[]);for(const et of o){const tt=(g=(c=et.userData)==null?void 0:c.gltfExtensions)==null?void 0:g[Ru],rt=tt&&await((b=e.getPlugin(Lr))==null?void 0:b.importConfigResources(tt.resources||{}))||{};et.traverse(st=>{var pt,gt;const at=st==null?void 0:st.material;if(!(at!=null&&at.isMaterial))return;const ct=(gt=(pt=at.userData)==null?void 0:pt.gltfExtensions)==null?void 0:gt[Ru];ct&&(ct.emissiveIntensity!==void 0&&(at.emissiveIntensity=ct.emissiveIntensity),ct.fog!==void 0&&(at.fog=ct.fog),ct.flatShading!==void 0&&(at.flatShading=ct.flatShading),ct.blending!==void 0&&(at.blending=ct.blending),ct.side!==void 0&&(at.side=ct.side),ct.shadowSide!==void 0&&(at.shadowSide=ct.shadowSide),ct.depthFunc!==void 0&&(at.depthFunc=ct.depthFunc),ct.depthTest!==void 0&&(at.depthTest=ct.depthTest),ct.depthWrite!==void 0&&(at.depthWrite=ct.depthWrite),ct.colorWrite!==void 0&&(at.colorWrite=ct.colorWrite),ct.vertexColors!==void 0&&(at.vertexColors=ct.vertexColors),ct.alphaTest!==void 0&&(at.alphaTest=ct.alphaTest),ct.wireframe!==void 0&&(at.wireframe=ct.wireframe),ct.wireframeLinewidth!==void 0&&(at.wireframeLinewidth=ct.wireframeLinewidth),ct.wireframeLinecap!==void 0&&(at.wireframeLinecap=ct.wireframeLinecap),ct.wireframeLinejoin!==void 0&&(at.wireframeLinejoin=ct.wireframeLinejoin),ct.rotation!==void 0&&(at.rotation=ct.rotation),ct.polygonOffset!==void 0&&(at.polygonOffset=ct.polygonOffset),ct.polygonOffsetFactor!==void 0&&(at.polygonOffsetFactor=ct.polygonOffsetFactor),ct.polygonOffsetUnits!==void 0&&(at.polygonOffsetUnits=ct.polygonOffsetUnits),ct.dithering!==void 0&&(at.dithering=ct.dithering),ct.alphaToCoverage!==void 0&&(at.alphaToCoverage=ct.alphaToCoverage),ct.premultipliedAlpha!==void 0&&(at.premultipliedAlpha=ct.premultipliedAlpha),ct.toneMapped!==void 0&&(at.toneMapped=ct.toneMapped),ct.normalScale!==void 0&&at.normalScale!==void 0&&(Array.isArray(ct.normalScale)?at.normalScale.fromArray(ct.normalScale):typeof ct.normalScale=="number"?at.normalScale.set(ct.normalScale,ct.normalScale):e.console.warn("normalScale is not an array or number",ct.normalScale)),ct.reflectivity!==void 0&&(at.reflectivity=ct.reflectivity),Object.entries(ct).forEach(([At,xt])=>{At.startsWith("_")||xt&&xt.resource&&typeof xt.resource=="string"&&(at[At]=Oo(xt,at[At],!1,rt))}),delete at.userData.gltfExtensions[Ru])}),tt&&delete et.userData.gltfExtensions[Ru]}}}),GA=h=>e=>({name:"__"+Rm,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(o=>{var g,b;if(!o.isLight)return;const c=(b=(g=o.userData)==null?void 0:g.gltfExtensions)==null?void 0:b[Rm];c&&(!o.shadow&&c.shadow&&console.error("Light has no shadow, cannot import",o,c),c.shadow&&o.shadow&&(c.shadow.bias!==void 0&&(o.shadow.bias=c.shadow.bias),c.shadow.normalBias!==void 0&&(o.shadow.normalBias=c.shadow.normalBias),c.shadow.radius!==void 0&&(o.shadow.radius=c.shadow.radius),c.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(c.shadow.mapSize),c.shadow.camera!==void 0&&(o.shadow.camera=h.parseObject(c.shadow.camera))),delete o.userData.gltfExtensions[Rm])})})}});async function x0(h,e,i,s){var et,tt,rt;if(!s){const st=h.json.scenes||[];if(st.length!==1){for(const at of st)await x0(h,e,i,at);return}s=st[0]}const o=(et=s.extensions)==null?void 0:et[iu];if(!o)return;const c=[];Object.values(o.resources).forEach(st=>{Object.values(st).forEach(at=>{at.url&&(at.url.type==="Uint16Array"&&at.url.data&&c.push(at.url),at.url.type==="Uint8Array"&&at.url.data&&c.push(at.url))})});for(const st of c){const at=st.data.image,ct=h.json.images[at],pt=await h.getDependency("bufferView",ct.bufferView);if(ct.mimeType.startsWith("image/")&&st.type==="Uint16Array"&&st.encoding==="rgbe"){const gt=new Blob([pt]);let At=URL.createObjectURL(gt);(st.encodingVersion||1)<2&&(At="data:image/png;base64,"+btoa(await gt.text())),st.data=(await new xv().parseAsync(At,void 0,!0)).data,URL.revokeObjectURL(At),delete st.encoding,delete st.encodingVersion}else st.data=pt}const g={textures:{},materials:{}},b=o.resources;if(b.textures&&h.json.textures)for(const[st,at]of[...Object.entries(b.textures)]){if(at.uuid||!st)continue;delete b.textures[st];const ct=h.json.textures.findIndex(pt=>{var gt,At,xt,yt,_t,Mt,It;return((gt=pt.extras)==null?void 0:gt.uuid)===st||((yt=(xt=(At=h.json.samplers)==null?void 0:At[pt.sampler])==null?void 0:xt.extras)==null?void 0:yt.uuid)===st||((It=(Mt=(_t=h.json.images)==null?void 0:_t[pt.source])==null?void 0:Mt.extras)==null?void 0:It.t_uuid)===st});ct>=0&&(g.textures[st]=await h.getDependency("texture",ct))}if(b.materials&&h.json.materials)for(const[st,at]of[...Object.entries(b.materials)]){if(at.uuid||!st)continue;delete b.materials[st];const ct=h.json.materials.findIndex(pt=>{var gt;return((gt=pt.extras)==null?void 0:gt.uuid)===st});ct>=0&&(g.materials[st]=await h.getDependency("material",ct),g.materials[st]=(rt=(tt=e.getPlugin(Lr))==null?void 0:tt.materials)==null?void 0:rt.processMaterial(g.materials[st],{}))}return o.resources=await e.getPlugin(Lr).importConfigResources(b||{},i,g),o}const E0="WEBGI_materials_bumpmap",Ev="WEBGI_materials_displacementmap",j_="WEBGI_materials_alphamap",_x="WEBGI_materials_lightmap";class HA{constructor(e){this.parser=e,this.name=E0}async extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],g=o.extensions[this.name];return g.bumpScale!==void 0&&(i.bumpScale=g.bumpScale),g.bumpTexture!==void 0&&c.push(s.assignTexture(i,"bumpMap",g.bumpTexture)),Promise.all(c)}}class U1{constructor(e){this.parser=e,this.name=Ev}async extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],g=o.extensions[this.name];return g.displacementScale!==void 0&&(i.displacementScale=g.displacementScale),g.displacementBias!==void 0&&(i.displacementBias=g.displacementBias),g.displacementTexture!==void 0&&c.push(s.assignTexture(i,"displacementMap",g.displacementTexture)),Promise.all(c)}}class Dm{constructor(e){this.parser=e,this.name=_x}async extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],g=o.extensions[this.name];return g.lightMapIntensity!==void 0&&(i.lightMapIntensity=g.lightMapIntensity),g.lightMapTexture!==void 0&&c.push(s.assignTexture(i,"lightMap",g.lightMapTexture)),Promise.all(c)}}class h_{constructor(e){this.parser=e,this.name=j_}async extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],g=o.extensions[this.name];return g.alphaTexture!==void 0&&c.push(s.assignTexture(i,"alphaMap",g.alphaTexture)),Promise.all(c)}}var yx=__webpackgi_require__(23);function S0(){return new yl(yx.Q,["drc"],!0)}class _g extends _.Ox3{get lightObject(){return this}get modelObject(){return this}constructor(e,i){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new _.Ilk(e),this.intensity=i||1,this.target.position.set(0,0,-1),this.add(this.target)}copy(e,i){const s=this.target,o=e.userData;return e.userData={},super.copy(e,i),tu(this.userData,o),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)==null||e.dispose(),(i=this.shadow.mapPass)==null||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const o=super.toJSON(e);return o.userData=To(tu({},i),!1),this.userData={},this.children=s,o.type="DirectionalLight2",o.target=this.target.position.toArray(),Object.assign(o,To(this,!0,e))}fromJSON(e,i){if(e.type!=="DirectionalLight2")return null;const s=e.target,o=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,Oo(e,this,!0,i),s&&(e.target=s),o&&(o.color!==void 0&&this.color.set(o.color),o.intensity!==void 0&&(this.intensity=o.intensity),e.object=o),this}}class QA extends _.PMe{get lightObject(){return this}get modelObject(){return this}constructor(e,i,s,o,c,g){super(e,i,s,o,c,g),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}copy(e,i){const s=this.target,o=e.userData;return e.userData={},super.copy(e,i),tu(this.userData,o),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)==null||e.dispose(),(i=this.shadow.mapPass)==null||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const o=super.toJSON(e);return o.userData=To(tu({},i),!1),this.userData={},this.children=s,o.type="SpotLight2",o.target=this.target.position.toArray(),Object.assign(o,To(this,!0,e))}fromJSON(e,i){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),Oo(e,this,!0,i),this):this)}}class Ty extends _.cek{get lightObject(){return this}get modelObject(){return this}constructor(e,i,s,o){super(e,i,s,o),this.assetType="light"}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),tu(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)==null||e.dispose(),(i=this.shadow.mapPass)==null||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=To(tu({},i),!1),this.userData={},s.type="PointLight2",Object.assign(s,To(this,!0,e))}fromJSON(e,i){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),Oo(e,this,!0,i),this):this}}class WA extends _.Mig{get lightObject(){return this}get modelObject(){return this}constructor(e,i){super(e,i),this.assetType="light"}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),tu(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=To(tu({},i),!1),this.userData={},s.type="AmbientLight2",Object.assign(s,To(this,!0,e))}fromJSON(e,i){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),Oo(e,this,!0,i),this):this}}class C0 extends _.aNw{load(e,i,s,o){const c=new _.hH6(this.manager);c.setPath(this.path),c.setResponseType("text"),c.load(e,g=>{try{i(this.parse(g))}catch(b){o?o(b):console.error(b),this.manager.itemError(e)}},s,o)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let i=null,s=null;const o=new _.Pa4(0,0,0),c=new _.Pa4(1,1,1),g=e.split(/[\n\r]+/g);let b=null,et=0;for(let st=0,at=g.length;st<at;st++){const ct=g[st].trim(),pt=ct.split(/\s/g);switch(pt[0]){case"TITLE":i=ct.substring(7,ct.length-1);break;case"LUT_3D_SIZE":const gt=pt[1];s=parseFloat(gt),b=new Uint8Array(s*s*s*4);break;case"DOMAIN_MIN":o.x=parseFloat(pt[1]),o.y=parseFloat(pt[2]),o.z=parseFloat(pt[3]);break;case"DOMAIN_MAX":c.x=parseFloat(pt[1]),c.y=parseFloat(pt[2]),c.z=parseFloat(pt[3]);break;default:const At=parseFloat(pt[0]),xt=parseFloat(pt[1]),yt=parseFloat(pt[2]);if(At>1||At<0||xt>1||xt<0||yt>1||yt<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");b[et+0]=255*At,b[et+1]=255*xt,b[et+2]=255*yt,b[et+3]=255,et+=4}}const tt=new _.IEO;tt.image.data=b,tt.image.width=s,tt.image.height=s*s,tt.type=_.ywz,tt.magFilter=_.wem,tt.minFilter=_.wem,tt.wrapS=_.uWy,tt.wrapT=_.uWy,tt.generateMipmaps=!1,tt.needsUpdate=!0;const rt=new _.JUT;return rt.image.data=b,rt.image.width=s,rt.image.height=s,rt.image.depth=s,rt.type=_.ywz,rt.magFilter=_.wem,rt.minFilter=_.wem,rt.wrapS=_.uWy,rt.wrapT=_.uWy,rt.wrapR=_.uWy,rt.generateMipmaps=!1,rt.needsUpdate=!0,{title:i,size:s,domainMin:o,domainMax:c,texture:tt,texture3D:rt}}}let ro=class{constructor({domainMax:h,domainMin:e,size:i,texture:s,texture3D:o,title:c}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=h,this.domainMin=e,this.size=i,this.texture=s,this.texture3D=o,this.title=c,this.uuid=Pn(),this.userData.__needsSourceBuffer=!0}fromJSON(h,e){return h.type!==this.type&&console.warn("type mismatch while import",h,this),console.error("not supported"),this}toJSON(h){return ix(this,h,this.texture.name)}};ro=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g}([qm("LUTCubeTextureWrapper")],ro);class Iy extends C0{parse(e){const i=super.parse(e);return new ro(i)}}var km={},xo=Uint8Array,Du=Uint16Array,wp=Uint32Array,sp=new xo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Eu=new xo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Py=new xo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),qA=function(h,e){for(var i=new Du(31),s=0;s<31;++s)i[s]=e+=1<<h[s-1];var o=new wp(i[30]);for(s=1;s<30;++s)for(var c=i[s];c<i[s+1];++c)o[c]=c-i[s]<<5|s;return[i,o]},M0=qA(sp,2),T0=M0[0],Ax=M0[1];T0[28]=258,Ax[258]=28;for(var Sv=qA(Eu,0),z_=Sv[0],op=Sv[1],V_=new Du(32768),Eo=0;Eo<32768;++Eo){var I0=(43690&Eo)>>>1|(21845&Eo)<<1;I0=(61680&(I0=(52428&I0)>>>2|(13107&I0)<<2))>>>4|(3855&I0)<<4,V_[Eo]=((65280&I0)>>>8|(255&I0)<<8)>>>1}var sm=function(h,e,i){for(var s=h.length,o=0,c=new Du(e);o<s;++o)++c[h[o]-1];var g,b=new Du(e);for(o=0;o<e;++o)b[o]=b[o-1]+c[o-1]<<1;if(i){g=new Du(1<<e);var et=15-e;for(o=0;o<s;++o)if(h[o])for(var tt=o<<4|h[o],rt=e-h[o],st=b[h[o]-1]++<<rt,at=st|(1<<rt)-1;st<=at;++st)g[V_[st]>>>et]=tt}else for(g=new Du(s),o=0;o<s;++o)h[o]&&(g[o]=V_[b[h[o]-1]++]>>>15-h[o]);return g},Cv=new xo(288);for(Eo=0;Eo<144;++Eo)Cv[Eo]=8;for(Eo=144;Eo<256;++Eo)Cv[Eo]=9;for(Eo=256;Eo<280;++Eo)Cv[Eo]=7;for(Eo=280;Eo<288;++Eo)Cv[Eo]=8;var P0=new xo(32);for(Eo=0;Eo<32;++Eo)P0[Eo]=5;var G_=sm(Cv,9,0),F1=sm(Cv,9,1),j1=sm(P0,5,0),Po=sm(P0,5,1),ap=function(h){for(var e=h[0],i=1;i<h.length;++i)h[i]>e&&(e=h[i]);return e},du=function(h,e,i){var s=e/8|0;return(h[s]|h[s+1]<<8)>>(7&e)&i},ev=function(h,e){var i=e/8|0;return(h[i]|h[i+1]<<8|h[i+2]<<16)>>(7&e)},Vp=function(h){return(h/8|0)+(7&h&&1)},Xu=function(h,e,i){(e==null||e<0)&&(e=0),(i==null||i>h.length)&&(i=h.length);var s=new(h instanceof Du?Du:h instanceof wp?wp:xo)(i-e);return s.set(h.subarray(e,i)),s},Mv=function(h,e,i){var s=h.length;if(!s||i&&!i.l&&s<5)return e||new xo(0);var o=!e||i,c=!i||i.i;i||(i={}),e||(e=new xo(3*s));var g=function(Jr){var cs=e.length;if(Jr>cs){var Os=new xo(Math.max(2*cs,Jr));Os.set(e),e=Os}},b=i.f||0,et=i.p||0,tt=i.b||0,rt=i.l,st=i.d,at=i.m,ct=i.n,pt=8*s;do{if(!rt){i.f=b=du(h,et,1);var gt=du(h,et+1,3);if(et+=3,!gt){var At=h[(on=Vp(et)+4)-4]|h[on-3]<<8,xt=on+At;if(xt>s){if(c)throw"unexpected EOF";break}o&&g(tt+At),e.set(h.subarray(on,xt),tt),i.b=tt+=At,i.p=et=8*xt;continue}if(gt==1)rt=F1,st=Po,at=9,ct=5;else{if(gt!=2)throw"invalid block type";var yt=du(h,et,31)+257,_t=du(h,et+10,15)+4,Mt=yt+du(h,et+5,31)+1;et+=14;for(var It=new xo(Mt),Bt=new xo(19),Lt=0;Lt<_t;++Lt)Bt[Py[Lt]]=du(h,et+3*Lt,7);et+=3*_t;var Ht=ap(Bt),Jt=(1<<Ht)-1,sn=sm(Bt,Ht,1);for(Lt=0;Lt<Mt;){var on,mn=sn[du(h,et,Jt)];if(et+=15&mn,(on=mn>>>4)<16)It[Lt++]=on;else{var cn=0,un=0;for(on==16?(un=3+du(h,et,3),et+=2,cn=It[Lt-1]):on==17?(un=3+du(h,et,7),et+=3):on==18&&(un=11+du(h,et,127),et+=7);un--;)It[Lt++]=cn}}var bn=It.subarray(0,yt),xn=It.subarray(yt);at=ap(bn),ct=ap(xn),rt=sm(bn,at,1),st=sm(xn,ct,1)}if(et>pt){if(c)throw"unexpected EOF";break}}o&&g(tt+131072);for(var Cn=(1<<at)-1,Jn=(1<<ct)-1,Kn=et;;Kn=et){var gr=(cn=rt[ev(h,et)&Cn])>>>4;if((et+=15&cn)>pt){if(c)throw"unexpected EOF";break}if(!cn)throw"invalid length/literal";if(gr<256)e[tt++]=gr;else{if(gr==256){Kn=et,rt=null;break}var nr=gr-254;if(gr>264){var tr=sp[Lt=gr-257];nr=du(h,et,(1<<tr)-1)+T0[Lt],et+=tr}var Cr=st[ev(h,et)&Jn],Ar=Cr>>>4;if(!Cr)throw"invalid distance";if(et+=15&Cr,xn=z_[Ar],Ar>3&&(tr=Eu[Ar],xn+=ev(h,et)&(1<<tr)-1,et+=tr),et>pt){if(c)throw"unexpected EOF";break}o&&g(tt+131072);for(var Hr=tt+nr;tt<Hr;tt+=4)e[tt]=e[tt-xn],e[tt+1]=e[tt+1-xn],e[tt+2]=e[tt+2-xn],e[tt+3]=e[tt+3-xn];tt=Hr}}i.l=rt,i.p=Kn,i.b=tt,rt&&(b=1,i.m=at,i.d=st,i.n=ct)}while(!b);return tt==e.length?e:Xu(e,0,tt)},tv=function(h,e,i){i<<=7&e;var s=e/8|0;h[s]|=i,h[s+1]|=i>>>8},H_=function(h,e,i){i<<=7&e;var s=e/8|0;h[s]|=i,h[s+1]|=i>>>8,h[s+2]|=i>>>16},Tv=function(h,e){for(var i=[],s=0;s<h.length;++s)h[s]&&i.push({s,f:h[s]});var o=i.length,c=i.slice();if(!o)return[Iv,0];if(o==1){var g=new xo(i[0].s+1);return g[i[0].s]=1,[g,1]}i.sort(function(It,Bt){return It.f-Bt.f}),i.push({s:-1,f:25001});var b=i[0],et=i[1],tt=0,rt=1,st=2;for(i[0]={s:-1,f:b.f+et.f,l:b,r:et};rt!=o-1;)b=i[i[tt].f<i[st].f?tt++:st++],et=i[tt!=rt&&i[tt].f<i[st].f?tt++:st++],i[rt++]={s:-1,f:b.f+et.f,l:b,r:et};var at=c[0].s;for(s=1;s<o;++s)c[s].s>at&&(at=c[s].s);var ct=new Du(at+1),pt=R0(i[rt-1],ct,0);if(pt>e){s=0;var gt=0,At=pt-e,xt=1<<At;for(c.sort(function(It,Bt){return ct[Bt.s]-ct[It.s]||It.f-Bt.f});s<o;++s){var yt=c[s].s;if(!(ct[yt]>e))break;gt+=xt-(1<<pt-ct[yt]),ct[yt]=e}for(gt>>>=At;gt>0;){var _t=c[s].s;ct[_t]<e?gt-=1<<e-ct[_t]++-1:++s}for(;s>=0&&gt;--s){var Mt=c[s].s;ct[Mt]==e&&(--ct[Mt],++gt)}pt=e}return[new xo(ct),pt]},R0=function(h,e,i){return h.s==-1?Math.max(R0(h.l,e,i+1),R0(h.r,e,i+1)):e[h.s]=i},Ry=function(h){for(var e=h.length;e&&!h[--e];);for(var i=new Du(++e),s=0,o=h[0],c=1,g=function(et){i[s++]=et},b=1;b<=e;++b)if(h[b]==o&&b!=e)++c;else{if(!o&&c>2){for(;c>138;c-=138)g(32754);c>2&&(g(c>10?c-11<<5|28690:c-3<<5|12305),c=0)}else if(c>3){for(g(o),--c;c>6;c-=6)g(8304);c>2&&(g(c-3<<5|8208),c=0)}for(;c--;)g(o);c=1,o=h[b]}return[i.subarray(0,s),e]},ru=function(h,e){for(var i=0,s=0;s<e.length;++s)i+=h[s]*e[s];return i},Dy=function(h,e,i){var s=i.length,o=Vp(e+2);h[o]=255&s,h[o+1]=s>>>8,h[o+2]=255^h[o],h[o+3]=255^h[o+1];for(var c=0;c<s;++c)h[o+c+4]=i[c];return 8*(o+4+s)},ku=function(h,e,i,s,o,c,g,b,et,tt,rt){tv(e,rt++,i),++o[256];for(var st=Tv(o,15),at=st[0],ct=st[1],pt=Tv(c,15),gt=pt[0],At=pt[1],xt=Ry(at),yt=xt[0],_t=xt[1],Mt=Ry(gt),It=Mt[0],Bt=Mt[1],Lt=new Du(19),Ht=0;Ht<yt.length;++Ht)Lt[31&yt[Ht]]++;for(Ht=0;Ht<It.length;++Ht)Lt[31&It[Ht]]++;for(var Jt=Tv(Lt,7),sn=Jt[0],on=Jt[1],mn=19;mn>4&&!sn[Py[mn-1]];--mn);var cn,un,bn,xn,Cn=tt+5<<3,Jn=ru(o,Cv)+ru(c,P0)+g,Kn=ru(o,at)+ru(c,gt)+g+14+3*mn+ru(Lt,sn)+(2*Lt[16]+3*Lt[17]+7*Lt[18]);if(Cn<=Jn&&Cn<=Kn)return Dy(e,rt,h.subarray(et,et+tt));if(tv(e,rt,1+(Kn<Jn)),rt+=2,Kn<Jn){cn=sm(at,ct,0),un=at,bn=sm(gt,At,0),xn=gt;var gr=sm(sn,on,0);for(tv(e,rt,_t-257),tv(e,rt+5,Bt-1),tv(e,rt+10,mn-4),rt+=14,Ht=0;Ht<mn;++Ht)tv(e,rt+3*Ht,sn[Py[Ht]]);rt+=3*mn;for(var nr=[yt,It],tr=0;tr<2;++tr){var Cr=nr[tr];for(Ht=0;Ht<Cr.length;++Ht){var Ar=31&Cr[Ht];tv(e,rt,gr[Ar]),rt+=sn[Ar],Ar>15&&(tv(e,rt,Cr[Ht]>>>5&127),rt+=Cr[Ht]>>>12)}}}else cn=G_,un=Cv,bn=j1,xn=P0;for(Ht=0;Ht<b;++Ht)if(s[Ht]>255){Ar=s[Ht]>>>18&31,H_(e,rt,cn[Ar+257]),rt+=un[Ar+257],Ar>7&&(tv(e,rt,s[Ht]>>>23&31),rt+=sp[Ar]);var Hr=31&s[Ht];H_(e,rt,bn[Hr]),rt+=xn[Hr],Hr>3&&(H_(e,rt,s[Ht]>>>5&8191),rt+=Eu[Hr])}else H_(e,rt,cn[s[Ht]]),rt+=un[s[Ht]];return H_(e,rt,cn[256]),rt+un[256]},XA=new wp([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Iv=new xo(0),Su=function(h,e,i,s,o,c){var g=h.length,b=new xo(s+g+5*(1+Math.ceil(g/7e3))+o),et=b.subarray(s,b.length-o),tt=0;if(!e||g<8)for(var rt=0;rt<=g;rt+=65535){var st=rt+65535;st<g?tt=Dy(et,tt,h.subarray(rt,st)):(et[rt]=c,tt=Dy(et,tt,h.subarray(rt,g)))}else{for(var at=XA[e-1],ct=at>>>13,pt=8191&at,gt=(1<<i)-1,At=new Du(32768),xt=new Du(gt+1),yt=Math.ceil(i/3),_t=2*yt,Mt=function(Pr){return(h[Pr]^h[Pr+1]<<yt^h[Pr+2]<<_t)&gt},It=new wp(25e3),Bt=new Du(288),Lt=new Du(32),Ht=0,Jt=0,sn=(rt=0,0),on=0,mn=0;rt<g;++rt){var cn=Mt(rt),un=32767&rt,bn=xt[cn];if(At[un]=bn,xt[cn]=un,on<=rt){var xn=g-rt;if((Ht>7e3||sn>24576)&&xn>423){tt=ku(h,et,0,It,Bt,Lt,Jt,sn,mn,rt-mn,tt),sn=Ht=Jt=0,mn=rt;for(var Cn=0;Cn<286;++Cn)Bt[Cn]=0;for(Cn=0;Cn<30;++Cn)Lt[Cn]=0}var Jn=2,Kn=0,gr=pt,nr=un-bn&32767;if(xn>2&&cn==Mt(rt-nr))for(var tr=Math.min(ct,xn)-1,Cr=Math.min(32767,rt),Ar=Math.min(258,xn);nr<=Cr&&--gr&&un!=bn;){if(h[rt+Jn]==h[rt+Jn-nr]){for(var Hr=0;Hr<Ar&&h[rt+Hr]==h[rt+Hr-nr];++Hr);if(Hr>Jn){if(Jn=Hr,Kn=nr,Hr>tr)break;var Jr=Math.min(nr,Hr-2),cs=0;for(Cn=0;Cn<Jr;++Cn){var Os=rt-nr+Cn+32768&32767,Ss=Os-At[Os]+32768&32767;Ss>cs&&(cs=Ss,bn=Os)}}}nr+=(un=bn)-(bn=At[un])+32768&32767}if(Kn){It[sn++]=268435456|Ax[Jn]<<18|op[Kn];var Ts=31&Ax[Jn],pr=31&op[Kn];Jt+=sp[Ts]+Eu[pr],++Bt[257+Ts],++Lt[pr],on=rt+Jn,++Ht}else It[sn++]=h[rt],++Bt[h[rt]]}}tt=ku(h,et,c,It,Bt,Lt,Jt,sn,mn,rt-mn,tt),!c&&7&tt&&(tt=Dy(et,tt+1,Iv))}return Xu(b,0,s+Vp(tt)+o)},YA=function(){for(var h=new Int32Array(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(1&i&&-306674912)^i>>>1;h[e]=i}return h}(),Q_=function(){var h=-1;return{p:function(e){for(var i=h,s=0;s<e.length;++s)i=YA[255&i^e[s]]^i>>>8;h=i},d:function(){return~h}}},us=function(){var h=1,e=0;return{p:function(i){for(var s=h,o=e,c=i.length,g=0;g!=c;){for(var b=Math.min(g+2655,c);g<b;++g)o+=s+=i[g];s=(65535&s)+15*(s>>16),o=(65535&o)+15*(o>>16)}h=s,e=o},d:function(){return(255&(h%=65521))<<24|h>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},Ul=function(h,e,i,s,o){return Su(h,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(h.length)))):12+e.mem,i,s,!o)},Bm=function(h,e){var i={};for(var s in h)i[s]=h[s];for(var s in e)i[s]=e[s];return i},Pv=function(h,e,i){for(var s=h(),o=h.toString(),c=o.slice(o.indexOf("[")+1,o.lastIndexOf("]")).replace(/ /g,"").split(","),g=0;g<s.length;++g){var b=s[g],et=c[g];if(typeof b=="function"){e+=";"+et+"=";var tt=b.toString();if(b.prototype)if(tt.indexOf("[native code]")!=-1){var rt=tt.indexOf(" ",8)+1;e+=tt.slice(rt,tt.indexOf("(",rt))}else for(var st in e+=tt,b.prototype)e+=";"+et+".prototype."+st+"="+b.prototype[st].toString();else e+=tt}else i[et]=b}return[e,i]},bx=[],xp=function(h,e,i,s){var o;if(!bx[i]){for(var c="",g={},b=h.length-1,et=0;et<b;++et)c=(o=Pv(h[et],c,g))[0],g=o[1];bx[i]=Pv(h[b],c,g)}var tt=Bm({},bx[i][1]);return function(rt,st,at,ct,pt){var gt=new Worker(km[st]||(km[st]=URL.createObjectURL(new Blob([rt],{type:"text/javascript"}))));return gt.onerror=function(At){return pt(At.error,null)},gt.onmessage=function(At){return pt(null,At.data)},gt.postMessage(at,ct),gt}(bx[i][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",i,tt,function(rt){var st=[];for(var at in rt)(rt[at]instanceof xo||rt[at]instanceof Du||rt[at]instanceof wp)&&st.push((rt[at]=new rt[at].constructor(rt[at])).buffer);return st}(tt),s)},Rv=function(){return[xo,Du,wp,sp,Eu,Py,T0,z_,F1,Po,V_,sm,ap,du,ev,Vp,Xu,Mv,Wo,W_,V1]},ky=function(){return[xo,Du,wp,sp,Eu,Py,Ax,op,G_,Cv,j1,P0,V_,XA,Iv,sm,tv,H_,Tv,R0,Ry,ru,Dy,ku,Vp,Xu,Su,Ul,or,W_]},Qo=function(){return[G1,Ct,Go,Q_,YA]},By=function(){return[Sp,wx]},Jo=function(){return[lt,Go,us]},z1=function(){return[mt]},W_=function(h){return postMessage(h,[h.buffer])},V1=function(h){return h&&h.size&&new xo(h.size)},D0=function(h,e,i,s,o,c){var g=xp(i,s,o,function(b,et){g.terminate(),c(b,et)});return g.postMessage([h,e],e.consume?[h.buffer]:[]),function(){g.terminate()}},Ep=function(h){return h.ondata=function(e,i){return postMessage([e,i],[e.buffer])},function(e){return h.push(e.data[0],e.data[1])}},k0=function(h,e,i,s,o){var c,g=xp(h,s,o,function(b,et){b?(g.terminate(),e.ondata.call(e,b)):(et[1]&&g.terminate(),e.ondata.call(e,b,et[0],et[1]))});g.postMessage(i),e.push=function(b,et){if(c)throw"stream finished";if(!e.ondata)throw"no stream handler";g.postMessage([b,c=et],[b.buffer])},e.terminate=function(){g.terminate()}},Yu=function(h,e){return h[e]|h[e+1]<<8},su=function(h,e){return(h[e]|h[e+1]<<8|h[e+2]<<16|h[e+3]<<24)>>>0},fs=function(h,e){return su(h,e)+4294967296*su(h,e+4)},Go=function(h,e,i){for(;i;++e)h[e]=i,i>>>=8},G1=function(h,e){var i=e.filename;if(h[0]=31,h[1]=139,h[2]=8,h[8]=e.level<2?4:e.level==9?2:0,h[9]=3,e.mtime!=0&&Go(h,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),i){h[3]=8;for(var s=0;s<=i.length;++s)h[s+10]=i.charCodeAt(s)}},Sp=function(h){if(h[0]!=31||h[1]!=139||h[2]!=8)throw"invalid gzip data";var e=h[3],i=10;4&e&&(i+=h[10]|2+(h[11]<<8));for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!h[i++]);return i+(2&e)},wx=function(h){var e=h.length;return(h[e-4]|h[e-3]<<8|h[e-2]<<16|h[e-1]<<24)>>>0},Ct=function(h){return 10+(h.filename&&h.filename.length+1||0)},lt=function(h,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;h[0]=120,h[1]=s<<6|(s?32-2*s:1)},mt=function(h){if((15&h[0])!=8||h[0]>>>4>7||(h[0]<<8|h[1])%31)throw"invalid zlib data";if(32&h[1])throw"invalid zlib data: preset dictionaries not supported"};function Tt(h,e){return e||typeof h!="function"||(e=h,h={}),this.ondata=e,h}var Vt=function(){function h(e,i){i||typeof e!="function"||(i=e,e={}),this.ondata=i,this.o=e||{}}return h.prototype.p=function(e,i){this.ondata(Ul(e,this.o,0,0,!i),i)},h.prototype.push=function(e,i){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=i,this.p(e,i||!1)},h}(),wn=function(){return function(h,e){k0([ky,function(){return[Ep,Vt]}],this,Tt.call(this,h,e),function(i){var s=new Vt(i.data);onmessage=Ep(s)},6)}}();function Tn(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return D0(h,e,[ky],function(s){return W_(or(s.data[0],s.data[1]))},0,i)}function or(h,e){return Ul(h,e||{},0,0)}var Mr=function(){function h(e){this.s={},this.p=new xo(0),this.ondata=e}return h.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var i=this.p.length,s=new xo(i+e.length);s.set(this.p),s.set(e,i),this.p=s},h.prototype.c=function(e){this.d=this.s.i=e||!1;var i=this.s.b,s=Mv(this.p,this.o,this.s);this.ondata(Xu(s,i,this.s.b),this.d),this.o=Xu(s,this.s.b-32768),this.s.b=this.o.length,this.p=Xu(this.p,this.s.p/8|0),this.s.p&=7},h.prototype.push=function(e,i){this.e(e),this.c(i)},h}(),as=function(){return function(h){this.ondata=h,k0([Rv,function(){return[Ep,Mr]}],this,0,function(){var e=new Mr;onmessage=Ep(e)},7)}}();function Gs(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return D0(h,e,[Rv],function(s){return W_(Wo(s.data[0],V1(s.data[1])))},1,i)}function Wo(h,e){return Mv(h,e)}var Ku=function(){function h(e,i){this.c=Q_(),this.l=0,this.v=1,Vt.call(this,e,i)}return h.prototype.push=function(e,i){Vt.prototype.push.call(this,e,i)},h.prototype.p=function(e,i){this.c.p(e),this.l+=e.length;var s=Ul(e,this.o,this.v&&Ct(this.o),i&&8,!i);this.v&&(G1(s,this.o),this.v=0),i&&(Go(s,s.length-8,this.c.d()),Go(s,s.length-4,this.l)),this.ondata(s,i)},h}(),Bu=function(){return function(h,e){k0([ky,Qo,function(){return[Ep,Vt,Ku]}],this,Tt.call(this,h,e),function(i){var s=new Ku(i.data);onmessage=Ep(s)},8)}}();function Om(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return D0(h,e,[ky,Qo,function(){return[Dv]}],function(s){return W_(Dv(s.data[0],s.data[1]))},2,i)}function Dv(h,e){e||(e={});var i=Q_(),s=h.length;i.p(h);var o=Ul(h,e,Ct(e),8),c=o.length;return G1(o,e),Go(o,c-8,i.d()),Go(o,c-4,s),o}var d_=function(){function h(e){this.v=1,Mr.call(this,e)}return h.prototype.push=function(e,i){if(Mr.prototype.e.call(this,e),this.v){var s=this.p.length>3?Sp(this.p):4;if(s>=this.p.length&&!i)return;this.p=this.p.subarray(s),this.v=0}if(i){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Mr.prototype.c.call(this,i)},h}(),KA=function(){return function(h){this.ondata=h,k0([Rv,By,function(){return[Ep,Mr,d_]}],this,0,function(){var e=new d_;onmessage=Ep(e)},9)}}();function Oy(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return D0(h,e,[Rv,By,function(){return[q_]}],function(s){return W_(q_(s.data[0]))},3,i)}function q_(h,e){return Mv(h.subarray(Sp(h),-8),e||new xo(wx(h)))}var Ly=function(){function h(e,i){this.c=us(),this.v=1,Vt.call(this,e,i)}return h.prototype.push=function(e,i){Vt.prototype.push.call(this,e,i)},h.prototype.p=function(e,i){this.c.p(e);var s=Ul(e,this.o,this.v&&2,i&&4,!i);this.v&&(lt(s,this.o),this.v=0),i&&Go(s,s.length-4,this.c.d()),this.ondata(s,i)},h}(),xx=function(){return function(h,e){k0([ky,Jo,function(){return[Ep,Vt,Ly]}],this,Tt.call(this,h,e),function(i){var s=new Ly(i.data);onmessage=Ep(s)},10)}}();function Ou(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return D0(h,e,[ky,Jo,function(){return[Ex]}],function(s){return W_(Ex(s.data[0],s.data[1]))},4,i)}function Ex(h,e){e||(e={});var i=us();i.p(h);var s=Ul(h,e,2,4);return lt(s,e),Go(s,s.length-4,i.d()),s}var kv=function(){function h(e){this.v=1,Mr.call(this,e)}return h.prototype.push=function(e,i){if(Mr.prototype.e.call(this,e),this.v){if(this.p.length<2&&!i)return;this.p=this.p.subarray(2),this.v=0}if(i){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Mr.prototype.c.call(this,i)},h}(),Ny=function(){return function(h){this.ondata=h,k0([Rv,z1,function(){return[Ep,Mr,kv]}],this,0,function(){var e=new kv;onmessage=Ep(e)},11)}}();function Gp(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return D0(h,e,[Rv,z1,function(){return[H1]}],function(s){return W_(H1(s.data[0],V1(s.data[1])))},5,i)}function H1(h,e){return Mv((mt(h),h.subarray(2,-4)),e)}var FM=function(){function h(e){this.G=d_,this.I=Mr,this.Z=kv,this.ondata=e}return h.prototype.push=function(e,i){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,i);else{if(this.p&&this.p.length){var s=new xo(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var o=this,c=function(){o.ondata.apply(o,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(c):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(c):new this.Z(c),this.s.push(this.p,i),this.p=null}}},h}(),p_=function(){function h(e){this.G=KA,this.I=as,this.Z=Ny,this.ondata=e}return h.prototype.push=function(e,i){FM.prototype.push.call(this,e,i)},h}();function FS(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return h[0]==31&&h[1]==139&&h[2]==8?Oy(h,e,i):(15&h[0])!=8||h[0]>>4>7||(h[0]<<8|h[1])%31?Gs(h,e,i):Gp(h,e,i)}function Cp(h,e){return h[0]==31&&h[1]==139&&h[2]==8?q_(h,e):(15&h[0])!=8||h[0]>>4>7||(h[0]<<8|h[1])%31?Wo(h,e):H1(h,e)}var Uy=function(h,e,i,s){for(var o in h){var c=h[o],g=e+o;c instanceof xo?i[g]=[c,s]:Array.isArray(c)?i[g]=[c[0],Bm(s,c[1])]:Uy(c,g+"/",i,s)}},jM=typeof TextEncoder<"u"&&new TextEncoder,JA=typeof TextDecoder<"u"&&new TextDecoder,zM=0;try{JA.decode(Iv,{stream:!0}),zM=1}catch{}var jS=function(h){for(var e="",i=0;;){var s=h[i++],o=(s>127)+(s>223)+(s>239);if(i+o>h.length)return[e,Xu(h,i-1)];o?o==3?(s=((15&s)<<18|(63&h[i++])<<12|(63&h[i++])<<6|63&h[i++])-65536,e+=String.fromCharCode(55296|s>>10,56320|1023&s)):e+=1&o?String.fromCharCode((31&s)<<6|63&h[i++]):String.fromCharCode((15&s)<<12|(63&h[i++])<<6|63&h[i++]):e+=String.fromCharCode(s)}},QD=function(){function h(e){this.ondata=e,zM?this.t=new TextDecoder:this.p=Iv}return h.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(i=!!i,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),i),i){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var s=new xo(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var o=jS(s),c=o[0],g=o[1];if(i){if(g.length)throw"invalid utf-8 data";this.p=null}else this.p=g;this.ondata(c,i)}},h}(),WD=function(){function h(e){this.ondata=e}return h.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Mp(e),this.d=i||!1)},h}();function Mp(h,e){if(e){for(var i=new xo(h.length),s=0;s<h.length;++s)i[s]=h.charCodeAt(s);return i}if(jM)return jM.encode(h);var o=h.length,c=new xo(h.length+(h.length>>1)),g=0,b=function(rt){c[g++]=rt};for(s=0;s<o;++s){if(g+5>c.length){var et=new xo(g+8+(o-s<<1));et.set(c),c=et}var tt=h.charCodeAt(s);tt<128||e?b(tt):tt<2048?(b(192|tt>>6),b(128|63&tt)):tt>55295&&tt<57344?(b(240|(tt=65536+(1047552&tt)|1023&h.charCodeAt(++s))>>18),b(128|tt>>12&63),b(128|tt>>6&63),b(128|63&tt)):(b(224|tt>>12),b(128|tt>>6&63),b(128|63&tt))}return Xu(c,0,g)}function X_(h,e){if(e){for(var i="",s=0;s<h.length;s+=16384)i+=String.fromCharCode.apply(null,h.subarray(s,s+16384));return i}if(JA)return JA.decode(h);var o=jS(h),c=o[0];if(o[1].length)throw"invalid utf-8 data";return c}var Q1=function(h){return h==1?3:h<6?2:h==9?1:0},W1=function(h,e){return e+30+Yu(h,e+26)+Yu(h,e+28)},VM=function(h,e,i){var s=Yu(h,e+28),o=X_(h.subarray(e+46,e+46+s),!(2048&Yu(h,e+8))),c=e+46+s,g=su(h,e+20),b=i&&g==4294967295?u2(h,c):[g,su(h,e+24),su(h,e+42)],et=b[0],tt=b[1],rt=b[2];return[Yu(h,e+10),et,tt,o,c+Yu(h,e+30)+Yu(h,e+32),rt]},u2=function(h,e){for(;Yu(h,e)!=1;e+=4+Yu(h,e+2));return[fs(h,e+12),fs(h,e+4),fs(h,e+20)]},nv=function(h){var e=0;if(h)for(var i in h){var s=h[i].length;if(s>65535)throw"extra field too long";e+=s+4}return e},ao=function(h,e,i,s,o,c,g,b){var et=s.length,tt=i.extra,rt=b&&b.length,st=nv(tt);Go(h,e,g!=null?33639248:67324752),e+=4,g!=null&&(h[e++]=20,h[e++]=i.os),h[e]=20,e+=2,h[e++]=i.flag<<1|(c==null&&8),h[e++]=o&&8,h[e++]=255&i.compression,h[e++]=i.compression>>8;var at=new Date(i.mtime==null?Date.now():i.mtime),ct=at.getFullYear()-1980;if(ct<0||ct>119)throw"date not in range 1980-2099";if(Go(h,e,ct<<25|at.getMonth()+1<<21|at.getDate()<<16|at.getHours()<<11|at.getMinutes()<<5|at.getSeconds()>>>1),e+=4,c!=null&&(Go(h,e,i.crc),Go(h,e+4,c),Go(h,e+8,i.size)),Go(h,e+12,et),Go(h,e+14,st),e+=16,g!=null&&(Go(h,e,rt),Go(h,e+6,i.attrs),Go(h,e+10,g),e+=14),h.set(s,e),e+=et,st)for(var pt in tt){var gt=tt[pt],At=gt.length;Go(h,e,+pt),Go(h,e+2,At),h.set(gt,e+4),e+=4+At}return rt&&(h.set(b,e),e+=rt),e},ls=function(h,e,i,s,o){Go(h,e,101010256),Go(h,e+8,i),Go(h,e+10,i),Go(h,e+12,s),Go(h,e+16,o)},lp=function(){function h(e){this.filename=e,this.c=Q_(),this.size=0,this.compression=0}return h.prototype.process=function(e,i){this.ondata(null,e,i)},h.prototype.push=function(e,i){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,i&&(this.crc=this.c.d()),this.process(e,i||!1)},h}(),zS=function(){function h(e,i){var s=this;i||(i={}),lp.call(this,e),this.d=new Vt(i,function(o,c){s.ondata(null,o,c)}),this.compression=8,this.flag=Q1(i.level)}return h.prototype.process=function(e,i){try{this.d.push(e,i)}catch(s){this.ondata(s,null,i)}},h.prototype.push=function(e,i){lp.prototype.push.call(this,e,i)},h}(),qD=function(){function h(e,i){var s=this;i||(i={}),lp.call(this,e),this.d=new wn(i,function(o,c,g){s.ondata(o,c,g)}),this.compression=8,this.flag=Q1(i.level),this.terminate=this.d.terminate}return h.prototype.process=function(e,i){this.d.push(e,i)},h.prototype.push=function(e,i){lp.prototype.push.call(this,e,i)},h}(),XD=function(){function h(e){this.ondata=e,this.u=[],this.d=1}return h.prototype.add=function(e){var i=this;if(2&this.d)throw"stream finished";var s=Mp(e.filename),o=s.length,c=e.comment,g=c&&Mp(c),b=o!=e.filename.length||g&&c.length!=g.length,et=o+nv(e.extra)+30;if(o>65535)throw"filename too long";var tt=new xo(et);ao(tt,0,e,s,b);var rt=[tt],st=function(){for(var At=0,xt=rt;At<xt.length;At++){var yt=xt[At];i.ondata(null,yt,!1)}rt=[]},at=this.d;this.d=0;var ct=this.u.length,pt=Bm(e,{f:s,u:b,o:g,t:function(){e.terminate&&e.terminate()},r:function(){if(st(),at){var At=i.u[ct+1];At?At.r():i.d=1}at=1}}),gt=0;e.ondata=function(At,xt,yt){if(At)i.ondata(At,xt,yt),i.terminate();else if(gt+=xt.length,rt.push(xt),yt){var _t=new xo(16);Go(_t,0,134695760),Go(_t,4,e.crc),Go(_t,8,gt),Go(_t,12,e.size),rt.push(_t),pt.c=gt,pt.b=et+gt+16,pt.crc=e.crc,pt.size=e.size,at&&pt.r(),at=1}else at&&st()},this.u.push(pt)},h.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},h.prototype.e=function(){for(var e=0,i=0,s=0,o=0,c=this.u;o<c.length;o++)s+=46+(tt=c[o]).f.length+nv(tt.extra)+(tt.o?tt.o.length:0);for(var g=new xo(s+22),b=0,et=this.u;b<et.length;b++){var tt=et[b];ao(g,e,tt,tt.f,tt.u,tt.c,i,tt.o),e+=46+tt.f.length+nv(tt.extra)+(tt.o?tt.o.length:0),i+=tt.b}ls(g,e,this.u.length,s,i),this.ondata(null,g,!0),this.d=2},h.prototype.terminate=function(){for(var e=0,i=this.u;e<i.length;e++)i[e].t();this.d=2},h}();function YD(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";var s={};Uy(h,"",s,e);var o=Object.keys(s),c=o.length,g=0,b=0,et=c,tt=new Array(c),rt=[],st=function(){for(var gt=0;gt<rt.length;++gt)rt[gt]()},at=function(){var gt=new xo(b+22),At=g,xt=b-g;b=0;for(var yt=0;yt<et;++yt){var _t=tt[yt];try{var Mt=_t.c.length;ao(gt,b,_t,_t.f,_t.u,Mt);var It=30+_t.f.length+nv(_t.extra),Bt=b+It;gt.set(_t.c,Bt),ao(gt,g,_t,_t.f,_t.u,Mt,b,_t.m),g+=16+It+(_t.m?_t.m.length:0),b=Bt+Mt}catch(Lt){return i(Lt,null)}}ls(gt,g,tt.length,xt,At),i(null,gt)};c||at();for(var ct=function(gt){var At=o[gt],xt=s[At],yt=xt[0],_t=xt[1],Mt=Q_(),It=yt.length;Mt.p(yt);var Bt=Mp(At),Lt=Bt.length,Ht=_t.comment,Jt=Ht&&Mp(Ht),sn=Jt&&Jt.length,on=nv(_t.extra),mn=_t.level==0?0:8,cn=function(un,bn){if(un)st(),i(un,null);else{var xn=bn.length;tt[gt]=Bm(_t,{size:It,crc:Mt.d(),c:bn,f:Bt,m:Jt,u:Lt!=At.length||Jt&&Ht.length!=sn,compression:mn}),g+=30+Lt+on+xn,b+=76+2*(Lt+on)+(sn||0)+xn,--c||at()}};if(Lt>65535&&cn("filename too long",null),mn)if(It<16e4)try{cn(null,or(yt,_t))}catch(un){cn(un,null)}else rt.push(Tn(yt,_t,cn));else cn(null,yt)},pt=0;pt<et;++pt)ct(pt);return st}function GM(h,e){e||(e={});var i={},s=[];Uy(h,"",i,e);var o=0,c=0;for(var g in i){var b=i[g],et=b[0],tt=b[1],rt=tt.level==0?0:8,st=(Lt=Mp(g)).length,at=tt.comment,ct=at&&Mp(at),pt=ct&&ct.length,gt=nv(tt.extra);if(st>65535)throw"filename too long";var At=rt?or(et,tt):et,xt=At.length,yt=Q_();yt.p(et),s.push(Bm(tt,{size:et.length,crc:yt.d(),c:At,f:Lt,m:ct,u:st!=g.length||ct&&at.length!=pt,o,compression:rt})),o+=30+st+gt+xt,c+=76+2*(st+gt)+(pt||0)+xt}for(var _t=new xo(c+22),Mt=o,It=c-o,Bt=0;Bt<s.length;++Bt){var Lt=s[Bt];ao(_t,Lt.o,Lt,Lt.f,Lt.u,Lt.c.length);var Ht=30+Lt.f.length+nv(Lt.extra);_t.set(Lt.c,Lt.o+Ht),ao(_t,o,Lt,Lt.f,Lt.u,Lt.c.length,Lt.o,Lt.m),o+=16+Ht+(Lt.m?Lt.m.length:0)}return ls(_t,o,s.length,It,Mt),_t}var h2=function(){function h(){}return h.prototype.push=function(e,i){this.ondata(null,e,i)},h.compression=0,h}(),KD=function(){function h(){var e=this;this.i=new Mr(function(i,s){e.ondata(null,i,s)})}return h.prototype.push=function(e,i){try{this.i.push(e,i)}catch(s){this.ondata(s,e,i)}},h.compression=8,h}(),VS=function(){function h(e,i){var s=this;i<32e4?this.i=new Mr(function(o,c){s.ondata(null,o,c)}):(this.i=new as(function(o,c,g){s.ondata(o,c,g)}),this.terminate=this.i.terminate)}return h.prototype.push=function(e,i){this.i.terminate&&(e=Xu(e,0)),this.i.push(e,i)},h.compression=8,h}(),d2=function(){function h(e){this.onfile=e,this.k=[],this.o={0:h2},this.p=Iv}return h.prototype.push=function(e,i){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var o=Math.min(this.c,e.length),c=e.subarray(0,o);if(this.c-=o,this.d?this.d.push(c,!this.c):this.k[0].push(c),(e=e.subarray(o)).length)return this.push(e,i)}else{var g=0,b=0,et=void 0,tt=void 0;this.p.length?e.length?((tt=new xo(this.p.length+e.length)).set(this.p),tt.set(e,this.p.length)):tt=this.p:tt=e;for(var rt=tt.length,st=this.c,at=st&&this.d,ct=function(){var At,xt=su(tt,b);if(xt==67324752){g=1,et=b,pt.d=null,pt.c=0;var yt=Yu(tt,b+6),_t=Yu(tt,b+8),Mt=2048&yt,It=8&yt,Bt=Yu(tt,b+26),Lt=Yu(tt,b+28);if(rt>b+30+Bt+Lt){var Ht=[];pt.k.unshift(Ht),g=2;var Jt,sn=su(tt,b+18),on=su(tt,b+22),mn=X_(tt.subarray(b+30,b+=30+Bt),!Mt);sn==4294967295?(At=It?[-2]:u2(tt,b),sn=At[0],on=At[1]):It&&(sn=-1),b+=Lt,pt.c=sn;var cn={name:mn,compression:_t,start:function(){if(!cn.ondata)throw"no callback";if(sn){var un=s.o[_t];if(!un)throw"unknown compression type "+_t;(Jt=sn<0?new un(mn):new un(mn,sn,on)).ondata=function(Jn,Kn,gr){cn.ondata(Jn,Kn,gr)};for(var bn=0,xn=Ht;bn<xn.length;bn++){var Cn=xn[bn];Jt.push(Cn,!1)}s.k[0]==Ht&&s.c?s.d=Jt:Jt.push(Iv,!0)}else cn.ondata(null,Iv,!0)},terminate:function(){Jt&&Jt.terminate&&Jt.terminate()}};sn>=0&&(cn.size=sn,cn.originalSize=on),pt.onfile(cn)}return"break"}if(st){if(xt==134695760)return et=b+=12+(st==-2&&8),g=3,pt.c=0,"break";if(xt==33639248)return et=b-=4,g=3,pt.c=0,"break"}},pt=this;b<rt-4&&ct()!=="break";++b);if(this.p=Iv,st<0){var gt=g?tt.subarray(0,et-12-(st==-2&&8)-(su(tt,et-16)==134695760&&4)):tt.subarray(0,b);at?at.push(gt,!!g):this.k[+(g==2)].push(gt)}if(2&g)return this.push(tt.subarray(b),i);this.p=tt.subarray(b)}if(i){if(this.c)throw"invalid zip file";this.p=null}},h.prototype.register=function(e){this.o[e.compression]=e},h}();function q1(h,e){if(typeof e!="function")throw"no callback";for(var i=[],s=function(){for(var at=0;at<i.length;++at)i[at]()},o={},c=h.length-22;su(h,c)!=101010256;--c)if(!c||h.length-c>65558)return void e("invalid zip file",null);var g=Yu(h,c+8);g||e(null,{});var b=g,et=su(h,c+16),tt=et==4294967295;if(tt){if(c=su(h,c-12),su(h,c)!=101075792)return void e("invalid zip file",null);b=g=su(h,c+32),et=su(h,c+48)}for(var rt=function(at){var ct=VM(h,et,tt),pt=ct[0],gt=ct[1],At=ct[2],xt=ct[3],yt=ct[4],_t=ct[5],Mt=W1(h,_t);et=yt;var It=function(Lt,Ht){Lt?(s(),e(Lt,null)):(o[xt]=Ht,--g||e(null,o))};if(pt)if(pt==8){var Bt=h.subarray(Mt,Mt+gt);if(gt<32e4)try{It(null,Wo(Bt,new xo(At)))}catch(Lt){It(Lt,null)}else i.push(Gs(Bt,{size:At},It))}else It("unknown compression type "+pt,null);else It(null,Xu(h,Mt,Mt+gt))},st=0;st<b;++st)rt();return s}function $A(h){for(var e={},i=h.length-22;su(h,i)!=101010256;--i)if(!i||h.length-i>65558)throw"invalid zip file";var s=Yu(h,i+8);if(!s)return{};var o=su(h,i+16),c=o==4294967295;if(c){if(i=su(h,i-12),su(h,i)!=101075792)throw"invalid zip file";s=su(h,i+32),o=su(h,i+48)}for(var g=0;g<s;++g){var b=VM(h,o,c),et=b[0],tt=b[1],rt=b[2],st=b[3],at=b[4],ct=b[5],pt=W1(h,ct);if(o=at,et){if(et!=8)throw"unknown compression type "+et;e[st]=Wo(h.subarray(pt,pt+tt),new xo(rt))}else e[st]=Xu(h,pt,pt+tt)}return e}class GS extends _.hH6{load(e,i,s,o){return this.setResponseType("arraybuffer"),super.load(e,c=>{const g=$A(new Uint8Array(c)),b=new Map(Object.entries(g).map(([et,tt])=>[et,new File([tt],et)]));i==null||i(b)},s,o)}}class HS extends _e.SimpleEventDispatcher{get cachedAssets(){return this._cachedAssets}get processors(){return this._processors}get loadingManager(){return this._loadingManager}constructor(e,i=!1){super(),this._processors=new $m,this._logger=console.log,this.Importers=[new yl(Al,["json"],!1),new yl(_.hH6,["txt"],!1),new yl(xv,["rgbe.png","hdr.png","hdrpng"],!1),new yl(_.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new yl(Iy,["cube"],!1),new yl(GS,["zip"],!0)],this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],i||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new _.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),this.Importers.push(a_(e)),this.Importers.push(w0(e)),this.Importers.push(S0())}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,i,s){this.dispatchEvent({type:"onProgress",url:e,loaded:i,total:s})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,i,s){this.dispatchEvent({type:"onStart",url:e,loaded:i,total:s})}_urlModifier(e){var c;let i=decodeURI(e);const s=(c=this._rootContext)==null?void 0:c.rootUrl;i.includes("://")||!s||i.startsWith(s)||(i=s+i),i=i.replace("./",""),i=i.replace(/^(\/\/)/,"/"),i=i.replace(/\?.*$/,"");const o=this._fileDatabase.get(i);return o?o.ext?(o.objectUrl||(o.objectUrl=URL.createObjectURL(o)+"#"+i),o.objectUrl):(console.error("Unable to determine file extension",o),e):e}_createLoader(e){const i=this._getImporter(e),s=i==null?void 0:i.ctor(this);return s&&(i==null||i.ext.forEach(o=>{const c=new RegExp(o.startsWith("data:")?"^"+o+"\\/":"\\."+o+"$","i");this._loadingManager.addHandler(c,s)})),s&&(this._loaderCache.push({loader:s,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:s})),s}addEventListener(e,i){if(super.addEventListener(e,i),e==="loaderCreate")for(const s of this._loaderCache)this.dispatchEvent({type:"loaderCreate",loader:s.loader})}async importFiles(e,i={}){const s=new Map;let{allowedExtensions:o}=i;if(o&&o.length<1&&(o=void 0),e.size===0)return s;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const c=[],g=[];if(e.forEach((b,et)=>{this.registerFile(et,b);const tt=b.ext;tt&&((o==null?void 0:o.includes(tt.toLowerCase()))??1)&&(this._isRootFileExtension(tt)?c.push(et):g.push(et))}),c.length>0)for(const b of c){let et=await this._importFile(b,void 0,i);et&&(et=await this.processImported(et,i)),s.set(b,et)}else for(const b of g){let et=await this._importFile(b,void 0,i);et&&(et=await this.processImported(et,i)),s.set(b,et)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((b,et)=>{this.unregisterFile(et)}),s}registerFile(e,i){var c;e=e.replace(/\?.*$/,"");const s=(i==null?void 0:i.ext)??((c=(0,_e.parseFileExtension)((i==null?void 0:i.name)??e))==null?void 0:c.toLowerCase());i&&(i.ext||(i.ext=s),this._fileDatabase.set(e,i));let o=this._getLoader(e);if(o||(o=this._createLoader(i??{name:e,ext:s})),o){for(const g of this._loaderCache)if(g.loader===o){g.files.push(e);break}}return o}unregisterFile(e){e=e.replace(/\?.*$/,"");const i=this._fileDatabase.get(e);i!=null&&i.objectUrl&&(URL.revokeObjectURL(i.objectUrl),i.objectUrl=void 0),i&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return this.Importers.find(i=>i.root&&i.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,i,s={},o){var g;if(i!=null&&i.__imported)return i.__imported;let c;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,i);const b=this.resolveURL(e),et=e.replace(/\?.*$/,""),tt=s.fileHandler??(await this._loadingManager.getHandler(et)||(i?await this._loadingManager.getHandler(i.name||i.ext||""):void 0));if(!tt)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:b,rootUrl:_.Zp0.extractUrlBase(e),baseUrl:_.Zp0.extractUrlBase(b)},c=await tt.loadAsync(e+(s.queryString?(e.includes("?")?"&":"?")+s.queryString:""),rt=>{o&&o(rt),this.dispatchEvent({type:"importFile",path:e,state:"downloading",loadedBytes:rt.loaded||void 0,totalBytes:rt.total||void 0,progress:rt.total>0?rt.loaded/rt.total:1})}),tt.transform&&(c=await tt.transform(c,s)),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),i?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),i&&this.unregisterFile(e)}catch(b){return console.error("AssetImporter: Unable to import file",e,i),console.error(b),console.error(b==null?void 0:b.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:b}),i&&this.unregisterFile(e),[]}if(this.dispatchEvent({type:"importFile",path:e,state:"done"}),i){i.__imported=c;let b=[];Array.isArray(c)?b=c:(g=c.userData)!=null&&g.rootSceneModelRoot?b.push(...c.children):b.push(c),b.forEach(et=>{var tt;(tt=et.addEventListener)==null||tt.call(et,"dispose",()=>{i.__imported=void 0})})}if(c&&typeof c=="object"){c.__rootPath=e;const b=i||this._fileDatabase.get(e);b&&(c.__rootBlob=b)}return c}_getImporter(e,i=!1){return this.Importers.find(s=>{if(i&&!s.root)return!1;const o=s.ext.find(c=>{var g,b,et;return e.ext&&c===e.ext.toLowerCase()||((b=(g=e.name)==null?void 0:g.toLowerCase())==null?void 0:b.endsWith("."+c.toLowerCase()))||(c==null?void 0:c.startsWith("data:"))&&((et=e.name)==null?void 0:et.startsWith(c))});return!!o&&(e.ext=o,!0)})}_getLoader(e){return this._loadingManager.getHandler(e)??void 0}async importAsset(e,i={},s){var g,b,et;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const rt=this._cachedAssets.find(st=>st.path===e.path);rt&&Object.assign(e,rt)}const tt=this._cachedAssets.findIndex(rt=>rt.path===e.path);tt>=0&&this._cachedAssets.splice(tt,1),this._cachedAssets.push(e)}let o;if(e!=null&&e.preImported&&(o=await e.preImported),!i.forceImport&&o){const tt=await this.processImported(o,i);let rt=!1;for(const st of tt){if((g=st.userData)!=null&&g.rootSceneModelRoot&&[...st.children,...st.__processedChildren||[]].find(at=>at.__disposed)){rt=!0;break}if(st.__disposed){rt=!0;break}}if(!rt||i.reimportDisposed===!1)return tt}const c=i.pathOverride||e.path;if(e.preImported=this._importFile(c,typeof((b=e.file)==null?void 0:b.arrayBuffer)=="function"?e.file:void 0,i,s),o=await e.preImported,o&&(this.dispatchEvent({type:"processFileStart",path:c,result:o}),o=await this.processImported(o,i),this.dispatchEvent({type:"processFileEnd",path:c,result:o})),o){const tt=[];Array.isArray(o)?tt.push(...o):(et=o.userData)!=null&&et.rootSceneModelRoot?tt.push(...o.children):tt.push(o),tt.forEach(rt=>{var st;return(st=rt.addEventListener)==null?void 0:st.call(rt,"dispose",()=>{e!=null&&e.preImported&&(e.preImported=void 0)})})}return o}async importSingle(e,i={}){var s;return typeof e=="string"?await this.importSinglePath(e,i):(s=await this.importAsset(e,i))==null?void 0:s[0]}async importSinglePath(e,i){var s;return(s=await this.importPath(e,i))==null?void 0:s[0]}async importPath(e,i={}){const s={...i};delete s.pathOverride,delete s.forceImport,delete s.reimportDisposed,delete s.fileHandler,delete s.importedFile;const o=JSON.stringify(s);let c;return c=this._cachedAssets.find(g=>g.path===e&&g._options===o)||{path:e},c._options=o,i.importedFile&&(c.file=i.importedFile),await this.importAsset(c,i)}async processImportedSingle(e,i={}){return(await this.processImported(e,i))[0]}async processImported(e,i={}){var g,b,et,tt,rt,st,at,ct;let s=e;if(!s)return[];if(i.processImported===!1)return[s];if(Array.isArray(s)){const pt=[];for(const gt of s)pt.push(...await this.processImported(gt,i));return pt}if((g=s.userData)!=null&&g.rootSceneModelRoot){if(i._rootSceneImported=!0,s.__processedChildren&&!i.forceImporterReprocess)return s.__processedChildren;if(!(s.children.length<1))return s.animations&&(s.children[0].animations||(s.children[0].animations=[]),s.children[0].animations.push(...s.animations)),s.__importedViewerConfig&&(s.children[0].__importedViewerConfig=s.__importedViewerConfig),s.userData.__importData&&(s.children[0].userData.__importData=s.userData.__importData),s.__processedChildren=await this.processImported([...s.children],i),s.__processedChildren;if(((b=s.animations)==null?void 0:b.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",s.animations),!s.__importedViewerConfig)return[];s=s.__importedViewerConfig}if((et=s.userData)!=null&&et.iModel&&(s=s.userData.iModel),(tt=s.userData)!=null&&tt.iMaterial&&(s=s.userData.iMaterial),s.assetImporterProcessed&&!i.forceImporterReprocess)return[s];const o=s.__rootPath,c=s.__rootBlob;if(!s.assetType){if(s.isBufferGeometry&&(s=new _.Kj0(s,new _.Wid)),s.isObject3D)if(s.isLight)s=ZA(s);else{const pt=[];s.traverse(gt=>{gt!==s&&gt.isLight&&pt.push(gt)});for(const gt of pt)ZA(gt);s=new wy(s,i)}s.isTexture&&(s.assetType="texture",i._testDataTextureComplete&&(s.isDataTexture&&((rt=s.image)!=null&&rt.data)&&(s.image.complete=!0),(st=s.image)!=null&&st.complete&&(s.needsUpdate=!0)),i.generateMipmaps!==void 0&&(s.generateMipmaps=i.generateMipmaps),s.generateMipmaps||s.isRenderTargetTexture||(s.minFilter=s.minFilter===_.D1R?_.wem:s.minFilter,s.magFilter=s.magFilter===_.D1R?_.wem:s.magFilter)),s.isMaterial&&(s.assetType="material")}if(s.assetType!=null)return s.userData&&(s.userData.rootPath||!o||o.startsWith("blob:")||o.startsWith("/")||(s.userData.rootPath=o),c&&(s.userData.__sourceBlob=c,s.userData.__needsSourceBuffer&&(s.userData.__sourceBuffer=await c.arrayBuffer(),delete s.userData.__needsSourceBuffer))),s=await this._processors.process(s.assetType,s,{}),s.assetImporterProcessed=!0,[s];if(s instanceof Map)return[...(await this.importFiles(s,i)).values()].flat();if(s.type&&s.type!=="ViewerApp"&&s.type!=="ThreeViewer"){const pt=this._viewer.getPluginByType(s.type);if(pt){let gt=s._importedResources||{};return s.resources&&(gt=await((at=this._viewer.getManager())==null?void 0:at.importConfigResources(s.resources)),delete s.resources,s._importedResources=gt),typeof pt.fromJSON=="function"&&(await Promise.resolve(pt.fromJSON(s,gt)),s.assetImporterProcessed=!1),[]}}return s.plugins||s.type==="ViewerApp"||s.type==="ThreeViewer"?(s.resources=await((ct=this._viewer.getManager())==null?void 0:ct.importConfigResources(s.resources)),await this._viewer.getManager().importViewerConfig(s),s.assetImporterProcessed=!1,[]):(console.warn("unknown/null asset type: ",s,s.plugins),[s])}dispose(){var e;this.clearCache(),(e=this._processors)==null||e.dispose()}clearLoaderCache(){this._loaderCache.forEach(e=>{e.loader.dispose&&e.loader.dispose()}),this._loaderCache=[]}clearCache(){this.clearLoaderCache(),this._cachedAssets=[]}}function B0(h){if(!h)return _.ywz;const e=h.extensions.has("EXT_color_buffer_half_float")||h.capabilities.isWebGL2&&h.extensions.has("EXT_color_buffer_float"),i=h.capabilities.isWebGL2||h.extensions.has("OES_texture_float")||h.extensions.has("WEBGL_color_buffer_float");return e?_.cLu:i?_.VzW:_.ywz}function ZA(h){var i,s;if(!h.isLight||h.assetType==="light")return h;if(h.uiConfig)return console.warn("ui config already exists, not supported",h),h;let e;if(h.children.length,h.isDirectionalLight&&(e=new _g),h.isAmbientLight&&(e=new WA),h.isSpotLight&&(e=new QA),h.isPointLight&&(e=new Ty),e){(s=(i=e.lightObject).copy)==null||s.call(i,h);const o=h.parent;o!=null&&o.isObject3D&&(o.remove(h),h.dispose(),h.userData.iModel=e,o.add(e.lightObject),e.uuid=h.uuid),Em(e.lightObject,o)}else console.warn("unknown light type: ",h);return e}class HM extends _.u7G{constructor(e){super(e)}async loadAsync(e,i){var c;const s=new _.hH6(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,i);try{const g=JSON.parse(o);if(g.images&&this.importer){const b={};let et=g.images;Array.isArray(et)||(et=Object.values(et));for(const tt of g.images){if(!tt.url||!tt.uuid)continue;const rt=(c=await this.importer.importPath(tt.url,{processImported:!1}))==null?void 0:c[0],st=rt==null?void 0:rt.source;if(!rt||!st)continue;const at=new _.Hw6(st.data);at.uuid=tt.uuid,b[at.uuid]=at,rt.dispose()}return await rp.LoadRootPathTextures(g.textures,b||g.images,this.importer),this.parse(g,b)}return this.parse(g)}catch(g){throw console.error(g),this.manager.itemError(e),g}}parse(e,i){var et;let s;const o={p:new Promise(tt=>{s=tt})};if(e.images||e.textures){const tt=new rp(this.manager);let rt={};const st=gt=>{s(),o.p=void 0,Object.values(rt).forEach(At=>{var xt;At.isTexture&&((xt=At.image)!=null&&xt.complete)&&(At.needsUpdate=!0)})};let at=e.images||[];Array.isArray(at)||(at=Object.values(at));const ct=i||tt.parseImages(at,st);let pt=e.textures;Array.isArray(pt)||(pt=Object.values(pt)),rt=tt.parseTextures2(pt,ct,st),this.setTextures(rt)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const c={...e};if(Object.entries(c).forEach(([tt,rt])=>{rt&&typeof rt=="string"&&this.textures[rt]&&(c[tt]=this.textures[rt])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?c.vertexColors=e.vertexColors>0:c.vertexColors=e.vertexColors),e.normalScale!==void 0){const tt=e.normalScale;Array.isArray(tt)===!1&&(c.normalScale=[tt,tt])}let g=e.type;g!=="MeshPhysicalMaterial"&&g!=="MeshStandardMaterial"&&g!=="PhysicalMaterial"||(g=Qu.TYPE),c.userData=Oo(c.userData,void 0,!1,this);const b=((et=this.materials)==null?void 0:et.generateFromTemplateType(g,c))??super.parse(e);return this.setTextures({}),b.userData.imageLoadAwaiter=o,b}}class Lr extends _e.SimpleEventDispatcher{constructor(e,i,{simpleCache:s=!1,storage:o}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(s||o)&&(s&&(_.CtF.enabled=!0),o&&window.Cache&&typeof window.Cache=="function"&&o instanceof window.Cache)){const c={..._.CtF};_.CtF.get=(g,b,et)=>b?g.startsWith("data:")||g.startsWith("blob")||g.startsWith("chrome-extension")?Promise.resolve(void 0):o.match(g).then(tt=>{if(tt)switch(b){case"arraybuffer":return tt.arrayBuffer();case"blob":return tt.blob();case"document":return tt.text().then(rt=>new DOMParser().parseFromString(rt,et??"text/html"));case"json":return tt.json();default:if(et===void 0)return tt.text();{const rt=/charset="?([^;"\s]*)"?/i.exec(et),st=rt&&rt[1]?rt[1].toLowerCase():void 0,at=new TextDecoder(st);return tt.arrayBuffer().then(ct=>at.decode(ct))}}}):c.get(g),_.CtF.add=async(g,b,et)=>{if(!et)return c.add(g,b);g.startsWith("data:")||g.startsWith("blob")||g.startsWith("chrome-extension")||(await o.match(g)&&await o.delete(g),await o.put(g,new Response(b,{status:200})))},_.CtF.remove=(g,b)=>{if(!b)return c.remove(g);o.delete(g)}}this.storage=o,this._importer=e,this._materials=i}async addAsset(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importAsset(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}async addFromPath(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importPath(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}addProcessedAssets(e,i){return e.map(s=>{var o;return(o=this._viewer)==null?void 0:o.scene.addSceneObject(s,i)})}async addAssetSingle(e,i={}){var s;return e?(s=await(typeof e=="string"?this.addFromPath:this.addAsset).call(this,e,i))==null?void 0:s[0]:void 0}async addImported(e,i={}){var s;return(s=this._importer)==null?void 0:s.processImported(e,i).then(o=>(this.addProcessedAssets(o,i),o))}async addImportedSingle(e,i={}){return this.addImported(e,i).then(s=>s==null?void 0:s[0])}_sceneUpdated(e){var i;if(e.type==="addSceneObject"){const s=e.object;s.assetType==="material"&&((i=this._materials)==null||i.processMaterial(s,{}))}else console.error("Unexpected")}onAdded(e){this._viewer=e,this._materials||(this._materials=new _0,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new HS(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(s,o)=>(FA(s,c=>{var g;return(g=this._materials)==null?void 0:g.processModel(c,{recursive:!1})}),s)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(s,o)=>{var c;return(c=this.materials)!=null&&c.findMaterial(s.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),s.uuid=Pn(),s.userData.uuid&&(s.userData.uuid=s.uuid)),this._materials.processMaterial(s,o)}})),this._importer.Importers.push(new yl(HM,[Qu.TypeSlug],!1,s=>(s&&(s.materials=this._materials),s&&(s.importer=this._importer),s)));const i=this.importViewerConfig.bind(this);this._importer.Importers.push(new yl(class extends Al{async loadAsync(s,o){return i(await super.loadAsync(s,o))}},[Lr.ViewerTypeSlug],!0))}onRemove(e){var i,s;e===this._viewer&&((i=this._importer)==null||i.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(s=this._materials)==null||s.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,i;return(i=(e=this._viewer)==null?void 0:e.getPluginByType("AssetExporterPlugin"))==null?void 0:i.exporter}get materials(){return this._materials}exportViewerConfig(e=!0,i){if(!this._viewer)return{};const s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...i},o=this._viewer.toJSON(s);return e||Object.values(s).forEach(c=>{c&&Object.values(c).forEach(g=>{g.url&&(g.url.data instanceof ArrayBuffer||Array.isArray(g.url.data))&&(g.url.type==="Uint16Array"?(g.url.data instanceof Uint16Array||(g.url.data=new Uint16Array(g.url.data)),g.url.data="data:application/octet-stream;base64,"+(0,_e.arrayBufferToBase64)(g.url.data.buffer)):g.url.type==="Uint8Array"?(g.url.data instanceof Uint8Array||(g.url.data=new Uint8Array(g.url.data)),g.url.data="data:application/octet-stream;base64,"+(0,_e.arrayBufferToBase64)(g.url.data.buffer)):g.url.data instanceof ArrayBuffer?g.url.data="data:application/octet-stream;base64,"+(0,_e.arrayBufferToBase64)(g.url.data.buffer):console.warn("Unsupported buffer type",g.url.type))})}),o.resources=s,o}exportPluginPresets(e){var s;const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:(s=this._viewer)==null?void 0:s.serializePlugins(i,e),resources:i}}exportPluginPreset(e){if(!e.toJSON)return;const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}},s=e.toJSON(i);return s.resources=i,s}async importPluginPreset(e,i){var g;const s=e.type;if(!(i=i||((g=this._viewer)==null?void 0:g.getPluginByType(s))))return void console.warn(`No plugin found for type ${s} to import preset`);if(!i.fromJSON)return void console.warn(`Plugin ${s} does not support importing presets`);const o=e.resources||{};e.resources&&delete e.resources;const c=await this.importConfigResources(o);return await i.fromJSON(e,c),c&&(e.resources=c),i}async importViewerConfig(e,i){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const s=await this.importConfigResources(e.resources||{},i);this.applyViewerConfig(e,s)}applyViewerConfig(e,i){var s;if(this._viewer&&this._importer)if((i=i||e.resources).__isLoadedResources){this._viewer.fromJSON(e,i);for(const o of Object.values(i.materials))o.__useCount?delete o.__useCount:(s=this._materials)==null||s.unregisterMaterial(o);for(const o of Object.values(i.textures))o.__useCount&&delete o.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,i,s){var g,b,et;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const o={};Object.values(e).forEach(tt=>{tt&&Object.values(tt).forEach(rt=>{if(!rt||!rt.url||typeof rt.url.data!="string")return;const st=rt.url.data.match(/^data:.*;base64,(.*)$/);st!=null&&st[1]?rt.url.data=(0,_e.base64ToArrayBuffer)(st==null?void 0:st[1]):(rt.url.type!=="Uint8Array"&&console.error("Unsupported buffer type string for ",rt.url.type,"use base64"),rt.url.data=new TextEncoder().encode(rt.url.data).buffer)})}),i=i??new rp(this._importer.loadingManager),o.animations=e.animations?i.parseAnimations(e.animations):{},s&&s.animations&&(o.animations={...o.animations,...s.animations}),o.shapes=e.shapes?i.parseShapes(e.shapes):{},s&&s.shapes&&(o.shapes={...o.shapes,...s.shapes}),o.geometries=e.geometries?i.parseGeometries(e.geometries,o.shapes):{},s&&s.geometries&&(o.geometries={...o.geometries,...s.geometries}),o.images=e.images?await i.parseImagesAsync(Object.values(e.images)):{},s&&s.images&&(o.images={...o.images,...s.images}),await rp.LoadRootPathTextures(e.textures,o.images,this._importer),o.textures=e.textures?i.parseTextures2(Object.values(e.textures),o.images,()=>{Object.values(o.textures).forEach(tt=>{var rt;tt.isTexture&&((rt=tt.image)!=null&&rt.complete)&&(tt.needsUpdate=!0)})}):{};for(const tt of Object.entries(o.textures))tt[1]=(g=await this._importer.processImported(tt[1],{}))==null?void 0:g[0],tt[1]?o.textures[tt[0]]=tt[1]:delete o.textures[tt[0]];s&&s.textures&&(o.textures={...o.textures,...s.textures});const c=e.materials?Object.values(e.materials):[];for(const tt of c)Object.entries(tt).forEach(([rt,st])=>{st&&st.resource&&st.uuid&&st.resource==="textures"&&(tt[rt]=st.uuid)});if(o.materials=i.parseMaterials2(c,o.textures,this._materials),s&&s.materials&&(o.materials={...o.materials,...s.materials}),e.object&&(o.object=i.parseObject(e.object,o.geometries,o.materials,o.textures,o.animations),e.skeletons&&(o.skeletons=i.parseSkeletons(e.skeletons,o.object),i.bindSkeletons(o.object,o.skeletons))),e.extras){o.extras=e.extras;for(const tt of Object.values(e.extras))if(tt.uuid&&tt.url)if(typeof tt.url=="string"){const rt=await((b=this._importer)==null?void 0:b.importPath(tt.url));(rt==null?void 0:rt.length)>0&&(o.extras[tt.uuid]=rt[0])}else if(tt.url.data){const rt=new File([(0,_e.getTypedArray)(tt.url.type,tt.url.data)],tt.url.path),st=await((et=this._importer)==null?void 0:et.importAsset({path:rt.name,file:rt}));(st==null?void 0:st.length)>0&&(o.extras[tt.uuid]=st[0])}else console.warn("invalid URL type while loading extra resource")}return s&&s.extras&&(o.extras={...o.extras,...s.extras}),o.__isLoadedResources=!0,o}}Lr.PluginType="AssetManager",Lr.ViewerTypeSlug="vjson";class QM{get inputEl(){return this._inputEl}get el(){return this._el}constructor(e,i,s){this._el=e,this._inputEl=i,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),i==null||i.addEventListener("change",this._onSelect),s&&Object.entries(s).forEach(([o,c])=>c&&this.on(o,c))}on(e,i){return this._listeners[e].push(i),this}_emit(e,i){return this._listeners[e].forEach(s=>s(i)),this}destroy(){const e=this._el,i=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),i==null||i.removeEventListener("change",this._onSelect)}_onDrop(e){var o,c;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const i=Array.from(((o=e.dataTransfer)==null?void 0:o.files)||[]),s=Array.from(((c=e.dataTransfer)==null?void 0:c.items)||[]);if(i.length!==0||s.length!==0)if(s.length>0){const g=s.map(b=>b.webkitGetAsEntry());this._loadNextEntry(new Map,g)}else this._emit("drop",{files:new Map(i.map(g=>(g.filePath=g.name,[g.filePath,g])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const i=[].slice.call(this._inputEl.files??new FileList),s=new Map;i.forEach(o=>{o.filePath=o.webkitRelativePath||o.name,s.set(o.filePath,o)}),this._emit("drop",{files:s})}_loadNextEntry(e,i){const s=i.pop();if(s)if(s.isFile)s.file(o=>{o.filePath=s.fullPath,e.set(s.fullPath,o),this._loadNextEntry(e,i)},()=>console.error("Could not load file: %s",s.fullPath));else if(s.isDirectory){const o=s.createReader(),c=g=>{g.length?(i=i.concat(g),o.readEntries(c)):this._loadNextEntry(e,i)};o.readEntries(c)}else console.warn("Unknown asset type: "+s.fullPath),this._loadNextEntry(e,i);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class Y_ extends _e.SimpleEventDispatcher{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new _.Pa4(.5,.5,3)},this.dependencies=[Lr],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]},{label:"Select local file",type:"button",value:()=>this.promptForFile()}]}}onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new QM(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var c,g,b;if(!e)return;const i=this._viewer;if(!i)return;if(this._allowedExtensions!==void 0)for(const et of e.keys())this._allowedExtensions.includes(((c=et.split(".").pop())==null?void 0:c.toLowerCase())??"")||e.delete(et);if(e.size<1)return;const s=i.getPlugin(Lr),o={type:"drop",files:e};if(this.importerParams.autoImport){const et={allowedExtensions:this.allowedExtensions,...this.importerParams};if(o.imported=await((g=s.importer)==null?void 0:g.importFiles(e,et)),this.importerParams.autoAdd){const tt=[...((b=o.imported)==null?void 0:b.values())??[]].flat(2).filter(rt=>!!rt)??[];if(o.assets=s.addProcessedAssets(tt,{...this.importerParams}),!et._rootSceneImported)for(const rt of o.assets)rt.modelObject&&rt.modelObject.dispatchEvent({type:"select",value:rt.modelObject})}}this.dispatchEvent(o)}promptForFile(){var e;(e=this._inputEl)==null||e.click()}onRemove(e){var i;(i=this._dropzone)==null||i.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(i=>"."+i).join(", "):"")}}Y_.PluginType="Dropzone";var QS=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};function _b(h){return Object.getPrototypeOf(h).constructor.PluginType}class iv extends _e.SimpleEventDispatcher{get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}constructor({isAntialiased:e=!1,useRgbm:i=!0,useGBufferDepth:s=!0,screenShader:o="",...c}){super(),this.console=console,this._state=$.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(st=>this.resize()):void 0,this._lastSize=new _.FM8,this._onContextRestore=st=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=st=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this._sceneEnvironmentChanged=()=>{this._rawBackground===WS&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=st=>{var pt;if(!st||!st.object)return;const at=st.object.__importedViewerConfig||((pt=st.object.modelObject)==null?void 0:pt.__importedViewerConfig);if(!at)return;const ct=this.getManager();ct?ct.applyViewerConfig(at,at.resources):this.fromJSON(at,at.resources)},this.alert=async st=>alert(st),this.confirm=async st=>confirm(st),this.prompt=async(st,at,ct=!0)=>prompt(st,at),this._useRgbm=i,this._useGBufferDepth=s,this._screenShader=o,this._canvas=c.canvas||(0,_e.createCanvasElement)();let g=c.container;if(g&&!c.canvas&&g.appendChild(this._canvas),g||(g=this._canvas.parentElement??void 0),!g)throw new Error("No container.");this._container=g,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){var gt;const st=window.location.href,at="https://dev-sandbox.pixotronics.com/webgi/";if(!st.startsWith(at)||(0,_e.getUrlQueryParam)("noUpdate")!==null)return!0;const ct=(gt=st.match(/\/webgi\/([0-9.a-zA-Z-]+)/))==null?void 0:gt[1],pt=(await(await fetch(at+"version.txt")).text()).split(`
`)[0];if(ct&&ct!==pt){if(confirm(`New version ${pt} is available, do you want to open?`)){const At=window.location.href.replace(ct,pt);return window.location.href=At,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const b=new hu(void 0,void 0,this._canvas);b.autoLookAtTarget=!0,this.addEventListener("postFrame",()=>{var at,ct;const st=tt.scene.activeCamera;if(st&&st.interactionsEnabled){const pt=(at=this.getPluginByType("Progressive"))==null?void 0:at.postFrameConvergedRecordingDelta();if(pt!==void 0&&pt===0)return;(ct=st.controls)==null||ct.update()}}),this.scene=new Nl(b),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new Av({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,colorSpace:i?cr:_.aCh,type:i?_.ywz:_.cLu,depthBuffer:!s,generateMipmaps:!!e,minFilter:e?_.FDw:_.wem}}),this._isAntialiased=e&&this._renderer.isWebGL2;let et=!0;this._renderer.rendererObject.userData||(et=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!et;const tt=this;this.renderFilter={passId:"render",passObject:new LA(this,et),update(){const st=this.passObject;st.scene=tt.scene.modelObject,st.camera=tt.scene.renderCamera.cameraObject}};const rt={passId:"screen",after:["render"],required:["render"],passObject:JD(o)};[this.renderFilter,rt].forEach(st=>this._renderer.registerPass(st)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("textureUpdate",st=>this.setDirty(this.scene,st)),this.scene.addEventListener("sceneMaterialUpdate",st=>this.setDirty(this.scene,st)),this.scene.addEventListener("sceneUpdate",st=>{this.setDirty(this.scene,st),st.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",st=>this.setDirty(this.scene,st)),this._renderer.addEventListener("update",st=>this.setDirty(this._renderer,st)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.scene.setBackgroundColor("#ffffff"),c.assetManager&&this.addPluginSync(new Lr(void 0,void 0,typeof c.assetManager=="boolean"?{}:c.assetManager)),c.dropzone&&this.addPluginSync(new Y_),this.console.log("WebGi Viewer instance initialized, version: ",iv.VERSION)}setDirty(e,i){this._needsReset=!0,e=e??this,this.dispatchEvent({...i??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;for(const i of[...Object.values(this.plugins)])this.removePlugin(i,!0);this.scene.dispose(),this.renderer.dispose(),this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)==null||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_renderEnabledChanged(){this.dispatchEvent({type:this.renderEnabled?"renderEnabled":"renderDisabled"})}_animationLoop({time:e,deltaTime:i,xrFrame:s}){var o,c;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let g=0;g<this.maxFramePerLoop;g++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const tt=[this._canvas.clientWidth,this._canvas.clientHeight];if(s){const rt=(c=(o=this._renderer.rendererObject.xr.getCamera())==null?void 0:o.cameras[0])==null?void 0:c.viewport;rt?(rt.x===0&&rt.y===0||this.console.warn("x and y must be 0?"),tt[0]=rt.width,tt[1]=rt.height,this.console.log("resize for xr",tt)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...tt),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:i,xrFrame:s});const b=Object.values(this.plugins).filter(tt=>tt.dirty);b.length>0&&this.setDirty(b),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const et=this._renderer.dirty;if(et){this.dispatchEvent({type:"preRender",target:this});try{this.scene.renderCamera=this.scene.activeCamera,this._renderer.render(!0)}catch(tt){this.console.error(tt),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!et)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return typeof e=="string"?this.getPluginByType(e):this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async getOrAddPlugin(e,...i){return this.getPlugin(e)||this.addPlugin(e,...i)}getOrAddPluginSync(e,...i){return this.getPlugin(e)||this.addPluginSync(e,...i)}async addPlugin(e,...i){let s;if(e.prototype){const c=this.getPlugin(e);if(c)return console.error(`Plugin of type ${_b(c)} already exists, no new plugin created`,c),c;s=new e(...i)}else s=e;const o=_b(s);if(!o)return this.console.error("PluginType is not defined for",s),s;for(const c of s.dependencies||[])await this.getOrAddPlugin(c);return this.plugins[o]&&(this.console.error(`Plugin of type ${o} already exists, old plugin will be removed and disposed`,this.plugins[o],s),await this.removePlugin(this.plugins[o],!0)),this.plugins[o]=s,await s.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:s}),this.setDirty(s),s}addPluginSync(e,...i){let s;if(e.prototype){const c=this.getPlugin(e);if(c)return console.error(`Plugin of type ${_b(c)} already exists, no new plugin created`,c),c;s=new e(...i)}else s=e;const o=_b(s);if(!o)return this.console.error("PluginType is not defined for",s),s;for(const c of s.dependencies||[])this.getOrAddPluginSync(c);return this.plugins[o]&&(this.console.error(`Plugin of type ${o} already exists, old plugin will be removed and disposed`,this.plugins[o],s),this.removePluginSync(this.plugins[o],!0)),this.plugins[o]=s,s.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:s}),this.setDirty(s),s}async addPlugins(e){for(const i of e)await this.addPlugin(i)}async addPluginsSync(e){for(const i of e)this.addPluginSync(i)}async removePlugin(e,i=!0){const s=_b(e);this.plugins[s]&&(await e.onRemove(this),delete this.plugins[s],i&&e.onDispose&&await e.onDispose(this),this.setDirty(e))}removePluginSync(e,i=!0){const s=_b(e);this.plugins[s]&&(e.onRemove(this),delete this.plugins[s],i&&e.onDispose&&e.onDispose(this),this.setDirty(e))}createCamera(e){const i=e.userData.iCamera??new hu(e,{controlsMode:"",aspect:"auto"},this._canvas);return e.userData.autoLookAtTarget===void 0?(i.autoLookAtTarget=!1,e.userData.autoLookAtTarget=!1):i.autoLookAtTarget=e.userData.autoLookAtTarget,i}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}async doOnce(e,i){return new Promise(s=>{const o=async(...c)=>{this.removeEventListener(e,o),s(await(i==null?void 0:i(...c)))};this.addEventListener(e,o)})}setBackgroundColor(e){return console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackgroundColor instead."),this.setBackgroundColor(e)}setBackground(e){if(console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackground instead."),this._rawBackground=e,e==null||typeof e!="string"&&typeof e!="number"&&!e.isColor)!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode");else if(e===WS)return this.scene.setBackground("environment");!e||e!=null&&e.isTexture?(this.scene.setBackground(e),e||this.scene.setBackgroundColor(e)):this.scene.setBackgroundColor(e)}getBackground(e=!1){if(console.warn("viewer.getBackground is deprecated, use viewer.scene.background instead."),e)return this._rawBackground;let i=this._rawBackground??this.scene.getBackground();return i?(i!=null&&i.isVector4&&(i=PS(i,7).getHexString()),i!=null&&i.isColor?i.getHexString():this._rawBackground===WS?this.scene.getEnvironment():i):null}getManager(){return this.getPluginByType("AssetManager")||this.addPluginSync(Lr)}resetCamera({rootObject:e,centerOffset:i=new _.Pa4(1,1,1),targetOffset:s=new _.Pa4(0,0,0),...o}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const c=e?new Xt().expandByObject(e,!0,!0):this.scene.getBounds(!0),g=c.getCenter(new _.Pa4),b=.5*c.getSize(new _.Pa4).length();g.add(s.clone().multiplyScalar(b)),this.scene.activeCamera.position=new _.Pa4(g.x+i.x*b,g.y+i.y*b,g.z+i.z*b),this.scene.activeCamera.target=g,this.setDirty()}}async fitToView(e,i=1.5,s,o){var g;const c=this.getPluginByType("CameraViews");c?await(c==null?void 0:c.animateToFitObject(e,i,s,o,{min:(((g=this.scene.activeCamera.getControls())==null?void 0:g.minDistance)??.5)+.5,max:1e3})):this.console.error("CameraViews plugin is required for fitToView to work")}async createObject3D(e){var i;return(i=this.getManager())==null?void 0:i.addImportedSingle(e||new _.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,i){var s,o,c,g;if(i!=null&&i.isMaterial){const b=(o=(s=this.getManager())==null?void 0:s.materials)==null?void 0:o.findMaterial(i.uuid);if(b)return b}return(g=(c=this.getManager())==null?void 0:c.materials)==null?void 0:g.generateFromTemplate(e,i)}serializePlugins(e,i){return Object.entries(this.plugins).map(s=>{var o,c;if(!i||i.includes(s[1].constructor.PluginType))return s[1].serializeWithViewer!==!1?(c=(o=s[1]).toJSON)==null?void 0:c.call(o,e):void 0}).filter(s=>!!s)}deserializePlugins(e,i){return e.forEach(s=>{var c;if(!s.type)return void this.console.warn("Invalid plugin to import ",s);const o=this.getPluginByType(s.type);o&&((c=o.fromJSON)==null||c.call(o,s,i))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,i){const s=Object.assign({version:iv.VERSION,type:"ViewerApp",metadata:{generator:"WebGiViewerApp",version:1},plugins:this.serializePlugins(e,i)},To(this,!0,e));return s.backgroundIntensity=this.scene.backgroundIntensity,s.useLegacyLights=this.renderer.useLegacyLights,s.background=s.scene.background||s.scene.backgroundColor,s.background==="environment"&&(s.background="envMapBackground"),s}fromJSON(e,i){var o,c,g,b,et;const s={...e};return s.backgroundIntensity!==void 0&&((o=s.scene)==null?void 0:o.backgroundIntensity)===void 0&&(this.console.warn("old file format, backgroundIntensity moved to RootScene"),this.scene.backgroundIntensity=s.backgroundIntensity,delete s.backgroundIntensity),s.useLegacyLights!==void 0&&((c=s.renderManager)==null?void 0:c.useLegacyLights)===void 0&&(this.console.warn("old file format, useLegacyLights moved to BaseRenderer"),this.renderer.useLegacyLights=s.useLegacyLights,delete s.useLegacyLights),s.background!==void 0&&((g=s.scene)==null?void 0:g.background)===void 0&&(this.console.warn("old file format, background moved to RootScene"),s.background==="envMapBackground"?s.background="environment":typeof s.background=="number"?s.background=new zo().setHex(s.background,_.GUF):typeof s.background=="string"?s.background=new zo().setStyle(s.background,_.GUF):(b=s.background)!=null&&b.isColor&&(s.background=new zo(s.background)),(et=s.background)!=null&&et.isColor?(this.scene.backgroundColor=s.background,this.scene.background=null):s.background?(this.scene.backgroundColor=new zo("#ffffff"),s.scene.background=s.background):(this.scene.backgroundColor=null,this.scene.background=null),delete s.background),Oo(s,this,!0,i),Array.isArray(s.plugins)&&this.deserializePlugins(s.plugins,i),this}get renderManager(){return this._renderer}get assetManager(){return this.getManager()}async load(e,i){if(e)return await this.assetManager.addAssetSingle(e,i)}async setEnvironmentMap(e,{setBackground:i=!1,...s}={}){return this.scene.environment=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,s)||null:e||null,i?this.setBackgroundMap(this.scene.environment):this.scene.environment}async setBackgroundMap(e,{setEnvironment:i=!1,...s}={}){return this.scene.background=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,s)||null:e||null,i?this.setEnvironmentMap(this.scene.background):this.scene.background}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void this.console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}iv.VERSION="0.9.1",QS([Mn("renderManager")],iv.prototype,"_renderer",void 0),QS([Mn()],iv.prototype,"scene",void 0),QS([(0,_e.onChange)(iv.prototype._renderEnabledChanged)],iv.prototype,"renderEnabled",void 0);const WS="envMapBackground";function JD(h){return h!=null&&h.isShaderPass2?h:new io({...dt,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(h)?h[0]:(h==null?void 0:h.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(h)?h[1]:typeof h=="string"?h:(h==null?void 0:h.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}class $D extends io{constructor(e){super({vertexShader:dt.vertexShader,uniforms:{tDiffuse:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},tTransparent:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                    
                    gl_FragColor.rgb *= gl_FragColor.a; // premultiply alpha
                }
                `},"tDiffuse","tTransparent"),this.uiConfig=void 0,this.material.transparent=!1,this.material.side=_.Wl3}render(e,i,s,o,c){super.render(e,i,s,o,c),this._lastReadBuffer=s,this.needsSwap=!0}reRender(e,i,s,o){this._lastReadBuffer&&this.render(e,i,this._lastReadBuffer,s,o)}dispose(){this._lastReadBuffer=void 0,super.dispose()}}class f_ extends Tm{get renderToScreen(){return this._renderToScreen}constructor(e=!0,i=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[bo],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render","screen"],this._requiredFilters=["render"],this._renderToScreen=!0,this._postFrame=()=>{var s,o;this._needsReRender&&this._renderToScreen&&this._viewer&&this.pass&&(this._needsReRender=!1,(o=(s=this.pass).update)==null||o.call(s),this.pass.passObject.reRender(this._viewer.renderer.rendererObject,null))},this._needsReRender=!1,this._setDirty=this._setDirty.bind(this),this._renderToScreen=i}async onAdded(e){var i,s;return(s=(i=this._viewer)==null?void 0:i.screenShader)!=null&&s.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&(0,_e.safeSetProperty)(e.renderer.passes.find(o=>o.passId==="screen"),"enabled",!1,!0,!0),e.addEventListener("postFrame",this._postFrame),super.onAdded(e)}async onRemove(e){return this._renderToScreen&&(0,_e.safeSetProperty)(e.renderer.passes.find(i=>i.passId==="screen"),"enabled",!0,!0,!0),super.onRemove(e)}passCtor(e){var c,g;const i=e.screenShader,s=["",""];this._renderToScreen&&!i.isShaderPass2&&(s[0]=Array.isArray(i)?i[0]:(i==null?void 0:i.pars)||"",s[1]=Array.isArray(i)?i[1]:typeof i=="string"?i:(i==null?void 0:i.main)||"");const o=new $D(s);return(0,_e.safeSetProperty)((g=(c=o.uiConfig)==null?void 0:c.children)==null?void 0:g.find(b=>(b==null?void 0:b.label)==="Enabled"),"hidden",!0,!0),o}_update(e){var i,s,o;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((i=this._viewer)==null?void 0:i.getPlugin(bo)),this._pass.passObject.material.uniforms.tTransparent.value=((o=(s=this._viewer)==null?void 0:s.renderFilter.passObject.transparentTarget)==null?void 0:o.texture)||null,!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,i;return((i=(e=this.pass)==null?void 0:e.passObject)==null?void 0:i.uiConfig)??{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}reRender(){this._renderToScreen?this._needsReRender=!0:this._setDirty()}}f_.PluginType="CombinedPostPlugin";var p2=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class O0 extends hs{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[f_]}get uiConfig(){var e;return(e=this._extension)==null?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var i;await super.onAdded(e),this._extension=this.generateExtension(e),(i=e.getPlugin(f_))==null||i.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}function qS(h,e,i){return h&~(1<<e)|(i?1:0)<<e}function f2(h,e){return h&~(1<<e)}p2([Mn("extension")],O0.prototype,"_extension",void 0),p2([Mn()],O0.prototype,"enabled",void 0);var K_,L0=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};const WM=_.dZ3;let Bv=K_=class{constructor(h,e=!0){this.depthTonemap=e,this.toneMapping=_.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this.saturation=1,this.contrast=1,this.renderDepth=!1,this.enabled=!0,this._rendererState={},this.extraUniforms={opacity:{value:1},toneMappingContrast:{value:1},toneMappingSaturation:{value:1}},this.parsFragmentSnippet=(i,s)=>this.enabled?_e.glsl`
            ${this.depthTonemap?bp:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            uniform float toneMappingContrast;
            uniform float toneMappingSaturation;
            ${`int getToneMapBit(in int number){
#ifdef WebGL2Context
return(number/2)%2;
#else
return int(mod(floor(float(number)/2.),2.));
#endif
}vec3 TonemappingSaturation(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);vec3 intensity=vec3(dot(rgb,W));return mix(intensity,rgb,toneMappingSaturation);}vec3 TonemappingContrast(vec3 color){return(color-vec3(0.5))*toneMappingContrast+vec3(0.5);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getToneMapBit(getGBufferFlags(vUv).a)>0;float depth=getDepth(vUv);vec4 transparentCol=tTransparentTexelToLinear(texture2D(tTransparent,vUv));
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.99&&transparentCol.a<0.001;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);outColor.rgb=TonemappingContrast(outColor.rgb);outColor.rgb=TonemappingSaturation(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;if(depth>0.99&&transparentCol.a>=0.001)outColor.a=transparentCol.a;
#endif
if(depth<0.00001)outColor.a=0.;
#if defined(DEBUG_DEPTH) && DEBUG_DEPTH > 0
outColor.rgb=vec3(sRGBToLinear(vec4((1.-depth))).x);
#endif
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=h.getPlugin(f_),this._setDirty=this._setDirty.bind(this),this.depthTonemap=e}shaderExtender(h,e,i){this.enabled&&(h.fragmentShader=rs(h.fragmentShader,"#glMarker",`
gl_FragColor = ToneMapping(gl_FragColor);
`,{prepend:!0}))}onObjectRender(h,e,i){if(!this.enabled)return;const{toneMapping:s,toneMappingExposure:o,outputColorSpace:c}=i;this._rendererState.toneMapping=s,this._rendererState.toneMappingExposure=o,this._rendererState.outputColorSpace=c;let g=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==g&&(e.materialObject.defines.TONEMAP_BACKGROUND=g,e.materialObject.needsUpdate=!0),g=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==g&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=g,e.materialObject.needsUpdate=!0),g=this.renderDepth?"1":"0",e.materialObject.defines.DEBUG_DEPTH!==g&&(e.materialObject.defines.DEBUG_DEPTH=g,e.materialObject.needsUpdate=!0),i.toneMapping=this.toneMapping,i.toneMappingExposure=this.exposure,i.outputColorSpace=_.KI_,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0,this.extraUniforms.toneMappingContrast.value=this.contrast,this.extraUniforms.toneMappingSaturation.value=this.saturation}onAfterRender(h,e,i){i.toneMapping=this._rendererState.toneMapping,i.toneMappingExposure=this._rendererState.toneMappingExposure,i.outputColorSpace=this._rendererState.outputColorSpace}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)==null||h.call(this),this._setDirty()}};Bv.PluginType="Tonemap",L0([em("Mode",[["Linear",_.EoG],["Reinhard",_.CdI],["Cineon",_.YGz],["ACESFilmic",_.LY2],["Uncharted2",WM]].map(h=>({label:h[0],value:h[1]})),{limitedUi:!0}),(0,_e.onChange)(K_.prototype._setDirty),Mn()],Bv.prototype,"toneMapping",void 0),L0([(0,_e.onChange)(K_.prototype._setDirty),Nr("Tonemap Background",{limitedUi:!0}),Mn()],Bv.prototype,"tonemapBackground",void 0),L0([(0,_e.onChange)(K_.prototype._setDirty),Nr("Clip Background"),Mn()],Bv.prototype,"clipBackground",void 0),L0([(0,_e.onChange)(K_.prototype._setDirty),es("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),Mn()],Bv.prototype,"exposure",void 0),L0([(0,_e.onChange)(K_.prototype._setDirty),es("Saturation",[0,2],.01,{limitedUi:!0}),Mn()],Bv.prototype,"saturation",void 0),L0([(0,_e.onChange)(K_.prototype._setDirty),es("Contrast",[0,2],.01,{limitedUi:!0}),Mn()],Bv.prototype,"contrast",void 0),L0([(0,_e.onChange)(K_.prototype._setDirty),Nr("Render Depth")],Bv.prototype,"renderDepth",void 0),Bv=K_=L0([Ms("Tonemapping")],Bv);class Sx extends O0{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(e,i){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,i)}async onAdded(e){var i;await super.onAdded(e),(i=e.getPlugin(bo))==null||i.registerGBufferUpdater(this.updateGBuffer)}generateExtension(e){return new Bv(e,this.depthTonemap)}get exposure(){var e;return((e=this._extension)==null?void 0:e.exposure)??1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get saturation(){var e;return((e=this._extension)==null?void 0:e.saturation)??1}set saturation(e){this._extension&&(this._extension.saturation=e,this._extension.setDirty())}get contrast(){var e;return((e=this._extension)==null?void 0:e.contrast)??1}set contrast(e){this._extension&&(this._extension.contrast=e,this._extension.setDirty())}get toneMapping(){var e;return((e=this._extension)==null?void 0:e.toneMapping)??_.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}updateGBuffer(e,i){var s,o;if(e instanceof _.Kj0&&((s=e.material)!=null&&s.userData)){const c=((o=e.material)==null?void 0:o.userData.postTonemap)===!1?0:1;i.w=qS(i.w,1,c)}}}Sx.PluginType="Tonemap",_.WdD.tonemapping_pars_fragment=_.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var X1,XS=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let ew=X1=class{constructor(h){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?_e.glsl`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=h.getPlugin(f_),this._setDirty=this._setDirty.bind(this)}shaderExtender(h,e,i){this.enabled&&(h.fragmentShader=rs(h.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(h,e,i){this.enabled&&(e.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)==null||h.call(this),this._setDirty()}};ew.PluginType="ChromaticAberration",XS([(0,_e.onChange)(X1.prototype._setDirty),Nr("Enable"),Mn()],ew.prototype,"enabled",void 0),XS([(0,_e.onChange)(X1.prototype._setDirty),es("Intensity",[0,.1],.001,{limitedUi:!0}),Mn()],ew.prototype,"aberrationIntensity",void 0),ew=X1=XS([Ms("ChromaticAberration")],ew);class Cx extends O0{constructor(){super()}generateExtension(e){return new ew(e)}get intensity(){var e;return((e=this._extension)==null?void 0:e.aberrationIntensity)??1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}Cx.PluginType="ChromaticAberration";class J_ extends hs{get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}constructor(){super(),this._pipeline=[]}async onAdded(e){await super.onAdded(e);const i=this.createPasses(e);this._passes=Object.fromEntries(i.map(s=>(s.passId||(console.warn("no id found for pass",s),s.passId=np()),e.renderer.registerPass(s,!0),[s.passId,s])))}async onRemove(e){var i;if(this._passes){for(const s of[...Object.values(this._passes)]){const o=s;e.renderer.unregisterPass(o),(i=o==null?void 0:o.dispose)==null||i.call(o)}this._passes=void 0}await super.onRemove(e)}toJSON(e){const i=super.toJSON(e);if(!i.type)return i;const s=Object.entries(this.passes);i.passes={};for(const[o,c]of s)i.passes[o]=To((c==null?void 0:c.passObject)??c,!1,e);return i}fromJSON(e,i){if(!super.fromJSON(e,i))return null;if(e.passes){const s=Object.entries(this.passes);for(const[o,c]of s)Oo(e.passes[o],(c==null?void 0:c.passObject)??c,!1,i)}return this}}var Lu=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class pu extends io{constructor(e,i,s="rgba"){super({vertexShader:dt.vertexShader,fragmentShader:i+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new _.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new _.FM8}},defines:{B_SRC_ACCESSOR:s}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,i,s,o,c){var g,b,et,tt;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((g=this.uniforms.tDiffuse.value)==null?void 0:g.image.width)||0,((b=this.uniforms.tDiffuse.value)==null?void 0:b.image.height)||0),super.render(e,i,this._target,o,c),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=i.texture,this.uniforms.tDiffuseSize.value.set(((et=this.uniforms.tDiffuse.value)==null?void 0:et.image.width)||0,((tt=this.uniforms.tDiffuse.value)==null?void 0:tt.image.height)||0),super.render(e,this._target,i,o,c))}}Lu([Mn(),hr()],pu.prototype,"smoothEnabled",void 0),Lu([Mn(),hr()],pu.prototype,"edgeSharpness",void 0);var om="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",m_=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,Y1=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,m2=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class qM extends io{constructor(e,i,s){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},screenSize:{value:new _.FM8(512,512)},saoData:{value:new _.Ltg},frameCount:{value:0},cameraNearFar:{value:new _.FM8(.1,1e3)},projection:{value:new _.yGw},saoBiasEpsilon:{value:new _.Pa4(1,1,1)}},vertexShader:om,fragmentShader:`

${m_}

${s}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);int getSelectionBit(in int number){
#ifdef WebGL2Context
return(number/4)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;bool disableAO=getSelectionBit(getGBufferFlags(vUv).a)>0?true:false;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(o,c,g)=>{o.defines.SSAO_ENABLED&&(o.fragmentShader=o.fragmentShader.replace("#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#else
#include <aomap_fragment>
#endif
#endif
`))},onObjectRender:(o,c,g)=>{var rt,st;this.materialExtension.extraUniforms.tSSAOMap.value=(rt=this._target)==null?void 0:rt.texture;const b=c.materialObject,et=!b.transparent&&b.transmission<.001;let tt=this.enabled&&et&&g.userData.screenSpaceRendering!==!1&&!((st=c.userData)!=null&&st.ssaoDisabled)?1:0;b.defines.SSAO_ENABLED!==tt&&(b.defines.SSAO_ENABLED=tt,b.needsUpdate=!0),tt=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==tt&&(this.materialExtension.extraUniforms.tSSAOMap.value=tt,b.needsUpdate=!0)},parsFragmentSnippet:o=>{var c;return _e.glsl`
             uniform sampler2D tSSAOMap;
             ${rn("tSSAOMap",(c=this._target)==null?void 0:c.texture,o.capabilities.isWebGL2)}
            ${Y1}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:o=>{var c,g;return this.enabled?"1":"0"+((g=(c=this._target)==null?void 0:c.texture)==null?void 0:g.colorSpace)},isCompatible:o=>{var c;return!((c=o.materialObject.userData)!=null&&c.ssaoDisabled)&&o.isMeshStandardMaterial2}},this._renderer=e,this._target=i,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new pu(this._target,s,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,i,s,o,c){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,i,{}),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,o,c),this._smoothEnabled&&this.bilateralPass.render(e,i,s,o,c))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const i=this.material.uniforms.saoBiasEpsilon.value;i.x=this.parameters.bias,i.y=.001,i.z=this.parameters.falloff}}m2([Mn()],qM.prototype,"bilateralPass",void 0),m2([Mn()],qM.prototype,"parameters",void 0);class K1 extends J_{get aoTarget(){return this._aoTarget}constructor(){super(),this.dependencies=[Lr,bo],this.setDirty=this.setDirty.bind(this)}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var i;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[Vo(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new qM(e.renderer,this._aoTarget,((i=e.getPlugin(bo))==null?void 0:i.getUnpackSnippet())??""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(bo)])}},()=>[e.getPlugin(bo),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get enabled(){var e,i;return((i=(e=this.passes.ssao)==null?void 0:e.passObject)==null?void 0:i.enabled)||!1}set enabled(e){var i;(i=this.passes.ssao)!=null&&i.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var s;if(this._uiConfig)return this._uiConfig;const e=this,i=e.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[i,"enabled"],onChange:e.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[i.parameters,"intensity"],onChange:e.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[i.parameters,"occlusionWorldRadius"],onChange:e.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[i.parameters,"bias"],onChange:e.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[i.parameters,"falloff"],onChange:e.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(s=i.material)==null?void 0:s.defines,"NUM_SAMPLES"],onChange:[()=>i.material.needsUpdate=!0,e.setDirty]},{type:"checkbox",property:[i.bilateralPass,"smoothEnabled"],onChange:e.setDirty},{type:"vec4",property:[i.bilateralPass,"edgeSharpness"],onChange:e.setDirty}]}}}K1.PluginType="SSAO";var tw,N0=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let g_=tw=class extends io{constructor(){super({vertexShader:dt.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new _.FM8},weight:{value:1},tNormalDepth:{value:null},tGBufferFlags:{value:null}},fragmentShader:bp+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}int getBloomBit(in int number){
#ifdef WebGL2Context
return(number/4)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}void main(){
#if PASS_STEP == 0 
int doBloom=getBloomBit(getGBufferFlags(vUv).a);gl_FragColor=float(doBloom)*weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new _.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(h,e,i,s,o){const c=h.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const g=i;let b=.5,et=g.width*b,tt=g.height*b;const rt=[];let st=c.getTempTarget({sizeMultiplier:1,type:_.cLu});rt.push(st);let at=g;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(h,st,at,s,o),at=st;let ct=1;for(;ct<this.bloomIterations&&(et/=2,tt/=2,b/=2,!(tt<2||et<2));ct++){st=c.getTempTarget({sizeMultiplier:b,type:_.cLu}),rt.push(st),this.material.defines.PASS_STEP=1;let gt=this._weights[ct];gt=this._weights[ct-1]!==0?this._weights[ct]/this._weights[ct-1]:this._weights[ct],this.material.uniforms.weight.value=gt,this.material.needsUpdate=!0,super.render(h,st,at,s,o),at=st}this.clear=!1;const pt=h.autoClear;for(h.autoClear=!1,ct-=2;ct>=0;ct--)st=rt[ct],rt[ct]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=_.WMw,this.material.needsUpdate=!0,h.autoClear=!1,super.render(h,st,at,s,o),this.material.blending=_.jFi,c.releaseTempTarget(at),at=st;this.clear=!0,h.autoClear=pt,h.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(h,e,at,s,o)):(this.uniforms.tSource.value=g.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(h,e,at,s,o),this.uniforms.tSource.value=null),c.releaseTempTarget(at)}_updateWeights(){if(!this._weights)return;const h=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let i=0;i<this.bloomIterations;i++){let s=i*e+.1,o=1.2-s;s=Math.pow(s,this.power),o=Math.pow(o,this.power),this._weights[i]=o*(1-h)+s*h}this.setDirty()}};function g2(h){const e=h==null?void 0:h.userData;return!!e&&(e[rv.PluginType]||(e[rv.PluginType]={}),e[rv.PluginType].enable=!0,h.isMaterial&&(h.needsUpdate=!0),!0)}N0([hr()],g_.prototype,"prefilter",void 0),N0([es("Threshold",[0,2]),(0,_e.onChange)(tw.prototype._thresholdsUpdated),Mn()],g_.prototype,"threshold",void 0),N0([es("Soft Threshold",[0,1]),(0,_e.onChange)(tw.prototype._thresholdsUpdated),Mn()],g_.prototype,"softThreshold",void 0),N0([es("Intensity",[0,3]),Mn(),hr()],g_.prototype,"intensity",void 0),N0([es("Iterations",[0,7],1),(0,_e.onChange)(tw.prototype._updateWeights),Mn()],g_.prototype,"bloomIterations",void 0),N0([es("Radius",[0,1],.01),(0,_e.onChange)(tw.prototype._updateWeights),Mn()],g_.prototype,"radius",void 0),N0([es("Power",[.2,10],.01),(0,_e.onChange)(tw.prototype._updateWeights),Mn()],g_.prototype,"power",void 0),N0([Nr("Debug")],g_.prototype,"bloomDebug",void 0),g_=tw=N0([Ms("Bloom")],g_);class rv extends Tm{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"],this.materialExtension={uuid:np(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const i=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=i,i},isCompatible:e=>!0}}setDirty(){this.pass.dirty=!0}_getUiConfig(e){const i={type:"folder",label:"Bloom",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=e.materialObject.userData[rv.PluginType])==null?void 0:s.enable)??!0},set value(s){var c;const o=e.materialObject.userData[rv.PluginType];s!==(o==null?void 0:o.enable)&&(o||g2(e.materialObject),e.materialObject.userData[rv.PluginType].enable=s,(c=i.uiRefresh)==null||c.call(i,"postFrame",!0))},onChange:this.setDirty}]};return i}passCtor(e){const i=new g_;return this.updateGBuffer=this.updateGBuffer.bind(this),this.setDirty=this.setDirty.bind(this),i}async onAdded(e){var s,o;await super.onAdded(e),(s=e.getPlugin(bo))==null||s.registerGBufferUpdater(this.updateGBuffer);const i=e.getPlugin(Lr);(o=i==null?void 0:i.materials)==null||o.registerMaterialExtension(this.materialExtension)}updateGBuffer(e,i){var s,o;if(e instanceof _.Kj0&&((s=e.material)!=null&&s.userData)){const c=(o=e.material)==null?void 0:o.userData[rv.PluginType],g=(c==null?void 0:c.enable)===!1?0:1;i.w=qS(i.w,2,g)}}_update(e){var i,s;return(s=e.getPlugin(bo))==null||s.updateShaderProperties((i=this.pass)==null?void 0:i.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}rv.PluginType="Bloom";var v2="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",Mx=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};const _2={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new _.FM8},cameraNearFar:{value:new _.FM8}},vertexShader:om,fragmentShader:bp+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},ZD=(Bs({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new _.FM8},direction:{value:new _.FM8}},vertexShader:om,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),Bs({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new _.FM8},direction:{value:new _.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:om,fragmentShader:m_+`
`+v2+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class Fy extends io{constructor(){super(_2,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=ZD,this.nearFarBlurScale=new _.FM8(.25,.25),this.focalDepthRange=new _.FM8(.5,1.5),this.crossCenter=new _.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new zo(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=Bs({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:om,fragmentShader:bp+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=Bs({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new _.FM8},direction:{value:new _.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:om,fragmentShader:bp+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,i,s,o,c){if(!this.enabled)return;const g=e.baseRenderer,b={minFilter:_.TyD,magFilter:_.TyD,type:_.cLu,encoding:_.rnI,sizeMultiplier:.5,isAntialiased:!1,format:_.wk1,depthBuffer:!1,generateMipmaps:!1},et=g.getTempTarget(b),tt=g.getTempTarget(b);if(this.computeCocMaterial.uniforms.colorTexture.value=s.texture,g.blit(void 0,et,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=et.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),g.blit(void 0,tt,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=tt.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),g.blit(void 0,et,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=et.texture,g.blit(void 0,tt,{material:this.dofBlurMaterial});else{const rt=g.getTempTarget(b);this.dofBlurMaterial.uniforms.cocTexture.value=et.texture,this.dofBlurMaterial.uniforms.colorTexture.value=et.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),g.blit(void 0,rt,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=rt.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),g.blit(void 0,tt,{material:this.dofBlurMaterial}),g.releaseTempTarget(rt)}this.material.uniforms.blurTexture.value=tt.texture,this.material.uniforms.cocTexture.value=et.texture,super.render(e,i,s,o,c),g.releaseTempTarget(et),g.releaseTempTarget(tt)}}Mx([Mn(),hr()],Fy.prototype,"nearFarBlurScale",void 0),Mx([Mn(),hr()],Fy.prototype,"focalDepthRange",void 0),Mx([hr()],Fy.prototype,"crossCenter",void 0),Mx([hr()],Fy.prototype,"crossRadius",void 0),Mx([hr()],Fy.prototype,"crossAlpha",void 0),Mx([hr()],Fy.prototype,"crossColor",void 0);class XM extends io{constructor(e){super({vertexShader:dt.vertexShader,fragmentShader:_e.glsl`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new _.Ltg(1,1,1,1)},weight2:{value:new _.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}var y2=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};const YM=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class cp extends J_{constructor(e=2*YM.length){super(),this._lastFrames=new Map,this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=i=>{const s=i.object;(s.modelObject||s.lightObject)&&(s.modelObject||s.lightObject).traverse(o=>{var c;(c=o==null?void 0:o.shadow)!=null&&c.camera&&o.shadow.mapSize&&this.trackedJitterCameras.add([o.shadow.camera,o.shadow.mapSize])})},this._jitterCamera=i=>{var o;const s=i.target;if(this.jitter&&s.renderer.frameCount>1){const c=(b,et)=>{const tt={...YM[s.renderer.frameCount%YM.length]};b.setViewOffset(et.width,et.height,tt.x,tt.y,et.width,et.height)},g=s.scene.activeCamera.cameraObject;c(g,{width:s.canvas.clientWidth*s.renderer.displayCanvasScaling,height:s.canvas.clientHeight*s.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(b=>c(...b)),this._hasSetOffset=!0,(o=this._viewer)==null||o.renderer.resetShadows()}},this._resetCameraJitter=i=>{const s=i.target;this._hasSetOffset&&(s.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=tm("Progressive",this),this.maxFrameCount=e}async onAdded(e){return await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrames.forEach(i=>e.renderer.disposeTarget(i)),this._lastFrames.clear(),await super.onRemove(e)}get lastFrame(){var e;return this._lastFrames.get((e=this._viewer)==null?void 0:e.scene.renderCamera.cameraObject.uuid)}getLastFrame(e){return e?this._lastFrames.get(e.cameraObject.uuid):this.lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const i=this;return[Vo(e,{passId:"progressive",get dirty(){var s;return i.jitter&&(((s=i._viewer)==null?void 0:s.renderer.frameCount)||0)<i.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends XM{render(s,o,c,g,b){if(i.lastFrame){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((c==null?void 0:c.texture)&&e.renderer.blit(c.texture,i.lastFrame,{}));this.needsSwap=!0,super.render(s,o,c,g,b),e.renderer.blit(o.texture,i.lastFrame,{})}else e.console.error("lastFrame render target undefined")}},update(){if(!i.lastFrame&&e.scene.renderCamera&&i._lastFrames.set(e.scene.renderCamera.cameraObject.uuid,e.renderer.composerTarget.clone(!0)),!i.lastFrame)return void console.error("lastFrame render target undefined");let s=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(s,s,s,s),s=1-s,this.passObject.weights2.set(s,s,s,s),this.passObject.blendTexture=i.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var i;return(((i=this._viewer)==null?void 0:i.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var i;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=((i=this.lastFrame)==null?void 0:i.texture)??void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const i=this._viewer.getPluginByType(e);return i&&i.isRecording()&&i.convergeMode?this.isConverged(!0)?1/i.videoFrameRate:0:-1}}cp.PluginType="Progressive",y2([Mn(),js("Frame count")],cp.prototype,"maxFrameCount",void 0),y2([Mn(),Nr("Jitter")],cp.prototype,"jitter",void 0);class U0 extends Tm{async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:_.wem,magFilter:_.wem,colorSpace:this._viewer.renderer.composerTarget.texture.colorSpace})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await(0,_e.timeout)(e))}stopTransition(){this._fadeTimeState=0}constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[cp],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(e.fadeDuration||1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(e.fadeDuration||200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(e.fadeDuration||500)},this._onPointerMove=e=>{var g;const i=(g=this._viewer)==null?void 0:g.canvas;if(!i)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==i)return void(this.pointerEnabled=!0);const s=i.getBoundingClientRect(),o=(e.clientX-s.left)/s.width,c=(e.clientY-s.top)/s.height;this.pointerEnabled=o<0||o>1||c<0||c>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const i=this,s=e.getPlugin(cp),o=new class extends XM{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=tm("Frame Fade",this)}render(c,g,b,et,tt){this.needsSwap=!1;const rt=i._target;if(!rt||!i.pointerEnabled||!this.enabled||!i.dirty||i._fadeTimeState<.001||e.scene.renderCamera!==e.scene.activeCamera)return;i._toSaveFrame&&s.lastFrame&&(e.renderer.blit(s.lastFrame.texture,rt),this._lastTime=0,i._toSaveFrame=!1),this.blendTexture=rt==null?void 0:rt.texture;const st=i._fadeTimeState/i._fadeTime;this.weights2.setScalar(st),this.weights2.w=1,this.weights1.setScalar(1-st),this.weights1.w=1,super.render(c,g,b,et,tt),this.needsSwap=!0;const at=(0,_e.now)();this._lastTime<10&&(this._lastTime=at-10);const ct=at-this._lastTime;this._lastTime=at,i._fadeTimeState-=ct}};return o.enabled=!0,o}setDirty(){var e;this.enabled&&((e=this._viewer)==null||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,i;return(i=(e=this.pass)==null?void 0:e.passObject)==null?void 0:i.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const i=this._disabledBy.indexOf(e);i>=0&&this._disabledBy.splice(i,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}U0.PluginType="FrameFade";var KM=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class jy extends Tm{passCtor(e){return new Fy}constructor(e=!0,i=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[bo],this.enableEdit=!1,this._focalPointHit=new _.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new _.Pa4,this.enabled=e,this.enableEdit=i,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}setFocalPoint(e,i=!0,s=!1){var o,c;this._focalPointHit.copy(e),i&&((c=(o=this._viewer)==null?void 0:o.getPlugin(U0))==null||c.startTransition(this._frameFadeTime)),s&&(this._focalPointHitTime=(0,_e.now)()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e;return((e=this.pass)==null?void 0:e.passObject.focalDepthRange.y)??0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e;return((e=this.pass)==null?void 0:e.passObject.nearFarBlurScale.x)??0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e;return((e=this.pass)==null?void 0:e.passObject.nearFarBlurScale.y)??0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var i,s;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(s=(i=this._viewer)==null?void 0:i.getPlugin(U0))==null||s.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var i;await super.onAdded(e),(i=e.getPluginByType("Picking"))==null||i.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var i;return(i=e.getPluginByType("Picking"))==null||i.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}_update(e){var g,b;if(!super._update(e))return!1;const i=(g=this.pass)==null?void 0:g.passObject;if(!i)return!1;const s=e.getPlugin(bo);s==null||s.updateShaderProperties(i.material),i.dofBlurMaterial.uniforms.frameCount&&((b=e.renderer)==null||b.updateShaderProperties(i.dofBlurMaterial));const o=e.scene.renderCamera;if(!o)return!1;o.cameraObject.updateMatrixWorld(!0),o.updateShaderProperties(i.material),o.cameraObject.getWorldPosition(this._tempVec),this._tempVec.subVectors(this._focalPointHit,this._tempVec),i.focalDepthRange.x=this._tempVec.length(),i.focalDepthRange.x*=o.cameraObject.getWorldDirection(new _.Pa4).dot(this._tempVec.normalize());let c=((0,_e.now)()-this._focalPointHitTime)/this.crossFadeTime;if(c=1-Math.min(1,Math.max(0,c)),Math.abs(c-i.crossAlpha)>.01&&(i.crossAlpha=c,this.setDirty()),c>0){const et=this._tempVec.copy(this._focalPointHit).project(o.cameraObject).addScalar(1).divideScalar(2);i.crossCenter.set(et.x,et.y),i.computeCocMaterial.uniformsNeedUpdate=!0,i.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var i,s,o,c,g;if(this._uiConfig)return this._uiConfig;const e=(s=(i=this._pass)==null?void 0:i.passObject)==null?void 0:s.uiConfig;return e?((c=(o=e.children)==null?void 0:o.map(b=>(0,_e.getOrCall)(b)))==null||c.flat(2).forEach(b=>b&&(b.onChange=this.setDirty)),(g=e.children)==null||g.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=e,e):{}}}jy.PluginType="DepthOfField",KM([Mn()],jy.prototype,"enableEdit",void 0),KM([Mn("focalPoint")],jy.prototype,"_focalPointHit",void 0),KM([Mn()],jy.prototype,"crossFadeTime",void 0);var A2=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let sv=class extends hs{addThinFilmLayer(h){return JM(h.materialObject)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new _k(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Lr],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new _.Ltg},thinNoiseLayerFactors:{value:new _.Ltg},thinColorNoiseParams:{value:new _.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(h,e)=>{var i;return this.enabled&&((i=e==null?void 0:e.materialObject.userData._thinFilmLayer)!=null&&i.hasThinFilm)?m_+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(h,e,i)=>{var o;if(!this.enabled||!((o=e.materialObject.userData._thinFilmLayer)!=null&&o.hasThinFilm))return;const s="#glMarker beforeAccumulation";h.fragmentShader=h.fragmentShader.replace(s,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+s),h.defines.USE_UV=""},onObjectRender:(h,e)=>{var o;const i=(o=e.materialObject.userData)==null?void 0:o._thinFilmLayer;if(!(i!=null&&i.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(i.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(i.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(i.colorNoiseParams),this._uniforms.thinFilmFactor.value=i.filmFactor;const s=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==s&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=s,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i;return(this.enabled?"1":"0")+((i=(e=h.materialObject.userData)==null?void 0:e._thinFilmLayer)!=null&&i.hasThinFilm?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2||h.isDiamondMaterial,updaters:()=>[],getUiConfig:h=>{const e=this._viewer,i={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=h.materialObject.userData._thinFilmLayer)==null?void 0:s.hasThinFilm)||!1},set value(s){var o,c;s!==((o=h.materialObject.userData._thinFilmLayer)==null?void 0:o.hasThinFilm)&&(s?JM(h.materialObject)||e.alert("Cannot add thin film."):h.materialObject.userData._thinFilmLayer&&(h.materialObject.userData._thinFilmLayer.hasThinFilm=!1,h.materialObject.needsUpdate=!0),(c=i.uiRefresh)==null||c.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var s;return!((s=h.materialObject.userData._thinFilmLayer)!=null&&s.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var s;return!((s=h.materialObject.userData._thinFilmLayer)!=null&&s.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var s;return!((s=h.materialObject.userData._thinFilmLayer)!=null&&s.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var s;return!((s=h.materialObject.userData._thinFilmLayer)!=null&&s.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var h;(h=this._viewer)==null||h.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,g;await super.onAdded(h);const e=h.getPlugin(Lr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(g=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||g.push(eB)}async onRemove(h){var e,i,s,o;return(i=(e=h.getPlugin(Lr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),(o=(s=h.getPlugin(Lr))==null?void 0:s.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};function JM(h){const e=h==null?void 0:h.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const i=e._thinFilmLayer;return i.hasThinFilm=!0,i.baseLayerFactors===void 0&&(i.baseLayerFactors=[.3,.6,1,.9]),i.noiseLayerFactors===void 0&&(i.noiseLayerFactors=[.7,.5,.9,.7]),i.colorNoiseParams===void 0&&(i.colorNoiseParams=[.5,.5,.5,.7]),i.filmFactor===void 0&&(i.filmFactor=.3),h.isMaterial&&(h.needsUpdate=!0),!0}sv.PluginType="ThinFilmLayerPlugin",sv.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",A2([Nr("Enabled",h=>({onChange:h.setDirty})),Mn()],sv.prototype,"enabled",void 0),sv=A2([Ms("ThinFilmLayer Materials")],sv);class _k{constructor(e){this.parser=e,this.name=sv.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return i.userData||(i.userData={}),JM(i),i.userData._thinFilmLayer=Oo(o,i.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const eB=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;i.extensions=i.extensions||{};const s=To(e.userData._thinFilmLayer,!1);i.extensions[sv.THIN_FILM_LAYER_GLTF_EXTENSION]=s,h.extensionsUsed[sv.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});class J1{async apply(e,i,s){var c,g,b,et;if(!i)return void(this.selected=void 0);let o=this.presets.find(tt=>function(rt,st){return(typeof rt=="string"?rt:rt.path)===(typeof st=="string"?st:st.path)}(tt,i));return o||(this.presets.push(i),o=i),this.selected=o,typeof o!="string"?(g=(c=e.getManager())==null?void 0:c.importer)==null?void 0:g.importAsset(o,s):(et=(b=e.getManager())==null?void 0:b.importer)==null?void 0:et.importPath(o,s)}constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}}class b2 extends J1{constructor(){super(...arguments),this.name="Background"}async apply(e,i){const s=await super.apply(e,i),o=s==null?void 0:s[0];return o&&(o.colorSpace=_.KI_,e.scene.background=o),o}}class w2 extends J1{constructor(){super(...arguments),this.name="Environment"}async apply(e,i){const s=await super.apply(e,i),o=s==null?void 0:s[0];return o&&(e.scene.environment=o),o}}class x2 extends J1{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,i){const s=await super.apply(e,i),o=s==null?void 0:s[0];return(0,_e.safeSetProperty)(e.getPluginByType("Diamond"),"envMap",o),o}}class $1 extends J1{async apply(e,i){var o,c;const s=await super.apply(e,i,{processImported:!1});return s?(c=(o=e.getManager())==null?void 0:o.importer)==null?void 0:c.processImported(s):void 0}}class E2 extends $1{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,i){const s=await super.apply(e,i);return s&&await e.alert("Material Library successfully imported."),s}}class nw extends hs{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(i=>{var s;return{label:((s=Tx(i))==null?void 0:s.split("/").pop())||"",value:Tx(i)}})],getValue:()=>Tx(e.selected)||"",setValue:i=>{e.apply(this._viewer,e.presets.find(s=>Tx(s)===i))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();(0,_e.downloadFile)(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",limitedUi:!1,value:()=>{const e=this.exportPresetGroups();(0,_e.downloadFile)(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var i,s;await super.onAdded(e),this.presetGroups.push(new b2),this.presetGroups.push(new w2),this.presetGroups.push(new x2),this.presetGroups.push(new $1("Ground")),this.presetGroups.push(new $1("CameraViews")),this.presetGroups.push(new $1("MaterialConfiguration")),this.presetGroups.push(new E2),(s=(i=this.uiConfig).uiRefresh)==null||s.call(i,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(i=>[i.name,Tx(i.selected)||void 0]).filter(([,i])=>i));return e.type=nw.PluginType,e}async fromJSON(e,i){var c,g;if(!super.fromJSON(e,i))return null;const s={...e};delete s.type;const o=[];for(const[b,et]of Object.entries(s)){const tt=this.presetGroups.find(at=>at.name===b),rt=tt==null?void 0:tt.presets;if(!tt||!rt)continue;const st=typeof et=="string"?{path:et}:et;o.push(tt.apply(this._viewer,st))}return await Promise.all(o),(g=(c=this.uiConfig).uiRefresh)==null||g.call(c,"postFrame",!0),this}async loadPresetGroups(e){var i;typeof e=="string"&&e.startsWith("http")&&(e=await fetch(e).then(async s=>s.json()));for(const[s,o]of Object.entries(e)){const c=(i=this.presetGroups.find(g=>g.name===s))==null?void 0:i.presets;c==null||c.push(...o)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(Tx)]).filter(([,e])=>e.length>0))}}function Tx(h){return h&&typeof h!="string"?h.path:h}nw.PluginType="PresetLibraryPlugin";var Z1,YS=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let Ix=Z1=class{constructor(h){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?_e.glsl`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=h.getPlugin(f_),this._setDirty=this._setDirty.bind(this)}shaderExtender(h,e,i){this.enabled&&(h.fragmentShader=rs(h.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(h,e,i){this.enabled&&(e.materialObject.uniforms.grainIntensity.value=this.grainIntensity,e.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)==null||h.call(this),this._setDirty()}};YS([(0,_e.onChange)(Z1.prototype._setDirty),Nr("Enable"),Mn()],Ix.prototype,"enabled",void 0),YS([(0,_e.onChange)(Z1.prototype._setDirty),Nr("Multiply"),Mn()],Ix.prototype,"grainMultiply",void 0),YS([(0,_e.onChange)(Z1.prototype._setDirty),es("Intensity",[0,20],.01,{limitedUi:!0}),Mn()],Ix.prototype,"grainIntensity",void 0),Ix=Z1=YS([Ms("FilmicGrain")],Ix);class eE extends O0{constructor(){super()}generateExtension(e){return new Ix(e)}get intensity(){var e;return((e=this._extension)==null?void 0:e.grainIntensity)??1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e;return((e=this._extension)==null?void 0:e.grainMultiply)??!1}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}eE.PluginType="FilmicGrain";class S2 extends _e.SimpleEventDispatcher{get scene(){return this._scene}set scene(e){var i;(i=this._scene)==null||i.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}constructor(e,i,s,o){super(),this.hoverEnabled=!1,this._scene=e,this._camera=s??this._scene.activeCamera,this.domElement=i,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=o??(c=>c.userData.userSelectable!==!1&&c.userData.bboxVisible!==!1&&c.material!=null&&c.material.type!=="ShadowMaterial"),this.raycaster=new _.iMs,this.mouse=new _.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",c=>this.onPointerMove(c)),this.domElement.addEventListener("pointerleave",c=>this.onPointerLeave(c)),this.domElement.addEventListener("pointerout",c=>this.onPointerLeave(c)),this.domElement.addEventListener("pointercancel",c=>this.onPointerCancel(c)),this.domElement.addEventListener("pointerenter",c=>this.onPointerEnter(c)),this.domElement.addEventListener("pointerdown",c=>this.onPointerDown(c)),this.domElement.addEventListener("pointerup",c=>this.onPointerUp(c))}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=(0,_e.now)(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){var i;e.isPrimary!==!1&&(this.updateMouseFromEvent(e),this.hoverEnabled&&(this.hoverObject=((i=this.checkIntersection())==null?void 0:i.intersects[0].object)??null))}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,(this.hoverEnabled||this.hoverObject)&&(this.hoverObject=null))}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const i=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-i.x)/i.width*2-1,this.mouse.y=-(e.clientY-i.y)/i.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const i=this.checkIntersection();i&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:i}),this.selectedObject=(i==null?void 0:i.selectedObject)||null}addPasses(){}checkIntersection(){var et;const e=(et=this._camera)==null?void 0:et.cameraObject;if(!e)return null;this.raycaster.setFromCamera(this.mouse,e);let i=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);const s=[];i=i.filter(tt=>!s.includes(tt.object.id)&&(s.push(tt.object.id),!0));let c,g=null;const b=[];for(const tt of i){for(g=tt.object,c=tt;!(g==null||g.visible&&this.selectionCondition(g));)g=g.parent;g!=null&&b.push(tt)}if(i=b,i.length>0){if(g=i[0].object,c=i[0],this._firstHit&&g.id!==this._firstHit.id)g=c.object;else for(let tt=0;tt<i.length;tt++)if(this.selectedObject&&this.selectedObject.id===i[tt].object.id){const rt=tt+1;if(!(rt<i.length))return null;c=i[rt],g=c.object}this._firstHit=i[0].object}return g&&c&&g?{selectedObject:g,intersect:c,intersects:i,mouse:this.mouse.toArray()}:null}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}const C2=new _.ZzF,Px=new _.Pa4;class zy extends _.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new _.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new _.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const i=this.attributes.instanceStart,s=this.attributes.instanceEnd;return i!==void 0&&(i.applyMatrix4(e),s.applyMatrix4(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new _.$TI(i,6,1);return this.setAttribute("instanceStart",new _.kB5(s,3,0)),this.setAttribute("instanceEnd",new _.kB5(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new _.$TI(i,6,1);return this.setAttribute("instanceColorStart",new _.kB5(s,3,0)),this.setAttribute("instanceColorEnd",new _.kB5(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new _.Uk6(e.geometry)),this}fromLineSegments(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new _.ZzF);const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;e!==void 0&&i!==void 0&&(this.boundingBox.setFromBufferAttribute(e),C2.setFromBufferAttribute(i),this.boundingBox.union(C2))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new _.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(e!==void 0&&i!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let o=0;for(let c=0,g=e.count;c<g;c++)Px.fromBufferAttribute(e,c),o=Math.max(o,s.distanceToSquared(Px)),Px.fromBufferAttribute(i,c),o=Math.max(o,s.distanceToSquared(Px));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class $M extends zy{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new _.Uk6(e))}}_.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new _.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},_.Vj0.line={uniforms:_.rDY.merge([_.rBU.common,_.rBU.fog,_.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class Ov extends _.jyz{constructor(e){super({type:"LineMaterial",uniforms:_.rDY.clone(_.Vj0.line.uniforms),vertexShader:_.Vj0.line.vertexShader,fragmentShader:_.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(i){this.uniforms.diffuse.value=i}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(i){i===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(i){this.uniforms.linewidth.value=i}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(i){!!i!="USE_DASH"in this.defines&&(this.needsUpdate=!0),i===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(i){this.uniforms.dashScale.value=i}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(i){this.uniforms.dashSize.value=i}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(i){this.uniforms.dashOffset.value=i}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(i){this.uniforms.gapSize.value=i}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(i){this.uniforms.opacity.value=i}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(i){this.uniforms.resolution.value.copy(i)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(i){!!i!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),i===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const ZM=new _.Pa4,M2=new _.Pa4;class KS extends _.Kj0{constructor(e=new zy,i=new Ov({color:16777215*Math.random()})){super(e,i),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,s=e.attributes.instanceEnd,o=new Float32Array(2*i.count);for(let g=0,b=0,et=i.count;g<et;g++,b+=2)ZM.fromBufferAttribute(i,g),M2.fromBufferAttribute(s,g),o[b]=b===0?0:o[b-1],o[b+1]=o[b]+ZM.distanceTo(M2);const c=new _.$TI(o,2,1);return e.setAttribute("instanceDistanceStart",new _.kB5(c,1,0)),e.setAttribute("instanceDistanceEnd",new _.kB5(c,1,1)),this}}class JS extends _.ZAu{_updater(){const e=this._object;if(e){const i=new Xt().expandByObject(e,!1);i.getCenter(this.position);const s=i.getBoundingSphere(new _.aLr).radius;this.scale.setScalar(s*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_initGeometry(e){if(this._geometry)return;const i=new $M(e);this._geometry=i;const s=new Ov({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new _.FM8(1024,1024),dashed:!1,toneMapped:!1}),o=new KS(i,s);o.computeLineDistances(),o.scale.set(1,1,1),o.visible=!0,this.add(o)}setVisible(e){var i;e!==this.visible&&(this.visible=e,(i=this.setDirty)==null||i.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)==null||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class eT extends JS{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new _.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new Xt().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}const iw=new _.iMs,Lm=new _.Pa4,Lv=new _.Pa4,Fl=new _._fP,tT={X:new _.Pa4(1,0,0),Y:new _.Pa4(0,1,0),Z:new _.Pa4(0,0,1)},nT={type:"change"},$S={type:"mouseDown"},T2={type:"mouseUp",mode:null},I2={type:"objectChange"};class P2 extends _.Tme{constructor(e,i){super(),i===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const s=new sB;this._gizmo=s,this.add(s);const o=new oB;this._plane=o,this.add(o);const c=this;function g(xt,yt){let _t=yt;Object.defineProperty(c,xt,{get:function(){return _t!==void 0?_t:yt},set:function(Mt){_t!==Mt&&(_t=Mt,o[xt]=Mt,s[xt]=Mt,c.dispatchEvent({type:xt+"-changed",value:Mt}),c.dispatchEvent(nT))}}),c[xt]=yt,o[xt]=yt,s[xt]=yt}g("camera",e),g("object",void 0),g("enabled",!0),g("axis",null),g("mode","translate"),g("translationSnap",null),g("rotationSnap",null),g("scaleSnap",null),g("space","world"),g("size",1),g("dragging",!1),g("showX",!0),g("showY",!0),g("showZ",!0);const b=new _.Pa4,et=new _.Pa4,tt=new _._fP,rt=new _._fP,st=new _.Pa4,at=new _._fP,ct=new _.Pa4,pt=new _.Pa4,gt=new _.Pa4,At=new _.Pa4;g("worldPosition",b),g("worldPositionStart",et),g("worldQuaternion",tt),g("worldQuaternionStart",rt),g("cameraPosition",st),g("cameraQuaternion",at),g("pointStart",ct),g("pointEnd",pt),g("rotationAxis",gt),g("rotationAngle",0),g("eye",At),this._offset=new _.Pa4,this._startNorm=new _.Pa4,this._endNorm=new _.Pa4,this._cameraScale=new _.Pa4,this._parentPosition=new _.Pa4,this._parentQuaternion=new _._fP,this._parentQuaternionInv=new _._fP,this._parentScale=new _.Pa4,this._worldScaleStart=new _.Pa4,this._worldQuaternionInv=new _._fP,this._worldScale=new _.Pa4,this._positionStart=new _.Pa4,this._quaternionStart=new _._fP,this._scaleStart=new _.Pa4,this._getPointer=tB.bind(this),this._onPointerDown=nB.bind(this),this._onPointerHover=R2.bind(this),this._onPointerMove=iB.bind(this),this._onPointerUp=rB.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;iw.setFromCamera(e,this.camera);const i=iT(this._gizmo.picker[this.mode],iw);this.axis=i?i.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){iw.setFromCamera(e,this.camera);const i=iT(this._plane,iw,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,$S.mode=this.mode,this.dispatchEvent($S)}}pointerMove(e){const i=this.axis,s=this.mode,o=this.object;let c=this.space;if(s==="scale"?c="local":i!=="E"&&i!=="XYZE"&&i!=="XYZ"||(c="world"),o===void 0||i===null||this.dragging===!1||e.button!==-1)return;iw.setFromCamera(e,this.camera);const g=iT(this._plane,iw,!0);if(g){if(this.pointEnd.copy(g.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),c==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),c==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),o.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(c==="local"&&(o.position.applyQuaternion(Fl.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(o.position.x=Math.round(o.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(o.position.y=Math.round(o.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(o.position.z=Math.round(o.position.z/this.translationSnap)*this.translationSnap),o.position.applyQuaternion(this._quaternionStart)),c==="world"&&(o.parent&&o.position.add(Lm.setFromMatrixPosition(o.parent.matrixWorld)),i.search("X")!==-1&&(o.position.x=Math.round(o.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(o.position.y=Math.round(o.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(o.position.z=Math.round(o.position.z/this.translationSnap)*this.translationSnap),o.parent&&o.position.sub(Lm.setFromMatrixPosition(o.parent.matrixWorld))));else if(s==="scale"){if(i.search("XYZ")!==-1){let b=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(b*=-1),Lv.set(b,b,b)}else Lm.copy(this.pointStart),Lv.copy(this.pointEnd),Lm.applyQuaternion(this._worldQuaternionInv),Lv.applyQuaternion(this._worldQuaternionInv),Lv.divide(Lm),i.search("X")===-1&&(Lv.x=1),i.search("Y")===-1&&(Lv.y=1),i.search("Z")===-1&&(Lv.z=1);o.scale.copy(this._scaleStart).multiply(Lv),this.scaleSnap&&(i.search("X")!==-1&&(o.scale.x=Math.round(o.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(o.scale.y=Math.round(o.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(o.scale.z=Math.round(o.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const b=20/this.worldPosition.distanceTo(Lm.setFromMatrixPosition(this.camera.matrixWorld));i==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Lm.copy(this.rotationAxis).cross(this.eye))*b):i!=="X"&&i!=="Y"&&i!=="Z"||(this.rotationAxis.copy(tT[i]),Lm.copy(tT[i]),c==="local"&&Lm.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Lm.cross(this.eye).normalize())*b),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),c==="local"&&i!=="E"&&i!=="XYZE"?(o.quaternion.copy(this._quaternionStart),o.quaternion.multiply(Fl.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),o.quaternion.copy(Fl.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),o.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(nT),this.dispatchEvent(I2)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(T2.mode=this.mode,this.dispatchEvent(T2)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(nT),this.dispatchEvent(I2),this.pointStart.copy(this.pointEnd))}getRaycaster(){return iw}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function tB(h){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:h.button};{const e=this.domElement.getBoundingClientRect();return{x:(h.clientX-e.left)/e.width*2-1,y:-(h.clientY-e.top)/e.height*2+1,button:h.button}}}function R2(h){if(this.enabled)switch(h.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(h))}}function nB(h){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(h.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(h)),this.pointerDown(this._getPointer(h)))}function iB(h){this.enabled&&this.pointerMove(this._getPointer(h))}function rB(h){this.enabled&&(this.domElement.releasePointerCapture(h.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(h)))}function iT(h,e,i){const s=e.intersectObject(h,!0);for(let o=0;o<s.length;o++)if(s[o].object.visible||i)return s[o];return!1}const ZS=new _.USm,xl=new _.Pa4(0,1,0),D2=new _.Pa4(0,0,0),rT=new _.yGw,tE=new _._fP,eC=new _._fP,$_=new _.Pa4,k2=new _.yGw,nE=new _.Pa4(1,0,0),rw=new _.Pa4(0,1,0),Rx=new _.Pa4(0,0,1),tC=new _.Pa4,sw=new _.Pa4,ow=new _.Pa4;class sB extends _.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new _.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new _.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const o=i.clone();o.opacity=.5;const c=e.clone();c.color.setHex(16711680);const g=e.clone();g.color.setHex(65280);const b=e.clone();b.color.setHex(255);const et=e.clone();et.color.setHex(16711680),et.opacity=.5;const tt=e.clone();tt.color.setHex(65280),tt.opacity=.5;const rt=e.clone();rt.color.setHex(255),rt.opacity=.5;const st=e.clone();st.opacity=.25;const at=e.clone();at.color.setHex(16776960),at.opacity=.25,e.clone().color.setHex(16776960);const ct=e.clone();ct.color.setHex(7895160);const pt=new _.fHI(0,.04,.1,12);pt.translate(0,.05,0);const gt=new _.DvJ(.08,.08,.08);gt.translate(0,.04,0);const At=new _.u9r;At.setAttribute("position",new _.a$l([0,0,0,1,0,0],3));const xt=new _.fHI(.0075,.0075,.5,3);function yt(cn,un){const bn=new _.XvJ(cn,.0075,3,64,un*Math.PI*2);return bn.rotateY(Math.PI/2),bn.rotateX(Math.PI/2),bn}xt.translate(0,.25,0);const _t={X:[[new _.Kj0(pt,c),[.5,0,0],[0,0,-Math.PI/2]],[new _.Kj0(pt,c),[-.5,0,0],[0,0,Math.PI/2]],[new _.Kj0(xt,c),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new _.Kj0(pt,g),[0,.5,0]],[new _.Kj0(pt,g),[0,-.5,0],[Math.PI,0,0]],[new _.Kj0(xt,g)]],Z:[[new _.Kj0(pt,b),[0,0,.5],[Math.PI/2,0,0]],[new _.Kj0(pt,b),[0,0,-.5],[-Math.PI/2,0,0]],[new _.Kj0(xt,b),null,[Math.PI/2,0,0]]],XYZ:[[new _.Kj0(new _.pQR(.1,0),st.clone()),[0,0,0]]],XY:[[new _.Kj0(new _.DvJ(.15,.15,.01),rt.clone()),[.15,.15,0]]],YZ:[[new _.Kj0(new _.DvJ(.15,.15,.01),et.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _.Kj0(new _.DvJ(.15,.15,.01),tt.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},Mt={X:[[new _.Kj0(new _.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new _.Kj0(new _.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,.3,0]],[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new _.Kj0(new _.pQR(.2,0),s)]],XY:[[new _.Kj0(new _.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new _.Kj0(new _.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _.Kj0(new _.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},It={START:[[new _.Kj0(new _.pQR(.01,2),o),null,null,null,"helper"]],END:[[new _.Kj0(new _.pQR(.01,2),o),null,null,null,"helper"]],DELTA:[[new _.x12(function(){const cn=new _.u9r;return cn.setAttribute("position",new _.a$l([0,0,0,1,1,1],3)),cn}(),o),null,null,null,"helper"]],X:[[new _.x12(At,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new _.x12(At,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new _.x12(At,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Bt={XYZE:[[new _.Kj0(yt(.5,1),ct),null,[0,Math.PI/2,0]]],X:[[new _.Kj0(yt(.5,.5),c)]],Y:[[new _.Kj0(yt(.5,.5),g),null,[0,0,-Math.PI/2]]],Z:[[new _.Kj0(yt(.5,.5),b),null,[0,Math.PI/2,0]]],E:[[new _.Kj0(yt(.75,1),at),null,[0,Math.PI/2,0]]]},Lt={AXIS:[[new _.x12(At,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Ht={XYZE:[[new _.Kj0(new _.xo$(.25,10,8),s)]],X:[[new _.Kj0(new _.XvJ(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new _.Kj0(new _.XvJ(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new _.Kj0(new _.XvJ(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new _.Kj0(new _.XvJ(.75,.1,2,24),s)]]},Jt={X:[[new _.Kj0(gt,c),[.5,0,0],[0,0,-Math.PI/2]],[new _.Kj0(xt,c),[0,0,0],[0,0,-Math.PI/2]],[new _.Kj0(gt,c),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new _.Kj0(gt,g),[0,.5,0]],[new _.Kj0(xt,g)],[new _.Kj0(gt,g),[0,-.5,0],[0,0,Math.PI]]],Z:[[new _.Kj0(gt,b),[0,0,.5],[Math.PI/2,0,0]],[new _.Kj0(xt,b),[0,0,0],[Math.PI/2,0,0]],[new _.Kj0(gt,b),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new _.Kj0(new _.DvJ(.15,.15,.01),rt),[.15,.15,0]]],YZ:[[new _.Kj0(new _.DvJ(.15,.15,.01),et),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _.Kj0(new _.DvJ(.15,.15,.01),tt),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new _.Kj0(new _.DvJ(.1,.1,.1),st.clone())]]},sn={X:[[new _.Kj0(new _.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new _.Kj0(new _.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,.3,0]],[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new _.Kj0(new _.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new _.Kj0(new _.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _.Kj0(new _.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new _.Kj0(new _.DvJ(.2,.2,.2),s),[0,0,0]]]},on={X:[[new _.x12(At,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new _.x12(At,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new _.x12(At,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function mn(cn){const un=new _.Tme;for(const bn in cn)for(let xn=cn[bn].length;xn--;){const Cn=cn[bn][xn][0].clone(),Jn=cn[bn][xn][1],Kn=cn[bn][xn][2],gr=cn[bn][xn][3],nr=cn[bn][xn][4];Cn.name=bn,Cn.tag=nr,Jn&&Cn.position.set(Jn[0],Jn[1],Jn[2]),Kn&&Cn.rotation.set(Kn[0],Kn[1],Kn[2]),gr&&Cn.scale.set(gr[0],gr[1],gr[2]),Cn.updateMatrix();const tr=Cn.geometry.clone();tr.applyMatrix4(Cn.matrix),Cn.geometry=tr,Cn.renderOrder=1/0,Cn.position.set(0,0,0),Cn.rotation.set(0,0,0),Cn.scale.set(1,1,1),un.add(Cn)}return un}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=mn(_t)),this.add(this.gizmo.rotate=mn(Bt)),this.add(this.gizmo.scale=mn(Jt)),this.add(this.picker.translate=mn(Mt)),this.add(this.picker.rotate=mn(Ht)),this.add(this.picker.scale=mn(sn)),this.add(this.helper.translate=mn(It)),this.add(this.helper.rotate=mn(Lt)),this.add(this.helper.scale=mn(on)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:eC;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let o=0;o<s.length;o++){const c=s[o];let g;c.visible=!0,c.rotation.set(0,0,0),c.position.copy(this.worldPosition),g=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),c.scale.set(1,1,1).multiplyScalar(g*this.size/4),c.tag!=="helper"?(c.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(c.name==="X"&&Math.abs(xl.copy(nE).applyQuaternion(i).dot(this.eye))>.99&&(c.scale.set(1e-10,1e-10,1e-10),c.visible=!1),c.name==="Y"&&Math.abs(xl.copy(rw).applyQuaternion(i).dot(this.eye))>.99&&(c.scale.set(1e-10,1e-10,1e-10),c.visible=!1),c.name==="Z"&&Math.abs(xl.copy(Rx).applyQuaternion(i).dot(this.eye))>.99&&(c.scale.set(1e-10,1e-10,1e-10),c.visible=!1),c.name==="XY"&&Math.abs(xl.copy(Rx).applyQuaternion(i).dot(this.eye))<.2&&(c.scale.set(1e-10,1e-10,1e-10),c.visible=!1),c.name==="YZ"&&Math.abs(xl.copy(nE).applyQuaternion(i).dot(this.eye))<.2&&(c.scale.set(1e-10,1e-10,1e-10),c.visible=!1),c.name==="XZ"&&Math.abs(xl.copy(rw).applyQuaternion(i).dot(this.eye))<.2&&(c.scale.set(1e-10,1e-10,1e-10),c.visible=!1)):this.mode==="rotate"&&(tE.copy(i),xl.copy(this.eye).applyQuaternion(Fl.copy(i).invert()),c.name.search("E")!==-1&&c.quaternion.setFromRotationMatrix(rT.lookAt(this.eye,D2,rw)),c.name==="X"&&(Fl.setFromAxisAngle(nE,Math.atan2(-xl.y,xl.z)),Fl.multiplyQuaternions(tE,Fl),c.quaternion.copy(Fl)),c.name==="Y"&&(Fl.setFromAxisAngle(rw,Math.atan2(xl.x,xl.z)),Fl.multiplyQuaternions(tE,Fl),c.quaternion.copy(Fl)),c.name==="Z"&&(Fl.setFromAxisAngle(Rx,Math.atan2(xl.y,xl.x)),Fl.multiplyQuaternions(tE,Fl),c.quaternion.copy(Fl))),c.visible=c.visible&&(c.name.indexOf("X")===-1||this.showX),c.visible=c.visible&&(c.name.indexOf("Y")===-1||this.showY),c.visible=c.visible&&(c.name.indexOf("Z")===-1||this.showZ),c.visible=c.visible&&(c.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),c.material._color=c.material._color||c.material.color.clone(),c.material._opacity=c.material._opacity||c.material.opacity,c.material.color.copy(c.material._color),c.material.opacity=c.material._opacity,this.enabled&&this.axis&&(c.name===this.axis||this.axis.split("").some(function(b){return c.name===b}))&&(c.material.color.setHex(16776960),c.material.opacity=1)):(c.visible=!1,c.name==="AXIS"?(c.visible=!!this.axis,this.axis==="X"&&(Fl.setFromEuler(ZS.set(0,0,0)),c.quaternion.copy(i).multiply(Fl),Math.abs(xl.copy(nE).applyQuaternion(i).dot(this.eye))>.9&&(c.visible=!1)),this.axis==="Y"&&(Fl.setFromEuler(ZS.set(0,0,Math.PI/2)),c.quaternion.copy(i).multiply(Fl),Math.abs(xl.copy(rw).applyQuaternion(i).dot(this.eye))>.9&&(c.visible=!1)),this.axis==="Z"&&(Fl.setFromEuler(ZS.set(0,Math.PI/2,0)),c.quaternion.copy(i).multiply(Fl),Math.abs(xl.copy(Rx).applyQuaternion(i).dot(this.eye))>.9&&(c.visible=!1)),this.axis==="XYZE"&&(Fl.setFromEuler(ZS.set(0,Math.PI/2,0)),xl.copy(this.rotationAxis),c.quaternion.setFromRotationMatrix(rT.lookAt(D2,xl,rw)),c.quaternion.multiply(Fl),c.visible=this.dragging),this.axis==="E"&&(c.visible=!1)):c.name==="START"?(c.position.copy(this.worldPositionStart),c.visible=this.dragging):c.name==="END"?(c.position.copy(this.worldPosition),c.visible=this.dragging):c.name==="DELTA"?(c.position.copy(this.worldPositionStart),c.quaternion.copy(this.worldQuaternionStart),Lm.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Lm.applyQuaternion(this.worldQuaternionStart.clone().invert()),c.scale.copy(Lm),c.visible=this.dragging):(c.quaternion.copy(i),this.dragging?c.position.copy(this.worldPositionStart):c.position.copy(this.worldPosition),this.axis&&(c.visible=this.axis.search(c.name)!==-1)))}super.updateMatrixWorld(e)}}class oB extends _.Kj0{constructor(){super(new _._12(1e5,1e5,2,2),new _.vBJ({visible:!1,wireframe:!0,side:_.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),tC.copy(nE).applyQuaternion(i==="local"?this.worldQuaternion:eC),sw.copy(rw).applyQuaternion(i==="local"?this.worldQuaternion:eC),ow.copy(Rx).applyQuaternion(i==="local"?this.worldQuaternion:eC),xl.copy(sw),this.mode){case"translate":case"scale":switch(this.axis){case"X":xl.copy(this.eye).cross(tC),$_.copy(tC).cross(xl);break;case"Y":xl.copy(this.eye).cross(sw),$_.copy(sw).cross(xl);break;case"Z":xl.copy(this.eye).cross(ow),$_.copy(ow).cross(xl);break;case"XY":$_.copy(ow);break;case"YZ":$_.copy(tC);break;case"XZ":xl.copy(ow),$_.copy(sw);break;case"XYZ":case"E":$_.set(0,0,0)}break;default:$_.set(0,0,0)}$_.length()===0?this.quaternion.copy(this.cameraQuaternion):(k2.lookAt(Lm.set(0,0,0),$_,xl),this.quaternion.setFromRotationMatrix(k2)),super.updateMatrixWorld(e)}}class B2 extends P2{_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(_.M8C.degToRad(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var i;(i=this==null?void 0:this.object)==null||i.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",i=>{const s=e==null?void 0:e.getPlugin(U0);s&&(s.enabled=!i.value),this._scene.activeCamera.interactionsEnabled=!i.value}),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var O2=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class vo extends hs{get picker(){return this._picker}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}constructor(e=eT,i=!1,s=!0,o=!1){super(),this.enabled=!0,this._enableWidget=!0,this.autoFocus=!1,this._onObjectHit=c=>{this._viewer&&(this.enabled?this.dispatchEvent(c):c.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const c=this.getSelectedObject();this.autoFocus&&c&&this.setSelectedObject(c,!0)}}],e&&(this._widget=new e),this._controls=i,this._pickUi=s,this.autoFocus=o}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)==null?void 0:e.selectedObject)||void 0}setSelectedObject(e,i=!1){if(!this.enabled||!this._picker)return;const s=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=s,(s||i)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new S2(e.scene,e.canvas,void 0,i=>{if(!i.material)return!1;let s=i,o=!1;for(;s;){if(!s.visible||((s.userData.iModel??s).assetType==="model"&&(o=!0),(s.userData.iModel??s).assetType==="widget")||s.userData.userSelectable===!1||s.userData.bboxVisible===!1)return!1;s=s.parent}return o}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new B2(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",i=>{var g,b,et;this.dispatchEvent(i);const s=((g=this._picker)==null?void 0:g.selectedObject)||void 0;if(this._pickUi){const tt=s==null?void 0:s.uiConfig,rt=this.uiConfig;rt.children=[...this._uiConfigChildren],tt&&rt.children.push(tt),(b=rt.uiRefresh)==null||b.call(rt)}const o=this._widget;o&&this._enableWidget&&(s?o.attach(s):o.detach());const c=this._transformControls;c&&((et=this._viewer)!=null&&et.scene.activeCamera.controls)&&(s&&c.enabled?c.attach(s):c.detach()),e.setDirty(),this.autoFocus&&this.focusObject(s)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",i=>{i.value===void 0?console.warn("e.value must be set for picking, can be null to unselect"):this.setSelectedObject(i.value,this.autoFocus||i.focusCamera)}),e.scene.addEventListener("addSceneObject",async i=>{var c,g;const s=i.object,o=this.getSelectedObject();if(o&&(s==null?void 0:s.assetType)==="material"&&typeof(o==null?void 0:o.setMaterial)=="function"&&((c=o==null?void 0:o.modelObject)!=null&&c.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const b=o.material;if(Array.isArray(b))console.warn("Dropping on material array not yet fully supported."),o.setMaterial(s);else{let et=Array.from((b==null?void 0:b.userData.__appliedMeshes)??[]);(et.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):et.length<1)&&(et=[o]);for(const tt of et)tt&&((g=tt.setMaterial)==null||g.call(tt,s))}}}),e.scene.addEventListener("sceneUpdate",i=>{if(!i.hierarchyChanged)return;const s=this.getSelectedObject();let o=!1;s==null||s.traverseAncestors(c=>{c===e.scene.modelObject&&(o=!0)}),o||this.setSelectedObject(void 0)})}async focusObject(e){var s,o,c;const i=(s=this._viewer)==null?void 0:s.getPluginByType("CameraViews");await(i==null?void 0:i.animateToFitObject(e,1.25,1e3,"easeOut",{min:(((c=(o=this._viewer)==null?void 0:o.scene.activeCamera.getControls())==null?void 0:c.minDistance)??.5)+.5,max:50}))}enableWidget(e){var i,s,o;if(this._enableWidget=e,e){const c=((i=this._picker)==null?void 0:i.selectedObject)||void 0;c&&((s=this._widget)==null||s.attach(c))}else(o=this._widget)==null||o.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}vo.PluginType="Picking",O2([Mn()],vo.prototype,"enabled",void 0),O2([Mn()],vo.prototype,"autoFocus",void 0);var nC,iE=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let Nu=nC=class extends hs{enableCustomBump(h,e,i){var o;const s=(o=h.materialObject)==null?void 0:o.userData;if(!s)return!1;if(s._hasCustomBump===void 0){const c=s.__appliedMeshes;let g=!0;if(c)for(const{geometry:b}of c)!b||b.attributes.position&&b.attributes.normal&&b.attributes.uv||(g=!1);if(!g)return!1}return s._hasCustomBump=!0,s._customBumpScale=i??s._customBumpScale??.001,s._customBumpMap=e??s._customBumpMap,h.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new aB(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Lr],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new _.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(h,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic_cb(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic_cb(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic_cb(fxy.x);vec4 ycubic=cubic_cb(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(h,e,i)=>{var o;if(!this.enabled||!e.materialObject.userData._hasCustomBump)return;((o=e.materialObject.userData)==null?void 0:o._customBumpMap)&&(h.fragmentShader=rs(h.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),h.vertexShader=rs(h.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),h.vertexShader=rs(h.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),h.defines.USE_UV="")},onObjectRender:(h,e)=>{var g;const i=e.materialObject.userData;if(!(i!=null&&i._hasCustomBump))return;const s=h;if(!s.isMesh||!s.geometry)return;const o=(g=i._customBumpMap)!=null&&g.isTexture?i._customBumpMap:null;this._uniforms.customBumpMap.value=o,this._uniforms.customBumpScale.value=o?i._customBumpScale:0,o&&(o.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(o.matrix));let c=this.enabled&&o?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==c&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=c,e.materialObject.needsUpdate=!0),c=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==c&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=c,e.materialObject.needsUpdate=!0),c=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==c&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=c,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i,s;return(this.enabled?"1":"0")+((e=h.materialObject.userData)!=null&&e._hasCustomBump?"1":"0")+((s=(i=h.materialObject.userData)==null?void 0:i._customBumpMap)==null?void 0:s.uuid)},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:h=>{const e=this._viewer,i=this.enableCustomBump,s={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return h.materialObject.userData._hasCustomBump||!1},set value(o){var c;o!==h.materialObject.userData._hasCustomBump&&(o?i(h)||e.alert("One or more geometries cannot be made anisotropic."):(h.materialObject.userData._hasCustomBump=!1,h.materialObject.needsUpdate=!0),(c=s.uiRefresh)==null||c.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",bounds:[-1,1],hidden:()=>!h.materialObject.userData._hasCustomBump,property:[h.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!h.materialObject.userData._hasCustomBump,property:[h.materialObject.userData,"_customBumpMap"],onChange:()=>{h.materialObject.needsUpdate=!0,this.setDirty()}},Ko(h.materialObject.userData,"_customBumpMap")]};return s}},this.setDirty=()=>{var h,e,i;(e=(h=this.materialExtension).setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()},this.enableCustomBumpSelected=()=>{var e,i,s;const h=(s=(i=(e=this._viewer)==null?void 0:e.getPlugin(vo))==null?void 0:i.getSelectedObject())==null?void 0:s.material;return(h==null?void 0:h.assetType)==="material"&&this.enableCustomBump(h)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,g;await super.onAdded(h);const e=h.getPlugin(Lr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(g=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||g.push(iC)}async onRemove(h){var i,s,o,c,g,b,et,tt,rt,st,at,ct;(s=(i=h.getPlugin(Lr))==null?void 0:i.materials)==null||s.unregisterMaterialExtension(this.materialExtension),(c=(o=h.getPlugin(Lr))==null?void 0:o.importer)==null||c.removeEventListener("loaderCreate",this._loaderCreate);const e=(tt=(et=(b=(g=h.getPlugin(Lr))==null?void 0:g.exporter)==null?void 0:b.getExporter("gltf","glb"))==null?void 0:et.extensions)==null?void 0:tt.indexOf(iC);return e!==void 0&&e!==-1&&((ct=(at=(st=(rt=h.getPlugin(Lr))==null?void 0:rt.exporter)==null?void 0:st.getExporter("gltf","glb"))==null?void 0:at.extensions)==null||ct.splice(e,1)),super.onRemove(h)}};Nu.PluginType="CustomBumpMapPlugin",Nu.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",iE([Nr("Enabled",h=>({onChange:h.setDirty})),Mn()],Nu.prototype,"enabled",void 0),iE([Nr("Bicubic",h=>({onChange:h.setDirty})),Kr("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,nC.prototype.setDirty),Mn()],Nu.prototype,"bicubicFiltering",void 0),iE([go("Enable CustomBumpMap",h=>({hidden:()=>{var e;return!((e=h._viewer)!=null&&e.getPlugin(vo))}}))],Nu.prototype,"enableCustomBumpSelected",void 0),Nu=nC=iE([Ms("CustomBumpMap Materials")],Nu);class aB{constructor(e){this.parser=e,this.name=Nu.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],g=o.extensions[this.name];i.userData||(i.userData={}),i.userData._hasCustomBump=!0,i.userData._customBumpScale=g.customBumpScale??0;const b=g.customBumpMap;return b&&c.push(s.assignTexture(i.userData,"_customBumpMap",b).then(et=>{et.colorSpace=_.KI_})),Promise.all(c)}}const iC=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const o={index:h.processTexture(e.userData._customBumpMap)};h.applyTextureTransform(o,e.userData._customBumpMap),s.customBumpMap=o}i.extensions[Nu.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=s,h.extensionsUsed[Nu.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var F0,up=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let $o=F0=class extends hs{get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}setTime(h){this._animationTime=Math.max(0,Math.min(h,this._animationDuration))}_wheel({deltaY:h}){this.enabled&&Math.abs(h)>.001&&(this._scrollAnimationState=-1*Math.sign(h))}_drag(h){this.enabled&&this._viewer&&(this.dragAxis==="x"?this._dragAnimationState=h.delta.x*this._viewer.canvas.width/4:this._dragAnimationState=h.delta.y*this._viewer.canvas.height/4)}_postFrame(){var c,g;if(!this._viewer)return;const h=this._viewer,e=this.animateOnScroll,i=this.animateOnDrag;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!e&&!i)return this._lastFrameTime=0,void(this._fadeDisabled&&((c=this._viewer.getPluginByType("FrameFade"))==null||c.enable(F0.PluginType),this._fadeDisabled=!1));if(this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"}),this.autoIncrementTime){const b=(0,_e.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=b-1/30);let et=b-this._lastFrameTime;if(et*=this.animationSpeed,this._lastFrameTime=b,e&&i?et*=(0,_e.absMax)(this._scrollAnimationState,this._dragAnimationState):e?et*=this._scrollAnimationState:i&&(et*=this._dragAnimationState),Math.abs(et)<1e-4)return;const tt=(g=this._viewer.getPluginByType("Progressive"))==null?void 0:g.postFrameConvergedRecordingDelta();if(tt&&tt>0&&(et=tt),tt===0)return;const rt=Math.abs(this.timeScale);this._animationTime+=et*(rt>0?rt:1)}const s=this._animationTime-this._lastAnimationTime;this._lastAnimationTime=this._animationTime;const o=this.timeScale<0?(isFinite(this._animationDuration)?this._animationDuration:0)-this._animationTime:this._animationTime;if(this.animations.map(b=>{b.mixer.setTime(o)}),!(Math.abs(s)<1e-5)){if(Math.abs(this._scrollAnimationState)<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,Math.abs(this._dragAnimationState)<.001?this._dragAnimationState=0:this._dragAnimationState*=1-this.dragAnimationDamping,this.dispatchEvent({type:"animationStep",delta:s,time:o}),h.scene.activeCamera.cameraObject.userData.__animatingCamera&&h.scene.activeCamera.setDirty(),h.scene.refreshActiveCameraNearFar(),h.renderer.resetShadows(),h.setDirty(),!this._fadeDisabled){const b=this._viewer.getPluginByType("FrameFade");b&&(b.disable(F0.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}constructor(){super(),this.enabled=!0,this._lastAnimationTime=0,this.autoIncrementTime=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=1,this.animationSpeed=1,this.animateOnScroll=!1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.animateOnDrag=!1,this.dragAxis="y",this.autoplayOnLoad=!1,this.syncMaxDuration=!1,this._dragAnimationState=0,this.dragAnimationDamping=.3,this.dependencies=[Lr],this._pointerDragHelper=new _e.PointerDragHelper,this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=h=>{const e=h.object;if(e.assetType!=="model"||!e.modelObject||!this._viewer)return;let i=!1;e.modelObject.traverse(s=>{const o=s.animations;if(o.length<1)return;const c=Math.max(...o.map(et=>et.duration));(e.modelObject.userData.gltfAnim_SyncMaxDuration??this.syncMaxDuration)&&(o.forEach(et=>et.duration=c),e.modelObject.userData.gltfAnim_SyncMaxDuration=!0);const g=new _.Xcj(this._viewer.scene.modelRoot.modelObject),b=o.map(et=>g.clipAction(et).setLoop(this.loopAnimations?_.YKA:_.jAl,this.loopRepetitions));b.forEach(et=>et.clampWhenFinished=!0),this.animations.push({mixer:g,clips:o,actions:b,duration:c}),i=!0}),i&&(this._onPropertyChange(!this.autoplayOnLoad),this.autoplayOnLoad&&this.playAnimation())},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this._onPropertyChange=this._onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this._pointerDragHelper.addEventListener("drag",this._drag.bind(this))}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new lB(e,this))}async onAdded(h){var i,s,o,c,g,b;(s=(i=h.getPlugin(Lr))==null?void 0:i.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),h.scene.addEventListener("addSceneObject",this._objectAdded),(b=(g=(c=(o=h.getPlugin(Lr))==null?void 0:o.exporter)==null?void 0:c.getExporter("gltf","glb"))==null?void 0:g.extensions)==null||b.push(cB),h.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),this._pointerDragHelper.element=h.canvas;let e=-1;return Object.defineProperty(h.scene.modelRoot,"currentTimelineMarker",{get:()=>e,set:et=>h.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[e=et]})}),h.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:et})=>{var rt;if(!this._viewer)return;if(!et)return this._viewer.scene.activeCamera=(rt=this._viewer)==null?void 0:rt.scene.defaultCamera,void this._viewer.setDirty();const tt=et.camera;tt&&(tt.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(tt))}),super.onAdded(h)}async onRemove(h){var e,i;for(;this.animations.length;)this.animations.pop();return h.scene.removeEventListener("addSceneObject",this._objectAdded),(i=(e=h.getPlugin(Lr))==null?void 0:e.importer)==null||i.addEventListener("loaderCreate",this._loaderCreate),h.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),this._pointerDragHelper.element=void 0,super.onRemove(h)}_onPropertyChange(h=!0){this._animationDuration=Math.max(...this.animations.map(({duration:e})=>e))*(this.loopAnimations?this.loopRepetitions:1),this._animationState==="playing"&&h&&this.playAnimation()}onStateChange(){var h,e;(e=(h=this.uiConfig)==null?void 0:h.children)==null||e.map(i=>i&&(0,_e.getOrCall)(i)).flat(2).forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)==null?void 0:s.call(i)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(h,e=!1){return this.playClips([h],e)}async playClips(h,e=!1){const i=[];return this.animations.forEach(({actions:s})=>{s.forEach(o=>{h.includes(o.getClip().name)&&i.push(o)})}),this.playAnimation(e,i)}async playAnimation(h=!1,e){var g;if(!this.enabled)return;let i=!1;this._animationState==="playing"&&(this.stopAnimation(!1),i=!0);let s=0;const o=!e;e||(e=[],this.animations.forEach(({mixer:b,actions:et,clips:tt})=>{e.push(...et)})),i?this.resetAnimation():this.animationState!=="paused"&&(e.forEach(b=>{b.reset()}),this._animationTime=0);const c=np();this._lastAnimId=c;for(const b of e)b.setLoop(this.loopAnimations?_.YKA:_.jAl,this.loopRepetitions),b.play(),s=Math.max(s,b.getClip().duration/Math.abs(b.timeScale));if(this._animationState="playing",(g=this._viewer)==null||g.setDirty(),o){if(!isFinite(this._animationDuration))return;await new Promise((b,et)=>{const tt=()=>{this.removeEventListener("checkpointEnd",tt),b()};this.addEventListener("checkpointEnd",tt)})}else{const b=this.loopAnimations?this.loopRepetitions:1;if(s*=b,!isFinite(s))return;await new Promise((et,tt)=>{const rt=st=>{st.time>=s&&(this.removeEventListener("animationStep",rt),et())};this.addEventListener("animationStep",rt)})}c===this._lastAnimId&&this.stopAnimation(h)}pauseAnimation(){var h;this._animationState==="playing"?(this._animationState="paused",(h=this._viewer)==null||h.setDirty()):console.warn("pauseAnimation called when animation was not playing.")}resumeAnimation(){var h;this._animationState==="paused"?(this._animationState="playing",(h=this._viewer)==null||h.setDirty()):console.warn("resumeAnimation called when animation was not paused.")}stopAnimation(h=!1){var e,i;this._animationState="stopped",h?this.resetAnimation():(e=this._viewer)==null||e.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((i=this._viewer.getPluginByType("FrameFade"))==null||i.enable(F0.PluginType),this._fadeDisabled=!1)}resetAnimation(){var h;this._animationState==="stopped"||this._animationState==="none"?(this.animations.forEach(({mixer:e,actions:i,clips:s})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(h=this._viewer)==null||h.setDirty()):this.stopAnimation(!0)}};$o.PluginType="GLTFAnimation",$o.AnimationMarkersExtension="WEBGI_animation_markers",up([Mn()],$o.prototype,"autoIncrementTime",void 0),up([Xm()],$o.prototype,"animationState",null),up([Xm()],$o.prototype,"animationTime",null),up([Xm()],$o.prototype,"animationDuration",null),up([(0,_e.onChange2)(F0.prototype._onPropertyChange),Nr("Loop",{limitedUi:!0}),Mn()],$o.prototype,"loopAnimations",void 0),up([(0,_e.onChange2)(F0.prototype._onPropertyChange),Mn()],$o.prototype,"loopRepetitions",void 0),up([es("Timescale",[-2,2],.01),Mn()],$o.prototype,"timeScale",void 0),up([es("Speed",[.1,4],.1,{limitedUi:!0}),Mn()],$o.prototype,"animationSpeed",void 0),up([Nr(),Mn()],$o.prototype,"animateOnScroll",void 0),up([Nr(),Mn()],$o.prototype,"animateOnDrag",void 0),up([em("Drag Axis",[{label:"x"},{label:"y"}]),Mn()],$o.prototype,"dragAxis",void 0),up([Nr(),Mn()],$o.prototype,"autoplayOnLoad",void 0),up([Nr("syncMaxDuration(dev)"),Mn()],$o.prototype,"syncMaxDuration",void 0),up([(0,_e.onChange)(F0.prototype.onStateChange)],$o.prototype,"_animationState",void 0),up([go("Play/Pause",h=>({label:()=>h.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],$o.prototype,"playPauseAnimation",null),up([go("Stop",{limitedUi:!0})],$o.prototype,"stopAnimation",null),up([go("Reset",{limitedUi:!0})],$o.prototype,"resetAnimation",null),$o=F0=up([Ms("GLTF Animations")],$o);class lB{constructor(e,i){this.parser=e,this.name=$o.AnimationMarkersExtension,this.plugin=i}async afterRoot(e){let i=[];for(const st of this.parser.json.scenes||[]){if(!st.extensions)continue;const at=st.extensions[this.name];for(const ct of(at==null?void 0:at.markers)||[]){const pt=ct.camera!==void 0?await this.parser.getDependency("camera",ct.camera):void 0;ct.time===void 0&&(ct.time=ct.frame/30,console.error("Update timeline markers plugin for correct times.")),i.push({name:ct.name,frame:ct.frame,time:ct.time,camera:pt})}}if(i.length<1)return;i=i.sort((st,at)=>st.frame-at.frame);const s=e.scene??e.scenes[0];if(!s)return;s.userData.__markers=i;const o=this.plugin.timelineMarkers,c=i.map(st=>st.time);let g=o.length;const b=i.map(st=>g++),et=Math.max(...c)+.01;o.push(...i);const tt=new _.dUE(".currentTimelineMarker",c,b,2300),rt=new _.m7l("animationTimelineMarker",et,[tt]);rt.__gltfExport=!1,e.animations.push(rt)}}const cB=h=>({afterParse(e){const i=h.json.scenes[h.json.scene||0];i.extensions=i.extensions||{};const s={markers:[]},o=[];if((Array.isArray(e)?e:[e]).forEach(c=>c.traverse(g=>{g.userData.__markers&&o.push(...g.userData.__markers)})),o.sort((c,g)=>c.frame-g.frame),!(o.length<1)){for(const c of o){const g=c.camera;if(g){const b=h.nodeMap.get(g);if(b===void 0){console.warn("Camera not found in gltf export",g,h.nodeMap);continue}const et=h.json.nodes[b].camera;c.camera=et,s.markers.push(c)}}i.extensions[$o.AnimationMarkersExtension]=s,h.extensionsUsed[$o.AnimationMarkersExtension]=!0}}});var Dx=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,rC=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,aw=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,lw=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,ov=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class Hp extends io{get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}constructor(e,i,s,o=!1){super({vertexShader:om,fragmentShader:`

${lw}
${Dx}
${m_}
${rC}
${s}

${aw}

varying vec2 vUv;uniform float frameCount2;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount2+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount2)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount2<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount2)/(frameCount2+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!o},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},frameCount2:{value:0},projection:{value:new _.yGw},screenSize:{value:new _.FM8},cameraPositionWorld:{value:new _.Pa4},cameraNearFar:{value:new _.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:o?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(c,g,b)=>{var st;if(!c.defines.SSRTAO_ENABLED)return;this.materialExtension.extraUniforms.tSSGIMap.value=(st=this._target)==null?void 0:st.texture;const et=g.materialObject;let tt=this.material.defines.SSGI_ENABLED;et.defines.SSGI_ENABLED!==tt&&(et.defines.SSGI_ENABLED=tt,et.needsUpdate=!0),tt=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==tt&&(this.materialExtension.extraUniforms.tSSGIMap.value=tt,et.needsUpdate=!0);const rt="vec3 totalDiffuse =";c.fragmentShader=c.fragmentShader.replace(rt,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${rt}`),c.fragmentShader=c.fragmentShader.replace("#include <aomap_fragment>",""),c.defines.USE_UV=""},onObjectRender:(c,g,b)=>{var st,at;const et=g.materialObject,tt=!et.transparent&&et.transmission<.001,rt=this.enabled&&tt&&(this.renderWithCamera||this._renderer.frameCount>1)&&b.userData.screenSpaceRendering!==!1&&!((st=et.userData)!=null&&st.ssrtaoDisabled)&&!((at=et.userData)!=null&&at.ssaoDisabled)?1:0;et.defines.SSRTAO_ENABLED!==rt&&(et.defines.SSRTAO_ENABLED=rt,et.needsUpdate=!0)},parsFragmentSnippet:c=>{var g;return _e.glsl`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${rn("tSSGIMap",(g=this._target)==null?void 0:g.texture,c.capabilities.isWebGL2)}

            ${Y1}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:c=>{var g,b,et,tt;return this.enabled?"1":"0"+((b=(g=this._target)==null?void 0:g.texture)==null?void 0:b.colorSpace)+((tt=(et=this._target)==null?void 0:et.texture)==null?void 0:tt.uuid)+this.material.defines.SSGI_ENABLED},isCompatible:c=>{var g;return!((g=c.materialObject.userData)!=null&&g.ssaoDisabled)&&c.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...bv(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=i,this.needsSwap=!0,this._giActivated=o,this.ssgiEnabled=o,this.bilateralPass=new pu(this._target,s,"rgba")}render(e,i,s,o,c){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,i),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,o,c),this.smoothEnabled&&this.bilateralPass.render(e,i,s,o,c))}}ov([Mn()],Hp.prototype,"bilateralPass",void 0),ov([es("Intensity",[0,4]),Mn(),hr()],Hp.prototype,"intensity",void 0),ov([es("Power",[0,3]),Mn(),hr()],Hp.prototype,"power",void 0),ov([Nr("Auto radius"),Mn(),hr()],Hp.prototype,"autoRadius",void 0),ov([es("Object Radius",[.01,10]),Mn(),hr()],Hp.prototype,"objectRadius",void 0),ov([es("Tolerance",[.1,5]),Mn(),hr()],Hp.prototype,"tolerance",void 0),ov([es("Bias",[-.3,.3]),Mn(),hr()],Hp.prototype,"bias",void 0),ov([es("Falloff",[1e-4,4]),Mn(),hr()],Hp.prototype,"falloff",void 0),ov([es("Ray Count",[1,5],1),Mn(),hr()],Hp.prototype,"rayCount",void 0),ov([es("Step count",[1,16],1),Mn(),Kr("RTAO_STEP_COUNT")],Hp.prototype,"stepCount",void 0),ov([Nr("Smooth Enabled"),Mn()],Hp.prototype,"smoothEnabled",void 0),ov([Nr("Render with Camera")],Hp.prototype,"renderWithCamera",void 0);class Ju extends J_{get rtgiTarget(){return this._rtgiTarget}constructor(e=!0){super(),this.dependencies=[Lr,bo,cp],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}async onAdded(e){var i,s;await super.onAdded(e),this.enabled=this._initEnabled,(s=(i=this.uiConfig).uiRefresh)==null||s.call(i,"postFrame",!0)}get enabled(){var e,i;return((i=(e=this.passes.ssrtgi)==null?void 0:e.passObject)==null?void 0:i.enabled)||!1}set enabled(e){var i;(i=this.passes.ssrtgi)!=null&&i.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var i,s;return this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1}),(i=this._viewer)==null||i.getPluginByType("debug"),[Vo(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Hp(e.renderer,this._rtgiTarget,((s=e.getPlugin(bo))==null?void 0:s.getUnpackSnippet())??"",!0),update:()=>{var c;const o=this.enabled;if(o){const g=(c=this._viewer)==null?void 0:c.getPluginByType("SSAO");g!=null&&g.enabled&&(g.enabled=!1)}o&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(bo)])}},()=>[e.getPlugin(bo),e.getPlugin(cp),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var i,s,o,c;const e=((s=(i=this.passes.ssrtgi)==null?void 0:i.passObject)==null?void 0:s.uiConfig)??{};return(c=(o=e.children)==null?void 0:o.map(g=>(0,_e.getOrCall)(g)))==null||c.flat(2).forEach(g=>g&&(g.onChange=this.setDirty)),e}}Ju.PluginType="SSGI";let j0=class extends Km{constructor(h,e,i){super(h,e,i??new sT,new zo(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(h,e,i,s,o){this.enabled&&super.render(h,e,i,s,o)}};j0=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g}([Ms("High precision Normal Buffer")],j0);class sT extends _.RSm{constructor(){super()}onBeforeRender(e,i,s,o,c){let g=c.material;Array.isArray(g)&&(g=g[0]),this.normalMap=(g==null?void 0:g.normalMap)??null,this.bumpMap=(g==null?void 0:g.bumpMap)??null,this.bumpScale=g==null?void 0:g.bumpScale,g!=null&&g.normalScale&&this.normalScale.copy(g==null?void 0:g.normalScale),this.needsUpdate=!0,this.side=g.side??_.ehD}}class av extends Tm{passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:_.cLu,minFilter:_.TyD,magFilter:_.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const i=this._normalTarget,s=new Set,o=new Set;return new class extends j0{render(c,g,b,et,tt){const rt=c.getRenderTarget(),st=c.getActiveCubeFace(),at=c.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:ct})=>{ct&&((ct.transparent&&ct.userData.renderToDepth||!ct.transparent&&ct.transmission===0&&ct.userData.renderToDepth===!1)&&(s.add(ct),ct.transparent=!ct.transparent),Math.abs(ct.transmission||0)>0&&ct.userData.renderToDepth&&(o.add([ct,ct.transmission]),ct.transmission=0))}),no(c,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(c,g,i,et,tt)),s.forEach(ct=>ct.transparent=!ct.transparent),s.clear(),o.forEach(([ct,pt])=>ct.transmission=pt),o.clear(),c.setRenderTarget(rt,st,at))}}}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,i.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var i,s;return e.renderer.disposeTarget((s=(i=this._normalTarget)==null?void 0:i.dispose)==null?void 0:s.call(i)),super.onRemove(e)}updateShaderProperties(e){var i;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled?((i=this.getNormalBuffer())==null?void 0:i.texture)??null:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}av.PluginType="NormalBufferPlugin";var cw=function(h,e){return cw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(i[o]=s[o])},cw(h,e)};function Vy(h,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=h}cw(h,e),h.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var Gy,Hy=function(){function h(){}return h._xfnv1a=function(e){for(var i=2166136261,s=0;s<e.length;s++)i=Math.imul(i^e.charCodeAt(s),16777619);return function(){return i+=i<<13,i^=i>>>7,i+=i<<3,i^=i>>>17,(i+=i<<5)>>>0}},h}(),rE=function(h){function e(i){var s=h.call(this)||this;return s.a=e._xfnv1a(i)(),s}return Vy(e,h),e.prototype.next=function(){var i=this.a+=1831565813;return i=Math.imul(i^i>>>15,1|i),(((i^=i+Math.imul(i^i>>>7,61|i))^i>>>14)>>>0)/4294967296},e}(Hy),L2=function(h){function e(i){var s=h.call(this)||this,o=e._xfnv1a(i);return s.a=o(),s.b=o(),s.c=o(),s.d=o(),s}return Vy(e,h),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var i=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,i=i+this.d|0,this.c=this.c+i|0,(i>>>0)/4294967296},e}(Hy),sC=function(h){function e(i){var s=h.call(this)||this,o=e._xfnv1a(i);return s.a=o(),s.b=o(),s.c=o(),s.d=o(),s}return Vy(e,h),e.prototype.next=function(){var i=this.b<<9,s=5*this.a;return s=s<<7|9*(s>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=i,this.d=this.d<<11|this.d>>>21,(s>>>0)/4294967296},e}(Hy);(function(h){h.sfc32="sfc32",h.mulberry32="mulberry32",h.xoshiro128ss="xoshiro128ss"})(Gy||(Gy={}));var sE=function(){function h(e,i){i===void 0&&(i=Gy.sfc32),this.str=e,this.prng=i,this.generator=this._initializeGenerator()}return h.prototype.next=function(){return this.generator.next()},h.prototype._initializeGenerator=function(){if(function(i){return i===null}(e=this.str)||function(i){return i===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new L2(this.str);case"mulberry32":return new rE(this.str);case"xoshiro128ss":return new sC(this.str);default:return this.wrap()}},h.prototype.wrap=function(){return{next:function(){return Math.random()}}},h}(),oE=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class kx extends _g{constructor(e,i,s,o){super(e,i),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new _.Pa4(10,10,10),normalDirection:new _.Pa4(.01,.98,.01).normalize(),direction:new _.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=s??{},this.randomParams=o??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,i=null,s=null){const o=new sE(e.toString()),c=new _.FM8(o.next()*Math.PI*2,Math.asin(2*o.next()-1));let g=new _.Pa4(Math.cos(c.x)*Math.cos(c.y),Math.sin(c.y),Math.sin(c.x)*Math.cos(c.y));const b=new _.FM8;for(let et=0;et<5;et++){b.set(o.next(),o.next()),g=oC(b,this._randomParams.normalDirection,.4),o.next()<Math.sqrt(i??this._randomParams.focus)&&(b.set(o.next(),o.next()),g=oC(b,this._randomParams.direction,Math.pow((s??this._randomParams.spread)/2,2)));const tt=g.dot(this._randomParams.normalDirection);if(tt>0&&tt<.4)break}g.normalize(),g.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(g.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new _.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,i){return super.fromJSON(e,i)?(this.updateShadowParams(),this):null}}function oC(h,e,i){e=e.clone().normalize();const s=new _.Pa4(0,-e.z,e.y).normalize(),o=new _.Pa4().crossVectors(e,s).normalize(),c=h;c.x=2*c.x*Math.PI,c.y=1-c.y*i;const g=Math.sqrt(1-c.y*c.y);return s.multiplyScalar(Math.cos(c.x)*g).add(o.multiplyScalar(Math.sin(c.x)*g)).add(e.multiplyScalar(c.y))}oE([Mn("shadowParams")],kx.prototype,"_shadowParams",void 0),oE([Mn("randomParams")],kx.prototype,"_randomParams",void 0);var aC=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class z0 extends hs{get cameraHelper(){return this._cameraHelper}constructor(e=!0){super(),this.enabled=!0,this.light=new kx("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var s,o;if(!this.enabled)return void(this.light.layers.mask=0);const i=((s=this._viewer)==null?void 0:s.renderer.frameCount)??0;this.light.randomizePosition(i<5?0:i),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(o=this._cameraHelper)==null||o.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}async onAdded(e){await super.onAdded(e),this._cameraHelper=new _.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var i,s;e?(i=this._viewer)==null||i.scene.setDirty():(s=this._viewer)==null||s.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.05,.05],property:[this.light.shadowParams,"normalBias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}z0.PluginType="RandomizedDirectionalLight",aC([Mn()],z0.prototype,"enabled",void 0),aC([Mn("rdLight")],z0.prototype,"light",void 0),aC([Mn()],z0.prototype,"lightLayers",void 0);var aE=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,Nm=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let Um=class extends io{constructor(h,e,i,s=!0){super({vertexShader:om,fragmentShader:`

varying vec2 vUv;

${lw}
${Dx}
${m_}
${rC}
${i}

${aw}

${aE}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new _.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new _.yGw},cameraPositionWorld:{value:new _.Pa4},cameraNearFar:{value:new _.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:s?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(o,c,g)=>{var tt,rt,st;let b=this.enabled&&g.userData.screenSpaceRendering!==!1&&!((tt=c.materialObject.userData)!=null&&tt.ssreflDisabled)?1:0;if(c.materialObject.defines.SSR_ENABLED!==b&&(c.materialObject.defines.SSR_ENABLED=b,c.materialObject.needsUpdate=!0),!o.defines.SSR_ENABLED)return;b=this.material.defines.SSR_STEP_COUNT,c.materialObject.defines.SSR_STEP_COUNT!==b&&(c.materialObject.defines.SSR_STEP_COUNT=b,c.materialObject.needsUpdate=!0),b=this.material.defines.SSR_LOW_QUALITY_FRAMES,c.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==b&&(c.materialObject.defines.SSR_LOW_QUALITY_FRAMES=b,c.materialObject.needsUpdate=!0),b=this.material.defines.PERSPECTIVE_CAMERA,c.materialObject.defines.PERSPECTIVE_CAMERA!==b&&(c.materialObject.defines.PERSPECTIVE_CAMERA=b,c.materialObject.needsUpdate=!0),b=this.material.defines.SSR_INLINE,c.materialObject.defines.SSR_INLINE!==b&&(c.materialObject.defines.SSR_INLINE=b,c.materialObject.needsUpdate=!0),b=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,c.materialObject.defines.SSR_MASK_FRONT_RAYS!==b&&(c.materialObject.defines.SSR_MASK_FRONT_RAYS=b,c.materialObject.needsUpdate=!0),b=(rt=c.materialObject.userData)!=null&&rt.ssreflNonPhysical?"1":"0",c.materialObject.defines.SSR_NON_PHYSICAL!==b&&(c.materialObject.defines.SSR_NON_PHYSICAL=b,c.materialObject.needsUpdate=!0),b=((st=this._target)==null?void 0:st.texture)??null,this.materialExtension.extraUniforms.tSSRMap.value!==b&&(this.materialExtension.extraUniforms.tSSRMap.value=b,c.materialObject.needsUpdate=!0);const et="#glMarker beforeModulation";o.fragmentShader=o.fragmentShader.replace(et,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${et}`)},onObjectRender:(o,c,g)=>{var et;const b=this.enabled&&g.userData.screenSpaceRendering!==!1&&!((et=c.materialObject.userData)!=null&&et.ssreflDisabled)?1:0;c.materialObject.defines.SSR_ENABLED!==b&&(c.materialObject.defines.SSR_ENABLED=b,c.materialObject.needsUpdate=!0)},parsFragmentSnippet:(o,c)=>{var g,b;return!this.enabled||o.userData.screenSpaceRendering===!1||(g=c==null?void 0:c.materialObject.userData)!=null&&g.ssreflDisabled?"":`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+rn("tSSRMap",(b=this._target)==null?void 0:b.texture,o.capabilities.isWebGL2)+rn("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,o.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${lw}
    
    #define THREE_PACKING_INCLUDED
    ${Dx}
    
    ${m_}
    ${rC}
    ${bp}
    
    ${aw}
    
    ${aE}
// #endif // SSR_INLINE
#endif
`:"")+`
${Y1}
        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:o=>{var c,g,b;return this.enabled?"1":"0"+((g=(c=this._target)==null?void 0:c.texture)==null?void 0:g.colorSpace)+(this.enabled&&!((b=o.materialObject.userData)!=null&&b.ssreflDisabled)?1:0)+Object.values(this.material.defines).map(et=>et+"").join(",")},isCompatible:o=>{var c;return!((c=o.materialObject.userData)!=null&&c.ssreflDisabled)&&o.isMeshStandardMaterial2}},this.intensity=1,this.boost=new _.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=h,this._target=e,this.needsSwap=!1,this._inline=s}render(h,e,i,s,o){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(h,this._target,i,s,o),this.needsSwap=!1}}};Nm([es("Intensity",[0,4]),Mn(),hr()],Um.prototype,"intensity",void 0),Nm([ip("Boost"),Mn(),hr()],Um.prototype,"boost",void 0),Nm([es("Object Radius",[.01,2]),Mn(),hr()],Um.prototype,"objectRadius",void 0),Nm([Nr("Auto radius"),Mn(),hr()],Um.prototype,"autoRadius",void 0),Nm([es("Power",[0,3]),Mn(),hr()],Um.prototype,"power",void 0),Nm([es("Tolerance",[.1,5]),Mn(),hr()],Um.prototype,"tolerance",void 0),Nm([es("Step count",[1,32],1),Mn(),Kr("SSR_STEP_COUNT")],Um.prototype,"stepCount",void 0),Nm([es("Low Quality Frames",[0,4],1),Mn(),Kr("SSR_LOW_QUALITY_FRAMES")],Um.prototype,"lowQualityFrames",void 0),Nm([Nr("Ignore front rays"),Mn(),Kr("SSR_MASK_FRONT_RAYS")],Um.prototype,"maskFrontRays",void 0),Nm([es("Mask front rays factor",[-1,1],.01,h=>({hidden:()=>!h.maskFrontRays})),Mn(),hr()],Um.prototype,"maskFrontFactor",void 0),Um=Nm([Ms("Screen Space Reflections")],Um);class Bx extends J_{get ssrTarget(){return this._ssrTarget}constructor(){super(),this.dependencies=[Lr,bo,cp],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get enabled(){var e,i;return((i=(e=this.passes.ssr)==null?void 0:e.passObject)==null?void 0:i.enabled)||!1}set enabled(e){var i;(i=this.passes.ssr)!=null&&i.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var i,s;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(s=(i=this.uiConfig).uiRefresh)==null||s.call(i,"postFrame",!0)}createPasses(e){var i;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[Vo(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Um(e.renderer,this._ssrTarget,((i=e.getPlugin(bo))==null?void 0:i.getUnpackSnippet())??"",this.inlineSSR)},()=>[e.getPlugin(bo),e.getPlugin(cp),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var i,s,o,c;const e=((s=(i=this.passes.ssr)==null?void 0:i.passObject)==null?void 0:s.uiConfig)??{};return(c=(o=e.children)==null?void 0:o.map(g=>(0,_e.getOrCall)(g)))==null||c.flat(2).forEach(g=>g&&(g.onChange=this.setDirty)),e}}Bx.PluginType="SSReflection";var lC=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let am=class extends hs{makeAnisotropic(h){var i;const e=(i=h.materialObject)==null?void 0:i.userData;if(!e)return!1;if(e._isAnisotropic===void 0){const s=e.__appliedMeshes;let o=!0;if(s)for(const{geometry:c}of s)!c||c.index&&c.attributes.position&&c.attributes.normal&&c.attributes.uv||(o=!1),o&&!c.attributes.tangent&&c.computeTangents();if(!o)return!1}return e._isAnisotropic=!0,e._anisotropyFactor===void 0&&(e._anisotropyFactor=1),e._anisotropyNoise===void 0&&(e._anisotropyNoise=0),e._anisotropyDirectionMode===void 0&&(e._anisotropyDirectionMode="DIRECTION"),h.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new N2(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Lr],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(h,e,i)=>{var b;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const s=(b=e.materialObject.userData)==null?void 0:b._anisotropyDirectionMap,o=_e.glsl`
                //#if ANISOTROPY_ENABLED
                ${m_}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(s?rn("anisotropyDirectionMap",s,i.capabilities.isWebGL2):"")+`
`;h.fragmentShader=rs(h.fragmentShader,"#include <common>",o,{append:!0}),h.fragmentShader=h.fragmentShader.replace("#include <lights_fragment_begin>",_.WdD.lights_fragment_begin),h.fragmentShader=rs(rs(h.fragmentShader,"IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tbn[0]*rot2.x+tbn[1]*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));`,{prepend:!0}),"RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )",{replaceAll:!0});let c=rs(_.WdD.lights_physical_pars_fragment,"void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {");c=rs(c,"BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )"),h.fragmentShader=rs(h.fragmentShader,"#include <lights_physical_pars_fragment>",c),h.fragmentShader=rs(h.fragmentShader,"#include <normal_fragment_begin>",_.WdD.normal_fragment_begin),h.fragmentShader=rs(h.fragmentShader,"#ifdef USE_NORMALMAP_TANGENTSPACE","#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_TANGENT )");let g=_e.glsl`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+_.WdD.lights_fragment_maps;g=rs(g,"getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )"),g=rs(g,"getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )"),h.fragmentShader=rs(h.fragmentShader,"#include <lights_fragment_maps>",g),h.defines.USE_UV="",h.vertexTangents=!0},onObjectRender:(h,e)=>{var c;const i=e.materialObject.userData;if(!(i!=null&&i._isAnisotropic))return;const s=h;if(!s.isMesh||!s.geometry)return;if(!s.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=i._anisotropyFactor,this._uniforms.anisotropyNoise.value=i._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=(c=i._anisotropyDirectionMap)!=null&&c.isTexture?i._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=i._anisotropyDirection;let o=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==o&&(e.materialObject.defines.ANISOTROPY_ENABLED=o,e.materialObject.needsUpdate=!0),o=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==o&&(e.materialObject.defines.ANISOTROPY_DEBUG=o,e.materialObject.needsUpdate=!0),o=i._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(o="CONSTANT"),o=o==="DIRECTION"?2:o==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==o&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=o,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i,s;return(this.enabled?"1":"0")+((e=h.materialObject.userData)!=null&&e._isAnisotropic?"1":"0")+((s=(i=h.materialObject.userData)==null?void 0:i._anisotropyDirectionMap)==null?void 0:s.uuid)},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>{var h;return[(h=this._viewer)==null?void 0:h.renderer]},getUiConfig:h=>{const e=this._viewer,i=this.makeAnisotropic,s={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return h.materialObject.userData._isAnisotropic||!1},set value(o){var c;o!==h.materialObject.userData._isAnisotropic&&(o?i(h)||e.alert("One or more geometries cannot be made anisotropic."):(h.materialObject.userData._isAnisotropic=!1,h.materialObject.needsUpdate=!0),(c=s.uiRefresh)==null||c.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{h.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(o=>({label:o})),onChange:()=>{h.materialObject.needsUpdate=!0,this.setDirty()}}]};return s}},this.setDirty=()=>{var h,e,i;(e=(h=this.materialExtension).setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()},this.makeSelectedAnisotropic=()=>{var e,i,s;const h=(s=(i=(e=this._viewer)==null?void 0:e.getPlugin(vo))==null?void 0:i.getSelectedObject())==null?void 0:s.material;return(h==null?void 0:h.assetType)==="material"&&this.makeAnisotropic(h)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,g;await super.onAdded(h);const e=h.getPlugin(Lr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(g=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||g.push(uB)}async onRemove(h){var e,i,s,o;return(i=(e=h.getPlugin(Lr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),(o=(s=h.getPlugin(Lr))==null?void 0:s.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};am.PluginType="AnisotropyPlugin",am.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",lC([Nr("Enabled",h=>({onChange:h.setDirty})),Mn()],am.prototype,"enabled",void 0),lC([go("Make Anisotropy",h=>({hidden:()=>{var e;return!((e=h._viewer)!=null&&e.getPlugin(vo))}}))],am.prototype,"makeSelectedAnisotropic",void 0),am=lC([Ms("Anisotropy Materials")],am);class N2{constructor(e){this.parser=e,this.name=am.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],g=o.extensions[this.name];i.userData||(i.userData={}),i.userData._isAnisotropic=!0,i.userData._anisotropyFactor=g.anisotropyFactor??0,i.userData._anisotropyNoise=g.anisotropyNoiseFactor??g.anisotropyNoise??0;let{anisotropyDirectionMode:b,anisotropyDirection:et}=g;return b||(b=g.anisotropyTextureMode),et||(et=g.anisotropyRotation),i.userData._anisotropyDirectionMode=b&&typeof(et==null?void 0:et.index)=="number"?b:"CONSTANT",b==="ROTATION"||b==="DIRECTION"?c.push(s.assignTexture(i.userData,"_anisotropyDirectionMap",et).then(tt=>{tt.colorSpace=_.KI_})):i.userData._anisotropyDirection=et??0,Promise.all(c)}afterRoot(e){var i;return(i=e.scene)==null||i.traverse(s=>{var g,b;if(!((b=(g=s.material)==null?void 0:g.userData)==null?void 0:b._isAnisotropic))return;const c=s.geometry;c.attributes.tangent||(c.computeTangents(),c.attributes.tangent.needsUpdate=!0)}),null}}const uB=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.anisotropyFactor=e.userData._anisotropyFactor||1,s.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,s.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&s.anisotropyDirectionMode!=="CONSTANT"){const o={index:h.processTexture(e.userData._anisotropyDirectionMap)};h.applyTextureTransform(o,e.userData._anisotropyDirectionMap),s.anisotropyDirection=o}else s.anisotropyDirectionMode="CONSTANT",s.anisotropyDirection=e.userData._anisotropyDirection||0;i.extensions[am.ANISOTROPY_GLTF_EXTENSION]=s,h.extensionsUsed[am.ANISOTROPY_GLTF_EXTENSION]=!0}});var cC,uw=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let Fm=cC=class extends hs{static AddFragmentClipping(h,e,i,s,o){var b;const c=(b=h.materialObject)==null?void 0:b.userData;if(!c)return!1;c._fragmentClippingExt||(c._fragmentClippingExt={});const g=c._fragmentClippingExt;return g.clipEnabled=!0,g.clipPosition===void 0&&(g.clipPosition=(e==null?void 0:e.toArray())??[0,0,0,0]),g.clipParams===void 0&&(g.clipParams=(i==null?void 0:i.toArray())??[1,0,0,0]),g.clipMode===void 0&&(g.clipMode=s??hp.Circle),g.clipInvert===void 0&&(g.clipInvert=o??!1),h.materialObject.isMaterial&&(h.needsUpdate=!0),!0}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new Ox(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Lr,bo],this._plane=new _.JOQ,this._viewNormalMatrix=new _.Vkp,this._defines={FRAG_CLIPPING_DEBUG:!1},this._uniforms={fragClippingPosition:{value:new _.Ltg},fragClippingParams:{value:new _.Ltg},fragClippingCamAspect:{value:1}},this.materialExtension={parsFragmentSnippet:(h,e)=>{var i;return this.enabled&&((i=e==null?void 0:e.materialObject.userData._fragmentClippingExt)!=null&&i.clipEnabled)?Y1+_e.glsl`
uniform vec4 fragClippingPosition;
uniform vec4 fragClippingParams;
uniform float fragClippingCamAspect;
#if FRAG_CLIPPING_MODE == ${hp.Circle}
float fragClippingCircle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    float radius = fragClippingParams.x;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#elif FRAG_CLIPPING_MODE == ${hp.Ellipse}
float fragClippingEllipse(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length((pos - center) / radius) - 1.0;
}
#elif FRAG_CLIPPING_MODE == ${hp.Rectangle}
float fragClippingRectangle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    vec2 d = abs(pos - center) - radius;
    return min(max(d.x,d.y),0.0) + length(max(d,0.0));
}
#elif FRAG_CLIPPING_MODE == ${hp.Plane}
float fragClippingPlane(){
    vec3 pos = vViewPosition.xyz;
    vec3 normal = fragClippingParams.xyz;
    float d = dot(pos, normal) - fragClippingParams.w;
    return d;
}
#elif FRAG_CLIPPING_MODE == ${hp.Sphere}
float fragClippingSphere(){
    vec3 pos = vViewPosition.xyz;
    vec3 center = fragClippingPosition.xyz;
    float radius = fragClippingParams.x;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#endif
        `:""},shaderExtender:(h,e,i)=>{var s;this.enabled&&((s=e.materialObject.userData._fragmentClippingExt)!=null&&s.clipEnabled)&&(h.fragmentShader=rs(h.fragmentShader,"#glMarker mainStart",_e.glsl`
    float fragClippingDist = 0.0;
    #if FRAG_CLIPPING_MODE == ${hp.Circle}
    fragClippingDist = fragClippingCircle();
    #elif FRAG_CLIPPING_MODE == ${hp.Ellipse}
    fragClippingDist = fragClippingEllipse();
    #elif FRAG_CLIPPING_MODE == ${hp.Rectangle}
    fragClippingDist = fragClippingRectangle();
    #elif FRAG_CLIPPING_MODE == ${hp.Plane}
    fragClippingDist = fragClippingPlane();
    #elif FRAG_CLIPPING_MODE == ${hp.Sphere}
    fragClippingDist = fragClippingSphere();
    #endif
    #if FRAG_CLIPPING_DEBUG
    gl_FragColor = vec4(max(fragClippingDist, 0.0), 0.0, 0.0, 1.0); 
//    gl_FragColor = vec4(vViewPosition.xyz, 1.0);
    #include <encodings_fragment>
    return;
    #endif
    
    #if FRAG_CLIPPING_INVERSE == 1
    if (fragClippingDist > 0.0) discard;
    #else
    if (fragClippingDist < 0.0) discard;
    #endif
            `,{append:!0}))},onObjectRender:(h,e)=>{var o,c,g,b,et,tt;let i=(o=e.materialObject.userData)==null?void 0:o._fragmentClippingExt;if(e.materialObject.userData.isGBufferMaterial&&h&&(i=(g=(c=h.material)==null?void 0:c.userData)==null?void 0:g._fragmentClippingExt),!(i!=null&&i.clipEnabled))return;if(this._uniforms.fragClippingPosition.value.fromArray(i.clipPosition),i.clipMode===hp.Plane){const rt=(b=this._viewer)==null?void 0:b.scene.activeCamera.cameraObject.matrixWorldInverse;this._plane.normal.set(i.clipParams[0],i.clipParams[1],i.clipParams[2]),this._plane.constant=i.clipParams[3],this._viewNormalMatrix.getNormalMatrix(rt),this._plane.applyMatrix4(rt,this._viewNormalMatrix),this._uniforms.fragClippingParams.value.set(this._plane.normal.x,this._plane.normal.y,this._plane.normal.z,this._plane.constant)}else this._uniforms.fragClippingParams.value.fromArray(i.clipParams);((et=this._viewer)==null?void 0:et.scene.activeCamera.cameraObject)instanceof _.cPb?this._uniforms.fragClippingCamAspect.value=(tt=this._viewer)==null?void 0:tt.scene.activeCamera.cameraObject.aspect:this._uniforms.fragClippingCamAspect.value=1;let s=this.enabled?1:0;s=+this._defines.FRAG_CLIPPING_DEBUG,e.materialObject.defines.FRAG_CLIPPING_DEBUG!==s&&(e.materialObject.defines.FRAG_CLIPPING_DEBUG=s,e.materialObject.needsUpdate=!0),s=+i.clipMode,e.materialObject.defines.FRAG_CLIPPING_MODE!==s&&(e.materialObject.defines.FRAG_CLIPPING_MODE=s,e.materialObject.needsUpdate=!0),s=+i.clipInvert,e.materialObject.defines.FRAG_CLIPPING_INVERSE!==s&&(e.materialObject.defines.FRAG_CLIPPING_INVERSE=s,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i;return(this.enabled?"1":"0")+((i=(e=h.materialObject.userData)==null?void 0:e._fragmentClippingExt)!=null&&i.clipEnabled?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2||h.userData.isGBufferMaterial,updaters:()=>[],getUiConfig:h=>{const e=this._viewer,i={type:"folder",label:"FragmentClipping",children:[{type:"checkbox",label:"Enabled",getValue:()=>{var s;return((s=h.materialObject.userData._fragmentClippingExt)==null?void 0:s.clipEnabled)||!1},setValue:s=>{var o,c;s!==((o=h.materialObject.userData._fragmentClippingExt)==null?void 0:o.clipEnabled)&&(s?cC.AddFragmentClipping(h.materialObject)||e.alert("Cannot add fragment clipping extension."):h.materialObject.userData._fragmentClippingExt&&(h.materialObject.userData._fragmentClippingExt.clipEnabled=!1,h.materialObject.needsUpdate=!0),(c=i.uiRefresh)==null||c.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"dropdown",label:"Mode",children:Object.entries(hp).map(s=>({label:s[0],value:s[1]})),hidden:()=>{var s;return!((s=h.materialObject.userData._fragmentClippingExt)!=null&&s.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipMode"],onChange:this.setDirty}),()=>({type:"vec4",label:"Position",bounds:[-1,1],hidden:()=>{var s;return!((s=h.materialObject.userData._fragmentClippingExt)!=null&&s.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipPosition"],onChange:this.setDirty}),()=>({type:"vec4",label:"Params",bounds:[0,1],hidden:()=>{var s;return!((s=h.materialObject.userData._fragmentClippingExt)!=null&&s.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipParams"],onChange:this.setDirty}),()=>({type:"toggle",label:"Invert",hidden:()=>{var s;return!((s=h.materialObject.userData._fragmentClippingExt)!=null&&s.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipInvert"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var h,e,i;(e=(h=this.materialExtension).setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,g,b,et;await super.onAdded(h);const e=h.getPlugin(Lr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(g=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||g.push(U2),(et=(b=h.getPlugin(bo))==null?void 0:b.material)==null||et.registerMaterialExtensions([this.materialExtension])}async onRemove(h){var e,i,s,o;return(i=(e=h.getPlugin(Lr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),(o=(s=h.getPlugin(Lr))==null?void 0:s.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};var hp;Fm.PluginType="FragmentClippingExtensionPlugin1",Fm.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION="WEBGI_materials_fragment_clipping_extension",uw([Nr("Enabled",h=>({onChange:h.setDirty})),Mn()],Fm.prototype,"enabled",void 0),Fm=cC=uw([Ms("FragmentClipping Materials")],Fm),function(h){h[h.Circle=0]="Circle",h[h.Ellipse=1]="Ellipse",h[h.Rectangle=2]="Rectangle",h[h.Plane=3]="Plane",h[h.Sphere=4]="Sphere"}(hp||(hp={}));class Ox{constructor(e){this.parser=e,this.name=Fm.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return i.userData||(i.userData={}),Fm.AddFragmentClipping(i),i.userData._fragmentClippingExt=Oo(o,i.userData._fragmentClippingExt,!1,{}),Promise.resolve()}}const U2=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._fragmentClippingExt||!e.userData._fragmentClippingExt.clipEnabled)return;i.extensions=i.extensions||{};const s=To(e.userData._fragmentClippingExt,!1);i.extensions[Fm.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=s,h.extensionsUsed[Fm.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=!0}});var Lx,Qy=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let Qp=Lx=class extends hs{constructor(h=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this.originPosition=new _.Pa4(0,0,0),this._paramsChanged=this._paramsChanged.bind(this),this.enabled=h,this.addEventListener("deserialize",this._paramsChanged)}_paramsChanged(){var s,o,c;if(!this._viewer)return;const h=this._viewer.scene.background;if(this.enabled&&h!==this._viewer.scene.environment&&h!=="environment")if(h&&h.isDataTexture)h.mapping=_.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const g=this._viewer.getPluginByType("SimpleBackgroundEnvUiPlugin1");g?(g.envmapBg=!0,(o=(s=g.uiConfig).uiRefresh)==null||o.call(s,"postFrame",!0)):this._viewer.scene.setBackground("environment")}else this.enabled=!1;const e=(c=this._viewer.renderer.rendererObject.background.getBoxMesh2())==null?void 0:c.material,i=(e==null?void 0:e.uniforms)??_.Vj0.backgroundCube.uniforms;i.tripodHeight||(i.tripodHeight={value:1}),i.worldRadius||(i.worldRadius={value:1}),i.originPosition||(i.originPosition={value:new _.Pa4}),i.tripodHeight.value=this.tripodHeight,i.worldRadius.value=this.worldRadius,i.originPosition.value.copy(this.originPosition),e&&(!this.enabled&&e.defines.HDRi_GROUND_PROJ?delete e.defines.HDRi_GROUND_PROJ:this.enabled&&(e.defines.HDRi_GROUND_PROJ="1"),e.needsUpdate=!0),this._viewer.setDirty()}async onAdded(h){var e,i,s;await super.onAdded(h),(s=(i=(e=this._viewer)==null?void 0:e.renderer)==null?void 0:i.rendererObject)!=null&&s.background.getBoxMesh()&&h.console.error("HDRi Ground Plugin must be added before setting any cube or env map"),_.Vj0.backgroundCube.fragmentShader.includes("#ifdef HDRi_GROUND_PROJ")||(_.Vj0.backgroundCube.fragmentShader=rs(_.Vj0.backgroundCube.fragmentShader,"void main() {",`#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;uniform vec3 originPosition;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,originPosition,worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),originPosition+vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif
`,{prepend:!0}),_.Vj0.backgroundCube.fragmentShader=rs(_.Vj0.backgroundCube.fragmentShader,"vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`)),h.scene.addEventListener("environmentChanged",this._paramsChanged)}};Qp.PluginType="HDRiGroundPlugin",Qy([Mn(),(0,_e.onChange)(Lx.prototype._paramsChanged),Nr("Enabled")],Qp.prototype,"enabled",void 0),Qy([Mn(),(0,_e.onChange)(Lx.prototype._paramsChanged),es("World Radius",[1,1e3],.01)],Qp.prototype,"worldRadius",void 0),Qy([Mn(),(0,_e.onChange)(Lx.prototype._paramsChanged),es("Tripod height",[0,50],.01)],Qp.prototype,"tripodHeight",void 0),Qy([Mn(),(0,_e.onChange)(Lx.prototype._paramsChanged),ip("Origin Position",void 0,.001,h=>({onChange:h._paramsChanged}))],Qp.prototype,"originPosition",void 0),Qp=Lx=Qy([Ms("HDRi Ground")],Qp);var v_,Wy=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let Tp=v_=class extends hs{constructor(h=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[bo,Lr],this.materialExtension={shaderExtender:(e,i,s)=>{if(!e.defines.SSCS_ENABLED)return;const o=_e.glsl`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,c=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${lw}
    
    #define THREE_PACKING_INCLUDED
    ${Dx}
    
    ${bp}
    ${m_}
    
    ${aw}

#endif
            
            `+_.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${o}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",c),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",_.WdD.lights_fragment_begin),e.fragmentShader=rs(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;"),e.fragmentShader=rs(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,i,s)=>{var g;const o=i.materialObject;let c=this.enabled&&s.userData.screenSpaceRendering!==!1&&!((g=o.userData)!=null&&g.sscsDisabled)?1:0;o.defines.SSCS_ENABLED!==c&&(o.defines.SSCS_ENABLED=c,o.needsUpdate=!0),c=this._defines.SSCS_STEP_COUNT,o.defines.SSCS_STEP_COUNT!==c&&(o.defines.SSCS_STEP_COUNT=c,o.needsUpdate=!0),c=+this._defines.SSCS_DEBUG,o.defines.SSCS_DEBUG!==c&&(o.defines.SSCS_DEBUG=c,o.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...v_._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,i,s,o,c;return[(e=this._viewer)==null?void 0:e.getPlugin(bo),(i=this._viewer)==null?void 0:i.getPlugin(cp),(s=this._viewer)==null?void 0:s.scene.renderCamera,(o=this._viewer)==null?void 0:o.renderer,(c=this._viewer)==null?void 0:c.scene]}},this.enabled=h,this.userData={setDirty:()=>{var e;(e=this._viewer)==null||e.setDirty()}}}async onAdded(h){var e,i;await super.onAdded(h),(i=(e=h.getPlugin(Lr))==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension)}async onRemove(h){var e,i;return(i=(e=h.getPlugin(Lr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),super.onRemove(h)}};Tp.PluginType="SSContactShadows",Tp._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new _.yGw},cameraPositionWorld:{value:new _.Pa4},cameraNearFar:{value:new _.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},Wy([Nr("Enabled"),Mn()],Tp.prototype,"enabled",void 0),Wy([hr({uniforms:v_._uniforms,propKey:"sscsRadius"}),es("Radius",[1e-4,.1],1e-4),Mn()],Tp.prototype,"radius",void 0),Wy([hr({uniforms:v_._uniforms,propKey:"sscsIntensity"}),es("Intensity",[1e-4,1],1e-4),Mn()],Tp.prototype,"intensity",void 0),Wy([hr({uniforms:v_._uniforms,propKey:"sscsTolerance"}),es("Tolerance",[.1,5]),Mn()],Tp.prototype,"tolerance",void 0),Wy([Kr("SSCS_DEBUG",void 0,!0),Nr("Debug only SSCS"),Mn()],Tp.prototype,"onlySSCSDebug",void 0),Wy([Kr("SSCS_STEP_COUNT",void 0,!0),es("Step count",[1,8],1),Mn()],Tp.prototype,"stepCount",void 0),Tp=v_=Wy([Ms("Screen Space Contact Shadows")],Tp);class Nx{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new _.xsS,this._mesh=new _.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new F2}dispose(){var e;(e=this._mesh.geometry)==null||e.dispose(),this._mesh.material.dispose(),this.disposeAllTargets()}disposeTarget(e){e.split(";").forEach(i=>{var s;return(s=this._normalsCache[i])==null?void 0:s.dispose()})}disposeAllTargets(){Object.values(this._normalsCache).forEach(e=>e.dispose())}hasCapturedNormalMap(e){return!!e.userData._normalsCaptureMap}captureNormalMap(e,i,s=512){if(!e)throw"No geometry";if(this.hasCapturedNormalMap(e))return!1;const o=i==null?void 0:i.split(";").find(b=>this._normalsCache[b]);if(o){const b=this._normalsCache[o];return i==null||i.split(";").forEach(et=>et!==o&&(this._normalsCache[et]=b)),b.width!==s&&console.warn("last cacheKey normalMapRes mismatch, check model",s),e.userData._normalsCaptureMap=b,!1}const c=this._renderer.createTargetCustom({width:s,height:s},{minFilter:_.TyD,magFilter:_.TyD,generateMipmaps:!1,type:_.cLu},_.oAp);if(c.attachedGeometries=[],c.autoDispose=Nx.AutoDisposeTargets,!c)throw"Unable to create render target";const g=()=>{const b=new _._am(1e-4,100,c);this._scene.add(b);const et=e.userData.normalsCaptureOffsets;et.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.fromArray(et.center),et.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.fromArray(et.offsetMatrixInv),et.radius!==void 0&&(this._mesh.material.uniforms.radius.value=et.radius),this._mesh.geometry=e,b.update(this._renderer.rendererObject,this._scene),this._scene.remove(b),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=c};return g(),this._renderer.addEventListener("contextRestored",g),c.attachedGeometries.push(e),e.addEventListener("dispose",()=>{var b;c.attachedGeometries=((b=c.attachedGeometries)==null?void 0:b.filter(et=>et!==e))??[],delete e.userData._normalsCaptureMap,this._renderer.removeEventListener("contextRestored",g),c.autoDispose&&!c.attachedGeometries.length&&c.dispose()}),i==null||i.split(";").forEach(b=>this._normalsCache[b]=c),c.addEventListener("dispose",()=>{i==null||i.split(";").forEach(b=>delete this._normalsCache[b]),this._renderer.removeEventListener("contextRestored",g),delete e.userData._normalsCaptureMap}),!0}}Nx.AutoDisposeTargets=!0;class F2 extends _.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:_.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new _.yGw().identity()},offsetCenter:{value:new _.Pa4}}})}}var lE=__webpackgi_require__(654);function Ux(h){const e=new _.Pa4(0,0,0),i=new _.Pa4(0,0,0),s=new _.Pa4(0,0,0),o=new _.Pa4(0,0,0),c=h.getAttribute("position"),g=h.index;if(g)for(let at=Math.max(0,h.drawRange.start),ct=Math.min(g.count,h.drawRange.start+h.drawRange.count)-1;at<ct/3;at+=3){const pt=g.getX(at),gt=g.getX(at+1),At=g.getX(at+2);i.set(c.getX(pt),c.getY(pt),c.getZ(pt)),s.set(c.getX(gt),c.getY(gt),c.getZ(gt)),o.set(c.getX(At),c.getY(At),c.getZ(At)),s.sub(i),o.sub(i),o.cross(s),o.normalize(),e.add(o)}else for(let at=0;at<c.count;at+=3)i.set(c.getX(at),c.getY(at),c.getZ(at)),s.set(c.getX(at+1),c.getY(at+1),c.getZ(at+1)),o.set(c.getX(at+2),c.getY(at+2),c.getZ(at+2)),s.sub(i),o.sub(i),o.cross(s),o.normalize(),e.add(o);e.normalize();let b=!1,et=0;for(;!b;){const at=et/3,ct=g?g.getX(at):at,pt=g?g.getX(at+1):at+1;i.set(c.getX(ct),c.getY(ct),c.getZ(ct)),s.set(c.getX(pt),c.getY(pt),c.getZ(pt)),i.sub(s),i.normalize();const gt=e.dot(i);Math.abs(gt-1)>.001&&i.length()>.5&&(b=!0),et+=3}s.crossVectors(i,e),s.normalize(),i.crossVectors(e,s),i.normalize();const tt=new _.yGw;tt.elements[0]=i.x,tt.elements[1]=i.y,tt.elements[2]=i.z,tt.elements[3]=0,tt.elements[4]=e.x,tt.elements[5]=e.y,tt.elements[6]=e.z,tt.elements[7]=0,tt.elements[8]=s.x,tt.elements[9]=s.y,tt.elements[10]=s.z,tt.elements[11]=0,tt.elements[12]=0,tt.elements[13]=0,tt.elements[14]=0,tt.elements[15]=1,h.computeBoundingSphere();const rt=h.boundingSphere.radius,st=new _.yGw().makeScale(rt,rt,rt);return tt.multiply(st),tt}function j2(h,e,i){const s=new _.Pa4().copy(h),o=new _.Pa4().copy(e),c=new _.Pa4().copy(i);return s.dot(o.cross(c))/6}function lm(h,e,i){const s=new _.Pa4().copy(h),o=new _.Pa4().copy(e),c=new _.Pa4().copy(i);return o.sub(s),c.sub(s),c.cross(o),.5*c.length()}function oT(h){const e=h.getAttribute("position"),i=h.getAttribute("normal");if(e.count/3>500)return console.warn("DiamondPlugin:: Too many faces. Mirror/Topology issues will not be fixed",e.count/3),Ux(h);const s=new _.Pa4(0,0,0),o=new _.Pa4(0,0,0),c=new _.Pa4(0,0,0),g=h.index,b=[];if(g)for(let xt=Math.max(0,h.drawRange.start),yt=Math.min(g.count,h.drawRange.start+h.drawRange.count)-1;xt<yt;xt+=3){const _t=g.getX(xt),Mt=g.getX(xt+1),It=g.getX(xt+2);s.set(e.getX(_t),e.getY(_t),e.getZ(_t)),o.set(e.getX(Mt),e.getY(Mt),e.getZ(Mt)),c.set(e.getX(It),e.getY(It),e.getZ(It)),b.push(s.toArray(),o.toArray(),c.toArray())}else for(let xt=0;xt<e.count;xt++)s.set(e.getX(xt),e.getY(xt),e.getZ(xt)),b.push(s.toArray());const et=function(xt,yt){const _t=new _.Pa4;for(let on=0;on<xt.length;on+=3)_t.x+=xt[on],_t.y+=xt[on+1],_t.z+=xt[on+2];_t.multiplyScalar(1/(xt.length/3));const Mt=new _.Pa4,It=new _.Pa4,Bt=new _.Pa4,Lt=new _.Pa4,Ht=new _.Pa4;let Jt=0,sn=0;for(let on=0;on<yt.length;on+=3){Mt.set(yt[on][0],yt[on][1],yt[on][2]),It.set(yt[on+1][0],yt[on+1][1],yt[on+1][2]),Bt.set(yt[on+2][0],yt[on+2][1],yt[on+2][2]),Ht.copy(Mt).add(It).add(Bt);const mn=lm(Mt,It,Bt);Ht.multiplyScalar(mn/3),Lt.add(Ht),Jt+=mn,sn+=j2(Mt,It,Bt)}return Lt.multiplyScalar(1/Jt),{centre:_t,com:Lt,volume:sn,area:Jt}}(e.array,b);if(et.volume<0){console.warn("DiamondPlugin:: Negative Volume, Fixing Normals");for(let xt=0;xt<i.count;xt++)i.setX(xt,-i.getX(xt)),i.setY(xt,-i.getY(xt)),i.setZ(xt,-i.getZ(xt));i.needsUpdate=!0}const tt=[];for(let xt=0;xt<e.array.length;xt+=3)tt.push([e.array[xt],e.array[xt+1],e.array[xt+2]]);const rt=console.log;console.log=()=>{};const st=(0,lE.getEigenVectors)(tt);console.log=rt;const at=new _.yGw;at.elements[0]=st[0].vector[0],at.elements[1]=st[0].vector[1],at.elements[2]=st[0].vector[2],at.elements[3]=0,at.elements[4]=st[1].vector[0],at.elements[5]=st[1].vector[1],at.elements[6]=st[1].vector[2],at.elements[7]=0,at.elements[8]=st[2].vector[0],at.elements[9]=st[2].vector[1],at.elements[10]=st[2].vector[2],at.elements[11]=0,at.elements[12]=0,at.elements[13]=0,at.elements[14]=0,at.elements[15]=1;const ct=new _.Pa4;ct.copy(et.com).sub(et.centre),ct.normalize();const pt=new _.Pa4(st[2].vector[0],st[2].vector[1],st[2].vector[2]);ct.dot(pt)<0&&(at.elements[4]=-st[1].vector[0],at.elements[5]=-st[1].vector[1],at.elements[6]=-st[1].vector[2],at.elements[8]=-st[2].vector[0],at.elements[9]=-st[2].vector[1],at.elements[10]=-st[2].vector[2]),h.computeBoundingSphere();const gt=h.boundingSphere.radius,At=new _.yGw().makeScale(gt,gt,gt);return at.multiply(At),at}const aT={...B1,color:new zo(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new _.Pa4(.892,.892,.98595025),wireframe:!1,envMapRotationOffset:0,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0,envMapIndex:0};var Ip=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class Ro extends _.jyz{get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,i,s,o,c){var et,tt;super.onBeforeRender(e,i,s,o,c),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||i.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=i.envMapIntensity),this.envMap!==void 0&&i.fixedEnvMapDirection!==void 0&&(i.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.uniforms.envMapRotation.value=(((et=this.envMap)==null?void 0:et.rotation)||0)+this.envMapRotationOffset,this.extraUniformsToUpload.inverseModelMatrix.value.copy(c.matrixWorld).invert();const g=o.userData.normalsCaptureOffsets;g&&(this.extraUniformsToUpload.centerOffset.value.fromArray(g.centerOffset),this.extraUniformsToUpload.modelOffsetMatrix.value.fromArray(g.offsetMatrix).premultiply(c.matrixWorld),this.extraUniformsToUpload.modelOffsetMatrixInv.value.copy(this.extraUniformsToUpload.modelOffsetMatrix.value).invert(),this.extraUniformsToUpload.radius.value=g.radius);const b=(tt=o.userData._normalsCaptureMap)==null?void 0:tt.texture;this.normalsCaptureMap!==b&&(this.normalsCaptureMap=b),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}onAfterRender(e,i,s,o,c){super.onAfterRender(e,i,s,o,c),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}constructor(e){super({side:_.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;
#ifdef USE_INSTANCING
uniform mat4 inverseModelMatrix;uniform mat4 modelOffsetMatrix;varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#endif
void main(){
#ifdef USE_INSTANCING
vWorldNormal=(modelMatrix*instanceMatrix*vec4(normal,0.)).xyz;
#else
vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#endif
#include <beginnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <project_vertex>
vViewPosition=-mvPosition.xyz;vUv=uv;
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;
#ifdef USE_INSTANCING
vModelInstanceOffsetMatrix=modelMatrix*instanceMatrix*inverseModelMatrix*modelOffsetMatrix;vModelInstanceOffsetMatrixInv=inverse(vModelInstanceOffsetMatrix);
#endif
}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;uniform float radius;uniform vec3 centerOffset;
#ifdef USE_INSTANCING
varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#define MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrixInv
#else
uniform mat4 modelOffsetMatrixInv;uniform mat4 modelOffsetMatrix;
#define MODEL_OFFSET_MATRIX  modelOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  modelOffsetMatrixInv
#endif
#define CENTER_OFFSET  (centerOffset) 
uniform mat4 projectionMatrix;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.y*=-1.;direction.z*=-1.;
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContribution(vec3 direction){
#if DIA_ORIENT_ENVMAP < 1
direction=mat3(MODEL_OFFSET_MATRIX)*direction;
#endif
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=CENTER_OFFSET;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+CENTER_OFFSET+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-CENTER_OFFSET);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=CENTER_OFFSET+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-CENTER_OFFSET);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=CENTER_OFFSET+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 getRefractionColor(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);int count=0;mat4 invModelOffsetMatrix=INV_MODEL_OFFSET_MATRIX;newDirection=normalize((invModelOffsetMatrix*vec4(newDirection,0.)).xyz);origin=(invModelOffsetMatrix*vec4(origin,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-CENTER_OFFSET);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;vec3 origin2=(MODEL_OFFSET_MATRIX*vec4(intersectedPos,1)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=mat3(MODEL_OFFSET_MATRIX)*oldDir;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(oldDir).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=normalize(mat3(MODEL_OFFSET_MATRIX)*newDirection);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 reflectedDirection=reflect(viewVector,normalizedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normalizedNormal,vec3(f0),0.);vec3 reflectionColor=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;vec3 refractionColor=getRefractionColor(vWorldPosition,viewVector,normalizedNormal);vec3 normal=normalize(vNormal);vec3 diffuseColor=vec3(1.);
#glMarker beforeAccumulation
gl_FragColor=vec4((refractionColor.rgb+reflectionColor.rgb)*diffuseColor,1.);gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(gammaFactor));
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new _.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new _.Pa4(1,1,1)}}}),this.typeSlug=Ro.TypeSlug,this.assetType="material",this.__envMap=[],this.isDiamondMaterial=!0,this.color=new zo(1,1,1),this.envMapIntensity=1,this.envMapRotationOffset=0,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new _.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new _.yGw().identity()},radius:{value:1},centerOffset:{value:new _.Pa4(0,0,0)},modelOffsetMatrix:{value:new _.yGw().identity()},modelOffsetMatrixInv:{value:new _.yGw().identity()}},this.envMapIndex=0,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.userData.separateEnvMapIntensity=!0,this.setValues(e),this.materialExtensions=wu.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...wu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,i){wu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:i}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+wu.CacheKeyForExtensions(this,this.materialExtensions)}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)==null?void 0:i.uiRefresh)==null||s.call(i,"postFrame",!0,1)}set envMaps(e){this.__envMap=e,this.refreshEnvUniform()}refreshEnvUniform(){var e;this.uniforms.envMap.value=this.envMap,this.defines.ENV_MAP_TYPE=(e=this.uniforms.envMap.value)!=null&&e.isCubeTexture?0:1,this.needsUpdate=!0}get envMap(){return this.__envMap[this.envMapIndex]??this.__envMap[0]??null}set envMap(e){console.error("Setting separate envmap for indivisual diamond material not supported yet.")}clone(){return super.clone()}toJSON(e){const i={metadata:{version:4.6,type:"DiamondMaterial",generator:"DiamondMaterial.toJSON"}};return i.name=this.name,i.uuid=this.uuid,i.color=this.color.getHex(),i.envMapIntensity=this.envMapIntensity,i.envMapIndex=this.envMapIndex,i.envMapRotationOffset=this.envMapRotationOffset,i.dispersion=this.dispersion,i.squashFactor=this.squashFactor,i.geometryFactor=this.geometryFactor,i.gammaFactor=this.gammaFactor,i.absorptionFactor=this.absorptionFactor,i.reflectivity=this.reflectivity,i.refractiveIndex=this.refractiveIndex,i.rayBounces=this.rayBounces,i.diamondOrientedEnvMap=this.diamondOrientedEnvMap,i.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},i.transmission=this.transmission,i.isDiamondMaterialParameters=!0,i.type=Ro.TYPE,i.userData={},Pu(i.userData,this.userData),i.userData.uuid=this.userData.uuid,i}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"dropdown",label:"Environment",property:[this,"envMapIndex"],children:[0,1,2].map(i=>({label:"env"+(i+1),value:i}))},...bv(this),{type:"input",label:"Mesh count",get value(){var i,s;return((s=(i=e.userData)==null?void 0:i.__appliedMeshes)==null?void 0:s.size)??0},set value(i){},disabled:!0},{type:"input",label:"uuid",get value(){return e.uuid},set value(i){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(i){e.userData.renderToDepth=i||void 0}},{type:"button",label:"Download .dmat",value:()=>{const i=new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"});(0,_e.downloadBlob)(i,"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(i=>{var s;return(s=i.getUiConfig)==null?void 0:s.call(i,this)})].filter(i=>i),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==Ro.TYPE)return console.warn("Material type is not supported",e),this;const i={},s=Array.from(Object.keys(aT));(0,_e.copyProps)(e,i,s);const o=i.userData;return delete i.userData,this.setValues(i),Pu(this.userData,o),this.setDirty(),this}fromJSON(e,i){return this.copyProps(e)}}Ro.TypeSlug="dmat",Ro.TYPE="DiamondMaterial",Ip([s_("Color",{limitedUi:!0}),hr()],Ro.prototype,"color",void 0),Ip([es("Env Intensity",[0,5],.01,{limitedUi:!0}),hr()],Ro.prototype,"envMapIntensity",void 0),Ip([es("Env Rotation Offset",[-Math.PI,Math.PI],.01),(0,_e.onChange2)(Ro.prototype.setDirty)],Ro.prototype,"envMapRotationOffset",void 0),Ip([es("Dispersion",[0,.1],1e-4,{limitedUi:!0}),hr({propKey:"rIndexDelta"})],Ro.prototype,"dispersion",void 0),Ip([es("Absorption",[0,15],.01,{limitedUi:!0}),hr()],Ro.prototype,"absorptionFactor",void 0),Ip([es("Refractive Index",[0,4],.01,{limitedUi:!0}),hr()],Ro.prototype,"refractiveIndex",void 0),Ip([hr()],Ro.prototype,"squashFactor",void 0),Ip([hr()],Ro.prototype,"geometryFactor",void 0),Ip([es("Gamma",[.1,4],.01,{limitedUi:!0}),hr()],Ro.prototype,"gammaFactor",void 0),Ip([ip("RGB Boost",void 0,void 0,{limitedUi:!0}),hr()],Ro.prototype,"boostFactors",void 0),Ip([es("Transmission",[0,1],.01,{limitedUi:!0}),hr()],Ro.prototype,"transmission",void 0),Ip([es("Reflectivity",[0,2],.01,{limitedUi:!0}),hr()],Ro.prototype,"reflectivity",void 0),Ip([Kr("RAY_BOUNCES",void 0,!0),es("Ray Bounces",[1,16],1)],Ro.prototype,"rayBounces",void 0),Ip([Kr("DIA_ORIENT_ENVMAP",void 0,!0),es("Diamond Oriented Lighting",[0,1],1)],Ro.prototype,"diamondOrientedEnvMap",void 0),Ip([hr({propKey:"tCubeMapNormals"})],Ro.prototype,"normalsCaptureMap",void 0),Ip([(0,_e.onChange)(Ro.prototype.refreshEnvUniform)],Ro.prototype,"envMapIndex",void 0);var hw=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class Uo extends hs{get envMapRotation(){var e;return((e=this.envMap)==null?void 0:e.rotation)??0}set envMapRotation(e){var s;const i=[this.envMap,this.envMap2,this.envMap3];for(const o of i)o&&(o.rotation=e,(s=this._viewer)==null||s.scene.setDirty())}refreshEnvMaps(){var s,o,c;if(!this._viewer)return;const e=this.getEnvMaps(),i=((o=(s=this._viewer.getPlugin(Lr))==null?void 0:s.materials)==null?void 0:o.getMaterialsOfType(Ro.TypeSlug))||[];for(const g of i)g&&(g.envMaps=e);(c=this._viewer)==null||c.scene.setDirty()}constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.envMap2=null,this.envMap3=null,this.forceSceneEnvMap=!1,this.getEnvMaps=()=>{var i;if(!this.forceSceneEnvMap&&this.envMap)return[this.envMap,this.envMap2,this.envMap3];const e=((i=this._viewer)==null?void 0:i.scene.getEnvironment())||null;return[e,e,e]},this._modelProcessor={forAssetType:"model",processAsync:async(e,i)=>{const s=[];return e.modelObject.traverse(o=>{var g,b,et,tt;const c=(b=(g=o.userData)==null?void 0:g.gltfExtensions)==null?void 0:b[Uo.DIAMOND_GLTF_EXTENSION];c&&o.geometry&&(this.prepareDiamondMesh(o,c),delete o.userData.gltfExtensions[Uo.DIAMOND_GLTF_EXTENSION]),o.material&&!s.includes(o.material)&&((tt=(et=o.material.userData)==null?void 0:et.gltfExtensions)!=null&&tt[Uo.DIAMOND_GLTF_EXTENSION])&&(o.material.materialObject||console.warn("material not processed",o.material),s.push(o.material))}),s.forEach(o=>{const c=o.userData.gltfExtensions[Uo.DIAMOND_GLTF_EXTENSION];c&&this._convertToDiamondMaterial(o,c)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"checkbox",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"image",label:"Environment 2",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap2"]},{type:"image",label:"Environment 3",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap3"]},{type:"button",label:"Make Diamond",hidden:()=>{var i,s,o;const e=(o=(s=(i=this._viewer)==null?void 0:i.getPlugin(vo))==null?void 0:s.getSelectedObject())==null?void 0:o.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==Qu.TypeSlug},value:async()=>{var o,c,g,b,et,tt;const e=(c=(o=this._viewer)==null?void 0:o.getPlugin(vo))==null?void 0:c.getSelectedObject();if(!(e!=null&&e.material))return;const i=await((g=this._viewer)==null?void 0:g.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let s=parseInt(await((b=this._viewer)==null?void 0:b.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite(s)||(s=512),s<64&&(s=64),((et=e.material.userData)==null?void 0:et.__appliedMeshes.size)>1&&await((tt=this._viewer)==null?void 0:tt.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(e.material,{cacheKey:i||void 0,normalMapRes:s},{}):this.makeDiamondMesh(e,{cacheKey:i||void 0,normalMapRes:s},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var i,s,o;const e=(o=(s=(i=this._viewer)==null?void 0:i.getPlugin(vo))==null?void 0:s.getSelectedObject())==null?void 0:o.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==Ro.TypeSlug},value:async()=>{var c,g,b,et,tt,rt,st,at;const e=(g=(c=this._viewer)==null?void 0:c.getPlugin(vo))==null?void 0:g.getSelectedObject(),i=e==null?void 0:e.material;if(!i)return;const s=i.userData._baseMaterial;let o=(tt=(et=(b=this._viewer)==null?void 0:b.getManager())==null?void 0:et.materials)==null?void 0:tt.findMaterial(s);if(o&&!o.isDiamondMaterial||(o=(rt=this._viewer)==null?void 0:rt.createPhysicalMaterial({color:i.color})),o){const ct=i.userData.__appliedMeshes.size>1&&await((st=this._viewer)==null?void 0:st.confirm("Convert all with this material?"))?Array.from(i.userData.__appliedMeshes):[e];for(const pt of ct)(at=pt==null?void 0:pt.setMaterial)==null||at.call(pt,o)}this.refreshUi()},limitedUi:!0},{type:"button",label:"Auto Instance Diamonds (dev)",hidden:()=>{var i,s,o,c;const e=(o=(s=(i=this._viewer)==null?void 0:i.getPlugin(vo))==null?void 0:s.getSelectedObject())==null?void 0:o.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==Ro.TypeSlug||((c=e.userData.__appliedMeshes)==null?void 0:c.size)<2},value:async()=>{var s,o;const e=(o=(s=this._viewer)==null?void 0:s.getPlugin(vo))==null?void 0:o.getSelectedObject();if(!e)return;const i=e.material;i&&!Array.isArray(i)&&p0(i)}},{type:"button",label:"Clear Cache",value:()=>{this.disposeAllCacheMaps()}}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}refreshUi(){var e,i,s;(e=this._viewer)==null||e.setDirty(),(s=(i=this.uiConfig)==null?void 0:i.uiRefresh)==null||s.call(i,"postFrame",!0)}async onAdded(e){var c,g,b,et,tt,rt,st;this._normalCapture=new Nx(e.renderer),this.offsetCache={},e.scene.addEventListener("materialChanged",at=>{var ct,pt,gt,At;if((ct=at.material)!=null&&ct.isDiamondMaterial){const xt=at.material,yt=at.mesh||at.object;if(yt.geometry&&!((pt=this._normalCapture)!=null&&pt.hasCapturedNormalMap(yt))){const Mt=((At=(gt=xt==null?void 0:xt.userData)==null?void 0:gt.gltfExtensions)==null?void 0:At[Uo.DIAMOND_GLTF_EXTENSION])??{};Mt.cacheKey===void 0&&!yt.userData._diamondCacheKey&&(xt!=null&&xt.name)&&(Mt.cacheKey=xt.name),this.prepareDiamondMesh(yt,Mt)}const _t=this.getEnvMaps();xt.envMaps=_t}}),e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const i=e.getPlugin(Lr);(c=i==null?void 0:i.importer)==null||c.processors.add("model",this._modelProcessor),(g=e.getPlugin(vo))==null||g.addEventListener("selectedObjectChanged",this.refreshUi);const s=this.getEnvMaps,o=new yl(class extends Al{async loadAsync(at,ct){var gt;const pt=await super.loadAsync(at,ct);return pt.type===Ro.TYPE||pt.isDiamondMaterialParameters?(pt.envMap=s(),(gt=i==null?void 0:i.materials)==null?void 0:gt.generateFromTemplate("diamond",pt)):(console.error("Invalid material type for Diamond Material.",pt),null)}},[Ro.TypeSlug],!1);return(b=i==null?void 0:i.importer)==null||b.Importers.push(o),(rt=(tt=(et=i==null?void 0:i.exporter)==null?void 0:et.getExporter("gltf","glb"))==null?void 0:tt.extensions)==null||rt.push(z2),(st=i==null?void 0:i.materials)==null||st.registerMaterialTemplate({name:"diamond",materialType:Ro.TYPE,isDiamondMaterialParameters:!0,generator:(at,ct)=>{const pt=!(ct!=null&&ct.metadata||!ct.isDiamondMaterialParameters)||(ct==null?void 0:ct.metadata)&&(ct==null?void 0:ct.metadata.version)<=4.5,gt=ct==null?void 0:ct.color;pt&&typeof ct.color=="number"&&(ct.color=new zo().setHex(ct.color,_.GUF).getHex());const At=new Ro(at);return At.envMaps=this.getEnvMaps(),ct&&At.copyProps(ct),ct.color=gt,At}}),super.onAdded(e)}async onRemove(e){var i,s,o,c;return(i=this._normalCapture)==null||i.dispose(),this._normalCapture=void 0,this.offsetCache={},(o=(s=e.getPlugin(Lr))==null?void 0:s.importer)==null||o.processors.remove("model",this._modelProcessor),(c=e.getPlugin(vo))==null||c.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:i,normalMapRes:s}){var g,b;e.userData._diamondCacheKey=i??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=s??e.userData._diamondNormalMapRes,i=i&&i.length>0?i.includes(";"+e.geometry.uuid)?i:i+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const o=((g=this._normalCapture)==null?void 0:g.captureNormalMap(e.geometry,i,s))??[void 0,!1],c=(b=this._viewer)==null?void 0:b.getPluginByType("debug");c&&o&&(c.counters.normalsCapture||(c.counters.normalsCapture=0),c.counters.normalsCapture++,console.log("DEBUG: new normal map captured",c.counters.normalsCapture,i),c.addTexture("normal"+c.counters.normalsCapture,()=>{var et,tt;return(tt=(et=e.geometry)==null?void 0:et.userData._normalsCaptureMap)==null?void 0:tt.texture},[40,110*c.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,i,s){var o;Array.from((e==null?void 0:e.userData.__appliedMeshes)??[]).forEach(c=>{c!=null&&c.isMesh&&c.geometry&&this.prepareDiamondMesh(c,i)}),this._convertToDiamondMaterial(e,s),(o=this._viewer)==null||o.setDirty()}makeDiamondMesh(e,i,s){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,i);const o=Array.isArray(e.material)?e.material[0]:e.material,c=this._convertToDiamondMaterial(o,s,!1);e.setMaterial(c)}_convertToDiamondMaterial(e,i={isDiamond:!0},s=!0){var g,b,et;let o={...i??{}};o.isDiamond||o.isDiamondMaterialParameters?Array.isArray(o.boostFactors)&&(o.boostFactors=new _.Pa4().fromArray(o.boostFactors)):o={isDiamondMaterialParameters:!0},o.color=o.color??(e==null?void 0:e.color)??new zo(1,1,1),o.name=o.name??(e==null?void 0:e.name)??"diamond";const c=(et=(b=(g=this._viewer)==null?void 0:g.getManager())==null?void 0:b.materials)==null?void 0:et.generateFromTemplate("diamond",o);if(c&&e&&!e.isDiamondMaterial&&(c.userData._baseMaterial=e.uuid),s){const tt=rt=>rt.setMaterial??(st=>{rt.material=st.materialObject});Array.from((e==null?void 0:e.userData.__appliedMeshes)??[]).forEach(rt=>{tt(rt)(c),this.prepareDiamondMesh(rt,i)})}return c}_computeOffsets(e,i,s=!1){if(e.userData.normalsCaptureOffsets){if((0,_e.getUrlQueryParam)("recomputeOffsets")===null)return e.userData.normalsCaptureOffsets;console.warn("recomputeOffsets",e.userData.normalsCaptureOffsets)}e.computeBoundingBox();const o=e.boundingBox.getCenter(new _.Pa4).toArray(),c=oT(e).toArray(),g=new _.yGw().fromArray(c).invert(),b=new _.Pa4().fromArray(o).applyMatrix4(g).toArray(),et={center:o,offsetMatrix:c,offsetMatrixInv:g.toArray(),radius:1,centerOffset:b};return e.userData.normalsCaptureOffsets=et,(0,_e.getUrlQueryParam)("recomputeOffsets")!==null&&console.warn("recomputeOffsets",et),et}disposeCacheMap(e){var i;(i=this._normalCapture)==null||i.disposeTarget(e)}disposeAllCacheMaps(){var e;(e=this._normalCapture)==null||e.disposeAllTargets()}}Uo.PluginType="Diamond",Uo.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",hw([(0,_e.onChange)(Uo.prototype.refreshEnvMaps),Mn()],Uo.prototype,"envMap",void 0),hw([(0,_e.onChange)(Uo.prototype.refreshEnvMaps),Mn()],Uo.prototype,"envMap2",void 0),hw([(0,_e.onChange)(Uo.prototype.refreshEnvMaps),Mn()],Uo.prototype,"envMap3",void 0),hw([(0,_e.onChange)(Uo.prototype.refreshEnvMaps),Mn()],Uo.prototype,"forceSceneEnvMap",void 0);const z2=h=>({writeMaterial:(e,i)=>{e.isDiamondMaterial&&(i.extensions=i.extensions||{},i.extensions[Uo.DIAMOND_GLTF_EXTENSION]=e.toJSON(),h.extensionsUsed[Uo.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,i)=>{var o,c;if(!(e!=null&&e.material.isDiamondMaterial))return;i.extensions=i.extensions||{};const s={};(c=(o=e.userData)==null?void 0:o.gltfExtensions)==null||delete c[Uo.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(s.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondCacheKey&&(s.cacheKey=e.userData._diamondCacheKey),i.extensions[Uo.DIAMOND_GLTF_EXTENSION]=s,h.extensionsUsed[Uo.DIAMOND_GLTF_EXTENSION]=!0}});class uC{static async GetClonedCanvas(e,{rect:i={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:s=1,scale:o=1}){var et,tt,rt;const c=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");c.width=i.width*o*s,c.height=i.height*o*s,i.assumeClientRect&&(i.x*=e.width/(s*e.clientWidth),i.y*=e.height/(s*e.clientHeight),i.width*=e.width/(s*e.clientWidth),i.height*=e.height/(s*e.clientHeight));const g=c.getContext("2d");if(!g)return console.error("snapshot: cannot create context"),c;const b=e.style.background||((et=e.parentElement)==null?void 0:et.style.background)||"";if(b.includes("url")){const st=(tt=/url\("(.*)"\)/gi.exec(b))==null?void 0:tt[1];if(st){const at=new Image;at.src=st,await new Promise((ct,pt)=>{at.onload=()=>ct(),at.onerror=()=>pt(),at.complete&&ct()}),g.drawImage(at,at.width*i.x*s/e.width,at.height*i.y*s/e.height,at.width*i.width*s/e.width,at.height*i.height*s/e.height,0,0,c.width,c.height)}}else g.fillStyle=e.style.background||((rt=e.parentElement)==null?void 0:rt.style.backgroundColor)||"#00000000",g.fillRect(0,0,c.width,c.height);return g==null||g.drawImage(e,i.x*s,i.y*s,i.width*s,i.height*s,0,0,c.width,c.height),this.Debug&&(document.body.appendChild(c),c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.borderWidth="2px",c.style.borderColor="#ff00ff",setTimeout(()=>c.remove(),5e3)),c}static async GetDataUrl(e,{mimeType:i="image/png",...s}){const o=await this.GetClonedCanvas(e,s),c=o.toDataURL(i);return this.Debug||o.remove(),c}static async GetImage(e,{mimeType:i="image/png",...s}={}){const o=await this.GetDataUrl(e,s);return new Promise((c,g)=>{const b=new Image;b.onload=()=>{c(b)},b.src=o})}static async GetBlob(e,i={}){const s=await this.GetClonedCanvas(e,i),o=await new Promise((c,g)=>{s.toBlob(b=>{b?c(b):g()},i.mimeType??"image/png")});return this.Debug||s.remove(),o}static async GetFile(e,i="image.png",s={}){return s.getDataUrl?await this.GetDataUrl(e,s):new File([await this.GetBlob(e,s)],i,{type:s.mimeType??"image/png",lastModified:(0,_e.now)()})}}uC.Debug=!1;var Nv=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let Uv=class extends hs{constructor(){super(),this.enabled=!0,this.filename="snapshot.png",this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(h,e={waitForProgressive:!0}){return e.getDataUrl=!1,await this._getFile(h||this.filename,e)}async getDataUrl(h={}){return h.getDataUrl=!0,await this._getFile("",h)??""}async _getFile(h,e={}){var s,o;const i=(s=this._viewer)==null?void 0:s.canvas;if(i){const c=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==c&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const g=(o=this._viewer)==null?void 0:o.getPlugin(cp);if(e.waitForProgressive&&g&&e.timeout===void 0)for(;!g.isConverged(!0);)await(0,_e.timeout)(64);else await(0,_e.timeout)(e.timeout??200);e.displayPixelRatio=1;const b=await uC.GetFile(i,h,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=c,b}}async downloadSnapshot(h,e={waitForProgressive:!0}){const i=await this.getFile(h,e);i&&await this._downloadBlob(i,i.name)}async _downloadBlob(h,e){var s,o;const i=(s=this._viewer)==null?void 0:s.getPluginByType("FileTransferPlugin");i?await i.exportFile(h,e):(o=this._viewer)==null||o.console.error("FileTransferPlugin required to export/download file")}};Uv.PluginType="CanvasSnipper",Nv([js("Filename"),Mn()],Uv.prototype,"filename",void 0),Nv([go("Download .png",{limitedUi:!0})],Uv.prototype,"downloadSnapshot",null),Uv=Nv([Ms("Image Export")],Uv);var dw=function(h){return function(e){return 1-h(1-e)}},cE=function(h){return function(e){return e<=.5?h(2*e)/2:(2-h(2*(1-e)))/2}},hC=function(h){return function(e){return Math.pow(e,h)}},Fx=function(h){return function(e){return e*e*((h+1)*e-h)}},uE=function(h){var e=Fx(h);return function(i){return(i*=2)<1?.5*e(i):.5*(2-Math.pow(2,-10*(i-1)))}},dC=function(h){return h},hE=hC(2),V2=dw(hE),lT=cE(hE),dE=function(h){return 1-Math.sin(Math.acos(h))},cT=dw(dE),G2=cE(cT),jm=Fx(1.525),pE=dw(jm),uT=cE(jm),pC=uE(1.525),qy=function(h){if(h===1||h===0)return h;var e=h*h;return h<.36363636363636365?7.5625*e:h<.7272727272727273?9.075*e-9.9*h+3.4:h<.9?12.066481994459833*e-19.63545706371191*h+8.898060941828255:10.8*h*h-20.52*h+10.72},fC=dw(qy),mC=function(h){return h<.5?.5*(1-qy(1-2*h)):.5*qy(2*h-1)+.5},Wl=function(){return Wl=Object.assign||function(h){for(var e,i=1,s=arguments.length;i<s;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(h[o]=e[o]);return h},Wl.apply(this,arguments)};function hT(h,e){var i={};for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&e.indexOf(s)<0&&(i[s]=h[s]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(s=Object.getOwnPropertySymbols(h);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(h,s[o])&&(i[s[o]]=h[s[o]])}return i}var gC=function(){},V0=function(h,e,i){return Math.min(Math.max(i,h),e)},pw=.001,dT=.01,H2=10,vC=.05,Q2=1,pT=12;function fE(h,e){return h*Math.sqrt(1-e*e)}var fT=["duration","bounce"],mT=["stiffness","damping","mass"];function gT(h,e){return e.some(function(i){return h[i]!==void 0})}function Xy(h){var e=h.from,i=e===void 0?0:e,s=h.to,o=s===void 0?1:s,c=h.restSpeed,g=c===void 0?2:c,b=h.restDelta,et=hT(h,["from","to","restSpeed","restDelta"]),tt={done:!1,value:i},rt=function(Mt){var It=Wl({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},Mt);if(!gT(Mt,mT)&&gT(Mt,fT)){var Bt=function(Lt){var Ht,Jt,sn=Lt.duration,on=sn===void 0?800:sn,mn=Lt.bounce,cn=mn===void 0?.25:mn,un=Lt.velocity,bn=un===void 0?0:un,xn=Lt.mass,Cn=xn===void 0?1:xn,Jn=1-cn;Jn=V0(vC,Q2,Jn),on=V0(dT,H2,on/1e3),Jn<1?(Ht=function(nr){var tr=nr*Jn,Cr=tr*on,Ar=tr-bn,Hr=fE(nr,Jn),Jr=Math.exp(-Cr);return pw-Ar/Hr*Jr},Jt=function(nr){var tr=nr*Jn*on,Cr=tr*bn+bn,Ar=Math.pow(Jn,2)*Math.pow(nr,2)*on,Hr=Math.exp(-tr),Jr=fE(Math.pow(nr,2),Jn);return(-Ht(nr)+pw>0?-1:1)*((Cr-Ar)*Hr)/Jr}):(Ht=function(nr){return Math.exp(-nr*on)*((nr-bn)*on+1)-pw},Jt=function(nr){return Math.exp(-nr*on)*(on*on*(bn-nr))});var Kn=function(nr,tr,Cr){for(var Ar=Cr,Hr=1;Hr<pT;Hr++)Ar-=nr(Ar)/tr(Ar);return Ar}(Ht,Jt,5/on);if(on*=1e3,isNaN(Kn))return{stiffness:100,damping:10,duration:on};var gr=Math.pow(Kn,2)*Cn;return{stiffness:gr,damping:2*Jn*Math.sqrt(Cn*gr),duration:on}}(Mt);(It=Wl(Wl(Wl({},It),Bt),{velocity:0,mass:1})).isResolvedFromDuration=!0}return It}(et),st=rt.stiffness,at=rt.damping,ct=rt.mass,pt=rt.velocity,gt=rt.duration,At=rt.isResolvedFromDuration,xt=fw,yt=fw;function _t(){var Mt=pt?-pt/1e3:0,It=o-i,Bt=at/(2*Math.sqrt(st*ct)),Lt=Math.sqrt(st/ct)/1e3;if(b!=null||(b=Math.abs(o-i)<=1?.01:.4),Bt<1){var Ht=fE(Lt,Bt);xt=function(sn){var on=Math.exp(-Bt*Lt*sn);return o-on*((Mt+Bt*Lt*It)/Ht*Math.sin(Ht*sn)+It*Math.cos(Ht*sn))},yt=function(sn){var on=Math.exp(-Bt*Lt*sn);return Bt*Lt*on*(Math.sin(Ht*sn)*(Mt+Bt*Lt*It)/Ht+It*Math.cos(Ht*sn))-on*(Math.cos(Ht*sn)*(Mt+Bt*Lt*It)-Ht*It*Math.sin(Ht*sn))}}else if(Bt===1)xt=function(sn){return o-Math.exp(-Lt*sn)*(It+(Mt+Lt*It)*sn)};else{var Jt=Lt*Math.sqrt(Bt*Bt-1);xt=function(sn){var on=Math.exp(-Bt*Lt*sn),mn=Math.min(Jt*sn,300);return o-on*((Mt+Bt*Lt*It)*Math.sinh(mn)+Jt*It*Math.cosh(mn))/Jt}}}return _t(),{next:function(Mt){var It=xt(Mt);if(At)tt.done=Mt>=gt;else{var Bt=1e3*yt(Mt),Lt=Math.abs(Bt)<=g,Ht=Math.abs(o-It)<=b;tt.done=Lt&&Ht}return tt.value=tt.done?o:It,tt},flipTarget:function(){var Mt;pt=-pt,i=(Mt=[o,i])[0],o=Mt[1],_t()}}}Xy.needsInterpolation=function(h,e){return typeof h=="string"||typeof e=="string"};var fw=function(h){return 0},mw=function(h,e,i){var s=e-h;return s===0?1:(i-h)/s},G0=function(h,e,i){return-i*h+i*e+h},Yy=function(h,e){return function(i){return Math.max(Math.min(i,e),h)}},H0=function(h){return h%1?Number(h.toFixed(5)):h},Fv=/(-)?([\d]*\.?[\d])+/g,gw=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,_C=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function Ky(h){return typeof h=="string"}var jx={test:function(h){return typeof h=="number"},parse:parseFloat,transform:function(h){return h}},mE=Wl(Wl({},jx),{transform:Yy(0,1)}),yC=(Wl(Wl({},jx),{default:1}),function(h,e){return function(i){return!!(Ky(i)&&_C.test(i)&&i.startsWith(h)||e&&Object.prototype.hasOwnProperty.call(i,e))}}),Jy=function(h,e,i){return function(s){var o;if(!Ky(s))return s;var c=s.match(Fv),g=c[0],b=c[1],et=c[2],tt=c[3];return(o={})[h]=parseFloat(g),o[e]=parseFloat(b),o[i]=parseFloat(et),o.alpha=tt!==void 0?parseFloat(tt):1,o}},W2=Yy(0,255),Q0=Wl(Wl({},jx),{transform:function(h){return Math.round(W2(h))}}),Z_={test:yC("rgb","red"),parse:Jy("red","green","blue"),transform:function(h){var e=h.red,i=h.green,s=h.blue,o=h.alpha,c=o===void 0?1:o;return"rgba("+Q0.transform(e)+", "+Q0.transform(i)+", "+Q0.transform(s)+", "+H0(mE.transform(c))+")"}},vT={test:yC("#"),parse:function(h){var e="",i="",s="",o="";return h.length>5?(e=h.substr(1,2),i=h.substr(3,2),s=h.substr(5,2),o=h.substr(7,2)):(e=h.substr(1,1),i=h.substr(2,1),s=h.substr(3,1),o=h.substr(4,1),e+=e,i+=i,s+=s,o+=o),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(s,16),alpha:o?parseInt(o,16)/255:1}},transform:Z_.transform},hB=function(h){return{test:function(e){return Ky(e)&&e.endsWith(h)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+h}}},gE=hB("%"),zx=(Wl(Wl({},gE),{parse:function(h){return gE.parse(h)/100},transform:function(h){return gE.transform(100*h)}}),{test:yC("hsl","hue"),parse:Jy("hue","saturation","lightness"),transform:function(h){var e=h.hue,i=h.saturation,s=h.lightness,o=h.alpha,c=o===void 0?1:o;return"hsla("+Math.round(e)+", "+gE.transform(H0(i))+", "+gE.transform(H0(s))+", "+H0(mE.transform(c))+")"}}),dB=function(h,e,i){var s=h*h,o=e*e;return Math.sqrt(Math.max(0,i*(o-s)+s))},pB=[vT,Z_,zx],q2=function(h){return pB.find(function(e){return e.test(h)})},vE=function(h,e){var i=q2(h),s=q2(e);if(gC(i.transform===s.transform),!i||!s||i.transform!==s.transform)return function(et){return""+(et>0?e:h)};var o=i.parse(h),c=s.parse(e),g=Wl({},o),b=i===zx?G0:dB;return function(et){for(var tt in g)tt!=="alpha"&&(g[tt]=b(o[tt],c[tt],et));return g.alpha=G0(o.alpha,c.alpha,et),i.transform(g)}},AC={test:function(h){return Z_.test(h)||vT.test(h)||zx.test(h)},parse:function(h){return Z_.test(h)?Z_.parse(h):zx.test(h)?zx.parse(h):vT.parse(h)},transform:function(h){return Ky(h)?h:h.hasOwnProperty("red")?Z_.transform(h):zx.transform(h)}},vw="${c}",X2="${n}";function Xl(h){typeof h=="number"&&(h=""+h);var e=[],i=0,s=h.match(gw);s&&(i=s.length,h=h.replace(gw,vw),e.push.apply(e,s.map(AC.parse)));var o=h.match(Fv);return o&&(h=h.replace(Fv,X2),e.push.apply(e,o.map(jx.parse))),{values:e,numColors:i,tokenised:h}}function _E(h){return Xl(h).values}function _T(h){var e=Xl(h),i=e.values,s=e.numColors,o=e.tokenised,c=i.length;return function(g){for(var b=o,et=0;et<c;et++)b=b.replace(et<s?vw:X2,et<s?AC.transform(g[et]):H0(g[et]));return b}}var bC=function(h){return typeof h=="number"?0:h},yE={test:function(h){var e,i,s,o;return isNaN(h)&&Ky(h)&&((i=(e=h.match(Fv))===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0)+((o=(s=h.match(gw))===null||s===void 0?void 0:s.length)!==null&&o!==void 0?o:0)>0},parse:_E,createTransformer:_T,getAnimatableNone:function(h){var e=_E(h);return _T(h)(e.map(bC))}},AE={x:0,y:0,z:0},wC=function(h){return typeof h=="number"},Y2=function(h,e){return function(i){return e(h(i))}},_w=function(){for(var h=[],e=0;e<arguments.length;e++)h[e]=arguments[e];return h.reduce(Y2)};function xC(h,e){return wC(h)?function(i){return G0(h,e,i)}:AC.test(h)?vE(h,e):yw(h,e)}var __=function(h,e){var i=function(c,g,b){if(b||arguments.length===2)for(var et,tt=0,rt=g.length;tt<rt;tt++)!et&&tt in g||(et||(et=Array.prototype.slice.call(g,0,tt)),et[tt]=g[tt]);return c.concat(et||Array.prototype.slice.call(g))}([],h),s=i.length,o=h.map(function(c,g){return xC(c,e[g])});return function(c){for(var g=0;g<s;g++)i[g]=o[g](c);return i}},K2=function(h,e){var i=Wl(Wl({},h),e),s={};for(var o in i)h[o]!==void 0&&e[o]!==void 0&&(s[o]=xC(h[o],e[o]));return function(c){for(var g in s)i[g]=s[g](c);return i}};function yT(h){for(var e=yE.parse(h),i=e.length,s=0,o=0,c=0,g=0;g<i;g++)s||typeof e[g]=="number"?s++:e[g].hue!==void 0?c++:o++;return{parsed:e,numNumbers:s,numRGB:o,numHSL:c}}var yw=function(h,e){var i=yE.createTransformer(e),s=yT(h),o=yT(e);return s.numHSL===o.numHSL&&s.numRGB===o.numRGB&&s.numNumbers>=o.numNumbers?_w(__(s.parsed,o.parsed),i):function(c){return""+(c>0?e:h)}},fB=function(h,e){return function(i){return G0(h,e,i)}};function Aw(h,e,i){var s=i===void 0?{}:i,o=s.clamp,c=o===void 0||o,g=s.ease,b=s.mixer,et=h.length;gC(et===e.length),gC(!g||!Array.isArray(g)||g.length===et-1),h[0]>h[et-1]&&(h=[].concat(h),e=[].concat(e),h.reverse(),e.reverse());var tt=function(st,at,ct){for(var pt=[],gt=ct||(typeof(Mt=st[0])=="number"?fB:typeof Mt=="string"?AC.test(Mt)?vE:yw:Array.isArray(Mt)?__:typeof Mt=="object"?K2:void 0),At=st.length-1,xt=0;xt<At;xt++){var yt=gt(st[xt],st[xt+1]);if(at){var _t=Array.isArray(at)?at[xt]:at;yt=_w(_t,yt)}pt.push(yt)}var Mt;return pt}(e,g,b),rt=et===2?function(st,at){var ct=st[0],pt=st[1],gt=at[0];return function(At){return gt(mw(ct,pt,At))}}(h,tt):function(st,at){var ct=st.length,pt=ct-1;return function(gt){var At=0,xt=!1;if(gt<=st[0]?xt=!0:gt>=st[pt]&&(At=pt-1,xt=!0),!xt){for(var yt=1;yt<ct&&!(st[yt]>gt||yt===pt);yt++);At=yt-1}var _t=mw(st[At],st[At+1],gt);return at[At](_t)}}(h,tt);return c?function(st){return rt(V0(h[0],h[et-1],st))}:rt}function Vx(h,e){return h.map(function(){return e||lT}).splice(0,h.length-1)}function W0(h){var e=h.from,i=e===void 0?0:e,s=h.to,o=s===void 0?1:s,c=h.ease,g=h.offset,b=h.duration,et=b===void 0?300:b,tt={done:!1,value:i},rt=Array.isArray(o)?o:[i,o],st=function(pt,gt){return pt.map(function(At){return At*gt})}(g&&g.length===rt.length?g:function(pt){var gt=pt.length;return pt.map(function(At,xt){return xt!==0?xt/(gt-1):0})}(rt),et);function at(){return Aw(st,rt,{ease:Array.isArray(c)?c:Vx(rt,c)})}var ct=at();return{next:function(pt){return tt.value=ct(pt),tt.done=pt>=et,tt},flipTarget:function(){rt.reverse(),ct=at()}}}function Gx(h){var e=h.velocity,i=e===void 0?0:e,s=h.from,o=s===void 0?0:s,c=h.power,g=c===void 0?.8:c,b=h.timeConstant,et=b===void 0?350:b,tt=h.restDelta,rt=tt===void 0?.5:tt,st=h.modifyTarget,at={done:!1,value:o},ct=g*i,pt=o+ct,gt=st===void 0?pt:st(pt);return gt!==pt&&(ct=gt-o),{next:function(At){var xt=-ct*Math.exp(-At/et);return at.done=!(xt>rt||xt<-rt),at.value=at.done?gt:gt+xt,at},flipTarget:function(){}}}var bw={keyframes:W0,spring:Xy,decay:Gx},Hx=1/60*1e3,bE=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},Qx=typeof window<"u"?function(h){return window.requestAnimationFrame(h)}:function(h){return setTimeout(function(){return h(bE())},Hx)},ww=!0,Wx=!1,EC=!1,qx={delta:0,timestamp:0},wE=["read","update","preRender","render","postRender"],SC=wE.reduce(function(h,e){return h[e]=function(i){var s=[],o=[],c=0,g=!1,b=new WeakSet,et={schedule:function(tt,rt,st){rt===void 0&&(rt=!1),st===void 0&&(st=!1);var at=st&&g,ct=at?s:o;return rt&&b.add(tt),ct.indexOf(tt)===-1&&(ct.push(tt),at&&g&&(c=s.length)),tt},cancel:function(tt){var rt=o.indexOf(tt);rt!==-1&&o.splice(rt,1),b.delete(tt)},process:function(tt){var rt;if(g=!0,s=(rt=[o,s])[0],(o=rt[1]).length=0,c=s.length)for(var st=0;st<c;st++){var at=s[st];at(tt),b.has(at)&&(et.schedule(at),i())}g=!1}};return et}(function(){return Wx=!0}),h},{}),AT=wE.reduce(function(h,e){var i=SC[e];return h[e]=function(s,o,c){return o===void 0&&(o=!1),c===void 0&&(c=!1),Wx||Z2(),i.schedule(s,o,c)},h},{}),J2=wE.reduce(function(h,e){return h[e]=SC[e].cancel,h},{}),$2=function(h){return SC[h].process(qx)},bT=function(h){Wx=!1,qx.delta=ww?Hx:Math.max(Math.min(h-qx.timestamp,40),1),qx.timestamp=h,EC=!0,wE.forEach($2),EC=!1,Wx&&(ww=!1,Qx(bT))},Z2=function(){Wx=!0,ww=!0,EC||Qx(bT)},wT=function(){return qx},eP=AT;function xT(h,e,i){return i===void 0&&(i=0),h-e-i}var jv=function(h){var e=function(i){var s=i.delta;return h(s)};return{start:function(){return eP.update(e,!0)},stop:function(){return J2.update(e)}}};function e0(h){var e,i,s,o,c,g=h.from,b=h.autoplay,et=b===void 0||b,tt=h.driver,rt=tt===void 0?jv:tt,st=h.elapsed,at=st===void 0?0:st,ct=h.repeat,pt=ct===void 0?0:ct,gt=h.repeatType,At=gt===void 0?"loop":gt,xt=h.repeatDelay,yt=xt===void 0?0:xt,_t=h.onPlay,Mt=h.onStop,It=h.onComplete,Bt=h.onRepeat,Lt=h.onUpdate,Ht=hT(h,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),Jt=Ht.to,sn=0,on=Ht.duration,mn=!1,cn=!0,un=function(xn){if(Array.isArray(xn.to))return W0;if(bw[xn.type])return bw[xn.type];var Cn=new Set(Object.keys(xn));return Cn.has("ease")||Cn.has("duration")&&!Cn.has("dampingRatio")?W0:Cn.has("dampingRatio")||Cn.has("stiffness")||Cn.has("mass")||Cn.has("damping")||Cn.has("restSpeed")||Cn.has("restDelta")?Xy:W0}(Ht);!((i=(e=un).needsInterpolation)===null||i===void 0)&&i.call(e,g,Jt)&&(c=Aw([0,100],[g,Jt],{clamp:!1}),g=0,Jt=100);var bn=un(Wl(Wl({},Ht),{from:g,to:Jt}));return et&&(_t==null||_t(),(s=rt(function(xn){if(cn||(xn=-xn),at+=xn,!mn){var Cn=bn.next(Math.max(0,at));o=Cn.value,c&&(o=c(o)),mn=cn?Cn.done:at<=0}Lt==null||Lt(o),mn&&(sn===0&&(on!=null||(on=at)),sn<pt?function(Jn,Kn,gr,nr){return nr?Jn>=Kn+gr:Jn<=-gr}(at,on,yt,cn)&&(sn++,At==="reverse"?at=function(Jn,Kn,gr,nr){return gr===void 0&&(gr=0),nr===void 0&&(nr=!0),nr?xT(Kn+-Jn,Kn,gr):Kn-(Jn-Kn)+gr}(at,on,yt,cn=sn%2==0):(at=xT(at,on,yt),At==="mirror"&&bn.flipTarget()),mn=!1,Bt&&Bt()):(s.stop(),It&&It()))})).start()),{stop:function(){Mt==null||Mt(),s.stop()}}}const $y={linear:dC,easeIn:hE,easeOut:V2,easeInOut:lT,circIn:dE,circOut:cT,circInOut:G2,backIn:jm,backOut:pE,backInOut:uT,anticipate:pC,bounceOut:qy,bounceIn:fC,bounceInOut:mC,easeInOutSine:function(h){return-(Math.cos(Math.PI*h)-1)/2}};function CC(h,e,i){const s=h[e],o=()=>{typeof(h==null?void 0:h.setDirty)=="function"&&h.setDirty(),i==null||i()};return s.isVector3||s.isVector2||s.isVector4?c=>{s.copy(c),o()}:c=>{h[e]=c,o()}}function MC(h){return typeof h!="boolean"}async function xE(h,e,i,s){e in h||console.error("invalid key",e,h);const o=CC(h,e),c=h[e],g=b=>{var et;o(b),(et=i.onUpdate)==null||et.call(i,b)};if(MC(c))return typeof i.to=="function"&&(i={...i,to:i.to(c,h)}),Xx({...i,from:c,onUpdate:g},s);{const{duration:b}=i;return(0,_e.timeout)(b??0).then(()=>g(i.to))}}async function Xx(h,e){const i=h.onComplete,s=h.onStop,o=h.onEnd;return h={...h},new Promise((c,g)=>{h.onComplete=()=>{try{i==null||i()}catch(et){return o==null||o(),void g(et)}o==null||o(),c()},h.onStop=()=>{try{s==null||s()}catch(et){return o==null||o(),void g(et)}o==null||o(),c()};const b=e0(h);e&&e.push(b)})}var El=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let tP=1,dp=class{constructor(h,e,i,s,o){this.position=new _.Pa4,this.target=new _.Pa4,this.quaternion=new _._fP,this.up=new _.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.updateView=()=>{},this.uiConfig=tm(this.name,this),h&&(this.position=h),e&&(this.target=e),i&&(this.up=i),s&&(this.quaternion=s),o&&(this.snap=o),this.name="#view"+tP++}_nameChanged(){var h,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(h=this.uiConfig).uiRefresh)==null||e.call(h))}};El([Mn(),ip()],dp.prototype,"position",void 0),El([Mn(),ip()],dp.prototype,"target",void 0),El([Mn(),ip()],dp.prototype,"quaternion",void 0),El([Mn(),ip()],dp.prototype,"up",void 0),El([Mn(),js()],dp.prototype,"name",void 0),El([yy()],dp.prototype,"snap",void 0),El([go()],dp.prototype,"focusView",void 0),El([go()],dp.prototype,"deleteView",void 0),El([go()],dp.prototype,"updateView",void 0),dp=El([qm("CameraView")],dp);class qo extends hs{get animationLooping(){return this._animationLooping}get animating(){return this._animating}constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(i=>i.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=-1),i+=1,e?i%=this._cameraViews.length:i=Math.min(i,this._cameraViews.length-1),this.focusView(this._cameraViews[i])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=0),i-=1,i=e?(i+this._cameraViews.length)%this._cameraViews.length:Math.max(i,0),this.focusView(this._cameraViews[i])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...bv(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var i;if(this.enabled&&!this._animating&&this.seekOnScroll){const s=(i=this._viewer)==null?void 0:i.scene.activeCamera;if(!s)return;const o=new _.$V,c=s.position,g=s.target,b=new _._fP().setFromUnitVectors(s.cameraObject.up,new _.Pa4(0,1,0)),et=b.clone().invert(),tt=c.clone().sub(g);tt.applyQuaternion(b),o.setFromVector3(tt),o.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,o.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,o.makeSafe(),tt.setFromSpherical(o),tt.applyQuaternion(et),c.copy(g).add(tt),s.positionUpdated(!1),s.targetUpdated()}}async onAdded(e){await super.onAdded(e);let i=!1;e.addEventListener("preFrame",s=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,i=!0):i&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,i=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var o,c;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((o=this._viewer.getPluginByType("FrameFade"))==null||o.enable(qo.PluginType),this._fadeDisabled=!1));const e=(0,_e.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=e-1/60);let i=e-this._lastFrameTime;this._lastFrameTime=e,i*=this.animateOnScroll?this._scrollAnimationState:1;const s=(c=this._viewer.getPluginByType("Progressive"))==null?void 0:c.postFrameConvergedRecordingDelta();if(s&&s>0&&(i=s),s!==0&&(i*=1e3,!(i<=0||(this._updaters.forEach(g=>{let b=i;g.time+b<0&&(b=-g.time),g.time+=b,Math.abs(b)>.001&&g.u(b)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const g=this._viewer.getPluginByType("FrameFade");g&&(g.disable(qo.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await(0,_e.timeout)(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await(0,_e.timeout)(2))}async recordAllViews(e,i=!0){var o;if(!this.enabled)return;const s=(o=this._viewer)==null?void 0:o.getPluginByType("CanvasRecorder");if(s&&s.enabled&&!(this._cameraViews.length<1)){if(await this.resetToFirstView(),!s.isRecording())return new Promise((c,g)=>{const b=()=>{s.removeEventListener("start",et),s.removeEventListener("stop",b),s.removeEventListener("error",tt)},et=async()=>{var st;b(),e==null||e(),await this.animateAllViews();const rt=await s.stopRecording();if(i){const at=await((st=this._viewer)==null?void 0:st.prompt("Canvas Recorder: Save file as","recording.mp4"));at!==null&&rt&&await this._downloadBlob(rt,at||"recording.mp4")}c(rt)},tt=async()=>{b(),g()};s.addEventListener("start",et),s.addEventListener("stop",b),s.addEventListener("error",tt),s.startRecording()||console.error("cannot start recording")});console.error("CanvasRecorderPlugin is already recording")}}async addCurrentView(){var s,o,c;if(!this.enabled)return;const e=(s=this._viewer)==null?void 0:s.scene.activeCamera;if(!e)return;const i=this.getCurrentCameraView(e);i.snap=await((c=(o=this._viewer)==null?void 0:o.getPlugin(Uv))==null?void 0:c.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this.addView(i)}addView(e){var i,s;this._cameraViews.push(e),(s=(i=this.uiConfig).uiRefresh)==null||s.call(i),this.dispatchEvent({type:"viewAdd",view:e})}getCurrentCameraView(e,i=!0,s){var rt,st,at;if(e||(e=(rt=this._viewer)==null?void 0:rt.scene.activeCamera),!e)return new dp;const o=new _.Pa4;e.cameraObject.updateWorldMatrix(!0,!1);const c=e.cameraObject.matrixWorld;o.x=c.elements[4],o.y=c.elements[5],o.z=c.elements[6],o.normalize();const g=e.target.clone(),b=e.position.clone(),et=e.cameraObject.parent;et&&(i?b.applyMatrix4(et.matrixWorld):o.transformDirection(et.matrixWorld.clone().invert()));const tt=i?e.cameraObject.getWorldQuaternion(new _._fP):e.cameraObject.quaternion.clone();return s?(s.position.copy(b),s.target.copy(g),s.up.copy(o),s.quaternion.copy(tt)):((s=new dp(b,g,o,tt,"")).focusView=async()=>s&&this.focusView(s),s.deleteView=()=>s&&this.deleteView(s),s.updateView=()=>this.getCurrentCameraView(e,i,s)),(at=(st=s.uiConfig).uiRefresh)==null||at.call(st,"postFrame",!0),s}setCurrentCameraView(e){var s;const i=(s=this._viewer)==null?void 0:s.scene.activeCamera;i&&(i.position.copy(e.position),i.target.copy(e.target),i.cameraObject.up.copy(e.up),i.cameraObject.quaternion.copy(e.quaternion),i.positionUpdated())}async focusView(e){return this.animateToView(e)}deleteView(e){var s,o;const i=this._cameraViews.indexOf(e);i>=0&&this._cameraViews.splice(i,1),(o=(s=this.uiConfig).uiRefresh)==null||o.call(s),this.dispatchEvent({type:"viewDelete",view:e})}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var i;return(i=e==null?void 0:e.stop)==null?void 0:i.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await(0,_e.timeout)(100)}async animateToView(e,i,s,o=!1){var rt,st;const c=(rt=this._viewer)==null?void 0:rt.scene.activeCamera;if(!c)return;if(this._animating){this._popAnimations.forEach(ct=>(ct==null?void 0:ct.stop)&&ct.stop()),this._popAnimations=[];let at=0;for(;this._animating&&(await(0,_e.timeout)(100),!(at++>20)););if(this._animating)return void console.warn("Unable to stop all animations, maybe because of viewLooping?")}this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),i===void 0&&(i=this.animDuration),i=Math.max(10,i);const g=typeof s=="function"?s:$y[s||this.animEase],b=this._driver,et=[];this._popAnimations=[];const tt=this._popAnimations;if(this.interpolateMode==="spherical")et.push(async function(at,ct,pt,gt,At,xt,yt){const _t=at.target.clone(),Mt=new _.Pa4,It=new _.Pa4,Bt=at.cameraObject.parent,Lt=at.cameraObject.up.clone(),Ht=cm({position:at.cameraObject.getWorldPosition(new _.Pa4),up:Bt?Lt.transformDirection(Bt.matrixWorld):Lt},_t),Jt=cm(ct,ct.target),sn=new _.$V;function on(){at.position.copy(Bt?Bt.worldToLocal(It):It),at.target.copy(Mt),at.positionUpdated()}return Xx({from:0,to:1,duration:pt,ease:gt,driver:At,onUpdate:mn=>{sn.phi=y_(Ht.phi,Jt.phi,mn),sn.theta=y_(Ht.theta,Jt.theta,mn),sn.radius=Hn(Ht.radius,Jt.radius,mn),Mt.copy(_t).lerp(ct.target,mn),It.setFromSpherical(sn),It.add(Mt),on()},onComplete:()=>{It.copy(ct.position),Mt.copy(ct.target),on()},onStop:()=>{throw new Error("Animation Stopped")}},xt)}(c,e,i,g,b,tt));else if(this.interpolateMode==="linear"){et.push(Xx({from:c.position.clone(),to:e.position.clone(),duration:i,ease:g,driver:b,onUpdate:pt=>c.position=pt,onComplete:()=>c.position=e.position,onStop:()=>{throw new Error("Animation stopped")}},tt)),et.push(Xx({from:c.target.clone(),to:e.target.clone(),duration:i,ease:g,driver:b,onUpdate:pt=>{c.target=pt,c.targetUpdated()},onComplete:()=>{c.target=e.target,c.targetUpdated()}},tt));const at=c.cameraObject.quaternion.clone(),ct=new _._fP;et.push(Xx({from:0,to:1,duration:i,ease:g,driver:b,onUpdate:pt=>{ct.copy(at).slerp(e.quaternion,pt),c.cameraObject.quaternion.copy(ct),c.cameraObject.updateProjectionMatrix()},onComplete:()=>{c.cameraObject.quaternion.copy(e.quaternion),c.cameraObject.updateProjectionMatrix()}},tt))}await Promise.allSettled(et).catch(at=>{if(o)throw at}),(st=this._viewer)==null||st.setDirty(),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await(0,_e.timeout)(10)}fromJSON(e,i){var s,o;return this._cameraViews.forEach(c=>this.deleteView(c)),super.fromJSON(e,i)?(this._cameraViews.forEach(c=>c.focusView=async()=>this.focusView(c)),this._cameraViews.forEach(c=>c.deleteView=()=>this.deleteView(c)),(o=(s=this.uiConfig).uiRefresh)==null||o.call(s),this):null}async animateToObject(e,i=4,s,o,c={min:.5,max:5}){if(!this._viewer)return;const g=new Xt().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),b=g.getCenter(new _.Pa4),et=g.getSize(new _.Pa4).length()/2;await this.animateToTarget(Math.min(c.max,Math.max(c.min,et*i)),b,s,o)}async animateToFitObject(e,i=1.5,s=1e3,o,c={min:.5,max:50}){if(!this._viewer)return;const g=new Xt().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),b=g.getCenter(new _.Pa4),et=g.getSize(new _.Pa4);let tt=this._viewer.scene.activeCamera.cameraObject,rt=1;if(tt.isPerspectiveCamera){const st=tt.fov*(Math.PI/180),at=2*Math.atan(Math.tan(st/2)*tt.aspect),ct=et.z/2+Math.abs(et.x/2/Math.tan(at/2)),pt=et.z/2+Math.abs(et.y/2/Math.tan(st/2));rt=Math.max(ct,pt)}await this.animateToTarget(Math.min(c.max,Math.max(c.min,rt*i)),b,s,o)}async animateToTarget(e,i,s,o){const c=this.getCurrentCameraView();c.target.copy(i);const g=new _.Pa4().subVectors(c.target,c.position).normalize();c.position.copy(g.multiplyScalar(-e).add(c.target)),await this.animateToView(c,s,o)}async _downloadBlob(e,i){var o,c;const s=(o=this._viewer)==null?void 0:o.getPluginByType("FileTransferPlugin");s?await s.exportFile(e,i):(c=this._viewer)==null||c.console.error("FileTransferPlugin required to export/download file")}}function cm(h,e){const i=h.position.clone();i.sub(e);const s=new _.$V().setFromVector3(i);return s.makeSafe(),s}function y_(h,e,i){const s=e-h;return s>=Math.PI?h+(s-2*Math.PI)*i:s<=-Math.PI?h+(s+2*Math.PI)*i:h+s*i}function ET(h,e,i){const s=(1-i)*Math.cos(h)+i*Math.cos(e),o=(1-i)*Math.sin(h)+i*Math.sin(e);return Math.atan2(o,s)}qo.PluginType="CameraViews",El([Mn("cameraViews")],qo.prototype,"_cameraViews",void 0),El([(0,_e.onChange)(qo.prototype._animationLoop),Mn(),Nr("Loop All Views",{limitedUi:!0})],qo.prototype,"viewLooping",void 0),El([Mn(),js("View Pause Time")],qo.prototype,"viewPauseTime",void 0),El([Mn(),em("Ease",Object.keys($y).map(h=>({label:h})))],qo.prototype,"animEase",void 0),El([Mn(),es("Duration",[10,1e4],10,{limitedUi:!0})],qo.prototype,"animDuration",void 0),El([Mn(),es("RotationOffset",[.2,.75],.01)],qo.prototype,"rotationOffset",void 0),El([Mn(),em("Interpolation",["spherical","linear"].map(h=>({label:h})))],qo.prototype,"interpolateMode",void 0),El([Nr(),Mn()],qo.prototype,"seekOnScroll",void 0),El([go("Animate All Views",{limitedUi:!0})],qo.prototype,"animateAllViews",null),El([go("Record All Views")],qo.prototype,"recordAllViews",null),El([go("Add Current View")],qo.prototype,"addCurrentView",null),El([go("Focus Next")],qo.prototype,"focusNext",void 0),El([go("Focus Previous")],qo.prototype,"focusPrevious",void 0);const Yx=new _.Pa4;function nP(h,e,i){let s=h.dot(e);s=Math.min(Math.max(s,-1),1);const o=Math.acos(s)*i;return Yx.copy(h).multiplyScalar(s).sub(e).negate().normalize(),h.multiplyScalar(Math.cos(o)).add(Yx.multiplyScalar(Math.sin(o)))}var t0,n0=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let A_=t0=class{constructor(h){this.enabled=!1,this.power=.5,this.bgcolor=new _.Ilk(0),this.extraUniforms={power:{value:.5},bgcolor:{value:new _.Ilk}},this.parsFragmentSnippet=(e,i)=>this.enabled?_e.glsl`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=h.getPlugin(f_),this._setDirty=this._setDirty.bind(this)}shaderExtender(h,e,i){this.enabled&&(h.fragmentShader=rs(h.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(h,e,i){this.enabled&&(e.materialObject.uniforms.power.value=this.power,e.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)==null||h.call(this),this._setDirty()}};A_.PluginType="Vignette",n0([(0,_e.onChange)(t0.prototype._setDirty),Nr("Enable"),Mn()],A_.prototype,"enabled",void 0),n0([(0,_e.onChange)(t0.prototype._setDirty),es("Power",[.1,4],.01,{limitedUi:!0}),Mn()],A_.prototype,"power",void 0),n0([(0,_e.onChange)(t0.prototype._setDirty),s_("Color"),Mn()],A_.prototype,"bgcolor",void 0),A_=t0=n0([Ms("Vignette")],A_);class q0 extends O0{constructor(){super()}generateExtension(e){return new A_(e)}get power(){var e;return((e=this._extension)==null?void 0:e.power)??1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e;return((e=this._extension)==null?void 0:e.bgcolor)??new _.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}q0.PluginType="Vignette";var Zy=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let fu=class extends hs{constructor(){super(),this.enabled=!0,this.dependencies=[Lr],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const h=await(0,_e.uploadFile)(!0,!1,"model/gltf");await this.loadScenes(h)}async loadScenes(h){var i,s;const e=await Promise.all(h.map(async o=>await o.arrayBuffer()));for(let o=0;o<h.length;o++){const c=h[o];this.scenes.push({[c.name]:new Uint8Array(e[o])}),this.assets[c.name]={path:c.name,file:c}}(s=(i=this.uiConfig)==null?void 0:i.uiRefresh)==null||s.call(i)}async play(){var o;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const h=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin")??this._viewer.getPluginByType("LoadingScreenPlugin");h==null||h.enabled,h&&(h.enabled=!1);const e=this._viewer.getPluginByType("FrameFade"),i=this._viewer.getPluginByType("GLTFAnimation"),s=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const c of this.scenes){if(!this._isPlaying)break;const g=Object.keys(c);i==null||i.stopAnimation(!1),await(s==null?void 0:s.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const et of g){let tt=this.assets[et];tt||(tt={path:et,file:new File([c[et]],et)},this.assets[et]=tt),await((o=this._viewer.getManager())==null?void 0:o.addAssetSingle(tt,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,h&&(h.enabled=!1),e&&(e.enabled=!0,await e.startTransition(1e3));const b=[(0,_e.timeout)(this.minSceneTime)];i&&b.push(i.playAnimation()),s&&b.push(s.animateAllViews()),await Promise.all(b)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const h={};for(const s of this.scenes)for(const o of Object.keys(s)){const c=h[o]?o+"_":o;h[c]=s[c]}const e=GM(h),i=new Blob([e],{type:"application/zip"});(0,_e.downloadBlob)(i,"scenes.glbloop")}async onAdded(h){var i,s;await super.onAdded(h);const e=this;(s=(i=h.getManager())==null?void 0:i.importer)==null||s.Importers.push(new yl(class extends GS{load(o,c,g,b){super.load(o,et=>{e.loadScenes([...et.values()]),c==null||c(null),(0,_e.timeout)(100).then(e.play)},g,b)}},["glbloop"],!0))}};fu.PluginType="SceneLoopPlugin",Zy([Xm("Loaded scenes")],fu.prototype,"loadedScenes",null),Zy([go("Load Scenes")],fu.prototype,"promptLoadScenes",null),Zy([Xm("Playing")],fu.prototype,"_isPlaying",void 0),Zy([js("Min Scene Time")],fu.prototype,"minSceneTime",void 0),Zy([go("Play")],fu.prototype,"play",null),Zy([go("Stop")],fu.prototype,"stop",null),Zy([go("Download Scenes")],fu.prototype,"downloadScenes",null),fu=Zy([Ms("Scene Loop")],fu);var TC=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let EE=class extends Km{constructor(h,e,i){super(h,e,i??new lv,new _.Ilk(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(h,e,i,s,o){if(!this.enabled||!this.camera)return;const c=this.overrideMaterial;c.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(c.uniforms.lastProjectionViewMatrix.value.copy(c.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(h,e,i,s,o),c.uniforms.lastProjectionViewMatrix.value.copy(c.uniforms.currentProjectionViewMatrix.value)}};TC([Nr("Enabled")],EE.prototype,"enabled",void 0),EE=TC([Ms("Velocity Buffer (TAA)")],EE);class lv extends _.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new _.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},alphaMapTransform:{value:new _.Vkp},currentProjectionViewMatrix:{value:new _.yGw},lastProjectionViewMatrix:{value:new _.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new _.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,i,s,o,c){const g=this._previousWorldMatrices[c.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(g??c.matrixWorld),g?g.copy(c.matrixWorld):this._previousWorldMatrices[c.uuid]=c.matrixWorld.clone();let b=c.material;Array.isArray(b)&&(b=b[0]),this.uniforms.alphaMap.value=(b==null?void 0:b.alphaMap)??null,this.uniforms.alphaTest.value=!b||!b.alphaTest||b.alphaTest<1e-7?.001:b.alphaTest;let et=this.uniforms.alphaMap.value?1:void 0;et!==this.defines.USE_ALPHAMAP&&(et===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=et,this.needsUpdate=!0),et=b.userData.ALPHA_I_RGBA_PACKING?1:void 0,et!==this.defines.ALPHA_I_RGBA_PACKING&&(et===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=et,this.needsUpdate=!0),this.side=b.side??_.ehD}}class cv extends Tm{passCtor(e){const i=e.renderer.createTarget({depthBuffer:!0,type:_.ywz});i.texture.name="velocityBuffer",this._velocityBuffers.push(i),e.getPluginByType("debug");const s=new Set,o=new Set;return new class extends EE{render(c,g,b,et,tt){var ct;if(e.renderer.frameCount>0)return;const rt=c.getRenderTarget(),st=c.getActiveCubeFace(),at=c.getActiveMipmapLevel();(ct=this.scene)==null||ct.traverse(({material:pt})=>{pt&&((pt.transparent&&pt.userData.renderToDepth||!pt.transparent&&pt.transmission===0&&pt.userData.renderToDepth===!1)&&(s.add(pt),pt.transparent=!pt.transparent),Math.abs(pt.transmission||0)>0&&pt.userData.renderToDepth&&(o.add([pt,pt.transmission]),pt.transmission=0))}),no(c,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(c,g,i,et,tt)),s.forEach(pt=>pt.transparent=!pt.transparent),s.clear(),o.forEach(([pt,gt])=>pt.transmission=gt),o.clear(),c.setRenderTarget(rt,st,at)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.renderCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.renderCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(i=>{var s;return e.renderer.disposeTarget((s=i==null?void 0:i.dispose)==null?void 0:s.call(i))}),super.onRemove(e)}updateShaderProperties(e){var i;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled?((i=this.getVelocityBuffer())==null?void 0:i.texture)??null:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}cv.PluginType="VelocityBuffer";var eA,Wp=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let X0=eA=class{constructor(h){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1},lut3d:{value:null},lut3d1:{value:null},lut3d2:{value:null},lut2d:{value:null},lut2d1:{value:null},lut2d2:{value:null}},this.extraDefines={USE_LUT:0,USE_LUT1:0,USE_LUT2:0,USE_3DTEXTURE:0,LUT_BACKGROUND:0},this.parsFragmentSnippet=(e,i)=>this.enabled?`#if (USE_LUT == 1 || USE_LUT1 == 1 || USE_LUT2 == 1)
uniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;
#if USE_LUT == 1
uniform sampler3D lut3d;
#endif
#if USE_LUT1 == 1
uniform sampler3D lut3d1;
#endif
#if USE_LUT2 == 1
uniform sampler3D lut3d2;
#endif
#else
#if USE_LUT == 1
uniform sampler2D lut2d;
#endif
#if USE_LUT1 == 1
uniform sampler2D lut2d1;
#endif
#if USE_LUT2 == 1
uniform sampler2D lut2d2;
#endif
vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
int getLUTBit(in int number){
#ifdef WebGL2Context
return number%2;
#else
return int(mod(float(number),2.));
#endif
}int getLUTIndex(in int number){
#ifdef WebGL2Context
return number%8;
#else
return int(mod(float(number),8.));
#endif
}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=float(getLUTBit(getGBufferFlags(vUv).a));float lutIndex=float(getLUTIndex(getGBufferFlags(vUv).g));
#if USE_3DTEXTURE == 1
if(lutIndex==0.){
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);
#endif
}else{
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}
#else
if(lutIndex==0.){outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(lutLookup(lut2d1,lutSize,getUVW(lutSize1,color)),color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(lutLookup(lut2d2,lutSize,getUVW(lutSize2,color)),color.a);
#endif
}else{outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._viewer=h,this._combinedPostPlugin=h.getPlugin(f_),this._setDirty=this._setDirty.bind(this),this.setDirty=this.setDirty.bind(this)}_updateParams(){if(!this.enabled)return;const h=this._viewer.renderer.rendererObject.capabilities.isWebGL2?1:0;let e=h?this.extraUniforms.lut3d:this.extraUniforms.lut2d;this._updateLUTMap(this.lutMap,e,this.extraUniforms.lutSize,h),this.extraDefines.USE_LUT=this.lutMap?1:0,e=h?this.extraUniforms.lut3d1:this.extraUniforms.lut2d1,this._updateLUTMap(this.lutMap1,e,this.extraUniforms.lutSize1,h),this.extraDefines.USE_LUT1=this.lutMap1?1:0,e=h?this.extraUniforms.lut3d2:this.extraUniforms.lut2d2,this._updateLUTMap(this.lutMap2,e,this.extraUniforms.lutSize2,h),this.extraDefines.USE_LUT2=this.lutMap2?1:0,this.extraUniforms.intensity.value=this.intensity,this.extraDefines.LUT_BACKGROUND=this.lutBackground?1:0,this.extraDefines.USE_3DTEXTURE=h,this._setDirty()}_updateLUTMap(h,e,i,s){if(h){let o=1;s==1?(e.value=h.texture3D,o=h.texture3D.image.width):h.texture&&(e.value=h.texture,o=h.texture.image.width),e.value.needsUpdate=!0,i.value=o}}shaderExtender(h,e,i){this.enabled&&(h.fragmentShader=rs(h.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                bool isBackground = getDepth(vUv)>0.9999;
                #if LUT_BACKGROUND == 1
                    gl_FragColor = colorLookUp(gl_FragColor);
                #else
                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);
                #endif
            #endif
            #glMarker
        `))}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){var h;(h=this.__setDirty)==null||h.call(this),this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};function ST(h){const e=h==null?void 0:h.userData;if(!e)return!1;e[mu.PluginType]||(e[mu.PluginType]={});const i=e[mu.PluginType];return i.enable=!0,i.index===void 0&&(i.index=0),h.isMaterial&&(h.needsUpdate=!0),!0}Wp([Mn(),(0,_e.onChange)(eA.prototype._updateParams),Nr("Enable")],X0.prototype,"enabled",void 0),Wp([Mn(),(0,_e.onChange)(eA.prototype._updateParams),Nr("LUT Background")],X0.prototype,"lutBackground",void 0),Wp([Mn(),(0,_e.onChange)(eA.prototype._updateParams),es("Intensity")],X0.prototype,"intensity",void 0),Wp([(0,_e.onChange)(eA.prototype._updateParams),yy("LUT"),Mn()],X0.prototype,"lutMap",void 0),Wp([(0,_e.onChange)(eA.prototype._updateParams),yy("LUT1"),Mn()],X0.prototype,"lutMap1",void 0),Wp([(0,_e.onChange)(eA.prototype._updateParams),yy("LUT2"),Mn()],X0.prototype,"lutMap2",void 0),X0=eA=Wp([Ms("LUT")],X0);class mu extends O0{_getUiConfig(e){var s,o;const i={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){var c;return((c=e.materialObject.userData[mu.PluginType])==null?void 0:c.enable)??!0},set value(c){var b;const g=e.materialObject.userData[mu.PluginType];c!==(g==null?void 0:g.enable)&&(g||ST(e.materialObject),e.materialObject.userData[mu.PluginType].enable=c,(b=i.uiRefresh)==null||b.call(i,"postFrame",!0))},onChange:(s=this._extension)==null?void 0:s.setDirty},{type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map(c=>({label:c[0],value:c[1]})),label:"index",hidden:()=>{const c=e.materialObject.userData[mu.PluginType];return!!c&&!c.enable},get value(){var c;return((c=e.materialObject.userData[mu.PluginType])==null?void 0:c.index)??0},set value(c){var g;e.materialObject.userData[mu.PluginType]||ST(e.materialObject),e.materialObject.userData[mu.PluginType].index=c,(g=i.uiRefresh)==null||g.call(i,"postFrame",!0)},onChange:(o=this._extension)==null?void 0:o.setDirty}]};return i}constructor(){super(),this.materialExtension={uuid:np(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const i=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=i,i},computeCacheKey:e=>{var i;return(this.enabled?"1":"0")+((i=e.materialObject.userData[mu.PluginType])!=null&&i.enable?"1":"0")},isCompatible:e=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(e){var s,o;await super.onAdded(e),(s=e.getPlugin(bo))==null||s.registerGBufferUpdater(this.updateGBuffer);const i=e.getPlugin(Lr);(o=i==null?void 0:i.materials)==null||o.registerMaterialExtension(this.materialExtension)}generateExtension(e){return new X0(e)}updateGBuffer(e,i){var s,o;if(e instanceof _.Kj0&&((s=e.material)!=null&&s.userData)){const c=(o=e.material)==null?void 0:o.userData[mu.PluginType];if(c){const g=c.enable===!1?0:1;i.w=qS(i.w,0,g);for(let et=0;et<3;et++)i.y=f2(i.y,et);let b=c.enable?c.index:0;b=Math.min(b,7),i.y=i.y|b}else i.w=qS(i.w,0,1)}}}mu.PluginType="LUTPlugin1";class CT{constructor(e){this._zee=new _.Pa4(0,0,1),this._euler=new _.USm,this._q0=new _._fP,this._q1=new _._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._q2=new _._fP,this._initQuaternionDest=new _._fP,this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this.onDeviceOrientationChangeEvent=i=>{this.deviceOrientation=i},this._isConnected=!1,this._viewer=e}getOffsetFromCenter(e=!0){if(!this.deviceOrientation)return new _.FM8;this.getQuaternion(e,this._q2);const i=new _.Pa4(0,0,1);return i.applyQuaternion(this._q2),new _.FM8(i.x,i.y)}getQuaternion(e,i){if(i||(i=new _._fP),!this.deviceOrientation)return i.identity();const s=this.deviceOrientation,o=s.alpha!==null?_.M8C.degToRad(s.alpha):0,c=s.beta!==null?_.M8C.degToRad(s.beta):0,g=s.gamma!==null?_.M8C.degToRad(s.gamma):0,b=this.screenOrientation?_.M8C.degToRad(this.screenOrientation.angle):0;return this._toQuaternion(i,o,c,g,b,e),i}_toQuaternion(e,i,s,o,c,g){this._euler.set(s,i,-o,"YXZ"),e.setFromEuler(this._euler),e.multiply(this._q1);const b=document.getElementById("debug");return b&&(b.textContent=c+""),e.multiply(this._q0.setFromAxisAngle(this._zee,-c)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(e).invert(),this._initQuaternionDest.__init=!0),g&&e.premultiply(this._initQuaternionDest),e}static IsCompatible(){return window.DeviceOrientationEvent!==void 0&&"ontouchstart"in window}addPermissionMessage(){this.permissionMessage=document.createElement("div"),this.permissionMessage.innerHTML="Tap on the screen to allow gyroscope",this.permissionMessage.style.visibility="visible",this.permissionMessage.style.width="100%",this.permissionMessage.style.height="40px",this.permissionMessage.style.color="black",this.permissionMessage.style.position="absolute",this.permissionMessage.style.textAlign="center",this.permissionMessage.style.fontSize="12px",this.permissionMessage.style.bottom="20%",this._viewer.container.appendChild(this.permissionMessage)}connect(){var e;if(!this._isConnected)return this._isConnected=!0,this.onScreenOrientationChangeEvent(),!!window.DeviceOrientationEvent&&(this.askPermission(),(e=this._viewer)==null||e.renderer.rendererObject.domElement.addEventListener("click",this.askPermission.bind(this)),window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),!0)}askPermission(){this.onScreenOrientationChangeEvent(),typeof DeviceMotionEvent.requestPermission=="function"&&(this.addPermissionMessage(),DeviceOrientationEvent.requestPermission().then(e=>{e=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._viewer.container.removeChild(this.permissionMessage))}).catch(e=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",e)}))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternionDest=new _._fP)}}class iP{constructor(){this._mousePos=new _.FM8(0,0),this._isConnected=!1}getOffsetFromCenter(){return new _.FM8(this._mousePos.x/window.innerWidth*2-1,-(this._mousePos.y/window.innerHeight*2-1))}connect(){this._isConnected||(this._isConnected=!0,window.addEventListener("mousemove",this._onMouseMove.bind(this)))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("mousemove",this._onMouseMove.bind(this)))}_onMouseMove(e){this._mousePos.set(e.clientX,e.clientY)}}var IC,um=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let hm=IC=class extends hs{constructor(){super(),this.enabled=!1,this.enableEdit=!1,this.invert=!1,this.sensitivity=.5,this.focalPointHit=new _.Pa4(0,0,0),this.damping=.5,this.cameraView="",this._target=new _.Pa4,this._center=new _.Pa4,this._pointerDown=!1,this._focalDistance=100,this._updateProjectionMatrix=()=>{var b,et;if(!this.enabled)return void((et=(b=this._object)._updateProjectionMatrixParallax)==null?void 0:et.call(b));const h=this._object,e=h.near;let i=e*Math.tan(.5*_.M8C.DEG2RAD*h.fov)/h.zoom,s=2*i,o=h.aspect*s,c=-.5*o;if(h.view!==null&&h.view.enabled){const tt=h.view.fullWidth,rt=h.view.fullHeight;c+=h.view.offsetX*o/tt,i-=h.view.offsetY*s/rt,o*=h.view.width/tt,s*=h.view.height/rt}c-=this._offX*e/this._focalDistance,i-=this._offY*e/this._focalDistance;const g=h.filmOffset;g!==0&&(c+=e*g/h.getFilmWidth()),h.projectionMatrix.makePerspective(c,c+o,i,i-s,e,h.far),h.projectionMatrixInverse.copy(h.projectionMatrix).invert()},this._preFrame=h=>{this.update(h.deltaTime)},this._offX=0,this._offY=0,this._xDamper=new _e.Damper,this._yDamper=new _e.Damper,this._onEnabledChange=this._onEnabledChange.bind(this),this._onDampingChange=this._onDampingChange.bind(this),this._onObjectHit=this._onObjectHit.bind(this),this._onActiveCameraChange=this._onActiveCameraChange.bind(this)}async onAdded(h){var e,i,s;await super.onAdded(h),CT.IsCompatible()?this._input=new CT(h):this._input=new iP,h.scene.addEventListener("activeCameraChange",this._onActiveCameraChange),this.addIndicator(),h.addEventListener("preFrame",this._preFrame),(e=this._viewer)==null||e.container.addEventListener("pointerdown",this.onPointerDown.bind(this)),(i=this._viewer)==null||i.container.addEventListener("pointerup",this.onPointerUp.bind(this)),(s=h.getPluginByType("Picking"))==null||s.addEventListener("hitObject",this._onObjectHit),this._onEnabledChange()}_onActiveCameraChange(){var h,e,i,s;this._object&&((h=this._object)!=null&&h._updateProjectionMatrixParallax)&&(this._object.updateProjectionMatrix=this._object._updateProjectionMatrixParallax,delete this._object._updateProjectionMatrixParallax),this._focalDistance=.01,this._object=(e=this._viewer)==null?void 0:e.scene.activeCamera.cameraObject,(i=this._object)!=null&&i.isOrthographicCamera?(s=this._viewer)==null||s.console.warn("ParallaxCameraControllerPlugin: Orthographic camera is not supported"):this.enabled&&(this._object._updateProjectionMatrixParallax=this._object.updateProjectionMatrix,this._object.updateProjectionMatrix=this._updateProjectionMatrix)}addIndicator(){var h;this._viewer&&(this._indicator&&this._indicator.remove(),this._indicator=document.createElement("div"),this._indicator.style.width="40px",this._indicator.style.height="40px",this._indicator.style.borderRadius="100%",this._indicator.style.border="4px solid #ff4444",this._indicator.style.transform="translate(-50%, -50%)",this._indicator.style.position="absolute",this._indicator.style.top="0",this._indicator.style.left="0",this._indicator.style.zIndex="10000",this._indicator.style.opacity="0",this._indicator.style.transition="opacity 0.5s",this._indicator.style.pointerEvents="none",(h=this._viewer)==null||h.container.appendChild(this._indicator))}onPointerDown(h){this.enabled&&this._viewer&&(this._pointerDown=!0,this.enableEdit&&this._indicator&&(this._indicator.style.top=h.clientY-this._viewer.container.offsetTop+"px",this._indicator.style.left=h.clientX-this._viewer.container.offsetLeft+"px"))}onPointerUp(){this._pointerDown=!1}update(h){if(!this.enabled||this._pointerDown||!this._input||!this._object||!this._viewer)return;this._viewer.scene.activeCamera.interactionsEnabled=!1,this._updateFocalDistance();const e=this._object.matrixWorld.elements,i=new _.Pa4(e[0],e[1],e[2]),s=new _.Pa4(e[4],e[5],e[6]);this._object.position.copy(this._center),this._viewer.scene.activeCamera.positionUpdated();let o=this.sensitivity;this.invert&&(o*=-1),this._offX=this._xDamper.update(this._offX,this._input.getOffsetFromCenter().x*o,h,1),this._offY=this._yDamper.update(this._offY,this._input.getOffsetFromCenter().y*o,h,1);const c=this._object;c.position.add(s.multiplyScalar(this._offY)).add(i.multiplyScalar(this._offX)),c.updateProjectionMatrix(),c.updateMatrixWorld(),this._dirty=!0}_onObjectHit(h){var e,i;h.intersects.intersect&&this.enableEdit&&(this.focalPointHit.copy(h.intersects.intersect.point),h.intersects.selectedObject=null,(i=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||i.call(e,"postFrame",!0),this._indicator&&(this._indicator.style.display="block",this._indicator.style.opacity="1",setTimeout(()=>{var s,o;this._indicator.style.opacity="0",setTimeout(()=>this._indicator.style.display="none",600),(o=(s=this.uiConfig)==null?void 0:s.uiRefresh)==null||o.call(s,"postFrame",!0)},200)))}_updateFocalDistance(){if(!this._object)return;const h=this._object,e=new _.Pa4;h.getWorldDirection(e),e.normalize(),this._focalDistance=this.focalPointHit.clone().sub(h.position).dot(e)}_onEnabledChange(){var h,e,i;if(this._viewer){if(this.enabled){if((h=this._input)==null||h.connect(),this._onActiveCameraChange(),!this._object)return;this._viewer.scene.activeCamera.interactionsEnabled=!1;const s=this._viewer.getPluginByType("CameraViews"),o=s==null?void 0:s.camViews.find(c=>c.name===this.cameraView);s&&o&&s.setCurrentCameraView(o),this._updateFocalDistance(),this._center.copy(this._object.position),this._object.lookAt(this._viewer.scene.activeCamera.target)}else if(this._object){this._onActiveCameraChange(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._object.position.copy(this._center),this._object.lookAt(this._viewer.scene.activeCamera.target);const s=this._object;s.updateProjectionMatrix(),s.updateMatrixWorld()}(i=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||i.call(e,"postFrame",!0)}}_onDampingChange(){this._xDamper&&this._yDamper&&(this._xDamper.setDecayTime(100*this.damping),this._yDamper.setDecayTime(100*this.damping))}dispose(){var h;(h=this._input)==null||h.disconnect()}};hm.PluginType="ParallaxCameraControllerPlugin",um([(0,_e.onChange)(IC.prototype._onEnabledChange),Mn(),Nr("Enabled")],hm.prototype,"enabled",void 0),um([Mn(),Nr("enableEdit")],hm.prototype,"enableEdit",void 0),um([Mn(),Nr("Invert")],hm.prototype,"invert",void 0),um([Mn(),es("Sensitivity",[.1,2],.01)],hm.prototype,"sensitivity",void 0),um([Mn("focalPoint"),ip("Focal Point Hit",void 0,.001)],hm.prototype,"focalPointHit",void 0),um([(0,_e.onChange)(IC.prototype._onDampingChange),Mn(),es("Damping",[0,1],.001)],hm.prototype,"damping",void 0),um([Mn(),js("Camera View")],hm.prototype,"cameraView",void 0),hm=IC=um([Ms("Parallax Camera Controller")],hm);var PC=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let zm=class extends hs{addNoiseBumpMaterial(h){return RC(h.materialObject)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new MT(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Lr],this._uniforms={noiseBumpParams:{value:new _.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},flakeParams:{value:new _.Ltg(0,1,3,0)},flakeFallOffParams:{value:new _.Pa4(0,1,0)},useColorFlakes:{value:!1}},this.materialExtension={parsFragmentSnippet:(h,e)=>{var i;return this.enabled&&((i=e==null?void 0:e.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)?m_+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform bool useColorFlakes;uniform vec4 flakeParams;uniform vec3 flakeFallOffParams;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(h,e,i)=>{var o;if(!this.enabled||!((o=e.materialObject.userData._noiseBumpMat)!=null&&o.hasBump))return;const s="#glMarker beforeAccumulation";h.fragmentShader=h.fragmentShader.replace(s,`vec3 outColor,outColor1,outColor2,outColor3,outColor4,outColor5;float distFac=length(vViewPosition.xyz);float level=1.;vec2 uvMod=noiseBumpFlakeScale*noiseBumpParams.xy*vUv*level;float voronoiDist=clamp(voronoi_f1_2d(uvMod,1.,noiseFlakeClamp,noiseFlakeRadius,outColor),0.,1.);vec3 oldNormal=normal;normal=perturbNormalArb_nb(-vViewPosition,normal,(2.*outColor.xy-1.)*noiseBumpScale,faceDirection);float oldRoughnessFactor=roughnessFactor;float oldMetalnessFactor=metalnessFactor;roughnessFactor=mix(roughnessFactor,flakeParams.x,1.-voronoiDist);metalnessFactor=mix(metalnessFactor,flakeParams.y,1.-voronoiDist);
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
vec3 sparkleRadiance=getIBLRadiance(normalize(vViewPosition),normal,roughnessFactor);float sparkleIntensity=length(sparkleRadiance);float sparkleIntensityMultiplier=sparkleIntensity>1.3?flakeParams.z:1.;vec3 oldDiffuseColor=diffuseColor.rgb;vec2 cellPosition_=floor(uvMod);vec3 colorRGB=useColorFlakes?hash3(cellPosition_):vec3(1.);float fallOff_=mix(1.,1./(1.+flakeFallOffParams.y*distFac+flakeFallOffParams.z*distFac*distFac),flakeFallOffParams.x);diffuseColor.rgb*=mix(vec3(1.),sparkleIntensityMultiplier*colorRGB*fallOff_,vec3(1.-voronoiDist));if(sparkleIntensity<flakeParams.w){float mixFactor=1.;roughnessFactor=mix(roughnessFactor,oldRoughnessFactor,mixFactor);metalnessFactor=mix(metalnessFactor,oldMetalnessFactor,mixFactor);normal=normalize(mix(normal,oldNormal,mixFactor));diffuseColor.rgb=mix(diffuseColor.rgb,oldDiffuseColor,mixFactor);}
#endif

`+s),h.defines.USE_UV="",h.extensionDerivatives=!0},onObjectRender:(h,e)=>{var o;const i=(o=e.materialObject.userData)==null?void 0:o._noiseBumpMat;if(!(i!=null&&i.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(i.bumpNoiseParams),this._uniforms.noiseBumpScale.value=i.bumpScale,this._uniforms.noiseBumpFlakeScale.value=i.flakeScale,this._uniforms.noiseFlakeClamp.value=i.flakeClamp,this._uniforms.noiseFlakeRadius.value=i.flakeRadius,i.flakeParams&&this._uniforms.flakeParams.value.copy(i.flakeParams),i.flakeFallOffParams&&this._uniforms.flakeFallOffParams.value.copy(i.flakeFallOffParams),this._uniforms.useColorFlakes.value=i.useColorFlakes;const s=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==s&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=s,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i;return(this.enabled?"1":"0")+((i=(e=h.materialObject.userData)==null?void 0:e._noiseBumpMat)!=null&&i.hasBump?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:h=>{const e=this._viewer,i={type:"folder",label:"SparkleBump (NoiseBump)",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.hasBump)||!1},set value(s){var o,c;s!==((o=h.materialObject.userData._noiseBumpMat)==null?void 0:o.hasBump)&&(s?RC(h.materialObject)||e.alert("Cannot add noise bump."):h.materialObject.userData._noiseBumpMat&&(h.materialObject.userData._noiseBumpMat.hasBump=!1,h.materialObject.needsUpdate=!0),(c=i.uiRefresh)==null||c.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var s;return!((s=h.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.001],stepSize:1e-5,hidden:()=>{var s;return!((s=h.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var s;return!((s=h.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var s;return!((s=h.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.01,1],stepSize:.001,hidden:()=>{var s;return!((s=h.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>{var s;return{type:"slider",label:"Flake Roughness",bounds:[0,1],stepSize:.01,hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeParams,"x"],onChange:this.setDirty}},()=>{var s;return{type:"slider",label:"Flake Metalness",bounds:[0,1],stepSize:.01,hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeParams,"y"],onChange:this.setDirty}},()=>{var s;return{type:"slider",label:"Flake Strength",bounds:[0,100],stepSize:.001,hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeParams,"z"],onChange:this.setDirty}},()=>{var s;return{type:"slider",label:"Flake Threshold",bounds:[.1,10],stepSize:.001,hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeParams,"w"],onChange:this.setDirty}},()=>{var s;return{type:"slider",label:"Falloff",stepSize:1,bounds:[0,1],hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeFallOffParams,"x"],onChange:this.setDirty}},()=>{var s;return{type:"slider",label:"Linear falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeFallOffParams,"y"],onChange:this.setDirty}},()=>{var s;return{type:"slider",label:"Quadratic falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeFallOffParams,"z"],onChange:this.setDirty}},()=>({type:"checkbox",label:"Colored Flakes",hidden:()=>{var s;return!((s=h.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"useColorFlakes"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var h,e,i;(e=(h=this.materialExtension).setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,g;await super.onAdded(h);const e=h.getPlugin(Lr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(g=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||g.push(mB)}async onRemove(h){var e,i,s,o;return(i=(e=h.getPlugin(Lr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),(o=(s=h.getPlugin(Lr))==null?void 0:s.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};function RC(h){const e=h==null?void 0:h.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const i=e._noiseBumpMat;return i.hasBump=!0,i.bumpNoiseParams===void 0&&(i.bumpNoiseParams=[.5,.5]),i.bumpScale===void 0&&(i.bumpScale=.05),i.flakeScale===void 0&&(i.flakeScale=.05),i.flakeClamp===void 0&&(i.flakeClamp=1),i.flakeRadius===void 0&&(i.flakeRadius=.3),i.useColorFlakes===void 0&&(i.useColorFlakes=!1),i.flakeParams===void 0&&(i.flakeParams=new _.Ltg(0,1,3,0)),i.flakeFallOffParams===void 0&&(i.flakeFallOffParams=new _.Pa4(0,1,0)),h.isMaterial&&(h.needsUpdate=!0),!0}zm.PluginType="NoiseBumpMaterialPlugin",zm.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",PC([Nr("Enabled",h=>({onChange:h.setDirty})),Mn()],zm.prototype,"enabled",void 0),zm=PC([Ms("NoiseBump Materials")],zm);class MT{constructor(e){this.parser=e,this.name=zm.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return i.userData||(i.userData={}),RC(i),i.userData._noiseBumpMat=Oo(o,i.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const mB=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;i.extensions=i.extensions||{};const s=To(e.userData._noiseBumpMat,!1);i.extensions[zm.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=s,h.extensionsUsed[zm.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});class TT extends io{constructor(e,i){super({vertexShader:dt.vertexShader,fragmentShader:i+`
`+Dx+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(1,1,getDepth(uv+offset.yy*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zy*texelSize));vec3 dtl=vec3(-1,1,getDepth(uv+offset.xy*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.xz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.yz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.xx*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zx*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.yx*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);
#if HAS_VELOCITY_BUFFER == 0
vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=texture2D(tVelocity,c_frag.xy).xy*2.-1.;screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new _.FM8},cameraNearFar:{value:new _.FM8},lastProjectionViewMatrix:{value:new _.yGw},currentProjectionViewMatrix:{value:new _.yGw},projection:{value:new _.yGw},inverseViewMatrix:{value:new _.yGw},jitterSample:{value:new _.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new _.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",stepSize:1e-4,property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,i,s,o,c){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const g=this.uniforms.tVelocity.value?1:0;g!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=g,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,i,s,o,c),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,i){super.setSize(e,i),this.onSizeUpdate()}}(function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);c>3&&g&&Object.defineProperty(e,i,g)})([Mn(),hr()],TT.prototype,"feedBack",void 0);class Kx extends Tm{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[bo],this._stableNoise=!0,this._stableNoiseConfig={label:"Stable Noise (Use Total Frame Count)",type:"checkbox",property:[this,"stableNoise"]}}passCtor(e){if(!e.getPlugin(cp))throw"Add ProgressivePlugin before TAA";const i=new TT(e.getPlugin(cp).lastFrame,e.getPlugin(bo).getUnpackSnippet());return e.renderer.addEventListener("resize",i.onSizeUpdate),i}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const i=e.renderer.frameCount,s=this._pass.passObject;if(s.taaEnabled=i<=1&&e.scene.renderCamera===e.scene.activeCamera,!s.taaEnabled)return!1;const o=e.scene.renderCamera;return s.updateShaderProperties([e.getPlugin(bo),o,e.getPluginByType("VelocityBuffer")]),s.target=e.getPlugin(cp).lastFrame,s.updateCameraProperties(o==null?void 0:o.cameraObject),!0}async onAdded(e){await super.onAdded(e),this.stableNoise=this._stableNoise}get stableNoise(){var e;return((e=this._viewer)==null?void 0:e.renderer.stableNoise)??this._stableNoise}set stableNoise(e){this._viewer&&(this._viewer.renderer.stableNoise=e),this._stableNoise=e}get uiConfig(){var i;const e=(i=this.pass)==null?void 0:i.passObject.uiConfig;if(e&&e.children)return e.children.includes(this._stableNoiseConfig)||e.children.push(this._stableNoiseConfig),e}}Kx.PluginType="TAA";var tA=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let dm=class extends hs{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=h=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const i=this._lastFsElement||((e=this._viewer)==null?void 0:e.canvas);i&&(i.style.width=this._lastSize[0],i.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(h){var i;if(this.isFullScreen())return;const e=h||((i=this._viewer)==null?void 0:i.canvas);return e?(this._lastFsElement=e,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[e.style.width,e.style.height],e.style.width="100%",e.style.height="100%",e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(h){return this.isFullScreen()?this.exit():this.enter(h)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};dm.PluginType="FullScreenPlugin",tA([go("Enter FullScreen")],dm.prototype,"enter",null),tA([go("Exit FullScreen")],dm.prototype,"exit",null),tA([go("Toggle FullScreen")],dm.prototype,"toggle",null),dm=tA([Ms("Full Screen")],dm);const gB=(h,e)=>{const i={};for(const s of h.mappings)for(const o of s.variants)i[e[o]]={material:null,gltfMaterialIndex:s.material};return i},xw="KHR_materials_variants";class rP{constructor(e){this.parser=e,this.name=xw}async afterRoot(e){const i=this.parser,s=i.json;if(!s.extensions||!s.extensions[this.name])return;const o=(c=>{const g=[],b=new Set;for(const et of c){let tt=et,rt=0;for(;b.has(tt);)tt=et+"."+ ++rt;b.add(tt),g.push(tt)}return g})((s.extensions[this.name].variants||[]).map(c=>c.name));for(const c of e.scenes)c.traverse(g=>{const b=i.associations.get(g);if(!b||b.meshes===void 0||b.primitives===void 0)return;const et=s.meshes[b.meshes].primitives[b.primitives].extensions;et&&et[this.name]&&(g.userData._variantMaterials=gB(et[this.name],o))});await Promise.all(e.scenes.map(async c=>{const g=[];return c.traverse(b=>{return(et=b).material!==void 0&&et.userData&&et.userData._variantMaterials&&g.push((async tt=>{const rt=tt.material,st=tt.userData._variantMaterials,at=[];for(const ct in st){const pt=st[ct];if(pt.material)continue;const gt=pt.gltfMaterialIndex;at.push(i.getDependency("material",gt).then(At=>{tt.material=At,i.assignFinalMaterial(tt),st[ct].material=tt.material}))}return Promise.all(at).then(()=>{tt.material=rt})})(b));var et}),c.userData.__importData||(c.userData.__importData={}),c.userData.__importData[xw]={names:o},Promise.all(g)}))}}const IT=h=>h.material!==void 0&&h.userData&&h.userData._variantMaterials&&!!Object.values(h.userData._variantMaterials).filter(e=>SE(e==null?void 0:e.material)),SE=h=>h&&h.isMaterial&&!Array.isArray(h);class PT{constructor(e){this.writer=e,this.name=xw,this.variantNames=[]}beforeParse(e){const i=new Set;for(const s of e)s.traverse(o=>{if(!IT(o))return;const c=o.userData._variantMaterials;for(const g in c){const b=c[g];SE(b.material)&&i.add(g)}});i.forEach(s=>this.variantNames.push(s))}writeMesh(e,i){if(!IT(e))return;const s=e.userData,o=s._variantMaterials,c={};for(const et in o){const tt=o[et].material;if(!SE(tt))continue;const rt=this.variantNames.indexOf(et),st=this.writer.processMaterial(tt);c[st]||(c[st]={material:st,variants:[]}),c[st].variants.push(rt)}const g=Object.values(c).map(et=>et.variants.sort((tt,rt)=>tt-rt)&&et).sort((et,tt)=>et.material-tt.material);if(g.length===0)return;const b=SE(s._originalMaterial)?this.writer.processMaterial(s._originalMaterial)??-1:-1;for(const et of i.primitives)b>=0&&(et.material=b),et.extensions=et.extensions||{},et.extensions[this.name]={mappings:g}}afterParse(e){if(this.variantNames.length===0)return;const i=this.writer.json;i.extensions=i.extensions||{};const s=this.variantNames.map(o=>({name:o}));i.extensions[this.name]={variants:s},this.writer.extensionsUsed[this.name]=!0}}function DC(h){return new PT(h)}class i0 extends hs{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[Lr],this.variants={},this.selectedVariant="",this._objectAdded=e=>{var s,o;const i=e.object;(i==null?void 0:i.assetType)==="model"&&i.modelObject&&this._viewer&&(i.modelObject.traverse(c=>{var et,tt,rt,st,at;if(c.userData._variantMaterials)for(const ct of Object.values(c.userData._variantMaterials))ct!=null&&ct.material&&(ct.material=((rt=(tt=(et=this._viewer)==null?void 0:et.getManager())==null?void 0:tt.materials)==null?void 0:rt.processMaterial(ct.material,{}))||ct.material);const g=(at=(st=c.userData)==null?void 0:st.__importData)==null?void 0:at[xw];if(!g)return;const b=g.names||[];for(const ct of b)this.variants[ct]||(this.variants[ct]=[]),this.variants[ct].push(c);delete c.userData.__importData[xw]}),(o=(s=this.uiConfig).uiRefresh)==null||o.call(s))},this.uiConfig={type:"folder",label:"KHR Material Variants",children:[()=>({children:[null,...Object.keys(this.variants)].map(e=>e?{label:e}:{label:"none",value:""}),type:"dropdown",label:"Variant",property:[this,"selectedVariant"]})]},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var s,o,c,g;await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._objectAdded);const i=e.getPlugin(Lr);(s=i==null?void 0:i.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(g=(c=(o=i==null?void 0:i.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||g.push(DC)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(i=>new rP(i))}async onRemove(e){var o,c,g,b,et,tt;e.scene.removeEventListener("addSceneObject",this._objectAdded);const i=e.getPlugin(Lr);(o=i.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate);const s=(b=(g=(c=i.exporter)==null?void 0:c.getExporter("gltf","glb"))==null?void 0:g.extensions)==null?void 0:b.indexOf(DC);return s!==void 0&&s!==-1&&((tt=(et=i.exporter.getExporter("gltf","glb"))==null?void 0:et.extensions)==null||tt.splice(s,1)),this.variants={},super.onRemove(e)}_variantChanged(){this.applyVariant(this.selectedVariant||"",!0)}applyVariant(e,i=!1,s,o=!0){if(!i&&!s&&this.selectedVariant===e||!e)return;s||(this.selectedVariant=e);const c=s?Array.isArray(s)?s:[s]:e?this.variants[e]||[]:Object.values(this.variants).flat();for(const g of c){const b=new Set,et=tt=>{var st,at;if(!tt.userData._variantMaterials||b.has(tt))return;const rt=e?(st=tt.userData._variantMaterials[e])==null?void 0:st.material:tt.userData._originalMaterial;rt&&(tt.userData._originalMaterial||(tt.userData._originalMaterial=tt.material),(at=tt==null?void 0:tt.setMaterial)==null||at.call(tt,rt)),b.add(tt)};o?g.traverse(et):et(g)}}}i0.PluginType="GLTFKHRMaterialVariantsPlugin",function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);c>3&&g&&Object.defineProperty(e,i,g)}([(0,_e.onChange)(i0.prototype._variantChanged)],i0.prototype,"selectedVariant",void 0);function Jx(h){const e=h==null?void 0:h.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const i=e._ssBevel;return i.hasSSBevel=!0,i.radius===void 0&&(i.radius=0),h.isMaterial&&(h.needsUpdate=!0),!0}let $x=class extends io{constructor(h,e,i,s){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new _.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new _.Pa4(1,1,1)}},vertexShader:om,fragmentShader:`

            ${i}

            ${m_}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
float getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(o,c,g)=>{var b,et;this.enabled&&((et=(b=c.materialObject.userData)==null?void 0:b._ssBevel)!=null&&et.hasSSBevel)&&(o.fragmentShader=rs(o.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(o,c,g)=>{var tt,rt;if(!this.enabled||!((rt=(tt=c.materialObject.userData)==null?void 0:tt._ssBevel)!=null&&rt.hasSSBevel))return;const b=c.materialObject,et=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==et&&(this.materialExtension.extraUniforms.tSSBevelMap.value=et,b.needsUpdate=!0)},getUiConfig:o=>{const c={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var g;return((g=o.materialObject.userData._ssBevel)==null?void 0:g.hasSSBevel)||!1},set value(g){var b,et;g!==((b=o.materialObject.userData._ssBevel)==null?void 0:b.hasSSBevel)&&(g?Jx(o.materialObject)||alert("Cannot add screen space bevel."):o.materialObject.userData._ssBevel&&(o.materialObject.userData._ssBevel.hasSSBevel=!1,o.materialObject.needsUpdate=!0),(et=c.uiRefresh)==null||et.call(c,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var g;return!((g=o.materialObject.userData._ssBevel)!=null&&g.hasSSBevel)},property:[o.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return c},parsFragmentSnippet:(o,c)=>{var g,b;return this.enabled&&((b=(g=c==null?void 0:c.materialObject.userData)==null?void 0:g._ssBevel)!=null&&b.hasSSBevel)?_e.glsl`
            uniform sampler2D tSSBevelMap;
            ${Y1}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:o=>{var c,g;return(this.enabled?"1":"0")+((g=(c=o.materialObject.userData)==null?void 0:c._ssBevel)!=null&&g.hasSSBevel?"1":"0")},isCompatible:o=>o.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=s,this._edgeMaterial=new U_({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new _.FM8(1,1)},cameraPositionWorld:{value:new _.Pa4(1,1,1)}},vertexShader:om,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new U_({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new _.FM8(.5,.5)},direction:{value:new _.FM8(.5,.5)}},vertexShader:om,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(h,e,i,s,o){var et,tt;if(!this.enabled)return;const c=h.baseRenderer,g={minFilter:_.wem,magFilter:_.wem,isAntialiased:!1,format:_.wk1,depthBuffer:!1,generateMipmaps:!1},b=c.getTempTarget(g);this._renderEdges(c,b),this._blurEdges(c,b),this._viewerApp.scene.renderCamera.updateShaderProperties(this.material),(et=this._viewerApp.getPlugin(bo))==null||et.updateShaderProperties(this.material),(tt=this._viewerApp.getPlugin(av))==null||tt.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=b.texture,super.render(h,this._target,b,s,o),c.releaseTempTarget(b)}_initsamples(){const h=[];return h.push(new _.FM8(-8,0).multiplyScalar(.125)),h.push(new _.FM8(-6,-4).multiplyScalar(.125)),h.push(new _.FM8(-3,-2).multiplyScalar(.125)),h.push(new _.FM8(-2,-6).multiplyScalar(.125)),h.push(new _.FM8(1,-1).multiplyScalar(.125)),h.push(new _.FM8(2,-5).multiplyScalar(.125)),h.push(new _.FM8(6,-7).multiplyScalar(.125)),h.push(new _.FM8(5,-3).multiplyScalar(.125)),h.push(new _.FM8(4,1).multiplyScalar(.125)),h.push(new _.FM8(7,4).multiplyScalar(.125)),h.push(new _.FM8(3,5).multiplyScalar(.125)),h.push(new _.FM8(0,7).multiplyScalar(.125)),h.push(new _.FM8(-1,3).multiplyScalar(.125)),h.push(new _.FM8(-4,6).multiplyScalar(.125)),h.push(new _.FM8(-7,8).multiplyScalar(.125)),h.push(new _.FM8(-5,2).multiplyScalar(.125)),h}_blurEdges(h,e){var g,b;const i={minFilter:_.wem,magFilter:_.wem,isAntialiased:!1,format:_.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},s=h.getTempTarget(i),o=((g=e.texture.image)==null?void 0:g.width)||1,c=((b=e.texture.image)==null?void 0:b.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new _.FM8(o,c),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new _.FM8(1,0),h.blit(void 0,s,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new _.FM8(o/2,c/2),this._separableBlurMaterial.uniforms.colorTexture.value=s.texture,this._separableBlurMaterial.uniforms.direction.value=new _.FM8(0,1),h.blit(void 0,e,{material:this._separableBlurMaterial}),h.releaseTempTarget(s)}_renderEdges(h,e){var o,c,g,b;const i=((o=e.texture.image)==null?void 0:o.width)||1,s=((c=e.texture.image)==null?void 0:c.height)||1;this._edgeMaterial.uniforms.screenSize.value=new _.FM8(i,s),this._viewerApp.scene.renderCamera.updateShaderProperties(this._edgeMaterial),(g=this._viewerApp.getPlugin(bo))==null||g.updateShaderProperties(this._edgeMaterial),(b=this._viewerApp.getPlugin(av))==null||b.updateShaderProperties(this._edgeMaterial),h.blit(void 0,e,{material:this._edgeMaterial})}};$x=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g}([Ms("SSBevel")],$x);class b_ extends Tm{get bevelTarget(){return this._bevelTarget}constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[Lr,bo,av],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(i=>new sP(i))}passCtor(e){var i;return this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:_.cLu,minFilter:_.TyD,magFilter:_.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1,e.getPluginByType("debug"),new $x(e.renderer,this._bevelTarget,((i=e.getPlugin(bo))==null?void 0:i.getUnpackSnippet())??"",e)}async onAdded(e){var s,o,c,g,b,et,tt,rt;await super.onAdded(e);const i=e.getPlugin(Lr);return(s=this.pass)!=null&&s.passObject.materialExtension&&((c=i==null?void 0:i.materials)==null||c.registerMaterialExtension((o=this.pass)==null?void 0:o.passObject.materialExtension)),(g=i==null?void 0:i.importer)==null||g.addEventListener("loaderCreate",this._loaderCreate),(tt=(et=(b=i==null?void 0:i.exporter)==null?void 0:b.getExporter("gltf","glb"))==null?void 0:et.extensions)==null||tt.push(vB),(rt=e.getPlugin(bo))==null||rt.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,i,s,o;(e=this._viewer)==null||e.setDirty(),(o=(i=this.pass)==null?void 0:(s=i.passObject.materialExtension).setDirty)==null||o.call(s)}_update(e){var s,o;let i=this.enabled;if(i&&!this._lastEnabled){const c=(s=this._viewer)==null?void 0:s.getPluginByType("NormalBufferPlugin");c&&!c.enabled&&(c.enabled=!0),c||((o=this._viewer)==null||o.console.error("SSBevelPlugin needs NormalBufferPlugin"))}return this._lastEnabled=i,i}get uiConfig(){var i,s,o,c;const e=((s=(i=this.pass)==null?void 0:i.passObject)==null?void 0:s.uiConfig)??{};return(c=(o=e.children)==null?void 0:o.map(g=>(0,_e.getOrCall)(g)))==null||c.flat(2).forEach(g=>g&&(g.onChange=this.setDirty)),e}updateGBuffer(e,i){var s,o,c;if(e instanceof _.Kj0&&((s=e.material)!=null&&s.userData)){for(let b=3;b<8;b++)i.y=f2(i.y,b);let g=(o=e.material)!=null&&o.userData._ssBevel?(c=e.material)==null?void 0:c.userData._ssBevel.radius:0;g=Math.min(g,31),g<<=3,i.y=i.y|g}}}b_.PluginType="SSBevelPlugin",b_.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class sP{constructor(e){this.parser=e,this.name=b_.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return i.userData||(i.userData={}),Jx(i),i.userData._ssBevel=Oo(o,i.userData._ssBevel,!1,{}),Promise.resolve()}}const vB=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;i.extensions=i.extensions||{};const s=To(e.userData._ssBevel,!1);i.extensions[b_.SSBEVEL_GLTF_EXTENSION]=s,h.extensionsUsed[b_.SSBEVEL_GLTF_EXTENSION]=!0}});class oP{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,i,s){this.enabled&&(e.fragmentShader=rs(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class kC extends O0{generateExtension(e){return new oP}}kC.PluginType="GammaCorrection";var RT=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let w_=class extends hs{addTriplanarMapping(h){var i;const e=(i=h.materialObject)==null?void 0:i.userData;return!!e&&(e._triplanarMapping||(e._triplanarMapping={}),e._triplanarMapping.enable=!0,e._triplanarMapping.scaleFactor===void 0&&(e._triplanarMapping.scaleFactor=1),e._triplanarMapping.blendFactor===void 0&&(e._triplanarMapping.blendFactor=1),e._triplanarMapping.offsetFactor===void 0&&(e._triplanarMapping.offsetFactor=0),h.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new BC(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Lr],this._uniforms={triplanarScale:{value:1},triplanarBlend:{value:1},triplanarOffset:{value:0}},this.materialExtension={shaderExtender:(h,e,i)=>{var et,tt;if(!this.enabled||!((tt=(et=e.materialObject.userData)==null?void 0:et._triplanarMapping)!=null&&tt.enable))return;const s=_e.glsl`
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;h.vertexShader=rs(h.vertexShader,"#include <common>",s,{prepend:!0});const o=_e.glsl`
                #ifndef USE_TRANSMISSION
                    vWorldPosition = worldPosition.xyz;
                #endif
                vWorldNormal = normalize((modelMatrix * vec4(objectNormal, 0.)).xyz);
            `;h.vertexShader=rs(h.vertexShader,"#include <worldpos_vertex>",o,{append:!0});const c=_e.glsl`
                ${"struct TriplanarUV{vec2 x;vec2 y;vec2 z;};uniform float triplanarScale;uniform float triplanarBlend;uniform float triplanarOffset;vec3 getTriplanarWeights(in vec3 position,in vec3 normal){vec3 triW=abs(normal);triW=clamp(triW-vec3(triplanarOffset),vec3(0.),vec3(1.));triW=pow(triW,vec3(triplanarBlend));return triW/(triW.x+triW.y+triW.z);}TriplanarUV getTriplanarUV(in vec3 position,in vec3 normal){TriplanarUV triUV;triUV.x=position.zy*triplanarScale;triUV.y=position.xz*triplanarScale;triUV.z=position.xy*triplanarScale;if(normal.x<0.){triUV.x.x=-triUV.x.x;}if(normal.y<0.){triUV.y.x=-triUV.y.x;}if(normal.z>=0.){triUV.z.x=-triUV.z.x;}return triUV;}vec4 textureTriplanar(in sampler2D tex,in vec3 position,in vec3 normal){TriplanarUV triUV=getTriplanarUV(position,normal);vec4 texX=texture2D(tex,triUV.x);vec4 texY=texture2D(tex,triUV.y);vec4 texZ=texture2D(tex,triUV.z);vec3 triW=getTriplanarWeights(position,normal);return texX*triW.x+texY*triW.y+texZ*triW.z;}"}
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;h.fragmentShader=rs(h.fragmentShader,"#include <common>",c,{prepend:!0});const g=_e.glsl`

            #ifdef USE_BUMPMAP

            uniform sampler2D bumpMap;
            uniform float bumpScale;

            // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
            // https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

            // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

            vec2 dHdxy_fwd() {

                vec3 dSTdx = dFdx( vWorldPosition );
                vec3 dSTdy = dFdy( vWorldPosition );

                vec3 normal_ = normalize(vWorldNormal);
                float Hll = bumpScale * textureTriplanar( bumpMap, vWorldPosition, normal_ ).x;
                float dBx = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdx, normal_ ).x - Hll;
                float dBy = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdy, normal_ ).x - Hll;

                return vec2( dBx, dBy );

            }

            vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

                vec3 vSigmaX = dFdx( surf_pos.xyz );
                vec3 vSigmaY = dFdy( surf_pos.xyz );
                vec3 vN = surf_norm; // normalized

                vec3 R1 = cross( vSigmaY, vN );
                vec3 R2 = cross( vN, vSigmaX );

                float fDet = dot( vSigmaX, R1 ) * faceDirection;

                vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
                return normalize( abs( fDet ) * surf_norm - vGrad );

            }

        #endif
            `;h.fragmentShader=rs(h.fragmentShader,"#include <bumpmap_pars_fragment>",g);let b=rs(_.WdD.map_fragment,"texture2D( map, vMapUv );","textureTriplanar( map, vWorldPosition, normalize(vWorldNormal) );");h.fragmentShader=rs(h.fragmentShader,"#include <map_fragment>",b),b=rs(_.WdD.roughnessmap_fragment,"texture2D( roughnessMap, vRoughnessMapUv );","textureTriplanar( roughnessMap, vWorldPosition, normalize(vWorldNormal));"),h.fragmentShader=rs(h.fragmentShader,"#include <roughnessmap_fragment>",b),b=rs(_.WdD.metalnessmap_fragment,"texture2D( metalnessMap, vMetalnessMapUv );","textureTriplanar( metalnessMap, vWorldPosition, normalize(vWorldNormal));"),h.fragmentShader=rs(h.fragmentShader,"#include <metalnessmap_fragment>",b),b=rs(_.WdD.normal_fragment_maps,"vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;","vec3 mapN = textureTriplanar( normalMap, vWorldPosition, normalize(vWorldNormal) ).xyz * 2.0 - 1.0;"),h.fragmentShader=rs(h.fragmentShader,"#include <normal_fragment_maps>",b),h.defines.USE_UV=""},onObjectRender:(h,e)=>{var o,c,g,b;const i=e.materialObject.userData;if(!((o=i==null?void 0:i._triplanarMapping)!=null&&o.enable))return;const s=h;s.isMesh&&s.geometry&&(this._uniforms.triplanarScale.value=(c=i._triplanarMapping)==null?void 0:c.scaleFactor,this._uniforms.triplanarBlend.value=(g=i._triplanarMapping)==null?void 0:g.blendFactor,this._uniforms.triplanarOffset.value=(b=i._triplanarMapping)==null?void 0:b.offsetFactor)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i;return(this.enabled?"1":"0")+((i=(e=h.materialObject.userData)==null?void 0:e._triplanarMapping)!=null&&i.enable?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>{var h;return[(h=this._viewer)==null?void 0:h.renderer]},getUiConfig:h=>{const e=this._viewer,i=this.addTriplanarMapping,s={type:"folder",label:"Triplanar",children:[{type:"checkbox",label:"Enabled",get value(){var o;return((o=h.materialObject.userData._triplanarMapping)==null?void 0:o.enable)||!1},set value(o){var c,g;o!==((c=h.materialObject.userData._triplanarMapping)==null?void 0:c.enable)&&(o?i(h)||e.alert("Cannot add Triplanar mapping."):h.materialObject.userData._triplanarMapping&&(h.materialObject.userData._triplanarMapping.enable=!1,h.materialObject.needsUpdate=!0),(g=s.uiRefresh)==null||g.call(s,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[.1,10],label:"Scale",hidden:()=>{var o;return!((o=h.materialObject.userData._triplanarMapping)!=null&&o.enable)},property:[h.materialObject.userData._triplanarMapping,"scaleFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[1,10],label:"Blend",hidden:()=>{var o;return!((o=h.materialObject.userData._triplanarMapping)!=null&&o.enable)},property:[h.materialObject.userData._triplanarMapping,"blendFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,.5],stepSize:.01,label:"Offset",hidden:()=>{var o;return!((o=h.materialObject.userData._triplanarMapping)!=null&&o.enable)},property:[h.materialObject.userData._triplanarMapping,"offsetFactor"],onChange:this.setDirty})]};return s}},this.setDirty=()=>{var h,e,i;(e=(h=this.materialExtension).setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,g;await super.onAdded(h);const e=h.getPlugin(Lr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(g=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||g.push(DT)}async onRemove(h){var e,i,s,o;return(i=(e=h.getPlugin(Lr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),(o=(s=h.getPlugin(Lr))==null?void 0:s.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};w_.PluginType="TriplanarUVMappingPlugin",w_.TRIPLANAR_GLTF_EXTENSION="WEBGI_materials_triplanar",RT([Nr("Enabled",h=>({onChange:h.setDirty})),Mn()],w_.prototype,"enabled",void 0),w_=RT([Ms("Triplanar Mapping")],w_);class BC{constructor(e){this.parser=e,this.name=w_.TRIPLANAR_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];i.userData||(i.userData={});const c=i.userData;return c._triplanarMapping||(c._triplanarMapping={}),c._triplanarMapping.enable=!0,c._triplanarMapping.scaleFactor===void 0&&(c._triplanarMapping.scaleFactor=1),c._triplanarMapping.blendFactor===void 0&&(c._triplanarMapping.blendFactor=1),c._triplanarMapping.offsetFactor===void 0&&(c._triplanarMapping.offsetFactor=0),i.userData._triplanarMapping=Oo(o,i.userData._triplanarMapping,!1,{}),Promise.resolve()}}const DT=h=>({writeMaterial:(e,i)=>{var o;if(!e.isMeshStandardMaterial||!((o=e.userData._triplanarMapping)!=null&&o.enable))return;i.extensions=i.extensions||{};const s=To(e.userData._triplanarMapping,!1);i.extensions[w_.TRIPLANAR_GLTF_EXTENSION]=s,h.extensionsUsed[w_.TRIPLANAR_GLTF_EXTENSION]=!0}});var aP=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let zv=class extends hs{addClearcoatTint(h){return kT(h.materialObject)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new lP(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Lr],this._defines={},this._uniforms={ccTintColor:{value:new zo},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(h,e)=>{var i;return this.enabled&&((i=e==null?void 0:e.materialObject.userData._clearcoatTint)!=null&&i.enableTint)&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(h,e,i)=>{var c;if(!(this.enabled&&((c=e==null?void 0:e.materialObject.userData._clearcoatTint)!=null&&c.enableTint)&&e.materialObject.clearcoat>0))return;const s="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",o="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";h.fragmentShader.includes(o)&&h.fragmentShader.includes(s)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),h.fragmentShader=h.fragmentShader.replace(o,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),h.fragmentShader=h.fragmentShader.replace(s,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+s),h.defines.USE_UV=""},onObjectRender:(h,e)=>{var o;const i=(o=e.materialObject.userData)==null?void 0:o._clearcoatTint;if(!(i!=null&&i.enableTint))return;this._uniforms.ccTintColor.value.set(i.tintColor),this._uniforms.ccThickness.value=i.thickness,this._uniforms.ccIor.value=i.ior;const s=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==s&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=s,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i;return(this.enabled?"1":"0")+((i=(e=h.materialObject.userData)==null?void 0:e._clearcoatTint)!=null&&i.enableTint?"1":"0")+(h.materialObject.clearcoat>0?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:h=>{const e=this._viewer,i={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=h.materialObject.userData._clearcoatTint)==null?void 0:s.enableTint)||!1},set value(s){var o,c;s!==((o=h.materialObject.userData._clearcoatTint)==null?void 0:o.enableTint)&&(s?kT(h.materialObject)||e.alert("Cannot add clearcoat tint."):h.materialObject.userData._clearcoatTint&&(h.materialObject.userData._clearcoatTint.enableTint=!1,h.materialObject.needsUpdate=!0),(c=i.uiRefresh)==null||c.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var s;return!((s=h.materialObject.userData._clearcoatTint)!=null&&s.enableTint)},property:[h.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var s;return!((s=h.materialObject.userData._clearcoatTint)!=null&&s.enableTint)},property:[h.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var s;return!((s=h.materialObject.userData._clearcoatTint)!=null&&s.enableTint)},property:[h.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var h,e,i;(e=(h=this.materialExtension).setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,g;await super.onAdded(h);const e=h.getPlugin(Lr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(g=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||g.push(cP)}async onRemove(h){var e,i,s,o;return(i=(e=h.getPlugin(Lr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),(o=(s=h.getPlugin(Lr))==null?void 0:s.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};function kT(h){const e=h==null?void 0:h.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const i=e._clearcoatTint;return i.enableTint=!0,i.tintColor===void 0&&(i.tintColor=16777215),i.thickness===void 0&&(i.thickness=.1),i.ior===void 0&&(i.ior=1.5),h.isMaterial&&(h.needsUpdate=!0),!0}zv.PluginType="ClearcoatTintPlugin",zv.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",aP([Nr("Enabled",h=>({onChange:h.setDirty})),Mn()],zv.prototype,"enabled",void 0),zv=aP([Ms("ClearcoatTint Materials")],zv);class lP{constructor(e){this.parser=e,this.name=zv.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return i.userData||(i.userData={}),kT(i),Oo(o,i.userData._clearcoatTint,!1,{}),Promise.resolve()}}const cP=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;i.extensions=i.extensions||{};const s=To(e.userData._clearcoatTint,!1);i.extensions[zv.CLEARCOAT_TINT_GLTF_EXTENSION]=s,h.extensionsUsed[zv.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});class Ew{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=i}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,i){const s=this.workersResolve[e];if(s&&s(i),this.queue.length){const{resolve:o,msg:c,transfer:g}=this.queue.shift();this.workersResolve[e]=o,this.workers[e].postMessage(c,g)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,i){return new Promise(s=>{const o=this._getIdleWorker();o!==-1?(this._initWorker(o),this.workerStatus|=1<<o,this.workersResolve[o]=s,this.workers[o].postMessage(e,i)):this.queue.push({resolve:s,msg:e,transfer:i})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class _B{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Zx{constructor(e,i,s,o){this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=o,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let o=0;for(;this._dataView.getUint8(this._offset)!==i&&o<e;)o++,this._offset++;return o<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,o)}}const qp=[171,75,84,88,32,50,48,187,13,10,26,10];function nA(h){return typeof TextDecoder<"u"?new TextDecoder().decode(h):Buffer.from(h).toString("utf8")}let OC,Y0,K0;const BT={env:{emscripten_notify_memory_growth:function(h){K0=new Uint8Array(Y0.exports.memory.buffer)}}};class uP{init(){return OC||(OC=typeof fetch<"u"?fetch("data:application/wasm;base64,"+iA).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,BT)).then(this._init):WebAssembly.instantiate(Buffer.from(iA,"base64"),BT).then(this._init),OC)}_init(e){Y0=e.instance,BT.env.emscripten_notify_memory_growth(0)}decode(e,i=0){if(!Y0)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,o=Y0.exports.malloc(s);K0.set(e,o),i=i||Number(Y0.exports.ZSTD_findDecompressedSize(o,s));const c=Y0.exports.malloc(i),g=Y0.exports.ZSTD_decompress(c,i,o,s),b=K0.slice(c,c+g);return Y0.exports.free(o),Y0.exports.free(c),b}}const iA="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",LC=new WeakMap;let OT,J0=0;class r0 extends _.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Ew,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new _.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),s=new _.hH6(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const o=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,o]).then(([c,g])=>{const b=r0.BasisWorker,et=["/* constants */","let _EngineFormat = "+JSON.stringify(r0.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(r0.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(r0.BasisFormat),"/* basis_transcoder.js */",c,"/* worker */",b.substring(b.indexOf("{")+1,b.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([et])),this.transcoderBinary=g,this.workerPool.setWorkerCreator(()=>{const tt=new Worker(this.workerSourceURL),rt=this.transcoderBinary.slice(0);return tt.postMessage({type:"init",config:this.workerConfig,transcoderBinary:rt},[rt]),tt})}),J0>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),J0++}return this.transcoderPending}load(e,i,s,o){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const c=new _.hH6(this.manager);c.setResponseType("arraybuffer"),c.setWithCredentials(this.withCredentials),c.load(e,g=>{if(LC.has(g))return LC.get(g).promise.then(i).catch(o);this.createTexture(g).then(b=>i?i(b):null).catch(o)},s,o)}_createTextureFrom(e,i){const{mipmaps:s,width:o,height:c,format:g,type:b,error:et,dfdTransferFn:tt,dfdFlags:rt}=e;if(b==="error")return Promise.reject(et);const st=i.layerCount>1?new _.Z_g(s,o,c,i.layerCount,g,_.ywz):new _.EB7(s,o,c,g,_.ywz);return st.minFilter=s.length===1?_.wem:_.D1R,st.magFilter=_.wem,st.generateMipmaps=!1,st.needsUpdate=!0,st.colorSpace=tt===2?_.KI_:_.aCh,st.premultiplyAlpha=!!(1&rt),st}async createTexture(e,i={}){const s=function(g){const b=new Uint8Array(g.buffer,g.byteOffset,qp.length);if(b[0]!==qp[0]||b[1]!==qp[1]||b[2]!==qp[2]||b[3]!==qp[3]||b[4]!==qp[4]||b[5]!==qp[5]||b[6]!==qp[6]||b[7]!==qp[7]||b[8]!==qp[8]||b[9]!==qp[9]||b[10]!==qp[10]||b[11]!==qp[11])throw new Error("Missing KTX 2.0 identifier.");const et=new _B,tt=17*Uint32Array.BYTES_PER_ELEMENT,rt=new Zx(g,qp.length,tt,!0);et.vkFormat=rt._nextUint32(),et.typeSize=rt._nextUint32(),et.pixelWidth=rt._nextUint32(),et.pixelHeight=rt._nextUint32(),et.pixelDepth=rt._nextUint32(),et.layerCount=rt._nextUint32(),et.faceCount=rt._nextUint32();const st=rt._nextUint32();et.supercompressionScheme=rt._nextUint32();const at=rt._nextUint32(),ct=rt._nextUint32(),pt=rt._nextUint32(),gt=rt._nextUint32(),At=rt._nextUint64(),xt=rt._nextUint64(),yt=new Zx(g,qp.length+tt,3*st*8,!0);for(let Cr=0;Cr<st;Cr++)et.levels.push({levelData:new Uint8Array(g.buffer,g.byteOffset+yt._nextUint64(),yt._nextUint64()),uncompressedByteLength:yt._nextUint64()});const _t=new Zx(g,at,ct,!0),Mt={vendorId:_t._skip(4)._nextUint16(),descriptorType:_t._nextUint16(),versionNumber:_t._nextUint16(),descriptorBlockSize:_t._nextUint16(),colorModel:_t._nextUint8(),colorPrimaries:_t._nextUint8(),transferFunction:_t._nextUint8(),flags:_t._nextUint8(),texelBlockDimension:[_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8()],bytesPlane:[_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8()],samples:[]},It=(Mt.descriptorBlockSize/4-6)/4;for(let Cr=0;Cr<It;Cr++){const Ar={bitOffset:_t._nextUint16(),bitLength:_t._nextUint8(),channelType:_t._nextUint8(),samplePosition:[_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Ar.channelType?(Ar.sampleLower=_t._nextInt32(),Ar.sampleUpper=_t._nextInt32()):(Ar.sampleLower=_t._nextUint32(),Ar.sampleUpper=_t._nextUint32()),Mt.samples[Cr]=Ar}et.dataFormatDescriptor.length=0,et.dataFormatDescriptor.push(Mt);const Bt=new Zx(g,pt,gt,!0);for(;Bt._offset<gt;){const Cr=Bt._nextUint32(),Ar=Bt._scan(Cr),Hr=nA(Ar),Jr=Bt._scan(Cr-Ar.byteLength);et.keyValue[Hr]=Hr.match(/^ktx/i)?nA(Jr):Jr,Bt._offset%4&&Bt._skip(4-Bt._offset%4)}if(xt<=0)return et;const Lt=new Zx(g,At,xt,!0),Ht=Lt._nextUint16(),Jt=Lt._nextUint16(),sn=Lt._nextUint32(),on=Lt._nextUint32(),mn=Lt._nextUint32(),cn=Lt._nextUint32(),un=[];for(let Cr=0;Cr<st;Cr++)un.push({imageFlags:Lt._nextUint32(),rgbSliceByteOffset:Lt._nextUint32(),rgbSliceByteLength:Lt._nextUint32(),alphaSliceByteOffset:Lt._nextUint32(),alphaSliceByteLength:Lt._nextUint32()});const bn=At+Lt._offset,xn=bn+sn,Cn=xn+on,Jn=Cn+mn,Kn=new Uint8Array(g.buffer,g.byteOffset+bn,sn),gr=new Uint8Array(g.buffer,g.byteOffset+xn,on),nr=new Uint8Array(g.buffer,g.byteOffset+Cn,mn),tr=new Uint8Array(g.buffer,g.byteOffset+Jn,cn);return et.globalData={endpointCount:Ht,selectorCount:Jt,imageDescs:un,endpointsData:Kn,selectorsData:gr,tablesData:nr,extendedData:tr},et}(new Uint8Array(e));if(s.vkFormat!==0)return async function(g){const{vkFormat:b,pixelWidth:et,pixelHeight:tt,pixelDepth:rt}=g;if(hP[b]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const st=g.levels[0];let at,ct;if(g.supercompressionScheme===0)at=st.levelData;else{if(g.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");OT||(OT=new Promise(async gt=>{const At=new uP;await At.init(),gt(At)})),at=(await OT).decode(st.levelData,st.uncompressedByteLength)}ct=NC[b]===_.VzW?new Float32Array(at.buffer,at.byteOffset,at.byteLength/Float32Array.BYTES_PER_ELEMENT):NC[b]===_.cLu?new Uint16Array(at.buffer,at.byteOffset,at.byteLength/Uint16Array.BYTES_PER_ELEMENT):at;const pt=rt===0?new _.IEO(ct,et,tt):new _.JUT(ct,et,tt,rt);return pt.type=NC[b],pt.format=hP[b],pt.colorSpace=LT[b]||_.aCh,pt.needsUpdate=!0,Promise.resolve(pt)}(s);const o=i,c=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:o},[e])).then(g=>this._createTextureFrom(g.data,s));return LC.set(e,{promise:c}),c}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),J0--,this}}r0.BasisFormat={ETC1S:0,UASTC_4x4:1},r0.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},r0.EngineFormat={RGBAFormat:_.wk1,RGBA_ASTC_4x4_Format:_.ptH,RGBA_BPTC_Format:_.bsb,RGBA_ETC2_EAC_Format:_.ekQ,RGBA_PVRTC_4BPPV1_Format:_.eaV,RGBA_S3TC_DXT5_Format:_.ILR,RGB_ETC1_Format:_.fto,RGB_ETC2_Format:_.l0P,RGB_PVRTC_4BPPV1_Format:_._AM,RGB_S3TC_DXT1_Format:_.wuA},r0.BasisWorker=`function () {

	let config;
	let transcoderPending;
	let BasisModule;

	const EngineFormat = _EngineFormat; // eslint-disable-line no-undef
	const TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef
	const BasisFormat = _BasisFormat; // eslint-disable-line no-undef

	self.addEventListener( 'message', function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				config = message.config;
				init( message.transcoderBinary );
				break;

			case 'transcode':
				transcoderPending.then( () => {

					try {

						const { width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags } = transcode( message.buffer );

						const buffers = [];

						for ( let i = 0; i < mipmaps.length; ++ i ) {

							buffers.push( mipmaps[ i ].data.buffer );

						}

						self.postMessage( { type: 'transcode', id: message.id, width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					}

				} );
				break;

		}

	} );

	function init( wasmBinary ) {

		transcoderPending = new Promise( ( resolve ) => {

			BasisModule = { wasmBinary, onRuntimeInitialized: resolve };
			BASIS( BasisModule ); // eslint-disable-line no-undef

		} ).then( () => {

			BasisModule.initializeBasis();

			if ( BasisModule.KTX2File === undefined ) {

				console.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );

			}

		} );

	}

	function transcode( buffer ) {

		const ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );

		function cleanup() {

			ktx2File.close();
			ktx2File.delete();

		}

		if ( ! ktx2File.isValid() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid or unsupported .ktx2 file' );

		}

		const basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;
		const width = ktx2File.getWidth();
		const height = ktx2File.getHeight();
		const layers = ktx2File.getLayers() || 1;
		const levels = ktx2File.getLevels();
		const hasAlpha = ktx2File.getHasAlpha();
		const dfdTransferFn = ktx2File.getDFDTransferFunc();
		const dfdFlags = ktx2File.getDFDFlags();

		const { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );

		if ( ! width || ! height || ! levels ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid texture' );

		}

		if ( ! ktx2File.startTranscoding() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader: .startTranscoding failed' );

		}

		const mipmaps = [];

		for ( let mip = 0; mip < levels; mip ++ ) {

			const layerMips = [];

			let mipWidth, mipHeight;

			for ( let layer = 0; layer < layers; layer ++ ) {

				const levelInfo = ktx2File.getImageLevelInfo( mip, layer, 0 );
				mipWidth = levelInfo.origWidth < 4 ? levelInfo.origWidth : levelInfo.width;
				mipHeight = levelInfo.origHeight < 4 ? levelInfo.origHeight : levelInfo.height;
				const dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, layer, 0, transcoderFormat ) );
				const status = ktx2File.transcodeImage(
					dst,
					mip,
					layer,
					0,
					transcoderFormat,
					0,
					- 1,
					- 1,
				);

				if ( ! status ) {

					cleanup();
					throw new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );

				}

				layerMips.push( dst );

			}

			mipmaps.push( { data: concat( layerMips ), width: mipWidth, height: mipHeight } );

		}

		cleanup();

		return { width, height, hasAlpha, mipmaps, format: engineFormat, dfdTransferFn, dfdFlags };

	}

	//

	// Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),
	// device capabilities, and texture dimensions. The list below ranks the formats separately
	// for ETC1S and UASTC.
	//
	// In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at
	// significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently
	// chooses RGBA32 only as a last resort and does not expose that option to the caller.
	const FORMAT_OPTIONS = [
		{
			if: 'astcSupported',
			basisFormat: [ BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],
			engineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],
			priorityETC1S: Infinity,
			priorityUASTC: 1,
			needsPowerOfTwo: false,
		},
		{
			if: 'bptcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],
			engineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],
			priorityETC1S: 3,
			priorityUASTC: 2,
			needsPowerOfTwo: false,
		},
		{
			if: 'dxtSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],
			engineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],
			priorityETC1S: 4,
			priorityUASTC: 5,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc2Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],
			engineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],
			priorityETC1S: 1,
			priorityUASTC: 3,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc1Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1 ],
			engineFormat: [ EngineFormat.RGB_ETC1_Format ],
			priorityETC1S: 2,
			priorityUASTC: 4,
			needsPowerOfTwo: false,
		},
		{
			if: 'pvrtcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],
			engineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],
			priorityETC1S: 5,
			priorityUASTC: 6,
			needsPowerOfTwo: true,
		},
	];

	const ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityETC1S - b.priorityETC1S;

	} );
	const UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityUASTC - b.priorityUASTC;

	} );

	function getTranscoderFormat( basisFormat, width, height, hasAlpha ) {

		let transcoderFormat;
		let engineFormat;

		const options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;

		for ( let i = 0; i < options.length; i ++ ) {

			const opt = options[ i ];

			if ( ! config[ opt.if ] ) continue;
			if ( ! opt.basisFormat.includes( basisFormat ) ) continue;
			if ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;
			if ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;

			transcoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];
			engineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];

			return { transcoderFormat, engineFormat };

		}

		console.warn( 'THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32.' );

		transcoderFormat = TranscoderFormat.RGBA32;
		engineFormat = EngineFormat.RGBAFormat;

		return { transcoderFormat, engineFormat };

	}

	function isPowerOfTwo( value ) {

		if ( value <= 2 ) return true;

		return ( value & ( value - 1 ) ) === 0 && value !== 0;

	}

	/** Concatenates N byte arrays. */
	function concat( arrays ) {

		let totalByteLength = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			totalByteLength += array.byteLength;

		}

		const result = new Uint8Array( totalByteLength );

		let byteOffset = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			result.set( array, byteOffset );

			byteOffset += array.byteLength;

		}

		return result;

	}

}`;const hP={109:_.wk1,97:_.wk1,37:_.wk1,43:_.wk1,103:_.av9,83:_.av9,16:_.av9,22:_.av9,100:_.hEm,76:_.hEm,15:_.hEm,9:_.hEm},NC={109:_.VzW,97:_.cLu,37:_.ywz,43:_.ywz,103:_.VzW,83:_.cLu,16:_.ywz,22:_.ywz,100:_.VzW,76:_.cLu,15:_.ywz,9:_.ywz},LT={43:_.KI_,22:_.KI_,15:_.KI_},NT="KHR_texture_basisu";class rA extends _e.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Lr]}async onAdded(e){var i,s,o,c,g,b;this._importer||(this._importer=new yl(class extends r0{constructor(et){super(et),this.setTranscoderPath(rA.TRANSCODER_LIBRARY_PATH).detectSupport(e.renderer.rendererObject)}async createTexture(et,tt){const rt=new Uint8Array(et.slice(0)),st=await super.createTexture(et,tt);return st.source._sourceImgBuffer=rt,st.userData.mimeType="image/ktx2",st.toJSON=at=>ix(st,at,st.name,"image/ktx2"),st.clone=()=>{throw new Error("ktx2 texture cloning not supported")},st}},["ktx2"],!1)),(s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.push(this._importer),(b=(g=(c=(o=e.getManager())==null?void 0:o.exporter)==null?void 0:c.getExporter("gltf","glb"))==null?void 0:g.extensions)==null||b.push(yB)}async onDispose(e){this._importer=void 0}async onRemove(e){var i,s;this._importer&&((s=(i=e.getManager())==null?void 0:i.importer)!=null&&s.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}rA.PluginType="KTX2LoadPlugin",rA.TRANSCODER_LIBRARY_PATH="https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/";const yB=h=>({writeTexture:(e,i)=>{if(e.userData.mimeType!=="image/ktx2")return;if(i.source!==void 0&&i.source!==null)return void console.warn("ktx2 export: source already set");const s=e.source._sourceImgBuffer||e.userData.__sourceBuffer;if(!s)return void console.warn("ktx2 export: no source buffer for ktx2");i.extensions=i.extensions||{};const o={},c=new Blob([s],{type:"image/ktx2"});o.source=h.processImageBlob(c,e),i.extensions[NT]=o,h.extensionsUsed[NT]=!0}});class $0 extends _e.SimpleEventDispatcher{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postRender)}addTexture(e,i,s,o,c,g="postRender",b=!1){var et;this._generators.has(g)||this._generators.set(g,[]),(et=this._generators.get(g))==null||et.push({key:e,fn:i,rect:s?[...s]:void 0,frag:c||o||b?new _.jyz({vertexShader:dt.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:c??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${b?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${b?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${o??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,i="postRender"){var s;this._generators.set(i,((s=this._generators.get(i))==null?void 0:s.filter(o=>o.key!==e))??[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var o;const i=this._viewer,s=i==null?void 0:i.renderer;s&&i&&((o=this._generators.get(e))==null||o.forEach(({key:c,fn:g,rect:b,frag:et})=>{const tt=g(i);if(tt){if(tt.image&&b){const rt=tt.image.width/tt.image.height;b[2]<1&&b[3]<1&&(b[2]=200),b[2]<1&&(b[2]=b[3]*rt),b[3]<1&&(b[3]=b[2]/rt)}s.blit(tt,void 0,{viewport:b,clear:!1,material:et})}}))}}$0.PluginType="debug";class dP extends _.aNw{constructor(e){super(e)}load(e,i,s,o){const c=this,g=this.path===""?_.Zp0.extractUrlBase(e):this.path,b=new _.hH6(this.manager);b.setPath(this.path),b.setRequestHeader(this.requestHeader),b.setWithCredentials(this.withCredentials),b.load(e,function(et){try{i(c.parse(et,g))}catch(tt){o?o(tt):console.error(tt),c.manager.itemError(e)}},s,o)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,i){const s=e.split(`
`);let o={};const c=/\s+/,g={};for(let et=0;et<s.length;et++){let tt=s[et];if(tt=tt.trim(),tt.length===0||tt.charAt(0)==="#")continue;const rt=tt.indexOf(" ");let st=rt>=0?tt.substring(0,rt):tt;st=st.toLowerCase();let at=rt>=0?tt.substring(rt+1):"";if(at=at.trim(),st==="newmtl")o={name:at},g[at]=o;else if(st==="ka"||st==="kd"||st==="ks"||st==="ke"){const ct=at.split(c,3);o[st]=[parseFloat(ct[0]),parseFloat(ct[1]),parseFloat(ct[2])]}else o[st]=at}const b=new Fo(this.resourcePath||i,this.materialOptions);return b.setCrossOrigin(this.crossOrigin),b.setManager(this.manager),b.setMaterials(g),b}}class Fo{constructor(e="",i={}){this.baseUrl=e,this.options=i,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:_.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:_.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const i={};for(const s in e){const o=e[s],c={};i[s]=c;for(const g in o){let b=!0,et=o[g];const tt=g.toLowerCase();switch(tt){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(et=[et[0]/255,et[1]/255,et[2]/255]),this.options&&this.options.ignoreZeroRGBs&&et[0]===0&&et[1]===0&&et[2]===0&&(b=!1)}b&&(c[tt]=et)}}return i}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const i in this.materialsInfo)this.materialsArray[e]=await this.create(i),this.nameLookup[i]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const i=this,s=this.materialsInfo[e],o={name:e,side:this.side};async function c(et,tt){if(o[et])return;const rt=i.getTextureParams(tt,o);return new Promise((st,at)=>{let ct=!1,pt=()=>!ct&&(ct=!0)&&st();const gt=i.loadTexture((At=i.baseUrl,typeof(xt=rt.url)!="string"||xt===""?"":/^https?:\/\//i.test(xt)?xt:At+xt),void 0,yt=>{o[et]=yt,pt()},void 0,pt);var At,xt;setTimeout(pt,50),gt.repeat.copy(rt.scale),gt.offset.copy(rt.offset),gt.wrapS=i.wrap,gt.wrapT=i.wrap,et!=="map"&&et!=="emissiveMap"||(gt.colorSpace=_.KI_)})}const g=Array.from(Object.keys(s||{}));let b=g.includes("d")||g.includes("D");for(const et of g){const tt=s[et];let rt;if(tt!=="")switch(et.toLowerCase()){case"kd":o.color=new _.Ilk().fromArray(tt).convertSRGBToLinear();break;case"ks":o.specular=new _.Ilk().fromArray(tt).convertSRGBToLinear();break;case"ke":o.emissive=new _.Ilk().fromArray(tt).convertSRGBToLinear();break;case"map_kd":await c("map",tt);break;case"map_ks":await c("specularMap",tt);break;case"map_ke":await c("emissiveMap",tt);break;case"norm":await c("normalMap",tt);break;case"map_bump":case"bump":await c("bumpMap",tt);break;case"map_d":await c("alphaMap",tt),o.transparent=!0;break;case"ns":o.shininess=parseFloat(tt);break;case"d":rt=parseFloat(tt),rt<1&&(o.opacity=rt,o.transparent=!0);break;case"tr":if(b)break;rt=parseFloat(tt),this.options&&this.options.invertTrProperty&&(rt=1-rt),rt>0&&(o.opacity=1-rt,o.transparent=!0)}}return this.materials[e]=new _.xoR(o),this.materials[e]}getTextureParams(e,i){const s={scale:new _.FM8(1,1),offset:new _.FM8(0,0)},o=e.split(/\s+/);let c;return c=o.indexOf("-bm"),c>=0&&(i.bumpScale=parseFloat(o[c+1]),o.splice(c,2)),c=o.indexOf("-s"),c>=0&&(s.scale.set(parseFloat(o[c+1]),parseFloat(o[c+2])),o.splice(c,4)),c=o.indexOf("-o"),c>=0&&(s.offset.set(parseFloat(o[c+1]),parseFloat(o[c+2])),o.splice(c,4)),s.url=o.join(" ").trim(),s}loadTexture(e,i,s,o,c){const g=this.manager!==void 0?this.manager:_.tEQ;let b=g.getHandler(e);b===null&&(b=new _.dpR(g)),b.setCrossOrigin&&b.setCrossOrigin(this.crossOrigin);const et=b.load(e,s,o,c);return i!==void 0&&(et.mapping=i),et}}const AB=/^[og]\s*(.+)?/,pP=/^mtllib /,bB=/^usemtl /,wB=/^usemap /,UC=/\s+/,fP=new _.Pa4,UT=new _.Pa4,mP=new _.Pa4,gP=new _.Pa4,Vv=new _.Pa4,CE=new _.Ilk;function FT(){const h={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,i){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=i!==!1);const s=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:i!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(o,c){const g=this._finalize(!1);g&&(g.inherited||g.groupCount<=0)&&this.materials.splice(g.index,1);const b={index:this.materials.length,name:o||"",mtllib:Array.isArray(c)&&c.length>0?c[c.length-1]:"",smooth:g!==void 0?g.smooth:this.smooth,groupStart:g!==void 0?g.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(et){const tt={index:typeof et=="number"?et:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return tt.clone=this.clone.bind(tt),tt}};return this.materials.push(b),b},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(o){const c=this.currentMaterial();if(c&&c.groupEnd===-1&&(c.groupEnd=this.geometry.vertices.length/3,c.groupCount=c.groupEnd-c.groupStart,c.inherited=!1),o&&this.materials.length>1)for(let g=this.materials.length-1;g>=0;g--)this.materials[g].groupCount<=0&&this.materials.splice(g,1);return o&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),c}},s&&s.name&&typeof s.clone=="function"){const o=s.clone(0);o.inherited=!0,this.object.materials.push(o)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseNormalIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseUVIndex:function(e,i){const s=parseInt(e,10);return 2*(s>=0?s-1:s+i/2)},addVertex:function(e,i,s){const o=this.vertices,c=this.object.geometry.vertices;c.push(o[e+0],o[e+1],o[e+2]),c.push(o[i+0],o[i+1],o[i+2]),c.push(o[s+0],o[s+1],o[s+2])},addVertexPoint:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addVertexLine:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addNormal:function(e,i,s){const o=this.normals,c=this.object.geometry.normals;c.push(o[e+0],o[e+1],o[e+2]),c.push(o[i+0],o[i+1],o[i+2]),c.push(o[s+0],o[s+1],o[s+2])},addFaceNormal:function(e,i,s){const o=this.vertices,c=this.object.geometry.normals;fP.fromArray(o,e),UT.fromArray(o,i),mP.fromArray(o,s),Vv.subVectors(mP,UT),gP.subVectors(fP,UT),Vv.cross(gP),Vv.normalize(),c.push(Vv.x,Vv.y,Vv.z),c.push(Vv.x,Vv.y,Vv.z),c.push(Vv.x,Vv.y,Vv.z)},addColor:function(e,i,s){const o=this.colors,c=this.object.geometry.colors;o[e]!==void 0&&c.push(o[e+0],o[e+1],o[e+2]),o[i]!==void 0&&c.push(o[i+0],o[i+1],o[i+2]),o[s]!==void 0&&c.push(o[s+0],o[s+1],o[s+2])},addUV:function(e,i,s){const o=this.uvs,c=this.object.geometry.uvs;c.push(o[e+0],o[e+1]),c.push(o[i+0],o[i+1]),c.push(o[s+0],o[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const i=this.uvs;this.object.geometry.uvs.push(i[e+0],i[e+1])},addFace:function(e,i,s,o,c,g,b,et,tt){const rt=this.vertices.length;let st=this.parseVertexIndex(e,rt),at=this.parseVertexIndex(i,rt),ct=this.parseVertexIndex(s,rt);if(this.addVertex(st,at,ct),this.addColor(st,at,ct),b!==void 0&&b!==""){const pt=this.normals.length;st=this.parseNormalIndex(b,pt),at=this.parseNormalIndex(et,pt),ct=this.parseNormalIndex(tt,pt),this.addNormal(st,at,ct)}else this.addFaceNormal(st,at,ct);if(o!==void 0&&o!==""){const pt=this.uvs.length;st=this.parseUVIndex(o,pt),at=this.parseUVIndex(c,pt),ct=this.parseUVIndex(g,pt),this.addUV(st,at,ct),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const i=this.vertices.length;for(let s=0,o=e.length;s<o;s++){const c=this.parseVertexIndex(e[s],i);this.addVertexPoint(c),this.addColor(c)}},addLineGeometry:function(e,i){this.object.geometry.type="Line";const s=this.vertices.length,o=this.uvs.length;for(let c=0,g=e.length;c<g;c++)this.addVertexLine(this.parseVertexIndex(e[c],s));for(let c=0,g=i.length;c<g;c++)this.addUVLine(this.parseUVIndex(i[c],o))}};return h.startObject("",!1),h}class vP extends _.aNw{constructor(e){super(e),this.materials=null}load(e,i,s,o){const c=this,g=new _.hH6(this.manager);g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(e,async function(b){try{i(await c.parse(b))}catch(et){o?o(et):console.error(et),c.manager.itemError(e)}},s,o)}setMaterials(e){return this.materials=e,this}async parse(e){const i=new FT;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const s=e.split(`
`);let o=[];for(let g=0,b=s.length;g<b;g++){const et=s[g].trimStart();if(et.length===0)continue;const tt=et.charAt(0);if(tt!=="#")if(tt==="v"){const rt=et.split(UC);switch(rt[0]){case"v":i.vertices.push(parseFloat(rt[1]),parseFloat(rt[2]),parseFloat(rt[3])),rt.length>=7?(CE.setRGB(parseFloat(rt[4]),parseFloat(rt[5]),parseFloat(rt[6])).convertSRGBToLinear(),i.colors.push(CE.r,CE.g,CE.b)):i.colors.push(void 0,void 0,void 0);break;case"vn":i.normals.push(parseFloat(rt[1]),parseFloat(rt[2]),parseFloat(rt[3]));break;case"vt":i.uvs.push(parseFloat(rt[1]),parseFloat(rt[2]))}}else if(tt==="f"){const rt=et.slice(1).trim().split(UC),st=[];for(let ct=0,pt=rt.length;ct<pt;ct++){const gt=rt[ct];if(gt.length>0){const At=gt.split("/");st.push(At)}}const at=st[0];for(let ct=1,pt=st.length-1;ct<pt;ct++){const gt=st[ct],At=st[ct+1];i.addFace(at[0],gt[0],At[0],at[1],gt[1],At[1],at[2],gt[2],At[2])}}else if(tt==="l"){const rt=et.substring(1).trim().split(" ");let st=[];const at=[];if(et.indexOf("/")===-1)st=rt;else for(let ct=0,pt=rt.length;ct<pt;ct++){const gt=rt[ct].split("/");gt[0]!==""&&st.push(gt[0]),gt[1]!==""&&at.push(gt[1])}i.addLineGeometry(st,at)}else if(tt==="p"){const rt=et.slice(1).trim().split(" ");i.addPointGeometry(rt)}else if((o=AB.exec(et))!==null){const rt=(" "+o[0].slice(1).trim()).slice(1);i.startObject(rt)}else if(bB.test(et))i.object.startMaterial(et.substring(7).trim(),i.materialLibraries);else if(pP.test(et)){i.materialLibraries.push(et.substring(7).trim());const rt=et.substring(7).trim(),st=this.manager.getHandler(rt);if(st){const at=await st.loadAsync(rt).catch(ct=>{console.warn(ct)});at&&this.setMaterials(at)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(wB.test(et))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(tt==="s"){if(o=et.split(" "),o.length>1){const st=o[1].trim().toLowerCase();i.object.smooth=st!=="0"&&st!=="off"}else i.object.smooth=!0;const rt=i.object.currentMaterial();rt&&(rt.smooth=i.object.smooth)}else{if(et==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+et+'"')}}i.finalize();const c=new _.ZAu;if(c.materialLibraries=[].concat(i.materialLibraries),!(i.objects.length===1&&i.objects[0].geometry.vertices.length===0))for(let g=0,b=i.objects.length;g<b;g++){const et=i.objects[g],tt=et.geometry,rt=et.materials,st=tt.type==="Line",at=tt.type==="Points";let ct=!1;if(tt.vertices.length===0)continue;const pt=new _.u9r;pt.setAttribute("position",new _.a$l(tt.vertices,3)),tt.normals.length>0&&pt.setAttribute("normal",new _.a$l(tt.normals,3)),tt.colors.length>0&&(ct=!0,pt.setAttribute("color",new _.a$l(tt.colors,3))),tt.hasUVIndices===!0&&pt.setAttribute("uv",new _.a$l(tt.uvs,2));const gt=[];for(let xt=0,yt=rt.length;xt<yt;xt++){const _t=rt[xt],Mt=_t.name+"_"+_t.smooth+"_"+ct;let It=i.materials[Mt];if(this.materials!==null)if(It=await this.materials.create(_t.name),!st||!It||It instanceof _.nls){if(at&&It&&!(It instanceof _.UY4)){const Bt=new _.UY4({size:10,sizeAttenuation:!1});_.F5T.prototype.copy.call(Bt,It),Bt.color.copy(It.color),Bt.map=It.map,It=Bt}}else{const Bt=new _.nls;_.F5T.prototype.copy.call(Bt,It),Bt.color.copy(It.color),It=Bt}It===void 0&&(It=st?new _.nls:at?new _.UY4({size:1,sizeAttenuation:!1}):new _.xoR,It.name=_t.name,It.flatShading=!_t.smooth,It.vertexColors=ct,i.materials[Mt]=It),gt.push(It)}let At;if(gt.length>1){for(let xt=0,yt=rt.length;xt<yt;xt++){const _t=rt[xt];pt.addGroup(_t.groupStart,_t.groupCount,xt)}At=st?new _.ejS(pt,gt):at?new _.woe(pt,gt):new _.Kj0(pt,gt)}else At=st?new _.ejS(pt,gt[0]):at?new _.woe(pt,gt[0]):new _.Kj0(pt,gt[0]);At.name=et.name,c.add(At)}else if(i.vertices.length>0){const g=new _.UY4({size:1,sizeAttenuation:!1}),b=new _.u9r;b.setAttribute("position",new _.a$l(i.vertices,3)),i.colors.length>0&&i.colors[0]!==void 0&&(b.setAttribute("color",new _.a$l(i.colors,3)),g.vertexColors=!0);const et=new _.woe(b,g);c.add(et)}return c}}class jT extends _e.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Lr],this._importer1=new yl(vP,["obj"],!0),this._importer2=new yl(dP,["mtl"],!1)}async onAdded(e){var i,s,o,c;(s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.push(this._importer1),(c=(o=e.getManager())==null?void 0:o.importer)==null||c.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){var i,s;(s=(i=e.getManager())==null?void 0:i.importer)!=null&&s.Importers&&(e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer1),1),e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer2),1))}}jT.PluginType="ObjMtlLoadPlugin";var zT=function(h){return URL.createObjectURL(new Blob([h],{type:"text/javascript"}))};try{URL.revokeObjectURL(zT(""))}catch{zT=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var pm=Uint8Array,Xp=Uint16Array,sA=Uint32Array,FC=new pm([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ME=new pm([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),VT=new pm([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Z0=function(h,e){for(var i=new Xp(31),s=0;s<31;++s)i[s]=e+=1<<h[s-1];var o=new sA(i[30]);for(s=1;s<30;++s)for(var c=i[s];c<i[s+1];++c)o[c]=c-i[s]<<5|s;return[i,o]},TE=Z0(FC,2),jC=TE[0],GT=TE[1];jC[28]=258,GT[258]=28;for(var HT=Z0(ME,0),xB=HT[0],_P=HT[1],zC=new Xp(32768),Rl=0;Rl<32768;++Rl){var Sw=(43690&Rl)>>>1|(21845&Rl)<<1;Sw=(61680&(Sw=(52428&Sw)>>>2|(13107&Sw)<<2))>>>4|(3855&Sw)<<4,zC[Rl]=((65280&Sw)>>>8|(255&Sw)<<8)>>>1}var s0=function(h,e,i){for(var s=h.length,o=0,c=new Xp(e);o<s;++o)++c[h[o]-1];var g,b=new Xp(e);for(o=0;o<e;++o)b[o]=b[o-1]+c[o-1]<<1;if(i){g=new Xp(1<<e);var et=15-e;for(o=0;o<s;++o)if(h[o])for(var tt=o<<4|h[o],rt=e-h[o],st=b[h[o]-1]++<<rt,at=st|(1<<rt)-1;st<=at;++st)g[zC[st]>>>et]=tt}else for(g=new Xp(s),o=0;o<s;++o)h[o]&&(g[o]=zC[b[h[o]-1]++]>>>15-h[o]);return g},oA=new pm(288);for(Rl=0;Rl<144;++Rl)oA[Rl]=8;for(Rl=144;Rl<256;++Rl)oA[Rl]=9;for(Rl=256;Rl<280;++Rl)oA[Rl]=7;for(Rl=280;Rl<288;++Rl)oA[Rl]=8;var e1=new pm(32);for(Rl=0;Rl<32;++Rl)e1[Rl]=5;var VC=s0(oA,9,0),yP=s0(oA,9,1),EB=s0(e1,5,0),GC=s0(e1,5,1),Yl=function(h){for(var e=h[0],i=1;i<h.length;++i)h[i]>e&&(e=h[i]);return e},x_=function(h,e,i){var s=e/8|0;return(h[s]|h[s+1]<<8)>>(7&e)&i},ou=function(h,e){var i=e/8|0;return(h[i]|h[i+1]<<8|h[i+2]<<16)>>(7&e)},t1=function(h){return(h/8|0)+(7&h&&1)},AP=function(h,e,i){(e==null||e<0)&&(e=0),(i==null||i>h.length)&&(i=h.length);var s=new(h instanceof Xp?Xp:h instanceof sA?sA:pm)(i-e);return s.set(h.subarray(e,i)),s},SB=function(h,e,i){var s=h.length;if(!s||i&&!i.l&&s<5)return e||new pm(0);var o=!e||i,c=!i||i.i;i||(i={}),e||(e=new pm(3*s));var g=function(Jr){var cs=e.length;if(Jr>cs){var Os=new pm(Math.max(2*cs,Jr));Os.set(e),e=Os}},b=i.f||0,et=i.p||0,tt=i.b||0,rt=i.l,st=i.d,at=i.m,ct=i.n,pt=8*s;do{if(!rt){i.f=b=x_(h,et,1);var gt=x_(h,et+1,3);if(et+=3,!gt){var At=h[(on=t1(et)+4)-4]|h[on-3]<<8,xt=on+At;if(xt>s){if(c)throw"unexpected EOF";break}o&&g(tt+At),e.set(h.subarray(on,xt),tt),i.b=tt+=At,i.p=et=8*xt;continue}if(gt==1)rt=yP,st=GC,at=9,ct=5;else{if(gt!=2)throw"invalid block type";var yt=x_(h,et,31)+257,_t=x_(h,et+10,15)+4,Mt=yt+x_(h,et+5,31)+1;et+=14;for(var It=new pm(Mt),Bt=new pm(19),Lt=0;Lt<_t;++Lt)Bt[VT[Lt]]=x_(h,et+3*Lt,7);et+=3*_t;var Ht=Yl(Bt),Jt=(1<<Ht)-1,sn=s0(Bt,Ht,1);for(Lt=0;Lt<Mt;){var on,mn=sn[x_(h,et,Jt)];if(et+=15&mn,(on=mn>>>4)<16)It[Lt++]=on;else{var cn=0,un=0;for(on==16?(un=3+x_(h,et,3),et+=2,cn=It[Lt-1]):on==17?(un=3+x_(h,et,7),et+=3):on==18&&(un=11+x_(h,et,127),et+=7);un--;)It[Lt++]=cn}}var bn=It.subarray(0,yt),xn=It.subarray(yt);at=Yl(bn),ct=Yl(xn),rt=s0(bn,at,1),st=s0(xn,ct,1)}if(et>pt){if(c)throw"unexpected EOF";break}}o&&g(tt+131072);for(var Cn=(1<<at)-1,Jn=(1<<ct)-1,Kn=et;;Kn=et){var gr=(cn=rt[ou(h,et)&Cn])>>>4;if((et+=15&cn)>pt){if(c)throw"unexpected EOF";break}if(!cn)throw"invalid length/literal";if(gr<256)e[tt++]=gr;else{if(gr==256){Kn=et,rt=null;break}var nr=gr-254;if(gr>264){var tr=FC[Lt=gr-257];nr=x_(h,et,(1<<tr)-1)+jC[Lt],et+=tr}var Cr=st[ou(h,et)&Jn],Ar=Cr>>>4;if(!Cr)throw"invalid distance";if(et+=15&Cr,xn=xB[Ar],Ar>3&&(tr=ME[Ar],xn+=ou(h,et)&(1<<tr)-1,et+=tr),et>pt){if(c)throw"unexpected EOF";break}o&&g(tt+131072);for(var Hr=tt+nr;tt<Hr;tt+=4)e[tt]=e[tt-xn],e[tt+1]=e[tt+1-xn],e[tt+2]=e[tt+2-xn],e[tt+3]=e[tt+3-xn];tt=Hr}}i.l=rt,i.p=Kn,i.b=tt,rt&&(b=1,i.m=at,i.d=st,i.n=ct)}while(!b);return tt==e.length?e:AP(e,0,tt)},ey=function(h,e,i){i<<=7&e;var s=e/8|0;h[s]|=i,h[s+1]|=i>>>8},n1=function(h,e,i){i<<=7&e;var s=e/8|0;h[s]|=i,h[s+1]|=i>>>8,h[s+2]|=i>>>16},i1=function(h,e){for(var i=[],s=0;s<h.length;++s)h[s]&&i.push({s,f:h[s]});var o=i.length,c=i.slice();if(!o)return[QT,0];if(o==1){var g=new pm(i[0].s+1);return g[i[0].s]=1,[g,1]}i.sort(function(It,Bt){return It.f-Bt.f}),i.push({s:-1,f:25001});var b=i[0],et=i[1],tt=0,rt=1,st=2;for(i[0]={s:-1,f:b.f+et.f,l:b,r:et};rt!=o-1;)b=i[i[tt].f<i[st].f?tt++:st++],et=i[tt!=rt&&i[tt].f<i[st].f?tt++:st++],i[rt++]={s:-1,f:b.f+et.f,l:b,r:et};var at=c[0].s;for(s=1;s<o;++s)c[s].s>at&&(at=c[s].s);var ct=new Xp(at+1),pt=IE(i[rt-1],ct,0);if(pt>e){s=0;var gt=0,At=pt-e,xt=1<<At;for(c.sort(function(It,Bt){return ct[Bt.s]-ct[It.s]||It.f-Bt.f});s<o;++s){var yt=c[s].s;if(!(ct[yt]>e))break;gt+=xt-(1<<pt-ct[yt]),ct[yt]=e}for(gt>>>=At;gt>0;){var _t=c[s].s;ct[_t]<e?gt-=1<<e-ct[_t]++-1:++s}for(;s>=0&&gt;--s){var Mt=c[s].s;ct[Mt]==e&&(--ct[Mt],++gt)}pt=e}return[new pm(ct),pt]},IE=function(h,e,i){return h.s==-1?Math.max(IE(h.l,e,i+1),IE(h.r,e,i+1)):e[h.s]=i},bP=function(h){for(var e=h.length;e&&!h[--e];);for(var i=new Xp(++e),s=0,o=h[0],c=1,g=function(et){i[s++]=et},b=1;b<=e;++b)if(h[b]==o&&b!=e)++c;else{if(!o&&c>2){for(;c>138;c-=138)g(32754);c>2&&(g(c>10?c-11<<5|28690:c-3<<5|12305),c=0)}else if(c>3){for(g(o),--c;c>6;c-=6)g(8304);c>2&&(g(c-3<<5|8208),c=0)}for(;c--;)g(o);c=1,o=h[b]}return[i.subarray(0,s),e]},PE=function(h,e){for(var i=0,s=0;s<e.length;++s)i+=h[s]*e[s];return i},HC=function(h,e,i){var s=i.length,o=t1(e+2);h[o]=255&s,h[o+1]=s>>>8,h[o+2]=255^h[o],h[o+3]=255^h[o+1];for(var c=0;c<s;++c)h[o+c+4]=i[c];return 8*(o+4+s)},wP=function(h,e,i,s,o,c,g,b,et,tt,rt){ey(e,rt++,i),++o[256];for(var st=i1(o,15),at=st[0],ct=st[1],pt=i1(c,15),gt=pt[0],At=pt[1],xt=bP(at),yt=xt[0],_t=xt[1],Mt=bP(gt),It=Mt[0],Bt=Mt[1],Lt=new Xp(19),Ht=0;Ht<yt.length;++Ht)Lt[31&yt[Ht]]++;for(Ht=0;Ht<It.length;++Ht)Lt[31&It[Ht]]++;for(var Jt=i1(Lt,7),sn=Jt[0],on=Jt[1],mn=19;mn>4&&!sn[VT[mn-1]];--mn);var cn,un,bn,xn,Cn=tt+5<<3,Jn=PE(o,oA)+PE(c,e1)+g,Kn=PE(o,at)+PE(c,gt)+g+14+3*mn+PE(Lt,sn)+(2*Lt[16]+3*Lt[17]+7*Lt[18]);if(Cn<=Jn&&Cn<=Kn)return HC(e,rt,h.subarray(et,et+tt));if(ey(e,rt,1+(Kn<Jn)),rt+=2,Kn<Jn){cn=s0(at,ct,0),un=at,bn=s0(gt,At,0),xn=gt;var gr=s0(sn,on,0);for(ey(e,rt,_t-257),ey(e,rt+5,Bt-1),ey(e,rt+10,mn-4),rt+=14,Ht=0;Ht<mn;++Ht)ey(e,rt+3*Ht,sn[VT[Ht]]);rt+=3*mn;for(var nr=[yt,It],tr=0;tr<2;++tr){var Cr=nr[tr];for(Ht=0;Ht<Cr.length;++Ht){var Ar=31&Cr[Ht];ey(e,rt,gr[Ar]),rt+=sn[Ar],Ar>15&&(ey(e,rt,Cr[Ht]>>>5&127),rt+=Cr[Ht]>>>12)}}}else cn=VC,un=oA,bn=EB,xn=e1;for(Ht=0;Ht<b;++Ht)if(s[Ht]>255){Ar=s[Ht]>>>18&31,n1(e,rt,cn[Ar+257]),rt+=un[Ar+257],Ar>7&&(ey(e,rt,s[Ht]>>>23&31),rt+=FC[Ar]);var Hr=31&s[Ht];n1(e,rt,bn[Hr]),rt+=xn[Hr],Hr>3&&(n1(e,rt,s[Ht]>>>5&8191),rt+=ME[Hr])}else n1(e,rt,cn[s[Ht]]),rt+=un[s[Ht]];return n1(e,rt,cn[256]),rt+un[256]},CB=new sA([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),QT=new pm(0),MB=function(){var h=1,e=0;return{p:function(i){for(var s=h,o=e,c=i.length,g=0;g!=c;){for(var b=Math.min(g+2655,c);g<b;++g)o+=s+=i[g];s=(65535&s)+15*(s>>16),o=(65535&o)+15*(o>>16)}h=s,e=o},d:function(){return(255&(h%=65521))<<24|h>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},TB=function(h,e,i,s,o){return function(c,g,b,et,tt,rt){var st=c.length,at=new pm(et+st+5*(1+Math.ceil(st/7e3))+tt),ct=at.subarray(et,at.length-tt),pt=0;if(!g||st<8)for(var gt=0;gt<=st;gt+=65535){var At=gt+65535;At<st?pt=HC(ct,pt,c.subarray(gt,At)):(ct[gt]=rt,pt=HC(ct,pt,c.subarray(gt,st)))}else{for(var xt=CB[g-1],yt=xt>>>13,_t=8191&xt,Mt=(1<<b)-1,It=new Xp(32768),Bt=new Xp(Mt+1),Lt=Math.ceil(b/3),Ht=2*Lt,Jt=function(Qs){return(c[Qs]^c[Qs+1]<<Lt^c[Qs+2]<<Ht)&Mt},sn=new sA(25e3),on=new Xp(288),mn=new Xp(32),cn=0,un=0,bn=(gt=0,0),xn=0,Cn=0;gt<st;++gt){var Jn=Jt(gt),Kn=32767&gt,gr=Bt[Jn];if(It[Kn]=gr,Bt[Jn]=Kn,xn<=gt){var nr=st-gt;if((cn>7e3||bn>24576)&&nr>423){pt=wP(c,ct,0,sn,on,mn,un,bn,Cn,gt-Cn,pt),bn=cn=un=0,Cn=gt;for(var tr=0;tr<286;++tr)on[tr]=0;for(tr=0;tr<30;++tr)mn[tr]=0}var Cr=2,Ar=0,Hr=_t,Jr=Kn-gr&32767;if(nr>2&&Jn==Jt(gt-Jr))for(var cs=Math.min(yt,nr)-1,Os=Math.min(32767,gt),Ss=Math.min(258,nr);Jr<=Os&&--Hr&&Kn!=gr;){if(c[gt+Cr]==c[gt+Cr-Jr]){for(var Ts=0;Ts<Ss&&c[gt+Ts]==c[gt+Ts-Jr];++Ts);if(Ts>Cr){if(Cr=Ts,Ar=Jr,Ts>cs)break;var pr=Math.min(Jr,Ts-2),Pr=0;for(tr=0;tr<pr;++tr){var qr=gt-Jr+tr+32768&32767,Xs=qr-It[qr]+32768&32767;Xs>Pr&&(Pr=Xs,gr=qr)}}}Jr+=(Kn=gr)-(gr=It[Kn])+32768&32767}if(Ar){sn[bn++]=268435456|GT[Cr]<<18|_P[Ar];var po=31&GT[Cr],eo=31&_P[Ar];un+=FC[po]+ME[eo],++on[257+po],++mn[eo],xn=gt+Cr,++cn}else sn[bn++]=c[gt],++on[c[gt]]}}pt=wP(c,ct,rt,sn,on,mn,un,bn,Cn,gt-Cn,pt),!rt&&7&pt&&(pt=HC(ct,pt+1,QT))}return AP(at,0,et+t1(pt)+tt)}(h,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(h.length)))):12+e.mem,i,s,!o)},IB=function(h,e,i){for(;i;++e)h[e]=i,i>>>=8},PB=function(h,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;h[0]=120,h[1]=s<<6|(s?32-2*s:1)},RB=function(h){if((15&h[0])!=8||h[0]>>>4>7||(h[0]<<8|h[1])%31)throw"invalid zlib data";if(32&h[1])throw"invalid zlib data: preset dictionaries not supported"};function RE(h,e){return SB((RB(h),h.subarray(2,-4)),e)}var DB=typeof TextDecoder<"u"&&new TextDecoder;try{DB.decode(QT,{stream:!0})}catch{}function xP(h,e,i){const s=i.length-h-1;if(e>=i[s])return s-1;if(e<=i[h])return h;let o=h,c=s,g=Math.floor((o+c)/2);for(;e<i[g]||e>=i[g+1];)e<i[g]?c=g:o=g,g=Math.floor((o+c)/2);return g}function kB(h,e){let i=1;for(let o=2;o<=h;++o)i*=o;let s=1;for(let o=2;o<=e;++o)s*=o;for(let o=2;o<=h-e;++o)s*=o;return i/s}class BB extends _.Hyl{constructor(e,i,s,o,c){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=o||0,this.endKnot=c||this.knots.length-1;for(let g=0;g<s.length;++g){const b=s[g];this.controlPoints[g]=new _.Ltg(b.x,b.y,b.z,b.w)}}getPoint(e,i=new _.Pa4){const s=i,o=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),c=function(g,b,et,tt){const rt=xP(g,tt,b),st=function(ct,pt,gt,At){const xt=[],yt=[],_t=[];xt[0]=1;for(let Mt=1;Mt<=gt;++Mt){yt[Mt]=pt-At[ct+1-Mt],_t[Mt]=At[ct+Mt]-pt;let It=0;for(let Bt=0;Bt<Mt;++Bt){const Lt=_t[Bt+1],Ht=yt[Mt-Bt],Jt=xt[Bt]/(Lt+Ht);xt[Bt]=It+Lt*Jt,It=Ht*Jt}xt[Mt]=It}return xt}(rt,tt,g,b),at=new _.Ltg(0,0,0,0);for(let ct=0;ct<=g;++ct){const pt=et[rt-g+ct],gt=st[ct],At=pt.w*gt;at.x+=pt.x*At,at.y+=pt.y*At,at.z+=pt.z*At,at.w+=pt.w*gt}return at}(this.degree,this.knots,this.controlPoints,o);return c.w!==1&&c.divideScalar(c.w),s.set(c.x,c.y,c.z)}getTangent(e,i=new _.Pa4){const s=i,o=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),c=function(g,b,et,tt,rt){const st=function(at,ct,pt,gt,At){const xt=At<at?At:at,yt=[],_t=xP(at,gt,ct),Mt=function(Bt,Lt,Ht,Jt,sn){const on=[];for(let Cn=0;Cn<=Ht;++Cn)on[Cn]=0;const mn=[];for(let Cn=0;Cn<=Jt;++Cn)mn[Cn]=on.slice(0);const cn=[];for(let Cn=0;Cn<=Ht;++Cn)cn[Cn]=on.slice(0);cn[0][0]=1;const un=on.slice(0),bn=on.slice(0);for(let Cn=1;Cn<=Ht;++Cn){un[Cn]=Lt-sn[Bt+1-Cn],bn[Cn]=sn[Bt+Cn]-Lt;let Jn=0;for(let Kn=0;Kn<Cn;++Kn){const gr=bn[Kn+1],nr=un[Cn-Kn];cn[Cn][Kn]=gr+nr;const tr=cn[Kn][Cn-1]/cn[Cn][Kn];cn[Kn][Cn]=Jn+gr*tr,Jn=nr*tr}cn[Cn][Cn]=Jn}for(let Cn=0;Cn<=Ht;++Cn)mn[0][Cn]=cn[Cn][Ht];for(let Cn=0;Cn<=Ht;++Cn){let Jn=0,Kn=1;const gr=[];for(let nr=0;nr<=Ht;++nr)gr[nr]=on.slice(0);gr[0][0]=1;for(let nr=1;nr<=Jt;++nr){let tr=0;const Cr=Cn-nr,Ar=Ht-nr;Cn>=nr&&(gr[Kn][0]=gr[Jn][0]/cn[Ar+1][Cr],tr=gr[Kn][0]*cn[Cr][Ar]);const Hr=Cn-1<=Ar?nr-1:Ht-Cn;for(let cs=Cr>=-1?1:-Cr;cs<=Hr;++cs)gr[Kn][cs]=(gr[Jn][cs]-gr[Jn][cs-1])/cn[Ar+1][Cr+cs],tr+=gr[Kn][cs]*cn[Cr+cs][Ar];Cn<=Ar&&(gr[Kn][nr]=-gr[Jn][nr-1]/cn[Ar+1][Cn],tr+=gr[Kn][nr]*cn[Cn][Ar]),mn[nr][Cn]=tr;const Jr=Jn;Jn=Kn,Kn=Jr}}let xn=Ht;for(let Cn=1;Cn<=Jt;++Cn){for(let Jn=0;Jn<=Ht;++Jn)mn[Cn][Jn]*=xn;xn*=Ht-Cn}return mn}(_t,gt,at,xt,ct),It=[];for(let Bt=0;Bt<pt.length;++Bt){const Lt=pt[Bt].clone(),Ht=Lt.w;Lt.x*=Ht,Lt.y*=Ht,Lt.z*=Ht,It[Bt]=Lt}for(let Bt=0;Bt<=xt;++Bt){const Lt=It[_t-at].clone().multiplyScalar(Mt[Bt][0]);for(let Ht=1;Ht<=at;++Ht)Lt.add(It[_t-at+Ht].clone().multiplyScalar(Mt[Bt][Ht]));yt[Bt]=Lt}for(let Bt=xt+1;Bt<=At+1;++Bt)yt[Bt]=new _.Ltg(0,0,0);return yt}(g,b,et,tt,rt);return function(at){const ct=at.length,pt=[],gt=[];for(let xt=0;xt<ct;++xt){const yt=at[xt];pt[xt]=new _.Pa4(yt.x,yt.y,yt.z),gt[xt]=yt.w}const At=[];for(let xt=0;xt<ct;++xt){const yt=pt[xt].clone();for(let _t=1;_t<=xt;++_t)yt.sub(At[xt-_t].clone().multiplyScalar(kB(xt,_t)*gt[_t]));At[xt]=yt.divideScalar(gt[0])}return At}(st)}(this.degree,this.knots,this.controlPoints,o,1);return s.copy(c[1]).normalize(),s}}let So,gu,fm;class OB extends _.aNw{constructor(e){super(e)}load(e,i,s,o){const c=this,g=c.path===""?_.Zp0.extractUrlBase(e):c.path,b=new _.hH6(this.manager);b.setPath(c.path),b.setResponseType("arraybuffer"),b.setRequestHeader(c.requestHeader),b.setWithCredentials(c.withCredentials),b.load(e,function(et){try{i(c.parse(et,g))}catch(tt){o?o(tt):console.error(tt),c.manager.itemError(e)}},s,o)}parse(e,i){if(function(c){const g="Kaydara FBX Binary  \0";return c.byteLength>=g.length&&g===Ot(c,0,g.length)}(e))So=new j().parse(e);else{const c=Ot(e);if(!function(g){const b=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let et=0;function tt(rt){const st=g[rt-1];return g=g.slice(et+rt),et++,st}for(let rt=0;rt<b.length;++rt)if(tt(1)===b[rt])return!1;return!0}(c))throw new Error("THREE.FBXLoader: Unknown format.");if(ot(c)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+ot(c));So=new a().parse(c)}const s=new _.dpR(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin),o=new LB(s,this.manager).parse(So);return So=null,gu=null,fm=null,o}}class LB{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){gu=this.parseConnections();const e=this.parseImages(),i=this.parseTextures(e),s=this.parseMaterials(i),o=this.parseDeformers(),c=new NB().parse(o);return this.parseScene(o,c,s),fm}parseConnections(){const e=new Map;return"Connections"in So&&So.Connections.connections.forEach(function(i){const s=i[0],o=i[1],c=i[2];e.has(s)||e.set(s,{parents:[],children:[]});const g={ID:o,relationship:c};e.get(s).parents.push(g),e.has(o)||e.set(o,{parents:[],children:[]});const b={ID:s,relationship:c};e.get(o).children.push(b)}),e}parseImages(){const e={},i={};if("Video"in So.Objects){const s=So.Objects.Video;for(const o in s){const c=s[o];if(e[parseInt(o)]=c.RelativeFilename||c.Filename,"Content"in c){const g=c.Content instanceof ArrayBuffer&&c.Content.byteLength>0,b=typeof c.Content=="string"&&c.Content!=="";if(g||b){const et=this.parseImage(s[o]);i[c.RelativeFilename||c.Filename]=et}}}}for(const s in e){const o=e[s];i[o]!==void 0?e[s]=i[o]:e[s]=e[s].split("\\").pop()}return e}parseImage(e){const i=e.Content,s=e.RelativeFilename||e.Filename,o=s.slice(s.lastIndexOf(".")+1).toLowerCase();let c;switch(o){case"bmp":c="image/bmp";break;case"jpg":case"jpeg":c="image/jpeg";break;case"png":c="image/png";break;case"tif":c="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",s),c="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+o+'" is not supported.')}if(typeof i=="string")return"data:"+c+";base64,"+i;{const g=new Uint8Array(i);return window.URL.createObjectURL(new Blob([g],{type:c}))}}parseTextures(e){const i=new Map;if("Texture"in So.Objects){const s=So.Objects.Texture;for(const o in s){const c=this.parseTexture(s[o],e);i.set(parseInt(o),c)}}return i}parseTexture(e,i){const s=this.loadTexture(e,i);s.ID=e.id,s.name=e.attrName;const o=e.WrapModeU,c=e.WrapModeV,g=o!==void 0?o.value:0,b=c!==void 0?c.value:0;if(s.wrapS=g===0?_.rpg:_.uWy,s.wrapT=b===0?_.rpg:_.uWy,"Scaling"in e){const et=e.Scaling.value;s.repeat.x=et[0],s.repeat.y=et[1]}if("Translation"in e){const et=e.Translation.value;s.offset.x=et[0],s.offset.y=et[1]}return s}loadTexture(e,i){let s;const o=this.textureLoader.path,c=gu.get(e.id).children;let g;c!==void 0&&c.length>0&&i[c[0].ID]!==void 0&&(s=i[c[0].ID],s.indexOf("blob:")!==0&&s.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const b=e.FileName.slice(-3).toLowerCase();if(b==="tga"){const et=this.manager.getHandler(".tga");et===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),g=new _.xEZ):(et.setPath(this.textureLoader.path),g=et.load(s))}else b==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),g=new _.xEZ):g=this.textureLoader.load(s);return this.textureLoader.setPath(o),g}parseMaterials(e){const i=new Map;if("Material"in So.Objects){const s=So.Objects.Material;for(const o in s){const c=this.parseMaterial(s[o],e);c!==null&&i.set(parseInt(o),c)}}return i}parseMaterial(e,i){const s=e.id,o=e.attrName;let c=e.ShadingModel;if(typeof c=="object"&&(c=c.value),!gu.has(s))return null;const g=this.parseParameters(e,i,s);let b;switch(c.toLowerCase()){case"phong":b=new _.xoR;break;case"lambert":b=new _.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',c),b=new _.xoR}return b.setValues(g),b.name=o,b}parseParameters(e,i,s){const o={};e.BumpFactor&&(o.bumpScale=e.BumpFactor.value),e.Diffuse?o.color=new _.Ilk().fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(o.color=new _.Ilk().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(o.displacementScale=e.DisplacementFactor.value),e.Emissive?o.emissive=new _.Ilk().fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(o.emissive=new _.Ilk().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(o.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(o.opacity=parseFloat(e.Opacity.value)),o.opacity<1&&(o.transparent=!0),e.ReflectionFactor&&(o.reflectivity=e.ReflectionFactor.value),e.Shininess&&(o.shininess=e.Shininess.value),e.Specular?o.specular=new _.Ilk().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(o.specular=new _.Ilk().fromArray(e.SpecularColor.value).convertSRGBToLinear());const c=this;return gu.get(s).children.forEach(function(g){const b=g.relationship;switch(b){case"Bump":o.bumpMap=c.getTexture(i,g.ID);break;case"Maya|TEX_ao_map":o.aoMap=c.getTexture(i,g.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":o.map=c.getTexture(i,g.ID),o.map!==void 0&&(o.map.colorSpace=_.KI_);break;case"DisplacementColor":o.displacementMap=c.getTexture(i,g.ID);break;case"EmissiveColor":o.emissiveMap=c.getTexture(i,g.ID),o.emissiveMap!==void 0&&(o.emissiveMap.colorSpace=_.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":o.normalMap=c.getTexture(i,g.ID);break;case"ReflectionColor":o.envMap=c.getTexture(i,g.ID),o.envMap!==void 0&&(o.envMap.mapping=_.dSO,o.envMap.colorSpace=_.KI_);break;case"SpecularColor":o.specularMap=c.getTexture(i,g.ID),o.specularMap!==void 0&&(o.specularMap.colorSpace=_.KI_);break;case"TransparentColor":case"TransparencyFactor":o.alphaMap=c.getTexture(i,g.ID),o.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",b)}}),o}getTexture(e,i){return"LayeredTexture"in So.Objects&&i in So.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=gu.get(i).children[0].ID),e.get(i)}parseDeformers(){const e={},i={};if("Deformer"in So.Objects){const s=So.Objects.Deformer;for(const o in s){const c=s[o],g=gu.get(parseInt(o));if(c.attrType==="Skin"){const b=this.parseSkeleton(g,s);b.ID=o,g.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),b.geometryID=g.parents[0].ID,e[o]=b}else if(c.attrType==="BlendShape"){const b={id:o};b.rawTargets=this.parseMorphTargets(g,s),b.id=o,g.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[o]=b}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){const s=[];return e.children.forEach(function(o){const c=i[o.ID];if(c.attrType!=="Cluster")return;const g={ID:o.ID,indices:[],weights:[],transformLink:new _.yGw().fromArray(c.TransformLink.a)};"Indexes"in c&&(g.indices=c.Indexes.a,g.weights=c.Weights.a),s.push(g)}),{rawBones:s,bones:[]}}parseMorphTargets(e,i){const s=[];for(let o=0;o<e.children.length;o++){const c=e.children[o],g=i[c.ID],b={name:g.attrName,initialWeight:g.DeformPercent,id:g.id,fullWeights:g.FullWeights.a};if(g.attrType!=="BlendShapeChannel")return;b.geoID=gu.get(parseInt(c.ID)).children.filter(function(et){return et.relationship===void 0})[0].ID,s.push(b)}return s}parseScene(e,i,s){fm=new _.ZAu;const o=this.parseModels(e.skeletons,i,s),c=So.Objects.Model,g=this;o.forEach(function(et){const tt=c[et.ID];g.setLookAtProperties(et,tt),gu.get(et.ID).parents.forEach(function(rt){const st=o.get(rt.ID);st!==void 0&&st.add(et)}),et.parent===null&&fm.add(et)}),this.bindSkeleton(e.skeletons,i,o),this.createAmbientLight(),fm.traverse(function(et){if(et.userData.transformData){et.parent&&(et.userData.transformData.parentMatrix=et.parent.matrix,et.userData.transformData.parentMatrixWorld=et.parent.matrixWorld);const tt=Dt(et.userData.transformData);et.applyMatrix4(tt),et.updateWorldMatrix()}});const b=new ut().parse();fm.children.length===1&&fm.children[0].isGroup&&(fm.children[0].animations=b,fm=fm.children[0]),fm.animations=b}parseModels(e,i,s){const o=new Map,c=So.Objects.Model;for(const g in c){const b=parseInt(g),et=c[g],tt=gu.get(b);let rt=this.buildSkeleton(tt,e,b,et.attrName);if(!rt){switch(et.attrType){case"Camera":rt=this.createCamera(tt);break;case"Light":rt=this.createLight(tt);break;case"Mesh":rt=this.createMesh(tt,i,s);break;case"NurbsCurve":rt=this.createCurve(tt,i);break;case"LimbNode":case"Root":rt=new _.N$j;break;default:rt=new _.ZAu}rt.name=et.attrName?_.iUV.sanitizeNodeName(et.attrName):"",rt.ID=b}this.getTransformData(rt,et),o.set(b,rt)}return o}buildSkeleton(e,i,s,o){let c=null;return e.parents.forEach(function(g){for(const b in i){const et=i[b];et.rawBones.forEach(function(tt,rt){if(tt.ID===g.ID){const st=c;c=new _.N$j,c.matrixWorld.copy(tt.transformLink),c.name=o?_.iUV.sanitizeNodeName(o):"",c.ID=s,et.bones[rt]=c,st!==null&&c.add(st)}})}}),c}createCamera(e){let i,s;if(e.children.forEach(function(o){const c=So.Objects.NodeAttribute[o.ID];c!==void 0&&(s=c)}),s===void 0)i=new _.Tme;else{let o=0;s.CameraProjectionType!==void 0&&s.CameraProjectionType.value===1&&(o=1);let c=1;s.NearPlane!==void 0&&(c=s.NearPlane.value/1e3);let g=1e3;s.FarPlane!==void 0&&(g=s.FarPlane.value/1e3);let b=window.innerWidth,et=window.innerHeight;s.AspectWidth!==void 0&&s.AspectHeight!==void 0&&(b=s.AspectWidth.value,et=s.AspectHeight.value);const tt=b/et;let rt=45;s.FieldOfView!==void 0&&(rt=s.FieldOfView.value);const st=s.FocalLength?s.FocalLength.value:null;switch(o){case 0:i=new _.cPb(rt,tt,c,g),st!==null&&i.setFocalLength(st);break;case 1:i=new _.iKG(-b/2,b/2,et/2,-et/2,c,g);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+o+"."),i=new _.Tme}}return i}createLight(e){let i,s;if(e.children.forEach(function(o){const c=So.Objects.NodeAttribute[o.ID];c!==void 0&&(s=c)}),s===void 0)i=new _.Tme;else{let o;o=s.LightType===void 0?0:s.LightType.value;let c=16777215;s.Color!==void 0&&(c=new _.Ilk().fromArray(s.Color.value).convertSRGBToLinear());let g=s.Intensity===void 0?1:s.Intensity.value/100;s.CastLightOnObject!==void 0&&s.CastLightOnObject.value===0&&(g=0);let b=0;s.FarAttenuationEnd!==void 0&&(b=s.EnableFarAttenuation!==void 0&&s.EnableFarAttenuation.value===0?0:s.FarAttenuationEnd.value);const et=1;switch(o){case 0:i=new _.cek(c,g,b,et);break;case 1:i=new _.Ox3(c,g);break;case 2:let tt=Math.PI/3;s.InnerAngle!==void 0&&(tt=_.M8C.degToRad(s.InnerAngle.value));let rt=0;s.OuterAngle!==void 0&&(rt=_.M8C.degToRad(s.OuterAngle.value),rt=Math.max(rt,1)),i=new _.PMe(c,g,b,tt,rt,et);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),i=new _.cek(c,g)}s.CastShadows!==void 0&&s.CastShadows.value===1&&(i.castShadow=!0)}return i}createMesh(e,i,s){let o,c=null,g=null;const b=[];return e.children.forEach(function(et){i.has(et.ID)&&(c=i.get(et.ID)),s.has(et.ID)&&b.push(s.get(et.ID))}),b.length>1?g=b:b.length>0?g=b[0]:(g=new _.xoR({color:13421772}),b.push(g)),"color"in c.attributes&&b.forEach(function(et){et.vertexColors=!0}),c.FBX_Deformer?(o=new _.TUv(c,g),o.normalizeSkinWeights()):o=new _.Kj0(c,g),o}createCurve(e,i){const s=e.children.reduce(function(c,g){return i.has(g.ID)&&(c=i.get(g.ID)),c},null),o=new _.nls({color:3342591,linewidth:1});return new _.x12(s,o)}getTransformData(e,i){const s={};"InheritType"in i&&(s.inheritType=parseInt(i.InheritType.value)),s.eulerOrder="RotationOrder"in i?Rt(i.RotationOrder.value):"ZYX","Lcl_Translation"in i&&(s.translation=i.Lcl_Translation.value),"PreRotation"in i&&(s.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(s.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(s.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(s.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(s.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(s.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(s.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(s.rotationPivot=i.RotationPivot.value),e.userData.transformData=s}setLookAtProperties(e,i){"LookAtProperty"in i&&gu.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const o=So.Objects.Model[s.ID];if("Lcl_Translation"in o){const c=o.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(c),fm.add(e.target)):e.lookAt(new _.Pa4().fromArray(c))}}})}bindSkeleton(e,i,s){const o=this.parsePoseNodes();for(const c in e){const g=e[c];gu.get(parseInt(g.ID)).parents.forEach(function(b){if(i.has(b.ID)){const et=b.ID;gu.get(et).parents.forEach(function(tt){s.has(tt.ID)&&s.get(tt.ID).bind(new _.OdW(g.bones),o[tt.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in So.Objects){const i=So.Objects.Pose;for(const s in i)if(i[s].attrType==="BindPose"&&i[s].NbPoseNodes>0){const o=i[s].PoseNode;Array.isArray(o)?o.forEach(function(c){e[c.Node]=new _.yGw().fromArray(c.Matrix.a)}):e[o.Node]=new _.yGw().fromArray(o.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in So&&"AmbientColor"in So.GlobalSettings){const e=So.GlobalSettings.AmbientColor.value,i=e[0],s=e[1],o=e[2];if(i!==0||s!==0||o!==0){const c=new _.Ilk(i,s,o).convertSRGBToLinear();fm.add(new _.Mig(c,1))}}}}class NB{constructor(){this.negativeMaterialIndices=!1}parse(e){const i=new Map;if("Geometry"in So.Objects){const s=So.Objects.Geometry;for(const o in s){const c=gu.get(parseInt(o)),g=this.parseGeometry(c,s[o],e);i.set(parseInt(o),g)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),i}parseGeometry(e,i,s){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,s);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,s){const o=s.skeletons,c=[],g=e.parents.map(function(st){return So.Objects.Model[st.ID]});if(g.length===0)return;const b=e.children.reduce(function(st,at){return o[at.ID]!==void 0&&(st=o[at.ID]),st},null);e.children.forEach(function(st){s.morphTargets[st.ID]!==void 0&&c.push(s.morphTargets[st.ID])});const et=g[0],tt={};"RotationOrder"in et&&(tt.eulerOrder=Rt(et.RotationOrder.value)),"InheritType"in et&&(tt.inheritType=parseInt(et.InheritType.value)),"GeometricTranslation"in et&&(tt.translation=et.GeometricTranslation.value),"GeometricRotation"in et&&(tt.rotation=et.GeometricRotation.value),"GeometricScaling"in et&&(tt.scale=et.GeometricScaling.value);const rt=Dt(tt);return this.genGeometry(i,b,c,rt)}genGeometry(e,i,s,o){const c=new _.u9r;e.attrName&&(c.name=e.attrName);const g=this.parseGeoNode(e,i),b=this.genBuffers(g),et=new _.a$l(b.vertex,3);if(et.applyMatrix4(o),c.setAttribute("position",et),b.colors.length>0&&c.setAttribute("color",new _.a$l(b.colors,3)),i&&(c.setAttribute("skinIndex",new _.qlB(b.weightsIndices,4)),c.setAttribute("skinWeight",new _.a$l(b.vertexWeights,4)),c.FBX_Deformer=i),b.normal.length>0){const tt=new _.Vkp().getNormalMatrix(o),rt=new _.a$l(b.normal,3);rt.applyNormalMatrix(tt),c.setAttribute("normal",rt)}if(b.uvs.forEach(function(tt,rt){const st=rt===0?"uv":`uv${rt}`;c.setAttribute(st,new _.a$l(b.uvs[rt],2))}),g.material&&g.material.mappingType!=="AllSame"){let tt=b.materialIndex[0],rt=0;if(b.materialIndex.forEach(function(st,at){st!==tt&&(c.addGroup(rt,at-rt,tt),tt=st,rt=at)}),c.groups.length>0){const st=c.groups[c.groups.length-1],at=st.start+st.count;at!==b.materialIndex.length&&c.addGroup(at,b.materialIndex.length-at,tt)}c.groups.length===0&&c.addGroup(0,b.materialIndex.length,b.materialIndex[0])}return this.addMorphTargets(c,e,s,o),c}parseGeoNode(e,i){const s={};if(s.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],s.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(s.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(s.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(s.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){s.uv=[];let o=0;for(;e.LayerElementUV[o];)e.LayerElementUV[o].UV&&s.uv.push(this.parseUVs(e.LayerElementUV[o])),o++}return s.weightTable={},i!==null&&(s.skeleton=i,i.rawBones.forEach(function(o,c){o.indices.forEach(function(g,b){s.weightTable[g]===void 0&&(s.weightTable[g]=[]),s.weightTable[g].push({id:c,weight:o.weights[b]})})})),s}genBuffers(e){const i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let s=0,o=0,c=!1,g=[],b=[],et=[],tt=[],rt=[],st=[];const at=this;return e.vertexIndices.forEach(function(ct,pt){let gt,At=!1;ct<0&&(ct^=-1,At=!0);let xt=[],yt=[];if(g.push(3*ct,3*ct+1,3*ct+2),e.color){const _t=wt(pt,s,ct,e.color);et.push(_t[0],_t[1],_t[2])}if(e.skeleton){if(e.weightTable[ct]!==void 0&&e.weightTable[ct].forEach(function(_t){yt.push(_t.weight),xt.push(_t.id)}),yt.length>4){c||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),c=!0);const _t=[0,0,0,0],Mt=[0,0,0,0];yt.forEach(function(It,Bt){let Lt=It,Ht=xt[Bt];Mt.forEach(function(Jt,sn,on){if(Lt>Jt){on[sn]=Lt,Lt=Jt;const mn=_t[sn];_t[sn]=Ht,Ht=mn}})}),xt=_t,yt=Mt}for(;yt.length<4;)yt.push(0),xt.push(0);for(let _t=0;_t<4;++_t)rt.push(yt[_t]),st.push(xt[_t])}if(e.normal){const _t=wt(pt,s,ct,e.normal);b.push(_t[0],_t[1],_t[2])}e.material&&e.material.mappingType!=="AllSame"&&(gt=wt(pt,s,ct,e.material)[0],gt<0&&(at.negativeMaterialIndices=!0,gt=0)),e.uv&&e.uv.forEach(function(_t,Mt){const It=wt(pt,s,ct,_t);tt[Mt]===void 0&&(tt[Mt]=[]),tt[Mt].push(It[0]),tt[Mt].push(It[1])}),o++,At&&(o>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),at.genFace(i,e,g,gt,b,et,tt,rt,st,o),s++,o=0,g=[],b=[],et=[],tt=[],rt=[],st=[])}),i}genFace(e,i,s,o,c,g,b,et,tt,rt){for(let st=2;st<rt;st++)e.vertex.push(i.vertexPositions[s[0]]),e.vertex.push(i.vertexPositions[s[1]]),e.vertex.push(i.vertexPositions[s[2]]),e.vertex.push(i.vertexPositions[s[3*(st-1)]]),e.vertex.push(i.vertexPositions[s[3*(st-1)+1]]),e.vertex.push(i.vertexPositions[s[3*(st-1)+2]]),e.vertex.push(i.vertexPositions[s[3*st]]),e.vertex.push(i.vertexPositions[s[3*st+1]]),e.vertex.push(i.vertexPositions[s[3*st+2]]),i.skeleton&&(e.vertexWeights.push(et[0]),e.vertexWeights.push(et[1]),e.vertexWeights.push(et[2]),e.vertexWeights.push(et[3]),e.vertexWeights.push(et[4*(st-1)]),e.vertexWeights.push(et[4*(st-1)+1]),e.vertexWeights.push(et[4*(st-1)+2]),e.vertexWeights.push(et[4*(st-1)+3]),e.vertexWeights.push(et[4*st]),e.vertexWeights.push(et[4*st+1]),e.vertexWeights.push(et[4*st+2]),e.vertexWeights.push(et[4*st+3]),e.weightsIndices.push(tt[0]),e.weightsIndices.push(tt[1]),e.weightsIndices.push(tt[2]),e.weightsIndices.push(tt[3]),e.weightsIndices.push(tt[4*(st-1)]),e.weightsIndices.push(tt[4*(st-1)+1]),e.weightsIndices.push(tt[4*(st-1)+2]),e.weightsIndices.push(tt[4*(st-1)+3]),e.weightsIndices.push(tt[4*st]),e.weightsIndices.push(tt[4*st+1]),e.weightsIndices.push(tt[4*st+2]),e.weightsIndices.push(tt[4*st+3])),i.color&&(e.colors.push(g[0]),e.colors.push(g[1]),e.colors.push(g[2]),e.colors.push(g[3*(st-1)]),e.colors.push(g[3*(st-1)+1]),e.colors.push(g[3*(st-1)+2]),e.colors.push(g[3*st]),e.colors.push(g[3*st+1]),e.colors.push(g[3*st+2])),i.material&&i.material.mappingType!=="AllSame"&&(e.materialIndex.push(o),e.materialIndex.push(o),e.materialIndex.push(o)),i.normal&&(e.normal.push(c[0]),e.normal.push(c[1]),e.normal.push(c[2]),e.normal.push(c[3*(st-1)]),e.normal.push(c[3*(st-1)+1]),e.normal.push(c[3*(st-1)+2]),e.normal.push(c[3*st]),e.normal.push(c[3*st+1]),e.normal.push(c[3*st+2])),i.uv&&i.uv.forEach(function(at,ct){e.uvs[ct]===void 0&&(e.uvs[ct]=[]),e.uvs[ct].push(b[ct][0]),e.uvs[ct].push(b[ct][1]),e.uvs[ct].push(b[ct][2*(st-1)]),e.uvs[ct].push(b[ct][2*(st-1)+1]),e.uvs[ct].push(b[ct][2*st]),e.uvs[ct].push(b[ct][2*st+1])})}addMorphTargets(e,i,s,o){if(s.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const c=this;s.forEach(function(g){g.rawTargets.forEach(function(b){const et=So.Objects.Geometry[b.geoID];et!==void 0&&c.genMorphGeometry(e,i,et,o,b.name)})})}genMorphGeometry(e,i,s,o,c){const g=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],b=s.Vertices!==void 0?s.Vertices.a:[],et=s.Indexes!==void 0?s.Indexes.a:[],tt=3*e.attributes.position.count,rt=new Float32Array(tt);for(let pt=0;pt<et.length;pt++){const gt=3*et[pt];rt[gt]=b[3*pt],rt[gt+1]=b[3*pt+1],rt[gt+2]=b[3*pt+2]}const st={vertexIndices:g,vertexPositions:rt},at=this.genBuffers(st),ct=new _.a$l(at.vertex,3);ct.name=c||s.attrName,ct.applyMatrix4(o),e.morphAttributes.position.push(ct)}parseNormals(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,o=e.Normals.a;let c=[];return s==="IndexToDirect"&&("NormalIndex"in e?c=e.NormalIndex.a:"NormalsIndex"in e&&(c=e.NormalsIndex.a)),{dataSize:3,buffer:o,indices:c,mappingType:i,referenceType:s}}parseUVs(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,o=e.UV.a;let c=[];return s==="IndexToDirect"&&(c=e.UVIndex.a),{dataSize:2,buffer:o,indices:c,mappingType:i,referenceType:s}}parseVertexColors(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,o=e.Colors.a;let c=[];s==="IndexToDirect"&&(c=e.ColorIndex.a);for(let g=0,b=new _.Ilk;g<o.length;g+=4)b.fromArray(o,g).convertSRGBToLinear().toArray(o,g);return{dataSize:4,buffer:o,indices:c,mappingType:i,referenceType:s}}parseMaterialIndices(e){const i=e.MappingInformationType,s=e.ReferenceInformationType;if(i==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const o=e.Materials.a,c=[];for(let g=0;g<o.length;++g)c.push(g);return{dataSize:1,buffer:o,indices:c,mappingType:i,referenceType:s}}parseNurbsGeometry(e){const i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new _.u9r;const s=i-1,o=e.KnotVector.a,c=[],g=e.Points.a;for(let rt=0,st=g.length;rt<st;rt+=4)c.push(new _.Ltg().fromArray(g,rt));let b,et;if(e.Form==="Closed")c.push(c[0]);else if(e.Form==="Periodic"){b=s,et=o.length-1-b;for(let rt=0;rt<s;++rt)c.push(c[rt])}const tt=new BB(s,o,c,b,et).getPoints(12*c.length);return new _.u9r().setFromPoints(tt)}}class ut{parse(){const e=[],i=this.parseClips();if(i!==void 0)for(const s in i){const o=i[s],c=this.addClip(o);e.push(c)}return e}parseClips(){if(So.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){const e=So.Objects.AnimationCurveNode,i=new Map;for(const s in e){const o=e[s];if(o.attrName.match(/S|R|T|DeformPercent/)!==null){const c={id:o.id,attr:o.attrName,curves:{}};i.set(c.id,c)}}return i}parseAnimationCurves(e){const i=So.Objects.AnimationCurve;for(const s in i){const o={id:i[s].id,times:i[s].KeyTime.a.map(ht),values:i[s].KeyValueFloat.a},c=gu.get(o.id);if(c!==void 0){const g=c.parents[0].ID,b=c.parents[0].relationship;b.match(/X/)?e.get(g).curves.x=o:b.match(/Y/)?e.get(g).curves.y=o:b.match(/Z/)?e.get(g).curves.z=o:b.match(/DeformPercent/)&&e.has(g)&&(e.get(g).curves.morph=o)}}}parseAnimationLayers(e){const i=So.Objects.AnimationLayer,s=new Map;for(const o in i){const c=[],g=gu.get(parseInt(o));g!==void 0&&(g.children.forEach(function(b,et){if(e.has(b.ID)){const tt=e.get(b.ID);if(tt.curves.x!==void 0||tt.curves.y!==void 0||tt.curves.z!==void 0){if(c[et]===void 0){const rt=gu.get(b.ID).parents.filter(function(st){return st.relationship!==void 0})[0].ID;if(rt!==void 0){const st=So.Objects.Model[rt.toString()];if(st===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",b);const at={modelName:st.attrName?_.iUV.sanitizeNodeName(st.attrName):"",ID:st.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};fm.traverse(function(ct){ct.ID===st.id&&(at.transform=ct.matrix,ct.userData.transformData&&(at.eulerOrder=ct.userData.transformData.eulerOrder))}),at.transform||(at.transform=new _.yGw),"PreRotation"in st&&(at.preRotation=st.PreRotation.value),"PostRotation"in st&&(at.postRotation=st.PostRotation.value),c[et]=at}}c[et]&&(c[et][tt.attr]=tt)}else if(tt.curves.morph!==void 0){if(c[et]===void 0){const rt=gu.get(b.ID).parents.filter(function(At){return At.relationship!==void 0})[0].ID,st=gu.get(rt).parents[0].ID,at=gu.get(st).parents[0].ID,ct=gu.get(at).parents[0].ID,pt=So.Objects.Model[ct],gt={modelName:pt.attrName?_.iUV.sanitizeNodeName(pt.attrName):"",morphName:So.Objects.Deformer[rt].attrName};c[et]=gt}c[et][tt.attr]=tt}}}),s.set(parseInt(o),c))}return s}parseAnimStacks(e){const i=So.Objects.AnimationStack,s={};for(const o in i){const c=gu.get(parseInt(o)).children;c.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const g=e.get(c[0].ID);s[o]={name:i[o].attrName,layer:g}}return s}addClip(e){let i=[];const s=this;return e.layer.forEach(function(o){i=i.concat(s.generateTracks(o))}),new _.m7l(e.name,-1,i)}generateTracks(e){const i=[];let s=new _.Pa4,o=new _._fP,c=new _.Pa4;if(e.transform&&e.transform.decompose(s,o,c),s=s.toArray(),o=new _.USm().setFromQuaternion(o,e.eulerOrder).toArray(),c=c.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const g=this.generateVectorTrack(e.modelName,e.T.curves,s,"position");g!==void 0&&i.push(g)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const g=this.generateRotationTrack(e.modelName,e.R.curves,o,e.preRotation,e.postRotation,e.eulerOrder);g!==void 0&&i.push(g)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const g=this.generateVectorTrack(e.modelName,e.S.curves,c,"scale");g!==void 0&&i.push(g)}if(e.DeformPercent!==void 0){const g=this.generateMorphTrack(e);g!==void 0&&i.push(g)}return i}generateVectorTrack(e,i,s,o){const c=this.getTimesForAllAxes(i),g=this.getKeyframeTrackValues(c,i,s);return new _.yC1(e+"."+o,c,g)}generateRotationTrack(e,i,s,o,c,g){i.x!==void 0&&(this.interpolateRotations(i.x),i.x.values=i.x.values.map(_.M8C.degToRad)),i.y!==void 0&&(this.interpolateRotations(i.y),i.y.values=i.y.values.map(_.M8C.degToRad)),i.z!==void 0&&(this.interpolateRotations(i.z),i.z.values=i.z.values.map(_.M8C.degToRad));const b=this.getTimesForAllAxes(i),et=this.getKeyframeTrackValues(b,i,s);o!==void 0&&((o=o.map(_.M8C.degToRad)).push(g),o=new _.USm().fromArray(o),o=new _._fP().setFromEuler(o)),c!==void 0&&((c=c.map(_.M8C.degToRad)).push(g),c=new _.USm().fromArray(c),c=new _._fP().setFromEuler(c).invert());const tt=new _._fP,rt=new _.USm,st=[];for(let at=0;at<et.length;at+=3)rt.set(et[at],et[at+1],et[at+2],g),tt.setFromEuler(rt),o!==void 0&&tt.premultiply(o),c!==void 0&&tt.multiply(c),tt.toArray(st,at/3*4);return new _.iLg(e+".quaternion",b,st)}generateMorphTrack(e){const i=e.DeformPercent.curves.morph,s=i.values.map(function(c){return c/100}),o=fm.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new _.dUE(e.modelName+".morphTargetInfluences["+o+"]",i.times,s)}getTimesForAllAxes(e){let i=[];if(e.x!==void 0&&(i=i.concat(e.x.times)),e.y!==void 0&&(i=i.concat(e.y.times)),e.z!==void 0&&(i=i.concat(e.z.times)),i=i.sort(function(s,o){return s-o}),i.length>1){let s=1,o=i[0];for(let c=1;c<i.length;c++){const g=i[c];g!==o&&(i[s]=g,o=g,s++)}i=i.slice(0,s)}return i}getKeyframeTrackValues(e,i,s){const o=s,c=[];let g=-1,b=-1,et=-1;return e.forEach(function(tt){if(i.x&&(g=i.x.times.indexOf(tt)),i.y&&(b=i.y.times.indexOf(tt)),i.z&&(et=i.z.times.indexOf(tt)),g!==-1){const rt=i.x.values[g];c.push(rt),o[0]=rt}else c.push(o[0]);if(b!==-1){const rt=i.y.values[b];c.push(rt),o[1]=rt}else c.push(o[1]);if(et!==-1){const rt=i.z.values[et];c.push(rt),o[2]=rt}else c.push(o[2])}),c}interpolateRotations(e){for(let i=1;i<e.values.length;i++){const s=e.values[i-1],o=e.values[i]-s,c=Math.abs(o);if(c>=180){const g=c/180,b=o/g;let et=s+b;const tt=e.times[i-1],rt=(e.times[i]-tt)/g;let st=tt+rt;const at=[],ct=[];for(;st<e.times[i];)at.push(st),st+=rt,ct.push(et),et+=b;e.times=Gt(e.times,i,at),e.values=Gt(e.values,i,ct)}}}}class a{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new it,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const i=this,s=e.split(/[\r\n]+/);return s.forEach(function(o,c){const g=o.match(/^[\s\t]*;/),b=o.match(/^[\s\t]*$/);if(g||b)return;const et=o.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),tt=o.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),rt=o.match("^\\t{"+(i.currentIndent-1)+"}}");et?i.parseNodeBegin(o,et):tt?i.parseNodeProperty(o,tt,s[++c]):rt?i.popStack():o.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(o)}),this.allNodes}parseNodeBegin(e,i){const s=i[1].trim().replace(/^"/,"").replace(/"$/,""),o=i[2].split(",").map(function(et){return et.trim().replace(/^"/,"").replace(/"$/,"")}),c={name:s},g=this.parseNodeAttr(o),b=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(s,c):s in b?(s==="PoseNode"?b.PoseNode.push(c):b[s].id!==void 0&&(b[s]={},b[s][b[s].id]=b[s]),g.id!==""&&(b[s][g.id]=c)):typeof g.id=="number"?(b[s]={},b[s][g.id]=c):s!=="Properties70"&&(b[s]=s==="PoseNode"?[c]:c),typeof g.id=="number"&&(c.id=g.id),g.name!==""&&(c.attrName=g.name),g.type!==""&&(c.attrType=g.type),this.pushStack(c)}parseNodeAttr(e){let i=e[0];e[0]!==""&&(i=parseInt(e[0]),isNaN(i)&&(i=e[0]));let s="",o="";return e.length>1&&(s=e[1].replace(/^(\w+)::/,""),o=e[2]),{id:i,name:s,type:o}}parseNodeProperty(e,i,s){let o=i[1].replace(/^"/,"").replace(/"$/,"").trim(),c=i[2].replace(/^"/,"").replace(/"$/,"").trim();o==="Content"&&c===","&&(c=s.replace(/"/g,"").replace(/,$/,"").trim());const g=this.getCurrentNode();if(g.name!=="Properties70"){if(o==="C"){const b=c.split(",").slice(1),et=parseInt(b[0]),tt=parseInt(b[1]);let rt=c.split(",").slice(3);rt=rt.map(function(st){return st.trim().replace(/^"/,"")}),o="connections",c=[et,tt],function(st,at){for(let ct=0,pt=st.length,gt=at.length;ct<gt;ct++,pt++)st[pt]=at[ct]}(c,rt),g[o]===void 0&&(g[o]=[])}o==="Node"&&(g.id=c),o in g&&Array.isArray(g[o])?g[o].push(c):o!=="a"?g[o]=c:g.a=c,this.setCurrentProp(g,o),o==="a"&&c.slice(-1)!==","&&(g.a=kt(c))}else this.parseNodeSpecialProperty(e,o,c)}parseNodePropertyContinued(e){const i=this.getCurrentNode();i.a+=e,e.slice(-1)!==","&&(i.a=kt(i.a))}parseNodeSpecialProperty(e,i,s){const o=s.split('",').map(function(rt){return rt.trim().replace(/^\"/,"").replace(/\s/,"_")}),c=o[0],g=o[1],b=o[2],et=o[3];let tt=o[4];switch(g){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":tt=parseFloat(tt);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":tt=kt(tt)}this.getPrevNode()[c]={type:g,type2:b,flag:et,value:tt},this.setCurrentProp(this.getPrevNode(),c)}}class j{parse(e){const i=new nt(e);i.skip(23);const s=i.getUint32();if(s<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+s);const o=new it;for(;!this.endOfContent(i);){const c=this.parseNode(i,s);c!==null&&o.add(c.name,c)}return o}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){const s={},o=i>=7500?e.getUint64():e.getUint32(),c=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();const g=e.getUint8(),b=e.getString(g);if(o===0)return null;const et=[];for(let at=0;at<c;at++)et.push(this.parseProperty(e));const tt=et.length>0?et[0]:"",rt=et.length>1?et[1]:"",st=et.length>2?et[2]:"";for(s.singleProperty=c===1&&e.getOffset()===o;o>e.getOffset();){const at=this.parseNode(e,i);at!==null&&this.parseSubNode(b,s,at)}return s.propertyList=et,typeof tt=="number"&&(s.id=tt),rt!==""&&(s.attrName=rt),st!==""&&(s.attrType=st),b!==""&&(s.name=b),s}parseSubNode(e,i,s){if(s.singleProperty===!0){const o=s.propertyList[0];Array.isArray(o)?(i[s.name]=s,s.a=o):i[s.name]=o}else if(e==="Connections"&&s.name==="C"){const o=[];s.propertyList.forEach(function(c,g){g!==0&&o.push(c)}),i.connections===void 0&&(i.connections=[]),i.connections.push(o)}else if(s.name==="Properties70")Object.keys(s).forEach(function(o){i[o]=s[o]});else if(e==="Properties70"&&s.name==="P"){let o=s.propertyList[0],c=s.propertyList[1];const g=s.propertyList[2],b=s.propertyList[3];let et;o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),c.indexOf("Lcl ")===0&&(c=c.replace("Lcl ","Lcl_")),et=c==="Color"||c==="ColorRGB"||c==="Vector"||c==="Vector3D"||c.indexOf("Lcl_")===0?[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:s.propertyList[4],i[o]={type:c,type2:g,flag:b,value:et}}else i[s.name]===void 0?typeof s.id=="number"?(i[s.name]={},i[s.name][s.id]=s):i[s.name]=s:s.name==="PoseNode"?(Array.isArray(i[s.name])||(i[s.name]=[i[s.name]]),i[s.name].push(s)):i[s.name][s.id]===void 0&&(i[s.name][s.id]=s)}parseProperty(e){const i=e.getString(1);let s;switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return s=e.getUint32(),e.getArrayBuffer(s);case"S":return s=e.getUint32(),e.getString(s);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const o=e.getUint32(),c=e.getUint32(),g=e.getUint32();if(c===0)switch(i){case"b":case"c":return e.getBooleanArray(o);case"d":return e.getFloat64Array(o);case"f":return e.getFloat32Array(o);case"i":return e.getInt32Array(o);case"l":return e.getInt64Array(o)}const b=RE(new Uint8Array(e.getArrayBuffer(g))),et=new nt(b.buffer);switch(i){case"b":case"c":return et.getBooleanArray(o);case"d":return et.getFloat64Array(o);case"f":return et.getFloat32Array(o);case"i":return et.getInt32Array(o);case"l":return et.getInt64Array(o)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class nt{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=i===void 0||i,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const i=[];for(let s=0;s<e;s++)i.push(this.getBoolean());return i}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt32());return i}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),2147483648&i?(i=4294967295&~i,e=4294967295&~e,e===4294967295&&(i=i+1&4294967295),e=e+1&4294967295,-(4294967296*i+e)):4294967296*i+e}getInt64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),4294967296*i+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat32());return i}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat64());return i}getArrayBuffer(e){const i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){const i=this.offset;let s=new Uint8Array(this.dv.buffer,i,e);this.skip(e);const o=s.indexOf(0);return o>=0&&(s=new Uint8Array(this.dv.buffer,i,o)),this._textDecoder.decode(s)}}class it{add(e,i){this[e]=i}}function ot(h){const e=h.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function ht(h){return h/46186158e3}const ft=[];function wt(h,e,i,s){let o;switch(s.mappingType){case"ByPolygonVertex":o=h;break;case"ByPolygon":o=e;break;case"ByVertice":o=i;break;case"AllSame":o=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}s.referenceType==="IndexToDirect"&&(o=s.indices[o]);const c=o*s.dataSize,g=c+s.dataSize;return function(b,et,tt,rt){for(let st=tt,at=0;st<rt;st++,at++)b[at]=et[st];return b}(ft,s.buffer,c,g)}const bt=new _.USm,St=new _.Pa4;function Dt(h){const e=new _.yGw,i=new _.yGw,s=new _.yGw,o=new _.yGw,c=new _.yGw,g=new _.yGw,b=new _.yGw,et=new _.yGw,tt=new _.yGw,rt=new _.yGw,st=new _.yGw,at=new _.yGw,ct=h.inheritType?h.inheritType:0;if(h.translation&&e.setPosition(St.fromArray(h.translation)),h.preRotation){const sn=h.preRotation.map(_.M8C.degToRad);sn.push(h.eulerOrder||_.USm.DEFAULT_ORDER),i.makeRotationFromEuler(bt.fromArray(sn))}if(h.rotation){const sn=h.rotation.map(_.M8C.degToRad);sn.push(h.eulerOrder||_.USm.DEFAULT_ORDER),s.makeRotationFromEuler(bt.fromArray(sn))}if(h.postRotation){const sn=h.postRotation.map(_.M8C.degToRad);sn.push(h.eulerOrder||_.USm.DEFAULT_ORDER),o.makeRotationFromEuler(bt.fromArray(sn)),o.invert()}h.scale&&c.scale(St.fromArray(h.scale)),h.scalingOffset&&b.setPosition(St.fromArray(h.scalingOffset)),h.scalingPivot&&g.setPosition(St.fromArray(h.scalingPivot)),h.rotationOffset&&et.setPosition(St.fromArray(h.rotationOffset)),h.rotationPivot&&tt.setPosition(St.fromArray(h.rotationPivot)),h.parentMatrixWorld&&(st.copy(h.parentMatrix),rt.copy(h.parentMatrixWorld));const pt=i.clone().multiply(s).multiply(o),gt=new _.yGw;gt.extractRotation(rt);const At=new _.yGw;At.copyPosition(rt);const xt=At.clone().invert().multiply(rt),yt=gt.clone().invert().multiply(xt),_t=c,Mt=new _.yGw;if(ct===0)Mt.copy(gt).multiply(pt).multiply(yt).multiply(_t);else if(ct===1)Mt.copy(gt).multiply(yt).multiply(pt).multiply(_t);else{const sn=new _.yGw().scale(new _.Pa4().setFromMatrixScale(st)).clone().invert(),on=yt.clone().multiply(sn);Mt.copy(gt).multiply(pt).multiply(on).multiply(_t)}const It=tt.clone().invert(),Bt=g.clone().invert();let Lt=e.clone().multiply(et).multiply(tt).multiply(i).multiply(s).multiply(o).multiply(It).multiply(b).multiply(g).multiply(c).multiply(Bt);const Ht=new _.yGw().copyPosition(Lt),Jt=rt.clone().multiply(Ht);return at.copyPosition(Jt),Lt=at.clone().multiply(Mt),Lt.premultiply(rt.invert()),Lt}function Rt(h){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(h=h||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[h]}function kt(h){return h.split(",").map(function(e){return parseFloat(e)})}function Ot(h,e,i){return e===void 0&&(e=0),i===void 0&&(i=h.byteLength),new TextDecoder().decode(new Uint8Array(h,e,i))}function Gt(h,e,i){return h.slice(0,e).concat(i).concat(h.slice(e))}class Nt extends _e.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Lr],this._importer=new yl(OB,["fbx"],!0)}async onAdded(e){var i,s;(s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){var i,s,o,c;(s=(i=e.getManager())==null?void 0:i.importer)!=null&&s.Importers&&((c=(o=e.getManager())==null?void 0:o.importer)==null||c.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1))}}Nt.PluginType="FBXLoadPlugin";const zt=new _.cPb(45,1,.1,1e3);function qt(h,e,i,s=7,o=new _.Pa4(0,0,1.5)){i=i??h.scene.modelObject;const c=new Xt().expandByObject(i??e,!0,!0),g=c.getCenter(new _.Pa4),b=c.getSize(new _.Pa4);zt.position.copy(g).add(o.clone().multiplyScalar(Math.max(b.x,b.y,b.z))),zt.lookAt(g),e&&e.traverseVisible(rt=>{rt.layers.enable(s)}),s>0?zt.layers.set(s):zt.layers.enableAll();const et=e==null?void 0:e.visible;e&&(e.visible=!0),h.renderer.rendererObject.setRenderTarget(null),h.renderer.rendererObject.render(i,zt);const tt=h.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=et,e.traverseVisible(rt=>{rt.layers.disable(s)}),zt.layers.enableAll()),h.setDirty(),tt}class $t{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new _.Kj0(new _.xo$(1)),cube:new _.Kj0(new _.DvJ(1,1,1)),cylinder:new _.Kj0(new _.fHI(.5,.5,1))};const i=new _.xsS;this._channel=7;const s=new _.vmT(16777215,4473924,1);s.position.set(0,10,0),s.layers.set(this._channel),i.add(s),this._lights.push(s),this._scene=i}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,i="sphere"){const s=this.shapes[i]||new _.Kj0(new _.xo$(1));s.material=e.materialObject,s.geometry.attributes.tangent||s.geometry.computeTangents(),this._scene.add(s),this._scene.environment=this.viewer.scene.getEnvironment();const o=s.material.envMapIntensity;typeof o=="number"&&(s.material.envMapIntensity=Math.max(o,2));const c=qt(this.viewer,s,this._scene,this._channel,new _.Pa4(0,0,1.5));return typeof o=="number"&&(s.material.envMapIntensity=o),this._scene.remove(s),s.material=void 0,c}}class En extends hs{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig).uiRefresh)==null||i.call(e))},this.dependencies=[Lr],this.variations=[],this._selectedMaterial=()=>{var e,i;return((i=(e=this._picking)==null?void 0:e.getSelectedObject())==null?void 0:i.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(by).filter(i=>i.endsWith("Map"))].map(i=>({label:i,value:i}))},...((e=this.getSelectedVariation())==null?void 0:e.materials.map(i=>i.uiConfig?Object.assign(i.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(i.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(i)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()},{type:"button",label:"Apply All",value:()=>{this.variations.forEach(i=>this.applyVariation(i,i.materials[0].uuid))}}]}]}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)==null?void 0:i.getPluginByType("Picking"),this._previewGenerator=new $t(this._viewer),(s=this._picking)==null||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,i){return this.variations=[],super.fromJSON(e,i)}async onRemove(e){var i,s;return(i=this._previewGenerator)==null||i.dispose(),this._previewGenerator=void 0,(s=this._picking)==null||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(i=>i.uuid===e):void 0}getSelectedVariation(){var e,i;return this.findVariation((e=this._selectedMaterial())==null?void 0:e.uuid)||this.findVariation((i=this._selectedMaterial())==null?void 0:i.name)}applyVariation(e,i){var c,g;const s=e.materials.find(b=>b.uuid===i),o=(g=(c=this._viewer)==null?void 0:c.getManager())==null?void 0:g.materials;return!!o&&!!s&&o.applyMaterial(s,e.uuid)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let i=this.findVariation(e.uuid);!i&&e.name.length>0&&(i=this.findVariation(e.name)),i&&this.removeVariation(i)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var s;const i=(s=e==null?void 0:e.clone)==null?void 0:s.call(e);if(e&&i){let o=this.findVariation(e.uuid);!o&&e.name.length>0&&(o=this.findVariation(e.name)),o||this.variations.push(o={uuid:e.name.length>0?e.name:e.uuid,title:e.name.length>0?e.name:"No Name",preview:"generate:sphere",materials:[]}),o.materials.push(i),this.refreshUi()}}}En.PluginType="MaterialConfiguratorBasePlugin",function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);c>3&&g&&Object.defineProperty(e,i,g)}([Mn()],En.prototype,"variations",void 0);class gn{static _initialize(){this._inited=!0,(0,_e.createStyles)(_e.css`
  .customContextGrid {
    background: #28223C;
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }
  .customContextGridParent{
    position: absolute;
    top: 0;
    left: 0;
    width: 270px;
    height: calc(100% - 100px);
    overflow-y: scroll;
    z-index: 100;
    display: flex;
    flex-direction: column;
    margin-bottom: 50px;
    margin-top: 50px;
  }
  /* Hide scrollbar for Chrome, Safari and Opera */
  .customContextGridParent::-webkit-scrollbar {
    display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .customContextGridParent {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

        `),this._container.style.position="absolute",this._container.style.top="0",this._container.style.left="0",this._container.style.width="270px",this._container.style.height="100%",this._container.style.pointerEvents="none",this._container.style.zIndex="100",this._container.style.overflowY="auto"}static Create(e,i,s,o,c,g,b){var at;this._inited||this._initialize();const et=(0,_e.mobileAndTabletCheck)(),tt=et?.15:.25,rt=et?1.5:2.5,st=(0,_e.createDiv)({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${i} </div>
            `});st.style.top=c+"px",st.style.left=o+"px",st.style.gap=tt+"rem",st.style.width=(rt+tt)*s-tt+"rem",st.dataset.tag=e;for(const ct of g){const pt=(0,_e.createDiv)({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${ct.image}" class="customContextGridItemImage">
            `});pt.style.width=rt+"rem",pt.style.height=rt+"rem",st.appendChild(pt),pt.onclick=()=>{var gt;return(gt=ct.onClick)==null?void 0:gt.call(ct,ct.id)},b(pt,ct)}return(at=this.Elements)==null||at.push(st),st}static RemoveAll(e){if(e){const i=this.Elements.filter(s=>s.dataset.tag===e);for(const s of i)s.remove();this.Elements=this.Elements.filter(s=>s.dataset.tag!==e)}else{for(const i of this.Elements)i.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=(0,_e.createDiv)({addToBody:!0,classList:["customContextGridParent"]}));for(const s of this.Elements)s.remove();this._container.innerHTML="";let i=20;e.appendChild(this._container);for(const s of this.Elements)s.style.top=i+"px",this._container.appendChild(s),i+=s.clientHeight+20}}function vn(h){if(h==null)return window;if(h.toString()!=="[object Window]"){var e=h.ownerDocument;return e&&e.defaultView||window}return h}function Un(h){return h instanceof vn(h).Element||h instanceof Element}function $n(h){return h instanceof vn(h).HTMLElement||h instanceof HTMLElement}function jn(h){return typeof ShadowRoot<"u"&&(h instanceof vn(h).ShadowRoot||h instanceof ShadowRoot)}gn.Elements=[],gn._inited=!1,gn._container=document.createElement("div");var sr=Math.max,Vn=Math.min,_r=Math.round;function xr(){var h=navigator.userAgentData;return h!=null&&h.brands?h.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Gr(){return!/^((?!chrome|android).)*safari/i.test(xr())}function ns(h,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var s=h.getBoundingClientRect(),o=1,c=1;e&&$n(h)&&(o=h.offsetWidth>0&&_r(s.width)/h.offsetWidth||1,c=h.offsetHeight>0&&_r(s.height)/h.offsetHeight||1);var g=(Un(h)?vn(h):window).visualViewport,b=!Gr()&&i,et=(s.left+(b&&g?g.offsetLeft:0))/o,tt=(s.top+(b&&g?g.offsetTop:0))/c,rt=s.width/o,st=s.height/c;return{width:rt,height:st,top:tt,right:et+rt,bottom:tt+st,left:et,x:et,y:tt}}function Vr(h){var e=vn(h);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function Tr(h){return h?(h.nodeName||"").toLowerCase():null}function Yr(h){return((Un(h)?h.ownerDocument:h.document)||window.document).documentElement}function ts(h){return ns(Yr(h)).left+Vr(h).scrollLeft}function mr(h){return vn(h).getComputedStyle(h)}function Dr(h){var e=mr(h),i=e.overflow,s=e.overflowX,o=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+o+s)}function $r(h,e,i){i===void 0&&(i=!1);var s,o,c=$n(e),g=$n(e)&&function(st){var at=st.getBoundingClientRect(),ct=_r(at.width)/st.offsetWidth||1,pt=_r(at.height)/st.offsetHeight||1;return ct!==1||pt!==1}(e),b=Yr(e),et=ns(h,g,i),tt={scrollLeft:0,scrollTop:0},rt={x:0,y:0};return(c||!c&&!i)&&((Tr(e)!=="body"||Dr(b))&&(tt=(s=e)!==vn(s)&&$n(s)?{scrollLeft:(o=s).scrollLeft,scrollTop:o.scrollTop}:Vr(s)),$n(e)?((rt=ns(e,!0)).x+=e.clientLeft,rt.y+=e.clientTop):b&&(rt.x=ts(b))),{x:et.left+tt.scrollLeft-rt.x,y:et.top+tt.scrollTop-rt.y,width:et.width,height:et.height}}function Ur(h){var e=ns(h),i=h.offsetWidth,s=h.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-s)<=1&&(s=e.height),{x:h.offsetLeft,y:h.offsetTop,width:i,height:s}}function ss(h){return Tr(h)==="html"?h:h.assignedSlot||h.parentNode||(jn(h)?h.host:null)||Yr(h)}function Hs(h){return["html","body","#document"].indexOf(Tr(h))>=0?h.ownerDocument.body:$n(h)&&Dr(h)?h:Hs(ss(h))}function Fn(h,e){var i;e===void 0&&(e=[]);var s=Hs(h),o=s===((i=h.ownerDocument)==null?void 0:i.body),c=vn(s),g=o?[c].concat(c.visualViewport||[],Dr(s)?s:[]):s,b=e.concat(g);return o?b:b.concat(Fn(ss(g)))}function Sn(h){return["table","td","th"].indexOf(Tr(h))>=0}function lr(h){return $n(h)&&mr(h).position!=="fixed"?h.offsetParent:null}function Yn(h){for(var e=vn(h),i=lr(h);i&&Sn(i)&&mr(i).position==="static";)i=lr(i);return i&&(Tr(i)==="html"||Tr(i)==="body"&&mr(i).position==="static")?e:i||function(s){var o=/firefox/i.test(xr());if(/Trident/i.test(xr())&&$n(s)&&mr(s).position==="fixed")return null;var c=ss(s);for(jn(c)&&(c=c.host);$n(c)&&["html","body"].indexOf(Tr(c))<0;){var g=mr(c);if(g.transform!=="none"||g.perspective!=="none"||g.contain==="paint"||["transform","perspective"].indexOf(g.willChange)!==-1||o&&g.willChange==="filter"||o&&g.filter&&g.filter!=="none")return c;c=c.parentNode}return null}(h)||e}var On="top",Zn="bottom",fn="right",Gn="left",qn="auto",Er=[On,Zn,fn,Gn],br="start",Rr="end",is="clippingParents",ms="viewport",Ps="popper",ds="reference",Ys=Er.reduce(function(h,e){return h.concat([e+"-"+br,e+"-"+Rr])},[]),qs=[].concat(Er,[qn]).reduce(function(h,e){return h.concat([e,e+"-"+br,e+"-"+Rr])},[]),Rs="beforeRead",Zo="read",Pp="afterRead",lo="beforeMain",Bo="main",jo="afterMain",ty="beforeWrite",yr="write",aA="afterWrite",DE=[Rs,Zo,Pp,lo,Bo,jo,ty,yr,aA];function mm(h){var e=new Map,i=new Set,s=[];function o(c){i.add(c.name),[].concat(c.requires||[],c.requiresIfExists||[]).forEach(function(g){if(!i.has(g)){var b=e.get(g);b&&o(b)}}),s.push(c)}return h.forEach(function(c){e.set(c.name,c)}),h.forEach(function(c){i.has(c.name)||o(c)}),s}var kE={placement:"bottom",modifiers:[],strategy:"absolute"};function r1(){for(var h=arguments.length,e=new Array(h),i=0;i<h;i++)e[i]=arguments[i];return!e.some(function(s){return!(s&&typeof s.getBoundingClientRect=="function")})}function BE(h){h===void 0&&(h={});var e=h,i=e.defaultModifiers,s=i===void 0?[]:i,o=e.defaultOptions,c=o===void 0?kE:o;return function(g,b,et){et===void 0&&(et=c);var tt,rt,st={placement:"bottom",orderedModifiers:[],options:Object.assign({},kE,c),modifiersData:{},elements:{reference:g,popper:b},attributes:{},styles:{}},at=[],ct=!1,pt={state:st,setOptions:function(At){var xt=typeof At=="function"?At(st.options):At;gt(),st.options=Object.assign({},c,st.options,xt),st.scrollParents={reference:Un(g)?Fn(g):g.contextElement?Fn(g.contextElement):[],popper:Fn(b)};var yt,_t,Mt=function(It){var Bt=mm(It);return DE.reduce(function(Lt,Ht){return Lt.concat(Bt.filter(function(Jt){return Jt.phase===Ht}))},[])}((yt=[].concat(s,st.options.modifiers),_t=yt.reduce(function(It,Bt){var Lt=It[Bt.name];return It[Bt.name]=Lt?Object.assign({},Lt,Bt,{options:Object.assign({},Lt.options,Bt.options),data:Object.assign({},Lt.data,Bt.data)}):Bt,It},{}),Object.keys(_t).map(function(It){return _t[It]})));return st.orderedModifiers=Mt.filter(function(It){return It.enabled}),st.orderedModifiers.forEach(function(It){var Bt=It.name,Lt=It.options,Ht=Lt===void 0?{}:Lt,Jt=It.effect;if(typeof Jt=="function"){var sn=Jt({state:st,name:Bt,instance:pt,options:Ht});at.push(sn||function(){})}}),pt.update()},forceUpdate:function(){if(!ct){var At=st.elements,xt=At.reference,yt=At.popper;if(r1(xt,yt)){st.rects={reference:$r(xt,Yn(yt),st.options.strategy==="fixed"),popper:Ur(yt)},st.reset=!1,st.placement=st.options.placement,st.orderedModifiers.forEach(function(Jt){return st.modifiersData[Jt.name]=Object.assign({},Jt.data)});for(var _t=0;_t<st.orderedModifiers.length;_t++)if(st.reset!==!0){var Mt=st.orderedModifiers[_t],It=Mt.fn,Bt=Mt.options,Lt=Bt===void 0?{}:Bt,Ht=Mt.name;typeof It=="function"&&(st=It({state:st,options:Lt,name:Ht,instance:pt})||st)}else st.reset=!1,_t=-1}}},update:(tt=function(){return new Promise(function(At){pt.forceUpdate(),At(st)})},function(){return rt||(rt=new Promise(function(At){Promise.resolve().then(function(){rt=void 0,At(tt())})})),rt}),destroy:function(){gt(),ct=!0}};if(!r1(g,b))return pt;function gt(){at.forEach(function(At){return At()}),at=[]}return pt.setOptions(et).then(function(At){!ct&&et.onFirstUpdate&&et.onFirstUpdate(At)}),pt}}var EP=BE(),s1={passive:!0},QC={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(h){var e=h.state,i=h.instance,s=h.options,o=s.scroll,c=o===void 0||o,g=s.resize,b=g===void 0||g,et=vn(e.elements.popper),tt=[].concat(e.scrollParents.reference,e.scrollParents.popper);return c&&tt.forEach(function(rt){rt.addEventListener("scroll",i.update,s1)}),b&&et.addEventListener("resize",i.update,s1),function(){c&&tt.forEach(function(rt){rt.removeEventListener("scroll",i.update,s1)}),b&&et.removeEventListener("resize",i.update,s1)}},data:{}};function E_(h){return h.split("-")[0]}function Gv(h){return h.split("-")[1]}function WC(h){return["top","bottom"].indexOf(h)>=0?"x":"y"}function WT(h){var e,i=h.reference,s=h.element,o=h.placement,c=o?E_(o):null,g=o?Gv(o):null,b=i.x+i.width/2-s.width/2,et=i.y+i.height/2-s.height/2;switch(c){case On:e={x:b,y:i.y-s.height};break;case Zn:e={x:b,y:i.y+i.height};break;case fn:e={x:i.x+i.width,y:et};break;case Gn:e={x:i.x-s.width,y:et};break;default:e={x:i.x,y:i.y}}var tt=c?WC(c):null;if(tt!=null){var rt=tt==="y"?"height":"width";switch(g){case br:e[tt]=e[tt]-(i[rt]/2-s[rt]/2);break;case Rr:e[tt]=e[tt]+(i[rt]/2-s[rt]/2)}}return e}var o1={name:"popperOffsets",enabled:!0,phase:"read",fn:function(h){var e=h.state,i=h.name;e.modifiersData[i]=WT({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},SP={top:"auto",right:"auto",bottom:"auto",left:"auto"};function OE(h){var e,i=h.popper,s=h.popperRect,o=h.placement,c=h.variation,g=h.offsets,b=h.position,et=h.gpuAcceleration,tt=h.adaptive,rt=h.roundOffsets,st=h.isFixed,at=g.x,ct=at===void 0?0:at,pt=g.y,gt=pt===void 0?0:pt,At=typeof rt=="function"?rt({x:ct,y:gt}):{x:ct,y:gt};ct=At.x,gt=At.y;var xt=g.hasOwnProperty("x"),yt=g.hasOwnProperty("y"),_t=Gn,Mt=On,It=window;if(tt){var Bt=Yn(i),Lt="clientHeight",Ht="clientWidth";Bt===vn(i)&&mr(Bt=Yr(i)).position!=="static"&&b==="absolute"&&(Lt="scrollHeight",Ht="scrollWidth"),(o===On||(o===Gn||o===fn)&&c===Rr)&&(Mt=Zn,gt-=(st&&Bt===It&&It.visualViewport?It.visualViewport.height:Bt[Lt])-s.height,gt*=et?1:-1),o!==Gn&&(o!==On&&o!==Zn||c!==Rr)||(_t=fn,ct-=(st&&Bt===It&&It.visualViewport?It.visualViewport.width:Bt[Ht])-s.width,ct*=et?1:-1)}var Jt,sn=Object.assign({position:b},tt&&SP),on=rt===!0?function(mn){var cn=mn.x,un=mn.y,bn=window.devicePixelRatio||1;return{x:_r(cn*bn)/bn||0,y:_r(un*bn)/bn||0}}({x:ct,y:gt}):{x:ct,y:gt};return ct=on.x,gt=on.y,et?Object.assign({},sn,((Jt={})[Mt]=yt?"0":"",Jt[_t]=xt?"0":"",Jt.transform=(It.devicePixelRatio||1)<=1?"translate("+ct+"px, "+gt+"px)":"translate3d("+ct+"px, "+gt+"px, 0)",Jt)):Object.assign({},sn,((e={})[Mt]=yt?gt+"px":"",e[_t]=xt?ct+"px":"",e.transform="",e))}var qC={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(h){var e=h.state,i=h.options,s=i.gpuAcceleration,o=s===void 0||s,c=i.adaptive,g=c===void 0||c,b=i.roundOffsets,et=b===void 0||b,tt={placement:E_(e.placement),variation:Gv(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:o,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,OE(Object.assign({},tt,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:g,roundOffsets:et})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,OE(Object.assign({},tt,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:et})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},Ln={name:"applyStyles",enabled:!0,phase:"write",fn:function(h){var e=h.state;Object.keys(e.elements).forEach(function(i){var s=e.styles[i]||{},o=e.attributes[i]||{},c=e.elements[i];$n(c)&&Tr(c)&&(Object.assign(c.style,s),Object.keys(o).forEach(function(g){var b=o[g];b===!1?c.removeAttribute(g):c.setAttribute(g,b===!0?"":b)}))})},effect:function(h){var e=h.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(s){var o=e.elements[s],c=e.attributes[s]||{},g=Object.keys(e.styles.hasOwnProperty(s)?e.styles[s]:i[s]).reduce(function(b,et){return b[et]="",b},{});$n(o)&&Tr(o)&&(Object.assign(o.style,g),Object.keys(c).forEach(function(b){o.removeAttribute(b)}))})}},requires:["computeStyles"]},wr={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(h){var e=h.state,i=h.options,s=h.name,o=i.offset,c=o===void 0?[0,0]:o,g=qs.reduce(function(rt,st){return rt[st]=function(at,ct,pt){var gt=E_(at),At=[Gn,On].indexOf(gt)>=0?-1:1,xt=typeof pt=="function"?pt(Object.assign({},ct,{placement:at})):pt,yt=xt[0],_t=xt[1];return yt=yt||0,_t=(_t||0)*At,[Gn,fn].indexOf(gt)>=0?{x:_t,y:yt}:{x:yt,y:_t}}(st,e.rects,c),rt},{}),b=g[e.placement],et=b.x,tt=b.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=et,e.modifiersData.popperOffsets.y+=tt),e.modifiersData[s]=g}},kr={left:"right",right:"left",bottom:"top",top:"bottom"};function Ir(h){return h.replace(/left|right|bottom|top/g,function(e){return kr[e]})}var Qr={start:"end",end:"start"};function ys(h){return h.replace(/start|end/g,function(e){return Qr[e]})}function Do(h,e){var i=e.getRootNode&&e.getRootNode();if(h.contains(e))return!0;if(i&&jn(i)){var s=e;do{if(s&&h.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function zs(h){return Object.assign({},h,{left:h.x,top:h.y,right:h.x+h.width,bottom:h.y+h.height})}function wo(h,e,i){return e===ms?zs(function(s,o){var c=vn(s),g=Yr(s),b=c.visualViewport,et=g.clientWidth,tt=g.clientHeight,rt=0,st=0;if(b){et=b.width,tt=b.height;var at=Gr();(at||!at&&o==="fixed")&&(rt=b.offsetLeft,st=b.offsetTop)}return{width:et,height:tt,x:rt+ts(s),y:st}}(h,i)):Un(e)?function(s,o){var c=ns(s,!1,o==="fixed");return c.top=c.top+s.clientTop,c.left=c.left+s.clientLeft,c.bottom=c.top+s.clientHeight,c.right=c.left+s.clientWidth,c.width=s.clientWidth,c.height=s.clientHeight,c.x=c.left,c.y=c.top,c}(e,i):zs(function(s){var o,c=Yr(s),g=Vr(s),b=(o=s.ownerDocument)==null?void 0:o.body,et=sr(c.scrollWidth,c.clientWidth,b?b.scrollWidth:0,b?b.clientWidth:0),tt=sr(c.scrollHeight,c.clientHeight,b?b.scrollHeight:0,b?b.clientHeight:0),rt=-g.scrollLeft+ts(s),st=-g.scrollTop;return mr(b||c).direction==="rtl"&&(rt+=sr(c.clientWidth,b?b.clientWidth:0)-et),{width:et,height:tt,x:rt,y:st}}(Yr(h)))}function Xo(h){return Object.assign({},{top:0,right:0,bottom:0,left:0},h)}function Co(h,e){return e.reduce(function(i,s){return i[s]=h,i},{})}function _o(h,e){e===void 0&&(e={});var i=e,s=i.placement,o=s===void 0?h.placement:s,c=i.strategy,g=c===void 0?h.strategy:c,b=i.boundary,et=b===void 0?is:b,tt=i.rootBoundary,rt=tt===void 0?ms:tt,st=i.elementContext,at=st===void 0?Ps:st,ct=i.altBoundary,pt=ct!==void 0&&ct,gt=i.padding,At=gt===void 0?0:gt,xt=Xo(typeof At!="number"?At:Co(At,Er)),yt=at===Ps?ds:Ps,_t=h.rects.popper,Mt=h.elements[pt?yt:at],It=function(cn,un,bn,xn){var Cn=un==="clippingParents"?function(nr){var tr=Fn(ss(nr)),Cr=["absolute","fixed"].indexOf(mr(nr).position)>=0&&$n(nr)?Yn(nr):nr;return Un(Cr)?tr.filter(function(Ar){return Un(Ar)&&Do(Ar,Cr)&&Tr(Ar)!=="body"}):[]}(cn):[].concat(un),Jn=[].concat(Cn,[bn]),Kn=Jn[0],gr=Jn.reduce(function(nr,tr){var Cr=wo(cn,tr,xn);return nr.top=sr(Cr.top,nr.top),nr.right=Vn(Cr.right,nr.right),nr.bottom=Vn(Cr.bottom,nr.bottom),nr.left=sr(Cr.left,nr.left),nr},wo(cn,Kn,xn));return gr.width=gr.right-gr.left,gr.height=gr.bottom-gr.top,gr.x=gr.left,gr.y=gr.top,gr}(Un(Mt)?Mt:Mt.contextElement||Yr(h.elements.popper),et,rt,g),Bt=ns(h.elements.reference),Lt=WT({reference:Bt,element:_t,strategy:"absolute",placement:o}),Ht=zs(Object.assign({},_t,Lt)),Jt=at===Ps?Ht:Bt,sn={top:It.top-Jt.top+xt.top,bottom:Jt.bottom-It.bottom+xt.bottom,left:It.left-Jt.left+xt.left,right:Jt.right-It.right+xt.right},on=h.modifiersData.offset;if(at===Ps&&on){var mn=on[o];Object.keys(sn).forEach(function(cn){var un=[fn,Zn].indexOf(cn)>=0?1:-1,bn=[On,Zn].indexOf(cn)>=0?"y":"x";sn[cn]+=mn[bn]*un})}return sn}var Rp={name:"flip",enabled:!0,phase:"main",fn:function(h){var e=h.state,i=h.options,s=h.name;if(!e.modifiersData[s]._skip){for(var o=i.mainAxis,c=o===void 0||o,g=i.altAxis,b=g===void 0||g,et=i.fallbackPlacements,tt=i.padding,rt=i.boundary,st=i.rootBoundary,at=i.altBoundary,ct=i.flipVariations,pt=ct===void 0||ct,gt=i.allowedAutoPlacements,At=e.options.placement,xt=E_(At),yt=et||(xt!==At&&pt?function(nr){if(E_(nr)===qn)return[];var tr=Ir(nr);return[ys(nr),tr,ys(tr)]}(At):[Ir(At)]),_t=[At].concat(yt).reduce(function(nr,tr){return nr.concat(E_(tr)===qn?function(Cr,Ar){Ar===void 0&&(Ar={});var Hr=Ar,Jr=Hr.placement,cs=Hr.boundary,Os=Hr.rootBoundary,Ss=Hr.padding,Ts=Hr.flipVariations,pr=Hr.allowedAutoPlacements,Pr=pr===void 0?qs:pr,qr=Gv(Jr),Xs=qr?Ts?Ys:Ys.filter(function(Qs){return Gv(Qs)===qr}):Er,po=Xs.filter(function(Qs){return Pr.indexOf(Qs)>=0});po.length===0&&(po=Xs);var eo=po.reduce(function(Qs,Ws){return Qs[Ws]=_o(Cr,{placement:Ws,boundary:cs,rootBoundary:Os,padding:Ss})[E_(Ws)],Qs},{});return Object.keys(eo).sort(function(Qs,Ws){return eo[Qs]-eo[Ws]})}(e,{placement:tr,boundary:rt,rootBoundary:st,padding:tt,flipVariations:pt,allowedAutoPlacements:gt}):tr)},[]),Mt=e.rects.reference,It=e.rects.popper,Bt=new Map,Lt=!0,Ht=_t[0],Jt=0;Jt<_t.length;Jt++){var sn=_t[Jt],on=E_(sn),mn=Gv(sn)===br,cn=[On,Zn].indexOf(on)>=0,un=cn?"width":"height",bn=_o(e,{placement:sn,boundary:rt,rootBoundary:st,altBoundary:at,padding:tt}),xn=cn?mn?fn:Gn:mn?Zn:On;Mt[un]>It[un]&&(xn=Ir(xn));var Cn=Ir(xn),Jn=[];if(c&&Jn.push(bn[on]<=0),b&&Jn.push(bn[xn]<=0,bn[Cn]<=0),Jn.every(function(nr){return nr})){Ht=sn,Lt=!1;break}Bt.set(sn,Jn)}if(Lt)for(var Kn=function(nr){var tr=_t.find(function(Cr){var Ar=Bt.get(Cr);if(Ar)return Ar.slice(0,nr).every(function(Hr){return Hr})});if(tr)return Ht=tr,"break"},gr=pt?3:1;gr>0&&Kn(gr)!=="break";gr--);e.placement!==Ht&&(e.modifiersData[s]._skip=!0,e.placement=Ht,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function pp(h,e,i){return sr(h,Vn(e,i))}var vu={name:"preventOverflow",enabled:!0,phase:"main",fn:function(h){var e=h.state,i=h.options,s=h.name,o=i.mainAxis,c=o===void 0||o,g=i.altAxis,b=g!==void 0&&g,et=i.boundary,tt=i.rootBoundary,rt=i.altBoundary,st=i.padding,at=i.tether,ct=at===void 0||at,pt=i.tetherOffset,gt=pt===void 0?0:pt,At=_o(e,{boundary:et,rootBoundary:tt,padding:st,altBoundary:rt}),xt=E_(e.placement),yt=Gv(e.placement),_t=!yt,Mt=WC(xt),It=Mt==="x"?"y":"x",Bt=e.modifiersData.popperOffsets,Lt=e.rects.reference,Ht=e.rects.popper,Jt=typeof gt=="function"?gt(Object.assign({},e.rects,{placement:e.placement})):gt,sn=typeof Jt=="number"?{mainAxis:Jt,altAxis:Jt}:Object.assign({mainAxis:0,altAxis:0},Jt),on=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,mn={x:0,y:0};if(Bt){if(c){var cn,un=Mt==="y"?On:Gn,bn=Mt==="y"?Zn:fn,xn=Mt==="y"?"height":"width",Cn=Bt[Mt],Jn=Cn+At[un],Kn=Cn-At[bn],gr=ct?-Ht[xn]/2:0,nr=yt===br?Lt[xn]:Ht[xn],tr=yt===br?-Ht[xn]:-Lt[xn],Cr=e.elements.arrow,Ar=ct&&Cr?Ur(Cr):{width:0,height:0},Hr=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},Jr=Hr[un],cs=Hr[bn],Os=pp(0,Lt[xn],Ar[xn]),Ss=_t?Lt[xn]/2-gr-Os-Jr-sn.mainAxis:nr-Os-Jr-sn.mainAxis,Ts=_t?-Lt[xn]/2+gr+Os+cs+sn.mainAxis:tr+Os+cs+sn.mainAxis,pr=e.elements.arrow&&Yn(e.elements.arrow),Pr=pr?Mt==="y"?pr.clientTop||0:pr.clientLeft||0:0,qr=(cn=on==null?void 0:on[Mt])!=null?cn:0,Xs=Cn+Ts-qr,po=pp(ct?Vn(Jn,Cn+Ss-qr-Pr):Jn,Cn,ct?sr(Kn,Xs):Kn);Bt[Mt]=po,mn[Mt]=po-Cn}if(b){var eo,Qs=Mt==="x"?On:Gn,Ws=Mt==="x"?Zn:fn,_s=Bt[It],ar=It==="y"?"height":"width",Wr=_s+At[Qs],bs=_s-At[Ws],Or=[On,Gn].indexOf(xt)!==-1,Us=(eo=on==null?void 0:on[It])!=null?eo:0,Gl=Or?Wr:_s-Lt[ar]-Ht[ar]-Us+sn.altAxis,lu=Or?_s+Lt[ar]+Ht[ar]-Us-sn.altAxis:bs,Gu=ct&&Or?function(Yp,Am,Op){var Ks=pp(Yp,Am,Op);return Ks>Op?Op:Ks}(Gl,_s,lu):pp(ct?Gl:Wr,_s,ct?lu:bs);Bt[It]=Gu,mn[It]=Gu-_s}e.modifiersData[s]=mn}},requiresIfExists:["offset"]},Cw={name:"arrow",enabled:!0,phase:"main",fn:function(h){var e,i=h.state,s=h.name,o=h.options,c=i.elements.arrow,g=i.modifiersData.popperOffsets,b=E_(i.placement),et=WC(b),tt=[Gn,fn].indexOf(b)>=0?"height":"width";if(c&&g){var rt=function(Ht,Jt){return Xo(typeof(Ht=typeof Ht=="function"?Ht(Object.assign({},Jt.rects,{placement:Jt.placement})):Ht)!="number"?Ht:Co(Ht,Er))}(o.padding,i),st=Ur(c),at=et==="y"?On:Gn,ct=et==="y"?Zn:fn,pt=i.rects.reference[tt]+i.rects.reference[et]-g[et]-i.rects.popper[tt],gt=g[et]-i.rects.reference[et],At=Yn(c),xt=At?et==="y"?At.clientHeight||0:At.clientWidth||0:0,yt=pt/2-gt/2,_t=rt[at],Mt=xt-st[tt]-rt[ct],It=xt/2-st[tt]/2+yt,Bt=pp(_t,It,Mt),Lt=et;i.modifiersData[s]=((e={})[Lt]=Bt,e.centerOffset=Bt-It,e)}},effect:function(h){var e=h.state,i=h.options.element,s=i===void 0?"[data-popper-arrow]":i;s!=null&&(typeof s!="string"||(s=e.elements.popper.querySelector(s)))&&Do(e.elements.popper,s)&&(e.elements.arrow=s)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Kl(h,e,i){return i===void 0&&(i={x:0,y:0}),{top:h.top-e.height-i.y,right:h.right-e.width+i.x,bottom:h.bottom-e.height+i.y,left:h.left-e.width-i.x}}function Cu(h){return[On,fn,Zn,Gn].some(function(e){return h[e]>=0})}var o0={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(h){var e=h.state,i=h.name,s=e.rects.reference,o=e.rects.popper,c=e.modifiersData.preventOverflow,g=_o(e,{elementContext:"reference"}),b=_o(e,{altBoundary:!0}),et=Kl(g,s),tt=Kl(b,o,c),rt=Cu(et),st=Cu(tt);e.modifiersData[i]={referenceClippingOffsets:et,popperEscapeOffsets:tt,isReferenceHidden:rt,hasPopperEscaped:st},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":rt,"data-popper-escaped":st})}},Uu=BE({defaultModifiers:[QC,o1,qC,Ln,wr,Rp,vu,Cw,o0]}),$s="tippy-box",Mu="tippy-content",qT="tippy-backdrop",CP="tippy-arrow",MP="tippy-svg-arrow",a0={passive:!0,capture:!0},TP=function(){return document.body};function XT(h,e,i){if(Array.isArray(h)){var s=h[e];return s??(Array.isArray(i)?i[e]:i)}return h}function YT(h,e){var i={}.toString.call(h);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function IP(h,e){return typeof h=="function"?h.apply(void 0,e):h}function PP(h,e){return e===0?h:function(s){clearTimeout(i),i=setTimeout(function(){h(s)},e)};var i}function Mw(h){return[].concat(h)}function KT(h,e){h.indexOf(e)===-1&&h.push(e)}function XC(h){return[].slice.call(h)}function _a(h){return Object.keys(h).reduce(function(e,i){return h[i]!==void 0&&(e[i]=h[i]),e},{})}function a1(){return document.createElement("div")}function Hv(h){return["Element","Fragment"].some(function(e){return YT(h,e)})}function ny(h,e){h.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function JT(h,e){h.forEach(function(i){i&&i.setAttribute("data-state",e)})}function Tw(h,e,i){var s=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(o){h[s](o,i)})}function YC(h,e){for(var i=e;i;){var s;if(h.contains(i))return!0;i=i.getRootNode==null||(s=i.getRootNode())==null?void 0:s.host}return!1}var zl={isTouch:!1},lA=0;function $T(){zl.isTouch||(zl.isTouch=!0,window.performance&&document.addEventListener("mousemove",S_))}function S_(){var h=performance.now();h-lA<20&&(zl.isTouch=!1,document.removeEventListener("mousemove",S_)),lA=h}function C_(){var h,e=document.activeElement;if((h=e)&&h._tippy&&h._tippy.reference===h){var i=e._tippy;e.blur&&!i.state.isVisible&&e.blur()}}var RP=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),Vl=Object.assign({appendTo:TP,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),LE=Object.keys(Vl);function DP(h){var e=(h.plugins||[]).reduce(function(i,s){var o,c=s.name,g=s.defaultValue;return c&&(i[c]=h[c]!==void 0?h[c]:(o=Vl[c])!=null?o:g),i},{});return Object.assign({},h,e)}function ZT(h,e){var i=Object.assign({},e,{content:IP(e.content,[h])},e.ignoreAttributes?{}:function(s,o){return(o?Object.keys(DP(Object.assign({},Vl,{plugins:o}))):LE).reduce(function(c,g){var b=(s.getAttribute("data-tippy-"+g)||"").trim();if(!b)return c;if(g==="content")c[g]=b;else try{c[g]=JSON.parse(b)}catch{c[g]=b}return c},{})}(h,e.plugins));return i.aria=Object.assign({},Vl.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var p4=function(){return"innerHTML"};function UB(h,e){h[p4()]=e}function ZL(h){var e=a1();return h===!0?e.className=CP:(e.className=MP,Hv(h)?e.appendChild(h):UB(e,h)),e}function e3(h,e){Hv(e.content)?(UB(h,""),h.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?UB(h,e.content):h.textContent=e.content)}function FB(h){var e=h.firstElementChild,i=XC(e.children);return{box:e,content:i.find(function(s){return s.classList.contains(Mu)}),arrow:i.find(function(s){return s.classList.contains(CP)||s.classList.contains(MP)}),backdrop:i.find(function(s){return s.classList.contains(qT)})}}function t3(h){var e=a1(),i=a1();i.className=$s,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var s=a1();function o(c,g){var b=FB(e),et=b.box,tt=b.content,rt=b.arrow;g.theme?et.setAttribute("data-theme",g.theme):et.removeAttribute("data-theme"),typeof g.animation=="string"?et.setAttribute("data-animation",g.animation):et.removeAttribute("data-animation"),g.inertia?et.setAttribute("data-inertia",""):et.removeAttribute("data-inertia"),et.style.maxWidth=typeof g.maxWidth=="number"?g.maxWidth+"px":g.maxWidth,g.role?et.setAttribute("role",g.role):et.removeAttribute("role"),c.content===g.content&&c.allowHTML===g.allowHTML||e3(tt,h.props),g.arrow?rt?c.arrow!==g.arrow&&(et.removeChild(rt),et.appendChild(ZL(g.arrow))):et.appendChild(ZL(g.arrow)):rt&&et.removeChild(rt)}return s.className=Mu,s.setAttribute("data-state","hidden"),e3(s,h.props),e.appendChild(i),i.appendChild(s),o(h.props,h.props),{popper:e,onUpdate:o}}t3.$$tippy=!0;var f4=1,kP=[],jB=[];function m4(h,e){var i,s,o,c,g,b,et,tt,rt=ZT(h,Object.assign({},Vl,DP(_a(e)))),st=!1,at=!1,ct=!1,pt=!1,gt=[],At=PP(pr,rt.interactiveDebounce),xt=f4++,yt=(tt=rt.plugins).filter(function(ar,Wr){return tt.indexOf(ar)===Wr}),_t={id:xt,reference:h,popper:a1(),popperInstance:null,props:rt,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:yt,clearDelayTimeouts:function(){clearTimeout(i),clearTimeout(s),cancelAnimationFrame(o)},setProps:function(ar){if(!_t.state.isDestroyed){Cn("onBeforeUpdate",[_t,ar]),Ss();var Wr=_t.props,bs=ZT(h,Object.assign({},Wr,_a(ar),{ignoreAttributes:!0}));_t.props=bs,Os(),Wr.interactiveDebounce!==bs.interactiveDebounce&&(gr(),At=PP(pr,bs.interactiveDebounce)),Wr.triggerTarget&&!bs.triggerTarget?Mw(Wr.triggerTarget).forEach(function(Or){Or.removeAttribute("aria-expanded")}):bs.triggerTarget&&h.removeAttribute("aria-expanded"),Kn(),xn(),Bt&&Bt(Wr,bs),_t.popperInstance&&(po(),Qs().forEach(function(Or){requestAnimationFrame(Or._tippy.popperInstance.forceUpdate)})),Cn("onAfterUpdate",[_t,ar])}},setContent:function(ar){_t.setProps({content:ar})},show:function(){var ar=_t.state.isVisible,Wr=_t.state.isDestroyed,bs=!_t.state.isEnabled,Or=zl.isTouch&&!_t.props.touch,Us=XT(_t.props.duration,0,Vl.duration);if(!(ar||Wr||bs||Or||mn().hasAttribute("disabled")||(Cn("onShow",[_t],!1),_t.props.onShow(_t)===!1))){if(_t.state.isVisible=!0,on()&&(It.style.visibility="visible"),xn(),Ar(),_t.state.isMounted||(It.style.transition="none"),on()){var Gl=un();ny([Gl.box,Gl.content],0)}var lu,Gu,Yp;b=function(){var Am;if(_t.state.isVisible&&!pt){if(pt=!0,It.offsetHeight,It.style.transition=_t.props.moveTransition,on()&&_t.props.animation){var Op=un(),Ks=Op.box,vv=Op.content;ny([Ks,vv],Us),JT([Ks,vv],"visible")}Jn(),Kn(),KT(jB,_t),(Am=_t.popperInstance)==null||Am.forceUpdate(),Cn("onMount",[_t]),_t.props.animation&&on()&&function(Zw,In){Jr(Zw,function(){_t.state.isShown=!0,Cn("onShown",[_t])})}(Us)}},Gu=_t.props.appendTo,Yp=mn(),(lu=_t.props.interactive&&Gu===TP||Gu==="parent"?Yp.parentNode:IP(Gu,[Yp])).contains(It)||lu.appendChild(It),_t.state.isMounted=!0,po()}},hide:function(){var ar=!_t.state.isVisible,Wr=_t.state.isDestroyed,bs=!_t.state.isEnabled,Or=XT(_t.props.duration,1,Vl.duration);if(!(ar||Wr||bs)&&(Cn("onHide",[_t],!1),_t.props.onHide(_t)!==!1)){if(_t.state.isVisible=!1,_t.state.isShown=!1,pt=!1,st=!1,on()&&(It.style.visibility="hidden"),gr(),Hr(),xn(!0),on()){var Us=un(),Gl=Us.box,lu=Us.content;_t.props.animation&&(ny([Gl,lu],Or),JT([Gl,lu],"hidden"))}Jn(),Kn(),_t.props.animation?on()&&function(Gu,Yp){Jr(Gu,function(){!_t.state.isVisible&&It.parentNode&&It.parentNode.contains(It)&&Yp()})}(Or,_t.unmount):_t.unmount()}},hideWithInteractivity:function(ar){cn().addEventListener("mousemove",At),KT(kP,At),At(ar)},enable:function(){_t.state.isEnabled=!0},disable:function(){_t.hide(),_t.state.isEnabled=!1},unmount:function(){_t.state.isVisible&&_t.hide(),_t.state.isMounted&&(eo(),Qs().forEach(function(ar){ar._tippy.unmount()}),It.parentNode&&It.parentNode.removeChild(It),jB=jB.filter(function(ar){return ar!==_t}),_t.state.isMounted=!1,Cn("onHidden",[_t]))},destroy:function(){_t.state.isDestroyed||(_t.clearDelayTimeouts(),_t.unmount(),Ss(),delete h._tippy,_t.state.isDestroyed=!0,Cn("onDestroy",[_t]))}};if(!rt.render)return _t;var Mt=rt.render(_t),It=Mt.popper,Bt=Mt.onUpdate;It.setAttribute("data-tippy-root",""),It.id="tippy-"+_t.id,_t.popper=It,h._tippy=_t,It._tippy=_t;var Lt=yt.map(function(ar){return ar.fn(_t)}),Ht=h.hasAttribute("aria-expanded");return Os(),Kn(),xn(),Cn("onCreate",[_t]),rt.showOnCreate&&Ws(),It.addEventListener("mouseenter",function(){_t.props.interactive&&_t.state.isVisible&&_t.clearDelayTimeouts()}),It.addEventListener("mouseleave",function(){_t.props.interactive&&_t.props.trigger.indexOf("mouseenter")>=0&&cn().addEventListener("mousemove",At)}),_t;function Jt(){var ar=_t.props.touch;return Array.isArray(ar)?ar:[ar,0]}function sn(){return Jt()[0]==="hold"}function on(){var ar;return!((ar=_t.props.render)==null||!ar.$$tippy)}function mn(){return et||h}function cn(){var ar,Wr,bs=mn().parentNode;return bs&&(Wr=Mw(bs)[0])!=null&&(ar=Wr.ownerDocument)!=null&&ar.body?Wr.ownerDocument:document}function un(){return FB(It)}function bn(ar){return _t.state.isMounted&&!_t.state.isVisible||zl.isTouch||c&&c.type==="focus"?0:XT(_t.props.delay,ar?0:1,Vl.delay)}function xn(ar){ar===void 0&&(ar=!1),It.style.pointerEvents=_t.props.interactive&&!ar?"":"none",It.style.zIndex=""+_t.props.zIndex}function Cn(ar,Wr,bs){var Or;bs===void 0&&(bs=!0),Lt.forEach(function(Us){Us[ar]&&Us[ar].apply(Us,Wr)}),bs&&(Or=_t.props)[ar].apply(Or,Wr)}function Jn(){var ar=_t.props.aria;if(ar.content){var Wr="aria-"+ar.content,bs=It.id;Mw(_t.props.triggerTarget||h).forEach(function(Or){var Us=Or.getAttribute(Wr);if(_t.state.isVisible)Or.setAttribute(Wr,Us?Us+" "+bs:bs);else{var Gl=Us&&Us.replace(bs,"").trim();Gl?Or.setAttribute(Wr,Gl):Or.removeAttribute(Wr)}})}}function Kn(){!Ht&&_t.props.aria.expanded&&Mw(_t.props.triggerTarget||h).forEach(function(ar){_t.props.interactive?ar.setAttribute("aria-expanded",_t.state.isVisible&&ar===mn()?"true":"false"):ar.removeAttribute("aria-expanded")})}function gr(){cn().removeEventListener("mousemove",At),kP=kP.filter(function(ar){return ar!==At})}function nr(ar){if(!zl.isTouch||!ct&&ar.type!=="mousedown"){var Wr=ar.composedPath&&ar.composedPath()[0]||ar.target;if(!_t.props.interactive||!YC(It,Wr)){if(Mw(_t.props.triggerTarget||h).some(function(bs){return YC(bs,Wr)})){if(zl.isTouch||_t.state.isVisible&&_t.props.trigger.indexOf("click")>=0)return}else Cn("onClickOutside",[_t,ar]);_t.props.hideOnClick===!0&&(_t.clearDelayTimeouts(),_t.hide(),at=!0,setTimeout(function(){at=!1}),_t.state.isMounted||Hr())}}}function tr(){ct=!0}function Cr(){ct=!1}function Ar(){var ar=cn();ar.addEventListener("mousedown",nr,!0),ar.addEventListener("touchend",nr,a0),ar.addEventListener("touchstart",Cr,a0),ar.addEventListener("touchmove",tr,a0)}function Hr(){var ar=cn();ar.removeEventListener("mousedown",nr,!0),ar.removeEventListener("touchend",nr,a0),ar.removeEventListener("touchstart",Cr,a0),ar.removeEventListener("touchmove",tr,a0)}function Jr(ar,Wr){var bs=un().box;function Or(Us){Us.target===bs&&(Tw(bs,"remove",Or),Wr())}if(ar===0)return Wr();Tw(bs,"remove",g),Tw(bs,"add",Or),g=Or}function cs(ar,Wr,bs){bs===void 0&&(bs=!1),Mw(_t.props.triggerTarget||h).forEach(function(Or){Or.addEventListener(ar,Wr,bs),gt.push({node:Or,eventType:ar,handler:Wr,options:bs})})}function Os(){var ar;sn()&&(cs("touchstart",Ts,{passive:!0}),cs("touchend",Pr,{passive:!0})),(ar=_t.props.trigger,ar.split(/\s+/).filter(Boolean)).forEach(function(Wr){if(Wr!=="manual")switch(cs(Wr,Ts),Wr){case"mouseenter":cs("mouseleave",Pr);break;case"focus":cs(RP?"focusout":"blur",qr);break;case"focusin":cs("focusout",qr)}})}function Ss(){gt.forEach(function(ar){var Wr=ar.node,bs=ar.eventType,Or=ar.handler,Us=ar.options;Wr.removeEventListener(bs,Or,Us)}),gt=[]}function Ts(ar){var Wr,bs=!1;if(_t.state.isEnabled&&!Xs(ar)&&!at){var Or=((Wr=c)==null?void 0:Wr.type)==="focus";c=ar,et=ar.currentTarget,Kn(),!_t.state.isVisible&&YT(ar,"MouseEvent")&&kP.forEach(function(Us){return Us(ar)}),ar.type==="click"&&(_t.props.trigger.indexOf("mouseenter")<0||st)&&_t.props.hideOnClick!==!1&&_t.state.isVisible?bs=!0:Ws(ar),ar.type==="click"&&(st=!bs),bs&&!Or&&_s(ar)}}function pr(ar){var Wr=ar.target,bs=mn().contains(Wr)||It.contains(Wr);if(ar.type!=="mousemove"||!bs){var Or=Qs().concat(It).map(function(Us){var Gl,lu=(Gl=Us._tippy.popperInstance)==null?void 0:Gl.state;return lu?{popperRect:Us.getBoundingClientRect(),popperState:lu,props:rt}:null}).filter(Boolean);(function(Us,Gl){var lu=Gl.clientX,Gu=Gl.clientY;return Us.every(function(Yp){var Am=Yp.popperRect,Op=Yp.popperState,Ks=Yp.props.interactiveBorder,vv=Op.placement.split("-")[0],Zw=Op.modifiersData.offset;if(!Zw)return!0;var In=vv==="bottom"?Zw.top.y:0,er=vv==="top"?Zw.bottom.y:0,dr=vv==="right"?Zw.left.x:0,Fr=vv==="left"?Zw.right.x:0,Xr=Am.top-Gu+In>Ks,fr=Gu-Am.bottom-er>Ks,zr=Am.left-lu+dr>Ks,Es=lu-Am.right-Fr>Ks;return Xr||fr||zr||Es})})(Or,ar)&&(gr(),_s(ar))}}function Pr(ar){Xs(ar)||_t.props.trigger.indexOf("click")>=0&&st||(_t.props.interactive?_t.hideWithInteractivity(ar):_s(ar))}function qr(ar){_t.props.trigger.indexOf("focusin")<0&&ar.target!==mn()||_t.props.interactive&&ar.relatedTarget&&It.contains(ar.relatedTarget)||_s(ar)}function Xs(ar){return!!zl.isTouch&&sn()!==ar.type.indexOf("touch")>=0}function po(){eo();var ar=_t.props,Wr=ar.popperOptions,bs=ar.placement,Or=ar.offset,Us=ar.getReferenceClientRect,Gl=ar.moveTransition,lu=on()?FB(It).arrow:null,Gu=Us?{getBoundingClientRect:Us,contextElement:Us.contextElement||mn()}:h,Yp=[{name:"offset",options:{offset:Or}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Gl}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Am){var Op=Am.state;if(on()){var Ks=un().box;["placement","reference-hidden","escaped"].forEach(function(vv){vv==="placement"?Ks.setAttribute("data-placement",Op.placement):Op.attributes.popper["data-popper-"+vv]?Ks.setAttribute("data-"+vv,""):Ks.removeAttribute("data-"+vv)}),Op.attributes.popper={}}}}];on()&&lu&&Yp.push({name:"arrow",options:{element:lu,padding:3}}),Yp.push.apply(Yp,(Wr==null?void 0:Wr.modifiers)||[]),_t.popperInstance=Uu(Gu,It,Object.assign({},Wr,{placement:bs,onFirstUpdate:b,modifiers:Yp}))}function eo(){_t.popperInstance&&(_t.popperInstance.destroy(),_t.popperInstance=null)}function Qs(){return XC(It.querySelectorAll("[data-tippy-root]"))}function Ws(ar){_t.clearDelayTimeouts(),ar&&Cn("onTrigger",[_t,ar]),Ar();var Wr=bn(!0),bs=Jt(),Or=bs[0],Us=bs[1];zl.isTouch&&Or==="hold"&&Us&&(Wr=Us),Wr?i=setTimeout(function(){_t.show()},Wr):_t.show()}function _s(ar){if(_t.clearDelayTimeouts(),Cn("onUntrigger",[_t,ar]),_t.state.isVisible){if(!(_t.props.trigger.indexOf("mouseenter")>=0&&_t.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(ar.type)>=0&&st)){var Wr=bn(!1);Wr?s=setTimeout(function(){_t.state.isVisible&&_t.hide()},Wr):o=requestAnimationFrame(function(){_t.hide()})}}else Hr()}}function KC(h,e){e===void 0&&(e={});var i=Vl.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",$T,a0),window.addEventListener("blur",C_);var s,o=Object.assign({},e,{plugins:i}),c=(s=h,Hv(s)?[s]:function(g){return YT(g,"NodeList")}(s)?XC(s):Array.isArray(s)?s:XC(document.querySelectorAll(s))).reduce(function(g,b){var et=b&&m4(b,o);return et&&g.push(et),g},[]);return Hv(h)?c[0]:c}KC.defaultProps=Vl,KC.setDefaultProps=function(h){Object.keys(h).forEach(function(e){Vl[e]=h[e]})},KC.currentInput=zl;var g4=Object.assign({},Ln,{effect:function(h){var e=h.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow)}}),v4=function(h,e){var i;e===void 0&&(e={});var s,o=h,c=[],g=[],b=e.overrides,et=[],tt=!1;function rt(){g=o.map(function(Bt){return Mw(Bt.props.triggerTarget||Bt.reference)}).reduce(function(Bt,Lt){return Bt.concat(Lt)},[])}function st(){c=o.map(function(Bt){return Bt.reference})}function at(Bt){o.forEach(function(Lt){Bt?Lt.enable():Lt.disable()})}function ct(Bt){return o.map(function(Lt){var Ht=Lt.setProps;return Lt.setProps=function(Jt){Ht(Jt),Lt.reference===s&&Bt.setProps(Jt)},function(){Lt.setProps=Ht}})}function pt(Bt,Lt){var Ht=g.indexOf(Lt);if(Lt!==s){s=Lt;var Jt=(b||[]).concat("content").reduce(function(sn,on){return sn[on]=o[Ht].props[on],sn},{});Bt.setProps(Object.assign({},Jt,{getReferenceClientRect:typeof Jt.getReferenceClientRect=="function"?Jt.getReferenceClientRect:function(){var sn;return(sn=c[Ht])==null?void 0:sn.getBoundingClientRect()}}))}}at(!1),st(),rt();var gt,At,xt,yt={fn:function(){return{onDestroy:function(){at(!0)},onHidden:function(){s=null},onClickOutside:function(Bt){Bt.props.showOnCreate&&!tt&&(tt=!0,s=null)},onShow:function(Bt){Bt.props.showOnCreate&&!tt&&(tt=!0,pt(Bt,c[0]))},onTrigger:function(Bt,Lt){pt(Bt,Lt.currentTarget)}}}},_t=KC(a1(),Object.assign({},(gt=e,At=["overrides"],xt=Object.assign({},gt),At.forEach(function(Bt){delete xt[Bt]}),xt),{plugins:[yt].concat(e.plugins||[]),triggerTarget:g,popperOptions:Object.assign({},e.popperOptions,{modifiers:[].concat(((i=e.popperOptions)==null?void 0:i.modifiers)||[],[g4])})})),Mt=_t.show;_t.show=function(Bt){if(Mt(),!s&&Bt==null)return pt(_t,c[0]);if(!s||Bt!=null){if(typeof Bt=="number")return c[Bt]&&pt(_t,c[Bt]);if(o.indexOf(Bt)>=0){var Lt=Bt.reference;return pt(_t,Lt)}return c.indexOf(Bt)>=0?pt(_t,Bt):void 0}},_t.showNext=function(){var Bt=c[0];if(!s)return _t.show(0);var Lt=c.indexOf(s);_t.show(c[Lt+1]||Bt)},_t.showPrevious=function(){var Bt=c[c.length-1];if(!s)return _t.show(Bt);var Lt=c.indexOf(s),Ht=c[Lt-1]||Bt;_t.show(Ht)};var It=_t.setProps;return _t.setProps=function(Bt){b=Bt.overrides||b,It(Bt)},_t.setInstances=function(Bt){at(!0),et.forEach(function(Lt){return Lt()}),o=Bt,at(!1),st(),rt(),et=ct(_t),_t.setProps({triggerTarget:g})},et=ct(_t),_t};KC.setDefaultProps({render:t3});var l1=KC;class uv{static _initialize(){this._inited=!0,(0,_e.createStyles)(_e.css`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&e.button===0&&this.Remove()})}static Create(e,i,s){this._inited||this._initialize(),this.Element&&this.Remove();const o=(0,_e.createDiv)({id:"customContextMenu",addToBody:!1});o.style.top=s+"px",o.style.left=i+"px";for(const[c,g]of Object.entries(e)){const b=(0,_e.createDiv)({classList:["customContextMenuItems"],addToBody:!1,innerHTML:c});o.appendChild(b),b.onclick=g}return this.Element=o,o}static Remove(){var e;(e=this.Element)==null||e.remove(),this.Element=void 0}}uv.Element=void 0,uv._inited=!1;class Iw extends En{async _refreshUi(){var e;if(!await super._refreshUi())return!1;gn.RemoveAll(Iw.PluginType);for(const i of this.variations)gn.Create(Iw.PluginType,i.title,5,20,0,i.materials.map(s=>{let o;if(i.preview.startsWith("generate:"))o=this._previewGenerator.generate(s,i.preview.split(":")[1]);else{const c=s[i.preview]||"#ff00ff";o=c.image?(0,_e.imageBitmapToBase64)(c.image,100):void 0,o||(o=(0,_e.makeColorSvgCircle)(c!=null&&c.isColor?c.getHexString():c))}return{id:s.uuid,image:o,onClick:c=>this.applyVariation(i,c),tooltip:s.name||s.uuid}}),(s,o)=>{l1(s,{placement:"bottom",content:o.tooltip}),s.oncontextmenu=c=>{c.preventDefault(),c.stopPropagation();const g=uv.Create({Remove:()=>{i.materials=i.materials.filter(b=>b.uuid!==o.id),this.refreshUi(),uv.Remove()}},c.clientX,c.clientY);document.body.appendChild(g)}});return gn.RebuildUi((e=this._viewer)==null?void 0:e.container),!0}}Iw.PluginType="MaterialConfiguratorPlugin";class zB extends hs{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._isVisibleChanged=!1,this.dependencies=[Lr],this.variations=[],this._selectedSwitchNode=()=>{var o;const e=(o=this._picking)==null?void 0:o.getSelectedObject();if(!e)return;const i=this.variations.map(c=>c.name);let s;return e.traverseAncestors(c=>{s||c.name&&i.includes(c.name)&&(s=c)}),s},this.uiConfig={label:"Switch Node",type:"folder",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"]},()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var i,s;await super.onAdded(e),this._picking=(i=this._viewer)==null?void 0:i.getPluginByType("Picking"),(s=this._picking)==null||s.addEventListener("selectedObjectChanged",()=>{var o,c;(c=(o=this.uiConfig).uiRefresh)==null||c.call(o)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer&&this.enabled){for(const o of this.variations){if(!o.name)continue;const c=this._viewer.scene.getObjectByName(o.name);if(!c||c.children.length<1)return;o.selected||(o.selected=c.children[0].name||c.children[0].uuid);for(const g of c.children)g.userData.__oldVisible=g.visible,g.visible=(g.name||g.uuid)===o.selected}this._isVisibleChanged=!0}}),e.addEventListener("postRender",()=>{if(this._viewer&&this._isVisibleChanged){for(const o of this.variations){if(!o.name)continue;const c=this._viewer.scene.getObjectByName(o.name);if(!c||c.children.length<1)return;for(const g of c.children){if(g.userData.__oldVisible===void 0)return;g.visible=g.userData.__oldVisible,delete g.userData.__oldVisible}}this._isVisibleChanged=!1}}),this.addEventListener("deserialize",async()=>{this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,i;return!!this.enabled&&!!this._viewer&&(this._uiNeedRefresh=!1,(i=(e=this.uiConfig).uiRefresh)==null||i.call(e),!0)}}(function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);c>3&&g&&Object.defineProperty(e,i,g)})([Mn()],zB.prototype,"variations",void 0);class Pw extends zB{_refreshUi(){var e;if(!super._refreshUi())return!1;gn.RemoveAll(Pw.PluginType);for(const i of this.variations){const s=this._viewer.scene.getObjectByName(i.name);s?(s.children.length<1&&console.warn("SwitchNode does not have enough children",i),gn.Create(Pw.PluginType,i.title,Math.min(5,s.children.length),20,0,s.children.map(o=>{const c=i.camView,g=new _.Pa4((c.includes("right")?1:0)-(c.includes("left")?1:0),(c.includes("top")?1:0)-(c.includes("bottom")?1:0),(c.includes("front")?1:0)-(c.includes("back")?1:0));i.camDistance||(i.camDistance=1);const b=qt(this._viewer,o,void 0,7,g.multiplyScalar(.5*i.camDistance));return{id:o.uuid,image:b,onClick:()=>{var et;i.selected=o.name||o.uuid,(et=this._viewer)==null||et.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:o.name||o.uuid}}),(o,c)=>l1(o,{placement:"bottom",content:c.tooltip}))):console.warn("no object found for variation, skipping",i)}return gn.RebuildUi((e=this._viewer)==null?void 0:e.container),!0}}Pw.PluginType="SwitchNodePlugin";class BP extends hs{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||i.call(e,"postFrame",!0))},this.dependencies=[Lr],this._selectedObject=()=>{var e;return((e=this._picking)==null?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())==null?void 0:e.material)||void 0}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)==null?void 0:i.getPluginByType("Picking"),this._previewGenerator=new $t(this._viewer),(s=this._picking)==null||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var i,s;return(i=this._previewGenerator)==null||i.dispose(),this._previewGenerator=void 0,(s=this._picking)==null||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}BP.PluginType="MaterialLibraryBasePlugin",function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);c>3&&g&&Object.defineProperty(e,i,g)}([Nr("Enabled")],BP.prototype,"enabled",void 0);class cA extends BP{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:np(),children:[...bv(this),()=>({type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(Lr).materials.getAllMaterials().map(e=>({label:e.name||e.uuid,value:e.uuid}))||[]]],getValue:()=>{var e;return(e=this._selectedMaterial())==null?void 0:e.uuid},setValue:e=>{var s,o,c,g,b;const i=(c=(o=(s=this._viewer)==null?void 0:s.getPlugin(Lr))==null?void 0:o.materials)==null?void 0:c.findMaterial(e);if(i)if(this.replaceMaterial)(b=(g=this._selectedObject())==null?void 0:g.setMaterial)==null||b.call(g,i);else{const et=this._selectedMaterial();if(et){const tt=et.name,rt=et.uuid;et.copyProps(i),et.name=tt,et.uuid=rt,et.userData.uuid&&(et.userData.uuid=rt)}}this._refreshUi()}})]}}async _refreshUi(){var o,c,g;if(!await super._refreshUi())return!1;const e=[Qu.TypeSlug,Ro.TypeSlug],i=(c=(o=this._viewer)==null?void 0:o.getPlugin(Lr))==null?void 0:c.materials,s=e.map(b=>[b,i==null?void 0:i.getMaterialsOfType(b)]);gn.RemoveAll(cA.PluginType);for(const[b,et]of s)gn.Create(cA.PluginType,b,5,20,0,et==null?void 0:et.filter(tt=>!tt.userData.__runtimeMaterial).map(tt=>{let rt;const st="generate:sphere";if(st.startsWith("generate:"))rt=this._previewGenerator.generate(tt,st.split(":")[1]);else{const at=tt[st]||"#ff00ff";rt=at.image?(0,_e.imageBitmapToBase64)(at.image,100):void 0,rt||(rt=(0,_e.makeColorSvg)(at))}return{id:tt.uuid,image:rt,onClick:at=>{const ct=i==null?void 0:i.findMaterial(at);if(ct){const pt=ct.userData.__appliedMeshes;if(pt!=null&&pt.size){const gt=pt.keys().next().value;gt.dispatchEvent({type:"select",value:gt})}}},tooltip:tt.name||tt.uuid}}),(tt,rt)=>l1(tt,{placement:"bottom",content:rt.tooltip}));return gn.RebuildUi((g=this._viewer)==null?void 0:g.container),!0}}cA.PluginType="MaterialLibraryPlugin",function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);c>3&&g&&Object.defineProperty(e,i,g)}([Nr("Replace Material")],cA.prototype,"replaceMaterial",void 0);class VB extends _.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,i){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",_e.glsl`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);c>3&&g&&Object.defineProperty(e,i,g)})([hr({propKey:"tLastThis"})],VB.prototype,"lastFrameTexture",void 0);var NE=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class Qv extends _e.SimpleEventDispatcher{get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}constructor(e){super(),this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.smoothShadow=!1,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this._bakeCounter=0,this.maxBakeCount=1/0,this.materialExtension={parsFragmentSnippet:(s,o)=>_e.glsl`
            uniform float transitionOpacity;
            `,extraUniforms:{transitionOpacity:{value:1}},shaderExtender:(s,o,c)=>{this.groundMapMode==="aoMap"?s.fragmentShader=rs(s.fragmentShader,"#include <aomap_fragment>",rs(_.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( mix(1., unpackRGBAToDepth(texture2D( aoMap, vAoMapUv ) ), transitionOpacity) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?s.fragmentShader=rs(s.fragmentShader,"#include <map_fragment>",rs(_.WdD.map_fragment,"diffuseColor *= texture2D( map, vMapUv );","float groundShadow = mix(1., unpackRGBAToDepth(texture2D( map, vMapUv )), transitionOpacity); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow) * transitionOpacity;")):this.groundMapMode==="alphaMap"&&(s.fragmentShader=rs(s.fragmentShader,"#include <alphamap_fragment>",rs(_.WdD.alphamap_fragment,"texture2D( alphaMap, vAlphaMapUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vAlphaMapUv ) )",{replaceAll:!0}))),s.fragmentShader=rs(s.fragmentShader,"#include <output_fragment>",_e.glsl`#include <output_fragment>
                #ifndef OPAQUE
                    #ifdef USE_AOMAP
                        #if NUM_DIR_LIGHT_SHADOWS > 0
                            // TODO find a better solution
                            float alphaMod = length(reflectedLight.directDiffuse)*4./float(NUM_DIR_LIGHT_SHADOWS);
                        #else
                            float alphaMod = 1.;
                        #endif
                        float t1 = 1. - ambientOcclusion;
                        float t2 = max(1. - alphaMod, 0.);
                        float t = t1 + t2;
                        gl_FragColor.a *= max(t, 0.);
                    #endif
                #endif
            `),this.alphaVignette&&c.capabilities.isWebGL2&&(s.defines.USE_UV="",s.fragmentShader=rs(s.fragmentShader,"#include <output_fragment>",_e.glsl`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV // why are we checking for this? this is always supposed to be true
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vAoMapUv.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(s,o)=>{o.materialObject.userData.gMapMode!==this.groundMapMode&&(o.materialObject.userData.gMapMode=this.groundMapMode,o.materialObject.needsUpdate=!0)},isCompatible:s=>s.isMeshStandardMaterial2},this._viewer=e;const i=new kx(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new _.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new _.Pa4(10,10,10),normalDirection:new _.Pa4(0,1,0)});i.shadow.camera.updateProjectionMatrix(),i.layers.disableAll(),i.layers.set(this._lightLayer),this._light=i,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new VB({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:_.jFi}),this._shadowBlurMat=new U_({uniforms:{colorTexture:{value:null},step:{value:.1},size:{value:new _.FM8(.5,.5)},direction:{value:new _.FM8(.5,.5)}},vertexShader:om,fragmentShader:`#include <packing>
uniform sampler2D colorTexture;uniform vec2 size;uniform vec2 direction;uniform float step;varying vec2 vUv;void main(){float sum=0.;vec2 uvDelta=step*direction/size;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv-1.*uvDelta))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vec2(vUv.x,vUv.y)))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv+1.*uvDelta))*0.3333;gl_FragColor=packDepthToRGBA(sum);}`})}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,i,s;(i=(e=this.materialExtension)==null?void 0:e.setDirty)==null||i.call(e),(s=this._viewer)==null||s.setDirty()}fromJSON(e,i){return Oo(e,this,!0,i),this.reset(),this}reset(){this._frameNumber=0}get frameNumber(){return this._frameNumber}autoUpdateShadow(){return!(!this.shadowAutoUpdate||this._bakeCounter>=this.maxBakeCount||!this.updateShadow()||(this._frameNumber===this.maxFrameNumber?this.dispatchEvent({type:"shadowBaked",bakeCount:++this._bakeCounter}):this._frameNumber>0&&this._frameNumber<this.maxFrameNumber&&this.dispatchEvent({type:"shadowBaking",progress:this._frameNumber/this.maxFrameNumber,bakeCount:this._bakeCounter}),0))}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(!e||++this._frameNumber>this.maxFrameNumber)return!1;const i=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:_.ywz,depthBuffer:!1,size:new _.FM8(i,i),sizeMultiplier:void 0,colorSpace:_.aCh,format:_.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const s=this._viewer.renderer.rendererObject,o=s.shadowMap,c=o.type,g=o.needsUpdate,b=o.autoUpdate;o.type=_._MY,o.needsUpdate=!0,o.autoUpdate=!1;const et=this._viewer.scene,tt=new _.S9g;tt.disableAll(),et.modelObject.traverse(pt=>{pt.isLight&&pt!==this._light.lightObject&&(pt.userData.__gp_layers=pt.layers,pt.layers=tt)});const rt=et.activeCamera.cameraObject;if(rt.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";rt.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),no(s,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(et)),rt.layers.disable(this._lightLayer);const st=rt.layers.mask;rt.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const at=this._viewer.renderer.getTempTarget({type:_.ywz,depthBuffer:!1,size:new _.FM8(i,i),colorSpace:_.aCh,format:_.wk1}),ct=at.texture.colorSpace;at.texture.colorSpace=_.aCh,this._viewer.renderer.blit(this._target.texture,at,{clear:!0});{const pt=e.material,gt=e.frustumCulled,At=s.getRenderTarget(),xt=s.getActiveCubeFace(),yt=s.getActiveMipmapLevel();e.material=this._shadowMat,e.frustumCulled=!1,s.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=at.texture,this._shadowMat.needsUpdate=!0,no(s,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(et)),s.setRenderTarget(At,xt,yt),e.frustumCulled=gt,e.material=pt,this.smoothShadow&&this._applySmoothFilter(this._target,at)}return at.texture.colorSpace=ct,this._viewer.renderer.releaseTempTarget(at),e.layers.disable(this._lightLayer),rt.layers.mask=st,et.modelObject.traverse(pt=>{pt.isLight&&pt!==this._light.lightObject&&(pt.layers=pt.userData.__gp_layers,delete pt.userData.__gp_layers)}),o.type=c,o.needsUpdate=g,o.autoUpdate=b,e.castShadow=!0,(this._frameNumber<3||this._frameNumber>Math.min(100,this.maxFrameNumber)&&this._frameNumber%4==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var i,s,o;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((i=this._target)==null?void 0:i.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((s=this._target)==null?void 0:s.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((o=this._target)==null?void 0:o.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.01,this._attachedMesh.material.needsUpdate=!0))}_applySmoothFilter(e,i){this._shadowBlurMat.uniforms.colorTexture.value=e.texture,this._shadowBlurMat.uniforms.direction.value.set(1,0),this._shadowBlurMat.uniforms.size.value.set(e.width,e.height),this._viewer.renderer.blit(void 0,i,{material:this._shadowBlurMat}),this._shadowBlurMat.uniforms.colorTexture.value=i.texture,this._shadowBlurMat.uniforms.direction.value.set(0,1),this._shadowBlurMat.uniforms.size.value.set(i.width,i.height),this._viewer.renderer.blit(void 0,e,{material:this._shadowBlurMat})}}NE([Mn("randomizedLight")],Qv.prototype,"_light",void 0),NE([(0,_e.onChange)(Qv.prototype.reset),Mn()],Qv.prototype,"maxFrameNumber",void 0),NE([(0,_e.onChange)(Qv.prototype.reset),Mn()],Qv.prototype,"smoothShadow",void 0),NE([(0,_e.onChange)(Qv.prototype._groundMapModeChanged),Mn()],Qv.prototype,"groundMapMode",void 0),NE([Mn(),(0,_e.onChange)(Qv.prototype._alphaVignetteChanged)],Qv.prototype,"alphaVignette",void 0),NE([Mn(),(0,_e.onChange)(Qv.prototype._alphaVignetteChanged)],Qv.prototype,"alphaVignetteAxis",void 0),NE([Mn()],Qv.prototype,"maxBakeCount",void 0);var n3=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class UE extends _.Kj0{_updateExtension(){var e,i;this.transparentReflectionBackground=this.reflectorModePhysical,(i=(e=this.materialExtension)==null?void 0:e.setDirty)==null||i.call(e)}constructor(e,i,s=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new _.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},extraDefines:{USE_UV:""},updaters:[],shaderExtender:(At,xt,yt)=>{if(this.enabled){At.vertexShader=rs(At.vertexShader,"void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const _t="#glMarker beforeModulation";At.fragmentShader=rs(At.fragmentShader,_t,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+_t)}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?v2+`
`+m_+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:At=>this.enabled+" "+At.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(At,{materialObject:xt})=>{xt.userData.__lastTransparent!==xt.transparent&&(xt.needsUpdate=!0,xt.userData.__lastTransparent=xt.transparent)},isCompatible:At=>At.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=i;const o=new _.JOQ,c=new _.Pa4,g=new _.Pa4,b=new _.Pa4,et=new _.yGw,tt=new _.Pa4(0,0,-1),rt=new _.Ltg,st=new _.Pa4,at=new _.Pa4,ct=new _.Ltg,pt=new _.yGw,gt=new _.cPb;_.M8C.isPowerOfTwo(i.texture.image.width)&&_.M8C.isPowerOfTwo(i.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(At,xt,yt)=>{if(!this.enabled||!At.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const _t=yt.view?Object.assign({},yt.view):null;if(_t&&yt.clearViewOffset&&yt.clearViewOffset(),g.setFromMatrixPosition(this.matrixWorld),b.setFromMatrixPosition(yt.matrixWorld),et.extractRotation(this.matrixWorld),c.set(0,0,1),c.applyMatrix4(et),st.subVectors(g,b),st.dot(c)>0)return;st.reflect(c).negate(),st.add(g),et.extractRotation(yt.matrixWorld),tt.set(0,0,-1),tt.applyMatrix4(et),tt.add(b),at.subVectors(g,tt),at.reflect(c).negate(),at.add(g),gt.position.copy(st),gt.up.set(0,1,0),gt.up.applyMatrix4(et),gt.up.reflect(c),gt.lookAt(at),gt.far=2,gt.near=0,gt.updateMatrixWorld(),gt.projectionMatrix.copy(yt.projectionMatrix),pt.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),pt.multiply(gt.projectionMatrix),pt.multiply(gt.matrixWorldInverse),pt.multiply(this.matrixWorld),o.setFromNormalAndCoplanarPoint(c,g),o.applyMatrix4(gt.matrixWorldInverse),rt.set(o.normal.x,o.normal.y,o.normal.z,o.constant);const Mt=gt.projectionMatrix;ct.x=(Math.sign(rt.x)+Mt.elements[8])/Mt.elements[0],ct.y=(Math.sign(rt.y)+Mt.elements[9])/Mt.elements[5],ct.z=-1,ct.w=(1+Mt.elements[10])/Mt.elements[14],rt.multiplyScalar(2/rt.dot(ct)),Mt.elements[2]=rt.x,Mt.elements[6]=rt.y,Mt.elements[10]=rt.z+1-s,Mt.elements[14]=rt.w,this.visible=!1;const It=At.getRenderTarget(),Bt=At.xr.enabled,Lt=At.shadowMap.autoUpdate;At.xr.enabled=!1,At.shadowMap.autoUpdate=!1,At.setRenderTarget(this._renderTarget),At.state.buffers.depth.setMask(!0),At.autoClear===!1&&At.clear();const Ht=xt.background;this.transparentReflectionBackground&&(xt.background=null);const Jt=!this.transparentReflectionBackground;Ht!=null&&Ht.isTexture&&Jt&&(Ht.userData||(Ht.userData={}),Ht.userData.flipX=!Ht.userData.flipX),no(At,{shadowMapRender:!1,backgroundRender:Jt,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>At.render(xt,gt)),Ht!=null&&Ht.isTexture&&Jt&&(Ht.userData.flipX=!Ht.userData.flipX||void 0),this.transparentReflectionBackground&&(xt.background=Ht),At.xr.enabled=Bt,At.shadowMap.autoUpdate=Lt,At.setRenderTarget(It),_t!=null&&_t.enabled&&yt.setViewOffset&&yt.setViewOffset(_t.fullWidth,_t.fullHeight,_t.offsetX,_t.offsetY,_t.width,_t.height);const sn=yt.viewport;sn!==void 0&&At.state.viewport(sn),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=pt,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new _.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=pt}getRenderTarget(){return this._renderTarget}}n3([(0,_e.onChange)(UE.prototype._updateExtension)],UE.prototype,"enabled",void 0),n3([(0,_e.onChange)(UE.prototype._updateExtension)],UE.prototype,"reflectorModePhysical",void 0),UE.prototype.isReflector=!0;var FE=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class Vm extends hs{get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[Lr],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this.enableRefreshTransform=!0,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new _._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get autoAdjustTransform(){return this._options.autoAdjustTransform}set autoAdjustTransform(e){this._options.autoAdjustTransform=e,this.refreshTransform()}_createMesh(){return new _.Kj0(this._geometry)}async onAdded(e){var s,o;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(Lr);const i=this._createMesh();i.userData.physicsMass=0,this._iMesh=await((s=this._manager)==null?void 0:s.addImportedSingle(i,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(o=this._iMesh)==null?void 0:o.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var i,s,o;return this._removeMaterial(),this._geometry.dispose(),(i=this._material)==null||i.dispose(),(o=(s=this._iMesh)==null?void 0:s.dispose)==null||o.call(s),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){this._material&&(this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){(e==null?void 0:e.geometryChanged)!==!1&&(e==null?void 0:e.updateGround)!==!1&&this.refreshTransform()}refreshTransform(){this.enableRefreshTransform&&(this._transformNeedRefresh=!0)}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var i;const e=(i=this._viewer)==null?void 0:i.scene.activeCamera.controls;e&&(e.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=e.maxPolarAngle),e.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(e.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var i,s,o;if(!this._mesh||!this._viewer)return;let e=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,e=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const c=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const g=c.getCenter(new _.Pa4).sub(new _.Pa4(0,c.getSize(new _.Pa4).y/2+this.yOffset,0));e=e||g.clone().sub(this._mesh.position).length()>1e-4,e&&this._mesh.position.copy(g)}e=e||Math.abs(this._mesh.scale.x-this.size)>1e-4,e&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new _.USm(-Math.PI/2,0,this._mesh.rotation.z)),this._mesh.matrixWorldNeedsUpdate=!0,(s=(i=this._mesh).setDirty)==null||s.call(i)),this._transformNeedRefresh=!1}else e&&((o=this._viewer)==null||o.scene.setDirty())}_refreshMaterial(){var s,o,c,g;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const e=this._material??((o=(s=this._manager)==null?void 0:s.materials)==null?void 0:o.findOrCreate("standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215}));let i=!1;return e!==this._material&&(this._removeMaterial(),e&&(this._material=e),(c=this._material)!=null&&c.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,(((g=this._mesh)==null?void 0:g.setMaterial)??(et=>{this._mesh&&(this._mesh.material=et.materialObject)}))(this._material)),i=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),i}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,i){return super.fromJSON(e,i)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)==null?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},{label:"Auto adjust transform",type:"checkbox",property:[this,"autoAdjustTransform"]},...this._extraUiConfig()]}}}FE([Mn("material")],Vm.prototype,"_material",void 0),FE([(0,_e.onChange)(Vm.prototype.refreshTransform),Mn()],Vm.prototype,"visible",void 0),FE([(0,_e.onChange2)(Vm.prototype._onSceneUpdate),Mn()],Vm.prototype,"size",void 0),FE([(0,_e.onChange2)(Vm.prototype._onSceneUpdate),Mn()],Vm.prototype,"yOffset",void 0),FE([(0,_e.onChange)(Vm.prototype._refreshOptions2),Mn()],Vm.prototype,"renderToDepth",void 0),FE([(0,_e.onChange)(Vm.prototype._refreshOptions2),Mn()],Vm.prototype,"tonemapGround",void 0),FE([(0,_e.onChange)(Vm.prototype._refreshCameraLimits),Mn()],Vm.prototype,"limitCameraAboveGround",void 0);var OP=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class Wv extends Vm{get shadowBaker(){return this._shadowBaker}bakeShadows(){var e;(e=this._shadowBaker)==null||e.reset()}constructor(e={},i=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this.autoBakeShadows=!0,this._showDebug=i,i&&this.dependencies.push($0),this._onSceneUpdate=this._onSceneUpdate.bind(this)}_createMesh(){const e=new UE(this._geometry,this._viewer.renderer.createTarget({type:_.ywz,format:_.wk1,colorSpace:_.aCh,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:_.D1R,magFilter:_.wem})),i=e.onBeforeRender;return e.onBeforeRender=(...s)=>{var g,b,et,tt,rt;let o=(b=(g=this._viewer)==null?void 0:g.getPluginByType("SSReflection"))==null?void 0:b.passes.ssr.passObject;o&&!o.enabled&&(o=void 0),o&&(o.enabled=!1);let c=(rt=(tt=(et=this._viewer)==null?void 0:et.getPluginByType("SSBevelPlugin"))==null?void 0:tt.pass)==null?void 0:rt.passObject;c&&!c.enabled&&(c=void 0),c&&(c.enabled=!1),i(...s),o&&(o.enabled=!0),c&&(c.enabled=!0)},e}async onAdded(e){var i,s;await super.onAdded(e),this._showDebug&&((i=e.getPlugin($0))==null||i.addTexture("bake_ground_1",()=>{var o,c;return(c=(o=this._shadowBaker)==null?void 0:o.light.shadow.map)==null?void 0:c.texture},[100,100,200,200]),(s=e.getPlugin($0))==null||s.addTexture("bake_ground_2",()=>{var o,c;return(c=(o=this._shadowBaker)==null?void 0:o.target)==null?void 0:c.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){super._postFrame(),this._viewer&&this.enabled&&this._shadowBaker&&this.bakedShadows&&this._shadowBaker.autoUpdateShadow()}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,i,s,o;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((i=(e=this._material).unregisterMaterialExtensions)==null||i.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const c=this._mesh.materialExtension;c||console.warn("unable to find the extension to unregister"),(o=(s=this._material).unregisterMaterialExtensions)==null||o.call(s,[c]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var i;super._onSceneUpdate(e),e.geometryChanged!==!1&&this.autoBakeShadows&&((i=this._shadowBaker)==null||i.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new Qv(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var i,s,o,c;if(!this._viewer)return!1;const e=super._refreshMaterial();if(!this._material)return e;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const g=this._mesh.materialExtension;g.updaters=[this._viewer.scene,this._viewer.renderer],(s=(i=this._material).registerMaterialExtensions)==null||s.call(i,[g]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((c=(o=this._material).registerMaterialExtensions)==null||c.call(o,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),e}_extraUiConfig(){var e,i,s,o,c,g,b,et,tt,rt,st,at,ct,pt,gt,At,xt,yt,_t,Mt,It,Bt,Lt,Ht,Jt,sn,on,mn,cn,un;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var bn,xn;return(xn=(bn=this._uiConfig)==null?void 0:bn.uiRefresh)==null?void 0:xn.call(bn,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var bn;return!((bn=this._shadowBaker)!=null&&bn.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(bn=>({label:bn,value:bn})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{label:"Smooth Shadow",type:"checkbox",property:[this._shadowBaker,"smoothShadow"],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)==null?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(i=this._shadowBaker)==null?void 0:i.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(o=(s=this._shadowBaker)==null?void 0:s.light)==null?void 0:o.shadowParams,"enabled"],onChange:[(g=(c=this._shadowBaker)==null?void 0:c.light)==null?void 0:g.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(et=(b=this._shadowBaker)==null?void 0:b.light)==null?void 0:et.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(rt=(tt=this._shadowBaker)==null?void 0:tt.light)==null?void 0:rt.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(at=(st=this._shadowBaker)==null?void 0:st.light)==null?void 0:at.randomParams,"distanceScale"],onChange:[(pt=(ct=this._shadowBaker)==null?void 0:ct.light)==null?void 0:pt.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(At=(gt=this._shadowBaker)==null?void 0:gt.light)==null?void 0:At.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(yt=(xt=this._shadowBaker)==null?void 0:xt.light)==null?void 0:yt.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(Mt=(_t=this._shadowBaker)==null?void 0:_t.light)==null?void 0:Mt.shadowParams,"radius"],onChange:[(Bt=(It=this._shadowBaker)==null?void 0:It.light)==null?void 0:Bt.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(Ht=(Lt=this._shadowBaker)==null?void 0:Lt.light)==null?void 0:Ht.shadowParams,"frustumSize"],onChange:[(sn=(Jt=this._shadowBaker)==null?void 0:Jt.light)==null?void 0:sn.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(mn=(on=this._shadowBaker)==null?void 0:on.light)==null?void 0:mn.shadowParams,"bias"],onChange:[(un=(cn=this._shadowBaker)==null?void 0:cn.light)==null?void 0:un.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}Wv.PluginType="Ground",OP([(0,_e.onChange)(Wv.prototype.refreshOptions),Mn()],Wv.prototype,"bakedShadows",void 0),OP([(0,_e.onChange)(Wv.prototype.refreshOptions),Mn()],Wv.prototype,"groundReflection",void 0),OP([(0,_e.onChange)(Wv.prototype.refreshOptions),Mn()],Wv.prototype,"physicalReflections",void 0),OP([Mn("shadowBaker")],Wv.prototype,"_shadowBaker",void 0);class _4 extends _.yxD{constructor(e){super(e),this.type=_.cLu}parse(e){const It=Math.pow(2.7182818,2.2),Bt={l:0,c:0,lc:0};function Lt(In,er,dr,Fr,Xr){for(;dr<In;)er=er<<8|Ws(Fr,Xr),dr+=8;dr-=In,Bt.l=er>>dr&(1<<In)-1,Bt.c=er,Bt.lc=dr}const Ht=new Array(59);function Jt(In){return 63&In}function sn(In){return In>>6}const on={c:0,lc:0};function mn(In,er,dr,Fr){In=In<<8|Ws(dr,Fr),er+=8,on.c=In,on.lc=er}const cn={c:0,lc:0};function un(In,er,dr,Fr,Xr,fr,zr,Es,Fs){if(In==er){Fr<8&&(mn(dr,Fr,Xr,fr),dr=on.c,Fr=on.lc);let Vs=dr>>(Fr-=8);if(Vs=new Uint8Array([Vs])[0],Es.value+Vs>Fs)return!1;const Ls=zr[Es.value-1];for(;Vs-- >0;)zr[Es.value++]=Ls}else{if(!(Es.value<Fs))return!1;zr[Es.value++]=In}cn.c=dr,cn.lc=Fr}function bn(In){return 65535&In}function xn(In){const er=bn(In);return er>32767?er-65536:er}const Cn={a:0,b:0};function Jn(In,er){const dr=xn(In),Fr=xn(er),Xr=dr+(1&Fr)+(Fr>>1),fr=Xr,zr=Xr-Fr;Cn.a=fr,Cn.b=zr}function Kn(In,er){const dr=bn(In),Fr=bn(er),Xr=dr-(Fr>>1)&65535,fr=Fr+Xr-32768&65535;Cn.a=fr,Cn.b=Xr}function gr(In,er,dr,Fr,Xr,fr,zr){const Es=zr<16384,Fs=dr>Xr?Xr:dr;let Vs,Ls,so=1;for(;so<=Fs;)so<<=1;for(so>>=1,Vs=so,so>>=1;so>=1;){Ls=0;const Cs=Ls+fr*(Xr-Vs),ws=fr*so,to=fr*Vs,os=Fr*so,ks=Fr*Vs;let Ns,co,cu,Ol;for(;Ls<=Cs;Ls+=to){let Ds=Ls;const uo=Ls+Fr*(dr-Vs);for(;Ds<=uo;Ds+=ks){const Io=Ds+os,Lp=Ds+ws,t_=Lp+os;Es?(Jn(In[Ds+er],In[Lp+er]),Ns=Cn.a,cu=Cn.b,Jn(In[Io+er],In[t_+er]),co=Cn.a,Ol=Cn.b,Jn(Ns,co),In[Ds+er]=Cn.a,In[Io+er]=Cn.b,Jn(cu,Ol),In[Lp+er]=Cn.a,In[t_+er]=Cn.b):(Kn(In[Ds+er],In[Lp+er]),Ns=Cn.a,cu=Cn.b,Kn(In[Io+er],In[t_+er]),co=Cn.a,Ol=Cn.b,Kn(Ns,co),In[Ds+er]=Cn.a,In[Io+er]=Cn.b,Kn(cu,Ol),In[Lp+er]=Cn.a,In[t_+er]=Cn.b)}if(dr&so){const Io=Ds+ws;Es?Jn(In[Ds+er],In[Io+er]):Kn(In[Ds+er],In[Io+er]),Ns=Cn.a,In[Io+er]=Cn.b,In[Ds+er]=Ns}}if(Xr&so){let Ds=Ls;const uo=Ls+Fr*(dr-Vs);for(;Ds<=uo;Ds+=ks){const Io=Ds+os;Es?Jn(In[Ds+er],In[Io+er]):Kn(In[Ds+er],In[Io+er]),Ns=Cn.a,In[Io+er]=Cn.b,In[Ds+er]=Ns}}Vs=so,so>>=1}return Ls}function nr(In,er,dr,Fr,Xr,fr){const zr=dr.value,Es=Qs(er,dr),Fs=Qs(er,dr);dr.value+=4;const Vs=Qs(er,dr);if(dr.value+=4,Es<0||Es>=65537||Fs<0||Fs>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Ls=new Array(65537),so=new Array(16384);if(function(Cs){for(let ws=0;ws<16384;ws++)Cs[ws]={},Cs[ws].len=0,Cs[ws].lit=0,Cs[ws].p=null}(so),function(Cs,ws,to,os,ks,Ns){const co=ws;let cu=0,Ol=0;for(;os<=ks;os++){if(co.value-ws.value>to)return!1;Lt(6,cu,Ol,Cs,co);const Ds=Bt.l;if(cu=Bt.c,Ol=Bt.lc,Ns[os]=Ds,Ds==63){if(co.value-ws.value>to)throw new Error("Something wrong with hufUnpackEncTable");Lt(8,cu,Ol,Cs,co);let uo=Bt.l+6;if(cu=Bt.c,Ol=Bt.lc,os+uo>ks+1)throw new Error("Something wrong with hufUnpackEncTable");for(;uo--;)Ns[os++]=0;os--}else if(Ds>=59){let uo=Ds-59+2;if(os+uo>ks+1)throw new Error("Something wrong with hufUnpackEncTable");for(;uo--;)Ns[os++]=0;os--}}(function(Ds){for(let Io=0;Io<=58;++Io)Ht[Io]=0;for(let Io=0;Io<65537;++Io)Ht[Ds[Io]]+=1;let uo=0;for(let Io=58;Io>0;--Io){const Lp=uo+Ht[Io]>>1;Ht[Io]=uo,uo=Lp}for(let Io=0;Io<65537;++Io){const Lp=Ds[Io];Lp>0&&(Ds[Io]=Lp|Ht[Lp]++<<6)}})(Ns)}(In,dr,Fr-(dr.value-zr),Es,Fs,Ls),Vs>8*(Fr-(dr.value-zr)))throw new Error("Something wrong with hufUncompress");(function(Cs,ws,to,os){for(;ws<=to;ws++){const ks=sn(Cs[ws]),Ns=Jt(Cs[ws]);if(ks>>Ns)throw new Error("Invalid table entry");if(Ns>14){const co=os[ks>>Ns-14];if(co.len)throw new Error("Invalid table entry");if(co.lit++,co.p){const cu=co.p;co.p=new Array(co.lit);for(let Ol=0;Ol<co.lit-1;++Ol)co.p[Ol]=cu[Ol]}else co.p=new Array(1);co.p[co.lit-1]=ws}else if(Ns){let co=0;for(let cu=1<<14-Ns;cu>0;cu--){const Ol=os[(ks<<14-Ns)+co];if(Ol.len||Ol.p)throw new Error("Invalid table entry");Ol.len=Ns,Ol.lit=ws,co++}}}})(Ls,Es,Fs,so),function(Cs,ws,to,os,ks,Ns,co,cu,Ol){let Ds=0,uo=0;const Io=co,Lp=Math.trunc(os.value+(ks+7)/8);for(;os.value<Lp;)for(mn(Ds,uo,to,os),Ds=on.c,uo=on.lc;uo>=14;){const Kp=ws[Ds>>uo-14&16383];if(Kp.len)uo-=Kp.len,un(Kp.lit,Ns,Ds,uo,to,os,cu,Ol,Io),Ds=cn.c,uo=cn.lc;else{if(!Kp.p)throw new Error("hufDecode issues");let ex;for(ex=0;ex<Kp.lit;ex++){const MS=Jt(Cs[Kp.p[ex]]);for(;uo<MS&&os.value<Lp;)mn(Ds,uo,to,os),Ds=on.c,uo=on.lc;if(uo>=MS&&sn(Cs[Kp.p[ex]])==(Ds>>uo-MS&(1<<MS)-1)){uo-=MS,un(Kp.p[ex],Ns,Ds,uo,to,os,cu,Ol,Io),Ds=cn.c,uo=cn.lc;break}}if(ex==Kp.lit)throw new Error("hufDecode issues")}}const t_=8-ks&7;for(Ds>>=t_,uo-=t_;uo>0;){const Kp=ws[Ds<<14-uo&16383];if(!Kp.len)throw new Error("hufDecode issues");uo-=Kp.len,un(Kp.lit,Ns,Ds,uo,to,os,cu,Ol,Io),Ds=cn.c,uo=cn.lc}}(Ls,so,In,dr,Vs,Fs,fr,Xr,{value:0})}function tr(In){for(let er=1;er<In.length;er++){const dr=In[er-1]+In[er]-128;In[er]=dr}}function Cr(In,er){let dr=0,Fr=Math.floor((In.length+1)/2),Xr=0;const fr=In.length-1;for(;!(Xr>fr||(er[Xr++]=In[dr++],Xr>fr));)er[Xr++]=In[Fr++]}function Ar(In){let er=In.byteLength;const dr=new Array;let Fr=0;const Xr=new DataView(In);for(;er>0;){const fr=Xr.getInt8(Fr++);if(fr<0){const zr=-fr;er-=zr+1;for(let Es=0;Es<zr;Es++)dr.push(Xr.getUint8(Fr++))}else{const zr=fr;er-=2;const Es=Xr.getUint8(Fr++);for(let Fs=0;Fs<zr+1;Fs++)dr.push(Es)}}return dr}function Hr(In,er,dr){let Fr,Xr=1;for(;Xr<64;)Fr=er[In.value],Fr==65280?Xr=64:Fr>>8==255?Xr+=255&Fr:(dr[Xr]=Fr,Xr++),In.value++}function Jr(In){const er=.5*Math.cos(.7853975),dr=.5*Math.cos(3.14159/16),Fr=.5*Math.cos(3.14159/8),Xr=.5*Math.cos(3*3.14159/16),fr=.5*Math.cos(.981746875),zr=.5*Math.cos(3*3.14159/8),Es=.5*Math.cos(1.374445625),Fs=new Array(4),Vs=new Array(4),Ls=new Array(4),so=new Array(4);for(let Cs=0;Cs<8;++Cs){const ws=8*Cs;Fs[0]=Fr*In[ws+2],Fs[1]=zr*In[ws+2],Fs[2]=Fr*In[ws+6],Fs[3]=zr*In[ws+6],Vs[0]=dr*In[ws+1]+Xr*In[ws+3]+fr*In[ws+5]+Es*In[ws+7],Vs[1]=Xr*In[ws+1]-Es*In[ws+3]-dr*In[ws+5]-fr*In[ws+7],Vs[2]=fr*In[ws+1]-dr*In[ws+3]+Es*In[ws+5]+Xr*In[ws+7],Vs[3]=Es*In[ws+1]-fr*In[ws+3]+Xr*In[ws+5]-dr*In[ws+7],Ls[0]=er*(In[ws+0]+In[ws+4]),Ls[3]=er*(In[ws+0]-In[ws+4]),Ls[1]=Fs[0]+Fs[3],Ls[2]=Fs[1]-Fs[2],so[0]=Ls[0]+Ls[1],so[1]=Ls[3]+Ls[2],so[2]=Ls[3]-Ls[2],so[3]=Ls[0]-Ls[1],In[ws+0]=so[0]+Vs[0],In[ws+1]=so[1]+Vs[1],In[ws+2]=so[2]+Vs[2],In[ws+3]=so[3]+Vs[3],In[ws+4]=so[3]-Vs[3],In[ws+5]=so[2]-Vs[2],In[ws+6]=so[1]-Vs[1],In[ws+7]=so[0]-Vs[0]}for(let Cs=0;Cs<8;++Cs)Fs[0]=Fr*In[16+Cs],Fs[1]=zr*In[16+Cs],Fs[2]=Fr*In[48+Cs],Fs[3]=zr*In[48+Cs],Vs[0]=dr*In[8+Cs]+Xr*In[24+Cs]+fr*In[40+Cs]+Es*In[56+Cs],Vs[1]=Xr*In[8+Cs]-Es*In[24+Cs]-dr*In[40+Cs]-fr*In[56+Cs],Vs[2]=fr*In[8+Cs]-dr*In[24+Cs]+Es*In[40+Cs]+Xr*In[56+Cs],Vs[3]=Es*In[8+Cs]-fr*In[24+Cs]+Xr*In[40+Cs]-dr*In[56+Cs],Ls[0]=er*(In[Cs]+In[32+Cs]),Ls[3]=er*(In[Cs]-In[32+Cs]),Ls[1]=Fs[0]+Fs[3],Ls[2]=Fs[1]-Fs[2],so[0]=Ls[0]+Ls[1],so[1]=Ls[3]+Ls[2],so[2]=Ls[3]-Ls[2],so[3]=Ls[0]-Ls[1],In[0+Cs]=so[0]+Vs[0],In[8+Cs]=so[1]+Vs[1],In[16+Cs]=so[2]+Vs[2],In[24+Cs]=so[3]+Vs[3],In[32+Cs]=so[3]-Vs[3],In[40+Cs]=so[2]-Vs[2],In[48+Cs]=so[1]-Vs[1],In[56+Cs]=so[0]-Vs[0]}function cs(In){for(let er=0;er<64;++er){const dr=In[0][er],Fr=In[1][er],Xr=In[2][er];In[0][er]=dr+1.5747*Xr,In[1][er]=dr-.1873*Fr-.4682*Xr,In[2][er]=dr+1.8556*Fr}}function Os(In,er,dr){for(let Xr=0;Xr<64;++Xr)er[dr+Xr]=_.A5E.toHalfFloat((Fr=In[Xr])<=1?Math.sign(Fr)*Math.pow(Math.abs(Fr),2.2):Math.sign(Fr)*Math.pow(It,Math.abs(Fr)-1));var Fr}function Ss(In){return new DataView(In.array.buffer,In.offset.value,In.size)}function Ts(In){const er=In.viewer.buffer.slice(In.offset.value,In.offset.value+In.size),dr=new Uint8Array(Ar(er)),Fr=new Uint8Array(dr.length);return tr(dr),Cr(dr,Fr),new DataView(Fr.buffer)}function pr(In){const er=RE(In.array.slice(In.offset.value,In.offset.value+In.size)),dr=new Uint8Array(er.length);return tr(er),Cr(er,dr),new DataView(dr.buffer)}function Pr(In){const er=In.viewer,dr={value:In.offset.value},Fr=new Uint16Array(In.width*In.scanlineBlockSize*(In.channels*In.type)),Xr=new Uint8Array(8192);let fr=0;const zr=new Array(In.channels);for(let to=0;to<In.channels;to++)zr[to]={},zr[to].start=fr,zr[to].end=zr[to].start,zr[to].nx=In.width,zr[to].ny=In.lines,zr[to].size=In.type,fr+=zr[to].nx*zr[to].ny*zr[to].size;const Es=Us(er,dr),Fs=Us(er,dr);if(Fs>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Es<=Fs)for(let to=0;to<Fs-Es+1;to++)Xr[to+Es]=_s(er,dr);const Vs=new Uint16Array(65536),Ls=function(to,os){let ks=0;for(let co=0;co<65536;++co)(co==0||to[co>>3]&1<<(7&co))&&(os[ks++]=co);const Ns=ks-1;for(;ks<65536;)os[ks++]=0;return Ns}(Xr,Vs),so=Qs(er,dr);nr(In.array,er,dr,so,Fr,fr);for(let to=0;to<In.channels;++to){const os=zr[to];for(let ks=0;ks<zr[to].size;++ks)gr(Fr,os.start+ks,os.nx,os.size,os.ny,os.nx*os.size,Ls)}(function(to,os,ks){for(let Ns=0;Ns<ks;++Ns)os[Ns]=to[os[Ns]]})(Vs,Fr,fr);let Cs=0;const ws=new Uint8Array(Fr.buffer.byteLength);for(let to=0;to<In.lines;to++)for(let os=0;os<In.channels;os++){const ks=zr[os],Ns=ks.nx*ks.size,co=new Uint8Array(Fr.buffer,ks.end*2,Ns*2);ws.set(co,Cs),Cs+=Ns*2,ks.end+=Ns}return new DataView(ws.buffer)}function qr(In){const er=RE(In.array.slice(In.offset.value,In.offset.value+In.size)),dr=In.lines*In.channels*In.width,Fr=In.type==1?new Uint16Array(dr):new Uint32Array(dr);let Xr=0,fr=0;const zr=new Array(4);for(let Es=0;Es<In.lines;Es++)for(let Fs=0;Fs<In.channels;Fs++){let Vs=0;switch(In.type){case 1:zr[0]=Xr,zr[1]=zr[0]+In.width,Xr=zr[1]+In.width;for(let Ls=0;Ls<In.width;++Ls)Vs+=er[zr[0]++]<<8|er[zr[1]++],Fr[fr]=Vs,fr++;break;case 2:zr[0]=Xr,zr[1]=zr[0]+In.width,zr[2]=zr[1]+In.width,Xr=zr[2]+In.width;for(let Ls=0;Ls<In.width;++Ls)Vs+=er[zr[0]++]<<24|er[zr[1]++]<<16|er[zr[2]++]<<8,Fr[fr]=Vs,fr++}}return new DataView(Fr.buffer)}function Xs(In){const er=In.viewer,dr={value:In.offset.value},Fr=new Uint8Array(In.width*In.lines*(In.channels*In.type*2)),Xr={version:ar(er,dr),unknownUncompressedSize:ar(er,dr),unknownCompressedSize:ar(er,dr),acCompressedSize:ar(er,dr),dcCompressedSize:ar(er,dr),rleCompressedSize:ar(er,dr),rleUncompressedSize:ar(er,dr),rleRawSize:ar(er,dr),totalAcUncompressedCount:ar(er,dr),totalDcUncompressedCount:ar(er,dr),acCompression:ar(er,dr)};if(Xr.version<2)throw new Error("EXRLoader.parse: "+Op.compression+" version "+Xr.version+" is unsupported");const fr=new Array;let zr=Us(er,dr)-2;for(;zr>0;){const os=po(er.buffer,dr),ks=_s(er,dr),Ns=ks>>2&3,co=new Int8Array([(ks>>4)-1])[0],cu=_s(er,dr);fr.push({name:os,index:co,type:cu,compression:Ns}),zr-=os.length+3}const Es=Op.channels,Fs=new Array(In.channels);for(let os=0;os<In.channels;++os){const ks=Fs[os]={},Ns=Es[os];ks.name=Ns.name,ks.compression=0,ks.decoded=!1,ks.type=Ns.pixelType,ks.pLinear=Ns.pLinear,ks.width=In.width,ks.height=In.lines}const Vs={idx:new Array(3)};for(let os=0;os<In.channels;++os){const ks=Fs[os];for(let Ns=0;Ns<fr.length;++Ns){const co=fr[Ns];ks.name==co.name&&(ks.compression=co.compression,co.index>=0&&(Vs.idx[co.index]=os),ks.offset=os)}}let Ls,so,Cs;if(Xr.acCompressedSize>0)switch(Xr.acCompression){case 0:Ls=new Uint16Array(Xr.totalAcUncompressedCount),nr(In.array,er,dr,Xr.acCompressedSize,Ls,Xr.totalAcUncompressedCount);break;case 1:const os=RE(In.array.slice(dr.value,dr.value+Xr.totalAcUncompressedCount));Ls=new Uint16Array(os.buffer),dr.value+=Xr.totalAcUncompressedCount}if(Xr.dcCompressedSize>0){const os={array:In.array,offset:dr,size:Xr.dcCompressedSize};so=new Uint16Array(pr(os).buffer),dr.value+=Xr.dcCompressedSize}Xr.rleRawSize>0&&(Cs=Ar(RE(In.array.slice(dr.value,dr.value+Xr.rleCompressedSize)).buffer),dr.value+=Xr.rleCompressedSize);let ws=0;const to=new Array(Fs.length);for(let os=0;os<to.length;++os)to[os]=new Array;for(let os=0;os<In.lines;++os)for(let ks=0;ks<Fs.length;++ks)to[ks].push(ws),ws+=Fs[ks].width*In.type*2;(function(os,ks,Ns,co,cu,Ol){let Ds=new DataView(Ol.buffer);const uo=Ns[os.idx[0]].width,Io=Ns[os.idx[0]].height,Lp=Math.floor(uo/8),t_=Math.ceil(uo/8),Kp=Math.ceil(Io/8),ex=uo-8*(t_-1),MS=Io-8*(Kp-1),bH={value:0},$L=new Array(3),a2=new Array(3),l2=new Array(3),fy=new Array(3),GD=new Array(3);for(let uu=0;uu<3;++uu)GD[uu]=ks[os.idx[uu]],$L[uu]=uu<1?0:$L[uu-1]+t_*Kp,a2[uu]=new Float32Array(64),l2[uu]=new Uint16Array(64),fy[uu]=new Uint16Array(64*t_);for(let uu=0;uu<Kp;++uu){let LM=8;uu==Kp-1&&(LM=MS);let NM=8;for(let Sl=0;Sl<t_;++Sl){Sl==t_-1&&(NM=ex);for(let Zl=0;Zl<3;++Zl)l2[Zl].fill(0),l2[Zl][0]=cu[$L[Zl]++],Hr(bH,co,l2[Zl]),As=l2[Zl],(xs=a2[Zl])[0]=Or(As[0]),xs[1]=Or(As[1]),xs[2]=Or(As[5]),xs[3]=Or(As[6]),xs[4]=Or(As[14]),xs[5]=Or(As[15]),xs[6]=Or(As[27]),xs[7]=Or(As[28]),xs[8]=Or(As[2]),xs[9]=Or(As[4]),xs[10]=Or(As[7]),xs[11]=Or(As[13]),xs[12]=Or(As[16]),xs[13]=Or(As[26]),xs[14]=Or(As[29]),xs[15]=Or(As[42]),xs[16]=Or(As[3]),xs[17]=Or(As[8]),xs[18]=Or(As[12]),xs[19]=Or(As[17]),xs[20]=Or(As[25]),xs[21]=Or(As[30]),xs[22]=Or(As[41]),xs[23]=Or(As[43]),xs[24]=Or(As[9]),xs[25]=Or(As[11]),xs[26]=Or(As[18]),xs[27]=Or(As[24]),xs[28]=Or(As[31]),xs[29]=Or(As[40]),xs[30]=Or(As[44]),xs[31]=Or(As[53]),xs[32]=Or(As[10]),xs[33]=Or(As[19]),xs[34]=Or(As[23]),xs[35]=Or(As[32]),xs[36]=Or(As[39]),xs[37]=Or(As[45]),xs[38]=Or(As[52]),xs[39]=Or(As[54]),xs[40]=Or(As[20]),xs[41]=Or(As[22]),xs[42]=Or(As[33]),xs[43]=Or(As[38]),xs[44]=Or(As[46]),xs[45]=Or(As[51]),xs[46]=Or(As[55]),xs[47]=Or(As[60]),xs[48]=Or(As[21]),xs[49]=Or(As[34]),xs[50]=Or(As[37]),xs[51]=Or(As[47]),xs[52]=Or(As[50]),xs[53]=Or(As[56]),xs[54]=Or(As[59]),xs[55]=Or(As[61]),xs[56]=Or(As[35]),xs[57]=Or(As[36]),xs[58]=Or(As[48]),xs[59]=Or(As[49]),xs[60]=Or(As[57]),xs[61]=Or(As[58]),xs[62]=Or(As[62]),xs[63]=Or(As[63]),Jr(a2[Zl]);cs(a2);for(let Zl=0;Zl<3;++Zl)Os(a2[Zl],fy[Zl],64*Sl)}let B_=0;for(let Sl=0;Sl<3;++Sl){const Zl=Ns[os.idx[Sl]].type;for(let tx=8*uu;tx<8*uu+LM;++tx){B_=GD[Sl][tx];for(let c2=0;c2<Lp;++c2){const RA=64*c2+8*(7&tx);Ds.setUint16(B_+0*2*Zl,fy[Sl][RA+0],!0),Ds.setUint16(B_+1*2*Zl,fy[Sl][RA+1],!0),Ds.setUint16(B_+2*2*Zl,fy[Sl][RA+2],!0),Ds.setUint16(B_+3*2*Zl,fy[Sl][RA+3],!0),Ds.setUint16(B_+4*2*Zl,fy[Sl][RA+4],!0),Ds.setUint16(B_+5*2*Zl,fy[Sl][RA+5],!0),Ds.setUint16(B_+6*2*Zl,fy[Sl][RA+6],!0),Ds.setUint16(B_+7*2*Zl,fy[Sl][RA+7],!0),B_+=8*2*Zl}}if(Lp!=t_)for(let tx=8*uu;tx<8*uu+LM;++tx){const c2=GD[Sl][tx]+8*Lp*2*Zl,RA=64*Lp+8*(7&tx);for(let HD=0;HD<NM;++HD)Ds.setUint16(c2+HD*2*Zl,fy[Sl][RA+HD],!0)}}}var As,xs;const d4=new Uint16Array(uo);Ds=new DataView(Ol.buffer);for(let uu=0;uu<3;++uu){Ns[os.idx[uu]].decoded=!0;const LM=Ns[os.idx[uu]].type;if(Ns[uu].type==2)for(let NM=0;NM<Io;++NM){const B_=GD[uu][NM];for(let Sl=0;Sl<uo;++Sl)d4[Sl]=Ds.getUint16(B_+Sl*2*LM,!0);for(let Sl=0;Sl<uo;++Sl)Ds.setFloat32(B_+Sl*2*LM,Or(d4[Sl]),!0)}}})(Vs,to,Fs,Ls,so,Fr);for(let os=0;os<Fs.length;++os){const ks=Fs[os];if(!ks.decoded){if(ks.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let Ns=0,co=0;for(let cu=0;cu<In.lines;++cu){let Ol=to[os][Ns];for(let Ds=0;Ds<ks.width;++Ds){for(let uo=0;uo<2*ks.type;++uo)Fr[Ol++]=Cs[co+uo*ks.width*ks.height];co++}Ns++}}}}return new DataView(Fr.buffer)}function po(In,er){const dr=new Uint8Array(In);let Fr=0;for(;dr[er.value+Fr]!=0;)Fr+=1;const Xr=new TextDecoder().decode(dr.slice(er.value,er.value+Fr));return er.value=er.value+Fr+1,Xr}function eo(In,er){const dr=In.getInt32(er.value,!0);return er.value=er.value+4,dr}function Qs(In,er){const dr=In.getUint32(er.value,!0);return er.value=er.value+4,dr}function Ws(In,er){const dr=In[er.value];return er.value=er.value+1,dr}function _s(In,er){const dr=In.getUint8(er.value);return er.value=er.value+1,dr}const ar=function(In,er){let dr;return dr="getBigInt64"in DataView.prototype?Number(In.getBigInt64(er.value,!0)):In.getUint32(er.value+4,!0)+Number(In.getUint32(er.value,!0)<<32),er.value+=8,dr};function Wr(In,er){const dr=In.getFloat32(er.value,!0);return er.value+=4,dr}function bs(In,er){return _.A5E.toHalfFloat(Wr(In,er))}function Or(In){const er=(31744&In)>>10,dr=1023&In;return(In>>15?-1:1)*(er?er===31?dr?NaN:1/0:Math.pow(2,er-15)*(1+dr/1024):dr/1024*6103515625e-14)}function Us(In,er){const dr=In.getUint16(er.value,!0);return er.value+=2,dr}function Gl(In,er){return Or(Us(In,er))}function lu(In,er,dr,Fr,Xr){return Fr==="string"||Fr==="stringvector"||Fr==="iccProfile"?function(fr,zr,Es){const Fs=new TextDecoder().decode(new Uint8Array(fr).slice(zr.value,zr.value+Es));return zr.value=zr.value+Es,Fs}(er,dr,Xr):Fr==="chlist"?function(fr,zr,Es,Fs){const Vs=Es.value,Ls=[];for(;Es.value<Vs+Fs-1;){const so=po(zr,Es),Cs=eo(fr,Es),ws=_s(fr,Es);Es.value+=3;const to=eo(fr,Es),os=eo(fr,Es);Ls.push({name:so,pixelType:Cs,pLinear:ws,xSampling:to,ySampling:os})}return Es.value+=1,Ls}(In,er,dr,Xr):Fr==="chromaticities"?function(fr,zr){return{redX:Wr(fr,zr),redY:Wr(fr,zr),greenX:Wr(fr,zr),greenY:Wr(fr,zr),blueX:Wr(fr,zr),blueY:Wr(fr,zr),whiteX:Wr(fr,zr),whiteY:Wr(fr,zr)}}(In,dr):Fr==="compression"?function(fr,zr){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][_s(fr,zr)]}(In,dr):Fr==="box2i"?function(fr,zr){return{xMin:Qs(fr,zr),yMin:Qs(fr,zr),xMax:Qs(fr,zr),yMax:Qs(fr,zr)}}(In,dr):Fr==="lineOrder"?function(fr,zr){return["INCREASING_Y"][_s(fr,zr)]}(In,dr):Fr==="float"?Wr(In,dr):Fr==="v2f"?function(fr,zr){return[Wr(fr,zr),Wr(fr,zr)]}(In,dr):Fr==="v3f"?function(fr,zr){return[Wr(fr,zr),Wr(fr,zr),Wr(fr,zr)]}(In,dr):Fr==="int"?eo(In,dr):Fr==="rational"?function(fr,zr){return[eo(fr,zr),Qs(fr,zr)]}(In,dr):Fr==="timecode"?function(fr,zr){return[Qs(fr,zr),Qs(fr,zr)]}(In,dr):Fr==="preview"?(dr.value+=Xr,"skipped"):void(dr.value+=Xr)}const Gu=new DataView(e),Yp=new Uint8Array(e),Am={value:0},Op=function(In,er,dr){const Fr={};if(In.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");Fr.version=In.getUint8(4);const Xr=In.getUint8(5);Fr.spec={singleTile:!!(2&Xr),longName:!!(4&Xr),deepFormat:!!(8&Xr),multiPart:!!(16&Xr)},dr.value=8;let fr=!0;for(;fr;){const zr=po(er,dr);if(zr==0)fr=!1;else{const Es=po(er,dr),Fs=lu(In,er,dr,Es,Qs(In,dr));Fs===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Es}'.`):Fr[zr]=Fs}}if(-5&Xr)throw console.error("EXRHeader:",Fr),new Error("THREE.EXRLoader: provided file is currently unsupported.");return Fr}(Gu,e,Am),Ks=function(In,er,dr,Fr,Xr){const fr={size:0,viewer:er,array:dr,offset:Fr,width:In.dataWindow.xMax-In.dataWindow.xMin+1,height:In.dataWindow.yMax-In.dataWindow.yMin+1,channels:In.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:In.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:_.GUF};switch(In.compression){case"NO_COMPRESSION":fr.lines=1,fr.uncompress=Ss;break;case"RLE_COMPRESSION":fr.lines=1,fr.uncompress=Ts;break;case"ZIPS_COMPRESSION":fr.lines=1,fr.uncompress=pr;break;case"ZIP_COMPRESSION":fr.lines=16,fr.uncompress=pr;break;case"PIZ_COMPRESSION":fr.lines=32,fr.uncompress=Pr;break;case"PXR24_COMPRESSION":fr.lines=16,fr.uncompress=qr;break;case"DWAA_COMPRESSION":fr.lines=32,fr.uncompress=Xs;break;case"DWAB_COMPRESSION":fr.lines=256,fr.uncompress=Xs;break;default:throw new Error("EXRLoader.parse: "+In.compression+" is unsupported")}if(fr.scanlineBlockSize=fr.lines,fr.type==1)switch(Xr){case _.VzW:fr.getter=Gl,fr.inputSize=2;break;case _.cLu:fr.getter=Us,fr.inputSize=2}else{if(fr.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+fr.type+" for "+In.compression+".");switch(Xr){case _.VzW:fr.getter=Wr,fr.inputSize=4;break;case _.cLu:fr.getter=bs,fr.inputSize=4}}fr.blockCount=(In.dataWindow.yMax+1)/fr.scanlineBlockSize;for(let Es=0;Es<fr.blockCount;Es++)ar(er,Fr);fr.outputChannels=fr.channels==3?4:fr.channels;const zr=fr.width*fr.height*fr.outputChannels;switch(Xr){case _.VzW:fr.byteArray=new Float32Array(zr),fr.channels<fr.outputChannels&&fr.byteArray.fill(1,0,zr);break;case _.cLu:fr.byteArray=new Uint16Array(zr),fr.channels<fr.outputChannels&&fr.byteArray.fill(15360,0,zr);break;default:console.error("THREE.EXRLoader: unsupported type: ",Xr)}return fr.bytesPerLine=fr.width*fr.inputSize*fr.channels,fr.outputChannels==4?(fr.format=_.wk1,fr.colorSpace=_.GUF):(fr.format=_.hEm,fr.colorSpace=_.aCh),fr}(Op,Gu,Yp,Am,this.type),vv={value:0},Zw={R:0,G:1,B:2,A:3,Y:0};for(let In=0;In<Ks.height/Ks.scanlineBlockSize;In++){const er=Qs(Gu,Am);Ks.size=Qs(Gu,Am),Ks.lines=er+Ks.scanlineBlockSize>Ks.height?Ks.height-er:Ks.scanlineBlockSize;const dr=Ks.size<Ks.lines*Ks.bytesPerLine?Ks.uncompress(Ks):Ss(Ks);Am.value+=Ks.size;for(let Fr=0;Fr<Ks.scanlineBlockSize;Fr++){const Xr=Fr+In*Ks.scanlineBlockSize;if(Xr>=Ks.height)break;for(let fr=0;fr<Ks.channels;fr++){const zr=Zw[Op.channels[fr].name];for(let Es=0;Es<Ks.width;Es++){vv.value=(Fr*(Ks.channels*Ks.width)+fr*Ks.width+Es)*Ks.inputSize;const Fs=(Ks.height-1-Xr)*(Ks.width*Ks.outputChannels)+Es*Ks.outputChannels+zr;Ks.byteArray[Fs]=Ks.getter(dr,vv)}}}}return{header:Op,width:Ks.width,height:Ks.height,data:Ks.byteArray,format:Ks.format,colorSpace:Ks.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,i,s,o){return super.load(e,function(c,g){c.colorSpace=g.colorSpace,c.minFilter=_.wem,c.magFilter=_.wem,c.generateMipmaps=!1,c.flipY=!1,i&&i(c,g)},s,o)}}class GB extends _e.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Lr]}async onAdded(e){var i,s;this._importer||(this._importer=new yl(class extends _4{constructor(o){super(o),this.setDataType(B0(e.renderer.rendererObject))}},["exr"],!1)),(s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var i,s;this._importer&&((s=(i=e.getManager())==null?void 0:i.importer)!=null&&s.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}GB.PluginType="EXRLoadPlugin";const HB=new WeakMap;class y4 extends _.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,s,o){const c=new _.hH6(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),this.url=e,c.load(e,g=>{if(HB.has(g))return HB.get(g).promise.then(i).catch(o);this.decodeObjects(g,e).then(b=>{b.userData.warnings=this.warnings,this.warnings=[],i(b)}).catch(b=>o(b))},s,o)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,i){let s,o;const c=e.byteLength,g=this._getWorker(c).then(b=>(s=b,o=this.workerNextTaskID++,new Promise((et,tt)=>{s._callbacks[o]={resolve:et,reject:tt},s.postMessage({type:"decode",id:o,buffer:e},[e])}))).then(b=>this._createGeometry(b.data)).catch(b=>{throw b});return g.catch(()=>!0).then(()=>{s&&o&&this._releaseTask(s,o)}),HB.set(e,{url:i,promise:g}),g}parse(e,i,s){this.decodeObjects(e,"").then(o=>{o.userData.warnings=this.warnings,i(o)}).catch(o=>s(o))}_compareMaterials(e){if(this.materials.includes(e))return e;const i={};i.name=e.name,i.color={},i.color.r=e.color.r,i.color.g=e.color.g,i.color.b=e.color.b,i.type=e.type;const s=JSON.stringify(i);for(let o=0;o<this.materials.length;o++){const c=this.materials[o],g={};if(g.name=c.name,g.color={},g.color.r=c.color.r,g.color.g=c.color.g,g.color.b=c.color.b,g.type=c.type,JSON.stringify(g)===s)return c}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new _.Wid({color:new _.Ilk(1,1,1),metalness:.8,name:"default",side:_.ehD});const i=e.diffuseColor,s=new _.Ilk(i.r/255,i.g/255,i.b/255);i.r===0&&i.g===0&&i.b===0&&(s.r=1,s.g=1,s.b=1);const o=new _.Wid({color:s,name:e.name,side:_.ehD,transparent:e.transparency>0,opacity:1-e.transparency}),c=new _.dpR;for(let g=0;g<e.textures.length;g++){const b=e.textures[g];if(b.image!==null){const et=c.load(b.image);switch(b.type){case"Diffuse":o.map=et;break;case"Bump":o.bumpMap=et;break;case"Transparency":o.alphaMap=et,o.transparent=!0;break;case"Emap":o.envMap=et}et.wrapS=b.wrapU===0?_.rpg:_.uWy,et.wrapT=b.wrapV===0?_.rpg:_.uWy,et.repeat.set(b.repeat[0],b.repeat[1])}}return o}_createGeometry(e){const i=new _.Tme,s=[],o=[],c=[];i.userData.layers=e.layers,i.userData.groups=e.groups,i.userData.settings=e.settings,i.userData.strings=e.strings,i.userData.objectType="File3dm",i.userData.materials=null,i.name=this.url;let g=e.objects;const b=e.materials;for(let et=0;et<g.length;et++){const tt=g[et],rt=tt.attributes;switch(tt.objectType){case"InstanceDefinition":o.push(tt);break;case"InstanceReference":c.push(tt);break;default:let st;if(rt.materialIndex>=0){const ct=b[rt.materialIndex];let pt=this._createMaterial(ct);pt=this._compareMaterials(pt),st=this._createObject(tt,pt)}else{const ct=this._createMaterial();st=this._createObject(tt,ct)}if(st===void 0)continue;const at=e.layers[rt.layerIndex];st.visible=!at||at.visible,rt.isInstanceDefinitionObject?s.push(st):i.add(st)}}for(let et=0;et<o.length;et++){const tt=o[et];g=[];for(let rt=0;rt<tt.attributes.objectIds.length;rt++){const st=tt.attributes.objectIds[rt];for(let at=0;at<s.length;at++)st===s[at].userData.attributes.id&&g.push(s[at])}for(let rt=0;rt<c.length;rt++){const st=c[rt];if(st.geometry.parentIdefId===tt.attributes.id){const at=st.geometry.xform.array,ct=new _.yGw;if(ct.set(...at),g.length===1){const pt=g[0].clone(!0);if(pt.name=st.attributes.name||pt.name,pt.applyMatrix4(ct),st.attributes.materialIndex>=0&&st.attributes.materialIndex!==g[0].userData.attributes.materialIndex){const gt=b[st.attributes.materialIndex],At=this._createMaterial(gt);pt.material=this._compareMaterials(At)}if(pt.userData.defAttributes=pt.userData.attributes,pt.userData.defObjectType=pt.userData.objectType,pt.userData.attributes={...pt.userData.attributes,...st.attributes},pt.userData.objectType=st.objectType,st.attributes.layerIndex!==void 0){const gt=e.layers[st.attributes.layerIndex];pt.visible=gt?gt.visible:pt.visible}i.add(pt)}else{console.warn("THREE.Rhino3dmLoader: InstanceReference with multiple/no objects, not all properties will be copied.");const pt=new _.Tme;pt.applyMatrix4(ct);for(let gt=0;gt<g.length;gt++)pt.add(g[gt].clone(!0));i.add(pt)}}}}return i.userData.materials=this.materials,i}_createObject(e,i){const s=new _.s4_,o=e.attributes;let c,g,b,et;switch(e.objectType){case"Point":case"PointSet":c=s.parse(e.geometry),c.attributes.hasOwnProperty("color")?g=new _.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(b=o.drawColor,et=new _.Ilk(b.r/255,b.g/255,b.b/255),g=new _.UY4({color:et,sizeAttenuation:!1,size:2})),g=this._compareMaterials(g);const tt=new _.woe(c,g);return tt.userData.attributes=o,tt.userData.objectType=e.objectType,o.name&&(tt.name=o.name),tt;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;c=s.parse(e.geometry),c.attributes.hasOwnProperty("color")&&(i.vertexColors=!0),i===null&&(i=this._createMaterial(),i=this._compareMaterials(i));const rt=new _.Kj0(c,i);return rt.castShadow=o.castsShadows,rt.receiveShadow=o.receivesShadows,rt.userData.attributes=o,rt.userData.objectType=e.objectType,o.name&&(rt.name=o.name,c.name=o.name),rt;case"Curve":c=s.parse(e.geometry),b=o.drawColor,et=new _.Ilk(b.r/255,b.g/255,b.b/255),g=new _.nls({color:et}),g=this._compareMaterials(g);const st=new _.x12(c,g);return st.userData.attributes=o,st.userData.objectType=e.objectType,o.name&&(st.name=o.name),st;case"TextDot":c=e.geometry;const at=document.createElement("canvas").getContext("2d"),ct=`${c.fontHeight}px ${c.fontFace}`;at.font=ct;const pt=at.measureText(c.text).width+10,gt=c.fontHeight+10,At=window.devicePixelRatio;at.canvas.width=pt*At,at.canvas.height=gt*At,at.canvas.style.width=pt+"px",at.canvas.style.height=gt+"px",at.setTransform(At,0,0,At,0,0),at.font=ct,at.textBaseline="middle",at.textAlign="center",et=o.drawColor,at.fillStyle=`rgba(${et.r},${et.g},${et.b},${et.a})`,at.fillRect(0,0,pt,gt),at.fillStyle="white",at.fillText(c.text,pt/2,gt/2);const xt=new _.ROQ(at.canvas);xt.minFilter=_.wem,xt.wrapS=_.uWy,xt.wrapT=_.uWy,g=new _.xeV({map:xt,depthTest:!1});const yt=new _.jyi(g);return yt.position.set(c.point[0],c.point[1],c.point[2]),yt.scale.set(pt/10,gt/10,1),yt.userData.attributes=o,yt.userData.objectType=e.objectType,o.name&&(yt.name=o.name),yt;case"Light":let _t;switch(c=e.geometry,c.lightStyle.name){case"LightStyle_WorldPoint":_t=new _.cek,_t.castShadow=o.castsShadows,_t.position.set(c.location[0],c.location[1],c.location[2]),_t.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":_t=new _.PMe,_t.castShadow=o.castsShadows,_t.position.set(c.location[0],c.location[1],c.location[2]),_t.target.position.set(c.direction[0],c.direction[1],c.direction[2]),_t.angle=c.spotAngleRadians,_t.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":_t=new _.T_f;const Mt=Math.abs(c.width[2]),It=Math.abs(c.length[0]);_t.position.set(c.location[0]-It/2,c.location[1],c.location[2]-Mt/2),_t.height=It,_t.width=Mt,_t.lookAt(c.direction[0],c.direction[1],c.direction[2]);break;case"LightStyle_WorldDirectional":_t=new _.Ox3,_t.castShadow=o.castsShadows,_t.position.set(c.location[0],c.location[1],c.location[2]),_t.target.position.set(c.direction[0],c.direction[1],c.direction[2]),_t.shadow.normalBias=.1}return _t&&(_t.intensity=c.intensity,b=c.diffuse,et=new _.Ilk(b.r/255,b.g/255,b.b/255),_t.color=et,_t.userData.attributes=o,_t.userData.objectType=e.objectType),_t}}_initLibrary(){if(!this.libraryPending){const e=new _.hH6(this.manager);e.setPath(this.libraryPath);const i=new Promise((c,g)=>{e.load("rhino3dm.js",c,void 0,g)}),s=new _.hH6(this.manager);s.setPath(this.libraryPath),s.setResponseType("arraybuffer");const o=new Promise((c,g)=>{s.load("rhino3dm.wasm",c,void 0,g)});this.libraryPending=Promise.all([i,o]).then(([c,g])=>{this.libraryConfig.wasmBinary=g;const b=A4,et=["/* rhino3dm.js */",c,"/* worker */",b.substring(b.indexOf("{")+1,b.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([et]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",libraryConfig:this.libraryConfig}),s.onmessage=o=>{const c=o.data;switch(c.type){case"warning":this.warnings.push(c.data),console.warn(c.data);break;case"decode":s._callbacks[c.id].resolve(c);break;case"error":s._callbacks[c.id].reject(c);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+c.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,o){return s._taskLoad>o._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskLoad+=e,i})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}const A4=`
function Rhino3dmWorker() {

	let libraryPending;
	let libraryConfig;
	let rhino;
	let taskID;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':

				// console.log(message)
				libraryConfig = message.libraryConfig;
				const wasmBinary = libraryConfig.wasmBinary;
				let RhinoModule;
				libraryPending = new Promise( function ( resolve ) {

					/* Like Basis Loader */
					RhinoModule = { wasmBinary, onRuntimeInitialized: resolve };

					rhino3dm( RhinoModule ); // eslint-disable-line no-undef

				 } ).then( () => {

					rhino = RhinoModule;

				 } );

				break;

			case 'decode':

				taskID = message.id;
				const buffer = message.buffer;
				libraryPending.then( () => {

					try {

						const data = decodeObjects( rhino, buffer );
						self.postMessage( { type: 'decode', id: message.id, data } );

					} catch ( error ) {

						self.postMessage( { type: 'error', id: message.id, error } );

					}

				} );

				break;

		}

	};

	function decodeObjects( rhino, buffer ) {

		const arr = new Uint8Array( buffer );
		const doc = rhino.File3dm.fromByteArray( arr );

		const objects = [];
		const materials = [];
		const layers = [];
		const views = [];
		const namedViews = [];
		const groups = [];
		const strings = [];

		//Handle objects

		const objs = doc.objects();
		const cnt = objs.count;

		for ( let i = 0; i < cnt; i ++ ) {

			const _object = objs.get( i );

			const object = extractObjectData( _object, doc );

			_object.delete();

			if ( object ) {

				objects.push( object );

			}

		}

		// Handle instance definitions
		// console.log( \`Instance Definitions Count: \${doc.instanceDefinitions().count()}\` );

		for ( let i = 0; i < doc.instanceDefinitions().count(); i ++ ) {

			const idef = doc.instanceDefinitions().get( i );
			const idefAttributes = extractProperties( idef );
			idefAttributes.objectIds = idef.getObjectIds();

			objects.push( { geometry: null, attributes: idefAttributes, objectType: 'InstanceDefinition' } );

		}

		// Handle materials

		const textureTypes = [
			// rhino.TextureType.Bitmap,
			rhino.TextureType.Diffuse,
			rhino.TextureType.Bump,
			rhino.TextureType.Transparency,
			rhino.TextureType.Opacity,
			rhino.TextureType.Emap
		];

		const pbrTextureTypes = [
			rhino.TextureType.PBR_BaseColor,
			rhino.TextureType.PBR_Subsurface,
			rhino.TextureType.PBR_SubsurfaceScattering,
			rhino.TextureType.PBR_SubsurfaceScatteringRadius,
			rhino.TextureType.PBR_Metallic,
			rhino.TextureType.PBR_Specular,
			rhino.TextureType.PBR_SpecularTint,
			rhino.TextureType.PBR_Roughness,
			rhino.TextureType.PBR_Anisotropic,
			rhino.TextureType.PBR_Anisotropic_Rotation,
			rhino.TextureType.PBR_Sheen,
			rhino.TextureType.PBR_SheenTint,
			rhino.TextureType.PBR_Clearcoat,
			rhino.TextureType.PBR_ClearcoatBump,
			rhino.TextureType.PBR_ClearcoatRoughness,
			rhino.TextureType.PBR_OpacityIor,
			rhino.TextureType.PBR_OpacityRoughness,
			rhino.TextureType.PBR_Emission,
			rhino.TextureType.PBR_AmbientOcclusion,
			rhino.TextureType.PBR_Displacement
		];

		for ( let i = 0; i < doc.materials().count(); i ++ ) {

			const _material = doc.materials().get( i );
			const _pbrMaterial = _material.physicallyBased();

			let material = extractProperties( _material );

			const textures = [];

			for ( let j = 0; j < textureTypes.length; j ++ ) {

				const _texture = _material.getTexture( textureTypes[ j ] );
				if ( _texture ) {

					let textureType = textureTypes[ j ].constructor.name;
					textureType = textureType.substring( 12, textureType.length );
					const texture = { type: textureType };

					const image = doc.getEmbeddedFileAsBase64( _texture.fileName );

					texture.wrapU = _texture.wrapU;
					texture.wrapV = _texture.wrapV;
					texture.wrapW = _texture.wrapW;
					const uvw = _texture.uvwTransform.toFloatArray( true );
					texture.repeat = [ uvw[ 0 ], uvw[ 5 ] ];

					if ( image ) {

						texture.image = 'data:image/png;base64,' + image;

					} else {

						self.postMessage( { type: 'warning', id: taskID, data: {
							message: \`THREE.3DMLoader: Image for \${textureType} texture not embedded in file.\`,
							type: 'missing resource'
						}

						} );

						texture.image = null;

					}

					textures.push( texture );

					_texture.delete();

				}

			}

			material.textures = textures;

			if ( _pbrMaterial.supported ) {

				for ( let j = 0; j < pbrTextureTypes.length; j ++ ) {

					const _texture = _material.getTexture( pbrTextureTypes[ j ] );
					if ( _texture ) {

						const image = doc.getEmbeddedFileAsBase64( _texture.fileName );
						let textureType = pbrTextureTypes[ j ].constructor.name;
						textureType = textureType.substring( 12, textureType.length );
						const texture = { type: textureType, image: 'data:image/png;base64,' + image };
						textures.push( texture );

						_texture.delete();

					}

				}

				const pbMaterialProperties = extractProperties( _material.physicallyBased() );

				material = Object.assign( pbMaterialProperties, material );

			}

			materials.push( material );

			_material.delete();
			_pbrMaterial.delete();

		}

		// Handle layers

		for ( let i = 0; i < doc.layers().count(); i ++ ) {

			const _layer = doc.layers().get( i );
			const layer = extractProperties( _layer );

			layers.push( layer );

			_layer.delete();

		}

		// Handle views

		for ( let i = 0; i < doc.views().count(); i ++ ) {

			const _view = doc.views().get( i );
			const view = extractProperties( _view );

			views.push( view );

			_view.delete();

		}

		// Handle named views

		for ( let i = 0; i < doc.namedViews().count(); i ++ ) {

			const _namedView = doc.namedViews().get( i );
			const namedView = extractProperties( _namedView );

			namedViews.push( namedView );

			_namedView.delete();

		}

		// Handle groups

		for ( let i = 0; i < doc.groups().count(); i ++ ) {

			const _group = doc.groups().get( i );
			const group = extractProperties( _group );

			groups.push( group );

			_group.delete();

		}

		// Handle settings

		const settings = extractProperties( doc.settings() );

		//TODO: Handle other document stuff like dimstyles, instance definitions, bitmaps etc.

		// Handle dimstyles
		// console.log( \`Dimstyle Count: \${doc.dimstyles().count()}\` );

		// Handle bitmaps
		// console.log( \`Bitmap Count: \${doc.bitmaps().count()}\` );

		// Handle strings
		// console.log( \`Document Strings Count: \${doc.strings().count()}\` );
		// Note: doc.strings().documentUserTextCount() counts any doc.strings defined in a section
		//console.log( \`Document User Text Count: \${doc.strings().documentUserTextCount()}\` );

		const strings_count = doc.strings().count();

		for ( let i = 0; i < strings_count; i ++ ) {

			strings.push( doc.strings().get( i ) );

		}

		doc.delete();

		return { objects, materials, layers, views, namedViews, groups, strings, settings };

	}

	function extractObjectData( object, doc ) {

		const _geometry = object.geometry();
		const _attributes = object.attributes();
		let objectType = _geometry.objectType;
		let geometry, attributes, position, data, mesh;

		// skip instance definition objects
		//if( _attributes.isInstanceDefinitionObject ) { continue; }

		// TODO: handle other geometry types
		switch ( objectType ) {

			case rhino.ObjectType.Curve:

				const pts = curveToPoints( _geometry, 100 );

				position = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [];

				for ( let j = 0; j < pts.length; j ++ ) {

					position.array.push( pts[ j ][ 0 ] );
					position.array.push( pts[ j ][ 1 ] );
					position.array.push( pts[ j ][ 2 ] );

				}

				attributes.position = position;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.Point:

				const pt = _geometry.location;

				position = {};
				const color = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [ pt[ 0 ], pt[ 1 ], pt[ 2 ] ];

				const _color = _attributes.drawColor( doc );

				color.itemSize = 3;
				color.type = 'Float32Array';
				color.array = [ _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 ];

				attributes.position = position;
				attributes.color = color;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.PointSet:
			case rhino.ObjectType.Mesh:

				geometry = _geometry.toThreejsJSON();

				break;

			case rhino.ObjectType.Brep:

				const faces = _geometry.faces();
				mesh = new rhino.Mesh();

				for ( let faceIndex = 0; faceIndex < faces.count; faceIndex ++ ) {

					const face = faces.get( faceIndex );
					const _mesh = face.getMesh( rhino.MeshType.Any );

					if ( _mesh ) {

						mesh.append( _mesh );
						_mesh.delete();

					}

					face.delete();

				}

				if ( mesh.faces().count > 0 ) {

					mesh.compact();
					geometry = mesh.toThreejsJSON();
					faces.delete();

				}

				mesh.delete();

				break;

			case rhino.ObjectType.Extrusion:

				mesh = _geometry.getMesh( rhino.MeshType.Any );

				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

			case rhino.ObjectType.TextDot:

				geometry = extractProperties( _geometry );

				break;

			case rhino.ObjectType.Light:

				geometry = extractProperties( _geometry );

				if ( geometry.lightStyle.name === 'LightStyle_WorldLinear' ) {

					self.postMessage( { type: 'warning', id: taskID, data: {
						message: \`THREE.3DMLoader: No conversion exists for \${objectType.constructor.name} \${geometry.lightStyle.name}\`,
						type: 'no conversion',
						guid: _attributes.id
					}

					} );

				}

				break;

			case rhino.ObjectType.InstanceReference:

				geometry = extractProperties( _geometry );
				geometry.xform = extractProperties( _geometry.xform );
				geometry.xform.array = _geometry.xform.toFloatArray( true );

				break;

			case rhino.ObjectType.SubD:

				// TODO: precalculate resulting vertices and faces and warn on excessive results
				_geometry.subdivide( 3 );
				mesh = rhino.Mesh.createFromSubDControlNet( _geometry );
				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

				/*
				case rhino.ObjectType.Annotation:
				case rhino.ObjectType.Hatch:
				case rhino.ObjectType.ClipPlane:
				*/

			default:

				self.postMessage( { type: 'warning', id: taskID, data: {
					message: \`THREE.3DMLoader: Conversion not implemented for \${objectType.constructor.name}\`,
					type: 'not implemented',
					guid: _attributes.id
				}

				} );

				break;

		}

		if ( geometry ) {

			attributes = extractProperties( _attributes );
			attributes.geometry = extractProperties( _geometry );

			if ( _attributes.groupCount > 0 ) {

				attributes.groupIds = _attributes.getGroupList();

			}

			if ( _attributes.userStringCount > 0 ) {

				attributes.userStrings = _attributes.getUserStrings();

			}

			if ( _geometry.userStringCount > 0 ) {

				attributes.geometry.userStrings = _geometry.getUserStrings();

			}

			attributes.drawColor = _attributes.drawColor( doc );

			objectType = objectType.constructor.name;
			objectType = objectType.substring( 11, objectType.length );

			return { geometry, attributes, objectType };

		} else {

			self.postMessage( { type: 'warning', id: taskID, data: {
				message: \`THREE.3DMLoader: \${objectType.constructor.name} has no associated mesh geometry.\`,
				type: 'missing mesh',
				guid: _attributes.id
			}

			} );

		}

	}

	function extractProperties( object ) {

		const result = {};

		for ( const property in object ) {

			const value = object[ property ];

			if ( typeof value !== 'function' ) {

				if ( typeof value === 'object' && value !== null && value.hasOwnProperty( 'constructor' ) ) {

					result[ property ] = { name: value.constructor.name, value: value.value };

				} else {

					result[ property ] = value;

				}

			} else {

				// these are functions that could be called to extract more data.
				//console.log( \`\${property}: \${object[ property ].constructor.name}\` );

			}

		}

		return result;

	}

	function curveToPoints( curve, pointLimit ) {

		let pointCount = pointLimit;
		let rc = [];
		const ts = [];

		if ( curve instanceof rhino.LineCurve ) {

			return [ curve.pointAtStart, curve.pointAtEnd ];

		}

		if ( curve instanceof rhino.PolylineCurve ) {

			pointCount = curve.pointCount;
			for ( let i = 0; i < pointCount; i ++ ) {

				rc.push( curve.point( i ) );

			}

			return rc;

		}

		if ( curve instanceof rhino.PolyCurve ) {

			const segmentCount = curve.segmentCount;

			for ( let i = 0; i < segmentCount; i ++ ) {

				const segment = curve.segmentCurve( i );
				const segmentArray = curveToPoints( segment, pointCount );
				rc = rc.concat( segmentArray );
				segment.delete();

			}

			return rc;

		}

		if ( curve instanceof rhino.ArcCurve ) {

			pointCount = Math.floor( curve.angleDegrees / 5 );
			pointCount = pointCount < 2 ? 2 : pointCount;
			// alternative to this hardcoded version: https://stackoverflow.com/a/18499923/2179399

		}

		if ( curve instanceof rhino.NurbsCurve && curve.degree === 1 ) {

			const pLine = curve.tryGetPolyline();

			for ( let i = 0; i < pLine.count; i ++ ) {

				rc.push( pLine.get( i ) );

			}

			pLine.delete();

			return rc;

		}

		const domain = curve.domain;
		const divisions = pointCount - 1.0;

		for ( let j = 0; j < pointCount; j ++ ) {

			const t = domain[ 0 ] + ( j / divisions ) * ( domain[ 1 ] - domain[ 0 ] );

			if ( t === domain[ 0 ] || t === domain[ 1 ] ) {

				ts.push( t );
				continue;

			}

			const tan = curve.tangentAt( t );
			const prevTan = curve.tangentAt( ts.slice( - 1 )[ 0 ] );

			// Duplicated from THREE.Vector3
			// How to pass imports to worker?

			const tS = tan[ 0 ] * tan[ 0 ] + tan[ 1 ] * tan[ 1 ] + tan[ 2 ] * tan[ 2 ];
			const ptS = prevTan[ 0 ] * prevTan[ 0 ] + prevTan[ 1 ] * prevTan[ 1 ] + prevTan[ 2 ] * prevTan[ 2 ];

			const denominator = Math.sqrt( tS * ptS );

			let angle;

			if ( denominator === 0 ) {

				angle = Math.PI / 2;

			} else {

				const theta = ( tan.x * prevTan.x + tan.y * prevTan.y + tan.z * prevTan.z ) / denominator;
				angle = Math.acos( Math.max( - 1, Math.min( 1, theta ) ) );

			}

			if ( angle < 0.1 ) continue;

			ts.push( t );

		}

		rc = ts.map( t => curve.pointAt( t ) );
		return rc;

	}

}
`;var JC,eI=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class fp extends y4{constructor(e){super(e),this.materials=[],this.setLibraryPath(fp.LIBRARY_PATH)}_createMaterial(e){return fp.ImportMaterials?super._createMaterial(e):this.materials[0]||new _.Wid({color:new _.Ilk(1,1,1),metalness:.8,name:"default",side:_.ehD})}async loadAsync(e,i){const s=await super.loadAsync(e,i);s.rotateX(-Math.PI/2),s.userData.materials&&delete s.userData.materials;const o=s.userData.layers;return s.traverse(c=>{var rt,st,at,ct;const g=(rt=c.userData.attributes)==null?void 0:rt.castsShadows,b=(st=c.userData.attributes)==null?void 0:st.receivesShadows;c.castShadow=g,c.receiveShadow=b;const et=((at=c.userData.attributes)==null?void 0:at.layerIndex)??((ct=c.userData.defAttributes)==null?void 0:ct.layerIndex),tt=o[et];tt&&(c.userData.rhinoLayer=tt),c.userData.rhino3dmRoot=s.uuid,this._hideLineMesh(c),this._useInstancedMesh(c),this._useMaterialSource(c,tt)}),this.materials=[],s}_useMaterialSource(e,i){var o,c,g,b,et;if(!fp.ImportMaterials)return;const s=e;if(((o=s.material)==null?void 0:o.name)==="default"||fp.ForceLayerMaterials){const tt=((c=s.userData.attributes)==null?void 0:c.materialSource)||((g=s.userData.defAttributes)==null?void 0:g.materialSource),rt=((b=s.userData.attributes)==null?void 0:b.colorSource)||((et=s.userData.defAttributes)==null?void 0:et.colorSource);if(!fp.ForceLayerMaterials&&!tt&&!rt)return;fp.ForceLayerMaterials||(tt==null?void 0:tt.value)===0||(tt==null?void 0:tt.value)===1&&(rt==null?void 0:rt.value)===0?i&&(s.material=this._compareMaterials(this._createMaterial({diffuseColor:i.color,name:i.name,transparency:0,textures:[]}))):(tt==null?void 0:tt.value)===3||(tt==null?void 0:tt.value)===1&&(rt==null?void 0:rt.value)===3?s.traverseAncestors(st=>{st!=null&&st.material&&(s.material=st.material)}):tt&&tt.value!==1&&console.warn("Unknown material source",tt,s,s.userData.attributes)}}_useInstancedMesh(e){if(!fp.ReplaceWithInstancedMesh||e.children.length<=0)return;const i=e.children,s=i.map(c=>c.geometry);s.filter((c,g)=>s.indexOf(c)===g).forEach(c=>{var et;const g=i.filter(tt=>tt.geometry===c),b=g.length>0?g.filter(tt=>tt.material===g[0].material):[];if(b.length>1){const tt=new _.SPe(c,b[0].material,b.length);tt.userData={...b[0].userData},tt.userData.instanceUserData=[],tt.userData.attributes=tt.userData.defAttributes||tt.userData.attributes,tt.userData.defAttributes&&delete tt.userData.defAttributes,tt.name=((et=tt.userData.attributes)==null?void 0:et.name)||b[0].name,b.forEach((rt,st)=>{tt.setMatrixAt(st,rt.matrix),e.remove(rt),tt.userData.instanceUserData.push(rt.userData)}),e.add(tt)}})}_hideLineMesh(e){if(!fp.HideLineMesh||e.children.length<=0)return;const i=[];e.traverse(s=>{s&&(s.isLine||s.isLineSegments||s.isPoints)&&i.push(s)}),i.forEach(s=>{s.userData.visible_3dm=s.visible,s.visible=!1})}}fp.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/rhino3dm@7.15.0/",fp.ImportMaterials=!0,fp.ForceLayerMaterials=!1,fp.ReplaceWithInstancedMesh=!1,fp.HideLineMesh=!1;let iy=JC=class extends _e.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Lr],this._importer=new yl(fp,["3dm"],!0),this.importMaterials=!0,this.forceLayerMaterials=!1,this.replaceWithInstancedMesh=!1,this.hideLineMesh=!1}_refresh(){fp.ImportMaterials=this.importMaterials,fp.ForceLayerMaterials=this.forceLayerMaterials,fp.ReplaceWithInstancedMesh=this.replaceWithInstancedMesh,fp.HideLineMesh=this.hideLineMesh}async onAdded(h){var e,i;(i=(e=h.getManager())==null?void 0:e.importer)==null||i.Importers.push(this._importer),this._refresh()}async onDispose(h){}async onRemove(h){var e,i;(i=(e=h.getManager())==null?void 0:e.importer)!=null&&i.Importers&&h.getManager().importer.Importers.splice(h.getManager().importer.Importers.indexOf(this._importer),1)}};iy.PluginType="Rhino3dmLoadPlugin",eI([(0,_e.onChange)(JC.prototype._refresh),Nr()],iy.prototype,"importMaterials",void 0),eI([(0,_e.onChange)(JC.prototype._refresh),Nr()],iy.prototype,"forceLayerMaterials",void 0),eI([(0,_e.onChange)(JC.prototype._refresh),Nr()],iy.prototype,"replaceWithInstancedMesh",void 0),eI([(0,_e.onChange)(JC.prototype._refresh),Nr()],iy.prototype,"hideLineMesh",void 0),iy=JC=eI([Ms("Rhino 3dm loader")],iy);class b4 extends _.aNw{constructor(e){super(e)}load(e,i,s,o){const c=this,g=new _.hH6(this.manager);g.setPath(this.path),g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(e,function(b){try{i(c.parse(b))}catch(et){o?o(et):console.error(et),c.manager.itemError(e)}},s,o)}parse(e){function i(c,g,b){for(let et=0,tt=c.length;et<tt;et++)if(c[et]!==g.getUint8(b+et))return!1;return!0}const s=function(c){if(typeof c=="string"){const g=new Uint8Array(c.length);for(let b=0;b<c.length;b++)g[b]=255&c.charCodeAt(b);return g.buffer||g}return c}(e);return function(c){const g=new DataView(c);if(84+50*g.getUint32(80,!0)===g.byteLength)return!0;const b=[115,111,108,105,100];for(let et=0;et<5;et++)if(i(b,g,et))return!1;return!0}(s)?function(c){const g=new DataView(c),b=g.getUint32(80,!0);let et,tt,rt,st,at,ct,pt,gt,At=!1;for(let Mt=0;Mt<70;Mt++)g.getUint32(Mt,!1)==1129270351&&g.getUint8(Mt+4)==82&&g.getUint8(Mt+5)==61&&(At=!0,st=new Float32Array(3*b*3),at=g.getUint8(Mt+6)/255,ct=g.getUint8(Mt+7)/255,pt=g.getUint8(Mt+8)/255,gt=g.getUint8(Mt+9)/255);const xt=new _.u9r,yt=new Float32Array(3*b*3),_t=new Float32Array(3*b*3);for(let Mt=0;Mt<b;Mt++){const It=84+50*Mt,Bt=g.getFloat32(It,!0),Lt=g.getFloat32(It+4,!0),Ht=g.getFloat32(It+8,!0);if(At){const Jt=g.getUint16(It+48,!0);32768&Jt?(et=at,tt=ct,rt=pt):(et=(31&Jt)/31,tt=(Jt>>5&31)/31,rt=(Jt>>10&31)/31)}for(let Jt=1;Jt<=3;Jt++){const sn=It+12*Jt,on=3*Mt*3+3*(Jt-1);yt[on]=g.getFloat32(sn,!0),yt[on+1]=g.getFloat32(sn+4,!0),yt[on+2]=g.getFloat32(sn+8,!0),_t[on]=Bt,_t[on+1]=Lt,_t[on+2]=Ht,At&&(st[on]=et,st[on+1]=tt,st[on+2]=rt)}}return xt.setAttribute("position",new _.TlE(yt,3)),xt.setAttribute("normal",new _.TlE(_t,3)),At&&(xt.setAttribute("color",new _.TlE(st,3)),xt.hasColors=!0,xt.alpha=gt),xt}(s):function(c){const g=new _.u9r,b=/solid([\s\S]*?)endsolid/g,et=/facet([\s\S]*?)endfacet/g;let tt=0;const rt=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,st=new RegExp("vertex"+rt+rt+rt,"g"),at=new RegExp("normal"+rt+rt+rt,"g"),ct=[],pt=[],gt=new _.Pa4;let At,xt=0,yt=0,_t=0;for(;(At=b.exec(c))!==null;){yt=_t;const Mt=At[0];for(;(At=et.exec(Mt))!==null;){let Lt=0,Ht=0;const Jt=At[0];for(;(At=at.exec(Jt))!==null;)gt.x=parseFloat(At[1]),gt.y=parseFloat(At[2]),gt.z=parseFloat(At[3]),Ht++;for(;(At=st.exec(Jt))!==null;)ct.push(parseFloat(At[1]),parseFloat(At[2]),parseFloat(At[3])),pt.push(gt.x,gt.y,gt.z),Lt++,_t++;Ht!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+tt),Lt!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+tt),tt++}const It=yt,Bt=_t-yt;g.addGroup(It,Bt,xt),xt++}return g.setAttribute("position",new _.a$l(ct,3)),g.setAttribute("normal",new _.a$l(pt,3)),g}(typeof(o=e)!="string"?new TextDecoder().decode(o):o);var o}}class QB extends _e.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Lr]}async onAdded(e){var i,s;this._importer||(this._importer=new yl(b4,["stl"],!0)),(s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var i,s;this._importer&&((s=(i=e.getManager())==null?void 0:i.importer)!=null&&s.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}QB.PluginType="STLLoadPlugin";class WB extends _e.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Lr]}async onAdded(e){const i=document.createElement("script");i.type="module",i.innerHTML=`
import { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(i),this._script=i}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}WB.PluginType="GLTFMeshOptPlugin";var w4=__webpackgi_require__(701),c1=__webpackgi_require__.n(w4),x4=__webpackgi_require__(236),u1=__webpackgi_require__.n(x4),E4=__webpackgi_require__(850),h1=__webpackgi_require__.n(E4),S4=__webpackgi_require__(182),d1=__webpackgi_require__.n(S4),C4=__webpackgi_require__(213),p1=__webpackgi_require__.n(C4),LP=__webpackgi_require__(27),tI={};LP.Z&&LP.Z.locals&&(tI.locals=LP.Z.locals);var qB,XB=0,jE={};jE.styleTagTransform=p1(),jE.setAttributes=h1(),jE.insert=function(h,e){(e.target||document.head).appendChild(h)},jE.domAPI=u1(),jE.insertStyleElement=d1(),tI.use=function(h){return jE.options=h||{},XB++||(qB=c1()(LP.Z,jE)),tI},tI.unuse=function(){XB>0&&!--XB&&(qB(),qB=null)};var M4=tI,NP=__webpackgi_require__(356),nI={};NP.Z&&NP.Z.locals&&(nI.locals=NP.Z.locals);var YB,KB=0,zE={};zE.styleTagTransform=p1(),zE.setAttributes=h1(),zE.insert=function(h,e){(e.target||document.head).appendChild(h)},zE.domAPI=u1(),zE.insertStyleElement=d1(),nI.use=function(h){return zE.options=h||{},KB++||(YB=c1()(NP.Z,zE)),nI},nI.unuse=function(){KB>0&&!--KB&&(YB(),YB=null)};var T4=nI;class $C extends hs{_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}constructor(e){super(),this.enabled=!0,this.dependencies=[Lr],this.processState=new Map,this._mainDiv=(0,_e.createDiv)({id:"assetManager"+e,addToBody:!1,innerHTML:""}),this._contentDiv=(0,_e.createDiv)({id:"assetManager"+e+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}async onAdded(e){var i,s,o,c,g,b,et,tt,rt,st,at,ct;await super.onAdded(e),e.container.appendChild(this._mainDiv),this._updateMainDiv(this.processState),(s=(i=e.getManager())==null?void 0:i.importer)==null||s.addEventListener("importFile",pt=>{pt.state!=="done"?this.processState.set(pt.path,{state:pt.state,progress:pt.progress?100*pt.progress:void 0}):this.processState.delete(pt.path),this._updateMainDiv(this.processState)}),(c=(o=e.getManager())==null?void 0:o.importer)==null||c.addEventListener("processFileStart",pt=>{this.processState.set(pt.path,{state:"processing",progress:void 0}),this._updateMainDiv(this.processState)}),(b=(g=e.getManager())==null?void 0:g.importer)==null||b.addEventListener("processFileEnd",pt=>{this.processState.delete(pt.path),this._updateMainDiv(this.processState)}),(tt=(et=e.getManager())==null?void 0:et.exporter)==null||tt.addEventListener("exportFile",pt=>{pt.state!=="done"?this.processState.set(pt.obj.name,{state:pt.state,progress:pt.progress?100*pt.progress:void 0}):this.processState.delete(pt.obj.name),this._updateMainDiv(this.processState)}),(rt=e.getPluginByType("FileTransferPlugin"))==null||rt.addEventListener("transferFile",pt=>{pt.state!=="done"?this.processState.set(pt.path,{state:pt.state,progress:pt.progress?100*pt.progress:void 0}):this.processState.delete(pt.path),this._updateMainDiv(this.processState)}),(st=e.getPluginByType("MaterialConfiguratorPlugin"))==null||st.addEventListener("progress",pt=>{pt.state!=="done"?this.processState.set("MatpreviewGeneration",{state:pt.state,progress:0}):this.processState.delete("MatpreviewGeneration"),this._updateMainDiv(this.processState)}),(at=e.getPluginByType("SwitchNodePlugin"))==null||at.addEventListener("progress",pt=>{pt.state!=="done"?this.processState.set("SwitchNodeGeneration",{state:pt.state,progress:0}):this.processState.delete("SwitchNodeGeneration"),this._updateMainDiv(this.processState)}),(ct=e.getPluginByType("ThemePlugin"))==null||ct.addEventListener("progress",pt=>{pt.state!=="done"?this.processState.set("ThemeInit",{state:pt.state,progress:0}):this.processState.delete("ThemeInit"),this._updateMainDiv(this.processState)})}async onRemove(e){var i;return this._mainDiv.remove(),(i=this._contentDiv)==null||i.remove(),this.processState.clear(),super.onRemove(e)}}(function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);c>3&&g&&Object.defineProperty(e,i,g)})([Nr("Enabled"),(0,_e.onChange)($C.prototype._onEnabledChange),Mn()],$C.prototype,"enabled",void 0);var ry,Fu=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let xa=ry=class extends $C{refresh(){this._updateMainDiv(this._isPreviewing?this._previewState:this.processState,!1)}togglePreview(){this.maximize(),this._isPreviewing=!this._isPreviewing,this.refresh(),this._isPreviewing?this.show():this.hideWithDelay()}constructor(){super("LoadingScreen"),this.styles=M4,this.spinners=[{styles:T4,html:'<span class="loader"></span>'}],this.loader=0,this.loadingTextHeader="Loading Files",this.errorTextHeader="Error Loading Files",this.showFileNames=!0,this.showProcessStates=!0,this.showProgress=!0,this.hideOnOnlyErrors=!0,this.hideOnFilesLoad=!0,this.hideOnSceneObjectLoad=!1,this.minimizeOnSceneObjectLoad=!0,this.showOnFilesLoading=!0,this.showOnSceneEmpty=!0,this.hideDelay=500,this.backgroundOpacity=.5,this.backgroundBlur=24,this.background="#ffffff",this.textColor="#222222",this.logoImage="https://static.webgi.xyz/logo.svg",this._isPreviewing=!1,this._previewState=new Map([["file.glb",{state:"downloading",progress:50}],["environment.hdr",{state:"adding"}]]),this.loadingElement=(0,_e.createDiv)({classList:["loadingScreenLoadingElement"],addToBody:!1}),this.filesElement=(0,_e.createDiv)({classList:["loadingScreenFilesElement"],addToBody:!1}),this.logoElement=(0,_e.createDiv)({classList:["loadingScreenLogoElement"],addToBody:!1}),this._isHidden=!1,this._sceneUpdate=h=>{if(!this._viewer||!h.hierarchyChanged)return;const e=this._viewer.scene.modelRoot.children;e.length===0&&this.showOnSceneEmpty&&this.show(),console.log(e.length),e.length>0?this.hideOnSceneObjectLoad?this.hideWithDelay():this.minimizeOnSceneObjectLoad&&(0,_e.timeout)(this.hideDelay+300).then(()=>this.minimize()):this.minimizeOnSceneObjectLoad&&this.maximize()},this._mainDiv.prepend(this.loadingElement),this._mainDiv.prepend(this.logoElement),this._mainDiv.appendChild(this.filesElement)}async hide(){this._isHidden=!0,this._mainDiv.style.opacity="0",await(0,_e.timeout)(502),this._isHidden&&(this._mainDiv.style.display="none",this._showMainDiv())}async hideWithDelay(){if(this._isHidden=!0,await(0,_e.timeout)(this.hideDelay),this._isHidden)return this.hide()}show(){this._isHidden=!1,this._showMainDiv(),this._mainDiv.style.display="flex"}_showMainDiv(){this._mainDiv.style.opacity="1"}minimize(){this._mainDiv.classList.add("minimizedLoadingScreen")}maximize(){this._mainDiv.classList.remove("minimizedLoadingScreen")}_setHTML(h,e){h.innerHTML!==e&&(h.innerHTML=e)}_updateMainDiv(h,e=!0){if(!this._viewer||!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");if(this.showFileNames){let s="";h.forEach((o,c)=>{s+=(this.showProcessStates?`<span class="loadingScreenProcessState">${o.state}</span>: `:"")+(c||"").split("/").pop()+(this.showProgress&&o.progress?" - "+o.progress.toFixed(0)+"%":"")+"<br>"}),this._setHTML(this.filesElement,s)}else this._setHTML(this.filesElement,"");const i=[...h.values()].filter(s=>s.state==="error");i.length>0&&i.length===h.size&&!this.hideOnOnlyErrors?this._setHTML(this._contentDiv,this.errorTextHeader):this._setHTML(this._contentDiv,this.loadingTextHeader),this._setHTML(this.loadingElement,this.spinners[this.loader].html),this._mainDiv.style.setProperty("--b-opacity",this.backgroundOpacity.toString()),this._mainDiv.style.setProperty("--b-background",this.background),this._mainDiv.style.backdropFilter=`blur(${this.backgroundBlur}px)`,this._mainDiv.style.color=this.textColor,this._setHTML(this.logoElement,this.logoImage?`<img class="loadingScreenLogoImageImg" src="${this.logoImage}"/>`:""),e&&(this.hideOnFilesLoad&&(h.size===0||i.length===h.size&&this.hideOnOnlyErrors)?this.hideDelay?this.hideWithDelay():this.hide():h.size>0&&this.showOnFilesLoading&&this.show())}async onAdded(h){this.styles.use({target:h.container}),this.spinners.forEach(e=>{e.styles.use({target:h.container})}),h.scene.addEventListener("sceneUpdate",this._sceneUpdate),await super.onAdded(h)}async onRemove(h){h.scene.removeEventListener("sceneUpdate",this._sceneUpdate),await super.onRemove(h)}};xa.PluginType="LoadingScreenPlugin",Fu([em("Loader",["Spinner 1"].map((h,e)=>({value:e,label:h}))),(0,_e.serialize)()],xa.prototype,"loader",void 0),Fu([js("Loading text header"),(0,_e.onChange)(ry.prototype.refresh),(0,_e.serialize)()],xa.prototype,"loadingTextHeader",void 0),Fu([js("Error text header"),(0,_e.serialize)()],xa.prototype,"errorTextHeader",void 0),Fu([Nr("Show file names"),(0,_e.serialize)(),(0,_e.onChange)(ry.prototype.refresh)],xa.prototype,"showFileNames",void 0),Fu([Nr("Show process states"),(0,_e.serialize)(),(0,_e.onChange)(ry.prototype.refresh)],xa.prototype,"showProcessStates",void 0),Fu([Nr("Show progress"),(0,_e.serialize)(),(0,_e.onChange)(ry.prototype.refresh)],xa.prototype,"showProgress",void 0),Fu([Nr("Hide on only errors"),(0,_e.serialize)()],xa.prototype,"hideOnOnlyErrors",void 0),Fu([Nr("Hide on files load"),(0,_e.serialize)()],xa.prototype,"hideOnFilesLoad",void 0),Fu([Nr("Hide on scene object load"),(0,_e.serialize)()],xa.prototype,"hideOnSceneObjectLoad",void 0),Fu([Nr("Minimize on scene object load"),(0,_e.serialize)()],xa.prototype,"minimizeOnSceneObjectLoad",void 0),Fu([Nr("Show when files start loading"),(0,_e.serialize)()],xa.prototype,"showOnFilesLoading",void 0),Fu([Nr("Show when scene empty"),(0,_e.serialize)()],xa.prototype,"showOnSceneEmpty",void 0),Fu([js("Hide delay (ms)"),(0,_e.serialize)()],xa.prototype,"hideDelay",void 0),Fu([es("Background Opacity",[0,1]),(0,_e.onChange)(ry.prototype.refresh),(0,_e.serialize)()],xa.prototype,"backgroundOpacity",void 0),Fu([es("Background Blur",[0,100]),(0,_e.onChange)(ry.prototype.refresh),(0,_e.serialize)()],xa.prototype,"backgroundBlur",void 0),Fu([js("Background Color"),(0,_e.onChange)(ry.prototype.refresh),(0,_e.serialize)()],xa.prototype,"background",void 0),Fu([js("Text Color"),(0,_e.onChange)(ry.prototype.refresh),(0,_e.serialize)()],xa.prototype,"textColor",void 0),Fu([js("Logo Image"),(0,_e.onChange)(ry.prototype.refresh),(0,_e.serialize)()],xa.prototype,"logoImage",void 0),Fu([go("Toggle preview")],xa.prototype,"togglePreview",null),Fu([go("Minimize")],xa.prototype,"minimize",null),Fu([go("Maximize")],xa.prototype,"maximize",null),xa=ry=Fu([Ms("Loading Screen")],xa);class i3 extends iv{constructor(e){super(e)}async initialize({caching:e=!0,ground:i=!0,bloom:s=!0,depthTonemap:o=!0,enableDrop:c=!1,importPopup:g=!1,debug:b=!1}={}){return b&&await this.addPlugin($0),this.getPlugin(Lr)||this.addPluginSync(Lr,void 0,void 0,{storage:e&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await this.addPlugin(xa,!0),await UP(this,{ground:i,bloom:s,depthTonemap:o,enableDrop:c,importPopup:g}),await this.addPlugin(Iw),await this.addPlugin(Pw),await this.addPlugin(cA),this}}async function UP(h,{ground:e=!0,bloom:i=!0,depthTonemap:s=!0,enableDrop:o=!1,importPopup:c=!1}={}){await h.getOrAddPlugin(Lr),c&&await h.getOrAddPlugin(xa),await h.getOrAddPlugin(bo),await h.getOrAddPlugin(dm),o&&await h.getOrAddPlugin(Y_),await h.addPlugin(new cp(32)),await h.getOrAddPlugin(f_),await h.getOrAddPlugin(Cx),await h.addPlugin(new Sx(s||!h.useRgbm)),await h.getOrAddPlugin(mu),await h.getOrAddPlugin(q0),await h.getOrAddPlugin(eE),await h.getOrAddPlugin(kC),await h.getOrAddPlugin(Bx),await h.getOrAddPlugin(K1),await h.getOrAddPlugin(Uo),await h.getOrAddPlugin(U0),await h.getOrAddPlugin($o),await h.getOrAddPlugin(am),await h.getOrAddPlugin(w_),await h.getOrAddPlugin(sv),await h.getOrAddPlugin(Fm),await h.getOrAddPlugin(zm),await h.getOrAddPlugin(Nu),await h.getOrAddPlugin(zv),await h.getOrAddPlugin(i0),await h.getOrAddPlugin(cv,!1),await h.getOrAddPlugin(Kx),await h.getOrAddPlugin(qo),await h.getOrAddPlugin(z0,!1),await h.getOrAddPlugin(Qp,!1),await h.getOrAddPlugin(jy,!1),await h.getOrAddPlugin(Tp,!1),await h.getOrAddPlugin(Ju,!1),await h.getOrAddPlugin(av,!1),await h.getOrAddPlugin(b_,!1),await h.getOrAddPlugin(rA),await h.getOrAddPlugin(jT),await h.getOrAddPlugin(Nt),await h.getOrAddPlugin(iy),await h.getOrAddPlugin(QB),await h.getOrAddPlugin(GB),await h.getOrAddPlugin(WB),await h.getOrAddPlugin(nw),await h.getOrAddPlugin(fu),await h.getOrAddPlugin(hm),i&&await h.getOrAddPlugin(rv),e&&await h.getOrAddPlugin(Wv),h.renderer.refreshPipeline()}let I4=0;class r3 extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this._environmentFromSource=null,this.viewerIndex=I4++,this.canvasId="webgi-viewer-"+this.viewerIndex,window.freeViewers||(window.freeViewers=[]),this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block";const e=window.freeViewers.pop(),i=document.createElement("style");i.textContent=_e.css`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.shadowRoot.append(i,this.wrapper),this._initialized=!0,this._initialize(e).then(async()=>this.refreshAll())}async refreshAll(){this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(e){e!=null&&e._lastState&&(this._state.src=e._lastState.src||this._state.src,this._state.environment=e._lastState.environment||this._state.environment,delete e._lastState),e!=null&&e.__models&&(this._models={...this._models,...e.__models},delete e.__models),this.canvas=(e==null?void 0:e.canvas)||(0,_e.createCanvasElement)(),this.canvas.setAttribute("id",this.canvasId),this.wrapper.append(this.canvas),this.viewer=e??new i3({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true",assetManager:{storage:window.caches?await caches.open("webgi-cache-storage"):void 0}}),this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),e||await this.viewer.initialize({debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this.dispatchEvent(new Event("initialized"))}connectedCallback(){this._initialized&&this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0,this.dispatchEvent(new Event("connected")))}disconnectedCallback(){var e,i;this.viewer&&(this.getAttribute("disposeOnRemove")==="true"||this.getAttribute("disposeonremove")==="true"?((e=this.canvas)==null||e.remove(),this.clearViewer(),this.viewer.dispose(),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.getAttribute("autoManageViewers")==="true"||this.getAttribute("automanageviewers")==="true"?((i=this.canvas)==null||i.remove(),this.viewer._lastState={...this._state},this.viewer._lastState.src="",this.clearViewer(),window.freeViewers.push(this.viewer),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.viewer.enabled=!1,this.dispatchEvent(new Event("disconnected")))}adoptedCallback(){this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment","renderScale"]}attributeChangedCallback(e,i,s){this.refreshAll()}clearViewer(){var e,i;(e=this.viewer)==null||e.scene.disposeSceneModels(),(i=this.viewer)==null||i.scene.setEnvironment(null),Object.values(this._models).forEach(async s=>s.then(o=>o.forEach(c=>c.dispose&&c.dispose()))),this._models={}}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const i=[e],s=[],o=[],c=this.viewer.scene.environment;this.viewer.scene.environment=null,this._environmentFromSource=null;for(const b of i)!this._models[b]&&b&&(this._models[b]=this.viewer.getManager().importer.importPath(b,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!0,pathOverride:this._getAttr("filename","")||void 0}));const g=this.viewer.scene.environment;g?this._environmentFromSource=g:this.viewer.scene.environment=c;for(const[b,et]of Object.entries(this._models))i.includes(b)?s.push(et.then(tt=>[b,tt])):o.push(et);await Promise.all([Promise.all(s).then(async b=>Promise.all(b.map(async et=>(this._models[et[0]]=this.viewer.getManager().importer.processImported(et[1]),this._models[et[0]])))).then(b=>{for(const et of b)for(const tt of et)tt&&tt.assetType==="model"&&this.viewer.scene.addSceneObject(tt)}),Promise.all(o).then(b=>{for(const et of b)for(const tt of et)tt&&tt.assetType==="model"&&tt.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);if(this._environmentFromSource)return void this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute.");const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const i=this.viewer.scene.getEnvironment(),s=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;this._environmentFromSource?this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute."):(s&&s.assetType!=="texture"||await this.viewer.scene.setEnvironment(s),i==null||i.dispose(),this.dispatchEvent(new CustomEvent("environment-loaded",{detail:{src:e}})),this._state.environment=e,this._refreshingEnvironment=!1)}_getAttr(e,i){return this.hasAttribute(e)?this.getAttribute(e):i}addEventListener(e,i,s){super.addEventListener(e,i,s),e==="initialized"&&this._initialized&&this.dispatchEvent(new Event("initialized"))}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",r3);var FP=__webpackgi_require__(798),iI={};FP.Z&&FP.Z.locals&&(iI.locals=FP.Z.locals);var JB,$B=0,VE={};VE.styleTagTransform=p1(),VE.setAttributes=h1(),VE.insert=function(h,e){(e.target||document.head).appendChild(h)},VE.domAPI=u1(),VE.insertStyleElement=d1(),iI.use=function(h){return VE.options=h||{},$B++||(JB=c1()(FP.Z,VE)),iI},iI.unuse=function(){$B>0&&!--$B&&(JB(),JB=null)};var P4=iI;let jP=class extends $C{constructor(){super("Popup");const h=(0,_e.createDiv)({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});h.addEventListener("click",()=>{this._mainDiv.style.display="none"}),this._mainDiv.appendChild(h)}_updateMainDiv(h){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e="";h.forEach((i,s)=>{e+=`<span class="processState">${i.state}</span>: ${(s||"").split("/").pop()} ${i.progress?" - "+i.progress.toFixed(0)+"%":""}<br>`}),this._contentDiv.innerHTML=e,h.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(h){P4.use({target:h.container}),await super.onAdded(h)}};jP.PluginType="AssetManagerBasicPopupPlugin",jP=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g}([Ms("Asset manager popup")],jP);var zP=__webpackgi_require__(44),rI={};zP.Z&&zP.Z.locals&&(rI.locals=zP.Z.locals);var ZB,eO=0,GE={};GE.styleTagTransform=p1(),GE.setAttributes=h1(),GE.insert=function(h,e){(e.target||document.head).appendChild(h)},GE.domAPI=u1(),GE.insertStyleElement=d1(),rI.use=function(h){return GE.options=h||{},eO++||(ZB=c1()(zP.Z,GE)),rI},rI.unuse=function(){eO>0&&!--eO&&(ZB(),ZB=null)};var R4=rI;let sI=class extends $C{constructor(h=!0){super("LoadingBar"),this.showText=h}_updateMainDiv(h){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e=1,i=1;h.forEach((s,o)=>{e+=s.progress??99,i+=100}),this._contentDiv.innerHTML=this.showText?(100*e/i).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*e/i).toFixed(0)+"%",h.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(h){R4.use({target:h.container}),await super.onAdded(h)}};sI.PluginType="AssetManagerLoadingBarPlugin",sI=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g}([Ms("Asset manager loading bar")],sI);class f1{get basePath(){return this._basePath}get assets(){return this._assets}constructor(e){var i;this._basePath=(e==null?void 0:e.basePath)??"",this._assets=((i=e==null?void 0:e.assets)==null?void 0:i.map(s=>this._resolveAsset(s)))??[]}find(e){return this._assets.find(e)??void 0}_resolveAsset(e){return{...e,path:(0,_e.pathJoin)([this._basePath,e.path])}}}class D4 extends _e.SimpleEventDispatcher{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const i=this._assets.indexOf(e);i>=0&&this._assets.splice(i,1)}async findAssetRegex(e){for(const i of this._assets){const s=i.find(o=>{var c;return o&&(e.test(o.path)||e.test(((c=o.file)==null?void 0:c.name)??""))});if(s)return s}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,i=!1){return this.findAssetRegex(new RegExp(e,i?"i":""))}}const s3=new _.Pa4,o3=new _.Pa4,gm=new _.Ltg,vm=new _.Ltg,uA=new _.Ltg,tO=new _.Pa4,nO=new _.yGw,_m=new _.Zzh,a3=new _.Pa4,VP=new _.ZzF,GP=new _.aLr,hA=new _.Ltg;let dA,HE;function l3(h,e,i){return hA.set(0,0,-e,1).applyMatrix4(h.projectionMatrix),hA.multiplyScalar(1/hA.w),hA.x=HE/i.width,hA.y=HE/i.height,hA.applyMatrix4(h.projectionMatrixInverse),hA.multiplyScalar(1/hA.w),Math.abs(Math.max(hA.x,hA.y))}class HP extends _.Kj0{constructor(e=new zy,i=new Ov({color:16777215*Math.random()})){super(e,i),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,s=e.attributes.instanceEnd,o=new Float32Array(2*i.count);for(let g=0,b=0,et=i.count;g<et;g++,b+=2)s3.fromBufferAttribute(i,g),o3.fromBufferAttribute(s,g),o[b]=b===0?0:o[b-1],o[b+1]=o[b]+s3.distanceTo(o3);const c=new _.$TI(o,2,1);return e.setAttribute("instanceDistanceStart",new _.kB5(c,1,0)),e.setAttribute("instanceDistanceEnd",new _.kB5(c,1,1)),this}raycast(e,i){const s=this.material.worldUnits,o=e.camera;o!==null||s||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const c=e.params.Line2!==void 0&&e.params.Line2.threshold||0;dA=e.ray;const g=this.matrixWorld,b=this.geometry,et=this.material;let tt,rt;HE=et.linewidth+c,b.boundingSphere===null&&b.computeBoundingSphere(),GP.copy(b.boundingSphere).applyMatrix4(g),tt=s?.5*HE:l3(o,Math.max(o.near,GP.distanceToPoint(dA.origin)),et.resolution),GP.radius+=tt,dA.intersectsSphere(GP)!==!1&&(b.boundingBox===null&&b.computeBoundingBox(),VP.copy(b.boundingBox).applyMatrix4(g),rt=s?.5*HE:l3(o,Math.max(o.near,VP.distanceToPoint(dA.origin)),et.resolution),VP.expandByScalar(rt),dA.intersectsBox(VP)!==!1&&(s?function(st,at){const ct=st.matrixWorld,pt=st.geometry,gt=pt.attributes.instanceStart,At=pt.attributes.instanceEnd;for(let xt=0,yt=Math.min(pt.instanceCount,gt.count);xt<yt;xt++){_m.start.fromBufferAttribute(gt,xt),_m.end.fromBufferAttribute(At,xt),_m.applyMatrix4(ct);const _t=new _.Pa4,Mt=new _.Pa4;dA.distanceSqToSegment(_m.start,_m.end,Mt,_t),Mt.distanceTo(_t)<.5*HE&&at.push({point:Mt,pointOnLine:_t,distance:dA.origin.distanceTo(Mt),object:st,face:null,faceIndex:xt,uv:null,uv1:null})}}(this,i):function(st,at,ct){const pt=at.projectionMatrix,gt=st.material.resolution,At=st.matrixWorld,xt=st.geometry,yt=xt.attributes.instanceStart,_t=xt.attributes.instanceEnd,Mt=Math.min(xt.instanceCount,yt.count),It=-at.near;dA.at(1,uA),uA.w=1,uA.applyMatrix4(at.matrixWorldInverse),uA.applyMatrix4(pt),uA.multiplyScalar(1/uA.w),uA.x*=gt.x/2,uA.y*=gt.y/2,uA.z=0,tO.copy(uA),nO.multiplyMatrices(at.matrixWorldInverse,At);for(let Bt=0,Lt=Mt;Bt<Lt;Bt++){if(gm.fromBufferAttribute(yt,Bt),vm.fromBufferAttribute(_t,Bt),gm.w=1,vm.w=1,gm.applyMatrix4(nO),vm.applyMatrix4(nO),gm.z>It&&vm.z>It)continue;if(gm.z>It){const mn=gm.z-vm.z,cn=(gm.z-It)/mn;gm.lerp(vm,cn)}else if(vm.z>It){const mn=vm.z-gm.z,cn=(vm.z-It)/mn;vm.lerp(gm,cn)}gm.applyMatrix4(pt),vm.applyMatrix4(pt),gm.multiplyScalar(1/gm.w),vm.multiplyScalar(1/vm.w),gm.x*=gt.x/2,gm.y*=gt.y/2,vm.x*=gt.x/2,vm.y*=gt.y/2,_m.start.copy(gm),_m.start.z=0,_m.end.copy(vm),_m.end.z=0;const Ht=_m.closestPointToPointParameter(tO,!0);_m.at(Ht,a3);const Jt=_.M8C.lerp(gm.z,vm.z,Ht),sn=Jt>=-1&&Jt<=1,on=tO.distanceTo(a3)<.5*HE;if(sn&&on){_m.start.fromBufferAttribute(yt,Bt),_m.end.fromBufferAttribute(_t,Bt),_m.start.applyMatrix4(At),_m.end.applyMatrix4(At);const mn=new _.Pa4,cn=new _.Pa4;dA.distanceSqToSegment(_m.start,_m.end,cn,mn),ct.push({point:cn,pointOnLine:mn,distance:dA.origin.distanceTo(cn),object:st,face:null,faceIndex:Bt,uv:null,uv1:null})}}}(this,o,i)))}}class oI extends zy{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const i=e.length-3,s=new Float32Array(2*i);for(let o=0;o<i;o+=3)s[2*o]=e[o],s[2*o+1]=e[o+1],s[2*o+2]=e[o+2],s[2*o+3]=e[o+3],s[2*o+4]=e[o+4],s[2*o+5]=e[o+5];return super.setPositions(s),this}setColors(e){const i=e.length-3,s=new Float32Array(2*i);for(let o=0;o<i;o+=3)s[2*o]=e[o],s[2*o+1]=e[o+1],s[2*o+2]=e[o+2],s[2*o+3]=e[o+3],s[2*o+4]=e[o+4],s[2*o+5]=e[o+5];return super.setColors(s),this}fromLine(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}}class iO extends HP{constructor(e=new oI,i=new Ov({color:16777215*Math.random()})){super(e,i),this.isLine2=!0,this.type="Line2"}}class k4 extends _.DqL{constructor(e){super(e)}parse(e,i){const s=new B4(e,1);return{mipmaps:s.mipmaps(i),width:s.pixelWidth,height:s.pixelHeight,format:s.glInternalFormat,isCubemap:s.numberOfFaces===6,mipmapCount:s.numberOfMipmapLevels}}}class B4{constructor(e,i){this.arrayBuffer=e;const s=new Uint8Array(this.arrayBuffer,0,12);if(s[0]!==171||s[1]!==75||s[2]!==84||s[3]!==88||s[4]!==32||s[5]!==49||s[6]!==49||s[7]!==187||s[8]!==13||s[9]!==10||s[10]!==26||s[11]!==10)return void console.error("texture missing KTX identifier");const o=Uint32Array.BYTES_PER_ELEMENT,c=new DataView(this.arrayBuffer,12,13*o),g=c.getUint32(0,!0)===67305985;this.glType=c.getUint32(1*o,g),this.glTypeSize=c.getUint32(2*o,g),this.glFormat=c.getUint32(3*o,g),this.glInternalFormat=c.getUint32(4*o,g),this.glBaseInternalFormat=c.getUint32(5*o,g),this.pixelWidth=c.getUint32(6*o,g),this.pixelHeight=c.getUint32(7*o,g),this.pixelDepth=c.getUint32(8*o,g),this.numberOfArrayElements=c.getUint32(9*o,g),this.numberOfFaces=c.getUint32(10*o,g),this.numberOfMipmapLevels=c.getUint32(11*o,g),this.bytesOfKeyValueData=c.getUint32(12*o,g),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===i?this.loadType=0:console.warn("number of faces expected"+i+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const i=[];let s=64+this.bytesOfKeyValueData,o=this.pixelWidth,c=this.pixelHeight;const g=e?this.numberOfMipmapLevels:1;for(let b=0;b<g;b++){const et=new Int32Array(this.arrayBuffer,s,1)[0];s+=4;for(let tt=0;tt<this.numberOfFaces;tt++){const rt=new Uint8Array(this.arrayBuffer,s,et);i.push({data:rt,width:o,height:c}),s+=et,s+=3-(et+3)%4}o=Math.max(1,.5*o),c=Math.max(1,.5*c)}return i}}class rO extends _e.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Lr]}async onAdded(e){var i,s;this._importer||(this._importer=new yl(k4,["ktx"],!1)),(s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var i,s;this._importer&&((s=(i=e.getManager())==null?void 0:i.importer)!=null&&s.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}rO.PluginType="KTXLoadPlugin";class O4 extends _.hH6{constructor(e){super(e),this.responseType="blob"}}class c3 extends _.hH6{constructor(e){super(e),this.responseType="blob"}load(e,i,s,o){return super.load(e,c=>{try{i==null||i((0,_e.blobToDataURL)(c))}catch(g){o==null||o(g)}},s,o)}}class u3{async parseAsync(e,i){return new Blob([JSON.stringify(e,null,i.jsonSpaces??2)],{type:"application/json"})}}class h3{async parseAsync(e,i){return new Blob([e],{type:"text/plain"})}}const d3={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class QP{constructor(){this.pluginCallbacks=[],this.register(function(e){return new N4(e)}),this.register(function(e){return new U4(e)}),this.register(function(e){return new z4(e)}),this.register(function(e){return new V4(e)}),this.register(function(e){return new G4(e)}),this.register(function(e){return new H4(e)}),this.register(function(e){return new F4(e)}),this.register(function(e){return new j4(e)}),this.register(function(e){return new Q4(e)}),this.register(function(e){return new W4(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,o,c){const g=c||new v3,b=[];for(let et=0,tt=this.pluginCallbacks.length;et<tt;et++)b.push(this.pluginCallbacks[et](g));g.setPlugins(b),g.write(e,i,o).catch(s)}parseAsync(e,i){const s=this;return new Promise(function(o,c){s.parse(e,o,c,i)})}}const sO=5120,oO=5121,aO=5122,lO=5123,cO="KHR_mesh_quantization",M_={};M_[_.TyD]=9728,M_[_.YLQ]=9984,M_[_.aH4]=9986,M_[_.wem]=9729,M_[_.qyh]=9985,M_[_.D1R]=9987,M_[_.uWy]=33071,M_[_.rpg]=10497,M_[_.OoA]=33648;const p3={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},L4=new _.Ilk;function aI(h,e){return h.length===e.length&&h.every(function(i,s){return i===e[s]})}function f3(h){return 4*Math.ceil(h/4)}function WP(h,e=0){const i=f3(h.byteLength);if(i!==h.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(h)),e!==0)for(let o=h.byteLength;o<i;o++)s[o]=e;return s.buffer}return h}function m3(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function g3(h,e){if(h.toBlob!==void 0)return new Promise(s=>h.toBlob(s,e));let i;return e==="image/jpeg"?i=.92:e==="image/webp"&&(i=.8),h.convertToBlob({type:e,quality:i})}class v3{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,i,s={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const o=this,c=o.buffers,g=o.json;s=o.options;const b=o.extensionsUsed,et=o.extensionsRequired,tt=new Blob(c,{type:"application/octet-stream"}),rt=Object.keys(b),st=Object.keys(et);if(rt.length>0&&(g.extensionsUsed=rt),st.length>0&&(g.extensionsRequired=st),g.buffers&&g.buffers.length>0&&(g.buffers[0].byteLength=tt.size),s.binary===!0){const at=new FileReader;at.readAsArrayBuffer(tt),at.onloadend=function(){const ct=WP(at.result),pt=new DataView(new ArrayBuffer(8));pt.setUint32(0,ct.byteLength,!0),pt.setUint32(4,5130562,!0);const gt=WP((At=JSON.stringify(g),new TextEncoder().encode(At).buffer),32);var At;const xt=new DataView(new ArrayBuffer(8));xt.setUint32(0,gt.byteLength,!0),xt.setUint32(4,1313821514,!0);const yt=new ArrayBuffer(12),_t=new DataView(yt);_t.setUint32(0,1179937895,!0),_t.setUint32(4,2,!0);const Mt=12+xt.byteLength+gt.byteLength+pt.byteLength+ct.byteLength;_t.setUint32(8,Mt,!0);const It=new Blob([yt,xt,gt,pt,ct],{type:"application/octet-stream"}),Bt=new FileReader;Bt.readAsArrayBuffer(It),Bt.onloadend=function(){i(Bt.result)}}}else if(g.buffers&&g.buffers.length>0){const at=new FileReader;at.readAsDataURL(tt),at.onloadend=function(){const ct=at.result;g.buffers[0].uri=ct,i(g)}}else i(g)}serializeUserData(e,i){if(Object.keys(e.userData).length===0)return;const s=this.options,o=this.extensionsUsed;try{const c=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&c.gltfExtensions){i.extensions===void 0&&(i.extensions={});for(const g in c.gltfExtensions)i.extensions[g]=c.gltfExtensions[g],o[g]=!0;delete c.gltfExtensions}Object.keys(c).length>0&&(i.extras=c)}catch(c){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+c.message),console.warn({...e.userData})}}getUID(e,i=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(i)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new _.Pa4;for(let s=0,o=e.count;s<o;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const i=this.cache;if(i.attributesNormalized.has(e))return i.attributesNormalized.get(e);const s=e.clone(),o=new _.Pa4;for(let c=0,g=s.count;c<g;c++)o.fromBufferAttribute(s,c),o.x===0&&o.y===0&&o.z===0?o.setX(1):o.normalize(),s.setXYZ(c,o.x,o.y,o.z);return i.attributesNormalized.set(e,s),s}applyTextureTransform(e,i){let s=!1;const o={};i.offset.x===0&&i.offset.y===0||(o.offset=i.offset.toArray(),s=!0),i.rotation!==0&&(o.rotation=i.rotation,s=!0),i.repeat.x===1&&i.repeat.y===1||(o.scale=i.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=o,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,i){if(e===i)return e;function s(at){return at.colorSpace===_.KI_?function(ct){return ct<.04045?.0773993808*ct:Math.pow(.9478672986*ct+.0521327014,2.4)}:function(ct){return ct}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const o=e?e.image:null,c=i?i.image:null,g=Math.max(o?o.width:0,c?c.width:0),b=Math.max(o?o.height:0,c?c.height:0),et=m3();et.width=g,et.height=b;const tt=et.getContext("2d");tt.fillStyle="#00ffff",tt.fillRect(0,0,g,b);const rt=tt.getImageData(0,0,g,b);if(o){tt.drawImage(o,0,0,g,b);const at=s(e),ct=tt.getImageData(0,0,g,b).data;for(let pt=2;pt<ct.length;pt+=4)rt.data[pt]=256*at(ct[pt]/256)}if(c){tt.drawImage(c,0,0,g,b);const at=s(i),ct=tt.getImageData(0,0,g,b).data;for(let pt=1;pt<ct.length;pt+=4)rt.data[pt]=256*at(ct[pt]/256)}tt.putImageData(rt,0,0);const st=(e||i).clone();return st.source=new _.Hw6(et),st.colorSpace=_.aCh,st.channel=(e||i).channel,e&&i&&e.channel!==i.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),st}processBuffer(e){const i=this.json,s=this.buffers;return i.buffers||(i.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,i,s,o,c){const g=this.json;let b;switch(g.bufferViews||(g.bufferViews=[]),i){case sO:case oO:b=1;break;case aO:case lO:b=2;break;default:b=4}const et=f3(o*e.itemSize*b),tt=new DataView(new ArrayBuffer(et));let rt=0;for(let at=s;at<s+o;at++)for(let ct=0;ct<e.itemSize;ct++){let pt;e.itemSize>4?pt=e.array[at*e.itemSize+ct]:(ct===0?pt=e.getX(at):ct===1?pt=e.getY(at):ct===2?pt=e.getZ(at):ct===3&&(pt=e.getW(at)),e.normalized===!0&&(pt=_.M8C.normalize(pt,e.array))),i===5126?tt.setFloat32(rt,pt,!0):i===5124?tt.setInt32(rt,pt,!0):i===5125?tt.setUint32(rt,pt,!0):i===aO?tt.setInt16(rt,pt,!0):i===lO?tt.setUint16(rt,pt,!0):i===sO?tt.setInt8(rt,pt):i===oO&&tt.setUint8(rt,pt),rt+=b}const st={buffer:this.processBuffer(tt.buffer),byteOffset:this.byteOffset,byteLength:et};return c!==void 0&&(st.target=c),c===34962&&(st.byteStride=e.itemSize*b),this.byteOffset+=et,g.bufferViews.push(st),{id:g.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const i=this,s=i.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(o){const c=new FileReader;c.readAsArrayBuffer(e),c.onloadend=function(){const g=WP(c.result),b={buffer:i.processBuffer(g),byteOffset:i.byteOffset,byteLength:g.byteLength};i.byteOffset+=g.byteLength,o(s.bufferViews.push(b)-1)}})}processBufferViewImageBuffer(e){const i=this,s=i.json;s.bufferViews||(s.bufferViews=[]),e=WP(e);const o={buffer:i.processBuffer(e),byteOffset:i.byteOffset,byteLength:e.byteLength};return i.byteOffset+=e.byteLength,s.bufferViews.push(o)-1}processAccessor(e,i,s,o){const c=this.json;let g;if(e.array.constructor===Float32Array)g=5126;else if(e.array.constructor===Int32Array)g=5124;else if(e.array.constructor===Uint32Array)g=5125;else if(e.array.constructor===Int16Array)g=aO;else if(e.array.constructor===Uint16Array)g=lO;else if(e.array.constructor===Int8Array)g=sO;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");g=oO}if(s===void 0&&(s=0),o===void 0&&(o=e.count),o===0)return null;const b=function(st,at,ct){const pt={min:new Array(st.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(st.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let gt=at;gt<at+ct;gt++)for(let At=0;At<st.itemSize;At++){let xt;st.itemSize>4?xt=st.array[gt*st.itemSize+At]:(At===0?xt=st.getX(gt):At===1?xt=st.getY(gt):At===2?xt=st.getZ(gt):At===3&&(xt=st.getW(gt)),st.normalized===!0&&(xt=_.M8C.normalize(xt,st.array))),pt.min[At]=Math.min(pt.min[At],xt),pt.max[At]=Math.max(pt.max[At],xt)}return pt}(e,s,o);let et;i!==void 0&&(et=e===i.index?34963:34962);const tt=this.processBufferView(e,g,s,o,et),rt={bufferView:tt.id,byteOffset:tt.byteOffset,componentType:g,count:o,max:b.max,min:b.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return e.normalized===!0&&(rt.normalized=!0),c.accessors||(c.accessors=[]),c.accessors.push(rt)-1}processImage(e,i,s,o="image/png",c=void 0,g=void 0){if(e!==null){const b=this,et=b.cache,tt=b.json,rt=b.options,st=b.pending;et.images.has(e)||et.images.set(e,{});const at=et.images.get(e),ct=o+":flipY/"+s.toString()+(c||g?";"+c+";"+g:"");if(at[ct]!==void 0)return at[ct];tt.images||(tt.images=[]);const pt={mimeType:o},gt=m3();gt.width=Math.min(c||e.width,rt.maxTextureSize),gt.height=Math.min(g||e.height,rt.maxTextureSize);const At=gt.getContext("2d");if(s===!0&&(At.translate(0,gt.height),At.scale(1,-1)),e.data!==void 0){i!==_.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>rt.maxTextureSize||e.height>rt.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const yt=new Uint8ClampedArray(e.height*e.width*4);for(let _t=0;_t<yt.length;_t+=4)yt[_t+0]=e.data[_t+0],yt[_t+1]=e.data[_t+1],yt[_t+2]=e.data[_t+2],yt[_t+3]=e.data[_t+3];At.putImageData(new ImageData(yt,e.width,e.height),0,0)}else At.drawImage(e,0,0,gt.width,gt.height);rt.binary===!0?st.push(g3(gt,o).then(yt=>b.processBufferViewImage(yt)).then(yt=>{pt.bufferView=yt})):gt.toDataURL!==void 0?pt.uri=gt.toDataURL(o):st.push(g3(gt,o).then(yt=>new FileReader().readAsDataURL(yt)).then(yt=>{pt.uri=yt}));const xt=tt.images.push(pt)-1;return at[ct]=xt,xt}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const i=this.json;i.samplers||(i.samplers=[]);const s={magFilter:M_[e.magFilter],minFilter:M_[e.minFilter],wrapS:M_[e.wrapS],wrapT:M_[e.wrapT]};return i.samplers.push(s)-1}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);s.textures||(s.textures=[]);let o=e.userData.mimeType;o==="image/webp"&&(o="image/png"),o==="image/jpg"&&(o="image/jpeg");const c={sampler:this.processSampler(e),source:!o||["image/jpeg","image/png"].includes(o)?this.processImage(e.image,e.format,e.flipY,o):null};e.name&&(c.name=e.name),this._invokeAll(function(b){b.writeTexture&&b.writeTexture(e,c)}),c.source===null&&console.error("GLTFExporter: Unsupported mime type: "+o+". Cannot export texture.",e);const g=s.textures.push(c)-1;return i.textures.set(e,g),g}processMaterial(e){const i=this.cache,s=this.json;if(i.materials.has(e))return i.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const o={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const c=e.color.toArray().concat([e.opacity]);if(aI(c,[1,1,1,1])||(o.pbrMetallicRoughness.baseColorFactor=c),e.isMeshStandardMaterial?(o.pbrMetallicRoughness.metallicFactor=e.metalness,o.pbrMetallicRoughness.roughnessFactor=e.roughness):(o.pbrMetallicRoughness.metallicFactor=.5,o.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const b=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),et={index:this.processTexture(b),channel:b.channel};this.applyTextureTransform(et,b),o.pbrMetallicRoughness.metallicRoughnessTexture=et}if(e.map){const b={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(b,e.map),o.pbrMetallicRoughness.baseColorTexture=b}if(e.emissive){const b=e.emissive;if(Math.max(b.r,b.g,b.b)>0&&(o.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const et={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(et,e.emissiveMap),o.emissiveTexture=et}}if(e.normalMap){const b={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(b.scale=e.normalScale.x),this.applyTextureTransform(b,e.normalMap),o.normalTexture=b}if(e.aoMap){const b={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(b.strength=e.aoMapIntensity),this.applyTextureTransform(b,e.aoMap),o.occlusionTexture=b}e.transparent?o.alphaMode="BLEND":e.alphaTest>0&&(o.alphaMode="MASK",o.alphaCutoff=e.alphaTest),e.side===_.ehD&&(o.doubleSided=!0),e.name!==""&&(o.name=e.name),this.serializeUserData(e,o),this._invokeAll(function(b){b.writeMaterial&&b.writeMaterial(e,o)});const g=s.materials.push(o)-1;return i.materials.set(e,g),g}processMesh(e){const i=this.cache,s=this.json,o=[e.geometry.uuid];if(Array.isArray(e.material))for(let _t=0,Mt=e.material.length;_t<Mt;_t++)o.push(e.material[_t].uuid);else o.push(e.material.uuid);const c=o.join(":");if(i.meshes.has(c))return i.meshes.get(c);const g=e.geometry;let b;b=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const et={},tt={},rt=[],st=[],at={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},ct=g.getAttribute("normal");ct===void 0||this.isNormalizedNormalAttribute(ct)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),g.setAttribute("normal",this.createNormalizedNormalAttribute(ct)));let pt=null;for(let _t in g.attributes){if(_t.slice(0,5)==="morph")continue;const Mt=g.attributes[_t];if(_t=at[_t]||_t.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(_t)||(_t="_"+_t),i.attributes.has(this.getUID(Mt))){tt[_t]=i.attributes.get(this.getUID(Mt));continue}pt=null;const It=Mt.array;_t!=="JOINTS_0"||It instanceof Uint16Array||It instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),pt=new _.TlE(new Uint16Array(It),Mt.itemSize,Mt.normalized));const Bt=this.processAccessor(pt||Mt,g);Bt!==null&&(_t.startsWith("_")||this.detectMeshQuantization(_t,Mt),tt[_t]=Bt,i.attributes.set(this.getUID(Mt),Bt))}if(ct!==void 0&&g.setAttribute("normal",ct),Object.keys(tt).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const _t=[],Mt=[],It={};if(e.morphTargetDictionary!==void 0)for(const Bt in e.morphTargetDictionary)It[e.morphTargetDictionary[Bt]]=Bt;for(let Bt=0;Bt<e.morphTargetInfluences.length;++Bt){const Lt={};let Ht=!1;for(const Jt in g.morphAttributes){if(Jt!=="position"&&Jt!=="normal"){Ht||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),Ht=!0);continue}const sn=g.morphAttributes[Jt][Bt],on=Jt.toUpperCase(),mn=g.attributes[Jt];if(i.attributes.has(this.getUID(sn,!0))){Lt[on]=i.attributes.get(this.getUID(sn,!0));continue}const cn=sn.clone();if(!g.morphTargetsRelative)for(let un=0,bn=sn.count;un<bn;un++)for(let xn=0;xn<sn.itemSize;xn++)xn===0&&cn.setX(un,sn.getX(un)-mn.getX(un)),xn===1&&cn.setY(un,sn.getY(un)-mn.getY(un)),xn===2&&cn.setZ(un,sn.getZ(un)-mn.getZ(un)),xn===3&&cn.setW(un,sn.getW(un)-mn.getW(un));Lt[on]=this.processAccessor(cn,g),i.attributes.set(this.getUID(mn,!0),Lt[on])}st.push(Lt),_t.push(e.morphTargetInfluences[Bt]),e.morphTargetDictionary!==void 0&&Mt.push(It[Bt])}et.weights=_t,Mt.length>0&&(et.extras={},et.extras.targetNames=Mt)}const gt=Array.isArray(e.material);if(gt&&g.groups.length===0)return null;const At=gt?e.material:[e.material],xt=gt?g.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let _t=0,Mt=xt.length;_t<Mt;_t++){const It={mode:b,attributes:tt};if(this.serializeUserData(g,It),st.length>0&&(It.targets=st),g.index!==null){let Lt=this.getUID(g.index);xt[_t].start===void 0&&xt[_t].count===void 0||(Lt+=":"+xt[_t].start+":"+xt[_t].count),i.attributes.has(Lt)?It.indices=i.attributes.get(Lt):(It.indices=this.processAccessor(g.index,g,xt[_t].start,xt[_t].count),i.attributes.set(Lt,It.indices)),It.indices===null&&delete It.indices}const Bt=this.processMaterial(At[xt[_t].materialIndex]);Bt!==null&&(It.material=Bt),rt.push(It)}et.primitives=rt,s.meshes||(s.meshes=[]),this._invokeAll(function(_t){_t.writeMesh&&_t.writeMesh(e,et)});const yt=s.meshes.push(et)-1;return i.meshes.set(c,yt),yt}detectMeshQuantization(e,i){if(this.extensionsUsed[cO])return;let s;switch(i.array.constructor){case Int8Array:s="byte";break;case Uint8Array:s="unsigned byte";break;case Int16Array:s="short";break;case Uint16Array:s="unsigned short";break;default:return}i.normalized&&(s+=" normalized");const o=e.split("_",1)[0];d3[o]&&d3[o].includes(s)&&(this.extensionsUsed[cO]=!0,this.extensionsRequired[cO]=!0)}processCamera(e){const i=this.json;i.cameras||(i.cameras=[]);const s=e.isOrthographicCamera,o={type:s?"orthographic":"perspective"};return s?o.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:o.perspective={aspectRatio:e.aspect,yfov:_.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(o.name=e.type),i.cameras.push(o)-1}processAnimation(e,i){const s=this.json,o=this.nodeMap;s.animations||(s.animations=[]);const c=(e=QP.Utils.mergeMorphTargetTracks(e.clone(),i)).tracks,g=[],b=[];for(let et=0;et<c.length;++et){const tt=c[et],rt=_.iUV.parseTrackName(tt.name);let st=_.iUV.findNode(i,rt.nodeName);const at=p3[rt.propertyName];if(rt.objectName==="bones"&&(st=st.isSkinnedMesh===!0?st.skeleton.getBoneByName(rt.objectIndex):void 0),!st||!at)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',tt.name),null;const ct=1;let pt,gt=tt.values.length/tt.times.length;at===p3.morphTargetInfluences&&(gt/=st.morphTargetInfluences.length),tt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(pt="CUBICSPLINE",gt/=3):pt=tt.getInterpolation()===_.Syv?"STEP":"LINEAR",b.push({input:this.processAccessor(new _.TlE(tt.times,ct)),output:this.processAccessor(new _.TlE(tt.values,gt)),interpolation:pt}),g.push({sampler:b.length-1,target:{node:o.get(st),path:at}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:b,channels:g}),s.animations.length-1}processSkin(e){const i=this.json,s=this.nodeMap,o=i.nodes[s.get(e)],c=e.skeleton;if(c===void 0)return null;const g=e.skeleton.bones[0];if(g===void 0)return null;const b=[],et=new Float32Array(16*c.bones.length),tt=new _.yGw;for(let rt=0;rt<c.bones.length;++rt)b.push(s.get(c.bones[rt])),tt.copy(c.boneInverses[rt]),tt.multiply(e.bindMatrix).toArray(et,16*rt);return i.skins===void 0&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new _.TlE(et,16)),joints:b,skeleton:s.get(g)}),o.skin=i.skins.length-1}processNode(e){const i=this.json,s=this.options,o=this.nodeMap;i.nodes||(i.nodes=[]);const c={};if(s.trs){const b=e.quaternion.toArray(),et=e.position.toArray(),tt=e.scale.toArray();aI(b,[0,0,0,1])||(c.rotation=b),aI(et,[0,0,0])||(c.translation=et),aI(tt,[1,1,1])||(c.scale=tt)}else e.matrixAutoUpdate&&e.updateMatrix(),aI(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(c.matrix=e.matrix.elements);if(e.name!==""&&(c.name=String(e.name)),this.serializeUserData(e,c),e.isMesh||e.isLine||e.isPoints){const b=this.processMesh(e);b!==null&&(c.mesh=b)}else e.isCamera&&(c.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const b=[];for(let et=0,tt=e.children.length;et<tt;et++){const rt=e.children[et];if(rt.visible||s.onlyVisible===!1){const st=this.processNode(rt);st!==null&&b.push(st)}}b.length>0&&(c.children=b)}this._invokeAll(function(b){b.writeNode&&b.writeNode(e,c)});const g=i.nodes.push(c)-1;return o.set(e,g),g}processScene(e){const i=this.json,s=this.options;i.scenes||(i.scenes=[],i.scene=0);const o={};e.name!==""&&(o.name=e.name),i.scenes.push(o);const c=[];for(let g=0,b=e.children.length;g<b;g++){const et=e.children[g];if(et.visible||s.onlyVisible===!1){const tt=this.processNode(et);tt!==null&&c.push(tt)}}c.length>0&&(o.nodes=c),this.serializeUserData(e,o)}processObjects(e){const i=new _.xsS;i.name="AuxScene";for(let s=0;s<e.length;s++)i.children.push(e[s]);this.processScene(i)}processInput(e){const i=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(o){o.beforeParse&&o.beforeParse(e)});const s=[];for(let o=0;o<e.length;o++)e[o]instanceof _.xsS?this.processScene(e[o]):s.push(e[o]);s.length>0&&this.processObjects(s);for(let o=0;o<this.skins.length;++o)this.processSkin(this.skins[o]);for(let o=0;o<i.animations.length;++o)this.processAnimation(i.animations[o],e[0]);this._invokeAll(function(o){o.afterParse&&o.afterParse(e)})}_invokeAll(e){for(let i=0,s=this.plugins.length;i<s;i++)e(this.plugins[i])}}class N4{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,i){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const s=this.writer,o=s.json,c=s.extensionsUsed,g={};e.name&&(g.name=e.name),g.color=e.color.toArray(),g.intensity=e.intensity,e.isDirectionalLight?g.type="directional":e.isPointLight?(g.type="point",e.distance>0&&(g.range=e.distance)):e.isSpotLight&&(g.type="spot",e.distance>0&&(g.range=e.distance),g.spot={},g.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,g.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),c[this.name]||(o.extensions=o.extensions||{},o.extensions[this.name]={lights:[]},c[this.name]=!0);const b=o.extensions[this.name].lights;b.push(g),i.extensions=i.extensions||{},i.extensions[this.name]={light:b.length-1}}}class U4{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,i){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;i.extensions=i.extensions||{},i.extensions[this.name]={},s[this.name]=!0,i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=.9}}class F4{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.clearcoatFactor=e.clearcoat,e.clearcoatMap){const g={index:s.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};s.applyTextureTransform(g,e.clearcoatMap),c.clearcoatTexture=g}if(c.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const g={index:s.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};s.applyTextureTransform(g,e.clearcoatRoughnessMap),c.clearcoatRoughnessTexture=g}if(e.clearcoatNormalMap){const g={index:s.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};s.applyTextureTransform(g,e.clearcoatNormalMap),c.clearcoatNormalTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class j4{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.iridescenceFactor=e.iridescence,e.iridescenceMap){const g={index:s.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};s.applyTextureTransform(g,e.iridescenceMap),c.iridescenceTexture=g}if(c.iridescenceIor=e.iridescenceIOR,c.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],c.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const g={index:s.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};s.applyTextureTransform(g,e.iridescenceThicknessMap),c.iridescenceThicknessTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class z4{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.transmissionFactor=e.transmission,e.transmissionMap){const g={index:s.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};s.applyTextureTransform(g,e.transmissionMap),c.transmissionTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class V4{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.thicknessFactor=e.thickness,e.thicknessMap){const g={index:s.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};s.applyTextureTransform(g,e.thicknessMap),c.thicknessTexture=g}c.attenuationDistance=e.attenuationDistance,c.attenuationColor=e.attenuationColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class G4{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const s=this.writer.extensionsUsed,o={};o.ior=e.ior,i.extensions=i.extensions||{},i.extensions[this.name]=o,s[this.name]=!0}}class H4{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(L4)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const s=this.writer,o=s.extensionsUsed,c={};if(e.specularIntensityMap){const g={index:s.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};s.applyTextureTransform(g,e.specularIntensityMap),c.specularTexture=g}if(e.specularColorMap){const g={index:s.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};s.applyTextureTransform(g,e.specularColorMap),c.specularColorTexture=g}c.specularFactor=e.specularIntensity,c.specularColorFactor=e.specularColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class Q4{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.sheen<.001)return;const s=this.writer,o=s.extensionsUsed,c={};if(e.sheenRoughnessMap){const g={index:s.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};s.applyTextureTransform(g,e.sheenRoughnessMap),c.sheenRoughnessTexture=g}if(e.sheenColorMap){const g={index:s.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};s.applyTextureTransform(g,e.sheenColorMap),c.sheenColorTexture=g}c.sheenRoughnessFactor=e.sheenRoughness,c.sheenColorFactor=e.sheenColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=c,i.extras=i.extras||{},i.extras.sheenFactor=e.sheen,o[this.name]=!0}}class W4{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const s=this.writer.extensionsUsed,o={};o.emissiveStrength=e.emissiveIntensity,i.extensions=i.extensions||{},i.extensions[this.name]=o,s[this.name]=!0}}QP.Utils={GLTFWriter:v3,insertKeyframe:function(h,e){const s=h.getValueSize(),o=new h.TimeBufferType(h.times.length+1),c=new h.ValueBufferType(h.values.length+s),g=h.createInterpolant(new h.ValueBufferType(s));let b;if(h.times.length===0){o[0]=e;for(let et=0;et<s;et++)c[et]=0;b=0}else if(e<h.times[0]){if(Math.abs(h.times[0]-e)<.001)return 0;o[0]=e,o.set(h.times,1),c.set(g.evaluate(e),0),c.set(h.values,s),b=0}else if(e>h.times[h.times.length-1]){if(Math.abs(h.times[h.times.length-1]-e)<.001)return h.times.length-1;o[o.length-1]=e,o.set(h.times,0),c.set(h.values,0),c.set(g.evaluate(e),h.values.length),b=o.length-1}else for(let et=0;et<h.times.length;et++){if(Math.abs(h.times[et]-e)<.001)return et;if(h.times[et]<e&&h.times[et+1]>e){o.set(h.times.slice(0,et+1),0),o[et+1]=e,o.set(h.times.slice(et+1),et+2),c.set(h.values.slice(0,(et+1)*s),0),c.set(g.evaluate(e),(et+1)*s),c.set(h.values.slice((et+1)*s),(et+2)*s),b=et+1;break}}return h.times=o,h.values=c,b},mergeMorphTargetTracks:function(h,e){const i=[],s={},o=h.tracks;for(let c=0;c<o.length;++c){let g=o[c];const b=_.iUV.parseTrackName(g.name),et=_.iUV.findNode(e,b.nodeName);if(b.propertyName!=="morphTargetInfluences"||b.propertyIndex===void 0){i.push(g);continue}if(g.createInterpolant!==g.InterpolantFactoryMethodDiscrete&&g.createInterpolant!==g.InterpolantFactoryMethodLinear){if(g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),g=g.clone(),g.setInterpolation(_.NMF)}const tt=et.morphTargetInfluences.length,rt=et.morphTargetDictionary[b.propertyIndex];if(rt===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+b.propertyIndex);let st;if(s[et.uuid]===void 0){st=g.clone();const ct=new st.ValueBufferType(tt*st.times.length);for(let pt=0;pt<st.times.length;pt++)ct[pt*tt+rt]=st.values[pt];st.name=(b.nodeName||"")+".morphTargetInfluences",st.values=ct,s[et.uuid]=st,i.push(st);continue}const at=g.createInterpolant(new g.ValueBufferType(1));st=s[et.uuid];for(let ct=0;ct<st.times.length;ct++)st.values[ct*tt+rt]=at.evaluate(st.times[ct]);for(let ct=0;ct<g.times.length;ct++){const pt=this.insertKeyframe(st,g.times[ct]);st.values[pt*tt+rt]=g.values[ct]}}return h.tracks=i,h}};class _3 extends QP.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new _.Wid}serializeUserData(e,i){const s=e.userData,o={};s.__disposed&&console.error("Serializing a disposed object",e),Object.entries(s).forEach(([g,b])=>{(!b||typeof b=="function"||b.isObject3D||b.isTexture||b.isMaterial||b.assetType!=null||g.startsWith("_")||g!=="uuid"&&(L_.includes(g)||_f.includes(g)||DA.includes(g)))&&(o[g]=b,delete s[g])});const c=To(s,!1);Object.entries(o).forEach(([g,b])=>{s[g]=b,delete o[g]}),e.userData=c,super.serializeUserData(e,i),e.userData=s}processObjects(e){var i;e.length===1&&((i=e[0])!=null&&i.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let i=e;i&&!i.isShaderMaterial||(i=this._defaultMaterial);const s=super.processMaterial(i);if(s===null)return console.error("GLTFWriter2: Unexpected error: Failed to process material",e),null;if(!e||i===e)return s;const o=JSON.stringify(this.json.materials[s]),c=JSON.parse(o);this.serializeUserData(e,c),this._invokeAll(b=>{b.writeMaterial&&b.writeMaterial(e,c)});const g=this.json.materials.push(c)-1;return this.cache.materials.set(e,g),g}processImageBlob(e,i){if(!e)return-1;const s=this.cache,o=this.options,c=this.pending,g=this.json,b=i.image;s.images.has(b)||s.images.set(b,{});const et=s.images.get(b),tt=e.type+":flipY/"+i.flipY.toString();if(et[tt]!==void 0)return et[tt];g.images||(g.images=[]);const rt={mimeType:e.type};o.binary===!0?c.push(new Promise(at=>{this.processBufferViewImage(e).then(ct=>{rt.bufferView=ct,at()})})):c.push((0,_e.blobToDataURL)(e).then(at=>{rt.uri=at}));const st=g.images.push(rt)-1;return et[tt]=st,st}processSampler(e){return super.processSampler(e)}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);const o=e.source.data,c=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))&&(e.source.data&&(!this.options.exporterOptions.embedUrlImagePreviews||e.isDataTexture?e.source.data=null:e.source.data._savePreview=!0),delete e.userData.mimeType);const g=super.processTexture(e),b=s.textures[g];if(!b)return console.error("No texture def",g,e),g;const et=s.images?s.images[b.source]:null;if(et&&(et.extras||(et.extras={}),e.source&&(et.extras.uuid=e.source.uuid),et.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))){if(e.source.data?delete e.source.data._savePreview:e.source.data=o,e.userData.mimeType=c,!b)return console.error("textureDef is null",g,e),g;if(b.source>=0){const tt=this.json.images[b.source];tt.uri?console.warn("uri already set",tt.uri):(tt.uri=e.userData.rootPath,tt.mimeType=c,tt.extras||(tt.extras={}),tt.extras.flipY=e.flipY,tt.extras.uri=e.userData.rootPath)}else b.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,c)}return b.source<0&&console.error("textureDef.source cannot be saved",b,e),g}processImage(e,i,s,o="image/png"){return e?super.processImage(e,i,s,o,e._savePreview?32:void 0,e._savePreview?32:void 0):-1}processImageUri(e,i,s,o="image/png"){const c=this.cache,g=this.json;c.images.has(e)||c.images.set(e,{});const b=c.images.get(e),et=o+":flipY/"+s.toString();if(b[et]!==void 0)return b[et];g.images||(g.images=[]);const tt={mimeType:o,uri:i,extras:{flipY:s}},rt=g.images.push(tt)-1;return b[et]=rt,rt}}function q4(h,e){(e=e??document.createElement("script")).type=h.type||"text/javascript",e.text=h.text;for(let i=0;i<h.attributes.length;i++){const s=h.attributes[i];e.setAttribute(s.name,s.value)}return e}function y3(h,e=0){const i=(s=h.byteLength,4*Math.ceil(s/4));var s;if(i!==h.byteLength){const o=new Uint8Array(i);if(o.set(new Uint8Array(h)),e!==0)for(let c=h.byteLength;c<i;c++)o[c]=e;return o.buffer}return h}ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(h,e){const i=new Uint8Array(this);e==null&&(e=i.length);const s=new ArrayBuffer(e-h),o=new Uint8Array(s);for(let c=0;c<o.length;c++)o[c]=i[c+h];return s});class uO extends QP{register(e){return super.register(e)}async parseAsync(e,i){if(!e)throw new Error("No object to export");const s=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((o,c)=>this.parse(e,o,c,i));if(s&&typeof s=="object"&&!s.byteLength)return new Blob([JSON.stringify(s,(o,c)=>o.startsWith("__")?void 0:c,i.jsonSpaces??2)],{type:"model/gltf+json"});if(s){let o=null;return i.encrypt&&(!i.encryptKey&&window.prompt&&(i.encryptKey=window.prompt("GLTFEncryption: Enter encryption key")||""),i.encryptKey?o=function(c,g){const b=y3(c),et=new DataView(new ArrayBuffer(8));et.setUint32(0,b.byteLength,!0),et.setUint32(4,5130562,!0);const tt=y3(new TextEncoder().encode(JSON.stringify({asset:{version:"2.0",generator:"WebGiGLBWrapper",encryption:{type:"aesgcm",version:1}}})).buffer,32),rt=new DataView(new ArrayBuffer(8));rt.setUint32(0,tt.byteLength,!0),rt.setUint32(4,1313821514,!0);const st=new ArrayBuffer(12),at=new DataView(st);at.setUint32(0,1179937895,!0),at.setUint32(4,2,!0);const ct=12+rt.byteLength+tt.byteLength+et.byteLength+b.byteLength;at.setUint32(8,ct,!0);const pt=new Blob([st,rt,tt,et,b],{type:"application/octet-stream"});return pt.ext="glb",pt}(await(0,_e.aesGcmEncrypt)(new Uint8Array(s),i.encryptKey)):console.warn("GLTF Export: encryption key not provided, skipping encryption")),o||(o=new Blob([s],{type:"model/gltf+binary"})),o}throw new Error("GLTFExporter2.parse() failed")}parse(e,i,s,o={}){const c={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!o.embedUrlImages&&o.externalImagesInExtras||!1,embedUrlImages:o.embedUrlImages??!1,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0,exporterOptions:o};return o.exportExt==="glb"&&(c.binary=!0),o.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(g=>g.traverse(b=>{b.uuid&&(b.userData.gltfUUID=b.uuid)})),(Array.isArray(e)?e:[e]).forEach(g=>g.traverse(b=>{if(b.animations)for(const et of b.animations)et.__gltfExport===!1||c.animations.includes(et)||c.animations.push(...b.animations)})),super.parse(e,g=>{o.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(b=>b.traverse(et=>{delete et.userData.gltfUUID})),i(Object.assign(g,{__isGLTFOutput:!0}))},s,c,new _3)}}function A3(h,e){const i=h.getPlugin(Lr).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&i.resources.textures&&[...Object.entries(i.resources.textures)].forEach(([o,c])=>{e.json.textures.find(b=>{var et,tt,rt,st,at;return((et=b.extras)==null?void 0:et.uuid)===o||((rt=(tt=e.json.samplers[b.sampler])==null?void 0:tt.extras)==null?void 0:rt.uuid)===o||((at=(st=e.json.images[b.source])==null?void 0:st.extras)==null?void 0:at.t_uuid)===o})&&(c.image&&i.resources.images&&i.resources.images[c.image]&&delete i.resources.images[c.image],i.resources.textures[o]={})}),e.json.materials&&i.resources.materials&&[...Object.entries(i.resources.materials)].forEach(([o,c])=>{e.json.materials.find(g=>{var b;return((b=g.extras)==null?void 0:b.uuid)===o})&&(i.resources.materials[o]={})});const s=[];Object.values(i.resources).forEach(o=>{o&&Object.values(o).forEach(c=>{c.url&&(c.url.type==="Uint16Array"&&c.url.data?(c.url.data instanceof Uint16Array||(c.url.data=new Uint16Array(c.url.data)),s.push(c.url)):c.url.type==="Uint8Array"&&c.url.data&&(c.url.data instanceof Uint8Array||(c.url.data=new Uint8Array(c.url.data)),s.push(c.url)))})});for(const o of s){let c="application/octet-stream";if(o.mimeType&&(c=o.mimeType),e.options.exporterOptions.encodeUint16Rgbe&&o.type==="Uint16Array"&&o.width>0&&o.height>0){const tt=X4(o.data,4),rt=new ImageData(tt,o.width,o.height),st=_.PpQ.getDataURL(rt,!0).split(",")[1],at=2;c="image/png",at===1||(o.data=Uint8Array.from(atob(st),ct=>ct.charCodeAt(0))),o.encoding="rgbe",o.encodingVersion=at}e.json.images||(e.json.images=[]);const g={mimeType:c},b=e.json.images.push(g)-1,et=o.data;g.bufferView=e.processBufferViewImageBuffer(et),o.data={image:b}}return i}function X4(h,e=3,i){let s,o,c,g,b;const et=h.byteLength/(2*e)|0;i=i||new Uint8ClampedArray(4*et);for(let tt=0;tt<et;tt++){s=h[tt*e],o=h[tt*e+1],c=h[tt*e+2],g=Math.max(Math.max(s,o),c);const rt=Math.ceil(Math.log2(g));b=Math.pow(2,rt-8),i[4*tt]=s/b|0,i[4*tt+1]=o/b|0,i[4*tt+2]=c/b|0,i[4*tt+3]=rt+128}return i}function hO(h,e,i=uO,s){if(!e)return;const o=h.Exporters.findIndex(g=>g.ext.includes("gltf")||g.ext.includes("glb")),c=[];o>=0?(c.push(...h.Exporters[o].extensions??[]),h.Exporters.splice(o,1)):(c.push(J4),c.push(K4),c.push(Y4),c.push(g=>new rx(g)),c.push(g=>new $4(g)),c.push(g=>new Z4(g)),c.push(g=>new e5(g)),c.push(g=>new t5(g))),h.Exporters.push({ctor:()=>{const g=new i;return c.forEach(b=>g.register(b)),g.register(b=>({afterParse:et=>{var rt,st;if(et=Array.isArray(et)?et[0]:et,!((rt=et==null?void 0:et.userData)!=null&&rt.rootSceneModelRoot)||((st=et==null?void 0:et.userData)==null?void 0:st.__exportViewerConfig)===!1)return;const tt=b.json.scenes[b.json.scene||0];tt.extensions||(tt.extensions={}),tt.extensions[iu]=A3(e,b),b.extensionsUsed[iu]=!0}})),s==null||s(g),g},ext:["gltf","glb"],extensions:c})}const Y4=h=>({writeNode:(e,i)=>{if(!(e!=null&&e.isLight))return;i.extensions||(i.extensions={});const s={};e.shadow&&(s.shadow=e.shadow.toJSON()),Object.keys(s).length>0&&(i.extensions[Rm]=s,h.extensionsUsed[Rm]=!0)}}),K4=h=>({writeNode:(e,i)=>{if(!(e!=null&&e.isObject3D))return;i.extensions||(i.extensions={});const s={};e.castShadow!==void 0&&(s.castShadow=e.castShadow),e.receiveShadow!==void 0&&(s.receiveShadow=e.receiveShadow),e.visible===!1&&(s.visible=!1),e.frustumCulled===!1&&(s.frustumCulled=!1),e.renderOrder!==0&&(s.renderOrder=e.renderOrder),e.layers.mask!==1&&(s.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),Object.keys(s).length>0&&(i.extensions[qu]=s,h.extensionsUsed[qu]=!0)}}),J4=h=>({writeMaterial(e,i){if(!(e!=null&&e.isMaterial))return;i.extensions||(i.extensions={});const s={};e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.side!==void 0&&e.side!==_.ehD&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(s.depthFunc=e.depthFunc),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.vertexColors!==void 0&&(s.vertexColors=e.vertexColors),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.normalScale!==void 0&&(s.normalScale=[e.normalScale.x,e.normalScale.y]);const o=this.materialExternalResources[e.uuid];o&&Object.entries(o).forEach(([c,g])=>{var b;c.startsWith("_")||(g!=null&&g.userData&&(g.userData.__embedUrlImagePreviews=(b=h.options.exporterOptions)==null?void 0:b.embedUrlImagePreviews),s[c]=To(g,!1,this.serializedMeta),g!=null&&g.userData&&delete g.userData.__embedUrlImagePreviews)}),Object.keys(s).length>0&&(i.extensions[Ru]=s,h.extensionsUsed[Ru]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!h.options.externalImagesInExtras)return;const i=[];(Array.isArray(e)?e:[e]).forEach(s=>{s==null||s.traverse(o=>{var c;o&&((c=o.material)!=null&&c.isMaterial)&&i.push(o.material)})}),i.forEach(s=>{s&&(this.materialExternalResources[s.uuid]||(this.materialExternalResources[s.uuid]={}),this.materialExternalResources[s.uuid].__materialRef=s,Object.entries(s).forEach(([o,c])=>{o.startsWith("_")||c&&c.isTexture&&c.userData.rootPath&&(c.userData.rootPath.startsWith("http")||c.userData.rootPath.startsWith("data:"))&&(s[o]=null,this.materialExternalResources[s.uuid][o]=c)}))})},afterParse(e){const i=Object.values(this.materialExternalResources);if(i.length<1)return;i.forEach(o=>{const c=o.__materialRef;c&&(Object.entries(o).forEach(([g,b])=>{g.startsWith("_")||b&&(c[g]=b)}),delete this.materialExternalResources[c.uuid])});const s=h.json.scenes[h.json.scene||0];s.extensions||(s.extensions={}),s.extensions[Ru]={resources:this.serializedMeta},h.extensionsUsed[Ru]=!0}});class $4{constructor(e){this.writer=e,this.name=E0}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.bumpScale=e.bumpScale,e.bumpMap){const g={index:s.processTexture(e.bumpMap)};s.applyTextureTransform(g,e.bumpMap),c.bumpTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class Z4{constructor(e){this.writer=e,this.name=Ev}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.displacementScale=e.displacementScale,c.displacementBias=e.displacementBias,e.displacementMap){const g={index:s.processTexture(e.displacementMap)};s.applyTextureTransform(g,e.displacementMap),c.displacementTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class e5{constructor(e){this.writer=e,this.name=_x}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.lightMapIntensity=e.lightMapIntensity,e.lightMap){const g={index:s.processTexture(e.lightMap)};s.applyTextureTransform(g,e.lightMap),c.lightMapTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class t5{constructor(e){this.writer=e,this.name=j_}writeMaterial(e,i){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const s=this.writer,o=s.extensionsUsed,c={};if(e.alphaMap){const g={index:s.processTexture(e.alphaMap)};s.applyTextureTransform(g,e.alphaMap),c.alphaTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}const n5=new TextEncoder;class i5{parse(e,i,s){if(!function(et,tt){if(tt.isWebGLRenderTarget&&(!et||!et.isWebGLRenderer))return console.error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer."),!1;if(!tt||!tt.isWebGLRenderTarget&&!tt.isDataTexture)return console.error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget or DataTexture."),!1;const rt=tt.isWebGLRenderTarget?tt.texture:tt;return rt.type!==_.VzW&&rt.type!==_.cLu?(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture type."),!1):rt.format===_.wk1||(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture format, expected RGBAFormat."),!1)}(e,i))return;const o=function(et,tt={}){const rt=et.isTexture?et:et.texture,st=et.isWebGLRenderTarget?et.width:et.image.width,at=et.isWebGLRenderTarget?et.height:et.image.height,ct=rt.type,pt=rt.format,gt=rt.colorSpace,At=tt.compression!==void 0?tt.compression:3,xt=(tt.type!==void 0?tt.type:_.cLu)===_.VzW?2:1,yt={0:1,2:1,3:16}[At];return{width:st,height:at,type:ct,format:pt,colorSpace:gt,compression:At,blockLines:yt,dataType:xt,dataSize:2*xt,numBlocks:Math.ceil(at/yt),numInputChannels:4,numOutputChannels:4,flipY:et.isDataTexture&&et.flipY}}(i,s),c=function(et,tt,rt){if(tt.isDataTexture)return tt.image.data;let st;return st=rt.type===_.VzW?new Float32Array(rt.width*rt.height*rt.numInputChannels):new Uint16Array(rt.width*rt.height*rt.numInputChannels),et.readRenderTargetPixels(tt,0,0,rt.width,rt.height,st),st}(e,i,o),g=function(et,tt){const rt=tt.width,st=tt.height,at={r:0,g:0,b:0,a:0},ct={value:0},pt=tt.numOutputChannels==4?1:0,gt=tt.type==_.VzW?u5:c5,At=tt.dataType==1?a5:dO,xt=new Uint8Array(tt.width*tt.height*tt.numOutputChannels*tt.dataSize),yt=new DataView(xt.buffer);for(let _t=0;_t<st;++_t)for(let Mt=0;Mt<rt;++Mt){const It=_t*rt*4+4*Mt,Bt=gt(et,It),Lt=gt(et,It+1),Ht=gt(et,It+2),Jt=gt(et,It+3),sn=(tt.flipY?_t:st-_t-1)*rt*(3+pt)*tt.dataSize;o5(at,Bt,Lt,Ht,Jt),ct.value=sn+Mt*tt.dataSize,At(yt,at.a,ct),ct.value=sn+pt*rt*tt.dataSize+Mt*tt.dataSize,At(yt,at.b,ct),ct.value=sn+(1+pt)*rt*tt.dataSize+Mt*tt.dataSize,At(yt,at.g,ct),ct.value=sn+(2+pt)*rt*tt.dataSize+Mt*tt.dataSize,At(yt,at.r,ct)}return xt}(c,o),b=function(et,tt){let rt,st,at=0;const ct={data:new Array,totalSize:0},pt=tt.width*tt.numOutputChannels*tt.blockLines*tt.dataSize;switch(tt.compression){case 0:rt=r5;break;case 2:case 3:rt=s5}tt.compression!==0&&(st=new Uint8Array(pt));for(let gt=0;gt<tt.numBlocks;++gt){const At=rt(et.subarray(pt*gt,pt*(gt+1)),st);at+=At.length,ct.data.push({dataChunk:At,size:At.length})}return ct.totalSize=at,ct}(g,o);return function(et,tt){const rt=8*tt.numBlocks,st=259+18*tt.numOutputChannels,at={value:st+rt},ct=new Uint8Array(st+rt+et.totalSize+8*tt.numBlocks),pt=new DataView(ct.buffer);(function(gt,At,xt){const yt={value:0},_t=new DataView(gt.buffer);Ho(_t,20000630,yt),Ho(_t,2,yt),mp(_t,"compression",yt),mp(_t,"compression",yt),Ho(_t,1,yt),lI(_t,xt.compression,yt),mp(_t,"screenWindowCenter",yt),mp(_t,"v2f",yt),Ho(_t,8,yt),Ho(_t,0,yt),Ho(_t,0,yt),mp(_t,"screenWindowWidth",yt),mp(_t,"float",yt),Ho(_t,4,yt),dO(_t,1,yt),mp(_t,"pixelAspectRatio",yt),mp(_t,"float",yt),Ho(_t,4,yt),dO(_t,1,yt),mp(_t,"lineOrder",yt),mp(_t,"lineOrder",yt),Ho(_t,1,yt),lI(_t,0,yt),mp(_t,"dataWindow",yt),mp(_t,"box2i",yt),Ho(_t,16,yt),Ho(_t,0,yt),Ho(_t,0,yt),Ho(_t,xt.width-1,yt),Ho(_t,xt.height-1,yt),mp(_t,"displayWindow",yt),mp(_t,"box2i",yt),Ho(_t,16,yt),Ho(_t,0,yt),Ho(_t,0,yt),Ho(_t,xt.width-1,yt),Ho(_t,xt.height-1,yt),mp(_t,"channels",yt),mp(_t,"chlist",yt),Ho(_t,18*xt.numOutputChannels+1,yt),mp(_t,"A",yt),Ho(_t,xt.dataType,yt),yt.value+=4,Ho(_t,1,yt),Ho(_t,1,yt),mp(_t,"B",yt),Ho(_t,xt.dataType,yt),yt.value+=4,Ho(_t,1,yt),Ho(_t,1,yt),mp(_t,"G",yt),Ho(_t,xt.dataType,yt),yt.value+=4,Ho(_t,1,yt),Ho(_t,1,yt),mp(_t,"R",yt),Ho(_t,xt.dataType,yt),yt.value+=4,Ho(_t,1,yt),Ho(_t,1,yt),lI(_t,0,yt),lI(_t,0,yt);let Mt=yt.value+8*xt.numBlocks;for(let It=0;It<At.data.length;++It)l5(_t,Mt,yt),Mt+=At.data[It].size+8})(ct,et,tt);for(let gt=0;gt<et.data.length;++gt){const At=et.data[gt].dataChunk,xt=et.data[gt].size;Ho(pt,gt*tt.blockLines,at),Ho(pt,xt,at),ct.set(At,at.value),at.value+=xt}return ct}(b,o)}}function r5(h){return h}function s5(h,e){let i=0,s=Math.floor((h.length+1)/2),o=0;const c=h.length-1;for(;!(o>c||(e[i++]=h[o++],o>c));)e[s++]=h[o++];let g=e[0];for(let b=1;b<e.length;b++){const et=e[b]-g+384;g=e[b],e[b]=et}return function(b,et){et||(et={});var tt=MB();tt.p(b);var rt=TB(b,et,2,4);return PB(rt,et),IB(rt,rt.length-4,tt.d()),rt}(e)}function o5(h,e,i,s,o){h.r=e,h.g=i,h.b=s,h.a=o}function lI(h,e,i){h.setUint8(i.value,e),i.value+=1}function Ho(h,e,i){h.setUint32(i.value,e,!0),i.value+=4}function a5(h,e,i){h.setUint16(i.value,_.A5E.toHalfFloat(e),!0),i.value+=2}function dO(h,e,i){h.setFloat32(i.value,e,!0),i.value+=4}function l5(h,e,i){h.setBigUint64(i.value,BigInt(e),!0),i.value+=8}function mp(h,e,i){const s=n5.encode(e+"\0");for(let o=0;o<s.length;++o)lI(h,s[o],i)}function c5(h,e){return function(i){const s=(31744&i)>>10,o=1023&i;return(i>>15?-1:1)*(s?s===31?o?NaN:1/0:Math.pow(2,s-15)*(1+o/1024):o/1024*6103515625e-14)}(h[e])}function u5(h,e){return h[e]}class qP extends i5{async parseAsync(e,i){const s=this.parse(e.renderer.rendererObject,e,i);return new Blob([s],{type:"image/x-exr"})}}class b3 extends _e.SimpleEventDispatcher{get processors(){return this._processors}getExporter(...e){return this.Exporters.find(i=>i.ext.some(s=>e.includes(s)))}constructor(e,i={}){super(),this._processors=new $m,this.Exporters=[{ctor:()=>new u3,ext:["json"]},{ctor:()=>new h3,ext:["txt","text"]},{ctor:()=>new qP,ext:["exr"]}],this._cachedParsers=[],hO(this,e)}async exportObject(e,i={}){var c,g;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");(c=e==null?void 0:e.userData)!=null&&c.rootSceneModelRoot&&i.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const s=[];e.assetType==="model"&&e.modelObject.traverse(b=>{b.userData.excludeFromExport&&b.visible&&(b.visible=!1,s.push(b))});const o=await this._exportFile(e,i);return e.assetType==="model"&&s.forEach(b=>b.visible=!0),(g=e==null?void 0:e.userData)!=null&&g.rootSceneModelRoot&&i.viewerConfig===!1&&delete e.userData.__exportViewerConfig,o}async _exportFile(e,i={}){let s;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const o=await this.processBeforeExport(e,i),c=i.exportExt??(o==null?void 0:o.typeExt)??(o==null?void 0:o.ext);if(!o||!c)throw new Error(`Unable to preprocess before export ${c}`);const g=this._getParser(c);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const b=await g.parseAsync(o.obj,{exportExt:o.ext??c,...i});b.ext=o.ext,s=b}catch(o){return console.error("AssetExporter: Unable to Export file",e),console.error(o),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:o})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),s}_createParser(e){const i=this.Exporters.find(o=>o.ext.includes(e));if(!i)throw new Error(`No exporter found for extension ${e}`);const s=i==null?void 0:i.ctor(this);if(!s)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:i.ext,parser:s}),this.dispatchEvent({type:"exporterCreate",exporter:i,parser:s}),s}_getParser(e){var i;return((i=this._cachedParsers.find(s=>s.ext.includes(e)))==null?void 0:i.parser)??this._createParser(e)}async processBeforeExport(e,i={}){if(e.assetType!=null&&e.assetType!=="renderTarget"&&(e=await this._processors.process(e.assetType,e,i)),e.isWebGLRenderTarget)return{obj:e,ext:"exr"};switch(e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};case"renderTarget":return{obj:e,ext:"exr"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)==null||e.dispose()}}var cI;(function(h){h[h.EDGEBREAKER=1]="EDGEBREAKER",h[h.SEQUENTIAL=0]="SEQUENTIAL"})(cI||(cI={}));class m1 extends hs{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,encodeUint16Rgbe:!1,convertMeshToIndexed:!1,embedUrlImagePreviews:!1,embedUrlImages:!1,dracoOptions:{encodeSpeed:5,method:cI.EDGEBREAKER,quantizationVolume:"mesh",quantizationBits:{POSITION:14,NORMAL:10,COLOR:8,TEX_COORD:12,GENERIC:12}},encrypt:!1,encryptKey:""},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new b3(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(i,s)=>{var o;return s.convertMeshToIndexed&&((o=i.modelObject)==null||o.traverse(c=>{var g;c.geometry&&(c.geometry.attributes.index||((g=c.setGeometry)==null||g.call(c,_c(c.geometry))))})),i}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var i,s;return(s=this.exporter)==null?void 0:s.exportObject((i=this._viewer)==null?void 0:i.scene.modelRoot,e||{...this.exportOptions})}async downloadSceneGlb(){const e=await this.exportScene(this.exportOptions);e&&await this._downloadBlob(e,this.exportOptions.name+"."+e.ext)}async _downloadBlob(e,i){var o,c;const s=(o=this._viewer)==null?void 0:o.getPluginByType("FileTransferPlugin");s?await s.exportFile(e,i):(c=this._viewer)==null||c.console.error("FileTransferPlugin required to export/download file")}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",s=>{var o;typeof((o=s.plugin)==null?void 0:o.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const i=Object.entries(e.plugins).filter(([s,o])=>typeof(o==null?void 0:o.toJSON)=="function"&&(o==null?void 0:o.serializeWithViewer)!==!1).map(([s,o])=>({label:s,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0,onChange:()=>{var s,o;return(o=(s=this._uiConfig)==null?void 0:s.uiRefresh)==null?void 0:o.call(s,"postFrame",!0)}},this.exportOptions.dracoOptions?{type:"folder",hidden:()=>!this.exportOptions.compress,label:"DRACO Options",children:[{type:"slider",label:"Encode Speed",bounds:[1,10],property:[this.exportOptions.dracoOptions,"encodeSpeed"]},{type:"dropdown",label:"Encoder Method",property:[this.exportOptions.dracoOptions,"method"],children:Object.entries(cI).map(([s,o])=>({label:s,value:o}))},{type:"dropdown",label:"Quantization Volume",property:[this.exportOptions.dracoOptions,"quantizationVolume"],children:["mesh","scene","bbox"].map(s=>({label:s}))},{type:"folder",label:"Quantization Bits",children:Object.keys(this.exportOptions.dracoOptions.quantizationBits).map(s=>({type:"slider",label:s,bounds:[1,16],stepSize:1,property:[this.exportOptions.dracoOptions.quantizationBits,s]}))}]}:{},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0,onChange:()=>{var s,o;return(o=(s=this._uiConfig)==null?void 0:s.uiRefresh)==null?void 0:o.call(s,"postFrame",!0)}},{type:"checkbox",label:"Embed Image Previews",property:[this.exportOptions,"embedUrlImagePreviews"]},{type:"checkbox",label:"Encrypt",property:[this.exportOptions,"encrypt"],onChange:()=>{var s,o;return(o=(s=this._uiConfig)==null?void 0:s.uiRefresh)==null?void 0:o.call(s,"postFrame",!0)}},{type:"checkbox",label:"Encrypt Password",hidden:()=>!this.exportOptions.encrypt,property:[this.exportOptions,"encryptKey"]},{type:"checkbox",label:"Compress hdr env maps",hidden:()=>!this.exportOptions.viewerConfig,property:[this.exportOptions,"encodeUint16Rgbe"]},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>this.downloadSceneGlb()}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:i},{type:"button",label:"Select none",value:()=>{i.forEach(s=>{var o;s.value=!1,(o=s.uiRefresh)==null||o.call(s)})}},{type:"button",label:"Select all",value:()=>{i.forEach(s=>{var o;s.value=!0,(o=s.uiRefresh)==null||o.call(s)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(Lr).exportPluginPresets(i.filter(o=>!!o.value).map(o=>(0,_e.getOrCall)(o.label)||"")),null,2)],{type:"application/json"});s&&await this._downloadBlob(s,this.exportOptions.name+"."+Lr.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(Lr).exportViewerConfig(!1),null,2)],{type:"application/json"});s&&await this._downloadBlob(s,this.exportOptions.name+"."+Lr.ViewerTypeSlug)}}]}]}}}m1.PluginType="AssetExporterPlugin",function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);c>3&&g&&Object.defineProperty(e,i,g)}([Mn()],m1.prototype,"exportOptions",void 0);class pO{constructor(){this._listeners={}}addEventListener(e,i){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i),this}removeEventListener(e,i){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const o=s.indexOf(i);o!==-1&&s.splice(o,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const i=this._listeners[e.type];if(i!==void 0){const s=i.slice(0);for(let o=0,c=s.length;o<c;o++)s[o].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class ZC extends pO{constructor(e,i,s,o={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=i,this._child=s,this._attributes=o,!i.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class h5 extends pO{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(i=>i.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(i=>i.getChild())}disconnectParents(e,i){let s=this.listParentEdges(e);return i&&(s=s.filter(o=>i(o.getParent()))),s.forEach(o=>o.dispose()),this}createEdge(e,i,s,o){return this._registerEdge(new ZC(e,i,s,o))}_registerEdge(e){this._edges.add(e);const i=e.getParent();this._parentEdges.has(i)||this._parentEdges.set(i,new Set),this._parentEdges.get(i).add(e);const s=e.getChild();return this._childEdges.has(s)||this._childEdges.set(s,new Set),this._childEdges.get(s).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function uI(){return uI=Object.assign||function(h){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(h[s]=i[s])}return h},uI.apply(this,arguments)}function fO(h){return h instanceof ZC}function hI(h){return Array.isArray(h)&&h[0]instanceof ZC}function dI(h){return!!(function(e){return!!e&&Object.getPrototypeOf(e)===Object.prototype}(h)&&function(e){for(const i in e)return e[i]}(h)instanceof ZC)}const Dl=Symbol("attributes"),eM=Symbol("immutableKeys");class mO extends pO{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[Dl]=void 0,this[eM]=void 0,this.graph=e,this[eM]=new Set,this[Dl]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),i={};for(const s in e){const o=e[s];if(o instanceof mO){const c=this.graph.createEdge(s,this,o);c.addEventListener("dispose",()=>o.dispose()),this[eM].add(s),i[s]=c}else i[s]=o}return i}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,i){for(const s in this[Dl]){const o=this[Dl][s];if(fO(o)){const c=o;c.getChild()===e&&this.setRef(s,i,c.getAttributes())}else if(hI(o)){const c=o.find(g=>g.getChild()===e);if(c){const g=c.getAttributes();this.removeRef(s,e).addRef(s,i,g)}}else if(dI(o)){const c=o;for(const g in c){const b=c[g];b.getChild()===e&&this.setRefMap(s,g,i,b.getAttributes())}}}return this}get(e){return this[Dl][e]}set(e,i){return this[Dl][e]=i,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const i=this[Dl][e];return i?i.getChild():null}setRef(e,i,s){if(this[eM].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const o=this[Dl][e];if(o&&o.dispose(),!i)return this;const c=this.graph.createEdge(e,this,i,s);return c.addEventListener("dispose",()=>{delete this[Dl][e],this.dispatchEvent({type:"change",attribute:e})}),this[Dl][e]=c,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[Dl][e].map(i=>i.getChild())}addRef(e,i,s){const o=this.graph.createEdge(e,this,i,s),c=this[Dl][e];return c.push(o),o.addEventListener("dispose",()=>{const g=c.filter(b=>b!==o);c.length=0;for(const b of g)c.push(b);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,i){return this[Dl][e].filter(s=>s.getChild()===i).forEach(s=>s.dispose()),this}listRefMapKeys(e){return Object.keys(this[Dl][e])}listRefMapValues(e){return Object.values(this[Dl][e]).map(i=>i.getChild())}getRefMap(e,i){const s=this[Dl][e];return s[i]?s[i].getChild():null}setRefMap(e,i,s,o){const c=this[Dl][e],g=c[i];if(g&&g.dispose(),!s)return this;o=Object.assign(o||{},{key:i});const b=this.graph.createEdge(e,this,s,uI({},o,{key:i}));return b.addEventListener("dispose",()=>{delete c[i],this.dispatchEvent({type:"change",attribute:e,key:i})}),c[i]=b,this.dispatchEvent({type:"change",attribute:e,key:i})}dispatchEvent(e){return super.dispatchEvent(uI({},e,{target:this})),this.graph.dispatchEvent(uI({},e,{target:this,type:`node:${e.type}`})),this}}const w3="@glb.bin";var Zr,XP,T_,Tu,QE;(function(h){h.ACCESSOR="Accessor",h.ANIMATION="Animation",h.ANIMATION_CHANNEL="AnimationChannel",h.ANIMATION_SAMPLER="AnimationSampler",h.BUFFER="Buffer",h.CAMERA="Camera",h.MATERIAL="Material",h.MESH="Mesh",h.PRIMITIVE="Primitive",h.PRIMITIVE_TARGET="PrimitiveTarget",h.NODE="Node",h.ROOT="Root",h.SCENE="Scene",h.SKIN="Skin",h.TEXTURE="Texture",h.TEXTURE_INFO="TextureInfo"})(Zr||(Zr={})),function(h){h.INTERLEAVED="interleaved",h.SEPARATE="separate"}(XP||(XP={})),function(h){h.ARRAY_BUFFER="ARRAY_BUFFER",h.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",h.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",h.OTHER="OTHER",h.SPARSE="SPARSE"}(T_||(T_={})),function(h){h[h.R=4096]="R",h[h.G=256]="G",h[h.B=16]="B",h[h.A=1]="A"}(Tu||(Tu={})),function(h){h.GLTF="GLTF",h.GLB="GLB"}(QE||(QE={}));const YP={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var KP,gO,vO=typeof Float32Array<"u"?Float32Array:Array;function _O(h){return Math.hypot(h[0],h[1],h[2])}function d5(h,e,i){var s=e[0],o=e[1],c=e[2],g=i[3]*s+i[7]*o+i[11]*c+i[15];return h[0]=(i[0]*s+i[4]*o+i[8]*c+i[12])/(g=g||1),h[1]=(i[1]*s+i[5]*o+i[9]*c+i[13])/g,h[2]=(i[2]*s+i[6]*o+i[10]*c+i[14])/g,h}function p5(h,e){const i={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const s of h.listPrimitives()){const o=s.getAttribute("POSITION");if(!o)continue;let c=[0,0,0],g=[0,0,0];for(let b=0;b<o.getCount();b++)c=o.getElement(b,c),g=d5(g,c,e),yO(g,i)}return i}function yO(h,e){for(let i=0;i<3;i++)e.min[i]=Math.min(h[i],e.min[i]),e.max[i]=Math.max(h[i],e.max[i])}Math.hypot||(Math.hypot=function(){for(var h=0,e=arguments.length;e--;)h+=arguments[e]*arguments[e];return Math.sqrt(h)}),KP=new vO(3),vO!=Float32Array&&(KP[0]=0,KP[1]=0,KP[2]=0);class yo{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const i=atob(e.split(",")[1]),s=new Uint8Array(i.length);for(let o=0;o<i.length;o++)s[o]=i.charCodeAt(o);return s}{const i=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(i,s?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let i=0;for(const c of e)i+=c.byteLength;const s=new Uint8Array(i);let o=0;for(const c of e)s.set(c,o),o+=c.byteLength;return s}static pad(e,i=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const o=new Uint8Array(s);if(o.set(e),i!==0)for(let c=e.byteLength;c<s;c++)o[c]=i;return o}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,i){if(e===i)return!0;if(e.byteLength!==i.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==i[s])return!1;return!0}static toView(e,i=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+i,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class qv{static hexToFactor(e,i){e=Math.floor(e);const s=i;return s[0]=(e>>16&255)/255,s[1]=(e>>8&255)/255,s[2]=(255&e)/255,this.convertSRGBToLinear(i,i)}static factorToHex(e){const i=[...e],[s,o,c]=this.convertLinearToSRGB(e,i);return 255*s<<16^255*o<<8^255*c<<0}static convertSRGBToLinear(e,i){const s=e,o=i;for(let c=0;c<3;c++)o[c]=s[c]<.04045?.0773993808*s[c]:Math.pow(.9478672986*s[c]+.0521327014,2.4);return i}static convertLinearToSRGB(e,i){const s=e,o=i;for(let c=0;c<3;c++)o[c]=s[c]<.0031308?12.92*s[c]:1.055*Math.pow(s[c],.41666)-.055;return i}}class JP{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const i=new DataView(e.buffer,e.byteOffset);return yo.decodeText(e.slice(12,16))===JP.PNG_FRIED_CHUNK_NAME?[i.getUint32(32,!1),i.getUint32(36,!1)]:[i.getUint32(16,!1),i.getUint32(20,!1)]}getChannels(e){return 4}}JP.PNG_FRIED_CHUNK_NAME="CgBI";class pA{static registerFormat(e,i){this.impls[e]=i}static getMimeType(e){for(const i in this.impls)if(this.impls[i].match(e))return i;return null}static getSize(e,i){return this.impls[i]?this.impls[i].getSize(e):null}static getChannels(e,i){return this.impls[i]?this.impls[i].getChannels(e):null}static getVRAMByteLength(e,i){if(!this.impls[i])return null;if(this.impls[i].getVRAMByteLength)return this.impls[i].getVRAMByteLength(e);let s=0;const o=this.getSize(e,i);if(!o)return null;for(;o[0]>1||o[1]>1;)s+=o[0]*o[1]*4,o[0]=Math.max(Math.floor(o[0]/2),1),o[1]=Math.max(Math.floor(o[1]/2),1);return s+=4,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}function f5(h,e){if(e>h.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(h.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return h}pA.impls={"image/jpeg":new class{match(h){return h.length>=3&&h[0]===255&&h[1]===216&&h[2]===255}getSize(h){let e,i,s=new DataView(h.buffer,h.byteOffset+4);for(;s.byteLength;){if(e=s.getUint16(0,!1),f5(s,e),i=s.getUint8(e+1),i===192||i===193||i===194)return[s.getUint16(e+7,!1),s.getUint16(e+5,!1)];s=new DataView(h.buffer,s.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(h){return 3}},"image/png":new JP};class tM{static basename(e){const i=e.split(/[\\/]/).pop();return i.substring(0,i.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const i=e.match(/data:(image\/\w+)/)[1];return pA.mimeTypeToExtension(i)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function x3(h){return Object.prototype.toString.call(h)==="[object Object]"}function WE(h){if(x3(h)===!1)return!1;const e=h.constructor;if(e===void 0)return!0;const i=e.prototype;return x3(i)!==!1&&Object.prototype.hasOwnProperty.call(i,"isPrototypeOf")!==!1}(function(h){h[h.SILENT=4]="SILENT",h[h.ERROR=3]="ERROR",h[h.WARN=2]="WARN",h[h.INFO=1]="INFO",h[h.DEBUG=0]="DEBUG"})(gO||(gO={}));class I_{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=I_.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=I_.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=I_.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=I_.Verbosity.ERROR&&console.error(e)}}function m5(h,e,i){var s=e[0],o=e[1],c=e[2],g=e[3],b=e[4],et=e[5],tt=e[6],rt=e[7],st=e[8],at=e[9],ct=e[10],pt=e[11],gt=e[12],At=e[13],xt=e[14],yt=e[15],_t=i[0],Mt=i[1],It=i[2],Bt=i[3];return h[0]=_t*s+Mt*b+It*st+Bt*gt,h[1]=_t*o+Mt*et+It*at+Bt*At,h[2]=_t*c+Mt*tt+It*ct+Bt*xt,h[3]=_t*g+Mt*rt+It*pt+Bt*yt,h[4]=(_t=i[4])*s+(Mt=i[5])*b+(It=i[6])*st+(Bt=i[7])*gt,h[5]=_t*o+Mt*et+It*at+Bt*At,h[6]=_t*c+Mt*tt+It*ct+Bt*xt,h[7]=_t*g+Mt*rt+It*pt+Bt*yt,h[8]=(_t=i[8])*s+(Mt=i[9])*b+(It=i[10])*st+(Bt=i[11])*gt,h[9]=_t*o+Mt*et+It*at+Bt*At,h[10]=_t*c+Mt*tt+It*ct+Bt*xt,h[11]=_t*g+Mt*rt+It*pt+Bt*yt,h[12]=(_t=i[12])*s+(Mt=i[13])*b+(It=i[14])*st+(Bt=i[15])*gt,h[13]=_t*o+Mt*et+It*at+Bt*At,h[14]=_t*c+Mt*tt+It*ct+Bt*xt,h[15]=_t*g+Mt*rt+It*pt+Bt*yt,h}I_.Verbosity=gO,I_.DEFAULT_INSTANCE=new I_(I_.Verbosity.INFO);class Jl{static identity(e){return e}static eq(e,i,s=1e-5){if(e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(Math.abs(e[o]-i[o])>s)return!1;return!0}static decodeNormalizedInt(e,i){switch(i){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,i){return Jl.decodeNormalizedInt(e,i)}static encodeNormalizedInt(e,i){switch(i){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,i){return Jl.encodeNormalizedInt(e,i)}static decompose(e,i,s,o){let c=_O([e[0],e[1],e[2]]);const g=_O([e[4],e[5],e[6]]),b=_O([e[8],e[9],e[10]]);var et,tt,rt,st,at,ct,pt,gt,At,xt,yt,_t,Mt,It,Bt,Lt,Ht;((tt=(et=e)[0])*(pt=et[5])-(rt=et[1])*(ct=et[4]))*((_t=et[10])*(Ht=et[15])-(Mt=et[11])*(Lt=et[14]))-(tt*(gt=et[6])-(st=et[2])*ct)*((yt=et[9])*Ht-Mt*(Bt=et[13]))+(tt*(At=et[7])-(at=et[3])*ct)*(yt*Lt-_t*Bt)+(rt*gt-st*pt)*((xt=et[8])*Ht-Mt*(It=et[12]))-(rt*At-at*pt)*(xt*Lt-_t*It)+(st*At-at*gt)*(xt*Bt-yt*It)<0&&(c=-c),i[0]=e[12],i[1]=e[13],i[2]=e[14];const Jt=e.slice(),sn=1/c,on=1/g,mn=1/b;Jt[0]*=sn,Jt[1]*=sn,Jt[2]*=sn,Jt[4]*=on,Jt[5]*=on,Jt[6]*=on,Jt[8]*=mn,Jt[9]*=mn,Jt[10]*=mn,function(cn,un){var bn=new vO(3);(function(Ts,pr){var Pr=pr[4],qr=pr[5],Xs=pr[6],po=pr[8],eo=pr[9],Qs=pr[10];Ts[0]=Math.hypot(pr[0],pr[1],pr[2]),Ts[1]=Math.hypot(Pr,qr,Xs),Ts[2]=Math.hypot(po,eo,Qs)})(bn,un);var xn=1/bn[0],Cn=1/bn[1],Jn=1/bn[2],Kn=un[0]*xn,gr=un[1]*Cn,nr=un[2]*Jn,tr=un[4]*xn,Cr=un[5]*Cn,Ar=un[6]*Jn,Hr=un[8]*xn,Jr=un[9]*Cn,cs=un[10]*Jn,Os=Kn+Cr+cs,Ss=0;Os>0?(Ss=2*Math.sqrt(Os+1),cn[3]=.25*Ss,cn[0]=(Ar-Jr)/Ss,cn[1]=(Hr-nr)/Ss,cn[2]=(gr-tr)/Ss):Kn>Cr&&Kn>cs?(Ss=2*Math.sqrt(1+Kn-Cr-cs),cn[3]=(Ar-Jr)/Ss,cn[0]=.25*Ss,cn[1]=(gr+tr)/Ss,cn[2]=(Hr+nr)/Ss):Cr>cs?(Ss=2*Math.sqrt(1+Cr-Kn-cs),cn[3]=(Hr-nr)/Ss,cn[0]=(gr+tr)/Ss,cn[1]=.25*Ss,cn[2]=(Ar+Jr)/Ss):(Ss=2*Math.sqrt(1+cs-Kn-Cr),cn[3]=(gr-tr)/Ss,cn[0]=(Hr+nr)/Ss,cn[1]=(Ar+Jr)/Ss,cn[2]=.25*Ss)}(s,Jt),o[0]=c,o[1]=g,o[2]=b}static compose(e,i,s,o){const c=o,g=i[0],b=i[1],et=i[2],tt=i[3],rt=g+g,st=b+b,at=et+et,ct=g*rt,pt=g*st,gt=g*at,At=b*st,xt=b*at,yt=et*at,_t=tt*rt,Mt=tt*st,It=tt*at,Bt=s[0],Lt=s[1],Ht=s[2];return c[0]=(1-(At+yt))*Bt,c[1]=(pt+It)*Bt,c[2]=(gt-Mt)*Bt,c[3]=0,c[4]=(pt-It)*Lt,c[5]=(1-(ct+yt))*Lt,c[6]=(xt+_t)*Lt,c[7]=0,c[8]=(gt+Mt)*Ht,c[9]=(xt-_t)*Ht,c[10]=(1-(ct+At))*Ht,c[11]=0,c[12]=e[0],c[13]=e[1],c[14]=e[2],c[15]=1,c}}function g5(h,e){if(!!h!=!!e)return!1;const i=h.getChild(),s=e.getChild();return i===s||i.equals(s)}function v5(h,e){if(!!h!=!!e||h.length!==e.length)return!1;for(let i=0;i<h.length;i++){const s=h[i],o=e[i];if(s.getChild()!==o.getChild()&&!s.getChild().equals(o.getChild()))return!1}return!0}function _5(h,e){if(!!h!=!!e)return!1;const i=Object.keys(h),s=Object.keys(e);if(i.length!==s.length)return!1;for(const o in h){const c=h[o],g=e[o];if(!!c!=!!g)return!1;const b=c.getChild(),et=g.getChild();if(b!==et&&!b.equals(et))return!1}return!0}function E3(h,e){if(h===e)return!0;if(!!h!=!!e||!h||!e||h.length!==e.length)return!1;for(let i=0;i<h.length;i++)if(h[i]!==e[i])return!1;return!0}function S3(h,e){if(h===e)return!0;if(!!h!=!!e)return!1;if(!WE(h)||!WE(e))return h===e;const i=h,s=e;let o,c=0,g=0;for(o in i)c++;for(o in s)g++;if(c!==g)return!1;for(o in i){const b=i[o],et=s[o];if($P(b)&&$P(et)){if(!E3(b,et))return!1}else if(WE(b)&&WE(et)){if(!S3(b,et))return!1}else if(b!==et)return!1}return!0}function $P(h){return Array.isArray(h)||ArrayBuffer.isView(h)}const C3="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",M3=new Set,y5=function(){let h="";for(let e=0;e<6;e++)h+=C3.charAt(Math.floor(Math.random()*C3.length));return h};class pI{static dirname(e){const i=e.lastIndexOf("/");return i===-1?"./":e.substring(0,i+1)}static basename(e){return tM.basename(new URL(e,"https://null.example").pathname)}static extension(e){return tM.extension(new URL(e,"https://null.example").pathname)}static resolve(e,i){if(!this.isRelativePath(i))return i;const s=e.split("/"),o=i.split("/");s.pop();for(let c=0;c<o.length;c++)o[c]!=="."&&(o[c]===".."?s.pop():s.push(o[c]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}pI.DEFAULT_INIT={},pI.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const Rw=h=>h,A5=new Set;class AO extends mO{constructor(e,i=""){super(e),this[Dl].name=i,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,i){return Array.isArray(i)&&(i=i.slice()),super.set(e,i)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,Rw)}copy(e,i=Rw){for(const s in this[Dl]){const o=this[Dl][s];if(o instanceof ZC)this[eM].has(s)||o.dispose();else if(hI(o))for(const c of o)c.dispose();else if(dI(o))for(const c in o)o[c].dispose()}for(const s in e[Dl]){const o=this[Dl][s],c=e[Dl][s];if(c instanceof ZC)this[eM].has(s)?o.getChild().copy(i(c.getChild()),i):this.setRef(s,i(c.getChild()),c.getAttributes());else if(hI(c))for(const g of c)this.addRef(s,i(g.getChild()),g.getAttributes());else if(dI(c))for(const g in c){const b=c[g];this.setRefMap(s,g,i(b.getChild()),b.getAttributes())}else this[Dl][s]=WE(c)?JSON.parse(JSON.stringify(c)):Array.isArray(c)||c instanceof ArrayBuffer||ArrayBuffer.isView(c)?c.slice():c}return this}equals(e,i=A5){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[Dl]){if(i.has(s))continue;const o=this[Dl][s],c=e[Dl][s];if(fO(o)||fO(c)){if(!g5(o,c))return!1}else if(hI(o)||hI(c)){if(!v5(o,c))return!1}else if(dI(o)||dI(c)){if(!_5(o,c))return!1}else if(WE(o)||WE(c)){if(!S3(o,c))return!1}else if($P(o)||$P(c)){if(!E3(o,c))return!1}else if(o!==c)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class hv extends AO{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,i){return i&&i.t(this),this.setRefMap("extensions",e,i)}listExtensions(){return this.listRefMapValues("extensions")}}class gs extends hv{constructor(...e){super(...e),this.i=Jl.identity,this.o=Jl.identity}init(){this.propertyType=Zr.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:gs.Type.SCALAR,componentType:gs.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,i=Rw){return super.copy(e,i),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case gs.Type.SCALAR:return 1;case gs.Type.VEC2:return 2;case gs.Type.VEC3:return 3;case gs.Type.VEC4:case gs.Type.MAT2:return 4;case gs.Type.MAT3:return 9;case gs.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case gs.ComponentType.BYTE:case gs.ComponentType.UNSIGNED_BYTE:return 1;case gs.ComponentType.SHORT:case gs.ComponentType.UNSIGNED_SHORT:return 2;case gs.ComponentType.UNSIGNED_INT:case gs.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const i=this.getElementSize();this.getMin(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMin(e){const i=this.get("array"),s=this.getCount(),o=this.getElementSize();for(let c=0;c<o;c++)e[c]=1/0;for(let c=0;c<s*o;c+=o)for(let g=0;g<o;g++){const b=i[c+g];Number.isFinite(b)&&(e[g]=Math.min(e[g],b))}return e}getMaxNormalized(e){const i=this.getElementSize();this.getMax(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMax(e){const i=this.get("array"),s=this.getCount(),o=this.getElementSize();for(let c=0;c<o;c++)e[c]=-1/0;for(let c=0;c<s*o;c+=o)for(let g=0;g<o;g++){const b=i[c+g];Number.isFinite(b)&&(e[g]=Math.max(e[g],b))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return gs.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=i=>Jl.decodeNormalizedInt(i,this.get("componentType")),this.i=i=>Jl.encodeNormalizedInt(i,this.get("componentType"))):(this.o=Jl.identity,this.i=Jl.identity),this}getScalar(e){const i=this.getElementSize();return this.o(this.get("array")[e*i])}setScalar(e,i){return this.get("array")[e*this.getElementSize()]=this.i(i),this}getElement(e,i){const s=this.getElementSize(),o=this.get("array");for(let c=0;c<s;c++)i[c]=this.o(o[e*s+c]);return i}setElement(e,i){const s=this.getElementSize(),o=this.get("array");for(let c=0;c<s;c++)o[e*s+c]=this.i(i[c]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(i){switch(i.constructor){case Float32Array:return gs.ComponentType.FLOAT;case Uint32Array:return gs.ComponentType.UNSIGNED_INT;case Uint16Array:return gs.ComponentType.UNSIGNED_SHORT;case Uint8Array:return gs.ComponentType.UNSIGNED_BYTE;case Int16Array:return gs.ComponentType.SHORT;case Int8Array:return gs.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):gs.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}gs.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},gs.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class T3 extends hv{init(){this.propertyType=Zr.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class bO extends hv{init(){this.propertyType=Zr.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}bO.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class nM extends hv{init(){this.propertyType=Zr.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:nM.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:T_.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:T_.OTHER})}}nM.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class I3 extends hv{init(){this.propertyType=Zr.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class qE extends hv{init(){this.propertyType=Zr.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:qE.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}qE.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class ju extends AO{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}ju.EXTENSION_NAME=void 0;class $l extends hv{init(){this.propertyType=Zr.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:$l.WrapMode.REPEAT,wrapT:$l.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}$l.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},$l.MagFilter={NEAREST:9728,LINEAR:9729},$l.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:ZP,G:eR,B:tR,A:b5}=Tu;class XE extends hv{init(){this.propertyType=Zr.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:XE.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new $l(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new $l(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new $l(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new $l(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new $l(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const i=this.get("baseColorFactor").slice();return i[3]=e,this.set("baseColorFactor",i)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return qv.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const i=this.get("baseColorFactor").slice();return this.set("baseColorFactor",qv.hexToFactor(e,i))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:ZP|eR|tR|b5})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return qv.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const i=this.get("emissiveFactor").slice();return this.set("emissiveFactor",qv.hexToFactor(e,i))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:ZP|eR|tR})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:ZP|eR|tR})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:ZP})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:eR|tR})}}XE.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class P3 extends hv{init(){this.propertyType=Zr.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class R3 extends hv{constructor(...e){super(...e),this.u=null}init(){this.propertyType=Zr.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,i=Rw){if(i===Rw)throw new Error("Node cannot be copied.");return super.copy(e,i)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Jl.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const i=this.get("translation").slice(),s=this.get("rotation").slice(),o=this.get("scale").slice();return Jl.decompose(e,i,s,o),this.set("translation",i).set("rotation",s).set("scale",o)}getWorldTranslation(){const e=[0,0,0];return Jl.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Jl.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Jl.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let o=this;o!=null;o=o.u)e.push(o);let i;const s=e.pop().getMatrix();for(;i=e.pop();)m5(s,s,i.getMatrix());return s}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const i=this[Dl].children;return i[i.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===Zr.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const i of this.listChildren())i.traverse(e);return this}}class YE extends hv{init(){this.propertyType=Zr.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:YE.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:T_.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:T_.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}YE.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class w5 extends AO{init(){this.propertyType=Zr.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:T_.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function Xv(){return(Xv=Object.assign||function(h){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(h[s]=i[s])}return h}).apply(this,arguments)}class D3 extends hv{init(){this.propertyType=Zr.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,i=Rw){if(i===Rw)throw new Error("Scene cannot be copied.");return super.copy(e,i)}addChild(e){return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const i of this.listChildren())i.traverse(e);return this}}class k3 extends hv{init(){this.propertyType=Zr.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:T_.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class B3 extends hv{init(){this.propertyType=Zr.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||pA.extensionToMimeType(tM.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const i=pA.extensionToMimeType(tM.extension(e));return i&&this.set("mimeType",i),this}getImage(){return this.get("image")}setImage(e){return this.set("image",yo.assertView(e))}getSize(){const e=this.get("image");return e?pA.getSize(e,this.getMimeType()):null}}class O3 extends hv{init(){this.propertyType=Zr.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v3.2.1",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",i=>{this.l(i.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,i=Rw){if(i===Rw)throw new Error("Root cannot be copied.");this.set("asset",Xv({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Xv({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?i(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const o=e.getExtension(s);this.setExtension(s,i(o))}return this}l(e){return e instanceof D3?this.addRef("scenes",e):e instanceof R3?this.addRef("nodes",e):e instanceof qE?this.addRef("cameras",e):e instanceof k3?this.addRef("skins",e):e instanceof P3?this.addRef("meshes",e):e instanceof XE?this.addRef("materials",e):e instanceof B3?this.addRef("textures",e):e instanceof T3?this.addRef("animations",e):e instanceof gs?this.addRef("accessors",e):e instanceof I3&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class iM{static fromGraph(e){return iM.m.get(e)||null}constructor(){this.v=new h5,this.T=new O3(this.v),this.M=I_.DEFAULT_INSTANCE,iM.m.set(this.v,this)}getRoot(){return this.T}getGraph(){return this.v}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new iM().setLogger(this.M).merge(this)}merge(e){for(const c of e.getRoot().listExtensionsUsed()){const g=this.createExtension(c.constructor);c.isRequired()&&g.setRequired(!0)}const i=new Set,s=new Map;i.add(e.T),s.set(e.T,this.T);for(const c of e.v.listEdges())for(const g of[c.getParent(),c.getChild()]){if(i.has(g))continue;let b;b=g.propertyType===Zr.TEXTURE_INFO?g:new g.constructor(this.v),s.set(g,b),i.add(g)}const o=c=>{const g=s.get(c);if(!g)throw new Error("Could resolve property.");return g};for(const c of i){const g=s.get(c);if(!g)throw new Error("Could resolve property.");g.propertyType!==Zr.TEXTURE_INFO&&g.copy(c,o)}return this}async transform(...e){const i=e.map(s=>s.name);for(const s of e)await s(this,{stack:i});return this}createExtension(e){const i=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(s=>s.extensionName===i)||new e(this)}createScene(e=""){return new D3(this.v,e)}createNode(e=""){return new R3(this.v,e)}createCamera(e=""){return new qE(this.v,e)}createSkin(e=""){return new k3(this.v,e)}createMesh(e=""){return new P3(this.v,e)}createPrimitive(){return new YE(this.v)}createPrimitiveTarget(e=""){return new w5(this.v,e)}createMaterial(e=""){return new XE(this.v,e)}createTexture(e=""){return new B3(this.v,e)}createAnimation(e=""){return new T3(this.v,e)}createAnimationChannel(e=""){return new bO(this.v,e)}createAnimationSampler(e=""){return new nM(this.v,e)}createAccessor(e="",i=null){return i||(i=this.getRoot().listBuffers()[0]),new gs(this.v,e).setBuffer(i)}createBuffer(e=""){return new I3(this.v,e)}}iM.m=new WeakMap;class au{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=s=>{const o=s,c=o.target;c instanceof ju&&c.extensionName===this.extensionName&&(o.type==="node:create"&&this.I(c),o.type==="node:dispose"&&this.N(c))};const i=e.getGraph();i.addEventListener("node:create",this.S),i.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const i of this.properties)i.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}I(e){return this.properties.add(e),this}N(e){return this.properties.delete(e),this}install(e,i){return this}preread(e,i){return this}prewrite(e,i){return this}}au.EXTENSION_NAME=void 0;class x5{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,i){this.textureInfos.set(e,i),i.texCoord!==void 0&&e.setTexCoord(i.texCoord),i.extras!==void 0&&e.setExtras(i.extras);const s=this.jsonDoc.json.textures[i.index];if(s.sampler===void 0)return;const o=this.jsonDoc.json.samplers[s.sampler];o.magFilter!==void 0&&e.setMagFilter(o.magFilter),o.minFilter!==void 0&&e.setMinFilter(o.minFilter),o.wrapS!==void 0&&e.setWrapS(o.wrapS),o.wrapT!==void 0&&e.setWrapT(o.wrapT)}}const L3={logger:I_.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function nR(h,e){const i=e.bufferViews[h.bufferView],s=e.jsonDoc.json.bufferViews[h.bufferView],o=YP[h.componentType],c=gs.getElementSize(h.type),g=o.BYTES_PER_ELEMENT;if(s.byteStride!==void 0&&s.byteStride!==c*g)return function(et,tt){const rt=tt.bufferViews[et.bufferView],st=tt.jsonDoc.json.bufferViews[et.bufferView],at=YP[et.componentType],ct=gs.getElementSize(et.type),pt=at.BYTES_PER_ELEMENT,gt=et.byteOffset||0,At=new at(et.count*ct),xt=new DataView(rt.buffer,rt.byteOffset,rt.byteLength),yt=st.byteStride;for(let _t=0;_t<et.count;_t++)for(let Mt=0;Mt<ct;Mt++){const It=gt+_t*yt+Mt*pt;let Bt;switch(et.componentType){case gs.ComponentType.FLOAT:Bt=xt.getFloat32(It,!0);break;case gs.ComponentType.UNSIGNED_INT:Bt=xt.getUint32(It,!0);break;case gs.ComponentType.UNSIGNED_SHORT:Bt=xt.getUint16(It,!0);break;case gs.ComponentType.UNSIGNED_BYTE:Bt=xt.getUint8(It);break;case gs.ComponentType.SHORT:Bt=xt.getInt16(It,!0);break;case gs.ComponentType.BYTE:Bt=xt.getInt8(It);break;default:throw new Error(`Unexpected componentType "${et.componentType}".`)}At[_t*ct+Mt]=Bt}return At}(h,e);const b=i.byteOffset+(h.byteOffset||0);return new o(i.buffer.slice(b,b+h.count*c*g))}var fI;(function(h){h[h.ARRAY_BUFFER=34962]="ARRAY_BUFFER",h[h.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(fI||(fI={}));class fA{constructor(e,i,s){this.O=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.C=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.O=e,this.jsonDoc=i,this.options=s;const o=e.getRoot(),c=o.listBuffers().length,g=o.listTextures().length;this.bufferURIGenerator=new N3(c>1,()=>s.basename||"buffer"),this.imageURIGenerator=new N3(g>1,b=>function(et,tt){const rt=et.getGraph().listParentEdges(tt).find(st=>st.getParent()!==et.getRoot());return rt?rt.getName().replace(/texture$/i,""):""}(e,b)||s.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,i){const s={magFilter:i.getMagFilter()||void 0,minFilter:i.getMinFilter()||void 0,wrapS:i.getWrapS(),wrapT:i.getWrapT()},o=JSON.stringify(s);this.samplerDefIndexMap.has(o)||(this.samplerDefIndexMap.set(o,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const c={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(o)},g=JSON.stringify(c);this.textureDefIndexMap.has(g)||(this.textureDefIndexMap.set(g,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(c));const b={index:this.textureDefIndexMap.get(g)};return i.getTexCoord()!==0&&(b.texCoord=i.getTexCoord()),Object.keys(i.getExtras()).length>0&&(b.extras=i.getExtras()),this.textureInfoDefMap.set(i,b),b}createPropertyDef(e){const i={};return e.getName()&&(i.name=e.getName()),Object.keys(e.getExtras()).length>0&&(i.extras=e.getExtras()),i}createAccessorDef(e){const i=this.createPropertyDef(e);return i.type=e.getType(),i.componentType=e.getComponentType(),i.count=e.getCount(),this.O.getGraph().listParentEdges(e).some(s=>s.getName()==="attributes"&&s.getAttributes().key==="POSITION"||s.getName()==="input")&&(i.max=e.getMax([]).map(Math.fround),i.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(i.normalized=e.getNormalized()),i}createImageData(e,i,s){if(this.options.format===QE.GLB)this.imageBufferViews.push(i),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:i.byteLength});else{const o=pA.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,o),this.jsonDoc.resources[e.uri]=i}}getAccessorUsage(e){const i=this.C.get(e);if(i)return i;if(e.getSparse())return T_.SPARSE;for(const s of this.O.getGraph().listParentEdges(e)){const{usage:o}=s.getAttributes();if(o)return o;s.getParent().propertyType!==Zr.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return T_.OTHER}addAccessorToUsageGroup(e,i){const s=this.C.get(e);if(s&&s!==i)throw new Error(`Accessor with usage "${s}" cannot be reused as "${i}".`);return this.C.set(e,i),this}listAccessorUsageGroups(){const e={};for(const[i,s]of Array.from(this.C.entries()))e[s]=e[s]||[],e[s].push(i);return e}}fA.BufferViewTarget=fI,fA.BufferViewUsage=T_,fA.USAGE_TO_TARGET={[T_.ARRAY_BUFFER]:fI.ARRAY_BUFFER,[T_.ELEMENT_ARRAY_BUFFER]:fI.ELEMENT_ARRAY_BUFFER};class N3{constructor(e,i){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=i}createURI(e,i){if(e.getURI())return e.getURI();if(this.multiple){const s=this.basename(e);return this.counter[s]=this.counter[s]||1,`${s}_${this.counter[s]++}.${i}`}return`${this.basename(e)}.${i}`}}const{BufferViewUsage:iR}=fA,{UNSIGNED_INT:E5,UNSIGNED_SHORT:S5,UNSIGNED_BYTE:C5}=gs.ComponentType;var rR;(function(h){h[h.JSON=1313821514]="JSON",h[h.BIN=5130562]="BIN"})(rR||(rR={}));class M5{constructor(){this.M=I_.DEFAULT_INSTANCE,this.h=new Set,this.F={},this.U=XP.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const i of e)this.h.add(i),i.register();return this}registerDependencies(e){return Object.assign(this.F,e),this}setVertexLayout(e){return this.U=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const i=await this.readURI(e,"view");this.lastReadBytes=i.byteLength;const s=U3(i)?this.P(i):{json:JSON.parse(yo.decodeText(i)),resources:{}};return await this.L(s,this.dirname(e)),this.j(s),s}async readJSON(e){return e=this.D(e),this.j(e),(class{static read(i,s=L3){const o=Xv({},L3,s),{json:c}=i,g=new iM().setLogger(o.logger);this.validate(i,o);const b=new x5(i),et=c.asset,tt=g.getRoot().getAsset();et.copyright&&(tt.copyright=et.copyright),et.extras&&(tt.extras=et.extras),c.extras!==void 0&&g.getRoot().setExtras(Xv({},c.extras));const rt=c.extensionsUsed||[],st=c.extensionsRequired||[];for(const _t of o.extensions)if(rt.includes(_t.EXTENSION_NAME)){const Mt=g.createExtension(_t).setRequired(st.includes(_t.EXTENSION_NAME));for(const It of Mt.readDependencies)Mt.install(It,o.dependencies[It])}const at=c.buffers||[];g.getRoot().listExtensionsUsed().filter(_t=>_t.prereadTypes.includes(Zr.BUFFER)).forEach(_t=>_t.preread(b,Zr.BUFFER)),b.buffers=at.map(_t=>{const Mt=g.createBuffer(_t.name);return _t.extras&&Mt.setExtras(_t.extras),_t.uri&&_t.uri.indexOf("__")!==0&&Mt.setURI(_t.uri),Mt}),b.bufferViewBuffers=(c.bufferViews||[]).map((_t,Mt)=>{if(!b.bufferViews[Mt]){const It=i.json.buffers[_t.buffer];b.bufferViews[Mt]=yo.toView(It.uri?i.resources[It.uri]:i.resources["@glb.bin"],_t.byteOffset||0,_t.byteLength)}return b.buffers[_t.buffer]});const ct=c.accessors||[];b.accessors=ct.map(_t=>{const Mt=g.createAccessor(_t.name,b.bufferViewBuffers[_t.bufferView]).setType(_t.type);return _t.extras&&Mt.setExtras(_t.extras),_t.normalized!==void 0&&Mt.setNormalized(_t.normalized),_t.bufferView===void 0||Mt.setArray(nR(_t,b)),Mt});const pt=c.images||[],gt=c.textures||[];g.getRoot().listExtensionsUsed().filter(_t=>_t.prereadTypes.includes(Zr.TEXTURE)).forEach(_t=>_t.preread(b,Zr.TEXTURE)),b.textures=pt.map(_t=>{const Mt=g.createTexture(_t.name);if(_t.extras&&Mt.setExtras(_t.extras),_t.bufferView!==void 0){const It=c.bufferViews[_t.bufferView],Bt=i.json.buffers[It.buffer],Lt=It.byteOffset||0,Ht=(Bt.uri?i.resources[Bt.uri]:i.resources["@glb.bin"]).slice(Lt,Lt+It.byteLength);Mt.setImage(Ht)}else _t.uri!==void 0&&(Mt.setImage(i.resources[_t.uri]),_t.uri.indexOf("__")!==0&&Mt.setURI(_t.uri));if(_t.mimeType!==void 0)Mt.setMimeType(_t.mimeType);else if(_t.uri){const It=tM.extension(_t.uri);Mt.setMimeType(pA.extensionToMimeType(It))}return Mt}),b.materials=(c.materials||[]).map(_t=>{const Mt=g.createMaterial(_t.name);_t.extras&&Mt.setExtras(_t.extras),_t.alphaMode!==void 0&&Mt.setAlphaMode(_t.alphaMode),_t.alphaCutoff!==void 0&&Mt.setAlphaCutoff(_t.alphaCutoff),_t.doubleSided!==void 0&&Mt.setDoubleSided(_t.doubleSided);const It=_t.pbrMetallicRoughness||{};if(It.baseColorFactor!==void 0&&Mt.setBaseColorFactor(It.baseColorFactor),_t.emissiveFactor!==void 0&&Mt.setEmissiveFactor(_t.emissiveFactor),It.metallicFactor!==void 0&&Mt.setMetallicFactor(It.metallicFactor),It.roughnessFactor!==void 0&&Mt.setRoughnessFactor(It.roughnessFactor),It.baseColorTexture!==void 0){const Bt=It.baseColorTexture;Mt.setBaseColorTexture(b.textures[gt[Bt.index].source]),b.setTextureInfo(Mt.getBaseColorTextureInfo(),Bt)}if(_t.emissiveTexture!==void 0){const Bt=_t.emissiveTexture;Mt.setEmissiveTexture(b.textures[gt[Bt.index].source]),b.setTextureInfo(Mt.getEmissiveTextureInfo(),Bt)}if(_t.normalTexture!==void 0){const Bt=_t.normalTexture;Mt.setNormalTexture(b.textures[gt[Bt.index].source]),b.setTextureInfo(Mt.getNormalTextureInfo(),Bt),_t.normalTexture.scale!==void 0&&Mt.setNormalScale(_t.normalTexture.scale)}if(_t.occlusionTexture!==void 0){const Bt=_t.occlusionTexture;Mt.setOcclusionTexture(b.textures[gt[Bt.index].source]),b.setTextureInfo(Mt.getOcclusionTextureInfo(),Bt),_t.occlusionTexture.strength!==void 0&&Mt.setOcclusionStrength(_t.occlusionTexture.strength)}if(It.metallicRoughnessTexture!==void 0){const Bt=It.metallicRoughnessTexture;Mt.setMetallicRoughnessTexture(b.textures[gt[Bt.index].source]),b.setTextureInfo(Mt.getMetallicRoughnessTextureInfo(),Bt)}return Mt});const At=c.meshes||[];g.getRoot().listExtensionsUsed().filter(_t=>_t.prereadTypes.includes(Zr.PRIMITIVE)).forEach(_t=>_t.preread(b,Zr.PRIMITIVE)),b.meshes=At.map(_t=>{const Mt=g.createMesh(_t.name);return _t.extras&&Mt.setExtras(_t.extras),_t.weights!==void 0&&Mt.setWeights(_t.weights),(_t.primitives||[]).forEach(It=>{const Bt=g.createPrimitive();It.extras&&Bt.setExtras(It.extras),It.material!==void 0&&Bt.setMaterial(b.materials[It.material]),It.mode!==void 0&&Bt.setMode(It.mode);for(const[Ht,Jt]of Object.entries(It.attributes||{}))Bt.setAttribute(Ht,b.accessors[Jt]);It.indices!==void 0&&Bt.setIndices(b.accessors[It.indices]);const Lt=_t.extras&&_t.extras.targetNames||[];(It.targets||[]).forEach((Ht,Jt)=>{const sn=Lt[Jt]||Jt.toString(),on=g.createPrimitiveTarget(sn);for(const[mn,cn]of Object.entries(Ht))on.setAttribute(mn,b.accessors[cn]);Bt.addTarget(on)}),Mt.addPrimitive(Bt)}),Mt}),b.cameras=(c.cameras||[]).map(_t=>{const Mt=g.createCamera(_t.name).setType(_t.type);if(_t.extras&&Mt.setExtras(_t.extras),_t.type===qE.Type.PERSPECTIVE){const It=_t.perspective;Mt.setYFov(It.yfov),Mt.setZNear(It.znear),It.zfar!==void 0&&Mt.setZFar(It.zfar),It.aspectRatio!==void 0&&Mt.setAspectRatio(It.aspectRatio)}else{const It=_t.orthographic;Mt.setZNear(It.znear).setZFar(It.zfar).setXMag(It.xmag).setYMag(It.ymag)}return Mt});const xt=c.nodes||[];g.getRoot().listExtensionsUsed().filter(_t=>_t.prereadTypes.includes(Zr.NODE)).forEach(_t=>_t.preread(b,Zr.NODE)),b.nodes=xt.map(_t=>{const Mt=g.createNode(_t.name);if(_t.extras&&Mt.setExtras(_t.extras),_t.translation!==void 0&&Mt.setTranslation(_t.translation),_t.rotation!==void 0&&Mt.setRotation(_t.rotation),_t.scale!==void 0&&Mt.setScale(_t.scale),_t.matrix!==void 0){const It=[0,0,0],Bt=[0,0,0,1],Lt=[1,1,1];Jl.decompose(_t.matrix,It,Bt,Lt),Mt.setTranslation(It),Mt.setRotation(Bt),Mt.setScale(Lt)}return _t.weights!==void 0&&Mt.setWeights(_t.weights),Mt}),b.skins=(c.skins||[]).map(_t=>{const Mt=g.createSkin(_t.name);_t.extras&&Mt.setExtras(_t.extras),_t.inverseBindMatrices!==void 0&&Mt.setInverseBindMatrices(b.accessors[_t.inverseBindMatrices]),_t.skeleton!==void 0&&Mt.setSkeleton(b.nodes[_t.skeleton]);for(const It of _t.joints)Mt.addJoint(b.nodes[It]);return Mt}),xt.map((_t,Mt)=>{const It=b.nodes[Mt];(_t.children||[]).forEach(Bt=>It.addChild(b.nodes[Bt])),_t.mesh!==void 0&&It.setMesh(b.meshes[_t.mesh]),_t.camera!==void 0&&It.setCamera(b.cameras[_t.camera]),_t.skin!==void 0&&It.setSkin(b.skins[_t.skin])}),b.animations=(c.animations||[]).map(_t=>{const Mt=g.createAnimation(_t.name);_t.extras&&Mt.setExtras(_t.extras);const It=(_t.samplers||[]).map(Bt=>{const Lt=g.createAnimationSampler().setInput(b.accessors[Bt.input]).setOutput(b.accessors[Bt.output]).setInterpolation(Bt.interpolation||nM.Interpolation.LINEAR);return Bt.extras&&Lt.setExtras(Bt.extras),Mt.addSampler(Lt),Lt});return(_t.channels||[]).forEach(Bt=>{const Lt=g.createAnimationChannel().setSampler(It[Bt.sampler]).setTargetPath(Bt.target.path);Bt.target.node!==void 0&&Lt.setTargetNode(b.nodes[Bt.target.node]),Bt.extras&&Lt.setExtras(Bt.extras),Mt.addChannel(Lt)}),Mt});const yt=c.scenes||[];return g.getRoot().listExtensionsUsed().filter(_t=>_t.prereadTypes.includes(Zr.SCENE)).forEach(_t=>_t.preread(b,Zr.SCENE)),b.scenes=yt.map(_t=>{const Mt=g.createScene(_t.name);return _t.extras&&Mt.setExtras(_t.extras),(_t.nodes||[]).map(It=>b.nodes[It]).forEach(It=>Mt.addChild(It)),Mt}),c.scene!==void 0&&g.getRoot().setDefaultScene(b.scenes[c.scene]),g.getRoot().listExtensionsUsed().forEach(_t=>_t.read(b)),ct.forEach((_t,Mt)=>{const It=b.accessors[Mt],Bt=!!_t.sparse,Lt=!_t.bufferView&&!It.getArray();(Bt||Lt)&&It.setSparse(!0).setArray(function(Ht,Jt){const sn=YP[Ht.componentType],on=gs.getElementSize(Ht.type);let mn;mn=Ht.bufferView!==void 0?nR(Ht,Jt):new sn(Ht.count*on);const cn=Ht.sparse;if(!cn)return mn;const un=cn.count,bn=Xv({},Ht,cn.indices,{count:un,type:"SCALAR"}),xn=Xv({},Ht,cn.values,{count:un}),Cn=nR(bn,Jt),Jn=nR(xn,Jt);for(let Kn=0;Kn<bn.count;Kn++)for(let gr=0;gr<on;gr++)mn[Cn[Kn]*on+gr]=Jn[Kn*on+gr];return mn}(_t,b))}),g}static validate(i,s){const o=i.json;if(o.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${o.asset.version}".`);if(o.extensionsRequired){for(const c of o.extensionsRequired)if(!s.extensions.find(g=>g.EXTENSION_NAME===c))throw new Error(`Missing required extension, "${c}".`)}if(o.extensionsUsed)for(const c of o.extensionsUsed)s.extensions.find(g=>g.EXTENSION_NAME===c)||s.logger.warn(`Missing optional extension, "${c}".`)}}).read(e,{extensions:Array.from(this.h),dependencies:this.F,logger:this.M})}async binaryToJSON(e){const i=this.P(yo.assertView(e));this.j(i);const s=i.json;if(s.buffers&&s.buffers.some(o=>function(c,g){return g.uri!==void 0&&!(g.uri in c.resources)}(i,o)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(o=>function(c,g){return g.uri!==void 0&&!(g.uri in c.resources)&&g.bufferView===void 0}(i,o)))throw new Error("Cannot resolve external images with binaryToJSON().");return i}async readBinary(e){return this.readJSON(await this.binaryToJSON(yo.assertView(e)))}async writeJSON(e,i={}){if(i.format===QE.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return(class{static write(s,o){const c=s.getRoot(),g={asset:Xv({generator:"glTF-Transform v3.2.1"},c.getAsset()),extras:Xv({},c.getExtras())},b={json:g,resources:{}},et=new fA(s,b,o),tt=o.logger||I_.DEFAULT_INSTANCE,rt=new Set(o.extensions.map(yt=>yt.EXTENSION_NAME)),st=s.getRoot().listExtensionsUsed().filter(yt=>rt.has(yt.extensionName)),at=s.getRoot().listExtensionsRequired().filter(yt=>rt.has(yt.extensionName));st.length<s.getRoot().listExtensionsUsed().length&&tt.warn("Some extensions were not registered for I/O, and will not be written.");for(const yt of st)for(const _t of yt.writeDependencies)yt.install(_t,o.dependencies[_t]);function ct(yt,_t,Mt,It){const Bt=[];let Lt=0;for(const Jt of yt){const sn=et.createAccessorDef(Jt);sn.bufferView=g.bufferViews.length;const on=Jt.getArray(),mn=yo.pad(yo.toView(on));sn.byteOffset=Lt,Lt+=mn.byteLength,Bt.push(mn),et.accessorIndexMap.set(Jt,g.accessors.length),g.accessors.push(sn)}const Ht={buffer:_t,byteOffset:Mt,byteLength:yo.concat(Bt).byteLength};return It&&(Ht.target=It),g.bufferViews.push(Ht),{buffers:Bt,byteLength:Lt}}function pt(yt,_t,Mt){const It=yt[0].getCount();let Bt=0;for(const sn of yt){const on=et.createAccessorDef(sn);on.bufferView=g.bufferViews.length,on.byteOffset=Bt;const mn=sn.getElementSize(),cn=sn.getComponentSize();Bt+=yo.padNumber(mn*cn),et.accessorIndexMap.set(sn,g.accessors.length),g.accessors.push(on)}const Lt=It*Bt,Ht=new ArrayBuffer(Lt),Jt=new DataView(Ht);for(let sn=0;sn<It;sn++){let on=0;for(const mn of yt){const cn=mn.getElementSize(),un=mn.getComponentSize(),bn=mn.getComponentType(),xn=mn.getArray();for(let Cn=0;Cn<cn;Cn++){const Jn=sn*Bt+on+Cn*un,Kn=xn[sn*cn+Cn];switch(bn){case gs.ComponentType.FLOAT:Jt.setFloat32(Jn,Kn,!0);break;case gs.ComponentType.BYTE:Jt.setInt8(Jn,Kn);break;case gs.ComponentType.SHORT:Jt.setInt16(Jn,Kn,!0);break;case gs.ComponentType.UNSIGNED_BYTE:Jt.setUint8(Jn,Kn);break;case gs.ComponentType.UNSIGNED_SHORT:Jt.setUint16(Jn,Kn,!0);break;case gs.ComponentType.UNSIGNED_INT:Jt.setUint32(Jn,Kn,!0);break;default:throw new Error("Unexpected component type: "+bn)}}on+=yo.padNumber(cn*un)}}return g.bufferViews.push({buffer:_t,byteOffset:Mt,byteLength:Lt,byteStride:Bt,target:fA.BufferViewTarget.ARRAY_BUFFER}),{byteLength:Lt,buffers:[new Uint8Array(Ht)]}}function gt(yt,_t,Mt){const It=[];let Bt=0;const Lt=new Map;let Ht=-1/0;for(const bn of yt){const xn=et.createAccessorDef(bn);g.accessors.push(xn),et.accessorIndexMap.set(bn,g.accessors.length-1);const Cn=[],Jn=[],Kn=[],gr=new Array(bn.getElementSize()).fill(0);for(let Ar=0,Hr=bn.getCount();Ar<Hr;Ar++)if(bn.getElement(Ar,Kn),!Jl.eq(Kn,gr,0)){Ht=Math.max(Ar,Ht),Cn.push(Ar);for(let Jr=0;Jr<Kn.length;Jr++)Jn.push(Kn[Jr])}const nr=Cn.length,tr={accessorDef:xn,count:nr};if(Lt.set(bn,tr),nr===0)continue;if(nr>bn.getCount()/3){const Ar=(100*Cn.length/bn.getCount()).toFixed(1);tt.warn(`Sparse accessor with many non-zero elements (${Ar}%) may increase file size.`)}const Cr=YP[bn.getComponentType()];tr.indices=Cn,tr.values=new Cr(Jn)}if(!Number.isFinite(Ht))return{buffers:It,byteLength:Bt};const Jt=Ht<255?Uint8Array:Ht<65535?Uint16Array:Uint32Array,sn=Ht<255?C5:Ht<65535?S5:E5,on={buffer:_t,byteOffset:Mt+Bt,byteLength:0};for(const bn of yt){const xn=Lt.get(bn);if(xn.count===0)continue;xn.indicesByteOffset=on.byteLength;const Cn=yo.pad(yo.toView(new Jt(xn.indices)));It.push(Cn),Bt+=Cn.byteLength,on.byteLength+=Cn.byteLength}g.bufferViews.push(on);const mn=g.bufferViews.length-1,cn={buffer:_t,byteOffset:Mt+Bt,byteLength:0};for(const bn of yt){const xn=Lt.get(bn);if(xn.count===0)continue;xn.valuesByteOffset=cn.byteLength;const Cn=yo.pad(yo.toView(xn.values));It.push(Cn),Bt+=Cn.byteLength,cn.byteLength+=Cn.byteLength}g.bufferViews.push(cn);const un=g.bufferViews.length-1;for(const bn of yt){const xn=Lt.get(bn);xn.count!==0&&(xn.accessorDef.sparse={count:xn.count,indices:{bufferView:mn,byteOffset:xn.indicesByteOffset,componentType:sn},values:{bufferView:un,byteOffset:xn.valuesByteOffset}})}return{buffers:It,byteLength:Bt}}const At=new Map;for(const yt of s.getGraph().listEdges()){if(yt.getParent()===c)continue;const _t=yt.getChild();if(_t instanceof gs){const Mt=At.get(_t)||[];Mt.push(yt),At.set(_t,Mt)}}if(g.accessors=[],g.bufferViews=[],g.samplers=[],g.textures=[],g.images=c.listTextures().map((yt,_t)=>{const Mt=et.createPropertyDef(yt);yt.getMimeType()&&(Mt.mimeType=yt.getMimeType());const It=yt.getImage();return It&&et.createImageData(Mt,It,yt),et.imageIndexMap.set(yt,_t),Mt}),st.filter(yt=>yt.prewriteTypes.includes(Zr.ACCESSOR)).forEach(yt=>yt.prewrite(et,Zr.ACCESSOR)),c.listAccessors().forEach(yt=>{const _t=et.accessorUsageGroupedByParent,Mt=et.accessorParents;if(et.accessorIndexMap.has(yt))return;const It=At.get(yt)||[],Bt=et.getAccessorUsage(yt);if(et.addAccessorToUsageGroup(yt,Bt),_t.has(Bt)){const Lt=It[0].getParent(),Ht=Mt.get(Lt)||new Set;Ht.add(yt),Mt.set(Lt,Ht)}}),st.filter(yt=>yt.prewriteTypes.includes(Zr.BUFFER)).forEach(yt=>yt.prewrite(et,Zr.BUFFER)),(c.listAccessors().length>0||c.listTextures().length>0||et.otherBufferViews.size>0)&&c.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");g.buffers=[],c.listBuffers().forEach((yt,_t)=>{const Mt=et.createPropertyDef(yt),It=et.accessorUsageGroupedByParent,Bt=et.accessorParents,Lt=yt.listParents().filter(cn=>cn instanceof gs),Ht=new Set(Lt),Jt=[],sn=g.buffers.length;let on=0;const mn=et.listAccessorUsageGroups();for(const cn in mn)if(It.has(cn))for(const un of Array.from(Bt.values())){const bn=Array.from(un).filter(xn=>Ht.has(xn)).filter(xn=>et.getAccessorUsage(xn)===cn);if(bn.length)if(cn!==iR.ARRAY_BUFFER||o.vertexLayout===XP.INTERLEAVED){const xn=cn===iR.ARRAY_BUFFER?pt(bn,sn,on):ct(bn,sn,on);on+=xn.byteLength,Jt.push(...xn.buffers)}else for(const xn of bn){const Cn=pt([xn],sn,on);on+=Cn.byteLength,Jt.push(...Cn.buffers)}}else{const un=mn[cn].filter(Cn=>Ht.has(Cn));if(!un.length)continue;const bn=cn===iR.ELEMENT_ARRAY_BUFFER?fA.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,xn=cn===iR.SPARSE?gt(un,sn,on):ct(un,sn,on,bn);on+=xn.byteLength,Jt.push(...xn.buffers)}if(et.imageBufferViews.length&&_t===0){for(let cn=0;cn<et.imageBufferViews.length;cn++)if(g.bufferViews[g.images[cn].bufferView].byteOffset=on,on+=et.imageBufferViews[cn].byteLength,Jt.push(et.imageBufferViews[cn]),on%8){const un=8-on%8;on+=un,Jt.push(new Uint8Array(un))}}if(et.otherBufferViews.has(yt))for(const cn of et.otherBufferViews.get(yt))g.bufferViews.push({buffer:sn,byteOffset:on,byteLength:cn.byteLength}),et.otherBufferViewsIndexMap.set(cn,g.bufferViews.length-1),on+=cn.byteLength,Jt.push(cn);if(on){let cn;o.format===QE.GLB?cn="@glb.bin":(cn=et.bufferURIGenerator.createURI(yt,"bin"),Mt.uri=cn),Mt.byteLength=on,b.resources[cn]=yo.concat(Jt)}g.buffers.push(Mt),et.bufferIndexMap.set(yt,_t)}),c.listAccessors().find(yt=>!yt.getBuffer())&&tt.warn("Skipped writing one or more Accessors: no Buffer assigned."),g.materials=c.listMaterials().map((yt,_t)=>{const Mt=et.createPropertyDef(yt);if(yt.getAlphaMode()!==XE.AlphaMode.OPAQUE&&(Mt.alphaMode=yt.getAlphaMode()),yt.getAlphaMode()===XE.AlphaMode.MASK&&(Mt.alphaCutoff=yt.getAlphaCutoff()),yt.getDoubleSided()&&(Mt.doubleSided=!0),Mt.pbrMetallicRoughness={},Jl.eq(yt.getBaseColorFactor(),[1,1,1,1])||(Mt.pbrMetallicRoughness.baseColorFactor=yt.getBaseColorFactor()),Jl.eq(yt.getEmissiveFactor(),[0,0,0])||(Mt.emissiveFactor=yt.getEmissiveFactor()),yt.getRoughnessFactor()!==1&&(Mt.pbrMetallicRoughness.roughnessFactor=yt.getRoughnessFactor()),yt.getMetallicFactor()!==1&&(Mt.pbrMetallicRoughness.metallicFactor=yt.getMetallicFactor()),yt.getBaseColorTexture()){const It=yt.getBaseColorTexture(),Bt=yt.getBaseColorTextureInfo();Mt.pbrMetallicRoughness.baseColorTexture=et.createTextureInfoDef(It,Bt)}if(yt.getEmissiveTexture()){const It=yt.getEmissiveTexture(),Bt=yt.getEmissiveTextureInfo();Mt.emissiveTexture=et.createTextureInfoDef(It,Bt)}if(yt.getNormalTexture()){const It=yt.getNormalTexture(),Bt=yt.getNormalTextureInfo(),Lt=et.createTextureInfoDef(It,Bt);yt.getNormalScale()!==1&&(Lt.scale=yt.getNormalScale()),Mt.normalTexture=Lt}if(yt.getOcclusionTexture()){const It=yt.getOcclusionTexture(),Bt=yt.getOcclusionTextureInfo(),Lt=et.createTextureInfoDef(It,Bt);yt.getOcclusionStrength()!==1&&(Lt.strength=yt.getOcclusionStrength()),Mt.occlusionTexture=Lt}if(yt.getMetallicRoughnessTexture()){const It=yt.getMetallicRoughnessTexture(),Bt=yt.getMetallicRoughnessTextureInfo();Mt.pbrMetallicRoughness.metallicRoughnessTexture=et.createTextureInfoDef(It,Bt)}return et.materialIndexMap.set(yt,_t),Mt}),g.meshes=c.listMeshes().map((yt,_t)=>{const Mt=et.createPropertyDef(yt);let It=null;return Mt.primitives=yt.listPrimitives().map(Bt=>{const Lt={attributes:{}};Lt.mode=Bt.getMode();const Ht=Bt.getMaterial();Ht&&(Lt.material=et.materialIndexMap.get(Ht)),Object.keys(Bt.getExtras()).length&&(Lt.extras=Bt.getExtras());const Jt=Bt.getIndices();Jt&&(Lt.indices=et.accessorIndexMap.get(Jt));for(const sn of Bt.listSemantics())Lt.attributes[sn]=et.accessorIndexMap.get(Bt.getAttribute(sn));for(const sn of Bt.listTargets()){const on={};for(const mn of sn.listSemantics())on[mn]=et.accessorIndexMap.get(sn.getAttribute(mn));Lt.targets=Lt.targets||[],Lt.targets.push(on)}return Bt.listTargets().length&&!It&&(It=Bt.listTargets().map(sn=>sn.getName())),Lt}),yt.getWeights().length&&(Mt.weights=yt.getWeights()),It&&(Mt.extras=Mt.extras||{},Mt.extras.targetNames=It),et.meshIndexMap.set(yt,_t),Mt}),g.cameras=c.listCameras().map((yt,_t)=>{const Mt=et.createPropertyDef(yt);if(Mt.type=yt.getType(),Mt.type===qE.Type.PERSPECTIVE){Mt.perspective={znear:yt.getZNear(),zfar:yt.getZFar(),yfov:yt.getYFov()};const It=yt.getAspectRatio();It!==null&&(Mt.perspective.aspectRatio=It)}else Mt.orthographic={znear:yt.getZNear(),zfar:yt.getZFar(),xmag:yt.getXMag(),ymag:yt.getYMag()};return et.cameraIndexMap.set(yt,_t),Mt}),g.nodes=c.listNodes().map((yt,_t)=>{const Mt=et.createPropertyDef(yt);return Jl.eq(yt.getTranslation(),[0,0,0])||(Mt.translation=yt.getTranslation()),Jl.eq(yt.getRotation(),[0,0,0,1])||(Mt.rotation=yt.getRotation()),Jl.eq(yt.getScale(),[1,1,1])||(Mt.scale=yt.getScale()),yt.getWeights().length&&(Mt.weights=yt.getWeights()),et.nodeIndexMap.set(yt,_t),Mt}),g.skins=c.listSkins().map((yt,_t)=>{const Mt=et.createPropertyDef(yt),It=yt.getInverseBindMatrices();It&&(Mt.inverseBindMatrices=et.accessorIndexMap.get(It));const Bt=yt.getSkeleton();return Bt&&(Mt.skeleton=et.nodeIndexMap.get(Bt)),Mt.joints=yt.listJoints().map(Lt=>et.nodeIndexMap.get(Lt)),et.skinIndexMap.set(yt,_t),Mt}),c.listNodes().forEach((yt,_t)=>{const Mt=g.nodes[_t],It=yt.getMesh();It&&(Mt.mesh=et.meshIndexMap.get(It));const Bt=yt.getCamera();Bt&&(Mt.camera=et.cameraIndexMap.get(Bt));const Lt=yt.getSkin();Lt&&(Mt.skin=et.skinIndexMap.get(Lt)),yt.listChildren().length>0&&(Mt.children=yt.listChildren().map(Ht=>et.nodeIndexMap.get(Ht)))}),g.animations=c.listAnimations().map((yt,_t)=>{const Mt=et.createPropertyDef(yt),It=new Map;return Mt.samplers=yt.listSamplers().map((Bt,Lt)=>{const Ht=et.createPropertyDef(Bt);return Ht.input=et.accessorIndexMap.get(Bt.getInput()),Ht.output=et.accessorIndexMap.get(Bt.getOutput()),Ht.interpolation=Bt.getInterpolation(),It.set(Bt,Lt),Ht}),Mt.channels=yt.listChannels().map(Bt=>{const Lt=et.createPropertyDef(Bt);return Lt.sampler=It.get(Bt.getSampler()),Lt.target={node:et.nodeIndexMap.get(Bt.getTargetNode()),path:Bt.getTargetPath()},Lt}),et.animationIndexMap.set(yt,_t),Mt}),g.scenes=c.listScenes().map((yt,_t)=>{const Mt=et.createPropertyDef(yt);return Mt.nodes=yt.listChildren().map(It=>et.nodeIndexMap.get(It)),et.sceneIndexMap.set(yt,_t),Mt});const xt=c.getDefaultScene();return xt&&(g.scene=c.listScenes().indexOf(xt)),g.extensionsUsed=st.map(yt=>yt.extensionName),g.extensionsRequired=at.map(yt=>yt.extensionName),st.forEach(yt=>yt.write(et)),function(yt){const _t=[];for(const Mt in yt){const It=yt[Mt];(Array.isArray(It)&&It.length===0||It===null||It===""||It&&typeof It=="object"&&Object.keys(It).length===0)&&_t.push(Mt)}for(const Mt of _t)delete yt[Mt]}(g),b}}).write(e,{format:i.format||QE.GLTF,basename:i.basename||"",logger:this.M,vertexLayout:this.U,dependencies:Xv({},this.F),extensions:Array.from(this.h)})}async writeBinary(e){const{json:i,resources:s}=await this.writeJSON(e,{format:QE.GLB}),o=new Uint32Array([1179937895,2,12]),c=JSON.stringify(i),g=yo.pad(yo.encodeText(c),32),b=yo.toView(new Uint32Array([g.byteLength,1313821514])),et=yo.concat([b,g]);o[o.length-1]+=et.byteLength;const tt=Object.values(s)[0];if(!tt||!tt.byteLength)return yo.concat([yo.toView(o),et]);const rt=yo.pad(tt,0),st=yo.toView(new Uint32Array([rt.byteLength,5130562])),at=yo.concat([st,rt]);return o[o.length-1]+=at.byteLength,yo.concat([yo.toView(o),et,at])}async L(e,i){var s=this;const o=[...e.json.images||[],...e.json.buffers||[]].map(async function(c){const g=c.uri;if(!g||g.match(/data:/))return Promise.resolve();e.resources[g]=await s.readURI(s.resolve(i,g),"view"),s.lastReadBytes+=e.resources[g].byteLength});await Promise.all(o)}j(e){function i(s){if(s.uri){if(s.uri in e.resources)yo.assertView(e.resources[s.uri]);else if(s.uri.match(/data:/)){const o=`__${function(){for(let c=0;c<999;c++){const g=y5();if(!M3.has(g))return M3.add(g),g}return""}()}.${tM.extension(s.uri)}`;e.resources[o]=yo.createBufferFromDataURI(s.uri),s.uri=o}}}(e.json.images||[]).forEach(s=>{if(s.bufferView===void 0&&s.uri===void 0)throw new Error("Missing resource URI or buffer view.");i(s)}),(e.json.buffers||[]).forEach(i)}D(e){const{images:i,buffers:s}=e.json;return e={json:Xv({},e.json),resources:Xv({},e.resources)},i&&(e.json.images=i.map(o=>Xv({},o))),s&&(e.json.buffers=s.map(o=>Xv({},o))),e}P(e){if(!U3(e))throw new Error("Invalid glTF 2.0 binary.");const i=new Uint32Array(e.buffer,e.byteOffset+12,2);if(i[1]!==rR.JSON)throw new Error("Missing required GLB JSON chunk.");const s=i[0],o=yo.decodeText(yo.toView(e,20,s)),c=JSON.parse(o),g=20+s;if(e.byteLength<=g)return{json:c,resources:{}};const b=new Uint32Array(e.buffer,e.byteOffset+g,2);if(b[1]!==rR.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:c,resources:{"@glb.bin":yo.toView(e,g+8,b[0])}}}}function U3(h){if(h.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(h.buffer,h.byteOffset,3);return e[0]===1179937895&&e[1]===2}class T5 extends M5{constructor(e=pI.DEFAULT_INIT){super(),this.k=void 0,this.k=e}async readURI(e,i){const s=await fetch(e,this.k);switch(i){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}resolve(e,i){return pI.resolve(e,i)}dirname(e){return pI.dirname(e)}}const I5=64;class P5{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class mI{constructor(e,i,s,o){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=o,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let o=0;for(;this._dataView.getUint8(this._offset)!==i&&o<e;)o++,this._offset++;return o<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,o)}}const dv=[171,75,84,88,32,50,48,187,13,10,26,10];function F3(h){return typeof TextDecoder<"u"?new TextDecoder().decode(h):Buffer.from(h).toString("utf8")}function wO(h){const e=new Uint8Array(h.buffer,h.byteOffset,dv.length);if(e[0]!==dv[0]||e[1]!==dv[1]||e[2]!==dv[2]||e[3]!==dv[3]||e[4]!==dv[4]||e[5]!==dv[5]||e[6]!==dv[6]||e[7]!==dv[7]||e[8]!==dv[8]||e[9]!==dv[9]||e[10]!==dv[10]||e[11]!==dv[11])throw new Error("Missing KTX 2.0 identifier.");const i=new P5,s=17*Uint32Array.BYTES_PER_ELEMENT,o=new mI(h,dv.length,s,!0);i.vkFormat=o._nextUint32(),i.typeSize=o._nextUint32(),i.pixelWidth=o._nextUint32(),i.pixelHeight=o._nextUint32(),i.pixelDepth=o._nextUint32(),i.layerCount=o._nextUint32(),i.faceCount=o._nextUint32();const c=o._nextUint32();i.supercompressionScheme=o._nextUint32();const g=o._nextUint32(),b=o._nextUint32(),et=o._nextUint32(),tt=o._nextUint32(),rt=o._nextUint64(),st=o._nextUint64(),at=3*c*8,ct=new mI(h,dv.length+s,at,!0);for(let Jn=0;Jn<c;Jn++)i.levels.push({levelData:new Uint8Array(h.buffer,h.byteOffset+ct._nextUint64(),ct._nextUint64()),uncompressedByteLength:ct._nextUint64()});const pt=new mI(h,g,b,!0),gt={vendorId:pt._skip(4)._nextUint16(),descriptorType:pt._nextUint16(),versionNumber:pt._nextUint16(),descriptorBlockSize:pt._nextUint16(),colorModel:pt._nextUint8(),colorPrimaries:pt._nextUint8(),transferFunction:pt._nextUint8(),flags:pt._nextUint8(),texelBlockDimension:[pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8()],bytesPlane:[pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8()],samples:[]},At=(gt.descriptorBlockSize/4-6)/4;for(let Jn=0;Jn<At;Jn++){const Kn={bitOffset:pt._nextUint16(),bitLength:pt._nextUint8(),channelType:pt._nextUint8(),samplePosition:[pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};Kn.channelType&I5?(Kn.sampleLower=pt._nextInt32(),Kn.sampleUpper=pt._nextInt32()):(Kn.sampleLower=pt._nextUint32(),Kn.sampleUpper=pt._nextUint32()),gt.samples[Jn]=Kn}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(gt);const xt=new mI(h,et,tt,!0);for(;xt._offset<tt;){const Jn=xt._nextUint32(),Kn=xt._scan(Jn),gr=F3(Kn),nr=xt._scan(Jn-Kn.byteLength);i.keyValue[gr]=gr.match(/^ktx/i)?F3(nr):nr,xt._offset%4&&xt._skip(4-xt._offset%4)}if(st<=0)return i;const yt=new mI(h,rt,st,!0),_t=yt._nextUint16(),Mt=yt._nextUint16(),It=yt._nextUint32(),Bt=yt._nextUint32(),Lt=yt._nextUint32(),Ht=yt._nextUint32(),Jt=[];for(let Jn=0;Jn<c;Jn++)Jt.push({imageFlags:yt._nextUint32(),rgbSliceByteOffset:yt._nextUint32(),rgbSliceByteLength:yt._nextUint32(),alphaSliceByteOffset:yt._nextUint32(),alphaSliceByteLength:yt._nextUint32()});const sn=rt+yt._offset,on=sn+It,mn=on+Bt,cn=mn+Lt,un=new Uint8Array(h.buffer,h.byteOffset+sn,It),bn=new Uint8Array(h.buffer,h.byteOffset+on,Bt),xn=new Uint8Array(h.buffer,h.byteOffset+mn,Lt),Cn=new Uint8Array(h.buffer,h.byteOffset+cn,Ht);return i.globalData={endpointCount:_t,selectorCount:Mt,imageDescs:Jt,endpointsData:un,selectorsData:bn,tablesData:xn,extendedData:Cn},i}class j3 extends ju{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[Zr.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}j3.EXTENSION_NAME="EXT_mesh_gpu_instancing";const KE="EXT_mesh_gpu_instancing";class z3 extends au{constructor(...e){super(...e),this.extensionName=KE,this.provideTypes=[Zr.NODE],this.prewriteTypes=[Zr.ACCESSOR]}createInstancedMesh(){return new j3(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((i,s)=>{if(!i.extensions||!i.extensions[KE])return;const o=i.extensions[KE],c=this.createInstancedMesh();for(const g in o.attributes)c.setAttribute(g,e.accessors[o.attributes[g]]);e.nodes[s].setExtension(KE,c)}),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const i of this.properties)for(const s of i.listAttributes())e.addAccessorToUsageGroup(s,"INSTANCE_ATTRIBUTE");return this}write(e){const i=e.jsonDoc;return this.document.getRoot().listNodes().forEach(s=>{const o=s.getExtension(KE);if(o){const c=e.nodeIndexMap.get(s),g=i.json.nodes[c],b={attributes:{}};o.listSemantics().forEach(et=>{const tt=o.getAttribute(et);b.attributes[et]=e.accessorIndexMap.get(tt)}),g.extensions=g.extensions||{},g.extensions[KE]=b}}),this}}function g1(){return(g1=Object.assign||function(h){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(h[s]=i[s])}return h}).apply(this,arguments)}var gI,rM,$u;z3.EXTENSION_NAME=KE,function(h){h.QUANTIZE="quantize",h.FILTER="filter"}(gI||(gI={})),function(h){h.ATTRIBUTES="ATTRIBUTES",h.TRIANGLES="TRIANGLES",h.INDICES="INDICES"}(rM||(rM={})),function(h){h.NONE="NONE",h.OCTAHEDRAL="OCTAHEDRAL",h.QUATERNION="QUATERNION",h.EXPONENTIAL="EXPONENTIAL"}($u||($u={}));const{BYTE:R5,SHORT:V3,FLOAT:D5}=gs.ComponentType,{encodeNormalizedInt:G3,decodeNormalizedInt:xO}=Jl;function k5(h,e,i,s){const{filter:o,bits:c}=s,g={array:h.getArray(),byteStride:h.getElementSize()*h.getComponentSize(),componentType:h.getComponentType(),normalized:h.getNormalized()};if(i!==rM.ATTRIBUTES)return g;if(o!==$u.NONE){let b=h.getNormalized()?function(et){const tt=et.getComponentType(),rt=et.getArray(),st=new Float32Array(rt.length);for(let at=0;at<rt.length;at++)st[at]=xO(rt[at],tt);return st}(h):new Float32Array(g.array);switch(o){case $u.EXPONENTIAL:g.byteStride=4*h.getElementSize(),g.componentType=D5,g.normalized=!1,g.array=e.encodeFilterExp(b,h.getCount(),g.byteStride,c);break;case $u.OCTAHEDRAL:g.byteStride=c>8?8:4,g.componentType=c>8?V3:R5,g.normalized=!0,b=h.getElementSize()===3?function(et){const tt=new Float32Array(4*et.length/3);for(let rt=0,st=et.length/3;rt<st;rt++)tt[4*rt]=et[3*rt],tt[4*rt+1]=et[3*rt+1],tt[4*rt+2]=et[3*rt+2];return tt}(b):b,g.array=e.encodeFilterOct(b,h.getCount(),g.byteStride,c);break;case $u.QUATERNION:g.byteStride=8,g.componentType=V3,g.normalized=!0,g.array=e.encodeFilterQuat(b,h.getCount(),g.byteStride,c);break;default:throw new Error("Invalid filter.")}g.min=h.getMin([]),g.max=h.getMax([]),h.getNormalized()&&(g.min=g.min.map(et=>xO(et,h.getComponentType())),g.max=g.max.map(et=>xO(et,h.getComponentType()))),g.normalized&&(g.min=g.min.map(et=>G3(et,g.componentType)),g.max=g.max.map(et=>G3(et,g.componentType)))}else g.byteStride%4&&(g.array=function(b,et){const tt=yo.padNumber(b.BYTES_PER_ELEMENT*et)/b.BYTES_PER_ELEMENT,rt=new b.constructor(b.length/et*tt);for(let st=0;st*et<b.length;st++)for(let at=0;at<et;at++)rt[st*tt+at]=b[st*et+at];return rt}(g.array,h.getElementSize()),g.byteStride=g.array.byteLength/h.getCount());return g}function B5(h,e){return e===fA.BufferViewUsage.ELEMENT_ARRAY_BUFFER?h.listParents().some(i=>i instanceof YE&&i.getMode()===YE.Mode.TRIANGLES)?rM.TRIANGLES:rM.INDICES:rM.ATTRIBUTES}function O5(h,e){const i=e.getGraph().listParentEdges(h).filter(s=>!(s.getParent()instanceof O3));for(const s of i){const o=s.getName(),c=s.getAttributes().key||"";if(o==="indices")return{filter:$u.NONE};if(o==="attributes"){if(c==="POSITION")return{filter:$u.NONE};if(c==="TEXCOORD_0")return{filter:$u.NONE};if(c==="NORMAL")return{filter:$u.OCTAHEDRAL,bits:8};if(c==="TANGENT")return{filter:$u.OCTAHEDRAL,bits:8};if(c.startsWith("JOINTS_"))return{filter:$u.NONE};if(c.startsWith("WEIGHTS_"))return{filter:$u.NONE}}if(o==="output"){const g=H3(h);return g==="rotation"?{filter:$u.QUATERNION,bits:16}:g==="translation"||g==="scale"?{filter:$u.EXPONENTIAL,bits:12}:{filter:$u.NONE}}if(o==="input")return{filter:$u.NONE};if(o==="inverseBindMatrices")return{filter:$u.NONE}}return{filter:$u.NONE}}function H3(h){for(const e of h.listParents())if(e instanceof nM){for(const i of e.listParents())if(i instanceof bO)return i.getTargetPath()}return null}const pv="EXT_meshopt_compression",Q3={method:gI.QUANTIZE};class EO extends au{constructor(...e){super(...e),this.extensionName=pv,this.prereadTypes=[Zr.BUFFER,Zr.PRIMITIVE],this.prewriteTypes=[Zr.BUFFER,Zr.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=Q3,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,i){return e==="meshopt.decoder"&&(this._decoder=i),e==="meshopt.encoder"&&(this._encoder=i),this}setEncoderOptions(e){return this._encoderOptions=g1({},Q3,e),this}preread(e,i){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${pv}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${pv}]: Missing WASM support.`)}return i===Zr.BUFFER?this._prereadBuffers(e):i===Zr.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach((s,o)=>{if(!s.extensions||!s.extensions[pv])return;const c=s.extensions[pv],g=c.byteOffset||0,b=c.byteLength||0,et=c.count,tt=c.byteStride,rt=new Uint8Array(et*tt),st=i.json.buffers[c.buffer],at=yo.toView(st.uri?i.resources[st.uri]:i.resources[w3],g,b);this._decoder.decodeGltfBuffer(rt,et,tt,at,c.mode,c.filter),e.bufferViews[o]=rt})}_prereadPrimitives(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach(s=>{var o;s.extensions&&s.extensions[pv]&&(o=i.json.buffers[s.buffer]).extensions&&o.extensions.EXT_meshopt_compression&&o.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[s.buffer],e.buffers[s.extensions[pv].buffer])})}read(e){if(!this.isRequired())return this;for(const[i,s]of this._decoderFallbackBufferMap){for(const o of i.listParents())o instanceof gs&&o.swap(i,s);i.dispose()}return this}prewrite(e,i){return i===Zr.ACCESSOR?this._prewriteAccessors(e):i===Zr.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const i=e.jsonDoc.json,s=this._encoder,o=this._encoderOptions,c=this.document.createBuffer(),g=this.document.getRoot().listBuffers().indexOf(c);this._encoderFallbackBuffer=c,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const b of this.document.getRoot().listAccessors()){if(H3(b)==="weights"||b.getSparse())continue;const et=e.getAccessorUsage(b),tt=B5(b,et),rt=o.method===gI.FILTER?O5(b,this.document):{filter:$u.NONE},st=k5(b,s,tt,rt),{array:at,byteStride:ct}=st,pt=b.getBuffer();if(!pt)throw new Error(`${pv}: Missing buffer for accessor.`);const gt=this.document.getRoot().listBuffers().indexOf(pt),At=[et,tt,rt.filter,ct,gt].join(":");let xt=this._encoderBufferViews[At],yt=this._encoderBufferViewData[At],_t=this._encoderBufferViewAccessors[At];xt&&yt||(_t=this._encoderBufferViewAccessors[At]=[],yt=this._encoderBufferViewData[At]=[],xt=this._encoderBufferViews[At]={buffer:g,target:fA.USAGE_TO_TARGET[et],byteOffset:0,byteLength:0,byteStride:et===fA.BufferViewUsage.ARRAY_BUFFER?ct:void 0,extensions:{[pv]:{buffer:gt,byteOffset:0,byteLength:0,mode:tt,filter:rt.filter!==$u.NONE?rt.filter:void 0,byteStride:ct,count:0}}});const Mt=e.createAccessorDef(b);Mt.componentType=st.componentType,Mt.normalized=st.normalized,Mt.byteOffset=xt.byteLength,Mt.min&&st.min&&(Mt.min=st.min),Mt.max&&st.max&&(Mt.max=st.max),e.accessorIndexMap.set(b,i.accessors.length),i.accessors.push(Mt),_t.push(Mt),yt.push(new Uint8Array(at.buffer,at.byteOffset,at.byteLength)),xt.byteLength+=at.byteLength,xt.extensions.EXT_meshopt_compression.count+=b.getCount()}}_prewriteBuffers(e){const i=this._encoder;for(const s in this._encoderBufferViews){const o=this._encoderBufferViews[s],c=this._encoderBufferViewData[s],g=this.document.getRoot().listBuffers()[o.extensions[pv].buffer],b=e.otherBufferViews.get(g)||[],{count:et,byteStride:tt,mode:rt}=o.extensions[pv],st=yo.concat(c),at=i.encodeGltfBuffer(st,et,tt,rt),ct=yo.pad(at);o.extensions[pv].byteLength=at.byteLength,c.length=0,c.push(ct),b.push(ct),e.otherBufferViews.set(g,b)}}write(e){let i=0;for(const g in this._encoderBufferViews){const b=this._encoderBufferViews[g],et=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[g][0]),tt=this._encoderBufferViewAccessors[g];for(const at of tt)at.bufferView=et;const rt=e.jsonDoc.json.bufferViews[et],st=rt.byteOffset||0;Object.assign(rt,b),rt.byteOffset=i,rt.extensions[pv].byteOffset=st,i+=yo.padNumber(b.byteLength)}const s=this._encoderFallbackBuffer,o=e.bufferIndexMap.get(s),c=e.jsonDoc.json.buffers[o];return c.byteLength=i,c.extensions={[pv]:{fallback:!0}},s.dispose(),this}}EO.EXTENSION_NAME=pv,EO.EncoderMethod=gI;const vI="EXT_texture_avif";class L5{match(e){return e.length>=12&&yo.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const i=new DataView(e.buffer,e.byteOffset,e.byteLength);let s=q3(i,0);if(!s)return null;let o=s.end;for(;s=q3(i,o);)if(s.type==="meta")o=s.start+4;else if(s.type==="iprp"||s.type==="ipco")o=s.start;else{if(s.type==="ispe")return[i.getUint32(s.start+4),i.getUint32(s.start+8)];if(s.type==="mdat")break;o=s.end}return null}getChannels(e){return 4}}class W3 extends au{constructor(...e){super(...e),this.extensionName=vI,this.prereadTypes=[Zr.TEXTURE]}static register(){pA.registerFormat("image/avif",new L5)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(i=>{i.extensions&&i.extensions[vI]&&(i.source=i.extensions[vI].source)}),this}read(e){return this}write(e){const i=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/avif"){const o=e.imageIndexMap.get(s);(i.json.textures||[]).forEach(c=>{c.source===o&&(c.extensions=c.extensions||{},c.extensions[vI]={source:c.source},delete c.source)})}}),this}}function q3(h,e){if(h.byteLength<4+e)return null;const i=h.getUint32(e);return h.byteLength<i+e||i<8?null:{type:yo.decodeText(new Uint8Array(h.buffer,h.byteOffset+e+4,4)),start:e+8,end:e+i}}W3.EXTENSION_NAME=vI;const _I="EXT_texture_webp";class N5{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const i=yo.decodeText(e.slice(0,4)),s=yo.decodeText(e.slice(8,12));if(i!=="RIFF"||s!=="WEBP")return null;const o=new DataView(e.buffer,e.byteOffset);let c=12;for(;c<o.byteLength;){const g=yo.decodeText(new Uint8Array([o.getUint8(c),o.getUint8(c+1),o.getUint8(c+2),o.getUint8(c+3)])),b=o.getUint32(c+4,!0);if(g==="VP8 ")return[16383&o.getInt16(c+14,!0),16383&o.getInt16(c+16,!0)];if(g==="VP8L"){const et=o.getUint8(c+9),tt=o.getUint8(c+10),rt=o.getUint8(c+11);return[1+((63&tt)<<8|et),1+((15&o.getUint8(c+12))<<10|rt<<2|(192&tt)>>6)]}c+=8+b+b%2}return null}getChannels(e){return 4}}class X3 extends au{constructor(...e){super(...e),this.extensionName=_I,this.prereadTypes=[Zr.TEXTURE]}static register(){pA.registerFormat("image/webp",new N5)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(i=>{i.extensions&&i.extensions[_I]&&(i.source=i.extensions[_I].source)}),this}read(e){return this}write(e){const i=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/webp"){const o=e.imageIndexMap.get(s);(i.json.textures||[]).forEach(c=>{c.source===o&&(c.extensions=c.extensions||{},c.extensions[_I]={source:c.source},delete c.source)})}}),this}}X3.EXTENSION_NAME=_I;const Y3="KHR_draco_mesh_compression";let Dp,K3,J3,Yv;function U5(h,e){const i=new Dp.DecoderBuffer;try{if(i.Init(e,e.length),h.GetEncodedGeometryType(i)!==Dp.TRIANGULAR_MESH)throw new Error(`[${Y3}] Unknown geometry type.`);const s=new Dp.Mesh;if(!h.DecodeBufferToMesh(i,s).ok()||s.ptr===0)throw new Error(`[${Y3}] Decoding failure.`);return s}finally{Dp.destroy(i)}}function F5(h,e){const i=3*e.num_faces();let s,o;if(e.num_points()<=65534){const c=i*Uint16Array.BYTES_PER_ELEMENT;s=Dp._malloc(c),h.GetTrianglesUInt16Array(e,c,s),o=new Uint16Array(Dp.HEAPU16.buffer,s,i).slice()}else{const c=i*Uint32Array.BYTES_PER_ELEMENT;s=Dp._malloc(c),h.GetTrianglesUInt32Array(e,c,s),o=new Uint32Array(Dp.HEAPU32.buffer,s,i).slice()}return Dp._free(s),o}function j5(h,e,i,s){const o=J3[s.componentType],c=K3[s.componentType],g=i.num_components(),b=e.num_points()*g,et=b*c.BYTES_PER_ELEMENT,tt=Dp._malloc(et);h.GetAttributeDataArrayForAllPoints(e,i,o,et,tt);const rt=new c(Dp.HEAPF32.buffer,tt,b).slice();return Dp._free(tt),rt}var yI,l0;(function(h){h[h.EDGEBREAKER=1]="EDGEBREAKER",h[h.SEQUENTIAL=0]="SEQUENTIAL"})(yI||(yI={})),function(h){h.POSITION="POSITION",h.NORMAL="NORMAL",h.COLOR="COLOR",h.TEX_COORD="TEX_COORD",h.GENERIC="GENERIC"}(l0||(l0={}));const $3={[l0.POSITION]:14,[l0.NORMAL]:10,[l0.COLOR]:8,[l0.TEX_COORD]:12,[l0.GENERIC]:12},Z3={decodeSpeed:5,encodeSpeed:5,method:yI.EDGEBREAKER,quantizationBits:$3,quantizationVolume:"mesh"};function z5(h,e=Z3){const i=g1({},Z3,e);i.quantizationBits=g1({},$3,e.quantizationBits);const s=new Yv.Encoder,o=new Yv.MeshBuilder,c=new Yv.Mesh,g={},b=new Yv.DracoInt8Array,et=h.listTargets().length>0;let tt=!1;for(const At of h.listSemantics()){const xt=h.getAttribute(At);if(xt.getSparse()){tt=!0;continue}const yt=V5(At),_t=G5(o,xt.getComponentType(),c,Yv[yt],xt.getCount(),xt.getElementSize(),xt.getArray());if(_t===-1)throw new Error(`Error compressing "${At}" attribute.`);if(g[At]=_t,i.quantizationVolume==="mesh"||At!=="POSITION")s.SetAttributeQuantization(Yv[yt],i.quantizationBits[yt]);else{if(typeof i.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:Mt}=i,It=Math.max(Mt.max[0]-Mt.min[0],Mt.max[1]-Mt.min[1],Mt.max[2]-Mt.min[2]);s.SetAttributeExplicitQuantization(Yv[yt],i.quantizationBits[yt],xt.getElementSize(),Mt.min,It)}}}const rt=h.getIndices();if(!rt)throw new sR("Primitive must have indices.");o.AddFacesToMesh(c,rt.getCount()/3,rt.getArray()),s.SetSpeedOptions(i.encodeSpeed,i.decodeSpeed),s.SetTrackEncodedProperties(!0),s.SetEncodingMethod(i.method===yI.SEQUENTIAL||et||tt?Yv.MESH_SEQUENTIAL_ENCODING:Yv.MESH_EDGEBREAKER_ENCODING);const st=s.EncodeMeshToDracoBuffer(c,b);if(st<=0)throw new sR("Error applying Draco compression.");const at=new Uint8Array(st);for(let At=0;At<st;++At)at[At]=b.GetValue(At);const ct=h.getAttribute("POSITION").getCount(),pt=s.GetNumberOfEncodedPoints(),gt=3*s.GetNumberOfEncodedFaces();if((et||tt)&&pt!==ct)throw new sR('Compression reduced vertex count unexpectedly, corrupting mesh data. Applying the "weld" function before compression may resolve the issue. See: https://github.com/google/draco/issues/929');return Yv.destroy(b),Yv.destroy(c),Yv.destroy(o),Yv.destroy(s),{numVertices:pt,numIndices:gt,data:at,attributeIDs:g}}function V5(h){return h==="POSITION"?l0.POSITION:h==="NORMAL"?l0.NORMAL:h.startsWith("COLOR_")?l0.COLOR:h.startsWith("TEXCOORD_")?l0.TEX_COORD:l0.GENERIC}function G5(h,e,i,s,o,c,g){switch(e){case gs.ComponentType.UNSIGNED_BYTE:return h.AddUInt8Attribute(i,s,o,c,g);case gs.ComponentType.BYTE:return h.AddInt8Attribute(i,s,o,c,g);case gs.ComponentType.UNSIGNED_SHORT:return h.AddUInt16Attribute(i,s,o,c,g);case gs.ComponentType.SHORT:return h.AddInt16Attribute(i,s,o,c,g);case gs.ComponentType.UNSIGNED_INT:return h.AddUInt32Attribute(i,s,o,c,g);case gs.ComponentType.FLOAT:return h.AddFloatAttribute(i,s,o,c,g);default:throw new Error(`Unexpected component type, "${e}".`)}}class sR extends Error{}const Zu="KHR_draco_mesh_compression";class AI extends au{constructor(...e){super(...e),this.extensionName=Zu,this.prereadTypes=[Zr.PRIMITIVE],this.prewriteTypes=[Zr.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,i){return e==="draco3d.decoder"&&(this._decoderModule=i,Dp=this._decoderModule,K3={[gs.ComponentType.FLOAT]:Float32Array,[gs.ComponentType.UNSIGNED_INT]:Uint32Array,[gs.ComponentType.UNSIGNED_SHORT]:Uint16Array,[gs.ComponentType.UNSIGNED_BYTE]:Uint8Array,[gs.ComponentType.SHORT]:Int16Array,[gs.ComponentType.BYTE]:Int8Array},J3={[gs.ComponentType.FLOAT]:Dp.DT_FLOAT32,[gs.ComponentType.UNSIGNED_INT]:Dp.DT_UINT32,[gs.ComponentType.UNSIGNED_SHORT]:Dp.DT_UINT16,[gs.ComponentType.UNSIGNED_BYTE]:Dp.DT_UINT8,[gs.ComponentType.SHORT]:Dp.DT_INT16,[gs.ComponentType.BYTE]:Dp.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=i,Yv=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Zu}] Please install extension dependency, "draco3d.decoder".`);const i=this.document.getLogger(),s=e.jsonDoc,o=new Map;try{const c=s.json.meshes||[];for(const g of c)for(const b of g.primitives){if(!b.extensions||!b.extensions[Zu])continue;const et=b.extensions[Zu];let[tt,rt]=o.get(et.bufferView)||[];if(!rt||!tt){const st=s.json.bufferViews[et.bufferView],at=s.json.buffers[st.buffer],ct=yo.toView(at.uri?s.resources[at.uri]:s.resources[w3],st.byteOffset||0,st.byteLength);tt=new this._decoderModule.Decoder,rt=U5(tt,ct),o.set(et.bufferView,[tt,rt]),i.debug(`[${Zu}] Decompressed ${ct.byteLength} bytes.`)}for(const st in b.attributes){const at=e.jsonDoc.json.accessors[b.attributes[st]],ct=tt.GetAttributeByUniqueId(rt,et.attributes[st]),pt=j5(tt,rt,ct,at);e.accessors[b.attributes[st]].setArray(pt)}b.indices!==void 0&&e.accessors[b.indices].setArray(F5(tt,rt))}}finally{for(const[c,g]of Array.from(o.values()))this._decoderModule.destroy(c),this._decoderModule.destroy(g)}return this}read(e){return this}prewrite(e,i){if(!this._encoderModule)throw new Error(`[${Zu}] Please install extension dependency, "draco3d.encoder".`);const s=this.document.getLogger();s.debug(`[${Zu}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const o=function(b){const et=b.getLogger(),tt=new Set,rt=new Set;for(const At of b.getRoot().listMeshes())for(const xt of At.listPrimitives())xt.getIndices()?xt.getMode()!==YE.Mode.TRIANGLES?(rt.add(xt),et.warn(`[${Zu}] Skipping Draco compression on non-TRIANGLES primitive.`)):tt.add(xt):(rt.add(xt),et.warn(`[${Zu}] Skipping Draco compression on non-indexed primitive.`));const st=b.getRoot().listAccessors(),at=new Map;for(let At=0;At<st.length;At++)at.set(st[At],At);const ct=new Map,pt=new Set,gt=new Map;for(const At of Array.from(tt)){let xt=eN(At,at);if(pt.has(xt))gt.set(At,xt);else{if(ct.has(At.getIndices())){const yt=At.getIndices(),_t=yt.clone();at.set(_t,b.getRoot().listAccessors().length-1),At.swap(yt,_t)}for(const yt of At.listAttributes())if(ct.has(yt)){const _t=yt.clone();at.set(_t,b.getRoot().listAccessors().length-1),At.swap(yt,_t)}xt=eN(At,at),pt.add(xt),gt.set(At,xt),ct.set(At.getIndices(),xt);for(const yt of At.listAttributes())ct.set(yt,xt)}}for(const At of Array.from(ct.keys())){const xt=new Set(At.listParents().map(yt=>yt.propertyType));if(xt.size!==2||!xt.has(Zr.PRIMITIVE)||!xt.has(Zr.ROOT))throw new Error(`[${Zu}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const At of Array.from(tt)){const xt=gt.get(At),yt=At.getIndices();if(ct.get(yt)!==xt||At.listAttributes().some(_t=>ct.get(_t)!==xt))throw new Error(`[${Zu}] Draco primitives must share all, or no, accessors.`)}for(const At of Array.from(rt)){const xt=At.getIndices();if(ct.has(xt)||At.listAttributes().some(yt=>ct.has(yt)))throw new Error(`[${Zu}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return gt}(this.document),c=new Map;let g="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?s.warn(`[${Zu}]: quantizationVolume=scene requires exactly 1 scene.`):g=function(b){const et={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},tt=b.propertyType===Zr.NODE?[b]:b.listChildren();for(const rt of tt)rt.traverse(st=>{const at=st.getMesh();if(!at)return;const ct=p5(at,st.getWorldMatrix());yO(ct.min,et),yO(ct.max,et)});return et}(this.document.getRoot().listScenes().pop()));for(const b of Array.from(o.keys())){const et=o.get(b);if(!et)throw new Error("Unexpected primitive.");if(c.has(et)){c.set(et,c.get(et));continue}const tt=b.getIndices(),rt=e.jsonDoc.json.accessors;let st;try{st=z5(b,g1({},this._encoderOptions,{quantizationVolume:g}))}catch(pt){if(pt instanceof sR){s.warn(`[${Zu}]: ${pt.message} Skipping primitive compression.`);continue}throw pt}c.set(et,st);const at=e.createAccessorDef(tt);at.count=st.numIndices,e.accessorIndexMap.set(tt,rt.length),rt.push(at);for(const pt of b.listSemantics()){const gt=b.getAttribute(pt);if(st.attributeIDs[pt]===void 0)continue;const At=e.createAccessorDef(gt);At.count=st.numVertices,e.accessorIndexMap.set(gt,rt.length),rt.push(At)}const ct=b.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(ct)||e.otherBufferViews.set(ct,[]),e.otherBufferViews.get(ct).push(st.data)}return s.debug(`[${Zu}] Compressed ${o.size} primitives.`),e.extensionData[Zu]={primitiveHashMap:o,primitiveEncodingMap:c},this}write(e){const i=e.extensionData[Zu];for(const s of this.document.getRoot().listMeshes()){const o=e.jsonDoc.json.meshes[e.meshIndexMap.get(s)];for(let c=0;c<s.listPrimitives().length;c++){const g=s.listPrimitives()[c],b=o.primitives[c],et=i.primitiveHashMap.get(g);if(!et)continue;const tt=i.primitiveEncodingMap.get(et);tt&&(b.extensions=b.extensions||{},b.extensions[Zu]={bufferView:e.otherBufferViewsIndexMap.get(tt.data),attributes:tt.attributeIDs})}}if(!i.primitiveHashMap.size){const s=e.jsonDoc.json;s.extensionsUsed=(s.extensionsUsed||[]).filter(o=>o!==Zu),s.extensionsRequired=(s.extensionsRequired||[]).filter(o=>o!==Zu)}return this}}function eN(h,e){const i=[],s=h.getIndices();i.push(e.get(s));for(const o of h.listAttributes())i.push(e.get(o));return i.sort().join("|")}AI.EXTENSION_NAME=Zu,AI.EncoderMethod=yI;class sM extends ju{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[Zr.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:sM.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return qv.factorToHex(this.getColor())}setColorHex(e){const i=this.getColor().slice();return qv.hexToFactor(e,i),this.setColor(i)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}sM.EXTENSION_NAME="KHR_lights_punctual",sM.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const mA="KHR_lights_punctual";class tN extends au{constructor(...e){super(...e),this.extensionName=mA}createLight(e=""){return new sM(this.document.getGraph(),e)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions[mA])return this;const s=(i.json.extensions[mA].lights||[]).map(o=>{var c,g;const b=this.createLight().setName(o.name||"").setType(o.type);return o.color!==void 0&&b.setColor(o.color),o.intensity!==void 0&&b.setIntensity(o.intensity),o.range!==void 0&&b.setRange(o.range),((c=o.spot)==null?void 0:c.innerConeAngle)!==void 0&&b.setInnerConeAngle(o.spot.innerConeAngle),((g=o.spot)==null?void 0:g.outerConeAngle)!==void 0&&b.setOuterConeAngle(o.spot.outerConeAngle),b});return i.json.nodes.forEach((o,c)=>{o.extensions&&o.extensions[mA]&&e.nodes[c].setExtension(mA,s[o.extensions[mA].light])}),this}write(e){const i=e.jsonDoc;if(this.properties.size===0)return this;const s=[],o=new Map;for(const c of this.properties){const g=c,b={type:g.getType()};Jl.eq(g.getColor(),[1,1,1])||(b.color=g.getColor()),g.getIntensity()!==1&&(b.intensity=g.getIntensity()),g.getRange()!=null&&(b.range=g.getRange()),g.getName()&&(b.name=g.getName()),g.getType()===sM.Type.SPOT&&(b.spot={innerConeAngle:g.getInnerConeAngle(),outerConeAngle:g.getOuterConeAngle()}),s.push(b),o.set(g,s.length-1)}return this.document.getRoot().listNodes().forEach(c=>{const g=c.getExtension(mA);if(g){const b=e.nodeIndexMap.get(c),et=i.json.nodes[b];et.extensions=et.extensions||{},et.extensions[mA]={light:o.get(g)}}}),i.json.extensions=i.json.extensions||{},i.json.extensions[mA]={lights:s},this}}tN.EXTENSION_NAME=mA;const{R:H5,G:Q5}=Tu;class nN extends ju{init(){this.extensionName="KHR_materials_anisotropy",this.propertyType="Anisotropy",this.parentTypes=[Zr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new $l(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:H5|Q5})}}nN.EXTENSION_NAME="KHR_materials_anisotropy";const JE="KHR_materials_anisotropy";class iN extends au{constructor(...e){super(...e),this.extensionName=JE}createAnisotropy(){return new nN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[JE]){const g=this.createAnisotropy();e.materials[c].setExtension(JE,g);const b=o.extensions[JE];if(b.anisotropyStrength!==void 0&&g.setAnisotropyStrength(b.anisotropyStrength),b.anisotropyRotation!==void 0&&g.setAnisotropyRotation(b.anisotropyRotation),b.anisotropyTexture!==void 0){const et=b.anisotropyTexture;g.setAnisotropyTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getAnisotropyTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(JE);if(o){const c=e.materialIndexMap.get(s),g=i.json.materials[c];g.extensions=g.extensions||{};const b=g.extensions[JE]={};if(o.getAnisotropyStrength()>0&&(b.anisotropyStrength=o.getAnisotropyStrength()),o.getAnisotropyRotation()!==0&&(b.anisotropyRotation=o.getAnisotropyRotation()),o.getAnisotropyTexture()){const et=o.getAnisotropyTexture(),tt=o.getAnisotropyTextureInfo();b.anisotropyTexture=e.createTextureInfoDef(et,tt)}}}),this}}iN.EXTENSION_NAME=JE;const{R:rN,G:sN,B:W5}=Tu;class oN extends ju{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[Zr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new $l(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new $l(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new $l(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:rN})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:sN})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:rN|sN|W5})}}oN.EXTENSION_NAME="KHR_materials_clearcoat";const $E="KHR_materials_clearcoat";class aN extends au{constructor(...e){super(...e),this.extensionName=$E}createClearcoat(){return new oN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[$E]){const g=this.createClearcoat();e.materials[c].setExtension($E,g);const b=o.extensions[$E];if(b.clearcoatFactor!==void 0&&g.setClearcoatFactor(b.clearcoatFactor),b.clearcoatRoughnessFactor!==void 0&&g.setClearcoatRoughnessFactor(b.clearcoatRoughnessFactor),b.clearcoatTexture!==void 0){const et=b.clearcoatTexture;g.setClearcoatTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getClearcoatTextureInfo(),et)}if(b.clearcoatRoughnessTexture!==void 0){const et=b.clearcoatRoughnessTexture;g.setClearcoatRoughnessTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getClearcoatRoughnessTextureInfo(),et)}if(b.clearcoatNormalTexture!==void 0){const et=b.clearcoatNormalTexture;g.setClearcoatNormalTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getClearcoatNormalTextureInfo(),et),et.scale!==void 0&&g.setClearcoatNormalScale(et.scale)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension($E);if(o){const c=e.materialIndexMap.get(s),g=i.json.materials[c];g.extensions=g.extensions||{};const b=g.extensions[$E]={clearcoatFactor:o.getClearcoatFactor(),clearcoatRoughnessFactor:o.getClearcoatRoughnessFactor()};if(o.getClearcoatTexture()){const et=o.getClearcoatTexture(),tt=o.getClearcoatTextureInfo();b.clearcoatTexture=e.createTextureInfoDef(et,tt)}if(o.getClearcoatRoughnessTexture()){const et=o.getClearcoatRoughnessTexture(),tt=o.getClearcoatRoughnessTextureInfo();b.clearcoatRoughnessTexture=e.createTextureInfoDef(et,tt)}if(o.getClearcoatNormalTexture()){const et=o.getClearcoatNormalTexture(),tt=o.getClearcoatNormalTextureInfo();b.clearcoatNormalTexture=e.createTextureInfoDef(et,tt),o.getClearcoatNormalScale()!==1&&(b.clearcoatNormalTexture.scale=o.getClearcoatNormalScale())}}}),this}}aN.EXTENSION_NAME=$E;class lN extends ju{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[Zr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}lN.EXTENSION_NAME="KHR_materials_emissive_strength";const ZE="KHR_materials_emissive_strength";class cN extends au{constructor(...e){super(...e),this.extensionName=ZE}createEmissiveStrength(){return new lN(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[ZE]){const o=this.createEmissiveStrength();e.materials[s].setExtension(ZE,o);const c=i.extensions[ZE];c.emissiveStrength!==void 0&&o.setEmissiveStrength(c.emissiveStrength)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(ZE);if(o){const c=e.materialIndexMap.get(s),g=i.json.materials[c];g.extensions=g.extensions||{},g.extensions[ZE]={emissiveStrength:o.getEmissiveStrength()}}}),this}}cN.EXTENSION_NAME=ZE;class uN extends ju{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[Zr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}uN.EXTENSION_NAME="KHR_materials_ior";const eS="KHR_materials_ior";class hN extends au{constructor(...e){super(...e),this.extensionName=eS}createIOR(){return new uN(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[eS]){const o=this.createIOR();e.materials[s].setExtension(eS,o);const c=i.extensions[eS];c.ior!==void 0&&o.setIOR(c.ior)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(eS);if(o){const c=e.materialIndexMap.get(s),g=i.json.materials[c];g.extensions=g.extensions||{},g.extensions[eS]={ior:o.getIOR()}}}),this}}hN.EXTENSION_NAME=eS;const{R:q5,G:X5}=Tu;class dN extends ju{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[Zr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new $l(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new $l(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:q5})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:X5})}}dN.EXTENSION_NAME="KHR_materials_iridescence";const tS="KHR_materials_iridescence";class pN extends au{constructor(...e){super(...e),this.extensionName=tS}createIridescence(){return new dN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[tS]){const g=this.createIridescence();e.materials[c].setExtension(tS,g);const b=o.extensions[tS];if(b.iridescenceFactor!==void 0&&g.setIridescenceFactor(b.iridescenceFactor),b.iridescenceIor!==void 0&&g.setIridescenceIOR(b.iridescenceIor),b.iridescenceThicknessMinimum!==void 0&&g.setIridescenceThicknessMinimum(b.iridescenceThicknessMinimum),b.iridescenceThicknessMaximum!==void 0&&g.setIridescenceThicknessMaximum(b.iridescenceThicknessMaximum),b.iridescenceTexture!==void 0){const et=b.iridescenceTexture;g.setIridescenceTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getIridescenceTextureInfo(),et)}if(b.iridescenceThicknessTexture!==void 0){const et=b.iridescenceThicknessTexture;g.setIridescenceThicknessTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getIridescenceThicknessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(tS);if(o){const c=e.materialIndexMap.get(s),g=i.json.materials[c];g.extensions=g.extensions||{};const b=g.extensions[tS]={};if(o.getIridescenceFactor()>0&&(b.iridescenceFactor=o.getIridescenceFactor()),o.getIridescenceIOR()!==1.3&&(b.iridescenceIor=o.getIridescenceIOR()),o.getIridescenceThicknessMinimum()!==100&&(b.iridescenceThicknessMinimum=o.getIridescenceThicknessMinimum()),o.getIridescenceThicknessMaximum()!==400&&(b.iridescenceThicknessMaximum=o.getIridescenceThicknessMaximum()),o.getIridescenceTexture()){const et=o.getIridescenceTexture(),tt=o.getIridescenceTextureInfo();b.iridescenceTexture=e.createTextureInfoDef(et,tt)}if(o.getIridescenceThicknessTexture()){const et=o.getIridescenceThicknessTexture(),tt=o.getIridescenceThicknessTextureInfo();b.iridescenceThicknessTexture=e.createTextureInfoDef(et,tt)}}}),this}}pN.EXTENSION_NAME=tS;const{R:fN,G:mN,B:gN,A:vN}=Tu;class _N extends ju{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[Zr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new $l(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new $l(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return qv.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const i=this.getDiffuseFactor().slice();return this.setDiffuseFactor(qv.hexToFactor(e,i))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:fN|mN|gN|vN})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:fN|mN|gN|vN})}}_N.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const nS="KHR_materials_pbrSpecularGlossiness";class yN extends au{constructor(...e){super(...e),this.extensionName=nS}createPBRSpecularGlossiness(){return new _N(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[nS]){const g=this.createPBRSpecularGlossiness();e.materials[c].setExtension(nS,g);const b=o.extensions[nS];if(b.diffuseFactor!==void 0&&g.setDiffuseFactor(b.diffuseFactor),b.specularFactor!==void 0&&g.setSpecularFactor(b.specularFactor),b.glossinessFactor!==void 0&&g.setGlossinessFactor(b.glossinessFactor),b.diffuseTexture!==void 0){const et=b.diffuseTexture;g.setDiffuseTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getDiffuseTextureInfo(),et)}if(b.specularGlossinessTexture!==void 0){const et=b.specularGlossinessTexture;g.setSpecularGlossinessTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getSpecularGlossinessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(nS);if(o){const c=e.materialIndexMap.get(s),g=i.json.materials[c];g.extensions=g.extensions||{};const b=g.extensions[nS]={diffuseFactor:o.getDiffuseFactor(),specularFactor:o.getSpecularFactor(),glossinessFactor:o.getGlossinessFactor()};if(o.getDiffuseTexture()){const et=o.getDiffuseTexture(),tt=o.getDiffuseTextureInfo();b.diffuseTexture=e.createTextureInfoDef(et,tt)}if(o.getSpecularGlossinessTexture()){const et=o.getSpecularGlossinessTexture(),tt=o.getSpecularGlossinessTextureInfo();b.specularGlossinessTexture=e.createTextureInfoDef(et,tt)}}}),this}}yN.EXTENSION_NAME=nS;const{R:Y5,G:K5,B:J5,A:$5}=Tu;class AN extends ju{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[Zr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new $l(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new $l(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return qv.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const i=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",qv.hexToFactor(e,i))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Y5|K5|J5})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:$5})}}AN.EXTENSION_NAME="KHR_materials_sheen";const iS="KHR_materials_sheen";class bN extends au{constructor(...e){super(...e),this.extensionName=iS}createSheen(){return new AN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[iS]){const g=this.createSheen();e.materials[c].setExtension(iS,g);const b=o.extensions[iS];if(b.sheenColorFactor!==void 0&&g.setSheenColorFactor(b.sheenColorFactor),b.sheenRoughnessFactor!==void 0&&g.setSheenRoughnessFactor(b.sheenRoughnessFactor),b.sheenColorTexture!==void 0){const et=b.sheenColorTexture;g.setSheenColorTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getSheenColorTextureInfo(),et)}if(b.sheenRoughnessTexture!==void 0){const et=b.sheenRoughnessTexture;g.setSheenRoughnessTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getSheenRoughnessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(iS);if(o){const c=e.materialIndexMap.get(s),g=i.json.materials[c];g.extensions=g.extensions||{};const b=g.extensions[iS]={sheenColorFactor:o.getSheenColorFactor(),sheenRoughnessFactor:o.getSheenRoughnessFactor()};if(o.getSheenColorTexture()){const et=o.getSheenColorTexture(),tt=o.getSheenColorTextureInfo();b.sheenColorTexture=e.createTextureInfoDef(et,tt)}if(o.getSheenRoughnessTexture()){const et=o.getSheenRoughnessTexture(),tt=o.getSheenRoughnessTextureInfo();b.sheenRoughnessTexture=e.createTextureInfoDef(et,tt)}}}),this}}bN.EXTENSION_NAME=iS;const{R:Z5,G:ez,B:tz,A:nz}=Tu;class wN extends ju{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[Zr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new $l(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new $l(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return qv.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const i=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",qv.hexToFactor(e,i))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:nz})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Z5|ez|tz})}}wN.EXTENSION_NAME="KHR_materials_specular";const rS="KHR_materials_specular";class xN extends au{constructor(...e){super(...e),this.extensionName=rS}createSpecular(){return new wN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[rS]){const g=this.createSpecular();e.materials[c].setExtension(rS,g);const b=o.extensions[rS];if(b.specularFactor!==void 0&&g.setSpecularFactor(b.specularFactor),b.specularColorFactor!==void 0&&g.setSpecularColorFactor(b.specularColorFactor),b.specularTexture!==void 0){const et=b.specularTexture;g.setSpecularTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getSpecularTextureInfo(),et)}if(b.specularColorTexture!==void 0){const et=b.specularColorTexture;g.setSpecularColorTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getSpecularColorTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(rS);if(o){const c=e.materialIndexMap.get(s),g=i.json.materials[c];g.extensions=g.extensions||{};const b=g.extensions[rS]={};if(o.getSpecularFactor()!==1&&(b.specularFactor=o.getSpecularFactor()),Jl.eq(o.getSpecularColorFactor(),[1,1,1])||(b.specularColorFactor=o.getSpecularColorFactor()),o.getSpecularTexture()){const et=o.getSpecularTexture(),tt=o.getSpecularTextureInfo();b.specularTexture=e.createTextureInfoDef(et,tt)}if(o.getSpecularColorTexture()){const et=o.getSpecularColorTexture(),tt=o.getSpecularColorTextureInfo();b.specularColorTexture=e.createTextureInfoDef(et,tt)}}}),this}}xN.EXTENSION_NAME=rS;const{R:iz}=Tu;class EN extends ju{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[Zr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new $l(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:iz})}}EN.EXTENSION_NAME="KHR_materials_transmission";const sS="KHR_materials_transmission";class SN extends au{constructor(...e){super(...e),this.extensionName=sS}createTransmission(){return new EN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[sS]){const g=this.createTransmission();e.materials[c].setExtension(sS,g);const b=o.extensions[sS];if(b.transmissionFactor!==void 0&&g.setTransmissionFactor(b.transmissionFactor),b.transmissionTexture!==void 0){const et=b.transmissionTexture;g.setTransmissionTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getTransmissionTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(sS);if(o){const c=e.materialIndexMap.get(s),g=i.json.materials[c];g.extensions=g.extensions||{};const b=g.extensions[sS]={transmissionFactor:o.getTransmissionFactor()};if(o.getTransmissionTexture()){const et=o.getTransmissionTexture(),tt=o.getTransmissionTextureInfo();b.transmissionTexture=e.createTextureInfoDef(et,tt)}}}),this}}SN.EXTENSION_NAME=sS;class CN extends ju{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[Zr.MATERIAL]}}CN.EXTENSION_NAME="KHR_materials_unlit";const oM="KHR_materials_unlit";class MN extends au{constructor(...e){super(...e),this.extensionName=oM}createUnlit(){return new CN(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{i.extensions&&i.extensions[oM]&&e.materials[s].setExtension(oM,this.createUnlit())}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{if(s.getExtension(oM)){const o=e.materialIndexMap.get(s),c=i.json.materials[o];c.extensions=c.extensions||{},c.extensions[oM]={}}}),this}}MN.EXTENSION_NAME=oM;class TN extends ju{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}TN.EXTENSION_NAME="KHR_materials_variants";class IN extends ju{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[Zr.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}IN.EXTENSION_NAME="KHR_materials_variants";class SO extends ju{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}SO.EXTENSION_NAME="KHR_materials_variants";const gA="KHR_materials_variants";class PN extends au{constructor(...e){super(...e),this.extensionName=gA}createMappingList(){return new IN(this.document.getGraph())}createVariant(e=""){return new SO(this.document.getGraph(),e)}createMapping(){return new TN(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof SO)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions[gA])return this;const s=(i.json.extensions[gA].variants||[]).map(o=>this.createVariant().setName(o.name||""));return(i.json.meshes||[]).forEach((o,c)=>{const g=e.meshes[c];(o.primitives||[]).forEach((b,et)=>{if(!b.extensions||!b.extensions[gA])return;const tt=this.createMappingList(),rt=b.extensions[gA];for(const st of rt.mappings){const at=this.createMapping();st.material!==void 0&&at.setMaterial(e.materials[st.material]);for(const ct of st.variants||[])at.addVariant(s[ct]);tt.addMapping(at)}g.listPrimitives()[et].setExtension(gA,tt)})}),this}write(e){const i=e.jsonDoc,s=this.listVariants();if(!s.length)return this;const o=[],c=new Map;for(const g of s)c.set(g,o.length),o.push(e.createPropertyDef(g));for(const g of this.document.getRoot().listMeshes()){const b=e.meshIndexMap.get(g);g.listPrimitives().forEach((et,tt)=>{const rt=et.getExtension(gA);if(!rt)return;const st=e.jsonDoc.json.meshes[b].primitives[tt],at=rt.listMappings().map(ct=>{const pt=e.createPropertyDef(ct),gt=ct.getMaterial();return gt&&(pt.material=e.materialIndexMap.get(gt)),pt.variants=ct.listVariants().map(At=>c.get(At)),pt});st.extensions=st.extensions||{},st.extensions[gA]={mappings:at}})}return i.json.extensions=i.json.extensions||{},i.json.extensions[gA]={variants:o},this}}PN.EXTENSION_NAME=gA;const{G:rz}=Tu;class RN extends ju{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[Zr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new $l(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:rz})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return qv.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const i=this.getAttenuationColor().slice();return this.set("attenuationColor",qv.hexToFactor(e,i))}}RN.EXTENSION_NAME="KHR_materials_volume";const oS="KHR_materials_volume";class DN extends au{constructor(...e){super(...e),this.extensionName=oS}createVolume(){return new RN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[oS]){const g=this.createVolume();e.materials[c].setExtension(oS,g);const b=o.extensions[oS];if(b.thicknessFactor!==void 0&&g.setThicknessFactor(b.thicknessFactor),b.attenuationDistance!==void 0&&g.setAttenuationDistance(b.attenuationDistance),b.attenuationColor!==void 0&&g.setAttenuationColor(b.attenuationColor),b.thicknessTexture!==void 0){const et=b.thicknessTexture;g.setThicknessTexture(e.textures[s[et.index].source]),e.setTextureInfo(g.getThicknessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(oS);if(o){const c=e.materialIndexMap.get(s),g=i.json.materials[c];g.extensions=g.extensions||{};const b=g.extensions[oS]={};if(o.getThicknessFactor()>0&&(b.thicknessFactor=o.getThicknessFactor()),Number.isFinite(o.getAttenuationDistance())&&(b.attenuationDistance=o.getAttenuationDistance()),Jl.eq(o.getAttenuationColor(),[1,1,1])||(b.attenuationColor=o.getAttenuationColor()),o.getThicknessTexture()){const et=o.getThicknessTexture(),tt=o.getThicknessTextureInfo();b.thicknessTexture=e.createTextureInfoDef(et,tt)}}}),this}}DN.EXTENSION_NAME=oS;const kN="KHR_mesh_quantization";class BN extends au{constructor(...e){super(...e),this.extensionName=kN}read(e){return this}write(e){return this}}BN.EXTENSION_NAME=kN;const bI="KHR_texture_basisu";class sz{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const i=wO(e);return[i.pixelWidth,i.pixelHeight]}getChannels(e){const i=wO(e).dataFormatDescriptor[0];if(i.colorModel===163)return i.samples.length===2&&(15&i.samples[1].channelType)==15?4:3;if(i.colorModel===166)return(15&i.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${i.colorModel}".`)}getVRAMByteLength(e){const i=wO(e),s=this.getChannels(e)>3;let o=0;for(let c=0;c<i.levels.length;c++){const g=i.levels[c];o+=g.uncompressedByteLength?g.uncompressedByteLength:Math.max(1,Math.floor(i.pixelWidth/Math.pow(2,c)))/4*(Math.max(1,Math.floor(i.pixelHeight/Math.pow(2,c)))/4)*(s?16:8)}return o}}class ON extends au{constructor(...e){super(...e),this.extensionName=bI,this.prereadTypes=[Zr.TEXTURE]}static register(){pA.registerFormat("image/ktx2",new sz)}preread(e){return e.jsonDoc.json.textures.forEach(i=>{i.extensions&&i.extensions[bI]&&(i.source=i.extensions[bI].source)}),this}read(e){return this}write(e){const i=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/ktx2"){const o=e.imageIndexMap.get(s);i.json.textures.forEach(c=>{c.source===o&&(c.extensions=c.extensions||{},c.extensions[bI]={source:c.source},delete c.source)})}}),this}}ON.EXTENSION_NAME=bI;class LN extends ju{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[Zr.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}LN.EXTENSION_NAME="KHR_texture_transform";const aS="KHR_texture_transform";class NN extends au{constructor(...e){super(...e),this.extensionName=aS}createTransform(){return new LN(this.document.getGraph())}read(e){for(const[i,s]of Array.from(e.textureInfos.entries())){if(!s.extensions||!s.extensions[aS])continue;const o=this.createTransform(),c=s.extensions[aS];c.offset!==void 0&&o.setOffset(c.offset),c.rotation!==void 0&&o.setRotation(c.rotation),c.scale!==void 0&&o.setScale(c.scale),c.texCoord!==void 0&&o.setTexCoord(c.texCoord),i.setExtension(aS,o)}return this}write(e){const i=Array.from(e.textureInfoDefMap.entries());for(const[s,o]of i){const c=s.getExtension(aS);if(!c)continue;o.extensions=o.extensions||{};const g={},b=Jl.eq;b(c.getOffset(),[0,0])||(g.offset=c.getOffset()),c.getRotation()!==0&&(g.rotation=c.getRotation()),b(c.getScale(),[1,1])||(g.scale=c.getScale()),c.getTexCoord()!=null&&(g.texCoord=c.getTexCoord()),o.extensions[aS]=g}return this}}NN.EXTENSION_NAME=aS;const oz=[Zr.ROOT,Zr.SCENE,Zr.NODE,Zr.MESH,Zr.MATERIAL,Zr.TEXTURE,Zr.ANIMATION];class UN extends ju{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=oz}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",g1({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const i=this.get("properties");return e in i?i[e]:null}setProperty(e,i){this._assertContext(e);const s=g1({},this.get("properties"));return i?s[e]=i:delete s[e],this.set("properties",s)}toJSONLD(){return g1({"@context":CO(this.get("context"))},CO(this.get("properties")))}fromJSONLD(e){const i=(e=CO(e))["@context"];return i&&this.set("context",i),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function CO(h){return JSON.parse(JSON.stringify(h))}UN.EXTENSION_NAME="KHR_xmp_json_ld";const Dw="KHR_xmp_json_ld";class FN extends au{constructor(...e){super(...e),this.extensionName=Dw}createPacket(){return new UN(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var i;const s=(i=e.jsonDoc.json.extensions)==null?void 0:i[Dw];if(!s||!s.packets)return this;const o=e.jsonDoc.json,c=this.document.getRoot(),g=s.packets.map(tt=>this.createPacket().fromJSONLD(tt)),b=[[o.asset],o.scenes,o.nodes,o.meshes,o.materials,o.images,o.animations],et=[[c],c.listScenes(),c.listNodes(),c.listMeshes(),c.listMaterials(),c.listTextures(),c.listAnimations()];for(let tt=0;tt<b.length;tt++){const rt=b[tt]||[];for(let st=0;st<rt.length;st++){const at=rt[st];at.extensions&&at.extensions[Dw]&&et[tt][st].setExtension(Dw,g[at.extensions[Dw].packet])}}return this}write(e){const{json:i}=e.jsonDoc,s=[];for(const o of this.properties){s.push(o.toJSONLD());for(const c of o.listParents()){let g;switch(c.propertyType){case Zr.ROOT:g=i.asset;break;case Zr.SCENE:g=i.scenes[e.sceneIndexMap.get(c)];break;case Zr.NODE:g=i.nodes[e.nodeIndexMap.get(c)];break;case Zr.MESH:g=i.meshes[e.meshIndexMap.get(c)];break;case Zr.MATERIAL:g=i.materials[e.materialIndexMap.get(c)];break;case Zr.TEXTURE:g=i.images[e.imageIndexMap.get(c)];break;case Zr.ANIMATION:g=i.animations[e.animationIndexMap.get(c)];break;default:g=null,this.document.getLogger().warn(`[${Dw}]: Unsupported parent property, "${c.propertyType}"`)}g&&(g.extensions=g.extensions||{},g.extensions[Dw]={packet:s.length-1})}}return s.length>0&&(i.extensions=i.extensions||{},i.extensions[Dw]={packets:s}),this}}FN.EXTENSION_NAME=Dw;const az=[z3,EO,W3,X3,AI,tN,iN,aN,cN,hN,pN,yN,xN,bN,SN,MN,PN,DN,BN,ON,NN,FN];class jN extends uO{constructor(e){super(),this._loadedLibs=!1,e=e||{method:AI.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new T5().registerExtensions(az).registerExtensions([zN,hR,aR,lR,cR,dR,pR,fR,mR,gR,vR,_R,yR,bR,AR,wR,uR]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:i=!1,dracoOptions:s,...o}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,o);await this._loadLibs();const c={...o};i&&(c.externalImagesInExtras=!0);const g=await new Promise((at,ct)=>this.parse(e,at,ct,c)),b=await super.parseAsync(g,c);if(!i)return b;if(!g)throw new Error("GLTFDracoExporter: gltf is null");let et=g;const tt=et.byteLength||1/0,rt=await(typeof et!="object"||et.byteLength?this._io.readBinary(new Uint8Array(et)):this._io.readJSON({json:et,resources:{}}));if(rt.createExtension(AI).setRequired(!0).setEncoderOptions({...this._encoderOptions,...s??{}}),c.exportExt==="glb")et=await this._io.writeBinary(rt),isFinite(tt)&&console.log("DRACO Compression ratio: "+(et.byteLength/tt).toFixed(5));else{const at=await this._io.writeJSON(rt);et=at.json,Object.values(at.resources).filter(ct=>ct).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),et.resources=at.resources)}et.__isGLTFOutput=!0;const st=await super.parseAsync(et,c);if(!st)throw new Error("GLTFDracoExporter: blob is null");return st.ext="glb",st.__uncompressed=b,st}}class MO extends hs{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Lr,m1]}async onAdded(e){await super.onAdded(e);const i=e.getManager().importer,s=e.getManager().exporter;if(!i)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(o,c,g){hO(o,c,jN,b=>{const et=np()+".drc",tt=b;tt.loader=g.registerFile(et),tt.loader.setDecoderConfig({type:"js"}),tt.loader.preload(!0,!0)})})(s,e,i)}}MO.PluginType="GLTFDracoExportPlugin";class lz extends ju{constructor(){super(...arguments),this.extensionName=iu,this.parentTypes=[Zr.SCENE],this.propertyType="ViewerJSON"}init(){}}class zN extends au{constructor(){super(...arguments),this.extensionName=iu,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var i;return this._viewerConfig={},(i=e.jsonDoc.json.scenes)==null||i.forEach((s,o)=>{if(s.extensions&&s.extensions[iu]){const c=new lz(this.document.getGraph());e.scenes[o].setExtension(iu,c),this._viewerConfig=s.extensions[iu]}}),this}write(e){return this.document.getRoot().listScenes().forEach(i=>{var s;if(i.getExtension(iu)){const o=(s=e.jsonDoc.json.scenes)==null?void 0:s[e.jsonDoc.json.scene||0];o&&Object.keys(this._viewerConfig).length>0&&(o.extensions=o.extensions||{},o.extensions[iu]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}zN.EXTENSION_NAME=iu;class oR extends ju{addTexture(e,i,s,o=4369){this.setRef(e,s,{channels:o}),this.textures[e]=[i,s]}constructor(e,i,s){super(e,i),this.parentTypes=[Zr.MATERIAL,Zr.MESH,Zr.NODE,Zr.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=s}init(){}}class Gm extends au{constructor(){super(...arguments),this.textureChannels={}}read(e){const i=e.jsonDoc,s=i.json.materials||[],o=i.json.textures||[];return s.forEach((c,g)=>{var b;if(c.extensions&&c.extensions[this.extensionName]){const et=new oR(this.document.getGraph(),"",this.extensionName);e.materials[g].setExtension(this.extensionName,et);const tt={...c.extensions[this.extensionName]};for(const[rt,st]of Object.entries(tt))if(typeof(st==null?void 0:st.index)=="number"){const at=st,ct=(b=o[at.index])==null?void 0:b.source;if(typeof ct!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",at);continue}const pt=e.textures[ct],gt=new $l(this.document.getGraph()),At=this.textureChannels[rt]??4369;et.addTexture(rt,gt,pt,At),e.setTextureInfo(gt,at),delete tt[rt]}et.setExtras(tt)}}),(i.json.meshes||[]).forEach((c,g)=>{if(c.extensions&&c.extensions[this.extensionName]){const b=new oR(this.document.getGraph(),"",this.extensionName);e.meshes[g].setExtension(this.extensionName,b);const et=c.extensions[this.extensionName];b.setExtras(et)}}),(i.json.nodes||[]).forEach((c,g)=>{if(c.extensions&&c.extensions[this.extensionName]){const b=new oR(this.document.getGraph(),"",this.extensionName);e.nodes[g].setExtension(this.extensionName,b);const et=c.extensions[this.extensionName];b.setExtras(et)}}),(i.json.scenes||[]).forEach((c,g)=>{if(c.extensions&&c.extensions[this.extensionName]){const b=new oR(this.document.getGraph(),"",this.extensionName);e.scenes[g].setExtension(this.extensionName,b);const et=c.extensions[this.extensionName];b.setExtras(et)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(this.extensionName);if(o){const c=e.materialIndexMap.get(s),g=i.json.materials[c];g.extensions=g.extensions||{};const b={...o.getExtras()};for(const[et,tt]of Object.entries(o.textures)){const rt=tt[0],st=tt[1];st&&(b[et]=e.createTextureInfoDef(st,rt))}g.extensions[this.extensionName]=b}}),this.document.getRoot().listMeshes().forEach(s=>{const o=s.getExtension(this.extensionName);if(o){const c=e.meshIndexMap.get(s),g=i.json.meshes[c];g.extensions=g.extensions||{},g.extensions[this.extensionName]=o.getExtras()}}),this.document.getRoot().listNodes().forEach(s=>{const o=s.getExtension(this.extensionName);if(o){const c=e.nodeIndexMap.get(s),g=i.json.nodes[c];g.extensions=g.extensions||{},g.extensions[this.extensionName]=o.getExtras()}}),this.document.getRoot().listScenes().forEach(s=>{const o=s.getExtension(this.extensionName);if(o){const c=e.jsonDoc.json.scene||0,g=i.json.scenes[c];if(!g)return;g.extensions=g.extensions||{},g.extensions[this.extensionName]=o.getExtras()}}),this}}class aR extends Gm{constructor(){super(...arguments),this.extensionName=aR.EXTENSION_NAME,this.textureChannels={bumpTexture:Tu.R}}}aR.EXTENSION_NAME=E0;class lR extends Gm{constructor(){super(...arguments),this.extensionName=lR.EXTENSION_NAME,this.textureChannels={lightMapTexture:Tu.R|Tu.G|Tu.B}}}lR.EXTENSION_NAME=_x;class cR extends Gm{constructor(){super(...arguments),this.extensionName=cR.EXTENSION_NAME,this.textureChannels={alphaTexture:Tu.G}}}cR.EXTENSION_NAME=j_;class uR extends Gm{constructor(){super(...arguments),this.extensionName=uR.EXTENSION_NAME,this.textureChannels={displacementTexture:Tu.R}}}uR.EXTENSION_NAME=Ev;class hR extends Gm{constructor(){super(...arguments),this.extensionName=hR.EXTENSION_NAME}}hR.EXTENSION_NAME=Uo.DIAMOND_GLTF_EXTENSION;class dR extends Gm{constructor(){super(...arguments),this.extensionName=dR.EXTENSION_NAME}}dR.EXTENSION_NAME=$o.AnimationMarkersExtension;class pR extends Gm{constructor(){super(...arguments),this.extensionName=pR.EXTENSION_NAME,this.textureChannels={anisotropyDirection:Tu.R|Tu.G|Tu.B}}}pR.EXTENSION_NAME=am.ANISOTROPY_GLTF_EXTENSION;class fR extends Gm{constructor(){super(...arguments),this.extensionName=fR.EXTENSION_NAME,this.textureChannels={customBumpMap:Tu.R|Tu.G|Tu.B}}}fR.EXTENSION_NAME=Nu.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class mR extends Gm{constructor(){super(...arguments),this.extensionName=mR.EXTENSION_NAME}}mR.EXTENSION_NAME=Rm;class gR extends Gm{constructor(){super(...arguments),this.extensionName=gR.EXTENSION_NAME}}gR.EXTENSION_NAME=qu;class vR extends Gm{constructor(){super(...arguments),this.extensionName=vR.EXTENSION_NAME}}vR.EXTENSION_NAME=Ru;class _R extends Gm{constructor(){super(...arguments),this.extensionName=_R.EXTENSION_NAME}}_R.EXTENSION_NAME=zv.CLEARCOAT_TINT_GLTF_EXTENSION;class yR extends Gm{constructor(){super(...arguments),this.extensionName=yR.EXTENSION_NAME}}yR.EXTENSION_NAME=sv.THIN_FILM_LAYER_GLTF_EXTENSION;class AR extends Gm{constructor(){super(...arguments),this.extensionName=AR.EXTENSION_NAME}}AR.EXTENSION_NAME=w_.TRIPLANAR_GLTF_EXTENSION;class bR extends Gm{constructor(){super(...arguments),this.extensionName=bR.EXTENSION_NAME}}bR.EXTENSION_NAME=b_.SSBEVEL_GLTF_EXTENSION;class wR extends Gm{constructor(){super(...arguments),this.extensionName=wR.EXTENSION_NAME}}wR.EXTENSION_NAME=zm.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class VN extends _e.SimpleEventDispatcher{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,i)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}VN.PluginType="PMREMGenerator";const GN=new _.Pa4,cz=new _._fP,HN=new _.Pa4;class uz extends _.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(i){i.element instanceof Element&&i.element.parentNode!==null&&i.element.parentNode.removeChild(i.element)})})}copy(e,i){return super.copy(e,i),this.element=e.element.cloneNode(!0),this}}const vA=new _.yGw,hz=new _.yGw;class dz{constructor(e={}){const i=this;let s,o,c,g;const b={camera:{fov:0,style:""},objects:new WeakMap},et=e.element!==void 0?e.element:document.createElement("div");et.style.overflow="hidden",this.domElement=et;const tt=document.createElement("div");tt.style.transformOrigin="0 0",tt.style.pointerEvents="none",et.appendChild(tt);const rt=document.createElement("div");function st(gt){return Math.abs(gt)<1e-10?0:gt}function at(gt){const At=gt.elements;return"matrix3d("+st(At[0])+","+st(-At[1])+","+st(At[2])+","+st(At[3])+","+st(At[4])+","+st(-At[5])+","+st(At[6])+","+st(At[7])+","+st(At[8])+","+st(-At[9])+","+st(At[10])+","+st(At[11])+","+st(At[12])+","+st(-At[13])+","+st(At[14])+","+st(At[15])+")"}function ct(gt){const At=gt.elements;return"translate(-50%,-50%)matrix3d("+st(At[0])+","+st(At[1])+","+st(At[2])+","+st(At[3])+","+st(-At[4])+","+st(-At[5])+","+st(-At[6])+","+st(-At[7])+","+st(At[8])+","+st(At[9])+","+st(At[10])+","+st(At[11])+","+st(At[12])+","+st(At[13])+","+st(At[14])+","+st(At[15])+")"}function pt(gt,At,xt,yt){if(gt.isCSS3DObject){const _t=gt.visible===!0&&gt.layers.test(xt.layers)===!0;if(gt.element.style.display=_t===!0?"":"none",_t===!0){let Mt;gt.onBeforeRender(i,At,xt),gt.isCSS3DSprite?(vA.copy(xt.matrixWorldInverse),vA.transpose(),gt.rotation2D!==0&&vA.multiply(hz.makeRotationZ(gt.rotation2D)),gt.matrixWorld.decompose(GN,cz,HN),vA.setPosition(GN),vA.scale(HN),vA.elements[3]=0,vA.elements[7]=0,vA.elements[11]=0,vA.elements[15]=1,Mt=ct(vA)):Mt=ct(gt.matrixWorld);const It=gt.element,Bt=b.objects.get(gt);if(Bt===void 0||Bt.style!==Mt){It.style.transform=Mt;const Lt={style:Mt};b.objects.set(gt,Lt)}It.parentNode!==rt&&rt.appendChild(It),gt.onAfterRender(i,At,xt)}}for(let _t=0,Mt=gt.children.length;_t<Mt;_t++)pt(gt.children[_t],At,xt)}rt.style.transformStyle="preserve-3d",tt.appendChild(rt),this.getSize=function(){return{width:s,height:o}},this.render=function(gt,At){const xt=At.projectionMatrix.elements[5]*g;let yt,_t;b.camera.fov!==xt&&(tt.style.perspective=At.isPerspectiveCamera?xt+"px":"",b.camera.fov=xt),At.view&&At.view.enabled?(tt.style.transform=`translate( ${-At.view.offsetX*(s/At.view.width)}px, ${-At.view.offsetY*(o/At.view.height)}px )`,tt.style.transform+=`scale( ${At.view.fullWidth/At.view.width}, ${At.view.fullHeight/At.view.height} )`):tt.style.transform="",gt.matrixWorldAutoUpdate===!0&&gt.updateMatrixWorld(),At.parent===null&&At.matrixWorldAutoUpdate===!0&&At.updateMatrixWorld(),At.isOrthographicCamera&&(yt=-(At.right+At.left)/2,_t=(At.top+At.bottom)/2);const Mt=At.view&&At.view.enabled?At.view.height/At.view.fullHeight:1,It=At.isOrthographicCamera?`scale( ${Mt} )scale(`+xt+")translate("+st(yt)+"px,"+st(_t)+"px)"+at(At.matrixWorldInverse):`scale( ${Mt} )translateZ(`+xt+"px)"+at(At.matrixWorldInverse),Bt=It+"translate("+c+"px,"+g+"px)";b.camera.style!==Bt&&(rt.style.transform=Bt,b.camera.style=Bt),pt(gt,gt,At)},this.setSize=function(gt,At){s=gt,o=At,c=s/2,g=o/2,et.style.width=gt+"px",et.style.height=At+"px",tt.style.width=gt+"px",tt.style.height=At+"px",rt.style.width=gt+"px",rt.style.height=At+"px"}}}var xR,ER=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let _A=xR=class extends hs{constructor(h=!0){super(),this._scene=new _.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var o,c,g,b,et;const e=(c=(o=this._viewer)==null?void 0:o.getPlugin(vo))==null?void 0:c.getSelectedObject();if(!(e!=null&&e.geometry))return void await((g=this._viewer)==null?void 0:g.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const i=await((b=this._viewer)==null?void 0:b.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!i)return;const s=await((et=this._viewer)==null?void 0:et.prompt("Width: Enter the width for the object.","512",!1))||"512";s&&this.attachIFrame(e,i,parseInt(s))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)==null||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=h,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const h=this._viewer;h&&this._renderer&&(h.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",h.canvas):this._renderer.domElement.appendChild(h.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new dz;const h=this._viewer.renderer.rendererObject.getSize(new _.FM8);this._renderer.setSize(h.width,h.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const i=this._viewer.renderer.rendererObject.getSize(new _.FM8);this._renderer.setSize(i.width,i.height)})}async onAdded(h){await super.onAdded(h);let e=!0,i=!0;h.addEventListener("postFrame",c=>{var g,b;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(i&&this._trackers.forEach(et=>{var st,at;let tt=!0;const rt=et.modelObj.material.side;if(rt!==_.ehD){const ct=new _.Pa4(0,0,1).applyQuaternion(et.cssObj.quaternion),pt=(at=(st=this._viewer)==null?void 0:st.scene.activeCamera)==null?void 0:at.cameraObject,gt=ct.dot(pt.getWorldDirection(new _.Pa4));tt=rt===_._Li?gt>0:gt<0}et.cssObj.element.style.visibility=tt?"visible":"hidden"}),this._trackers.filter(et=>et.dirty).forEach(et=>this._syncProperties(et)),(b=this._renderer)==null||b.render(this._scene,(g=h.scene.activeCamera)==null?void 0:g.cameraObject),e=!1))}),h.addEventListener("update",c=>{this.enabled&&(e=this._trackers.length>0)}),h.scene.addEventListener("sceneUpdate",c=>{this.enabled&&(this._trackers.forEach(g=>g.dirty=!0),e=this._trackers.length>0)}),h.scene.addEventListener("activeCameraUpdate",c=>{this.enabled&&(e=this._trackers.length>0,i=!0)});let s=!1;const o=new _.iMs;h.container.addEventListener("mousemove",c=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const g=this._viewer.canvas.getBoundingClientRect(),b=(c.clientX-g.x)/g.width*2-1,et=-(c.clientY-g.y)/g.height*2+1;o.setFromCamera({x:b,y:et},this._viewer.scene.activeCamera.cameraObject);const tt=this._trackers.map(st=>st.modelObj),rt=o.intersectObjects(tt,!1);if(console.log(rt),rt.length)return this._viewer.canvas.style.pointerEvents="none",s=!0,void console.log(this._viewer.canvas.style.pointerEvents);s&&(this._viewer.canvas.style.pointerEvents="auto",s=!1)})}attachIFrame(h,e,i){const s=CR(h.modelObject),o=QN(e,i,i*s.y/s.x,()=>{var c;return(c=h.setDirty)==null?void 0:c.call(h)});return this.attachCSS3DObject(o,h),o}attachCSS3DObject(h,e){var s,o,c,g,b;if(this._trackers.push({cssObj:h,modelObj:e.modelObject,dirty:!0}),h.element&&(this._resizeObserver.observe(h.element),h.element.__isCSS3DObjectElement=!0,console.log(h.element,h.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const i=(s=this._viewer)==null?void 0:s.createMaterial("basic",{opacity:0,color:new _.Ilk("black"),blending:_.jFi,side:_.Wl3});if(!i)throw"cannot create mat";i.userData.forcedLinearDepth=0,(o=e.setMaterial)==null||o.call(e,i),SR(e.modelObject),TO(e.modelObject),CR(e.modelObject),this._scene.add(h),(g=(c=this.uiConfig)==null?void 0:c.uiRefresh)==null||g.call(c),(b=e.setDirty)==null||b.call(e)}_syncProperties(h){const e=h.modelObj,i=h.cssObj;e.updateMatrixWorld();const s=h.cssObj.element.clientWidth<1.5?0:(h.cssObj.element.clientWidth-1.5)/CR(e).x,o=SR(e);i.quaternion.setFromUnitVectors(new _.Pa4(0,0,1),o),i.position.copy(TO(e)),i.scale.set(1,1,1).multiplyScalar(1/s),i.updateMatrixWorld(),i.applyMatrix4(e.matrixWorld),h.dirty=!1}async onDispose(h){return this._resizeObserver.disconnect(),super.onDispose(h)}};function QN(h,e,i,s){const o=document.createElement("div");o.style.width=e.toString()+"px",o.style.height=i.toString()+"px",o.style.backgroundColor="transparent";const c=document.createElement("iframe",{is:"x-frame-bypass"});c.style.width="100%",c.style.height="100%",c.style.border="0px";const g=()=>{var b;try{c.contentWindow.name}catch(et){(typeof et=="string"?et:((b=et==null?void 0:et.toString)==null?void 0:b.call(et))??"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(et)}s(),c.removeEventListener("load",g)};return c.addEventListener("load",g),c.src=h,o.appendChild(c),new uz(o)}function SR(h){if(h.geometry.userData.geometryNormal)return h.geometry.userData.geometryNormal;const e=h.geometry.attributes.normal,i=new _.Pa4,s=new _.Pa4;for(let o=0,c=e.count;o<c;o++)i.fromBufferAttribute(e,o),s.add(i);return s.normalize(),h.geometry.userData.geometryNormal=s,s}function TO(h){if(h.geometry.userData.geometryCenter)return h.geometry.userData.geometryCenter;const e=h.geometry;if(!e)return new _.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const i=e.boundingBox.getCenter(new _.Pa4);return h.geometry.userData.geometryCenter=i,i}function CR(h,e=new _.Pa4(0,0,1)){if(h.geometry.userData.geometrySize)return h.geometry.userData.geometrySize;const i=h.geometry;if(!i)return new _.Pa4(0,0,0);const s=i.clone();s.applyMatrix4(new _.yGw().makeRotationFromQuaternion(new _._fP().setFromUnitVectors(e,SR(h)).invert())),s.computeBoundingBox();const o=s.boundingBox.getSize(new _.Pa4);return h.geometry.userData.geometrySize=o,s.dispose(),o}_A.PluginType="CSS3DRenderer",ER([Nr("Enabled"),(0,_e.onChange)(xR.prototype._refreshEnabled),Mn()],_A.prototype,"enabled",void 0),ER([Nr("Over canvas"),(0,_e.onChange)(xR.prototype._refreshCanvasInDOM),Mn()],_A.prototype,"overCanvas",void 0),ER([go("Attach iframe")],_A.prototype,"attachIFrameToSelected",void 0),_A=xR=ER([Ms("CSS3D Renderer")],_A);class pz extends Km{constructor(e,i,s,o=new _.Ilk(1,1,1),c=1){super(void 0,void 0,s,o,c),this.target=i,this._getSelectedObject=e}render(e,i,s,o,c){const g=e.getRenderTarget(),b=e.getActiveCubeFace(),et=e.getActiveMipmapLevel(),tt=this._getSelectedObject();if(tt)this._renderSelectedObject(e,tt,i,o,c);else{e.setRenderTarget(this.target);const rt=new _.Ilk;e.getClearColor(rt),e.setClearColor(new _.Ilk(16777215)),e.clear(!0,!0),e.setClearColor(rt)}e.setRenderTarget(g,b,et)}_renderSelectedObject(e,i,s,o,c){if(!this.camera)return;i.traverse(et=>{et.layers.enable(6)});const g=this.camera.layers.mask;this.camera.layers.set(6);const b=e.userData;b||console.error("threejs is not patched?"),b.transmissionRenderTarget=s,no(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!0,transmissionRender:!0,mainRenderPass:!1},()=>super.render(e,s,this.target,o,c)),b.transmissionRenderTarget=void 0,i.traverse(et=>{et.layers.disable(6)}),this.camera.layers.mask=g}}var kw,v1=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let sy=kw=class{constructor(h,e){this.enabled=!0,this.enableHighlight=!1,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new _.Ilk(15305317),this.debugOutline=!1,this.transparency=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new _.FM8(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new _.Ilk(15305317)},enableHighlight:{value:!0},outlineBuffer:{value:null}},this.extraDefines={DEBUG_OUTLINE:"0"},this.parsFragmentSnippet=(i,s)=>this.enabled?_e.glsl`
            ${bp}
            ${`uniform sampler2D outlineBuffer;uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;float isSelected(vec2 uv){return 1.-texture2D(outlineBuffer,uv).b;}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;
#if DEBUG_OUTLINE > 0
color=vec4(0.,0.,0.,1.);
#endif
vec3 finalColor=color.rgb;float c=isSelected(vUv);if(c>0.){vec4 uvOffset=1.5*outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c1=isSelected(vUv+uvOffset.xy);float c2=isSelected(vUv-uvOffset.xy);float c3=isSelected(vUv+uvOffset.yw);float c4=isSelected(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 edgeColor=vec4(outlineColor,1.)*vec4(d);float gbufferDepth=getDepth(vUv);float outlineDepth=unpack16(texture2D(outlineBuffer,vUv).xy);outlineDepth*=outlineDepth;outlineDepth-=0.005;if(gbufferDepth<outlineDepth){highlightColor.rgb=highlightColor.rgb*0.3;edgeColor.rgb=edgeColor.rgb*0.5;}vec4 outColor=edgeColor+highlightColor*(1.-d);finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);}else{finalColor.rgb=color.rgb;}return vec4(finalColor.rgb,color.a);}`}
        `:"",this._combinedPostPlugin=h.getPlugin(f_),this._pickingPlugin=h.getPluginByType("Picking"),this._setDirty=this._setDirty.bind(this),e&&(this.extraUniforms.outlineBuffer.value=e.texture),this._enable()}shaderExtender(h,e,i){this.enabled&&(h.fragmentShader=rs(h.fragmentShader,"#glMarker",` 
            gl_FragColor = outline(gl_FragColor);
            #glMarker
        `))}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&this._combinedPostPlugin.reRender(),this.extraDefines&&(this.extraDefines.DEBUG_OUTLINE=this.debugOutline?"1":"0"),this.extraUniforms&&(this.extraUniforms.outlineIntensity.value=this.outlineIntensity,this.extraUniforms.outlineColor.value.copy(this.outlineColor),this.extraUniforms.outlineThickness.value=this._outlineThickness,this.extraUniforms.enableHighlight.value=this.enableHighlight,this.extraUniforms.highlightTransparency.value=this.transparency)}setDirty(){var h;(h=this.__setDirty)==null||h.call(this),this._setDirty()}_enable(){var h;(h=this._pickingPlugin)==null||h.enableWidget(!this.enabled),this._setDirty()}};sy.PluginType="Outline",v1([(0,_e.onChange)(kw.prototype._enable),Nr("Enable"),Mn()],sy.prototype,"enabled",void 0),v1([(0,_e.onChange)(kw.prototype._setDirty),Nr("Highlight"),Mn()],sy.prototype,"enableHighlight",void 0),v1([(0,_e.onChange)(kw.prototype._setDirty),Nr("DynamicSelection"),Mn()],sy.prototype,"enableDynamicSelection",void 0),v1([(0,_e.onChange)(kw.prototype._setDirty),es("Intensity",[0,2],.001,{limitedUi:!0}),Mn()],sy.prototype,"outlineIntensity",void 0),v1([(0,_e.onChange)(kw.prototype._setDirty),es("Transparency",[0,1],.01,{limitedUi:!0}),Mn()],sy.prototype,"highlightTransparency",void 0),v1([(0,_e.onChange)(kw.prototype._setDirty),s_("Color"),Mn()],sy.prototype,"outlineColor",void 0),v1([(0,_e.onChange)(kw.prototype._setDirty),Nr("Debug")],sy.prototype,"debugOutline",void 0),sy=kw=v1([Ms("Outline")],sy);class wI extends O0{constructor(){super(),this._state="in",this.mouseInOutAnimationEnabled=!0}generateExtension(e){return new sy(e,this._outlineTarget)}async onAdded(e){this._outlineTarget=e.renderer.createTarget({sizeMultiplier:1}),await super.onAdded(e);const i=e==null?void 0:e.getPluginByType("Picking"),s=new _.jyz({uniforms:{cameraNearFar:{value:new _.FM8(.1,100)}},vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vViewPosition;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:"uniform vec2 cameraNearFar;varying vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);vec2 packedZ=pack16(pow(linearZ,0.5));gl_FragColor=vec4(packedZ.x,packedZ.y,0.,0.);}",side:_.ehD}),o=Vo(e,{passId:"outline",after:["gbuffer"],before:["render"],passObject:new pz(()=>i==null?void 0:i.getSelectedObject(),this._outlineTarget,s),update(){e.scene.renderCamera.updateShaderProperties(this.passObject.overrideMaterial),o.passObject.scene=e.scene.modelObject,o.passObject.camera=e.scene.renderCamera.cameraObject}});e.renderer.registerPass(o),i==null||i.addEventListener("selectedObjectChanged",()=>{!this._animationCallBack&&this._extension&&(i!=null&&i.getSelectedObject()?this._extension.enableDynamicSelection?(this._extension.transparency=1,this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparency=this._extension.highlightTransparency:this._extension.transparency=1)}),document.addEventListener("mousemove",c=>{if(!this._extension||!this.mouseInOutAnimationEnabled)return;const g=i==null?void 0:i.getSelectedObject();g&&this._extension.enableDynamicSelection?c.target!==e.canvas?this._animationCallBack||this._state!=="in"||(this._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),this._state="out"):this._animationCallBack||this._state!=="out"||(this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),this._state="in"):this._extension.transparency=g?this._extension.highlightTransparency:1})}async _startTransparencyAnimation(e,i,s){return xE(this._extension,"transparency",{from:e,to:i,duration:s,onComplete:()=>{this._animationCallBack=null}})}}wI.PluginType="Outline";const MR=.2,fz=Math.PI/24,WN=new _.FM8,TR=(h,e,i)=>{let s=e>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let o=0;o<=12;++o)h.push(e+.17*Math.cos(s),i+.17*Math.sin(s),0,e+MR*Math.cos(s),i+MR*Math.sin(s),0),s+=fz};class qN extends _.Kj0{constructor(e,i,s=!1){super(((et,tt)=>{const rt=new _.u9r,st=[],at=[],ct=et.getSize(new _.Pa4),pt=ct.x/2,gt=(tt?ct.y:ct.z)/2;TR(at,pt,gt),TR(at,-pt,gt),TR(at,-pt,-gt),TR(at,pt,-gt);const At=at.length/3;for(let yt=0;yt<At-2;yt+=2)st.push(yt,yt+1,yt+3,yt,yt+3,yt+2);const xt=At-2;return st.push(xt,xt+1,1,xt,1,0),rt.setAttribute("position",new _.a$l(at,3)),rt.setIndex(st),rt})(e,s)),this.boundingSize=new _.Pa4,this._raycaster=new _.iMs,this._camera=i,this._placeOnWall=s;const o=this.material;o.side=_.Wl3,o.color=new zo(16711935),o.opacity=0,this.userData.bboxVisible=!1;const c=e.getSize(this.boundingSize),g=c.x/2,b=(s?c.y:c.z)/2;this.hitPlane=new _.Kj0(new _._12(2*(g+MR),2*(b+MR))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),s?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,i,s){WN.set(i,-s),this.hitPlane.visible=!0;const o=this._positionAndNormalFromPoint(WN,this.hitPlane);return this.hitPlane.visible=!1,o==null?null:o.position}getExpandedHit(e,i,s){this.hitPlane.scale.set(1e3,1e3,1e3);const o=this.getHit(e,i,s);return this.hitPlane.scale.set(1,1,1),o}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const i=this.material;this.visible=i.opacity>0}dispose(){var s;const{geometry:e,material:i}=this.hitPlane;e.dispose(),i.dispose(),this.geometry.dispose(),this.material.dispose(),(s=this.parent)==null||s.remove(this)}_positionAndNormalFromPoint(e,i){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const s=this._raycaster.intersectObject(i,!0);if(s.length===0)return null;const o=s[0];return o.face==null?null:o.uv==null?{position:o.point,normal:o.face.normal,uv:null}:(o.face.normal.applyNormalMatrix(new _.Vkp().getNormalMatrix(o.object.matrixWorld)),{position:o.point,normal:o.face.normal,uv:o.uv})}}const IO=new _.Pa4;class XN{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new _.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new _.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new _.Pa4,this._hitMatrix=new _.yGw,this.xDamper=new _e.Damper,this.yDamper=new _e.Damper,this.zDamper=new _e.Damper,this.yawDamper=new _e.Damper,this.scaleDamper=new _e.Damper,this.onSelectStart=e=>{const i=this.transientHitTestSource;if(i==null)return;const s=this.frame.getHitTestResultsForTransientInput(i),o=this.presentedScene,c=this.placementBox;if(s.length===1){this.inputSource=e.inputSource;const{axes:g}=this.inputSource.gamepad||{axes:[0,0]},b=c.getHit(o,g[0],g[1]);c.show=!0,b!=null?(this.isTranslating=!0,this.lastDragPosition.copy(b),this.presentedScene&&(this.presentedScene.visible=!0)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*g[0])}else if(s.length===2){c.show=!0,this.isTwoFingering=!0;const{separation:g}=this.fingerPolar(s);this.firstRatio=g/o.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,i,s){var o;this.transientHitTestSource=await((o=e.requestHitTestSourceForTransientInput)==null?void 0:o.call(e,{profile:"generic-touchscreen"})),this.presentedScene=i,this.placementBox=s,this.session=e,this.placementComplete=!1,this.goalPosition.copy(i.position),this.goalYaw=i.rotation.y,this.goalScale=i.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var o;const i=(o=this.xr)==null?void 0:o.getReferenceSpace(),s=i?e.getPose(i):null;return s?(this._hitMatrix.fromArray(s.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const i=this.presentedScene,s=i.position,o=i.rotation.y,c=this.placementBox,g=Math.max(c.boundingSize.x,c.boundingSize.y,c.boundingSize.z)/2,b=this.goalPosition,et=i.scale.x;if(!b.equals(s)||this.goalScale!==et){let{x:tt,y:rt,z:st}=s;tt=this.xDamper.update(tt,b.x,e,g),rt=this.yDamper.update(rt,b.y,e,g),st=this.zDamper.update(st,b.z,e,g),s.set(tt,rt,st);const at=this.scaleDamper.update(et,this.goalScale,e,1);if(i.scale.set(at,at,at),!this.isTranslating){const ct=b.y-rt;this.placementComplete&&!this.placeOnWall?c.offsetHeight=ct/at:ct===0&&(this.placementComplete=!0,c.show=!1)}}c.updateOpacity(e),i.rotation.y=this.yawDamper.update(o,this.goalYaw,e,Math.PI)}processInput(e){var g;this.frame=e;const i=this.transientHitTestSource;if(!i||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const s=e.getHitTestResultsForTransientInput(i),o=this.presentedScene,c=o.scale.x;if(this.isTwoFingering)if(s.length<2)this.isTwoFingering=!1;else{const{separation:b,deltaYaw:et}=this.fingerPolar(s);if(this.placeOnWall||(this.goalYaw+=et),!o.userData.__scaleDisabled){const tt=b/this.firstRatio;this.goalScale=tt<1.3&&tt>.7692307692307692?1:tt}}else if(s.length!==2)if(this.isRotating&&((g=this.inputSource)!=null&&g.gamepad)){const b=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=b-this.lastAngle,this.lastAngle=b}else this.isTranslating&&(console.log("translating"),s.forEach(b=>{if(b.inputSource!==this.inputSource)return;let et=null;if(b.results.length>0&&(et=this.getHitPoint(b.results[0])),et==null&&(et=this.getTouchLocation()),et!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const tt=et.y-this.lastDragPosition.y;if(tt<0){this.placementBox.offsetHeight=tt/c;const rt=IO.copy(this.xr.getCamera().position),st=-tt/(rt.y-et.y);rt.multiplyScalar(st),et.multiplyScalar(1-st).add(rt)}}this.goalPosition.add(et),this.lastDragPosition.copy(et)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:b}=this.fingerPolar(s);this.firstRatio=b/c}}getTouchLocation(){var s;const{axes:e}=this.inputSource.gamepad??{axes:[0,0]},i=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return i!=null&&(IO.copy(i).sub((s=this.xr)==null?void 0:s.getCamera().position),IO.length()>10)?null:i}fingerPolar(e){var et,tt,rt,st;const i=((tt=(et=e[0].inputSource)==null?void 0:et.gamepad)==null?void 0:tt.axes)??[0,0],s=((st=(rt=e[1].inputSource)==null?void 0:rt.gamepad)==null?void 0:st.axes)??[0,0],o=s[0]-i[0],c=s[1]-i[1],g=Math.atan2(c,o);let b=this.lastAngle-g;return b>Math.PI?b-=2*Math.PI:b<-Math.PI&&(b+=2*Math.PI),this.lastAngle=g,{separation:Math.sqrt(o*o+c*c),deltaYaw:b}}}class mz{constructor(e,i,s,o,c){this.xrLight=e,this.renderer=i,this.lightProbe=s,this.xrWebGLBinding=null,this.estimationStartCallback=c,this.frameCallback=this.onXRFrame.bind(this);const g=i.xr.getSession();if(o&&"XRWebGLBinding"in window){const b=new _.oAp(16);e.environment=b.texture;const et=i.getContext();switch(g.preferredReflectionFormat){case"srgba8":et.getExtension("EXT_sRGB");break;case"rgba16f":et.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(g,et),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}g.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const i=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);i&&(e.__webglTexture=i,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,i){if(!this.xrLight)return;i.session.requestAnimationFrame(this.frameCallback);const s=i.getLightEstimate(this.lightProbe);if(s){this.xrLight.lightProbe.sh.fromArray(s.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const o=Math.max(1,Math.max(s.primaryLightIntensity.x,Math.max(s.primaryLightIntensity.y,s.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(s.primaryLightIntensity.x/o,s.primaryLightIntensity.y/o,s.primaryLightIntensity.z/o),this.xrLight.directionalLight.intensity=o,this.xrLight.directionalLight.position.copy(s.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class gz extends _.ZAu{constructor(e,i=!0){super(),this.lightProbe=new _.lk7,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new _.Ox3,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let s=null,o=!1;e.xr.addEventListener("sessionstart",()=>{const c=e.xr.getSession();"requestLightProbe"in c&&c.requestLightProbe({reflectionFormat:c.preferredReflectionFormat}).then(g=>{s=new mz(this,e,g,i,()=>{o=!0,this.dispatchEvent({type:"estimationstart"})})})}),e.xr.addEventListener("sessionend",()=>{s&&(s.dispose(),s=null),o&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{s&&(s.dispose(),s=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}var aM=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let Bw=class extends hs{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new XN,this.dependencies=[bo],this.estimateLighting=!1,this.placeOnWall=!1,this.xrResolutionScale=1,this.toJSON=void 0,this.enterAR=()=>{var h;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already in AR"):((h=this._xrManager)==null||h.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.domOverlay}).then(this._onSessionStarted)):console.error("XR not supported"))},this.exitAR=()=>{this._xrSession&&this._xrSession.end()},this._preRender=()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const h=this._xrManager.getCamera(),e=h.cameras[0]||h,i=this._viewer.scene.activeCamera;i.cameraObject.projectionMatrix.copy(e.projectionMatrix),i.cameraObject.projectionMatrixInverse.copy(i.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var i,s;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const h=this._viewer.renderer,e=(s=(i=this._xrManager)==null?void 0:i.getCamera())==null?void 0:s.cameras[0].viewport;e?h.rendererObject.setViewport(e):console.warn("no viewport for ar camera"),this._viewer.getPlugin(bo).updateShaderProperties(lM.material),lM.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,no(h.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{lM.render(h.rendererObject,null,h.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0},this._frameCount=0,this._isPresenting=!1,this._preFrame=({xrFrame:h,deltaTime:e})=>{var c,g;if(this.dirty=!!h&&((c=this._xrManager)==null?void 0:c.isPresenting)||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!h)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: AR session init"),this._frameCount++;const i=this._xrManager.getReferenceSpace(),s=h.getViewerPose(i);if(s==null&&this._frameCount,s==null||((g=this._viewer)==null?void 0:g.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const o=this._viewer.scene.activeCamera;this._xrManager.updateCamera(o.cameraObject),o.setDirty(),this.moveToFloor(h),this._touchInputHelper.processInput(h),this._touchInputHelper.moveScene(e),this._updateShadow()},this._preXRState={viewerBg:null,modelScale:new _.Pa4(1,1,1),modelPosition:new _.Pa4,modelRotation:new _._fP,cameraPosition:new _.Pa4(0,0,5),cameraTarget:new _.Pa4,cameraUp:new _.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectioMatrix:new _.yGw,cameraAutoNearFar:void 0,groundOffset:new _.Pa4,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new _.FM8,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.getBackground(!0);const h=this._viewer.scene.modelRoot,e=this._viewer.scene.activeCamera;h.updateMatrix(),h.updateMatrixWorld(!0),this._preXRState.modelScale.copy(h.scale),this._preXRState.modelPosition.copy(h.position),this._preXRState.modelRotation.copy(h.quaternion),this._preXRState.cameraPosition.copy(e.position),this._preXRState.cameraTarget.copy(e.target),this._preXRState.cameraUp.copy(e.cameraObject.up),e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=e.cameraObject.fov,this._preXRState.cameraAspect=e.cameraObject.aspect),this._preXRState.cameraZoom=e.cameraObject.zoom,this._preXRState.cameraNear=e.cameraObject.near,this._preXRState.cameraFar=e.cameraObject.far,this._preXRState.cameraAutoNearFar=e.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectioMatrix.copy(e.cameraObject.projectionMatrix);const i=this._viewer.getPluginByType("Ground");i!=null&&i.mesh&&(this._preXRState.groundOffset.subVectors(h.position,i.mesh.modelObject.position),this._preXRState.groundScale=i.mesh.modelObject.scale.x,this._preXRState.groundRotation=i.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=i.renderToDepth,this._preXRState.groundShadowBaker=i.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const h=20*Math.PI/180,e=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(h),z:-Math.cos(h)});this._viewer.renderer.useTotalFrameCount=!0,this._viewer.resize(),(async()=>{var i,s;if(this._xrSession){this._touchInputHelper.placeOnWall=this.placeOnWall,await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._placementBox);const o=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((s=(i=this._xrSession).requestHitTestSource)==null?void 0:s.call(i,{space:o,offsetRay:e}))}})()},this._xrRenderingEnd=()=>{console.log("webxr: AR session end"),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._removePlacementBox(),this._cancelHitSources(),this._viewer&&(this._viewer.renderer.useTotalFrameCount=!1,this._restorePreXRState())},this._onSessionStarted=async h=>{h.addEventListener("end",this._onSessionEnded),this.estimateLighting&&(this._xrLight=new gz(this._viewer.renderer.rendererObject),this._xrLight.addEventListener("estimationstart",()=>{this._xrSession&&this._xrLight&&(this._viewer.scene.modelRoot.add(this._xrLight),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._viewer.scene.setEnvironment(this._xrLight.environment))})),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(h),this._xrSession=h},this._onSessionEnded=()=>{this._xrSession&&(this._xrSession.removeEventListener("end",this._onSessionEnded),this._xrLight&&(this._xrLight.removeFromParent(),this._xrLight.dispose(),this._xrLight=void 0))}}async onAdded(h){await super.onAdded(h);const e=h.renderer.rendererObject.xr;if(e.enabled=!0,e.cameraAutoUpdate=!1,this._xrManager=e,this._touchInputHelper.xr=e,!this.domOverlay){const i=document.getElementById("tweakpaneUiContainer");this.domOverlay=i?{root:i}:void 0}if(h.addEventListener("preRender",this._preRender),h.addEventListener("postRender",this._postRender),h.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return h.console.error("XR not supported in insecure context, try https://"),this.enabled=!1,void(e.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-ar").then(i=>{if(!i)throw new Error("AR not supported")}).catch(i=>{h.console.error("AR not supported:",i),e.enabled=!1,this.enabled=!1}):(e.enabled=!1,this.enabled=!1)}_updateShadow(){var i,s;if(!this._viewer)return;const h=this._viewer.scene.modelRoot,e=(s=(i=this._viewer.getPluginByType("Ground"))==null?void 0:i.mesh)==null?void 0:s.modelObject;e&&(e.rotation.z=this._viewer.scene.modelRoot.rotation.y,e.position.copy(this._preXRState.groundOffset).multiplyScalar(h.modelObject.scale.x).sub(h.modelObject.position).negate(),e.scale.setScalar(h.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(h){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const e=h.getHitTestResults(this._hitTestSource);if(!e.length)return;const i=e[0];this._touchInputHelper.placeOnWall=this.placeOnWall;const s=this._touchInputHelper.getHitPoint(i);if(!s)return;this._placementBox.show=!0;const o=this._viewer.scene.modelRoot;this._touchInputHelper.goalPosition.copy(s),o.position.copy(s),this._viewer.scene.modelRoot.visible=!0,this._hitTestSource.cancel(),this._hitTestSource=void 0}_removePlacementBox(){this._placementBox&&(this._placementBox.removeFromParent(),this._placementBox=void 0)}_preSetupModel(){var et,tt;const h=this._viewer.scene.modelRoot,e=this._viewer.scene.activeCamera,i=(et=this._xrManager)==null?void 0:et.getCamera(),s=i.cameras[0]||i;this._removePlacementBox();const o=this._viewer.scene.getBounds(!0,!0);o.getSize(new _.Pa4).length()>.01&&(this._placementBox=new qN(o,i,this.placeOnWall),h.add(this._placementBox),this._placementBox.show=!1);const c=i.getWorldDirection(new _.Pa4);h.rotation.y=Math.atan2(-c.x,-c.z)-0,e.cameraObject.zoom=s.zoom,e.cameraObject.near=s.near,e.cameraObject.far=s.far,e.cameraObject.userData.autoNearFar=!1,e.cameraObject.isPerspectiveCamera?(e.cameraObject.fov=s.fov,e.cameraObject.aspect=s.viewport.width/s.viewport.height):console.warn("Perspective camera required."),e.cameraObject.updateProjectionMatrix();const g=h.userData.arScale||1;h.scale.set(g,g,g),h.position.copy(i.position).add(c.multiplyScalar(5)),h.visible=!0;const b=(tt=this._viewer)==null?void 0:tt.getPluginByType("Ground");b!=null&&b.mesh&&(b.shadowBaker.enabled=!1,b.renderToDepth=!1)}_restorePreXRState(){if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const h=this._viewer.scene.modelRoot;h.scale.copy(this._preXRState.modelScale),h.position.copy(this._preXRState.modelPosition),h.quaternion.copy(this._preXRState.modelRotation),h.updateMatrix(),h.updateMatrixWorld(!0),h.visible=!0;const e=this._viewer.scene.activeCamera;e.position.copy(this._preXRState.cameraPosition),e.target.copy(this._preXRState.cameraTarget),e.cameraObject.up.copy(this._preXRState.cameraUp),e.cameraObject.near=this._preXRState.cameraNear,e.cameraObject.far=this._preXRState.cameraFar,e.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(e.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(e.cameraObject.aspect=this._preXRState.cameraAspect)),e.positionUpdated(!1),e.targetUpdated(!0),e.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectioMatrix),e.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectioMatrix).invert(),e.cameraObject.updateMatrixWorld(!0),e.cameraObject.updateProjectionMatrix();const i=this._viewer.getPluginByType("Ground");i!=null&&i.mesh&&(i.mesh.modelObject.position.subVectors(h.position,this._preXRState.groundOffset),i.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),i.mesh.modelObject.rotation.z=this._preXRState.groundRotation,i.renderToDepth=this._preXRState.groundRenderToDepth,i.shadowBaker.enabled=this._preXRState.groundShadowBaker,i.refreshTransform()),this._viewer.scene.setEnvironment(this._preXRState.environment),this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}};Bw.PluginType="WEBXR_ARPlugin",aM([Nr("Light Estimate")],Bw.prototype,"estimateLighting",void 0),aM([Nr("Place on Wall")],Bw.prototype,"placeOnWall",void 0),aM([es("Resilution scale",[.1,1],.1)],Bw.prototype,"xrResolutionScale",void 0),aM([go("Enter AR")],Bw.prototype,"enterAR",void 0),aM([go("Exit AR")],Bw.prototype,"exitAR",void 0),Bw=aM([Ms("WebXR AR")],Bw);const lM=new io({vertexShader:dt.vertexShader,fragmentShader:`
        ${bp}
        
        uniform float opacity;

		uniform sampler2D tDiffuse;
		uniform sampler2D tTransparentMap;

		varying vec2 vUv;

		void main() {
		
            float depth = getDepth(vUv);
            vec4 texel;
            if(depth>0.9999) {
			    texel = texture2D( tTransparentMap, vUv );
                if(texel.a < 0.01) discard; // background
                // transparent objects with render to depth = false
            }else {
                texel = texture2D( tDiffuse, vUv );
			}
            gl_FragColor = texel;
            
		}
		`,uniforms:{...dt.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});lM.renderToScreen=!1,lM.useExistingRenderTarget=!0,lM.clear=!1;class IR extends _e.SimpleEventDispatcher{get state(){return this._state}setState(e,i){this._state=e,this.dispatchEvent({type:e,...i})}_setOptions(e){Object.assign(this.options,e)}setOptions(e){this._setOptions(e)}constructor(e,i){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._frameCount=0,this._ondataavailable=s=>{s.data&&s.data.size>0&&this._currentRecording.push(s.data)},this._canvas=e,i==null||i.mimeType,this.options={mimeType:"auto",frameRate:30,stepMode:!1},this._setOptions(i||this.options)}isRecording(){return this._state==="recording"}requestFrame(){return this._state==="recording"&&(this._frameCount++,!0)}dispose(){(this.isRecording()||this._state==="paused")&&this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()})}}class YN extends IR{constructor(){super(...arguments),this._currentImages=[],this._onstop=e=>{this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]),this.setState("stopped")},this._onerror=e=>{this.setState("error",{error:e}),this._console.error(e)}}start(){if(this.state!=="recording"){if(this.state==="error"&&this._console.warn("Resetting from error state."),this.state==="paused")return this.setState("starting"),void this.setState("recording");this._currentRecording=[],this._currentImages=[],this._frameCount=0,this.setState("starting"),window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async e=>{const i=await(e==null?void 0:e.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=i,this._frameCount=0,this.setState("recording")}).catch(e=>{this._onerror({detail:e})})}else this._console.log("Already recording canvas")}requestFrame(){if(!super.requestFrame())return!1;const e=this.options.mimeType;return this._canvas.toBlob(i=>{this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),i])},e,90),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[]),!0}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}async _writeImages(e){if(!this._imgDirectory)return;const i=[];for(const s of e){const o=await this._imgDirectory.getFileHandle(s[0],{create:!0});i.push((0,_e.writeFile)(o,s[1]))}await Promise.all(i)}}class xI extends IR{_setOptions(e){var i;super._setOptions(e),this.options.mimeType&&this.options.mimeType!=="auto"||(this.options.mimeType=xI.GetSupportedMimeTypes([],["h264"],!0)??xI.GetSupportedMimeTypes(void 0,void 0,!0)),this.options.mimeType&&!((i=this.options.mimeType)!=null&&i.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this.options.mimeType="image/png"),this.options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,i){super(e,i),this._resumeSyncTime=0,this._onstop=s=>{var o;if(this._recorder&&this._currentRecording.length>0){const c=new Blob(this._currentRecording,{type:this.options.mimeType});(o=this._recordingCallback)==null||o.call(this,c)}this._recorder=void 0,this.setState("stopped")},this._onstart=s=>{var o;this._frameCount=0,this.options.stepMode&&((o=this._recorder)==null||o.pause()),this.setState("recording")},this._onresume=s=>{if(this.state!=="paused"&&this.state!=="starting"&&this.state!=="stopped"||this.setState("recording"),!this.options.stepMode)return;const o=()=>{var g;this.state==="recording"&&((g=this._recorder)==null||g.pause())},c=Math.min(this._resumeSyncTime-(0,_e.now)(),0)+1e3/this.options.frameRate;c>0?(0,_e.timeout)(c).then(o):o()},this._onerror=s=>{this.setState("error",{error:s}),this._console.error(s),this._recorder=void 0}}start(){var i,s,o;if(this.state==="recording")return void this._console.log("Already recording canvas");if(this.state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this.state==="paused"?(this.setState("starting"),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this.state);const e={mimeType:this.options.mimeType,videoBitsPerSecond:this.options.videoBitsPerSecond};if(this._currentRecording=[],this._frameCount=0,(i=e.mimeType)==null?void 0:i.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void this.setState("error",{error:new Error("MediaRecorder not supported")});{const c=this._canvas.captureStream(this.options.stepMode?0:this.options.frameRate),g=(s=c.getVideoTracks())==null?void 0:s[0];this._track=g,this._recorder=new window.MediaRecorder(c,e),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.setState("starting"),this._recorder&&((o=this._recorder)==null||o.start())}requestFrame(){return!(!this._recorder||!super.requestFrame()||this._track&&this.options.stepMode&&(this._resumeSyncTime=(0,_e.now)(),this._track.requestFrame(),this._recorder.resume(),0))}pause(){this.state!=="paused"&&this.state!=="stopped"&&(this.options.stepMode?console.error("Pause not supported in stepMode"):this._recorder&&(this._recorder.pause(),this.setState("paused")))}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._recorder&&this._recorder.stop()):this._console.error("Recorder in error state, cannot stop, call start again."))}dispose(){this._recorder&&(super.dispose(),this._recorder=void 0)}static GetSupportedMimeTypes(e,i,s=!1){if(!window.MediaRecorder)return s?void 0:[];const o=["webm","ogg","mp4","x-matroska"].filter(b=>!e||e.length<1||e.includes(b)),c=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(b=>!i||i.length<1||i.includes(b)),g=[];return o.forEach(b=>{const et=`video/${b}`;c.forEach(tt=>{[`${et};codecs=${tt}`,`${et};codecs:${tt}`,`${et};codecs=${tt.toUpperCase()}`,`${et};codecs:${tt.toUpperCase()}`,`${et}`].forEach(rt=>{MediaRecorder.isTypeSupported(rt)&&g.push(rt)})})}),s?g.length>0?g[0]:void 0:g}}class cM extends IR{constructor(e,i){super(e,i),this._workerRunning=!1,this.worker=new Worker((0,_e.remoteWorkerURL)(cM.LIBRARY_PATH+"ffmpeg-worker-mp4.js",cM.LIBRARY_PATH+"ffmpeg-worker-mp4.wasm")),this.worker.onmessage=s=>{var c;const o=s.data;switch(o.type){case"stdout":case"stderr":if(o.data.indexOf("frame=")===0){const g=parseInt(o.data.split("frame=")[1].split("fps")[0].trim()),b=this._frameCount,et=Math.round(g/b*100);this.dispatchEvent({type:"encode-progress",progress:et,frame:g,totalFrames:b})}console.log(o.data+`
`);break;case"exit":console.log("Process exited with code "+o.data),parseInt(o.data);break;case"done":if(o.data.MEMFS[0].data===void 0)return void console.log("video processing failed");this._workerRunning=!1,(c=this._recordingCallback)==null||c.call(this,new Blob([o.data.MEMFS[0].data],{type:"video/mp4"})),console.timeEnd("ffmpeg-record"),this.setState("stopped")}}}start(){this.state!=="recording"?(this.state==="error"&&console.warn("Resetting from error state."),this.state!=="paused"&&(this._frameCount=0),this.setState("starting"),this.setState("recording")):console.log("Already recording canvas")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onStop()):console.error("Recorder in error state, cannot stop, call start again."))}_onStop(){const e=this._canvas.width%2==0?this._canvas.width:this._canvas.width-1;this._workerRunning=!0,console.time("ffmpeg-record");const i=this.options.frameRate.toString(),s=this.options.frameRate.toString();this.worker.postMessage({type:"run",arguments:["-r",i,"-an","-i","img%03d.jpeg","-c:v","libx264","-crf","17","-filter:v",`scale=${e}:-2`,"-pix_fmt","yuv420p","-b:v","10M","-preset","ultrafast","-r",s,"out.mp4"]})}requestFrame(){return!!super.requestFrame()&&(this.sendBlobToWorker(this._frameCount-1),!0)}sendBlobToWorker(e){this._canvas.toBlob(i=>{this.worker.postMessage({type:"image",file:{name:`img${this.pad(e,3)}.jpeg`,data:i}})},"image/jpeg",90)}pad(e,i){return(e+="").length>=i?e:new Array(i-e.length+1).join("0")+e}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}}cM.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/@repalash/ffmpeg.js@4.2.9005/dist/";var PO=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class oy extends hs{get recorder(){return this._recorder}constructor(){super(),this.enabled=!0,this.convergeMode=!1,this.mimeType="image/jpeg",this.videoFrameRate=30,this._recorders={},this._renderToScreenDisabled=!1,this._preRender=()=>{var e,i,s;if(this.convergeMode&&((e=this._recorder)!=null&&e.isRecording())){const o=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((s=(i=this._viewer)==null?void 0:i.getPluginByType("Progressive"))==null?void 0:s.isConverged())||!1,o&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,i,s;if((e=this._recorder)!=null&&e.isRecording()&&(!this.convergeMode||(s=(i=this._viewer)==null?void 0:i.getPluginByType("Progressive"))!=null&&s.isConverged(!0))){const o=()=>{var c;return(c=this._recorder)==null?void 0:c.requestFrame()};this.convergeMode?(0,_e.timeout)(1).then(o):o()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)},this._refreshUi=()=>{var e;(e=this.uiConfig.children)==null||e.map(i=>(0,_e.getOrCall)(i)).flat(2).forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)==null?void 0:s.call(i)})},this.uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"],["MP4 Video (ffmpeg)","video/mp4"]].map(e=>({label:e[0],value:e[1]}))},{type:"input",disabled:!0,label:"State",getValue:()=>{var e;return((e=this.recorder)==null?void 0:e.state)??"not initialized"}},{type:"button",label:()=>{var e;return(e=this.recorder)!=null&&e.isRecording()?"Stop Recording":"Start Recording"},value:()=>{var e;(e=this.recorder)!=null&&e.isRecording()?this.stopRecording().then(async i=>{if(i){const s=i.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(i,s)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var e,i;return!!((e=this.recorder)!=null&&e.isRecording())||!((i=this._viewer)!=null&&i.getPluginByType("CameraViews"))},value:()=>{var e,i;(i=(e=this._viewer)==null?void 0:e.getPluginByType("CameraViews"))==null||i.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var e,i,s,o;return!!((e=this.recorder)!=null&&e.isRecording())||!((i=this._viewer)!=null&&i.getPluginByType("CameraViews"))||!((o=(s=this._viewer)==null?void 0:s.getPluginByType("GLTFAnimation"))!=null&&o.animations.length)},value:()=>{var i,s,o,c;const e=((s=(i=this._viewer)==null?void 0:i.getPluginByType("GLTFAnimation"))==null?void 0:s.animationState)==="playing";(c=(o=this._viewer)==null?void 0:o.getPluginByType("CameraViews"))==null||c.recordAllViews(()=>{var g,b;(b=(g=this._viewer)==null?void 0:g.getPluginByType("GLTFAnimation"))==null||b.playAnimation()}).then(()=>{var g,b;e||((b=(g=this._viewer)==null?void 0:g.getPluginByType("GLTFAnimation"))==null||b.stopAnimation())})}},{type:"button",limitedUi:!0,label:"Record GLTF Anim",hidden:()=>{var e,i,s;return!!((e=this.recorder)!=null&&e.isRecording())||!((s=(i=this._viewer)==null?void 0:i.getPluginByType("GLTFAnimation"))!=null&&s.animations.length)},value:async()=>{var o,c;if((o=this.recorder)!=null&&o.isRecording())return;const e=(c=this._viewer)==null?void 0:c.getPluginByType("GLTFAnimation");if(!e)return;let i=!1;e.loopAnimations&&(i=!0),i&&(e.loopAnimations=!1);const s=await this.record(async()=>e.playAnimation());if(i&&(e.loopAnimations=!0),s){const g=s.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(s,g)}}},{type:"button",limitedUi:!0,label:"Record 360 animation",hidden:()=>{var e;return!!((e=this.recorder)!=null&&e.isRecording())},value:async()=>{var o;if((o=this.recorder)!=null&&o.isRecording()||!this._viewer)return;const e=await this._viewer.prompt("Enter duration in seconds","5",!0);if(e===null)return;const i=parseFloat(e||"5");if(!isFinite(i)||i<=0)return;const s=await this.recordCamera360(i);if(s){const c=s.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(s,c)}}}]},this.refreshRecorderOptions=this.refreshRecorderOptions.bind(this)}isRecording(){var e;return((e=this._recorder)==null?void 0:e.isRecording())??!1}refreshRecorderOptions(){if(!this._viewer)return;let e="image";this.mimeType==="video/mp4"?e="ffmpeg.js":this.mimeType==="auto"?e="canvas-media":this.mimeType.startsWith("image")&&(e="image"),this._recorder=this._getRecorder(e),this._recorder&&this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType,stepMode:this.convergeMode})}async onAdded(e){var i;await super.onAdded(e),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.scene.addEventListener("addSceneObject",this._refreshUi),this._recordIndicator=document.createElement("div"),this._recordIndicator.style.width="20px",this._recordIndicator.style.height="20px",this._recordIndicator.style.backgroundColor="red",this._recordIndicator.style.top="10px",this._recordIndicator.style.left="10px",this._recordIndicator.style.position="absolute",this._recordIndicator.style.borderRadius="100%",this._recordIndicator.style.visibility="hidden",(i=e.canvas.parentElement)==null||i.appendChild(this._recordIndicator),this.refreshRecorderOptions()}_stateChange(e){var i,s;this.dirty=e,(i=this._viewer)==null||i.setDirty(),(s=this.uiConfig.children)==null||s.map(o=>(0,_e.getOrCall)(o)).flat(2).forEach(o=>{var c;return(c=o==null?void 0:o.uiRefresh)==null?void 0:c.call(o)})}async onRemove(e){var i;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),e.scene.removeEventListener("addSceneObject",this._refreshUi),(i=this._recorder)==null||i.dispose(),Object.values(this._recorders).forEach(s=>{s==null||s.dispose()}),super.onRemove(e)}async record(e,i){var s;if(this.enabled&&!((s=this._recorder)!=null&&s.isRecording()))return await new Promise((o,c)=>{const g=()=>{this.removeEventListener("start",b),this.removeEventListener("stop",g),this.removeEventListener("error",et)},b=async()=>{g(),i==null||i(),await e(),o()},et=async()=>{g(),c()};this.addEventListener("start",b),this.addEventListener("stop",g),this.addEventListener("error",et),this.startRecording()}),await this.stopRecording()}startRecording(){var e;return!!this.enabled&&((e=this.recorder)==null?void 0:e.isRecording())===!1&&(this.recorder.options.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if((e=this.recorder)!=null&&e.isRecording())return new Promise((i,s)=>{var o;return(o=this.recorder)==null?void 0:o.stop(i)})}async _downloadBlob(e,i){var c,g,b;const s=await((c=this._viewer)==null?void 0:c.prompt("Canvas Recorder: Save file as","recording.mp4",!1)),o=(g=this._viewer)==null?void 0:g.getPluginByType("FileTransferPlugin");o?await o.exportFile(e,s||"recording.mp4"):(b=this._viewer)==null||b.console.error("FileTransferPlugin required to export/download file")}async recordCamera360(e){var rt;if((rt=this.recorder)!=null&&rt.isRecording()||!this._viewer)return;const i=this._viewer.scene.activeCamera;let s=i.interactionsEnabled;for(;!s;)this._viewer.setDirty(),await this._viewer.doOnce("postFrame"),this._viewer.console.warn("interactions are already disabled by something, waiting..."),s=i.interactionsEnabled;s&&(i.interactionsEnabled=!1);const o=i.target.clone(),c=i.position.clone().sub(o),g=await this._viewer.getPluginByType("PopmotionPlugin");if(!g)return void console.error("Popmotion plugin not found");const b=new _.$V().setFromVector3(c);i.position.setFromSpherical(b).add(o),i.positionUpdated(!0);const et=i.autoLookAtTarget;i.autoLookAtTarget=!0;const tt=await this.record(async()=>g.animate({from:b.theta,to:b.theta+2*Math.PI,duration:1e3*e,ease:$y.linear,onUpdate:st=>{b.theta=st,i.position.setFromSpherical(b).add(o),i.positionUpdated(!0)}}).promise);return i.autoLookAtTarget=et,i.position.copy(c).add(o),i.positionUpdated(!0),s&&(i.interactionsEnabled=!0),tt}_getRecorder(e){if(!this._viewer)throw new Error("No viewer");if(this._recorders[e])return this._recorders[e];let i;return i=e==="canvas-media"?new xI(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):e==="ffmpeg.js"?new cM(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):new YN(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),i.addEventListener("starting",()=>this._stateChange(!1)),i.addEventListener("recording",()=>{this._recordIndicator.style.visibility="visible",this._recordIndicator.style.backgroundColor="red",this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),i.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),i.addEventListener("paused",()=>this._stateChange(!1)),i.addEventListener("stopped",()=>{this._recordIndicator.style.visibility="hidden",this.dispatchEvent({type:"stop"}),this._stateChange(!1)}),i.addEventListener("encode-progress",s=>{this.dispatchEvent({...s})}),this._recorders[e]=i,i}}oy.PluginType="CanvasRecorder",PO([(0,_e.onChange)(oy.prototype.refreshRecorderOptions),Mn()],oy.prototype,"convergeMode",void 0),PO([(0,_e.onChange)(oy.prototype.refreshRecorderOptions),Mn()],oy.prototype,"mimeType",void 0),PO([(0,_e.onChange)(oy.prototype.refreshRecorderOptions),Mn()],oy.prototype,"videoFrameRate",void 0);var PR=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};const RO=new _.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});RO.depthTest=!1;const DO=new _.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});DO.depthTest=!1;class P_ extends Vm{constructor(e={},i=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new _.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=i,i&&this.dependencies.push($0)}async onAdded(e){const i=e.renderer.createTarget({type:_.ywz,format:_.wk1,colorSpace:_.aCh,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:_.wem,magFilter:_.wem});i.texture.name="groundContactDepthTexture";const s=new _.lRF({depthPacking:_.z81});s.onBeforeCompile=function(c){c.uniforms.opacity.value=1,c.fragmentShader=`
						${c.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const o=new nm(i,s,new _.Ilk(0,0,0),0);this._depthPass=o,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject,null);const e=this._viewer.renderer.getTempTarget({type:_.ywz,format:_.wk1,colorSpace:_.aCh,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:_.wem,magFilter:_.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,i=1){this._viewer&&this._depthPass&&(RO.uniforms.h.value=i*this.blurAmount/256,DO.uniforms.v.value=i*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:RO,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:DO,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new _.Pa4)),this.shadowCamera.setRotationFromEuler(new _.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)==null||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var i;if(!this._viewer)return!1;const e=super._refreshMaterial();return this._material&&(this._material.alphaMap=((i=this._depthPass)==null?void 0:i.target.texture)||null,e&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),e}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}function KN(h,e,i,s){h.traverse(o=>{o&&(o.userData.cloneRotI=e,o.userData.rotationCount=i,o.userData.rotationAxis=s,o.addEventListener("beforeRender",c=>function(g,b){var et;b&&((et=b.map)!=null&&et.isTexture)&&(b.extraUniformsToUpload||(b.extraUniformsToUpload={}),b.extraUniformsToUpload.uvTransform||(b.extraUniformsToUpload.uvTransform={value:new _.Vkp}),b.extraUniformsToUpload.uvTransform.value.setUvTransform(b.map.offset.x*b.map.repeat.x*g.userData.cloneRotI/(g.userData.rotationCount||1),b.map.offset.y*b.map.repeat.y*g.userData.cloneRotI/(g.userData.rotationCount||1),b.map.repeat.x,b.map.repeat.y,b.map.rotation,b.map.center.x,b.map.center.y))}(o,c.material)))})}function JN(h,e,i,s="x"){if(h.userData.rotationCount>1&&!h.userData.rotationRoot)return h;const o=h.parent;if(!o)throw new Error("No parent");if(h.userData.cloneParent){const g=h.userData.cloneParent;if(!(h=o.children.find(b=>g===b.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",g,o),h}let c=o.children.filter(g=>{var b;return((b=g.userData)==null?void 0:b.cloneParent)===h.uuid}).sort((g,b)=>g.userData.cloneRotI-b.userData.cloneRotI);if(h.userData.rotationCount===e&&e===c.length&&i===void 0&&h.userData.rotationAxis===s)return h;if(i==null&&(i=h.userData.rotationSkips??[]),i!==h.userData.rotationSkips&&(h.userData.rotationSkips=[...i]),KN(h,0,e,s),h.userData.rotationRoot=!0,h.visible=!0,e<=c.length){for(let g=e-1;g<c.length;g++)o.remove(c[g]),c[g].traverse(b=>b.userData={__disposed:!0});c=c.slice(0,e)}for(let g=1;g<e;g++){const b=g<=c.length?c[g-1]:h.clone();b.rotation.copy(h.rotation),b.rotation[s]+=g/e*Math.PI*2,KN(b,g,e,s),g>c.length&&o.add(b),b.visible=!i.includes(g)}return h.visible=!i.includes(0),h}P_.PluginType="ContactShadowGroundPlugin",PR([(0,_e.onChange)(P_.prototype.refreshOptions),Mn()],P_.prototype,"contactShadows",void 0),PR([Mn(),(0,_e.onChange)(P_.prototype._setDirty)],P_.prototype,"blurAmount",void 0),PR([Mn(),(0,_e.onChange)(P_.prototype._refreshShadowCameraFrustum)],P_.prototype,"shadowScale",void 0),PR([Mn(),(0,_e.onChange)(P_.prototype._refreshShadowCameraFrustum)],P_.prototype,"shadowHeight",void 0);var uM,EI=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let ay=uM=class extends hs{async onAdded(h){var e;await super.onAdded(h),(e=h.getPluginByType("Picking"))==null||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}_selectedObjectChanged(){var i,s,o,c,g,b,et;if(!this.enabled)return;const h=(s=(i=this._viewer)==null?void 0:i.getPluginByType("Picking"))==null?void 0:s.getSelectedObject();if(!h)return void((c=(o=this.uiConfig).uiRefresh)==null?void 0:c.call(o,"postFrame",!0));const e=h.userData.rotationRoot?h.userData.rotationCount??1:1;this.rotations=e,this.skips=((g=h.userData.rotationSkips)==null?void 0:g.join(","))??"",this.axis=h.userData.rotationAxis||"x",(et=(b=this.uiConfig).uiRefresh)==null||et.call(b,"postFrame",!0)}_paramsChanged(){var e,i,s,o,c,g;if(!this.enabled)return;const h=(i=(e=this._viewer)==null?void 0:e.getPluginByType("Picking"))==null?void 0:i.getSelectedObject();if(h){if(this.rotations>1||h.userData.rotationCount){const b=h.userData.rotationCount,et=JN(h,this.rotations,this.skips.split(",").map(rt=>parseInt(rt)).filter(rt=>isFinite(rt)),this.axis),tt=et==null?void 0:et.userData.rotationCount;if(tt&&tt!==b){const rt=[];et==null||et.traverseAncestors(st=>{rt.push(st)});for(const st of rt)if(st.userData.autoScaled){Mo(st),(s=this._viewer)==null||s.resetCamera({rootObject:st,centerOffset:new _.Pa4(4,4,4)});break}}h.parent&&!h.userData.__disposed||((c=(o=this._viewer)==null?void 0:o.getPluginByType("Picking"))==null||c.setSelectedObject(et,!0))}(g=this._viewer)==null||g.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};ay.PluginType="ObjectRotationPlugin",EI([Mn(),Nr("Enabled"),(0,_e.onChange)(uM.prototype._paramsChanged)],ay.prototype,"enabled",void 0),EI([es("Rotation Count",[1,100],1,h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&i.getSelectedObject())||!h.rotations}})),(0,_e.onChange)(uM.prototype._paramsChanged)],ay.prototype,"rotations",void 0),EI([em("Axis",["x","y","z"].map(h=>({label:h})),h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&i.getSelectedObject())||!h.rotations}})),(0,_e.onChange)(uM.prototype._paramsChanged)],ay.prototype,"axis",void 0),EI([js("Rotation Skips",h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&i.getSelectedObject())||!h.rotations}})),(0,_e.onChange)(uM.prototype._paramsChanged)],ay.prototype,"skips",void 0),ay=uM=EI([Ms("Object Rotations")],ay);var lS,hM=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let c0=lS=class extends hs{constructor(h=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,i,s)=>{if(i.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const o of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=rs(e.fragmentShader,`#include <${o}>`,_.WdD[o].replace(/\bv\w+Uv\b/g,"parallaxUv.xy",{replaceAll:!0}));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=rs(e.fragmentShader,"texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=rs(e.fragmentShader,"#include <normal_fragment_maps>",rs(rs(_.WdD.normal_fragment_maps,"#elif defined( USE_NORMALMAP_TANGENTSPACE )","#elif defined( USE_NORMALMAP_TANGENTSPACE ) && !defined( USE_BUMPMAP )"),"normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vBumpMapUv,0.);float parallaxHeight;vec2 texCoords=vBumpMapUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vBumpMapUv);vec2 duv2=dFdy(vBumpMapUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vBumpMapUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var i;return this.enabled+" "+((i=e.materialObject.bumpMap)==null?void 0:i.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:i},s)=>{if(this.enabled)for(const[o,c]of Object.entries(this._defines)){const g=typeof c=="number"?c:c?1:0;i.defines[o]!==g&&(i.defines[o]=g,i.needsUpdate=!0)}}},this.dependencies=[Lr],this.enabled=h,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var h,e,i;(e=(h=this._bumpMapExtension)==null?void 0:h.setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()}async onAdded(h){var e,i;return(i=(e=h.getPlugin(Lr))==null?void 0:e.materials)==null||i.registerMaterialExtension(this._bumpMapExtension),super.onAdded(h)}async onRemove(h){var e,i;return(i=(e=h.getPlugin(Lr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(h)}};c0.PluginType="ReliefParallaxMapping",hM([(0,_e.onChange)(lS.prototype._updateExtension),Mn(),Nr("Enabled")],c0.prototype,"enabled",void 0),hM([(0,_e.onChange)(lS.prototype._updateExtension),Nr("Debug Normals")],c0.prototype,"debugNormals",void 0),hM([(0,_e.onChange)(lS.prototype._updateExtension),Nr("Debug Hit Height")],c0.prototype,"debugHitHeight",void 0),hM([Kr("PARALLAX_MAP_STEPS",void 0,!0,lS.prototype._updateExtension),es("Step count",[1,32],1),Mn()],c0.prototype,"stepCount",void 0),hM([Kr("PARALLAX_MAP_B_STEPS",void 0,!0,lS.prototype._updateExtension),es("Binary search steps",[1,8],1),Mn()],c0.prototype,"binaryStepCount",void 0),c0=lS=hM([Ms("Parallax Mapping")],c0);class kO extends _.u9r{constructor(e,i,s=32,o=64,c=!1,g=new _.FM8(1,1),b="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:i,shape:e,shapeSegments:s,tubularSegments:o,closed:c,primary:b,shapeScale:g.clone()};const et=i.computeFrenetFrames(o,c);this.frames=et;const tt=new _.Pa4,rt=new _.Pa4,st=new _.Pa4,at=new _.FM8;let ct=new _.Pa4;const pt=[],gt=[],At=[],xt=e.getSpacedPoints(s);for(const Mt of xt)Mt.multiply(g);(function(){for(let Mt=0;Mt<o;Mt++)_t(Mt);_t(c===!1?o:0),function(){for(let Mt=0;Mt<=o;Mt++)for(let It=0;It<=s;It++)at.x=Mt/o,at.y=It/s,gt.push(at.x,at.y)}(),function(){const Mt=b==="shape",It=Mt?s:o,Bt=Mt?o:s;for(let Lt=1;Lt<=It;Lt++)for(let Ht=1;Ht<=Bt;Ht++){const[Jt,sn]=Mt?[Ht,Lt]:[Lt,Ht],on=(s+1)*(Jt-1)+(sn-1),mn=(s+1)*Jt+(sn-1),cn=(s+1)*Jt+sn,un=(s+1)*(Jt-1)+sn;At.push(on,mn,un),At.push(mn,cn,un)}}()})(),this.setIndex(At),this.setAttribute("position",new _.a$l(pt,3)),this.setAttribute("uv",new _.a$l(gt,2)),this.computeVertexNormals();const yt=this.attributes.normal;function _t(Mt){ct=i.getPointAt(Mt/o,ct);const It=et.normals[Mt],Bt=et.binormals[Mt];for(let Lt=0;Lt<=s;Lt++){const Ht=xt[Lt%s];rt.set(0,0,0).addScaledVector(It,Ht.x).addScaledVector(Bt,Ht.y),tt.copy(ct).add(rt),pt.push(tt.x,tt.y,tt.z)}}(function(){for(let It=1;It<s;It++){const Bt=It+o*(s+1);rt.fromBufferAttribute(yt,It),st.fromBufferAttribute(yt,Bt),rt.add(st).normalize(),yt.setXYZ(It,rt.x,rt.y,rt.z),yt.setXYZ(Bt,rt.x,rt.y,rt.z)}for(let It=1;It<o;It++){const Bt=It*(s+1),Lt=Bt+s;rt.fromBufferAttribute(yt,Bt),st.fromBufferAttribute(yt,Lt),rt.add(st).normalize(),yt.setXYZ(Bt,rt.x,rt.y,rt.z),yt.setXYZ(Lt,rt.x,rt.y,rt.z)}rt.fromBufferAttribute(yt,0),st.fromBufferAttribute(yt,s),rt.add(st);const Mt=o*(s+1);st.fromBufferAttribute(yt,Mt),rt.add(st),st.fromBufferAttribute(yt,Mt+s),rt.add(st),rt.normalize(),yt.setXYZ(0,rt.x,rt.y,rt.z),yt.setXYZ(s,rt.x,rt.y,rt.z),yt.setXYZ(Mt,rt.x,rt.y,rt.z),yt.setXYZ(Mt+s,rt.x,rt.y,rt.z),yt.needsUpdate=!0})()}createSplits(e){this.clearGroups();const i=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,s=this.index.count,o=[...e,1].sort((b,et)=>b-et);let c=0,g=0;for(const b of o){const et=Math.round(i*b)*s/i;this.addGroup(c,et-c,g++),c=et}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var BO,_1=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let Kv=BO=class extends hs{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new _.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var s,o;const h=(o=(s=this._viewer)==null?void 0:s.getPlugin(vo))==null?void 0:o.getSelectedObject();if(!h)return;let e=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!e)return;e=parseFloat(e);const i=new OO(0,0,e,e,0,2*Math.PI,!0,0);await this.extrudeObject(h,i)}}async onAdded(h){await super.onAdded(h)}static CreateCurve(h,e){if(h==="circle")return new OO(0,0,e.radius??1,e.radius??1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(h,e,i=this.shapeSegments,s=this.tubularSegments,o=this.shapeScale,c=this.materialSplits.split(",").map(b=>parseFloat(b.trim())),g=this.horizontalSplits){var at,ct,pt,gt,At,xt,yt,_t;if(h.userData.isExtrudedTube,h.userData._extrudeSource){const Mt=h.userData._extrudeSource;if(h=(at=h.parent)==null?void 0:at.children.find(It=>Mt===It.uuid),!h)return void console.warn("Could not find extrude source with uuid",Mt)}if(h.userData.extrudedObject){const Mt=h.userData.extrudedObject,It=(ct=h.parent)==null?void 0:ct.children.find(Bt=>Mt===Bt.uuid);It&&(It.removeFromParent(),It.geometry.dispose(),It.geometry=null,It.material=null),delete h.userData.extrudedObject}const b=h.geometry;if(!b)return void((pt=this._viewer)==null?void 0:pt.alert("Extrude: No geometry to extrude"));const et=[h.material];let tt;try{const Mt=BO.ConvertGeometryToFlatShape(b);tt=new kO(Mt,e,i,s,!0,o,g?"shape":"path"),tt.computeBoundingBox(),tt.createSplits(c)}catch(Mt){return void((gt=this._viewer)==null?void 0:gt.alert(typeof Mt=="string"?Mt:Mt==null?void 0:Mt.message))}et[0].color.set(16777215);for(let Mt=et.length;Mt<tt.groups.length;Mt++){const It=et[0].clone();et.push(It),It.color.set(16777215*Math.random())}const rt=new _.Kj0(tt,et);rt.userData._extrudeSource=h.uuid,rt.userData.isExtrudedTube=!0,h.visible=!1,h.userData.bboxVisible=!1,rt.name=h.name+"_extruded";const st=await((yt=(xt=(At=this._viewer)==null?void 0:At.getManager())==null?void 0:xt.importer)==null?void 0:yt.processImportedSingle(rt,{autoCenter:!1,autoScale:!1}));st&&((_t=h.parent)==null||_t.add(st.modelObject),h.userData.extrudedObject=st.modelObject.uuid,st.dispatchEvent({type:"select",ui:!0,value:st}))}static ExtrudeShape(h,e,i,s,o,c,g,b){const et=new kO(h,s,e,i,!0,new _.FM8(o,c),b?"shape":"path");et.computeBoundingBox(),et.createSplits(g);const tt=new _.Kj0(et,[]);return tt.userData.isExtrudedTube=!0,tt}static ConvertGeometryToFlatShape(h,e=!0){if(h.userData.__planarShape)return h.userData.__planarShape;let i=h.attributes.position;if(!i)throw"no position attribute";if(i.count>500)throw"too large to extrude";const s=h;i=s.attributes.position,s.boundingBox||s.computeBoundingBox();const o=s.boundingBox.getSize(new _.Pa4),c=o.x<.001?"x":o.y<.001?"y":o.z<.001?"z":null;if(!c)throw"geometry is not axis aligned not planar";let g=[];for(let et=0;et<i.count;et++){const tt=new _.FM8;c==="x"?tt.set(i.getY(et),i.getZ(et)):c==="y"?tt.set(i.getX(et),i.getZ(et)):tt.set(i.getX(et),i.getY(et)),g.push(tt)}if(e){let et=0;for(let tt=0;tt<g.length;tt++)(g[tt].x<g[et].x||g[tt].x===g[et].x&&g[tt].y<g[et].y)&&(et=tt);et!==0&&(g=g.slice(et).concat(g.slice(0,et)))}const b=new _.bnF(g);return h.userData.__planarShape=b,b}};Kv.PluginType="ShapeTubeExtrudePlugin",_1([Nr("Enabled")],Kv.prototype,"enabled",void 0),_1([es("Shape Segments (X)",[1,100],1,h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPlugin(vo))!=null&&i.getSelectedObject())}}))],Kv.prototype,"shapeSegments",void 0),_1([es("Tube Segments (Y)",[1,100],1,h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPlugin(vo))!=null&&i.getSelectedObject())}}))],Kv.prototype,"tubularSegments",void 0),_1([ip("Shape scale",[.01,10],.01,h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPlugin(vo))!=null&&i.getSelectedObject())}}))],Kv.prototype,"shapeScale",void 0),_1([js("Material Splits",h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPlugin(vo))!=null&&i.getSelectedObject())}}))],Kv.prototype,"materialSplits",void 0),_1([Nr("Horizontal Splits",h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPlugin(vo))!=null&&i.getSelectedObject())}}))],Kv.prototype,"horizontalSplits",void 0),_1([go("Extrude Circle Tube",h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPlugin(vo))!=null&&i.getSelectedObject())}}))],Kv.prototype,"extrudeCirceTube",void 0),Kv=BO=_1([Ms("Extrude Tube Shapes")],Kv);class OO extends _.Ny0{getPoint(e,i){return super.getPoint(e,i||new _.Pa4)}}class dM extends hs{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var c,g;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((c=this._viewer.getPluginByType("FrameFade"))==null||c.enable(dM.PluginType),this._fadeDisabled=!1));const i=(0,_e.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=i-1/60);let s=i-this._lastFrameTime;this._lastFrameTime=i;const o=(g=this._viewer.getPluginByType("Progressive"))==null?void 0:g.postFrameConvergedRecordingDelta();if(o&&o>0&&(s=o),o!==0&&(s*=1e3,!(s<=.001)&&(this._updaters.forEach(b=>{let et=s;b.time+et<0&&(et=-b.time),b.time+=et,Math.abs(et)>.001&&b.u(et)}),!this._fadeDisabled&&this.disableFrameFade))){const b=this._viewer.getPluginByType("FrameFade");b&&(b.disable(dM.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=i=>({start:()=>this._updaters.push({u:i,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(s=>s.u===i),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const i=np(),s={id:i,options:e,stop:()=>{var o,c,g;(o=this.animations[i])!=null&&o._stop?(g=(c=this.animations[i])==null?void 0:c._stop)==null||g.call(c):console.warn("Animation not started")}};return this.animations[i]=s,s.promise=new Promise((o,c)=>{const g={driver:this.defaultDriver,...e,onComplete:()=>{var et;try{(et=e.onComplete)==null||et.call(e)}catch(tt){return void c(tt)}o()},onStop:()=>{var et;try{(et=e.onStop)==null||et.call(e)}catch(tt){return void c(tt)}o()}},b=e0(g);this.animations[i]._stop=b.stop,this.animations[i].options=g}).then(()=>(delete this.animations[i],i)),this.animations[i]}async animateAsync(e){return this.animate(e).promise}}dM.PluginType="PopmotionPlugin";var LO,ly,_u=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};const Hm=h=>({onChange:e=>{e.last&&h.onChange()}});let gp=LO=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.textAnchor="middle",this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(h){Object.assign(this,h)}reset(){const h=this.onChange;Object.assign(this,new LO),this.onChange=h}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor,textAnchor:this.textAnchor}}};_u([js("Text",Hm)],gp.prototype,"text",void 0),_u([es("Font Size",[2,400],1,Hm)],gp.prototype,"fontSize",void 0),_u([es("Width",[2,4096],1,Hm)],gp.prototype,"width",void 0),_u([es("Height",[2,4096],1,Hm)],gp.prototype,"height",void 0),_u([es("X Offset",[-1024,1024],1,Hm)],gp.prototype,"xOffset",void 0),_u([es("Y Offset",[-1024,1024],1,Hm)],gp.prototype,"yOffset",void 0),_u([es("V-Width",[2,4096],1,Hm)],gp.prototype,"boxWidth",void 0),_u([es("V-Height",[2,4096],1,Hm)],gp.prototype,"boxHeight",void 0),_u([em("Text Anchor",["start","middle","end"].map(h=>({label:h})),Hm)],gp.prototype,"textAnchor",void 0),_u([js("Font",Hm)],gp.prototype,"fontFamily",void 0),_u([js("Font Url",Hm)],gp.prototype,"fontPath",void 0),_u([Nr("Mask Text",Hm)],gp.prototype,"maskText",void 0),_u([Nr("Inner Shadow",Hm)],gp.prototype,"innerShadow",void 0),_u([s_("Text Color",Hm)],gp.prototype,"textColor",void 0),_u([s_("BG Fill",Hm)],gp.prototype,"bgFillColor",void 0),_u([s_("SVG BG",Hm)],gp.prototype,"svgBackground",void 0),gp=LO=_u([Ms("Text SVG Options")],gp);const $N={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},SI=h=>({hidden:()=>{const e=h.getSelected();return!e||!e.userData[Jv.PluginType]}});let Jv=ly=class extends hs{async onAdded(h){var e;await super.onAdded(h),(e=h.getPluginByType("Picking"))==null||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.getSelected=()=>{var h,e;return(e=(h=this._viewer)==null?void 0:h.getPluginByType("Picking"))==null?void 0:e.getSelectedObject()},this.options=new gp,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}_selectedObjectChanged(){var i,s,o,c,g,b;if(!this.enabled)return;const h=this.getSelected();if(!h)return void((s=(i=this.uiConfig).uiRefresh)==null?void 0:s.call(i,"postFrame",!0));const e=h.userData[ly.PluginType];if(!e)return this.options.reset(),this._lastMeta=void 0,void((c=(o=this.uiConfig).uiRefresh)==null?void 0:c.call(o,"postFrame",!0));this._lastMeta!==e&&(this.options.set(e),this._lastMeta=e),(b=(g=this.uiConfig).uiRefresh)==null||b.call(g,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const h=this.getSelected();h&&h.isMesh&&h.userData[ly.PluginType]&&this.updateText(h,this.options.toJSON())}async addTextToSelected(){var e;const h=this.getSelected();h&&h.isMesh?h.material?(h.userData[ly.PluginType]||!h.material.map||await((e=this._viewer)==null?void 0:e.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(h):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(h,e){return this.updateText(h,Object.assign(this.options.toJSON(),e))}async updateText(h,e){var c,g;if(!h.isMesh)return;if(!h.material)return void console.error("updateText: no material on mesh");let i=h.userData[ly.PluginType];i||(h.userData[ly.PluginType]=i={}),Object.assign(i,e);const s=h.material;s.map&&(s.map._isSimpleTextTexture&&s.map.dispose(),s.map=void 0),s.alphaMap&&(s.alphaMap._isSimpleTextTexture&&s.alphaMap.dispose(),s.alphaMap=void 0),s.bumpMap&&(s.bumpMap._isSimpleTextTexture&&s.bumpMap.dispose(),s.bumpMap=void 0);const o=await this.makeTextSvg(i);this.applyToMap&&(s.map=o),this.applyToAlphaMap&&(s.alphaMap=o,s.transparent=!0),this.applyToBumpMap&&(s.bumpMap=o),s.userData.inverseAlphaMap=this.inverseAlphaMap,s.setDirty(),s.needsUpdate=!0,(g=(c=this.uiConfig).uiRefresh)==null||g.call(c,"postFrame",!0)}async makeTextSvg(h){const e=h.fontFamily||"Arial",i=h.fontPath||this.fonts[e]||"";let s=h.style;if(i.length>0){const g=i.split("?")[0].split(".").pop()||"woff";s+=`
`+(i.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${i}) format(${$N[g]||g});
            }`:"")}let o=function({text:g="Custom Text",svgBackground:b="#ffffff",xOffset:et=0,yOffset:tt=0,width:rt=1024,height:st=1024,boxWidth:at=1024,boxHeight:ct=1024,fontFamily:pt="",fontSize:gt=32,maskText:At=!0,innerShadow:xt=!0,bgFillColor:yt="#000000",textColor:_t="#ffffff",textAnchor:Mt="middle",style:It=""}){return`
<svg style="background-color:${b}" width="${rt}" height="${st}" viewBox="0 0 ${at} ${ct}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${It}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: ${Mt}; font-size: ${gt}px; font-family: ${pt||"Arial"}">
        <defs>

`+(At?`
<mask id="textMask">
<text style="fill:white; font-size: ${gt}px;" x="${et+at/2}" y="${ct/2+tt+gt/4}" > ${g} </text>
</mask>
`:"")+`

`+(xt?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(At?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${at}" height="${ct}" style="fill:${yt}"/>
        <text style="${xt?"filter: url(#innerShadow);":""} fill:${_t};" x="${et+at/2}" y="${ct/2+tt+gt/4}"> ${g} </text>

`+(At?`
        </g>
`:"")+`

    </g>
</svg>
`}({...h,fontFamily:e,style:s});o=await(0,_e.embedUrlRefs)(o,async g=>this._getAssetData(g)),o=(0,_e.svgUrl)(o);const c=await this._viewer.getManager().importer.importSinglePath(o,{generateMipmaps:!1,minFilter:_.wem});return c._isSimpleTextTexture=!0,c.flipY=!1,c.needsUpdate=!0,c}async _getAssetData(h){var i,s;if(h.startsWith("http://www.w3.org"))return h;const e=(s=(i=this._viewer)==null?void 0:i.getManager())==null?void 0:s.importer;if(!e)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new c3(e.loadingManager),processImported:!1};try{return await e.importPath(h,this._assetLoadOptions)}catch(o){return console.error(o),""}}};Jv.PluginType="SimpleTextPlugin",_u([Ap(void 0,{params:SI})],Jv.prototype,"options",void 0),_u([Nr("Apply Map",SI),(0,_e.onChange)(ly.prototype._paramsChanged)],Jv.prototype,"applyToMap",void 0),_u([Nr("Apply Bump Map",SI),(0,_e.onChange)(ly.prototype._paramsChanged)],Jv.prototype,"applyToBumpMap",void 0),_u([Nr("Apply Alpha Map",SI),(0,_e.onChange)(ly.prototype._paramsChanged)],Jv.prototype,"applyToAlphaMap",void 0),_u([Nr("Invert Alpha Map",SI),(0,_e.onChange)(ly.prototype._paramsChanged)],Jv.prototype,"inverseAlphaMap",void 0),_u([go("Add Text",h=>({hidden:()=>!h.getSelected()}))],Jv.prototype,"addTextToSelected",null),Jv=ly=_u([Ms("Simple Text")],Jv);class NO{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class vz{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class yA{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new yA;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(i=>i.clone()),e}invert(){for(let i=0;i<this.polygons.length;i++)this.polygons[i].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let i=new Array,s=new Array;for(let o=0;o<e.length;o++)this.plane.splitPolygon(e[o],i,s,i,s);return this.front&&(i=this.front.clipPolygons(i)),s=this.back?this.back.clipPolygons(s):[],i.concat(s)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const i=[],s=[];for(let o=0;o<e.length;o++)this.plane.splitPolygon(e[o],this.polygons,this.polygons,i,s);i.length&&(this.front||(this.front=new yA),this.front.build(i)),s.length&&(this.back||(this.back=new yA),this.back.build(s))}}class $v{constructor(e=0,i=0,s=0){this.x=e,this.y=i,this.z=s}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new $v(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,i){return this.add(new $v().copy(e).sub(this).times(i))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const i=this.clone(),s=i.x,o=i.y,c=i.z,g=e.x,b=e.y,et=e.z;return this.x=o*et-c*b,this.y=c*g-s*et,this.z=s*b-o*g,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new _.Pa4(this.x,this.y,this.z)}}class cS{constructor(e,i){this.normal=e,this.w=i,this.normal=e,this.w=i}clone(){return new cS(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,i,s,o,c){let g=0;const b=[];for(let et=0;et<e.vertices.length;et++){const tt=this.normal.dot(e.vertices[et].pos)-this.w,rt=tt<-cS.EPSILON?2:tt>cS.EPSILON?1:0;g|=rt,b.push(rt)}switch(g){case 0:(this.normal.dot(e.plane.normal)>0?i:s).push(e);break;case 1:o.push(e);break;case 2:c.push(e);break;case 3:{const et=[],tt=[];for(let rt=0;rt<e.vertices.length;rt++){const st=(rt+1)%e.vertices.length,at=b[rt],ct=b[st],pt=e.vertices[rt],gt=e.vertices[st];if(at!=2&&et.push(pt),at!=1&&tt.push(at!=2?pt.clone():pt),(at|ct)==3){const At=(this.w-this.normal.dot(pt.pos))/this.normal.dot(new $v().copy(gt.pos).sub(pt.pos)),xt=pt.interpolate(gt,At);et.push(xt),tt.push(xt.clone())}}et.length>=3&&o.push(new pM(et,e.shared)),tt.length>=3&&c.push(new pM(tt,e.shared));break}}}static fromPoints(e,i,s){const o=new $v().copy(i).sub(e).cross(new $v().copy(s).sub(e)).normalize();return new cS(o.clone(),o.dot(e))}}cS.EPSILON=1e-5;class pM{constructor(e,i){this.vertices=e,this.shared=i,this.plane=cS.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new pM(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class RR{constructor(e,i,s,o){this.pos=new $v().copy(e),this.normal=new $v().copy(i),this.uv=new $v().copy(s),this.uv.z=0,o&&(this.color=new $v().copy(o))}clone(){return new RR(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,i){return new RR(this.pos.clone().lerp(e.pos,i),this.normal.clone().lerp(e.normal,i),this.uv.clone().lerp(e.uv,i),this.color&&e.color&&this.color.clone().lerp(e.color,i))}}class zu{constructor(){this.polygons=new Array}static fromPolygons(e){const i=new zu;return i.polygons=e,i}static fromGeometry(e,i){let s=[];const o=e.attributes.position,c=e.attributes.normal,g=e.attributes.uv,b=e.attributes.color,et=e.groups;let tt;if(e.index)tt=e.index.array;else{tt=new Array(o.array.length/o.itemSize|0);for(let st=0;st<tt.length;st++)tt[st]=st}const rt=tt.length/3|0;s=new Array(rt);for(let st=0,at=0,ct=tt.length;st<ct;st+=3,at++){const pt=new Array(3);for(let gt=0;gt<3;gt++){const At=tt[st+gt],xt=3*At,yt=2*At,_t=o.array[xt],Mt=o.array[xt+1],It=o.array[xt+2],Bt=c.array[xt],Lt=c.array[xt+1],Ht=c.array[xt+2],Jt=g==null?void 0:g.array[yt],sn=g==null?void 0:g.array[yt+1];pt[gt]=new RR(new $v(_t,Mt,It),new $v(Bt,Lt,Ht),new $v(Jt,sn,0),b&&new $v(b.array[yt],b.array[yt+1],b.array[yt+2]))}if(i===void 0&&et&&et.length>0)for(const gt of et)st>=gt.start&&st<gt.start+gt.count&&(s[at]=new pM(pt,gt.materialIndex));else s[at]=new pM(pt,i)}return zu.fromPolygons(s.filter(st=>!isNaN(st.plane.normal.x)))}static toGeometry(e,i){let s=0;const o=e.polygons;for(const ct of o)s+=ct.vertices.length-2;const c=new _.u9r,g=new NO(3*s*3),b=new NO(3*s*3),et=new vz(2*s*3);let tt;const rt=[],st=[];for(const ct of o){const pt=ct.vertices,gt=pt.length;ct.shared!==void 0&&(rt[ct.shared]||(rt[ct.shared]=[])),gt&&pt[0].color!==void 0&&(tt||(tt=new NO(3*s*3)));for(let At=3;At<=gt;At++)(ct.shared===void 0?st:rt[ct.shared]).push(g.top/3,g.top/3+1,g.top/3+2),g.write(pt[0].pos),g.write(pt[At-2].pos),g.write(pt[At-1].pos),b.write(pt[0].normal),b.write(pt[At-2].normal),b.write(pt[At-1].normal),et&&(et.write(pt[0].uv),et.write(pt[At-2].uv),et.write(pt[At-1].uv)),tt&&(tt.write(pt[0].color),tt.write(pt[At-2].color),tt.write(pt[At-1].color))}c.setAttribute("position",new _.TlE(g.array,3)),c.setAttribute("normal",new _.TlE(b.array,3)),et&&c.setAttribute("uv",new _.TlE(et.array,2)),tt&&c.setAttribute("color",new _.TlE(tt.array,3));for(let ct=0;ct<rt.length;ct++)rt[ct]===void 0&&(rt[ct]=[]);if(rt.length){let ct=[],pt=0;for(let gt=0;gt<rt.length;gt++)c.addGroup(pt,rt[gt].length,gt),pt+=rt[gt].length,ct=ct.concat(rt[gt]);c.addGroup(pt,st.length,rt.length),ct=ct.concat(st),c.setIndex(ct)}const at=new _.yGw().copy(i).invert();return c.applyMatrix4(at),c.computeBoundingSphere(),c.computeBoundingBox(),c}static fromMesh(e,i){const s=zu.fromGeometry(e.geometry,i),o=new _.Pa4,c=new _.Vkp;c.getNormalMatrix(e.matrix);for(let g=0;g<s.polygons.length;g++){const b=s.polygons[g];for(let et=0;et<b.vertices.length;et++){const tt=b.vertices[et];tt.pos.copy(o.copy(tt.pos.toVector3()).applyMatrix4(e.matrix)),tt.normal.copy(o.copy(tt.normal.toVector3()).applyMatrix3(c))}}return s}static toMesh(e,i,s){const o=zu.toGeometry(e,i),c=new _.Kj0(o,s);return c.matrix.copy(i),c.matrix.decompose(c.position,c.quaternion,c.scale),c.rotation.setFromQuaternion(c.quaternion),c.updateMatrixWorld(),c.castShadow=c.receiveShadow=!0,c}static union(e,i){const s=zu.fromMesh(e),o=zu.fromMesh(i);return zu.toMesh(s.union(o),e.matrix,e.material)}static subtract(e,i){const s=zu.fromMesh(e),o=zu.fromMesh(i);return zu.toMesh(s.subtract(o),e.matrix,e.material)}static intersect(e,i){const s=zu.fromMesh(e),o=zu.fromMesh(i);return zu.toMesh(s.intersect(o),e.matrix,e.material)}clone(){const e=new zu;return e.polygons=this.polygons.map(i=>i.clone()).filter(i=>Number.isFinite(i.plane.w)),e}toPolygons(){return this.polygons}union(e){const i=new yA(this.clone().polygons),s=new yA(e.clone().polygons);return i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),zu.fromPolygons(i.allPolygons())}subtract(e){const i=new yA(this.clone().polygons),s=new yA(e.clone().polygons);return i.invert(),i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),i.invert(),zu.fromPolygons(i.allPolygons())}intersect(e){const i=new yA(this.clone().polygons),s=new yA(e.clone().polygons);return i.invert(),s.clipTo(i),s.invert(),i.clipTo(s),s.clipTo(i),i.build(s.allPolygons()),i.invert(),zu.fromPolygons(i.allPolygons())}inverse(){const e=this.clone();for(const i of e.polygons)i.flip();return e}toMesh(e,i){return zu.toMesh(this,e,i)}toGeometry(e){return zu.toGeometry(this,e)}}var fM=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};const UO=["union","subtract","intersect"];class Ow extends hs{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[vo],this.rootMesh=new _.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var i;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(i=e.getPlugin(vo))==null||i.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var i,s;const e=(s=(i=this._viewer)==null?void 0:i.getPlugin(vo))==null?void 0:s.getSelectedObject();e&&e.geometry&&(e.userData._isCSGMesh||(e.userData.csgBrush||(e.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&(0,_e.downloadBlob)(e,"csg."+e.ext)}async exportObject(){var o,c;const e=(c=(o=this._viewer)==null?void 0:o.getPluginByType("AssetExporterPlugin"))==null?void 0:c.exporter;if(!e||!this.rootObject)return;const i=this.rootMesh.visible;this.rootMesh.visible=!0;const s=await e.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=i,s}_updateSelectedProperties(){var i,s;const e=(s=(i=this._viewer)==null?void 0:i.getPlugin(vo))==null?void 0:s.getSelectedObject();e&&e.userData.csgBrush&&(e.userData.csgBrush.enabled=this.csgSelectedEnabled,e.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var i,s,o,c,g,b;const e=(s=(i=this._viewer)==null?void 0:i.getPlugin(vo))==null?void 0:s.getSelectedObject();e&&(this.csgSelectedEnabled=((o=e.userData.csgBrush)==null?void 0:o.enabled)??!1,this.csgSelectedOperation=((c=e.userData.csgBrush)==null?void 0:c.operation)??"union"),(b=(g=this.uiConfig)==null?void 0:g.uiRefresh)==null||b.call(g,"postFrame",!0)}_preFrame(){var i,s;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const e=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(i=this.rootObject)==null||i.modelObject.updateMatrixWorld(!0),(this.rootMesh.userData.dispose??this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(e)),this.rootMesh&&!this.rootMesh.parent&&((s=this.rootObject)==null||s.modelObject.add(this.rootMesh)),this.showResult?(e.forEach(o=>{o[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(e.forEach(o=>{o[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var i;const e=[];return(i=this._viewer)==null||i.scene.traverse(s=>{var o;s.isMesh&&s.geometry&&((o=s.userData.csgBrush)!=null&&o.enabled)&&e.push([s,s.userData.csgBrush.operation])}),e}_sceneUpdate(e){var i,s;(s=(i=e==null?void 0:e.object)==null?void 0:i.userData)!=null&&s._isCSGMesh||(this._csgNeedsUpdate=!0)}}fM([Nr("Show Result",h=>({onChange:()=>{var e;return(e=h._viewer)==null?void 0:e.setDirty()}}))],Ow.prototype,"showResult",void 0),fM([go("Make CSG Brush",h=>({hidden:()=>{var i,s;const e=(s=(i=h._viewer)==null?void 0:i.getPlugin(vo))==null?void 0:s.getSelectedObject();return!(e!=null&&e.userData)||!!e.userData.csgBrush||e.userData._isCSGMesh}}))],Ow.prototype,"makeSelectedCSGBrush",null),fM([Nr("Enabled",h=>({hidden:()=>{var i,s;const e=(s=(i=h._viewer)==null?void 0:i.getPlugin(vo))==null?void 0:s.getSelectedObject();return!e||!e.userData.csgBrush},onChange:h._updateSelectedProperties}))],Ow.prototype,"csgSelectedEnabled",void 0),fM([em("Operation",UO.map(h=>({label:h})),h=>({hidden:()=>{var i,s;const e=(s=(i=h._viewer)==null?void 0:i.getPlugin(vo))==null?void 0:s.getSelectedObject();return!e||!e.userData.csgBrush},onChange:h._updateSelectedProperties}))],Ow.prototype,"csgSelectedOperation",void 0),fM([go("Refresh CSG")],Ow.prototype,"refreshCSG",null),fM([go("Export Result",h=>({hidden:()=>{var e;return!((e=h._viewer)!=null&&e.getPluginByType("AssetExporterPlugin"))}}))],Ow.prototype,"downloadObject",null);function ZN(h,e){let i=new zu;const s=h.map(c=>c[0].material).flatMap(c=>c);h.forEach(([c,g])=>{if(!UO.includes(g))return void console.error(`Unknown operation ${g}`);c.updateMatrix(),c.updateMatrixWorld();const b=c.matrix;c.matrix=c.matrixWorld;let et=0;et=Array.isArray(c.material)?void 0:s.indexOf(c.material),i=i[g](zu.fromMesh(c,et)),c.matrix=b});const o=i.toMesh(e??new _.yGw().identity(),s);return o.userData._isCSGMesh=!0,o.geometry.groups=o.geometry.groups.filter(c=>c.count>0),o}let CI=class extends Ow{_buildCSGMesh(h){return ZN(h)}};CI.PluginType="CSGPluginBSP",CI=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g}([Ms("CSG Plugin (BSP)")],CI);const eU=0,tU=1,nU=3,iU=4;class Lw{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,i){let s=1/0,o=-1/0;for(let c=0,g=e.length;c<g;c++){const b=e[c][i];s=b<s?b:s,o=b>o?b:o}this.min=s,this.max=o}setFromPoints(e,i){let s=1/0,o=-1/0;for(let c=0,g=i.length;c<g;c++){const b=i[c],et=e.dot(b);s=et<s?et:s,o=et>o?et:o}this.min=s,this.max=o}isSeparated(e){return this.min>e.max||e.min>this.max}}Lw.prototype.setFromBox=function(){const h=new _.Pa4;return function(e,i){const s=i.min,o=i.max;let c=1/0,g=-1/0;for(let b=0;b<=1;b++)for(let et=0;et<=1;et++)for(let tt=0;tt<=1;tt++){h.x=s.x*b+o.x*(1-b),h.y=s.y*et+o.y*(1-et),h.z=s.z*tt+o.z*(1-tt);const rt=e.dot(h);c=Math.min(rt,c),g=Math.max(rt,g)}this.min=c,this.max=g}}();const _z=function(){const h=new _.Pa4,e=new _.Pa4,i=new _.Pa4;return function(s,o,c){const g=s.start,b=h,et=o.start,tt=e;i.subVectors(g,et),h.subVectors(s.end,s.start),e.subVectors(o.end,o.start);const rt=i.dot(tt),st=tt.dot(b),at=tt.dot(tt),ct=i.dot(b),pt=b.dot(b)*at-st*st;let gt,At;gt=pt!==0?(rt*st-ct*at)/pt:0,At=(rt+gt*st)/at,c.x=gt,c.y=At}}(),FO=function(){const h=new _.FM8,e=new _.Pa4,i=new _.Pa4;return function(s,o,c,g){_z(s,o,h);let b=h.x,et=h.y;if(b>=0&&b<=1&&et>=0&&et<=1)return s.at(b,c),void o.at(et,g);if(b>=0&&b<=1)return et<0?o.at(0,g):o.at(1,g),void s.closestPointToPoint(g,!0,c);if(et>=0&&et<=1)return b<0?s.at(0,c):s.at(1,c),void o.closestPointToPoint(c,!0,g);{let tt,rt;tt=b<0?s.start:s.end,rt=et<0?o.start:o.end;const st=e,at=i;return s.closestPointToPoint(rt,!0,e),o.closestPointToPoint(tt,!0,i),st.distanceToSquared(rt)<=at.distanceToSquared(tt)?(c.copy(st),void g.copy(rt)):(c.copy(tt),void g.copy(at))}}}(),yz=function(){const h=new _.Pa4,e=new _.Pa4,i=new _.JOQ,s=new _.Zzh;return function(o,c){const{radius:g,center:b}=o,{a:et,b:tt,c:rt}=c;if(s.start=et,s.end=tt,s.closestPointToPoint(b,!0,h).distanceTo(b)<=g||(s.start=et,s.end=rt,s.closestPointToPoint(b,!0,h).distanceTo(b)<=g)||(s.start=tt,s.end=rt,s.closestPointToPoint(b,!0,h).distanceTo(b)<=g))return!0;const st=c.getPlane(i);if(Math.abs(st.distanceToPoint(b))<=g){const at=st.projectPoint(b,e);if(c.containsPoint(at))return!0}return!1}}(),Az=1e-15;function mM(h){return Math.abs(h)<Az}class AA extends _.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new _.Pa4),this.satBounds=new Array(4).fill().map(()=>new Lw),this.points=[this.a,this.b,this.c],this.sphere=new _.aLr,this.plane=new _.JOQ,this.needsUpdate=!0}intersectsSphere(e){return yz(e,this)}update(){const e=this.a,i=this.b,s=this.c,o=this.points,c=this.satAxes,g=this.satBounds,b=c[0],et=g[0];this.getNormal(b),et.setFromPoints(b,o);const tt=c[1],rt=g[1];tt.subVectors(e,i),rt.setFromPoints(tt,o);const st=c[2],at=g[2];st.subVectors(i,s),at.setFromPoints(st,o);const ct=c[3],pt=g[3];ct.subVectors(s,e),pt.setFromPoints(ct,o),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(b,e),this.needsUpdate=!1}}AA.prototype.closestPointToSegment=function(){const h=new _.Pa4,e=new _.Pa4,i=new _.Zzh;return function(s,o=null,c=null){const{start:g,end:b}=s,et=this.points;let tt,rt=1/0;for(let st=0;st<3;st++){const at=(st+1)%3;i.start.copy(et[st]),i.end.copy(et[at]),FO(i,s,h,e),tt=h.distanceToSquared(e),tt<rt&&(rt=tt,o&&o.copy(h),c&&c.copy(e))}return this.closestPointToPoint(g,h),tt=g.distanceToSquared(h),tt<rt&&(rt=tt,o&&o.copy(h),c&&c.copy(g)),this.closestPointToPoint(b,h),tt=b.distanceToSquared(h),tt<rt&&(rt=tt,o&&o.copy(h),c&&c.copy(b)),Math.sqrt(rt)}}(),AA.prototype.intersectsTriangle=function(){const h=new AA,e=new Array(3),i=new Array(3),s=new Lw,o=new Lw,c=new _.Pa4,g=new _.Pa4,b=new _.Pa4,et=new _.Pa4,tt=new _.Zzh,rt=new _.Zzh,st=new _.Zzh;return function(at,ct=null,pt=!1){this.needsUpdate&&this.update(),at.isExtendedTriangle?at.needsUpdate&&at.update():(h.copy(at),h.update(),at=h);const gt=this.plane,At=at.plane;if(Math.abs(gt.normal.dot(At.normal))>1-1e-10){const xt=this.satBounds,yt=this.satAxes;i[0]=at.a,i[1]=at.b,i[2]=at.c;for(let It=0;It<4;It++){const Bt=xt[It],Lt=yt[It];if(s.setFromPoints(Lt,i),Bt.isSeparated(s))return!1}const _t=at.satBounds,Mt=at.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let It=0;It<4;It++){const Bt=_t[It],Lt=Mt[It];if(s.setFromPoints(Lt,e),Bt.isSeparated(s))return!1}for(let It=0;It<4;It++){const Bt=yt[It];for(let Lt=0;Lt<4;Lt++){const Ht=Mt[Lt];if(c.crossVectors(Bt,Ht),s.setFromPoints(c,e),o.setFromPoints(c,i),s.isSeparated(o))return!1}}return ct&&(pt||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),ct.start.set(0,0,0),ct.end.set(0,0,0)),!0}{const xt=this.points;let yt=!1,_t=0;for(let on=0;on<3;on++){const mn=xt[on],cn=xt[(on+1)%3];tt.start.copy(mn),tt.end.copy(cn),tt.delta(g);const un=yt?rt.start:rt.end,bn=mM(At.distanceToPoint(mn));if(mM(At.normal.dot(g))&&bn){rt.copy(tt),_t=2;break}if((At.intersectLine(tt,un)||bn)&&!mM(un.distanceTo(cn))){if(_t++,yt)break;yt=!0}}if(_t===1&&at.containsPoint(rt.end))return ct&&(ct.start.copy(rt.end),ct.end.copy(rt.end)),!0;if(_t!==2)return!1;const Mt=at.points;let It=!1,Bt=0;for(let on=0;on<3;on++){const mn=Mt[on],cn=Mt[(on+1)%3];tt.start.copy(mn),tt.end.copy(cn),tt.delta(b);const un=It?st.start:st.end,bn=mM(gt.distanceToPoint(mn));if(mM(gt.normal.dot(b))&&bn){st.copy(tt),Bt=2;break}if((gt.intersectLine(tt,un)||bn)&&!mM(un.distanceTo(cn))){if(Bt++,It)break;It=!0}}if(Bt===1&&this.containsPoint(st.end))return ct&&(ct.start.copy(st.end),ct.end.copy(st.end)),!0;if(Bt!==2)return!1;if(rt.delta(g),st.delta(b),g.dot(b)<0){let on=st.start;st.start=st.end,st.end=on}const Lt=rt.start.dot(g),Ht=rt.end.dot(g),Jt=st.start.dot(g),sn=st.end.dot(g);return(Lt===sn||Jt===Ht||Ht<Jt!=Lt<sn)&&(ct&&(et.subVectors(rt.start,st.start),et.dot(g)>0?ct.start.copy(rt.start):ct.start.copy(st.start),et.subVectors(rt.end,st.end),et.dot(g)<0?ct.end.copy(rt.end):ct.end.copy(st.end)),!0)}}}(),AA.prototype.distanceToPoint=function(){const h=new _.Pa4;return function(e){return this.closestPointToPoint(e,h),e.distanceTo(h)}}(),AA.prototype.distanceToTriangle=function(){const h=new _.Pa4,e=new _.Pa4,i=["a","b","c"],s=new _.Zzh,o=new _.Zzh;return function(c,g=null,b=null){const et=g||b?s:null;if(this.intersectsTriangle(c,et))return(g||b)&&(g&&et.getCenter(g),b&&et.getCenter(b)),0;let tt=1/0;for(let rt=0;rt<3;rt++){let st;const at=i[rt],ct=c[at];this.closestPointToPoint(ct,h),st=ct.distanceToSquared(h),st<tt&&(tt=st,g&&g.copy(h),b&&b.copy(ct));const pt=this[at];c.closestPointToPoint(pt,h),st=pt.distanceToSquared(h),st<tt&&(tt=st,g&&g.copy(pt),b&&b.copy(h))}for(let rt=0;rt<3;rt++){const st=i[rt],at=i[(rt+1)%3];s.set(this[st],this[at]);for(let ct=0;ct<3;ct++){const pt=i[ct],gt=i[(ct+1)%3];o.set(c[pt],c[gt]),FO(s,o,h,e);const At=h.distanceToSquared(e);At<tt&&(tt=At,g&&g.copy(h),b&&b.copy(e))}}return Math.sqrt(tt)}}();const gM=1e-14,vM=1e-10,Nw=new _.Zzh,_h=new _.Zzh,Uw=new _.Pa4,rU=new _.Pa4,MI=new _.JOQ,bz=new AA;function TI(h){return h.a.distanceToSquared(h.b)<gM||h.a.distanceToSquared(h.c)<gM||h.b.distanceToSquared(h.c)<gM}class wz{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new _.CJI),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class xz{constructor(){this.trianglePool=new wz,this.triangles=[],this.normal=new _.Pa4}initialize(e){const{triangles:i,trianglePool:s,normal:o}=this;if(i.length=0,s.clear(),Array.isArray(e))for(let c=0,g=e.length;c<g;c++){const b=e[c];if(c===0)b.getNormal(o);else if(Math.abs(1-b.getNormal(Uw).dot(o))>gM)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const et=s.getTriangle();et.copy(b),i.push(et)}else{e.getNormal(o);const c=s.getTriangle();c.copy(e),i.push(c)}}splitByTriangle(e){const{normal:i,triangles:s}=this;if(e.getPlane(MI),Math.abs(1-Math.abs(MI.normal.dot(i)))<vM){const o=[e.a,e.b,e.c];for(let c=0;c<3;c++){const g=(c+1)%3,b=o[c],et=o[g];Uw.subVectors(et,b).normalize(),rU.crossVectors(i,Uw),MI.setFromNormalAndCoplanarPoint(rU,b),this.splitByPlane(MI,e,c)}for(let c=0,g=s.length;c<g;c++)s[c].coplanarCount=0}else this.splitByPlane(MI,e)}splitByPlane(e,i=null,s=-1){const{triangles:o,trianglePool:c}=this;let g=null;i!==null&&(g=bz,g.copy(i),g.needsUpdate=!0);for(let b=0,et=o.length;b<et;b++){const tt=o[b],{a:rt,b:st,c:at}=tt;if(g&&!g.intersectsTriangle(tt,Nw,!0))continue;let ct=0,pt=-1,gt=0,At=!1;const xt=[rt,st,at];for(let yt=0;yt<3;yt++){const _t=(yt+1)%3;Nw.start.copy(xt[yt]),Nw.end.copy(xt[_t]);const Mt=e.distanceToPoint(Nw.start),It=e.distanceToPoint(Nw.end);if(Math.abs(Mt)<vM&&Math.abs(It)<vM){At=!0;break}if(Math.abs(Mt)<vM)continue;Mt>0&&gt++;let Bt=!!e.intersectLine(Nw,Uw);!Bt&&Math.abs(It)<vM&&(Uw.copy(Nw.end),Bt=!0),!Bt||Uw.distanceTo(Nw.start)<gM||(Uw.distanceTo(Nw.end)<gM&&(pt=yt),ct===0?_h.start.copy(Uw):_h.end.copy(Uw),ct++)}if(!At)if(ct===2&&_h.distance()>vM)if(pt!==-1){pt=(pt+1)%3;let yt=0;yt===pt&&(yt=(yt+1)%3);let _t=yt+1;_t===pt&&(_t=(_t+1)%3);const Mt=c.getTriangle();Mt.a.copy(xt[_t]),Mt.b.copy(_h.end),Mt.c.copy(_h.start),TI(Mt)||o.push(Mt),tt.a.copy(xt[yt]),tt.b.copy(_h.start),tt.c.copy(_h.end),TI(tt)&&(o.splice(b,1),b--,et--)}else{const yt=xt.findIndex(Lt=>gt>=2?e.distanceToPoint(Lt)<0:e.distanceToPoint(Lt)>0);if(yt===0){let Lt=_h.start;_h.start=_h.end,_h.end=Lt}else if(yt===-1)continue;const _t=(yt+1)%3,Mt=(yt+2)%3,It=c.getTriangle(),Bt=c.getTriangle();xt[_t].distanceToSquared(_h.start)<xt[Mt].distanceToSquared(_h.end)?(It.a.copy(xt[_t]),It.b.copy(_h.start),It.c.copy(_h.end),Bt.a.copy(xt[_t]),Bt.b.copy(xt[Mt]),Bt.c.copy(_h.start)):(It.a.copy(xt[Mt]),It.b.copy(_h.start),It.c.copy(_h.end),Bt.a.copy(xt[_t]),Bt.b.copy(xt[Mt]),Bt.c.copy(_h.end)),tt.a.copy(xt[yt]),tt.b.copy(_h.end),tt.c.copy(_h.start),TI(It)||o.push(It),TI(Bt)||o.push(Bt),TI(tt)&&(o.splice(b,1),b--,et--)}else ct===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function sU(){return typeof SharedArrayBuffer<"u"}function Ez(h){if(h.buffer instanceof SharedArrayBuffer)return h;const e=h.constructor,i=h.buffer,s=new SharedArrayBuffer(i.byteLength),o=new Uint8Array(i);return new Uint8Array(s).set(o,0),new e(s)}class oU{constructor(e,i=500){const s=sU()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new s(i*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:i,array:s,expansionFactor:o}=this;e===null&&(e=~~(s.length*o));const c=new i(e);c.set(s,0),this.array=c}push(...e){let{array:i,length:s}=this;s+e.length>i.length&&(this.expand(),i=this.array);for(let o=0,c=e.length;o<c;o++)i[s+o]=e[o];this.length+=e.length}clear(){this.length=0}}class Sz{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:i,groupAttributes:s}=this;let o=0;for(let c=0;c<i;c++)o+=s[c][e].length;return o}getGroupSet(e=0){const{groupAttributes:i}=this;if(i[e])return this.groupCount=Math.max(this.groupCount,e+1),i[e];const s=i[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=i.length;){const o={};i.push(o);for(const c in s)o[c]=new oU(s[c].type)}return i[e]}getGroupArray(e,i=0){const{groupAttributes:s}=this;if(!s[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(i)[e]}initializeArray(e,i){const{groupAttributes:s}=this,o=s[0][e];if(o){if(o.type!==i)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let c=0,g=s.length;c<g;c++)s[c][e]=new oU(i)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(i=>{for(const s in i)i[s].clear()})}delete(e){this.groupAttributes.forEach(i=>{delete i[e]})}reset(){this.groupAttributes=[]}}class Cz{constructor(e){this.triangle=new _.CJI().copy(e),this.intersects={}}addTriangle(e,i){this.intersects[e]=new _.CJI().copy(i)}getIntersectArray(){const e=[],{intersects:i}=this;for(const s in i)e.push(i[s]);return e}}class aU{constructor(){this.data={}}addTriangleIntersection(e,i,s,o){const{data:c}=this;c[e]||(c[e]=new Cz(i)),c[e].addTriangle(s,o)}getTrianglesAsArray(e=null){const{data:i}=this,s=[];if(e!==null)e in i&&s.push(i[e].triangle);else for(const o in i)s.push(i[o].triangle);return s}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:i}=this;return i[e]?Object.keys(i[e].intersects).map(s=>parseInt(s)):[]}getIntersectionsAsArray(e=null,i=null){const{data:s}=this,o=new Set,c=[],g=b=>{if(s[b])if(i!==null)s[b].intersects[i]&&c.push(s[b].intersects[i]);else{const et=s[b].intersects;for(const tt in et)o.has(tt)||(o.add(tt),c.push(et[tt]))}};if(e!==null)g(e);else for(const b in s)g(b);return c}reset(){this.data={}}}class Mz{constructor(){this.enabled=!1,this.triangleIntersectsA=new aU,this.triangleIntersectsB=new aU,this.intersectionEdges=[]}addIntersectingTriangles(e,i,s,o){const{triangleIntersectsA:c,triangleIntersectsB:g}=this;c.addTriangleIntersection(e,i,s,o),g.addTriangleIntersection(s,o,e,i)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}class lU{constructor(){this.intersectionSet={},this.ids=[]}add(e,i){const{intersectionSet:s,ids:o}=this;s[e]||(s[e]=[],o.push(e)),s[e].push(i)}}const y1=new _.zHn,cU=new _.yGw,fv=new _.CJI,Fw=new _.Pa4,uU=new _.Ltg,hU=new _.Ltg,dU=new _.Ltg,jO=new _.Ltg,DR=new _.Ltg,kR=new _.Ltg,zO=new _.Zzh,VO=new _.Pa4,GO=1e-8,Tz=1e-15,BR=-1,OR=1,pU=-2,HO=2,LR=0,NR=1,QO=2;let UR=null;function fU(h){UR=h}function mU(h,e){function i(){return Math.random()-.5}h.getNormal(VO),y1.direction.copy(VO),h.getMidpoint(y1.origin);let s=0,o=1/0;for(let c=0;c<3;c++){y1.direction.x+=i()*GO,y1.direction.y+=i()*GO,y1.direction.z+=i()*GO,y1.direction.multiplyScalar(-1);const g=e.raycastFirst(y1,_.ehD);if(g&&y1.direction.dot(g.face.normal)>0&&s++,g!==null&&(o=Math.min(o,g.distance)),o<=Tz)return g.face.normal.dot(VO)>0?HO:pU;if(s/3>.5||(c-s+1)/3>.5)break}return s/3>.5?BR:OR}function Iz(h,e,i,s,o,c,g=!1){const b=i.attributes,et=i.index,tt=3*h,rt=et.getX(tt+0),st=et.getX(tt+1),at=et.getX(tt+2);for(const ct in c){const pt=b[ct],gt=c[ct];if(!(ct in b))throw new Error(`CSG Operations: Attribute ${ct} not available on geometry.`);const At=pt.itemSize;ct==="position"?(fv.a.fromBufferAttribute(pt,rt).applyMatrix4(s),fv.b.fromBufferAttribute(pt,st).applyMatrix4(s),fv.c.fromBufferAttribute(pt,at).applyMatrix4(s),WO(fv.a,fv.b,fv.c,e,3,gt,g)):ct==="normal"?(fv.a.fromBufferAttribute(pt,rt).applyNormalMatrix(o),fv.b.fromBufferAttribute(pt,st).applyNormalMatrix(o),fv.c.fromBufferAttribute(pt,at).applyNormalMatrix(o),g&&(fv.a.multiplyScalar(-1),fv.b.multiplyScalar(-1),fv.c.multiplyScalar(-1)),WO(fv.a,fv.b,fv.c,e,3,gt,g,!0)):(uU.fromBufferAttribute(pt,rt),hU.fromBufferAttribute(pt,st),dU.fromBufferAttribute(pt,at),WO(uU,hU,dU,e,At,gt,g))}}function Pz(h,e,i,s,o,c,g,b=!1){qO(h,s,o,c,g,b),qO(b?i:e,s,o,c,g,b),qO(b?e:i,s,o,c,g,b)}function gU(h,e,i=!1){switch(h){case eU:if(e===OR||e===HO&&!i)return NR;break;case tU:if(i){if(e===BR)return LR}else if(e===OR||e===pU)return NR;break;case nU:if(e===BR)return LR;if(e===OR)return NR;break;case iU:if(e===BR||e===HO&&!i)return NR;break;default:throw new Error(`Unrecognized CSG operation enum "${h}".`)}return QO}function WO(h,e,i,s,o,c,g=!1,b=!1){const et=tt=>{c.push(tt.x),o>1&&c.push(tt.y),o>2&&c.push(tt.z),o>3&&c.push(tt.w)};jO.set(0,0,0,0).addScaledVector(h,s.a.x).addScaledVector(e,s.a.y).addScaledVector(i,s.a.z),DR.set(0,0,0,0).addScaledVector(h,s.b.x).addScaledVector(e,s.b.y).addScaledVector(i,s.b.z),kR.set(0,0,0,0).addScaledVector(h,s.c.x).addScaledVector(e,s.c.y).addScaledVector(i,s.c.z),b&&(jO.normalize(),DR.normalize(),kR.normalize()),et(jO),g?(et(kR),et(DR)):(et(DR),et(kR))}function qO(h,e,i,s,o,c=!1){for(const g in o){const b=e[g],et=o[g];if(!(g in e))throw new Error(`CSG Operations: Attribute ${g} no available on geometry.`);const tt=b.itemSize;g==="position"?(Fw.fromBufferAttribute(b,h).applyMatrix4(i),et.push(Fw.x,Fw.y,Fw.z)):g==="normal"?(Fw.fromBufferAttribute(b,h).applyNormalMatrix(s),c&&Fw.multiplyScalar(-1),et.push(Fw.x,Fw.y,Fw.z)):(et.push(b.getX(h)),tt>1&&et.push(b.getY(h)),tt>2&&et.push(b.getZ(h)),tt>3&&et.push(b.getW(h)))}}const A1=new _.yGw,FR=new _.Vkp,uS=new _.CJI,jR=new _.CJI,zR=new _.CJI,VR=new _.CJI;function Rz(h){for(const e of h)return e}function vU(h,e,i,s,o,c,g,b=0){const et=h.matrixWorld.determinant()<0;A1.copy(e.matrixWorld).invert().multiply(h.matrixWorld),FR.getNormalMatrix(h.matrixWorld).multiplyScalar(et?-1:1);const tt=h.geometry.groupIndices,rt=h.geometry.index,st=h.geometry.attributes.position,at=e.geometry.boundsTree,ct=e.geometry.index,pt=e.geometry.attributes.position,gt=i.ids,At=i.intersectionSet;for(let xt=0,yt=gt.length;xt<yt;xt++){const _t=gt[xt],Mt=b===-1?0:tt[_t]+b,It=g.getGroupSet(Mt),Bt=3*_t,Lt=rt.getX(Bt+0),Ht=rt.getX(Bt+1),Jt=rt.getX(Bt+2);uS.a.fromBufferAttribute(st,Lt).applyMatrix4(A1),uS.b.fromBufferAttribute(st,Ht).applyMatrix4(A1),uS.c.fromBufferAttribute(st,Jt).applyMatrix4(A1),c.initialize(uS);const sn=At[_t];for(let mn=0,cn=sn.length;mn<cn;mn++){const un=3*sn[mn],bn=ct.getX(un+0),xn=ct.getX(un+1),Cn=ct.getX(un+2);jR.a.fromBufferAttribute(pt,bn),jR.b.fromBufferAttribute(pt,xn),jR.c.fromBufferAttribute(pt,Cn),c.splitByTriangle(jR)}const on=c.triangles;for(let mn=0,cn=on.length;mn<cn;mn++){const un=on[mn],bn=gU(s,mU(un,at),o);if(bn!==QO){uS.getBarycoord(un.a,VR.a),uS.getBarycoord(un.b,VR.b),uS.getBarycoord(un.c,VR.c);const xn=bn===LR;Iz(_t,VR,h.geometry,h.matrixWorld,FR,It,et!==xn)}}}return gt.length}function _U(h,e,i,s,o,c,g=0){const b=h.matrixWorld.determinant()<0;A1.copy(e.matrixWorld).invert().multiply(h.matrixWorld),FR.getNormalMatrix(h.matrixWorld).multiplyScalar(b?-1:1);const et=e.geometry.boundsTree,tt=h.geometry.groupIndices,rt=h.geometry.index,st=h.geometry.attributes,at=st.position,ct=[],pt=h.geometry.halfEdges,gt=new Set;for(let At=0,xt=rt.count/3;At<xt;At++)At in i.intersectionSet||gt.add(At);for(;gt.size>0;){const At=Rz(gt);gt.delete(At),ct.push(At);const xt=3*At,yt=rt.getX(xt+0),_t=rt.getX(xt+1),Mt=rt.getX(xt+2);zR.a.fromBufferAttribute(at,yt).applyMatrix4(A1),zR.b.fromBufferAttribute(at,_t).applyMatrix4(A1),zR.c.fromBufferAttribute(at,Mt).applyMatrix4(A1);const It=gU(s,mU(zR,et),o);for(;ct.length>0;){const Bt=ct.pop(),Lt=g===-1?0:tt[Bt]+g,Ht=c.getGroupSet(Lt);for(let un=0;un<3;un++){const bn=pt.getSiblingTriangleIndex(Bt,un);bn!==-1&&gt.has(bn)&&(ct.push(bn),gt.delete(bn))}if(It===QO)continue;const Jt=3*Bt,sn=rt.getX(Jt+0),on=rt.getX(Jt+1),mn=rt.getX(Jt+2),cn=It===LR;Pz(sn,on,mn,st,h.matrixWorld,FR,Ht,cn!==b)}}}const yU=0,Dz=1,kz=2,XO=1.25,AU=1,YO=65535,Bz=Math.pow(2,-24);class GR{constructor(){}}function bA(h,e,i){return i.min.x=e[h],i.min.y=e[h+1],i.min.z=e[h+2],i.max.x=e[h+3],i.max.y=e[h+4],i.max.z=e[h+5],i}function bU(h){let e=-1,i=-1/0;for(let s=0;s<3;s++){const o=h[s+3]-h[s];o>i&&(i=o,e=s)}return e}function wU(h,e){e.set(h)}function xU(h,e,i){let s,o;for(let c=0;c<3;c++){const g=c+3;s=h[c],o=e[c],i[c]=s<o?s:o,s=h[g],o=e[g],i[g]=s>o?s:o}}function HR(h,e,i){for(let s=0;s<3;s++){const o=e[h+2*s],c=e[h+2*s+1],g=o-c,b=o+c;g<i[s]&&(i[s]=g),b>i[s+3]&&(i[s+3]=b)}}function II(h){const e=h[3]-h[0],i=h[4]-h[1],s=h[5]-h[2];return 2*(e*i+i*s+s*e)}function KO(h,e,i,s,o=null){let c=1/0,g=1/0,b=1/0,et=-1/0,tt=-1/0,rt=-1/0,st=1/0,at=1/0,ct=1/0,pt=-1/0,gt=-1/0,At=-1/0;const xt=o!==null;for(let yt=6*e,_t=6*(e+i);yt<_t;yt+=6){const Mt=h[yt+0],It=h[yt+1],Bt=Mt-It,Lt=Mt+It;Bt<c&&(c=Bt),Lt>et&&(et=Lt),xt&&Mt<st&&(st=Mt),xt&&Mt>pt&&(pt=Mt);const Ht=h[yt+2],Jt=h[yt+3],sn=Ht-Jt,on=Ht+Jt;sn<g&&(g=sn),on>tt&&(tt=on),xt&&Ht<at&&(at=Ht),xt&&Ht>gt&&(gt=Ht);const mn=h[yt+4],cn=h[yt+5],un=mn-cn,bn=mn+cn;un<b&&(b=un),bn>rt&&(rt=bn),xt&&mn<ct&&(ct=mn),xt&&mn>At&&(At=mn)}s[0]=c,s[1]=g,s[2]=b,s[3]=et,s[4]=tt,s[5]=rt,xt&&(o[0]=st,o[1]=at,o[2]=ct,o[3]=pt,o[4]=gt,o[5]=At)}const jw=32,Oz=(h,e)=>h.candidate-e.candidate,b1=new Array(jw).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),QR=new Float32Array(6);class wA{constructor(e,i,s){this.isOrientedBox=!0,this.min=new _.Pa4,this.max=new _.Pa4,this.matrix=new _.yGw,this.invMatrix=new _.yGw,this.points=new Array(8).fill().map(()=>new _.Pa4),this.satAxes=new Array(3).fill().map(()=>new _.Pa4),this.satBounds=new Array(3).fill().map(()=>new Lw),this.alignedSatBounds=new Array(3).fill().map(()=>new Lw),this.needsUpdate=!1,e&&this.min.copy(e),i&&this.max.copy(i),s&&this.matrix.copy(s)}set(e,i,s){this.min.copy(e),this.max.copy(i),this.matrix.copy(s),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}wA.prototype.update=function(){const h=this.matrix,e=this.min,i=this.max,s=this.points;for(let et=0;et<=1;et++)for(let tt=0;tt<=1;tt++)for(let rt=0;rt<=1;rt++){const st=s[1*et|2*tt|4*rt];st.x=et?i.x:e.x,st.y=tt?i.y:e.y,st.z=rt?i.z:e.z,st.applyMatrix4(h)}const o=this.satBounds,c=this.satAxes,g=s[0];for(let et=0;et<3;et++){const tt=c[et],rt=o[et],st=s[1<<et];tt.subVectors(g,st),rt.setFromPoints(tt,s)}const b=this.alignedSatBounds;b[0].setFromPointsField(s,"x"),b[1].setFromPointsField(s,"y"),b[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},wA.prototype.intersectsBox=function(){const h=new Lw;return function(e){this.needsUpdate&&this.update();const i=e.min,s=e.max,o=this.satBounds,c=this.satAxes,g=this.alignedSatBounds;if(h.min=i.x,h.max=s.x,g[0].isSeparated(h)||(h.min=i.y,h.max=s.y,g[1].isSeparated(h))||(h.min=i.z,h.max=s.z,g[2].isSeparated(h)))return!1;for(let b=0;b<3;b++){const et=c[b],tt=o[b];if(h.setFromBox(et,e),tt.isSeparated(h))return!1}return!0}}(),wA.prototype.intersectsTriangle=function(){const h=new AA,e=new Array(3),i=new Lw,s=new Lw,o=new _.Pa4;return function(c){this.needsUpdate&&this.update(),c.isExtendedTriangle?c.needsUpdate&&c.update():(h.copy(c),h.update(),c=h);const g=this.satBounds,b=this.satAxes;e[0]=c.a,e[1]=c.b,e[2]=c.c;for(let st=0;st<3;st++){const at=g[st],ct=b[st];if(i.setFromPoints(ct,e),at.isSeparated(i))return!1}const et=c.satBounds,tt=c.satAxes,rt=this.points;for(let st=0;st<3;st++){const at=et[st],ct=tt[st];if(i.setFromPoints(ct,rt),at.isSeparated(i))return!1}for(let st=0;st<3;st++){const at=b[st];for(let ct=0;ct<4;ct++){const pt=tt[ct];if(o.crossVectors(at,pt),i.setFromPoints(o,e),s.setFromPoints(o,rt),i.isSeparated(s))return!1}}return!0}}(),wA.prototype.closestPointToPoint=function(h,e){return this.needsUpdate&&this.update(),e.copy(h).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},wA.prototype.distanceToPoint=function(){const h=new _.Pa4;return function(e){return this.closestPointToPoint(e,h),e.distanceTo(h)}}(),wA.prototype.distanceToBox=function(){const h=["x","y","z"],e=new Array(12).fill().map(()=>new _.Zzh),i=new Array(12).fill().map(()=>new _.Zzh),s=new _.Pa4,o=new _.Pa4;return function(c,g=0,b=null,et=null){if(this.needsUpdate&&this.update(),this.intersectsBox(c))return(b||et)&&(c.getCenter(o),this.closestPointToPoint(o,s),c.closestPointToPoint(s,o),b&&b.copy(s),et&&et.copy(o)),0;const tt=g*g,rt=c.min,st=c.max,at=this.points;let ct=1/0;for(let gt=0;gt<8;gt++){const At=at[gt];o.copy(At).clamp(rt,st);const xt=At.distanceToSquared(o);if(xt<ct&&(ct=xt,b&&b.copy(At),et&&et.copy(o),xt<tt))return Math.sqrt(xt)}let pt=0;for(let gt=0;gt<3;gt++)for(let At=0;At<=1;At++)for(let xt=0;xt<=1;xt++){const yt=(gt+1)%3,_t=(gt+2)%3,Mt=1<<gt|At<<yt|xt<<_t,It=at[At<<yt|xt<<_t],Bt=at[Mt];e[pt].set(It,Bt);const Lt=h[gt],Ht=h[yt],Jt=h[_t],sn=i[pt],on=sn.start,mn=sn.end;on[Lt]=rt[Lt],on[Ht]=At?rt[Ht]:st[Ht],on[Jt]=xt?rt[Jt]:st[Ht],mn[Lt]=st[Lt],mn[Ht]=At?rt[Ht]:st[Ht],mn[Jt]=xt?rt[Jt]:st[Ht],pt++}for(let gt=0;gt<=1;gt++)for(let At=0;At<=1;At++)for(let xt=0;xt<=1;xt++){o.x=gt?st.x:rt.x,o.y=At?st.y:rt.y,o.z=xt?st.z:rt.z,this.closestPointToPoint(o,s);const yt=o.distanceToSquared(s);if(yt<ct&&(ct=yt,b&&b.copy(s),et&&et.copy(o),yt<tt))return Math.sqrt(yt)}for(let gt=0;gt<12;gt++){const At=e[gt];for(let xt=0;xt<12;xt++){const yt=i[xt];FO(At,yt,s,o);const _t=s.distanceToSquared(o);if(_t<ct&&(ct=_t,b&&b.copy(s),et&&et.copy(o),_t<tt))return Math.sqrt(_t)}}return Math.sqrt(ct)}}();const WR=new _.Pa4,qR=new _.Pa4,XR=new _.Pa4,EU=new _.FM8,SU=new _.FM8,CU=new _.FM8,MU=new _.Pa4;function TU(h,e,i,s,o){const c=3*s,g=h.index.getX(c),b=h.index.getX(c+1),et=h.index.getX(c+2),tt=function(rt,st,at,ct,pt,gt,At){WR.fromBufferAttribute(st,ct),qR.fromBufferAttribute(st,pt),XR.fromBufferAttribute(st,gt);const xt=function(yt,_t,Mt,It,Bt,Lt){let Ht;return Ht=Lt===_._Li?yt.intersectTriangle(It,Mt,_t,!0,Bt):yt.intersectTriangle(_t,Mt,It,Lt!==_.ehD,Bt),Ht===null?null:{distance:yt.origin.distanceTo(Bt),point:Bt.clone()}}(rt,WR,qR,XR,MU,At);if(xt){at&&(EU.fromBufferAttribute(at,ct),SU.fromBufferAttribute(at,pt),CU.fromBufferAttribute(at,gt),xt.uv=_.CJI.getUV(MU,WR,qR,XR,EU,SU,CU,new _.FM8));const yt={a:ct,b:pt,c:gt,normal:new _.Pa4,materialIndex:0};_.CJI.getNormal(WR,qR,XR,yt.normal),xt.face=yt,xt.faceIndex=ct}return xt}(i,h.attributes.position,h.attributes.uv,g,b,et,e);return tt?(tt.faceIndex=s,o&&o.push(tt),tt):null}function xA(h,e,i,s){const o=h.a,c=h.b,g=h.c;let b=e,et=e+1,tt=e+2;i&&(b=i.getX(e),et=i.getX(e+1),tt=i.getX(e+2)),o.x=s.getX(b),o.y=s.getY(b),o.z=s.getZ(b),c.x=s.getX(et),c.y=s.getY(et),c.z=s.getZ(et),g.x=s.getX(tt),g.y=s.getY(tt),g.z=s.getZ(tt)}function IU(h,e,i,s,o,c,g){const b=i.index,et=i.attributes.position;for(let tt=h,rt=e+h;tt<rt;tt++)if(xA(g,3*tt,b,et),g.needsUpdate=!0,s(g,tt,o,c))return!0;return!1}class PU{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function w1(h,e){return e[h+15]===65535}function _M(h,e){return e[h+6]}function PI(h,e){return e[h+14]}function RI(h){return h+8}function DI(h,e){return e[h+6]}const yM=new _.ZzF,YR=new _.Pa4,Lz=["x","y","z"];function JO(h,e,i,s,o){let c=2*h,g=AM,b=x1,et=E1;if(w1(c,b))(function(tt,rt,st,at,ct,pt){for(let gt=at,At=at+ct;gt<At;gt++)TU(tt,rt,st,gt,pt)})(e,i,s,_M(h,et),PI(c,b),o);else{const tt=RI(h);KR(tt,g,s,YR)&&JO(tt,e,i,s,o);const rt=DI(h,et);KR(rt,g,s,YR)&&JO(rt,e,i,s,o)}}function $O(h,e,i,s){let o=2*h,c=AM,g=x1,b=E1;if(w1(o,g))return function(et,tt,rt,st,at){let ct=1/0,pt=null;for(let gt=st,At=st+at;gt<At;gt++){const xt=TU(et,tt,rt,gt);xt&&xt.distance<ct&&(pt=xt,ct=xt.distance)}return pt}(e,i,s,_M(h,b),PI(o,g));{const et=function(gt,At){return At[gt+7]}(h,b),tt=Lz[et],rt=s.direction[tt]>=0;let st,at;rt?(st=RI(h),at=DI(h,b)):(st=DI(h,b),at=RI(h));const ct=KR(st,c,s,YR)?$O(st,e,i,s):null;if(ct){const gt=ct.point[tt];if(rt?gt<=c[at+et]:gt>=c[at+et+3])return ct}const pt=KR(at,c,s,YR)?$O(at,e,i,s):null;return ct&&pt?ct.distance<=pt.distance?ct:pt:ct||pt||null}}const Nz=function(){let h,e;const i=[],s=new PU(()=>new _.ZzF);return function(...c){h=s.getPrimitive(),e=s.getPrimitive(),i.push(h,e);const g=o(...c);s.releasePrimitive(h),s.releasePrimitive(e),i.pop(),i.pop();const b=i.length;return b>0&&(e=i[b-1],h=i[b-2]),g};function o(c,g,b,et,tt=null,rt=0,st=0){function at(yt){let _t=2*yt,Mt=x1,It=E1;for(;!w1(_t,Mt);)_t=2*(yt=RI(yt));return _M(yt,It)}function ct(yt){let _t=2*yt,Mt=x1,It=E1;for(;!w1(_t,Mt);)_t=2*(yt=DI(yt,It));return _M(yt,It)+PI(_t,Mt)}let pt=2*c,gt=AM,At=x1,xt=E1;if(w1(pt,At)){const yt=_M(c,xt),_t=PI(pt,At);return bA(c,gt,h),et(yt,_t,!1,st,rt+c,h)}{const yt=RI(c),_t=DI(c,xt);let Mt,It,Bt,Lt,Ht=yt,Jt=_t;if(tt&&(Bt=h,Lt=e,bA(Ht,gt,Bt),bA(Jt,gt,Lt),Mt=tt(Bt),It=tt(Lt),It<Mt)){Ht=_t,Jt=yt;const un=Mt;Mt=It,It=un,Bt=Lt}Bt||(Bt=h,bA(Ht,gt,Bt));const sn=b(Bt,w1(2*Ht,At),Mt,st+1,rt+Ht);let on;if(sn===2){const un=at(Ht);on=et(un,ct(Ht)-un,!0,st+1,rt+Ht,Bt)}else on=sn&&o(Ht,g,b,et,tt,rt,st+1);if(on)return!0;Lt=e,bA(Jt,gt,Lt);const mn=b(Lt,w1(2*Jt,At),It,st+1,rt+Jt);let cn;if(mn===2){const un=at(Jt);cn=et(un,ct(Jt)-un,!0,st+1,rt+Jt,Lt)}else cn=mn&&o(Jt,g,b,et,tt,rt,st+1);return!!cn}}}(),Uz=function(){const h=new AA,e=new AA,i=new _.yGw,s=new wA,o=new wA;return function c(g,b,et,tt,rt=null){let st=2*g,at=AM,ct=x1,pt=E1;if(rt===null&&(et.boundingBox||et.computeBoundingBox(),s.set(et.boundingBox.min,et.boundingBox.max,tt),rt=s),!w1(st,ct)){const gt=g+8,At=pt[g+6];return bA(gt,at,yM),rt.intersectsBox(yM)&&c(gt,b,et,tt,rt)?!0:(bA(At,at,yM),!(!rt.intersectsBox(yM)||!c(At,b,et,tt,rt)))}{const gt=b,At=gt.index,xt=gt.attributes.position,yt=et.index,_t=et.attributes.position,Mt=_M(g,pt),It=PI(st,ct);if(i.copy(tt).invert(),et.boundsTree)return bA(g,at,o),o.matrix.copy(i),o.needsUpdate=!0,et.boundsTree.shapecast({intersectsBounds:Lt=>o.intersectsBox(Lt),intersectsTriangle:Lt=>{Lt.a.applyMatrix4(tt),Lt.b.applyMatrix4(tt),Lt.c.applyMatrix4(tt),Lt.needsUpdate=!0;for(let Ht=3*Mt,Jt=3*(It+Mt);Ht<Jt;Ht+=3)if(xA(e,Ht,At,xt),e.needsUpdate=!0,Lt.intersectsTriangle(e))return!0;return!1}});for(let Bt=3*Mt,Lt=It+3*Mt;Bt<Lt;Bt+=3){xA(h,Bt,At,xt),h.a.applyMatrix4(i),h.b.applyMatrix4(i),h.c.applyMatrix4(i),h.needsUpdate=!0;for(let Ht=0,Jt=yt.count;Ht<Jt;Ht+=3)if(xA(e,Ht,yt,_t),e.needsUpdate=!0,h.intersectsTriangle(e))return!0}}}}();function KR(h,e,i,s){return bA(h,e,yM),i.intersectBox(yM,s)}const ZO=[];let JR,AM,x1,E1;function kI(h){JR&&ZO.push(JR),JR=h,AM=new Float32Array(h),x1=new Uint16Array(h),E1=new Uint32Array(h)}function $R(){JR=null,AM=null,x1=null,E1=null,ZO.length&&kI(ZO.pop())}const eL=Symbol("skip tree generation"),tL=new _.ZzF,nL=new _.ZzF,bM=new _.yGw,hS=new wA,BI=new wA,OI=new _.Pa4,ZR=new _.Pa4,Fz=new _.Pa4,jz=new _.Pa4,zz=new _.Pa4,RU=new _.ZzF,EA=new PU(()=>new AA);class LI{static serialize(e,i={}){if(i.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),LI.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});i={cloneBuffers:!0,...i};const s=e.geometry,o=e._roots,c=s.getIndex();let g;return g=i.cloneBuffers?{roots:o.map(b=>b.slice()),index:c.array.slice()}:{roots:o,index:c.array},g}static deserialize(e,i,s={}){if(typeof s=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),LI.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});s={setIndex:!0,...s};const{index:o,roots:c}=e,g=new LI(i,{...s,[eL]:!0});if(g._roots=c,s.setIndex){const b=i.getIndex();if(b===null){const et=new _.TlE(e.index,1,!1);i.setIndex(et)}else b.array!==o&&(b.array.set(o),b.needsUpdate=!0)}return g}constructor(e,i={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((i=Object.assign({strategy:yU,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[eL]:!1},i)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,i[eL]||(this._roots=function(s,o){const c=function(ct,pt){function gt(un){Jt&&Jt(un/sn)}function At(un,bn,xn,Cn=null,Jn=0){if(!on&&Jn>=It&&(on=!0,Bt&&(console.warn(`MeshBVH: Max depth of ${It} reached when generating BVH. Consider increasing maxDepth.`),console.warn(ct))),xn<=Lt||Jn>=It)return gt(bn+xn),un.offset=bn,un.count=xn,un;const Kn=function(nr,tr,Cr,Ar,Hr,Jr){let cs=-1,Os=0;if(Jr===yU)cs=bU(tr),cs!==-1&&(Os=(tr[cs]+tr[cs+3])/2);else if(Jr===Dz)cs=bU(nr),cs!==-1&&(Os=function(Ss,Ts,pr,Pr){let qr=0;for(let Xs=Ts,po=Ts+pr;Xs<po;Xs++)qr+=Ss[6*Xs+2*Pr];return qr/pr}(Cr,Ar,Hr,cs));else if(Jr===kz){const Ss=II(nr);let Ts=XO*Hr;const pr=6*Ar,Pr=6*(Ar+Hr);for(let qr=0;qr<3;qr++){const Xs=tr[qr],po=(tr[qr+3]-Xs)/jw;if(Hr<jw/4){const eo=[...b1];eo.length=Hr;let Qs=0;for(let _s=pr;_s<Pr;_s+=6,Qs++){const ar=eo[Qs];ar.candidate=Cr[_s+2*qr],ar.count=0;const{bounds:Wr,leftCacheBounds:bs,rightCacheBounds:Or}=ar;for(let Us=0;Us<3;Us++)Or[Us]=1/0,Or[Us+3]=-1/0,bs[Us]=1/0,bs[Us+3]=-1/0,Wr[Us]=1/0,Wr[Us+3]=-1/0;HR(_s,Cr,Wr)}eo.sort(Oz);let Ws=Hr;for(let _s=0;_s<Ws;_s++){const ar=eo[_s];for(;_s+1<Ws&&eo[_s+1].candidate===ar.candidate;)eo.splice(_s+1,1),Ws--}for(let _s=pr;_s<Pr;_s+=6){const ar=Cr[_s+2*qr];for(let Wr=0;Wr<Ws;Wr++){const bs=eo[Wr];ar>=bs.candidate?HR(_s,Cr,bs.rightCacheBounds):(HR(_s,Cr,bs.leftCacheBounds),bs.count++)}}for(let _s=0;_s<Ws;_s++){const ar=eo[_s],Wr=ar.count,bs=Hr-ar.count,Or=ar.leftCacheBounds,Us=ar.rightCacheBounds;let Gl=0;Wr!==0&&(Gl=II(Or)/Ss);let lu=0;bs!==0&&(lu=II(Us)/Ss);const Gu=AU+XO*(Gl*Wr+lu*bs);Gu<Ts&&(cs=qr,Ts=Gu,Os=ar.candidate)}}else{for(let Ws=0;Ws<jw;Ws++){const _s=b1[Ws];_s.count=0,_s.candidate=Xs+po+Ws*po;const ar=_s.bounds;for(let Wr=0;Wr<3;Wr++)ar[Wr]=1/0,ar[Wr+3]=-1/0}for(let Ws=pr;Ws<Pr;Ws+=6){let _s=~~((Cr[Ws+2*qr]-Xs)/po);_s>=jw&&(_s=jw-1);const ar=b1[_s];ar.count++,HR(Ws,Cr,ar.bounds)}const eo=b1[jw-1];wU(eo.bounds,eo.rightCacheBounds);for(let Ws=jw-2;Ws>=0;Ws--){const _s=b1[Ws],ar=b1[Ws+1];xU(_s.bounds,ar.rightCacheBounds,_s.rightCacheBounds)}let Qs=0;for(let Ws=0;Ws<jw-1;Ws++){const _s=b1[Ws],ar=_s.count,Wr=_s.bounds,bs=b1[Ws+1].rightCacheBounds;ar!==0&&(Qs===0?wU(Wr,QR):xU(Wr,QR,QR)),Qs+=ar;let Or=0,Us=0;Qs!==0&&(Or=II(QR)/Ss);const Gl=Hr-Qs;Gl!==0&&(Us=II(bs)/Ss);const lu=AU+XO*(Or*Qs+Us*Gl);lu<Ts&&(cs=qr,Ts=lu,Os=_s.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${Jr} used.`);return{axis:cs,pos:Os}}(un.boundingData,Cn,_t,bn,xn,Ht);if(Kn.axis===-1)return gt(bn+xn),un.offset=bn,un.count=xn,un;const gr=function(nr,tr,Cr,Ar,Hr){let Jr=Cr,cs=Cr+Ar-1;const Os=Hr.pos,Ss=2*Hr.axis;for(;;){for(;Jr<=cs&&tr[6*Jr+Ss]<Os;)Jr++;for(;Jr<=cs&&tr[6*cs+Ss]>=Os;)cs--;if(!(Jr<cs))return Jr;for(let Ts=0;Ts<3;Ts++){let pr=nr[3*Jr+Ts];nr[3*Jr+Ts]=nr[3*cs+Ts],nr[3*cs+Ts]=pr;let Pr=tr[6*Jr+2*Ts+0];tr[6*Jr+2*Ts+0]=tr[6*cs+2*Ts+0],tr[6*cs+2*Ts+0]=Pr;let qr=tr[6*Jr+2*Ts+1];tr[6*Jr+2*Ts+1]=tr[6*cs+2*Ts+1],tr[6*cs+2*Ts+1]=qr}Jr++,cs--}}(Mt,_t,bn,xn,Kn);if(gr===bn||gr===bn+xn)gt(bn+xn),un.offset=bn,un.count=xn;else{un.splitAxis=Kn.axis;const nr=new GR,tr=bn,Cr=gr-bn;un.left=nr,nr.boundingData=new Float32Array(6),KO(_t,tr,Cr,nr.boundingData,yt),At(nr,tr,Cr,yt,Jn+1);const Ar=new GR,Hr=gr,Jr=xn-Cr;un.right=Ar,Ar.boundingData=new Float32Array(6),KO(_t,Hr,Jr,Ar.boundingData,yt),At(Ar,Hr,Jr,yt,Jn+1)}return un}(function(un,bn){if(!un.index){const xn=un.attributes.position.count,Cn=bn.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let Jn;Jn=xn>65535?new Uint32Array(new Cn(4*xn)):new Uint16Array(new Cn(2*xn)),un.setIndex(new _.TlE(Jn,1));for(let Kn=0;Kn<xn;Kn++)Jn[Kn]=Kn}})(ct,pt);const xt=new Float32Array(6),yt=new Float32Array(6),_t=function(un,bn){const xn=un.attributes.position,Cn=un.index.array,Jn=Cn.length/3,Kn=new Float32Array(6*Jn),gr=xn.normalized,nr=xn.array,tr=xn.offset||0;let Cr=3;xn.isInterleavedBufferAttribute&&(Cr=xn.data.stride);const Ar=["getX","getY","getZ"];for(let Hr=0;Hr<Jn;Hr++){const Jr=3*Hr,cs=6*Hr;let Os,Ss,Ts;gr?(Os=Cn[Jr+0],Ss=Cn[Jr+1],Ts=Cn[Jr+2]):(Os=Cn[Jr+0]*Cr+tr,Ss=Cn[Jr+1]*Cr+tr,Ts=Cn[Jr+2]*Cr+tr);for(let pr=0;pr<3;pr++){let Pr,qr,Xs;gr?(Pr=xn[Ar[pr]](Os),qr=xn[Ar[pr]](Ss),Xs=xn[Ar[pr]](Ts)):(Pr=nr[Os+pr],qr=nr[Ss+pr],Xs=nr[Ts+pr]);let po=Pr;qr<po&&(po=qr),Xs<po&&(po=Xs);let eo=Pr;qr>eo&&(eo=qr),Xs>eo&&(eo=Xs);const Qs=(eo-po)/2,Ws=2*pr;Kn[cs+Ws+0]=po+Qs,Kn[cs+Ws+1]=Qs+(Math.abs(po)+Qs)*Bz,po<bn[pr]&&(bn[pr]=po),eo>bn[pr+3]&&(bn[pr+3]=eo)}}return Kn}(ct,xt),Mt=ct.index.array,It=pt.maxDepth,Bt=pt.verbose,Lt=pt.maxLeafTris,Ht=pt.strategy,Jt=pt.onProgress,sn=ct.index.count/3;let on=!1;const mn=[],cn=function(un){if(!un.groups||!un.groups.length)return[{offset:0,count:un.index.count/3}];const bn=[],xn=new Set;for(const Jn of un.groups)xn.add(Jn.start),xn.add(Jn.start+Jn.count);const Cn=Array.from(xn.values()).sort((Jn,Kn)=>Jn-Kn);for(let Jn=0;Jn<Cn.length-1;Jn++){const Kn=Cn[Jn],gr=Cn[Jn+1];bn.push({offset:Kn/3,count:(gr-Kn)/3})}return bn}(ct);if(cn.length===1){const un=cn[0],bn=new GR;bn.boundingData=xt,function(xn,Cn,Jn,Kn){let gr=1/0,nr=1/0,tr=1/0,Cr=-1/0,Ar=-1/0,Hr=-1/0;for(let Jr=6*Cn,cs=6*(Cn+Jn);Jr<cs;Jr+=6){const Os=xn[Jr+0];Os<gr&&(gr=Os),Os>Cr&&(Cr=Os);const Ss=xn[Jr+2];Ss<nr&&(nr=Ss),Ss>Ar&&(Ar=Ss);const Ts=xn[Jr+4];Ts<tr&&(tr=Ts),Ts>Hr&&(Hr=Ts)}Kn[0]=gr,Kn[1]=nr,Kn[2]=tr,Kn[3]=Cr,Kn[4]=Ar,Kn[5]=Hr}(_t,un.offset,un.count,yt),At(bn,un.offset,un.count,yt),mn.push(bn)}else for(let un of cn){const bn=new GR;bn.boundingData=new Float32Array(6),KO(_t,un.offset,un.count,bn.boundingData,yt),At(bn,un.offset,un.count,yt),mn.push(bn)}return mn}(s,o);let g,b,et;const tt=[],rt=o.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let ct=0;ct<c.length;ct++){const pt=c[ct],gt=new rt(32*st(pt));g=new Float32Array(gt),b=new Uint32Array(gt),et=new Uint16Array(gt),at(0,pt),tt.push(gt)}return tt;function st(ct){return ct.count?1:1+st(ct.left)+st(ct.right)}function at(ct,pt){const gt=ct/4,At=ct/2,xt=!!pt.count,yt=pt.boundingData;for(let _t=0;_t<6;_t++)g[gt+_t]=yt[_t];if(xt){const _t=pt.offset,Mt=pt.count;return b[gt+6]=_t,et[At+14]=Mt,et[At+15]=YO,ct+32}{const _t=pt.left,Mt=pt.right,It=pt.splitAxis;let Bt;if(Bt=at(ct+32,_t),Bt/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return b[gt+6]=Bt/4,Bt=at(Bt,Mt),b[gt+7]=It,Bt}}}(e,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new _.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=this.geometry,s=i.index.array,o=i.attributes.position;let c,g,b,et,tt=0;const rt=this._roots;for(let at=0,ct=rt.length;at<ct;at++)c=rt[at],g=new Uint32Array(c),b=new Uint16Array(c),et=new Float32Array(c),st(0,tt),tt+=c.byteLength;function st(at,ct,pt=!1){const gt=2*at;if(b[gt+15]===YO){const At=g[at+6];let xt=1/0,yt=1/0,_t=1/0,Mt=-1/0,It=-1/0,Bt=-1/0;for(let Lt=3*At,Ht=3*(At+b[gt+14]);Lt<Ht;Lt++){const Jt=s[Lt],sn=o.getX(Jt),on=o.getY(Jt),mn=o.getZ(Jt);sn<xt&&(xt=sn),sn>Mt&&(Mt=sn),on<yt&&(yt=on),on>It&&(It=on),mn<_t&&(_t=mn),mn>Bt&&(Bt=mn)}return(et[at+0]!==xt||et[at+1]!==yt||et[at+2]!==_t||et[at+3]!==Mt||et[at+4]!==It||et[at+5]!==Bt)&&(et[at+0]=xt,et[at+1]=yt,et[at+2]=_t,et[at+3]=Mt,et[at+4]=It,et[at+5]=Bt,!0)}{const At=at+8,xt=g[at+6],yt=At+ct,_t=xt+ct;let Mt=pt,It=!1,Bt=!1;e?Mt||(It=e.has(yt),Bt=e.has(_t),Mt=!It&&!Bt):(It=!0,Bt=!0);const Lt=Mt||Bt;let Ht=!1;(Mt||It)&&(Ht=st(At,ct,Mt));let Jt=!1;Lt&&(Jt=st(xt,ct,Mt));const sn=Ht||Jt;if(sn)for(let on=0;on<3;on++){const mn=At+on,cn=xt+on,un=et[mn],bn=et[mn+3],xn=et[cn],Cn=et[cn+3];et[at+on]=un<xn?un:xn,et[at+on+3]=bn>Cn?bn:Cn}return sn}}}traverse(e,i=0){const s=this._roots[i],o=new Uint32Array(s),c=new Uint16Array(s);(function g(b,et=0){const tt=2*b,rt=c[tt+15]===YO;if(rt){const st=o[b+6],at=c[tt+14];e(et,rt,new Float32Array(s,4*b,6),st,at)}else{const st=b+8,at=o[b+6],ct=o[b+7];e(et,rt,new Float32Array(s,4*b,6),ct)||(g(st,et+1),g(at,et+1))}})(0)}raycast(e,i=_.Wl3){const s=this._roots,o=this.geometry,c=[],g=i.isMaterial,b=Array.isArray(i),et=o.groups,tt=g?i.side:i;for(let rt=0,st=s.length;rt<st;rt++){const at=b?i[et[rt].materialIndex].side:tt,ct=c.length;if(kI(s[rt]),JO(0,o,at,e,c),$R(),b){const pt=et[rt].materialIndex;for(let gt=ct,At=c.length;gt<At;gt++)c[gt].face.materialIndex=pt}}return c}raycastFirst(e,i=_.Wl3){const s=this._roots,o=this.geometry,c=i.isMaterial,g=Array.isArray(i);let b=null;const et=o.groups,tt=c?i.side:i;for(let rt=0,st=s.length;rt<st;rt++){const at=g?i[et[rt].materialIndex].side:tt;kI(s[rt]);const ct=$O(0,o,at,e);$R(),ct!=null&&(b==null||ct.distance<b.distance)&&(b=ct,g&&(ct.face.materialIndex=et[rt].materialIndex))}return b}intersectsGeometry(e,i){const s=this.geometry;let o=!1;for(const c of this._roots)if(kI(c),o=Uz(0,s,e,i),$R(),o)break;return o}shapecast(e,i,s){const o=this.geometry;if(e instanceof Function){if(i){const at=i;i=(ct,pt,gt,At)=>{const xt=3*pt;return at(ct,xt,xt+1,xt+2,gt,At)}}e={boundsTraverseOrder:s,intersectsBounds:e,intersectsTriangle:i,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const c=EA.getPrimitive();let{boundsTraverseOrder:g,intersectsBounds:b,intersectsRange:et,intersectsTriangle:tt}=e;if(et&&tt){const at=et;et=(ct,pt,gt,At,xt)=>!!at(ct,pt,gt,At,xt)||IU(ct,pt,o,tt,gt,At,c)}else et||(et=tt?(at,ct,pt,gt)=>IU(at,ct,o,tt,pt,gt,c):(at,ct,pt)=>pt);let rt=!1,st=0;for(const at of this._roots){if(kI(at),rt=Nz(0,o,b,et,g,st),$R(),rt)break;st+=at.byteLength}return EA.releasePrimitive(c),rt}bvhcast(e,i,s){let{intersectsRanges:o,intersectsTriangles:c}=s;const g=this.geometry.index,b=this.geometry.attributes.position,et=e.geometry.index,tt=e.geometry.attributes.position;bM.copy(i).invert();const rt=EA.getPrimitive(),st=EA.getPrimitive();if(c){let ct=function(pt,gt,At,xt,yt,_t,Mt,It){for(let Bt=At,Lt=At+xt;Bt<Lt;Bt++){xA(st,3*Bt,et,tt),st.a.applyMatrix4(i),st.b.applyMatrix4(i),st.c.applyMatrix4(i),st.needsUpdate=!0;for(let Ht=pt,Jt=pt+gt;Ht<Jt;Ht++)if(xA(rt,3*Ht,g,b),rt.needsUpdate=!0,c(rt,st,Ht,Bt,yt,_t,Mt,It))return!0}return!1};if(o){const pt=o;o=function(gt,At,xt,yt,_t,Mt,It,Bt){return!!pt(gt,At,xt,yt,_t,Mt,It,Bt)||ct(gt,At,xt,yt,_t,Mt,It,Bt)}}else o=ct}e.getBoundingBox(nL),nL.applyMatrix4(i);const at=this.shapecast({intersectsBounds:ct=>nL.intersectsBox(ct),intersectsRange:(ct,pt,gt,At,xt,yt)=>(tL.copy(yt),tL.applyMatrix4(bM),e.shapecast({intersectsBounds:_t=>tL.intersectsBox(_t),intersectsRange:(_t,Mt,It,Bt,Lt)=>o(ct,pt,_t,Mt,At,xt,Bt,Lt)}))});return EA.releasePrimitive(rt),EA.releasePrimitive(st),at}intersectsBox(e,i){return hS.set(e.min,e.max,i),hS.needsUpdate=!0,this.shapecast({intersectsBounds:s=>hS.intersectsBox(s),intersectsTriangle:s=>hS.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:i=>e.intersectsBox(i),intersectsTriangle:i=>i.intersectsSphere(e)})}closestPointToGeometry(e,i,s={},o={},c=0,g=1/0){e.boundingBox||e.computeBoundingBox(),hS.set(e.boundingBox.min,e.boundingBox.max,i),hS.needsUpdate=!0;const b=this.geometry,et=b.attributes.position,tt=b.index,rt=e.attributes.position,st=e.index,at=EA.getPrimitive(),ct=EA.getPrimitive();let pt=ZR,gt=Fz,At=null,xt=null;o&&(At=jz,xt=zz);let yt=1/0,_t=null,Mt=null;return bM.copy(i).invert(),BI.matrix.copy(bM),this.shapecast({boundsTraverseOrder:It=>hS.distanceToBox(It),intersectsBounds:(It,Bt,Lt)=>Lt<yt&&Lt<g&&(Bt&&(BI.min.copy(It.min),BI.max.copy(It.max),BI.needsUpdate=!0),!0),intersectsRange:(It,Bt)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:Lt=>BI.distanceToBox(Lt),intersectsBounds:(Lt,Ht,Jt)=>Jt<yt&&Jt<g,intersectsRange:(Lt,Ht)=>{for(let Jt=3*Lt,sn=3*(Lt+Ht);Jt<sn;Jt+=3){xA(ct,Jt,st,rt),ct.a.applyMatrix4(i),ct.b.applyMatrix4(i),ct.c.applyMatrix4(i),ct.needsUpdate=!0;for(let on=3*It,mn=3*(It+Bt);on<mn;on+=3){xA(at,on,tt,et),at.needsUpdate=!0;const cn=at.distanceToTriangle(ct,pt,At);if(cn<yt&&(gt.copy(pt),xt&&xt.copy(At),yt=cn,_t=on/3,Mt=Jt/3),cn<c)return!0}}}});for(let Lt=0,Ht=st?st.count:rt.count;Lt<Ht;Lt+=3){xA(ct,Lt,st,rt),ct.a.applyMatrix4(i),ct.b.applyMatrix4(i),ct.c.applyMatrix4(i),ct.needsUpdate=!0;for(let Jt=3*It,sn=3*(It+Bt);Jt<sn;Jt+=3){xA(at,Jt,tt,et),at.needsUpdate=!0;const on=at.distanceToTriangle(ct,pt,At);if(on<yt&&(gt.copy(pt),xt&&xt.copy(At),yt=on,_t=Jt/3,Mt=Lt/3),on<c)return!0}}}}),EA.releasePrimitive(at),EA.releasePrimitive(ct),yt===1/0?null:(s.point?s.point.copy(gt):s.point=gt.clone(),s.distance=yt,s.faceIndex=_t,o&&(o.point?o.point.copy(xt):o.point=xt.clone(),o.point.applyMatrix4(bM),gt.applyMatrix4(bM),o.distance=gt.sub(o.point).length(),o.faceIndex=Mt),s)}closestPointToPoint(e,i={},s=0,o=1/0){const c=s*s,g=o*o;let b=1/0,et=null;if(this.shapecast({boundsTraverseOrder:rt=>(OI.copy(e).clamp(rt.min,rt.max),OI.distanceToSquared(e)),intersectsBounds:(rt,st,at)=>at<b&&at<g,intersectsTriangle:(rt,st)=>{rt.closestPointToPoint(e,OI);const at=e.distanceToSquared(OI);return at<b&&(ZR.copy(OI),b=at,et=st),at<c}}),b===1/0)return null;const tt=Math.sqrt(b);return i.point?i.point.copy(ZR):i.point=ZR.clone(),i.distance=tt,i.faceIndex=et,i}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{bA(0,new Float32Array(i),RU),e.union(RU)}),e}}const Vz=1e6*(1+1e-7);function iL(h){return~~(h*Vz)}function DU(h){return`${iL(h.x)},${iL(h.y)},${iL(h.z)}`}const rL=[new _.Pa4,new _.Pa4,new _.Pa4];class Gz{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:~~(s/3)}getSiblingEdgeIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:s%3}updateFrom(e){const i=new Map,{attributes:s}=e,o=e.index,c=s.position;let g=o?o.count/3:c.count/3;const b=g;let et=0;this.useDrawRange&&(et=e.drawRange.start,e.drawRange.count!==1/0&&(g=~~(e.drawRange.count/3)));let tt=this.data;(!tt||tt.length<3*b)&&(tt=new Int32Array(3*b)),tt.fill(-1);let rt=0,st=0;for(let at=0;at<g;at++){const ct=3*at+et;for(let pt=0;pt<3;pt++){let gt=ct+pt;o&&(gt=o.getX(gt)),rL[pt].fromBufferAttribute(c,gt)}for(let pt=0;pt<3;pt++){const gt=(pt+1)%3,At=rL[pt],xt=rL[gt],yt=DU(At),_t=DU(xt),Mt=`${_t}_${yt}`;if(i.has(Mt)){const It=i.get(Mt);tt[ct+pt]=It,tt[It]=ct+pt,i.delete(Mt),rt--,st++}else{const It=`${yt}_${_t}`;i.set(It,ct+pt),rt++}}}this.matchedEdges=st,this.unmatchedEdges=rt,this.data=tt}}class eD extends _.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new _.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:i}=this,s=e.elements,o=i.elements;for(let c=0;c<16;c++)if(s[c]!==o[c])return!0;return!1}prepareGeometry(){const e=this.geometry,i=e.attributes;if(sU())for(const s in i){const o=i[s];if(o.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");o.array=Ez(o.array)}if(e.boundsTree||(e.boundsTree=new LI(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new Gz(e)),!e.groupIndices){const s=e.index.count/3,o=new Uint16Array(s),c=e.groups;for(let g=0,b=c.length;g<b;g++){const{start:et,count:tt}=c[g];for(let rt=et/3,st=(et+tt)/3;rt<st;rt++)o[rt]=g}e.groupIndices=o}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function kU(h,e){let i=e;return Array.isArray(e)||(i=[],h.forEach(s=>{i[s.materialIndex]=e})),i}class Hz{constructor(){this.triangleSplitter=new xz,this.attributeData=new Sz,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new Mz}evaluate(e,i,s,o=new eD){e.prepareGeometry(),i.prepareGeometry();const{triangleSplitter:c,attributeData:g,attributes:b,useGroups:et,debug:tt}=this,rt=o.geometry,st=e.geometry.attributes;for(let xt=0,yt=b.length;xt<yt;xt++){const _t=b[xt],Mt=st[_t];g.initializeArray(_t,Mt.array.constructor)}for(const xt in g.attributes)b.includes(xt)||g.delete(xt);for(const xt in rt.attributes)b.includes(xt)||(rt.deleteAttribute(xt),rt.dispose());g.clear(),tt.enabled&&(tt.reset(),fU(tt)),function(xt,yt,_t,Mt,It,Bt){const{useGroups:Lt=!0}=Bt,{aIntersections:Ht,bIntersections:Jt}=function(on,mn){const cn=new lU,un=new lU;return cU.copy(on.matrixWorld).invert().multiply(mn.matrixWorld),on.geometry.boundsTree.bvhcast(mn.geometry.boundsTree,cU,{intersectsTriangles(bn,xn,Cn,Jn){if(bn.intersectsTriangle(xn,zO,!0)){if(zO.distanceSq()===0&&bn.plane.normal.dot(xn.plane.normal)<1-1e-10)return!1;cn.add(Cn,Jn),un.add(Jn,Cn),UR&&(UR.addEdge(zO),UR.addIntersectingTriangles(Cn,bn,Jn,xn))}return!1}}),{aIntersections:cn,bIntersections:un}}(xt,yt);let sn;sn=Lt?0:-1,_U(xt,yt,Ht,_t,!1,It,sn),vU(xt,yt,Ht,_t,!1,Mt,It,sn),sn=Lt?xt.geometry.groups.length||1:-1,_U(yt,xt,Jt,_t,!0,It,sn),vU(yt,xt,Jt,_t,!0,Mt,It,sn)}(e,i,s,c,g,{useGroups:et}),tt.enabled&&fU(null);const at=et&&e.geometry.groups.length!==0?e.geometry.groups.map(xt=>({...xt})):[{start:0,count:1/0,materialIndex:0}],ct=et&&i.geometry.groups.length!==0?i.geometry.groups.map(xt=>({...xt})):[{start:0,count:1/0,materialIndex:0}],pt=kU(at,e.material),gt=kU(ct,i.material);ct.forEach(xt=>{xt.materialIndex+=pt.length}),function(xt,yt,_t,Mt){let It=!1,Bt=-1;const Lt=Mt.groupCount,Ht=xt.attributes,Jt=Mt.groupAttributes[0];for(const on in Jt){const mn=Mt.getTotalLength(on,Lt),cn=Jt[on].type;let un=Ht[on];if(!un||un.array.length<mn){const xn=yt.attributes[on];un=new _.TlE(new cn(mn),xn.itemSize,xn.normalized),xt.setAttribute(on,un),It=!0}let bn=0;for(let xn=0;xn<Lt;xn++){const{array:Cn,type:Jn,length:Kn}=Mt.groupAttributes[xn][on],gr=new Jn(Cn.buffer,0,Kn);un.array.set(gr,bn),bn+=gr.length}un.needsUpdate=!0,Bt=mn/un.itemSize}xt.setDrawRange(0,Bt),xt.clearGroups();let sn=0;for(let on=0;on<Lt;on++){const mn=Mt.getGroupArray("position",on).length/3;if(mn!==0){const cn=_t[on];xt.addGroup(sn,mn,cn.materialIndex),sn+=mn}}if(xt.index){const on=xt.index.array;if(on.length<Bt)xt.index=null,It=!0;else for(let mn=0,cn=on.length;mn<cn;mn++)on[mn]=mn}xt.boundsTree=null,It&&xt.dispose()}(rt,e.geometry,[...at,...ct],g);const At=rt.groups;if(et){const xt=new Map,yt=[...pt,...gt];let _t=0;for(let Mt=0,It=yt.length;Mt<It;Mt++)At.find(Bt=>Bt.materialIndex===Mt)?(xt.set(Mt,_t),_t++):yt[Mt]=null;for(let Mt=0,It=At.length;Mt<It;Mt++){const Bt=At[Mt];Bt.materialIndex=xt.get(Bt.materialIndex)}o.material=yt.filter(Mt=>Mt)}return o}evaluateHierarchy(e,i=new eD){e.updateMatrixWorld(!0);const s=(c,g)=>{const b=c.children;for(let et=0,tt=b.length;et<tt;et++){const rt=b[et];rt.isOperationGroup?s(rt,g):g(rt)}},o=c=>{const g=c.children;let b=!1;for(let tt=0,rt=g.length;tt<rt;tt++){const st=g[tt];b=o(st)||b}const et=c.isDirty();if(et&&c.markUpdated(),b&&!c.isOperationGroup){let tt;return s(c,rt=>{tt=tt?this.evaluate(tt,rt,rt.operation):this.evaluate(c,rt,rt.operation)}),c._cachedGeometry=tt.geometry,c._cachedMaterials=tt.material,!0}return b||et};return o(e),i.geometry=e._cachedGeometry,i.material=e._cachedMaterials,i}reset(){this.triangleSplitter.reset()}}const BU={union:eU,subtract:tU,intersect:iU,difference:nU};function OU(h,e){const i=new Hz;i.useGroups=!0,i.attributes=["position","normal","uv"],h.forEach(c=>{for(const g of[...i.attributes])c[0].geometry.getAttribute(g)||i.attributes.splice(i.attributes.indexOf(g),1)});let s=new eD(new _._12(.01,.01,2,2));h.forEach(([c,g])=>{if(!Object.keys(BU).includes(g))return void console.error(`Unknown operation ${g}`);c.updateMatrix(),c.updateMatrixWorld();const b=new eD;b.geometry=c.geometry,b.material=c.material,c.matrixWorld.decompose(b.position,b.quaternion,b.scale),b.updateMatrix(),b.updateMatrixWorld(),s=i.evaluate(s,b,BU[g])});const o=s;return o.userData._isCSGMesh=!0,o}let NI=class extends Ow{_buildCSGMesh(h){return OU(h)}};NI.PluginType="CSGPluginBVH",NI=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g}([Ms("CSG Plugin (BVH)")],NI);class tD extends hs{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var i,s,o,c;(s=(i=e.lastCamera)==null?void 0:i.removeControlsCtor)==null||s.call(i,this.controlsKey),(c=(o=e.camera)==null?void 0:o.setControlsCtor)==null||c.call(o,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}var LU=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};const Qz=new _.Pa4(0,0,1),NU=new _.USm,Wz=new _._fP,qz=new _._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),wM=new _._fP,Xz={type:"change"};let UI=class extends _e.SimpleEventDispatcher{constructor(h){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new _._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new _._fP,this._initQuaternionInvert=new _._fP,this._initQuaternionDest=new _._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=h,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(h=>{h=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(h=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",h)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new _._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const h=this.deviceOrientation;if(h){const e=h.alpha!==null?_.M8C.degToRad(h.alpha):0,i=h.beta!==null?_.M8C.degToRad(h.beta):0,s=h.gamma!==null?_.M8C.degToRad(h.gamma):0,o=this.screenOrientation?_.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,i,s,o),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(Xz))}}dispose(){this.disconnect()}setObjectQuaternion(h,e,i,s){const o=(0,_e.now)()/1e3;NU.set(e,h,-i,"YXZ"),wM.setFromEuler(NU),wM.multiply(qz),wM.multiply(Wz.setFromAxisAngle(Qz,-s)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(wM).invert(),this._initQuaternionDest.__init=!0),wM.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(wM,this.dampingFactor/(Math.min(1,o-this._lastTime)/(1/60))),this._lastTime=o}};LU([Mn(),es("Damping",[0,1],.01)],UI.prototype,"dampingFactor",void 0),UI=LU([wv("Device Orientation Controls")],UI);class sL extends tD{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,i)=>new UI(e)}}sL.PluginType="DeviceOrientationControlsPlugin";var Qm=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};const UU=new _.Pa4,oL=new _.$V,aL=new _.Pa4,Yz={type:"change"};let kp=class extends _e.SimpleEventDispatcher{constructor(h,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new _.Pa4,this._lastTime=-1,this.object=h,this.domElement=e,this.onPointerMove=this.onPointerMove.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const h=this.object.quaternion;UU.set(0,0,-1).applyQuaternion(h),oL.setFromVector3(UU),this.lat=90-_.M8C.radToDeg(oL.phi),this.lon=_.M8C.radToDeg(oL.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onPointerDown(h){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(h.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onPointerUp(h){if(this.activeLook)switch(h.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onPointerMove(h){this.domElement===document?(this.pointerX=h.pageX-this.viewHalfX,this.pointerY=h.pageY-this.viewHalfY):(this.pointerX=h.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=h.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(h){if(this.enableKeys)switch(h.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(h){if(this.enableKeys)switch(h.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(h,e,i){return h.isVector3?aL.copy(h):e===void 0||i===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):aL.set(h,e,i),this.object.lookAt(aL),this.setOrientation(),this}update(){const h=(0,_e.now)(),e=(this._lastTime<0?16:Math.min(h-this._lastTime,1e3))/1e3;if(this._lastTime=h,!this.enabled)return;if(this.heightSpeed){const et=_.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(et*this.heightCoef)}else this.autoSpeedFactor=0;const i=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(i+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(i),this.moveLeft&&this.object.translateX(-i),this.moveRight&&this.object.translateX(i),this.moveUp&&this.object.translateY(i),this.moveDown&&this.object.translateY(-i);let s=e*this.lookSpeed;this.activeLook||(s=0);let o=1;this.constrainVertical&&(o=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.pointerX*s,this.lookVertical&&(this.lat-=this.pointerY*s*o),this.lat=Math.max(-85,Math.min(85,this.lat));let c=_.M8C.degToRad(90-this.lat);const g=_.M8C.degToRad(this.lon);this.constrainVertical&&(c=_.M8C.mapLinear(c,0,Math.PI,this.verticalMin,this.verticalMax));const b=this.object.position;this.targetPosition.setFromSphericalCoords(1,c,g).add(b),this.object.lookAt(this.targetPosition),this.dispatchEvent(Yz)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(h){this.enableKeys&&h.preventDefault()}};Qm([Mn(),Nr()],kp.prototype,"enabled",void 0),Qm([Mn(),Nr()],kp.prototype,"enableKeys",void 0),Qm([Mn(),js()],kp.prototype,"movementSpeed",void 0),Qm([Mn(),js()],kp.prototype,"lookSpeed",void 0),Qm([Mn(),Nr()],kp.prototype,"lookVertical",void 0),Qm([Mn(),Nr()],kp.prototype,"autoForward",void 0),Qm([Mn(),Nr()],kp.prototype,"activeLook",void 0),Qm([Mn(),Nr()],kp.prototype,"heightSpeed",void 0),Qm([Mn(),js()],kp.prototype,"heightCoef",void 0),Qm([Mn(),js()],kp.prototype,"heightMin",void 0),Qm([Mn(),js()],kp.prototype,"heightMax",void 0),Qm([Mn(),Nr()],kp.prototype,"constrainVertical",void 0),Qm([Mn(),js()],kp.prototype,"verticalMin",void 0),Qm([Mn(),js()],kp.prototype,"verticalMax",void 0),Qm([Mn(),Nr()],kp.prototype,"mouseDragOn",void 0),kp=Qm([Ms("First Person Controls")],kp);class lL extends tD{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,i)=>new kp(e,i)}}lL.PluginType="FirstPersonControlsPlugin";var xM=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};const EM=new _.USm(0,0,0,"YXZ"),SM=new _.Pa4,Kz={type:"change"},Jz={type:"lock"},$z={type:"unlock"},FU=Math.PI/2;let zw=class extends _e.SimpleEventDispatcher{constructor(h,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new _.Pa4(0,0,-1),this.domElement=e,this.object=h,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(h){this.isLocked||this.autoLockOnClick&&(h.preventDefault(),this.lock())}onMouseMove(h){this.isLocked&&(this._movementX+=h.movementX||h.mozMovementX||h.webkitMovementX||0,this._movementY+=h.movementY||h.mozMovementY||h.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(Jz),this.isLocked=!0):(this.dispatchEvent($z),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(h){return h.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(h){SM.setFromMatrixColumn(this.object.matrix,0),SM.crossVectors(this.object.up,SM),this.object.position.addScaledVector(SM,h)}moveRight(h){SM.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(SM,h)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Math.abs(this._movementX)<1e-4&&Math.abs(this._movementY)<1e-4||(EM.setFromQuaternion(this.object.quaternion),EM.y-=.002*this._movementX*this.pointerSpeed,EM.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,EM.x=Math.max(FU-this.maxPolarAngle,Math.min(FU-this.minPolarAngle,EM.x)),this.object.quaternion.setFromEuler(EM),this.dispatchEvent(Kz))}};xM([Nr(),Mn()],zw.prototype,"enabled",void 0),xM([js(),Mn()],zw.prototype,"minPolarAngle",void 0),xM([js(),Mn()],zw.prototype,"maxPolarAngle",void 0),xM([js(),Mn()],zw.prototype,"pointerSpeed",void 0),xM([Nr(),Mn()],zw.prototype,"autoLockOnClick",void 0),zw=xM([wv("Pointer Lock Controls")],zw);class cL extends tD{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,i)=>new zw(e,i.ownerDocument?i:i.documentElement)}}cL.PluginType="PointerLockControlsPlugin";class jU{constructor(){this._animations=[],this._playingAnimations=new Set,this._clock=new _.SUY}loadModel(e){this._model=e,this.mixer=new _.Xcj(e),e&&(this._animations=[...e.animations])}get getMixer(){return this.mixer}get getAnimationClips(){return this._animations}async playAllAnimations(e){var s;const i=[];(s=this._animations)==null||s.forEach(o=>{i.push(this.playClip(o,e))}),await Promise.all(i)}async reverseAllAnimation(e){var s;const i=[];(s=this._animations)==null||s.forEach(o=>{i.push(this.playClip(o,e,1,!0))}),await Promise.all(i)}async playClip(e,i,s=1,o=!1,c=!1){if(!this.mixer)return;const g=this.mixer.clipAction(e);return this._playingAnimations.has(g)&&this.mixer.dispatchEvent({type:"canceled",action:g}),c&&(this.mixer.setTime(0),this.mixer.stopAllAction()),o?(g.paused=!1,g.timeScale=-s):(g.reset(),g.timeScale=s),g.loop=i?_.YKA:_.jAl,g.clampWhenFinished=!0,new Promise(b=>{const et=async tt=>{tt.action===g&&(this.mixer.removeEventListener("finished",et),this.mixer.removeEventListener("canceled",et),this._playingAnimations.delete(g),b())};this.mixer.addEventListener("finished",et),this.mixer.addEventListener("canceled",et),this._playingAnimations.add(g),g.play()})}playClipByName(e,i,s=1,o=!1){let c;this._animations.forEach(g=>{g.name===e&&(c=g)}),c&&this.playClip(c,i,s,o)}update(){const e=this._clock.getDelta();return this._playingAnimations.size>0&&(this.mixer.update(e),!0)}}class zU extends hs{constructor(){super(),this.helperIdentities=new Map}async onAdded(e){var i;await super.onAdded(e),(i=this._viewer)==null||i.addEventListener("postFrame",()=>{this.helperIdentities.forEach(s=>{var o;s.update()&&((o=this._viewer)==null||o.setDirty())})})}createHelper(e,i){var s;if(this.helperIdentities.has(e))(s=this._viewer)==null||s.console.warn("Helper with this id already exists");else{const o=new jU;o.loadModel(i),this.helperIdentities.set(e,o)}}getAnimationClips(e){if(this.helperIdentities.has(e))return this.helperIdentities.get(e).getAnimationClips}async playClip(e,i,s,o=1,c=!1,g=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClip(i,s,o,c,g)}async playAllAnimations(e,i){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playAllAnimations(i)}async playAllAnimationsInReverse(e,i){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).reverseAllAnimation(i)}async playAnimationByName(e,i,s,o=1,c=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClipByName(i,s,o,c)}}zU.PluginType="AnimationHelperPlugin";class FI extends hs{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.defaultActions={exportFile:async(e,i,s)=>{(0,_e.downloadBlob)(e,i)}},this.actions={...this.defaultActions}}async exportFile(e,i){i=i||e.name||"file_export",this.dispatchEvent({type:"transferFile",path:i,state:"exporting"}),await this.actions.exportFile(e,i,({state:s,progress:o})=>{this.dispatchEvent({type:"transferFile",path:i,state:s??"exporting",progress:o})}),this.dispatchEvent({type:"transferFile",path:i,state:"done"})}}FI.PluginType="FileTransferPlugin";var CM=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class SA extends hs{_onEnabledChanged1(){this._onEnabledChanged()}_onEnabledChanged(){this._viewer&&(this._viewer.scene.activeCamera.interactionsEnabled=!this.enabled);const e=this._cameraViews.length;this._oldState=e<2?0:_.M8C.clamp(this._currentState,0,e-1.001),this.enabled&&this._animateCameraToView(),this.dispatchEvent({type:"enableChanged",enabled:this.enabled})}constructor(e=!0){super(),this.enabled=!0,this.animEase="easeInOutSine",this.interpolateMode="spherical",this.enableDamping=!0,this.damping=.04,this.initAnimationTime=1,this.dependencies=[qo],this._currentState=0,this._oldState=0,this._overrideTime=0,this._preFrame1=i=>{this._preFrame(i)},this.enabled=e,this._onEnabledChanged1=this._onEnabledChanged1.bind(this)}get _cameraViews(){var e,i;return((i=(e=this._viewer)==null?void 0:e.getPlugin(qo))==null?void 0:i.camViews)??[]}setState(e){this._currentState=e}async onAdded(e){await super.onAdded(e),this.enabled&&this._onEnabledChanged(),e.addEventListener("preFrame",this._preFrame1)}async onRemove(e){return e.removeEventListener("preFrame",this._preFrame1),this.enabled=!1,super.onRemove(e)}_preFrame(e){var tt;if(!this.enabled)return;const i=this._cameraViews;if(i.length<=1||!this._overrideStartView&&Math.abs(this._currentState-this._oldState)<.001)return;this.enableDamping?this._oldState=_.M8C.lerp(this._oldState,this._currentState,this.damping):this._oldState=this._currentState,this._oldState=_.M8C.clamp(this._oldState,0,i.length-1.001);const s=Math.floor(this._oldState),o=this._overrideStartView||i[s],c=this._overrideEndView||i[s+1];let g,b=this._overrideStartView?this._overrideTime:this._oldState-s;b=$y[this.animEase](b),g=this.interpolateMode==="spherical"?this._lerpViewsSpherical(o,c,b):this._lerpViewsLinear(o,c,b);const et=(tt=this._viewer)==null?void 0:tt.scene.activeCamera;et&&(et.position.copy(g[0]),et.target.copy(g[1]),et.positionTargetUpdated(!0)),this._overrideStartView&&(this._overrideTime+=e.deltaTime/1e3,this._overrideTime>=this.initAnimationTime&&(this._overrideTime=0,this._overrideStartView=void 0,this._overrideEndView=void 0))}_lerpViewsLinear(e,i,s){const o=new _.Pa4,c=new _.Pa4;return c.lerpVectors(e.position,i.position,s),o.lerpVectors(e.target,i.target,s),[c,o]}_lerpViewsSpherical(e,i,s){const o=e.target.clone(),c=new _.Pa4,g=new _.Pa4,b=cm(e,e.target),et=cm(i,i.target),tt=new _.$V;return tt.phi=y_(b.phi,et.phi,s),tt.theta=y_(b.theta,et.theta,s),tt.radius=_.M8C.lerp(b.radius,et.radius,s),c.copy(o).lerp(i.target,s),g.setFromSpherical(tt),g.add(c),[g,c]}_animateCameraToView(){const e=this._cameraViews;if(!this._viewer||e.length<2||!this.enabled)return;this._overrideStartView=new dp(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target);const i=Math.floor(this._oldState),s=this._oldState-i;let o;o=this.interpolateMode==="spherical"?this._lerpViewsSpherical(e[i],e[i+1],s):this._lerpViewsLinear(e[i],e[i+1],s),this._overrideEndView=new dp(o[0],o[1]),this._overrideTime=0}}SA.PluginType="CameraViewControlPlugin",CM([Nr("Enabled"),(0,_e.onChange)(SA.prototype._onEnabledChanged1),Mn()],SA.prototype,"enabled",void 0),CM([Mn(),em("Ease",Object.keys($y).map(h=>({label:h})))],SA.prototype,"animEase",void 0),CM([Mn(),em("Interpolation",["spherical","linear"].map(h=>({label:h})))],SA.prototype,"interpolateMode",void 0),CM([Nr("Enable Damping"),Mn()],SA.prototype,"enableDamping",void 0),CM([es("Damping",[.01,1],.001),Mn()],SA.prototype,"damping",void 0),CM([es("Init Anim Time",[.01,5],.001),Mn()],SA.prototype,"initAnimationTime",void 0);class uL extends SA{constructor(e=document.body,i=!0){super(i),this.wrapper=document.createElement("div"),this.toJSON=void 0,this.uiConfig={type:"folder",label:"Scrollable Camera Views",children:[...bv(this)]},typeof e=="string"?(this.parent=document.getElementById(e),this.parent||(console.error("parent doesn't exist"),this.parent=document.body)):this.parent=e}_preFrame(e){if(!this.enabled||this._cameraViews.length<=1)return;const i=this._findActiveView(),s=this._getScroll(i);this.setState(s+i),super._preFrame(e)}_getScroll(e){if(e>=this._cameraViews.length-1)return 0;const i=this.parent.querySelector(this._cameraViews[e].name)??this.parent.getElementsByTagName("section")[e],s=this.parent.querySelector(this._cameraViews[e+1].name)??this.parent.getElementsByTagName("section")[e+1],o=this.parent.getBoundingClientRect();if(!i||!s)return 0;const c=i.getBoundingClientRect(),g=s.getBoundingClientRect(),b=this.parent===document.body?0:o.top;return _.M8C.clamp((b-c.top)/Math.max(g.top-c.top,1e-4),0,1)}_findActiveView(){var e;for(let i=this._cameraViews.length-1;i>=0;i--){const s=this.parent.querySelector(this._cameraViews[i].name)??this.parent.getElementsByTagName("section")[i],o=this.parent.getBoundingClientRect();if(s){if(s.getBoundingClientRect().top<(this.parent===document.body?0:o.top))return i}else(e=this._cameraViews[i].name)!=null&&e.startsWith("#")&&console.error("section with id "+this._cameraViews[i].name+" doesn't exist!")}return 0}}uL.PluginType="ScrollableCameraViewPlugin";var hL,dL=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let S1=hL=class extends uL{generateCode(){var o;const h=document.createElement("div");h.style.position="absolute",h.style.top="0",h.style.width="100%",h.style.height="100%",h.style.display="flex",h.style.flexDirection="column",h.style.justifyContent="center",h.style.alignItems="center",h.style.zIndex="200";const e=document.createElement("textarea");e.rows=20,e.style.border="3px solid #27223a",e.style.borderRadius="5px",e.style.width="30%",e.style.padding="5px",e.style.zIndex="1000";const i=document.createElement("div");i.textContent="X",i.style.color="red",i.style.width="20px",i.style.height="20px",i.style.padding="2",i.style.textAlign="center",i.style.backgroundColor="white",i.style.borderRadius="100%",i.style.border="2px solid #27223a",i.style.cursor="pointer",i.addEventListener("click",()=>{var c;(c=this._viewer)==null||c.container.removeChild(h)});const s=document.createElement("div");s.textContent="Update",s.style.marginTop="10px",s.style.color="white",s.style.padding="4px 10px 4px 10px",s.style.justifyContent="center",s.style.alignItems="center",s.style.backgroundColor="green",s.style.borderRadius="10px",s.style.border="2px solid #fff",s.style.cursor="pointer",s.addEventListener("click",()=>{var b;const c=this.parent.innerHTML;this.parent.innerHTML=e.value;let g=0;for(;g<this._cameraViews.length;g++){const et=this.parent.querySelector(this._cameraViews[g].name)??this.parent.getElementsByTagName("section")[g];if(!et&&g<2){alert("you need to add 2 sections at least");break}if(!et){const tt=((b=this._cameraViews[g].name)==null||b.startsWith("#"),this._cameraViews[g].name.replace(/^#/,""));e.value+=tt,e.value=this._format(e.value)}}g<2?this.parent.innerHTML=c:async function(et,tt){var st;et.innerHTML=tt;const rt=et.getElementsByTagName("script");for(let at=0;at<rt.length;at++){const ct=rt[at],pt=q4(ct);let gt=!1;await new Promise(At=>{pt.onload=At,pt.onerror=()=>{gt=!0,At(void 0)}}),gt||((st=ct.parentNode)==null||st.replaceChild(pt,ct))}}(this.parent,e.value)}),h.appendChild(i),h.appendChild(e),h.appendChild(s),e.value=this._format(this.parent.innerHTML),(o=this._viewer)==null||o.container.appendChild(h)}_onEnabledChanged(){super._onEnabledChanged(),this._togglePreview()}_togglePreview(){this.wrapper&&(this.wrapper.style.zIndex=this.canvasUp?"-100":"100",this.wrapper.style.visibility=this.enabled?"visible":"hidden",this._viewer&&(this._viewer.canvas.style.pointerEvents=this.enabled&&this.canvasUp?"none":"auto"))}constructor(h=document.body,e=!1){super(h,e),this.canvasUp=!1,this._togglePreview=this._togglePreview.bind(this),this.generateCode=this.generateCode.bind(this)}async onAdded(h){var e,i,s,o,c,g;this.parent=this.wrapper,await super.onAdded(h),this._addWrapper(),this._togglePreview(),this.deserialize=this.deserialize.bind(this),this.addView=this.addView.bind(this),this.deleteView=this.deleteView.bind(this),(i=(e=this._viewer)==null?void 0:e.getPlugin(qo))==null||i.addEventListener("viewDelete",this.deleteView),(o=(s=this._viewer)==null?void 0:s.getPlugin(qo))==null||o.addEventListener("deserialize",this.deserialize),(g=(c=this._viewer)==null?void 0:c.getPlugin(qo))==null||g.addEventListener("viewAdd",this.addView)}deserialize(h){this._cameraViews.forEach(e=>{this._createSection(e.name)})}_addWrapper(){var h;this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.zIndex="-100",this.wrapper.style.position="absolute",this.wrapper.style.top="0",this.wrapper.id="parentWrapper",this.wrapper.style.borderRadius="10px",this.wrapper.style.overflowY="scroll",this.wrapper.style.overflowX="hidden",(h=this._viewer)==null||h.container.appendChild(this.wrapper)}_createSection(h){const e=document.createElement("section");e.style.width="100%",e.style.height="100%",e.style.opacity="50%",e.style.backgroundColor="black",e.style.zIndex="100",e.style.top="0",e.textContent=h,e.style.color="white",e.style.fontSize="100px",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.id=h,this.parent.appendChild(e)}addView(h){this._cameraViews.forEach((e,i)=>{var s;if(!(this.parent.querySelector(e.name)??this.parent.getElementsByTagName("section")[i])){const o=`<section id="${(s=e.name)!=null&&s.startsWith("#")?e.name.replace(/^#/,""):""}" style="width: 100%; height: 100%; opacity: 0.5; background-color: black; z-index: 100; top: 0px; color: white; font-size: 100px; display: flex; align-items: center; justify-content: center;">
                    ${e.name}
                    </section>`;this.parent.innerHTML+=o}})}deleteView(h){const e=this.parent.querySelector(h.view.name)??this.parent.getElementsByTagName("section").namedItem(h.view.name);e==null||e.remove()}_format(h){let e="",i="";return h.split(/>\s*</).forEach(function(s){s.match(/^\/\w/)&&(i=i.substring(1)),e+=i+"<"+s+`>\r
`,s.match(/^<?\w[^>]*[^/]$/)&&!s.startsWith("input")&&(i+="	")}),e.substring(1,e.length-3)}};dL([go("Show/Edit Code")],S1.prototype,"generateCode",null),dL([Nr("Canvas on top"),(0,_e.onChange)(hL.prototype._togglePreview)],S1.prototype,"canvasUp",void 0),S1=hL=dL([Ms("Scrollable Camera View Preview (Dev)")],S1);var pL={d:(h,e)=>{for(var i in e)pL.o(e,i)&&!pL.o(h,i)&&Object.defineProperty(h,i,{enumerable:!0,get:e[i]})},o:(h,e)=>Object.prototype.hasOwnProperty.call(h,e)},VU={};pL.d(VU,{Q:()=>nV});var fL=function(h,e,i,s){return new(i||(i=Promise))(function(o,c){function g(tt){try{et(s.next(tt))}catch(rt){c(rt)}}function b(tt){try{et(s.throw(tt))}catch(rt){c(rt)}}function et(tt){var rt;tt.done?o(tt.value):(rt=tt.value,rt instanceof i?rt:new i(function(st){st(rt)})).then(g,b)}et((s=s.apply(h,e||[])).next())})};const GU=Symbol("Comlink.proxy"),Zz=Symbol("Comlink.endpoint"),eV=Symbol("Comlink.releaseProxy"),mL=Symbol("Comlink.thrown"),HU=h=>typeof h=="object"&&h!==null||typeof h=="function",QU=new Map([["proxy",{canHandle:h=>HU(h)&&h[GU],serialize(h){const{port1:e,port2:i}=new MessageChannel;return WU(h,e),[i,[i]]},deserialize:h=>(h.start(),XU(h))}],["throw",{canHandle:h=>HU(h)&&mL in h,serialize({value:h}){let e;return e=h instanceof Error?{isError:!0,value:{message:h.message,name:h.name,stack:h.stack}}:{isError:!1,value:h},[e,[]]},deserialize(h){throw h.isError?Object.assign(new Error(h.value.message),h.value):h.value}}]]);function WU(h,e=self){e.addEventListener("message",function i(s){if(!s||!s.data)return;const{id:o,type:c,path:g}=Object.assign({path:[]},s.data),b=(s.data.argumentList||[]).map(dS);let et;try{const tt=g.slice(0,-1).reduce((st,at)=>st[at],h),rt=g.reduce((st,at)=>st[at],h);switch(c){case"GET":et=rt;break;case"SET":tt[g.slice(-1)[0]]=dS(s.data.value),et=!0;break;case"APPLY":et=rt.apply(tt,b);break;case"CONSTRUCT":et=iD(new rt(...b));break;case"ENDPOINT":{const{port1:st,port2:at}=new MessageChannel;WU(h,at),et=function(ct,pt){return KU.set(ct,pt),ct}(st,[st])}break;case"RELEASE":et=void 0;break;default:return}}catch(tt){et={value:tt,[mL]:0}}Promise.resolve(et).catch(tt=>({value:tt,[mL]:0})).then(tt=>{const[rt,st]=vL(tt);e.postMessage(Object.assign(Object.assign({},rt),{id:o}),st),c==="RELEASE"&&(e.removeEventListener("message",i),qU(e))})}),e.start&&e.start()}function qU(h){(function(e){return e.constructor.name==="MessagePort"})(h)&&h.close()}function XU(h,e){return gL(h,[],e)}function nD(h){if(h)throw new Error("Proxy has been released and is not useable")}function gL(h,e=[],i=function(){}){let s=!1;const o=new Proxy(i,{get(c,g){if(nD(s),g===eV)return()=>MM(h,{type:"RELEASE",path:e.map(b=>b.toString())}).then(()=>{qU(h),s=!0});if(g==="then"){if(e.length===0)return{then:()=>o};const b=MM(h,{type:"GET",path:e.map(et=>et.toString())}).then(dS);return b.then.bind(b)}return gL(h,[...e,g])},set(c,g,b){nD(s);const[et,tt]=vL(b);return MM(h,{type:"SET",path:[...e,g].map(rt=>rt.toString()),value:et},tt).then(dS)},apply(c,g,b){nD(s);const et=e[e.length-1];if(et===Zz)return MM(h,{type:"ENDPOINT"}).then(dS);if(et==="bind")return gL(h,e.slice(0,-1));const[tt,rt]=YU(b);return MM(h,{type:"APPLY",path:e.map(st=>st.toString()),argumentList:tt},rt).then(dS)},construct(c,g){nD(s);const[b,et]=YU(g);return MM(h,{type:"CONSTRUCT",path:e.map(tt=>tt.toString()),argumentList:b},et).then(dS)}});return o}function YU(h){const e=h.map(vL);return[e.map(s=>s[0]),(i=e.map(s=>s[1]),Array.prototype.concat.apply([],i))];var i}const KU=new WeakMap;function iD(h){return Object.assign(h,{[GU]:!0})}function vL(h){for(const[e,i]of QU)if(i.canHandle(h)){const[s,o]=i.serialize(h);return[{type:"HANDLER",name:e,value:s},o]}return[{type:"RAW",value:h},KU.get(h)||[]]}function dS(h){switch(h.type){case"HANDLER":return QU.get(h.name).deserialize(h.value);case"RAW":return h.value}}function MM(h,e,i){return new Promise(s=>{const o=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");h.addEventListener("message",function c(g){g.data&&g.data.id&&g.data.id===o&&(h.removeEventListener("message",c),s(g.data))}),h.start&&h.start(),h.postMessage(Object.assign({id:o},e),i)})}class tV extends class{}{init(e,i,s,o){if(!this.api){if(!o)throw new Error("workerFilePath is required");(()=>{var c,g,b;c=this,b=function*(){const et=yield fetch(o).then(st=>st.blob()),tt=URL.createObjectURL(et),rt=new Worker(tt,{type:"module"});this.api=yield new(XU(rt))(iD(()=>{e(),URL.revokeObjectURL(tt)}),iD((st,at)=>st==="xatlas_web.wasm"?s:st+at),iD(i))},new((g=void 0)||(g=Promise))(function(et,tt){function rt(ct){try{at(b.next(ct))}catch(pt){tt(pt)}}function st(ct){try{at(b.throw(ct))}catch(pt){tt(pt)}}function at(ct){var pt;ct.done?et(ct.value):(pt=ct.value,pt instanceof g?pt:new g(function(gt){gt(pt)})).then(rt,st)}at((b=b.apply(c,[])).next())})})()}}}class nV extends class{constructor(e,i={resolution:2048},s={},o=!1,c=!1,g=!1){this.THREE=e,this.packOptions=i,this.chartOptions=s,this.useNormals=o,this.timeUnwrap=c,this.logProgress=g,this._libraryLoaded=!1,this._isUnwrapping=!1,this.xAtlas=this._createXAtlas()}loadLibrary(e,i,s){return fL(this,void 0,void 0,function*(){if(!this._libraryLoaded){for(yield new Promise((o,c)=>{try{this.xAtlas.init(()=>{o()},e,i,s)}catch(g){c(g)}});!this.xAtlas.api||!(yield this.xAtlas.api.loaded);)yield new Promise(o=>setTimeout(o,100));this._libraryLoaded=!0}})}packAtlas(e,i="uv2",s="uv"){return fL(this,void 0,void 0,function*(){if(!this._libraryLoaded)return console.warn("xatlas-three: library not loaded"),[];if(!e)return[];if(e.length<1)return[];const o=this.chartOptions.useInputMeshUvs;for(;this._isUnwrapping;)console.log("xatlas-three: unwrapping another mesh, waiting 100 ms"),yield new Promise(tt=>setTimeout(tt,100));this._isUnwrapping=!0,yield this.xAtlas.api.setProgressLogging(this.logProgress),yield this.xAtlas.api.createAtlas();let c=[],g="";for(let tt of e){let{uuid:rt,index:st,attributes:at}=tt;const ct=tt.userData.worldScale||1;c.push(rt),st&&at.position&&at.position.itemSize===3?(g="Mesh"+c.length+" added to atlas: "+rt,this.timeUnwrap&&console.time(g),yield this.xAtlas.api.addMesh(st.array,at.position.array,at.normal?at.normal.array:void 0,at.uv?at.uv.array:void 0,rt,this.useNormals,o,ct),this.timeUnwrap&&console.timeEnd(g)):console.warn("xatlas-three: Geometry not supported: ",tt)}g="Generated atlas with "+c.length+" meshes",this.timeUnwrap&&console.time(g);let b=yield this.xAtlas.api.generateAtlas(this.chartOptions,this.packOptions,!0);this.timeUnwrap&&console.timeEnd(g);let et=[];for(let tt of b){let rt=e.find(st=>st.uuid===tt.mesh);rt?(tt.vertex.vertices&&rt.setAttribute("position",new this.THREE.BufferAttribute(tt.vertex.vertices,3,!1)),tt.vertex.normals&&rt.setAttribute("normal",new this.THREE.BufferAttribute(tt.vertex.normals,3,!0)),tt.vertex.coords1&&rt.setAttribute(i,new this.THREE.BufferAttribute(tt.vertex.coords1,2,!1)),tt.vertex.coords&&i!==s&&rt.setAttribute(s,new this.THREE.BufferAttribute(tt.vertex.coords,2,!1)),tt.index&&rt.setIndex(new this.THREE.BufferAttribute(tt.index,1,!1)),et.push(rt)):console.error("xatlas-three: Mesh not found: ",tt.mesh)}return yield this.xAtlas.api.destroyAtlas(),this._isUnwrapping=!1,et})}unwrapGeometry(e,i="uv",s="uv2"){return fL(this,void 0,void 0,function*(){return this.packAtlas([e],i,s)})}}{_createXAtlas(){return new tV}}var jI,iV=VU.Q,Bl=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let mv=class{constructor(){this.fixWinding=!1,this.maxBoundaryLength=0,this.maxChartArea=0,this.maxCost=2,this.maxIterations=1,this.normalDeviationWeight=2,this.normalSeamWeight=4,this.roundnessWeight=.009999999776482582,this.straightnessWeight=6,this.textureSeamWeight=.5,this.useInputMeshUvs=!1}};Bl([Mn()],mv.prototype,"fixWinding",void 0),Bl([Mn()],mv.prototype,"maxBoundaryLength",void 0),Bl([Mn()],mv.prototype,"maxChartArea",void 0),Bl([Mn()],mv.prototype,"maxCost",void 0),Bl([Mn()],mv.prototype,"maxIterations",void 0),Bl([Mn()],mv.prototype,"normalDeviationWeight",void 0),Bl([Mn()],mv.prototype,"normalSeamWeight",void 0),Bl([Mn()],mv.prototype,"roundnessWeight",void 0),Bl([Mn()],mv.prototype,"straightnessWeight",void 0),Bl([Mn()],mv.prototype,"textureSeamWeight",void 0),Bl([Mn()],mv.prototype,"useInputMeshUvs",void 0),mv=Bl([Ms("Chart Options"),qm("UChartOptions")],mv);let Zv=class{constructor(){this.bilinear=!0,this.blockAlign=!1,this.bruteForce=!1,this.createImage=!1,this.maxChartSize=0,this.padding=0,this.resolution=0,this.rotateCharts=!0,this.rotateChartsToAxis=!0,this.texelsPerUnit=0}};Bl([Mn()],Zv.prototype,"bilinear",void 0),Bl([Mn()],Zv.prototype,"blockAlign",void 0),Bl([Mn()],Zv.prototype,"bruteForce",void 0),Bl([Mn()],Zv.prototype,"createImage",void 0),Bl([Mn()],Zv.prototype,"maxChartSize",void 0),Bl([Mn()],Zv.prototype,"padding",void 0),Bl([Mn()],Zv.prototype,"resolution",void 0),Bl([Mn()],Zv.prototype,"rotateCharts",void 0),Bl([Mn()],Zv.prototype,"rotateChartsToAxis",void 0),Bl([Mn()],Zv.prototype,"texelsPerUnit",void 0),Zv=Bl([Ms("Pack Options"),qm("UPackOptions")],Zv);let u0=jI=class extends hs{constructor(h=!1){super(),this.enabled=!0,this.useNormals=!0,this.chartOptions=new mv,this.packOptions=new Zv,this._loaded=!1,this._unwrapProgress=(e,i)=>{console.log("Unwrapping",e,i)},this.unwrapSelected=async()=>{var i,s,o,c,g;const e=(s=(i=this._viewer)==null?void 0:i.getPlugin(vo))==null?void 0:s.getSelectedObject();if(e)if(e.geometry){if(e.geometry.attributes.uv&&!await((o=this._viewer)==null?void 0:o.confirm("Unwrap: Geometry already has UVs. Overwrite?")))return;await this.unwrapGeometry(e.geometry)}else(c=this._viewer)==null||c.alert("Unwrap: Selected object has no geometry");else(g=this._viewer)==null||g.alert("Unwrap: No object selected")},h&&this.loadLibrary()}async loadLibrary(){if(this._unwrapper)for(;!this._loaded;)await(0,_e.timeout)(100);else this._unwrapper=new iV({BufferAttribute:_.TlE},this.packOptions,this.chartOptions,this.useNormals),await this._unwrapper.loadLibrary(this._unwrapProgress,jI.LIBRARY_PATH+"xatlas.wasm",jI.LIBRARY_PATH+"xatlas.js"),console.log("xatlas loaded"),this._loaded=!0}async unwrapGeometry(h,e="uv",i="uv"){var s;await this.loadLibrary(),await((s=this._unwrapper)==null?void 0:s.unwrapGeometry(h,e,i))}async packAtlas(h,e=!0,i="uv2",s="uv"){var c;await this.loadLibrary(),Array.isArray(h)||(h=[h]);const o=[];e?h.forEach(g=>g.traverse(b=>{b.geometry&&o.push(b.geometry)})):h.forEach(g=>{g.geometry&&o.push(g.geometry)}),await((c=this._unwrapper)==null?void 0:c.packAtlas(o,i,s))}_useNormalsChanged(){this._unwrapper&&(this._unwrapper.useNormals=this.useNormals)}};u0.PluginType="XAtlasPlugin",u0.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/xatlasjs@0.1.0/dist/",Bl([(0,_e.onChange)(jI.prototype._useNormalsChanged),Mn()],u0.prototype,"useNormals",void 0),Bl([Mn()],u0.prototype,"chartOptions",void 0),Bl([Mn()],u0.prototype,"packOptions",void 0),Bl([go("Unwrap Selected Geometry")],u0.prototype,"unwrapSelected",void 0),u0=jI=Bl([Ms("UV Unwrapping (xAtlas)")],u0);class zI extends hs{constructor(){super(...arguments),this.dependencies=[Lr],this.enabled=!0,this.baseUrl="",this.variations={objects:[],materials:[]},this.autoDispose=!0,this._ty=["objects","materials"],this._extForType={objects:["glb","fbx","obj","gltf","stl","3dm","json","vjson"],materials:["pmat","dmat"],images:["png","jpg","jpeg","gif","bmp","webp","svg"]},this.utils={getName:e=>e.name||e.prefix.replace(/^\//,"").replace(/\/$/,"").replaceAll("/","_"),getTitle:e=>e.title||this.utils.getName(e),getIcon:(e,i)=>{let s=e.icon;return(s&&/^(\w+)\(([^)]*)\)/.exec(s)||/^#([A-Fa-f\d]+)$/.exec(s))&&(s=(0,_e.makeColorSvg)(s)),s&&s.startsWith("http")&&s.startsWith("data:")||(s=this.utils.pathToIcon(this.baseUrl+i+"/"+e.prefix+(s||""))),s},getItemIcon:(e,i,s)=>{const o=e.iconFiles[i];if(o)return URL.createObjectURL(o);let c=e.icons[i];return(c&&/^(\w+)\(([^)]*)\)/.exec(c)||/^#([A-Fa-f\d]+)$/.exec(c))&&(c=(0,_e.makeColorSvg)(c)),c||(c=this.utils.pathToIcon(e.items[i])),!c||c.startsWith("http")||c.startsWith("data:")||(c=this.baseUrl+s+"/"+e.prefix+c),c},getItemTitle:(e,i)=>e.titles[i]||this.utils.pathToTitle(e.items[i]),getItemPath:(e,i,s)=>e.items[i].startsWith("http")?e.items[i]:`${this.baseUrl}${s}/${e.prefix}${e.items[i]}`,pathToTitle:e=>e.split("/").pop().replace(/\.[^.]*$/,""),pathToIcon:e=>e.replace(/\/$/,"").replace(/\.[^/.]+$/,"")+".webp"},this.toJSON=void 0}_getVariationId(e){return this.utils.getName(e)}async applyVariation(e,i,s,o=!1){var st,at;if(!this._viewer)return;const c=this._getVariationId(e);typeof i=="number"&&(i=e.items[i]);const g=e.items.indexOf(i);if(g===-1)return void this._viewer.console.warn(`Item ${i} not found`);const b=e.itemFiles[g],et=e.selected;if(!o&&et===g)return;e.selected=g;const tt=this._viewer.getManager(),rt=this.utils.getItemPath(e,g,s);if(s==="objects"){let ct=this._viewer.scene.findObjectsByName(c).map(yt=>yt.modelObject);ct.length===0&&(ct=[(await this._viewer.createObject3D()).modelObject],ct[0].name=c),this._viewer.renderEnabled=!1;for(const yt of ct)[...yt.children].forEach(_t=>_t.dispose&&this.autoDispose?_t.dispose():_t.removeFromParent());const pt=await this._loadObject(rt,b);if(!pt.length)return void(rt.endsWith("json")||this._viewer.console.warn(`Object ${rt} not found`));let gt=!1;for(const yt of ct){[...yt.children].forEach(_t=>_t.dispose&&this.autoDispose?_t.dispose():_t.removeFromParent());for(const _t of pt)gt?yt.add(_t.modelObject.clone()):yt.add(_t.modelObject);gt=!0}const At=[],xt=this.variations.materials.filter(yt=>yt&&typeof yt.selected=="number");for(const yt of xt)At.push(this.applyVariation(yt,yt.selected,"materials",!0));await Promise.all(At),this._viewer.renderEnabled=!0}if(s==="materials"){const ct=await this._loadMaterial(rt,b);if(!ct)return void this._viewer.console.warn(`Material ${rt} not found`);ct.userData.__isVariation=!0;const pt=this._viewer.scene.findObjectsByName(c),gt=At=>{var xt,yt,_t;At.material&&(Array.isArray(At.material)?At.material.length!==0&&((xt=e.data)==null?void 0:xt.matType)!==At.material[0].typeSlug:((yt=e.data)==null?void 0:yt.matType)!==At.material.typeSlug)||((_t=At==null?void 0:At.setMaterial)==null||_t.call(At,ct))};for(const At of pt)(st=e.data)!=null&&st.traverse?At.traverse(gt):gt(At);(at=tt.materials)==null||at.applyMaterial(ct,c)}}clearVariations(){const e=this.variations.objects;if(this.variations.materials,this.variations={objects:[],materials:[]},this._viewer)for(const i of e){const s=this._getVariationId(i),o=this._viewer.scene.findObjectsByName(s);for(const c of o)[...c.children].forEach(g=>(g.dispose??g.removeFromParent)())}}async _loadMaterial(e,i){var s,o,c;return(c=(o=(s=this._viewer)==null?void 0:s.getManager())==null?void 0:o.importer)==null?void 0:c.importSinglePath(e,{importedFile:i})}async _loadObject(e,i){var s,o,c;return(c=(o=(s=this._viewer)==null?void 0:s.getManager())==null?void 0:o.importer)==null?void 0:c.importPath(e,{importedFile:i,reimportDisposed:!0})}importConfig(e,i){typeof e=="string"&&(e=JSON.parse(e)),e.baseUrl!==void 0&&(this.baseUrl=e.baseUrl),!i&&e.folder&&(i=typeof e.folder=="object"?e.folder:typeof e.folder=="string"?$A(Mp(e.folder)):$A(e.folder));for(const s of this._ty)if(e[s])for(const o of e[s]){const c={items:o.items,prefix:o.prefix,name:o.name,title:o.title||"",icon:o.icon||"",icons:o.icons??o.items.map(()=>""),titles:o.titles??o.items.map(()=>""),itemFiles:[],iconFiles:[],data:{...o.data}};if(i)for(let g=0;g<o.items.length;g++){const b=o.items[g],et=i[s+"/"+o.prefix+b];c.itemFiles[g]=et?new File([et],b):void 0;const tt=o.icons[g];if(!tt)continue;const rt=i[s+"/"+o.prefix+tt];c.iconFiles[g]=rt?new File([rt],tt):void 0}this.variations[s].push(c)}}async importPath(e){var i,s;if(e.endsWith(".json")){const o=await((s=(i=this._viewer)==null?void 0:i.getManager().importer)==null?void 0:s.importSinglePath(e,{processImported:!1})),c=e.split("?")[0];return this.baseUrl||(this.baseUrl=c.substring(0,c.lastIndexOf("/")+1)),this.importConfig(o)}e.endsWith(".zip")?alert("not implemented"):alert("not supported")}getMaterials(e){var i;return((i=this.variations.materials.find(s=>this.utils.getName(s)===e))==null?void 0:i.items)||[]}getObjects(e){var i;return((i=this.variations.objects.find(s=>this.utils.getName(s)===e))==null?void 0:i.items)||[]}getMaterialVariations(){return this.variations.materials.map(e=>this.utils.getName(e))}getObjectVariations(){return this.variations.objects.map(e=>this.utils.getName(e))}async onRemove(e){return super.onRemove(e)}fromJSON(e){return super.fromJSON(e)?(this.importConfig(e),this):null}async _exportConfiguratorState(){var o;let e={objects:{},materials:{}};const i={objects:[],materials:[],type:zI.PluginType};this.baseUrl&&(i.baseUrl=this.baseUrl);let s=!1;for(const c of this._ty)for(const g of this.variations[c]){const b={...g};b.data={...b.data},delete b.itemFiles,delete b.iconFiles,i[c].push(b);const et=g.prefix.replace(/^\//,""),tt=et.trimEnd().endsWith("/")?"":et.split("/").pop()||"",rt=et.replace(tt,"").trimEnd().replace(/\/$/,""),st={};let at=!1;for(let gt=0;gt<g.items.length;gt++){const At=g.items[gt],xt=g.itemFiles[gt],yt=g.iconFiles[gt],_t=g.icons[gt];xt?(st[tt+At]=new Uint8Array(await xt.arrayBuffer()),yt&&!_t&&((o=this._viewer)==null||o.console.error("Icon file without icon name")),yt&&_t&&(st[tt+_t]=new Uint8Array(await yt.arrayBuffer())),at=!0):yt&&alert("Icon file without model/material file not supported")}if(!at)continue;s=!0;const ct=rt.split("/");let pt=e[c];for(const gt of ct){pt[gt]||(pt[gt]={});const At=pt[gt];if(typeof At!="object")throw new Error("Invalid prefix: "+g.prefix);pt=At}Object.assign(pt,st)}return s||(e=void 0),{folder:e,config:i}}}zI.PluginType="VariationConfiguratorPlugin";class TM extends zI{constructor(){super(),this._uiNeedRefresh=!1,this._refreshUi=this._refreshUi.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("preFrame",this._refreshUi)}async onRemove(e){return e.removeEventListener("preFrame",this._refreshUi),super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){if(!this.enabled||!this._viewer||!this._uiNeedRefresh)return!1;this._uiNeedRefresh=!1,gn.RemoveAll(TM.PluginType);for(const e of["objects","materials"])for(const i of this.variations[e])gn.Create(TM.PluginType,this.utils.getTitle(i),5,20,0,i.items.map((s,o)=>({id:s,image:this.utils.getItemIcon(i,o,e),onClick:async c=>this.applyVariation(i,c,e,!1),tooltip:this.utils.getItemTitle(i,o)})),(s,o)=>l1(s,{placement:"bottom",content:o.tooltip}));return gn.RebuildUi(this._viewer.container),!0}}TM.PluginType="VariationConfiguratorPlugin";class VI extends TM{constructor(){super(...arguments),this._uiExpandedState={},this.uiConfig={type:"folder",label:"Configurator",children:[{type:"input",label:"Base URL",property:[this,"baseUrl"]},...this._ty.map(e=>({type:"folder",expanded:this._uiExpandedState["__/"+e],onExpand:()=>this._uiExpandedState["__/"+e]=!0,onCollapse:()=>this._uiExpandedState["__/"+e]=!1,label:e,children:[()=>this.variations[e].map(i=>({type:"folder",expanded:this._uiExpandedState[i.name],onExpand:()=>this._uiExpandedState[i.name]=!0,onCollapse:()=>this._uiExpandedState[i.name]=!1,label:()=>this.utils.getName(i),children:[{type:"input",placeholder:()=>this.utils.getName(i),property:[i,"name"]},{type:"input",property:[i,"prefix"]},{type:"input",placeholder:()=>this.utils.pathToTitle(this.utils.getName(i)),property:[i,"title"]},{type:"input",placeholder:()=>this.utils.pathToIcon(this.baseUrl+i.prefix),property:[i,"icon"]},{type:"folder",label:"items",children:i.items.map((s,o)=>({type:"folder",label:()=>i.items[o],children:[{type:"input",label:"File/URL",isMonitor:!i.itemFiles[o],getValue:()=>i.items[o],setValue:c=>{i.items[o]=c}},{type:"input",label:"Icon/Image",placeholder:this.utils.pathToIcon(i.items[o]),getValue:()=>i.icons[o],setValue:c=>{i.icons[o]=c}},{type:"input",label:"Title",placeholder:this.utils.pathToTitle(i.items[o]),getValue:()=>i.titles[o],setValue:c=>{i.titles[o]=c}},{type:"button",label:"Apply",value:async()=>this.applyVariation(i,o,e)},i.itemFiles[o]?[{type:"button",label:"Remove",value:()=>{i.items.splice(o,1),i.itemFiles.splice(o,1),this.refreshUi()}},{type:"button",label:"Replace",value:async()=>{const c=await(0,_e.uploadFile)(!1,!1);c.length!==0&&(i.itemFiles[o]=c[0],i.items[o]=c[0].name,this.refreshUi())}},{type:"button",label:"Download",value:async()=>{const c=i.itemFiles[o];(0,_e.downloadBlob)(c,c.name)}}]:{}]}))},{type:"button",label:"Add item (local)",value:async()=>{var o,c;const s=await(0,_e.uploadFile)(!0,!1);if(s.length!==0){for(const g of s){if(!this._extForType[e].includes(g.name.split(".").pop()??"")){await((o=this._viewer)==null?void 0:o.alert(`Invalid file: ${g.name} is not a valid ${e} file`));continue}if(i.items.includes(g.name)){await((c=this._viewer)==null?void 0:c.alert(`Already exists: Item with name ${g.name} already exists`));continue}const b=i.items.push(g.name)-1;i.icons[b]="",i.titles[b]="",i.itemFiles[b]=g}this.refreshUi()}}},{type:"button",label:"Add item (url)",value:async()=>{var c,g,b,et;const s=await((c=this._viewer)==null?void 0:c.prompt("URL: Enter the url of the object/material"));if(!s)return;if(!s.startsWith("http")&&!this.baseUrl.startsWith("http"))return void await((g=this._viewer)==null?void 0:g.alert(`Invalid url: ${s} should be a valid HTTP(S) url. If you are passing a relative path, set the baseURL first`));if(!this._extForType[e].includes(s.split(".").pop()??""))return void await((b=this._viewer)==null?void 0:b.alert(`Invalid url: ${s} should be of a material ending with mat`));i.items.includes(s)&&await((et=this._viewer)==null?void 0:et.alert(`Already exists: Item with url ${s} already exists`)),i.items.push(s);const o=i.items.length-1;i.icons[o]="",i.titles[o]="",this.refreshUi()}},{type:"button",label:()=>"Remove "+this.utils.getName(i),value:async()=>{var s;await((s=this._viewer)==null?void 0:s.confirm(`Delete Group: Are you sure you want to remove ${this.utils.getName(i)}?`))&&(this.variations[e].splice(this.variations[e].indexOf(i),1),this.refreshUi())}}]})),{type:"button",label:`Add ${e} group (empty)`,value:async()=>{var s;const i=await((s=this._viewer)==null?void 0:s.prompt("Name: Enter the name of the object/material"));i&&(this.variations[e].push({items:[],itemFiles:[],icons:[],iconFiles:[],titles:[],prefix:i+"/",name:i,icon:"",title:""}),this.refreshUi())}},{type:"button",label:`Add ${e} group (local folder)`,value:async()=>{var st,at,ct;const i=await(0,_e.uploadFile)(!1,!0);if(i.length===0)return;const s=[],o=[],c=[],g=[];for(const pt of i){if(pt.name.startsWith("."))continue;const gt=pt.name.split(".").pop()??"";gt?this._extForType[e].includes(gt)?(s.push(pt.webkitRelativePath.replace(/^\//,"")),o.push(pt)):this._extForType.images.includes(gt)?(c.push(pt.webkitRelativePath.replace(/^\//,"")),g.push(pt)):await((st=this._viewer)==null?void 0:st.alert(`Invalid file: ${pt.name} is not a valid ${e} file`)):await((at=this._viewer)==null?void 0:at.alert(`Invalid file: ${pt.name} has no extension`))}const b=(0,_e.longestCommonPrefix)(s),et=this.utils.getName({prefix:b});let tt=await((ct=this._viewer)==null?void 0:ct.prompt("Name: Enter the name of the object/material",et,!0));if(tt===null)return;tt=tt||et;const rt=s.map(pt=>{const gt=pt.replace(b,""),At=gt.split(".").pop()??"",xt=gt.replace("."+At,"")+".",yt=c.findIndex(_t=>_t.replace(b,"").startsWith(xt));return yt<0?["",void 0]:[c[yt].replace(b,""),g[yt]||void 0]});this.variations[e].push({items:s.map(pt=>pt.replace(b,"")),icons:rt.map(pt=>pt[0]),iconFiles:rt.map(pt=>pt[1]),titles:s.map(()=>""),itemFiles:o,prefix:b,name:tt,icon:"",title:""}),this.refreshUi()}}]})),{type:"button",label:"Download JSON/Zip",value:async()=>{var e,i;try{const{folder:s,config:o}=await this._exportConfiguratorState(),c=JSON.stringify(o,null,4);if(s){s["config.json"]=Mp(c);const g=await GM(s),b=new Blob([g],{type:"application/zip"});(0,_e.downloadBlob)(b,"configurator.zip")}else{const g=new Blob([c],{type:"application/json"});(0,_e.downloadBlob)(g,"config.json")}}catch(s){return(e=this._viewer)==null||e.console.error(s),void await((i=this._viewer)==null?void 0:i.alert("Error: "+((s==null?void 0:s.message)||s)))}}},{type:"button",label:"Load JSON/Zip",value:async()=>{var s,o,c;const e=await(0,_e.uploadFile)(!1,!1,"application/zip,application/json");if(e.length===0)return;const i=e[0];if(i.name.endsWith(".zip")){const g=$A(new Uint8Array(await i.arrayBuffer()));if(!g["config.json"])return void await((s=this._viewer)==null?void 0:s.alert("Invalid zip: config.json not found"));const b=JSON.parse(X_(g["config.json"]));this.importConfig(b,g)}else{if(!i.name.endsWith(".json"))return void await((o=this._viewer)==null?void 0:o.alert("Invalid file: "+i.name));{const g=JSON.parse(await i.text());this.importConfig(g)}}await((c=this._viewer)==null?void 0:c.alert("Imported successfully")),this.refreshUi()}},{type:"button",label:"Import Path",value:async()=>{var i,s;const e=await((i=this._viewer)==null?void 0:i.prompt("URL: Enter the url of the json file."));e&&(await this.importPath(e),await((s=this._viewer)==null?void 0:s.alert("Imported successfully")),this.refreshUi())}},{type:"button",label:"Refresh UI",value:()=>{this.refreshUi()}},{type:"button",label:"Clear All",value:async()=>{var e;await((e=this._viewer)==null?void 0:e.confirm("Clear: Are you sure you want to clear the configuration ?"))&&(this.variations.objects=[],this.variations.materials=[],this.refreshUi())}}]}}_refreshUiConfig(){var e,i;(i=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||i.call(e,"postFrame",!0)}refreshUi(){this._refreshUiConfig(),super.refreshUi()}async _loadObject(e,i){const s=await super._loadObject(e,i);for(const o of s)(o.modelObject||o).userData.excludeFromExport=!0;return s}}VI.PluginType="VariationConfiguratorPlugin";class Vw extends hs{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._addSceneObject=e=>{const i=e.object;i!=null&&i.traverse&&i.traverse(s=>{var c,g;s.userData[Vw.PluginType]===void 0&&(s.userData[Vw.PluginType]={transforms:[]});const o={type:"folder",label:"Transform Animation",children:[{type:"button",label:"Add Current Transform",value:()=>{var b;this.addTransform(s),(b=o==null?void 0:o.uiRefresh)==null||b.call(o)}},()=>s.userData[Vw.PluginType].transforms.map((b,et)=>({type:"folder",label:`Transform ${et}`,children:[{type:"vec3",label:"Position",property:[b,"position"]},{type:"vec3",label:"Quaternion",property:[b,"quaternion"]},{type:"vec3",label:"Scale",property:[b,"scale"]},{type:"button",label:"Set",value:()=>{this.setTransform(s,b)}},{type:"button",label:"Animate",value:()=>{this.animateTransform(s,b)}}]}))]};(g=(c=s.uiConfig)==null?void 0:c.children)==null||g.push(o)})}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),super.onRemove(e)}addTransform(e){e.userData[Vw.PluginType].transforms.push({position:e.position.clone(),quaternion:e.quaternion.clone(),scale:e.scale.clone()})}setTransform(e,i){var s,o,c,g;e.position.copy(i.position),e.quaternion.copy(i.quaternion),e.scale.copy(i.scale),(o=(s=e.userData).setDirty)==null||o.call(s),(g=(c=e.uiConfig)==null?void 0:c.uiRefresh)==null||g.call(c)}animateTransform(e,i,s=2e3){var gt,At;const o=(gt=this._viewer)==null?void 0:gt.getPluginByType("PopmotionPlugin");o||((At=this._viewer)==null||At.console.error("PopmotionPlugin required for animation"));const c=typeof i=="number"?e.userData[Vw.PluginType].transforms[i]:i,g=new _.Pa4,b=new _._fP,et=new _.Pa4,tt=e.position.clone(),rt=e.quaternion.clone(),st=e.scale.clone(),at=c.position,ct=c.quaternion,pt=c.scale;return o==null?void 0:o.animate({from:0,to:1,duration:s,onUpdate:xt=>{var yt,_t;g.lerpVectors(tt,at,xt),b.slerpQuaternions(rt,ct,xt),et.lerpVectors(st,pt,xt),e.position.copy(g),e.quaternion.copy(b),e.scale.copy(et),(yt=this._viewer)==null||yt.setDirty(),(_t=this._viewer)==null||_t.renderer.resetShadows()},onStop:()=>{var xt,yt,_t,Mt;e.position.copy(c.position),e.quaternion.copy(c.quaternion),e.scale.copy(c.scale),(yt=(xt=e.userData).setDirty)==null||yt.call(xt),(Mt=(_t=e.uiConfig)==null?void 0:_t.uiRefresh)==null||Mt.call(_t)}})}}Vw.PluginType="TransformAnimationPlugin";var JU=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let pS=class extends hs{constructor(h=!0){super(),this.enabled=!0,this.toJSON=void 0,this.cameras=[],this._preRender=()=>{if(this.enabled&&this._viewer)for(const e of this.cameras){if(!e.enabled)continue;const i=this._viewer,s=e.camera;try{this.dispatchEvent({type:"preRenderCamera",camera:e}),i.scene.renderCamera=s,i.renderer.render(!1);const o=i.renderer.composer.readBuffer;this.dispatchEvent({type:"preBlitCamera",camera:e,readBuffer:o}),i.renderer.blit(o.texture,e.target),this.dispatchEvent({type:"postRenderCamera",camera:e})}catch(o){console.error(o),e.enabled=!1}}},this.enabled=h}async onAdded(h){await super.onAdded(h),h.addEventListener("preRender",this._preRender)}addCamera(h){if(!this._viewer)throw"Plugin not added to viewer";const e={camera:h,target:this._viewer.renderer.composerTarget.clone(!0),enabled:!0};return this.cameras.push(e),e}};pS.PluginType="VirtualCamerasPlugin",JU([Nr()],pS.prototype,"enabled",void 0),pS=JU([Ms("Virtual Cameras")],pS);class cy{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const i=this.elements;i[0]=e.x,i[4]=e.y,i[8]=e.z}getTrace(e){e===void 0&&(e=new en);const i=this.elements;return e.x=i[0],e.y=i[4],e.z=i[8],e}vmult(e,i){i===void 0&&(i=new en);const s=this.elements,o=e.x,c=e.y,g=e.z;return i.x=s[0]*o+s[1]*c+s[2]*g,i.y=s[3]*o+s[4]*c+s[5]*g,i.z=s[6]*o+s[7]*c+s[8]*g,i}smult(e){for(let i=0;i<this.elements.length;i++)this.elements[i]*=e}mmult(e,i){i===void 0&&(i=new cy);const s=this.elements,o=e.elements,c=i.elements,g=s[0],b=s[1],et=s[2],tt=s[3],rt=s[4],st=s[5],at=s[6],ct=s[7],pt=s[8],gt=o[0],At=o[1],xt=o[2],yt=o[3],_t=o[4],Mt=o[5],It=o[6],Bt=o[7],Lt=o[8];return c[0]=g*gt+b*yt+et*It,c[1]=g*At+b*_t+et*Bt,c[2]=g*xt+b*Mt+et*Lt,c[3]=tt*gt+rt*yt+st*It,c[4]=tt*At+rt*_t+st*Bt,c[5]=tt*xt+rt*Mt+st*Lt,c[6]=at*gt+ct*yt+pt*It,c[7]=at*At+ct*_t+pt*Bt,c[8]=at*xt+ct*Mt+pt*Lt,i}scale(e,i){i===void 0&&(i=new cy);const s=this.elements,o=i.elements;for(let c=0;c!==3;c++)o[3*c+0]=e.x*s[3*c+0],o[3*c+1]=e.y*s[3*c+1],o[3*c+2]=e.z*s[3*c+2];return i}solve(e,i){i===void 0&&(i=new en);const s=[];let o,c;for(o=0;o<12;o++)s.push(0);for(o=0;o<3;o++)for(c=0;c<3;c++)s[o+4*c]=this.elements[o+3*c];s[3]=e.x,s[7]=e.y,s[11]=e.z;let g=3;const b=g;let et,tt;do{if(o=b-g,s[o+4*o]===0){for(c=o+1;c<b;c++)if(s[o+4*c]!==0){et=4;do tt=4-et,s[tt+4*o]+=s[tt+4*c];while(--et);break}}if(s[o+4*o]!==0)for(c=o+1;c<b;c++){const rt=s[o+4*c]/s[o+4*o];et=4;do tt=4-et,s[tt+4*c]=tt<=o?0:s[tt+4*c]-s[tt+4*o]*rt;while(--et)}}while(--g);if(i.z=s[11]/s[10],i.y=(s[7]-s[6]*i.z)/s[5],i.x=(s[3]-s[2]*i.z-s[1]*i.y)/s[0],isNaN(i.x)||isNaN(i.y)||isNaN(i.z)||i.x===1/0||i.y===1/0||i.z===1/0)throw`Could not solve equation! Got x=[${i.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return i}e(e,i,s){if(s===void 0)return this.elements[i+3*e];this.elements[i+3*e]=s}copy(e){for(let i=0;i<e.elements.length;i++)this.elements[i]=e.elements[i];return this}toString(){let e="";for(let i=0;i<9;i++)e+=this.elements[i]+",";return e}reverse(e){e===void 0&&(e=new cy);const i=rV;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)i[s+6*o]=this.elements[s+3*o];i[3]=1,i[9]=0,i[15]=0,i[4]=0,i[10]=1,i[16]=0,i[5]=0,i[11]=0,i[17]=1;let c=3;const g=c;let b,et;do{if(s=g-c,i[s+6*s]===0){for(o=s+1;o<g;o++)if(i[s+6*o]!==0){b=6;do et=6-b,i[et+6*s]+=i[et+6*o];while(--b);break}}if(i[s+6*s]!==0)for(o=s+1;o<g;o++){const tt=i[s+6*o]/i[s+6*s];b=6;do et=6-b,i[et+6*o]=et<=s?0:i[et+6*o]-i[et+6*s]*tt;while(--b)}}while(--c);s=2;do{o=s-1;do{const tt=i[s+6*o]/i[s+6*s];b=6;do et=6-b,i[et+6*o]=i[et+6*o]-i[et+6*s]*tt;while(--b)}while(o--)}while(--s);s=2;do{const tt=1/i[s+6*s];b=6;do et=6-b,i[et+6*s]=i[et+6*s]*tt;while(--b)}while(s--);s=2;do{o=2;do{if(et=i[3+o+6*s],isNaN(et)||et===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(s,o,et)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const i=e.x,s=e.y,o=e.z,c=e.w,g=i+i,b=s+s,et=o+o,tt=i*g,rt=i*b,st=i*et,at=s*b,ct=s*et,pt=o*et,gt=c*g,At=c*b,xt=c*et,yt=this.elements;return yt[0]=1-(at+pt),yt[1]=rt-xt,yt[2]=st+At,yt[3]=rt+xt,yt[4]=1-(tt+pt),yt[5]=ct-gt,yt[6]=st-At,yt[7]=ct+gt,yt[8]=1-(tt+at),this}transpose(e){e===void 0&&(e=new cy);const i=this.elements,s=e.elements;let o;return s[0]=i[0],s[4]=i[4],s[8]=i[8],o=i[1],s[1]=i[3],s[3]=o,o=i[2],s[2]=i[6],s[6]=o,o=i[5],s[5]=i[7],s[7]=o,e}}const rV=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class en{constructor(e,i,s){e===void 0&&(e=0),i===void 0&&(i=0),s===void 0&&(s=0),this.x=e,this.y=i,this.z=s}cross(e,i){i===void 0&&(i=new en);const s=e.x,o=e.y,c=e.z,g=this.x,b=this.y,et=this.z;return i.x=b*c-et*o,i.y=et*s-g*c,i.z=g*o-b*s,i}set(e,i,s){return this.x=e,this.y=i,this.z=s,this}setZero(){this.x=this.y=this.z=0}vadd(e,i){if(!i)return new en(this.x+e.x,this.y+e.y,this.z+e.z);i.x=e.x+this.x,i.y=e.y+this.y,i.z=e.z+this.z}vsub(e,i){if(!i)return new en(this.x-e.x,this.y-e.y,this.z-e.z);i.x=this.x-e.x,i.y=this.y-e.y,i.z=this.z-e.z}crossmat(){return new cy([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,i=this.y,s=this.z,o=Math.sqrt(e*e+i*i+s*s);if(o>0){const c=1/o;this.x*=c,this.y*=c,this.z*=c}else this.x=0,this.y=0,this.z=0;return o}unit(e){e===void 0&&(e=new en);const i=this.x,s=this.y,o=this.z;let c=Math.sqrt(i*i+s*s+o*o);return c>0?(c=1/c,e.x=i*c,e.y=s*c,e.z=o*c):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,i=this.y,s=this.z;return Math.sqrt(e*e+i*i+s*s)}lengthSquared(){return this.dot(this)}distanceTo(e){const i=this.x,s=this.y,o=this.z,c=e.x,g=e.y,b=e.z;return Math.sqrt((c-i)*(c-i)+(g-s)*(g-s)+(b-o)*(b-o))}distanceSquared(e){const i=this.x,s=this.y,o=this.z,c=e.x,g=e.y,b=e.z;return(c-i)*(c-i)+(g-s)*(g-s)+(b-o)*(b-o)}scale(e,i){i===void 0&&(i=new en);const s=this.x,o=this.y,c=this.z;return i.x=e*s,i.y=e*o,i.z=e*c,i}vmul(e,i){return i===void 0&&(i=new en),i.x=e.x*this.x,i.y=e.y*this.y,i.z=e.z*this.z,i}addScaledVector(e,i,s){return s===void 0&&(s=new en),s.x=this.x+e*i.x,s.y=this.y+e*i.y,s.z=this.z+e*i.z,s}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new en),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,i){const s=this.length();if(s>0){const o=sV,c=1/s;o.set(this.x*c,this.y*c,this.z*c);const g=oV;Math.abs(o.x)<.9?(g.set(1,0,0),o.cross(g,e)):(g.set(0,1,0),o.cross(g,e)),o.cross(e,i)}else e.set(1,0,0),i.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,i,s){const o=this.x,c=this.y,g=this.z;s.x=o+(e.x-o)*i,s.y=c+(e.y-c)*i,s.z=g+(e.z-g)*i}almostEquals(e,i){return i===void 0&&(i=1e-6),!(Math.abs(this.x-e.x)>i||Math.abs(this.y-e.y)>i||Math.abs(this.z-e.z)>i)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,i){return this.negate($U),$U.almostEquals(e,i)}clone(){return new en(this.x,this.y,this.z)}}en.ZERO=new en(0,0,0),en.UNIT_X=new en(1,0,0),en.UNIT_Y=new en(0,1,0),en.UNIT_Z=new en(0,0,1);const sV=new en,oV=new en,$U=new en;class yu{constructor(e){e===void 0&&(e={}),this.lowerBound=new en,this.upperBound=new en,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,i,s,o){const c=this.lowerBound,g=this.upperBound,b=s;c.copy(e[0]),b&&b.vmult(c,c),g.copy(c);for(let et=1;et<e.length;et++){let tt=e[et];b&&(b.vmult(tt,ZU),tt=ZU),tt.x>g.x&&(g.x=tt.x),tt.x<c.x&&(c.x=tt.x),tt.y>g.y&&(g.y=tt.y),tt.y<c.y&&(c.y=tt.y),tt.z>g.z&&(g.z=tt.z),tt.z<c.z&&(c.z=tt.z)}return i&&(i.vadd(c,c),i.vadd(g,g)),o&&(c.x-=o,c.y-=o,c.z-=o,g.x+=o,g.y+=o,g.z+=o),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new yu().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const i=this.lowerBound,s=this.upperBound,o=e.lowerBound,c=e.upperBound,g=o.x<=s.x&&s.x<=c.x||i.x<=c.x&&c.x<=s.x,b=o.y<=s.y&&s.y<=c.y||i.y<=c.y&&c.y<=s.y,et=o.z<=s.z&&s.z<=c.z||i.z<=c.z&&c.z<=s.z;return g&&b&&et}volume(){const e=this.lowerBound,i=this.upperBound;return(i.x-e.x)*(i.y-e.y)*(i.z-e.z)}contains(e){const i=this.lowerBound,s=this.upperBound,o=e.lowerBound,c=e.upperBound;return i.x<=o.x&&s.x>=c.x&&i.y<=o.y&&s.y>=c.y&&i.z<=o.z&&s.z>=c.z}getCorners(e,i,s,o,c,g,b,et){const tt=this.lowerBound,rt=this.upperBound;e.copy(tt),i.set(rt.x,tt.y,tt.z),s.set(rt.x,rt.y,tt.z),o.set(tt.x,rt.y,rt.z),c.set(rt.x,tt.y,rt.z),g.set(tt.x,rt.y,tt.z),b.set(tt.x,tt.y,rt.z),et.copy(rt)}toLocalFrame(e,i){const s=eF,o=s[0],c=s[1],g=s[2],b=s[3],et=s[4],tt=s[5],rt=s[6],st=s[7];this.getCorners(o,c,g,b,et,tt,rt,st);for(let at=0;at!==8;at++){const ct=s[at];e.pointToLocal(ct,ct)}return i.setFromPoints(s)}toWorldFrame(e,i){const s=eF,o=s[0],c=s[1],g=s[2],b=s[3],et=s[4],tt=s[5],rt=s[6],st=s[7];this.getCorners(o,c,g,b,et,tt,rt,st);for(let at=0;at!==8;at++){const ct=s[at];e.pointToWorld(ct,ct)}return i.setFromPoints(s)}overlapsRay(e){const{direction:i,from:s}=e,o=1/i.x,c=1/i.y,g=1/i.z,b=(this.lowerBound.x-s.x)*o,et=(this.upperBound.x-s.x)*o,tt=(this.lowerBound.y-s.y)*c,rt=(this.upperBound.y-s.y)*c,st=(this.lowerBound.z-s.z)*g,at=(this.upperBound.z-s.z)*g,ct=Math.max(Math.max(Math.min(b,et),Math.min(tt,rt)),Math.min(st,at)),pt=Math.min(Math.min(Math.max(b,et),Math.max(tt,rt)),Math.max(st,at));return!(pt<0||ct>pt)}}const ZU=new en,eF=[new en,new en,new en,new en,new en,new en,new en,new en];class tF{constructor(){this.matrix=[]}get(e,i){let{index:s}=e,{index:o}=i;if(o>s){const c=o;o=s,s=c}return this.matrix[(s*(s+1)>>1)+o-1]}set(e,i,s){let{index:o}=e,{index:c}=i;if(c>o){const g=c;c=o,o=g}this.matrix[(o*(o+1)>>1)+c-1]=s?1:0}reset(){for(let e=0,i=this.matrix.length;e!==i;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class nF{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].includes(i)||s[e].push(i),this}hasEventListener(e,i){if(this._listeners===void 0)return!1;const s=this._listeners;return!(s[e]===void 0||!s[e].includes(i))}hasAnyEventListener(e){return this._listeners!==void 0&&this._listeners[e]!==void 0}removeEventListener(e,i){if(this._listeners===void 0)return this;const s=this._listeners;if(s[e]===void 0)return this;const o=s[e].indexOf(i);return o!==-1&&s[e].splice(o,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;const i=this._listeners[e.type];if(i!==void 0){e.target=this;for(let s=0,o=i.length;s<o;s++)i[s].call(this,e)}return this}}class Iu{constructor(e,i,s,o){e===void 0&&(e=0),i===void 0&&(i=0),s===void 0&&(s=0),o===void 0&&(o=1),this.x=e,this.y=i,this.z=s,this.w=o}set(e,i,s,o){return this.x=e,this.y=i,this.z=s,this.w=o,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,i){const s=Math.sin(.5*i);return this.x=e.x*s,this.y=e.y*s,this.z=e.z*s,this.w=Math.cos(.5*i),this}toAxisAngle(e){e===void 0&&(e=new en),this.normalize();const i=2*Math.acos(this.w),s=Math.sqrt(1-this.w*this.w);return s<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/s,e.y=this.y/s,e.z=this.z/s),[e,i]}setFromVectors(e,i){if(e.isAntiparallelTo(i)){const s=aV,o=lV;e.tangents(s,o),this.setFromAxisAngle(s,Math.PI)}else{const s=e.cross(i);this.x=s.x,this.y=s.y,this.z=s.z,this.w=Math.sqrt(e.length()**2*i.length()**2)+e.dot(i),this.normalize()}return this}mult(e,i){i===void 0&&(i=new Iu);const s=this.x,o=this.y,c=this.z,g=this.w,b=e.x,et=e.y,tt=e.z,rt=e.w;return i.x=s*rt+g*b+o*tt-c*et,i.y=o*rt+g*et+c*b-s*tt,i.z=c*rt+g*tt+s*et-o*b,i.w=g*rt-s*b-o*et-c*tt,i}inverse(e){e===void 0&&(e=new Iu);const i=this.x,s=this.y,o=this.z,c=this.w;this.conjugate(e);const g=1/(i*i+s*s+o*o+c*c);return e.x*=g,e.y*=g,e.z*=g,e.w*=g,e}conjugate(e){return e===void 0&&(e=new Iu),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,i){i===void 0&&(i=new en);const s=e.x,o=e.y,c=e.z,g=this.x,b=this.y,et=this.z,tt=this.w,rt=tt*s+b*c-et*o,st=tt*o+et*s-g*c,at=tt*c+g*o-b*s,ct=-g*s-b*o-et*c;return i.x=rt*tt+ct*-g+st*-et-at*-b,i.y=st*tt+ct*-b+at*-g-rt*-et,i.z=at*tt+ct*-et+rt*-b-st*-g,i}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,i){let s,o,c;i===void 0&&(i="YZX");const g=this.x,b=this.y,et=this.z,tt=this.w;if(i!=="YZX")throw new Error(`Euler order ${i} not supported yet.`);{const rt=g*b+et*tt;if(rt>.499&&(s=2*Math.atan2(g,tt),o=Math.PI/2,c=0),rt<-.499&&(s=-2*Math.atan2(g,tt),o=-Math.PI/2,c=0),s===void 0){const st=g*g,at=b*b,ct=et*et;s=Math.atan2(2*b*tt-2*g*et,1-2*at-2*ct),o=Math.asin(2*rt),c=Math.atan2(2*g*tt-2*b*et,1-2*st-2*ct)}}e.y=s,e.z=o,e.x=c}setFromEuler(e,i,s,o){o===void 0&&(o="XYZ");const c=Math.cos(e/2),g=Math.cos(i/2),b=Math.cos(s/2),et=Math.sin(e/2),tt=Math.sin(i/2),rt=Math.sin(s/2);return o==="XYZ"?(this.x=et*g*b+c*tt*rt,this.y=c*tt*b-et*g*rt,this.z=c*g*rt+et*tt*b,this.w=c*g*b-et*tt*rt):o==="YXZ"?(this.x=et*g*b+c*tt*rt,this.y=c*tt*b-et*g*rt,this.z=c*g*rt-et*tt*b,this.w=c*g*b+et*tt*rt):o==="ZXY"?(this.x=et*g*b-c*tt*rt,this.y=c*tt*b+et*g*rt,this.z=c*g*rt+et*tt*b,this.w=c*g*b-et*tt*rt):o==="ZYX"?(this.x=et*g*b-c*tt*rt,this.y=c*tt*b+et*g*rt,this.z=c*g*rt-et*tt*b,this.w=c*g*b+et*tt*rt):o==="YZX"?(this.x=et*g*b+c*tt*rt,this.y=c*tt*b+et*g*rt,this.z=c*g*rt-et*tt*b,this.w=c*g*b-et*tt*rt):o==="XZY"&&(this.x=et*g*b-c*tt*rt,this.y=c*tt*b-et*g*rt,this.z=c*g*rt+et*tt*b,this.w=c*g*b+et*tt*rt),this}clone(){return new Iu(this.x,this.y,this.z,this.w)}slerp(e,i,s){s===void 0&&(s=new Iu);const o=this.x,c=this.y,g=this.z,b=this.w;let et,tt,rt,st,at,ct=e.x,pt=e.y,gt=e.z,At=e.w;return tt=o*ct+c*pt+g*gt+b*At,tt<0&&(tt=-tt,ct=-ct,pt=-pt,gt=-gt,At=-At),1-tt>1e-6?(et=Math.acos(tt),rt=Math.sin(et),st=Math.sin((1-i)*et)/rt,at=Math.sin(i*et)/rt):(st=1-i,at=i),s.x=st*o+at*ct,s.y=st*c+at*pt,s.z=st*g+at*gt,s.w=st*b+at*At,s}integrate(e,i,s,o){o===void 0&&(o=new Iu);const c=e.x*s.x,g=e.y*s.y,b=e.z*s.z,et=this.x,tt=this.y,rt=this.z,st=this.w,at=.5*i;return o.x+=at*(c*st+g*rt-b*tt),o.y+=at*(g*st+b*et-c*rt),o.z+=at*(b*st+c*tt-g*et),o.w+=at*(-c*et-g*tt-b*rt),o}}const aV=new en,lV=new en;class ps{constructor(e){e===void 0&&(e={}),this.id=ps.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,i){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,i,s,o){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}ps.idCounter=0,ps.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class na{constructor(e){e===void 0&&(e={}),this.position=new en,this.quaternion=new Iu,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,i){return na.pointToLocalFrame(this.position,this.quaternion,e,i)}pointToWorld(e,i){return na.pointToWorldFrame(this.position,this.quaternion,e,i)}vectorToWorldFrame(e,i){return i===void 0&&(i=new en),this.quaternion.vmult(e,i),i}static pointToLocalFrame(e,i,s,o){return o===void 0&&(o=new en),s.vsub(e,o),i.conjugate(iF),iF.vmult(o,o),o}static pointToWorldFrame(e,i,s,o){return o===void 0&&(o=new en),i.vmult(s,o),o.vadd(e,o),o}static vectorToWorldFrame(e,i,s){return s===void 0&&(s=new en),e.vmult(i,s),s}static vectorToLocalFrame(e,i,s,o){return o===void 0&&(o=new en),i.w*=-1,i.vmult(s,o),i.w*=-1,o}}const iF=new Iu;class fS extends ps{constructor(e){e===void 0&&(e={});const{vertices:i=[],faces:s=[],normals:o=[],axes:c,boundingSphereRadius:g}=e;super({type:ps.types.CONVEXPOLYHEDRON}),this.vertices=i,this.faces=s,this.faceNormals=o,this.faceNormals.length===0&&this.computeNormals(),g?this.boundingSphereRadius=g:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=c?c.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,i=this.vertices,s=this.uniqueEdges;s.length=0;const o=new en;for(let c=0;c!==e.length;c++){const g=e[c],b=g.length;for(let et=0;et!==b;et++){const tt=(et+1)%b;i[g[et]].vsub(i[g[tt]],o),o.normalize();let rt=!1;for(let st=0;st!==s.length;st++)if(s[st].almostEquals(o)||s[st].almostEquals(o)){rt=!0;break}rt||s.push(o.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let o=0;o<this.faces[e].length;o++)if(!this.vertices[this.faces[e][o]])throw new Error(`Vertex ${this.faces[e][o]} not found!`);const i=this.faceNormals[e]||new en;this.getFaceNormal(e,i),i.negate(i),this.faceNormals[e]=i;const s=this.vertices[this.faces[e][0]];if(i.dot(s)<0){console.error(`.faceNormals[${e}] = Vec3(${i.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let o=0;o<this.faces[e].length;o++)console.warn(`.vertices[${this.faces[e][o]}] = Vec3(${this.vertices[this.faces[e][o]].toString()})`)}}}getFaceNormal(e,i){const s=this.faces[e],o=this.vertices[s[0]],c=this.vertices[s[1]],g=this.vertices[s[2]];fS.computeNormal(o,c,g,i)}static computeNormal(e,i,s,o){const c=new en,g=new en;i.vsub(e,g),s.vsub(i,c),c.cross(g,o),o.isZero()||o.normalize()}clipAgainstHull(e,i,s,o,c,g,b,et,tt){const rt=new en;let st=-1,at=-Number.MAX_VALUE;for(let pt=0;pt<s.faces.length;pt++){rt.copy(s.faceNormals[pt]),c.vmult(rt,rt);const gt=rt.dot(g);gt>at&&(at=gt,st=pt)}const ct=[];for(let pt=0;pt<s.faces[st].length;pt++){const gt=s.vertices[s.faces[st][pt]],At=new en;At.copy(gt),c.vmult(At,At),o.vadd(At,At),ct.push(At)}st>=0&&this.clipFaceAgainstHull(g,e,i,ct,b,et,tt)}findSeparatingAxis(e,i,s,o,c,g,b,et){const tt=new en,rt=new en,st=new en,at=new en,ct=new en,pt=new en;let gt=Number.MAX_VALUE;const At=this;if(At.uniqueAxes)for(let xt=0;xt!==At.uniqueAxes.length;xt++){s.vmult(At.uniqueAxes[xt],tt);const yt=At.testSepAxis(tt,e,i,s,o,c);if(yt===!1)return!1;yt<gt&&(gt=yt,g.copy(tt))}else{const xt=b?b.length:At.faces.length;for(let yt=0;yt<xt;yt++){const _t=b?b[yt]:yt;tt.copy(At.faceNormals[_t]),s.vmult(tt,tt);const Mt=At.testSepAxis(tt,e,i,s,o,c);if(Mt===!1)return!1;Mt<gt&&(gt=Mt,g.copy(tt))}}if(e.uniqueAxes)for(let xt=0;xt!==e.uniqueAxes.length;xt++){c.vmult(e.uniqueAxes[xt],rt);const yt=At.testSepAxis(rt,e,i,s,o,c);if(yt===!1)return!1;yt<gt&&(gt=yt,g.copy(rt))}else{const xt=et?et.length:e.faces.length;for(let yt=0;yt<xt;yt++){const _t=et?et[yt]:yt;rt.copy(e.faceNormals[_t]),c.vmult(rt,rt);const Mt=At.testSepAxis(rt,e,i,s,o,c);if(Mt===!1)return!1;Mt<gt&&(gt=Mt,g.copy(rt))}}for(let xt=0;xt!==At.uniqueEdges.length;xt++){s.vmult(At.uniqueEdges[xt],at);for(let yt=0;yt!==e.uniqueEdges.length;yt++)if(c.vmult(e.uniqueEdges[yt],ct),at.cross(ct,pt),!pt.almostZero()){pt.normalize();const _t=At.testSepAxis(pt,e,i,s,o,c);if(_t===!1)return!1;_t<gt&&(gt=_t,g.copy(pt))}}return o.vsub(i,st),st.dot(g)>0&&g.negate(g),!0}testSepAxis(e,i,s,o,c,g){fS.project(this,e,s,o,_L),fS.project(i,e,c,g,yL);const b=_L[0],et=_L[1],tt=yL[0],rt=yL[1];if(b<rt||tt<et)return!1;const st=b-rt,at=tt-et;return st<at?st:at}calculateLocalInertia(e,i){const s=new en,o=new en;this.computeLocalAABB(o,s);const c=s.x-o.x,g=s.y-o.y,b=s.z-o.z;i.x=1/12*e*(2*g*2*g+2*b*2*b),i.y=1/12*e*(2*c*2*c+2*b*2*b),i.z=1/12*e*(2*g*2*g+2*c*2*c)}getPlaneConstantOfFace(e){const i=this.faces[e],s=this.faceNormals[e],o=this.vertices[i[0]];return-s.dot(o)}clipFaceAgainstHull(e,i,s,o,c,g,b){const et=new en,tt=new en,rt=new en,st=new en,at=new en,ct=new en,pt=new en,gt=new en,At=this,xt=o,yt=[];let _t=-1,Mt=Number.MAX_VALUE;for(let Jt=0;Jt<At.faces.length;Jt++){et.copy(At.faceNormals[Jt]),s.vmult(et,et);const sn=et.dot(e);sn<Mt&&(Mt=sn,_t=Jt)}if(_t<0)return;const It=At.faces[_t];It.connectedFaces=[];for(let Jt=0;Jt<At.faces.length;Jt++)for(let sn=0;sn<At.faces[Jt].length;sn++)It.indexOf(At.faces[Jt][sn])!==-1&&Jt!==_t&&It.connectedFaces.indexOf(Jt)===-1&&It.connectedFaces.push(Jt);const Bt=It.length;for(let Jt=0;Jt<Bt;Jt++){const sn=At.vertices[It[Jt]],on=At.vertices[It[(Jt+1)%Bt]];sn.vsub(on,tt),rt.copy(tt),s.vmult(rt,rt),i.vadd(rt,rt),st.copy(this.faceNormals[_t]),s.vmult(st,st),i.vadd(st,st),rt.cross(st,at),at.negate(at),ct.copy(sn),s.vmult(ct,ct),i.vadd(ct,ct);const mn=It.connectedFaces[Jt];pt.copy(this.faceNormals[mn]);const cn=this.getPlaneConstantOfFace(mn);gt.copy(pt),s.vmult(gt,gt);const un=cn-gt.dot(i);for(this.clipFaceAgainstPlane(xt,yt,gt,un);xt.length;)xt.shift();for(;yt.length;)xt.push(yt.shift())}pt.copy(this.faceNormals[_t]);const Lt=this.getPlaneConstantOfFace(_t);gt.copy(pt),s.vmult(gt,gt);const Ht=Lt-gt.dot(i);for(let Jt=0;Jt<xt.length;Jt++){let sn=gt.dot(xt[Jt])+Ht;if(sn<=c&&(console.log(`clamped: depth=${sn} to minDist=${c}`),sn=c),sn<=g){const on=xt[Jt];if(sn<=1e-6){const mn={point:on,normal:gt,depth:sn};b.push(mn)}}}}clipFaceAgainstPlane(e,i,s,o){let c,g;const b=e.length;if(b<2)return i;let et=e[e.length-1],tt=e[0];c=s.dot(et)+o;for(let rt=0;rt<b;rt++){if(tt=e[rt],g=s.dot(tt)+o,c<0)if(g<0){const st=new en;st.copy(tt),i.push(st)}else{const st=new en;et.lerp(tt,c/(c-g),st),i.push(st)}else if(g<0){const st=new en;et.lerp(tt,c/(c-g),st),i.push(st),i.push(tt)}et=tt,c=g}return i}computeWorldVertices(e,i){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new en);const s=this.vertices,o=this.worldVertices;for(let c=0;c!==this.vertices.length;c++)i.vmult(s[c],o[c]),e.vadd(o[c],o[c]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,i){const s=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let o=0;o<this.vertices.length;o++){const c=s[o];c.x<e.x?e.x=c.x:c.x>i.x&&(i.x=c.x),c.y<e.y?e.y=c.y:c.y>i.y&&(i.y=c.y),c.z<e.z?e.z=c.z:c.z>i.z&&(i.z=c.z)}}computeWorldFaceNormals(e){const i=this.faceNormals.length;for(;this.worldFaceNormals.length<i;)this.worldFaceNormals.push(new en);const s=this.faceNormals,o=this.worldFaceNormals;for(let c=0;c!==i;c++)e.vmult(s[c],o[c]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const i=this.vertices;for(let s=0;s!==i.length;s++){const o=i[s].lengthSquared();o>e&&(e=o)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,i,s,o){const c=this.vertices;let g,b,et,tt,rt,st,at=new en;for(let ct=0;ct<c.length;ct++){at.copy(c[ct]),i.vmult(at,at),e.vadd(at,at);const pt=at;(g===void 0||pt.x<g)&&(g=pt.x),(tt===void 0||pt.x>tt)&&(tt=pt.x),(b===void 0||pt.y<b)&&(b=pt.y),(rt===void 0||pt.y>rt)&&(rt=pt.y),(et===void 0||pt.z<et)&&(et=pt.z),(st===void 0||pt.z>st)&&(st=pt.z)}s.set(g,b,et),o.set(tt,rt,st)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){e===void 0&&(e=new en);const i=this.vertices;for(let s=0;s<i.length;s++)e.vadd(i[s],e);return e.scale(1/i.length,e),e}transformAllPoints(e,i){const s=this.vertices.length,o=this.vertices;if(i){for(let c=0;c<s;c++){const g=o[c];i.vmult(g,g)}for(let c=0;c<this.faceNormals.length;c++){const g=this.faceNormals[c];i.vmult(g,g)}}if(e)for(let c=0;c<s;c++){const g=o[c];g.vadd(e,g)}}pointIsInside(e){const i=this.vertices,s=this.faces,o=this.faceNormals,c=new en;this.getAveragePointLocal(c);for(let g=0;g<this.faces.length;g++){let b=o[g];const et=i[s[g][0]],tt=new en;e.vsub(et,tt);const rt=b.dot(tt),st=new en;c.vsub(et,st);const at=b.dot(st);if(rt<0&&at>0||rt>0&&at<0)return!1}return-1}static project(e,i,s,o,c){const g=e.vertices.length,b=cV;let et=0,tt=0;const rt=uV,st=e.vertices;rt.setZero(),na.vectorToLocalFrame(s,o,i,b),na.pointToLocalFrame(s,o,rt,rt);const at=rt.dot(b);tt=et=st[0].dot(b);for(let ct=1;ct<g;ct++){const pt=st[ct].dot(b);pt>et&&(et=pt),pt<tt&&(tt=pt)}if(tt-=at,et-=at,tt>et){const ct=tt;tt=et,et=ct}c[0]=et,c[1]=tt}}const _L=[],yL=[],cV=(new en,new en),uV=new en;class rD extends ps{constructor(e){super({type:ps.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,i=this.halfExtents.y,s=this.halfExtents.z,o=en,c=[new o(-e,-i,-s),new o(e,-i,-s),new o(e,i,-s),new o(-e,i,-s),new o(-e,-i,s),new o(e,-i,s),new o(e,i,s),new o(-e,i,s)],g=[new o(0,0,1),new o(0,1,0),new o(1,0,0)],b=new fS({vertices:c,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:g});this.convexPolyhedronRepresentation=b,b.material=this.material}calculateLocalInertia(e,i){return i===void 0&&(i=new en),rD.calculateInertia(this.halfExtents,e,i),i}static calculateInertia(e,i,s){const o=e;s.x=1/12*i*(2*o.y*2*o.y+2*o.z*2*o.z),s.y=1/12*i*(2*o.x*2*o.x+2*o.z*2*o.z),s.z=1/12*i*(2*o.y*2*o.y+2*o.x*2*o.x)}getSideNormals(e,i){const s=e,o=this.halfExtents;if(s[0].set(o.x,0,0),s[1].set(0,o.y,0),s[2].set(0,0,o.z),s[3].set(-o.x,0,0),s[4].set(0,-o.y,0),s[5].set(0,0,-o.z),i!==void 0)for(let c=0;c!==s.length;c++)i.vmult(s[c],s[c]);return s}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,i,s){const o=this.halfExtents,c=[[o.x,o.y,o.z],[-o.x,o.y,o.z],[-o.x,-o.y,o.z],[-o.x,-o.y,-o.z],[o.x,-o.y,-o.z],[o.x,o.y,-o.z],[-o.x,o.y,-o.z],[o.x,-o.y,o.z]];for(let g=0;g<c.length;g++)C1.set(c[g][0],c[g][1],c[g][2]),i.vmult(C1,C1),e.vadd(C1,C1),s(C1.x,C1.y,C1.z)}calculateWorldAABB(e,i,s,o){const c=this.halfExtents;CA[0].set(c.x,c.y,c.z),CA[1].set(-c.x,c.y,c.z),CA[2].set(-c.x,-c.y,c.z),CA[3].set(-c.x,-c.y,-c.z),CA[4].set(c.x,-c.y,-c.z),CA[5].set(c.x,c.y,-c.z),CA[6].set(-c.x,c.y,-c.z),CA[7].set(c.x,-c.y,c.z);const g=CA[0];i.vmult(g,g),e.vadd(g,g),o.copy(g),s.copy(g);for(let b=1;b<8;b++){const et=CA[b];i.vmult(et,et),e.vadd(et,et);const tt=et.x,rt=et.y,st=et.z;tt>o.x&&(o.x=tt),rt>o.y&&(o.y=rt),st>o.z&&(o.z=st),tt<s.x&&(s.x=tt),rt<s.y&&(s.y=rt),st<s.z&&(s.z=st)}}}const C1=new en,CA=[new en,new en,new en,new en,new en,new en,new en,new en];class vs extends nF{constructor(e){e===void 0&&(e={}),super(),this.id=vs.idCounter++,this.index=-1,this.world=null,this.vlambda=new en,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse!="boolean"||e.collisionResponse,this.position=new en,this.previousPosition=new en,this.interpolatedPosition=new en,this.initPosition=new en,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new en,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new en,this.force=new en;const i=typeof e.mass=="number"?e.mass:0;this.mass=i,this.invMass=i>0?1/i:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=i<=0?vs.STATIC:vs.DYNAMIC,typeof e.type==typeof vs.STATIC&&(this.type=e.type),this.allowSleep=e.allowSleep===void 0||e.allowSleep,this.sleepState=vs.AWAKE,this.sleepSpeedLimit=e.sleepSpeedLimit!==void 0?e.sleepSpeedLimit:.1,this.sleepTimeLimit=e.sleepTimeLimit!==void 0?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new en,this.quaternion=new Iu,this.initQuaternion=new Iu,this.previousQuaternion=new Iu,this.interpolatedQuaternion=new Iu,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new en,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new en,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new en,this.invInertia=new en,this.invInertiaWorld=new cy,this.invMassSolve=0,this.invInertiaSolve=new en,this.invInertiaWorldSolve=new cy,this.fixedRotation=e.fixedRotation!==void 0&&e.fixedRotation,this.angularDamping=e.angularDamping!==void 0?e.angularDamping:.01,this.linearFactor=new en(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new en(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new yu,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new en,this.isTrigger=!!e.isTrigger,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=vs.AWAKE,this.wakeUpAfterNarrowphase=!1,e===vs.SLEEPING&&this.dispatchEvent(vs.wakeupEvent)}sleep(){this.sleepState=vs.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const i=this.sleepState,s=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),o=this.sleepSpeedLimit**2;i===vs.AWAKE&&s<o?(this.sleepState=vs.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(vs.sleepyEvent)):i===vs.SLEEPY&&s>o?this.wakeUp():i===vs.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(vs.sleepEvent))}}updateSolveMassProperties(){this.sleepState===vs.SLEEPING||this.type===vs.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,i){return i===void 0&&(i=new en),e.vsub(this.position,i),this.quaternion.conjugate().vmult(i,i),i}vectorToLocalFrame(e,i){return i===void 0&&(i=new en),this.quaternion.conjugate().vmult(e,i),i}pointToWorldFrame(e,i){return i===void 0&&(i=new en),this.quaternion.vmult(e,i),i.vadd(this.position,i),i}vectorToWorldFrame(e,i){return i===void 0&&(i=new en),this.quaternion.vmult(e,i),i}addShape(e,i,s){const o=new en,c=new Iu;return i&&o.copy(i),s&&c.copy(s),this.shapes.push(e),this.shapeOffsets.push(o),this.shapeOrientations.push(c),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const i=this.shapes.indexOf(e);return i===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(i,1),this.shapeOffsets.splice(i,1),this.shapeOrientations.splice(i,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,i=this.shapeOffsets,s=e.length;let o=0;for(let c=0;c!==s;c++){const g=e[c];g.updateBoundingSphereRadius();const b=i[c].length(),et=g.boundingSphereRadius;b+et>o&&(o=b+et)}this.boundingRadius=o}updateAABB(){const e=this.shapes,i=this.shapeOffsets,s=this.shapeOrientations,o=e.length,c=hV,g=dV,b=this.quaternion,et=this.aabb,tt=pV;for(let rt=0;rt!==o;rt++){const st=e[rt];b.vmult(i[rt],c),c.vadd(this.position,c),b.mult(s[rt],g),st.calculateWorldAABB(c,g,tt.lowerBound,tt.upperBound),rt===0?et.copy(tt):et.extend(tt)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const i=this.invInertia;if(i.x!==i.y||i.y!==i.z||e){const s=fV,o=mV;s.setRotationFromQuaternion(this.quaternion),s.transpose(o),s.scale(i,s),s.mmult(o,this.invInertiaWorld)}}applyForce(e,i){if(i===void 0&&(i=new en),this.type!==vs.DYNAMIC)return;this.sleepState===vs.SLEEPING&&this.wakeUp();const s=gV;i.cross(e,s),this.force.vadd(e,this.force),this.torque.vadd(s,this.torque)}applyLocalForce(e,i){if(i===void 0&&(i=new en),this.type!==vs.DYNAMIC)return;const s=vV,o=_V;this.vectorToWorldFrame(e,s),this.vectorToWorldFrame(i,o),this.applyForce(s,o)}applyTorque(e){this.type===vs.DYNAMIC&&(this.sleepState===vs.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,i){if(i===void 0&&(i=new en),this.type!==vs.DYNAMIC)return;this.sleepState===vs.SLEEPING&&this.wakeUp();const s=i,o=yV;o.copy(e),o.scale(this.invMass,o),this.velocity.vadd(o,this.velocity);const c=AV;s.cross(e,c),this.invInertiaWorld.vmult(c,c),this.angularVelocity.vadd(c,this.angularVelocity)}applyLocalImpulse(e,i){if(i===void 0&&(i=new en),this.type!==vs.DYNAMIC)return;const s=bV,o=wV;this.vectorToWorldFrame(e,s),this.vectorToWorldFrame(i,o),this.applyImpulse(s,o)}updateMassProperties(){const e=xV;this.invMass=this.mass>0?1/this.mass:0;const i=this.inertia,s=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),rD.calculateInertia(e,this.mass,i),this.invInertia.set(i.x>0&&!s?1/i.x:0,i.y>0&&!s?1/i.y:0,i.z>0&&!s?1/i.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,i){const s=new en;return e.vsub(this.position,s),this.angularVelocity.cross(s,i),this.velocity.vadd(i,i),i}integrate(e,i,s){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==vs.DYNAMIC&&this.type!==vs.KINEMATIC||this.sleepState===vs.SLEEPING)return;const o=this.velocity,c=this.angularVelocity,g=this.position,b=this.force,et=this.torque,tt=this.quaternion,rt=this.invMass,st=this.invInertiaWorld,at=this.linearFactor,ct=rt*e;o.x+=b.x*ct*at.x,o.y+=b.y*ct*at.y,o.z+=b.z*ct*at.z;const pt=st.elements,gt=this.angularFactor,At=et.x*gt.x,xt=et.y*gt.y,yt=et.z*gt.z;c.x+=e*(pt[0]*At+pt[1]*xt+pt[2]*yt),c.y+=e*(pt[3]*At+pt[4]*xt+pt[5]*yt),c.z+=e*(pt[6]*At+pt[7]*xt+pt[8]*yt),g.x+=o.x*e,g.y+=o.y*e,g.z+=o.z*e,tt.integrate(this.angularVelocity,e,this.angularFactor,tt),i&&(s?tt.normalizeFast():tt.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}vs.idCounter=0,vs.COLLIDE_EVENT_NAME="collide",vs.DYNAMIC=1,vs.STATIC=2,vs.KINEMATIC=4,vs.AWAKE=0,vs.SLEEPY=1,vs.SLEEPING=2,vs.wakeupEvent={type:"wakeup"},vs.sleepyEvent={type:"sleepy"},vs.sleepEvent={type:"sleep"};const hV=new en,dV=new Iu,pV=new yu,fV=new cy,mV=new cy,gV=(new cy,new en),vV=new en,_V=new en,yV=new en,AV=new en,bV=new en,wV=new en,xV=new en;class EV{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,i,s){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,i){return(e.collisionFilterGroup&i.collisionFilterMask)!=0&&(i.collisionFilterGroup&e.collisionFilterMask)!=0&&((e.type&vs.STATIC)==0&&e.sleepState!==vs.SLEEPING||(i.type&vs.STATIC)==0&&i.sleepState!==vs.SLEEPING)}intersectionTest(e,i,s,o){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,i,s,o):this.doBoundingSphereBroadphase(e,i,s,o)}doBoundingSphereBroadphase(e,i,s,o){const c=SV;i.position.vsub(e.position,c);const g=(e.boundingRadius+i.boundingRadius)**2;c.lengthSquared()<g&&(s.push(e),o.push(i))}doBoundingBoxBroadphase(e,i,s,o){e.aabbNeedsUpdate&&e.updateAABB(),i.aabbNeedsUpdate&&i.updateAABB(),e.aabb.overlaps(i.aabb)&&(s.push(e),o.push(i))}makePairsUnique(e,i){const s=CV,o=MV,c=TV,g=e.length;for(let b=0;b!==g;b++)o[b]=e[b],c[b]=i[b];e.length=0,i.length=0;for(let b=0;b!==g;b++){const et=o[b].id,tt=c[b].id,rt=et<tt?`${et},${tt}`:`${tt},${et}`;s[rt]=b,s.keys.push(rt)}for(let b=0;b!==s.keys.length;b++){const et=s.keys.pop(),tt=s[et];e.push(o[tt]),i.push(c[tt]),delete s[et]}}setWorld(e){}static boundingSphereCheck(e,i){const s=new en;e.position.vsub(i.position,s);const o=e.shapes[0],c=i.shapes[0];return Math.pow(o.boundingSphereRadius+c.boundingSphereRadius,2)>s.lengthSquared()}aabbQuery(e,i,s){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const SV=new en;new en,new Iu,new en;const CV={keys:[]},MV=[],TV=[];new en,new en,new en;class IV extends EV{constructor(){super()}collisionPairs(e,i,s){const o=e.bodies,c=o.length;let g,b;for(let et=0;et!==c;et++)for(let tt=0;tt!==et;tt++)g=o[et],b=o[tt],this.needBroadphaseCollision(g,b)&&this.intersectionTest(g,b,i,s)}aabbQuery(e,i,s){s===void 0&&(s=[]);for(let o=0;o<e.bodies.length;o++){const c=e.bodies[o];c.aabbNeedsUpdate&&c.updateAABB(),c.aabb.overlaps(i)&&s.push(c)}return s}}class sD{constructor(){this.rayFromWorld=new en,this.rayToWorld=new en,this.hitNormalWorld=new en,this.hitPointWorld=new en,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,i,s,o,c,g,b){this.rayFromWorld.copy(e),this.rayToWorld.copy(i),this.hitNormalWorld.copy(s),this.hitPointWorld.copy(o),this.shape=c,this.body=g,this.distance=b}}let rF,sF,oF,aF,lF,cF,uF;rF=ps.types.SPHERE,sF=ps.types.PLANE,oF=ps.types.BOX,aF=ps.types.CYLINDER,lF=ps.types.CONVEXPOLYHEDRON,cF=ps.types.HEIGHTFIELD,uF=ps.types.TRIMESH;class vp{get[rF](){return this._intersectSphere}get[sF](){return this._intersectPlane}get[oF](){return this._intersectBox}get[aF](){return this._intersectConvex}get[lF](){return this._intersectConvex}get[cF](){return this._intersectHeightfield}get[uF](){return this._intersectTrimesh}constructor(e,i){e===void 0&&(e=new en),i===void 0&&(i=new en),this.from=e.clone(),this.to=i.clone(),this.direction=new en,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=vp.ANY,this.result=new sD,this.hasHit=!1,this.callback=s=>{}}intersectWorld(e,i){return this.mode=i.mode||vp.ANY,this.result=i.result||new sD,this.skipBackfaces=!!i.skipBackfaces,this.collisionFilterMask=i.collisionFilterMask!==void 0?i.collisionFilterMask:-1,this.collisionFilterGroup=i.collisionFilterGroup!==void 0?i.collisionFilterGroup:-1,this.checkCollisionResponse=i.checkCollisionResponse===void 0||i.checkCollisionResponse,i.from&&this.from.copy(i.from),i.to&&this.to.copy(i.to),this.callback=i.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(hF),AL.length=0,e.broadphase.aabbQuery(e,hF,AL),this.intersectBodies(AL),this.hasHit}intersectBody(e,i){i&&(this.result=i,this.updateDirection());const s=this.checkCollisionResponse;if(s&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const o=PV,c=RV;for(let g=0,b=e.shapes.length;g<b;g++){const et=e.shapes[g];if((!s||et.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[g],c),e.quaternion.vmult(e.shapeOffsets[g],o),o.vadd(e.position,o),this.intersectShape(et,c,o,e),this.result.shouldStop))break}}intersectBodies(e,i){i&&(this.result=i,this.updateDirection());for(let s=0,o=e.length;!this.result.shouldStop&&s<o;s++)this.intersectBody(e[s])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,i,s,o){if(function(b,et,tt){tt.vsub(b,mS);const rt=mS.dot(et);return et.scale(rt,aD),aD.vadd(b,aD),tt.distanceTo(aD)}(this.from,this.direction,s)>e.boundingSphereRadius)return;const g=this[e.type];g&&g.call(this,e,i,s,o,e)}_intersectBox(e,i,s,o,c){return this._intersectConvex(e.convexPolyhedronRepresentation,i,s,o,c)}_intersectPlane(e,i,s,o,c){const g=this.from,b=this.to,et=this.direction,tt=new en(0,0,1);i.vmult(tt,tt);const rt=new en;g.vsub(s,rt);const st=rt.dot(tt);if(b.vsub(s,rt),st*rt.dot(tt)>0||g.distanceTo(b)<st)return;const at=tt.dot(et);if(Math.abs(at)<this.precision)return;const ct=new en,pt=new en,gt=new en;g.vsub(s,ct);const At=-tt.dot(ct)/at;et.scale(At,pt),g.vadd(pt,gt),this.reportIntersection(tt,gt,c,o,-1)}getAABB(e){const{lowerBound:i,upperBound:s}=e,o=this.to,c=this.from;i.x=Math.min(o.x,c.x),i.y=Math.min(o.y,c.y),i.z=Math.min(o.z,c.z),s.x=Math.max(o.x,c.x),s.y=Math.max(o.y,c.y),s.z=Math.max(o.z,c.z)}_intersectHeightfield(e,i,s,o,c){e.data,e.elementSize;const g=DV;g.from.copy(this.from),g.to.copy(this.to),na.pointToLocalFrame(s,i,g.from,g.from),na.pointToLocalFrame(s,i,g.to,g.to),g.updateDirection();const b=kV;let et,tt,rt,st;et=tt=0,rt=st=e.data.length-1;const at=new yu;g.getAABB(at),e.getIndexOfPosition(at.lowerBound.x,at.lowerBound.y,b,!0),et=Math.max(et,b[0]),tt=Math.max(tt,b[1]),e.getIndexOfPosition(at.upperBound.x,at.upperBound.y,b,!0),rt=Math.min(rt,b[0]+1),st=Math.min(st,b[1]+1);for(let ct=et;ct<rt;ct++)for(let pt=tt;pt<st;pt++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(ct,pt,at),at.overlapsRay(g)){if(e.getConvexTrianglePillar(ct,pt,!1),na.pointToWorldFrame(s,i,e.pillarOffset,oD),this._intersectConvex(e.pillarConvex,i,oD,o,c,dF),this.result.shouldStop)return;e.getConvexTrianglePillar(ct,pt,!0),na.pointToWorldFrame(s,i,e.pillarOffset,oD),this._intersectConvex(e.pillarConvex,i,oD,o,c,dF)}}}_intersectSphere(e,i,s,o,c){const g=this.from,b=this.to,et=e.radius,tt=(b.x-g.x)**2+(b.y-g.y)**2+(b.z-g.z)**2,rt=2*((b.x-g.x)*(g.x-s.x)+(b.y-g.y)*(g.y-s.y)+(b.z-g.z)*(g.z-s.z)),st=rt**2-4*tt*((g.x-s.x)**2+(g.y-s.y)**2+(g.z-s.z)**2-et**2),at=BV,ct=OV;if(!(st<0))if(st===0)g.lerp(b,st,at),at.vsub(s,ct),ct.normalize(),this.reportIntersection(ct,at,c,o,-1);else{const pt=(-rt-Math.sqrt(st))/(2*tt),gt=(-rt+Math.sqrt(st))/(2*tt);if(pt>=0&&pt<=1&&(g.lerp(b,pt,at),at.vsub(s,ct),ct.normalize(),this.reportIntersection(ct,at,c,o,-1)),this.result.shouldStop)return;gt>=0&&gt<=1&&(g.lerp(b,gt,at),at.vsub(s,ct),ct.normalize(),this.reportIntersection(ct,at,c,o,-1))}}_intersectConvex(e,i,s,o,c,g){const b=LV,et=pF,tt=g&&g.faceList||null,rt=e.faces,st=e.vertices,at=e.faceNormals,ct=this.direction,pt=this.from,gt=this.to,At=pt.distanceTo(gt),xt=tt?tt.length:rt.length,yt=this.result;for(let _t=0;!yt.shouldStop&&_t<xt;_t++){const Mt=tt?tt[_t]:_t,It=rt[Mt],Bt=at[Mt],Lt=i,Ht=s;et.copy(st[It[0]]),Lt.vmult(et,et),et.vadd(Ht,et),et.vsub(pt,et),Lt.vmult(Bt,b);const Jt=ct.dot(b);if(Math.abs(Jt)<this.precision)continue;const sn=b.dot(et)/Jt;if(!(sn<0)){ct.scale(sn,e_),e_.vadd(pt,e_),uy.copy(st[It[0]]),Lt.vmult(uy,uy),Ht.vadd(uy,uy);for(let on=1;!yt.shouldStop&&on<It.length-1;on++){MA.copy(st[It[on]]),TA.copy(st[It[on+1]]),Lt.vmult(MA,MA),Lt.vmult(TA,TA),Ht.vadd(MA,MA),Ht.vadd(TA,TA);const mn=e_.distanceTo(pt);!vp.pointInTriangle(e_,uy,MA,TA)&&!vp.pointInTriangle(e_,MA,uy,TA)||mn>At||this.reportIntersection(b,e_,c,o,Mt)}}}}_intersectTrimesh(e,i,s,o,c,g){const b=NV,et=GV,tt=HV,rt=pF,st=UV,at=FV,ct=jV,pt=VV,gt=zV,At=e.indices;e.vertices;const xt=this.from,yt=this.to,_t=this.direction;tt.position.copy(s),tt.quaternion.copy(i),na.vectorToLocalFrame(s,i,_t,st),na.pointToLocalFrame(s,i,xt,at),na.pointToLocalFrame(s,i,yt,ct),ct.x*=e.scale.x,ct.y*=e.scale.y,ct.z*=e.scale.z,at.x*=e.scale.x,at.y*=e.scale.y,at.z*=e.scale.z,ct.vsub(at,st),st.normalize();const Mt=at.distanceSquared(ct);e.tree.rayQuery(this,tt,et);for(let It=0,Bt=et.length;!this.result.shouldStop&&It!==Bt;It++){const Lt=et[It];e.getNormal(Lt,b),e.getVertex(At[3*Lt],uy),uy.vsub(at,rt);const Ht=st.dot(b),Jt=b.dot(rt)/Ht;if(Jt<0)continue;st.scale(Jt,e_),e_.vadd(at,e_),e.getVertex(At[3*Lt+1],MA),e.getVertex(At[3*Lt+2],TA);const sn=e_.distanceSquared(at);!vp.pointInTriangle(e_,MA,uy,TA)&&!vp.pointInTriangle(e_,uy,MA,TA)||sn>Mt||(na.vectorToWorldFrame(i,b,gt),na.pointToWorldFrame(s,i,e_,pt),this.reportIntersection(gt,pt,c,o,Lt))}et.length=0}reportIntersection(e,i,s,o,c){const g=this.from,b=this.to,et=g.distanceTo(i),tt=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(tt.hitFaceIndex=c!==void 0?c:-1,this.mode){case vp.ALL:this.hasHit=!0,tt.set(g,b,e,i,s,o,et),tt.hasHit=!0,this.callback(tt);break;case vp.CLOSEST:(et<tt.distance||!tt.hasHit)&&(this.hasHit=!0,tt.hasHit=!0,tt.set(g,b,e,i,s,o,et));break;case vp.ANY:this.hasHit=!0,tt.hasHit=!0,tt.set(g,b,e,i,s,o,et),tt.shouldStop=!0}}static pointInTriangle(e,i,s,o){o.vsub(i,mS),s.vsub(i,GI),e.vsub(i,bL);const c=mS.dot(mS),g=mS.dot(GI),b=mS.dot(bL),et=GI.dot(GI),tt=GI.dot(bL);let rt,st;return(rt=et*b-g*tt)>=0&&(st=c*tt-g*b)>=0&&rt+st<c*et-g*g}}vp.CLOSEST=1,vp.ANY=2,vp.ALL=4;const hF=new yu,AL=[],GI=new en,bL=new en,PV=new en,RV=new Iu,e_=new en,uy=new en,MA=new en,TA=new en;new en,new sD;const dF={faceList:[0]},oD=new en,DV=new vp,kV=[],BV=new en,OV=new en,LV=new en,pF=(new en,new en,new en),NV=new en,UV=new en,FV=new en,jV=new en,zV=new en,VV=new en;new yu;const GV=[],HV=new na,mS=new en,aD=new en;class fF{static defaults(e,i){e===void 0&&(e={});for(let s in i)s in e||(e[s]=i[s]);return e}}class lD{constructor(e,i,s){s===void 0&&(s={}),s=fF.defaults(s,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=i,this.id=lD.idCounter++,this.collideConnected=s.collideConnected,s.wakeUpBodies&&(e&&e.wakeUp(),i&&i.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const e=this.equations;for(let i=0;i<e.length;i++)e[i].enabled=!0}disable(){const e=this.equations;for(let i=0;i<e.length;i++)e[i].enabled=!1}}lD.idCounter=0;class mF{constructor(){this.spatial=new en,this.rotational=new en}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,i){return e.dot(this.spatial)+i.dot(this.rotational)}}class HI{constructor(e,i,s,o){s===void 0&&(s=-1e6),o===void 0&&(o=1e6),this.id=HI.idCounter++,this.minForce=s,this.maxForce=o,this.bi=e,this.bj=i,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new mF,this.jacobianElementB=new mF,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,i,s){const o=i,c=e,g=s;this.a=4/(g*(1+4*o)),this.b=4*o/(1+4*o),this.eps=4/(g*g*c*(1+4*o))}computeB(e,i,s){const o=this.computeGW();return-this.computeGq()*e-o*i-this.computeGiMf()*s}computeGq(){const e=this.jacobianElementA,i=this.jacobianElementB,s=this.bi,o=this.bj,c=s.position,g=o.position;return e.spatial.dot(c)+i.spatial.dot(g)}computeGW(){const e=this.jacobianElementA,i=this.jacobianElementB,s=this.bi,o=this.bj,c=s.velocity,g=o.velocity,b=s.angularVelocity,et=o.angularVelocity;return e.multiplyVectors(c,b)+i.multiplyVectors(g,et)}computeGWlambda(){const e=this.jacobianElementA,i=this.jacobianElementB,s=this.bi,o=this.bj,c=s.vlambda,g=o.vlambda,b=s.wlambda,et=o.wlambda;return e.multiplyVectors(c,b)+i.multiplyVectors(g,et)}computeGiMf(){const e=this.jacobianElementA,i=this.jacobianElementB,s=this.bi,o=this.bj,c=s.force,g=s.torque,b=o.force,et=o.torque,tt=s.invMassSolve,rt=o.invMassSolve;return c.scale(tt,gF),b.scale(rt,vF),s.invInertiaWorldSolve.vmult(g,_F),o.invInertiaWorldSolve.vmult(et,yF),e.multiplyVectors(gF,_F)+i.multiplyVectors(vF,yF)}computeGiMGt(){const e=this.jacobianElementA,i=this.jacobianElementB,s=this.bi,o=this.bj,c=s.invMassSolve,g=o.invMassSolve,b=s.invInertiaWorldSolve,et=o.invInertiaWorldSolve;let tt=c+g;return b.vmult(e.rotational,cD),tt+=cD.dot(e.rotational),et.vmult(i.rotational,cD),tt+=cD.dot(i.rotational),tt}addToWlambda(e){const i=this.jacobianElementA,s=this.jacobianElementB,o=this.bi,c=this.bj,g=QV;o.vlambda.addScaledVector(o.invMassSolve*e,i.spatial,o.vlambda),c.vlambda.addScaledVector(c.invMassSolve*e,s.spatial,c.vlambda),o.invInertiaWorldSolve.vmult(i.rotational,g),o.wlambda.addScaledVector(e,g,o.wlambda),c.invInertiaWorldSolve.vmult(s.rotational,g),c.wlambda.addScaledVector(e,g,c.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}HI.idCounter=0;const gF=new en,vF=new en,_F=new en,yF=new en,cD=new en,QV=new en;class uD extends HI{constructor(e,i,s){s===void 0&&(s=1e6),super(e,i,0,s),this.restitution=0,this.ri=new en,this.rj=new en,this.ni=new en}computeB(e){const i=this.a,s=this.b,o=this.bi,c=this.bj,g=this.ri,b=this.rj,et=WV,tt=qV,rt=o.velocity,st=o.angularVelocity;o.force,o.torque;const at=c.velocity,ct=c.angularVelocity;c.force,c.torque;const pt=XV,gt=this.jacobianElementA,At=this.jacobianElementB,xt=this.ni;g.cross(xt,et),b.cross(xt,tt),xt.negate(gt.spatial),et.negate(gt.rotational),At.spatial.copy(xt),At.rotational.copy(tt),pt.copy(c.position),pt.vadd(b,pt),pt.vsub(o.position,pt),pt.vsub(g,pt);const yt=xt.dot(pt),_t=this.restitution+1;return-yt*i-(_t*at.dot(xt)-_t*rt.dot(xt)+ct.dot(tt)-st.dot(et))*s-e*this.computeGiMf()}getImpactVelocityAlongNormal(){const e=YV,i=KV,s=JV,o=$V,c=ZV;return this.bi.position.vadd(this.ri,s),this.bj.position.vadd(this.rj,o),this.bi.getVelocityAtWorldPoint(s,e),this.bj.getVelocityAtWorldPoint(o,i),e.vsub(i,c),this.ni.dot(c)}}const WV=new en,qV=new en,XV=new en,YV=new en,KV=new en,JV=new en,$V=new en,ZV=new en;class eG extends lD{constructor(e,i,s,o,c){i===void 0&&(i=new en),o===void 0&&(o=new en),c===void 0&&(c=1e6),super(e,s),this.pivotA=i.clone(),this.pivotB=o.clone();const g=this.equationX=new uD(e,s),b=this.equationY=new uD(e,s),et=this.equationZ=new uD(e,s);this.equations.push(g,b,et),g.minForce=b.minForce=et.minForce=-c,g.maxForce=b.maxForce=et.maxForce=c,g.ni.set(1,0,0),b.ni.set(0,1,0),et.ni.set(0,0,1)}update(){const e=this.bodyA,i=this.bodyB,s=this.equationX,o=this.equationY,c=this.equationZ;e.quaternion.vmult(this.pivotA,s.ri),i.quaternion.vmult(this.pivotB,s.rj),o.ri.copy(s.ri),o.rj.copy(s.rj),c.ri.copy(s.ri),c.rj.copy(s.rj)}}new en,new en,new en,new en,new en,new en,new en,new en,new en,new en;class AF extends HI{constructor(e,i,s){super(e,i,-s,s),this.ri=new en,this.rj=new en,this.t=new en}computeB(e){this.a;const i=this.b;this.bi,this.bj;const s=this.ri,o=this.rj,c=tG,g=nG,b=this.t;s.cross(b,c),o.cross(b,g);const et=this.jacobianElementA,tt=this.jacobianElementB;return b.negate(et.spatial),c.negate(et.rotational),tt.spatial.copy(b),tt.rotational.copy(g),-this.computeGW()*i-e*this.computeGiMf()}}const tG=new en,nG=new en;class hD{constructor(e,i,s){s=fF.defaults(s,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=hD.idCounter++,this.materials=[e,i],this.friction=s.friction,this.restitution=s.restitution,this.contactEquationStiffness=s.contactEquationStiffness,this.contactEquationRelaxation=s.contactEquationRelaxation,this.frictionEquationStiffness=s.frictionEquationStiffness,this.frictionEquationRelaxation=s.frictionEquationRelaxation}}hD.idCounter=0;class dD{constructor(e){e===void 0&&(e={});let i="";typeof e=="string"&&(i=e,e={}),this.name=i,this.id=dD.idCounter++,this.friction=e.friction!==void 0?e.friction:-1,this.restitution=e.restitution!==void 0?e.restitution:-1}}dD.idCounter=0,new en,new en,new en,new en,new en,new en,new en,new en,new en,new en,new en,new en,new en,new en,new en,new en,new en,new en,new en,new vp,new en,new en,new en,new en(1,0,0),new en(0,1,0),new en(0,0,1),new en,new en,new en,new en,new en,new en,new en,new en,new en,new en,new en;class bF extends ps{constructor(e){if(super({type:ps.types.SPHERE}),this.radius=e!==void 0?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,i){i===void 0&&(i=new en);const s=2*e*this.radius*this.radius/5;return i.x=s,i.y=s,i.z=s,i}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,i,s,o){const c=this.radius,g=["x","y","z"];for(let b=0;b<g.length;b++){const et=g[b];s[et]=e[et]-c,o[et]=e[et]+c}}}new en,new en,new en,new en,new en,new en,new en,new en,new en;class iG extends fS{constructor(e,i,s,o){if(e===void 0&&(e=1),i===void 0&&(i=1),s===void 0&&(s=1),o===void 0&&(o=8),e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(i<0)throw new Error("The cylinder radiusBottom cannot be negative.");const c=o,g=[],b=[],et=[],tt=[],rt=[],st=Math.cos,at=Math.sin;g.push(new en(-i*at(0),.5*-s,i*st(0))),tt.push(0),g.push(new en(-e*at(0),.5*s,e*st(0))),rt.push(1);for(let pt=0;pt<c;pt++){const gt=2*Math.PI/c*(pt+1),At=2*Math.PI/c*(pt+.5);pt<c-1?(g.push(new en(-i*at(gt),.5*-s,i*st(gt))),tt.push(2*pt+2),g.push(new en(-e*at(gt),.5*s,e*st(gt))),rt.push(2*pt+3),et.push([2*pt,2*pt+1,2*pt+3,2*pt+2])):et.push([2*pt,2*pt+1,1,0]),(c%2==1||pt<c/2)&&b.push(new en(-at(At),0,st(At)))}et.push(tt),b.push(new en(0,1,0));const ct=[];for(let pt=0;pt<rt.length;pt++)ct.push(rt[rt.length-pt-1]);et.push(ct),super({vertices:g,faces:et,axes:b}),this.type=ps.types.CYLINDER,this.radiusTop=e,this.radiusBottom=i,this.height=s,this.numSegments=o}}class rG extends ps{constructor(){super({type:ps.types.PLANE}),this.worldNormal=new en,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const i=this.worldNormal;i.set(0,0,1),e.vmult(i,i),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,i){return i===void 0&&(i=new en),i}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,i,s,o){Gw.set(0,0,1),i.vmult(Gw,Gw);const c=Number.MAX_VALUE;s.set(-c,-c,-c),o.set(c,c,c),Gw.x===1?o.x=e.x:Gw.x===-1&&(s.x=e.x),Gw.y===1?o.y=e.y:Gw.y===-1&&(s.y=e.y),Gw.z===1?o.z=e.z:Gw.z===-1&&(s.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const Gw=new en;new en,new en,new en,new en,new en,new en,new en,new en,new en;class IA{constructor(e){e===void 0&&(e={}),this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new yu,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,i,s){s===void 0&&(s=0);const o=this.data;if(!this.aabb.contains(e))return!1;const c=this.children;if(s<(this.maxDepth||this.root.maxDepth)){let g=!1;c.length||(this.subdivide(),g=!0);for(let b=0;b!==8;b++)if(c[b].insert(e,i,s+1))return!0;g&&(c.length=0)}return o.push(i),!0}subdivide(){const e=this.aabb,i=e.lowerBound,s=e.upperBound,o=this.children;o.push(new IA({aabb:new yu({lowerBound:new en(0,0,0)})}),new IA({aabb:new yu({lowerBound:new en(1,0,0)})}),new IA({aabb:new yu({lowerBound:new en(1,1,0)})}),new IA({aabb:new yu({lowerBound:new en(1,1,1)})}),new IA({aabb:new yu({lowerBound:new en(0,1,1)})}),new IA({aabb:new yu({lowerBound:new en(0,0,1)})}),new IA({aabb:new yu({lowerBound:new en(1,0,1)})}),new IA({aabb:new yu({lowerBound:new en(0,1,0)})})),s.vsub(i,gS),gS.scale(.5,gS);const c=this.root||this;for(let g=0;g!==8;g++){const b=o[g];b.root=c;const et=b.aabb.lowerBound;et.x*=gS.x,et.y*=gS.y,et.z*=gS.z,et.vadd(i,et),et.vadd(gS,b.aabb.upperBound)}}aabbQuery(e,i){this.data,this.children;const s=[this];for(;s.length;){const o=s.pop();o.aabb.overlaps(e)&&Array.prototype.push.apply(i,o.data),Array.prototype.push.apply(s,o.children)}return i}rayQuery(e,i,s){return e.getAABB(pD),pD.toLocalFrame(i,pD),this.aabbQuery(pD,s),s}removeEmptyNodes(){for(let e=this.children.length-1;e>=0;e--)this.children[e].removeEmptyNodes(),this.children[e].children.length||this.children[e].data.length||this.children.splice(e,1)}}class sG extends IA{constructor(e,i){i===void 0&&(i={}),super({root:null,aabb:e}),this.maxDepth=i.maxDepth!==void 0?i.maxDepth:8}}const gS=new en,pD=new yu;class fD extends ps{constructor(e,i){super({type:ps.types.TRIMESH}),this.vertices=new Float32Array(e),this.indices=new Int16Array(i),this.normals=new Float32Array(i.length),this.aabb=new yu,this.edges=null,this.scale=new en(1,1,1),this.tree=new sG,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const e=this.tree;e.reset(),e.aabb.copy(this.aabb);const i=this.scale;e.aabb.lowerBound.x*=1/i.x,e.aabb.lowerBound.y*=1/i.y,e.aabb.lowerBound.z*=1/i.z,e.aabb.upperBound.x*=1/i.x,e.aabb.upperBound.y*=1/i.y,e.aabb.upperBound.z*=1/i.z;const s=new yu,o=new en,c=new en,g=new en,b=[o,c,g];for(let et=0;et<this.indices.length/3;et++){const tt=3*et;this._getUnscaledVertex(this.indices[tt],o),this._getUnscaledVertex(this.indices[tt+1],c),this._getUnscaledVertex(this.indices[tt+2],g),s.setFromPoints(b),e.insert(s,et)}e.removeEmptyNodes()}getTrianglesInAABB(e,i){mD.copy(e);const s=this.scale,o=s.x,c=s.y,g=s.z,b=mD.lowerBound,et=mD.upperBound;return b.x/=o,b.y/=c,b.z/=g,et.x/=o,et.y/=c,et.z/=g,this.tree.aabbQuery(mD,i)}setScale(e){const i=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,s=e.x===e.y&&e.y===e.z;i&&s||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const e=oG,i=this.normals;for(let s=0;s<this.indices.length/3;s++){const o=3*s,c=this.indices[o],g=this.indices[o+1],b=this.indices[o+2];this.getVertex(c,EF),this.getVertex(g,SF),this.getVertex(b,CF),fD.computeNormal(SF,EF,CF,e),i[o]=e.x,i[o+1]=e.y,i[o+2]=e.z}}updateEdges(){const e={},i=(o,c)=>{e[o<c?`${o}_${c}`:`${c}_${o}`]=!0};for(let o=0;o<this.indices.length/3;o++){const c=3*o,g=this.indices[c],b=this.indices[c+1],et=this.indices[c+2];i(g,b),i(b,et),i(et,g)}const s=Object.keys(e);this.edges=new Int16Array(2*s.length);for(let o=0;o<s.length;o++){const c=s[o].split("_");this.edges[2*o]=parseInt(c[0],10),this.edges[2*o+1]=parseInt(c[1],10)}}getEdgeVertex(e,i,s){const o=this.edges[2*e+(i?1:0)];this.getVertex(o,s)}getEdgeVector(e,i){const s=aG,o=lG;this.getEdgeVertex(e,0,s),this.getEdgeVertex(e,1,o),o.vsub(s,i)}static computeNormal(e,i,s,o){i.vsub(e,xF),s.vsub(i,wF),wF.cross(xF,o),o.isZero()||o.normalize()}getVertex(e,i){const s=this.scale;return this._getUnscaledVertex(e,i),i.x*=s.x,i.y*=s.y,i.z*=s.z,i}_getUnscaledVertex(e,i){const s=3*e,o=this.vertices;return i.set(o[s],o[s+1],o[s+2])}getWorldVertex(e,i,s,o){return this.getVertex(e,o),na.pointToWorldFrame(i,s,o,o),o}getTriangleVertices(e,i,s,o){const c=3*e;this.getVertex(this.indices[c],i),this.getVertex(this.indices[c+1],s),this.getVertex(this.indices[c+2],o)}getNormal(e,i){const s=3*e;return i.set(this.normals[s],this.normals[s+1],this.normals[s+2])}calculateLocalInertia(e,i){this.computeLocalAABB(vS);const s=vS.upperBound.x-vS.lowerBound.x,o=vS.upperBound.y-vS.lowerBound.y,c=vS.upperBound.z-vS.lowerBound.z;return i.set(1/12*e*(2*o*2*o+2*c*2*c),1/12*e*(2*s*2*s+2*c*2*c),1/12*e*(2*o*2*o+2*s*2*s))}computeLocalAABB(e){const i=e.lowerBound,s=e.upperBound,o=this.vertices.length;this.vertices;const c=cG;this.getVertex(0,c),i.copy(c),s.copy(c);for(let g=0;g!==o;g++)this.getVertex(g,c),c.x<i.x?i.x=c.x:c.x>s.x&&(s.x=c.x),c.y<i.y?i.y=c.y:c.y>s.y&&(s.y=c.y),c.z<i.z?i.z=c.z:c.z>s.z&&(s.z=c.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0;const i=this.vertices,s=new en;for(let o=0,c=i.length/3;o!==c;o++){this.getVertex(o,s);const g=s.lengthSquared();g>e&&(e=g)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,i,s,o){const c=uG,g=hG;c.position=e,c.quaternion=i,this.aabb.toWorldFrame(c,g),s.copy(g.lowerBound),o.copy(g.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(e,i,s,o,c){e===void 0&&(e=1),i===void 0&&(i=.5),s===void 0&&(s=8),o===void 0&&(o=6),c===void 0&&(c=2*Math.PI);const g=[],b=[];for(let et=0;et<=s;et++)for(let tt=0;tt<=o;tt++){const rt=tt/o*c,st=et/s*Math.PI*2,at=(e+i*Math.cos(st))*Math.cos(rt),ct=(e+i*Math.cos(st))*Math.sin(rt),pt=i*Math.sin(st);g.push(at,ct,pt)}for(let et=1;et<=s;et++)for(let tt=1;tt<=o;tt++){const rt=(o+1)*et+tt-1,st=(o+1)*(et-1)+tt-1,at=(o+1)*(et-1)+tt,ct=(o+1)*et+tt;b.push(rt,st,ct),b.push(st,at,ct)}return new fD(g,b)}}const oG=new en,mD=new yu,aG=new en,lG=new en,wF=new en,xF=new en,EF=new en,SF=new en,CF=new en,vS=new yu,cG=new en,uG=new na,hG=new yu;class dG{constructor(){this.equations=[]}solve(e,i){return 0}addEquation(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}removeEquation(e){const i=this.equations,s=i.indexOf(e);s!==-1&&i.splice(s,1)}removeAllEquations(){this.equations.length=0}}class pG extends dG{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,i){let s=0;const o=this.iterations,c=this.tolerance*this.tolerance,g=this.equations,b=g.length,et=i.bodies,tt=et.length,rt=e;let st,at,ct,pt,gt,At;if(b!==0)for(let Mt=0;Mt!==tt;Mt++)et[Mt].updateSolveMassProperties();const xt=mG,yt=gG,_t=fG;xt.length=b,yt.length=b,_t.length=b;for(let Mt=0;Mt!==b;Mt++){const It=g[Mt];_t[Mt]=0,yt[Mt]=It.computeB(rt),xt[Mt]=1/It.computeC()}if(b!==0){for(let Bt=0;Bt!==tt;Bt++){const Lt=et[Bt],Ht=Lt.vlambda,Jt=Lt.wlambda;Ht.set(0,0,0),Jt.set(0,0,0)}for(s=0;s!==o;s++){pt=0;for(let Bt=0;Bt!==b;Bt++){const Lt=g[Bt];st=yt[Bt],at=xt[Bt],At=_t[Bt],gt=Lt.computeGWlambda(),ct=at*(st-gt-Lt.eps*At),At+ct<Lt.minForce?ct=Lt.minForce-At:At+ct>Lt.maxForce&&(ct=Lt.maxForce-At),_t[Bt]+=ct,pt+=ct>0?ct:-ct,Lt.addToWlambda(ct)}if(pt*pt<c)break}for(let Bt=0;Bt!==tt;Bt++){const Lt=et[Bt],Ht=Lt.velocity,Jt=Lt.angularVelocity;Lt.vlambda.vmul(Lt.linearFactor,Lt.vlambda),Ht.vadd(Lt.vlambda,Ht),Lt.wlambda.vmul(Lt.angularFactor,Lt.wlambda),Jt.vadd(Lt.wlambda,Jt)}let Mt=g.length;const It=1/rt;for(;Mt--;)g[Mt].multiplier=_t[Mt]*It}return s}}const fG=[],mG=[],gG=[];vs.STATIC;class vG{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let i=0;i!==e;i++)this.objects.push(i<0||arguments.length<=i?void 0:arguments[i]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const i=this.objects;for(;i.length>e;)i.pop();for(;i.length<e;)i.push(this.constructObject());return this}}class _G extends vG{constructor(){super(...arguments),this.type=en}constructObject(){return new en}}const yG=ps.types.SPHERE,AG=ps.types.SPHERE|ps.types.PLANE,bG=ps.types.BOX|ps.types.BOX,wG=ps.types.SPHERE|ps.types.BOX,xG=ps.types.PLANE|ps.types.BOX,EG=ps.types.CONVEXPOLYHEDRON,SG=ps.types.SPHERE|ps.types.CONVEXPOLYHEDRON,CG=ps.types.PLANE|ps.types.CONVEXPOLYHEDRON,MG=ps.types.BOX|ps.types.CONVEXPOLYHEDRON,TG=ps.types.SPHERE|ps.types.HEIGHTFIELD,IG=ps.types.BOX|ps.types.HEIGHTFIELD,PG=ps.types.CONVEXPOLYHEDRON|ps.types.HEIGHTFIELD,RG=ps.types.PARTICLE|ps.types.SPHERE,DG=ps.types.PLANE|ps.types.PARTICLE,kG=ps.types.BOX|ps.types.PARTICLE,BG=ps.types.PARTICLE|ps.types.CONVEXPOLYHEDRON,OG=ps.types.CYLINDER,LG=ps.types.SPHERE|ps.types.CYLINDER,NG=ps.types.PLANE|ps.types.CYLINDER,UG=ps.types.BOX|ps.types.CYLINDER,FG=ps.types.CONVEXPOLYHEDRON|ps.types.CYLINDER,jG=ps.types.HEIGHTFIELD|ps.types.CYLINDER,zG=ps.types.PARTICLE|ps.types.CYLINDER,VG=ps.types.SPHERE|ps.types.TRIMESH,GG=ps.types.PLANE|ps.types.TRIMESH;class HG{get[yG](){return this.sphereSphere}get[AG](){return this.spherePlane}get[bG](){return this.boxBox}get[wG](){return this.sphereBox}get[xG](){return this.planeBox}get[EG](){return this.convexConvex}get[SG](){return this.sphereConvex}get[CG](){return this.planeConvex}get[MG](){return this.boxConvex}get[TG](){return this.sphereHeightfield}get[IG](){return this.boxHeightfield}get[PG](){return this.convexHeightfield}get[RG](){return this.sphereParticle}get[DG](){return this.planeParticle}get[kG](){return this.boxParticle}get[BG](){return this.convexParticle}get[OG](){return this.convexConvex}get[LG](){return this.sphereConvex}get[NG](){return this.planeConvex}get[UG](){return this.boxConvex}get[FG](){return this.convexConvex}get[jG](){return this.heightfieldCylinder}get[zG](){return this.particleCylinder}get[VG](){return this.sphereTrimesh}get[GG](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new _G,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,i,s,o,c,g){let b;this.contactPointPool.length?(b=this.contactPointPool.pop(),b.bi=e,b.bj=i):b=new uD(e,i),b.enabled=e.collisionResponse&&i.collisionResponse&&s.collisionResponse&&o.collisionResponse;const et=this.currentContactMaterial;b.restitution=et.restitution,b.setSpookParams(et.contactEquationStiffness,et.contactEquationRelaxation,this.world.dt);const tt=s.material||e.material,rt=o.material||i.material;return tt&&rt&&tt.restitution>=0&&rt.restitution>=0&&(b.restitution=tt.restitution*rt.restitution),b.si=c||s,b.sj=g||o,b}createFrictionEquationsFromContact(e,i){const s=e.bi,o=e.bj,c=e.si,g=e.sj,b=this.world,et=this.currentContactMaterial;let tt=et.friction;const rt=c.material||s.material,st=g.material||o.material;if(rt&&st&&rt.friction>=0&&st.friction>=0&&(tt=rt.friction*st.friction),tt>0){const at=tt*b.gravity.length();let ct=s.invMass+o.invMass;ct>0&&(ct=1/ct);const pt=this.frictionEquationPool,gt=pt.length?pt.pop():new AF(s,o,at*ct),At=pt.length?pt.pop():new AF(s,o,at*ct);return gt.bi=At.bi=s,gt.bj=At.bj=o,gt.minForce=At.minForce=-at*ct,gt.maxForce=At.maxForce=at*ct,gt.ri.copy(e.ri),gt.rj.copy(e.rj),At.ri.copy(e.ri),At.rj.copy(e.rj),e.ni.tangents(gt.t,At.t),gt.setSpookParams(et.frictionEquationStiffness,et.frictionEquationRelaxation,b.dt),At.setSpookParams(et.frictionEquationStiffness,et.frictionEquationRelaxation,b.dt),gt.enabled=At.enabled=e.enabled,i.push(gt,At),!0}return!1}createFrictionFromAverage(e){let i=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(i,this.frictionResult)||e===1)return;const s=this.frictionResult[this.frictionResult.length-2],o=this.frictionResult[this.frictionResult.length-1];_S.setZero(),IM.setZero(),PM.setZero();const c=i.bi;i.bj;for(let b=0;b!==e;b++)i=this.result[this.result.length-1-b],i.bi!==c?(_S.vadd(i.ni,_S),IM.vadd(i.ri,IM),PM.vadd(i.rj,PM)):(_S.vsub(i.ni,_S),IM.vadd(i.rj,IM),PM.vadd(i.ri,PM));const g=1/e;IM.scale(g,s.ri),PM.scale(g,s.rj),o.ri.copy(s.ri),o.rj.copy(s.rj),_S.normalize(),_S.tangents(s.t,o.t)}getContacts(e,i,s,o,c,g,b){this.contactPointPool=c,this.frictionEquationPool=b,this.result=o,this.frictionResult=g;const et=qG,tt=XG,rt=QG,st=WG;for(let at=0,ct=e.length;at!==ct;at++){const pt=e[at],gt=i[at];let At=null;pt.material&&gt.material&&(At=s.getContactMaterial(pt.material,gt.material)||null);const xt=pt.type&vs.KINEMATIC&&gt.type&vs.STATIC||pt.type&vs.STATIC&&gt.type&vs.KINEMATIC||pt.type&vs.KINEMATIC&&gt.type&vs.KINEMATIC;for(let yt=0;yt<pt.shapes.length;yt++){pt.quaternion.mult(pt.shapeOrientations[yt],et),pt.quaternion.vmult(pt.shapeOffsets[yt],rt),rt.vadd(pt.position,rt);const _t=pt.shapes[yt];for(let Mt=0;Mt<gt.shapes.length;Mt++){gt.quaternion.mult(gt.shapeOrientations[Mt],tt),gt.quaternion.vmult(gt.shapeOffsets[Mt],st),st.vadd(gt.position,st);const It=gt.shapes[Mt];if(!(_t.collisionFilterMask&It.collisionFilterGroup&&It.collisionFilterMask&_t.collisionFilterGroup)||rt.distanceTo(st)>_t.boundingSphereRadius+It.boundingSphereRadius)continue;let Bt=null;_t.material&&It.material&&(Bt=s.getContactMaterial(_t.material,It.material)||null),this.currentContactMaterial=Bt||At||s.defaultContactMaterial;const Lt=this[_t.type|It.type];if(Lt){let Ht=!1;Ht=_t.type<It.type?Lt.call(this,_t,It,rt,st,et,tt,pt,gt,_t,It,xt):Lt.call(this,It,_t,st,rt,tt,et,gt,pt,_t,It,xt),Ht&&xt&&(s.shapeOverlapKeeper.set(_t.id,It.id),s.bodyOverlapKeeper.set(pt.id,gt.id))}}}}}sphereSphere(e,i,s,o,c,g,b,et,tt,rt,st){if(st)return s.distanceSquared(o)<(e.radius+i.radius)**2;const at=this.createContactEquation(b,et,e,i,tt,rt);o.vsub(s,at.ni),at.ni.normalize(),at.ri.copy(at.ni),at.rj.copy(at.ni),at.ri.scale(e.radius,at.ri),at.rj.scale(-i.radius,at.rj),at.ri.vadd(s,at.ri),at.ri.vsub(b.position,at.ri),at.rj.vadd(o,at.rj),at.rj.vsub(et.position,at.rj),this.result.push(at),this.createFrictionEquationsFromContact(at,this.frictionResult)}spherePlane(e,i,s,o,c,g,b,et,tt,rt,st){const at=this.createContactEquation(b,et,e,i,tt,rt);if(at.ni.set(0,0,1),g.vmult(at.ni,at.ni),at.ni.negate(at.ni),at.ni.normalize(),at.ni.scale(e.radius,at.ri),s.vsub(o,gD),at.ni.scale(at.ni.dot(gD),MF),gD.vsub(MF,at.rj),-gD.dot(at.ni)<=e.radius){if(st)return!0;const ct=at.ri,pt=at.rj;ct.vadd(s,ct),ct.vsub(b.position,ct),pt.vadd(o,pt),pt.vsub(et.position,pt),this.result.push(at),this.createFrictionEquationsFromContact(at,this.frictionResult)}}boxBox(e,i,s,o,c,g,b,et,tt,rt,st){return e.convexPolyhedronRepresentation.material=e.material,i.convexPolyhedronRepresentation.material=i.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,i.convexPolyhedronRepresentation,s,o,c,g,b,et,e,i,st)}sphereBox(e,i,s,o,c,g,b,et,tt,rt,st){const at=this.v3pool,ct=A6;s.vsub(o,vD),i.getSideNormals(ct,g);const pt=e.radius;let gt=!1;const At=w6,xt=x6,yt=E6;let _t=null,Mt=0,It=0,Bt=0,Lt=null;for(let xn=0,Cn=ct.length;xn!==Cn&&gt===!1;xn++){const Jn=v6;Jn.copy(ct[xn]);const Kn=Jn.length();Jn.normalize();const gr=vD.dot(Jn);if(gr<Kn+pt&&gr>0){const nr=_6,tr=y6;nr.copy(ct[(xn+1)%3]),tr.copy(ct[(xn+2)%3]);const Cr=nr.length(),Ar=tr.length();nr.normalize(),tr.normalize();const Hr=vD.dot(nr),Jr=vD.dot(tr);if(Hr<Cr&&Hr>-Cr&&Jr<Ar&&Jr>-Ar){const cs=Math.abs(gr-Kn-pt);if((Lt===null||cs<Lt)&&(Lt=cs,It=Hr,Bt=Jr,_t=Kn,At.copy(Jn),xt.copy(nr),yt.copy(tr),Mt++,st))return!0}}}if(Mt){gt=!0;const xn=this.createContactEquation(b,et,e,i,tt,rt);At.scale(-pt,xn.ri),xn.ni.copy(At),xn.ni.negate(xn.ni),At.scale(_t,At),xt.scale(It,xt),At.vadd(xt,At),yt.scale(Bt,yt),At.vadd(yt,xn.rj),xn.ri.vadd(s,xn.ri),xn.ri.vsub(b.position,xn.ri),xn.rj.vadd(o,xn.rj),xn.rj.vsub(et.position,xn.rj),this.result.push(xn),this.createFrictionEquationsFromContact(xn,this.frictionResult)}let Ht=at.get();const Jt=b6;for(let xn=0;xn!==2&&!gt;xn++)for(let Cn=0;Cn!==2&&!gt;Cn++)for(let Jn=0;Jn!==2&&!gt;Jn++)if(Ht.set(0,0,0),xn?Ht.vadd(ct[0],Ht):Ht.vsub(ct[0],Ht),Cn?Ht.vadd(ct[1],Ht):Ht.vsub(ct[1],Ht),Jn?Ht.vadd(ct[2],Ht):Ht.vsub(ct[2],Ht),o.vadd(Ht,Jt),Jt.vsub(s,Jt),Jt.lengthSquared()<pt*pt){if(st)return!0;gt=!0;const Kn=this.createContactEquation(b,et,e,i,tt,rt);Kn.ri.copy(Jt),Kn.ri.normalize(),Kn.ni.copy(Kn.ri),Kn.ri.scale(pt,Kn.ri),Kn.rj.copy(Ht),Kn.ri.vadd(s,Kn.ri),Kn.ri.vsub(b.position,Kn.ri),Kn.rj.vadd(o,Kn.rj),Kn.rj.vsub(et.position,Kn.rj),this.result.push(Kn),this.createFrictionEquationsFromContact(Kn,this.frictionResult)}at.release(Ht),Ht=null;const sn=at.get(),on=at.get(),mn=at.get(),cn=at.get(),un=at.get(),bn=ct.length;for(let xn=0;xn!==bn&&!gt;xn++)for(let Cn=0;Cn!==bn&&!gt;Cn++)if(xn%3!=Cn%3){ct[Cn].cross(ct[xn],sn),sn.normalize(),ct[xn].vadd(ct[Cn],on),mn.copy(s),mn.vsub(on,mn),mn.vsub(o,mn);const Jn=mn.dot(sn);sn.scale(Jn,cn);let Kn=0;for(;Kn===xn%3||Kn===Cn%3;)Kn++;un.copy(s),un.vsub(cn,un),un.vsub(on,un),un.vsub(o,un);const gr=Math.abs(Jn),nr=un.length();if(gr<ct[Kn].length()&&nr<pt){if(st)return!0;gt=!0;const tr=this.createContactEquation(b,et,e,i,tt,rt);on.vadd(cn,tr.rj),tr.rj.copy(tr.rj),un.negate(tr.ni),tr.ni.normalize(),tr.ri.copy(tr.rj),tr.ri.vadd(o,tr.ri),tr.ri.vsub(s,tr.ri),tr.ri.normalize(),tr.ri.scale(pt,tr.ri),tr.ri.vadd(s,tr.ri),tr.ri.vsub(b.position,tr.ri),tr.rj.vadd(o,tr.rj),tr.rj.vsub(et.position,tr.rj),this.result.push(tr),this.createFrictionEquationsFromContact(tr,this.frictionResult)}}at.release(sn,on,mn,cn,un)}planeBox(e,i,s,o,c,g,b,et,tt,rt,st){return i.convexPolyhedronRepresentation.material=i.material,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,i.convexPolyhedronRepresentation.id=i.id,this.planeConvex(e,i.convexPolyhedronRepresentation,s,o,c,g,b,et,e,i,st)}convexConvex(e,i,s,o,c,g,b,et,tt,rt,st,at,ct){const pt=F6;if(!(s.distanceTo(o)>e.boundingSphereRadius+i.boundingSphereRadius)&&e.findSeparatingAxis(i,s,c,o,g,pt,at,ct)){const gt=[],At=j6;e.clipAgainstHull(s,c,i,o,g,pt,-100,100,gt);let xt=0;for(let yt=0;yt!==gt.length;yt++){if(st)return!0;const _t=this.createContactEquation(b,et,e,i,tt,rt),Mt=_t.ri,It=_t.rj;pt.negate(_t.ni),gt[yt].normal.negate(At),At.scale(gt[yt].depth,At),gt[yt].point.vadd(At,Mt),It.copy(gt[yt].point),Mt.vsub(s,Mt),It.vsub(o,It),Mt.vadd(s,Mt),Mt.vsub(b.position,Mt),It.vadd(o,It),It.vsub(et.position,It),this.result.push(_t),xt++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(_t,this.frictionResult)}this.enableFrictionReduction&&xt&&this.createFrictionFromAverage(xt)}}sphereConvex(e,i,s,o,c,g,b,et,tt,rt,st){const at=this.v3pool;s.vsub(o,S6);const ct=i.faceNormals,pt=i.faces,gt=i.vertices,At=e.radius;let xt=!1;for(let yt=0;yt!==gt.length;yt++){const _t=gt[yt],Mt=I6;g.vmult(_t,Mt),o.vadd(Mt,Mt);const It=T6;if(Mt.vsub(s,It),It.lengthSquared()<At*At){if(st)return!0;xt=!0;const Bt=this.createContactEquation(b,et,e,i,tt,rt);return Bt.ri.copy(It),Bt.ri.normalize(),Bt.ni.copy(Bt.ri),Bt.ri.scale(At,Bt.ri),Mt.vsub(o,Bt.rj),Bt.ri.vadd(s,Bt.ri),Bt.ri.vsub(b.position,Bt.ri),Bt.rj.vadd(o,Bt.rj),Bt.rj.vsub(et.position,Bt.rj),this.result.push(Bt),void this.createFrictionEquationsFromContact(Bt,this.frictionResult)}}for(let yt=0,_t=pt.length;yt!==_t&&xt===!1;yt++){const Mt=ct[yt],It=pt[yt],Bt=P6;g.vmult(Mt,Bt);const Lt=R6;g.vmult(gt[It[0]],Lt),Lt.vadd(o,Lt);const Ht=D6;Bt.scale(-At,Ht),s.vadd(Ht,Ht);const Jt=k6;Ht.vsub(Lt,Jt);const sn=Jt.dot(Bt),on=B6;if(s.vsub(Lt,on),sn<0&&on.dot(Bt)>0){const mn=[];for(let cn=0,un=It.length;cn!==un;cn++){const bn=at.get();g.vmult(gt[It[cn]],bn),o.vadd(bn,bn),mn.push(bn)}if(g6(mn,Bt,s)){if(st)return!0;xt=!0;const cn=this.createContactEquation(b,et,e,i,tt,rt);Bt.scale(-At,cn.ri),Bt.negate(cn.ni);const un=at.get();Bt.scale(-sn,un);const bn=at.get();Bt.scale(-At,bn),s.vsub(o,cn.rj),cn.rj.vadd(bn,cn.rj),cn.rj.vadd(un,cn.rj),cn.rj.vadd(o,cn.rj),cn.rj.vsub(et.position,cn.rj),cn.ri.vadd(s,cn.ri),cn.ri.vsub(b.position,cn.ri),at.release(un),at.release(bn),this.result.push(cn),this.createFrictionEquationsFromContact(cn,this.frictionResult);for(let xn=0,Cn=mn.length;xn!==Cn;xn++)at.release(mn[xn]);return}for(let cn=0;cn!==It.length;cn++){const un=at.get(),bn=at.get();g.vmult(gt[It[(cn+1)%It.length]],un),g.vmult(gt[It[(cn+2)%It.length]],bn),o.vadd(un,un),o.vadd(bn,bn);const xn=C6;bn.vsub(un,xn);const Cn=M6;xn.unit(Cn);const Jn=at.get(),Kn=at.get();s.vsub(un,Kn);const gr=Kn.dot(Cn);Cn.scale(gr,Jn),Jn.vadd(un,Jn);const nr=at.get();if(Jn.vsub(s,nr),gr>0&&gr*gr<xn.lengthSquared()&&nr.lengthSquared()<At*At){if(st)return!0;const tr=this.createContactEquation(b,et,e,i,tt,rt);Jn.vsub(o,tr.rj),Jn.vsub(s,tr.ni),tr.ni.normalize(),tr.ni.scale(At,tr.ri),tr.rj.vadd(o,tr.rj),tr.rj.vsub(et.position,tr.rj),tr.ri.vadd(s,tr.ri),tr.ri.vsub(b.position,tr.ri),this.result.push(tr),this.createFrictionEquationsFromContact(tr,this.frictionResult);for(let Cr=0,Ar=mn.length;Cr!==Ar;Cr++)at.release(mn[Cr]);return at.release(un),at.release(bn),at.release(Jn),at.release(nr),void at.release(Kn)}at.release(un),at.release(bn),at.release(Jn),at.release(nr),at.release(Kn)}for(let cn=0,un=mn.length;cn!==un;cn++)at.release(mn[cn])}}}planeConvex(e,i,s,o,c,g,b,et,tt,rt,st){const at=O6,ct=L6;ct.set(0,0,1),c.vmult(ct,ct);let pt=0;const gt=N6;for(let At=0;At!==i.vertices.length;At++)if(at.copy(i.vertices[At]),g.vmult(at,at),o.vadd(at,at),at.vsub(s,gt),ct.dot(gt)<=0){if(st)return!0;const xt=this.createContactEquation(b,et,e,i,tt,rt),yt=U6;ct.scale(ct.dot(gt),yt),at.vsub(yt,yt),yt.vsub(s,xt.ri),xt.ni.copy(ct),at.vsub(o,xt.rj),xt.ri.vadd(s,xt.ri),xt.ri.vsub(b.position,xt.ri),xt.rj.vadd(o,xt.rj),xt.rj.vsub(et.position,xt.rj),this.result.push(xt),pt++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(xt,this.frictionResult)}this.enableFrictionReduction&&pt&&this.createFrictionFromAverage(pt)}boxConvex(e,i,s,o,c,g,b,et,tt,rt,st){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,i,s,o,c,g,b,et,e,i,st)}sphereHeightfield(e,i,s,o,c,g,b,et,tt,rt,st){const at=i.data,ct=e.radius,pt=i.elementSize,gt=$6,At=J6;na.pointToLocalFrame(o,g,s,At);let xt=Math.floor((At.x-ct)/pt)-1,yt=Math.ceil((At.x+ct)/pt)+1,_t=Math.floor((At.y-ct)/pt)-1,Mt=Math.ceil((At.y+ct)/pt)+1;if(yt<0||Mt<0||xt>at.length||_t>at[0].length)return;xt<0&&(xt=0),yt<0&&(yt=0),_t<0&&(_t=0),Mt<0&&(Mt=0),xt>=at.length&&(xt=at.length-1),yt>=at.length&&(yt=at.length-1),Mt>=at[0].length&&(Mt=at[0].length-1),_t>=at[0].length&&(_t=at[0].length-1);const It=[];i.getRectMinMax(xt,_t,yt,Mt,It);const Bt=It[0],Lt=It[1];if(At.z-ct>Lt||At.z+ct<Bt)return;const Ht=this.result;for(let Jt=xt;Jt<yt;Jt++)for(let sn=_t;sn<Mt;sn++){const on=Ht.length;let mn=!1;if(i.getConvexTrianglePillar(Jt,sn,!1),na.pointToWorldFrame(o,g,i.pillarOffset,gt),s.distanceTo(gt)<i.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(mn=this.sphereConvex(e,i.pillarConvex,s,gt,c,g,b,et,e,i,st)),st&&mn||(i.getConvexTrianglePillar(Jt,sn,!0),na.pointToWorldFrame(o,g,i.pillarOffset,gt),s.distanceTo(gt)<i.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(mn=this.sphereConvex(e,i.pillarConvex,s,gt,c,g,b,et,e,i,st)),st&&mn))return!0;if(Ht.length-on>2)return}}boxHeightfield(e,i,s,o,c,g,b,et,tt,rt,st){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,i,s,o,c,g,b,et,e,i,st)}convexHeightfield(e,i,s,o,c,g,b,et,tt,rt,st){const at=i.data,ct=i.elementSize,pt=e.boundingSphereRadius,gt=Y6,At=K6,xt=X6;na.pointToLocalFrame(o,g,s,xt);let yt=Math.floor((xt.x-pt)/ct)-1,_t=Math.ceil((xt.x+pt)/ct)+1,Mt=Math.floor((xt.y-pt)/ct)-1,It=Math.ceil((xt.y+pt)/ct)+1;if(_t<0||It<0||yt>at.length||Mt>at[0].length)return;yt<0&&(yt=0),_t<0&&(_t=0),Mt<0&&(Mt=0),It<0&&(It=0),yt>=at.length&&(yt=at.length-1),_t>=at.length&&(_t=at.length-1),It>=at[0].length&&(It=at[0].length-1),Mt>=at[0].length&&(Mt=at[0].length-1);const Bt=[];i.getRectMinMax(yt,Mt,_t,It,Bt);const Lt=Bt[0],Ht=Bt[1];if(!(xt.z-pt>Ht||xt.z+pt<Lt))for(let Jt=yt;Jt<_t;Jt++)for(let sn=Mt;sn<It;sn++){let on=!1;if(i.getConvexTrianglePillar(Jt,sn,!1),na.pointToWorldFrame(o,g,i.pillarOffset,gt),s.distanceTo(gt)<i.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(on=this.convexConvex(e,i.pillarConvex,s,gt,c,g,b,et,null,null,st,At,null)),st&&on||(i.getConvexTrianglePillar(Jt,sn,!0),na.pointToWorldFrame(o,g,i.pillarOffset,gt),s.distanceTo(gt)<i.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(on=this.convexConvex(e,i.pillarConvex,s,gt,c,g,b,et,null,null,st,At,null)),st&&on))return!0}}sphereParticle(e,i,s,o,c,g,b,et,tt,rt,st){const at=H6;if(at.set(0,0,1),o.vsub(s,at),at.lengthSquared()<=e.radius*e.radius){if(st)return!0;const ct=this.createContactEquation(et,b,i,e,tt,rt);at.normalize(),ct.rj.copy(at),ct.rj.scale(e.radius,ct.rj),ct.ni.copy(at),ct.ni.negate(ct.ni),ct.ri.set(0,0,0),this.result.push(ct),this.createFrictionEquationsFromContact(ct,this.frictionResult)}}planeParticle(e,i,s,o,c,g,b,et,tt,rt,st){const at=z6;at.set(0,0,1),b.quaternion.vmult(at,at);const ct=V6;if(o.vsub(b.position,ct),at.dot(ct)<=0){if(st)return!0;const pt=this.createContactEquation(et,b,i,e,tt,rt);pt.ni.copy(at),pt.ni.negate(pt.ni),pt.ri.set(0,0,0);const gt=G6;at.scale(at.dot(o),gt),o.vsub(gt,gt),pt.rj.copy(gt),this.result.push(pt),this.createFrictionEquationsFromContact(pt,this.frictionResult)}}boxParticle(e,i,s,o,c,g,b,et,tt,rt,st){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,i,s,o,c,g,b,et,e,i,st)}convexParticle(e,i,s,o,c,g,b,et,tt,rt,st){let at=-1;const ct=W6,pt=q6;let gt=null;const At=Q6;if(At.copy(o),At.vsub(s,At),c.conjugate(TF),TF.vmult(At,At),e.pointIsInside(At)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(s,c),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(c);for(let xt=0,yt=e.faces.length;xt!==yt;xt++){const _t=[e.worldVertices[e.faces[xt][0]]],Mt=e.worldFaceNormals[xt];o.vsub(_t[0],IF);const It=-Mt.dot(IF);if(gt===null||Math.abs(It)<Math.abs(gt)){if(st)return!0;gt=It,at=xt,ct.copy(Mt)}}if(at!==-1){const xt=this.createContactEquation(et,b,i,e,tt,rt);ct.scale(gt,pt),pt.vadd(o,pt),pt.vsub(s,pt),xt.rj.copy(pt),ct.negate(xt.ni),xt.ri.set(0,0,0);const yt=xt.ri,_t=xt.rj;yt.vadd(o,yt),yt.vsub(et.position,yt),_t.vadd(s,_t),_t.vsub(b.position,_t),this.result.push(xt),this.createFrictionEquationsFromContact(xt,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,i,s,o,c,g,b,et,tt,rt,st){return this.convexHeightfield(i,e,o,s,g,c,et,b,tt,rt,st)}particleCylinder(e,i,s,o,c,g,b,et,tt,rt,st){return this.convexParticle(i,e,o,s,g,c,et,b,tt,rt,st)}sphereTrimesh(e,i,s,o,c,g,b,et,tt,rt,st){const at=n6,ct=i6,pt=r6,gt=s6,At=o6,xt=a6,yt=h6,_t=t6,Mt=ZG,It=d6;na.pointToLocalFrame(o,g,s,At);const Bt=e.radius;yt.lowerBound.set(At.x-Bt,At.y-Bt,At.z-Bt),yt.upperBound.set(At.x+Bt,At.y+Bt,At.z+Bt),i.getTrianglesInAABB(yt,It);const Lt=e6,Ht=e.radius*e.radius;for(let cn=0;cn<It.length;cn++)for(let un=0;un<3;un++)if(i.getVertex(i.indices[3*It[cn]+un],Lt),Lt.vsub(At,Mt),Mt.lengthSquared()<=Ht){if(_t.copy(Lt),na.pointToWorldFrame(o,g,_t,Lt),Lt.vsub(s,Mt),st)return!0;let bn=this.createContactEquation(b,et,e,i,tt,rt);bn.ni.copy(Mt),bn.ni.normalize(),bn.ri.copy(bn.ni),bn.ri.scale(e.radius,bn.ri),bn.ri.vadd(s,bn.ri),bn.ri.vsub(b.position,bn.ri),bn.rj.copy(Lt),bn.rj.vsub(et.position,bn.rj),this.result.push(bn),this.createFrictionEquationsFromContact(bn,this.frictionResult)}for(let cn=0;cn<It.length;cn++)for(let un=0;un<3;un++){i.getVertex(i.indices[3*It[cn]+un],at),i.getVertex(i.indices[3*It[cn]+(un+1)%3],ct),ct.vsub(at,pt),At.vsub(ct,xt);const bn=xt.dot(pt);At.vsub(at,xt);let xn=xt.dot(pt);if(xn>0&&bn<0&&(At.vsub(at,xt),gt.copy(pt),gt.normalize(),xn=xt.dot(gt),gt.scale(xn,xt),xt.vadd(at,xt),xt.distanceTo(At)<e.radius)){if(st)return!0;const Cn=this.createContactEquation(b,et,e,i,tt,rt);xt.vsub(At,Cn.ni),Cn.ni.normalize(),Cn.ni.scale(e.radius,Cn.ri),Cn.ri.vadd(s,Cn.ri),Cn.ri.vsub(b.position,Cn.ri),na.pointToWorldFrame(o,g,xt,xt),xt.vsub(et.position,Cn.rj),na.vectorToWorldFrame(g,Cn.ni,Cn.ni),na.vectorToWorldFrame(g,Cn.ri,Cn.ri),this.result.push(Cn),this.createFrictionEquationsFromContact(Cn,this.frictionResult)}}const Jt=l6,sn=c6,on=u6,mn=$G;for(let cn=0,un=It.length;cn!==un;cn++){i.getTriangleVertices(It[cn],Jt,sn,on),i.getNormal(It[cn],mn),At.vsub(Jt,xt);let bn=xt.dot(mn);if(mn.scale(bn,xt),At.vsub(xt,xt),bn=xt.distanceTo(At),vp.pointInTriangle(xt,Jt,sn,on)&&bn<e.radius){if(st)return!0;let xn=this.createContactEquation(b,et,e,i,tt,rt);xt.vsub(At,xn.ni),xn.ni.normalize(),xn.ni.scale(e.radius,xn.ri),xn.ri.vadd(s,xn.ri),xn.ri.vsub(b.position,xn.ri),na.pointToWorldFrame(o,g,xt,xt),xt.vsub(et.position,xn.rj),na.vectorToWorldFrame(g,xn.ni,xn.ni),na.vectorToWorldFrame(g,xn.ri,xn.ri),this.result.push(xn),this.createFrictionEquationsFromContact(xn,this.frictionResult)}}It.length=0}planeTrimesh(e,i,s,o,c,g,b,et,tt,rt,st){const at=new en,ct=YG;ct.set(0,0,1),c.vmult(ct,ct);for(let pt=0;pt<i.vertices.length/3;pt++){i.getVertex(pt,at);const gt=new en;gt.copy(at),na.pointToWorldFrame(o,g,gt,at);const At=KG;if(at.vsub(s,At),ct.dot(At)<=0){if(st)return!0;const xt=this.createContactEquation(b,et,e,i,tt,rt);xt.ni.copy(ct);const yt=JG;ct.scale(At.dot(ct),yt),at.vsub(yt,yt),xt.ri.copy(yt),xt.ri.vsub(b.position,xt.ri),xt.rj.copy(at),xt.rj.vsub(et.position,xt.rj),this.result.push(xt),this.createFrictionEquationsFromContact(xt,this.frictionResult)}}}}const _S=new en,IM=new en,PM=new en,QG=new en,WG=new en,qG=new Iu,XG=new Iu,YG=new en,KG=new en,JG=new en,$G=new en,ZG=new en;new en;const e6=new en,t6=new en,n6=new en,i6=new en,r6=new en,s6=new en,o6=new en,a6=new en,l6=new en,c6=new en,u6=new en,h6=new yu,d6=[],gD=new en,MF=new en,p6=new en,f6=new en,m6=new en;function g6(h,e,i){let s=null;const o=h.length;for(let c=0;c!==o;c++){const g=h[c],b=p6;h[(c+1)%o].vsub(g,b);const et=f6;b.cross(e,et);const tt=m6;i.vsub(g,tt);const rt=et.dot(tt);if(!(s===null||rt>0&&s===!0||rt<=0&&s===!1))return!1;s===null&&(s=rt>0)}return!0}const vD=new en,v6=new en,_6=new en,y6=new en,A6=[new en,new en,new en,new en,new en,new en],b6=new en,w6=new en,x6=new en,E6=new en,S6=new en,C6=new en,M6=new en,T6=new en,I6=new en,P6=new en,R6=new en,D6=new en,k6=new en,B6=new en;new en,new en;const O6=new en,L6=new en,N6=new en,U6=new en,F6=new en,j6=new en,z6=new en,V6=new en,G6=new en,H6=new en,TF=new Iu,Q6=new en;new en;const W6=new en,IF=new en,q6=new en,X6=new en,Y6=new en,K6=[0],J6=new en,$6=new en;class PF{constructor(){this.current=[],this.previous=[]}getKey(e,i){if(i<e){const s=i;i=e,e=s}return e<<16|i}set(e,i){const s=this.getKey(e,i),o=this.current;let c=0;for(;s>o[c];)c++;if(s!==o[c]){for(let g=o.length-1;g>=c;g--)o[g+1]=o[g];o[c]=s}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,i){const s=this.current,o=this.previous,c=s.length,g=o.length;let b=0;for(let et=0;et<c;et++){let tt=!1;const rt=s[et];for(;rt>o[b];)b++;tt=rt===o[b],tt||RF(e,rt)}b=0;for(let et=0;et<g;et++){let tt=!1;const rt=o[et];for(;rt>s[b];)b++;tt=s[b]===rt,tt||RF(i,rt)}}}function RF(h,e){h.push((4294901760&e)>>16,65535&e)}const wL=(h,e)=>h<e?`${h}-${e}`:`${e}-${h}`;class Z6{constructor(){this.data={keys:[]}}get(e,i){const s=wL(e,i);return this.data[s]}set(e,i,s){const o=wL(e,i);this.get(e,i)||this.data.keys.push(o),this.data[o]=s}delete(e,i){const s=wL(e,i),o=this.data.keys.indexOf(s);o!==-1&&this.data.keys.splice(o,1),delete this.data[s]}reset(){const e=this.data,i=e.keys;for(;i.length>0;)delete e[i.pop()]}}class e8 extends nF{constructor(e){e===void 0&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0&&e.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new en,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=e.broadphase!==void 0?e.broadphase:new IV,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new pG,this.constraints=[],this.narrowphase=new HG(this),this.collisionMatrix=new tF,this.collisionMatrixPrevious=new tF,this.bodyOverlapKeeper=new PF,this.shapeOverlapKeeper=new PF,this.contactmaterials=[],this.contactMaterialTable=new Z6,this.defaultMaterial=new dD("default"),this.defaultContactMaterial=new hD(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,i){return this.contactMaterialTable.get(e.id,i.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const i=this.constraints.indexOf(e);i!==-1&&this.constraints.splice(i,1)}rayTest(e,i,s){s instanceof sD?this.raycastClosest(e,i,{skipBackfaces:!0},s):this.raycastAll(e,i,{skipBackfaces:!0},s)}raycastAll(e,i,s,o){return s===void 0&&(s={}),s.mode=vp.ALL,s.from=e,s.to=i,s.callback=o,xL.intersectWorld(this,s)}raycastAny(e,i,s,o){return s===void 0&&(s={}),s.mode=vp.ANY,s.from=e,s.to=i,s.result=o,xL.intersectWorld(this,s)}raycastClosest(e,i,s,o){return s===void 0&&(s={}),s.mode=vp.CLOSEST,s.from=e,s.to=i,s.result=o,xL.intersectWorld(this,s)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof vs&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const i=this.bodies.length-1,s=this.bodies,o=s.indexOf(e);if(o!==-1){s.splice(o,1);for(let c=0;c!==s.length;c++)s[c].index=c;this.collisionMatrix.setNumObjects(i),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const i=this.bodies;for(let s=0;s<i.length;s++){const o=i[s].shapes;for(let c=0;c<o.length;c++){const g=o[c];if(g.id===e)return g}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const i=this.contactmaterials.indexOf(e);i!==-1&&(this.contactmaterials.splice(i,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,i){e===void 0&&(e=1/60),i===void 0&&(i=10);const s=Bp.now()/1e3;if(this.lastCallTime){const o=s-this.lastCallTime;this.step(e,o,i)}else this.step(e,void 0,i);this.lastCallTime=s}step(e,i,s){if(s===void 0&&(s=10),i===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=i;const o=Bp.now();let c=0;for(;this.accumulator>=e&&c<s&&(this.internalStep(e),this.accumulator-=e,c++,!(Bp.now()-o>1e3*e)););this.accumulator=this.accumulator%e;const g=this.accumulator/e;for(let b=0;b!==this.bodies.length;b++){const et=this.bodies[b];et.previousPosition.lerp(et.position,g,et.interpolatedPosition),et.previousQuaternion.slerp(et.quaternion,g,et.interpolatedQuaternion),et.previousQuaternion.normalize()}this.time+=i}}internalStep(e){this.dt=e;const i=this.contacts,s=s8,o=o8,c=this.bodies.length,g=this.bodies,b=this.solver,et=this.gravity,tt=this.doProfiling,rt=this.profile,st=vs.DYNAMIC;let at=-1/0;const ct=this.constraints,pt=r8;et.length();const gt=et.x,At=et.y,xt=et.z;let yt=0;for(tt&&(at=Bp.now()),yt=0;yt!==c;yt++){const mn=g[yt];if(mn.type===st){const cn=mn.force,un=mn.mass;cn.x+=un*gt,cn.y+=un*At,cn.z+=un*xt}}for(let mn=0,cn=this.subsystems.length;mn!==cn;mn++)this.subsystems[mn].update();tt&&(at=Bp.now()),s.length=0,o.length=0,this.broadphase.collisionPairs(this,s,o),tt&&(rt.broadphase=Bp.now()-at);let _t=ct.length;for(yt=0;yt!==_t;yt++){const mn=ct[yt];if(!mn.collideConnected)for(let cn=s.length-1;cn>=0;cn-=1)(mn.bodyA===s[cn]&&mn.bodyB===o[cn]||mn.bodyB===s[cn]&&mn.bodyA===o[cn])&&(s.splice(cn,1),o.splice(cn,1))}this.collisionMatrixTick(),tt&&(at=Bp.now());const Mt=i8,It=i.length;for(yt=0;yt!==It;yt++)Mt.push(i[yt]);i.length=0;const Bt=this.frictionEquations.length;for(yt=0;yt!==Bt;yt++)pt.push(this.frictionEquations[yt]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(s,o,this,i,Mt,this.frictionEquations,pt),tt&&(rt.narrowphase=Bp.now()-at),tt&&(at=Bp.now()),yt=0;yt<this.frictionEquations.length;yt++)b.addEquation(this.frictionEquations[yt]);const Lt=i.length;for(let mn=0;mn!==Lt;mn++){const cn=i[mn],un=cn.bi,bn=cn.bj,xn=cn.si,Cn=cn.sj;let Jn;Jn=un.material&&bn.material&&this.getContactMaterial(un.material,bn.material)||this.defaultContactMaterial,Jn.friction,un.material&&bn.material&&(un.material.friction>=0&&bn.material.friction>=0&&(un.material.friction,bn.material.friction),un.material.restitution>=0&&bn.material.restitution>=0&&(cn.restitution=un.material.restitution*bn.material.restitution)),b.addEquation(cn),un.allowSleep&&un.type===vs.DYNAMIC&&un.sleepState===vs.SLEEPING&&bn.sleepState===vs.AWAKE&&bn.type!==vs.STATIC&&bn.velocity.lengthSquared()+bn.angularVelocity.lengthSquared()>=2*bn.sleepSpeedLimit**2&&(un.wakeUpAfterNarrowphase=!0),bn.allowSleep&&bn.type===vs.DYNAMIC&&bn.sleepState===vs.SLEEPING&&un.sleepState===vs.AWAKE&&un.type!==vs.STATIC&&un.velocity.lengthSquared()+un.angularVelocity.lengthSquared()>=2*un.sleepSpeedLimit**2&&(bn.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(un,bn,!0),this.collisionMatrixPrevious.get(un,bn)||(QI.body=bn,QI.contact=cn,un.dispatchEvent(QI),QI.body=un,bn.dispatchEvent(QI)),this.bodyOverlapKeeper.set(un.id,bn.id),this.shapeOverlapKeeper.set(xn.id,Cn.id)}for(this.emitContactEvents(),tt&&(rt.makeContactConstraints=Bp.now()-at,at=Bp.now()),yt=0;yt!==c;yt++){const mn=g[yt];mn.wakeUpAfterNarrowphase&&(mn.wakeUp(),mn.wakeUpAfterNarrowphase=!1)}for(_t=ct.length,yt=0;yt!==_t;yt++){const mn=ct[yt];mn.update();for(let cn=0,un=mn.equations.length;cn!==un;cn++){const bn=mn.equations[cn];b.addEquation(bn)}}b.solve(e,this),tt&&(rt.solve=Bp.now()-at),b.removeAllEquations();const Ht=Math.pow;for(yt=0;yt!==c;yt++){const mn=g[yt];if(mn.type&st){const cn=Ht(1-mn.linearDamping,e),un=mn.velocity;un.scale(cn,un);const bn=mn.angularVelocity;if(bn){const xn=Ht(1-mn.angularDamping,e);bn.scale(xn,bn)}}}this.dispatchEvent(n8),tt&&(at=Bp.now());const Jt=this.stepnumber%(this.quatNormalizeSkip+1)==0,sn=this.quatNormalizeFast;for(yt=0;yt!==c;yt++)g[yt].integrate(e,Jt,sn);this.clearForces(),this.broadphase.dirty=!0,tt&&(rt.integrate=Bp.now()-at),this.stepnumber+=1,this.dispatchEvent(t8);let on=!0;if(this.allowSleep)for(on=!1,yt=0;yt!==c;yt++){const mn=g[yt];mn.sleepTick(this.time),mn.sleepState!==vs.SLEEPING&&(on=!0)}this.hasActiveBodies=on}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),i=this.hasAnyEventListener("endContact");if((e||i)&&this.bodyOverlapKeeper.getDiff(Hw,Qw),e){for(let c=0,g=Hw.length;c<g;c+=2)WI.bodyA=this.getBodyById(Hw[c]),WI.bodyB=this.getBodyById(Hw[c+1]),this.dispatchEvent(WI);WI.bodyA=WI.bodyB=null}if(i){for(let c=0,g=Qw.length;c<g;c+=2)qI.bodyA=this.getBodyById(Qw[c]),qI.bodyB=this.getBodyById(Qw[c+1]),this.dispatchEvent(qI);qI.bodyA=qI.bodyB=null}Hw.length=Qw.length=0;const s=this.hasAnyEventListener("beginShapeContact"),o=this.hasAnyEventListener("endShapeContact");if((s||o)&&this.shapeOverlapKeeper.getDiff(Hw,Qw),s){for(let c=0,g=Hw.length;c<g;c+=2){const b=this.getShapeById(Hw[c]),et=this.getShapeById(Hw[c+1]);Ww.shapeA=b,Ww.shapeB=et,b&&(Ww.bodyA=b.body),et&&(Ww.bodyB=et.body),this.dispatchEvent(Ww)}Ww.bodyA=Ww.bodyB=Ww.shapeA=Ww.shapeB=null}if(o){for(let c=0,g=Qw.length;c<g;c+=2){const b=this.getShapeById(Qw[c]),et=this.getShapeById(Qw[c+1]);qw.shapeA=b,qw.shapeB=et,b&&(qw.bodyA=b.body),et&&(qw.bodyB=et.body),this.dispatchEvent(qw)}qw.bodyA=qw.bodyB=qw.shapeA=qw.shapeB=null}}clearForces(){const e=this.bodies,i=e.length;for(let s=0;s!==i;s++){const o=e[s];o.force,o.torque,o.force.set(0,0,0),o.torque.set(0,0,0)}}}new yu;const xL=new vp,Bp=globalThis.performance||{};if(!Bp.now){let h=Date.now();Bp.timing&&Bp.timing.navigationStart&&(h=Bp.timing.navigationStart),Bp.now=()=>Date.now()-h}new en;const t8={type:"postStep"},n8={type:"preStep"},QI={type:vs.COLLIDE_EVENT_NAME,body:null,contact:null},i8=[],r8=[],s8=[],o8=[],Hw=[],Qw=[],WI={type:"beginContact",bodyA:null,bodyB:null},qI={type:"endContact",bodyA:null,bodyB:null},Ww={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},qw={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var a8=function(){var h,e,i,s,o=0,c=new _.Pa4;function g(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new rt,this.unassigned=new rt,this.vertices=[]}function b(){this.normal=new _.Pa4,this.midpoint=new _.Pa4,this.area=0,this.constant=0,this.outside=null,this.mark=o,this.edge=null}function et(st,at){this.vertex=st,this.prev=null,this.next=null,this.twin=null,this.face=at}function tt(st,at){this.point=st,this.index=at,this.prev=null,this.next=null,this.face=null}function rt(){this.head=null,this.tail=null}return Object.assign(g.prototype,{toJSON:function(){const st=this.faces.map(At=>At.toArray()),at=Array.from(new Set(st.flat())).sort(),ct=[];for(let At=0;At<at.length;At++)ct.push(this.vertices[at[At]].point.x,this.vertices[at[At]].point.y,this.vertices[at[At]].point.z);const pt=new Map;for(let At=0;At<at.length;At++)pt.set(at[At],At);const gt=[];for(let At=0;At<st.length;At++)gt.push([pt.get(st[At][0]),pt.get(st[At][1]),pt.get(st[At][2])]);return[ct,gt]},setFromPoints:function(st){Array.isArray(st)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),st.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var at=0,ct=st.length;at<ct;at++)this.vertices.push(new tt(st[at],at));return this.compute(),this},setFromObject:function(st){var at=[];return st.updateMatrixWorld(!0),st.traverse(function(ct){var pt,gt,At,xt=ct.geometry;if(xt!==void 0&&(xt.isGeometry&&(xt=xt.toBufferGeometry?xt.toBufferGeometry():new BufferGeometry().fromGeometry(xt)),xt.isBufferGeometry)){var yt=xt.attributes.position;if(yt!==void 0)for(pt=0,gt=yt.count;pt<gt;pt++)(At=new _.Pa4).fromBufferAttribute(yt,pt).applyMatrix4(ct.matrixWorld),at.push(At)}}),this.setFromPoints(at)},containsPoint:function(st){for(var at=this.faces,ct=0,pt=at.length;ct<pt;ct++)if(at[ct].distanceToPoint(st)>this.tolerance)return!1;return!0},intersectRay:function(st,at){for(var ct=this.faces,pt=-1/0,gt=1/0,At=0,xt=ct.length;At<xt;At++){var yt=ct[At],_t=yt.distanceToPoint(st.origin),Mt=yt.normal.dot(st.direction);if(_t>0&&Mt>=0)return null;var It=Mt!==0?-_t/Mt:0;if(!(It<=0)&&(Mt>0?gt=Math.min(It,gt):pt=Math.max(It,pt),pt>gt))return null}return pt!==-1/0?st.at(pt,at):st.at(gt,at),at},intersectsRay:function(st){return this.intersectRay(st,c)!==null},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(st,at){return st.face=at,at.outside===null?this.assigned.append(st):this.assigned.insertBefore(at.outside,st),at.outside=st,this},removeVertexFromFace:function(st,at){return st===at.outside&&(st.next!==null&&st.next.face===at?at.outside=st.next:at.outside=null),this.assigned.remove(st),this},removeAllVerticesFromFace:function(st){if(st.outside!==null){for(var at=st.outside,ct=st.outside;ct.next!==null&&ct.next.face===st;)ct=ct.next;return this.assigned.removeSubList(at,ct),at.prev=ct.next=null,st.outside=null,at}},deleteFaceVertices:function(st,at){var ct=this.removeAllVerticesFromFace(st);if(ct!==void 0)if(at===void 0)this.unassigned.appendChain(ct);else{var pt=ct;do{var gt=pt.next;at.distanceToPoint(pt.point)>this.tolerance?this.addVertexToFace(pt,at):this.unassigned.append(pt),pt=gt}while(pt!==null)}return this},resolveUnassignedPoints:function(st){if(this.unassigned.isEmpty()===!1){var at=this.unassigned.first();do{for(var ct=at.next,pt=this.tolerance,gt=null,At=0;At<st.length;At++){var xt=st[At];if(xt.mark===o){var yt=xt.distanceToPoint(at.point);if(yt>pt&&(pt=yt,gt=xt),pt>1e3*this.tolerance)break}}gt!==null&&this.addVertexToFace(at,gt),at=ct}while(at!==null)}return this},computeExtremes:function(){var st,at,ct,pt=new _.Pa4,gt=new _.Pa4,At=[],xt=[];for(st=0;st<3;st++)At[st]=xt[st]=this.vertices[0];for(pt.copy(this.vertices[0].point),gt.copy(this.vertices[0].point),st=0,at=this.vertices.length;st<at;st++){var yt=this.vertices[st],_t=yt.point;for(ct=0;ct<3;ct++)_t.getComponent(ct)<pt.getComponent(ct)&&(pt.setComponent(ct,_t.getComponent(ct)),At[ct]=yt);for(ct=0;ct<3;ct++)_t.getComponent(ct)>gt.getComponent(ct)&&(gt.setComponent(ct,_t.getComponent(ct)),xt[ct]=yt)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(pt.x),Math.abs(gt.x))+Math.max(Math.abs(pt.y),Math.abs(gt.y))+Math.max(Math.abs(pt.z),Math.abs(gt.z))),{min:At,max:xt}},computeInitialHull:function(){h===void 0&&(h=new _.Zzh,e=new _.JOQ,i=new _.Pa4);var st,at,ct,pt,gt,At,xt,yt,_t,Mt=this.vertices,It=this.computeExtremes(),Bt=It.min,Lt=It.max,Ht=0,Jt=0;for(At=0;At<3;At++)(_t=Lt[At].point.getComponent(At)-Bt[At].point.getComponent(At))>Ht&&(Ht=_t,Jt=At);for(at=Bt[Jt],ct=Lt[Jt],Ht=0,h.set(at.point,ct.point),At=0,xt=this.vertices.length;At<xt;At++)(st=Mt[At])!==at&&st!==ct&&(h.closestPointToPoint(st.point,!0,i),(_t=i.distanceToSquared(st.point))>Ht&&(Ht=_t,pt=st));for(Ht=-1,e.setFromCoplanarPoints(at.point,ct.point,pt.point),At=0,xt=this.vertices.length;At<xt;At++)(st=Mt[At])!==at&&st!==ct&&st!==pt&&(_t=Math.abs(e.distanceToPoint(st.point)))>Ht&&(Ht=_t,gt=st);var sn=[];if(e.distanceToPoint(gt.point)<0)for(sn.push(b.create(at,ct,pt),b.create(gt,ct,at),b.create(gt,pt,ct),b.create(gt,at,pt)),At=0;At<3;At++)yt=(At+1)%3,sn[At+1].getEdge(2).setTwin(sn[0].getEdge(yt)),sn[At+1].getEdge(1).setTwin(sn[yt+1].getEdge(0));else for(sn.push(b.create(at,pt,ct),b.create(gt,at,ct),b.create(gt,ct,pt),b.create(gt,pt,at)),At=0;At<3;At++)yt=(At+1)%3,sn[At+1].getEdge(2).setTwin(sn[0].getEdge((3-At)%3)),sn[At+1].getEdge(0).setTwin(sn[yt+1].getEdge(1));for(At=0;At<4;At++)this.faces.push(sn[At]);for(At=0,xt=Mt.length;At<xt;At++)if((st=Mt[At])!==at&&st!==ct&&st!==pt&&st!==gt){Ht=this.tolerance;var on=null;for(yt=0;yt<4;yt++)(_t=this.faces[yt].distanceToPoint(st.point))>Ht&&(Ht=_t,on=this.faces[yt]);on!==null&&this.addVertexToFace(st,on)}return this},reindexFaces:function(){for(var st=[],at=0;at<this.faces.length;at++){var ct=this.faces[at];ct.mark===o&&st.push(ct)}return this.faces=st,this},nextVertexToAdd:function(){if(this.assigned.isEmpty()===!1){var st,at=0,ct=this.assigned.first().face,pt=ct.outside;do{var gt=ct.distanceToPoint(pt.point);gt>at&&(at=gt,st=pt),pt=pt.next}while(pt!==null&&pt.face===ct);return st}},computeHorizon:function(st,at,ct,pt){var gt;this.deleteFaceVertices(ct),ct.mark=1,gt=at===null?at=ct.getEdge(0):at.next;do{var At=gt.twin,xt=At.face;xt.mark===o&&(xt.distanceToPoint(st)>this.tolerance?this.computeHorizon(st,At,xt,pt):pt.push(gt)),gt=gt.next}while(gt!==at);return this},addAdjoiningFace:function(st,at){var ct=b.create(st,at.tail(),at.head());return this.faces.push(ct),ct.getEdge(-1).setTwin(at.twin),ct.getEdge(0)},addNewFaces:function(st,at){this.newFaces=[];for(var ct=null,pt=null,gt=0;gt<at.length;gt++){var At=at[gt],xt=this.addAdjoiningFace(st,At);ct===null?ct=xt:xt.next.setTwin(pt),this.newFaces.push(xt.face),pt=xt}return ct.next.setTwin(pt),this},addVertexToHull:function(st){var at=[];return this.unassigned.clear(),this.removeVertexFromFace(st,st.face),this.computeHorizon(st.point,null,st.face,at),this.addNewFaces(st,at),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var st;for(this.computeInitialHull();(st=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(st);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(b,{create:function(st,at,ct){var pt=new b,gt=new et(st,pt),At=new et(at,pt),xt=new et(ct,pt);return gt.next=xt.prev=At,At.next=gt.prev=xt,xt.next=At.prev=gt,pt.edge=gt,pt.compute()}}),Object.assign(b.prototype,{toArray:function(){const st=[];let at=this.edge;do st.push(at.head().index),at=at.next;while(at!==this.edge);return st},getEdge:function(st){for(var at=this.edge;st>0;)at=at.next,st--;for(;st<0;)at=at.prev,st++;return at},compute:function(){s===void 0&&(s=new _.CJI);var st=this.edge.tail(),at=this.edge.head(),ct=this.edge.next.head();return s.set(st.point,at.point,ct.point),s.getNormal(this.normal),s.getMidpoint(this.midpoint),this.area=s.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(st){return this.normal.dot(st)-this.constant}}),Object.assign(et.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var st=this.head(),at=this.tail();return at!==null?at.point.distanceTo(st.point):-1},lengthSquared:function(){var st=this.head(),at=this.tail();return at!==null?at.point.distanceToSquared(st.point):-1},setTwin:function(st){return this.twin=st,st.twin=this,this}}),Object.assign(rt.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(st,at){return at.prev=st.prev,at.next=st,at.prev===null?this.head=at:at.prev.next=at,st.prev=at,this},insertAfter:function(st,at){return at.prev=st,at.next=st.next,at.next===null?this.tail=at:at.next.prev=at,st.next=at,this},append:function(st){return this.head===null?this.head=st:this.tail.next=st,st.prev=this.tail,st.next=null,this.tail=st,this},appendChain:function(st){for(this.head===null?this.head=st:this.tail.next=st,st.prev=this.tail;st.next!==null;)st=st.next;return this.tail=st,this},remove:function(st){return st.prev===null?this.head=st.next:st.prev.next=st.next,st.next===null?this.tail=st.prev:st.next.prev=st.prev,this},removeSubList:function(st,at){return st.prev===null?this.head=at.next:st.prev.next=at.next,at.next===null?this.tail=st.prev:at.next.prev=st.prev,this},isEmpty:function(){return this.head===null}}),g}();const l8=new _.Pa4,_D=new _.Pa4,c8=new _._fP;function yD(h){const e=function(o){const c=[];return o.traverse(function(g){g.isMesh&&c.push(g)}),c}(h);if(e.length===0)return null;if(e.length===1)return DF(e[0]);let i;const s=[];for(;i=e.pop();)s.push(u8(DF(i)));return function(o){let c=0;for(let et=0;et<o.length;et++){const tt=o[et].attributes.position;tt&&tt.itemSize===3&&(c+=tt.count)}const g=new Float32Array(3*c);let b=0;for(let et=0;et<o.length;et++){const tt=o[et].attributes.position;if(tt&&tt.itemSize===3)for(let rt=0;rt<tt.count;rt++)g[b++]=tt.getX(rt),g[b++]=tt.getY(rt),g[b++]=tt.getZ(rt)}return new _.u9r().setAttribute("position",new _.TlE(g,3))}(s)}function DF(h){let e=h.geometry;return e=e.toBufferGeometry?e.toBufferGeometry():e.clone(),h.updateMatrixWorld(),h.matrixWorld.decompose(l8,c8,_D),e.scale(_D.x,_D.y,_D.z),e}function kF(h){const e=h.attributes.position,i=new Float32Array(3*e.count);for(let s=0;s<e.count;s++)i[3*s]=e.getX(s),i[3*s+1]=e.getY(s),i[3*s+2]=e.getZ(s);return i}function AD(h,e){switch(e){case"x":return h.x;case"y":return h.y;case"z":return h.z}throw new Error(`Unexpected component ${e}`)}function u8(h,e=1e-4){e=Math.max(e,Number.EPSILON);const i={},s=h.getIndex(),o=h.getAttribute("position"),c=s?s.count:o.count;let g=0;const b=[],et=[],tt=Math.log10(1/e),rt=Math.pow(10,tt);for(let ct=0;ct<c;ct++){const pt=s?s.getX(ct):ct;let gt="";gt+=~~(o.getX(pt)*rt)+",",gt+=~~(o.getY(pt)*rt)+",",gt+=~~(o.getZ(pt)*rt)+",",gt in i?b.push(i[gt]):(et.push(o.getX(pt)),et.push(o.getY(pt)),et.push(o.getZ(pt)),i[gt]=g,b.push(g),g++)}const st=new _.TlE(new Float32Array(et),o.itemSize,o.normalized),at=new _.u9r;return at.setAttribute("position",st),at.setIndex(b),at}const BF=Math.PI/2;var Vu;(function(h){h.BOX="Box",h.CYLINDER="Cylinder",h.SPHERE="Sphere",h.HULL="ConvexPolyhedron",h.MESH="Trimesh"})(Vu||(Vu={}));const h8=function(h,e={}){const i=function(et,tt={}){let rt;if(tt.type===Vu.BOX)return LF(et);if(tt.type===Vu.CYLINDER)return function(st,at){const ct=["x","y","z"],pt=at.cylinderAxis||"y",gt=ct.splice(ct.indexOf(pt),1)&&ct,At=new _.ZzF().setFromObject(st);if(!isFinite(At.min.lengthSq()))return null;const xt=At.max[pt]-At.min[pt],yt=.5*Math.max(AD(At.max,gt[0])-AD(At.min,gt[0]),AD(At.max,gt[1])-AD(At.min,gt[1])),_t=pt==="y"?BF:0,Mt=pt==="z"?BF:0;return{type:Vu.CYLINDER,params:{radiusTop:yt,radiusBottom:yt,height:xt,segments:12},orientation:new Iu().setFromEuler(_t,Mt,0,"XYZ").normalize()}}(et,tt);if(tt.type===Vu.SPHERE)return function(st,at){if(at.sphereRadius)return{type:Vu.SPHERE,params:{radius:at.sphereRadius}};const ct=yD(st);return ct?(ct.computeBoundingSphere(),{type:Vu.SPHERE,params:{radius:ct.boundingSphere.radius}}):null}(et,tt);if(tt.type===Vu.HULL)return function(st){const at=yD(st);if(!at)return null;const ct=1e-4;for(let At=0;At<at.attributes.position.count;At++)at.attributes.position.setXYZ(At,at.attributes.position.getX(At)+(Math.random()-.5)*ct,at.attributes.position.getY(At)+(Math.random()-.5)*ct,at.attributes.position.getZ(At)+(Math.random()-.5)*ct);const[pt,gt]=new a8().setFromObject(new _.Kj0(at)).toJSON();return{type:Vu.HULL,params:{vertices:new Float32Array(pt),faces:gt}}}(et);if(tt.type===Vu.MESH)return rt=yD(et),rt?function(st){const at=kF(st);if(!at.length)return null;const ct=new Uint32Array(at.length);for(let pt=0;pt<at.length;pt++)ct[pt]=pt;return{type:Vu.MESH,params:{vertices:at,indices:ct}}}(rt):null;if(tt.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${tt.type}".`);if(rt=yD(et),!rt)return null;switch(rt.type){case"BoxGeometry":case"BoxBufferGeometry":return OF(rt);case"CylinderGeometry":case"CylinderBufferGeometry":return function(st){const at=st.parameters;return{type:Vu.CYLINDER,params:{radiusTop:at.radiusTop,radiusBottom:at.radiusBottom,height:at.height,segments:at.radialSegments},orientation:new Iu().setFromEuler(_.M8C.degToRad(-90),0,0,"XYZ").normalize()}}(rt);case"PlaneGeometry":case"PlaneBufferGeometry":return function(st){st.computeBoundingBox();const at=st.boundingBox;return{type:Vu.BOX,params:{x:(at.max.x-at.min.x)/2||.1,y:(at.max.y-at.min.y)/2||.1,z:(at.max.z-at.min.z)/2||.1}}}(rt);case"SphereGeometry":case"SphereBufferGeometry":return function(st){return{type:Vu.SPHERE,params:{radius:st.parameters.radius}}}(rt);case"TubeGeometry":case"BufferGeometry":return LF(et);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',rt.type),OF(rt)}}(h,e);if(!i)return null;const{type:s,params:o,offset:c,orientation:g}=i;let b;return b=s===Vu.BOX?function(et){const{x:tt,y:rt,z:st}=et;return new rD(new en(tt,rt,st))}(o):s===Vu.CYLINDER?function(et){const{radiusTop:tt,radiusBottom:rt,height:st,segments:at}=et,ct=new iG(tt,rt,st,at);return ct.radiusTop=rt,ct.radiusBottom=rt,ct.height=st,ct.numSegments=at,ct}(o):s===Vu.SPHERE?function(et){return new bF(et.radius)}(o):s===Vu.HULL?function(et){const{faces:tt,vertices:rt}=et,st=[];for(let at=0;at<rt.length;at+=3)st.push(new en(rt[at],rt[at+1],rt[at+2]));return new fS({faces:tt,vertices:st})}(o):function(et){const{vertices:tt,indices:rt}=et;return new fD(tt,rt)}(o),{shape:b,offset:c,orientation:g}};function OF(h){if(!kF(h).length)return null;h.computeBoundingBox();const e=h.boundingBox;return{type:Vu.BOX,params:{x:(e.max.x-e.min.x)/2,y:(e.max.y-e.min.y)/2,z:(e.max.z-e.min.z)/2}}}function LF(h){const e=h.clone();e.quaternion.set(0,0,0,1),e.updateMatrixWorld();const i=new _.ZzF().setFromObject(e);if(!isFinite(i.min.lengthSq()))return null;const s=i.translate(e.position.negate()).getCenter(new _.Pa4);return{type:Vu.BOX,params:{x:(i.max.x-i.min.x)/2,y:(i.max.y-i.min.y)/2,z:(i.max.z-i.min.z)/2},offset:s.lengthSq()?new en(s.x,s.y,s.z):void 0}}var bD,wD=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let PA=bD=class extends hs{constructor(h=!1){super(),this._world=new e8,this.enabled=!0,this.nextSteps=0,this.stepPhysics={stepCount:100,delta:.1,step:()=>{this.nextSteps=this.stepPhysics.stepCount}},this.makeRootBodies=()=>{var o;(o=this._viewer)==null||o.scene.modelRoot.children.forEach(c=>{this.makeBody(c)})},this._bodyMeshMap=new Map,this._movementPlane=new _.Kj0(new _._12(100,100),new _.vBJ({color:65280,side:_.ehD})),this.enabled=h,this._world.gravity.set(0,-9.81,0);const e=new rG,i=new vs({mass:0,position:new en(0,-2,0)});i.addShape(e),i.quaternion.setFromEuler(-Math.PI/2,0,0),this._ground=i,this._world.addBody(i);const s=new bF(.1);this._jointBody=new vs({mass:0}),this._jointBody.addShape(s),this._jointBody.collisionFilterGroup=0,this._jointBody.collisionFilterMask=0,this._world.addBody(this._jointBody)}async onAdded(h){await super.onAdded(h);const e=new _.Pa4,i=new _.Pa4,s=new _.Pa4,o=new _._fP,c=new _._fP,g=new _.yGw,b=new _.yGw;let et=!1,tt=!1;function rt(st){const at=h.canvas.getBoundingClientRect(),ct=new _.FM8;return ct.x=(st.clientX-at.x)/at.width*2-1,ct.y=-(st.clientY-at.y)/at.height*2+1,ct}h.addEventListener("preFrame",()=>{const st=h.getPlugin(Wv),at=h.getPlugin(U0);if(!this.enabled){if(!(this.nextSteps>0))return st&&et&&(st.enableRefreshTransform=!0,et=!1),at&&tt&&(at.enable(bD.PluginType),tt=!1),void(this._dirty=!1);this.enabled=!0}if(st&&st.enableRefreshTransform&&!et&&(st.enableRefreshTransform=!1,et=!0),at&&!tt&&at.disable(bD.PluginType),this.nextSteps>0)for(let pt=0;pt<this.stepPhysics.stepCount;pt++)this._world.step(this.stepPhysics.delta);else this._world.fixedStep();this._dirty=!1;let ct=!1;for(const pt of this._world.bodies){if(pt.mass===0)continue;const gt=this._bodyMeshMap.get(pt);if(gt&&(gt.updateMatrixWorld(),gt.getWorldPosition(i),gt.getWorldQuaternion(c),gt.getWorldScale(s),i.manhattanDistanceTo(e.copy(pt.position))>0&&(ct=!0),c.angleTo(o.copy(pt.quaternion))>0&&(ct=!0),ct)){if(g.compose(e,o,s),!gt.parent)throw new Error("no parent");b.copy(gt.parent.matrixWorld).invert(),b.multiply(g),b.decompose(e,o,s),gt.position.copy(e),gt.quaternion.copy(o)}}this._dirty=ct,h.setDirty(),h.renderer.resetShadows(),st==null||st.bakeShadows(),this.nextSteps>0&&(this.enabled=!1,this.nextSteps=0)}),h.scene.addEventListener("update",st=>{this._bodyMeshMap.forEach((at,ct)=>{ct.velocity.set(0,0,0),ct.angularVelocity.set(0,0,0)})}),h.scene.addEventListener("addSceneObject",st=>{var ct;const at=(ct=st.object)==null?void 0:ct.modelObject;at&&at.traverse(pt=>{const gt=pt.uiConfig;gt&&Array.isArray(gt.children)&&(gt.children.push({type:"folder",label:"Physics",children:[{type:"button",label:"Make Body",value:()=>this.makeBody(pt)},{type:"number",label:"Mass",hidden:()=>!pt._physicsBody,getValue:()=>{var At;return((At=pt._physicsBody)==null?void 0:At.mass)??0},setValue:At=>{pt._physicsBody&&(pt._physicsBody.mass=At)}}]}),pt.userData.physicsMass!==void 0&&this.makeBody(pt))})}),h.canvas.addEventListener("pointerdown",st=>{if(!this.enabled||!st.isPrimary)return;h.getPlugin(vo).enabled=!1;const at=rt(st),ct=new _.iMs;ct.setFromCamera(at,h.scene.activeCamera.cameraObject);const pt=ct.intersectObjects([...this._bodyMeshMap.values()],!0);if(!pt.length)return;let gt,At=null,xt=pt[0];for(const Mt of pt){for(At=Mt.object,xt=Mt;!(At==null||At.visible&&At.material);)At=At.parent;if(At)break}if(!At)return;for(;At.parent&&!gt;){for(const[Mt,It]of this._bodyMeshMap.entries())if(It===At){Mt.mass>0&&(gt=Mt);break}At=At.parent}if(!gt)return;h.scene.activeCamera.interactionsEnabled=!1,this._movementPlane.position.copy(xt.point),this._movementPlane.lookAt(h.scene.activeCamera.cameraObject.getWorldPosition(new _.Pa4));const yt=new en().copy(xt.point).vsub(gt.position),_t=gt.quaternion.inverse().vmult(yt);this._jointBody.position.copy(xt.point),this._jointConstraint=new eG(gt,_t,this._jointBody,new en(0,0,0)),this._world.addConstraint(this._jointConstraint)}),h.canvas.addEventListener("pointermove",st=>{if(!this.enabled||!st.isPrimary||!this._jointConstraint)return;const at=rt(st),ct=new _.iMs;ct.setFromCamera(at,h.scene.activeCamera.cameraObject);const pt=ct.intersectObject(this._movementPlane);if(!pt.length)return;const gt=pt[0];this._jointBody.position.copy(gt.point),this._jointConstraint.update()}),h.canvas.addEventListener("pointerup",st=>{this.enabled&&st.isPrimary&&(h.getPlugin(vo).enabled=!0,h.scene.activeCamera.interactionsEnabled=!0,this._jointConstraint&&(this._world.removeConstraint(this._jointConstraint),this._jointConstraint=void 0))})}makeBody(h){if(h.isLight||h._physicsBody)return;const e=[];let i=0;if(h.updateMatrixWorld(),h.traverse(et=>{const tt=et;if(!tt.isMesh)return;if(tt._physicsShape)return void e.push(tt._physicsShape);if(i+=tt.userData.physicsMass??1,tt.addEventListener("objectUpdate",()=>{tt.userData.physicsMass===0&&(this._ground.position.y=tt.position.y,this._bodyMeshMap.forEach((st,at)=>{at.velocity.set(0,0,0),at.angularVelocity.set(0,0,0),at.force.set(0,0,0),at.torque.set(0,0,0)}))}),tt.userData.physicsMass===0)return;const rt=h8(tt,{type:Vu.HULL});rt?(e.push([rt.shape,tt]),tt._physicsShape=rt.shape):console.warn("Failed to convert mesh to cannon shape",tt)}),!e.length)return;const s=new vs({mass:i,angularVelocity:new en(0,0,0),velocity:new en(0,0,0)}),o=new _.Pa4,c=new _._fP,g=new _.Pa4,b=new _.yGw;for(const[et,tt]of e)tt!==h?(tt.updateMatrixWorld(),b.copy(h.matrixWorld).invert(),b.multiply(tt.matrixWorld),b.decompose(o,c,g),s.addShape(et,new en(...o.toArray()),new Iu(...c.toArray()))):s.addShape(et);s.position.set(...h.getWorldPosition(o).toArray()),s.quaternion.set(...h.getWorldQuaternion(c).toArray()),s.angularVelocity.set(0,0,0),s.velocity.set(0,0,0),h.addEventListener("objectUpdate",()=>{s.position.set(...h.getWorldPosition(o).toArray()),s.quaternion.set(...h.getWorldQuaternion(c).toArray()),s.angularVelocity.set(0,0,0),s.velocity.set(0,0,0)}),this._world.addBody(s),this._bodyMeshMap.set(s,h),h._physicsBody=s,h.setDirty({sceneUpdate:!0,updateGround:!1,frameFade:!1,refreshUi:!0})}};PA.PluginType="CannonPhysics",wD([Nr("Enabled",h=>({onChange:()=>{}})),Mn()],PA.prototype,"enabled",void 0),wD([Ap()],PA.prototype,"stepPhysics",void 0),wD([go("Make Root Bodies")],PA.prototype,"makeRootBodies",void 0),PA=bD=wD([Ms("Physics (dev)")],PA);var d8=__webpackgi_require__(819),p8=__webpackgi_require__(665);const f8=(h,e,i)=>{var g,b;const s=h.controller_,o=(b=(g=s.parent)==null?void 0:g.children)==null?void 0:b.indexOf(s);return!(((et,tt)=>tt.controller_.rackController.rack===et.controller_.parent)(h,e)&&o===i||(e.add(h,i),0))},NF=(h,e,i,s)=>{var st;let o=e.uiRef;o!=null&&o.controller_.viewProps.get("disposed")&&(o=void 0);const c=o==null?void 0:o.expanded;if(!o){const at=h.addFolder({title:""});o=at,o.on("fold",ct=>{var gt,At,xt;let pt=at.expanded;(0,_e.safeSetProperty)(e,"expanded",pt,!0),pt=(0,_e.getOrCall)(e.expanded)??pt,pt!==at.expanded&&(at.expanded=pt),(gt=e.uiRefresh)==null||gt.call(e,"postFrame",!0,10),pt?(At=e.onExpand)==null||At.call(e,e):(xt=e.onCollapse)==null||xt.call(e,e)})}if(!o)return o;o.expanded=(0,_e.getOrCall)(e.expanded)??c??!1;const g=(e.children??[]).map(at=>at&&(0,_e.getOrCall)(at)).flat(2).filter(at=>at);let b=0;for(const at of g){if(Array.isArray(at)||typeof at!="object"){console.error("child is not an object",at);continue}let ct=at.uiRef;ct&&ct.controller_.viewProps.get("disposed")&&(at.uiRef=void 0,at.uiRefresh=void 0),ct=at.uiRef,ct||(i.appendUiObject({uiConfig:at},o),ct=at.uiRef),ct&&f8(ct,o,b++)&&i.appendUiObject({uiConfig:at},o)}let et=o.children;for(;et.length>b;){const at=et[et.length-1];o.remove(at),at.dispose(),et=o.children}o.controller_.props.set("title",(0,_e.getOrCall)(e.label)??"");const tt=o.controller_.view.containerElement,rt=(0,_e.getOrCall)(e.domChildren,[]);if((rt==null?void 0:rt.length)!==void 0){const at=[];for(let ct=0;ct<tt.children.length;ct++){const pt=tt.children[ct];(st=pt.dataset)!=null&&st.tpCustomDOM&&at.push(pt)}for(const ct of at)tt.removeChild(ct);for(const ct of rt)ct.parentElement!==tt&&(tt.appendChild(ct),ct.dataset.tpCustomDOM="true");o.controller_.foldable.cleanUpTransition()}return o},m8=(h,e,i,s)=>{const[o,c]=e.property??[void 0,void 0],g=(0,_e.getOrCall)(e.label)??c;let b=e.uiRef;return b!=null&&b.controller_.viewProps.get("disposed")&&(b=void 0),b||(b=h.addButton({title:""}),b.on("click",async()=>{const et=[];e.prompt&&et.push(await i.prompt(...e.prompt));let tt=o&&c?o[c]:void 0,rt=o;if(tt||(tt=e.value,rt=e),typeof tt=="function"){const st=()=>{i.removeEventListener("postFrame",st),tt.call(rt??e,...et)};i.addEventListener("postFrame",st)}else console.warn("Invalid action type for button")})),b&&(b.title=(g??"click me")+""),b},g8=(h,e,i,s)=>{const o=Object.fromEntries(((0,_e.getOrCall)(e.children)??[]).map(c=>(0,_e.getOrCall)(c)).flat(2).filter(c=>c).map(c=>{const g=(0,_e.getOrCall)(c.label);return[g,c.value??g]}));return hy(h,e,i,{options:o,...s??{}})},v8=(h,e,i,s)=>{const o=(0,_e.getOrCall)(e.bounds),c=((o==null?void 0:o.length)??0)>=2?o[1]:1,g=((o==null?void 0:o.length)??0)>=1?o[0]:0,b=e.stepSize||void 0;return hy(h,e,i,{min:g,max:c,step:b,...s??{}})},xD=(h,e,i,s)=>{const o=(0,_e.getOrCall)(e.bounds);if(!o||o.length<1)return hy(h,e,i,{...s??{}});const c=(o.length??0)>=2?o[1]:1,g=(o.length??0)>=1?o[0]:0,b={min:g,max:c,step:e.stepSize??(c-g)/100},et={x:b,y:b};e.type!=="vec3"&&e.type!=="vec4"||(et.z=b),e.type==="vec4"&&(et.w=b);const tt=e.property;if(e.value===void 0&&tt&&tt[0]&&typeof tt[0]=="object"&&tt[0][tt[1]]&&Array.isArray(tt[0][tt[1]])){const[rt,st]=tt,at=rt[st],ct=at.length,pt=new(ct===2?_.FM8:ct===3?_.Pa4:_.Ltg)().fromArray(at);e.value=pt,e.property=void 0,e.onChange=[()=>{rt[st]=pt.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(gt=>gt),e.label===void 0&&(e.label=st)}return hy(h,e,i,{...et,...s??{}})},_8=(h,e,i,s)=>{var c;const o=e.property;if(e.value===void 0&&o&&typeof o[0]=="object"&&((c=o[0][o[1]])!=null&&c.isColor)){const[g,b]=o,et=_.KI_;Object.defineProperty(e,"value",{get:()=>{const tt=g[b];return tt?new zo(tt).getHex(et):0},set:tt=>{const rt=g[b],st=new zo().setHex(tt,et);rt.isColor?rt.copy(st):typeof rt=="number"?g[b]=st.getHex():typeof rt=="string"&&(g[b]="#"+st.getHexString()),typeof(g==null?void 0:g.setDirty)=="function"&&g.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(tt=>tt),e.label===void 0&&(e.label=b+"")}return(s=s??{}).view="color",(0,_e.getOrCall)(e.inlinePicker)&&(s.picker="inline"),hy(h,e,i,s)},hy=(h,e,i,s)=>{var b;let o=(0,_e.getOrCall)(e.property);if((e.getValue||e.setValue)&&o&&console.error("specify either property or value, or getValue and setValue",e),o)e.value&&console.warn("Both property and value are defined, value will be ignored",e);else if((Object.hasOwn?Object.hasOwn(e,"value"):e.hasOwnProperty("value"))||e.value!==void 0||!e.getValue&&!e.setValue||(Object.defineProperty(e,"value",{get:()=>{var et;return(et=e.getValue)==null?void 0:et.call(e)},set:et=>{var tt;return(tt=e.setValue)==null?void 0:tt.call(e,et)}}),o=[e,"value"]),o||e.value===void 0||(o=[e,"value"]),!o)return void console.error("cannot determine property",e);s=s??{};const c={label:(0,_e.getOrCall)(e.label)??o[1],...s};let g=e.uiRef;if(g!=null&&g.controller_.viewProps.get("disposed")&&(g=void 0),!g&&typeof o[0]=="object"&&o[0]){const[et,tt]=o;try{g=e.isMonitor?h.addMonitor(et,tt,c):h.addInput(et,tt,c).on("change",rt=>{[e.onChange].flat().forEach(st=>typeof st=="function"&&(st==null?void 0:st(rt))),typeof(et==null?void 0:et.setDirty)=="function"&&et.setDirty(rt)})}catch(rt){if(!rt.message.startsWith("No matching controller for"))throw rt;g=void 0}}if(g){for(const[et,tt]of Object.entries(c)){const rt=g.controller_.props.value(et);rt!==void 0&&rt.rawValue!==tt&&g.controller_.props.set(et,tt)}e.type==="slider"&&(c.min!==void 0&&g.controller_.valueController.sliderController.props.set("minValue",c.min),c.max!==void 0&&g.controller_.valueController.sliderController.props.set("maxValue",c.max)),(b=g==null?void 0:g.controller_.valueController.view.inputElement)==null||b.setAttribute("placeholder",(0,_e.getOrCall)(e.placeholder)??""),g.refresh()}return g};class UF extends _e.SimpleEventDispatcher{constructor(e=!1,i=!1,s=!1,o=!0,c=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:NF,folder:NF,input:hy,number:hy,slider:v8,dropdown:g8,checkbox:hy,color:_8,vec:xD,vec2:xD,vec3:xD,vec4:xD,button:m8,monitor:(b,et,tt,rt)=>(et.isMonitor=!0,hy(b,et,tt,rt)),dummy:(b,et,tt,rt)=>hy(b,et,tt,rt)},this.alert=async b=>alert(b),this.confirm=async b=>confirm(b),this.prompt=async(b,et,tt=!0)=>prompt(b,et),this._expand=e,this._limitedOptions=s;const g=this._createUiContainer();c.appendChild(g),this._pane=new p8.Pane({title:"Configuration",container:g}),this._pane.expanded=this._expand,o&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const i=this._refreshQueue[e],s=[],o=(0,_e.now)(),c=o-this._lastModeTime[e];i.forEach(g=>{g[2]>.001?(g[2]-=c,s.push(g)):this._refreshUiObject(g[0],g[1],g[2])}),this._refreshQueue[e]=s,this._lastModeTime[e]=o}addToRefreshQueue(e,i){var b;const s=(b=i[0])==null?void 0:b.uiConfig,o=s==null?void 0:s.uuid,c=this._refreshQueue[e],g=c.find(et=>et[3]===o);g?g[2]=Math.max(g[2],i[2]):c.push([...i,o]),this._refreshQueue[e]=c}dispose(){var e;(e=this._pane)==null||e.dispose(),this._pane=void 0}appendUiObject(e,i){e&&this._appendUiObject(e,i)}_appendUiObject(e,i){var o,c;const{uiConfig:s}=e??{};if(s&&(!this._limitedOptions||s.limitedUi)&&(i=i??this._pane,s.type)){s.uuid||(s.uuid=np()),s.uiRef&&s.uiRefType!==s.type&&this.removeUiConfig(s);const g=(c=(o=this._typeGenerators)[s.type])==null?void 0:c.call(o,i,s,this);g&&(g.hidden=(0,_e.getOrCall)(s.hidden)??!1,g.disabled=(0,_e.getOrCall)(s.disabled)??!1),s.uiRef=g,s.uiRefType=g?s.type:void 0,s.uiRefresh=(b="postFrame",et=!1,tt=0)=>this._uiObjectRefresh(b,(e==null?void 0:e.uiConfig)??s,i,et,tt),g==null||g.controller_.viewProps.handleDispose(()=>{s.uiRef=void 0,s.uiRefType=void 0,s.uiRefresh=void 0})}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var i,s;e&&e.uiRef&&((s=(i=e.uiRef).dispose)==null||s.call(i),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,i,s,o,c){(o?ED(i,s):[{uiConfig:i,parentFolder:s}]).forEach(g=>{const b=[{uiConfig:g.uiConfig},g.parentFolder,c];e==="immediate"?this._refreshUiObject(...b):this.addToRefreshQueue(e,b)})}_refreshUiObject(e,i,s=0){this._appendUiObject(e,i),s>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=(0,_e.createDiv)({id:"tweakpaneUiContainer",addToBody:!1});return(0,_e.createStyles)(_e.css`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function ED(h,e,i){return i=i??[],h&&h.uiRef&&(i.push({uiConfig:h,parentFolder:e}),[...h.children||[]].forEach(s=>{typeof s!="function"&&s&&(Array.isArray(s)?s.forEach(o=>i=ED(o,h.uiRef,i)):i=ED(s,h.uiRef,i))})),i}class FF{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const o=s.indexOf(i);o!==-1&&s.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let o=0,c=s.length;o<c;o++)s[o].call(this,e);e.target=null}}}function jF(h){return document.createElementNS("http://www.w3.org/1999/xhtml",h)}const zF={};function EL(h){h in zF||(zF[h]=!0,console.warn(h))}let RM;class y8{static getDataURL(e,i=!1){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let s;if(e instanceof HTMLCanvasElement)s=e;else{RM===void 0&&(RM=jF("canvas")),RM.width=e.width,RM.height=e.height;const o=RM.getContext("2d");e instanceof ImageData?o.putImageData(e,0,0):o.drawImage(e,0,0,e.width,e.height),s=RM}return!i&&(s.width>2048||s.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),s.toDataURL("image/jpeg",.6)):s.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=jF("canvas");i.width=e.width,i.height=e.height;const s=i.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const o=s.getImageData(0,0,e.width,e.height),c=o.data;for(let g=0;g<c.length;g++)c[g]=255*Yo(c[g]/255);return s.putImageData(o,0,0),i}if(e.data){const i=e.data.slice(0);for(let s=0;s<i.length;s++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[s]=Math.floor(255*Yo(i[s]/255)):i[s]=Yo(i[s]);return{data:i,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class A8{constructor(e=null){this.isSource=!0,this.uuid=Pn(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},o=this.data;if(o!==null){let c;if(Array.isArray(o)){c=[];for(let g=0,b=o.length;g<b;g++)o[g].isDataTexture?c.push(SL(o[g].image)):c.push(SL(o[g]))}else c=SL(o);s.url=c}return i||(e.images[this.uuid]=s),s}}function SL(h){if(typeof HTMLImageElement<"u"&&h instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&h instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&h instanceof ImageBitmap)return y8.getDataURL(h);if(h.data){let e=[];try{e=Array.from(h.data)}catch(i){i.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(i),e=h.data}return{data:e,width:h.width,height:h.height,type:h.data.constructor.name}}return h.url!==void 0?h.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let b8=0;class M1 extends FF{constructor(e=M1.DEFAULT_IMAGE,i=M1.DEFAULT_MAPPING,s=1001,o=1001,c=Ml,g=1008,b=1023,et=1009,tt=M1.DEFAULT_ANISOTROPY,rt=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:b8++}),this.uuid=Pn(),this.name="",this.source=new A8(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=s,this.wrapT=o,this.magFilter=c,this.minFilter=g,this.anisotropy=tt,this.format=b,this.internalFormat=null,this.type=et,this.offset=new tn(0,0),this.repeat=new tn(1,1),this.center=new tn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Tl,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof rt=="string"?this.colorSpace=rt:(EL("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=rt===Ll?_l:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===_l?Ll:3e3,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),i||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return EL("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===_l?Ll:3e3}set encoding(e){EL("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Ll?_l:""}}M1.DEFAULT_IMAGE=null,M1.DEFAULT_MAPPING=300,M1.DEFAULT_ANISOTROPY=1;var SD=__webpackgi_require__(898),XI={};SD.Z&&SD.Z.locals&&(XI.locals=SD.Z.locals);var CL,ML=0,yS={};yS.styleTagTransform=p1(),yS.setAttributes=h1(),yS.insert=function(h,e){(e.target||document.head).appendChild(h)},yS.domAPI=u1(),yS.insertStyleElement=d1(),XI.use=function(h){return yS.options=h||{},ML++||(CL=c1()(SD.Z,yS)),XI},XI.unuse=function(){ML>0&&!--ML&&(CL(),CL=null)};var w8=XI;class CD extends UF{constructor(e=!1,i=!1,s=!1,o=document.body){super(e,i,s,!1),this.dependencies=[Lr],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=c=>{this.dispatchEvent(c),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async c=>this._viewer?this._viewer.alert(c):super.alert(c),this.confirm=async c=>this._viewer?this._viewer.confirm(c):super.confirm(c),this.prompt=async(c,g,b=!0)=>this._viewer?this._viewer.prompt(c,g,b):super.prompt(c,g,b),this._pane.registerPlugin(d8),w8.use({target:o})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(i=>(s,o,c,g)=>{let b=o.property||o.__property;const et="placeholder";if(o.value===void 0&&(o.getValue||o.setValue)&&(Object.defineProperty(o,"_value",{get:()=>{var tt;return(tt=o.getValue)==null?void 0:tt.call(o)},set:tt=>{var rt;return(rt=o.setValue)==null?void 0:rt.call(o,tt)}}),b=[o,"_value"]),(!(Object.hasOwn?Object.hasOwn(o,"value"):o.hasOwnProperty("value"))||o.value===void 0)&&b&&typeof b[0]=="object"){const[tt,rt]=b,st=(0,_e.makeTextSvg)("Render Target"),at=(0,_e.makeTextSvg)("Data Texture"),ct=(0,_e.makeTextSvg)("CUBE Texture"),pt=(0,_e.makeTextSvg)("Compressed Texture"),gt={},At={};Object.defineProperty(o,"value",{get:()=>{let xt,yt=tt[rt];if(yt!=null&&yt.get&&(yt=yt.get()),!yt)return et;if(yt.isCompressedTexture&&!yt.image.tp_src&&(yt.image.tp_src=pt),yt.isTexture?(yt.image&&!yt.image.tp_src&&(yt.image instanceof ImageBitmap||yt.image instanceof HTMLImageElement||yt.image instanceof HTMLVideoElement)?yt.image.tp_src=(0,_e.imageBitmapToBase64)(yt.image,160):yt.image&&yt.isRenderTargetTexture&&!yt.image.tp_src?yt.__target&&(yt.image.tp_src=i.renderer.renderTargetToDataUrl(yt.__target)):yt.image&&!yt.image.tp_src&&(yt.image.tp_src=vy(yt,160,!1).toDataURL("image/png",90)),yt.isRenderTargetTexture&&!yt.image.tp_src&&(yt.image.tp_src=st),yt.isDataTexture&&!yt.image.tp_src&&(yt.image.tp_src=at),yt.image&&(xt=yt.image.tp_src_uuid,xt=xt?gt[xt]:void 0,xt||(xt=yt.image.tp_src||yt.image.src))):typeof yt=="string"?xt=yt:yt.domainMin?(xt=yt.texture,yt.texture.image&&!yt.texture.image.tp_src&&(yt.texture.image.tp_src=ct),yt.texture.image&&(xt=yt.texture.image.tp_src_uuid,xt=xt?gt[xt]:void 0,xt||(xt=yt.texture.image.tp_src||yt.texture.image.src))):yt&&console.error("unknown value",yt),xt||(xt=et),yt.image&&!yt.image.tp_src_uuid){const _t=np();yt.image.tp_src_uuid=_t,At[xt]=_t}return typeof xt=="string"&&(xt=gt[xt]??xt),xt},set:xt=>{var It,Bt,Lt,Ht,Jt,sn,on,mn,cn;const yt=tt[rt],_t=un=>{tt[rt]=un,un!=null&&un.isTexture&&(un.flipY=un.isDataTexture?un.flipY:(yt==null?void 0:yt.flipY)??!0)};if(typeof xt=="string")return void(typeof yt=="string"&&_t(xt));if(!xt)return void(o.value=et);if(xt.isPlaceholder)return void(yt&&(_t(typeof yt=="string"?"":null),typeof(tt==null?void 0:tt.setDirty)=="function"&&tt.setDirty()));let Mt=xt.tp_src_uuid;if(Mt||(Mt=xt.src??xt.tp_src,Mt=At[Mt]??Mt,delete At[Mt],xt.tp_src_uuid=Mt),Mt&&(gt[Mt]=xt),typeof yt!="string"){if(!((yt==null?void 0:yt.image)===xt||((It=yt==null?void 0:yt.image)==null?void 0:It.src)===xt.src||((Bt=yt==null?void 0:yt.image)==null?void 0:Bt.tp_src)===xt.tp_src&&xt.tp_src!=null||((Lt=yt==null?void 0:yt.image)==null?void 0:Lt.tp_src)===xt.src&&xt.src!=null||((Ht=yt==null?void 0:yt.image)==null?void 0:Ht.src)===xt.tp_src&&xt.tp_src!=null))if(xt instanceof File){const un=i==null?void 0:i.getPlugin(Lr);if(!un)throw"Viewer or AssetManagerPlugin not found";(Jt=un.importer)==null||Jt.importSingle({file:xt,path:xt.src}).then(bn=>{var xn,Cn,Jn,Kn;if(bn){bn.isDataTexture&&(bn.needsUpdate=!0);const gr=(Jn=(Cn=(xn=xt.src)==null?void 0:xn.split("?"))==null?void 0:Cn[0])==null?void 0:Jn.split(".").pop();bn.userData&&(bn.userData.mimeType||(bn.userData.mimeType="image/"+(["jpg","jpeg"].includes(gr)?"jpeg":"png"))),_t(bn),[o.onChange].flat().forEach(nr=>typeof nr=="function"&&(nr==null?void 0:nr())),typeof(tt==null?void 0:tt.setDirty)=="function"&&tt.setDirty(),(Kn=o.uiRefresh)==null||Kn.call(o,"postFrame",!1)}})}else{const un=new M1(xt);un.assetType="texture",un.needsUpdate=!0;const bn=(mn=(on=(sn=xt.src)==null?void 0:sn.split("?"))==null?void 0:on[0])==null?void 0:mn.split(".").pop();un.userData.mimeType||(un.userData.mimeType="image/"+(["jpg","jpeg"].includes(bn)?"jpeg":"png"));const xn=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(rt);un.colorSpace=xn?_.GUF:_.KI_,un.wrapS=_.rpg,un.wrapT=_.rpg,_t(un),[o.onChange].flat().forEach(Cn=>typeof Cn=="function"&&(Cn==null?void 0:Cn())),typeof(tt==null?void 0:tt.setDirty)=="function"&&tt.setDirty(),(cn=o.uiRefresh)==null||cn.call(o,"postFrame",!1)}}else _t(Mt)}}),o.__property=o.property,o.property=void 0,o.label===void 0&&(o.label=rt)}return(g=g??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],g.imageFit===void 0&&(g.imageFit="contain"),g.clickCallback===void 0&&(g.clickCallback=(tt,rt)=>{var At;const st=tt==null?void 0:tt.target,at=st==null?void 0:st.getBoundingClientRect();if(!at)return void rt.click();const ct=o.uiRef.controller_.valueController.value.rawValue,pt=ct===et||ct!=null&&ct.isPlaceholder?{}:{"remove image":()=>{var Mt;o.uiRef.controller_.valueController.value.setRawValue("");const[xt,yt]=o.property||o.__property||[o,"value"],_t=typeof xt[yt]=="string";xt[yt]=_t?"":null,[o.onChange].flat().forEach(It=>typeof It=="function"&&(It==null?void 0:It())),typeof(xt==null?void 0:xt.setDirty)=="function"&&xt.setDirty(),(Mt=o.uiRefresh)==null||Mt.call(o,"postFrame",!1),uv.Remove()},"download image":async()=>{uv.Remove();const[xt,yt]=o.property||o.__property||[o,"value"],_t=xt[yt];if(!_t)return;const Mt=(_t==null?void 0:_t.image)??o.uiRef.controller_.valueController.value.rawValue;let It=_t.__rootBlob?_t.__rootBlob.objectUrl||URL.createObjectURL(_t.__rootBlob):_t.userData.rootPath||(Mt==null?void 0:Mt.src);Mt&&(Mt instanceof ImageBitmap||Mt instanceof HTMLImageElement||Mt instanceof HTMLVideoElement)&&!It&&(It=(0,_e.imageBitmapToBase64)(Mt));let Bt=_t.__rootBlob?_t.__rootBlob.name||"image."+(_t.__rootBlob.ext||"png"):null;if(!It&&_t.isRenderTargetTexture){const Ht=_t.__target;if(_t.type===_.ywz)It=i.renderer.renderTargetToDataUrl(Ht,"image/png",90),Bt="renderTarget.png";else{const Jt=new qP().parse(i.renderer.rendererObject,Ht),sn=new Blob([Jt],{type:"image/x-exr"});if(!sn)return void console.error("cannot export render target",Mt,xt[yt],xt,yt,o);Bt="renderTarget.exr",It=URL.createObjectURL(sn)}}if(!It&&_t.isDataTexture){const Ht=new qP().parse(void 0,_t),Jt=new Blob([Ht],{type:"image/x-exr"});if(!Jt)return void console.error("cannot export data texture",Mt,xt[yt],xt,yt,o);Bt="dataTexture.exr",It=URL.createObjectURL(Jt)}if(!It)return void console.error("cannot export image",Mt,xt[yt],xt,yt,o);const Lt=document.createElement("a");document.body.appendChild(Lt),Lt.style.display="none",Lt.href=It,Lt.download=Bt||(It.startsWith("data:")?"image.png":It.split("/").pop()??"image.png"),Lt.target="_blank",Lt.click(),document.body.removeChild(Lt)}},gt=uv.Create({...pt,"set/replace image":()=>{rt.click(),uv.Remove()},"from url":async()=>{var It,Bt;let xt="";if(xt=await c.prompt("Load texture: Enter Image/Texture URL",xt,!0),!xt||!xt.startsWith("http")&&!xt.startsWith("data:image"))return xt!==null&&await c.alert("Loading Image: Invalid URL"),void uv.Remove();xt=xt.trim();const[yt,_t]=o.property||o.__property||[o,"value"],Mt=yt[_t];if(typeof Mt=="string")yt[_t]=xt,[o.onChange].flat().forEach(Lt=>typeof Lt=="function"&&(Lt==null?void 0:Lt())),typeof(yt==null?void 0:yt.setDirty)=="function"&&yt.setDirty(),(It=o.uiRefresh)==null||It.call(o,"postFrame",!1);else{const Lt=i==null?void 0:i.getPlugin(Lr);if(!Lt)throw"Viewer or AssetManagerPlugin not found";(Bt=Lt.importer)==null||Bt.importSinglePath(xt).then(Ht=>{var Jt;if(Ht){Ht.isDataTexture?Ht.needsUpdate=!0:Ht&&(Mt==null?void 0:Mt.flipY)!==void 0&&(Ht.flipY=Mt.flipY);const sn=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(_t);Ht.colorSpace=sn?_.GUF:_.KI_,yt[_t]=Ht,[o.onChange].flat().forEach(on=>typeof on=="function"&&(on==null?void 0:on())),typeof(yt==null?void 0:yt.setDirty)=="function"&&yt.setDirty(),(Jt=o.uiRefresh)==null||Jt.call(o,"postFrame",!1)}else console.warn("Failed to load texture",xt)})}uv.Remove()},cancel:()=>{uv.Remove()}},2,at.height+8);(At=st.parentElement)==null||At.appendChild(gt),at.y>.7*document.body.clientHeight&&(gt.style.top="auto",gt.style.bottom=at.height+8+"px")}),g.view="input-image",hy(s,o,c,g)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var o;const i=(o=this._viewer)==null?void 0:o.getPlugin(e);if(!i)return void console.warn("plugin not found:",e);this._plugins.push(i),i.uiConfig&&(i.uiConfig.limitedUi=!0),i.uiConfig&&i.uiConfig.hidden===void 0&&(i.uiConfig.hidden=!1),this._appendUiObject(i);const s=i.uiConfig;if(s!=null&&s.uiRef&&i.toJSON){const c=typeof i.toJSON=="function"?i.toJSON():null;i.resetDefaults=async()=>{var et,tt;await((et=i.fromJSON)==null?void 0:et.call(i,c)),(tt=s.uiRefresh)==null||tt.call(s,"postFrame",!0)};const g=s.uiRef.controller_.view.element,b=(0,_e.createDiv)({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});b.onclick=et=>{const tt={};typeof i.toJSON=="function"&&(tt["download preset"]=async()=>{var at,ct;const st=(ct=(at=this._viewer)==null?void 0:at.getPlugin(Lr))==null?void 0:ct.exportPluginPreset(i);await(0,_e.downloadBlob)(new Blob([JSON.stringify(st,null,2)],{type:"application/json"}),"preset."+i.constructor.PluginType+".json"),uv.Remove()}),typeof i.fromJSON=="function"&&(tt["upload preset"]=async()=>{var gt,At,xt;uv.Remove();const st=await(0,_e.uploadFile)(!1,!1);if(st.length===0)return;const at=st[0],ct=await at.text(),pt=JSON.parse(ct);await((At=(gt=this._viewer)==null?void 0:gt.getPlugin(Lr))==null?void 0:At.importPluginPreset(pt,i)),(xt=s.uiRefresh)==null||xt.call(s,"postFrame",!0)},c&&(tt["reset defaults"]=async()=>{var st;uv.Remove(),await((st=i.resetDefaults)==null?void 0:st.call(i))}));const rt=uv.Create(tt,g.clientWidth-120,12);g.append(rt),et.preventDefault()},g.appendChild(b)}return s}setupPlugins(...e){e.forEach(i=>this.setupPluginUi(i))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var s;const i=e.uiConfig;i&&((0,_e.getOrCall)(i.hidden)!==!0?(s=i.uiRefresh)==null||s.call(i,"postFrame",!0):i.uiRef&&(i.uiRef.hidden=!0))})}}CD.PluginType="TweakpaneUi";class YI extends hs{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._savedBg=!1,this.lastBgVal=null,this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[{label:"Color",type:"color",inlinePicker:!0,property:[this,"sceneBackgroundColor"],limitedUi:!0},()=>({label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0}),{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",getValue:()=>{var e;return((e=this._viewer)==null?void 0:e.scene.backgroundIntensity)??1},setValue:e=>{this._viewer&&(this._viewer.scene.backgroundIntensity=e)},bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{this._viewer&&(this._viewer.scene.background=null,this._viewer.scene.backgroundColor=null)}},()=>({label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0}),{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0},{type:"checkbox",label:"Fixed Env Direction",property:[this,"sceneEnvironmentFixedDirection"]},{type:"checkbox",label:"Artistic Lighting",getValue:()=>{var e;return((e=this._viewer)==null?void 0:e.renderer.useLegacyLights)??!0},setValue:e=>{this._viewer&&(this._viewer.renderer.useLegacyLights=e)}}]}}get sceneBackgroundColor(){var i,s;const e=(s=(i=this._viewer)==null?void 0:i.scene.backgroundColor)==null?void 0:s.getHex(_.KI_);return e!==void 0&&(this._savedBg=!0),e||0}set sceneBackgroundColor(e){this._viewer&&this._savedBg&&(this._viewer.scene.backgroundColor||(this._viewer.scene.backgroundColor=new zo),this._viewer.scene.backgroundColor.setHex(e),this._viewer.scene.setDirty())}get sceneBackground(){var i;const e=(i=this._viewer)==null?void 0:i.scene.background;return e&&(e.isTexture||e.assetType==="texture")?e:null}set sceneBackground(e){this._viewer&&(this._viewer.scene.background=e)}get sceneEnvironment(){var e;return((e=this._viewer)==null?void 0:e.scene.environment)||null}set sceneEnvironment(e){this._viewer&&(this._viewer.scene.environment=e)}get sceneEnvironmentRotation(){var e,i;return((i=(e=this._viewer)==null?void 0:e.scene.environment)==null?void 0:i.rotation)??0}set sceneEnvironmentRotation(e){var s,o;const i=(s=this._viewer)==null?void 0:s.scene.environment;i&&(i.rotation=e,(o=this._viewer)==null||o.scene.setDirty())}get sceneEnvironmentIntensity(){var e;return((e=this._viewer)==null?void 0:e.scene.envMapIntensity)??1}set sceneEnvironmentIntensity(e){var i;(i=this._viewer)!=null&&i.scene&&(this._viewer.scene.envMapIntensity=e)}get sceneEnvironmentFixedDirection(){var e;return((e=this._viewer)==null?void 0:e.scene.fixedEnvMapDirection)??!1}set sceneEnvironmentFixedDirection(e){var i;(i=this._viewer)!=null&&i.scene&&(this._viewer.scene.fixedEnvMapDirection=e)}get envmapBg(){var e,i,s;return((e=this._viewer)==null?void 0:e.scene.background)==="environment"||((i=this._viewer)==null?void 0:i.scene.background)===((s=this._viewer)==null?void 0:s.scene.environment)}set envmapBg(e){if(this._viewer)if(e){const i=this._viewer.scene.background;i&&i!==this._viewer.scene.environment&&i!=="environment"&&(this.lastBgVal=i),this._viewer.scene.background="environment"}else this._viewer.scene.background!==this._viewer.scene.environment&&this._viewer.scene.background!=="environment"||(this._viewer.scene.background=this.lastBgVal)}async onAdded(e){await super.onAdded(e),this.lastBgVal=e.scene.background,e.scene.addEventListener("backgroundChanged",()=>{var i,s;(s=(i=this.uiConfig).uiRefresh)==null||s.call(i,"postFrame",!0)}),e.scene.addEventListener("environmentChanged",()=>{var i,s;(s=(i=this.uiConfig).uiRefresh)==null||s.call(i,"postFrame",!0)})}}YI.PluginType="SimpleBackgroundEnvUiPlugin1";class KI extends hs{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{var e,i;(i=(e=this._uiConfig).uiRefresh)==null||i.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)==null||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var e,i;return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...((i=(e=this._viewer)==null?void 0:e.scene.modelRoot.modelObject.children)==null?void 0:i.map(s=>s.assetType==="light"?null:s.uiConfig).filter(s=>s!=null))??[]),this._uiConfig):this._uiConfig}_sceneUpdate(){var e,i;(i=(e=this._uiConfig)==null?void 0:e.uiRefresh)==null||i.call(e,"postFrame",!0)}}KI.PluginType="SimpleUi";var x8=__webpackgi_require__(1),E8=__webpackgi_require__.n(x8)();class JI extends hs{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=(0,_e.createDiv)({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(i,s)=>(i.push({text:s.name||"unnamed",id:s.uuid,children:s.children.reduce(this._buildData,[])}),i),this._findVisible=(i,s)=>(s.visible&&(s.children.length<1?i.push(s.uuid):i.push(...s.children.reduce(this._findVisible,[]))),i),this._setVisible=i=>{var s;(s=this._viewer)==null||s.doOnce("postFrame",()=>{var g,b,et;const o=(g=this._viewer)==null?void 0:g.scene.modelRoot;if(!o||i==null)return;const c=new Set;o.traverse(tt=>{tt!==o&&(tt.visible=i.includes(tt.uuid),tt.visible&&tt.traverseAncestors(rt=>c.add(rt)))}),c.forEach(tt=>tt.visible=!0),(et=(b=this._viewer)==null?void 0:b.scene)==null||et.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})})},this.enabled=e,this.reset=this.reset.bind(this),(0,_e.createStyles)(_e.css`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){var g;if(e!=null&&e.fromHierarchyPlugin||!(e!=null&&e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const i=(g=this._viewer)==null?void 0:g.scene.modelRoot;if(!i)return;const s=i.children.reduce(this._buildData,[]),o=i.children.reduce(this._findVisible,[]);let c=!1;return new Promise((b,et)=>{this.treeView=new E8(this.hierarchyDiv,{closeDepth:1,data:s,loaded:function(){this.values=o,b()},onChange:()=>{c?(0,_e.timeout)(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):c=!0},onItemLabelClick:tt=>{var st;const rt=(st=this._viewer)==null?void 0:st.scene.modelRoot.modelObject.getObjectByProperty("uuid",tt);rt&&i.visible&&rt.dispatchEvent({type:"select",value:rt,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}JI.PluginType="HierarchyUiPlugin";class $I extends hs{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new _g;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}},{type:"button",label:"Add Ambient Light",value:()=>{if(!this._viewer)return;const e=new WA;e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Point Light",value:()=>{if(!this._viewer)return;const e=new Ty;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Spot Light",value:()=>{if(!this._viewer)return;const e=new QA;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,e.lookAt(0,0,0),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[Lr],this._sceneUpdate=e=>{var s,o,c;if(!e.hierarchyChanged)return;const i=[];(s=this._viewer)==null||s.traverseSceneObjects(g=>{if(!g.lightObject)return;const b=g.uiConfig;b&&!i.includes(b)&&i.push(b)}),[...this.uiConfig.children].forEach(g=>{(g==null?void 0:g.type)==="button"||i.includes(g)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(g),1)}),i.forEach(g=>{this.uiConfig.children.includes(g)||this.uiConfig.children.push(g)}),(c=(o=this.uiConfig).uiRefresh)==null||c.call(o,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}$I.PluginType="SimpleLightsUi";class ZI extends hs{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",value:()=>{var s;if(!this._viewer)return;const e=this._viewer.createCamera(new _.cPb(45,1,.5,20));this._viewer.scene.modelRoot.add(e.cameraObject),e.setCameraOptions({controlsMode:"orbit"}),e.position.set(2,2,2),e.target.set(0,0,0),e.positionUpdated(!0),e.cameraObject.lookAt(0,0,0),e.setDirty();const i=this._viewer.getPluginByType("VirtualCamerasPlugin");if(i){const o=i.addCamera(e),c=(s=this._viewer)==null?void 0:s.getPluginByType("debug");c&&c.addTexture("camera frame",()=>o.target.texture,[40,310,300,200])}}}],limitedUi:!0},this.dependencies=[Lr],this._sceneUpdate=e=>{var s,o,c;if(!e.hierarchyChanged)return;const i=[];(s=this._viewer)==null||s.traverseSceneObjects(g=>{if(!g.cameraObject)return;const b=g.uiConfig;b&&!i.includes(b)&&i.push(b)}),[...this.uiConfig.children].forEach(g=>{(g==null?void 0:g.type)==="button"||i.includes(g)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(g),1)}),i.forEach(g=>{this.uiConfig.children.includes(g)||this.uiConfig.children.push(g)}),(c=(o=this.uiConfig).uiRefresh)==null||c.call(o,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}ZI.PluginType="SimpleSceneCamerasUi";var Xw,DM=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let R_=Xw=class extends hs{constructor(){super(),this.enabled=!0,this._serializeVersion=1,this.mode="full",this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(h=!0){if(!this._viewer)return;if(this.mode==="full")return this._viewer.setSize({}),this._setScale(this.scale),void this._refresh();const e={width:Math.floor(this.width),height:Math.floor(this.height)},i=this._viewer.container.getBoundingClientRect(),s={width:Math.floor(i.width),height:Math.floor(i.height)};let o=1;if(e.width>s.width){const c=e.width;e.width=s.width;const g=e.width/c;if(e.height=Math.floor(e.height*g),o/=g,o>Xw.MaxCanvasScale)return this.width=s.width*Xw.MaxCanvasScale,console.log("loop",this.width,s.width,o),void this._sizeChanged()}if(e.height>s.height){const c=e.height;e.height=s.height;const g=e.height/c;if(e.width=Math.floor(e.width*g),o/=g,o>Xw.MaxCanvasScale)return this.height=s.height*Xw.MaxCanvasScale,console.log("loop",this.width,s.width,this.height,s.height,o),void this._sizeChanged()}(e.width>=s.width||e.width<1)&&delete e.width,(e.height>=s.height||e.height<1)&&delete e.height,this._viewer.setSize(e),this._setScale(o),h&&(this.scale=o),this._refresh()}_setScale(h){this._viewer&&(this._viewer.renderer.displayCanvasScaling=h)}_scaleChanged(){if(!this._viewer)return;const h=this.scale;if(Math.abs(h-this._viewer.renderer.displayCanvasScaling)<.01)return;if(this.mode==="full")return void this._sizeChanged();const e=this.width/this.height,i=this._viewer.container.getBoundingClientRect(),s=Math.floor(i.width*h),o=Math.floor(s/e);this.width=s,this.height=o,this._sizeChanged(!1)}async onAdded(h){await super.onAdded(h);const e=h.canvas.clientWidth,i=h.canvas.clientHeight,s=h.renderer.displayCanvasScaling;this.width=e,this.height=i,this.scale=s,h.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",()=>this._sizeChanged(!0)),this._refresh()}async onRemove(h){return h.renderer.removeEventListener("resize",this._refresh),super.onRemove(h)}_refresh(){var h,e;(e=(h=this.uiConfig)==null?void 0:h.uiRefresh)==null||e.call(h,"postFrame",!0)}fromJSON(h,e){if(!h.mode)if(h.width||h.height){const i=this._viewer.container.getBoundingClientRect();h.width||(h.width=i.width),h.height||(h.height=i.height),h.scale&&(h.width*=h.scale,h.height*=h.scale,delete h.scale),h.width=Math.round(h.width),h.height=Math.round(h.height),h.mode="custom"}else h.mode="full";return super.fromJSON(h,e)}toJSON(h){const e=super.toJSON(h);return e.mode==="full"&&(delete e.width,delete e.height),e.mode==="custom"&&delete e.scale,e}};R_.PluginType="RendererParamsUiPlugin",R_.MaxCanvasScale=5,DM([Mn("version")],R_.prototype,"_serializeVersion",void 0),DM([Mn(),em("Mode",["full","custom"].map(h=>({label:h}))),(0,_e.onChange2)(Xw.prototype._sizeChanged)],R_.prototype,"mode",void 0),DM([Mn(),es("Width",void 0,1,h=>({onChange:()=>h._sizeChanged(),hidden:()=>h.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=h._viewer)==null?void 0:e.container.getBoundingClientRect().width)||1024)+2))]}}))],R_.prototype,"width",void 0),DM([Mn(),es("Height",void 0,1,h=>({onChange:()=>h._sizeChanged(),hidden:()=>h.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=h._viewer)==null?void 0:e.container.getBoundingClientRect().height)||1024)+2))]}}))],R_.prototype,"height",void 0),DM([Mn(),(0,_e.onChange)(Xw.prototype._scaleChanged),es("Scale",[.25,Xw.MaxCanvasScale],.001,h=>({disabled:()=>h.mode==="custom"}))],R_.prototype,"scale",void 0),R_=Xw=DM([Ms("Renderer")],R_);class e2 extends hs{async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}toJSON(e){var s;const i=super.toJSON(e);return i.activeCamera=(s=this._viewer)==null?void 0:s.scene.activeCamera.toJSON(),i}fromJSON(e,i){var s;return e.activeCamera&&((s=this._viewer)==null||s.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,i)}_refresh(){var e,i;this._viewer&&((i=(e=this.uiConfig).uiRefresh)==null||i.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)==null?void 0:e.scene.activeCamera.uiConfig)||{}}}e2.PluginType="CameraUiPlugin";var S8={create:h=>{let e="button"+(h.type?" "+h.type:""),i=Zs.createDiv(e,h.text);return i.addEventListener("click",h.onClick),i}};let gv={createElement:(h,e,i,s)=>{let o=document.createElement(h);if(e&&(o.className=e),i&&(o.innerHTML=i),s)for(let c in s)o.setAttribute(c,s[c]);return o},createDiv:(h,e,i)=>gv.createElement("div",h,e,i),createDomTree:h=>{if(!h||!h.hasOwnProperty("dom"))return h;let e=h.dom;if(h.children)for(let i in h.children)h.children[i]&&e.appendChild(gv.createDomTree(h.children[i]));return e},removeElement:h=>{h!=null&&h.parentNode.removeChild(h)},appendToBody:h=>{document.body.appendChild(h)},makeIconHTML:h=>{let e="";return h=="ok"&&(e="#tick"),h=="error"&&(e="#cancel"),h=="info"&&(e="#info-button"),h=="caution"&&(e="#danger"),h=="min"&&(e="#line"),h=="close"&&(e="#close"),`<svg class="icon ${h}"><use xlink:href="${e}" /></svg>`},makeNftContent:h=>{let e=null;if(h.type){let i=null;i=typeof h.content=="string"?gv.createDiv("inner-content",h.content):gv.createDomTree({dom:gv.createDiv("inner-content"),children:[h.content]}),e=h.type=="text"?gv.createDomTree({dom:gv.createDiv("content text"),children:[i]}):gv.createDomTree({dom:gv.createDiv("content"),children:[gv.createDiv("state",gv.makeIconHTML(h.type)),i]})}else typeof h.content=="string"&&(e=gv.createDiv("content",h.content));return e},standardizeButtons:(h,e)=>{let i=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||i.push({key:27,text:"Cancel",onClick:h.close.bind(h,"cancel")}),i.push({key:13,text:"OK",type:"main",onClick:h.close.bind(h,"ok")}),i;i=e.buttons,i.constructor!==Array&&(i=[i]);for(let s in i)!i[s].onClick&&(i[s].onClick=h.close.bind(h,i[s].id));return i},makeButtons:h=>{let e=[];if(h)for(let i in h)e.push(S8.create({text:h[i].text?h[i].text:"OK",type:h[i].normal?null:"main",onClick:h[i].onClick}));return gv.createDomTree({dom:gv.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:h=>{let e=i=>{for(let s in h)if(h[s].key===i.keyCode)return void h[s].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:h=>{window.removeEventListener("keydown",h)}};var Zs=gv,_d=__webpackgi_require__(476),ym={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let dy={};dy.overlay_in=[new _d.Frame(ym["wwise-overlay-in-1"],0),new _d.Frame(ym["wwise-overlay-in-2"],400)],dy.overlay_out=[new _d.Frame(ym["wwise-overlay-out-1"],300)],dy.pop_in=[new _d.Frame(ym["wwise-pop-in-1"],0),new _d.Frame(ym["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new _d.Frame(ym["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new _d.Frame(ym["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],dy.pop_out=[new _d.Frame(ym["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],dy.flip_in=[new _d.Frame(ym["wwise-flip-in-1"],0),new _d.Frame(ym["wwise-flip-in-2"],500)],dy.flip_out=[new _d.Frame(ym["wwise-flip-out-1"],400)],dy.min_in=[new _d.Frame(ym["wwise-min-in-1"],0),new _d.Frame(ym["wwise-min-in-2"],350)],dy.min_out=[new _d.Frame(ym["wwise-min-out-1"],400)];let VF=["top","bottom","left","right"];for(let h in VF){let e=VF[h];dy[e+"_in"]=[new _d.Frame(ym["wwise-"+e+"-in-1"],0),new _d.Frame(ym["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],dy[e+"_out"]=[new _d.Frame(ym["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var MD=dy;let C8={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class TL{static create(e,i){let s=e.getElementsByClassName("title")[0];s&&(s=s.innerHTML);let o=e.getElementsByClassName("content")[0];return o&&(o=o.innerHTML),Zs.removeElement(e),i.title=s,i.content=o,new TL(i)}constructor(e){this.options=JSON.parse(JSON.stringify(C8));for(let et in e)e[et]!=null&&(this.options[et]=e[et]);let i=this.options.position;if(i.indexOf(" ")==-1&&(i=="left"||i=="right"?i+=" center":i=i=="top"||i=="bottom"?"center "+i:i+" "+i),this.options.position=i,this.options.overlay){let et=document.getElementsByClassName("wwise-overlay");et.length?(this.overlay=et[0],this.hasOverlay=!0):(this.overlay=Zs.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let s="content";if(this.options.topbar){let et=[];this.options.topbar.showMin&&(et.push(Zs.createDiv(null,Zs.makeIconHTML("min"))),et[et.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(et.push(Zs.createDiv(null,Zs.makeIconHTML("close"))),et[et.length-1].addEventListener("click",this.close.bind(this,void 0)));let tt=null;tt=typeof this.options.title=="string"?Zs.createDiv("title",this.options.title):Zs.createDomTree({dom:Zs.createDiv("title"),children:[this.options.title]}),this.topbar=Zs.createDomTree({dom:Zs.createDiv("topbar"),children:[{dom:Zs.createDiv("control"),children:et.map(rt=>({dom:rt}))},{dom:tt},{dom:Zs.createDiv("clear")}]})}else s+=" no-topbar";typeof this.options.content=="string"?this.content=Zs.createDomTree({dom:Zs.createDiv(s,this.options.content)}):this.content=Zs.createDomTree({dom:Zs.createDiv(s),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=Zs.createDomTree({dom:Zs.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let o=Zs.createDiv("wwise-wrapper");this.options.zIndex&&(o.style.zIndex=this.options.zIndex),this.wrapper=Zs.createDomTree({dom:o,children:[this.window]}),this.dom=Zs.createDomTree({dom:Zs.createDiv(),children:[this.wrapper]});let c=this.options.position.split(" "),g=-50,b=-50;if(c[0]=="left"?(g=0,this.wrapper.classList.add("left")):c[0]=="right"?(g=-100,this.wrapper.classList.add("right")):c[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=c[0],c[1]=="top"?(b=0,this.wrapper.classList.add("top")):c[1]=="bottom"?(b=-100,this.wrapper.classList.add("bottom")):c[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=i[1],this.window.style.transform=`translate(${g}%, ${b}%)`,this.options.style)for(let et in this.options.style)this.window.style[et]=this.options.style[et];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(s=>{this.promiseResolve=s}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let i=e?"min":this.options.animation;if(i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new _d.Queue(this.wrapper,MD[i+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&s.push(new _d.Queue(this.overlay,MD.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let i=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new _d.Queue(this.wrapper,MD[i+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&s.push(new _d.Queue(this.overlay,MD.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(Zs.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),Zs.appendToBody(this.dom)}removeDoms(){Zs.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(Zs.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let i={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},s=window.getComputedStyle(this.wrapper),o=this.options.draggable,c=parseFloat(s.left),g=parseFloat(s.top);if(s.left.indexOf("%")!=-1){c=s.left,c=c.substr(0,c.length-1),c=parseInt(c);let b=window,et=document,tt=et.documentElement,rt=et.getElementsByTagName("body")[0];c=c*(b.innerWidth||tt.clientWidth||rt.clientWidth)/100}if(s.top.indexOf("%")!=-1){g=s.top,g=g.substr(0,g.length-1),g=parseInt(g);let b=window,et=document,tt=et.documentElement,rt=et.getElementsByTagName("body")[0];g=g*(b.innerHeight||tt.clientHeight||rt.clientHeight)/100}o!=1&&o!="horizontal"||(this.wrapper.style.left=c+i.x+"px"),o!=1&&o!="vertical"||(this.wrapper.style.top=g+i.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let i=e.relatedTarget;i&&i.nodeName!="HTML"||(this.inDragging=!1)}}var M8=TL,IL=class{constructor(h){let e=this.options=h;!e.type&&(e.type="ok");let i={topbar:!1};i.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),i.overlay=!0,i.keepOverlay=e.keepOverlay,i.clickOverlayToClose=!1,i.animation=e.animation,i.zIndex=e.zIndex,this.wwise=new M8(i)}constructContent(h){let e=Zs.createDiv("modal"),i=Zs.createDomTree({dom:Zs.createDiv("main "+h.type),children:[Zs.createDiv(null,Zs.makeIconHTML(h.type)),Zs.createDiv("title",h.title),Zs.createDiv("text",h.text)]});this.buttonArr=Zs.standardizeButtons(this,h);let s=Zs.makeButtons(this.buttonArr),o=null;h.content&&(o=typeof h.content=="string"?Zs.createDiv(null,h.content):h.content);let c=null;return s.innerHTML&&(c=Zs.createDomTree({dom:Zs.createDiv("operation "+h.type),children:[s]})),o||c||i.classList.add("no-op"),Zs.createDomTree({dom:e,children:[i,o,c]})}open(){if(this.wwise.opened)return;let h=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=Zs.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),h}close(h){if(this.wwise.opened)return this.value=h,Zs.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let T8={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},I8={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var TD=__webpackgi_require__(513),t2={};TD.Z&&TD.Z.locals&&(t2.locals=TD.Z.locals);var PL,RL=0,AS={};AS.styleTagTransform=p1(),AS.setAttributes=h1(),AS.insert=function(h,e){(e.target||document.head).appendChild(h)},AS.domAPI=u1(),AS.insertStyleElement=d1(),t2.use=function(h){return AS.options=h||{},RL++||(PL=c1()(TD.Z,AS)),t2},t2.unuse=function(){RL>0&&!--RL&&(PL(),PL=null)};var P8=t2;class DL extends hs{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},Zs.appendToBody=i=>{e.container.appendChild(i)},Zs.makeIconHTML=i=>"",P8.use({target:e.container}),e.alert=async i=>{const s=i==null?void 0:i.split(":")[0],o=new IL({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s+":",""))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return o.open(),o.getPromise()},e.confirm=async i=>{const s=i==null?void 0:i.split(":")[0],o=new IL({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return o.open(),await o.getPromise()==="yes"},e.prompt=async(i,s,o=!0)=>{const c=i==null?void 0:i.split(":")[0],g=new class{constructor(b){this.options=JSON.parse(JSON.stringify(T8));for(let st in b)b[st]!=null&&(this.options[st]=b[st]);let et=this.options,tt=JSON.parse(JSON.stringify(I8));for(let st in tt)et.hasOwnProperty(st)&&(tt[st]=et[st]);let rt=[];et.showCancel&&rt.push({key:27,text:et.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),rt.push({key:13,text:et.okText,onClick:this.handleOk.bind(this)}),tt.buttons=rt,this.input=Zs.createElement("input","input",null,{placeholder:et.placeholder}),this.error=Zs.createDiv("error"),tt.content=Zs.createDomTree({dom:Zs.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new IL(tt)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},b=>{this.error.innerText=b}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let b=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((et,tt)=>{this.promiseResolve=et,this.promiseReject=tt}),b}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:c??"&ndsp;",placeholder:s??"",showCancel:o,animation:"overlay",text:(i==null?void 0:i.replace(c||"","").replace(":",""))||""});return g.open(),await g.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}DL.PluginType="WindowiseDialogPlugin";var ID=__webpackgi_require__(729),n2={};ID.Z&&ID.Z.locals&&(n2.locals=ID.Z.locals);var kL,BL=0,bS={};bS.styleTagTransform=p1(),bS.setAttributes=h1(),bS.insert=function(h,e){(e.target||document.head).appendChild(h)},bS.domAPI=u1(),bS.insertStyleElement=d1(),n2.use=function(h){return bS.options=h||{},BL++||(kL=c1()(ID.Z,bS)),n2},n2.unuse=function(){BL>0&&!--BL&&(kL(),kL=null)};var R8=n2,PD=__webpackgi_require__(109),i2={};PD.Z&&PD.Z.locals&&(i2.locals=PD.Z.locals);var OL,LL=0,wS={};wS.styleTagTransform=p1(),wS.setAttributes=h1(),wS.insert=function(h,e){(e.target||document.head).appendChild(h)},wS.domAPI=u1(),wS.insertStyleElement=d1(),i2.use=function(h){return wS.options=h||{},LL++||(OL=c1()(PD.Z,wS)),i2},i2.unuse=function(){LL>0&&!--LL&&(OL(),OL=null)};var D8=i2;function GF(){R8.use(),D8.use()}async function HF(h,e=void 0,i=[]){var pt,gt;l1.setDefaultProps({theme:"editor",duration:300,arrow:!0,appendTo:()=>h.container});const s=(0,_e.createDiv)({classList:["mode-buttons-container","button-bar"],addToBody:!0}),o=(0,_e.createDiv)({innerHTML:"",id:"webgi-logo",addToBody:!1});(0,_e.getUrlQueryParam)("logo-img")&&(o.style.backgroundImage=`url(${(0,_e.getUrlQueryParam)("logo-img")})`),o.onclick=()=>{window.open((0,_e.getUrlQueryParam)("logo-link")||"https://webgi.xyz","_blank")};const c=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
</svg>`;h.container.appendChild(o),l1(o,{placement:"right",content:"Powered by WebGi SDK"});const g=(0,_e.createDiv)({innerHTML:c,id:"fsToggle",classList:["round-button"],addToBody:!1});g.dataset.tippyContent="Full-Screen",(pt=h.getPlugin(dm))==null||pt.addEventListener("enter",()=>{g.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path d="M9 19L9 15M9 15L5 15M9 15L4 20M15 15L20 20M15 15V19M15 15H19M15 5V9M15 9L19 9M15 9L20 4M9 5L9 9M9 9L5 9M9 9L4 4" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,g.dataset.tippyContent="Exit Full-Screen"}),(gt=h.getPlugin(dm))==null||gt.addEventListener("exit",()=>{g.innerHTML=c,g.dataset.tippyContent="Full-Screen"}),g.onclick=()=>{var At;(At=h.getPlugin(dm))==null||At.toggle(h.container)},h.container.appendChild(g),l1(g,{placement:"left"});const b=(0,_e.createDiv)({classList:["button-bar","util-buttons-container"],addToBody:!1});h.container.appendChild(b);const et=[{id:"reset-settings",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Reset All Settings",onclick:async()=>{var xt;if(!await h.confirm("Reset settings: Are you sure you want to reset all plugin settings?"))return;const At=at.map(yt=>h.getPlugin(yt));for(const yt of At)await((xt=yt==null?void 0:yt.resetDefaults)==null?void 0:xt.call(yt))}},{id:"clear-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
 <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
</svg>`,tooltip:"Clear Scene",onclick:async()=>{await h.confirm("Clear scene: Are you sure you want to clear the scene?")&&h.scene.disposeSceneModels()}},{id:"fit-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
    <path fill="currentColor" d="M17 12C17 7.55 11.62 5.31 8.46 8.46C5.31 11.61 7.55 17 12 17C14.76 17 17 14.76 17 12M12 15C9.33 15 8 11.77 9.88 9.88C11.77 8 15 9.33 15 12C15 13.66 13.66 15 12 15M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19" />
</svg>`,tooltip:"Fit Object/Scene",onclick:async()=>{var At;await h.fitToView((At=h.getPlugin(vo))==null?void 0:At.getSelectedObject())}},{id:"loop-cam-views",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Loop Camera Views",toggle:!0,onclick:async()=>{h.getPlugin(qo)&&(h.getPlugin(qo).viewLooping=!h.getPlugin(qo).viewLooping)}},{id:"play-gltf",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>`,tooltip:"GLTF Animations",toggle:!0,onclick:async()=>{var At;(At=h.getPlugin($o))==null||At.playPauseAnimation()}},{id:"auto-rotate-cc",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M10,12L14,16L10,20V16.9C5.44,16.44 2,14.42 2,12C2,9.58 5.44,7.56 10,7.1V9.09C6.55,9.43 4,10.6 4,12C4,13.4 6.55,14.57 10,14.91V12M20,12C20,10.6 17.45,9.43 14,9.09V7.1C18.56,7.56 22,9.58 22,12C22,14.16 19.26,16 15.42,16.7L16.12,16L14.92,14.79C17.89,14.36 20,13.27 20,12M11,2H13V13L11,11V2M11,22V21L13,19V22H11Z" />
</svg>`,tooltip:"Auto rotate",toggle:!0,onclick:async()=>{const At=h.scene.activeCamera.controls;At&&At.autoRotate!==void 0&&(At.autoRotate=!At.autoRotate)}},{id:"snapshot",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
</svg>`,tooltip:"Capture Snapshot",onclick:async()=>{const At=h.getPlugin(Uv);At?await At.downloadSnapshot():h.console.error("CanvasSnipperPlugin not added")}},{id:"glb-export",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
</svg>`,tooltip:"Export GLB",onclick:async()=>{const At=h.getPlugin(m1);At?await(At==null?void 0:At.downloadSceneGlb()):h.console.error("AssetExporterPlugin not added")}}];for(const At of et){const xt=(0,_e.createDiv)({innerHTML:At.icon,id:At.id,classList:["button-bar-button","util-button"],addToBody:!1});xt.dataset.tippyContent=At.tooltip,xt.onclick=()=>{At.toggle&&xt.classList.toggle("button-bar-selected-box"),At.onclick()},b.appendChild(xt)}v4(l1(".util-button"),{moveTransition:"transform 0.2s ease-out",placement:"top"});const tt=h.getPlugin(vo);for(const[At,xt]of Object.entries(e??{})){const yt=i.find(_t=>_t.title===At);yt?yt.plugins.push(...xt):i.push({title:At,plugins:[...xt]})}let rt=i[2],st=[];const at=i.reduce((At,xt)=>At.concat(xt.plugins),[]);function ct(At){var xt;rt=At,tt&&(tt.enabled=!0),st=[];for(const yt of at){const _t=h.getPlugin(yt);if(!(_t!=null&&_t.uiConfig))continue;const Mt=At.plugins.includes(yt);(0,_e.safeSetProperty)(_t.uiConfig,"hidden",!Mt,!0),Mt&&st.push(_t)}for(const yt of i)(xt=yt.div)==null||xt.classList[rt!==yt?"remove":"add"]("mode-button-selected","button-bar-selected");h.getPlugin(CD).refreshPluginsEnabled()}for(const At of i){const xt=(0,_e.createDiv)({innerHTML:At.title,classList:["mode-button","button-bar-button"]});xt.onclick=()=>{ct(At)},At.div=xt,s.appendChild(xt)}ct(i[0]),tt==null||tt.addEventListener("selectedObjectChanged",()=>{tt!=null&&tt.getSelectedObject()&&!["Picking","Modifiers","Configurators"].includes(rt.title)&&ct(i.find(At=>At.plugins.includes(vo)))})}class NL extends hs{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>({label:"Shadow type",type:"dropdown",children:[["Basic",_._MY],["PCF",_._iA],["PCFSoft",Cl],["VSM",$a]].map(e=>({label:e[0],value:e[1]})),getValue:()=>{var e;return(e=this._viewer)==null?void 0:e.renderer.rendererObject.shadowMap.type},setValue:e=>{var i;(i=this._viewer)==null||i.doOnce("postFrame",()=>{this._viewer&&(this._viewer.renderer.rendererObject.shadowMap.type=e,this._viewer.renderer.resetShadows(),this._viewer.renderer.reset(),this._viewer.scene.setDirty({sceneUpdate:!0,frameFade:!1}),this._viewer.setDirty())})}}),()=>{var e;return{label:((e=this._viewer)!=null&&e.useRgbm?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{var i,s;await((i=this._viewer)==null?void 0:i.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,_e.setUrlQueryParam)("rgbm",(s=this._viewer)!=null&&s.useRgbm?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.isAntialiased?"Disable":"Enable")+" MSAA",type:"button",value:async()=>{var i,s;await((i=this._viewer)==null?void 0:i.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,_e.setUrlQueryParam)("msaa",(s=this._viewer)!=null&&s.isAntialiased?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.useGBufferDepth?"Disable":"Enable")+" Depth(z) Prepass",type:"button",value:async()=>{var i,s;await((i=this._viewer)==null?void 0:i.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,_e.setUrlQueryParam)("depthPrepass",(s=this._viewer)!=null&&s.useGBufferDepth?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.getPluginByType("debug")?"Disable":"Enable")+" Debug",type:"button",value:async()=>{var i,s;await((i=this._viewer)==null?void 0:i.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,_e.setUrlQueryParam)("debug",(s=this._viewer)!=null&&s.getPluginByType("debug")?null:"true",!0)}}},{label:"Clear local storage",type:"button",value:async()=>{var e;await((e=this._viewer)==null?void 0:e.confirm("Edit Extras: This will clear all local storage. Are you sure?"))&&localStorage.clear()}},{label:"Clear caches",type:"button",value:async()=>{var i,s;const e=(s=(i=this._viewer)==null?void 0:i.getPlugin(Lr))==null?void 0:s.storage;if(e instanceof Storage)e.clear();else if(e instanceof Cache){const o=await e.keys();await Promise.all(o.map(async c=>e.delete(c)))}localStorage.clear()}},{label:"Auto GPU instance all",type:"button",value:()=>{var i;const e=new Set;(i=this._viewer)==null||i.scene.modelRoot.traverse(s=>s.geometry&&e.add(s.geometry)),e.forEach(s=>p0(s))}},{label:"Auto Center All Geometries",type:"button",value:()=>{var i;const e=new Set;(i=this._viewer)==null||i.scene.modelRoot.traverse(s=>s.geometry&&e.add(s.geometry)),e.forEach(s=>{const o=new _.Pa4;s.center(o),s.userData.__appliedMeshes.forEach(c=>{c.position.sub(o),c.setDirty&&c.setDirty()})})}}]}}}NL.PluginType="ExtrasUiPlugin1";class UL extends _.Tme{constructor(e){super(),this.modelObject=this,this.assetType="widget",this.visible=!0,this.uiConfig=tm("Widget",this),this.object=e,this.object.updateMatrixWorld(),this.object.updateProjectionMatrix&&this.object.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this._objectUpdate=this._objectUpdate.bind(this),this.attach(e),this.traverse(i=>{i.userData.__keepShadowDef=!0,i.castShadow=!1,i.receiveShadow=!1})}dispose(){this.detach()}_objectUpdate(){this.object&&this.update()}attach(e){var i,s;return this.object&&this.detach(),this.object=e,this.object&&(this.update(),this.object.addEventListener("objectUpdate",this._objectUpdate),this.object.addEventListener("dispose",this.dispose),this.uiConfig&&((s=(i=this.object.uiConfig)==null?void 0:i.children)==null||s.push(this.uiConfig)),this.visible=!0),this}detach(){var e,i,s,o;if(this.object){if(this.object.removeEventListener("objectUpdate",this._objectUpdate),this.object.removeEventListener("dispose",this.dispose),this.uiConfig){const c=(i=(e=this.object.uiConfig)==null?void 0:e.children)==null?void 0:i.indexOf(this.uiConfig);c!==void 0&&c>=0&&((o=(s=this.object.uiConfig)==null?void 0:s.children)==null||o.splice(c,1))}this.object=void 0,this.visible=!1}return this}}(function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);c>3&&g&&Object.defineProperty(e,i,g)})([Nr()],UL.prototype,"visible",void 0);class FL extends UL{constructor(e){super(e),this.light=e,this.traverse(i=>{i.userData.__keepShadowDef=!0,i.castShadow=!1,i.receiveShadow=!1})}}var jL=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class Yw extends FL{constructor(e,i,s){super(e),this.lineWidth=5,this.size=.5,this._v1=new _.Pa4,this._v2=new _.Pa4,this._v3=new _.Pa4,this.color=s,i!==void 0&&(this.size=i);let o=new oI;this.material=new Ov({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightPlane=new iO(o,this.material),this.add(this.lightPlane),o=new oI,o.setPositions([0,0,0,0,0,1]),this.targetLine=new iO(o,this.material),this.add(this.targetLine),this.update(),this.traverse(c=>{c.userData.__keepShadowDef=!0,c.castShadow=!1,c.receiveShadow=!1})}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose(),super.dispose()}update(){this.light&&this.lightPlane&&(this._v1.setFromMatrixPosition(this.light.matrixWorld),this._v2.setFromMatrixPosition(this.light.target.matrixWorld),this._v3.subVectors(this._v2,this._v1),this.lightPlane.geometry.setPositions([-this.size,this.size,0,this.size,this.size,0,this.size,-this.size,0,-this.size,-this.size,0,-this.size,this.size,0]),this.lightPlane.lookAt(this._v2),this.lightPlane.material=this.material,this.targetLine.material=this.material,this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth,this.targetLine.lookAt(this._v2),this.targetLine.scale.z=this.light.intensity/3)}static Check(e){return e.isDirectionalLight}static Create(e){return new Yw(e)}}jL([(0,_e.onChange)(Yw.prototype.update)],Yw.prototype,"material",void 0),jL([(0,_e.onChange)(Yw.prototype.update),es(void 0,[.1,20],.01)],Yw.prototype,"lineWidth",void 0),jL([(0,_e.onChange)(Yw.prototype.update),es(void 0,[.01,10],.01)],Yw.prototype,"size",void 0);var zL=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class Kw extends FL{constructor(e,i,s){super(e),this.lineWidth=5,this.size=.5,this.color=s,i!==void 0&&(this.size=i);const o=new $M(new _.xo$(.5,4,2));this.material=new Ov({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightSphere=new KS(o,this.material),this.lightSphere.computeLineDistances(),this.add(this.lightSphere),this.update(),this.traverse(c=>{c.userData.__keepShadowDef=!0,c.castShadow=!1,c.receiveShadow=!1})}dispose(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose(),super.dispose()}update(){this.light&&this.lightSphere&&(this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth,this.lightSphere.scale.setScalar(this.size))}static Check(e){return e.isPointLight}static Create(e){return new Kw(e)}}zL([(0,_e.onChange)(Kw.prototype.update)],Kw.prototype,"material",void 0),zL([(0,_e.onChange)(Kw.prototype.update),es(void 0,[.1,20],.01)],Kw.prototype,"lineWidth",void 0),zL([(0,_e.onChange)(Kw.prototype.update),es(void 0,[.01,10],.01)],Kw.prototype,"size",void 0);var QF=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};class xS extends FL{constructor(e,i,s){super(e),this.lineWidth=5,this._v1=new _.Pa4,this.color=s;let o=new zy;const c=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let g=0,b=1,et=32;g<et;g++,b++){const tt=g/et*Math.PI*2,rt=b/et*Math.PI*2;c.push(Math.cos(tt),Math.sin(tt),1,Math.cos(rt),Math.sin(rt),1)}o.setPositions(c),this.material=new Ov({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.cone=new HP(o,this.material),this.add(this.cone),o=new oI,o.setPositions([0,0,0,0,0,1]),this.update(),this.traverse(g=>{g.userData.__keepShadowDef=!0,g.castShadow=!1,g.receiveShadow=!1})}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose(),super.dispose()}update(){if(!this.light||!this.cone)return;this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,i=e*Math.tan(this.light.angle);this.cone.scale.set(i,i,e),this._v1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(this._v1),this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth}static Check(e){return e.isSpotLight}static Create(e){return new xS(e)}}QF([(0,_e.onChange)(xS.prototype.update)],xS.prototype,"material",void 0),QF([(0,_e.onChange)(xS.prototype.update),es(void 0,[.1,20],.01)],xS.prototype,"lineWidth",void 0);class r2{constructor(e=0,i=0,s=0,o=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=s,this._w=o}static slerpFlat(e,i,s,o,c,g,b){let et=s[o+0],tt=s[o+1],rt=s[o+2],st=s[o+3];const at=c[g+0],ct=c[g+1],pt=c[g+2],gt=c[g+3];if(b===0)return e[i+0]=et,e[i+1]=tt,e[i+2]=rt,void(e[i+3]=st);if(b===1)return e[i+0]=at,e[i+1]=ct,e[i+2]=pt,void(e[i+3]=gt);if(st!==gt||et!==at||tt!==ct||rt!==pt){let At=1-b;const xt=et*at+tt*ct+rt*pt+st*gt,yt=xt>=0?1:-1,_t=1-xt*xt;if(_t>Number.EPSILON){const It=Math.sqrt(_t),Bt=Math.atan2(It,xt*yt);At=Math.sin(At*Bt)/It,b=Math.sin(b*Bt)/It}const Mt=b*yt;if(et=et*At+at*Mt,tt=tt*At+ct*Mt,rt=rt*At+pt*Mt,st=st*At+gt*Mt,At===1-b){const It=1/Math.sqrt(et*et+tt*tt+rt*rt+st*st);et*=It,tt*=It,rt*=It,st*=It}}e[i]=et,e[i+1]=tt,e[i+2]=rt,e[i+3]=st}static multiplyQuaternionsFlat(e,i,s,o,c,g){const b=s[o],et=s[o+1],tt=s[o+2],rt=s[o+3],st=c[g],at=c[g+1],ct=c[g+2],pt=c[g+3];return e[i]=b*pt+rt*st+et*ct-tt*at,e[i+1]=et*pt+rt*at+tt*st-b*ct,e[i+2]=tt*pt+rt*ct+b*at-et*st,e[i+3]=rt*pt-b*st-et*at-tt*ct,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,s,o){return this._x=e,this._y=i,this._z=s,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i){const s=e._x,o=e._y,c=e._z,g=e._order,b=Math.cos,et=Math.sin,tt=b(s/2),rt=b(o/2),st=b(c/2),at=et(s/2),ct=et(o/2),pt=et(c/2);switch(g){case"XYZ":this._x=at*rt*st+tt*ct*pt,this._y=tt*ct*st-at*rt*pt,this._z=tt*rt*pt+at*ct*st,this._w=tt*rt*st-at*ct*pt;break;case"YXZ":this._x=at*rt*st+tt*ct*pt,this._y=tt*ct*st-at*rt*pt,this._z=tt*rt*pt-at*ct*st,this._w=tt*rt*st+at*ct*pt;break;case"ZXY":this._x=at*rt*st-tt*ct*pt,this._y=tt*ct*st+at*rt*pt,this._z=tt*rt*pt+at*ct*st,this._w=tt*rt*st-at*ct*pt;break;case"ZYX":this._x=at*rt*st-tt*ct*pt,this._y=tt*ct*st+at*rt*pt,this._z=tt*rt*pt-at*ct*st,this._w=tt*rt*st+at*ct*pt;break;case"YZX":this._x=at*rt*st+tt*ct*pt,this._y=tt*ct*st+at*rt*pt,this._z=tt*rt*pt-at*ct*st,this._w=tt*rt*st-at*ct*pt;break;case"XZY":this._x=at*rt*st-tt*ct*pt,this._y=tt*ct*st-at*rt*pt,this._z=tt*rt*pt+at*ct*st,this._w=tt*rt*st+at*ct*pt;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+g)}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const s=i/2,o=Math.sin(s);return this._x=e.x*o,this._y=e.y*o,this._z=e.z*o,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,s=i[0],o=i[4],c=i[8],g=i[1],b=i[5],et=i[9],tt=i[2],rt=i[6],st=i[10],at=s+b+st;if(at>0){const ct=.5/Math.sqrt(at+1);this._w=.25/ct,this._x=(rt-et)*ct,this._y=(c-tt)*ct,this._z=(g-o)*ct}else if(s>b&&s>st){const ct=2*Math.sqrt(1+s-b-st);this._w=(rt-et)/ct,this._x=.25*ct,this._y=(o+g)/ct,this._z=(c+tt)/ct}else if(b>st){const ct=2*Math.sqrt(1+b-s-st);this._w=(c-tt)/ct,this._x=(o+g)/ct,this._y=.25*ct,this._z=(et+rt)/ct}else{const ct=2*Math.sqrt(1+st-s-b);this._w=(g-o)/ct,this._x=(c+tt)/ct,this._y=(et+rt)/ct,this._z=.25*ct}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let s=e.dot(i)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(nn(this.dot(e),-1,1)))}rotateTowards(e,i){const s=this.angleTo(e);if(s===0)return this;const o=Math.min(1,i/s);return this.slerp(e,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const s=e._x,o=e._y,c=e._z,g=e._w,b=i._x,et=i._y,tt=i._z,rt=i._w;return this._x=s*rt+g*b+o*tt-c*et,this._y=o*rt+g*et+c*b-s*tt,this._z=c*rt+g*tt+s*et-o*b,this._w=g*rt-s*b-o*et-c*tt,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const s=this._x,o=this._y,c=this._z,g=this._w;let b=g*e._w+s*e._x+o*e._y+c*e._z;if(b<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,b=-b):this.copy(e),b>=1)return this._w=g,this._x=s,this._y=o,this._z=c,this;const et=1-b*b;if(et<=Number.EPSILON){const ct=1-i;return this._w=ct*g+i*this._w,this._x=ct*s+i*this._x,this._y=ct*o+i*this._y,this._z=ct*c+i*this._z,this.normalize(),this._onChangeCallback(),this}const tt=Math.sqrt(et),rt=Math.atan2(tt,b),st=Math.sin((1-i)*rt)/tt,at=Math.sin(i*rt)/tt;return this._w=g*st+this._w*at,this._x=s*st+this._x*at,this._y=o*st+this._y*at,this._z=c*st+this._z*at,this._onChangeCallback(),this}slerpQuaternions(e,i,s){return this.copy(e).slerp(i,s)}random(){const e=Math.random(),i=Math.sqrt(1-e),s=Math.sqrt(e),o=2*Math.PI*Math.random(),c=2*Math.PI*Math.random();return this.set(i*Math.cos(o),s*Math.sin(c),s*Math.cos(c),i*Math.sin(o))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class _p{constructor(e=0,i=0,s=0){_p.prototype.isVector3=!0,this.x=e,this.y=i,this.z=s}set(e,i,s){return s===void 0&&(s=this.z),this.x=e,this.y=i,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(WF.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(WF.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,s=this.y,o=this.z,c=e.elements;return this.x=c[0]*i+c[3]*s+c[6]*o,this.y=c[1]*i+c[4]*s+c[7]*o,this.z=c[2]*i+c[5]*s+c[8]*o,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,s=this.y,o=this.z,c=e.elements,g=1/(c[3]*i+c[7]*s+c[11]*o+c[15]);return this.x=(c[0]*i+c[4]*s+c[8]*o+c[12])*g,this.y=(c[1]*i+c[5]*s+c[9]*o+c[13])*g,this.z=(c[2]*i+c[6]*s+c[10]*o+c[14])*g,this}applyQuaternion(e){const i=this.x,s=this.y,o=this.z,c=e.x,g=e.y,b=e.z,et=e.w,tt=et*i+g*o-b*s,rt=et*s+b*i-c*o,st=et*o+c*s-g*i,at=-c*i-g*s-b*o;return this.x=tt*et+at*-c+rt*-b-st*-g,this.y=rt*et+at*-g+st*-c-tt*-b,this.z=st*et+at*-b+tt*-g-rt*-c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,s=this.y,o=this.z,c=e.elements;return this.x=c[0]*i+c[4]*s+c[8]*o,this.y=c[1]*i+c[5]*s+c[9]*o,this.z=c[2]*i+c[6]*s+c[10]*o,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this.z=e.z+(i.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const s=e.x,o=e.y,c=e.z,g=i.x,b=i.y,et=i.z;return this.x=o*et-c*b,this.y=c*g-s*et,this.z=s*b-o*g,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const s=e.dot(this)/i;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return VL.copy(this).projectOnVector(e),this.sub(VL)}reflect(e){return this.sub(VL.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(nn(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y,o=this.z-e.z;return i*i+s*s+o*o}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,s){const o=Math.sin(i)*e;return this.x=o*Math.sin(s),this.y=Math.cos(i)*e,this.z=o*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,s){return this.x=e*Math.sin(i),this.y=s,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),o=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=s,this.z=o,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,4*i)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,3*i)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),i=Math.random()*Math.PI*2,s=Math.sqrt(1-e**2);return this.x=s*Math.cos(i),this.y=s*Math.sin(i),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const VL=new _p,WF=new r2;class h0{constructor(){h0.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,i,s,o,c,g,b,et,tt,rt,st,at,ct,pt,gt,At){const xt=this.elements;return xt[0]=e,xt[4]=i,xt[8]=s,xt[12]=o,xt[1]=c,xt[5]=g,xt[9]=b,xt[13]=et,xt[2]=tt,xt[6]=rt,xt[10]=st,xt[14]=at,xt[3]=ct,xt[7]=pt,xt[11]=gt,xt[15]=At,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new h0().fromArray(this.elements)}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],this}copyPosition(e){const i=this.elements,s=e.elements;return i[12]=s[12],i[13]=s[13],i[14]=s[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,s){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,i,s){return this.set(e.x,i.x,s.x,0,e.y,i.y,s.y,0,e.z,i.z,s.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,s=e.elements,o=1/kM.setFromMatrixColumn(e,0).length(),c=1/kM.setFromMatrixColumn(e,1).length(),g=1/kM.setFromMatrixColumn(e,2).length();return i[0]=s[0]*o,i[1]=s[1]*o,i[2]=s[2]*o,i[3]=0,i[4]=s[4]*c,i[5]=s[5]*c,i[6]=s[6]*c,i[7]=0,i[8]=s[8]*g,i[9]=s[9]*g,i[10]=s[10]*g,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,s=e.x,o=e.y,c=e.z,g=Math.cos(s),b=Math.sin(s),et=Math.cos(o),tt=Math.sin(o),rt=Math.cos(c),st=Math.sin(c);if(e.order==="XYZ"){const at=g*rt,ct=g*st,pt=b*rt,gt=b*st;i[0]=et*rt,i[4]=-et*st,i[8]=tt,i[1]=ct+pt*tt,i[5]=at-gt*tt,i[9]=-b*et,i[2]=gt-at*tt,i[6]=pt+ct*tt,i[10]=g*et}else if(e.order==="YXZ"){const at=et*rt,ct=et*st,pt=tt*rt,gt=tt*st;i[0]=at+gt*b,i[4]=pt*b-ct,i[8]=g*tt,i[1]=g*st,i[5]=g*rt,i[9]=-b,i[2]=ct*b-pt,i[6]=gt+at*b,i[10]=g*et}else if(e.order==="ZXY"){const at=et*rt,ct=et*st,pt=tt*rt,gt=tt*st;i[0]=at-gt*b,i[4]=-g*st,i[8]=pt+ct*b,i[1]=ct+pt*b,i[5]=g*rt,i[9]=gt-at*b,i[2]=-g*tt,i[6]=b,i[10]=g*et}else if(e.order==="ZYX"){const at=g*rt,ct=g*st,pt=b*rt,gt=b*st;i[0]=et*rt,i[4]=pt*tt-ct,i[8]=at*tt+gt,i[1]=et*st,i[5]=gt*tt+at,i[9]=ct*tt-pt,i[2]=-tt,i[6]=b*et,i[10]=g*et}else if(e.order==="YZX"){const at=g*et,ct=g*tt,pt=b*et,gt=b*tt;i[0]=et*rt,i[4]=gt-at*st,i[8]=pt*st+ct,i[1]=st,i[5]=g*rt,i[9]=-b*rt,i[2]=-tt*rt,i[6]=ct*st+pt,i[10]=at-gt*st}else if(e.order==="XZY"){const at=g*et,ct=g*tt,pt=b*et,gt=b*tt;i[0]=et*rt,i[4]=-st,i[8]=tt*rt,i[1]=at*st+gt,i[5]=g*rt,i[9]=ct*st-pt,i[2]=pt*st-ct,i[6]=b*rt,i[10]=gt*st+at}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(k8,e,B8)}lookAt(e,i,s){const o=this.elements;return D_.subVectors(e,i),D_.lengthSq()===0&&(D_.z=1),D_.normalize(),T1.crossVectors(s,D_),T1.lengthSq()===0&&(Math.abs(s.z)===1?D_.x+=1e-4:D_.z+=1e-4,D_.normalize(),T1.crossVectors(s,D_)),T1.normalize(),RD.crossVectors(D_,T1),o[0]=T1.x,o[4]=RD.x,o[8]=D_.x,o[1]=T1.y,o[5]=RD.y,o[9]=D_.y,o[2]=T1.z,o[6]=RD.z,o[10]=D_.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,o=i.elements,c=this.elements,g=s[0],b=s[4],et=s[8],tt=s[12],rt=s[1],st=s[5],at=s[9],ct=s[13],pt=s[2],gt=s[6],At=s[10],xt=s[14],yt=s[3],_t=s[7],Mt=s[11],It=s[15],Bt=o[0],Lt=o[4],Ht=o[8],Jt=o[12],sn=o[1],on=o[5],mn=o[9],cn=o[13],un=o[2],bn=o[6],xn=o[10],Cn=o[14],Jn=o[3],Kn=o[7],gr=o[11],nr=o[15];return c[0]=g*Bt+b*sn+et*un+tt*Jn,c[4]=g*Lt+b*on+et*bn+tt*Kn,c[8]=g*Ht+b*mn+et*xn+tt*gr,c[12]=g*Jt+b*cn+et*Cn+tt*nr,c[1]=rt*Bt+st*sn+at*un+ct*Jn,c[5]=rt*Lt+st*on+at*bn+ct*Kn,c[9]=rt*Ht+st*mn+at*xn+ct*gr,c[13]=rt*Jt+st*cn+at*Cn+ct*nr,c[2]=pt*Bt+gt*sn+At*un+xt*Jn,c[6]=pt*Lt+gt*on+At*bn+xt*Kn,c[10]=pt*Ht+gt*mn+At*xn+xt*gr,c[14]=pt*Jt+gt*cn+At*Cn+xt*nr,c[3]=yt*Bt+_t*sn+Mt*un+It*Jn,c[7]=yt*Lt+_t*on+Mt*bn+It*Kn,c[11]=yt*Ht+_t*mn+Mt*xn+It*gr,c[15]=yt*Jt+_t*cn+Mt*Cn+It*nr,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[4],o=e[8],c=e[12],g=e[1],b=e[5],et=e[9],tt=e[13],rt=e[2],st=e[6],at=e[10],ct=e[14];return e[3]*(+c*et*st-o*tt*st-c*b*at+s*tt*at+o*b*ct-s*et*ct)+e[7]*(+i*et*ct-i*tt*at+c*g*at-o*g*ct+o*tt*rt-c*et*rt)+e[11]*(+i*tt*st-i*b*ct-c*g*st+s*g*ct+c*b*rt-s*tt*rt)+e[15]*(-o*b*rt-i*et*st+i*b*at+o*g*st-s*g*at+s*et*rt)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,s){const o=this.elements;return e.isVector3?(o[12]=e.x,o[13]=e.y,o[14]=e.z):(o[12]=e,o[13]=i,o[14]=s),this}invert(){const e=this.elements,i=e[0],s=e[1],o=e[2],c=e[3],g=e[4],b=e[5],et=e[6],tt=e[7],rt=e[8],st=e[9],at=e[10],ct=e[11],pt=e[12],gt=e[13],At=e[14],xt=e[15],yt=st*At*tt-gt*at*tt+gt*et*ct-b*At*ct-st*et*xt+b*at*xt,_t=pt*at*tt-rt*At*tt-pt*et*ct+g*At*ct+rt*et*xt-g*at*xt,Mt=rt*gt*tt-pt*st*tt+pt*b*ct-g*gt*ct-rt*b*xt+g*st*xt,It=pt*st*et-rt*gt*et-pt*b*at+g*gt*at+rt*b*At-g*st*At,Bt=i*yt+s*_t+o*Mt+c*It;if(Bt===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Lt=1/Bt;return e[0]=yt*Lt,e[1]=(gt*at*c-st*At*c-gt*o*ct+s*At*ct+st*o*xt-s*at*xt)*Lt,e[2]=(b*At*c-gt*et*c+gt*o*tt-s*At*tt-b*o*xt+s*et*xt)*Lt,e[3]=(st*et*c-b*at*c-st*o*tt+s*at*tt+b*o*ct-s*et*ct)*Lt,e[4]=_t*Lt,e[5]=(rt*At*c-pt*at*c+pt*o*ct-i*At*ct-rt*o*xt+i*at*xt)*Lt,e[6]=(pt*et*c-g*At*c-pt*o*tt+i*At*tt+g*o*xt-i*et*xt)*Lt,e[7]=(g*at*c-rt*et*c+rt*o*tt-i*at*tt-g*o*ct+i*et*ct)*Lt,e[8]=Mt*Lt,e[9]=(pt*st*c-rt*gt*c-pt*s*ct+i*gt*ct+rt*s*xt-i*st*xt)*Lt,e[10]=(g*gt*c-pt*b*c+pt*s*tt-i*gt*tt-g*s*xt+i*b*xt)*Lt,e[11]=(rt*b*c-g*st*c-rt*s*tt+i*st*tt+g*s*ct-i*b*ct)*Lt,e[12]=It*Lt,e[13]=(rt*gt*o-pt*st*o+pt*s*at-i*gt*at-rt*s*At+i*st*At)*Lt,e[14]=(pt*b*o-g*gt*o-pt*s*et+i*gt*et+g*s*At-i*b*At)*Lt,e[15]=(g*st*o-rt*b*o+rt*s*et-i*st*et-g*s*at+i*b*at)*Lt,this}scale(e){const i=this.elements,s=e.x,o=e.y,c=e.z;return i[0]*=s,i[4]*=o,i[8]*=c,i[1]*=s,i[5]*=o,i[9]*=c,i[2]*=s,i[6]*=o,i[10]*=c,i[3]*=s,i[7]*=o,i[11]*=c,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],o=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,s,o))}makeTranslation(e,i,s){return this.set(1,0,0,e,0,1,0,i,0,0,1,s,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,i,-s,0,0,s,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,0,s,0,0,1,0,0,-s,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,0,s,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const s=Math.cos(i),o=Math.sin(i),c=1-s,g=e.x,b=e.y,et=e.z,tt=c*g,rt=c*b;return this.set(tt*g+s,tt*b-o*et,tt*et+o*b,0,tt*b+o*et,rt*b+s,rt*et-o*g,0,tt*et-o*b,rt*et+o*g,c*et*et+s,0,0,0,0,1),this}makeScale(e,i,s){return this.set(e,0,0,0,0,i,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,i,s,o,c,g){return this.set(1,s,c,0,e,1,g,0,i,o,1,0,0,0,0,1),this}compose(e,i,s){const o=this.elements,c=i._x,g=i._y,b=i._z,et=i._w,tt=c+c,rt=g+g,st=b+b,at=c*tt,ct=c*rt,pt=c*st,gt=g*rt,At=g*st,xt=b*st,yt=et*tt,_t=et*rt,Mt=et*st,It=s.x,Bt=s.y,Lt=s.z;return o[0]=(1-(gt+xt))*It,o[1]=(ct+Mt)*It,o[2]=(pt-_t)*It,o[3]=0,o[4]=(ct-Mt)*Bt,o[5]=(1-(at+xt))*Bt,o[6]=(At+yt)*Bt,o[7]=0,o[8]=(pt+_t)*Lt,o[9]=(At-yt)*Lt,o[10]=(1-(at+gt))*Lt,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this}decompose(e,i,s){const o=this.elements;let c=kM.set(o[0],o[1],o[2]).length();const g=kM.set(o[4],o[5],o[6]).length(),b=kM.set(o[8],o[9],o[10]).length();this.determinant()<0&&(c=-c),e.x=o[12],e.y=o[13],e.z=o[14],py.copy(this);const et=1/c,tt=1/g,rt=1/b;return py.elements[0]*=et,py.elements[1]*=et,py.elements[2]*=et,py.elements[4]*=tt,py.elements[5]*=tt,py.elements[6]*=tt,py.elements[8]*=rt,py.elements[9]*=rt,py.elements[10]*=rt,i.setFromRotationMatrix(py),s.x=c,s.y=g,s.z=b,this}makePerspective(e,i,s,o,c,g){const b=this.elements,et=2*c/(i-e),tt=2*c/(s-o),rt=(i+e)/(i-e),st=(s+o)/(s-o),at=-(g+c)/(g-c),ct=-2*g*c/(g-c);return b[0]=et,b[4]=0,b[8]=rt,b[12]=0,b[1]=0,b[5]=tt,b[9]=st,b[13]=0,b[2]=0,b[6]=0,b[10]=at,b[14]=ct,b[3]=0,b[7]=0,b[11]=-1,b[15]=0,this}makeOrthographic(e,i,s,o,c,g){const b=this.elements,et=1/(i-e),tt=1/(s-o),rt=1/(g-c),st=(i+e)*et,at=(s+o)*tt,ct=(g+c)*rt;return b[0]=2*et,b[4]=0,b[8]=0,b[12]=-st,b[1]=0,b[5]=2*tt,b[9]=0,b[13]=-at,b[2]=0,b[6]=0,b[10]=-2*rt,b[14]=-ct,b[3]=0,b[7]=0,b[11]=0,b[15]=1,this}equals(e){const i=this.elements,s=e.elements;for(let o=0;o<16;o++)if(i[o]!==s[o])return!1;return!0}fromArray(e,i=0){for(let s=0;s<16;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e[i+9]=s[9],e[i+10]=s[10],e[i+11]=s[11],e[i+12]=s[12],e[i+13]=s[13],e[i+14]=s[14],e[i+15]=s[15],e}}const kM=new _p,py=new h0,k8=new _p(0,0,0),B8=new _p(1,1,1),T1=new _p,RD=new _p,D_=new _p,qF=new h0,XF=new r2;class DD{constructor(e=0,i=0,s=0,o=DD.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=s,this._order=o}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,s,o=this._order){return this._x=e,this._y=i,this._z=s,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,s=!0){const o=e.elements,c=o[0],g=o[4],b=o[8],et=o[1],tt=o[5],rt=o[9],st=o[2],at=o[6],ct=o[10];switch(i){case"XYZ":this._y=Math.asin(nn(b,-1,1)),Math.abs(b)<.9999999?(this._x=Math.atan2(-rt,ct),this._z=Math.atan2(-g,c)):(this._x=Math.atan2(at,tt),this._z=0);break;case"YXZ":this._x=Math.asin(-nn(rt,-1,1)),Math.abs(rt)<.9999999?(this._y=Math.atan2(b,ct),this._z=Math.atan2(et,tt)):(this._y=Math.atan2(-st,c),this._z=0);break;case"ZXY":this._x=Math.asin(nn(at,-1,1)),Math.abs(at)<.9999999?(this._y=Math.atan2(-st,ct),this._z=Math.atan2(-g,tt)):(this._y=0,this._z=Math.atan2(et,c));break;case"ZYX":this._y=Math.asin(-nn(st,-1,1)),Math.abs(st)<.9999999?(this._x=Math.atan2(at,ct),this._z=Math.atan2(et,c)):(this._x=0,this._z=Math.atan2(-g,tt));break;case"YZX":this._z=Math.asin(nn(et,-1,1)),Math.abs(et)<.9999999?(this._x=Math.atan2(-rt,tt),this._y=Math.atan2(-st,c)):(this._x=0,this._y=Math.atan2(b,ct));break;case"XZY":this._z=Math.asin(-nn(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(at,tt),this._y=Math.atan2(b,c)):(this._x=Math.atan2(-rt,ct),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,s){return qF.makeRotationFromQuaternion(e),this.setFromRotationMatrix(qF,i,s)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return XF.setFromEuler(this),this.setFromQuaternion(XF,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}DD.DEFAULT_ORDER="XYZ";class O8{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}}let L8=0;const YF=new _p,BM=new r2,Jw=new h0,kD=new _p,s2=new _p,N8=new _p,U8=new r2,KF=new _p(1,0,0),JF=new _p(0,1,0),$F=new _p(0,0,1),F8={type:"added"},ZF={type:"removed"};class I1 extends FF{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:L8++}),this.uuid=Pn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=I1.DEFAULT_UP.clone();const e=new _p,i=new DD,s=new r2,o=new _p(1,1,1);i._onChange(function(){s.setFromEuler(i,!1)}),s._onChange(function(){i.setFromQuaternion(s,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new h0},normalMatrix:{value:new Tl}}),this.matrix=new h0,this.matrixWorld=new h0,this.matrixAutoUpdate=I1.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=I1.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new O8,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(e,i,s,o,c,g){this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:o,material:c,group:g})}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return BM.setFromAxisAngle(e,i),this.quaternion.multiply(BM),this}rotateOnWorldAxis(e,i){return BM.setFromAxisAngle(e,i),this.quaternion.premultiply(BM),this}rotateX(e){return this.rotateOnAxis(KF,e)}rotateY(e){return this.rotateOnAxis(JF,e)}rotateZ(e){return this.rotateOnAxis($F,e)}translateOnAxis(e,i){return YF.copy(e).applyQuaternion(this.quaternion),this.position.add(YF.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(KF,e)}translateY(e){return this.translateOnAxis(JF,e)}translateZ(e){return this.translateOnAxis($F,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Jw.copy(this.matrixWorld).invert())}lookAt(e,i,s){e.isVector3?kD.copy(e):kD.set(e,i,s);const o=this.parent;this.updateWorldMatrix(!0,!1),s2.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Jw.lookAt(s2,kD,this.up):Jw.lookAt(kD,s2,this.up),this.quaternion.setFromRotationMatrix(Jw),o&&(Jw.extractRotation(o.matrixWorld),BM.setFromRotationMatrix(Jw),this.quaternion.premultiply(BM.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(F8)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(ZF)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const i=this.children[e];i.parent=null,i.dispatchEvent(ZF)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Jw.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Jw.multiply(e.parent.matrixWorld)),e.applyMatrix4(Jw),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let s=0,o=this.children.length;s<o;s++){const c=this.children[s].getObjectByProperty(e,i);if(c!==void 0)return c}}getObjectsByProperty(e,i){let s=[];this[e]===i&&s.push(this);for(let o=0,c=this.children.length;o<c;o++){const g=this.children[o].getObjectsByProperty(e,i);g.length>0&&(s=s.concat(g))}return s}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(s2,e,N8),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(s2,U8,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let s=0,o=i.length;s<o;s++){const c=i[s];c.matrixWorldAutoUpdate!==!0&&e!==!0||c.updateMatrixWorld(e)}}updateWorldMatrix(e,i){const s=this.parent;if(e===!0&&s!==null&&s.matrixWorldAutoUpdate===!0&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const o=this.children;for(let c=0,g=o.length;c<g;c++){const b=o[c];b.matrixWorldAutoUpdate===!0&&b.updateWorldMatrix(!1,!0)}}}toJSON(e){const i=e===void 0||typeof e=="string",s={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const o={};function c(b,et){return b[et.uuid]===void 0&&(b[et.uuid]=et.toJSON(e)),et.uuid}if(o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),o.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(o.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=c(e.geometries,this.geometry);const b=this.geometry.parameters;if(b!==void 0&&b.shapes!==void 0){const et=b.shapes;if(Array.isArray(et))for(let tt=0,rt=et.length;tt<rt;tt++){const st=et[tt];c(e.shapes,st)}else c(e.shapes,et)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(c(e.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const b=[];for(let et=0,tt=this.material.length;et<tt;et++)b.push(c(e.materials,this.material[et]));o.material=b}else o.material=c(e.materials,this.material);if(this.children.length>0){o.children=[];for(let b=0;b<this.children.length;b++)o.children.push(this.children[b].toJSON(e).object)}if(this.animations.length>0){o.animations=[];for(let b=0;b<this.animations.length;b++){const et=this.animations[b];o.animations.push(c(e.animations,et))}}if(i){const b=g(e.geometries),et=g(e.materials),tt=g(e.textures),rt=g(e.images),st=g(e.shapes),at=g(e.skeletons),ct=g(e.animations),pt=g(e.nodes);b.length>0&&(s.geometries=b),et.length>0&&(s.materials=et),tt.length>0&&(s.textures=tt),rt.length>0&&(s.images=rt),st.length>0&&(s.shapes=st),at.length>0&&(s.skeletons=at),ct.length>0&&(s.animations=ct),pt.length>0&&(s.nodes=pt)}return s.object=o,s;function g(b){const et=[];for(const tt in b){const rt=b[tt];delete rt.metadata,et.push(rt)}return et}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData={};for(const[s,o]of Object.entries(e.userData))this.userData[s]=!o||o&&(o.isTexture||o.isObject3D)?o:JSON.parse(JSON.stringify(o));if(i===!0)for(let s=0;s<e.children.length;s++){const o=e.children[s];this.add(o.clone())}return this}}I1.DEFAULT_UP=new _p(0,1,0),I1.DEFAULT_MATRIX_AUTO_UPDATE=!0,I1.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class j8 extends I1{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new h0,this.projectionMatrix=new h0,this.projectionMatrixInverse=new h0}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(-i[8],-i[9],-i[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class z8 extends UL{constructor(e){super(e),this.camera=e,this.traverse(i=>{i.userData.__keepShadowDef=!0,i.castShadow=!1,i.receiveShadow=!1})}}class GL extends z8{constructor(e){super(e),this._vector=new _p,this._camera=new j8;const i=new zy,s=new Ov({color:16777215,linewidth:.005,vertexColors:!0,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),{vertices:o,colors:c,pointMap:g}=function(){const at=[],ct=[],pt={};function gt(xt,yt){At(xt),At(yt)}function At(xt){at.push(0,0,0),ct.push(0,0,0),pt[xt]===void 0&&(pt[xt]=[]),pt[xt].push(at.length/3-1)}return gt("n1","n2"),gt("n2","n4"),gt("n4","n3"),gt("n3","n1"),gt("f1","f2"),gt("f2","f4"),gt("f4","f3"),gt("f3","f1"),gt("n1","f1"),gt("n2","f2"),gt("n3","f3"),gt("n4","f4"),gt("p","n1"),gt("p","n2"),gt("p","n3"),gt("p","n4"),gt("u1","u2"),gt("u2","u3"),gt("u3","u1"),gt("c","t"),gt("p","c"),gt("cn1","cn2"),gt("cn3","cn4"),gt("cf1","cf2"),gt("cf3","cf4"),{vertices:at,colors:ct,pointMap:pt}}();i.setPositions(o),i.setColors(c),this.line=new HP(i,s),this.line.frustumCulled=!1,this.add(this.line),this.pointMap=g,this.update();const b=new zo(16755200),et=new zo(16711680),tt=new zo(43775),rt=new zo(16777215),st=new zo(3355443);this.setColors(b,et,tt,rt,st)}setColors(e,i,s,o,c){const g=this.line.geometry,b=g.getAttribute("instanceColorStart"),et=g.getAttribute("instanceColorEnd");function tt(rt,st){b.setXYZ(rt/2,st.r,st.g,st.b),et.setXYZ(rt/2,st.r,st.g,st.b)}tt(0,e),tt(2,e),tt(4,e),tt(6,e),tt(8,e),tt(10,e),tt(12,e),tt(14,e),tt(16,e),tt(18,e),tt(20,e),tt(22,e),tt(24,i),tt(26,i),tt(28,i),tt(30,i),tt(32,s),tt(34,s),tt(36,s),tt(38,o),tt(40,c),tt(42,c),tt(44,c),tt(46,c),tt(48,c),b.needsUpdate=!0,et.needsUpdate=!0}update(){if(!this.camera)return;const e=this.line.geometry,i=this.pointMap,{_camera:s,_vector:o}=this;s.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ep("c",i,e,s,0,0,-1,o),ep("t",i,e,s,0,0,1,o),ep("n1",i,e,s,-1,-1,-1,o),ep("n2",i,e,s,1,-1,-1,o),ep("n3",i,e,s,-1,1,-1,o),ep("n4",i,e,s,1,1,-1,o),ep("f1",i,e,s,-1,-1,1,o),ep("f2",i,e,s,1,-1,1,o),ep("f3",i,e,s,-1,1,1,o),ep("f4",i,e,s,1,1,1,o),ep("u1",i,e,s,.7,1.1,-1,o),ep("u2",i,e,s,-.7,1.1,-1,o),ep("u3",i,e,s,0,2,-1,o),ep("cf1",i,e,s,-1,0,1,o),ep("cf2",i,e,s,1,0,1,o),ep("cf3",i,e,s,0,-1,1,o),ep("cf4",i,e,s,0,1,1,o),ep("cn1",i,e,s,-1,0,-1,o),ep("cn2",i,e,s,1,0,-1,o),ep("cn3",i,e,s,0,-1,-1,o),ep("cn4",i,e,s,0,1,-1,o),e.getAttribute("instanceStart").needsUpdate=!0,e.getAttribute("instanceEnd").needsUpdate=!0,e.computeBoundingBox(),e.computeBoundingSphere()}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),super.dispose()}static Check(e){return e.isCamera}static Create(e){return new GL(e)}}function ep(h,e,i,s,o,c,g,b){b.set(o,c,g).unproject(s);const et=e[h];if(et!==void 0){const tt=i.getAttribute("instanceStart"),rt=i.getAttribute("instanceEnd");for(let st=0,at=et.length;st<at;st++){const ct=Math.floor(et[st]/2);(et[st]%2==0?tt:rt).setXYZ(ct,b.x,b.y,b.z)}}}class ES extends hs{constructor(){super(...arguments),this.enabled=!0,this.helpers=[Yw,xS,Kw,GL],this.visible=!0,this.toJSON=null,this._addSceneObject=e=>{const i=e.object;this._createWidgets(i==null?void 0:i.modelObject)},this.widgets=[],this.uiConfig={type:"folder",label:"Widgets",children:[{type:"checkbox",label:"Visible",property:[this,"visible"]},{type:"button",label:"Refresh",value:()=>this.refresh()}]}}_onVisibleChange(){var e,i;(e=this.widgets)==null||e.forEach(s=>s.visible=this.visible),(i=this._viewer)==null||i.setDirty()}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),this.widgets.forEach(i=>i.dispose&&i.dispose()),this.widgets=[],super.onRemove(e)}refresh(){var e;this._createWidgets((e=this._viewer)==null?void 0:e.scene.modelRoot)}_createWidgets(e){e==null||e.traverse(i=>{const s=this.widgets.find(o=>o.object===i);if(s)return void(s.update&&s.update());this.helpers.filter(o=>o.Check(i)).forEach(o=>{var g;const c=o.Create(i);this.widgets.push(c),(g=this._viewer)==null||g.scene.addWidget(c)})})}}ES.PluginType="WidgetsPlugin",function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);c>3&&g&&Object.defineProperty(e,i,g)}([(0,_e.onChange)(ES.prototype._onVisibleChange)],ES.prototype,"visible",void 0);var V8=BE({defaultModifiers:[QC,o1,qC,Ln]}),G8=__webpackgi_require__(388),H8=__webpackgi_require__.n(G8);function Q8(h){const e=[];h.traverse(o=>{o.geometry&&e.push(o)});const i={},s={};e.forEach(o=>{if(!i[o.geometry.uuid]){const b=o.geometry.toJSON().data,et=b?H8()({a:b.attributes||{},b:b.index||[]}):"";i[o.geometry.uuid]=et}const c=i[o.geometry.uuid],g=s[c]??(s[c]=[]);g.includes(o)||g.push(o)}),Object.values(s).forEach(o=>{if(o.length<2)return;const c=o[0].geometry;o.forEach((g,b)=>{b<1||(g.geometry.dispose(),g.geometry=c)})})}const $w=new _.Pa4,SS=new _.Pa4,BD=new _.Pa4,HL=new _.Pa4,OD=new _.Pa4,OM=new _.Pa4;let QL=1;const W8=new _.Pa4(0,1,0);class q8 extends lx{constructor(e,i){super(e,i),this.throttleUpdate=60,this.targetOffset=new _.Pa4(0,0,0);const s=this.update;this.update=()=>this._update(s)}_update(e){this.target.add(this.targetOffset),$w.copy(this.object.position).sub(this.target),QL=$w.length(),OM.copy(this.target);const i=e();return OM.sub(this.target),$w.copy(this.object.position).sub(this.target),QL/=$w.length(),this.target.add(OM),this.object.position.copy(this.target).add($w),$w.normalize(),SS.crossVectors(W8,$w).normalize(),BD.crossVectors($w,SS).normalize(),HL.crossVectors(SS,BD).normalize().negate(),SS.length()>.1&&this.object.up.crossVectors($w.clone().normalize(),SS),this.enablePan&&(OD.set(0,0,0).addScaledVector(SS,OM.x).addScaledVector(BD,OM.y).addScaledVector(HL,OM.z),this.targetOffset.add(OD),this.targetOffset.multiplyScalar(1/QL)),OD.set(0,0,0).addScaledVector(SS,-this.targetOffset.x).addScaledVector(BD,-this.targetOffset.y).addScaledVector(HL,-this.targetOffset.z),this.object.lookAt(OD.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),i}}class LD extends _e.SimpleEventDispatcher{_setOptions(e){var i;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=LD.GetSupportedMimeTypes([],["h264"],!0)??LD.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!((i=this._options.mimeType)!=null&&i.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,i){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=o=>{var c;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const g=new Blob(this._currentRecording,{type:this._options.mimeType});(c=this._recordingCallback)==null||c.call(this,g)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=o=>{var c;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((c=this._recorder)==null||c.pause())},this._onresume=o=>{if(!this.stepMode)return;const c=()=>{var b;this._state==="recording"&&((b=this._recorder)==null||b.pause())},g=Math.min(this._resumeSyncTime-(0,_e.now)(),0)+1e3/this._options.frameRate;g>0?(0,_e.timeout)(g).then(c):c()},this._onpause=o=>{},this._ondataavailable=o=>{o.data&&o.data.size>0&&this._currentRecording.push(o.data)},this._onerror=o=>{this._state="error",this._console.error(o),this.dispatchEvent({type:"error",error:o}),this._recorder=void 0},this._canvas=e;const s=i==null?void 0:i.mimeType;this._options={mimeType:s||"auto",frameRate:30,stepMode:!1},this._setOptions(i||this._options)}isRecording(){return this._state==="recording"}start(){var i,s,o;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const e={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(i=e.mimeType)==null?void 0:i.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const c=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),g=(s=c.getVideoTracks())==null?void 0:s[0];this._track=g,this._recorder=new window.MediaRecorder(c,e),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(o=this._recorder)==null||o.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async c=>{const g=await(c==null?void 0:c.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=g,this._state="recording",this._onstart({})}).catch(c=>{this._onerror({detail:c})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const i=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),i]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=(0,_e.now)(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const i=await Promise.all(e.map(async([o,c])=>await(await fetch(c)).blob())),s=[];for(let o=0;o<e.length;o++){const c=await this._imgDirectory.getFileHandle(e[o][0],{create:!0});s.push((0,_e.writeFile)(c,i[o]))}await Promise.all(s)}static GetSupportedMimeTypes(e,i,s=!1){if(!window.MediaRecorder)return s?void 0:[];const o=["webm","ogg","mp4","x-matroska"].filter(b=>!e||e.length<1||e.includes(b)),c=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(b=>!i||i.length<1||i.includes(b)),g=[];return o.forEach(b=>{const et=`video/${b}`;c.forEach(tt=>{[`${et};codecs=${tt}`,`${et};codecs:${tt}`,`${et};codecs=${tt.toUpperCase()}`,`${et};codecs:${tt.toUpperCase()}`,`${et}`].forEach(rt=>{MediaRecorder.isTypeSupported(rt)&&g.push(rt)})})}),s?g.length>0?g[0]:void 0:g}}class X8 extends JS{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new _.cJO(1,0))}}function WL(h,e){const i=Array.from((h.access??"").split(".")),s=i.pop();let o=h.targetObject??e;if(!s||s.length===0)return{key:void 0,tar:o};if(o=(0,_e.deepAccessObject)(i,o),o&&!(s in o))throw console.error("invalid key",s,o,e,h),"";return{key:s,tar:o}}function qL(h,e,i,s){const{key:o,tar:c}=WL(h,e);return o&&c?CC(c,o,()=>{var g;i&&((g=h.updater)!=null&&g.length)&&h.updater.forEach(b=>i[b]()),s==null||s()}):g=>console.warn("Unable to set ",g,o,c,h,e)}async function ND(h,e,i){const{key:s,tar:o}=WL(e,h),c=e.animSet?[_j(o,e.animSet,i,e.animSetParallel??!1)]:[];if(s&&o){const g=e.updater??[],b=async()=>xE(o,s,{...e,onUpdate:et=>{var tt;(tt=e.onUpdate)==null||tt.call(e,et),g.forEach(rt=>{var st;return(st=i[rt])==null?void 0:st.call(i)})}});e.delay?c.push((0,_e.timeout)(e.delay).then(b)):c.push(b())}else(e.duration||e.delay)&&c.push((0,_e.timeout)((e.delay??0)+(e.duration??0)));return c.length===1?c[0]:Promise.all(c)}async function _j(h,e,i,s=!1){if(s)return Promise.all(e.map(async o=>ND(h,o,i)));for(const o of e)await ND(h,o,i)}function $j(h,e,i,s){var g,b;if(!h)return;e||(e=[]);const o=s??{},c=h;for(let et=0,tt=e.length;et<tt;et++){const rt=e[et];if(rt.uiRef){const at=(c==null?void 0:c.indexOf(rt.uiRef))??-1;at!==et&&(at>=0&&(c==null||c.splice(at,1)),c==null||c.splice(et,0,rt.uiRef))}else{rt.uiRef={type:"folder",label:rt.name??"Animation "+et,children:[]};const at=[{type:"button",label:"animate",value:()=>{ND(i,rt,o).then(()=>{var ct;return console.log(((ct=rt.uiRef)==null?void 0:ct.label)+" finished")})}}];rt.access!==void 0&&at.push({type:"input",property:[rt,"access"]}),rt.from!==void 0&&at.push({type:rt.uiObjectType??"input",property:[rt,"from"],onChange:()=>{var ct;qL(rt,i)(rt.from),(ct=rt.updater)==null||ct.forEach(pt=>pt in o&&o[pt]())}}),rt.to!==void 0&&at.push({type:rt.uiObjectType??"input",property:[rt,"to"],onChange:()=>{var ct;qL(rt,i)(rt.to),(ct=rt.updater)==null||ct.forEach(pt=>pt in o&&o[pt]())}}),rt.duration!==void 0&&at.push({type:"input",property:[rt,"duration"]}),rt.animSet&&(rt.animSetParallel||(rt.animSetParallel=!1),at.push({type:"input",label:"run parallel",property:[rt,"animSetParallel"]})),rt.animSet&&at.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),(g=rt.uiRef.children)==null||g.push(...at),c==null||c.splice(et,0,rt.uiRef)}const st=(b=rt.uiRef.children)==null?void 0:b.map(at=>(0,_e.getOrCall)(at)).flat(2).find(at=>at==null?void 0:at.animSetContainer);rt.animSet&&st&&$j(st.children,rt.animSet,rt.targetObject??i,s)}}const XL=new TextEncoder,Y8={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},K8=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class J8{constructor({accessKeyId:e,secretAccessKey:i,sessionToken:s,service:o,region:c,cache:g,retries:b,initRetryMs:et}){if(e==null)throw new TypeError("accessKeyId is a required option");if(i==null)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=e,this.secretAccessKey=i,this.sessionToken=s,this.service=o,this.region=c,this.cache=g||new Map,this.retries=b??10,this.initRetryMs=et||50}async sign(e,i){if(e instanceof Request){const{method:c,url:g,headers:b,body:et}=e;(i=Object.assign({method:c,url:g,headers:b},i)).body==null&&b.has("Content-Type")&&(i.body=et!=null&&b.has("X-Amz-Content-Sha256")?et:await e.clone().arrayBuffer()),e=g}const s=new $8(Object.assign({url:e},i,this,i&&i.aws)),o=Object.assign({},i,await s.sign());delete o.aws;try{return new Request(o.url.toString(),o)}catch(c){if(c instanceof TypeError)return new Request(o.url.toString(),Object.assign({duplex:"half"},o));throw c}}async fetch(e,i){for(let s=0;s<=this.retries;s++){const o=fetch(await this.sign(e,i));if(s===this.retries)return o;const c=await o;if(c.status<500&&c.status!==429)return c;await new Promise(g=>setTimeout(g,Math.random()*this.initRetryMs*Math.pow(2,s)))}throw new Error("An unknown error occurred, ensure retries is not negative")}}class $8{constructor({method:e,url:i,headers:s,body:o,accessKeyId:c,secretAccessKey:g,sessionToken:b,service:et,region:tt,cache:rt,datetime:st,signQuery:at,appendSessionToken:ct,allHeaders:pt,singleEncode:gt}){if(i==null)throw new TypeError("url is a required option");if(c==null)throw new TypeError("accessKeyId is a required option");if(g==null)throw new TypeError("secretAccessKey is a required option");let At,xt;this.method=e||(o?"POST":"GET"),this.url=new URL(i),this.headers=new Headers(s||{}),this.body=o,this.accessKeyId=c,this.secretAccessKey=g,this.sessionToken=b,et&&tt||([At,xt]=function(Mt,It){const{hostname:Bt,pathname:Lt}=Mt;if(Bt.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(Bt.endsWith(".backblazeb2.com")){const on=Bt.match(/^(?:[^.]+\.)?s3\.([^.]+)\.backblazeb2\.com$/);return on!=null?["s3",on[1]]:["",""]}const Ht=Bt.replace("dualstack.","").match(/([^.]+)\.(?:([^.]*)\.)?amazonaws\.com(?:\.cn)?$/);let[Jt,sn]=(Ht||["",""]).slice(1,3);if(sn==="us-gov")sn="us-gov-west-1";else if(sn==="s3"||sn==="s3-accelerate")sn="us-east-1",Jt="s3";else if(Jt==="iot")Jt=Bt.startsWith("iot.")?"execute-api":Bt.startsWith("data.jobs.iot.")?"iot-jobs-data":Lt==="/mqtt"?"iotdevicegateway":"iotdata";else if(Jt==="autoscaling"){const on=(It.get("X-Amz-Target")||"").split(".")[0];on==="AnyScaleFrontendService"?Jt="application-autoscaling":on==="AnyScaleScalingPlannerFrontendService"&&(Jt="autoscaling-plans")}else sn==null&&Jt.startsWith("s3-")?(sn=Jt.slice(3).replace(/^fips-|^external-1/,""),Jt="s3"):Jt.endsWith("-fips")?Jt=Jt.slice(0,-5):sn&&/-\d$/.test(Jt)&&!/-\d$/.test(sn)&&([Jt,sn]=[sn,Jt]);return[Y8[Jt]||Jt,sn]}(this.url,this.headers)),this.service=et||At||"",this.region=tt||xt||"us-east-1",this.cache=rt||new Map,this.datetime=st||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=at,this.appendSessionToken=ct||this.service==="iotdevicegateway",this.headers.delete("Host"),this.service!=="s3"||this.signQuery||this.headers.has("X-Amz-Content-Sha256")||this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const yt=this.signQuery?this.url.searchParams:this.headers;if(yt.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&yt.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(Mt=>pt||!K8.has(Mt)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(Mt=>Mt+":"+(Mt==="host"?this.url.host:(this.headers.get(Mt)||"").replace(/\s+/g," "))).join(`
`),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&(this.service!=="s3"||yt.has("X-Amz-Expires")||yt.set("X-Amz-Expires","86400"),yt.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),yt.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),yt.set("X-Amz-SignedHeaders",this.signedHeaders)),this.service==="s3")try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch{this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");gt||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=t4(this.encodedPath);const _t=new Set;this.encodedSearch=[...this.url.searchParams].filter(([Mt])=>{if(!Mt)return!1;if(this.service==="s3"){if(_t.has(Mt))return!1;_t.add(Mt)}return!0}).map(Mt=>Mt.map(It=>t4(encodeURIComponent(It)))).sort(([Mt,It],[Bt,Lt])=>Mt<Bt?-1:Mt>Bt?1:It<Lt?-1:It>Lt?1:0).map(Mt=>Mt.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const e=this.datetime.slice(0,8),i=[this.secretAccessKey,e,this.region,this.service].join();let s=this.cache.get(i);if(!s){const o=await o2("AWS4"+this.secretAccessKey,e),c=await o2(o,this.region),g=await o2(c,this.service);s=await o2(g,"aws4_request"),this.cache.set(i,s)}return YL(await o2(s,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,YL(await e4(await this.canonicalString()))].join(`
`)}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+`
`,this.signedHeaders,await this.hexBodyHash()].join(`
`)}async hexBodyHash(){let e=this.headers.get("X-Amz-Content-Sha256")||(this.service==="s3"&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(e==null){if(this.body&&typeof this.body!="string"&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");e=YL(await e4(this.body||""))}return e}}async function o2(h,e){const i=await crypto.subtle.importKey("raw",typeof h=="string"?XL.encode(h):h,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",i,XL.encode(e))}async function e4(h){return crypto.subtle.digest("SHA-256",typeof h=="string"?XL.encode(h):h)}function YL(h){return Array.prototype.map.call(new Uint8Array(h),e=>("0"+e.toString(16)).slice(-2)).join("")}function t4(h){return h.replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())}var CS=function(h,e,i,s){var o,c=arguments.length,g=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(h,e,i,s);else for(var b=h.length-1;b>=0;b--)(o=h[b])&&(g=(c<3?o(g):c>3?o(e,i,g):o(e,i))||g);return c>3&&g&&Object.defineProperty(e,i,g),g};let k_=class extends hs{constructor(){super(),this.enabled=!0,this._connected=!1,this.dependencies=[FI],this.accessKeyId="",this.accessKeySecret="",this.endpointURL="",this.pathPrefix="webgi",this.serializeSettings=!1,this.toggleConnection=()=>{this._connected?this.disconnect():this.connect()},this.serializeWithViewer=!1}connect(){this._connected&&this.disconnect(),this._client=new J8({accessKeyId:this.accessKeyId,secretAccessKey:this.accessKeySecret}),this._connected=!0,this.refreshUi()}refreshUi(){var h,e;(e=(h=this.uiConfig)==null?void 0:h.uiRefresh)==null||e.call(h,"postFrame",!0)}disconnect(){this._client=void 0,this._connected=!1,this.refreshUi()}get connected(){return this._connected}get client(){return this._client}toJSON(h){return this.serializeSettings?super.toJSON(h):{type:this.constructor.PluginType}}async onAdded(h){await super.onAdded(h);const e=h.getPlugin(FI);e.actions.exportFile=async(i,s,o)=>{if(!this._connected)return void await e.defaultActions.exportFile(i,s);const c=(0,_e.pathJoin)([this.endpointURL,this.pathPrefix,s]),g=await this._fetch(c,{method:"PUT",body:i},o);if(!g.ok)return h.console.error("Error uploading file",g),void await e.defaultActions.exportFile(i,s);this.dispatchEvent({type:"fileUpload",name:s,blob:i,response:g,path:c}),h.console.log("File uploaded",g)}}async _fetch(h,e,i){if(!this._client)throw new Error("Not connected");for(let s=0;s<=this._client.retries;s++){const o=fetch(await this._client.sign(h,e));if(s===this._client.retries)return o;const c=await o;if(c.status<500&&c.status!==429)return c;await(0,_e.timeout)(Math.random()*this._client.initRetryMs*Math.pow(2,s))}throw new Error("An unknown error occurred, ensure retries is not negative")}};k_.PluginType="AWSClientPlugin1",CS([Mn(),js("Access Key ID",h=>({disabled:()=>!h.enabled||h._connected}))],k_.prototype,"accessKeyId",void 0),CS([Mn(),js("Access Key Secret",h=>({disabled:()=>!h.enabled||h._connected}))],k_.prototype,"accessKeySecret",void 0),CS([Mn(),js("Endpoint URL",h=>({disabled:()=>!h.enabled||h._connected}))],k_.prototype,"endpointURL",void 0),CS([Mn(),js("Path Prefix",h=>({disabled:()=>!h.enabled}))],k_.prototype,"pathPrefix",void 0),CS([Mn(),Nr("Remember",h=>({disabled:()=>!h.enabled||h._connected}))],k_.prototype,"serializeSettings",void 0),CS([go(void 0,h=>({label:()=>h._connected?"Disconnect":"Connect"}))],k_.prototype,"toggleConnection",void 0),k_=CS([Ms("S3 Connection")],k_);const Z8={Background:new f1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/background",assets:["gradient-radial-dark-blue.svg","gradient-radial-grey.svg","gradient-radial-red.svg","gradient-radial-aqua.svg","gradient-radial-green.svg","gradient-radial-white.svg","gradient-radial-coral.svg","gradient-radial-fuchsia.svg","gradient-radial-blue.svg","gradient-radial-black.svg","gradient-radial-light-blue.svg","gradient-radial-gray.svg","gradient-radial-beige.svg","gradient-radial-antrasit.svg","gradient-linear-light-blue.svg","gradient-linear-gray.svg","gradient-linear-beige.svg","gradient-linear-antrasit.svg","bg-1.jpg","bg-2.png"].map(h=>({path:h}))}).assets,Environment:new f1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-metal-1.hdr","env-metal-2.hdr","env-metal-3.hdr","env-metal-4.hdr","env-metal-5.hdr","env-metal-6.hdr","env-metal-7.hdr","env-metal-8.hdr","env-metal-9.hdr","env-metal-10.hdr","env-metal-11.hdr","env-metal-12.hdr","env-metal-13.hdr","env-metal-14.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr","env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","alps_field_1k.hdr","paul_lobe_haus_1k.hdr","derelict_highway_midday_1k.hdr","neon_photostudio_1k.hdr","studio_small_08_1k.hdr","evening_meadow_1k.hdr","st_peters_square_night_1k.hdr","studio_small_07_1k.hdr","moonless_golf_1k.hdr","satara_night_1k.hdr","venice_sunset_1k.hdr","umhlanga_sunrise_1k.hdr","studio_country_hall_1k.hdr"].map(h=>({path:h}))}).assets,GemEnvironment:new f1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(h=>({path:h}))}).assets,Ground:new f1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/ground",assets:["ground-1.json","ground-2.json","ground-3.json","g-1.json","g-2.json","g-3.json","g-4.json","g-5.json"].map(h=>({path:h}))}).assets,CameraViews:new f1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/views",assets:["views-1.json","views-2.json"].map(h=>({path:h}))}).assets,MaterialConfiguration:new f1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-conf",assets:["gold-ceramic.json","gold.json","metal-diamond.json"].map(h=>({path:h}))}).assets,MaterialLibraries:new f1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-lib",assets:["metal.zip","gem.zip"].map(h=>({path:h}))}).assets};function n4(h,e){return e?h*(1e3/e):0}function eH(h){var e,i=h.from,s=i===void 0?0:i,o=h.velocity,c=o===void 0?0:o,g=h.min,b=h.max,et=h.power,tt=et===void 0?.8:et,rt=h.timeConstant,st=rt===void 0?750:rt,at=h.bounceStiffness,ct=at===void 0?500:at,pt=h.bounceDamping,gt=pt===void 0?10:pt,At=h.restDelta,xt=At===void 0?1:At,yt=h.modifyTarget,_t=h.driver,Mt=h.onUpdate,It=h.onComplete,Bt=h.onStop;function Lt(xn){return g!==void 0&&xn<g||b!==void 0&&xn>b}function Ht(xn){return g===void 0?b:b===void 0||Math.abs(g-xn)<Math.abs(b-xn)?g:b}function Jt(xn){e==null||e.stop(),e=e0(Wl(Wl({},xn),{driver:_t,onUpdate:function(Cn){var Jn;Mt==null||Mt(Cn),(Jn=xn.onUpdate)===null||Jn===void 0||Jn.call(xn,Cn)},onComplete:It,onStop:Bt}))}function sn(xn){Jt(Wl({type:"spring",stiffness:ct,damping:gt,restDelta:xt},xn))}if(Lt(s))sn({from:s,velocity:c,to:Ht(s)});else{var on=tt*c+s;yt!==void 0&&(on=yt(on));var mn,cn,un=Ht(on),bn=un===g?-1:1;Jt({type:"decay",from:s,velocity:c,timeConstant:st,power:tt,restDelta:xt,modifyTarget:yt,onUpdate:Lt(on)?function(xn){mn=cn,cn=xn,c=n4(xn-mn,wT().delta),(bn===1&&xn>un||bn===-1&&xn<un)&&sn({from:xn,to:un,velocity:c})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var i4=function(h){return 180*h/Math.PI},tH=function(h,e){return e===void 0&&(e=AE),i4(Math.atan2(e.y-h.y,e.x-h.x))},nH=function(h,e){var i=!0;return e===void 0&&(e=h,i=!1),function(s){return i?s-h+e:(h=s,i=!0,e)}},iH=function(h){return h},KL=function(h){return h===void 0&&(h=iH),function(e,i,s){var o=i-s,c=-(0-e+1)*(0-h(Math.abs(o)));return o<=0?i+c:i-c}},rH=KL(),sH=KL(Math.sqrt),r4=function(h){return h*Math.PI/180},UD=function(h){return h.hasOwnProperty("x")&&h.hasOwnProperty("y")},JL=function(h){return UD(h)&&h.hasOwnProperty("z")},FD=function(h,e){return Math.abs(h-e)};function oH(h,e){if(wC(h)&&wC(e))return FD(h,e);if(UD(h)&&UD(e)){var i=FD(h.x,e.x),s=FD(h.y,e.y),o=JL(h)&&JL(e)?FD(h.z,e.z):0;return Math.sqrt(Math.pow(i,2)+Math.pow(s,2)+Math.pow(o,2))}}var aH=function(h,e,i){return e=r4(e),{x:i*Math.cos(e)+h.x,y:i*Math.sin(e)+h.y}},s4=function(h,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(h*e)/e},o4=function(h,e,i,s){return s===void 0&&(s=0),s4(h+i*(e-h)/Math.max(s,i))},lH=function(h){h===void 0&&(h=50);var e=0,i=0;return function(s){var o=wT().timestamp,c=o!==i?o-i:0,g=c?o4(e,s,c,h):e;return i=o,e=g,g}},cH=function(h){if(typeof h=="number")return function(s){return Math.round(s/h)*h};var e=0,i=h.length;return function(s){var o=Math.abs(h[0]-s);for(e=1;e<i;e++){var c=h[e],g=Math.abs(c-s);if(g===0)return c;if(g>o)return h[e-1];if(e===i-1)return c;o=g}}};function uH(h,e){return h/(1e3/e)}var hH=function(h,e,i){var s=e-h;return((i-h)%s+s)%s+h},a4=function(h,e){return 1-3*e+3*h},l4=function(h,e){return 3*e-6*h},c4=function(h){return 3*h},jD=function(h,e,i){return((a4(e,i)*h+l4(e,i))*h+c4(e))*h},u4=function(h,e,i){return 3*a4(e,i)*h*h+2*l4(e,i)*h+c4(e)},dH=1e-7,pH=10,fH=8,mH=.001,zD=11,VD=1/(zD-1);function gH(h,e,i,s){if(h===e&&i===s)return dC;for(var o=new Float32Array(zD),c=0;c<zD;++c)o[c]=jD(c*VD,h,i);return function(g){return g===0||g===1?g:jD(function(b){for(var et=0,tt=1,rt=zD-1;tt!==rt&&o[tt]<=b;++tt)et+=VD;--tt;var st=et+(b-o[tt])/(o[tt+1]-o[tt])*VD,at=u4(st,h,i);return at>=mH?function(ct,pt,gt,At){for(var xt=0;xt<fH;++xt){var yt=u4(pt,gt,At);if(yt===0)return pt;pt-=(jD(pt,gt,At)-ct)/yt}return pt}(b,st,h,i):at===0?st:function(ct,pt,gt,At,xt){var yt,_t,Mt=0;do(yt=jD(_t=pt+(gt-pt)/2,At,xt)-ct)>0?gt=_t:pt=_t;while(Math.abs(yt)>dH&&++Mt<pH);return _t}(b,et,et+VD,h,i)}(g),e,s)}}var vH=function(h,e){return e===void 0&&(e="end"),function(i){var s=(i=e==="end"?Math.min(i,.999):Math.max(i,.001))*h,o=e==="end"?Math.floor(s):Math.ceil(s);return V0(0,1,o/h)}};class _H extends iv{get editorInitialized(){return this._editorInitialized}constructor(e){super(e),this._editorInitialized=!1,this.defaultModes=[{title:"Viewer",plugins:[R_,e2,nw,Y_]},{title:"Picking",plugins:[JI,vo,Uo,cA,u0,ES]},{title:"Scene",plugins:[YI,Wv,KI,$I,ZI,z0,Qp,P_]},{title:"Anti-aliasing",plugins:[cp,Kx,cv]},{title:"Post Processing",plugins:[Sx,wI,mu,Cx,eE,q0,Bx,K1,rv,jy,Ju,Tp]},{title:"Export",plugins:[m1,Uv,oy,k_]},{title:"Animations",plugins:[$o,qo,fu,S1,PA]},{title:"Modifiers",plugins:[ay,Kv,Jv,c0,CI,NI,hm]},{title:"Configurators",plugins:[Pw,Iw,i0,VI]},{title:"Plugins",plugins:[am,dm,Nu,U0,zv,sv,Fm,b_,av,zm,xa,_A,iy]},{title:"Extras",plugins:[NL]}],GF()}async setupUi(e,i){await HF(this,e,i??this.defaultModes),this._editorInitialized=!0}}async function h4(h,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:o=!1,importPopup:c=!0,caching:g=!0}){h.enabled=!1,e&&await h.addPlugin($0),h.getPlugin(Lr)||await h.addPlugin(Lr,void 0,void 0,{storage:g&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await h.addPlugin(m1),await h.addPlugin(MO),await h.addPlugin(FI),c&&await h.addPlugin(xa),await h.addPlugin(DL),await h.addPlugin(pS,!1),await h.addPlugin(rO),await h.addPlugin(dM),await h.addPlugin(Y_),await h.addPlugin(PA),await h.addPlugin(Vw),await h.addPlugin(vo,eT,!1,!0),await UP(h,{ground:i,bloom:s,depthTonemap:o}),await h.addPlugin(wI),await h.addPlugin(c0,!1),await h.addPlugin(sL),await h.addPlugin(lL),await h.addPlugin(cL),await h.addPlugin(_A,!1),await h.addPlugin(ay),await h.addPlugin(Kv),await h.addPlugin(Jv),await h.addPlugin(Iw),await h.addPlugin(Pw),await h.addPlugin(VI),await h.addPlugin(cA),await h.addPlugin(oy),await h.addPlugin(Uv),await h.addPlugin(JI),await h.addPlugin(KI),await h.addPlugin($I),await h.addPlugin(ZI),await h.addPlugin(R_),await h.addPlugin(e2),await h.addPlugin(YI),await h.addPlugin(ES),await h.addPlugin(u0),await h.addPlugin(S1,h.container,!1),await h.addPlugin(k_);const b=await h.addPlugin(new CD(!(0,_e.mobileAndTabletCheck)()));return h.renderer.refreshPipeline(),h.scene.addEventListener("textureAdded",et=>{et.texture&&h.scene.setEnvironment(et.texture)}),b.setupPluginUi(dm),b.setupPluginUi(R_),b.setupPluginUi(e2),b.setupPluginUi(xa),b.setupPluginUi(Y_),b.setupPluginUi(YI),b.setupPluginUi(m1),b.setupPluginUi($o),b.setupPluginUi(z0),b.setupPluginUi(Pw),b.setupPluginUi(Iw),b.setupPluginUi(PA),b.setupPluginUi(JI),b.setupPluginUi(cA),b.setupPluginUi(Uo),b.setupPluginUi(vo),i&&h.getPlugin(Wv)&&b.setupPluginUi(Wv),i&&h.getPlugin(P_)&&b.setupPluginUi(P_),b.setupPluginUi(Bx),b.setupPluginUi(qo),b.setupPluginUi(oy),b.setupPluginUi(Sx),b.setupPluginUi(wI),b.setupPluginUi(Cx),b.setupPluginUi(eE),b.setupPluginUi(mu),b.setupPluginUi(q0),b.setupPluginUi(jy),b.setupPluginUi(K1),b.setupPluginUi(av),b.setupPluginUi(b_),b.setupPluginUi(KI),b.setupPluginUi(ay),b.setupPluginUi(Kv),b.setupPluginUi(cp),b.setupPluginUi($I),b.setupPluginUi(ZI),b.setupPluginUi(sv),b.setupPluginUi(Fm),b.setupPluginUi(zm),s&&b.setupPluginUi(rv),b.setupPluginUi(Uv),b.setupPluginUi(am),b.setupPluginUi(Kx),b.setupPluginUi(Qp),b.setupPluginUi(Ju),b.setupPluginUi(Tp),b.setupPluginUi(Jv),b.setupPluginUi(U0),b.setupPluginUi(cv),b.setupPluginUi(nw),b.setupPluginUi(i0),b.setupPluginUi(Nu),b.setupPluginUi(c0),b.setupPluginUi(fu),b.setupPluginUi(_A),b.setupPluginUi(k_),b.setupPluginUi(S1),b.setupPluginUi(u0),b.setupPluginUi(VI),b.setupPluginUi(hm),b.setupPluginUi(ES),b.setupPluginUi(iy),b.setupPluginUi(pS),h.enabled=!0,h}async function yH(h,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:o=!1,importPopup:c=!0,caching:g=!0}){const b=new iv(h);return await h4(b,{debug:e,ground:i,bloom:s,depthTonemap:o,importPopup:c,caching:g}),b}async function AH(h,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:o=!0,importPopup:c=!1,enableDrop:g=!1,caching:b=!0}={}){const et=new iv(h);return e&&await et.addPlugin($0),et.getPlugin(Lr)||et.addPluginSync(Lr,void 0,void 0,{storage:b&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await et.addPlugin(sI,!0),await UP(et,{ground:i,bloom:s,depthTonemap:o,enableDrop:g,importPopup:c}),et}})();__webpackgi_exports__.MWW;__webpackgi_exports__.LY2;__webpackgi_exports__.GYo;__webpackgi_exports__.GPz;__webpackgi_exports__.HRj;__webpackgi_exports__.li4;__webpackgi_exports__.FO5;__webpackgi_exports__.Nlh;__webpackgi_exports__.Mp4;__webpackgi_exports__.QvI;__webpackgi_exports__.PrA;__webpackgi_exports__.JHp;__webpackgi_exports__.bGH;__webpackgi_exports__.NDo;__webpackgi_exports__.gSk;__webpackgi_exports__.WMw;__webpackgi_exports__.OTo;__webpackgi_exports__.Se2;__webpackgi_exports__.cum;__webpackgi_exports__.Mig;__webpackgi_exports__.B$7;__webpackgi_exports__.i_9;__webpackgi_exports__.bBp;__webpackgi_exports__.m7l;__webpackgi_exports__.sYA;__webpackgi_exports__.Xcj;__webpackgi_exports__.mzJ;__webpackgi_exports__.ZZA;__webpackgi_exports__.$Ph;__webpackgi_exports__.T__;__webpackgi_exports__.HkE;__webpackgi_exports__.tGC;__webpackgi_exports__.g1S;__webpackgi_exports__.I$C;__webpackgi_exports__.QIH;__webpackgi_exports__._JE;__webpackgi_exports__.SwW;__webpackgi_exports__.ksm;__webpackgi_exports__.jl_;__webpackgi_exports__.b7R;__webpackgi_exports__.BDV;__webpackgi_exports__.Ea_;__webpackgi_exports__.qff;__webpackgi_exports__.tmC;__webpackgi_exports__.BON;__webpackgi_exports__.P40;__webpackgi_exports__.wLL;__webpackgi_exports__.iHO;__webpackgi_exports__.BbS;__webpackgi_exports__.kqm;__webpackgi_exports__.Hmr;__webpackgi_exports__.SJI;__webpackgi_exports__.mTL;__webpackgi_exports__.y8_;__webpackgi_exports__._Li;__webpackgi_exports__.w7U;__webpackgi_exports__.g56;__webpackgi_exports__.bj3;__webpackgi_exports__.z81;__webpackgi_exports__._MY;__webpackgi_exports__.yEv;__webpackgi_exports__.dFZ;__webpackgi_exports__.N$j;__webpackgi_exports__._YM;__webpackgi_exports__.TUj;__webpackgi_exports__.ZzF;__webpackgi_exports__.qzb;__webpackgi_exports__.GQ;__webpackgi_exports__.nvb;__webpackgi_exports__.DvJ;__webpackgi_exports__.fQA;__webpackgi_exports__.cPz;__webpackgi_exports__.TlE;__webpackgi_exports__.u9r;__webpackgi_exports__.s4_;__webpackgi_exports__.T95;__webpackgi_exports__.F5w;__webpackgi_exports__.NlP;__webpackgi_exports__.$8Z;__webpackgi_exports__.YYN;__webpackgi_exports__.CtF;__webpackgi_exports__.V1s;__webpackgi_exports__.jOv;__webpackgi_exports__.Rki;__webpackgi_exports__.pzV;__webpackgi_exports__.itZ;__webpackgi_exports__.MMq;__webpackgi_exports__.qKx;__webpackgi_exports__.Hmi;__webpackgi_exports__.X4S;__webpackgi_exports__.vlJ;__webpackgi_exports__.nPO;__webpackgi_exports__.zcQ;var __webpackgi_exports__CanvasSnipperPlugin=__webpackgi_exports__.GH1;__webpackgi_exports__.ROQ;__webpackgi_exports__.YN5;__webpackgi_exports__.BVQ;__webpackgi_exports__.YT8;__webpackgi_exports__._DE;__webpackgi_exports__.YGz;__webpackgi_exports__.trn;__webpackgi_exports__.zf8;__webpackgi_exports__.uWy;__webpackgi_exports__.wYQ;__webpackgi_exports__.SUY;__webpackgi_exports__.Ilk;__webpackgi_exports__.R2R;__webpackgi_exports__.epp;__webpackgi_exports__.xmJ;__webpackgi_exports__.GD$;__webpackgi_exports__.Z_g;__webpackgi_exports__.EB7;__webpackgi_exports__.DqL;__webpackgi_exports__._3;__webpackgi_exports__.b_z;__webpackgi_exports__.OCn;__webpackgi_exports__.N_j;__webpackgi_exports__.hNv;__webpackgi_exports__._am;__webpackgi_exports__.kB7;__webpackgi_exports__.fY$;__webpackgi_exports__.vxC;__webpackgi_exports__.BtG;__webpackgi_exports__.cBK;__webpackgi_exports__.g8_;__webpackgi_exports__.AXT;__webpackgi_exports__.yj7;__webpackgi_exports__.dYG;__webpackgi_exports__.tm_;__webpackgi_exports__.S2y;__webpackgi_exports__.B02;__webpackgi_exports__.PeU;__webpackgi_exports__.Hyl;__webpackgi_exports__.Wqd;__webpackgi_exports__.c0Q;__webpackgi_exports__.re0;__webpackgi_exports__.Xaj;__webpackgi_exports__.DUb;__webpackgi_exports__.dZ3;__webpackgi_exports__.m_w;__webpackgi_exports__.fHI;__webpackgi_exports__.LBq;__webpackgi_exports__.Qww;__webpackgi_exports__.CGV;__webpackgi_exports__.JUT;__webpackgi_exports__.p3g;__webpackgi_exports__.IEO;__webpackgi_exports__.yxD;__webpackgi_exports__.CUS;__webpackgi_exports__.A5E;__webpackgi_exports__.zqG;__webpackgi_exports__.PfX;__webpackgi_exports__.Q1o;__webpackgi_exports__.jfJ;__webpackgi_exports__.T_J;__webpackgi_exports__.tEQ;__webpackgi_exports__.gb4;__webpackgi_exports__.qkB;__webpackgi_exports__.cvk;__webpackgi_exports__.HWo;__webpackgi_exports__.brP;__webpackgi_exports__.$YQ;__webpackgi_exports__.X8d;__webpackgi_exports__.Zdt;__webpackgi_exports__.yNB;__webpackgi_exports__.h7x;__webpackgi_exports__.Ox3;__webpackgi_exports__.qtn;__webpackgi_exports__.cBI;__webpackgi_exports__.cU9;__webpackgi_exports__.ntt;__webpackgi_exports__.DT1;__webpackgi_exports__.Kgo;__webpackgi_exports__.ehD;__webpackgi_exports__.fhJ;__webpackgi_exports__.y1s;__webpackgi_exports__.fSK;__webpackgi_exports__.Vdb;__webpackgi_exports__.l8J;__webpackgi_exports__.dj0;__webpackgi_exports__.QM0;__webpackgi_exports__.n94;__webpackgi_exports__.OIS;__webpackgi_exports__.q8b;__webpackgi_exports__.TOt;__webpackgi_exports__.xaN;__webpackgi_exports__.Ny0;__webpackgi_exports__.NeD;__webpackgi_exports__.Zof;__webpackgi_exports__.N1Y;__webpackgi_exports__.itK;__webpackgi_exports__.eD;__webpackgi_exports__.jwo;__webpackgi_exports__.dSO;__webpackgi_exports__.Bf4;__webpackgi_exports__.USm;__webpackgi_exports__.pBf;__webpackgi_exports__.eBg;__webpackgi_exports__.$Vf;__webpackgi_exports__.O7d;__webpackgi_exports__.ksq;__webpackgi_exports__.hFL;__webpackgi_exports__.gXf;__webpackgi_exports__.hH6;__webpackgi_exports__.izP;__webpackgi_exports__.kpi;__webpackgi_exports__.DwZ;__webpackgi_exports__.kN3;__webpackgi_exports__.e62;__webpackgi_exports__.a$l;__webpackgi_exports__.OM3;__webpackgi_exports__.VzW;__webpackgi_exports__.ybr;__webpackgi_exports__.yo9;__webpackgi_exports__.Dzq;__webpackgi_exports__.zCA;__webpackgi_exports__.$Bt;__webpackgi_exports__.Wzm;__webpackgi_exports__.Wl3;__webpackgi_exports__.iWj;__webpackgi_exports__.DNz;__webpackgi_exports__.m1M;__webpackgi_exports__.ylh;__webpackgi_exports__.v9Y;__webpackgi_exports__.LSk;__webpackgi_exports__.LHE;__webpackgi_exports__.KE0;__webpackgi_exports__.KCF;__webpackgi_exports__.a4n;__webpackgi_exports__.NKC;__webpackgi_exports__.jrv;__webpackgi_exports__.zIH;__webpackgi_exports__.Hfk;__webpackgi_exports__.png;__webpackgi_exports__.tAj;__webpackgi_exports__.Eb_;__webpackgi_exports__.SJj;__webpackgi_exports__.cF0;__webpackgi_exports__.BT2;__webpackgi_exports__._8p;__webpackgi_exports__.V5Z;__webpackgi_exports__.s5b;__webpackgi_exports__.BHZ;__webpackgi_exports__.hkn;__webpackgi_exports__.GFY;__webpackgi_exports__.w$m;__webpackgi_exports__.ksN;__webpackgi_exports__.j4z;__webpackgi_exports__.OAl;__webpackgi_exports__.VLJ;__webpackgi_exports__.C73;__webpackgi_exports__.ZAu;__webpackgi_exports__.ibP;__webpackgi_exports__.lth;__webpackgi_exports__._fI;__webpackgi_exports__.hUN;__webpackgi_exports__.cLu;__webpackgi_exports__.vmT;__webpackgi_exports__.Qpg;__webpackgi_exports__.So8;__webpackgi_exports__.eOv;__webpackgi_exports__.Wjw;__webpackgi_exports__.cJO;__webpackgi_exports__.QRU;__webpackgi_exports__.S3k;__webpackgi_exports__.OPJ;__webpackgi_exports__.PpQ;__webpackgi_exports__.q_9;__webpackgi_exports__.ZRs;__webpackgi_exports__.oqc;__webpackgi_exports__.T_x;__webpackgi_exports__.lb7;__webpackgi_exports__.L5s;__webpackgi_exports__.$TI;__webpackgi_exports__.SPe;__webpackgi_exports__.aVm;__webpackgi_exports__.j87;__webpackgi_exports__.RNb;__webpackgi_exports__.Kz5;__webpackgi_exports__.vpT;__webpackgi_exports__.kB5;__webpackgi_exports__._C8;__webpackgi_exports__.Syv;__webpackgi_exports__.NMF;__webpackgi_exports__.pIN;__webpackgi_exports__.eMJ;__webpackgi_exports__.rN7;__webpackgi_exports__.iUp;__webpackgi_exports__.GFd;__webpackgi_exports__.x5V;__webpackgi_exports__.tUh;__webpackgi_exports__.z8B;__webpackgi_exports__.vcl;__webpackgi_exports__.GZb;__webpackgi_exports__.p7y;__webpackgi_exports__.S9g;__webpackgi_exports__.Zr5;__webpackgi_exports__.vCF;__webpackgi_exports__.yt0;__webpackgi_exports__.uXU;__webpackgi_exports__._kC;__webpackgi_exports__.lk7;__webpackgi_exports__.USc;__webpackgi_exports__.x12;__webpackgi_exports__.w_R;__webpackgi_exports__.Zzh;__webpackgi_exports__.nls;__webpackgi_exports__.g_z;__webpackgi_exports__.U7;__webpackgi_exports__.FT0;__webpackgi_exports__.L1_;__webpackgi_exports__.blk;__webpackgi_exports__.YRm;__webpackgi_exports__.ejS;__webpackgi_exports__.wUb;__webpackgi_exports__.zOz;__webpackgi_exports__.rnI;__webpackgi_exports__.wem;__webpackgi_exports__.lfu;__webpackgi_exports__.FDw;__webpackgi_exports__.lRj;__webpackgi_exports__.D1R;__webpackgi_exports__.qyh;__webpackgi_exports__.GUF;__webpackgi_exports__.EoG;__webpackgi_exports__.aNw;__webpackgi_exports__.Zp0;__webpackgi_exports__.lLk;__webpackgi_exports__.NHT;__webpackgi_exports__.jAl;__webpackgi_exports__.uEv;__webpackgi_exports__.YKA;__webpackgi_exports__.cRx;__webpackgi_exports__.Y8D;__webpackgi_exports__.RsA;__webpackgi_exports__.Y0m;__webpackgi_exports__.F5T;__webpackgi_exports__.EDU;__webpackgi_exports__.z$Q;__webpackgi_exports__.KA8;__webpackgi_exports__.ZqF;__webpackgi_exports__.XUj;__webpackgi_exports__.Me$;__webpackgi_exports__.u7G;__webpackgi_exports__.PEk;__webpackgi_exports__.BG4;__webpackgi_exports__.M8C;__webpackgi_exports__.Vkp;__webpackgi_exports__.yGw;__webpackgi_exports__.Sm8;__webpackgi_exports__.Kj0;__webpackgi_exports__.vBJ;__webpackgi_exports__.QfV;__webpackgi_exports__.lRF;__webpackgi_exports__.Lun;__webpackgi_exports__.YBo;__webpackgi_exports__.kaV;__webpackgi_exports__.RSm;__webpackgi_exports__.xoR;__webpackgi_exports__.EJi;__webpackgi_exports__.Wid;__webpackgi_exports__.iuj;__webpackgi_exports__.IKL;__webpackgi_exports__.r_;__webpackgi_exports__.OoA;__webpackgi_exports__.qhX;__webpackgi_exports__.CRe;__webpackgi_exports__.qPT;__webpackgi_exports__.M5h;__webpackgi_exports__.Ns1;__webpackgi_exports__.TyD;__webpackgi_exports__.vZf;__webpackgi_exports__.HTd;__webpackgi_exports__.aH4;__webpackgi_exports__.YLQ;__webpackgi_exports__.BVF;__webpackgi_exports__.MyG;__webpackgi_exports__.jFi;__webpackgi_exports__.aCh;__webpackgi_exports__.uL9;__webpackgi_exports__.TNj;__webpackgi_exports__.IFH;__webpackgi_exports__.bdR;__webpackgi_exports__.RPs;__webpackgi_exports__.kM_;__webpackgi_exports__.M6v;__webpackgi_exports__.RvT;__webpackgi_exports__.dUE;__webpackgi_exports__.oe_;__webpackgi_exports__.BuN;__webpackgi_exports__.Tme;__webpackgi_exports__.N9P;__webpackgi_exports__.tfP;__webpackgi_exports__.Gql;__webpackgi_exports__.$XY;__webpackgi_exports__.O9d;__webpackgi_exports__.zEO;__webpackgi_exports__.qfx;__webpackgi_exports__.PA7;__webpackgi_exports__.REq;__webpackgi_exports__.pQR;__webpackgi_exports__.ghN;__webpackgi_exports__.Hy8;__webpackgi_exports__.Wpd;__webpackgi_exports__.LgZ;__webpackgi_exports__.iWC;__webpackgi_exports__.mqn;__webpackgi_exports__.SKe;__webpackgi_exports__.iKG;__webpackgi_exports__.rCq;__webpackgi_exports__._iA;__webpackgi_exports__.ntZ;__webpackgi_exports__.anP;__webpackgi_exports__.X2e;__webpackgi_exports__.oxT;__webpackgi_exports__.FCo;__webpackgi_exports__.y$t;__webpackgi_exports__.cPb;__webpackgi_exports__.lmx;__webpackgi_exports__.JOQ;__webpackgi_exports__.BKK;__webpackgi_exports__._12;__webpackgi_exports__.tJx;__webpackgi_exports__.mjX;__webpackgi_exports__.cek;__webpackgi_exports__.qD0;__webpackgi_exports__.xG9;__webpackgi_exports__.eqi;__webpackgi_exports__.wI8;__webpackgi_exports__.Sgv;__webpackgi_exports__.woe;__webpackgi_exports__.UY4;__webpackgi_exports__.aq0;__webpackgi_exports__.ujx;__webpackgi_exports__.Uol;__webpackgi_exports__.JiH;__webpackgi_exports__.VYz;__webpackgi_exports__.B2H;__webpackgi_exports__._Pm;__webpackgi_exports__.EsW;__webpackgi_exports__.iUV;__webpackgi_exports__.tf;__webpackgi_exports__.ZQ6;__webpackgi_exports__.mXe;__webpackgi_exports__._fP;__webpackgi_exports__.iLg;__webpackgi_exports__.zbs;__webpackgi_exports__.ZTh;__webpackgi_exports__.HdW;__webpackgi_exports__.UZH;__webpackgi_exports__.mSO;__webpackgi_exports__.wk1;__webpackgi_exports__.E2K;__webpackgi_exports__.FUD;__webpackgi_exports__.pKu;__webpackgi_exports__.GG6;__webpackgi_exports__.Gih;__webpackgi_exports__.iiP;__webpackgi_exports__.SvJ;__webpackgi_exports__.ptH;__webpackgi_exports__.jZA;__webpackgi_exports__.y2t;__webpackgi_exports__.gi4;__webpackgi_exports__.Djp;__webpackgi_exports__.BG$;__webpackgi_exports__.NYV;__webpackgi_exports__.xJs;__webpackgi_exports__.bsb;__webpackgi_exports__.ekQ;__webpackgi_exports__.CaW;__webpackgi_exports__.eaV;__webpackgi_exports__.BFQ;__webpackgi_exports__.v3W;__webpackgi_exports__.ILR;__webpackgi_exports__.G_r;__webpackgi_exports__.N3F;__webpackgi_exports__.fto;__webpackgi_exports__.l0P;__webpackgi_exports__.vCx;__webpackgi_exports__._AM;__webpackgi_exports__.wuA;__webpackgi_exports__.av9;__webpackgi_exports__.CtA;__webpackgi_exports__.BvQ;__webpackgi_exports__.FZJ;__webpackgi_exports__.FIo;__webpackgi_exports__.zHn;__webpackgi_exports__.iMs;__webpackgi_exports__.T_f;__webpackgi_exports__.hEm;__webpackgi_exports__.D9w;__webpackgi_exports__.sHH;__webpackgi_exports__.CdI;__webpackgi_exports__.rkc;__webpackgi_exports__.rpg;__webpackgi_exports__.ce8;__webpackgi_exports__.rOj;__webpackgi_exports__.P6m;__webpackgi_exports__.JA6;__webpackgi_exports__.V4E;__webpackgi_exports__.o8S;__webpackgi_exports__.flB;__webpackgi_exports__.lGU;__webpackgi_exports__.vuL;__webpackgi_exports__.KI_;__webpackgi_exports__.iLN;__webpackgi_exports__.X6w;__webpackgi_exports__.rz_;__webpackgi_exports__.jsw;__webpackgi_exports__.srG;__webpackgi_exports__.i6Z;__webpackgi_exports__.vfv;__webpackgi_exports__.xsS;__webpackgi_exports__.or;__webpackgi_exports__.EQj;__webpackgi_exports__.Rnn;__webpackgi_exports__.TyN;__webpackgi_exports__.ov0;__webpackgi_exports__.WdD;__webpackgi_exports__.Vj0;__webpackgi_exports__.jyz;__webpackgi_exports__.mTM;__webpackgi_exports__.Mn1;__webpackgi_exports__.Hlq;__webpackgi_exports__.Fi7;__webpackgi_exports__.Tn7;__webpackgi_exports__.bnF;__webpackgi_exports__.HW6;__webpackgi_exports__.oa8;__webpackgi_exports__.T_1;__webpackgi_exports__.zHJ;__webpackgi_exports__.iDF;__webpackgi_exports__.iAb;__webpackgi_exports__.d4E;__webpackgi_exports__.lBg;__webpackgi_exports__.JeJ;__webpackgi_exports__.FKY;__webpackgi_exports__.zlZ;__webpackgi_exports__.vkg;__webpackgi_exports__.brh;__webpackgi_exports__.kZK;__webpackgi_exports__.puG;__webpackgi_exports__.OdW;__webpackgi_exports__._YX;__webpackgi_exports__.TUv;__webpackgi_exports__.Hw6;__webpackgi_exports__.aLr;__webpackgi_exports__.Aip;__webpackgi_exports__.xo$;__webpackgi_exports__.bIn;__webpackgi_exports__.$V;__webpackgi_exports__.lDi;__webpackgi_exports__.gti;__webpackgi_exports__.PMe;__webpackgi_exports__.iwP;__webpackgi_exports__.FvO;__webpackgi_exports__.jyi;__webpackgi_exports__.xeV;__webpackgi_exports__.k74;__webpackgi_exports__.RlZ;__webpackgi_exports__.KhW;__webpackgi_exports__.HgB;__webpackgi_exports__.W2J;__webpackgi_exports__.JWc;__webpackgi_exports__.u37;__webpackgi_exports__.Z6B;__webpackgi_exports__.QZ1;__webpackgi_exports__.Ir4;__webpackgi_exports__.NwF;__webpackgi_exports__.Wbm;__webpackgi_exports__.N4l;__webpackgi_exports__.Jxm;__webpackgi_exports__.ej9;__webpackgi_exports__.QmN;__webpackgi_exports__.Y4W;__webpackgi_exports__.IOt;__webpackgi_exports__.NOD;__webpackgi_exports__.L5g;__webpackgi_exports__.H$k;__webpackgi_exports__.cuP;__webpackgi_exports__.xEZ;__webpackgi_exports__.dpR;__webpackgi_exports__.wOD;__webpackgi_exports__.KNb;var __webpackgi_exports__TonemapPlugin=__webpackgi_exports__.IiN;__webpackgi_exports__.Cne;__webpackgi_exports__.XvJ;__webpackgi_exports__.XZw;__webpackgi_exports__.FE5;__webpackgi_exports__.Mck;__webpackgi_exports__.lVp;__webpackgi_exports__.CJI;__webpackgi_exports__.z$h;__webpackgi_exports__.UlW;__webpackgi_exports__.WwZ;__webpackgi_exports__.zG7;__webpackgi_exports__.Lcc;__webpackgi_exports__.WXh;__webpackgi_exports__.Vjr;__webpackgi_exports__.LuM;__webpackgi_exports__.LP5;__webpackgi_exports__.ub3;__webpackgi_exports__.OV;__webpackgi_exports__.G_n;__webpackgi_exports__.xfE;__webpackgi_exports__.qlB;__webpackgi_exports__.lCJ;__webpackgi_exports__.WTc;__webpackgi_exports__.rAo;__webpackgi_exports__.LZj;__webpackgi_exports__.xWb;__webpackgi_exports__.gH0;__webpackgi_exports__.rBU;__webpackgi_exports__.rDY;__webpackgi_exports__.ywz;__webpackgi_exports__.wJv;__webpackgi_exports__.JQ4;__webpackgi_exports__.k0A;__webpackgi_exports__.irR;__webpackgi_exports__.LsT;__webpackgi_exports__.q5h;__webpackgi_exports__.TKh;__webpackgi_exports__.tyg;__webpackgi_exports__.Ro5;__webpackgi_exports__.dwk;__webpackgi_exports__.t0w;__webpackgi_exports__.M7$;__webpackgi_exports__.ML4;__webpackgi_exports__.FM8;__webpackgi_exports__.Pa4;__webpackgi_exports__.Ltg;__webpackgi_exports__.yC1;__webpackgi_exports__.lHq;__webpackgi_exports__.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA;__webpackgi_exports__.JzW;__webpackgi_exports__.QEt;__webpackgi_exports__.IFZ;__webpackgi_exports__.b5g;__webpackgi_exports__.Ywn;__webpackgi_exports__.GVz;__webpackgi_exports__.oAp;__webpackgi_exports__.kFz;__webpackgi_exports__.dd2;__webpackgi_exports__.CP7;__webpackgi_exports__.fQK;__webpackgi_exports__.Wd$;__webpackgi_exports__.t1_;__webpackgi_exports__.v27;__webpackgi_exports__.Uk6;__webpackgi_exports__.H7Z;__webpackgi_exports__._sL;__webpackgi_exports__.czO;__webpackgi_exports__.Pnf;__webpackgi_exports__.c8b;__webpackgi_exports__._lf;__webpackgi_exports__.ad5;__webpackgi_exports__.sZV;__webpackgi_exports__.TfA;__webpackgi_exports__.sKX;__webpackgi_exports__.UdM;__webpackgi_exports__.P0y;__webpackgi_exports__.L_r;__webpackgi_exports__.zC5;var __webpackgi_exports__addBasePlugins=__webpackgi_exports__.Bve;__webpackgi_exports__.b5G;__webpackgi_exports__.UeO;__webpackgi_exports__.qCx;__webpackgi_exports__.$nx;__webpackgi_exports__.Bk6;__webpackgi_exports__.EER;__webpackgi_exports__.y4l;__webpackgi_exports__.P39;__webpackgi_exports__.HI1;__webpackgi_exports__.ZYi;__webpackgi_exports__.wXW;__webpackgi_exports__.r5x;__webpackgi_exports__.MSI;__webpackgi_exports__.EUu;__webpackgi_exports__.jtH;__webpackgi_exports__.T0T;__webpackgi_exports__.gAb;__webpackgi_exports__.je_;__webpackgi_exports__.wBP;__webpackgi_exports__.LU2;__webpackgi_exports__.wQL;__webpackgi_exports__.Zs7;__webpackgi_exports__.sMc;__webpackgi_exports__.x7s;__webpackgi_exports__.Mnd;__webpackgi_exports__.A0_;__webpackgi_exports__.d73;__webpackgi_exports__.HCD;__webpackgi_exports__.YQ8;__webpackgi_exports__.RG9;__webpackgi_exports__.G2P;__webpackgi_exports__.XLf;__webpackgi_exports__.CGN;__webpackgi_exports__.RGi;__webpackgi_exports__.mvg;__webpackgi_exports__.Hiy;__webpackgi_exports__.XMc;__webpackgi_exports__.N7M;__webpackgi_exports__.iv;__webpackgi_exports__.n55;__webpackgi_exports__.IaC;__webpackgi_exports__.h9t;__webpackgi_exports__.yDW;__webpackgi_exports__.gJv;__webpackgi_exports__.l$g;__webpackgi_exports__.vQi;__webpackgi_exports__.$MY;__webpackgi_exports__.wJl;__webpackgi_exports__.Z7Y;__webpackgi_exports__.X7D;__webpackgi_exports__.BnX;__webpackgi_exports__.uZ5;__webpackgi_exports__.zVI;__webpackgi_exports__.Wz1;__webpackgi_exports__.DpF;__webpackgi_exports__.nNb;__webpackgi_exports__.cqZ;__webpackgi_exports__.pKN;__webpackgi_exports__.CN8;__webpackgi_exports__.DdI;__webpackgi_exports__.rrX;__webpackgi_exports__.uqj;__webpackgi_exports__.Z9P;__webpackgi_exports__.KlC;__webpackgi_exports__.KVn;__webpackgi_exports__.oau;__webpackgi_exports__.aw9;__webpackgi_exports__.Aap;__webpackgi_exports__.Dxg;__webpackgi_exports__.MjT;__webpackgi_exports__.F7Q;__webpackgi_exports__.IFq;__webpackgi_exports__.IJl;__webpackgi_exports__.O5A;__webpackgi_exports__.wCn;__webpackgi_exports__.gGT;__webpackgi_exports__.pEc;__webpackgi_exports__.Bi6;__webpackgi_exports__.fi_;__webpackgi_exports__.TT;__webpackgi_exports__.q2Z;__webpackgi_exports__.NyK;__webpackgi_exports__.bgu;__webpackgi_exports__.kcS;__webpackgi_exports__.rRN;__webpackgi_exports__.ivY;__webpackgi_exports__._s1;__webpackgi_exports__._HO;__webpackgi_exports__.tpL;__webpackgi_exports__.DMK;__webpackgi_exports__.LjN;__webpackgi_exports__.iFs;__webpackgi_exports__.qTg;__webpackgi_exports__.J4G;__webpackgi_exports__.Zj8;__webpackgi_exports__.Wtl;__webpackgi_exports__.DmK;__webpackgi_exports__.Htt;__webpackgi_exports__.Nv0;__webpackgi_exports__.tCp;__webpackgi_exports__.Hx7;__webpackgi_exports__.imt;__webpackgi_exports__.US6;__webpackgi_exports__.vZs;__webpackgi_exports__.TE$;__webpackgi_exports__.lmu;__webpackgi_exports__.SvO;__webpackgi_exports__.YQY;__webpackgi_exports__.mZN;__webpackgi_exports__.VvG;__webpackgi_exports__.omp;__webpackgi_exports__.utz;__webpackgi_exports__.TFV;__webpackgi_exports__.hrz;__webpackgi_exports__.H$s;__webpackgi_exports__.JKM;__webpackgi_exports__.jZf;__webpackgi_exports__.RjL;__webpackgi_exports__.RRI;__webpackgi_exports__.RUq;__webpackgi_exports__._t4;__webpackgi_exports__.YHh;__webpackgi_exports__.R8g;__webpackgi_exports__.f1L;__webpackgi_exports__.Bbl;__webpackgi_exports__.V9r;__webpackgi_exports__.a95;__webpackgi_exports__.PZ2;__webpackgi_exports__.w7A;__webpackgi_exports__.N6S;__webpackgi_exports__.Uxp;__webpackgi_exports__.tAz;__webpackgi_exports__.R$F;__webpackgi_exports__.N33;__webpackgi_exports__.JFD;__webpackgi_exports__.gw2;__webpackgi_exports__.rfc;__webpackgi_exports__.wo6;__webpackgi_exports__.V4T;__webpackgi_exports__.H4P;__webpackgi_exports__.NLp;__webpackgi_exports__.swA;__webpackgi_exports__._Z3;__webpackgi_exports__.ivc;__webpackgi_exports__.rZ1;__webpackgi_exports__.CpZ;__webpackgi_exports__.dyc;__webpackgi_exports__.MxZ;__webpackgi_exports__.btp;__webpackgi_exports__.mXy;__webpackgi_exports__.Ej0;__webpackgi_exports__.ep4;__webpackgi_exports__.DQP;__webpackgi_exports__.VNr;__webpackgi_exports__.V7q;__webpackgi_exports__.hiB;__webpackgi_exports__.zEk;__webpackgi_exports__.qfq;__webpackgi_exports__.piB;__webpackgi_exports__.IIc;__webpackgi_exports__.rrF;__webpackgi_exports__.naq;__webpackgi_exports__.zlD;__webpackgi_exports__.sXR;__webpackgi_exports__.p5I;__webpackgi_exports__.wps;__webpackgi_exports__.wuo;__webpackgi_exports__.GpE;__webpackgi_exports__.F4b;__webpackgi_exports__.NN$;__webpackgi_exports__.t$v;__webpackgi_exports__.tdn;__webpackgi_exports__.Y9t;__webpackgi_exports__.GEo;__webpackgi_exports__.GGm;__webpackgi_exports__.DH3;__webpackgi_exports__.uxM;__webpackgi_exports__.zH3;__webpackgi_exports__.MLs;__webpackgi_exports__.xXG;__webpackgi_exports__.YM4;__webpackgi_exports__.B3r;__webpackgi_exports__.iAx;__webpackgi_exports__.lDn;__webpackgi_exports__.P1O;__webpackgi_exports__.iib;__webpackgi_exports__.qf5;__webpackgi_exports__.n4s;__webpackgi_exports__.fr;__webpackgi_exports__.Z9s;__webpackgi_exports__.oaQ;__webpackgi_exports__.CD7;__webpackgi_exports__.Rc0;__webpackgi_exports__.iPG;__webpackgi_exports__.TIc;__webpackgi_exports__.xsC;__webpackgi_exports__.zOc;__webpackgi_exports__.i8W;__webpackgi_exports__.r46;__webpackgi_exports__.z2C;__webpackgi_exports__.N4A;__webpackgi_exports__.hjq;__webpackgi_exports__._X$;__webpackgi_exports__._yn;__webpackgi_exports__.Dyg;__webpackgi_exports__.cUc;__webpackgi_exports__.zGw;__webpackgi_exports__.Ctq;__webpackgi_exports__.$ch;__webpackgi_exports__.k5b;__webpackgi_exports__.kZl;__webpackgi_exports__.OCg;__webpackgi_exports__.Kd3;__webpackgi_exports__.YjH;__webpackgi_exports__.Ui8;__webpackgi_exports__.YD2;__webpackgi_exports__.vi9;__webpackgi_exports__.ij3;__webpackgi_exports__.pJq;__webpackgi_exports__.YPW;__webpackgi_exports__._tY;__webpackgi_exports__.Bg1;__webpackgi_exports__.kon;__webpackgi_exports__.M3g;__webpackgi_exports__.F2z;__webpackgi_exports__.pJF;__webpackgi_exports__.knz;__webpackgi_exports__.Ejo;__webpackgi_exports__.BgY;__webpackgi_exports__.qCG;__webpackgi_exports__.HD9;__webpackgi_exports__.Rgz;__webpackgi_exports__.fEB;__webpackgi_exports__.Udc;__webpackgi_exports__.ZQg;__webpackgi_exports__.ofC;__webpackgi_exports__.yRy;__webpackgi_exports__._NL;__webpackgi_exports__.LCA;__webpackgi_exports__.Sy1;__webpackgi_exports__.Vs_;__webpackgi_exports__.j1w;__webpackgi_exports__.i8J;__webpackgi_exports__.p7C;__webpackgi_exports__.ZAS;__webpackgi_exports__.ipH;__webpackgi_exports__.$TF;__webpackgi_exports__.uZI;__webpackgi_exports__.VWG;__webpackgi_exports__.pQ7;__webpackgi_exports__.STw;__webpackgi_exports__.jc8;__webpackgi_exports__.BL_;__webpackgi_exports__.S6;__webpackgi_exports__.T8U;__webpackgi_exports__.TD6;__webpackgi_exports__.akS;__webpackgi_exports__.QKE;__webpackgi_exports__.dKx;__webpackgi_exports__.OvX;__webpackgi_exports__.doP;__webpackgi_exports__.$jA;__webpackgi_exports__.T99;__webpackgi_exports__.LJS;__webpackgi_exports__.VsW;__webpackgi_exports__.LZE;__webpackgi_exports__.YMc;__webpackgi_exports__.aPg;__webpackgi_exports__.LFn;__webpackgi_exports__.VsX;__webpackgi_exports__.wey;__webpackgi_exports__.MaE;__webpackgi_exports__.s4x;__webpackgi_exports__.FJA;__webpackgi_exports__.vIA;__webpackgi_exports__.Spv;__webpackgi_exports__.w8l;__webpackgi_exports__.riG;__webpackgi_exports__.Kbh;__webpackgi_exports__.BFq;__webpackgi_exports__.t8K;__webpackgi_exports__.Q7n;__webpackgi_exports__.KGF;__webpackgi_exports__.e5;__webpackgi_exports__.Rik;__webpackgi_exports__.GZo;__webpackgi_exports__.Bds;__webpackgi_exports__.HTu;__webpackgi_exports__.cTq;__webpackgi_exports__.X_Y;__webpackgi_exports__.dA8;__webpackgi_exports__.NSm;__webpackgi_exports__.bwS;__webpackgi_exports__.Lks;__webpackgi_exports__.Rvq;__webpackgi_exports__.P4F;__webpackgi_exports__.Pd0;__webpackgi_exports__.Pjo;__webpackgi_exports__.Tum;__webpackgi_exports__.dRH;__webpackgi_exports__.RX0;__webpackgi_exports__.reQ;__webpackgi_exports__.cWm;__webpackgi_exports__.NC9;__webpackgi_exports__.$Re;__webpackgi_exports__.Xo9;__webpackgi_exports__.LNO;__webpackgi_exports__.iZP;function WebGiViewer(){const $=reactExports.useRef(null),_e=reactExports.useCallback(async()=>{const _=new __webpackgi_exports__ViewerApp({canvas:$.current});await __webpackgi_exports__addBasePlugins(_),await _.addPlugin(__webpackgi_exports__CanvasSnipperPlugin),await _.load("/assets/robots.glb"),_.getPlugin(__webpackgi_exports__TonemapPlugin).config.clipBackground=!0},[]);return reactExports.useEffect(()=>{_e()},[]),jsxRuntimeExports.jsx("div",{id:"webgi-canvas-container",children:jsxRuntimeExports.jsx("canvas",{id:"webgi-canvas",ref:$})})}function App(){return reactExports.useState(0),jsxRuntimeExports.jsxs("div",{className:"App",children:[jsxRuntimeExports.jsx(Nav,{}),jsxRuntimeExports.jsx(WebGiViewer,{})]})}client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));

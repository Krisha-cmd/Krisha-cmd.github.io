(function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const ot of document.querySelectorAll('link[rel="modulepreload"]'))tt(ot);new MutationObserver(ot=>{for(const ut of ot)if(ut.type==="childList")for(const gt of ut.addedNodes)gt.tagName==="LINK"&&gt.rel==="modulepreload"&&tt(gt)}).observe(document,{childList:!0,subtree:!0});function g(ot){const ut={};return ot.integrity&&(ut.integrity=ot.integrity),ot.referrerPolicy&&(ut.referrerPolicy=ot.referrerPolicy),ot.crossOrigin==="use-credentials"?ut.credentials="include":ot.crossOrigin==="anonymous"?ut.credentials="omit":ut.credentials="same-origin",ut}function tt(ot){if(ot.ep)return;ot.ep=!0;const ut=g(ot);fetch(ot.href,ut)}})();function getDefaultExportFromCjs($){return $&&$.__esModule&&Object.prototype.hasOwnProperty.call($,"default")?$.default:$}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w$1=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1($){return $===null||typeof $!="object"?null:($=z$1&&$[z$1]||$["@@iterator"],typeof $=="function"?$:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1($,b,g){this.props=$,this.context=b,this.refs=D$1,this.updater=g||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function($,b){if(typeof $!="object"&&typeof $!="function"&&$!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,$,b,"setState")};E$1.prototype.forceUpdate=function($){this.updater.enqueueForceUpdate(this,$,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1($,b,g){this.props=$,this.context=b,this.refs=D$1,this.updater=g||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1($,b,g){var tt,ot={},ut=null,gt=null;if(b!=null)for(tt in b.ref!==void 0&&(gt=b.ref),b.key!==void 0&&(ut=""+b.key),b)J.call(b,tt)&&!L$1.hasOwnProperty(tt)&&(ot[tt]=b[tt]);var xt=arguments.length-2;if(xt===1)ot.children=g;else if(1<xt){for(var It=Array(xt),kt=0;kt<xt;kt++)It[kt]=arguments[kt+2];ot.children=It}if($&&$.defaultProps)for(tt in xt=$.defaultProps,xt)ot[tt]===void 0&&(ot[tt]=xt[tt]);return{$$typeof:l$1,type:$,key:ut,ref:gt,props:ot,_owner:K$1.current}}function N$1($,b){return{$$typeof:l$1,type:$.type,key:b,ref:$.ref,props:$.props,_owner:$._owner}}function O$1($){return typeof $=="object"&&$!==null&&$.$$typeof===l$1}function escape$1($){var b={"=":"=0",":":"=2"};return"$"+$.replace(/[=:]/g,function(g){return b[g]})}var P$1=/\/+/g;function Q$1($,b){return typeof $=="object"&&$!==null&&$.key!=null?escape$1(""+$.key):b.toString(36)}function R$1($,b,g,tt,ot){var ut=typeof $;(ut==="undefined"||ut==="boolean")&&($=null);var gt=!1;if($===null)gt=!0;else switch(ut){case"string":case"number":gt=!0;break;case"object":switch($.$$typeof){case l$1:case n$1:gt=!0}}if(gt)return gt=$,ot=ot(gt),$=tt===""?"."+Q$1(gt,0):tt,I$1(ot)?(g="",$!=null&&(g=$.replace(P$1,"$&/")+"/"),R$1(ot,b,g,"",function(kt){return kt})):ot!=null&&(O$1(ot)&&(ot=N$1(ot,g+(!ot.key||gt&&gt.key===ot.key?"":(""+ot.key).replace(P$1,"$&/")+"/")+$)),b.push(ot)),1;if(gt=0,tt=tt===""?".":tt+":",I$1($))for(var xt=0;xt<$.length;xt++){ut=$[xt];var It=tt+Q$1(ut,xt);gt+=R$1(ut,b,g,It,ot)}else if(It=A$1($),typeof It=="function")for($=It.call($),xt=0;!(ut=$.next()).done;)ut=ut.value,It=tt+Q$1(ut,xt++),gt+=R$1(ut,b,g,It,ot);else if(ut==="object")throw b=String($),Error("Objects are not valid as a React child (found: "+(b==="[object Object]"?"object with keys {"+Object.keys($).join(", ")+"}":b)+"). If you meant to render a collection of children, use an array instead.");return gt}function S$1($,b,g){if($==null)return $;var tt=[],ot=0;return R$1($,tt,"","",function(ut){return b.call(g,ut,ot++)}),tt}function T$1($){if($._status===-1){var b=$._result;b=b(),b.then(function(g){($._status===0||$._status===-1)&&($._status=1,$._result=g)},function(g){($._status===0||$._status===-1)&&($._status=2,$._result=g)}),$._status===-1&&($._status=0,$._result=b)}if($._status===1)return $._result.default;throw $._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};react_production_min.Children={map:S$1,forEach:function($,b,g){S$1($,function(){b.apply(this,arguments)},g)},count:function($){var b=0;return S$1($,function(){b++}),b},toArray:function($){return S$1($,function(b){return b})||[]},only:function($){if(!O$1($))throw Error("React.Children.only expected to receive a single React element child.");return $}};react_production_min.Component=E$1;react_production_min.Fragment=p$3;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w$1;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.cloneElement=function($,b,g){if($==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+$+".");var tt=C$1({},$.props),ot=$.key,ut=$.ref,gt=$._owner;if(b!=null){if(b.ref!==void 0&&(ut=b.ref,gt=K$1.current),b.key!==void 0&&(ot=""+b.key),$.type&&$.type.defaultProps)var xt=$.type.defaultProps;for(It in b)J.call(b,It)&&!L$1.hasOwnProperty(It)&&(tt[It]=b[It]===void 0&&xt!==void 0?xt[It]:b[It])}var It=arguments.length-2;if(It===1)tt.children=g;else if(1<It){xt=Array(It);for(var kt=0;kt<It;kt++)xt[kt]=arguments[kt+2];tt.children=xt}return{$$typeof:l$1,type:$.type,key:ot,ref:ut,props:tt,_owner:gt}};react_production_min.createContext=function($){return $={$$typeof:u,_currentValue:$,_currentValue2:$,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},$.Provider={$$typeof:t,_context:$},$.Consumer=$};react_production_min.createElement=M$1;react_production_min.createFactory=function($){var b=M$1.bind(null,$);return b.type=$,b};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function($){return{$$typeof:v$1,render:$}};react_production_min.isValidElement=O$1;react_production_min.lazy=function($){return{$$typeof:y,_payload:{_status:-1,_result:$},_init:T$1}};react_production_min.memo=function($,b){return{$$typeof:x,type:$,compare:b===void 0?null:b}};react_production_min.startTransition=function($){var b=V$1.transition;V$1.transition={};try{$()}finally{V$1.transition=b}};react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};react_production_min.useCallback=function($,b){return U$1.current.useCallback($,b)};react_production_min.useContext=function($){return U$1.current.useContext($)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function($){return U$1.current.useDeferredValue($)};react_production_min.useEffect=function($,b){return U$1.current.useEffect($,b)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function($,b,g){return U$1.current.useImperativeHandle($,b,g)};react_production_min.useInsertionEffect=function($,b){return U$1.current.useInsertionEffect($,b)};react_production_min.useLayoutEffect=function($,b){return U$1.current.useLayoutEffect($,b)};react_production_min.useMemo=function($,b){return U$1.current.useMemo($,b)};react_production_min.useReducer=function($,b,g){return U$1.current.useReducer($,b,g)};react_production_min.useRef=function($){return U$1.current.useRef($)};react_production_min.useState=function($){return U$1.current.useState($)};react_production_min.useSyncExternalStore=function($,b,g){return U$1.current.useSyncExternalStore($,b,g)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.2.0";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q($,b,g){var tt,ot={},ut=null,gt=null;g!==void 0&&(ut=""+g),b.key!==void 0&&(ut=""+b.key),b.ref!==void 0&&(gt=b.ref);for(tt in b)m$1.call(b,tt)&&!p$2.hasOwnProperty(tt)&&(ot[tt]=b[tt]);if($&&$.defaultProps)for(tt in b=$.defaultProps,b)ot[tt]===void 0&&(ot[tt]=b[tt]);return{$$typeof:k,type:$,key:ut,ref:gt,props:ot,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function($){function b(Un,Jn){var hn=Un.length;Un.push(Jn);e:for(;0<hn;){var rr=hn-1>>>1,sr=Un[rr];if(0<ot(sr,Jn))Un[rr]=Jn,Un[hn]=sr,hn=rr;else break e}}function g(Un){return Un.length===0?null:Un[0]}function tt(Un){if(Un.length===0)return null;var Jn=Un[0],hn=Un.pop();if(hn!==Jn){Un[0]=hn;e:for(var rr=0,sr=Un.length,br=sr>>>1;rr<br;){var Kn=2*(rr+1)-1,dn=Un[Kn],kn=Kn+1,Vn=Un[kn];if(0>ot(dn,hn))kn<sr&&0>ot(Vn,dn)?(Un[rr]=Vn,Un[kn]=hn,rr=kn):(Un[rr]=dn,Un[Kn]=hn,rr=Kn);else if(kn<sr&&0>ot(Vn,hn))Un[rr]=Vn,Un[kn]=hn,rr=kn;else break e}}return Jn}function ot(Un,Jn){var hn=Un.sortIndex-Jn.sortIndex;return hn!==0?hn:Un.id-Jn.id}if(typeof performance=="object"&&typeof performance.now=="function"){var ut=performance;$.unstable_now=function(){return ut.now()}}else{var gt=Date,xt=gt.now();$.unstable_now=function(){return gt.now()-xt}}var It=[],kt=[],Ft=1,Xt=null,qt=3,jt=!1,sn=!1,Gt=!1,vn=typeof setTimeout=="function"?setTimeout:null,nn=typeof clearTimeout=="function"?clearTimeout:null,Wt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function on(Un){for(var Jn=g(kt);Jn!==null;){if(Jn.callback===null)tt(kt);else if(Jn.startTime<=Un)tt(kt),Jn.sortIndex=Jn.expirationTime,b(It,Jn);else break;Jn=g(kt)}}function gn(Un){if(Gt=!1,on(Un),!sn)if(g(It)!==null)sn=!0,Yn(ln);else{var Jn=g(kt);Jn!==null&&tr(gn,Jn.startTime-Un)}}function ln(Un,Jn){sn=!1,Gt&&(Gt=!1,nn(Qt),Qt=-1),jt=!0;var hn=qt;try{for(on(Jn),Xt=g(It);Xt!==null&&(!(Xt.expirationTime>Jn)||Un&&!Yt());){var rr=Xt.callback;if(typeof rr=="function"){Xt.callback=null,qt=Xt.priorityLevel;var sr=rr(Xt.expirationTime<=Jn);Jn=$.unstable_now(),typeof sr=="function"?Xt.callback=sr:Xt===g(It)&&tt(It),on(Jn)}else tt(It);Xt=g(It)}if(Xt!==null)var br=!0;else{var Kn=g(kt);Kn!==null&&tr(gn,Kn.startTime-Jn),br=!1}return br}finally{Xt=null,qt=hn,jt=!1}}var _n=!1,Ut=null,Qt=-1,tn=5,bn=-1;function Yt(){return!($.unstable_now()-bn<tn)}function en(){if(Ut!==null){var Un=$.unstable_now();bn=Un;var Jn=!0;try{Jn=Ut(!0,Un)}finally{Jn?un():(_n=!1,Ut=null)}}else _n=!1}var un;if(typeof Wt=="function")un=function(){Wt(en)};else if(typeof MessageChannel<"u"){var yn=new MessageChannel,zn=yn.port2;yn.port1.onmessage=en,un=function(){zn.postMessage(null)}}else un=function(){vn(en,0)};function Yn(Un){Ut=Un,_n||(_n=!0,un())}function tr(Un,Jn){Qt=vn(function(){Un($.unstable_now())},Jn)}$.unstable_IdlePriority=5,$.unstable_ImmediatePriority=1,$.unstable_LowPriority=4,$.unstable_NormalPriority=3,$.unstable_Profiling=null,$.unstable_UserBlockingPriority=2,$.unstable_cancelCallback=function(Un){Un.callback=null},$.unstable_continueExecution=function(){sn||jt||(sn=!0,Yn(ln))},$.unstable_forceFrameRate=function(Un){0>Un||125<Un?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):tn=0<Un?Math.floor(1e3/Un):5},$.unstable_getCurrentPriorityLevel=function(){return qt},$.unstable_getFirstCallbackNode=function(){return g(It)},$.unstable_next=function(Un){switch(qt){case 1:case 2:case 3:var Jn=3;break;default:Jn=qt}var hn=qt;qt=Jn;try{return Un()}finally{qt=hn}},$.unstable_pauseExecution=function(){},$.unstable_requestPaint=function(){},$.unstable_runWithPriority=function(Un,Jn){switch(Un){case 1:case 2:case 3:case 4:case 5:break;default:Un=3}var hn=qt;qt=Un;try{return Jn()}finally{qt=hn}},$.unstable_scheduleCallback=function(Un,Jn,hn){var rr=$.unstable_now();switch(typeof hn=="object"&&hn!==null?(hn=hn.delay,hn=typeof hn=="number"&&0<hn?rr+hn:rr):hn=rr,Un){case 1:var sr=-1;break;case 2:sr=250;break;case 5:sr=1073741823;break;case 4:sr=1e4;break;default:sr=5e3}return sr=hn+sr,Un={id:Ft++,callback:Jn,priorityLevel:Un,startTime:hn,expirationTime:sr,sortIndex:-1},hn>rr?(Un.sortIndex=hn,b(kt,Un),g(It)===null&&Un===g(kt)&&(Gt?(nn(Qt),Qt=-1):Gt=!0,tr(gn,hn-rr))):(Un.sortIndex=sr,b(It,Un),sn||jt||(sn=!0,Yn(ln))),Un},$.unstable_shouldYield=Yt,$.unstable_wrapCallback=function(Un){var Jn=qt;return function(){var hn=qt;qt=Jn;try{return Un.apply(this,arguments)}finally{qt=hn}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$1($){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+$,g=1;g<arguments.length;g++)b+="&args[]="+encodeURIComponent(arguments[g]);return"Minified React error #"+$+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa($,b){ha($,b),ha($+"Capture",b)}function ha($,b){for(ea[$]=b,$=0;$<b.length;$++)da.add(b[$])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa($){return ja.call(ma,$)?!0:ja.call(la,$)?!1:ka.test($)?ma[$]=!0:(la[$]=!0,!1)}function pa($,b,g,tt){if(g!==null&&g.type===0)return!1;switch(typeof b){case"function":case"symbol":return!0;case"boolean":return tt?!1:g!==null?!g.acceptsBooleans:($=$.toLowerCase().slice(0,5),$!=="data-"&&$!=="aria-");default:return!1}}function qa($,b,g,tt){if(b===null||typeof b>"u"||pa($,b,g,tt))return!0;if(tt)return!1;if(g!==null)switch(g.type){case 3:return!b;case 4:return b===!1;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function v($,b,g,tt,ot,ut,gt){this.acceptsBooleans=b===2||b===3||b===4,this.attributeName=tt,this.attributeNamespace=ot,this.mustUseProperty=g,this.propertyName=$,this.type=b,this.sanitizeURL=ut,this.removeEmptyString=gt}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function($){z[$]=new v($,0,!1,$,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function($){var b=$[0];z[b]=new v(b,1,!1,$[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function($){z[$]=new v($,2,!1,$.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function($){z[$]=new v($,2,!1,$,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function($){z[$]=new v($,3,!1,$.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function($){z[$]=new v($,3,!0,$,null,!1,!1)});["capture","download"].forEach(function($){z[$]=new v($,4,!1,$,null,!1,!1)});["cols","rows","size","span"].forEach(function($){z[$]=new v($,6,!1,$,null,!1,!1)});["rowSpan","start"].forEach(function($){z[$]=new v($,5,!1,$.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa($){return $[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function($){var b=$.replace(ra,sa);z[b]=new v(b,1,!1,$,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function($){var b=$.replace(ra,sa);z[b]=new v(b,1,!1,$,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function($){var b=$.replace(ra,sa);z[b]=new v(b,1,!1,$,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function($){z[$]=new v($,1,!1,$.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function($){z[$]=new v($,1,!1,$.toLowerCase(),null,!0,!0)});function ta($,b,g,tt){var ot=z.hasOwnProperty(b)?z[b]:null;(ot!==null?ot.type!==0:tt||!(2<b.length)||b[0]!=="o"&&b[0]!=="O"||b[1]!=="n"&&b[1]!=="N")&&(qa(b,g,ot,tt)&&(g=null),tt||ot===null?oa(b)&&(g===null?$.removeAttribute(b):$.setAttribute(b,""+g)):ot.mustUseProperty?$[ot.propertyName]=g===null?ot.type===3?!1:"":g:(b=ot.attributeName,tt=ot.attributeNamespace,g===null?$.removeAttribute(b):(ot=ot.type,g=ot===3||ot===4&&g===!0?"":""+g,tt?$.setAttributeNS(tt,b,g):$.setAttribute(b,g))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka($){return $===null||typeof $!="object"?null:($=Ja&&$[Ja]||$["@@iterator"],typeof $=="function"?$:null)}var A=Object.assign,La;function Ma($){if(La===void 0)try{throw Error()}catch(g){var b=g.stack.trim().match(/\n( *(at )?)/);La=b&&b[1]||""}return`
`+La+$}var Na=!1;function Oa($,b){if(!$||Na)return"";Na=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(kt){var tt=kt}Reflect.construct($,[],b)}else{try{b.call()}catch(kt){tt=kt}$.call(b.prototype)}else{try{throw Error()}catch(kt){tt=kt}$()}}catch(kt){if(kt&&tt&&typeof kt.stack=="string"){for(var ot=kt.stack.split(`
`),ut=tt.stack.split(`
`),gt=ot.length-1,xt=ut.length-1;1<=gt&&0<=xt&&ot[gt]!==ut[xt];)xt--;for(;1<=gt&&0<=xt;gt--,xt--)if(ot[gt]!==ut[xt]){if(gt!==1||xt!==1)do if(gt--,xt--,0>xt||ot[gt]!==ut[xt]){var It=`
`+ot[gt].replace(" at new "," at ");return $.displayName&&It.includes("<anonymous>")&&(It=It.replace("<anonymous>",$.displayName)),It}while(1<=gt&&0<=xt);break}}}finally{Na=!1,Error.prepareStackTrace=g}return($=$?$.displayName||$.name:"")?Ma($):""}function Pa($){switch($.tag){case 5:return Ma($.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return $=Oa($.type,!1),$;case 11:return $=Oa($.type.render,!1),$;case 1:return $=Oa($.type,!0),$;default:return""}}function Qa($){if($==null)return null;if(typeof $=="function")return $.displayName||$.name||null;if(typeof $=="string")return $;switch($){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof $=="object")switch($.$$typeof){case Ca:return($.displayName||"Context")+".Consumer";case Ba:return($._context.displayName||"Context")+".Provider";case Da:var b=$.render;return $=$.displayName,$||($=b.displayName||b.name||"",$=$!==""?"ForwardRef("+$+")":"ForwardRef"),$;case Ga:return b=$.displayName||null,b!==null?b:Qa($.type)||"Memo";case Ha:b=$._payload,$=$._init;try{return Qa($(b))}catch{}}return null}function Ra($){var b=$.type;switch($.tag){case 24:return"Cache";case 9:return(b.displayName||"Context")+".Consumer";case 10:return(b._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return $=b.render,$=$.displayName||$.name||"",b.displayName||($!==""?"ForwardRef("+$+")":"ForwardRef");case 7:return"Fragment";case 5:return b;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(b);case 8:return b===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b}return null}function Sa($){switch(typeof $){case"boolean":case"number":case"string":case"undefined":return $;case"object":return $;default:return""}}function Ta($){var b=$.type;return($=$.nodeName)&&$.toLowerCase()==="input"&&(b==="checkbox"||b==="radio")}function Ua($){var b=Ta($)?"checked":"value",g=Object.getOwnPropertyDescriptor($.constructor.prototype,b),tt=""+$[b];if(!$.hasOwnProperty(b)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var ot=g.get,ut=g.set;return Object.defineProperty($,b,{configurable:!0,get:function(){return ot.call(this)},set:function(gt){tt=""+gt,ut.call(this,gt)}}),Object.defineProperty($,b,{enumerable:g.enumerable}),{getValue:function(){return tt},setValue:function(gt){tt=""+gt},stopTracking:function(){$._valueTracker=null,delete $[b]}}}}function Va($){$._valueTracker||($._valueTracker=Ua($))}function Wa($){if(!$)return!1;var b=$._valueTracker;if(!b)return!0;var g=b.getValue(),tt="";return $&&(tt=Ta($)?$.checked?"true":"false":$.value),$=tt,$!==g?(b.setValue($),!0):!1}function Xa($){if($=$||(typeof document<"u"?document:void 0),typeof $>"u")return null;try{return $.activeElement||$.body}catch{return $.body}}function Ya($,b){var g=b.checked;return A({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:g??$._wrapperState.initialChecked})}function Za($,b){var g=b.defaultValue==null?"":b.defaultValue,tt=b.checked!=null?b.checked:b.defaultChecked;g=Sa(b.value!=null?b.value:g),$._wrapperState={initialChecked:tt,initialValue:g,controlled:b.type==="checkbox"||b.type==="radio"?b.checked!=null:b.value!=null}}function ab($,b){b=b.checked,b!=null&&ta($,"checked",b,!1)}function bb($,b){ab($,b);var g=Sa(b.value),tt=b.type;if(g!=null)tt==="number"?(g===0&&$.value===""||$.value!=g)&&($.value=""+g):$.value!==""+g&&($.value=""+g);else if(tt==="submit"||tt==="reset"){$.removeAttribute("value");return}b.hasOwnProperty("value")?cb($,b.type,g):b.hasOwnProperty("defaultValue")&&cb($,b.type,Sa(b.defaultValue)),b.checked==null&&b.defaultChecked!=null&&($.defaultChecked=!!b.defaultChecked)}function db($,b,g){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var tt=b.type;if(!(tt!=="submit"&&tt!=="reset"||b.value!==void 0&&b.value!==null))return;b=""+$._wrapperState.initialValue,g||b===$.value||($.value=b),$.defaultValue=b}g=$.name,g!==""&&($.name=""),$.defaultChecked=!!$._wrapperState.initialChecked,g!==""&&($.name=g)}function cb($,b,g){(b!=="number"||Xa($.ownerDocument)!==$)&&(g==null?$.defaultValue=""+$._wrapperState.initialValue:$.defaultValue!==""+g&&($.defaultValue=""+g))}var eb=Array.isArray;function fb($,b,g,tt){if($=$.options,b){b={};for(var ot=0;ot<g.length;ot++)b["$"+g[ot]]=!0;for(g=0;g<$.length;g++)ot=b.hasOwnProperty("$"+$[g].value),$[g].selected!==ot&&($[g].selected=ot),ot&&tt&&($[g].defaultSelected=!0)}else{for(g=""+Sa(g),b=null,ot=0;ot<$.length;ot++){if($[ot].value===g){$[ot].selected=!0,tt&&($[ot].defaultSelected=!0);return}b!==null||$[ot].disabled||(b=$[ot])}b!==null&&(b.selected=!0)}}function gb($,b){if(b.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A({},b,{value:void 0,defaultValue:void 0,children:""+$._wrapperState.initialValue})}function hb($,b){var g=b.value;if(g==null){if(g=b.children,b=b.defaultValue,g!=null){if(b!=null)throw Error(p$1(92));if(eb(g)){if(1<g.length)throw Error(p$1(93));g=g[0]}b=g}b==null&&(b=""),g=b}$._wrapperState={initialValue:Sa(g)}}function ib($,b){var g=Sa(b.value),tt=Sa(b.defaultValue);g!=null&&(g=""+g,g!==$.value&&($.value=g),b.defaultValue==null&&$.defaultValue!==g&&($.defaultValue=g)),tt!=null&&($.defaultValue=""+tt)}function jb($){var b=$.textContent;b===$._wrapperState.initialValue&&b!==""&&b!==null&&($.value=b)}function kb($){switch($){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb($,b){return $==null||$==="http://www.w3.org/1999/xhtml"?kb(b):$==="http://www.w3.org/2000/svg"&&b==="foreignObject"?"http://www.w3.org/1999/xhtml":$}var mb,nb=function($){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(b,g,tt,ot){MSApp.execUnsafeLocalFunction(function(){return $(b,g,tt,ot)})}:$}(function($,b){if($.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in $)$.innerHTML=b;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+b.valueOf().toString()+"</svg>",b=mb.firstChild;$.firstChild;)$.removeChild($.firstChild);for(;b.firstChild;)$.appendChild(b.firstChild)}});function ob($,b){if(b){var g=$.firstChild;if(g&&g===$.lastChild&&g.nodeType===3){g.nodeValue=b;return}}$.textContent=b}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function($){qb.forEach(function(b){b=b+$.charAt(0).toUpperCase()+$.substring(1),pb[b]=pb[$]})});function rb($,b,g){return b==null||typeof b=="boolean"||b===""?"":g||typeof b!="number"||b===0||pb.hasOwnProperty($)&&pb[$]?(""+b).trim():b+"px"}function sb($,b){$=$.style;for(var g in b)if(b.hasOwnProperty(g)){var tt=g.indexOf("--")===0,ot=rb(g,b[g],tt);g==="float"&&(g="cssFloat"),tt?$.setProperty(g,ot):$[g]=ot}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub($,b){if(b){if(tb[$]&&(b.children!=null||b.dangerouslySetInnerHTML!=null))throw Error(p$1(137,$));if(b.dangerouslySetInnerHTML!=null){if(b.children!=null)throw Error(p$1(60));if(typeof b.dangerouslySetInnerHTML!="object"||!("__html"in b.dangerouslySetInnerHTML))throw Error(p$1(61))}if(b.style!=null&&typeof b.style!="object")throw Error(p$1(62))}}function vb($,b){if($.indexOf("-")===-1)return typeof b.is=="string";switch($){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb($){return $=$.target||$.srcElement||window,$.correspondingUseElement&&($=$.correspondingUseElement),$.nodeType===3?$.parentNode:$}var yb=null,zb=null,Ab=null;function Bb($){if($=Cb($)){if(typeof yb!="function")throw Error(p$1(280));var b=$.stateNode;b&&(b=Db(b),yb($.stateNode,$.type,b))}}function Eb($){zb?Ab?Ab.push($):Ab=[$]:zb=$}function Fb(){if(zb){var $=zb,b=Ab;if(Ab=zb=null,Bb($),b)for($=0;$<b.length;$++)Bb(b[$])}}function Gb($,b){return $(b)}function Hb(){}var Ib=!1;function Jb($,b,g){if(Ib)return $(b,g);Ib=!0;try{return Gb($,b,g)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb($,b){var g=$.stateNode;if(g===null)return null;var tt=Db(g);if(tt===null)return null;g=tt[b];e:switch(b){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(tt=!tt.disabled)||($=$.type,tt=!($==="button"||$==="input"||$==="select"||$==="textarea")),$=!tt;break e;default:$=!1}if($)return null;if(g&&typeof g!="function")throw Error(p$1(231,b,typeof g));return g}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb($,b,g,tt,ot,ut,gt,xt,It){var kt=Array.prototype.slice.call(arguments,3);try{b.apply(g,kt)}catch(Ft){this.onError(Ft)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function($){Ob=!0,Pb=$}};function Tb($,b,g,tt,ot,ut,gt,xt,It){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub($,b,g,tt,ot,ut,gt,xt,It){if(Tb.apply(this,arguments),Ob){if(Ob){var kt=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=kt)}}function Vb($){var b=$,g=$;if($.alternate)for(;b.return;)b=b.return;else{$=b;do b=$,b.flags&4098&&(g=b.return),$=b.return;while($)}return b.tag===3?g:null}function Wb($){if($.tag===13){var b=$.memoizedState;if(b===null&&($=$.alternate,$!==null&&(b=$.memoizedState)),b!==null)return b.dehydrated}return null}function Xb($){if(Vb($)!==$)throw Error(p$1(188))}function Yb($){var b=$.alternate;if(!b){if(b=Vb($),b===null)throw Error(p$1(188));return b!==$?null:$}for(var g=$,tt=b;;){var ot=g.return;if(ot===null)break;var ut=ot.alternate;if(ut===null){if(tt=ot.return,tt!==null){g=tt;continue}break}if(ot.child===ut.child){for(ut=ot.child;ut;){if(ut===g)return Xb(ot),$;if(ut===tt)return Xb(ot),b;ut=ut.sibling}throw Error(p$1(188))}if(g.return!==tt.return)g=ot,tt=ut;else{for(var gt=!1,xt=ot.child;xt;){if(xt===g){gt=!0,g=ot,tt=ut;break}if(xt===tt){gt=!0,tt=ot,g=ut;break}xt=xt.sibling}if(!gt){for(xt=ut.child;xt;){if(xt===g){gt=!0,g=ut,tt=ot;break}if(xt===tt){gt=!0,tt=ut,g=ot;break}xt=xt.sibling}if(!gt)throw Error(p$1(189))}}if(g.alternate!==tt)throw Error(p$1(190))}if(g.tag!==3)throw Error(p$1(188));return g.stateNode.current===g?$:b}function Zb($){return $=Yb($),$!==null?$b($):null}function $b($){if($.tag===5||$.tag===6)return $;for($=$.child;$!==null;){var b=$b($);if(b!==null)return b;$=$.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc($){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,$,void 0,($.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc($){return $>>>=0,$===0?32:31-(pc($)/qc|0)|0}var rc=64,sc=4194304;function tc($){switch($&-$){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return $&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return $&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return $}}function uc($,b){var g=$.pendingLanes;if(g===0)return 0;var tt=0,ot=$.suspendedLanes,ut=$.pingedLanes,gt=g&268435455;if(gt!==0){var xt=gt&~ot;xt!==0?tt=tc(xt):(ut&=gt,ut!==0&&(tt=tc(ut)))}else gt=g&~ot,gt!==0?tt=tc(gt):ut!==0&&(tt=tc(ut));if(tt===0)return 0;if(b!==0&&b!==tt&&!(b&ot)&&(ot=tt&-tt,ut=b&-b,ot>=ut||ot===16&&(ut&4194240)!==0))return b;if(tt&4&&(tt|=g&16),b=$.entangledLanes,b!==0)for($=$.entanglements,b&=tt;0<b;)g=31-oc(b),ot=1<<g,tt|=$[g],b&=~ot;return tt}function vc($,b){switch($){case 1:case 2:case 4:return b+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc($,b){for(var g=$.suspendedLanes,tt=$.pingedLanes,ot=$.expirationTimes,ut=$.pendingLanes;0<ut;){var gt=31-oc(ut),xt=1<<gt,It=ot[gt];It===-1?(!(xt&g)||xt&tt)&&(ot[gt]=vc(xt,b)):It<=b&&($.expiredLanes|=xt),ut&=~xt}}function xc($){return $=$.pendingLanes&-1073741825,$!==0?$:$&1073741824?1073741824:0}function yc(){var $=rc;return rc<<=1,!(rc&4194240)&&(rc=64),$}function zc($){for(var b=[],g=0;31>g;g++)b.push($);return b}function Ac($,b,g){$.pendingLanes|=b,b!==536870912&&($.suspendedLanes=0,$.pingedLanes=0),$=$.eventTimes,b=31-oc(b),$[b]=g}function Bc($,b){var g=$.pendingLanes&~b;$.pendingLanes=b,$.suspendedLanes=0,$.pingedLanes=0,$.expiredLanes&=b,$.mutableReadLanes&=b,$.entangledLanes&=b,b=$.entanglements;var tt=$.eventTimes;for($=$.expirationTimes;0<g;){var ot=31-oc(g),ut=1<<ot;b[ot]=0,tt[ot]=-1,$[ot]=-1,g&=~ut}}function Cc($,b){var g=$.entangledLanes|=b;for($=$.entanglements;g;){var tt=31-oc(g),ot=1<<tt;ot&b|$[tt]&b&&($[tt]|=b),g&=~ot}}var C=0;function Dc($){return $&=-$,1<$?4<$?$&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc($,b){switch($){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(b.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(b.pointerId)}}function Tc($,b,g,tt,ot,ut){return $===null||$.nativeEvent!==ut?($={blockedOn:b,domEventName:g,eventSystemFlags:tt,nativeEvent:ut,targetContainers:[ot]},b!==null&&(b=Cb(b),b!==null&&Fc(b)),$):($.eventSystemFlags|=tt,b=$.targetContainers,ot!==null&&b.indexOf(ot)===-1&&b.push(ot),$)}function Uc($,b,g,tt,ot){switch(b){case"focusin":return Lc=Tc(Lc,$,b,g,tt,ot),!0;case"dragenter":return Mc=Tc(Mc,$,b,g,tt,ot),!0;case"mouseover":return Nc=Tc(Nc,$,b,g,tt,ot),!0;case"pointerover":var ut=ot.pointerId;return Oc.set(ut,Tc(Oc.get(ut)||null,$,b,g,tt,ot)),!0;case"gotpointercapture":return ut=ot.pointerId,Pc.set(ut,Tc(Pc.get(ut)||null,$,b,g,tt,ot)),!0}return!1}function Vc($){var b=Wc($.target);if(b!==null){var g=Vb(b);if(g!==null){if(b=g.tag,b===13){if(b=Wb(g),b!==null){$.blockedOn=b,Ic($.priority,function(){Gc(g)});return}}else if(b===3&&g.stateNode.current.memoizedState.isDehydrated){$.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}$.blockedOn=null}function Xc($){if($.blockedOn!==null)return!1;for(var b=$.targetContainers;0<b.length;){var g=Yc($.domEventName,$.eventSystemFlags,b[0],$.nativeEvent);if(g===null){g=$.nativeEvent;var tt=new g.constructor(g.type,g);wb=tt,g.target.dispatchEvent(tt),wb=null}else return b=Cb(g),b!==null&&Fc(b),$.blockedOn=g,!1;b.shift()}return!0}function Zc($,b,g){Xc($)&&g.delete(b)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad($,b){$.blockedOn===b&&($.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd($){function b(ot){return ad(ot,$)}if(0<Kc.length){ad(Kc[0],$);for(var g=1;g<Kc.length;g++){var tt=Kc[g];tt.blockedOn===$&&(tt.blockedOn=null)}}for(Lc!==null&&ad(Lc,$),Mc!==null&&ad(Mc,$),Nc!==null&&ad(Nc,$),Oc.forEach(b),Pc.forEach(b),g=0;g<Qc.length;g++)tt=Qc[g],tt.blockedOn===$&&(tt.blockedOn=null);for(;0<Qc.length&&(g=Qc[0],g.blockedOn===null);)Vc(g),g.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed($,b,g,tt){var ot=C,ut=cd.transition;cd.transition=null;try{C=1,fd($,b,g,tt)}finally{C=ot,cd.transition=ut}}function gd($,b,g,tt){var ot=C,ut=cd.transition;cd.transition=null;try{C=4,fd($,b,g,tt)}finally{C=ot,cd.transition=ut}}function fd($,b,g,tt){if(dd){var ot=Yc($,b,g,tt);if(ot===null)hd($,b,tt,id,g),Sc($,tt);else if(Uc(ot,$,b,g,tt))tt.stopPropagation();else if(Sc($,tt),b&4&&-1<Rc.indexOf($)){for(;ot!==null;){var ut=Cb(ot);if(ut!==null&&Ec(ut),ut=Yc($,b,g,tt),ut===null&&hd($,b,tt,id,g),ut===ot)break;ot=ut}ot!==null&&tt.stopPropagation()}else hd($,b,tt,null,g)}}var id=null;function Yc($,b,g,tt){if(id=null,$=xb(tt),$=Wc($),$!==null)if(b=Vb($),b===null)$=null;else if(g=b.tag,g===13){if($=Wb(b),$!==null)return $;$=null}else if(g===3){if(b.stateNode.current.memoizedState.isDehydrated)return b.tag===3?b.stateNode.containerInfo:null;$=null}else b!==$&&($=null);return id=$,null}function jd($){switch($){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var $,b=ld,g=b.length,tt,ot="value"in kd?kd.value:kd.textContent,ut=ot.length;for($=0;$<g&&b[$]===ot[$];$++);var gt=g-$;for(tt=1;tt<=gt&&b[g-tt]===ot[ut-tt];tt++);return md=ot.slice($,1<tt?1-tt:void 0)}function od($){var b=$.keyCode;return"charCode"in $?($=$.charCode,$===0&&b===13&&($=13)):$=b,$===10&&($=13),32<=$||$===13?$:0}function pd(){return!0}function qd(){return!1}function rd($){function b(g,tt,ot,ut,gt){this._reactName=g,this._targetInst=ot,this.type=tt,this.nativeEvent=ut,this.target=gt,this.currentTarget=null;for(var xt in $)$.hasOwnProperty(xt)&&(g=$[xt],this[xt]=g?g(ut):ut[xt]);return this.isDefaultPrevented=(ut.defaultPrevented!=null?ut.defaultPrevented:ut.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(b.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),b}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function($){return $.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function($){return $.relatedTarget===void 0?$.fromElement===$.srcElement?$.toElement:$.fromElement:$.relatedTarget},movementX:function($){return"movementX"in $?$.movementX:($!==yd&&(yd&&$.type==="mousemove"?(wd=$.screenX-yd.screenX,xd=$.screenY-yd.screenY):xd=wd=0,yd=$),wd)},movementY:function($){return"movementY"in $?$.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function($){return"clipboardData"in $?$.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd($){var b=this.nativeEvent;return b.getModifierState?b.getModifierState($):($=Od[$])?!!b[$]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function($){if($.key){var b=Md[$.key]||$.key;if(b!=="Unidentified")return b}return $.type==="keypress"?($=od($),$===13?"Enter":String.fromCharCode($)):$.type==="keydown"||$.type==="keyup"?Nd[$.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function($){return $.type==="keypress"?od($):0},keyCode:function($){return $.type==="keydown"||$.type==="keyup"?$.keyCode:0},which:function($){return $.type==="keypress"?od($):$.type==="keydown"||$.type==="keyup"?$.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function($){return"deltaX"in $?$.deltaX:"wheelDeltaX"in $?-$.wheelDeltaX:0},deltaY:function($){return"deltaY"in $?$.deltaY:"wheelDeltaY"in $?-$.wheelDeltaY:"wheelDelta"in $?-$.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=" ",fe=!1;function ge($,b){switch($){case"keyup":return $d.indexOf(b.keyCode)!==-1;case"keydown":return b.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he($){return $=$.detail,typeof $=="object"&&"data"in $?$.data:null}var ie=!1;function je($,b){switch($){case"compositionend":return he(b);case"keypress":return b.which!==32?null:(fe=!0,ee);case"textInput":return $=b.data,$===ee&&fe?null:$;default:return null}}function ke($,b){if(ie)return $==="compositionend"||!ae&&ge($,b)?($=nd(),md=ld=kd=null,ie=!1,$):null;switch($){case"paste":return null;case"keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;case"compositionend":return de&&b.locale!=="ko"?null:b.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me($){var b=$&&$.nodeName&&$.nodeName.toLowerCase();return b==="input"?!!le[$.type]:b==="textarea"}function ne($,b,g,tt){Eb(tt),b=oe(b,"onChange"),0<b.length&&(g=new td("onChange","change",null,g,tt),$.push({event:g,listeners:b}))}var pe=null,qe=null;function re($){se($,0)}function te($){var b=ue($);if(Wa(b))return $}function ve($,b){if($==="change")return b}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be($){if($.propertyName==="value"&&te(qe)){var b=[];ne(b,qe,$,xb($)),Jb(re,b)}}function Ce($,b,g){$==="focusin"?(Ae(),pe=b,qe=g,pe.attachEvent("onpropertychange",Be)):$==="focusout"&&Ae()}function De($){if($==="selectionchange"||$==="keyup"||$==="keydown")return te(qe)}function Ee($,b){if($==="click")return te(b)}function Fe($,b){if($==="input"||$==="change")return te(b)}function Ge($,b){return $===b&&($!==0||1/$===1/b)||$!==$&&b!==b}var He=typeof Object.is=="function"?Object.is:Ge;function Ie($,b){if(He($,b))return!0;if(typeof $!="object"||$===null||typeof b!="object"||b===null)return!1;var g=Object.keys($),tt=Object.keys(b);if(g.length!==tt.length)return!1;for(tt=0;tt<g.length;tt++){var ot=g[tt];if(!ja.call(b,ot)||!He($[ot],b[ot]))return!1}return!0}function Je($){for(;$&&$.firstChild;)$=$.firstChild;return $}function Ke($,b){var g=Je($);$=0;for(var tt;g;){if(g.nodeType===3){if(tt=$+g.textContent.length,$<=b&&tt>=b)return{node:g,offset:b-$};$=tt}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=Je(g)}}function Le($,b){return $&&b?$===b?!0:$&&$.nodeType===3?!1:b&&b.nodeType===3?Le($,b.parentNode):"contains"in $?$.contains(b):$.compareDocumentPosition?!!($.compareDocumentPosition(b)&16):!1:!1}function Me(){for(var $=window,b=Xa();b instanceof $.HTMLIFrameElement;){try{var g=typeof b.contentWindow.location.href=="string"}catch{g=!1}if(g)$=b.contentWindow;else break;b=Xa($.document)}return b}function Ne($){var b=$&&$.nodeName&&$.nodeName.toLowerCase();return b&&(b==="input"&&($.type==="text"||$.type==="search"||$.type==="tel"||$.type==="url"||$.type==="password")||b==="textarea"||$.contentEditable==="true")}function Oe($){var b=Me(),g=$.focusedElem,tt=$.selectionRange;if(b!==g&&g&&g.ownerDocument&&Le(g.ownerDocument.documentElement,g)){if(tt!==null&&Ne(g)){if(b=tt.start,$=tt.end,$===void 0&&($=b),"selectionStart"in g)g.selectionStart=b,g.selectionEnd=Math.min($,g.value.length);else if($=(b=g.ownerDocument||document)&&b.defaultView||window,$.getSelection){$=$.getSelection();var ot=g.textContent.length,ut=Math.min(tt.start,ot);tt=tt.end===void 0?ut:Math.min(tt.end,ot),!$.extend&&ut>tt&&(ot=tt,tt=ut,ut=ot),ot=Ke(g,ut);var gt=Ke(g,tt);ot&&gt&&($.rangeCount!==1||$.anchorNode!==ot.node||$.anchorOffset!==ot.offset||$.focusNode!==gt.node||$.focusOffset!==gt.offset)&&(b=b.createRange(),b.setStart(ot.node,ot.offset),$.removeAllRanges(),ut>tt?($.addRange(b),$.extend(gt.node,gt.offset)):(b.setEnd(gt.node,gt.offset),$.addRange(b)))}}for(b=[],$=g;$=$.parentNode;)$.nodeType===1&&b.push({element:$,left:$.scrollLeft,top:$.scrollTop});for(typeof g.focus=="function"&&g.focus(),g=0;g<b.length;g++)$=b[g],$.element.scrollLeft=$.left,$.element.scrollTop=$.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue($,b,g){var tt=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;Te||Qe==null||Qe!==Xa(tt)||(tt=Qe,"selectionStart"in tt&&Ne(tt)?tt={start:tt.selectionStart,end:tt.selectionEnd}:(tt=(tt.ownerDocument&&tt.ownerDocument.defaultView||window).getSelection(),tt={anchorNode:tt.anchorNode,anchorOffset:tt.anchorOffset,focusNode:tt.focusNode,focusOffset:tt.focusOffset}),Se&&Ie(Se,tt)||(Se=tt,tt=oe(Re,"onSelect"),0<tt.length&&(b=new td("onSelect","select",null,b,g),$.push({event:b,listeners:tt}),b.target=Qe)))}function Ve($,b){var g={};return g[$.toLowerCase()]=b.toLowerCase(),g["Webkit"+$]="webkit"+b,g["Moz"+$]="moz"+b,g}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze($){if(Xe[$])return Xe[$];if(!We[$])return $;var b=We[$],g;for(g in b)if(b.hasOwnProperty(g)&&g in Ye)return Xe[$]=b[g];return $}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff($,b){df.set($,b),fa(b,[$])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf($,b,g){var tt=$.type||"unknown-event";$.currentTarget=g,Ub(tt,b,void 0,$),$.currentTarget=null}function se($,b){b=(b&4)!==0;for(var g=0;g<$.length;g++){var tt=$[g],ot=tt.event;tt=tt.listeners;e:{var ut=void 0;if(b)for(var gt=tt.length-1;0<=gt;gt--){var xt=tt[gt],It=xt.instance,kt=xt.currentTarget;if(xt=xt.listener,It!==ut&&ot.isPropagationStopped())break e;nf(ot,xt,kt),ut=It}else for(gt=0;gt<tt.length;gt++){if(xt=tt[gt],It=xt.instance,kt=xt.currentTarget,xt=xt.listener,It!==ut&&ot.isPropagationStopped())break e;nf(ot,xt,kt),ut=It}}}if(Qb)throw $=Rb,Qb=!1,Rb=null,$}function D($,b){var g=b[of];g===void 0&&(g=b[of]=new Set);var tt=$+"__bubble";g.has(tt)||(pf(b,$,2,!1),g.add(tt))}function qf($,b,g){var tt=0;b&&(tt|=4),pf(g,$,tt,b)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf($){if(!$[rf]){$[rf]=!0,da.forEach(function(g){g!=="selectionchange"&&(mf.has(g)||qf(g,!1,$),qf(g,!0,$))});var b=$.nodeType===9?$:$.ownerDocument;b===null||b[rf]||(b[rf]=!0,qf("selectionchange",!1,b))}}function pf($,b,g,tt){switch(jd(b)){case 1:var ot=ed;break;case 4:ot=gd;break;default:ot=fd}g=ot.bind(null,b,g,$),ot=void 0,!Lb||b!=="touchstart"&&b!=="touchmove"&&b!=="wheel"||(ot=!0),tt?ot!==void 0?$.addEventListener(b,g,{capture:!0,passive:ot}):$.addEventListener(b,g,!0):ot!==void 0?$.addEventListener(b,g,{passive:ot}):$.addEventListener(b,g,!1)}function hd($,b,g,tt,ot){var ut=tt;if(!(b&1)&&!(b&2)&&tt!==null)e:for(;;){if(tt===null)return;var gt=tt.tag;if(gt===3||gt===4){var xt=tt.stateNode.containerInfo;if(xt===ot||xt.nodeType===8&&xt.parentNode===ot)break;if(gt===4)for(gt=tt.return;gt!==null;){var It=gt.tag;if((It===3||It===4)&&(It=gt.stateNode.containerInfo,It===ot||It.nodeType===8&&It.parentNode===ot))return;gt=gt.return}for(;xt!==null;){if(gt=Wc(xt),gt===null)return;if(It=gt.tag,It===5||It===6){tt=ut=gt;continue e}xt=xt.parentNode}}tt=tt.return}Jb(function(){var kt=ut,Ft=xb(g),Xt=[];e:{var qt=df.get($);if(qt!==void 0){var jt=td,sn=$;switch($){case"keypress":if(od(g)===0)break e;case"keydown":case"keyup":jt=Rd;break;case"focusin":sn="focus",jt=Fd;break;case"focusout":sn="blur",jt=Fd;break;case"beforeblur":case"afterblur":jt=Fd;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":jt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":jt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":jt=Vd;break;case $e:case af:case bf:jt=Hd;break;case cf:jt=Xd;break;case"scroll":jt=vd;break;case"wheel":jt=Zd;break;case"copy":case"cut":case"paste":jt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":jt=Td}var Gt=(b&4)!==0,vn=!Gt&&$==="scroll",nn=Gt?qt!==null?qt+"Capture":null:qt;Gt=[];for(var Wt=kt,on;Wt!==null;){on=Wt;var gn=on.stateNode;if(on.tag===5&&gn!==null&&(on=gn,nn!==null&&(gn=Kb(Wt,nn),gn!=null&&Gt.push(tf(Wt,gn,on)))),vn)break;Wt=Wt.return}0<Gt.length&&(qt=new jt(qt,sn,null,g,Ft),Xt.push({event:qt,listeners:Gt}))}}if(!(b&7)){e:{if(qt=$==="mouseover"||$==="pointerover",jt=$==="mouseout"||$==="pointerout",qt&&g!==wb&&(sn=g.relatedTarget||g.fromElement)&&(Wc(sn)||sn[uf]))break e;if((jt||qt)&&(qt=Ft.window===Ft?Ft:(qt=Ft.ownerDocument)?qt.defaultView||qt.parentWindow:window,jt?(sn=g.relatedTarget||g.toElement,jt=kt,sn=sn?Wc(sn):null,sn!==null&&(vn=Vb(sn),sn!==vn||sn.tag!==5&&sn.tag!==6)&&(sn=null)):(jt=null,sn=kt),jt!==sn)){if(Gt=Bd,gn="onMouseLeave",nn="onMouseEnter",Wt="mouse",($==="pointerout"||$==="pointerover")&&(Gt=Td,gn="onPointerLeave",nn="onPointerEnter",Wt="pointer"),vn=jt==null?qt:ue(jt),on=sn==null?qt:ue(sn),qt=new Gt(gn,Wt+"leave",jt,g,Ft),qt.target=vn,qt.relatedTarget=on,gn=null,Wc(Ft)===kt&&(Gt=new Gt(nn,Wt+"enter",sn,g,Ft),Gt.target=on,Gt.relatedTarget=vn,gn=Gt),vn=gn,jt&&sn)t:{for(Gt=jt,nn=sn,Wt=0,on=Gt;on;on=vf(on))Wt++;for(on=0,gn=nn;gn;gn=vf(gn))on++;for(;0<Wt-on;)Gt=vf(Gt),Wt--;for(;0<on-Wt;)nn=vf(nn),on--;for(;Wt--;){if(Gt===nn||nn!==null&&Gt===nn.alternate)break t;Gt=vf(Gt),nn=vf(nn)}Gt=null}else Gt=null;jt!==null&&wf(Xt,qt,jt,Gt,!1),sn!==null&&vn!==null&&wf(Xt,vn,sn,Gt,!0)}}e:{if(qt=kt?ue(kt):window,jt=qt.nodeName&&qt.nodeName.toLowerCase(),jt==="select"||jt==="input"&&qt.type==="file")var ln=ve;else if(me(qt))if(we)ln=Fe;else{ln=De;var _n=Ce}else(jt=qt.nodeName)&&jt.toLowerCase()==="input"&&(qt.type==="checkbox"||qt.type==="radio")&&(ln=Ee);if(ln&&(ln=ln($,kt))){ne(Xt,ln,g,Ft);break e}_n&&_n($,qt,kt),$==="focusout"&&(_n=qt._wrapperState)&&_n.controlled&&qt.type==="number"&&cb(qt,"number",qt.value)}switch(_n=kt?ue(kt):window,$){case"focusin":(me(_n)||_n.contentEditable==="true")&&(Qe=_n,Re=kt,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(Xt,g,Ft);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(Xt,g,Ft)}var Ut;if(ae)e:{switch($){case"compositionstart":var Qt="onCompositionStart";break e;case"compositionend":Qt="onCompositionEnd";break e;case"compositionupdate":Qt="onCompositionUpdate";break e}Qt=void 0}else ie?ge($,g)&&(Qt="onCompositionEnd"):$==="keydown"&&g.keyCode===229&&(Qt="onCompositionStart");Qt&&(de&&g.locale!=="ko"&&(ie||Qt!=="onCompositionStart"?Qt==="onCompositionEnd"&&ie&&(Ut=nd()):(kd=Ft,ld="value"in kd?kd.value:kd.textContent,ie=!0)),_n=oe(kt,Qt),0<_n.length&&(Qt=new Ld(Qt,$,null,g,Ft),Xt.push({event:Qt,listeners:_n}),Ut?Qt.data=Ut:(Ut=he(g),Ut!==null&&(Qt.data=Ut)))),(Ut=ce?je($,g):ke($,g))&&(kt=oe(kt,"onBeforeInput"),0<kt.length&&(Ft=new Ld("onBeforeInput","beforeinput",null,g,Ft),Xt.push({event:Ft,listeners:kt}),Ft.data=Ut))}se(Xt,b)})}function tf($,b,g){return{instance:$,listener:b,currentTarget:g}}function oe($,b){for(var g=b+"Capture",tt=[];$!==null;){var ot=$,ut=ot.stateNode;ot.tag===5&&ut!==null&&(ot=ut,ut=Kb($,g),ut!=null&&tt.unshift(tf($,ut,ot)),ut=Kb($,b),ut!=null&&tt.push(tf($,ut,ot))),$=$.return}return tt}function vf($){if($===null)return null;do $=$.return;while($&&$.tag!==5);return $||null}function wf($,b,g,tt,ot){for(var ut=b._reactName,gt=[];g!==null&&g!==tt;){var xt=g,It=xt.alternate,kt=xt.stateNode;if(It!==null&&It===tt)break;xt.tag===5&&kt!==null&&(xt=kt,ot?(It=Kb(g,ut),It!=null&&gt.unshift(tf(g,It,xt))):ot||(It=Kb(g,ut),It!=null&&gt.push(tf(g,It,xt)))),g=g.return}gt.length!==0&&$.push({event:b,listeners:gt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf($){return(typeof $=="string"?$:""+$).replace(xf,`
`).replace(yf,"")}function Af($,b,g){if(b=zf(b),zf($)!==b&&g)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef($,b){return $==="textarea"||$==="noscript"||typeof b.children=="string"||typeof b.children=="number"||typeof b.dangerouslySetInnerHTML=="object"&&b.dangerouslySetInnerHTML!==null&&b.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function($){return Hf.resolve(null).then($).catch(If)}:Ff;function If($){setTimeout(function(){throw $})}function Kf($,b){var g=b,tt=0;do{var ot=g.nextSibling;if($.removeChild(g),ot&&ot.nodeType===8)if(g=ot.data,g==="/$"){if(tt===0){$.removeChild(ot),bd(b);return}tt--}else g!=="$"&&g!=="$?"&&g!=="$!"||tt++;g=ot}while(g);bd(b)}function Lf($){for(;$!=null;$=$.nextSibling){var b=$.nodeType;if(b===1||b===3)break;if(b===8){if(b=$.data,b==="$"||b==="$!"||b==="$?")break;if(b==="/$")return null}}return $}function Mf($){$=$.previousSibling;for(var b=0;$;){if($.nodeType===8){var g=$.data;if(g==="$"||g==="$!"||g==="$?"){if(b===0)return $;b--}else g==="/$"&&b++}$=$.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc($){var b=$[Of];if(b)return b;for(var g=$.parentNode;g;){if(b=g[uf]||g[Of]){if(g=b.alternate,b.child!==null||g!==null&&g.child!==null)for($=Mf($);$!==null;){if(g=$[Of])return g;$=Mf($)}return b}$=g,g=$.parentNode}return null}function Cb($){return $=$[Of]||$[uf],!$||$.tag!==5&&$.tag!==6&&$.tag!==13&&$.tag!==3?null:$}function ue($){if($.tag===5||$.tag===6)return $.stateNode;throw Error(p$1(33))}function Db($){return $[Pf]||null}var Sf=[],Tf=-1;function Uf($){return{current:$}}function E($){0>Tf||($.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G($,b){Tf++,Sf[Tf]=$.current,$.current=b}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf($,b){var g=$.type.contextTypes;if(!g)return Vf;var tt=$.stateNode;if(tt&&tt.__reactInternalMemoizedUnmaskedChildContext===b)return tt.__reactInternalMemoizedMaskedChildContext;var ot={},ut;for(ut in g)ot[ut]=b[ut];return tt&&($=$.stateNode,$.__reactInternalMemoizedUnmaskedChildContext=b,$.__reactInternalMemoizedMaskedChildContext=ot),ot}function Zf($){return $=$.childContextTypes,$!=null}function $f(){E(Wf),E(H)}function ag($,b,g){if(H.current!==Vf)throw Error(p$1(168));G(H,b),G(Wf,g)}function bg($,b,g){var tt=$.stateNode;if(b=b.childContextTypes,typeof tt.getChildContext!="function")return g;tt=tt.getChildContext();for(var ot in tt)if(!(ot in b))throw Error(p$1(108,Ra($)||"Unknown",ot));return A({},g,tt)}function cg($){return $=($=$.stateNode)&&$.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,$),G(Wf,Wf.current),!0}function dg($,b,g){var tt=$.stateNode;if(!tt)throw Error(p$1(169));g?($=bg($,b,Xf),tt.__reactInternalMemoizedMergedChildContext=$,E(Wf),E(H),G(H,$)):E(Wf),G(Wf,g)}var eg=null,fg=!1,gg=!1;function hg($){eg===null?eg=[$]:eg.push($)}function ig($){fg=!0,hg($)}function jg(){if(!gg&&eg!==null){gg=!0;var $=0,b=C;try{var g=eg;for(C=1;$<g.length;$++){var tt=g[$];do tt=tt(!0);while(tt!==null)}eg=null,fg=!1}catch(ot){throw eg!==null&&(eg=eg.slice($+1)),ac(fc,jg),ot}finally{C=b,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg($,b){kg[lg++]=ng,kg[lg++]=mg,mg=$,ng=b}function ug($,b,g){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=$;var tt=rg;$=sg;var ot=32-oc(tt)-1;tt&=~(1<<ot),g+=1;var ut=32-oc(b)+ot;if(30<ut){var gt=ot-ot%5;ut=(tt&(1<<gt)-1).toString(32),tt>>=gt,ot-=gt,rg=1<<32-oc(b)+ot|g<<ot|tt,sg=ut+$}else rg=1<<ut|g<<ot|tt,sg=$}function vg($){$.return!==null&&(tg($,1),ug($,1,0))}function wg($){for(;$===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;$===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag($,b){var g=Bg(5,null,null,0);g.elementType="DELETED",g.stateNode=b,g.return=$,b=$.deletions,b===null?($.deletions=[g],$.flags|=16):b.push(g)}function Cg($,b){switch($.tag){case 5:var g=$.type;return b=b.nodeType!==1||g.toLowerCase()!==b.nodeName.toLowerCase()?null:b,b!==null?($.stateNode=b,xg=$,yg=Lf(b.firstChild),!0):!1;case 6:return b=$.pendingProps===""||b.nodeType!==3?null:b,b!==null?($.stateNode=b,xg=$,yg=null,!0):!1;case 13:return b=b.nodeType!==8?null:b,b!==null?(g=qg!==null?{id:rg,overflow:sg}:null,$.memoizedState={dehydrated:b,treeContext:g,retryLane:1073741824},g=Bg(18,null,null,0),g.stateNode=b,g.return=$,$.child=g,xg=$,yg=null,!0):!1;default:return!1}}function Dg($){return($.mode&1)!==0&&($.flags&128)===0}function Eg($){if(I){var b=yg;if(b){var g=b;if(!Cg($,b)){if(Dg($))throw Error(p$1(418));b=Lf(g.nextSibling);var tt=xg;b&&Cg($,b)?Ag(tt,g):($.flags=$.flags&-4097|2,I=!1,xg=$)}}else{if(Dg($))throw Error(p$1(418));$.flags=$.flags&-4097|2,I=!1,xg=$}}}function Fg($){for($=$.return;$!==null&&$.tag!==5&&$.tag!==3&&$.tag!==13;)$=$.return;xg=$}function Gg($){if($!==xg)return!1;if(!I)return Fg($),I=!0,!1;var b;if((b=$.tag!==3)&&!(b=$.tag!==5)&&(b=$.type,b=b!=="head"&&b!=="body"&&!Ef($.type,$.memoizedProps)),b&&(b=yg)){if(Dg($))throw Hg(),Error(p$1(418));for(;b;)Ag($,b),b=Lf(b.nextSibling)}if(Fg($),$.tag===13){if($=$.memoizedState,$=$!==null?$.dehydrated:null,!$)throw Error(p$1(317));e:{for($=$.nextSibling,b=0;$;){if($.nodeType===8){var g=$.data;if(g==="/$"){if(b===0){yg=Lf($.nextSibling);break e}b--}else g!=="$"&&g!=="$!"&&g!=="$?"||b++}$=$.nextSibling}yg=null}}else yg=xg?Lf($.stateNode.nextSibling):null;return!0}function Hg(){for(var $=yg;$;)$=Lf($.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg($){zg===null?zg=[$]:zg.push($)}var Kg=ua.ReactCurrentBatchConfig;function Lg($,b){if($&&$.defaultProps){b=A({},b),$=$.defaultProps;for(var g in $)b[g]===void 0&&(b[g]=$[g]);return b}return b}var Mg=Uf(null),Ng=null,Og=null,Pg=null;function Qg(){Pg=Og=Ng=null}function Rg($){var b=Mg.current;E(Mg),$._currentValue=b}function Sg($,b,g){for(;$!==null;){var tt=$.alternate;if(($.childLanes&b)!==b?($.childLanes|=b,tt!==null&&(tt.childLanes|=b)):tt!==null&&(tt.childLanes&b)!==b&&(tt.childLanes|=b),$===g)break;$=$.return}}function Tg($,b){Ng=$,Pg=Og=null,$=$.dependencies,$!==null&&$.firstContext!==null&&($.lanes&b&&(Ug=!0),$.firstContext=null)}function Vg($){var b=$._currentValue;if(Pg!==$)if($={context:$,memoizedValue:b,next:null},Og===null){if(Ng===null)throw Error(p$1(308));Og=$,Ng.dependencies={lanes:0,firstContext:$}}else Og=Og.next=$;return b}var Wg=null;function Xg($){Wg===null?Wg=[$]:Wg.push($)}function Yg($,b,g,tt){var ot=b.interleaved;return ot===null?(g.next=g,Xg(b)):(g.next=ot.next,ot.next=g),b.interleaved=g,Zg($,tt)}function Zg($,b){$.lanes|=b;var g=$.alternate;for(g!==null&&(g.lanes|=b),g=$,$=$.return;$!==null;)$.childLanes|=b,g=$.alternate,g!==null&&(g.childLanes|=b),g=$,$=$.return;return g.tag===3?g.stateNode:null}var $g=!1;function ah($){$.updateQueue={baseState:$.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bh($,b){$=$.updateQueue,b.updateQueue===$&&(b.updateQueue={baseState:$.baseState,firstBaseUpdate:$.firstBaseUpdate,lastBaseUpdate:$.lastBaseUpdate,shared:$.shared,effects:$.effects})}function ch($,b){return{eventTime:$,lane:b,tag:0,payload:null,callback:null,next:null}}function dh($,b,g){var tt=$.updateQueue;if(tt===null)return null;if(tt=tt.shared,K&2){var ot=tt.pending;return ot===null?b.next=b:(b.next=ot.next,ot.next=b),tt.pending=b,Zg($,g)}return ot=tt.interleaved,ot===null?(b.next=b,Xg(tt)):(b.next=ot.next,ot.next=b),tt.interleaved=b,Zg($,g)}function eh($,b,g){if(b=b.updateQueue,b!==null&&(b=b.shared,(g&4194240)!==0)){var tt=b.lanes;tt&=$.pendingLanes,g|=tt,b.lanes=g,Cc($,g)}}function fh($,b){var g=$.updateQueue,tt=$.alternate;if(tt!==null&&(tt=tt.updateQueue,g===tt)){var ot=null,ut=null;if(g=g.firstBaseUpdate,g!==null){do{var gt={eventTime:g.eventTime,lane:g.lane,tag:g.tag,payload:g.payload,callback:g.callback,next:null};ut===null?ot=ut=gt:ut=ut.next=gt,g=g.next}while(g!==null);ut===null?ot=ut=b:ut=ut.next=b}else ot=ut=b;g={baseState:tt.baseState,firstBaseUpdate:ot,lastBaseUpdate:ut,shared:tt.shared,effects:tt.effects},$.updateQueue=g;return}$=g.lastBaseUpdate,$===null?g.firstBaseUpdate=b:$.next=b,g.lastBaseUpdate=b}function gh($,b,g,tt){var ot=$.updateQueue;$g=!1;var ut=ot.firstBaseUpdate,gt=ot.lastBaseUpdate,xt=ot.shared.pending;if(xt!==null){ot.shared.pending=null;var It=xt,kt=It.next;It.next=null,gt===null?ut=kt:gt.next=kt,gt=It;var Ft=$.alternate;Ft!==null&&(Ft=Ft.updateQueue,xt=Ft.lastBaseUpdate,xt!==gt&&(xt===null?Ft.firstBaseUpdate=kt:xt.next=kt,Ft.lastBaseUpdate=It))}if(ut!==null){var Xt=ot.baseState;gt=0,Ft=kt=It=null,xt=ut;do{var qt=xt.lane,jt=xt.eventTime;if((tt&qt)===qt){Ft!==null&&(Ft=Ft.next={eventTime:jt,lane:0,tag:xt.tag,payload:xt.payload,callback:xt.callback,next:null});e:{var sn=$,Gt=xt;switch(qt=b,jt=g,Gt.tag){case 1:if(sn=Gt.payload,typeof sn=="function"){Xt=sn.call(jt,Xt,qt);break e}Xt=sn;break e;case 3:sn.flags=sn.flags&-65537|128;case 0:if(sn=Gt.payload,qt=typeof sn=="function"?sn.call(jt,Xt,qt):sn,qt==null)break e;Xt=A({},Xt,qt);break e;case 2:$g=!0}}xt.callback!==null&&xt.lane!==0&&($.flags|=64,qt=ot.effects,qt===null?ot.effects=[xt]:qt.push(xt))}else jt={eventTime:jt,lane:qt,tag:xt.tag,payload:xt.payload,callback:xt.callback,next:null},Ft===null?(kt=Ft=jt,It=Xt):Ft=Ft.next=jt,gt|=qt;if(xt=xt.next,xt===null){if(xt=ot.shared.pending,xt===null)break;qt=xt,xt=qt.next,qt.next=null,ot.lastBaseUpdate=qt,ot.shared.pending=null}}while(!0);if(Ft===null&&(It=Xt),ot.baseState=It,ot.firstBaseUpdate=kt,ot.lastBaseUpdate=Ft,b=ot.shared.interleaved,b!==null){ot=b;do gt|=ot.lane,ot=ot.next;while(ot!==b)}else ut===null&&(ot.shared.lanes=0);hh|=gt,$.lanes=gt,$.memoizedState=Xt}}function ih($,b,g){if($=b.effects,b.effects=null,$!==null)for(b=0;b<$.length;b++){var tt=$[b],ot=tt.callback;if(ot!==null){if(tt.callback=null,tt=g,typeof ot!="function")throw Error(p$1(191,ot));ot.call(tt)}}}var jh=new aa.Component().refs;function kh($,b,g,tt){b=$.memoizedState,g=g(tt,b),g=g==null?b:A({},b,g),$.memoizedState=g,$.lanes===0&&($.updateQueue.baseState=g)}var nh={isMounted:function($){return($=$._reactInternals)?Vb($)===$:!1},enqueueSetState:function($,b,g){$=$._reactInternals;var tt=L(),ot=lh($),ut=ch(tt,ot);ut.payload=b,g!=null&&(ut.callback=g),b=dh($,ut,ot),b!==null&&(mh(b,$,ot,tt),eh(b,$,ot))},enqueueReplaceState:function($,b,g){$=$._reactInternals;var tt=L(),ot=lh($),ut=ch(tt,ot);ut.tag=1,ut.payload=b,g!=null&&(ut.callback=g),b=dh($,ut,ot),b!==null&&(mh(b,$,ot,tt),eh(b,$,ot))},enqueueForceUpdate:function($,b){$=$._reactInternals;var g=L(),tt=lh($),ot=ch(g,tt);ot.tag=2,b!=null&&(ot.callback=b),b=dh($,ot,tt),b!==null&&(mh(b,$,tt,g),eh(b,$,tt))}};function oh($,b,g,tt,ot,ut,gt){return $=$.stateNode,typeof $.shouldComponentUpdate=="function"?$.shouldComponentUpdate(tt,ut,gt):b.prototype&&b.prototype.isPureReactComponent?!Ie(g,tt)||!Ie(ot,ut):!0}function ph($,b,g){var tt=!1,ot=Vf,ut=b.contextType;return typeof ut=="object"&&ut!==null?ut=Vg(ut):(ot=Zf(b)?Xf:H.current,tt=b.contextTypes,ut=(tt=tt!=null)?Yf($,ot):Vf),b=new b(g,ut),$.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=nh,$.stateNode=b,b._reactInternals=$,tt&&($=$.stateNode,$.__reactInternalMemoizedUnmaskedChildContext=ot,$.__reactInternalMemoizedMaskedChildContext=ut),b}function qh($,b,g,tt){$=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(g,tt),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(g,tt),b.state!==$&&nh.enqueueReplaceState(b,b.state,null)}function rh($,b,g,tt){var ot=$.stateNode;ot.props=g,ot.state=$.memoizedState,ot.refs=jh,ah($);var ut=b.contextType;typeof ut=="object"&&ut!==null?ot.context=Vg(ut):(ut=Zf(b)?Xf:H.current,ot.context=Yf($,ut)),ot.state=$.memoizedState,ut=b.getDerivedStateFromProps,typeof ut=="function"&&(kh($,b,ut,g),ot.state=$.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof ot.getSnapshotBeforeUpdate=="function"||typeof ot.UNSAFE_componentWillMount!="function"&&typeof ot.componentWillMount!="function"||(b=ot.state,typeof ot.componentWillMount=="function"&&ot.componentWillMount(),typeof ot.UNSAFE_componentWillMount=="function"&&ot.UNSAFE_componentWillMount(),b!==ot.state&&nh.enqueueReplaceState(ot,ot.state,null),gh($,g,ot,tt),ot.state=$.memoizedState),typeof ot.componentDidMount=="function"&&($.flags|=4194308)}function sh($,b,g){if($=g.ref,$!==null&&typeof $!="function"&&typeof $!="object"){if(g._owner){if(g=g._owner,g){if(g.tag!==1)throw Error(p$1(309));var tt=g.stateNode}if(!tt)throw Error(p$1(147,$));var ot=tt,ut=""+$;return b!==null&&b.ref!==null&&typeof b.ref=="function"&&b.ref._stringRef===ut?b.ref:(b=function(gt){var xt=ot.refs;xt===jh&&(xt=ot.refs={}),gt===null?delete xt[ut]:xt[ut]=gt},b._stringRef=ut,b)}if(typeof $!="string")throw Error(p$1(284));if(!g._owner)throw Error(p$1(290,$))}return $}function th($,b){throw $=Object.prototype.toString.call(b),Error(p$1(31,$==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":$))}function uh($){var b=$._init;return b($._payload)}function vh($){function b(nn,Wt){if($){var on=nn.deletions;on===null?(nn.deletions=[Wt],nn.flags|=16):on.push(Wt)}}function g(nn,Wt){if(!$)return null;for(;Wt!==null;)b(nn,Wt),Wt=Wt.sibling;return null}function tt(nn,Wt){for(nn=new Map;Wt!==null;)Wt.key!==null?nn.set(Wt.key,Wt):nn.set(Wt.index,Wt),Wt=Wt.sibling;return nn}function ot(nn,Wt){return nn=wh(nn,Wt),nn.index=0,nn.sibling=null,nn}function ut(nn,Wt,on){return nn.index=on,$?(on=nn.alternate,on!==null?(on=on.index,on<Wt?(nn.flags|=2,Wt):on):(nn.flags|=2,Wt)):(nn.flags|=1048576,Wt)}function gt(nn){return $&&nn.alternate===null&&(nn.flags|=2),nn}function xt(nn,Wt,on,gn){return Wt===null||Wt.tag!==6?(Wt=xh(on,nn.mode,gn),Wt.return=nn,Wt):(Wt=ot(Wt,on),Wt.return=nn,Wt)}function It(nn,Wt,on,gn){var ln=on.type;return ln===ya?Ft(nn,Wt,on.props.children,gn,on.key):Wt!==null&&(Wt.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===Ha&&uh(ln)===Wt.type)?(gn=ot(Wt,on.props),gn.ref=sh(nn,Wt,on),gn.return=nn,gn):(gn=yh(on.type,on.key,on.props,null,nn.mode,gn),gn.ref=sh(nn,Wt,on),gn.return=nn,gn)}function kt(nn,Wt,on,gn){return Wt===null||Wt.tag!==4||Wt.stateNode.containerInfo!==on.containerInfo||Wt.stateNode.implementation!==on.implementation?(Wt=zh(on,nn.mode,gn),Wt.return=nn,Wt):(Wt=ot(Wt,on.children||[]),Wt.return=nn,Wt)}function Ft(nn,Wt,on,gn,ln){return Wt===null||Wt.tag!==7?(Wt=Ah(on,nn.mode,gn,ln),Wt.return=nn,Wt):(Wt=ot(Wt,on),Wt.return=nn,Wt)}function Xt(nn,Wt,on){if(typeof Wt=="string"&&Wt!==""||typeof Wt=="number")return Wt=xh(""+Wt,nn.mode,on),Wt.return=nn,Wt;if(typeof Wt=="object"&&Wt!==null){switch(Wt.$$typeof){case va:return on=yh(Wt.type,Wt.key,Wt.props,null,nn.mode,on),on.ref=sh(nn,null,Wt),on.return=nn,on;case wa:return Wt=zh(Wt,nn.mode,on),Wt.return=nn,Wt;case Ha:var gn=Wt._init;return Xt(nn,gn(Wt._payload),on)}if(eb(Wt)||Ka(Wt))return Wt=Ah(Wt,nn.mode,on,null),Wt.return=nn,Wt;th(nn,Wt)}return null}function qt(nn,Wt,on,gn){var ln=Wt!==null?Wt.key:null;if(typeof on=="string"&&on!==""||typeof on=="number")return ln!==null?null:xt(nn,Wt,""+on,gn);if(typeof on=="object"&&on!==null){switch(on.$$typeof){case va:return on.key===ln?It(nn,Wt,on,gn):null;case wa:return on.key===ln?kt(nn,Wt,on,gn):null;case Ha:return ln=on._init,qt(nn,Wt,ln(on._payload),gn)}if(eb(on)||Ka(on))return ln!==null?null:Ft(nn,Wt,on,gn,null);th(nn,on)}return null}function jt(nn,Wt,on,gn,ln){if(typeof gn=="string"&&gn!==""||typeof gn=="number")return nn=nn.get(on)||null,xt(Wt,nn,""+gn,ln);if(typeof gn=="object"&&gn!==null){switch(gn.$$typeof){case va:return nn=nn.get(gn.key===null?on:gn.key)||null,It(Wt,nn,gn,ln);case wa:return nn=nn.get(gn.key===null?on:gn.key)||null,kt(Wt,nn,gn,ln);case Ha:var _n=gn._init;return jt(nn,Wt,on,_n(gn._payload),ln)}if(eb(gn)||Ka(gn))return nn=nn.get(on)||null,Ft(Wt,nn,gn,ln,null);th(Wt,gn)}return null}function sn(nn,Wt,on,gn){for(var ln=null,_n=null,Ut=Wt,Qt=Wt=0,tn=null;Ut!==null&&Qt<on.length;Qt++){Ut.index>Qt?(tn=Ut,Ut=null):tn=Ut.sibling;var bn=qt(nn,Ut,on[Qt],gn);if(bn===null){Ut===null&&(Ut=tn);break}$&&Ut&&bn.alternate===null&&b(nn,Ut),Wt=ut(bn,Wt,Qt),_n===null?ln=bn:_n.sibling=bn,_n=bn,Ut=tn}if(Qt===on.length)return g(nn,Ut),I&&tg(nn,Qt),ln;if(Ut===null){for(;Qt<on.length;Qt++)Ut=Xt(nn,on[Qt],gn),Ut!==null&&(Wt=ut(Ut,Wt,Qt),_n===null?ln=Ut:_n.sibling=Ut,_n=Ut);return I&&tg(nn,Qt),ln}for(Ut=tt(nn,Ut);Qt<on.length;Qt++)tn=jt(Ut,nn,Qt,on[Qt],gn),tn!==null&&($&&tn.alternate!==null&&Ut.delete(tn.key===null?Qt:tn.key),Wt=ut(tn,Wt,Qt),_n===null?ln=tn:_n.sibling=tn,_n=tn);return $&&Ut.forEach(function(Yt){return b(nn,Yt)}),I&&tg(nn,Qt),ln}function Gt(nn,Wt,on,gn){var ln=Ka(on);if(typeof ln!="function")throw Error(p$1(150));if(on=ln.call(on),on==null)throw Error(p$1(151));for(var _n=ln=null,Ut=Wt,Qt=Wt=0,tn=null,bn=on.next();Ut!==null&&!bn.done;Qt++,bn=on.next()){Ut.index>Qt?(tn=Ut,Ut=null):tn=Ut.sibling;var Yt=qt(nn,Ut,bn.value,gn);if(Yt===null){Ut===null&&(Ut=tn);break}$&&Ut&&Yt.alternate===null&&b(nn,Ut),Wt=ut(Yt,Wt,Qt),_n===null?ln=Yt:_n.sibling=Yt,_n=Yt,Ut=tn}if(bn.done)return g(nn,Ut),I&&tg(nn,Qt),ln;if(Ut===null){for(;!bn.done;Qt++,bn=on.next())bn=Xt(nn,bn.value,gn),bn!==null&&(Wt=ut(bn,Wt,Qt),_n===null?ln=bn:_n.sibling=bn,_n=bn);return I&&tg(nn,Qt),ln}for(Ut=tt(nn,Ut);!bn.done;Qt++,bn=on.next())bn=jt(Ut,nn,Qt,bn.value,gn),bn!==null&&($&&bn.alternate!==null&&Ut.delete(bn.key===null?Qt:bn.key),Wt=ut(bn,Wt,Qt),_n===null?ln=bn:_n.sibling=bn,_n=bn);return $&&Ut.forEach(function(en){return b(nn,en)}),I&&tg(nn,Qt),ln}function vn(nn,Wt,on,gn){if(typeof on=="object"&&on!==null&&on.type===ya&&on.key===null&&(on=on.props.children),typeof on=="object"&&on!==null){switch(on.$$typeof){case va:e:{for(var ln=on.key,_n=Wt;_n!==null;){if(_n.key===ln){if(ln=on.type,ln===ya){if(_n.tag===7){g(nn,_n.sibling),Wt=ot(_n,on.props.children),Wt.return=nn,nn=Wt;break e}}else if(_n.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===Ha&&uh(ln)===_n.type){g(nn,_n.sibling),Wt=ot(_n,on.props),Wt.ref=sh(nn,_n,on),Wt.return=nn,nn=Wt;break e}g(nn,_n);break}else b(nn,_n);_n=_n.sibling}on.type===ya?(Wt=Ah(on.props.children,nn.mode,gn,on.key),Wt.return=nn,nn=Wt):(gn=yh(on.type,on.key,on.props,null,nn.mode,gn),gn.ref=sh(nn,Wt,on),gn.return=nn,nn=gn)}return gt(nn);case wa:e:{for(_n=on.key;Wt!==null;){if(Wt.key===_n)if(Wt.tag===4&&Wt.stateNode.containerInfo===on.containerInfo&&Wt.stateNode.implementation===on.implementation){g(nn,Wt.sibling),Wt=ot(Wt,on.children||[]),Wt.return=nn,nn=Wt;break e}else{g(nn,Wt);break}else b(nn,Wt);Wt=Wt.sibling}Wt=zh(on,nn.mode,gn),Wt.return=nn,nn=Wt}return gt(nn);case Ha:return _n=on._init,vn(nn,Wt,_n(on._payload),gn)}if(eb(on))return sn(nn,Wt,on,gn);if(Ka(on))return Gt(nn,Wt,on,gn);th(nn,on)}return typeof on=="string"&&on!==""||typeof on=="number"?(on=""+on,Wt!==null&&Wt.tag===6?(g(nn,Wt.sibling),Wt=ot(Wt,on),Wt.return=nn,nn=Wt):(g(nn,Wt),Wt=xh(on,nn.mode,gn),Wt.return=nn,nn=Wt),gt(nn)):g(nn,Wt)}return vn}var Bh=vh(!0),Ch=vh(!1),Dh={},Eh=Uf(Dh),Fh=Uf(Dh),Gh=Uf(Dh);function Hh($){if($===Dh)throw Error(p$1(174));return $}function Ih($,b){switch(G(Gh,b),G(Fh,$),G(Eh,Dh),$=b.nodeType,$){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:lb(null,"");break;default:$=$===8?b.parentNode:b,b=$.namespaceURI||null,$=$.tagName,b=lb(b,$)}E(Eh),G(Eh,b)}function Jh(){E(Eh),E(Fh),E(Gh)}function Kh($){Hh(Gh.current);var b=Hh(Eh.current),g=lb(b,$.type);b!==g&&(G(Fh,$),G(Eh,g))}function Lh($){Fh.current===$&&(E(Eh),E(Fh))}var M=Uf(0);function Mh($){for(var b=$;b!==null;){if(b.tag===13){var g=b.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||g.data==="$?"||g.data==="$!"))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if(b.flags&128)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===$)break;for(;b.sibling===null;){if(b.return===null||b.return===$)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var Nh=[];function Oh(){for(var $=0;$<Nh.length;$++)Nh[$]._workInProgressVersionPrimary=null;Nh.length=0}var Ph=ua.ReactCurrentDispatcher,Qh=ua.ReactCurrentBatchConfig,Rh=0,N=null,O=null,P=null,Sh=!1,Th=!1,Uh=0,Vh=0;function Q(){throw Error(p$1(321))}function Wh($,b){if(b===null)return!1;for(var g=0;g<b.length&&g<$.length;g++)if(!He($[g],b[g]))return!1;return!0}function Xh($,b,g,tt,ot,ut){if(Rh=ut,N=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,Ph.current=$===null||$.memoizedState===null?Yh:Zh,$=g(tt,ot),Th){ut=0;do{if(Th=!1,Uh=0,25<=ut)throw Error(p$1(301));ut+=1,P=O=null,b.updateQueue=null,Ph.current=$h,$=g(tt,ot)}while(Th)}if(Ph.current=ai,b=O!==null&&O.next!==null,Rh=0,P=O=N=null,Sh=!1,b)throw Error(p$1(300));return $}function bi(){var $=Uh!==0;return Uh=0,$}function ci(){var $={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return P===null?N.memoizedState=P=$:P=P.next=$,P}function di(){if(O===null){var $=N.alternate;$=$!==null?$.memoizedState:null}else $=O.next;var b=P===null?N.memoizedState:P.next;if(b!==null)P=b,O=$;else{if($===null)throw Error(p$1(310));O=$,$={memoizedState:O.memoizedState,baseState:O.baseState,baseQueue:O.baseQueue,queue:O.queue,next:null},P===null?N.memoizedState=P=$:P=P.next=$}return P}function ei($,b){return typeof b=="function"?b($):b}function fi($){var b=di(),g=b.queue;if(g===null)throw Error(p$1(311));g.lastRenderedReducer=$;var tt=O,ot=tt.baseQueue,ut=g.pending;if(ut!==null){if(ot!==null){var gt=ot.next;ot.next=ut.next,ut.next=gt}tt.baseQueue=ot=ut,g.pending=null}if(ot!==null){ut=ot.next,tt=tt.baseState;var xt=gt=null,It=null,kt=ut;do{var Ft=kt.lane;if((Rh&Ft)===Ft)It!==null&&(It=It.next={lane:0,action:kt.action,hasEagerState:kt.hasEagerState,eagerState:kt.eagerState,next:null}),tt=kt.hasEagerState?kt.eagerState:$(tt,kt.action);else{var Xt={lane:Ft,action:kt.action,hasEagerState:kt.hasEagerState,eagerState:kt.eagerState,next:null};It===null?(xt=It=Xt,gt=tt):It=It.next=Xt,N.lanes|=Ft,hh|=Ft}kt=kt.next}while(kt!==null&&kt!==ut);It===null?gt=tt:It.next=xt,He(tt,b.memoizedState)||(Ug=!0),b.memoizedState=tt,b.baseState=gt,b.baseQueue=It,g.lastRenderedState=tt}if($=g.interleaved,$!==null){ot=$;do ut=ot.lane,N.lanes|=ut,hh|=ut,ot=ot.next;while(ot!==$)}else ot===null&&(g.lanes=0);return[b.memoizedState,g.dispatch]}function gi($){var b=di(),g=b.queue;if(g===null)throw Error(p$1(311));g.lastRenderedReducer=$;var tt=g.dispatch,ot=g.pending,ut=b.memoizedState;if(ot!==null){g.pending=null;var gt=ot=ot.next;do ut=$(ut,gt.action),gt=gt.next;while(gt!==ot);He(ut,b.memoizedState)||(Ug=!0),b.memoizedState=ut,b.baseQueue===null&&(b.baseState=ut),g.lastRenderedState=ut}return[ut,tt]}function hi(){}function ii($,b){var g=N,tt=di(),ot=b(),ut=!He(tt.memoizedState,ot);if(ut&&(tt.memoizedState=ot,Ug=!0),tt=tt.queue,ji(ki.bind(null,g,tt,$),[$]),tt.getSnapshot!==b||ut||P!==null&&P.memoizedState.tag&1){if(g.flags|=2048,li(9,mi.bind(null,g,tt,ot,b),void 0,null),R===null)throw Error(p$1(349));Rh&30||ni(g,b,ot)}return ot}function ni($,b,g){$.flags|=16384,$={getSnapshot:b,value:g},b=N.updateQueue,b===null?(b={lastEffect:null,stores:null},N.updateQueue=b,b.stores=[$]):(g=b.stores,g===null?b.stores=[$]:g.push($))}function mi($,b,g,tt){b.value=g,b.getSnapshot=tt,oi(b)&&pi($)}function ki($,b,g){return g(function(){oi(b)&&pi($)})}function oi($){var b=$.getSnapshot;$=$.value;try{var g=b();return!He($,g)}catch{return!0}}function pi($){var b=Zg($,1);b!==null&&mh(b,$,1,-1)}function qi($){var b=ci();return typeof $=="function"&&($=$()),b.memoizedState=b.baseState=$,$={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:$},b.queue=$,$=$.dispatch=ri.bind(null,N,$),[b.memoizedState,$]}function li($,b,g,tt){return $={tag:$,create:b,destroy:g,deps:tt,next:null},b=N.updateQueue,b===null?(b={lastEffect:null,stores:null},N.updateQueue=b,b.lastEffect=$.next=$):(g=b.lastEffect,g===null?b.lastEffect=$.next=$:(tt=g.next,g.next=$,$.next=tt,b.lastEffect=$)),$}function si(){return di().memoizedState}function ti($,b,g,tt){var ot=ci();N.flags|=$,ot.memoizedState=li(1|b,g,void 0,tt===void 0?null:tt)}function ui($,b,g,tt){var ot=di();tt=tt===void 0?null:tt;var ut=void 0;if(O!==null){var gt=O.memoizedState;if(ut=gt.destroy,tt!==null&&Wh(tt,gt.deps)){ot.memoizedState=li(b,g,ut,tt);return}}N.flags|=$,ot.memoizedState=li(1|b,g,ut,tt)}function vi($,b){return ti(8390656,8,$,b)}function ji($,b){return ui(2048,8,$,b)}function wi($,b){return ui(4,2,$,b)}function xi($,b){return ui(4,4,$,b)}function yi($,b){if(typeof b=="function")return $=$(),b($),function(){b(null)};if(b!=null)return $=$(),b.current=$,function(){b.current=null}}function zi($,b,g){return g=g!=null?g.concat([$]):null,ui(4,4,yi.bind(null,b,$),g)}function Ai(){}function Bi($,b){var g=di();b=b===void 0?null:b;var tt=g.memoizedState;return tt!==null&&b!==null&&Wh(b,tt[1])?tt[0]:(g.memoizedState=[$,b],$)}function Ci($,b){var g=di();b=b===void 0?null:b;var tt=g.memoizedState;return tt!==null&&b!==null&&Wh(b,tt[1])?tt[0]:($=$(),g.memoizedState=[$,b],$)}function Di($,b,g){return Rh&21?(He(g,b)||(g=yc(),N.lanes|=g,hh|=g,$.baseState=!0),b):($.baseState&&($.baseState=!1,Ug=!0),$.memoizedState=g)}function Ei($,b){var g=C;C=g!==0&&4>g?g:4,$(!0);var tt=Qh.transition;Qh.transition={};try{$(!1),b()}finally{C=g,Qh.transition=tt}}function Fi(){return di().memoizedState}function Gi($,b,g){var tt=lh($);if(g={lane:tt,action:g,hasEagerState:!1,eagerState:null,next:null},Hi($))Ii(b,g);else if(g=Yg($,b,g,tt),g!==null){var ot=L();mh(g,$,tt,ot),Ji(g,b,tt)}}function ri($,b,g){var tt=lh($),ot={lane:tt,action:g,hasEagerState:!1,eagerState:null,next:null};if(Hi($))Ii(b,ot);else{var ut=$.alternate;if($.lanes===0&&(ut===null||ut.lanes===0)&&(ut=b.lastRenderedReducer,ut!==null))try{var gt=b.lastRenderedState,xt=ut(gt,g);if(ot.hasEagerState=!0,ot.eagerState=xt,He(xt,gt)){var It=b.interleaved;It===null?(ot.next=ot,Xg(b)):(ot.next=It.next,It.next=ot),b.interleaved=ot;return}}catch{}finally{}g=Yg($,b,ot,tt),g!==null&&(ot=L(),mh(g,$,tt,ot),Ji(g,b,tt))}}function Hi($){var b=$.alternate;return $===N||b!==null&&b===N}function Ii($,b){Th=Sh=!0;var g=$.pending;g===null?b.next=b:(b.next=g.next,g.next=b),$.pending=b}function Ji($,b,g){if(g&4194240){var tt=b.lanes;tt&=$.pendingLanes,g|=tt,b.lanes=g,Cc($,g)}}var ai={readContext:Vg,useCallback:Q,useContext:Q,useEffect:Q,useImperativeHandle:Q,useInsertionEffect:Q,useLayoutEffect:Q,useMemo:Q,useReducer:Q,useRef:Q,useState:Q,useDebugValue:Q,useDeferredValue:Q,useTransition:Q,useMutableSource:Q,useSyncExternalStore:Q,useId:Q,unstable_isNewReconciler:!1},Yh={readContext:Vg,useCallback:function($,b){return ci().memoizedState=[$,b===void 0?null:b],$},useContext:Vg,useEffect:vi,useImperativeHandle:function($,b,g){return g=g!=null?g.concat([$]):null,ti(4194308,4,yi.bind(null,b,$),g)},useLayoutEffect:function($,b){return ti(4194308,4,$,b)},useInsertionEffect:function($,b){return ti(4,2,$,b)},useMemo:function($,b){var g=ci();return b=b===void 0?null:b,$=$(),g.memoizedState=[$,b],$},useReducer:function($,b,g){var tt=ci();return b=g!==void 0?g(b):b,tt.memoizedState=tt.baseState=b,$={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$,lastRenderedState:b},tt.queue=$,$=$.dispatch=Gi.bind(null,N,$),[tt.memoizedState,$]},useRef:function($){var b=ci();return $={current:$},b.memoizedState=$},useState:qi,useDebugValue:Ai,useDeferredValue:function($){return ci().memoizedState=$},useTransition:function(){var $=qi(!1),b=$[0];return $=Ei.bind(null,$[1]),ci().memoizedState=$,[b,$]},useMutableSource:function(){},useSyncExternalStore:function($,b,g){var tt=N,ot=ci();if(I){if(g===void 0)throw Error(p$1(407));g=g()}else{if(g=b(),R===null)throw Error(p$1(349));Rh&30||ni(tt,b,g)}ot.memoizedState=g;var ut={value:g,getSnapshot:b};return ot.queue=ut,vi(ki.bind(null,tt,ut,$),[$]),tt.flags|=2048,li(9,mi.bind(null,tt,ut,g,b),void 0,null),g},useId:function(){var $=ci(),b=R.identifierPrefix;if(I){var g=sg,tt=rg;g=(tt&~(1<<32-oc(tt)-1)).toString(32)+g,b=":"+b+"R"+g,g=Uh++,0<g&&(b+="H"+g.toString(32)),b+=":"}else g=Vh++,b=":"+b+"r"+g.toString(32)+":";return $.memoizedState=b},unstable_isNewReconciler:!1},Zh={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:fi,useRef:si,useState:function(){return fi(ei)},useDebugValue:Ai,useDeferredValue:function($){var b=di();return Di(b,O.memoizedState,$)},useTransition:function(){var $=fi(ei)[0],b=di().memoizedState;return[$,b]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1},$h={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:gi,useRef:si,useState:function(){return gi(ei)},useDebugValue:Ai,useDeferredValue:function($){var b=di();return O===null?b.memoizedState=$:Di(b,O.memoizedState,$)},useTransition:function(){var $=gi(ei)[0],b=di().memoizedState;return[$,b]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1};function Ki($,b){try{var g="",tt=b;do g+=Pa(tt),tt=tt.return;while(tt);var ot=g}catch(ut){ot=`
Error generating stack: `+ut.message+`
`+ut.stack}return{value:$,source:b,stack:ot,digest:null}}function Li($,b,g){return{value:$,source:null,stack:g??null,digest:b??null}}function Mi($,b){try{console.error(b.value)}catch(g){setTimeout(function(){throw g})}}var Ni=typeof WeakMap=="function"?WeakMap:Map;function Oi($,b,g){g=ch(-1,g),g.tag=3,g.payload={element:null};var tt=b.value;return g.callback=function(){Pi||(Pi=!0,Qi=tt),Mi($,b)},g}function Ri($,b,g){g=ch(-1,g),g.tag=3;var tt=$.type.getDerivedStateFromError;if(typeof tt=="function"){var ot=b.value;g.payload=function(){return tt(ot)},g.callback=function(){Mi($,b)}}var ut=$.stateNode;return ut!==null&&typeof ut.componentDidCatch=="function"&&(g.callback=function(){Mi($,b),typeof tt!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var gt=b.stack;this.componentDidCatch(b.value,{componentStack:gt!==null?gt:""})}),g}function Ti($,b,g){var tt=$.pingCache;if(tt===null){tt=$.pingCache=new Ni;var ot=new Set;tt.set(b,ot)}else ot=tt.get(b),ot===void 0&&(ot=new Set,tt.set(b,ot));ot.has(g)||(ot.add(g),$=Ui.bind(null,$,b,g),b.then($,$))}function Vi($){do{var b;if((b=$.tag===13)&&(b=$.memoizedState,b=b!==null?b.dehydrated!==null:!0),b)return $;$=$.return}while($!==null);return null}function Wi($,b,g,tt,ot){return $.mode&1?($.flags|=65536,$.lanes=ot,$):($===b?$.flags|=65536:($.flags|=128,g.flags|=131072,g.flags&=-52805,g.tag===1&&(g.alternate===null?g.tag=17:(b=ch(-1,1),b.tag=2,dh(g,b,1))),g.lanes|=1),$)}var Xi=ua.ReactCurrentOwner,Ug=!1;function Yi($,b,g,tt){b.child=$===null?Ch(b,null,g,tt):Bh(b,$.child,g,tt)}function Zi($,b,g,tt,ot){g=g.render;var ut=b.ref;return Tg(b,ot),tt=Xh($,b,g,tt,ut,ot),g=bi(),$!==null&&!Ug?(b.updateQueue=$.updateQueue,b.flags&=-2053,$.lanes&=~ot,$i($,b,ot)):(I&&g&&vg(b),b.flags|=1,Yi($,b,tt,ot),b.child)}function aj($,b,g,tt,ot){if($===null){var ut=g.type;return typeof ut=="function"&&!bj(ut)&&ut.defaultProps===void 0&&g.compare===null&&g.defaultProps===void 0?(b.tag=15,b.type=ut,cj($,b,ut,tt,ot)):($=yh(g.type,null,tt,b,b.mode,ot),$.ref=b.ref,$.return=b,b.child=$)}if(ut=$.child,!($.lanes&ot)){var gt=ut.memoizedProps;if(g=g.compare,g=g!==null?g:Ie,g(gt,tt)&&$.ref===b.ref)return $i($,b,ot)}return b.flags|=1,$=wh(ut,tt),$.ref=b.ref,$.return=b,b.child=$}function cj($,b,g,tt,ot){if($!==null){var ut=$.memoizedProps;if(Ie(ut,tt)&&$.ref===b.ref)if(Ug=!1,b.pendingProps=tt=ut,($.lanes&ot)!==0)$.flags&131072&&(Ug=!0);else return b.lanes=$.lanes,$i($,b,ot)}return dj($,b,g,tt,ot)}function ej($,b,g){var tt=b.pendingProps,ot=tt.children,ut=$!==null?$.memoizedState:null;if(tt.mode==="hidden")if(!(b.mode&1))b.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(fj,gj),gj|=g;else{if(!(g&1073741824))return $=ut!==null?ut.baseLanes|g:g,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:$,cachePool:null,transitions:null},b.updateQueue=null,G(fj,gj),gj|=$,null;b.memoizedState={baseLanes:0,cachePool:null,transitions:null},tt=ut!==null?ut.baseLanes:g,G(fj,gj),gj|=tt}else ut!==null?(tt=ut.baseLanes|g,b.memoizedState=null):tt=g,G(fj,gj),gj|=tt;return Yi($,b,ot,g),b.child}function hj($,b){var g=b.ref;($===null&&g!==null||$!==null&&$.ref!==g)&&(b.flags|=512,b.flags|=2097152)}function dj($,b,g,tt,ot){var ut=Zf(g)?Xf:H.current;return ut=Yf(b,ut),Tg(b,ot),g=Xh($,b,g,tt,ut,ot),tt=bi(),$!==null&&!Ug?(b.updateQueue=$.updateQueue,b.flags&=-2053,$.lanes&=~ot,$i($,b,ot)):(I&&tt&&vg(b),b.flags|=1,Yi($,b,g,ot),b.child)}function ij($,b,g,tt,ot){if(Zf(g)){var ut=!0;cg(b)}else ut=!1;if(Tg(b,ot),b.stateNode===null)jj($,b),ph(b,g,tt),rh(b,g,tt,ot),tt=!0;else if($===null){var gt=b.stateNode,xt=b.memoizedProps;gt.props=xt;var It=gt.context,kt=g.contextType;typeof kt=="object"&&kt!==null?kt=Vg(kt):(kt=Zf(g)?Xf:H.current,kt=Yf(b,kt));var Ft=g.getDerivedStateFromProps,Xt=typeof Ft=="function"||typeof gt.getSnapshotBeforeUpdate=="function";Xt||typeof gt.UNSAFE_componentWillReceiveProps!="function"&&typeof gt.componentWillReceiveProps!="function"||(xt!==tt||It!==kt)&&qh(b,gt,tt,kt),$g=!1;var qt=b.memoizedState;gt.state=qt,gh(b,tt,gt,ot),It=b.memoizedState,xt!==tt||qt!==It||Wf.current||$g?(typeof Ft=="function"&&(kh(b,g,Ft,tt),It=b.memoizedState),(xt=$g||oh(b,g,xt,tt,qt,It,kt))?(Xt||typeof gt.UNSAFE_componentWillMount!="function"&&typeof gt.componentWillMount!="function"||(typeof gt.componentWillMount=="function"&&gt.componentWillMount(),typeof gt.UNSAFE_componentWillMount=="function"&&gt.UNSAFE_componentWillMount()),typeof gt.componentDidMount=="function"&&(b.flags|=4194308)):(typeof gt.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=tt,b.memoizedState=It),gt.props=tt,gt.state=It,gt.context=kt,tt=xt):(typeof gt.componentDidMount=="function"&&(b.flags|=4194308),tt=!1)}else{gt=b.stateNode,bh($,b),xt=b.memoizedProps,kt=b.type===b.elementType?xt:Lg(b.type,xt),gt.props=kt,Xt=b.pendingProps,qt=gt.context,It=g.contextType,typeof It=="object"&&It!==null?It=Vg(It):(It=Zf(g)?Xf:H.current,It=Yf(b,It));var jt=g.getDerivedStateFromProps;(Ft=typeof jt=="function"||typeof gt.getSnapshotBeforeUpdate=="function")||typeof gt.UNSAFE_componentWillReceiveProps!="function"&&typeof gt.componentWillReceiveProps!="function"||(xt!==Xt||qt!==It)&&qh(b,gt,tt,It),$g=!1,qt=b.memoizedState,gt.state=qt,gh(b,tt,gt,ot);var sn=b.memoizedState;xt!==Xt||qt!==sn||Wf.current||$g?(typeof jt=="function"&&(kh(b,g,jt,tt),sn=b.memoizedState),(kt=$g||oh(b,g,kt,tt,qt,sn,It)||!1)?(Ft||typeof gt.UNSAFE_componentWillUpdate!="function"&&typeof gt.componentWillUpdate!="function"||(typeof gt.componentWillUpdate=="function"&&gt.componentWillUpdate(tt,sn,It),typeof gt.UNSAFE_componentWillUpdate=="function"&&gt.UNSAFE_componentWillUpdate(tt,sn,It)),typeof gt.componentDidUpdate=="function"&&(b.flags|=4),typeof gt.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof gt.componentDidUpdate!="function"||xt===$.memoizedProps&&qt===$.memoizedState||(b.flags|=4),typeof gt.getSnapshotBeforeUpdate!="function"||xt===$.memoizedProps&&qt===$.memoizedState||(b.flags|=1024),b.memoizedProps=tt,b.memoizedState=sn),gt.props=tt,gt.state=sn,gt.context=It,tt=kt):(typeof gt.componentDidUpdate!="function"||xt===$.memoizedProps&&qt===$.memoizedState||(b.flags|=4),typeof gt.getSnapshotBeforeUpdate!="function"||xt===$.memoizedProps&&qt===$.memoizedState||(b.flags|=1024),tt=!1)}return kj($,b,g,tt,ut,ot)}function kj($,b,g,tt,ot,ut){hj($,b);var gt=(b.flags&128)!==0;if(!tt&&!gt)return ot&&dg(b,g,!1),$i($,b,ut);tt=b.stateNode,Xi.current=b;var xt=gt&&typeof g.getDerivedStateFromError!="function"?null:tt.render();return b.flags|=1,$!==null&&gt?(b.child=Bh(b,$.child,null,ut),b.child=Bh(b,null,xt,ut)):Yi($,b,xt,ut),b.memoizedState=tt.state,ot&&dg(b,g,!0),b.child}function lj($){var b=$.stateNode;b.pendingContext?ag($,b.pendingContext,b.pendingContext!==b.context):b.context&&ag($,b.context,!1),Ih($,b.containerInfo)}function mj($,b,g,tt,ot){return Ig(),Jg(ot),b.flags|=256,Yi($,b,g,tt),b.child}var nj={dehydrated:null,treeContext:null,retryLane:0};function oj($){return{baseLanes:$,cachePool:null,transitions:null}}function pj($,b,g){var tt=b.pendingProps,ot=M.current,ut=!1,gt=(b.flags&128)!==0,xt;if((xt=gt)||(xt=$!==null&&$.memoizedState===null?!1:(ot&2)!==0),xt?(ut=!0,b.flags&=-129):($===null||$.memoizedState!==null)&&(ot|=1),G(M,ot&1),$===null)return Eg(b),$=b.memoizedState,$!==null&&($=$.dehydrated,$!==null)?(b.mode&1?$.data==="$!"?b.lanes=8:b.lanes=1073741824:b.lanes=1,null):(gt=tt.children,$=tt.fallback,ut?(tt=b.mode,ut=b.child,gt={mode:"hidden",children:gt},!(tt&1)&&ut!==null?(ut.childLanes=0,ut.pendingProps=gt):ut=qj(gt,tt,0,null),$=Ah($,tt,g,null),ut.return=b,$.return=b,ut.sibling=$,b.child=ut,b.child.memoizedState=oj(g),b.memoizedState=nj,$):rj(b,gt));if(ot=$.memoizedState,ot!==null&&(xt=ot.dehydrated,xt!==null))return sj($,b,gt,tt,xt,ot,g);if(ut){ut=tt.fallback,gt=b.mode,ot=$.child,xt=ot.sibling;var It={mode:"hidden",children:tt.children};return!(gt&1)&&b.child!==ot?(tt=b.child,tt.childLanes=0,tt.pendingProps=It,b.deletions=null):(tt=wh(ot,It),tt.subtreeFlags=ot.subtreeFlags&14680064),xt!==null?ut=wh(xt,ut):(ut=Ah(ut,gt,g,null),ut.flags|=2),ut.return=b,tt.return=b,tt.sibling=ut,b.child=tt,tt=ut,ut=b.child,gt=$.child.memoizedState,gt=gt===null?oj(g):{baseLanes:gt.baseLanes|g,cachePool:null,transitions:gt.transitions},ut.memoizedState=gt,ut.childLanes=$.childLanes&~g,b.memoizedState=nj,tt}return ut=$.child,$=ut.sibling,tt=wh(ut,{mode:"visible",children:tt.children}),!(b.mode&1)&&(tt.lanes=g),tt.return=b,tt.sibling=null,$!==null&&(g=b.deletions,g===null?(b.deletions=[$],b.flags|=16):g.push($)),b.child=tt,b.memoizedState=null,tt}function rj($,b){return b=qj({mode:"visible",children:b},$.mode,0,null),b.return=$,$.child=b}function tj($,b,g,tt){return tt!==null&&Jg(tt),Bh(b,$.child,null,g),$=rj(b,b.pendingProps.children),$.flags|=2,b.memoizedState=null,$}function sj($,b,g,tt,ot,ut,gt){if(g)return b.flags&256?(b.flags&=-257,tt=Li(Error(p$1(422))),tj($,b,gt,tt)):b.memoizedState!==null?(b.child=$.child,b.flags|=128,null):(ut=tt.fallback,ot=b.mode,tt=qj({mode:"visible",children:tt.children},ot,0,null),ut=Ah(ut,ot,gt,null),ut.flags|=2,tt.return=b,ut.return=b,tt.sibling=ut,b.child=tt,b.mode&1&&Bh(b,$.child,null,gt),b.child.memoizedState=oj(gt),b.memoizedState=nj,ut);if(!(b.mode&1))return tj($,b,gt,null);if(ot.data==="$!"){if(tt=ot.nextSibling&&ot.nextSibling.dataset,tt)var xt=tt.dgst;return tt=xt,ut=Error(p$1(419)),tt=Li(ut,tt,void 0),tj($,b,gt,tt)}if(xt=(gt&$.childLanes)!==0,Ug||xt){if(tt=R,tt!==null){switch(gt&-gt){case 4:ot=2;break;case 16:ot=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:ot=32;break;case 536870912:ot=268435456;break;default:ot=0}ot=ot&(tt.suspendedLanes|gt)?0:ot,ot!==0&&ot!==ut.retryLane&&(ut.retryLane=ot,Zg($,ot),mh(tt,$,ot,-1))}return uj(),tt=Li(Error(p$1(421))),tj($,b,gt,tt)}return ot.data==="$?"?(b.flags|=128,b.child=$.child,b=vj.bind(null,$),ot._reactRetry=b,null):($=ut.treeContext,yg=Lf(ot.nextSibling),xg=b,I=!0,zg=null,$!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=$.id,sg=$.overflow,qg=b),b=rj(b,tt.children),b.flags|=4096,b)}function wj($,b,g){$.lanes|=b;var tt=$.alternate;tt!==null&&(tt.lanes|=b),Sg($.return,b,g)}function xj($,b,g,tt,ot){var ut=$.memoizedState;ut===null?$.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:tt,tail:g,tailMode:ot}:(ut.isBackwards=b,ut.rendering=null,ut.renderingStartTime=0,ut.last=tt,ut.tail=g,ut.tailMode=ot)}function yj($,b,g){var tt=b.pendingProps,ot=tt.revealOrder,ut=tt.tail;if(Yi($,b,tt.children,g),tt=M.current,tt&2)tt=tt&1|2,b.flags|=128;else{if($!==null&&$.flags&128)e:for($=b.child;$!==null;){if($.tag===13)$.memoizedState!==null&&wj($,g,b);else if($.tag===19)wj($,g,b);else if($.child!==null){$.child.return=$,$=$.child;continue}if($===b)break e;for(;$.sibling===null;){if($.return===null||$.return===b)break e;$=$.return}$.sibling.return=$.return,$=$.sibling}tt&=1}if(G(M,tt),!(b.mode&1))b.memoizedState=null;else switch(ot){case"forwards":for(g=b.child,ot=null;g!==null;)$=g.alternate,$!==null&&Mh($)===null&&(ot=g),g=g.sibling;g=ot,g===null?(ot=b.child,b.child=null):(ot=g.sibling,g.sibling=null),xj(b,!1,ot,g,ut);break;case"backwards":for(g=null,ot=b.child,b.child=null;ot!==null;){if($=ot.alternate,$!==null&&Mh($)===null){b.child=ot;break}$=ot.sibling,ot.sibling=g,g=ot,ot=$}xj(b,!0,g,null,ut);break;case"together":xj(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function jj($,b){!(b.mode&1)&&$!==null&&($.alternate=null,b.alternate=null,b.flags|=2)}function $i($,b,g){if($!==null&&(b.dependencies=$.dependencies),hh|=b.lanes,!(g&b.childLanes))return null;if($!==null&&b.child!==$.child)throw Error(p$1(153));if(b.child!==null){for($=b.child,g=wh($,$.pendingProps),b.child=g,g.return=b;$.sibling!==null;)$=$.sibling,g=g.sibling=wh($,$.pendingProps),g.return=b;g.sibling=null}return b.child}function zj($,b,g){switch(b.tag){case 3:lj(b),Ig();break;case 5:Kh(b);break;case 1:Zf(b.type)&&cg(b);break;case 4:Ih(b,b.stateNode.containerInfo);break;case 10:var tt=b.type._context,ot=b.memoizedProps.value;G(Mg,tt._currentValue),tt._currentValue=ot;break;case 13:if(tt=b.memoizedState,tt!==null)return tt.dehydrated!==null?(G(M,M.current&1),b.flags|=128,null):g&b.child.childLanes?pj($,b,g):(G(M,M.current&1),$=$i($,b,g),$!==null?$.sibling:null);G(M,M.current&1);break;case 19:if(tt=(g&b.childLanes)!==0,$.flags&128){if(tt)return yj($,b,g);b.flags|=128}if(ot=b.memoizedState,ot!==null&&(ot.rendering=null,ot.tail=null,ot.lastEffect=null),G(M,M.current),tt)break;return null;case 22:case 23:return b.lanes=0,ej($,b,g)}return $i($,b,g)}var Aj,Bj,Cj,Dj;Aj=function($,b){for(var g=b.child;g!==null;){if(g.tag===5||g.tag===6)$.appendChild(g.stateNode);else if(g.tag!==4&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===b)break;for(;g.sibling===null;){if(g.return===null||g.return===b)return;g=g.return}g.sibling.return=g.return,g=g.sibling}};Bj=function(){};Cj=function($,b,g,tt){var ot=$.memoizedProps;if(ot!==tt){$=b.stateNode,Hh(Eh.current);var ut=null;switch(g){case"input":ot=Ya($,ot),tt=Ya($,tt),ut=[];break;case"select":ot=A({},ot,{value:void 0}),tt=A({},tt,{value:void 0}),ut=[];break;case"textarea":ot=gb($,ot),tt=gb($,tt),ut=[];break;default:typeof ot.onClick!="function"&&typeof tt.onClick=="function"&&($.onclick=Bf)}ub(g,tt);var gt;g=null;for(kt in ot)if(!tt.hasOwnProperty(kt)&&ot.hasOwnProperty(kt)&&ot[kt]!=null)if(kt==="style"){var xt=ot[kt];for(gt in xt)xt.hasOwnProperty(gt)&&(g||(g={}),g[gt]="")}else kt!=="dangerouslySetInnerHTML"&&kt!=="children"&&kt!=="suppressContentEditableWarning"&&kt!=="suppressHydrationWarning"&&kt!=="autoFocus"&&(ea.hasOwnProperty(kt)?ut||(ut=[]):(ut=ut||[]).push(kt,null));for(kt in tt){var It=tt[kt];if(xt=ot!=null?ot[kt]:void 0,tt.hasOwnProperty(kt)&&It!==xt&&(It!=null||xt!=null))if(kt==="style")if(xt){for(gt in xt)!xt.hasOwnProperty(gt)||It&&It.hasOwnProperty(gt)||(g||(g={}),g[gt]="");for(gt in It)It.hasOwnProperty(gt)&&xt[gt]!==It[gt]&&(g||(g={}),g[gt]=It[gt])}else g||(ut||(ut=[]),ut.push(kt,g)),g=It;else kt==="dangerouslySetInnerHTML"?(It=It?It.__html:void 0,xt=xt?xt.__html:void 0,It!=null&&xt!==It&&(ut=ut||[]).push(kt,It)):kt==="children"?typeof It!="string"&&typeof It!="number"||(ut=ut||[]).push(kt,""+It):kt!=="suppressContentEditableWarning"&&kt!=="suppressHydrationWarning"&&(ea.hasOwnProperty(kt)?(It!=null&&kt==="onScroll"&&D("scroll",$),ut||xt===It||(ut=[])):(ut=ut||[]).push(kt,It))}g&&(ut=ut||[]).push("style",g);var kt=ut;(b.updateQueue=kt)&&(b.flags|=4)}};Dj=function($,b,g,tt){g!==tt&&(b.flags|=4)};function Ej($,b){if(!I)switch($.tailMode){case"hidden":b=$.tail;for(var g=null;b!==null;)b.alternate!==null&&(g=b),b=b.sibling;g===null?$.tail=null:g.sibling=null;break;case"collapsed":g=$.tail;for(var tt=null;g!==null;)g.alternate!==null&&(tt=g),g=g.sibling;tt===null?b||$.tail===null?$.tail=null:$.tail.sibling=null:tt.sibling=null}}function S($){var b=$.alternate!==null&&$.alternate.child===$.child,g=0,tt=0;if(b)for(var ot=$.child;ot!==null;)g|=ot.lanes|ot.childLanes,tt|=ot.subtreeFlags&14680064,tt|=ot.flags&14680064,ot.return=$,ot=ot.sibling;else for(ot=$.child;ot!==null;)g|=ot.lanes|ot.childLanes,tt|=ot.subtreeFlags,tt|=ot.flags,ot.return=$,ot=ot.sibling;return $.subtreeFlags|=tt,$.childLanes=g,b}function Fj($,b,g){var tt=b.pendingProps;switch(wg(b),b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(b),null;case 1:return Zf(b.type)&&$f(),S(b),null;case 3:return tt=b.stateNode,Jh(),E(Wf),E(H),Oh(),tt.pendingContext&&(tt.context=tt.pendingContext,tt.pendingContext=null),($===null||$.child===null)&&(Gg(b)?b.flags|=4:$===null||$.memoizedState.isDehydrated&&!(b.flags&256)||(b.flags|=1024,zg!==null&&(Gj(zg),zg=null))),Bj($,b),S(b),null;case 5:Lh(b);var ot=Hh(Gh.current);if(g=b.type,$!==null&&b.stateNode!=null)Cj($,b,g,tt,ot),$.ref!==b.ref&&(b.flags|=512,b.flags|=2097152);else{if(!tt){if(b.stateNode===null)throw Error(p$1(166));return S(b),null}if($=Hh(Eh.current),Gg(b)){tt=b.stateNode,g=b.type;var ut=b.memoizedProps;switch(tt[Of]=b,tt[Pf]=ut,$=(b.mode&1)!==0,g){case"dialog":D("cancel",tt),D("close",tt);break;case"iframe":case"object":case"embed":D("load",tt);break;case"video":case"audio":for(ot=0;ot<lf.length;ot++)D(lf[ot],tt);break;case"source":D("error",tt);break;case"img":case"image":case"link":D("error",tt),D("load",tt);break;case"details":D("toggle",tt);break;case"input":Za(tt,ut),D("invalid",tt);break;case"select":tt._wrapperState={wasMultiple:!!ut.multiple},D("invalid",tt);break;case"textarea":hb(tt,ut),D("invalid",tt)}ub(g,ut),ot=null;for(var gt in ut)if(ut.hasOwnProperty(gt)){var xt=ut[gt];gt==="children"?typeof xt=="string"?tt.textContent!==xt&&(ut.suppressHydrationWarning!==!0&&Af(tt.textContent,xt,$),ot=["children",xt]):typeof xt=="number"&&tt.textContent!==""+xt&&(ut.suppressHydrationWarning!==!0&&Af(tt.textContent,xt,$),ot=["children",""+xt]):ea.hasOwnProperty(gt)&&xt!=null&&gt==="onScroll"&&D("scroll",tt)}switch(g){case"input":Va(tt),db(tt,ut,!0);break;case"textarea":Va(tt),jb(tt);break;case"select":case"option":break;default:typeof ut.onClick=="function"&&(tt.onclick=Bf)}tt=ot,b.updateQueue=tt,tt!==null&&(b.flags|=4)}else{gt=ot.nodeType===9?ot:ot.ownerDocument,$==="http://www.w3.org/1999/xhtml"&&($=kb(g)),$==="http://www.w3.org/1999/xhtml"?g==="script"?($=gt.createElement("div"),$.innerHTML="<script><\/script>",$=$.removeChild($.firstChild)):typeof tt.is=="string"?$=gt.createElement(g,{is:tt.is}):($=gt.createElement(g),g==="select"&&(gt=$,tt.multiple?gt.multiple=!0:tt.size&&(gt.size=tt.size))):$=gt.createElementNS($,g),$[Of]=b,$[Pf]=tt,Aj($,b,!1,!1),b.stateNode=$;e:{switch(gt=vb(g,tt),g){case"dialog":D("cancel",$),D("close",$),ot=tt;break;case"iframe":case"object":case"embed":D("load",$),ot=tt;break;case"video":case"audio":for(ot=0;ot<lf.length;ot++)D(lf[ot],$);ot=tt;break;case"source":D("error",$),ot=tt;break;case"img":case"image":case"link":D("error",$),D("load",$),ot=tt;break;case"details":D("toggle",$),ot=tt;break;case"input":Za($,tt),ot=Ya($,tt),D("invalid",$);break;case"option":ot=tt;break;case"select":$._wrapperState={wasMultiple:!!tt.multiple},ot=A({},tt,{value:void 0}),D("invalid",$);break;case"textarea":hb($,tt),ot=gb($,tt),D("invalid",$);break;default:ot=tt}ub(g,ot),xt=ot;for(ut in xt)if(xt.hasOwnProperty(ut)){var It=xt[ut];ut==="style"?sb($,It):ut==="dangerouslySetInnerHTML"?(It=It?It.__html:void 0,It!=null&&nb($,It)):ut==="children"?typeof It=="string"?(g!=="textarea"||It!=="")&&ob($,It):typeof It=="number"&&ob($,""+It):ut!=="suppressContentEditableWarning"&&ut!=="suppressHydrationWarning"&&ut!=="autoFocus"&&(ea.hasOwnProperty(ut)?It!=null&&ut==="onScroll"&&D("scroll",$):It!=null&&ta($,ut,It,gt))}switch(g){case"input":Va($),db($,tt,!1);break;case"textarea":Va($),jb($);break;case"option":tt.value!=null&&$.setAttribute("value",""+Sa(tt.value));break;case"select":$.multiple=!!tt.multiple,ut=tt.value,ut!=null?fb($,!!tt.multiple,ut,!1):tt.defaultValue!=null&&fb($,!!tt.multiple,tt.defaultValue,!0);break;default:typeof ot.onClick=="function"&&($.onclick=Bf)}switch(g){case"button":case"input":case"select":case"textarea":tt=!!tt.autoFocus;break e;case"img":tt=!0;break e;default:tt=!1}}tt&&(b.flags|=4)}b.ref!==null&&(b.flags|=512,b.flags|=2097152)}return S(b),null;case 6:if($&&b.stateNode!=null)Dj($,b,$.memoizedProps,tt);else{if(typeof tt!="string"&&b.stateNode===null)throw Error(p$1(166));if(g=Hh(Gh.current),Hh(Eh.current),Gg(b)){if(tt=b.stateNode,g=b.memoizedProps,tt[Of]=b,(ut=tt.nodeValue!==g)&&($=xg,$!==null))switch($.tag){case 3:Af(tt.nodeValue,g,($.mode&1)!==0);break;case 5:$.memoizedProps.suppressHydrationWarning!==!0&&Af(tt.nodeValue,g,($.mode&1)!==0)}ut&&(b.flags|=4)}else tt=(g.nodeType===9?g:g.ownerDocument).createTextNode(tt),tt[Of]=b,b.stateNode=tt}return S(b),null;case 13:if(E(M),tt=b.memoizedState,$===null||$.memoizedState!==null&&$.memoizedState.dehydrated!==null){if(I&&yg!==null&&b.mode&1&&!(b.flags&128))Hg(),Ig(),b.flags|=98560,ut=!1;else if(ut=Gg(b),tt!==null&&tt.dehydrated!==null){if($===null){if(!ut)throw Error(p$1(318));if(ut=b.memoizedState,ut=ut!==null?ut.dehydrated:null,!ut)throw Error(p$1(317));ut[Of]=b}else Ig(),!(b.flags&128)&&(b.memoizedState=null),b.flags|=4;S(b),ut=!1}else zg!==null&&(Gj(zg),zg=null),ut=!0;if(!ut)return b.flags&65536?b:null}return b.flags&128?(b.lanes=g,b):(tt=tt!==null,tt!==($!==null&&$.memoizedState!==null)&&tt&&(b.child.flags|=8192,b.mode&1&&($===null||M.current&1?T===0&&(T=3):uj())),b.updateQueue!==null&&(b.flags|=4),S(b),null);case 4:return Jh(),Bj($,b),$===null&&sf(b.stateNode.containerInfo),S(b),null;case 10:return Rg(b.type._context),S(b),null;case 17:return Zf(b.type)&&$f(),S(b),null;case 19:if(E(M),ut=b.memoizedState,ut===null)return S(b),null;if(tt=(b.flags&128)!==0,gt=ut.rendering,gt===null)if(tt)Ej(ut,!1);else{if(T!==0||$!==null&&$.flags&128)for($=b.child;$!==null;){if(gt=Mh($),gt!==null){for(b.flags|=128,Ej(ut,!1),tt=gt.updateQueue,tt!==null&&(b.updateQueue=tt,b.flags|=4),b.subtreeFlags=0,tt=g,g=b.child;g!==null;)ut=g,$=tt,ut.flags&=14680066,gt=ut.alternate,gt===null?(ut.childLanes=0,ut.lanes=$,ut.child=null,ut.subtreeFlags=0,ut.memoizedProps=null,ut.memoizedState=null,ut.updateQueue=null,ut.dependencies=null,ut.stateNode=null):(ut.childLanes=gt.childLanes,ut.lanes=gt.lanes,ut.child=gt.child,ut.subtreeFlags=0,ut.deletions=null,ut.memoizedProps=gt.memoizedProps,ut.memoizedState=gt.memoizedState,ut.updateQueue=gt.updateQueue,ut.type=gt.type,$=gt.dependencies,ut.dependencies=$===null?null:{lanes:$.lanes,firstContext:$.firstContext}),g=g.sibling;return G(M,M.current&1|2),b.child}$=$.sibling}ut.tail!==null&&B()>Hj&&(b.flags|=128,tt=!0,Ej(ut,!1),b.lanes=4194304)}else{if(!tt)if($=Mh(gt),$!==null){if(b.flags|=128,tt=!0,g=$.updateQueue,g!==null&&(b.updateQueue=g,b.flags|=4),Ej(ut,!0),ut.tail===null&&ut.tailMode==="hidden"&&!gt.alternate&&!I)return S(b),null}else 2*B()-ut.renderingStartTime>Hj&&g!==1073741824&&(b.flags|=128,tt=!0,Ej(ut,!1),b.lanes=4194304);ut.isBackwards?(gt.sibling=b.child,b.child=gt):(g=ut.last,g!==null?g.sibling=gt:b.child=gt,ut.last=gt)}return ut.tail!==null?(b=ut.tail,ut.rendering=b,ut.tail=b.sibling,ut.renderingStartTime=B(),b.sibling=null,g=M.current,G(M,tt?g&1|2:g&1),b):(S(b),null);case 22:case 23:return Ij(),tt=b.memoizedState!==null,$!==null&&$.memoizedState!==null!==tt&&(b.flags|=8192),tt&&b.mode&1?gj&1073741824&&(S(b),b.subtreeFlags&6&&(b.flags|=8192)):S(b),null;case 24:return null;case 25:return null}throw Error(p$1(156,b.tag))}function Jj($,b){switch(wg(b),b.tag){case 1:return Zf(b.type)&&$f(),$=b.flags,$&65536?(b.flags=$&-65537|128,b):null;case 3:return Jh(),E(Wf),E(H),Oh(),$=b.flags,$&65536&&!($&128)?(b.flags=$&-65537|128,b):null;case 5:return Lh(b),null;case 13:if(E(M),$=b.memoizedState,$!==null&&$.dehydrated!==null){if(b.alternate===null)throw Error(p$1(340));Ig()}return $=b.flags,$&65536?(b.flags=$&-65537|128,b):null;case 19:return E(M),null;case 4:return Jh(),null;case 10:return Rg(b.type._context),null;case 22:case 23:return Ij(),null;case 24:return null;default:return null}}var Kj=!1,U=!1,Lj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Mj($,b){var g=$.ref;if(g!==null)if(typeof g=="function")try{g(null)}catch(tt){W($,b,tt)}else g.current=null}function Nj($,b,g){try{g()}catch(tt){W($,b,tt)}}var Oj=!1;function Pj($,b){if(Cf=dd,$=Me(),Ne($)){if("selectionStart"in $)var g={start:$.selectionStart,end:$.selectionEnd};else e:{g=(g=$.ownerDocument)&&g.defaultView||window;var tt=g.getSelection&&g.getSelection();if(tt&&tt.rangeCount!==0){g=tt.anchorNode;var ot=tt.anchorOffset,ut=tt.focusNode;tt=tt.focusOffset;try{g.nodeType,ut.nodeType}catch{g=null;break e}var gt=0,xt=-1,It=-1,kt=0,Ft=0,Xt=$,qt=null;t:for(;;){for(var jt;Xt!==g||ot!==0&&Xt.nodeType!==3||(xt=gt+ot),Xt!==ut||tt!==0&&Xt.nodeType!==3||(It=gt+tt),Xt.nodeType===3&&(gt+=Xt.nodeValue.length),(jt=Xt.firstChild)!==null;)qt=Xt,Xt=jt;for(;;){if(Xt===$)break t;if(qt===g&&++kt===ot&&(xt=gt),qt===ut&&++Ft===tt&&(It=gt),(jt=Xt.nextSibling)!==null)break;Xt=qt,qt=Xt.parentNode}Xt=jt}g=xt===-1||It===-1?null:{start:xt,end:It}}else g=null}g=g||{start:0,end:0}}else g=null;for(Df={focusedElem:$,selectionRange:g},dd=!1,V=b;V!==null;)if(b=V,$=b.child,(b.subtreeFlags&1028)!==0&&$!==null)$.return=b,V=$;else for(;V!==null;){b=V;try{var sn=b.alternate;if(b.flags&1024)switch(b.tag){case 0:case 11:case 15:break;case 1:if(sn!==null){var Gt=sn.memoizedProps,vn=sn.memoizedState,nn=b.stateNode,Wt=nn.getSnapshotBeforeUpdate(b.elementType===b.type?Gt:Lg(b.type,Gt),vn);nn.__reactInternalSnapshotBeforeUpdate=Wt}break;case 3:var on=b.stateNode.containerInfo;on.nodeType===1?on.textContent="":on.nodeType===9&&on.documentElement&&on.removeChild(on.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(gn){W(b,b.return,gn)}if($=b.sibling,$!==null){$.return=b.return,V=$;break}V=b.return}return sn=Oj,Oj=!1,sn}function Qj($,b,g){var tt=b.updateQueue;if(tt=tt!==null?tt.lastEffect:null,tt!==null){var ot=tt=tt.next;do{if((ot.tag&$)===$){var ut=ot.destroy;ot.destroy=void 0,ut!==void 0&&Nj(b,g,ut)}ot=ot.next}while(ot!==tt)}}function Rj($,b){if(b=b.updateQueue,b=b!==null?b.lastEffect:null,b!==null){var g=b=b.next;do{if((g.tag&$)===$){var tt=g.create;g.destroy=tt()}g=g.next}while(g!==b)}}function Sj($){var b=$.ref;if(b!==null){var g=$.stateNode;switch($.tag){case 5:$=g;break;default:$=g}typeof b=="function"?b($):b.current=$}}function Tj($){var b=$.alternate;b!==null&&($.alternate=null,Tj(b)),$.child=null,$.deletions=null,$.sibling=null,$.tag===5&&(b=$.stateNode,b!==null&&(delete b[Of],delete b[Pf],delete b[of],delete b[Qf],delete b[Rf])),$.stateNode=null,$.return=null,$.dependencies=null,$.memoizedProps=null,$.memoizedState=null,$.pendingProps=null,$.stateNode=null,$.updateQueue=null}function Uj($){return $.tag===5||$.tag===3||$.tag===4}function Vj($){e:for(;;){for(;$.sibling===null;){if($.return===null||Uj($.return))return null;$=$.return}for($.sibling.return=$.return,$=$.sibling;$.tag!==5&&$.tag!==6&&$.tag!==18;){if($.flags&2||$.child===null||$.tag===4)continue e;$.child.return=$,$=$.child}if(!($.flags&2))return $.stateNode}}function Wj($,b,g){var tt=$.tag;if(tt===5||tt===6)$=$.stateNode,b?g.nodeType===8?g.parentNode.insertBefore($,b):g.insertBefore($,b):(g.nodeType===8?(b=g.parentNode,b.insertBefore($,g)):(b=g,b.appendChild($)),g=g._reactRootContainer,g!=null||b.onclick!==null||(b.onclick=Bf));else if(tt!==4&&($=$.child,$!==null))for(Wj($,b,g),$=$.sibling;$!==null;)Wj($,b,g),$=$.sibling}function Xj($,b,g){var tt=$.tag;if(tt===5||tt===6)$=$.stateNode,b?g.insertBefore($,b):g.appendChild($);else if(tt!==4&&($=$.child,$!==null))for(Xj($,b,g),$=$.sibling;$!==null;)Xj($,b,g),$=$.sibling}var X=null,Yj=!1;function Zj($,b,g){for(g=g.child;g!==null;)ak($,b,g),g=g.sibling}function ak($,b,g){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,g)}catch{}switch(g.tag){case 5:U||Mj(g,b);case 6:var tt=X,ot=Yj;X=null,Zj($,b,g),X=tt,Yj=ot,X!==null&&(Yj?($=X,g=g.stateNode,$.nodeType===8?$.parentNode.removeChild(g):$.removeChild(g)):X.removeChild(g.stateNode));break;case 18:X!==null&&(Yj?($=X,g=g.stateNode,$.nodeType===8?Kf($.parentNode,g):$.nodeType===1&&Kf($,g),bd($)):Kf(X,g.stateNode));break;case 4:tt=X,ot=Yj,X=g.stateNode.containerInfo,Yj=!0,Zj($,b,g),X=tt,Yj=ot;break;case 0:case 11:case 14:case 15:if(!U&&(tt=g.updateQueue,tt!==null&&(tt=tt.lastEffect,tt!==null))){ot=tt=tt.next;do{var ut=ot,gt=ut.destroy;ut=ut.tag,gt!==void 0&&(ut&2||ut&4)&&Nj(g,b,gt),ot=ot.next}while(ot!==tt)}Zj($,b,g);break;case 1:if(!U&&(Mj(g,b),tt=g.stateNode,typeof tt.componentWillUnmount=="function"))try{tt.props=g.memoizedProps,tt.state=g.memoizedState,tt.componentWillUnmount()}catch(xt){W(g,b,xt)}Zj($,b,g);break;case 21:Zj($,b,g);break;case 22:g.mode&1?(U=(tt=U)||g.memoizedState!==null,Zj($,b,g),U=tt):Zj($,b,g);break;default:Zj($,b,g)}}function bk($){var b=$.updateQueue;if(b!==null){$.updateQueue=null;var g=$.stateNode;g===null&&(g=$.stateNode=new Lj),b.forEach(function(tt){var ot=ck.bind(null,$,tt);g.has(tt)||(g.add(tt),tt.then(ot,ot))})}}function dk($,b){var g=b.deletions;if(g!==null)for(var tt=0;tt<g.length;tt++){var ot=g[tt];try{var ut=$,gt=b,xt=gt;e:for(;xt!==null;){switch(xt.tag){case 5:X=xt.stateNode,Yj=!1;break e;case 3:X=xt.stateNode.containerInfo,Yj=!0;break e;case 4:X=xt.stateNode.containerInfo,Yj=!0;break e}xt=xt.return}if(X===null)throw Error(p$1(160));ak(ut,gt,ot),X=null,Yj=!1;var It=ot.alternate;It!==null&&(It.return=null),ot.return=null}catch(kt){W(ot,b,kt)}}if(b.subtreeFlags&12854)for(b=b.child;b!==null;)ek(b,$),b=b.sibling}function ek($,b){var g=$.alternate,tt=$.flags;switch($.tag){case 0:case 11:case 14:case 15:if(dk(b,$),fk($),tt&4){try{Qj(3,$,$.return),Rj(3,$)}catch(Gt){W($,$.return,Gt)}try{Qj(5,$,$.return)}catch(Gt){W($,$.return,Gt)}}break;case 1:dk(b,$),fk($),tt&512&&g!==null&&Mj(g,g.return);break;case 5:if(dk(b,$),fk($),tt&512&&g!==null&&Mj(g,g.return),$.flags&32){var ot=$.stateNode;try{ob(ot,"")}catch(Gt){W($,$.return,Gt)}}if(tt&4&&(ot=$.stateNode,ot!=null)){var ut=$.memoizedProps,gt=g!==null?g.memoizedProps:ut,xt=$.type,It=$.updateQueue;if($.updateQueue=null,It!==null)try{xt==="input"&&ut.type==="radio"&&ut.name!=null&&ab(ot,ut),vb(xt,gt);var kt=vb(xt,ut);for(gt=0;gt<It.length;gt+=2){var Ft=It[gt],Xt=It[gt+1];Ft==="style"?sb(ot,Xt):Ft==="dangerouslySetInnerHTML"?nb(ot,Xt):Ft==="children"?ob(ot,Xt):ta(ot,Ft,Xt,kt)}switch(xt){case"input":bb(ot,ut);break;case"textarea":ib(ot,ut);break;case"select":var qt=ot._wrapperState.wasMultiple;ot._wrapperState.wasMultiple=!!ut.multiple;var jt=ut.value;jt!=null?fb(ot,!!ut.multiple,jt,!1):qt!==!!ut.multiple&&(ut.defaultValue!=null?fb(ot,!!ut.multiple,ut.defaultValue,!0):fb(ot,!!ut.multiple,ut.multiple?[]:"",!1))}ot[Pf]=ut}catch(Gt){W($,$.return,Gt)}}break;case 6:if(dk(b,$),fk($),tt&4){if($.stateNode===null)throw Error(p$1(162));ot=$.stateNode,ut=$.memoizedProps;try{ot.nodeValue=ut}catch(Gt){W($,$.return,Gt)}}break;case 3:if(dk(b,$),fk($),tt&4&&g!==null&&g.memoizedState.isDehydrated)try{bd(b.containerInfo)}catch(Gt){W($,$.return,Gt)}break;case 4:dk(b,$),fk($);break;case 13:dk(b,$),fk($),ot=$.child,ot.flags&8192&&(ut=ot.memoizedState!==null,ot.stateNode.isHidden=ut,!ut||ot.alternate!==null&&ot.alternate.memoizedState!==null||(gk=B())),tt&4&&bk($);break;case 22:if(Ft=g!==null&&g.memoizedState!==null,$.mode&1?(U=(kt=U)||Ft,dk(b,$),U=kt):dk(b,$),fk($),tt&8192){if(kt=$.memoizedState!==null,($.stateNode.isHidden=kt)&&!Ft&&$.mode&1)for(V=$,Ft=$.child;Ft!==null;){for(Xt=V=Ft;V!==null;){switch(qt=V,jt=qt.child,qt.tag){case 0:case 11:case 14:case 15:Qj(4,qt,qt.return);break;case 1:Mj(qt,qt.return);var sn=qt.stateNode;if(typeof sn.componentWillUnmount=="function"){tt=qt,g=qt.return;try{b=tt,sn.props=b.memoizedProps,sn.state=b.memoizedState,sn.componentWillUnmount()}catch(Gt){W(tt,g,Gt)}}break;case 5:Mj(qt,qt.return);break;case 22:if(qt.memoizedState!==null){hk(Xt);continue}}jt!==null?(jt.return=qt,V=jt):hk(Xt)}Ft=Ft.sibling}e:for(Ft=null,Xt=$;;){if(Xt.tag===5){if(Ft===null){Ft=Xt;try{ot=Xt.stateNode,kt?(ut=ot.style,typeof ut.setProperty=="function"?ut.setProperty("display","none","important"):ut.display="none"):(xt=Xt.stateNode,It=Xt.memoizedProps.style,gt=It!=null&&It.hasOwnProperty("display")?It.display:null,xt.style.display=rb("display",gt))}catch(Gt){W($,$.return,Gt)}}}else if(Xt.tag===6){if(Ft===null)try{Xt.stateNode.nodeValue=kt?"":Xt.memoizedProps}catch(Gt){W($,$.return,Gt)}}else if((Xt.tag!==22&&Xt.tag!==23||Xt.memoizedState===null||Xt===$)&&Xt.child!==null){Xt.child.return=Xt,Xt=Xt.child;continue}if(Xt===$)break e;for(;Xt.sibling===null;){if(Xt.return===null||Xt.return===$)break e;Ft===Xt&&(Ft=null),Xt=Xt.return}Ft===Xt&&(Ft=null),Xt.sibling.return=Xt.return,Xt=Xt.sibling}}break;case 19:dk(b,$),fk($),tt&4&&bk($);break;case 21:break;default:dk(b,$),fk($)}}function fk($){var b=$.flags;if(b&2){try{e:{for(var g=$.return;g!==null;){if(Uj(g)){var tt=g;break e}g=g.return}throw Error(p$1(160))}switch(tt.tag){case 5:var ot=tt.stateNode;tt.flags&32&&(ob(ot,""),tt.flags&=-33);var ut=Vj($);Xj($,ut,ot);break;case 3:case 4:var gt=tt.stateNode.containerInfo,xt=Vj($);Wj($,xt,gt);break;default:throw Error(p$1(161))}}catch(It){W($,$.return,It)}$.flags&=-3}b&4096&&($.flags&=-4097)}function ik($,b,g){V=$,jk($)}function jk($,b,g){for(var tt=($.mode&1)!==0;V!==null;){var ot=V,ut=ot.child;if(ot.tag===22&&tt){var gt=ot.memoizedState!==null||Kj;if(!gt){var xt=ot.alternate,It=xt!==null&&xt.memoizedState!==null||U;xt=Kj;var kt=U;if(Kj=gt,(U=It)&&!kt)for(V=ot;V!==null;)gt=V,It=gt.child,gt.tag===22&&gt.memoizedState!==null?kk(ot):It!==null?(It.return=gt,V=It):kk(ot);for(;ut!==null;)V=ut,jk(ut),ut=ut.sibling;V=ot,Kj=xt,U=kt}lk($)}else ot.subtreeFlags&8772&&ut!==null?(ut.return=ot,V=ut):lk($)}}function lk($){for(;V!==null;){var b=V;if(b.flags&8772){var g=b.alternate;try{if(b.flags&8772)switch(b.tag){case 0:case 11:case 15:U||Rj(5,b);break;case 1:var tt=b.stateNode;if(b.flags&4&&!U)if(g===null)tt.componentDidMount();else{var ot=b.elementType===b.type?g.memoizedProps:Lg(b.type,g.memoizedProps);tt.componentDidUpdate(ot,g.memoizedState,tt.__reactInternalSnapshotBeforeUpdate)}var ut=b.updateQueue;ut!==null&&ih(b,ut,tt);break;case 3:var gt=b.updateQueue;if(gt!==null){if(g=null,b.child!==null)switch(b.child.tag){case 5:g=b.child.stateNode;break;case 1:g=b.child.stateNode}ih(b,gt,g)}break;case 5:var xt=b.stateNode;if(g===null&&b.flags&4){g=xt;var It=b.memoizedProps;switch(b.type){case"button":case"input":case"select":case"textarea":It.autoFocus&&g.focus();break;case"img":It.src&&(g.src=It.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(b.memoizedState===null){var kt=b.alternate;if(kt!==null){var Ft=kt.memoizedState;if(Ft!==null){var Xt=Ft.dehydrated;Xt!==null&&bd(Xt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U||b.flags&512&&Sj(b)}catch(qt){W(b,b.return,qt)}}if(b===$){V=null;break}if(g=b.sibling,g!==null){g.return=b.return,V=g;break}V=b.return}}function hk($){for(;V!==null;){var b=V;if(b===$){V=null;break}var g=b.sibling;if(g!==null){g.return=b.return,V=g;break}V=b.return}}function kk($){for(;V!==null;){var b=V;try{switch(b.tag){case 0:case 11:case 15:var g=b.return;try{Rj(4,b)}catch(It){W(b,g,It)}break;case 1:var tt=b.stateNode;if(typeof tt.componentDidMount=="function"){var ot=b.return;try{tt.componentDidMount()}catch(It){W(b,ot,It)}}var ut=b.return;try{Sj(b)}catch(It){W(b,ut,It)}break;case 5:var gt=b.return;try{Sj(b)}catch(It){W(b,gt,It)}}}catch(It){W(b,b.return,It)}if(b===$){V=null;break}var xt=b.sibling;if(xt!==null){xt.return=b.return,V=xt;break}V=b.return}}var mk=Math.ceil,nk=ua.ReactCurrentDispatcher,ok=ua.ReactCurrentOwner,pk=ua.ReactCurrentBatchConfig,K=0,R=null,Y=null,Z=0,gj=0,fj=Uf(0),T=0,qk=null,hh=0,rk=0,sk=0,tk=null,uk=null,gk=0,Hj=1/0,vk=null,Pi=!1,Qi=null,Si=null,wk=!1,xk=null,yk=0,zk=0,Ak=null,Bk=-1,Ck=0;function L(){return K&6?B():Bk!==-1?Bk:Bk=B()}function lh($){return $.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Ck===0&&(Ck=yc()),Ck):($=C,$!==0||($=window.event,$=$===void 0?16:jd($.type)),$):1}function mh($,b,g,tt){if(50<zk)throw zk=0,Ak=null,Error(p$1(185));Ac($,g,tt),(!(K&2)||$!==R)&&($===R&&(!(K&2)&&(rk|=g),T===4&&Dk($,Z)),Ek($,tt),g===1&&K===0&&!(b.mode&1)&&(Hj=B()+500,fg&&jg()))}function Ek($,b){var g=$.callbackNode;wc($,b);var tt=uc($,$===R?Z:0);if(tt===0)g!==null&&bc(g),$.callbackNode=null,$.callbackPriority=0;else if(b=tt&-tt,$.callbackPriority!==b){if(g!=null&&bc(g),b===1)$.tag===0?ig(Fk.bind(null,$)):hg(Fk.bind(null,$)),Jf(function(){!(K&6)&&jg()}),g=null;else{switch(Dc(tt)){case 1:g=fc;break;case 4:g=gc;break;case 16:g=hc;break;case 536870912:g=jc;break;default:g=hc}g=Gk(g,Hk.bind(null,$))}$.callbackPriority=b,$.callbackNode=g}}function Hk($,b){if(Bk=-1,Ck=0,K&6)throw Error(p$1(327));var g=$.callbackNode;if(Ik()&&$.callbackNode!==g)return null;var tt=uc($,$===R?Z:0);if(tt===0)return null;if(tt&30||tt&$.expiredLanes||b)b=Jk($,tt);else{b=tt;var ot=K;K|=2;var ut=Kk();(R!==$||Z!==b)&&(vk=null,Hj=B()+500,Lk($,b));do try{Mk();break}catch(xt){Nk($,xt)}while(!0);Qg(),nk.current=ut,K=ot,Y!==null?b=0:(R=null,Z=0,b=T)}if(b!==0){if(b===2&&(ot=xc($),ot!==0&&(tt=ot,b=Ok($,ot))),b===1)throw g=qk,Lk($,0),Dk($,tt),Ek($,B()),g;if(b===6)Dk($,tt);else{if(ot=$.current.alternate,!(tt&30)&&!Pk(ot)&&(b=Jk($,tt),b===2&&(ut=xc($),ut!==0&&(tt=ut,b=Ok($,ut))),b===1))throw g=qk,Lk($,0),Dk($,tt),Ek($,B()),g;switch($.finishedWork=ot,$.finishedLanes=tt,b){case 0:case 1:throw Error(p$1(345));case 2:Qk($,uk,vk);break;case 3:if(Dk($,tt),(tt&130023424)===tt&&(b=gk+500-B(),10<b)){if(uc($,0)!==0)break;if(ot=$.suspendedLanes,(ot&tt)!==tt){L(),$.pingedLanes|=$.suspendedLanes&ot;break}$.timeoutHandle=Ff(Qk.bind(null,$,uk,vk),b);break}Qk($,uk,vk);break;case 4:if(Dk($,tt),(tt&4194240)===tt)break;for(b=$.eventTimes,ot=-1;0<tt;){var gt=31-oc(tt);ut=1<<gt,gt=b[gt],gt>ot&&(ot=gt),tt&=~ut}if(tt=ot,tt=B()-tt,tt=(120>tt?120:480>tt?480:1080>tt?1080:1920>tt?1920:3e3>tt?3e3:4320>tt?4320:1960*mk(tt/1960))-tt,10<tt){$.timeoutHandle=Ff(Qk.bind(null,$,uk,vk),tt);break}Qk($,uk,vk);break;case 5:Qk($,uk,vk);break;default:throw Error(p$1(329))}}}return Ek($,B()),$.callbackNode===g?Hk.bind(null,$):null}function Ok($,b){var g=tk;return $.current.memoizedState.isDehydrated&&(Lk($,b).flags|=256),$=Jk($,b),$!==2&&(b=uk,uk=g,b!==null&&Gj(b)),$}function Gj($){uk===null?uk=$:uk.push.apply(uk,$)}function Pk($){for(var b=$;;){if(b.flags&16384){var g=b.updateQueue;if(g!==null&&(g=g.stores,g!==null))for(var tt=0;tt<g.length;tt++){var ot=g[tt],ut=ot.getSnapshot;ot=ot.value;try{if(!He(ut(),ot))return!1}catch{return!1}}}if(g=b.child,b.subtreeFlags&16384&&g!==null)g.return=b,b=g;else{if(b===$)break;for(;b.sibling===null;){if(b.return===null||b.return===$)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function Dk($,b){for(b&=~sk,b&=~rk,$.suspendedLanes|=b,$.pingedLanes&=~b,$=$.expirationTimes;0<b;){var g=31-oc(b),tt=1<<g;$[g]=-1,b&=~tt}}function Fk($){if(K&6)throw Error(p$1(327));Ik();var b=uc($,0);if(!(b&1))return Ek($,B()),null;var g=Jk($,b);if($.tag!==0&&g===2){var tt=xc($);tt!==0&&(b=tt,g=Ok($,tt))}if(g===1)throw g=qk,Lk($,0),Dk($,b),Ek($,B()),g;if(g===6)throw Error(p$1(345));return $.finishedWork=$.current.alternate,$.finishedLanes=b,Qk($,uk,vk),Ek($,B()),null}function Rk($,b){var g=K;K|=1;try{return $(b)}finally{K=g,K===0&&(Hj=B()+500,fg&&jg())}}function Sk($){xk!==null&&xk.tag===0&&!(K&6)&&Ik();var b=K;K|=1;var g=pk.transition,tt=C;try{if(pk.transition=null,C=1,$)return $()}finally{C=tt,pk.transition=g,K=b,!(K&6)&&jg()}}function Ij(){gj=fj.current,E(fj)}function Lk($,b){$.finishedWork=null,$.finishedLanes=0;var g=$.timeoutHandle;if(g!==-1&&($.timeoutHandle=-1,Gf(g)),Y!==null)for(g=Y.return;g!==null;){var tt=g;switch(wg(tt),tt.tag){case 1:tt=tt.type.childContextTypes,tt!=null&&$f();break;case 3:Jh(),E(Wf),E(H),Oh();break;case 5:Lh(tt);break;case 4:Jh();break;case 13:E(M);break;case 19:E(M);break;case 10:Rg(tt.type._context);break;case 22:case 23:Ij()}g=g.return}if(R=$,Y=$=wh($.current,null),Z=gj=b,T=0,qk=null,sk=rk=hh=0,uk=tk=null,Wg!==null){for(b=0;b<Wg.length;b++)if(g=Wg[b],tt=g.interleaved,tt!==null){g.interleaved=null;var ot=tt.next,ut=g.pending;if(ut!==null){var gt=ut.next;ut.next=ot,tt.next=gt}g.pending=tt}Wg=null}return $}function Nk($,b){do{var g=Y;try{if(Qg(),Ph.current=ai,Sh){for(var tt=N.memoizedState;tt!==null;){var ot=tt.queue;ot!==null&&(ot.pending=null),tt=tt.next}Sh=!1}if(Rh=0,P=O=N=null,Th=!1,Uh=0,ok.current=null,g===null||g.return===null){T=1,qk=b,Y=null;break}e:{var ut=$,gt=g.return,xt=g,It=b;if(b=Z,xt.flags|=32768,It!==null&&typeof It=="object"&&typeof It.then=="function"){var kt=It,Ft=xt,Xt=Ft.tag;if(!(Ft.mode&1)&&(Xt===0||Xt===11||Xt===15)){var qt=Ft.alternate;qt?(Ft.updateQueue=qt.updateQueue,Ft.memoizedState=qt.memoizedState,Ft.lanes=qt.lanes):(Ft.updateQueue=null,Ft.memoizedState=null)}var jt=Vi(gt);if(jt!==null){jt.flags&=-257,Wi(jt,gt,xt,ut,b),jt.mode&1&&Ti(ut,kt,b),b=jt,It=kt;var sn=b.updateQueue;if(sn===null){var Gt=new Set;Gt.add(It),b.updateQueue=Gt}else sn.add(It);break e}else{if(!(b&1)){Ti(ut,kt,b),uj();break e}It=Error(p$1(426))}}else if(I&&xt.mode&1){var vn=Vi(gt);if(vn!==null){!(vn.flags&65536)&&(vn.flags|=256),Wi(vn,gt,xt,ut,b),Jg(Ki(It,xt));break e}}ut=It=Ki(It,xt),T!==4&&(T=2),tk===null?tk=[ut]:tk.push(ut),ut=gt;do{switch(ut.tag){case 3:ut.flags|=65536,b&=-b,ut.lanes|=b;var nn=Oi(ut,It,b);fh(ut,nn);break e;case 1:xt=It;var Wt=ut.type,on=ut.stateNode;if(!(ut.flags&128)&&(typeof Wt.getDerivedStateFromError=="function"||on!==null&&typeof on.componentDidCatch=="function"&&(Si===null||!Si.has(on)))){ut.flags|=65536,b&=-b,ut.lanes|=b;var gn=Ri(ut,xt,b);fh(ut,gn);break e}}ut=ut.return}while(ut!==null)}Tk(g)}catch(ln){b=ln,Y===g&&g!==null&&(Y=g=g.return);continue}break}while(!0)}function Kk(){var $=nk.current;return nk.current=ai,$===null?ai:$}function uj(){(T===0||T===3||T===2)&&(T=4),R===null||!(hh&268435455)&&!(rk&268435455)||Dk(R,Z)}function Jk($,b){var g=K;K|=2;var tt=Kk();(R!==$||Z!==b)&&(vk=null,Lk($,b));do try{Uk();break}catch(ot){Nk($,ot)}while(!0);if(Qg(),K=g,nk.current=tt,Y!==null)throw Error(p$1(261));return R=null,Z=0,T}function Uk(){for(;Y!==null;)Vk(Y)}function Mk(){for(;Y!==null&&!cc();)Vk(Y)}function Vk($){var b=Wk($.alternate,$,gj);$.memoizedProps=$.pendingProps,b===null?Tk($):Y=b,ok.current=null}function Tk($){var b=$;do{var g=b.alternate;if($=b.return,b.flags&32768){if(g=Jj(g,b),g!==null){g.flags&=32767,Y=g;return}if($!==null)$.flags|=32768,$.subtreeFlags=0,$.deletions=null;else{T=6,Y=null;return}}else if(g=Fj(g,b,gj),g!==null){Y=g;return}if(b=b.sibling,b!==null){Y=b;return}Y=b=$}while(b!==null);T===0&&(T=5)}function Qk($,b,g){var tt=C,ot=pk.transition;try{pk.transition=null,C=1,Xk($,b,g,tt)}finally{pk.transition=ot,C=tt}return null}function Xk($,b,g,tt){do Ik();while(xk!==null);if(K&6)throw Error(p$1(327));g=$.finishedWork;var ot=$.finishedLanes;if(g===null)return null;if($.finishedWork=null,$.finishedLanes=0,g===$.current)throw Error(p$1(177));$.callbackNode=null,$.callbackPriority=0;var ut=g.lanes|g.childLanes;if(Bc($,ut),$===R&&(Y=R=null,Z=0),!(g.subtreeFlags&2064)&&!(g.flags&2064)||wk||(wk=!0,Gk(hc,function(){return Ik(),null})),ut=(g.flags&15990)!==0,g.subtreeFlags&15990||ut){ut=pk.transition,pk.transition=null;var gt=C;C=1;var xt=K;K|=4,ok.current=null,Pj($,g),ek(g,$),Oe(Df),dd=!!Cf,Df=Cf=null,$.current=g,ik(g),dc(),K=xt,C=gt,pk.transition=ut}else $.current=g;if(wk&&(wk=!1,xk=$,yk=ot),ut=$.pendingLanes,ut===0&&(Si=null),mc(g.stateNode),Ek($,B()),b!==null)for(tt=$.onRecoverableError,g=0;g<b.length;g++)ot=b[g],tt(ot.value,{componentStack:ot.stack,digest:ot.digest});if(Pi)throw Pi=!1,$=Qi,Qi=null,$;return yk&1&&$.tag!==0&&Ik(),ut=$.pendingLanes,ut&1?$===Ak?zk++:(zk=0,Ak=$):zk=0,jg(),null}function Ik(){if(xk!==null){var $=Dc(yk),b=pk.transition,g=C;try{if(pk.transition=null,C=16>$?16:$,xk===null)var tt=!1;else{if($=xk,xk=null,yk=0,K&6)throw Error(p$1(331));var ot=K;for(K|=4,V=$.current;V!==null;){var ut=V,gt=ut.child;if(V.flags&16){var xt=ut.deletions;if(xt!==null){for(var It=0;It<xt.length;It++){var kt=xt[It];for(V=kt;V!==null;){var Ft=V;switch(Ft.tag){case 0:case 11:case 15:Qj(8,Ft,ut)}var Xt=Ft.child;if(Xt!==null)Xt.return=Ft,V=Xt;else for(;V!==null;){Ft=V;var qt=Ft.sibling,jt=Ft.return;if(Tj(Ft),Ft===kt){V=null;break}if(qt!==null){qt.return=jt,V=qt;break}V=jt}}}var sn=ut.alternate;if(sn!==null){var Gt=sn.child;if(Gt!==null){sn.child=null;do{var vn=Gt.sibling;Gt.sibling=null,Gt=vn}while(Gt!==null)}}V=ut}}if(ut.subtreeFlags&2064&&gt!==null)gt.return=ut,V=gt;else e:for(;V!==null;){if(ut=V,ut.flags&2048)switch(ut.tag){case 0:case 11:case 15:Qj(9,ut,ut.return)}var nn=ut.sibling;if(nn!==null){nn.return=ut.return,V=nn;break e}V=ut.return}}var Wt=$.current;for(V=Wt;V!==null;){gt=V;var on=gt.child;if(gt.subtreeFlags&2064&&on!==null)on.return=gt,V=on;else e:for(gt=Wt;V!==null;){if(xt=V,xt.flags&2048)try{switch(xt.tag){case 0:case 11:case 15:Rj(9,xt)}}catch(ln){W(xt,xt.return,ln)}if(xt===gt){V=null;break e}var gn=xt.sibling;if(gn!==null){gn.return=xt.return,V=gn;break e}V=xt.return}}if(K=ot,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,$)}catch{}tt=!0}return tt}finally{C=g,pk.transition=b}}return!1}function Yk($,b,g){b=Ki(g,b),b=Oi($,b,1),$=dh($,b,1),b=L(),$!==null&&(Ac($,1,b),Ek($,b))}function W($,b,g){if($.tag===3)Yk($,$,g);else for(;b!==null;){if(b.tag===3){Yk(b,$,g);break}else if(b.tag===1){var tt=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof tt.componentDidCatch=="function"&&(Si===null||!Si.has(tt))){$=Ki(g,$),$=Ri(b,$,1),b=dh(b,$,1),$=L(),b!==null&&(Ac(b,1,$),Ek(b,$));break}}b=b.return}}function Ui($,b,g){var tt=$.pingCache;tt!==null&&tt.delete(b),b=L(),$.pingedLanes|=$.suspendedLanes&g,R===$&&(Z&g)===g&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-gk?Lk($,0):sk|=g),Ek($,b)}function Zk($,b){b===0&&($.mode&1?(b=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):b=1);var g=L();$=Zg($,b),$!==null&&(Ac($,b,g),Ek($,g))}function vj($){var b=$.memoizedState,g=0;b!==null&&(g=b.retryLane),Zk($,g)}function ck($,b){var g=0;switch($.tag){case 13:var tt=$.stateNode,ot=$.memoizedState;ot!==null&&(g=ot.retryLane);break;case 19:tt=$.stateNode;break;default:throw Error(p$1(314))}tt!==null&&tt.delete(b),Zk($,g)}var Wk;Wk=function($,b,g){if($!==null)if($.memoizedProps!==b.pendingProps||Wf.current)Ug=!0;else{if(!($.lanes&g)&&!(b.flags&128))return Ug=!1,zj($,b,g);Ug=!!($.flags&131072)}else Ug=!1,I&&b.flags&1048576&&ug(b,ng,b.index);switch(b.lanes=0,b.tag){case 2:var tt=b.type;jj($,b),$=b.pendingProps;var ot=Yf(b,H.current);Tg(b,g),ot=Xh(null,b,tt,$,ot,g);var ut=bi();return b.flags|=1,typeof ot=="object"&&ot!==null&&typeof ot.render=="function"&&ot.$$typeof===void 0?(b.tag=1,b.memoizedState=null,b.updateQueue=null,Zf(tt)?(ut=!0,cg(b)):ut=!1,b.memoizedState=ot.state!==null&&ot.state!==void 0?ot.state:null,ah(b),ot.updater=nh,b.stateNode=ot,ot._reactInternals=b,rh(b,tt,$,g),b=kj(null,b,tt,!0,ut,g)):(b.tag=0,I&&ut&&vg(b),Yi(null,b,ot,g),b=b.child),b;case 16:tt=b.elementType;e:{switch(jj($,b),$=b.pendingProps,ot=tt._init,tt=ot(tt._payload),b.type=tt,ot=b.tag=$k(tt),$=Lg(tt,$),ot){case 0:b=dj(null,b,tt,$,g);break e;case 1:b=ij(null,b,tt,$,g);break e;case 11:b=Zi(null,b,tt,$,g);break e;case 14:b=aj(null,b,tt,Lg(tt.type,$),g);break e}throw Error(p$1(306,tt,""))}return b;case 0:return tt=b.type,ot=b.pendingProps,ot=b.elementType===tt?ot:Lg(tt,ot),dj($,b,tt,ot,g);case 1:return tt=b.type,ot=b.pendingProps,ot=b.elementType===tt?ot:Lg(tt,ot),ij($,b,tt,ot,g);case 3:e:{if(lj(b),$===null)throw Error(p$1(387));tt=b.pendingProps,ut=b.memoizedState,ot=ut.element,bh($,b),gh(b,tt,null,g);var gt=b.memoizedState;if(tt=gt.element,ut.isDehydrated)if(ut={element:tt,isDehydrated:!1,cache:gt.cache,pendingSuspenseBoundaries:gt.pendingSuspenseBoundaries,transitions:gt.transitions},b.updateQueue.baseState=ut,b.memoizedState=ut,b.flags&256){ot=Ki(Error(p$1(423)),b),b=mj($,b,tt,g,ot);break e}else if(tt!==ot){ot=Ki(Error(p$1(424)),b),b=mj($,b,tt,g,ot);break e}else for(yg=Lf(b.stateNode.containerInfo.firstChild),xg=b,I=!0,zg=null,g=Ch(b,null,tt,g),b.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling;else{if(Ig(),tt===ot){b=$i($,b,g);break e}Yi($,b,tt,g)}b=b.child}return b;case 5:return Kh(b),$===null&&Eg(b),tt=b.type,ot=b.pendingProps,ut=$!==null?$.memoizedProps:null,gt=ot.children,Ef(tt,ot)?gt=null:ut!==null&&Ef(tt,ut)&&(b.flags|=32),hj($,b),Yi($,b,gt,g),b.child;case 6:return $===null&&Eg(b),null;case 13:return pj($,b,g);case 4:return Ih(b,b.stateNode.containerInfo),tt=b.pendingProps,$===null?b.child=Bh(b,null,tt,g):Yi($,b,tt,g),b.child;case 11:return tt=b.type,ot=b.pendingProps,ot=b.elementType===tt?ot:Lg(tt,ot),Zi($,b,tt,ot,g);case 7:return Yi($,b,b.pendingProps,g),b.child;case 8:return Yi($,b,b.pendingProps.children,g),b.child;case 12:return Yi($,b,b.pendingProps.children,g),b.child;case 10:e:{if(tt=b.type._context,ot=b.pendingProps,ut=b.memoizedProps,gt=ot.value,G(Mg,tt._currentValue),tt._currentValue=gt,ut!==null)if(He(ut.value,gt)){if(ut.children===ot.children&&!Wf.current){b=$i($,b,g);break e}}else for(ut=b.child,ut!==null&&(ut.return=b);ut!==null;){var xt=ut.dependencies;if(xt!==null){gt=ut.child;for(var It=xt.firstContext;It!==null;){if(It.context===tt){if(ut.tag===1){It=ch(-1,g&-g),It.tag=2;var kt=ut.updateQueue;if(kt!==null){kt=kt.shared;var Ft=kt.pending;Ft===null?It.next=It:(It.next=Ft.next,Ft.next=It),kt.pending=It}}ut.lanes|=g,It=ut.alternate,It!==null&&(It.lanes|=g),Sg(ut.return,g,b),xt.lanes|=g;break}It=It.next}}else if(ut.tag===10)gt=ut.type===b.type?null:ut.child;else if(ut.tag===18){if(gt=ut.return,gt===null)throw Error(p$1(341));gt.lanes|=g,xt=gt.alternate,xt!==null&&(xt.lanes|=g),Sg(gt,g,b),gt=ut.sibling}else gt=ut.child;if(gt!==null)gt.return=ut;else for(gt=ut;gt!==null;){if(gt===b){gt=null;break}if(ut=gt.sibling,ut!==null){ut.return=gt.return,gt=ut;break}gt=gt.return}ut=gt}Yi($,b,ot.children,g),b=b.child}return b;case 9:return ot=b.type,tt=b.pendingProps.children,Tg(b,g),ot=Vg(ot),tt=tt(ot),b.flags|=1,Yi($,b,tt,g),b.child;case 14:return tt=b.type,ot=Lg(tt,b.pendingProps),ot=Lg(tt.type,ot),aj($,b,tt,ot,g);case 15:return cj($,b,b.type,b.pendingProps,g);case 17:return tt=b.type,ot=b.pendingProps,ot=b.elementType===tt?ot:Lg(tt,ot),jj($,b),b.tag=1,Zf(tt)?($=!0,cg(b)):$=!1,Tg(b,g),ph(b,tt,ot),rh(b,tt,ot,g),kj(null,b,tt,!0,$,g);case 19:return yj($,b,g);case 22:return ej($,b,g)}throw Error(p$1(156,b.tag))};function Gk($,b){return ac($,b)}function al($,b,g,tt){this.tag=$,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=tt,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg($,b,g,tt){return new al($,b,g,tt)}function bj($){return $=$.prototype,!(!$||!$.isReactComponent)}function $k($){if(typeof $=="function")return bj($)?1:0;if($!=null){if($=$.$$typeof,$===Da)return 11;if($===Ga)return 14}return 2}function wh($,b){var g=$.alternate;return g===null?(g=Bg($.tag,b,$.key,$.mode),g.elementType=$.elementType,g.type=$.type,g.stateNode=$.stateNode,g.alternate=$,$.alternate=g):(g.pendingProps=b,g.type=$.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=$.flags&14680064,g.childLanes=$.childLanes,g.lanes=$.lanes,g.child=$.child,g.memoizedProps=$.memoizedProps,g.memoizedState=$.memoizedState,g.updateQueue=$.updateQueue,b=$.dependencies,g.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},g.sibling=$.sibling,g.index=$.index,g.ref=$.ref,g}function yh($,b,g,tt,ot,ut){var gt=2;if(tt=$,typeof $=="function")bj($)&&(gt=1);else if(typeof $=="string")gt=5;else e:switch($){case ya:return Ah(g.children,ot,ut,b);case za:gt=8,ot|=8;break;case Aa:return $=Bg(12,g,b,ot|2),$.elementType=Aa,$.lanes=ut,$;case Ea:return $=Bg(13,g,b,ot),$.elementType=Ea,$.lanes=ut,$;case Fa:return $=Bg(19,g,b,ot),$.elementType=Fa,$.lanes=ut,$;case Ia:return qj(g,ot,ut,b);default:if(typeof $=="object"&&$!==null)switch($.$$typeof){case Ba:gt=10;break e;case Ca:gt=9;break e;case Da:gt=11;break e;case Ga:gt=14;break e;case Ha:gt=16,tt=null;break e}throw Error(p$1(130,$==null?$:typeof $,""))}return b=Bg(gt,g,b,ot),b.elementType=$,b.type=tt,b.lanes=ut,b}function Ah($,b,g,tt){return $=Bg(7,$,tt,b),$.lanes=g,$}function qj($,b,g,tt){return $=Bg(22,$,tt,b),$.elementType=Ia,$.lanes=g,$.stateNode={isHidden:!1},$}function xh($,b,g){return $=Bg(6,$,null,b),$.lanes=g,$}function zh($,b,g){return b=Bg(4,$.children!==null?$.children:[],$.key,b),b.lanes=g,b.stateNode={containerInfo:$.containerInfo,pendingChildren:null,implementation:$.implementation},b}function bl($,b,g,tt,ot){this.tag=b,this.containerInfo=$,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=tt,this.onRecoverableError=ot,this.mutableSourceEagerHydrationData=null}function cl($,b,g,tt,ot,ut,gt,xt,It){return $=new bl($,b,g,xt,It),b===1?(b=1,ut===!0&&(b|=8)):b=0,ut=Bg(3,null,null,b),$.current=ut,ut.stateNode=$,ut.memoizedState={element:tt,isDehydrated:g,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah(ut),$}function dl($,b,g){var tt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:tt==null?null:""+tt,children:$,containerInfo:b,implementation:g}}function el($){if(!$)return Vf;$=$._reactInternals;e:{if(Vb($)!==$||$.tag!==1)throw Error(p$1(170));var b=$;do{switch(b.tag){case 3:b=b.stateNode.context;break e;case 1:if(Zf(b.type)){b=b.stateNode.__reactInternalMemoizedMergedChildContext;break e}}b=b.return}while(b!==null);throw Error(p$1(171))}if($.tag===1){var g=$.type;if(Zf(g))return bg($,g,b)}return b}function fl($,b,g,tt,ot,ut,gt,xt,It){return $=cl(g,tt,!0,$,ot,ut,gt,xt,It),$.context=el(null),g=$.current,tt=L(),ot=lh(g),ut=ch(tt,ot),ut.callback=b??null,dh(g,ut,ot),$.current.lanes=ot,Ac($,ot,tt),Ek($,tt),$}function gl($,b,g,tt){var ot=b.current,ut=L(),gt=lh(ot);return g=el(g),b.context===null?b.context=g:b.pendingContext=g,b=ch(ut,gt),b.payload={element:$},tt=tt===void 0?null:tt,tt!==null&&(b.callback=tt),$=dh(ot,b,gt),$!==null&&(mh($,ot,gt,ut),eh($,ot,gt)),gt}function hl($){if($=$.current,!$.child)return null;switch($.child.tag){case 5:return $.child.stateNode;default:return $.child.stateNode}}function il($,b){if($=$.memoizedState,$!==null&&$.dehydrated!==null){var g=$.retryLane;$.retryLane=g!==0&&g<b?g:b}}function jl($,b){il($,b),($=$.alternate)&&il($,b)}function kl(){return null}var ll=typeof reportError=="function"?reportError:function($){console.error($)};function ml($){this._internalRoot=$}nl.prototype.render=ml.prototype.render=function($){var b=this._internalRoot;if(b===null)throw Error(p$1(409));gl($,b,null,null)};nl.prototype.unmount=ml.prototype.unmount=function(){var $=this._internalRoot;if($!==null){this._internalRoot=null;var b=$.containerInfo;Sk(function(){gl(null,$,null,null)}),b[uf]=null}};function nl($){this._internalRoot=$}nl.prototype.unstable_scheduleHydration=function($){if($){var b=Hc();$={blockedOn:null,target:$,priority:b};for(var g=0;g<Qc.length&&b!==0&&b<Qc[g].priority;g++);Qc.splice(g,0,$),g===0&&Vc($)}};function ol($){return!(!$||$.nodeType!==1&&$.nodeType!==9&&$.nodeType!==11)}function pl($){return!(!$||$.nodeType!==1&&$.nodeType!==9&&$.nodeType!==11&&($.nodeType!==8||$.nodeValue!==" react-mount-point-unstable "))}function ql(){}function rl($,b,g,tt,ot){if(ot){if(typeof tt=="function"){var ut=tt;tt=function(){var kt=hl(gt);ut.call(kt)}}var gt=fl(b,tt,$,0,null,!1,!1,"",ql);return $._reactRootContainer=gt,$[uf]=gt.current,sf($.nodeType===8?$.parentNode:$),Sk(),gt}for(;ot=$.lastChild;)$.removeChild(ot);if(typeof tt=="function"){var xt=tt;tt=function(){var kt=hl(It);xt.call(kt)}}var It=cl($,0,!1,null,null,!1,!1,"",ql);return $._reactRootContainer=It,$[uf]=It.current,sf($.nodeType===8?$.parentNode:$),Sk(function(){gl(b,It,g,tt)}),It}function sl($,b,g,tt,ot){var ut=g._reactRootContainer;if(ut){var gt=ut;if(typeof ot=="function"){var xt=ot;ot=function(){var It=hl(gt);xt.call(It)}}gl(b,gt,$,ot)}else gt=rl(g,b,$,ot,tt);return hl(gt)}Ec=function($){switch($.tag){case 3:var b=$.stateNode;if(b.current.memoizedState.isDehydrated){var g=tc(b.pendingLanes);g!==0&&(Cc(b,g|1),Ek(b,B()),!(K&6)&&(Hj=B()+500,jg()))}break;case 13:Sk(function(){var tt=Zg($,1);if(tt!==null){var ot=L();mh(tt,$,1,ot)}}),jl($,1)}};Fc=function($){if($.tag===13){var b=Zg($,134217728);if(b!==null){var g=L();mh(b,$,134217728,g)}jl($,134217728)}};Gc=function($){if($.tag===13){var b=lh($),g=Zg($,b);if(g!==null){var tt=L();mh(g,$,b,tt)}jl($,b)}};Hc=function(){return C};Ic=function($,b){var g=C;try{return C=$,b()}finally{C=g}};yb=function($,b,g){switch(b){case"input":if(bb($,g),b=g.name,g.type==="radio"&&b!=null){for(g=$;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]'),b=0;b<g.length;b++){var tt=g[b];if(tt!==$&&tt.form===$.form){var ot=Db(tt);if(!ot)throw Error(p$1(90));Wa(tt),bb(tt,ot)}}}break;case"textarea":ib($,g);break;case"select":b=g.value,b!=null&&fb($,!!g.multiple,b,!1)}};Gb=Rk;Hb=Sk;var tl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Rk]},ul={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},vl={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function($){return $=Zb($),$===null?null:$.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||kl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wl.isDisabled&&wl.supportsFiber)try{kc=wl.inject(vl),lc=wl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl;reactDom_production_min.createPortal=function($,b){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ol(b))throw Error(p$1(200));return dl($,b,null,g)};reactDom_production_min.createRoot=function($,b){if(!ol($))throw Error(p$1(299));var g=!1,tt="",ot=ll;return b!=null&&(b.unstable_strictMode===!0&&(g=!0),b.identifierPrefix!==void 0&&(tt=b.identifierPrefix),b.onRecoverableError!==void 0&&(ot=b.onRecoverableError)),b=cl($,1,!1,null,null,g,!1,tt,ot),$[uf]=b.current,sf($.nodeType===8?$.parentNode:$),new ml(b)};reactDom_production_min.findDOMNode=function($){if($==null)return null;if($.nodeType===1)return $;var b=$._reactInternals;if(b===void 0)throw typeof $.render=="function"?Error(p$1(188)):($=Object.keys($).join(","),Error(p$1(268,$)));return $=Zb(b),$=$===null?null:$.stateNode,$};reactDom_production_min.flushSync=function($){return Sk($)};reactDom_production_min.hydrate=function($,b,g){if(!pl(b))throw Error(p$1(200));return sl(null,$,b,!0,g)};reactDom_production_min.hydrateRoot=function($,b,g){if(!ol($))throw Error(p$1(405));var tt=g!=null&&g.hydratedSources||null,ot=!1,ut="",gt=ll;if(g!=null&&(g.unstable_strictMode===!0&&(ot=!0),g.identifierPrefix!==void 0&&(ut=g.identifierPrefix),g.onRecoverableError!==void 0&&(gt=g.onRecoverableError)),b=fl(b,null,$,1,g??null,ot,!1,ut,gt),$[uf]=b.current,sf($),tt)for($=0;$<tt.length;$++)g=tt[$],ot=g._getVersion,ot=ot(g._source),b.mutableSourceEagerHydrationData==null?b.mutableSourceEagerHydrationData=[g,ot]:b.mutableSourceEagerHydrationData.push(g,ot);return new nl(b)};reactDom_production_min.render=function($,b,g){if(!pl(b))throw Error(p$1(200));return sl(null,$,b,!1,g)};reactDom_production_min.unmountComponentAtNode=function($){if(!pl($))throw Error(p$1(40));return $._reactRootContainer?(Sk(function(){sl(null,null,$,!1,function(){$._reactRootContainer=null,$[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Rk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function($,b,g,tt){if(!pl(g))throw Error(p$1(200));if($==null||$._reactInternals===void 0)throw Error(p$1(38));return sl($,b,g,!1,tt)};reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch($){console.error($)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,m=reactDomExports;client.createRoot=m.createRoot,client.hydrateRoot=m.hydrateRoot;var faK={prefix:"fas",iconName:"k",icon:[320,512,[107],"4b","M311 86.3c12.3-12.7 12-32.9-.7-45.2s-32.9-12-45.2 .7l-155.2 160L64 249V64c0-17.7-14.3-32-32-32S0 46.3 0 64V328 448c0 17.7 14.3 32 32 32s32-14.3 32-32V341l64.7-66.7 133 192c10.1 14.5 30 18.1 44.5 8.1s18.1-30 8.1-44.5L174.1 227.4 311 86.3z"]};function ownKeys$1($,b){var g=Object.keys($);if(Object.getOwnPropertySymbols){var tt=Object.getOwnPropertySymbols($);b&&(tt=tt.filter(function(ot){return Object.getOwnPropertyDescriptor($,ot).enumerable})),g.push.apply(g,tt)}return g}function _objectSpread2$1($){for(var b=1;b<arguments.length;b++){var g=arguments[b]!=null?arguments[b]:{};b%2?ownKeys$1(Object(g),!0).forEach(function(tt){_defineProperty$1($,tt,g[tt])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(g)):ownKeys$1(Object(g)).forEach(function(tt){Object.defineProperty($,tt,Object.getOwnPropertyDescriptor(g,tt))})}return $}function _typeof$1($){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},_typeof$1($)}function _classCallCheck($,b){if(!($ instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1($,b){for(var g=0;g<b.length;g++){var tt=b[g];tt.enumerable=tt.enumerable||!1,tt.configurable=!0,"value"in tt&&(tt.writable=!0),Object.defineProperty($,tt.key,tt)}}function _createClass$1($,b,g){return b&&_defineProperties$1($.prototype,b),g&&_defineProperties$1($,g),Object.defineProperty($,"prototype",{writable:!1}),$}function _defineProperty$1($,b,g){return b in $?Object.defineProperty($,b,{value:g,enumerable:!0,configurable:!0,writable:!0}):$[b]=g,$}function _slicedToArray($,b){return _arrayWithHoles($)||_iterableToArrayLimit($,b)||_unsupportedIterableToArray$1($,b)||_nonIterableRest()}function _toConsumableArray$1($){return _arrayWithoutHoles$1($)||_iterableToArray$1($)||_unsupportedIterableToArray$1($)||_nonIterableSpread$1()}function _arrayWithoutHoles$1($){if(Array.isArray($))return _arrayLikeToArray$1($)}function _arrayWithHoles($){if(Array.isArray($))return $}function _iterableToArray$1($){if(typeof Symbol<"u"&&$[Symbol.iterator]!=null||$["@@iterator"]!=null)return Array.from($)}function _iterableToArrayLimit($,b){var g=$==null?null:typeof Symbol<"u"&&$[Symbol.iterator]||$["@@iterator"];if(g!=null){var tt=[],ot=!0,ut=!1,gt,xt;try{for(g=g.call($);!(ot=(gt=g.next()).done)&&(tt.push(gt.value),!(b&&tt.length===b));ot=!0);}catch(It){ut=!0,xt=It}finally{try{!ot&&g.return!=null&&g.return()}finally{if(ut)throw xt}}return tt}}function _unsupportedIterableToArray$1($,b){if($){if(typeof $=="string")return _arrayLikeToArray$1($,b);var g=Object.prototype.toString.call($).slice(8,-1);if(g==="Object"&&$.constructor&&(g=$.constructor.name),g==="Map"||g==="Set")return Array.from($);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$1($,b)}}function _arrayLikeToArray$1($,b){(b==null||b>$.length)&&(b=$.length);for(var g=0,tt=new Array(b);g<b;g++)tt[g]=$[g];return tt}function _nonIterableSpread$1(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var noop=function(){},_WINDOW={},_DOCUMENT={},_MUTATION_OBSERVER=null,_PERFORMANCE={mark:noop,measure:noop};try{typeof window<"u"&&(_WINDOW=window),typeof document<"u"&&(_DOCUMENT=document),typeof MutationObserver<"u"&&(_MUTATION_OBSERVER=MutationObserver),typeof performance<"u"&&(_PERFORMANCE=performance)}catch{}var _ref=_WINDOW.navigator||{},_ref$userAgent=_ref.userAgent,userAgent=_ref$userAgent===void 0?"":_ref$userAgent,WINDOW=_WINDOW,DOCUMENT=_DOCUMENT,MUTATION_OBSERVER=_MUTATION_OBSERVER,PERFORMANCE=_PERFORMANCE;WINDOW.document;var IS_DOM=!!DOCUMENT.documentElement&&!!DOCUMENT.head&&typeof DOCUMENT.addEventListener=="function"&&typeof DOCUMENT.createElement=="function",IS_IE=~userAgent.indexOf("MSIE")||~userAgent.indexOf("Trident/"),_familyProxy,_familyProxy2,_familyProxy3,_familyProxy4,_familyProxy5,NAMESPACE_IDENTIFIER="___FONT_AWESOME___",UNITS_IN_GRID=16,DEFAULT_CSS_PREFIX="fa",DEFAULT_REPLACEMENT_CLASS="svg-inline--fa",DATA_FA_I2SVG="data-fa-i2svg",DATA_FA_PSEUDO_ELEMENT="data-fa-pseudo-element",DATA_FA_PSEUDO_ELEMENT_PENDING="data-fa-pseudo-element-pending",DATA_PREFIX="data-prefix",DATA_ICON="data-icon",HTML_CLASS_I2SVG_BASE_CLASS="fontawesome-i2svg",MUTATION_APPROACH_ASYNC="async",TAGNAMES_TO_SKIP_FOR_PSEUDOELEMENTS=["HTML","HEAD","STYLE","SCRIPT"],PRODUCTION$1=function(){try{return!0}catch{return!1}}(),FAMILY_CLASSIC="classic",FAMILY_SHARP="sharp",FAMILIES=[FAMILY_CLASSIC,FAMILY_SHARP];function familyProxy($){return new Proxy($,{get:function(g,tt){return tt in g?g[tt]:g[FAMILY_CLASSIC]}})}var PREFIX_TO_STYLE=familyProxy((_familyProxy={},_defineProperty$1(_familyProxy,FAMILY_CLASSIC,{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fad:"duotone","fa-duotone":"duotone",fab:"brands","fa-brands":"brands",fak:"kit",fakd:"kit","fa-kit":"kit","fa-kit-duotone":"kit"}),_defineProperty$1(_familyProxy,FAMILY_SHARP,{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"}),_familyProxy)),STYLE_TO_PREFIX=familyProxy((_familyProxy2={},_defineProperty$1(_familyProxy2,FAMILY_CLASSIC,{solid:"fas",regular:"far",light:"fal",thin:"fat",duotone:"fad",brands:"fab",kit:"fak"}),_defineProperty$1(_familyProxy2,FAMILY_SHARP,{solid:"fass",regular:"fasr",light:"fasl",thin:"fast"}),_familyProxy2)),PREFIX_TO_LONG_STYLE=familyProxy((_familyProxy3={},_defineProperty$1(_familyProxy3,FAMILY_CLASSIC,{fab:"fa-brands",fad:"fa-duotone",fak:"fa-kit",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"}),_defineProperty$1(_familyProxy3,FAMILY_SHARP,{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"}),_familyProxy3)),LONG_STYLE_TO_PREFIX=familyProxy((_familyProxy4={},_defineProperty$1(_familyProxy4,FAMILY_CLASSIC,{"fa-brands":"fab","fa-duotone":"fad","fa-kit":"fak","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"}),_defineProperty$1(_familyProxy4,FAMILY_SHARP,{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"}),_familyProxy4)),ICON_SELECTION_SYNTAX_PATTERN=/fa(s|r|l|t|d|b|k|ss|sr|sl|st)?[\-\ ]/,LAYERS_TEXT_CLASSNAME="fa-layers-text",FONT_FAMILY_PATTERN=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp|Kit)?.*/i,FONT_WEIGHT_TO_PREFIX=familyProxy((_familyProxy5={},_defineProperty$1(_familyProxy5,FAMILY_CLASSIC,{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"}),_defineProperty$1(_familyProxy5,FAMILY_SHARP,{900:"fass",400:"fasr",300:"fasl",100:"fast"}),_familyProxy5)),oneToTen=[1,2,3,4,5,6,7,8,9,10],oneToTwenty=oneToTen.concat([11,12,13,14,15,16,17,18,19,20]),ATTRIBUTES_WATCHED_FOR_MUTATION=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],DUOTONE_CLASSES={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},prefixes=new Set;Object.keys(STYLE_TO_PREFIX[FAMILY_CLASSIC]).map(prefixes.add.bind(prefixes));Object.keys(STYLE_TO_PREFIX[FAMILY_SHARP]).map(prefixes.add.bind(prefixes));var RESERVED_CLASSES=[].concat(FAMILIES,_toConsumableArray$1(prefixes),["2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",DUOTONE_CLASSES.GROUP,DUOTONE_CLASSES.SWAP_OPACITY,DUOTONE_CLASSES.PRIMARY,DUOTONE_CLASSES.SECONDARY]).concat(oneToTen.map(function($){return"".concat($,"x")})).concat(oneToTwenty.map(function($){return"w-".concat($)})),initial=WINDOW.FontAwesomeConfig||{};function getAttrConfig($){var b=DOCUMENT.querySelector("script["+$+"]");if(b)return b.getAttribute($)}function coerce($){return $===""?!0:$==="false"?!1:$==="true"?!0:$}if(DOCUMENT&&typeof DOCUMENT.querySelector=="function"){var attrs=[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]];attrs.forEach(function($){var b=_slicedToArray($,2),g=b[0],tt=b[1],ot=coerce(getAttrConfig(g));ot!=null&&(initial[tt]=ot)})}var _default={styleDefault:"solid",familyDefault:"classic",cssPrefix:DEFAULT_CSS_PREFIX,replacementClass:DEFAULT_REPLACEMENT_CLASS,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};initial.familyPrefix&&(initial.cssPrefix=initial.familyPrefix);var _config$1=_objectSpread2$1(_objectSpread2$1({},_default),initial);_config$1.autoReplaceSvg||(_config$1.observeMutations=!1);var config={};Object.keys(_default).forEach(function($){Object.defineProperty(config,$,{enumerable:!0,set:function(g){_config$1[$]=g,_onChangeCb.forEach(function(tt){return tt(config)})},get:function(){return _config$1[$]}})});Object.defineProperty(config,"familyPrefix",{enumerable:!0,set:function(b){_config$1.cssPrefix=b,_onChangeCb.forEach(function(g){return g(config)})},get:function(){return _config$1.cssPrefix}});WINDOW.FontAwesomeConfig=config;var _onChangeCb=[];function onChange($){return _onChangeCb.push($),function(){_onChangeCb.splice(_onChangeCb.indexOf($),1)}}var d=UNITS_IN_GRID,meaninglessTransform={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function insertCss($){if(!(!$||!IS_DOM)){var b=DOCUMENT.createElement("style");b.setAttribute("type","text/css"),b.innerHTML=$;for(var g=DOCUMENT.head.childNodes,tt=null,ot=g.length-1;ot>-1;ot--){var ut=g[ot],gt=(ut.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(gt)>-1&&(tt=ut)}return DOCUMENT.head.insertBefore(b,tt),$}}var idPool="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function nextUniqueId(){for(var $=12,b="";$-- >0;)b+=idPool[Math.random()*62|0];return b}function toArray$1($){for(var b=[],g=($||[]).length>>>0;g--;)b[g]=$[g];return b}function classArray($){return $.classList?toArray$1($.classList):($.getAttribute("class")||"").split(" ").filter(function(b){return b})}function htmlEscape($){return"".concat($).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function joinAttributes($){return Object.keys($||{}).reduce(function(b,g){return b+"".concat(g,'="').concat(htmlEscape($[g]),'" ')},"").trim()}function joinStyles($){return Object.keys($||{}).reduce(function(b,g){return b+"".concat(g,": ").concat($[g].trim(),";")},"")}function transformIsMeaningful($){return $.size!==meaninglessTransform.size||$.x!==meaninglessTransform.x||$.y!==meaninglessTransform.y||$.rotate!==meaninglessTransform.rotate||$.flipX||$.flipY}function transformForSvg($){var b=$.transform,g=$.containerWidth,tt=$.iconWidth,ot={transform:"translate(".concat(g/2," 256)")},ut="translate(".concat(b.x*32,", ").concat(b.y*32,") "),gt="scale(".concat(b.size/16*(b.flipX?-1:1),", ").concat(b.size/16*(b.flipY?-1:1),") "),xt="rotate(".concat(b.rotate," 0 0)"),It={transform:"".concat(ut," ").concat(gt," ").concat(xt)},kt={transform:"translate(".concat(tt/2*-1," -256)")};return{outer:ot,inner:It,path:kt}}function transformForCss($){var b=$.transform,g=$.width,tt=g===void 0?UNITS_IN_GRID:g,ot=$.height,ut=ot===void 0?UNITS_IN_GRID:ot,gt=$.startCentered,xt=gt===void 0?!1:gt,It="";return xt&&IS_IE?It+="translate(".concat(b.x/d-tt/2,"em, ").concat(b.y/d-ut/2,"em) "):xt?It+="translate(calc(-50% + ".concat(b.x/d,"em), calc(-50% + ").concat(b.y/d,"em)) "):It+="translate(".concat(b.x/d,"em, ").concat(b.y/d,"em) "),It+="scale(".concat(b.size/d*(b.flipX?-1:1),", ").concat(b.size/d*(b.flipY?-1:1),") "),It+="rotate(".concat(b.rotate,"deg) "),It}var baseStyles=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Solid";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Regular";
  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Light";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Thin";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 6 Sharp";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
}

svg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {
  overflow: visible;
  box-sizing: content-box;
}

.svg-inline--fa {
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285705em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  top: 0.25em;
}
.svg-inline--fa.fa-fw {
  width: var(--fa-fw-width, 1.25em);
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  -webkit-transform: scale(var(--fa-counter-scale, 0.25));
          transform: scale(var(--fa-counter-scale, 0.25));
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: bottom right;
          transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: bottom left;
          transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: top left;
          transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: 0.625em;
  line-height: 0.1em;
  vertical-align: 0.225em;
}

.fa-xs {
  font-size: 0.75em;
  line-height: 0.0833333337em;
  vertical-align: 0.125em;
}

.fa-sm {
  font-size: 0.875em;
  line-height: 0.0714285718em;
  vertical-align: 0.0535714295em;
}

.fa-lg {
  font-size: 1.25em;
  line-height: 0.05em;
  vertical-align: -0.075em;
}

.fa-xl {
  font-size: 1.5em;
  line-height: 0.0416666682em;
  vertical-align: -0.125em;
}

.fa-2xl {
  font-size: 2em;
  line-height: 0.03125em;
  vertical-align: -0.1875em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: var(--fa-li-margin, 2.5em);
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: calc(var(--fa-li-width, 2em) * -1);
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.08em);
  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);
}

.fa-pull-left {
  float: left;
  margin-right: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right {
  float: right;
  margin-left: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  -webkit-animation-name: fa-beat;
          animation-name: fa-beat;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, ease-in-out);
          animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  -webkit-animation-name: fa-bounce;
          animation-name: fa-bounce;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  -webkit-animation-name: fa-fade;
          animation-name: fa-fade;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  -webkit-animation-name: fa-beat-fade;
          animation-name: fa-beat-fade;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  -webkit-animation-name: fa-flip;
          animation-name: fa-flip;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, ease-in-out);
          animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  -webkit-animation-name: fa-shake;
          animation-name: fa-shake;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, linear);
          animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  -webkit-animation-name: fa-spin;
          animation-name: fa-spin;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 2s);
          animation-duration: var(--fa-animation-duration, 2s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, linear);
          animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  -webkit-animation-name: fa-spin;
          animation-name: fa-spin;
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, steps(8));
          animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
.fa-bounce,
.fa-fade,
.fa-beat-fade,
.fa-flip,
.fa-pulse,
.fa-shake,
.fa-spin,
.fa-spin-pulse {
    -webkit-animation-delay: -1ms;
            animation-delay: -1ms;
    -webkit-animation-duration: 1ms;
            animation-duration: 1ms;
    -webkit-animation-iteration-count: 1;
            animation-iteration-count: 1;
    -webkit-transition-delay: 0s;
            transition-delay: 0s;
    -webkit-transition-duration: 0s;
            transition-duration: 0s;
  }
}
@-webkit-keyframes fa-beat {
  0%, 90% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  45% {
    -webkit-transform: scale(var(--fa-beat-scale, 1.25));
            transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-beat {
  0%, 90% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  45% {
    -webkit-transform: scale(var(--fa-beat-scale, 1.25));
            transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@-webkit-keyframes fa-bounce {
  0% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  10% {
    -webkit-transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
            transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    -webkit-transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
            transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    -webkit-transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
            transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    -webkit-transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
            transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  100% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-bounce {
  0% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  10% {
    -webkit-transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
            transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    -webkit-transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
            transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    -webkit-transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
            transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    -webkit-transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
            transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  100% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
}
@-webkit-keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@-webkit-keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  50% {
    opacity: 1;
    -webkit-transform: scale(var(--fa-beat-fade-scale, 1.125));
            transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  50% {
    opacity: 1;
    -webkit-transform: scale(var(--fa-beat-fade-scale, 1.125));
            transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@-webkit-keyframes fa-flip {
  50% {
    -webkit-transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
            transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-flip {
  50% {
    -webkit-transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
            transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@-webkit-keyframes fa-shake {
  0% {
    -webkit-transform: rotate(-15deg);
            transform: rotate(-15deg);
  }
  4% {
    -webkit-transform: rotate(15deg);
            transform: rotate(15deg);
  }
  8%, 24% {
    -webkit-transform: rotate(-18deg);
            transform: rotate(-18deg);
  }
  12%, 28% {
    -webkit-transform: rotate(18deg);
            transform: rotate(18deg);
  }
  16% {
    -webkit-transform: rotate(-22deg);
            transform: rotate(-22deg);
  }
  20% {
    -webkit-transform: rotate(22deg);
            transform: rotate(22deg);
  }
  32% {
    -webkit-transform: rotate(-12deg);
            transform: rotate(-12deg);
  }
  36% {
    -webkit-transform: rotate(12deg);
            transform: rotate(12deg);
  }
  40%, 100% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
}
@keyframes fa-shake {
  0% {
    -webkit-transform: rotate(-15deg);
            transform: rotate(-15deg);
  }
  4% {
    -webkit-transform: rotate(15deg);
            transform: rotate(15deg);
  }
  8%, 24% {
    -webkit-transform: rotate(-18deg);
            transform: rotate(-18deg);
  }
  12%, 28% {
    -webkit-transform: rotate(18deg);
            transform: rotate(18deg);
  }
  16% {
    -webkit-transform: rotate(-22deg);
            transform: rotate(-22deg);
  }
  20% {
    -webkit-transform: rotate(22deg);
            transform: rotate(22deg);
  }
  32% {
    -webkit-transform: rotate(-12deg);
            transform: rotate(-12deg);
  }
  36% {
    -webkit-transform: rotate(12deg);
            transform: rotate(12deg);
  }
  40%, 100% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
}
@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  -webkit-transform: rotate(90deg);
          transform: rotate(90deg);
}

.fa-rotate-180 {
  -webkit-transform: rotate(180deg);
          transform: rotate(180deg);
}

.fa-rotate-270 {
  -webkit-transform: rotate(270deg);
          transform: rotate(270deg);
}

.fa-flip-horizontal {
  -webkit-transform: scale(-1, 1);
          transform: scale(-1, 1);
}

.fa-flip-vertical {
  -webkit-transform: scale(1, -1);
          transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  -webkit-transform: scale(-1, -1);
          transform: scale(-1, -1);
}

.fa-rotate-by {
  -webkit-transform: rotate(var(--fa-rotate-angle, none));
          transform: rotate(var(--fa-rotate-angle, none));
}

.fa-stack {
  display: inline-block;
  vertical-align: middle;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
  z-index: var(--fa-stack-z-index, auto);
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.sr-only,
.fa-sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.sr-only-focusable:not(:focus),
.fa-sr-only-focusable:not(:focus) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse,
.fa-duotone.fa-inverse {
  color: var(--fa-inverse, #fff);
}`;function css(){var $=DEFAULT_CSS_PREFIX,b=DEFAULT_REPLACEMENT_CLASS,g=config.cssPrefix,tt=config.replacementClass,ot=baseStyles;if(g!==$||tt!==b){var ut=new RegExp("\\.".concat($,"\\-"),"g"),gt=new RegExp("\\--".concat($,"\\-"),"g"),xt=new RegExp("\\.".concat(b),"g");ot=ot.replace(ut,".".concat(g,"-")).replace(gt,"--".concat(g,"-")).replace(xt,".".concat(tt))}return ot}var _cssInserted=!1;function ensureCss(){config.autoAddCss&&!_cssInserted&&(insertCss(css()),_cssInserted=!0)}var InjectCSS={mixout:function(){return{dom:{css,insertCss:ensureCss}}},hooks:function(){return{beforeDOMElementCreation:function(){ensureCss()},beforeI2svg:function(){ensureCss()}}}},w=WINDOW||{};w[NAMESPACE_IDENTIFIER]||(w[NAMESPACE_IDENTIFIER]={});w[NAMESPACE_IDENTIFIER].styles||(w[NAMESPACE_IDENTIFIER].styles={});w[NAMESPACE_IDENTIFIER].hooks||(w[NAMESPACE_IDENTIFIER].hooks={});w[NAMESPACE_IDENTIFIER].shims||(w[NAMESPACE_IDENTIFIER].shims=[]);var namespace=w[NAMESPACE_IDENTIFIER],functions=[],listener=function $(){DOCUMENT.removeEventListener("DOMContentLoaded",$),loaded=1,functions.map(function(b){return b()})},loaded=!1;IS_DOM&&(loaded=(DOCUMENT.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(DOCUMENT.readyState),loaded||DOCUMENT.addEventListener("DOMContentLoaded",listener));function domready($){IS_DOM&&(loaded?setTimeout($,0):functions.push($))}function toHtml($){var b=$.tag,g=$.attributes,tt=g===void 0?{}:g,ot=$.children,ut=ot===void 0?[]:ot;return typeof $=="string"?htmlEscape($):"<".concat(b," ").concat(joinAttributes(tt),">").concat(ut.map(toHtml).join(""),"</").concat(b,">")}function iconFromMapping($,b,g){if($&&$[b]&&$[b][g])return{prefix:b,iconName:g,icon:$[b][g]}}var bindInternal4=function(b,g){return function(tt,ot,ut,gt){return b.call(g,tt,ot,ut,gt)}},reduce=function(b,g,tt,ot){var ut=Object.keys(b),gt=ut.length,xt=ot!==void 0?bindInternal4(g,ot):g,It,kt,Ft;for(tt===void 0?(It=1,Ft=b[ut[0]]):(It=0,Ft=tt);It<gt;It++)kt=ut[It],Ft=xt(Ft,b[kt],kt,b);return Ft};function ucs2decode($){for(var b=[],g=0,tt=$.length;g<tt;){var ot=$.charCodeAt(g++);if(ot>=55296&&ot<=56319&&g<tt){var ut=$.charCodeAt(g++);(ut&64512)==56320?b.push(((ot&1023)<<10)+(ut&1023)+65536):(b.push(ot),g--)}else b.push(ot)}return b}function toHex($){var b=ucs2decode($);return b.length===1?b[0].toString(16):null}function codePointAt($,b){var g=$.length,tt=$.charCodeAt(b),ot;return tt>=55296&&tt<=56319&&g>b+1&&(ot=$.charCodeAt(b+1),ot>=56320&&ot<=57343)?(tt-55296)*1024+ot-56320+65536:tt}function normalizeIcons($){return Object.keys($).reduce(function(b,g){var tt=$[g],ot=!!tt.icon;return ot?b[tt.iconName]=tt.icon:b[g]=tt,b},{})}function defineIcons($,b){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},tt=g.skipHooks,ot=tt===void 0?!1:tt,ut=normalizeIcons(b);typeof namespace.hooks.addPack=="function"&&!ot?namespace.hooks.addPack($,normalizeIcons(b)):namespace.styles[$]=_objectSpread2$1(_objectSpread2$1({},namespace.styles[$]||{}),ut),$==="fas"&&defineIcons("fa",b)}var _LONG_STYLE,_PREFIXES,_PREFIXES_FOR_FAMILY,styles=namespace.styles,shims=namespace.shims,LONG_STYLE=(_LONG_STYLE={},_defineProperty$1(_LONG_STYLE,FAMILY_CLASSIC,Object.values(PREFIX_TO_LONG_STYLE[FAMILY_CLASSIC])),_defineProperty$1(_LONG_STYLE,FAMILY_SHARP,Object.values(PREFIX_TO_LONG_STYLE[FAMILY_SHARP])),_LONG_STYLE),_defaultUsablePrefix=null,_byUnicode={},_byLigature={},_byOldName={},_byOldUnicode={},_byAlias={},PREFIXES=(_PREFIXES={},_defineProperty$1(_PREFIXES,FAMILY_CLASSIC,Object.keys(PREFIX_TO_STYLE[FAMILY_CLASSIC])),_defineProperty$1(_PREFIXES,FAMILY_SHARP,Object.keys(PREFIX_TO_STYLE[FAMILY_SHARP])),_PREFIXES);function isReserved($){return~RESERVED_CLASSES.indexOf($)}function getIconName($,b){var g=b.split("-"),tt=g[0],ot=g.slice(1).join("-");return tt===$&&ot!==""&&!isReserved(ot)?ot:null}var build=function(){var b=function(ut){return reduce(styles,function(gt,xt,It){return gt[It]=reduce(xt,ut,{}),gt},{})};_byUnicode=b(function(ot,ut,gt){if(ut[3]&&(ot[ut[3]]=gt),ut[2]){var xt=ut[2].filter(function(It){return typeof It=="number"});xt.forEach(function(It){ot[It.toString(16)]=gt})}return ot}),_byLigature=b(function(ot,ut,gt){if(ot[gt]=gt,ut[2]){var xt=ut[2].filter(function(It){return typeof It=="string"});xt.forEach(function(It){ot[It]=gt})}return ot}),_byAlias=b(function(ot,ut,gt){var xt=ut[2];return ot[gt]=gt,xt.forEach(function(It){ot[It]=gt}),ot});var g="far"in styles||config.autoFetchSvg,tt=reduce(shims,function(ot,ut){var gt=ut[0],xt=ut[1],It=ut[2];return xt==="far"&&!g&&(xt="fas"),typeof gt=="string"&&(ot.names[gt]={prefix:xt,iconName:It}),typeof gt=="number"&&(ot.unicodes[gt.toString(16)]={prefix:xt,iconName:It}),ot},{names:{},unicodes:{}});_byOldName=tt.names,_byOldUnicode=tt.unicodes,_defaultUsablePrefix=getCanonicalPrefix(config.styleDefault,{family:config.familyDefault})};onChange(function($){_defaultUsablePrefix=getCanonicalPrefix($.styleDefault,{family:config.familyDefault})});build();function byUnicode($,b){return(_byUnicode[$]||{})[b]}function byLigature($,b){return(_byLigature[$]||{})[b]}function byAlias($,b){return(_byAlias[$]||{})[b]}function byOldName($){return _byOldName[$]||{prefix:null,iconName:null}}function byOldUnicode($){var b=_byOldUnicode[$],g=byUnicode("fas",$);return b||(g?{prefix:"fas",iconName:g}:null)||{prefix:null,iconName:null}}function getDefaultUsablePrefix(){return _defaultUsablePrefix}var emptyCanonicalIcon=function(){return{prefix:null,iconName:null,rest:[]}};function getCanonicalPrefix($){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=b.family,tt=g===void 0?FAMILY_CLASSIC:g,ot=PREFIX_TO_STYLE[tt][$],ut=STYLE_TO_PREFIX[tt][$]||STYLE_TO_PREFIX[tt][ot],gt=$ in namespace.styles?$:null;return ut||gt||null}var PREFIXES_FOR_FAMILY=(_PREFIXES_FOR_FAMILY={},_defineProperty$1(_PREFIXES_FOR_FAMILY,FAMILY_CLASSIC,Object.keys(PREFIX_TO_LONG_STYLE[FAMILY_CLASSIC])),_defineProperty$1(_PREFIXES_FOR_FAMILY,FAMILY_SHARP,Object.keys(PREFIX_TO_LONG_STYLE[FAMILY_SHARP])),_PREFIXES_FOR_FAMILY);function getCanonicalIcon($){var b,g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},tt=g.skipLookups,ot=tt===void 0?!1:tt,ut=(b={},_defineProperty$1(b,FAMILY_CLASSIC,"".concat(config.cssPrefix,"-").concat(FAMILY_CLASSIC)),_defineProperty$1(b,FAMILY_SHARP,"".concat(config.cssPrefix,"-").concat(FAMILY_SHARP)),b),gt=null,xt=FAMILY_CLASSIC;($.includes(ut[FAMILY_CLASSIC])||$.some(function(kt){return PREFIXES_FOR_FAMILY[FAMILY_CLASSIC].includes(kt)}))&&(xt=FAMILY_CLASSIC),($.includes(ut[FAMILY_SHARP])||$.some(function(kt){return PREFIXES_FOR_FAMILY[FAMILY_SHARP].includes(kt)}))&&(xt=FAMILY_SHARP);var It=$.reduce(function(kt,Ft){var Xt=getIconName(config.cssPrefix,Ft);if(styles[Ft]?(Ft=LONG_STYLE[xt].includes(Ft)?LONG_STYLE_TO_PREFIX[xt][Ft]:Ft,gt=Ft,kt.prefix=Ft):PREFIXES[xt].indexOf(Ft)>-1?(gt=Ft,kt.prefix=getCanonicalPrefix(Ft,{family:xt})):Xt?kt.iconName=Xt:Ft!==config.replacementClass&&Ft!==ut[FAMILY_CLASSIC]&&Ft!==ut[FAMILY_SHARP]&&kt.rest.push(Ft),!ot&&kt.prefix&&kt.iconName){var qt=gt==="fa"?byOldName(kt.iconName):{},jt=byAlias(kt.prefix,kt.iconName);qt.prefix&&(gt=null),kt.iconName=qt.iconName||jt||kt.iconName,kt.prefix=qt.prefix||kt.prefix,kt.prefix==="far"&&!styles.far&&styles.fas&&!config.autoFetchSvg&&(kt.prefix="fas")}return kt},emptyCanonicalIcon());return($.includes("fa-brands")||$.includes("fab"))&&(It.prefix="fab"),($.includes("fa-duotone")||$.includes("fad"))&&(It.prefix="fad"),!It.prefix&&xt===FAMILY_SHARP&&(styles.fass||config.autoFetchSvg)&&(It.prefix="fass",It.iconName=byAlias(It.prefix,It.iconName)||It.iconName),(It.prefix==="fa"||gt==="fa")&&(It.prefix=getDefaultUsablePrefix()||"fas"),It}var Library=function(){function $(){_classCallCheck(this,$),this.definitions={}}return _createClass$1($,[{key:"add",value:function(){for(var g=this,tt=arguments.length,ot=new Array(tt),ut=0;ut<tt;ut++)ot[ut]=arguments[ut];var gt=ot.reduce(this._pullDefinitions,{});Object.keys(gt).forEach(function(xt){g.definitions[xt]=_objectSpread2$1(_objectSpread2$1({},g.definitions[xt]||{}),gt[xt]),defineIcons(xt,gt[xt]);var It=PREFIX_TO_LONG_STYLE[FAMILY_CLASSIC][xt];It&&defineIcons(It,gt[xt]),build()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(g,tt){var ot=tt.prefix&&tt.iconName&&tt.icon?{0:tt}:tt;return Object.keys(ot).map(function(ut){var gt=ot[ut],xt=gt.prefix,It=gt.iconName,kt=gt.icon,Ft=kt[2];g[xt]||(g[xt]={}),Ft.length>0&&Ft.forEach(function(Xt){typeof Xt=="string"&&(g[xt][Xt]=kt)}),g[xt][It]=kt}),g}}]),$}(),_plugins$1=[],_hooks={},providers={},defaultProviderKeys=Object.keys(providers);function registerPlugins($,b){var g=b.mixoutsTo;return _plugins$1=$,_hooks={},Object.keys(providers).forEach(function(tt){defaultProviderKeys.indexOf(tt)===-1&&delete providers[tt]}),_plugins$1.forEach(function(tt){var ot=tt.mixout?tt.mixout():{};if(Object.keys(ot).forEach(function(gt){typeof ot[gt]=="function"&&(g[gt]=ot[gt]),_typeof$1(ot[gt])==="object"&&Object.keys(ot[gt]).forEach(function(xt){g[gt]||(g[gt]={}),g[gt][xt]=ot[gt][xt]})}),tt.hooks){var ut=tt.hooks();Object.keys(ut).forEach(function(gt){_hooks[gt]||(_hooks[gt]=[]),_hooks[gt].push(ut[gt])})}tt.provides&&tt.provides(providers)}),g}function chainHooks($,b){for(var g=arguments.length,tt=new Array(g>2?g-2:0),ot=2;ot<g;ot++)tt[ot-2]=arguments[ot];var ut=_hooks[$]||[];return ut.forEach(function(gt){b=gt.apply(null,[b].concat(tt))}),b}function callHooks($){for(var b=arguments.length,g=new Array(b>1?b-1:0),tt=1;tt<b;tt++)g[tt-1]=arguments[tt];var ot=_hooks[$]||[];ot.forEach(function(ut){ut.apply(null,g)})}function callProvided(){var $=arguments[0],b=Array.prototype.slice.call(arguments,1);return providers[$]?providers[$].apply(null,b):void 0}function findIconDefinition($){$.prefix==="fa"&&($.prefix="fas");var b=$.iconName,g=$.prefix||getDefaultUsablePrefix();if(b)return b=byAlias(g,b)||b,iconFromMapping(library.definitions,g,b)||iconFromMapping(namespace.styles,g,b)}var library=new Library,noAuto=function(){config.autoReplaceSvg=!1,config.observeMutations=!1,callHooks("noAuto")},dom={i2svg:function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return IS_DOM?(callHooks("beforeI2svg",b),callProvided("pseudoElements2svg",b),callProvided("i2svg",b)):Promise.reject("Operation requires a DOM of some kind.")},watch:function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=b.autoReplaceSvgRoot;config.autoReplaceSvg===!1&&(config.autoReplaceSvg=!0),config.observeMutations=!0,domready(function(){autoReplace({autoReplaceSvgRoot:g}),callHooks("watch",b)})}},parse={icon:function(b){if(b===null)return null;if(_typeof$1(b)==="object"&&b.prefix&&b.iconName)return{prefix:b.prefix,iconName:byAlias(b.prefix,b.iconName)||b.iconName};if(Array.isArray(b)&&b.length===2){var g=b[1].indexOf("fa-")===0?b[1].slice(3):b[1],tt=getCanonicalPrefix(b[0]);return{prefix:tt,iconName:byAlias(tt,g)||g}}if(typeof b=="string"&&(b.indexOf("".concat(config.cssPrefix,"-"))>-1||b.match(ICON_SELECTION_SYNTAX_PATTERN))){var ot=getCanonicalIcon(b.split(" "),{skipLookups:!0});return{prefix:ot.prefix||getDefaultUsablePrefix(),iconName:byAlias(ot.prefix,ot.iconName)||ot.iconName}}if(typeof b=="string"){var ut=getDefaultUsablePrefix();return{prefix:ut,iconName:byAlias(ut,b)||b}}}},api={noAuto,config,dom,parse,library,findIconDefinition,toHtml},autoReplace=function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=b.autoReplaceSvgRoot,tt=g===void 0?DOCUMENT:g;(Object.keys(namespace.styles).length>0||config.autoFetchSvg)&&IS_DOM&&config.autoReplaceSvg&&api.dom.i2svg({node:tt})};function domVariants($,b){return Object.defineProperty($,"abstract",{get:b}),Object.defineProperty($,"html",{get:function(){return $.abstract.map(function(tt){return toHtml(tt)})}}),Object.defineProperty($,"node",{get:function(){if(IS_DOM){var tt=DOCUMENT.createElement("div");return tt.innerHTML=$.html,tt.children}}}),$}function asIcon($){var b=$.children,g=$.main,tt=$.mask,ot=$.attributes,ut=$.styles,gt=$.transform;if(transformIsMeaningful(gt)&&g.found&&!tt.found){var xt=g.width,It=g.height,kt={x:xt/It/2,y:.5};ot.style=joinStyles(_objectSpread2$1(_objectSpread2$1({},ut),{},{"transform-origin":"".concat(kt.x+gt.x/16,"em ").concat(kt.y+gt.y/16,"em")}))}return[{tag:"svg",attributes:ot,children:b}]}function asSymbol($){var b=$.prefix,g=$.iconName,tt=$.children,ot=$.attributes,ut=$.symbol,gt=ut===!0?"".concat(b,"-").concat(config.cssPrefix,"-").concat(g):ut;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:_objectSpread2$1(_objectSpread2$1({},ot),{},{id:gt}),children:tt}]}]}function makeInlineSvgAbstract($){var b=$.icons,g=b.main,tt=b.mask,ot=$.prefix,ut=$.iconName,gt=$.transform,xt=$.symbol,It=$.title,kt=$.maskId,Ft=$.titleId,Xt=$.extra,qt=$.watchable,jt=qt===void 0?!1:qt,sn=tt.found?tt:g,Gt=sn.width,vn=sn.height,nn=ot==="fak",Wt=[config.replacementClass,ut?"".concat(config.cssPrefix,"-").concat(ut):""].filter(function(tn){return Xt.classes.indexOf(tn)===-1}).filter(function(tn){return tn!==""||!!tn}).concat(Xt.classes).join(" "),on={children:[],attributes:_objectSpread2$1(_objectSpread2$1({},Xt.attributes),{},{"data-prefix":ot,"data-icon":ut,class:Wt,role:Xt.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(Gt," ").concat(vn)})},gn=nn&&!~Xt.classes.indexOf("fa-fw")?{width:"".concat(Gt/vn*16*.0625,"em")}:{};jt&&(on.attributes[DATA_FA_I2SVG]=""),It&&(on.children.push({tag:"title",attributes:{id:on.attributes["aria-labelledby"]||"title-".concat(Ft||nextUniqueId())},children:[It]}),delete on.attributes.title);var ln=_objectSpread2$1(_objectSpread2$1({},on),{},{prefix:ot,iconName:ut,main:g,mask:tt,maskId:kt,transform:gt,symbol:xt,styles:_objectSpread2$1(_objectSpread2$1({},gn),Xt.styles)}),_n=tt.found&&g.found?callProvided("generateAbstractMask",ln)||{children:[],attributes:{}}:callProvided("generateAbstractIcon",ln)||{children:[],attributes:{}},Ut=_n.children,Qt=_n.attributes;return ln.children=Ut,ln.attributes=Qt,xt?asSymbol(ln):asIcon(ln)}function makeLayersTextAbstract($){var b=$.content,g=$.width,tt=$.height,ot=$.transform,ut=$.title,gt=$.extra,xt=$.watchable,It=xt===void 0?!1:xt,kt=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},gt.attributes),ut?{title:ut}:{}),{},{class:gt.classes.join(" ")});It&&(kt[DATA_FA_I2SVG]="");var Ft=_objectSpread2$1({},gt.styles);transformIsMeaningful(ot)&&(Ft.transform=transformForCss({transform:ot,startCentered:!0,width:g,height:tt}),Ft["-webkit-transform"]=Ft.transform);var Xt=joinStyles(Ft);Xt.length>0&&(kt.style=Xt);var qt=[];return qt.push({tag:"span",attributes:kt,children:[b]}),ut&&qt.push({tag:"span",attributes:{class:"sr-only"},children:[ut]}),qt}function makeLayersCounterAbstract($){var b=$.content,g=$.title,tt=$.extra,ot=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},tt.attributes),g?{title:g}:{}),{},{class:tt.classes.join(" ")}),ut=joinStyles(tt.styles);ut.length>0&&(ot.style=ut);var gt=[];return gt.push({tag:"span",attributes:ot,children:[b]}),g&&gt.push({tag:"span",attributes:{class:"sr-only"},children:[g]}),gt}var styles$1=namespace.styles;function asFoundIcon($){var b=$[0],g=$[1],tt=$.slice(4),ot=_slicedToArray(tt,1),ut=ot[0],gt=null;return Array.isArray(ut)?gt={tag:"g",attributes:{class:"".concat(config.cssPrefix,"-").concat(DUOTONE_CLASSES.GROUP)},children:[{tag:"path",attributes:{class:"".concat(config.cssPrefix,"-").concat(DUOTONE_CLASSES.SECONDARY),fill:"currentColor",d:ut[0]}},{tag:"path",attributes:{class:"".concat(config.cssPrefix,"-").concat(DUOTONE_CLASSES.PRIMARY),fill:"currentColor",d:ut[1]}}]}:gt={tag:"path",attributes:{fill:"currentColor",d:ut}},{found:!0,width:b,height:g,icon:gt}}var missingIconResolutionMixin={found:!1,width:512,height:512};function maybeNotifyMissing($,b){!PRODUCTION$1&&!config.showMissingIcons&&$&&console.error('Icon with name "'.concat($,'" and prefix "').concat(b,'" is missing.'))}function findIcon($,b){var g=b;return b==="fa"&&config.styleDefault!==null&&(b=getDefaultUsablePrefix()),new Promise(function(tt,ot){if(callProvided("missingIconAbstract"),g==="fa"){var ut=byOldName($)||{};$=ut.iconName||$,b=ut.prefix||b}if($&&b&&styles$1[b]&&styles$1[b][$]){var gt=styles$1[b][$];return tt(asFoundIcon(gt))}maybeNotifyMissing($,b),tt(_objectSpread2$1(_objectSpread2$1({},missingIconResolutionMixin),{},{icon:config.showMissingIcons&&$?callProvided("missingIconAbstract")||{}:{}}))})}var noop$1=function(){},p=config.measurePerformance&&PERFORMANCE&&PERFORMANCE.mark&&PERFORMANCE.measure?PERFORMANCE:{mark:noop$1,measure:noop$1},preamble='FA "6.5.1"',begin=function(b){return p.mark("".concat(preamble," ").concat(b," begins")),function(){return end(b)}},end=function(b){p.mark("".concat(preamble," ").concat(b," ends")),p.measure("".concat(preamble," ").concat(b),"".concat(preamble," ").concat(b," begins"),"".concat(preamble," ").concat(b," ends"))},perf={begin,end},noop$2=function(){};function isWatched($){var b=$.getAttribute?$.getAttribute(DATA_FA_I2SVG):null;return typeof b=="string"}function hasPrefixAndIcon($){var b=$.getAttribute?$.getAttribute(DATA_PREFIX):null,g=$.getAttribute?$.getAttribute(DATA_ICON):null;return b&&g}function hasBeenReplaced($){return $&&$.classList&&$.classList.contains&&$.classList.contains(config.replacementClass)}function getMutator(){if(config.autoReplaceSvg===!0)return mutators.replace;var $=mutators[config.autoReplaceSvg];return $||mutators.replace}function createElementNS($){return DOCUMENT.createElementNS("http://www.w3.org/2000/svg",$)}function createElement($){return DOCUMENT.createElement($)}function convertSVG($){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=b.ceFn,tt=g===void 0?$.tag==="svg"?createElementNS:createElement:g;if(typeof $=="string")return DOCUMENT.createTextNode($);var ot=tt($.tag);Object.keys($.attributes||[]).forEach(function(gt){ot.setAttribute(gt,$.attributes[gt])});var ut=$.children||[];return ut.forEach(function(gt){ot.appendChild(convertSVG(gt,{ceFn:tt}))}),ot}function nodeAsComment($){var b=" ".concat($.outerHTML," ");return b="".concat(b,"Font Awesome fontawesome.com "),b}var mutators={replace:function(b){var g=b[0];if(g.parentNode)if(b[1].forEach(function(ot){g.parentNode.insertBefore(convertSVG(ot),g)}),g.getAttribute(DATA_FA_I2SVG)===null&&config.keepOriginalSource){var tt=DOCUMENT.createComment(nodeAsComment(g));g.parentNode.replaceChild(tt,g)}else g.remove()},nest:function(b){var g=b[0],tt=b[1];if(~classArray(g).indexOf(config.replacementClass))return mutators.replace(b);var ot=new RegExp("".concat(config.cssPrefix,"-.*"));if(delete tt[0].attributes.id,tt[0].attributes.class){var ut=tt[0].attributes.class.split(" ").reduce(function(xt,It){return It===config.replacementClass||It.match(ot)?xt.toSvg.push(It):xt.toNode.push(It),xt},{toNode:[],toSvg:[]});tt[0].attributes.class=ut.toSvg.join(" "),ut.toNode.length===0?g.removeAttribute("class"):g.setAttribute("class",ut.toNode.join(" "))}var gt=tt.map(function(xt){return toHtml(xt)}).join(`
`);g.setAttribute(DATA_FA_I2SVG,""),g.innerHTML=gt}};function performOperationSync($){$()}function perform($,b){var g=typeof b=="function"?b:noop$2;if($.length===0)g();else{var tt=performOperationSync;config.mutateApproach===MUTATION_APPROACH_ASYNC&&(tt=WINDOW.requestAnimationFrame||performOperationSync),tt(function(){var ot=getMutator(),ut=perf.begin("mutate");$.map(ot),ut(),g()})}}var disabled=!1;function disableObservation(){disabled=!0}function enableObservation(){disabled=!1}var mo=null;function observe($){if(MUTATION_OBSERVER&&config.observeMutations){var b=$.treeCallback,g=b===void 0?noop$2:b,tt=$.nodeCallback,ot=tt===void 0?noop$2:tt,ut=$.pseudoElementsCallback,gt=ut===void 0?noop$2:ut,xt=$.observeMutationsRoot,It=xt===void 0?DOCUMENT:xt;mo=new MUTATION_OBSERVER(function(kt){if(!disabled){var Ft=getDefaultUsablePrefix();toArray$1(kt).forEach(function(Xt){if(Xt.type==="childList"&&Xt.addedNodes.length>0&&!isWatched(Xt.addedNodes[0])&&(config.searchPseudoElements&&gt(Xt.target),g(Xt.target)),Xt.type==="attributes"&&Xt.target.parentNode&&config.searchPseudoElements&&gt(Xt.target.parentNode),Xt.type==="attributes"&&isWatched(Xt.target)&&~ATTRIBUTES_WATCHED_FOR_MUTATION.indexOf(Xt.attributeName))if(Xt.attributeName==="class"&&hasPrefixAndIcon(Xt.target)){var qt=getCanonicalIcon(classArray(Xt.target)),jt=qt.prefix,sn=qt.iconName;Xt.target.setAttribute(DATA_PREFIX,jt||Ft),sn&&Xt.target.setAttribute(DATA_ICON,sn)}else hasBeenReplaced(Xt.target)&&ot(Xt.target)})}}),IS_DOM&&mo.observe(It,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}}function disconnect(){mo&&mo.disconnect()}function styleParser($){var b=$.getAttribute("style"),g=[];return b&&(g=b.split(";").reduce(function(tt,ot){var ut=ot.split(":"),gt=ut[0],xt=ut.slice(1);return gt&&xt.length>0&&(tt[gt]=xt.join(":").trim()),tt},{})),g}function classParser($){var b=$.getAttribute("data-prefix"),g=$.getAttribute("data-icon"),tt=$.innerText!==void 0?$.innerText.trim():"",ot=getCanonicalIcon(classArray($));return ot.prefix||(ot.prefix=getDefaultUsablePrefix()),b&&g&&(ot.prefix=b,ot.iconName=g),ot.iconName&&ot.prefix||(ot.prefix&&tt.length>0&&(ot.iconName=byLigature(ot.prefix,$.innerText)||byUnicode(ot.prefix,toHex($.innerText))),!ot.iconName&&config.autoFetchSvg&&$.firstChild&&$.firstChild.nodeType===Node.TEXT_NODE&&(ot.iconName=$.firstChild.data)),ot}function attributesParser($){var b=toArray$1($.attributes).reduce(function(ot,ut){return ot.name!=="class"&&ot.name!=="style"&&(ot[ut.name]=ut.value),ot},{}),g=$.getAttribute("title"),tt=$.getAttribute("data-fa-title-id");return config.autoA11y&&(g?b["aria-labelledby"]="".concat(config.replacementClass,"-title-").concat(tt||nextUniqueId()):(b["aria-hidden"]="true",b.focusable="false")),b}function blankMeta(){return{iconName:null,title:null,titleId:null,prefix:null,transform:meaninglessTransform,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function parseMeta($){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0},g=classParser($),tt=g.iconName,ot=g.prefix,ut=g.rest,gt=attributesParser($),xt=chainHooks("parseNodeAttributes",{},$),It=b.styleParser?styleParser($):[];return _objectSpread2$1({iconName:tt,title:$.getAttribute("title"),titleId:$.getAttribute("data-fa-title-id"),prefix:ot,transform:meaninglessTransform,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:ut,styles:It,attributes:gt}},xt)}var styles$2=namespace.styles;function generateMutation($){var b=config.autoReplaceSvg==="nest"?parseMeta($,{styleParser:!1}):parseMeta($);return~b.extra.classes.indexOf(LAYERS_TEXT_CLASSNAME)?callProvided("generateLayersText",$,b):callProvided("generateSvgReplacementMutation",$,b)}var knownPrefixes=new Set;FAMILIES.map(function($){knownPrefixes.add("fa-".concat($))});Object.keys(PREFIX_TO_STYLE[FAMILY_CLASSIC]).map(knownPrefixes.add.bind(knownPrefixes));Object.keys(PREFIX_TO_STYLE[FAMILY_SHARP]).map(knownPrefixes.add.bind(knownPrefixes));knownPrefixes=_toConsumableArray$1(knownPrefixes);function onTree($){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!IS_DOM)return Promise.resolve();var g=DOCUMENT.documentElement.classList,tt=function(Xt){return g.add("".concat(HTML_CLASS_I2SVG_BASE_CLASS,"-").concat(Xt))},ot=function(Xt){return g.remove("".concat(HTML_CLASS_I2SVG_BASE_CLASS,"-").concat(Xt))},ut=config.autoFetchSvg?knownPrefixes:FAMILIES.map(function(Ft){return"fa-".concat(Ft)}).concat(Object.keys(styles$2));ut.includes("fa")||ut.push("fa");var gt=[".".concat(LAYERS_TEXT_CLASSNAME,":not([").concat(DATA_FA_I2SVG,"])")].concat(ut.map(function(Ft){return".".concat(Ft,":not([").concat(DATA_FA_I2SVG,"])")})).join(", ");if(gt.length===0)return Promise.resolve();var xt=[];try{xt=toArray$1($.querySelectorAll(gt))}catch{}if(xt.length>0)tt("pending"),ot("complete");else return Promise.resolve();var It=perf.begin("onTree"),kt=xt.reduce(function(Ft,Xt){try{var qt=generateMutation(Xt);qt&&Ft.push(qt)}catch(jt){PRODUCTION$1||jt.name==="MissingIcon"&&console.error(jt)}return Ft},[]);return new Promise(function(Ft,Xt){Promise.all(kt).then(function(qt){perform(qt,function(){tt("active"),tt("complete"),ot("pending"),typeof b=="function"&&b(),It(),Ft()})}).catch(function(qt){It(),Xt(qt)})})}function onNode($){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;generateMutation($).then(function(g){g&&perform([g],b)})}function resolveIcons($){return function(b){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},tt=(b||{}).icon?b:findIconDefinition(b||{}),ot=g.mask;return ot&&(ot=(ot||{}).icon?ot:findIconDefinition(ot||{})),$(tt,_objectSpread2$1(_objectSpread2$1({},g),{},{mask:ot}))}}var render=function(b){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},tt=g.transform,ot=tt===void 0?meaninglessTransform:tt,ut=g.symbol,gt=ut===void 0?!1:ut,xt=g.mask,It=xt===void 0?null:xt,kt=g.maskId,Ft=kt===void 0?null:kt,Xt=g.title,qt=Xt===void 0?null:Xt,jt=g.titleId,sn=jt===void 0?null:jt,Gt=g.classes,vn=Gt===void 0?[]:Gt,nn=g.attributes,Wt=nn===void 0?{}:nn,on=g.styles,gn=on===void 0?{}:on;if(b){var ln=b.prefix,_n=b.iconName,Ut=b.icon;return domVariants(_objectSpread2$1({type:"icon"},b),function(){return callHooks("beforeDOMElementCreation",{iconDefinition:b,params:g}),config.autoA11y&&(qt?Wt["aria-labelledby"]="".concat(config.replacementClass,"-title-").concat(sn||nextUniqueId()):(Wt["aria-hidden"]="true",Wt.focusable="false")),makeInlineSvgAbstract({icons:{main:asFoundIcon(Ut),mask:It?asFoundIcon(It.icon):{found:!1,width:null,height:null,icon:{}}},prefix:ln,iconName:_n,transform:_objectSpread2$1(_objectSpread2$1({},meaninglessTransform),ot),symbol:gt,title:qt,maskId:Ft,titleId:sn,extra:{attributes:Wt,styles:gn,classes:vn}})})}},ReplaceElements={mixout:function(){return{icon:resolveIcons(render)}},hooks:function(){return{mutationObserverCallbacks:function(g){return g.treeCallback=onTree,g.nodeCallback=onNode,g}}},provides:function(b){b.i2svg=function(g){var tt=g.node,ot=tt===void 0?DOCUMENT:tt,ut=g.callback,gt=ut===void 0?function(){}:ut;return onTree(ot,gt)},b.generateSvgReplacementMutation=function(g,tt){var ot=tt.iconName,ut=tt.title,gt=tt.titleId,xt=tt.prefix,It=tt.transform,kt=tt.symbol,Ft=tt.mask,Xt=tt.maskId,qt=tt.extra;return new Promise(function(jt,sn){Promise.all([findIcon(ot,xt),Ft.iconName?findIcon(Ft.iconName,Ft.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(function(Gt){var vn=_slicedToArray(Gt,2),nn=vn[0],Wt=vn[1];jt([g,makeInlineSvgAbstract({icons:{main:nn,mask:Wt},prefix:xt,iconName:ot,transform:It,symbol:kt,maskId:Xt,title:ut,titleId:gt,extra:qt,watchable:!0})])}).catch(sn)})},b.generateAbstractIcon=function(g){var tt=g.children,ot=g.attributes,ut=g.main,gt=g.transform,xt=g.styles,It=joinStyles(xt);It.length>0&&(ot.style=It);var kt;return transformIsMeaningful(gt)&&(kt=callProvided("generateAbstractTransformGrouping",{main:ut,transform:gt,containerWidth:ut.width,iconWidth:ut.width})),tt.push(kt||ut.icon),{children:tt,attributes:ot}}}},Layers={mixout:function(){return{layer:function(g){var tt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ot=tt.classes,ut=ot===void 0?[]:ot;return domVariants({type:"layer"},function(){callHooks("beforeDOMElementCreation",{assembler:g,params:tt});var gt=[];return g(function(xt){Array.isArray(xt)?xt.map(function(It){gt=gt.concat(It.abstract)}):gt=gt.concat(xt.abstract)}),[{tag:"span",attributes:{class:["".concat(config.cssPrefix,"-layers")].concat(_toConsumableArray$1(ut)).join(" ")},children:gt}]})}}}},LayersCounter={mixout:function(){return{counter:function(g){var tt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ot=tt.title,ut=ot===void 0?null:ot,gt=tt.classes,xt=gt===void 0?[]:gt,It=tt.attributes,kt=It===void 0?{}:It,Ft=tt.styles,Xt=Ft===void 0?{}:Ft;return domVariants({type:"counter",content:g},function(){return callHooks("beforeDOMElementCreation",{content:g,params:tt}),makeLayersCounterAbstract({content:g.toString(),title:ut,extra:{attributes:kt,styles:Xt,classes:["".concat(config.cssPrefix,"-layers-counter")].concat(_toConsumableArray$1(xt))}})})}}}},LayersText={mixout:function(){return{text:function(g){var tt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ot=tt.transform,ut=ot===void 0?meaninglessTransform:ot,gt=tt.title,xt=gt===void 0?null:gt,It=tt.classes,kt=It===void 0?[]:It,Ft=tt.attributes,Xt=Ft===void 0?{}:Ft,qt=tt.styles,jt=qt===void 0?{}:qt;return domVariants({type:"text",content:g},function(){return callHooks("beforeDOMElementCreation",{content:g,params:tt}),makeLayersTextAbstract({content:g,transform:_objectSpread2$1(_objectSpread2$1({},meaninglessTransform),ut),title:xt,extra:{attributes:Xt,styles:jt,classes:["".concat(config.cssPrefix,"-layers-text")].concat(_toConsumableArray$1(kt))}})})}}},provides:function(b){b.generateLayersText=function(g,tt){var ot=tt.title,ut=tt.transform,gt=tt.extra,xt=null,It=null;if(IS_IE){var kt=parseInt(getComputedStyle(g).fontSize,10),Ft=g.getBoundingClientRect();xt=Ft.width/kt,It=Ft.height/kt}return config.autoA11y&&!ot&&(gt.attributes["aria-hidden"]="true"),Promise.resolve([g,makeLayersTextAbstract({content:g.innerHTML,width:xt,height:It,transform:ut,title:ot,extra:gt,watchable:!0})])}}},CLEAN_CONTENT_PATTERN=new RegExp('"',"ug"),SECONDARY_UNICODE_RANGE=[1105920,1112319];function hexValueFromContent($){var b=$.replace(CLEAN_CONTENT_PATTERN,""),g=codePointAt(b,0),tt=g>=SECONDARY_UNICODE_RANGE[0]&&g<=SECONDARY_UNICODE_RANGE[1],ot=b.length===2?b[0]===b[1]:!1;return{value:toHex(ot?b[0]:b),isSecondary:tt||ot}}function replaceForPosition($,b){var g="".concat(DATA_FA_PSEUDO_ELEMENT_PENDING).concat(b.replace(":","-"));return new Promise(function(tt,ot){if($.getAttribute(g)!==null)return tt();var ut=toArray$1($.children),gt=ut.filter(function(Ut){return Ut.getAttribute(DATA_FA_PSEUDO_ELEMENT)===b})[0],xt=WINDOW.getComputedStyle($,b),It=xt.getPropertyValue("font-family").match(FONT_FAMILY_PATTERN),kt=xt.getPropertyValue("font-weight"),Ft=xt.getPropertyValue("content");if(gt&&!It)return $.removeChild(gt),tt();if(It&&Ft!=="none"&&Ft!==""){var Xt=xt.getPropertyValue("content"),qt=~["Sharp"].indexOf(It[2])?FAMILY_SHARP:FAMILY_CLASSIC,jt=~["Solid","Regular","Light","Thin","Duotone","Brands","Kit"].indexOf(It[2])?STYLE_TO_PREFIX[qt][It[2].toLowerCase()]:FONT_WEIGHT_TO_PREFIX[qt][kt],sn=hexValueFromContent(Xt),Gt=sn.value,vn=sn.isSecondary,nn=It[0].startsWith("FontAwesome"),Wt=byUnicode(jt,Gt),on=Wt;if(nn){var gn=byOldUnicode(Gt);gn.iconName&&gn.prefix&&(Wt=gn.iconName,jt=gn.prefix)}if(Wt&&!vn&&(!gt||gt.getAttribute(DATA_PREFIX)!==jt||gt.getAttribute(DATA_ICON)!==on)){$.setAttribute(g,on),gt&&$.removeChild(gt);var ln=blankMeta(),_n=ln.extra;_n.attributes[DATA_FA_PSEUDO_ELEMENT]=b,findIcon(Wt,jt).then(function(Ut){var Qt=makeInlineSvgAbstract(_objectSpread2$1(_objectSpread2$1({},ln),{},{icons:{main:Ut,mask:emptyCanonicalIcon()},prefix:jt,iconName:on,extra:_n,watchable:!0})),tn=DOCUMENT.createElementNS("http://www.w3.org/2000/svg","svg");b==="::before"?$.insertBefore(tn,$.firstChild):$.appendChild(tn),tn.outerHTML=Qt.map(function(bn){return toHtml(bn)}).join(`
`),$.removeAttribute(g),tt()}).catch(ot)}else tt()}else tt()})}function replace2($){return Promise.all([replaceForPosition($,"::before"),replaceForPosition($,"::after")])}function processable($){return $.parentNode!==document.head&&!~TAGNAMES_TO_SKIP_FOR_PSEUDOELEMENTS.indexOf($.tagName.toUpperCase())&&!$.getAttribute(DATA_FA_PSEUDO_ELEMENT)&&(!$.parentNode||$.parentNode.tagName!=="svg")}function searchPseudoElements($){if(IS_DOM)return new Promise(function(b,g){var tt=toArray$1($.querySelectorAll("*")).filter(processable).map(replace2),ot=perf.begin("searchPseudoElements");disableObservation(),Promise.all(tt).then(function(){ot(),enableObservation(),b()}).catch(function(){ot(),enableObservation(),g()})})}var PseudoElements={hooks:function(){return{mutationObserverCallbacks:function(g){return g.pseudoElementsCallback=searchPseudoElements,g}}},provides:function(b){b.pseudoElements2svg=function(g){var tt=g.node,ot=tt===void 0?DOCUMENT:tt;config.searchPseudoElements&&searchPseudoElements(ot)}}},_unwatched=!1,MutationObserver$1={mixout:function(){return{dom:{unwatch:function(){disableObservation(),_unwatched=!0}}}},hooks:function(){return{bootstrap:function(){observe(chainHooks("mutationObserverCallbacks",{}))},noAuto:function(){disconnect()},watch:function(g){var tt=g.observeMutationsRoot;_unwatched?enableObservation():observe(chainHooks("mutationObserverCallbacks",{observeMutationsRoot:tt}))}}}},parseTransformString=function(b){var g={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return b.toLowerCase().split(" ").reduce(function(tt,ot){var ut=ot.toLowerCase().split("-"),gt=ut[0],xt=ut.slice(1).join("-");if(gt&&xt==="h")return tt.flipX=!0,tt;if(gt&&xt==="v")return tt.flipY=!0,tt;if(xt=parseFloat(xt),isNaN(xt))return tt;switch(gt){case"grow":tt.size=tt.size+xt;break;case"shrink":tt.size=tt.size-xt;break;case"left":tt.x=tt.x-xt;break;case"right":tt.x=tt.x+xt;break;case"up":tt.y=tt.y-xt;break;case"down":tt.y=tt.y+xt;break;case"rotate":tt.rotate=tt.rotate+xt;break}return tt},g)},PowerTransforms={mixout:function(){return{parse:{transform:function(g){return parseTransformString(g)}}}},hooks:function(){return{parseNodeAttributes:function(g,tt){var ot=tt.getAttribute("data-fa-transform");return ot&&(g.transform=parseTransformString(ot)),g}}},provides:function(b){b.generateAbstractTransformGrouping=function(g){var tt=g.main,ot=g.transform,ut=g.containerWidth,gt=g.iconWidth,xt={transform:"translate(".concat(ut/2," 256)")},It="translate(".concat(ot.x*32,", ").concat(ot.y*32,") "),kt="scale(".concat(ot.size/16*(ot.flipX?-1:1),", ").concat(ot.size/16*(ot.flipY?-1:1),") "),Ft="rotate(".concat(ot.rotate," 0 0)"),Xt={transform:"".concat(It," ").concat(kt," ").concat(Ft)},qt={transform:"translate(".concat(gt/2*-1," -256)")},jt={outer:xt,inner:Xt,path:qt};return{tag:"g",attributes:_objectSpread2$1({},jt.outer),children:[{tag:"g",attributes:_objectSpread2$1({},jt.inner),children:[{tag:tt.icon.tag,children:tt.icon.children,attributes:_objectSpread2$1(_objectSpread2$1({},tt.icon.attributes),jt.path)}]}]}}}},ALL_SPACE={x:0,y:0,width:"100%",height:"100%"};function fillBlack($){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return $.attributes&&($.attributes.fill||b)&&($.attributes.fill="black"),$}function deGroup($){return $.tag==="g"?$.children:[$]}var Masks={hooks:function(){return{parseNodeAttributes:function(g,tt){var ot=tt.getAttribute("data-fa-mask"),ut=ot?getCanonicalIcon(ot.split(" ").map(function(gt){return gt.trim()})):emptyCanonicalIcon();return ut.prefix||(ut.prefix=getDefaultUsablePrefix()),g.mask=ut,g.maskId=tt.getAttribute("data-fa-mask-id"),g}}},provides:function(b){b.generateAbstractMask=function(g){var tt=g.children,ot=g.attributes,ut=g.main,gt=g.mask,xt=g.maskId,It=g.transform,kt=ut.width,Ft=ut.icon,Xt=gt.width,qt=gt.icon,jt=transformForSvg({transform:It,containerWidth:Xt,iconWidth:kt}),sn={tag:"rect",attributes:_objectSpread2$1(_objectSpread2$1({},ALL_SPACE),{},{fill:"white"})},Gt=Ft.children?{children:Ft.children.map(fillBlack)}:{},vn={tag:"g",attributes:_objectSpread2$1({},jt.inner),children:[fillBlack(_objectSpread2$1({tag:Ft.tag,attributes:_objectSpread2$1(_objectSpread2$1({},Ft.attributes),jt.path)},Gt))]},nn={tag:"g",attributes:_objectSpread2$1({},jt.outer),children:[vn]},Wt="mask-".concat(xt||nextUniqueId()),on="clip-".concat(xt||nextUniqueId()),gn={tag:"mask",attributes:_objectSpread2$1(_objectSpread2$1({},ALL_SPACE),{},{id:Wt,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[sn,nn]},ln={tag:"defs",children:[{tag:"clipPath",attributes:{id:on},children:deGroup(qt)},gn]};return tt.push(ln,{tag:"rect",attributes:_objectSpread2$1({fill:"currentColor","clip-path":"url(#".concat(on,")"),mask:"url(#".concat(Wt,")")},ALL_SPACE)}),{children:tt,attributes:ot}}}},MissingIconIndicator={provides:function(b){var g=!1;WINDOW.matchMedia&&(g=WINDOW.matchMedia("(prefers-reduced-motion: reduce)").matches),b.missingIconAbstract=function(){var tt=[],ot={fill:"currentColor"},ut={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};tt.push({tag:"path",attributes:_objectSpread2$1(_objectSpread2$1({},ot),{},{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"})});var gt=_objectSpread2$1(_objectSpread2$1({},ut),{},{attributeName:"opacity"}),xt={tag:"circle",attributes:_objectSpread2$1(_objectSpread2$1({},ot),{},{cx:"256",cy:"364",r:"28"}),children:[]};return g||xt.children.push({tag:"animate",attributes:_objectSpread2$1(_objectSpread2$1({},ut),{},{attributeName:"r",values:"28;14;28;28;14;28;"})},{tag:"animate",attributes:_objectSpread2$1(_objectSpread2$1({},gt),{},{values:"1;0;1;1;0;1;"})}),tt.push(xt),tt.push({tag:"path",attributes:_objectSpread2$1(_objectSpread2$1({},ot),{},{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),children:g?[]:[{tag:"animate",attributes:_objectSpread2$1(_objectSpread2$1({},gt),{},{values:"1;0;0;0;0;1;"})}]}),g||tt.push({tag:"path",attributes:_objectSpread2$1(_objectSpread2$1({},ot),{},{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),children:[{tag:"animate",attributes:_objectSpread2$1(_objectSpread2$1({},gt),{},{values:"0;0;1;1;0;0;"})}]}),{tag:"g",attributes:{class:"missing"},children:tt}}}},SvgSymbols={hooks:function(){return{parseNodeAttributes:function(g,tt){var ot=tt.getAttribute("data-fa-symbol"),ut=ot===null?!1:ot===""?!0:ot;return g.symbol=ut,g}}}},plugins=[InjectCSS,ReplaceElements,Layers,LayersCounter,LayersText,PseudoElements,MutationObserver$1,PowerTransforms,Masks,MissingIconIndicator,SvgSymbols];registerPlugins(plugins,{mixoutsTo:api});api.noAuto;api.config;api.library;api.dom;var parse$1=api.parse;api.findIconDefinition;api.toHtml;var icon2=api.icon;api.layer;api.text;api.counter;var propTypes={exports:{}},ReactPropTypesSecret$1="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",ReactPropTypesSecret_1=ReactPropTypesSecret$1,ReactPropTypesSecret=ReactPropTypesSecret_1;function emptyFunction(){}function emptyFunctionWithReset(){}emptyFunctionWithReset.resetWarningCache=emptyFunction;var factoryWithThrowingShims=function(){function $(tt,ot,ut,gt,xt,It){if(It!==ReactPropTypesSecret){var kt=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw kt.name="Invariant Violation",kt}}$.isRequired=$;function b(){return $}var g={array:$,bigint:$,bool:$,func:$,number:$,object:$,string:$,symbol:$,any:$,arrayOf:b,element:$,elementType:$,instanceOf:b,node:$,objectOf:b,oneOf:b,oneOfType:b,shape:b,exact:b,checkPropTypes:emptyFunctionWithReset,resetWarningCache:emptyFunction};return g.PropTypes=g,g};propTypes.exports=factoryWithThrowingShims();var propTypesExports=propTypes.exports;const PropTypes=getDefaultExportFromCjs(propTypesExports);function ownKeys($,b){var g=Object.keys($);if(Object.getOwnPropertySymbols){var tt=Object.getOwnPropertySymbols($);b&&(tt=tt.filter(function(ot){return Object.getOwnPropertyDescriptor($,ot).enumerable})),g.push.apply(g,tt)}return g}function _objectSpread2($){for(var b=1;b<arguments.length;b++){var g=arguments[b]!=null?arguments[b]:{};b%2?ownKeys(Object(g),!0).forEach(function(tt){_defineProperty($,tt,g[tt])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(g)):ownKeys(Object(g)).forEach(function(tt){Object.defineProperty($,tt,Object.getOwnPropertyDescriptor(g,tt))})}return $}function _typeof($){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},_typeof($)}function _defineProperty($,b,g){return b in $?Object.defineProperty($,b,{value:g,enumerable:!0,configurable:!0,writable:!0}):$[b]=g,$}function _objectWithoutPropertiesLoose($,b){if($==null)return{};var g={},tt=Object.keys($),ot,ut;for(ut=0;ut<tt.length;ut++)ot=tt[ut],!(b.indexOf(ot)>=0)&&(g[ot]=$[ot]);return g}function _objectWithoutProperties($,b){if($==null)return{};var g=_objectWithoutPropertiesLoose($,b),tt,ot;if(Object.getOwnPropertySymbols){var ut=Object.getOwnPropertySymbols($);for(ot=0;ot<ut.length;ot++)tt=ut[ot],!(b.indexOf(tt)>=0)&&Object.prototype.propertyIsEnumerable.call($,tt)&&(g[tt]=$[tt])}return g}function _toConsumableArray($){return _arrayWithoutHoles($)||_iterableToArray($)||_unsupportedIterableToArray($)||_nonIterableSpread()}function _arrayWithoutHoles($){if(Array.isArray($))return _arrayLikeToArray($)}function _iterableToArray($){if(typeof Symbol<"u"&&$[Symbol.iterator]!=null||$["@@iterator"]!=null)return Array.from($)}function _unsupportedIterableToArray($,b){if($){if(typeof $=="string")return _arrayLikeToArray($,b);var g=Object.prototype.toString.call($).slice(8,-1);if(g==="Object"&&$.constructor&&(g=$.constructor.name),g==="Map"||g==="Set")return Array.from($);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray($,b)}}function _arrayLikeToArray($,b){(b==null||b>$.length)&&(b=$.length);for(var g=0,tt=new Array(b);g<b;g++)tt[g]=$[g];return tt}function _nonIterableSpread(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function classList($){var b,g=$.beat,tt=$.fade,ot=$.beatFade,ut=$.bounce,gt=$.shake,xt=$.flash,It=$.spin,kt=$.spinPulse,Ft=$.spinReverse,Xt=$.pulse,qt=$.fixedWidth,jt=$.inverse,sn=$.border,Gt=$.listItem,vn=$.flip,nn=$.size,Wt=$.rotation,on=$.pull,gn=(b={"fa-beat":g,"fa-fade":tt,"fa-beat-fade":ot,"fa-bounce":ut,"fa-shake":gt,"fa-flash":xt,"fa-spin":It,"fa-spin-reverse":Ft,"fa-spin-pulse":kt,"fa-pulse":Xt,"fa-fw":qt,"fa-inverse":jt,"fa-border":sn,"fa-li":Gt,"fa-flip":vn===!0,"fa-flip-horizontal":vn==="horizontal"||vn==="both","fa-flip-vertical":vn==="vertical"||vn==="both"},_defineProperty(b,"fa-".concat(nn),typeof nn<"u"&&nn!==null),_defineProperty(b,"fa-rotate-".concat(Wt),typeof Wt<"u"&&Wt!==null&&Wt!==0),_defineProperty(b,"fa-pull-".concat(on),typeof on<"u"&&on!==null),_defineProperty(b,"fa-swap-opacity",$.swapOpacity),b);return Object.keys(gn).map(function(ln){return gn[ln]?ln:null}).filter(function(ln){return ln})}function _isNumerical($){return $=$-0,$===$}function camelize($){return _isNumerical($)?$:($=$.replace(/[\-_\s]+(.)?/g,function(b,g){return g?g.toUpperCase():""}),$.substr(0,1).toLowerCase()+$.substr(1))}var _excluded=["style"];function capitalize($){return $.charAt(0).toUpperCase()+$.slice(1)}function styleToObject($){return $.split(";").map(function(b){return b.trim()}).filter(function(b){return b}).reduce(function(b,g){var tt=g.indexOf(":"),ot=camelize(g.slice(0,tt)),ut=g.slice(tt+1).trim();return ot.startsWith("webkit")?b[capitalize(ot)]=ut:b[ot]=ut,b},{})}function convert($,b){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof b=="string")return b;var tt=(b.children||[]).map(function(It){return convert($,It)}),ot=Object.keys(b.attributes||{}).reduce(function(It,kt){var Ft=b.attributes[kt];switch(kt){case"class":It.attrs.className=Ft,delete b.attributes.class;break;case"style":It.attrs.style=styleToObject(Ft);break;default:kt.indexOf("aria-")===0||kt.indexOf("data-")===0?It.attrs[kt.toLowerCase()]=Ft:It.attrs[camelize(kt)]=Ft}return It},{attrs:{}}),ut=g.style,gt=ut===void 0?{}:ut,xt=_objectWithoutProperties(g,_excluded);return ot.attrs.style=_objectSpread2(_objectSpread2({},ot.attrs.style),gt),$.apply(void 0,[b.tag,_objectSpread2(_objectSpread2({},ot.attrs),xt)].concat(_toConsumableArray(tt)))}var PRODUCTION=!1;try{PRODUCTION=!0}catch{}function log(){if(!PRODUCTION&&console&&typeof console.error=="function"){var $;($=console).error.apply($,arguments)}}function normalizeIconArgs($){if($&&_typeof($)==="object"&&$.prefix&&$.iconName&&$.icon)return $;if(parse$1.icon)return parse$1.icon($);if($===null)return null;if($&&_typeof($)==="object"&&$.prefix&&$.iconName)return $;if(Array.isArray($)&&$.length===2)return{prefix:$[0],iconName:$[1]};if(typeof $=="string")return{prefix:"fas",iconName:$}}function objectWithKey($,b){return Array.isArray(b)&&b.length>0||!Array.isArray(b)&&b?_defineProperty({},$,b):{}}var FontAwesomeIcon=React.forwardRef(function($,b){var g=$.icon,tt=$.mask,ot=$.symbol,ut=$.className,gt=$.title,xt=$.titleId,It=$.maskId,kt=normalizeIconArgs(g),Ft=objectWithKey("classes",[].concat(_toConsumableArray(classList($)),_toConsumableArray(ut.split(" ")))),Xt=objectWithKey("transform",typeof $.transform=="string"?parse$1.transform($.transform):$.transform),qt=objectWithKey("mask",normalizeIconArgs(tt)),jt=icon2(kt,_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2({},Ft),Xt),qt),{},{symbol:ot,title:gt,titleId:xt,maskId:It}));if(!jt)return log("Could not find icon",kt),null;var sn=jt.abstract,Gt={ref:b};return Object.keys($).forEach(function(vn){FontAwesomeIcon.defaultProps.hasOwnProperty(vn)||(Gt[vn]=$[vn])}),convertCurry(sn[0],Gt)});FontAwesomeIcon.displayName="FontAwesomeIcon";FontAwesomeIcon.propTypes={beat:PropTypes.bool,border:PropTypes.bool,beatFade:PropTypes.bool,bounce:PropTypes.bool,className:PropTypes.string,fade:PropTypes.bool,flash:PropTypes.bool,mask:PropTypes.oneOfType([PropTypes.object,PropTypes.array,PropTypes.string]),maskId:PropTypes.string,fixedWidth:PropTypes.bool,inverse:PropTypes.bool,flip:PropTypes.oneOf([!0,!1,"horizontal","vertical","both"]),icon:PropTypes.oneOfType([PropTypes.object,PropTypes.array,PropTypes.string]),listItem:PropTypes.bool,pull:PropTypes.oneOf(["right","left"]),pulse:PropTypes.bool,rotation:PropTypes.oneOf([0,90,180,270]),shake:PropTypes.bool,size:PropTypes.oneOf(["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"]),spin:PropTypes.bool,spinPulse:PropTypes.bool,spinReverse:PropTypes.bool,symbol:PropTypes.oneOfType([PropTypes.bool,PropTypes.string]),title:PropTypes.string,titleId:PropTypes.string,transform:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),swapOpacity:PropTypes.bool};FontAwesomeIcon.defaultProps={border:!1,className:"",mask:null,maskId:null,fixedWidth:!1,inverse:!1,flip:!1,icon:null,listItem:!1,pull:null,pulse:!1,rotation:null,size:null,spin:!1,spinPulse:!1,spinReverse:!1,beat:!1,fade:!1,beatFade:!1,bounce:!1,shake:!1,symbol:!1,title:"",titleId:null,transform:null,swapOpacity:!1};var convertCurry=convert.bind(null,React.createElement),faStackOverflow={prefix:"fab",iconName:"stack-overflow",icon:[384,512,[],"f16c","M290.7 311L95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"]},faDiscord={prefix:"fab",iconName:"discord",icon:[640,512,[],"f392","M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"]},faLinkedin={prefix:"fab",iconName:"linkedin",icon:[448,512,[],"f08c","M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"]},faGithub={prefix:"fab",iconName:"github",icon:[496,512,[],"f09b","M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"]};function Nav(){return jsxRuntimeExports.jsx("nav",{className:"nav-wrapper",children:jsxRuntimeExports.jsx("div",{className:"nav-content",children:jsxRuntimeExports.jsxs("ul",{className:"list-styled",children:[jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx(FontAwesomeIcon,{className:"icon k",icon:faK})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Experience"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Resume"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Skills"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Projects"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Roles"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Achievements"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Certificates"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled",children:"Education"})}),jsxRuntimeExports.jsxs("ul",{className:"icon-list",children:[jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled icon ",children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faGithub})})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled icon",children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faLinkedin})})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled icon",children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faStackOverflow})})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{className:"link-styled icon",children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faDiscord})})})]})]})})})}/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={109:function($,b,g){var tt=g(352),ot=g.n(tt)()(function(ut){return ut[1]});ot.push([$.id,'.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(0.54, 1.5, 0.38, 1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:rgba(0,0,0,0);border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',""]),b.Z=ot},356:function($,b,g){var tt=g(352),ot=g.n(tt)()(function(ut){return ut[1]});ot.push([$.id,".loader{width:48px;height:48px;border:5px solid #333;border-bottom-color:rgba(0,0,0,0);border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}",""]),b.Z=ot},44:function($,b,g){var tt=g(352),ot=g.n(tt)()(function(ut){return ut[1]});ot.push([$.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:rgba(0,0,0,0);height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:rgba(34,34,34,.6666666667);text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),b.Z=ot},27:function($,b,g){var tt=g(352),ot=g.n(tt)()(function(ut){return ut[1]});ot.push([$.id,'#assetManagerLoadingScreen{z-index:300;position:absolute;bottom:0;right:0;min-width:100%;min-height:100%;color:#333;font-size:1rem;gap:1rem;display:flex;align-content:center;justify-content:center;align-items:center;flex-direction:column;opacity:1;transition:opacity .5s ease-in-out,min-width .5s,min-height .5s,bottom .5s,right .5s;overflow:hidden;background:rgba(0,0,0,0);-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;--b-opacity: 0.8;--b-background: #ffffff}#assetManagerLoadingScreen::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;opacity:var(--b-opacity);background:var(--b-background)}#assetManagerLoadingScreenContent{padding-top:.5rem}.loadingScreenProcessState{font-weight:bold}#assetManagerLoadingScreen.minimizedLoadingScreen{top:unset;left:unset;bottom:2rem;right:2rem;min-width:0;min-height:0;max-width:80vw;max-height:80vh;width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content;padding:1.5rem;border-radius:.5rem}.loadingScreenFilesElement{min-height:4rem}.loadingScreenLogoElement{margin-bottom:.5rem}.loadingScreenLogoElement img{min-height:3rem;max-height:6rem}.loadingScreenLogoImage{width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content}.minimizedLoadingScreen .loadingScreenLoadingElement{display:none}.minimizedLoadingScreen .loadingScreenFilesElement{min-height:0}.minimizedLoadingScreen .loadingScreenLogoImage{min-height:0}.minimizedLoadingScreen #assetManagerLoadingScreenContent{display:none}',""]),b.Z=ot},798:function($,b,g){var tt=g(352),ot=g.n(tt)()(function(ut){return ut[1]});ot.push([$.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;color:#fff;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;background-color:rgba(40,34,60,.6666666667);padding:1.5rem;font-size:1rem;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),b.Z=ot},729:function($,b,g){var tt=g(352),ot=g.n(tt)()(function(ut){return ut[1]});ot.push([$.id,'.button-bar{background:var(--tp-base-background-color);border:1px solid #8f949c;width:fit-content;width:-moz-fit-content;height:auto;display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;z-index:200;padding:.25rem .5rem .5rem;border-radius:.5rem;pointer-events:auto;box-shadow:0 2px 4px var(--tp-base-shadow-color);gap:8px;font-size:.85rem;line-height:130%;font-family:Inter,"Roboto Mono","Source Code Pro",Menlo,Courier,monospace;opacity:1;transition:all .25s}.button-bar-button{background-color:rgba(0,0,0,0);cursor:pointer;width:auto;height:auto;font-weight:400;padding:.35rem .5rem;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;color:#ccc;transition:color .25s}.button-bar-button:hover{color:#eee}.button-bar-selected{color:#fff}.button-bar-selected-box{color:#fff}.button-bar>.button-bar-button:not(:last-child)::after{content:"";position:absolute;right:-5px;top:20%;width:2px;height:60%;border-radius:1px;background-color:#413762}.button-bar-button:before{left:50%;width:0;content:"";position:absolute}.button-bar-selected:before{left:25%;width:50%;bottom:0;height:2px;border-radius:1px;background-color:#ccc;transition:width .25s,left .25s}.button-bar-selected-box{background-color:rgba(238,238,238,.3333333333);border-radius:.25rem;transition:all .25s}.round-button{width:1rem;height:1rem;padding:.6rem;background-color:var(--tp-base-background-color);border-radius:1.2rem;color:#ccc;cursor:pointer;box-shadow:0 2px 4px var(--tp-base-shadow-color);transition:all .25s}.round-button:hover{color:#fff}.util-buttons-container{bottom:1.25rem;right:1.25rem;position:absolute;gap:8px;padding:.25rem}.util-button{position:relative;width:auto;height:1.2rem}.mode-buttons-container{border-top:0;top:0;left:0;right:0;margin-left:auto;margin-right:auto;position:absolute;min-width:6rem;border-radius:0 0 .5rem .5rem;gap:8px}.mode-button{font-weight:400}#webgi-logo{background-image:url("https://webgi.xyz/img/logo.svg");background-size:contain;background-repeat:no-repeat;background-position:center;bottom:1.25rem;left:1rem;z-index:100;width:2.5rem;height:2.5rem;position:absolute;cursor:pointer}#webgi-logo:hover{filter:grayscale(100%)}#fsToggle{position:absolute;right:1.25rem;top:1.25rem}#assetManagerPopup{position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;color:#fff;padding:1.5rem;font-size:.85rem;overflow-y:scroll;background-color:var(--tp-base-background-color)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:rgba(40,34,60,.8) !important;border-radius:6px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.4);border-radius:6px}::-webkit-scrollbar-corner{background:rgba(0,0,0,.5)}.tippy-box[data-theme~=editor]{margin:.25rem !important;background-color:var(--tp-base-background-color) !important;font-size:.8rem !important;color:#ddd !important}#tweakpaneUiContainer{margin-top:7.5rem}@media only screen and (min-width: 480px){#tweakpaneUiContainer{margin-top:5.5rem}}#canvasContainer{display:flex;justify-content:center;align-items:center}@media only screen and (min-width: 920px){#canvasContainer{width:calc(min(100% - 3rem,100% - var(--tweakpane-ui-container-width, 300px)) - 3.5rem) !important;height:calc(100% - 5rem);margin:3.5rem 1.5rem 1.5rem 1.5rem;border-radius:.5rem;box-shadow:rgba(0,0,0,.25) 0px 25px 50px -12px}#mcanvas{border-radius:.5rem}#tweakpaneUiContainer{margin-top:3.5rem}}body{background-color:#d1d4e7}',""]),b.Z=ot},898:function($,b,g){var tt=g(352),ot=g.n(tt)()(function(ut){return ut[1]});ot.push([$.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-moz-min-content;height:min-content;background:rgba(0,0,0,0);color:#eee;border:none}',""]),b.Z=ot},513:function($,b,g){var tt=g(352),ot=g.n(tt)()(function(ut){return ut[1]});ot.push([$.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),b.Z=ot},476:function($){var b;b=function(){return function(g){var tt={};function ot(ut){if(tt[ut])return tt[ut].exports;var gt=tt[ut]={i:ut,l:!1,exports:{}};return g[ut].call(gt.exports,gt,gt.exports,ot),gt.l=!0,gt.exports}return ot.m=g,ot.c=tt,ot.i=function(ut){return ut},ot.d=function(ut,gt,xt){ot.o(ut,gt)||Object.defineProperty(ut,gt,{configurable:!1,enumerable:!0,get:xt})},ot.n=function(ut){var gt=ut&&ut.__esModule?function(){return ut.default}:function(){return ut};return ot.d(gt,"a",gt),gt},ot.o=function(ut,gt){return Object.prototype.hasOwnProperty.call(ut,gt)},ot.p="",ot(ot.s=5)}([function(g,tt,ot){Object.defineProperty(tt,"__esModule",{value:!0});var ut={convertToObject:function(gt){var xt=gt.substring(gt.indexOf("{")+1).trim().slice(0,-1),It={};return xt.split(";").map(function(kt){if(kt=kt.trim()){var Ft=kt.split(":");It[Ft[0].trim()]=Ft[1].trim()}}),It},getFromSheets:function(gt){var xt=document.styleSheets;for(var It in xt){var kt=null;try{kt=xt[It].rules||xt[It].cssRules}catch{}if(kt){for(var Ft in kt)if(kt[Ft].selectorText&&kt[Ft].selectorText.split(",").indexOf(gt)!=-1)return kt[Ft].cssText?ut.convertToObject(kt[Ft].cssText):ut.convertToObject(kt[Ft].style.cssText)}}return{}},getPropertyDefault:function(gt){return gt=="timing-function"?"ease":gt=="iteration-count"?1:gt=="direction"?"normal":gt=="fill-mode"?"none":null}};tt.default=ut},function(g,tt,ot){Object.defineProperty(tt,"__esModule",{value:!0});var ut={generateId:function(){for(var gt="",xt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",It=0;It<8;++It)gt+=xt.charAt(Math.floor(Math.random()*xt.length));return gt},frameToString:function(gt){var xt="";for(var It in gt)xt+=It+":"+gt[It]+";";return xt},convertTimeToMs:function(gt){if(!gt)return 0;if(typeof gt=="number")return gt;var xt=parseFloat(gt);return gt.indexOf("ms")!=-1?xt:1e3*xt},prefixes:["","-webkit-","-moz-","-o-"]};tt.default=ut},function(g,tt,ot){Object.defineProperty(tt,"__esModule",{value:!0});var ut,gt=(ut=ot(0))&&ut.__esModule?ut:{default:ut};tt.default=function xt(It,kt){if(function(qt,jt){if(!(qt instanceof jt))throw new TypeError("Cannot call a class as a function")}(this,xt),this.styles=typeof It=="string"?gt.default.getFromSheets(It):It,typeof kt=="string"){var Ft=gt.default.getFromSheets(kt);for(var Xt in this.options={},Ft)this.options[Xt.replace("animation-","")]=Ft[Xt]}else this.options=typeof kt=="number"?{duration:kt}:kt}},function(g,tt,ot){Object.defineProperty(tt,"__esModule",{value:!0});var ut=function(){function Xt(qt,jt){for(var sn=0;sn<jt.length;sn++){var Gt=jt[sn];Gt.enumerable=Gt.enumerable||!1,Gt.configurable=!0,"value"in Gt&&(Gt.writable=!0),Object.defineProperty(qt,Gt.key,Gt)}}return function(qt,jt,sn){return jt&&Xt(qt.prototype,jt),sn&&Xt(qt,sn),qt}}(),gt=kt(ot(4)),xt=kt(ot(1)),It=kt(ot(0));function kt(Xt){return Xt&&Xt.__esModule?Xt:{default:Xt}}var Ft=function(){function Xt(qt,jt,sn,Gt){if(function(Wt,on){if(!(Wt instanceof on))throw new TypeError("Cannot call a class as a function")}(this,Xt),qt.constructor===Array?this.doms=qt:this.doms=[qt],jt.constructor===Array?this.frames=jt:this.frames=[jt],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},sn!=null&&sn!=null)if(typeof sn=="boolean")this.options.instant=sn;else if(typeof sn=="number")this.options.count=sn,typeof Gt=="boolean"&&(this.options.instant=Gt);else for(var vn in sn)vn=="pauseAt"&&sn.pauseAt.constructor!==Array?this.options[vn]=[sn[vn]]:this.options[vn]=sn[vn];for(var nn in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=xt.default.prefixes:this.prefixes=[""],qt)this.countRemainder[nn]=this.options.count-1;this.options.instant&&this.play()}return ut(Xt,[{key:"play",value:function(){var qt=this;for(var jt in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(Gt){qt.promiseResolve=Gt})),this.doms){var sn=this.makeAnimation(this.doms[jt]);this.animations[jt]=sn.names,this.styleDoms[jt]=sn.styleDom,this.superSets[jt]=this.makeSuperSet(this.doms[jt],this.animations[jt]),this.playAnimation(this.doms[jt],this.superSets[jt]),this.eventHandler[jt]=this.handleAnimationEnd.bind(this,jt),this.doms[jt].addEventListener("animationend",this.eventHandler[jt])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(qt){if(!qt){for(var jt in this.doms)this.clear(jt);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var sn=this.styleDoms[qt];for(var Gt in sn&&sn.parentNode&&sn.parentNode.removeChild(sn),this.superSets[qt])for(var vn in this.prefixes)this.doms[qt].style[this.prefixes[vn]+"animation-"+Gt]=null;for(var nn in this.prefixes)this.doms[qt].style[this.prefixes[nn]+"animation-play-state"]=null;this.doms[qt].removeEventListener("animationend",this.eventHandler[qt]),this.countRemainder[qt]=this.options.count-1}},{key:"replay",value:function(qt){var jt=this.doms[qt],sn=jt.cloneNode(!0);jt.parentNode.replaceChild(sn,jt),this.doms[qt].removeEventListener("animationend",this.eventHandler[qt]),this.doms[qt]=sn,this.doms[qt].addEventListener("animationend",this.eventHandler[qt])}},{key:"pause",value:function(){for(var qt in this.doms)this.pauseDom(this.doms[qt])}},{key:"resume",value:function(){for(var qt in this.doms)this.resumeDom(this.doms[qt])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(qt,jt){var sn=jt.animationName,Gt=sn.substring(sn.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(Gt))&&this.pauseDom(this.doms[qt]),Gt==this.frames.length&&(this.countRemainder[qt]==-1?this.replay(qt):this.countRemainder[qt]>0?(this.countRemainder[qt]--,this.replay(qt)):(this.options.applyOnEnd&&this.applyOnEnd(qt),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(qt){for(var jt in this.prefixes)qt.style[this.prefixes[jt]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(qt){for(var jt in this.prefixes)qt.style[this.prefixes[jt]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(qt){var jt=this.newFrames[this.frames.length];for(var sn in jt)this.doms[qt].style[sn]=jt[sn]}},{key:"makeAnimation",value:function(qt){var jt={},sn=[],Gt={};for(var vn in this.frames)for(var nn in sn.push(this.frames[vn].styles),sn[vn])Gt[nn]=!0;var Wt=window.getComputedStyle(qt);for(var on in Gt)jt[on]=Wt[on];sn.unshift(jt);for(var gn=[sn[0]],ln=1;ln<sn.length;++ln){var _n=JSON.parse(JSON.stringify(gn[ln-1]));for(var Ut in sn[ln])_n[Ut]=sn[ln][Ut];gn.push(_n)}return this.newFrames=gn,gt.default.make(gn,this.prefixes)}},{key:"makeSuperSet",value:function(qt,jt){var sn=0,Gt={};for(var vn in this.frames)for(var nn in this.frames[vn].options)Gt[nn]="";Gt.name="",Gt.duration="",Gt.delay="";for(var Wt=0;Wt<this.frames.length;++Wt){if(Wt)for(var on in Gt)Gt[on]+=",";var gn=xt.default.convertTimeToMs(this.frames[Wt].options.duration),ln=xt.default.convertTimeToMs(this.frames[Wt].options.delay);for(var _n in Wt<this.options.startFrom&&(gn=0,ln=0),Gt.name+=jt[Wt],Gt.duration+=gn+"ms",Gt.delay+=sn+ln+"ms",Gt)_n!="name"&&_n!="duration"&&_n!="delay"&&(Gt[_n]+=this.frames[Wt].options[_n]?this.frames[Wt].options[_n]:It.default.getPropertyDefault(_n));var Ut=this.frames[Wt].options["iteration-count"];sn+=gn*parseInt(Ut||1)+ln}return Gt}},{key:"playAnimation",value:function(qt,jt){for(var sn in jt)for(var Gt in this.prefixes)qt.style[this.prefixes[Gt]+"animation-"+sn]=jt[sn];this.options.pauseAt.includes(0)&&this.pauseDom(qt)}}]),Xt}();tt.default=Ft},function(g,tt,ot){Object.defineProperty(tt,"__esModule",{value:!0});var ut,gt=(ut=ot(1))&&ut.__esModule?ut:{default:ut},xt={make:function(It,kt){for(var Ft=[],Xt="",qt="atr-"+gt.default.generateId(),jt=document.createElement("style"),sn=0;sn<It.length-1;++sn)Ft.push(qt+"-"+(sn+1)),Xt+=xt.makeFromTwoFrames(It[sn],It[sn+1],Ft[sn],kt);return jt.innerHTML=Xt,jt.class="foo",document.getElementsByTagName("head")[0].appendChild(jt),{names:Ft,styleDom:jt}},makeFromTwoFrames:function(It,kt,Ft,Xt){var qt="";for(var jt in Xt)qt+="@"+Xt[jt]+"keyframes "+Ft+" {",qt+="0%",qt+="{"+gt.default.frameToString(It)+"}",qt+="100%",qt+="{"+gt.default.frameToString(kt)+"}",qt+="}";return qt}};tt.default=xt},function(g,tt,ot){Object.defineProperty(tt,"__esModule",{value:!0}),tt.Queue=tt.Frame=void 0;var ut=xt(ot(2)),gt=xt(ot(3));function xt(It){return It&&It.__esModule?It:{default:It}}tt.Frame=ut.default,tt.Queue=gt.default}])},$.exports=b()},352:function($){$.exports=function(b){var g=[];return g.toString=function(){return this.map(function(tt){var ot=b(tt);return tt[2]?"@media ".concat(tt[2]," {").concat(ot,"}"):ot}).join("")},g.i=function(tt,ot,ut){typeof tt=="string"&&(tt=[[null,tt,""]]);var gt={};if(ut)for(var xt=0;xt<this.length;xt++){var It=this[xt][0];It!=null&&(gt[It]=!0)}for(var kt=0;kt<tt.length;kt++){var Ft=[].concat(tt[kt]);ut&&gt[Ft[0]]||(ot&&(Ft[2]?Ft[2]="".concat(ot," and ").concat(Ft[2]):Ft[2]=ot),g.push(Ft))}},g}},388:function($){$.exports=function b(g,tt,ot){function ut(It,kt){if(!tt[It]){if(!g[It]){if(gt)return gt(It,!0);throw new Error("Cannot find module '"+It+"'")}var Ft=tt[It]={exports:{}};g[It][0].call(Ft.exports,function(Xt){return ut(g[It][1][Xt]||Xt)},Ft,Ft.exports,b,g,tt,ot)}return tt[It].exports}for(var gt=void 0,xt=0;xt<ot.length;xt++)ut(ot[xt]);return ut}({1:[function(b,g,tt){(function(ot,ut,gt,xt,It,kt,Ft,Xt,qt){var jt=b("crypto");function sn(ln,_n){return function(Ut,Qt){var tn;if((tn=Qt.algorithm!=="passthrough"?jt.createHash(Qt.algorithm):new gn).write===void 0&&(tn.write=tn.update,tn.end=tn.update),on(Qt,tn).dispatch(Ut),tn.update||tn.end(""),tn.digest)return tn.digest(Qt.encoding==="buffer"?void 0:Qt.encoding);var bn=tn.read();return Qt.encoding!=="buffer"?bn.toString(Qt.encoding):bn}(ln,_n=nn(ln,_n))}(tt=g.exports=sn).sha1=function(ln){return sn(ln)},tt.keys=function(ln){return sn(ln,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},tt.MD5=function(ln){return sn(ln,{algorithm:"md5",encoding:"hex"})},tt.keysMD5=function(ln){return sn(ln,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var Gt=jt.getHashes?jt.getHashes().slice():["sha1","md5"];Gt.push("passthrough");var vn=["buffer","hex","binary","base64"];function nn(ln,_n){_n=_n||{};var Ut={};if(Ut.algorithm=_n.algorithm||"sha1",Ut.encoding=_n.encoding||"hex",Ut.excludeValues=!!_n.excludeValues,Ut.algorithm=Ut.algorithm.toLowerCase(),Ut.encoding=Ut.encoding.toLowerCase(),Ut.ignoreUnknown=_n.ignoreUnknown===!0,Ut.respectType=_n.respectType!==!1,Ut.respectFunctionNames=_n.respectFunctionNames!==!1,Ut.respectFunctionProperties=_n.respectFunctionProperties!==!1,Ut.unorderedArrays=_n.unorderedArrays===!0,Ut.unorderedSets=_n.unorderedSets!==!1,Ut.unorderedObjects=_n.unorderedObjects!==!1,Ut.replacer=_n.replacer||void 0,Ut.excludeKeys=_n.excludeKeys||void 0,ln===void 0)throw new Error("Object argument required.");for(var Qt=0;Qt<Gt.length;++Qt)Gt[Qt].toLowerCase()===Ut.algorithm.toLowerCase()&&(Ut.algorithm=Gt[Qt]);if(Gt.indexOf(Ut.algorithm)===-1)throw new Error('Algorithm "'+Ut.algorithm+'"  not supported. supported values: '+Gt.join(", "));if(vn.indexOf(Ut.encoding)===-1&&Ut.algorithm!=="passthrough")throw new Error('Encoding "'+Ut.encoding+'"  not supported. supported values: '+vn.join(", "));return Ut}function Wt(ln){if(typeof ln=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(ln))!=null}function on(ln,_n,Ut){function Qt(tn){return _n.update?_n.update(tn,"utf8"):_n.write(tn,"utf8")}return Ut=Ut||[],{dispatch:function(tn){return ln.replacer&&(tn=ln.replacer(tn)),this["_"+(tn===null?"null":typeof tn)](tn)},_object:function(tn){var bn,Yt=Object.prototype.toString.call(tn),en=/\[object (.*)\]/i.exec(Yt);if(en=(en=en?en[1]:"unknown:["+Yt+"]").toLowerCase(),0<=(bn=Ut.indexOf(tn)))return this.dispatch("[CIRCULAR:"+bn+"]");if(Ut.push(tn),gt!==void 0&&gt.isBuffer&&gt.isBuffer(tn))return Qt("buffer:"),Qt(tn);if(en==="object"||en==="function"||en==="asyncfunction"){var un=Object.keys(tn);ln.unorderedObjects&&(un=un.sort()),ln.respectType===!1||Wt(tn)||un.splice(0,0,"prototype","__proto__","constructor"),ln.excludeKeys&&(un=un.filter(function(zn){return!ln.excludeKeys(zn)})),Qt("object:"+un.length+":");var yn=this;return un.forEach(function(zn){yn.dispatch(zn),Qt(":"),ln.excludeValues||yn.dispatch(tn[zn]),Qt(",")})}if(!this["_"+en]){if(ln.ignoreUnknown)return Qt("["+en+"]");throw new Error('Unknown object type "'+en+'"')}this["_"+en](tn)},_array:function(tn,bn){bn=bn!==void 0?bn:ln.unorderedArrays!==!1;var Yt=this;if(Qt("array:"+tn.length+":"),!bn||tn.length<=1)return tn.forEach(function(yn){return Yt.dispatch(yn)});var en=[],un=tn.map(function(yn){var zn=new gn,Yn=Ut.slice();return on(ln,zn,Yn).dispatch(yn),en=en.concat(Yn.slice(Ut.length)),zn.read().toString()});return Ut=Ut.concat(en),un.sort(),this._array(un,!1)},_date:function(tn){return Qt("date:"+tn.toJSON())},_symbol:function(tn){return Qt("symbol:"+tn.toString())},_error:function(tn){return Qt("error:"+tn.toString())},_boolean:function(tn){return Qt("bool:"+tn.toString())},_string:function(tn){Qt("string:"+tn.length+":"),Qt(tn.toString())},_function:function(tn){Qt("fn:"),Wt(tn)?this.dispatch("[native]"):this.dispatch(tn.toString()),ln.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(tn.name)),ln.respectFunctionProperties&&this._object(tn)},_number:function(tn){return Qt("number:"+tn.toString())},_xml:function(tn){return Qt("xml:"+tn.toString())},_null:function(){return Qt("Null")},_undefined:function(){return Qt("Undefined")},_regexp:function(tn){return Qt("regex:"+tn.toString())},_uint8array:function(tn){return Qt("uint8array:"),this.dispatch(Array.prototype.slice.call(tn))},_uint8clampedarray:function(tn){return Qt("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(tn))},_int8array:function(tn){return Qt("uint8array:"),this.dispatch(Array.prototype.slice.call(tn))},_uint16array:function(tn){return Qt("uint16array:"),this.dispatch(Array.prototype.slice.call(tn))},_int16array:function(tn){return Qt("uint16array:"),this.dispatch(Array.prototype.slice.call(tn))},_uint32array:function(tn){return Qt("uint32array:"),this.dispatch(Array.prototype.slice.call(tn))},_int32array:function(tn){return Qt("uint32array:"),this.dispatch(Array.prototype.slice.call(tn))},_float32array:function(tn){return Qt("float32array:"),this.dispatch(Array.prototype.slice.call(tn))},_float64array:function(tn){return Qt("float64array:"),this.dispatch(Array.prototype.slice.call(tn))},_arraybuffer:function(tn){return Qt("arraybuffer:"),this.dispatch(new Uint8Array(tn))},_url:function(tn){return Qt("url:"+tn.toString())},_map:function(tn){Qt("map:");var bn=Array.from(tn);return this._array(bn,ln.unorderedSets!==!1)},_set:function(tn){Qt("set:");var bn=Array.from(tn);return this._array(bn,ln.unorderedSets!==!1)},_file:function(tn){return Qt("file:"),this.dispatch([tn.name,tn.size,tn.type,tn.lastModfied])},_blob:function(){if(ln.ignoreUnknown)return Qt("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return Qt("domwindow")},_bigint:function(tn){return Qt("bigint:"+tn.toString())},_process:function(){return Qt("process")},_timer:function(){return Qt("timer")},_pipe:function(){return Qt("pipe")},_tcp:function(){return Qt("tcp")},_udp:function(){return Qt("udp")},_tty:function(){return Qt("tty")},_statwatcher:function(){return Qt("statwatcher")},_securecontext:function(){return Qt("securecontext")},_connection:function(){return Qt("connection")},_zlib:function(){return Qt("zlib")},_context:function(){return Qt("context")},_nodescript:function(){return Qt("nodescript")},_httpparser:function(){return Qt("httpparser")},_dataview:function(){return Qt("dataview")},_signal:function(){return Qt("signal")},_fsevent:function(){return Qt("fsevent")},_tlswrap:function(){return Qt("tlswrap")}}}function gn(){return{buf:"",write:function(ln){this.buf+=ln},end:function(ln){this.buf+=ln},read:function(){return this.buf}}}tt.writeToStream=function(ln,_n,Ut){return Ut===void 0&&(Ut=_n,_n={}),on(_n=nn(ln,_n),Ut).dispatch(ln)}}).call(this,b("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},b("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(b,g,tt){(function(ot,ut,gt,xt,It,kt,Ft,Xt,qt){(function(jt){var sn=typeof Uint8Array<"u"?Uint8Array:Array,Gt=43,vn=47,nn=48,Wt=97,on=65,gn=45,ln=95;function _n(Ut){var Qt=Ut.charCodeAt(0);return Qt===Gt||Qt===gn?62:Qt===vn||Qt===ln?63:Qt<nn?-1:Qt<nn+10?Qt-nn+26+26:Qt<on+26?Qt-on:Qt<Wt+26?Qt-Wt+26:void 0}jt.toByteArray=function(Ut){var Qt,tn;if(0<Ut.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var bn=Ut.length,Yt=Ut.charAt(bn-2)==="="?2:Ut.charAt(bn-1)==="="?1:0,en=new sn(3*Ut.length/4-Yt),un=0<Yt?Ut.length-4:Ut.length,yn=0;function zn(Yn){en[yn++]=Yn}for(Qt=0;Qt<un;Qt+=4,0)zn((16711680&(tn=_n(Ut.charAt(Qt))<<18|_n(Ut.charAt(Qt+1))<<12|_n(Ut.charAt(Qt+2))<<6|_n(Ut.charAt(Qt+3))))>>16),zn((65280&tn)>>8),zn(255&tn);return Yt==2?zn(255&(tn=_n(Ut.charAt(Qt))<<2|_n(Ut.charAt(Qt+1))>>4)):Yt==1&&(zn((tn=_n(Ut.charAt(Qt))<<10|_n(Ut.charAt(Qt+1))<<4|_n(Ut.charAt(Qt+2))>>2)>>8&255),zn(255&tn)),en},jt.fromByteArray=function(Ut){var Qt,tn,bn,Yt,en=Ut.length%3,un="";function yn(zn){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(zn)}for(Qt=0,bn=Ut.length-en;Qt<bn;Qt+=3)un+=yn((Yt=tn=(Ut[Qt]<<16)+(Ut[Qt+1]<<8)+Ut[Qt+2])>>18&63)+yn(Yt>>12&63)+yn(Yt>>6&63)+yn(63&Yt);switch(en){case 1:un+=yn((tn=Ut[Ut.length-1])>>2),un+=yn(tn<<4&63),un+="==";break;case 2:un+=yn((tn=(Ut[Ut.length-2]<<8)+Ut[Ut.length-1])>>10),un+=yn(tn>>4&63),un+=yn(tn<<2&63),un+="="}return un}})(tt===void 0?this.base64js={}:tt)}).call(this,b("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},b("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(b,g,tt){(function(ot,ut,Gt,xt,It,kt,Ft,Xt,qt){var jt=b("base64-js"),sn=b("ieee754");function Gt(dn,kn,Vn){if(!(this instanceof Gt))return new Gt(dn,kn,Vn);var Rr,cr,Hr,xs,Ys,ls=typeof dn;if(kn==="base64"&&ls=="string")for(dn=(Rr=dn).trim?Rr.trim():Rr.replace(/^\s+|\s+$/g,"");dn.length%4!=0;)dn+="=";if(ls=="number")cr=yn(dn);else if(ls=="string")cr=Gt.byteLength(dn,kn);else{if(ls!="object")throw new Error("First argument needs to be a number, array or string.");cr=yn(dn.length)}if(Gt._useTypedArrays?Hr=Gt._augment(new Uint8Array(cr)):((Hr=this).length=cr,Hr._isBuffer=!0),Gt._useTypedArrays&&typeof dn.byteLength=="number")Hr._set(dn);else if(zn(Ys=dn)||Gt.isBuffer(Ys)||Ys&&typeof Ys=="object"&&typeof Ys.length=="number")for(xs=0;xs<cr;xs++)Gt.isBuffer(dn)?Hr[xs]=dn.readUInt8(xs):Hr[xs]=dn[xs];else if(ls=="string")Hr.write(dn,0,kn);else if(ls=="number"&&!Gt._useTypedArrays&&!Vn)for(xs=0;xs<cr;xs++)Hr[xs]=0;return Hr}function vn(dn,kn,Vn,Rr){Rr||(Kn(typeof Vn=="boolean","missing or invalid endian"),Kn(kn!=null,"missing offset"),Kn(kn+1<dn.length,"Trying to read beyond buffer length"));var cr,Hr=dn.length;if(!(Hr<=kn))return Vn?(cr=dn[kn],kn+1<Hr&&(cr|=dn[kn+1]<<8)):(cr=dn[kn]<<8,kn+1<Hr&&(cr|=dn[kn+1])),cr}function nn(dn,kn,Vn,Rr){Rr||(Kn(typeof Vn=="boolean","missing or invalid endian"),Kn(kn!=null,"missing offset"),Kn(kn+3<dn.length,"Trying to read beyond buffer length"));var cr,Hr=dn.length;if(!(Hr<=kn))return Vn?(kn+2<Hr&&(cr=dn[kn+2]<<16),kn+1<Hr&&(cr|=dn[kn+1]<<8),cr|=dn[kn],kn+3<Hr&&(cr+=dn[kn+3]<<24>>>0)):(kn+1<Hr&&(cr=dn[kn+1]<<16),kn+2<Hr&&(cr|=dn[kn+2]<<8),kn+3<Hr&&(cr|=dn[kn+3]),cr+=dn[kn]<<24>>>0),cr}function Wt(dn,kn,Vn,Rr){if(Rr||(Kn(typeof Vn=="boolean","missing or invalid endian"),Kn(kn!=null,"missing offset"),Kn(kn+1<dn.length,"Trying to read beyond buffer length")),!(dn.length<=kn)){var cr=vn(dn,kn,Vn,!0);return 32768&cr?-1*(65535-cr+1):cr}}function on(dn,kn,Vn,Rr){if(Rr||(Kn(typeof Vn=="boolean","missing or invalid endian"),Kn(kn!=null,"missing offset"),Kn(kn+3<dn.length,"Trying to read beyond buffer length")),!(dn.length<=kn)){var cr=nn(dn,kn,Vn,!0);return 2147483648&cr?-1*(4294967295-cr+1):cr}}function gn(dn,kn,Vn,Rr){return Rr||(Kn(typeof Vn=="boolean","missing or invalid endian"),Kn(kn+3<dn.length,"Trying to read beyond buffer length")),sn.read(dn,kn,Vn,23,4)}function ln(dn,kn,Vn,Rr){return Rr||(Kn(typeof Vn=="boolean","missing or invalid endian"),Kn(kn+7<dn.length,"Trying to read beyond buffer length")),sn.read(dn,kn,Vn,52,8)}function _n(dn,kn,Vn,Rr,cr){cr||(Kn(kn!=null,"missing value"),Kn(typeof Rr=="boolean","missing or invalid endian"),Kn(Vn!=null,"missing offset"),Kn(Vn+1<dn.length,"trying to write beyond buffer length"),rr(kn,65535));var Hr=dn.length;if(!(Hr<=Vn))for(var xs=0,Ys=Math.min(Hr-Vn,2);xs<Ys;xs++)dn[Vn+xs]=(kn&255<<8*(Rr?xs:1-xs))>>>8*(Rr?xs:1-xs)}function Ut(dn,kn,Vn,Rr,cr){cr||(Kn(kn!=null,"missing value"),Kn(typeof Rr=="boolean","missing or invalid endian"),Kn(Vn!=null,"missing offset"),Kn(Vn+3<dn.length,"trying to write beyond buffer length"),rr(kn,4294967295));var Hr=dn.length;if(!(Hr<=Vn))for(var xs=0,Ys=Math.min(Hr-Vn,4);xs<Ys;xs++)dn[Vn+xs]=kn>>>8*(Rr?xs:3-xs)&255}function Qt(dn,kn,Vn,Rr,cr){cr||(Kn(kn!=null,"missing value"),Kn(typeof Rr=="boolean","missing or invalid endian"),Kn(Vn!=null,"missing offset"),Kn(Vn+1<dn.length,"Trying to write beyond buffer length"),sr(kn,32767,-32768)),dn.length<=Vn||_n(dn,0<=kn?kn:65535+kn+1,Vn,Rr,cr)}function tn(dn,kn,Vn,Rr,cr){cr||(Kn(kn!=null,"missing value"),Kn(typeof Rr=="boolean","missing or invalid endian"),Kn(Vn!=null,"missing offset"),Kn(Vn+3<dn.length,"Trying to write beyond buffer length"),sr(kn,2147483647,-2147483648)),dn.length<=Vn||Ut(dn,0<=kn?kn:4294967295+kn+1,Vn,Rr,cr)}function bn(dn,kn,Vn,Rr,cr){cr||(Kn(kn!=null,"missing value"),Kn(typeof Rr=="boolean","missing or invalid endian"),Kn(Vn!=null,"missing offset"),Kn(Vn+3<dn.length,"Trying to write beyond buffer length"),br(kn,34028234663852886e22,-34028234663852886e22)),dn.length<=Vn||sn.write(dn,kn,Vn,Rr,23,4)}function Yt(dn,kn,Vn,Rr,cr){cr||(Kn(kn!=null,"missing value"),Kn(typeof Rr=="boolean","missing or invalid endian"),Kn(Vn!=null,"missing offset"),Kn(Vn+7<dn.length,"Trying to write beyond buffer length"),br(kn,17976931348623157e292,-17976931348623157e292)),dn.length<=Vn||sn.write(dn,kn,Vn,Rr,52,8)}tt.Buffer=Gt,tt.SlowBuffer=Gt,tt.INSPECT_MAX_BYTES=50,Gt.poolSize=8192,Gt._useTypedArrays=function(){try{var dn=new ArrayBuffer(0),kn=new Uint8Array(dn);return kn.foo=function(){return 42},kn.foo()===42&&typeof kn.subarray=="function"}catch{return!1}}(),Gt.isEncoding=function(dn){switch(String(dn).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Gt.isBuffer=function(dn){return!(dn==null||!dn._isBuffer)},Gt.byteLength=function(dn,kn){var Vn;switch(dn+="",kn||"utf8"){case"hex":Vn=dn.length/2;break;case"utf8":case"utf-8":Vn=tr(dn).length;break;case"ascii":case"binary":case"raw":Vn=dn.length;break;case"base64":Vn=Un(dn).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Vn=2*dn.length;break;default:throw new Error("Unknown encoding")}return Vn},Gt.concat=function(dn,kn){if(Kn(zn(dn),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),dn.length===0)return new Gt(0);if(dn.length===1)return dn[0];if(typeof kn!="number")for(cr=kn=0;cr<dn.length;cr++)kn+=dn[cr].length;for(var Vn=new Gt(kn),Rr=0,cr=0;cr<dn.length;cr++){var Hr=dn[cr];Hr.copy(Vn,Rr),Rr+=Hr.length}return Vn},Gt.prototype.write=function(dn,kn,Vn,Rr){var cr;isFinite(kn)?isFinite(Vn)||(Rr=Vn,Vn=void 0):(cr=Rr,Rr=kn,kn=Vn,Vn=cr),kn=Number(kn)||0;var Hr,xs,Ys,ls,oo,Ks,Xo,fr=this.length-kn;switch((!Vn||fr<(Vn=Number(Vn)))&&(Vn=fr),Rr=String(Rr||"utf8").toLowerCase()){case"hex":Hr=function(ko,pu,Fu,wo){Fu=Number(Fu)||0;var Pl=ko.length-Fu;(!wo||Pl<(wo=Number(wo)))&&(wo=Pl);var xa=pu.length;Kn(xa%2==0,"Invalid hex string"),xa/2<wo&&(wo=xa/2);for(var Bl=0;Bl<wo;Bl++){var po=parseInt(pu.substr(2*Bl,2),16);Kn(!isNaN(po),"Invalid hex string"),ko[Fu+Bl]=po}return Gt._charsWritten=2*Bl,Bl}(this,dn,kn,Vn);break;case"utf8":case"utf-8":oo=dn,Ks=kn,Xo=Vn,Hr=Gt._charsWritten=Jn(tr(oo),this,Ks,Xo);break;case"ascii":case"binary":Hr=function(ko,pu,Fu,wo){return Gt._charsWritten=Jn(function(Pl){for(var xa=[],Bl=0;Bl<Pl.length;Bl++)xa.push(255&Pl.charCodeAt(Bl));return xa}(pu),ko,Fu,wo)}(this,dn,kn,Vn);break;case"base64":xs=dn,Ys=kn,ls=Vn,Hr=Gt._charsWritten=Jn(Un(xs),this,Ys,ls);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Hr=function(ko,pu,Fu,wo){return Gt._charsWritten=Jn(function(Pl){for(var xa,Bl,po,Go=[],su=0;su<Pl.length;su++)Bl=(xa=Pl.charCodeAt(su))>>8,po=xa%256,Go.push(po),Go.push(Bl);return Go}(pu),ko,Fu,wo)}(this,dn,kn,Vn);break;default:throw new Error("Unknown encoding")}return Hr},Gt.prototype.toString=function(dn,kn,Vn){var Rr,cr,Hr,xs,Ys=this;if(dn=String(dn||"utf8").toLowerCase(),kn=Number(kn)||0,(Vn=Vn!==void 0?Number(Vn):Vn=Ys.length)===kn)return"";switch(dn){case"hex":Rr=function(ls,oo,Ks){var Xo=ls.length;(!oo||oo<0)&&(oo=0),(!Ks||Ks<0||Xo<Ks)&&(Ks=Xo);for(var fr="",ko=oo;ko<Ks;ko++)fr+=Yn(ls[ko]);return fr}(Ys,kn,Vn);break;case"utf8":case"utf-8":Rr=function(ls,oo,Ks){var Xo="",fr="";Ks=Math.min(ls.length,Ks);for(var ko=oo;ko<Ks;ko++)ls[ko]<=127?(Xo+=hn(fr)+String.fromCharCode(ls[ko]),fr=""):fr+="%"+ls[ko].toString(16);return Xo+hn(fr)}(Ys,kn,Vn);break;case"ascii":case"binary":Rr=function(ls,oo,Ks){var Xo="";Ks=Math.min(ls.length,Ks);for(var fr=oo;fr<Ks;fr++)Xo+=String.fromCharCode(ls[fr]);return Xo}(Ys,kn,Vn);break;case"base64":cr=Ys,xs=Vn,Rr=(Hr=kn)===0&&xs===cr.length?jt.fromByteArray(cr):jt.fromByteArray(cr.slice(Hr,xs));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Rr=function(ls,oo,Ks){for(var Xo=ls.slice(oo,Ks),fr="",ko=0;ko<Xo.length;ko+=2)fr+=String.fromCharCode(Xo[ko]+256*Xo[ko+1]);return fr}(Ys,kn,Vn);break;default:throw new Error("Unknown encoding")}return Rr},Gt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Gt.prototype.copy=function(dn,kn,Vn,Rr){if(Vn=Vn||0,Rr||Rr===0||(Rr=this.length),kn=kn||0,Rr!==Vn&&dn.length!==0&&this.length!==0){Kn(Vn<=Rr,"sourceEnd < sourceStart"),Kn(0<=kn&&kn<dn.length,"targetStart out of bounds"),Kn(0<=Vn&&Vn<this.length,"sourceStart out of bounds"),Kn(0<=Rr&&Rr<=this.length,"sourceEnd out of bounds"),Rr>this.length&&(Rr=this.length),dn.length-kn<Rr-Vn&&(Rr=dn.length-kn+Vn);var cr=Rr-Vn;if(cr<100||!Gt._useTypedArrays)for(var Hr=0;Hr<cr;Hr++)dn[Hr+kn]=this[Hr+Vn];else dn._set(this.subarray(Vn,Vn+cr),kn)}},Gt.prototype.slice=function(dn,kn){var Vn=this.length;if(dn=un(dn,Vn,0),kn=un(kn,Vn,Vn),Gt._useTypedArrays)return Gt._augment(this.subarray(dn,kn));for(var Rr=kn-dn,cr=new Gt(Rr,void 0,!0),Hr=0;Hr<Rr;Hr++)cr[Hr]=this[Hr+dn];return cr},Gt.prototype.get=function(dn){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(dn)},Gt.prototype.set=function(dn,kn){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(dn,kn)},Gt.prototype.readUInt8=function(dn,kn){if(kn||(Kn(dn!=null,"missing offset"),Kn(dn<this.length,"Trying to read beyond buffer length")),!(dn>=this.length))return this[dn]},Gt.prototype.readUInt16LE=function(dn,kn){return vn(this,dn,!0,kn)},Gt.prototype.readUInt16BE=function(dn,kn){return vn(this,dn,!1,kn)},Gt.prototype.readUInt32LE=function(dn,kn){return nn(this,dn,!0,kn)},Gt.prototype.readUInt32BE=function(dn,kn){return nn(this,dn,!1,kn)},Gt.prototype.readInt8=function(dn,kn){if(kn||(Kn(dn!=null,"missing offset"),Kn(dn<this.length,"Trying to read beyond buffer length")),!(dn>=this.length))return 128&this[dn]?-1*(255-this[dn]+1):this[dn]},Gt.prototype.readInt16LE=function(dn,kn){return Wt(this,dn,!0,kn)},Gt.prototype.readInt16BE=function(dn,kn){return Wt(this,dn,!1,kn)},Gt.prototype.readInt32LE=function(dn,kn){return on(this,dn,!0,kn)},Gt.prototype.readInt32BE=function(dn,kn){return on(this,dn,!1,kn)},Gt.prototype.readFloatLE=function(dn,kn){return gn(this,dn,!0,kn)},Gt.prototype.readFloatBE=function(dn,kn){return gn(this,dn,!1,kn)},Gt.prototype.readDoubleLE=function(dn,kn){return ln(this,dn,!0,kn)},Gt.prototype.readDoubleBE=function(dn,kn){return ln(this,dn,!1,kn)},Gt.prototype.writeUInt8=function(dn,kn,Vn){Vn||(Kn(dn!=null,"missing value"),Kn(kn!=null,"missing offset"),Kn(kn<this.length,"trying to write beyond buffer length"),rr(dn,255)),kn>=this.length||(this[kn]=dn)},Gt.prototype.writeUInt16LE=function(dn,kn,Vn){_n(this,dn,kn,!0,Vn)},Gt.prototype.writeUInt16BE=function(dn,kn,Vn){_n(this,dn,kn,!1,Vn)},Gt.prototype.writeUInt32LE=function(dn,kn,Vn){Ut(this,dn,kn,!0,Vn)},Gt.prototype.writeUInt32BE=function(dn,kn,Vn){Ut(this,dn,kn,!1,Vn)},Gt.prototype.writeInt8=function(dn,kn,Vn){Vn||(Kn(dn!=null,"missing value"),Kn(kn!=null,"missing offset"),Kn(kn<this.length,"Trying to write beyond buffer length"),sr(dn,127,-128)),kn>=this.length||(0<=dn?this.writeUInt8(dn,kn,Vn):this.writeUInt8(255+dn+1,kn,Vn))},Gt.prototype.writeInt16LE=function(dn,kn,Vn){Qt(this,dn,kn,!0,Vn)},Gt.prototype.writeInt16BE=function(dn,kn,Vn){Qt(this,dn,kn,!1,Vn)},Gt.prototype.writeInt32LE=function(dn,kn,Vn){tn(this,dn,kn,!0,Vn)},Gt.prototype.writeInt32BE=function(dn,kn,Vn){tn(this,dn,kn,!1,Vn)},Gt.prototype.writeFloatLE=function(dn,kn,Vn){bn(this,dn,kn,!0,Vn)},Gt.prototype.writeFloatBE=function(dn,kn,Vn){bn(this,dn,kn,!1,Vn)},Gt.prototype.writeDoubleLE=function(dn,kn,Vn){Yt(this,dn,kn,!0,Vn)},Gt.prototype.writeDoubleBE=function(dn,kn,Vn){Yt(this,dn,kn,!1,Vn)},Gt.prototype.fill=function(dn,kn,Vn){if(dn=dn||0,kn=kn||0,Vn=Vn||this.length,typeof dn=="string"&&(dn=dn.charCodeAt(0)),Kn(typeof dn=="number"&&!isNaN(dn),"value is not a number"),Kn(kn<=Vn,"end < start"),Vn!==kn&&this.length!==0){Kn(0<=kn&&kn<this.length,"start out of bounds"),Kn(0<=Vn&&Vn<=this.length,"end out of bounds");for(var Rr=kn;Rr<Vn;Rr++)this[Rr]=dn}},Gt.prototype.inspect=function(){for(var dn=[],kn=this.length,Vn=0;Vn<kn;Vn++)if(dn[Vn]=Yn(this[Vn]),Vn===tt.INSPECT_MAX_BYTES){dn[Vn+1]="...";break}return"<Buffer "+dn.join(" ")+">"},Gt.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(Gt._useTypedArrays)return new Gt(this).buffer;for(var dn=new Uint8Array(this.length),kn=0,Vn=dn.length;kn<Vn;kn+=1)dn[kn]=this[kn];return dn.buffer};var en=Gt.prototype;function un(dn,kn,Vn){return typeof dn!="number"?Vn:kn<=(dn=~~dn)?kn:0<=dn||0<=(dn+=kn)?dn:0}function yn(dn){return(dn=~~Math.ceil(+dn))<0?0:dn}function zn(dn){return(Array.isArray||function(kn){return Object.prototype.toString.call(kn)==="[object Array]"})(dn)}function Yn(dn){return dn<16?"0"+dn.toString(16):dn.toString(16)}function tr(dn){for(var kn=[],Vn=0;Vn<dn.length;Vn++){var Rr=dn.charCodeAt(Vn);if(Rr<=127)kn.push(dn.charCodeAt(Vn));else{var cr=Vn;55296<=Rr&&Rr<=57343&&Vn++;for(var Hr=encodeURIComponent(dn.slice(cr,Vn+1)).substr(1).split("%"),xs=0;xs<Hr.length;xs++)kn.push(parseInt(Hr[xs],16))}}return kn}function Un(dn){return jt.toByteArray(dn)}function Jn(dn,kn,Vn,Rr){for(var cr=0;cr<Rr&&!(cr+Vn>=kn.length||cr>=dn.length);cr++)kn[cr+Vn]=dn[cr];return cr}function hn(dn){try{return decodeURIComponent(dn)}catch{return""}}function rr(dn,kn){Kn(typeof dn=="number","cannot write a non-number as a number"),Kn(0<=dn,"specified a negative value for writing an unsigned value"),Kn(dn<=kn,"value is larger than maximum value for type"),Kn(Math.floor(dn)===dn,"value has a fractional component")}function sr(dn,kn,Vn){Kn(typeof dn=="number","cannot write a non-number as a number"),Kn(dn<=kn,"value larger than maximum allowed value"),Kn(Vn<=dn,"value smaller than minimum allowed value"),Kn(Math.floor(dn)===dn,"value has a fractional component")}function br(dn,kn,Vn){Kn(typeof dn=="number","cannot write a non-number as a number"),Kn(dn<=kn,"value larger than maximum allowed value"),Kn(Vn<=dn,"value smaller than minimum allowed value")}function Kn(dn,kn){if(!dn)throw new Error(kn||"Failed assertion")}Gt._augment=function(dn){return dn._isBuffer=!0,dn._get=dn.get,dn._set=dn.set,dn.get=en.get,dn.set=en.set,dn.write=en.write,dn.toString=en.toString,dn.toLocaleString=en.toString,dn.toJSON=en.toJSON,dn.copy=en.copy,dn.slice=en.slice,dn.readUInt8=en.readUInt8,dn.readUInt16LE=en.readUInt16LE,dn.readUInt16BE=en.readUInt16BE,dn.readUInt32LE=en.readUInt32LE,dn.readUInt32BE=en.readUInt32BE,dn.readInt8=en.readInt8,dn.readInt16LE=en.readInt16LE,dn.readInt16BE=en.readInt16BE,dn.readInt32LE=en.readInt32LE,dn.readInt32BE=en.readInt32BE,dn.readFloatLE=en.readFloatLE,dn.readFloatBE=en.readFloatBE,dn.readDoubleLE=en.readDoubleLE,dn.readDoubleBE=en.readDoubleBE,dn.writeUInt8=en.writeUInt8,dn.writeUInt16LE=en.writeUInt16LE,dn.writeUInt16BE=en.writeUInt16BE,dn.writeUInt32LE=en.writeUInt32LE,dn.writeUInt32BE=en.writeUInt32BE,dn.writeInt8=en.writeInt8,dn.writeInt16LE=en.writeInt16LE,dn.writeInt16BE=en.writeInt16BE,dn.writeInt32LE=en.writeInt32LE,dn.writeInt32BE=en.writeInt32BE,dn.writeFloatLE=en.writeFloatLE,dn.writeFloatBE=en.writeFloatBE,dn.writeDoubleLE=en.writeDoubleLE,dn.writeDoubleBE=en.writeDoubleBE,dn.fill=en.fill,dn.inspect=en.inspect,dn.toArrayBuffer=en.toArrayBuffer,dn}}).call(this,b("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},b("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(b,g,tt){(function(ot,ut,gt,xt,It,kt,Ft,Xt,qt){gt=b("buffer").Buffer;var jt=new gt(4);jt.fill(0),g.exports={hash:function(sn,Gt,vn,nn){return gt.isBuffer(sn)||(sn=new gt(sn)),function(Wt,on,gn){for(var ln=new gt(on),_n=gn?ln.writeInt32BE:ln.writeInt32LE,Ut=0;Ut<Wt.length;Ut++)_n.call(ln,Wt[Ut],4*Ut,!0);return ln}(Gt(function(Wt,on){var gn;Wt.length%4!=0&&(gn=Wt.length+(4-Wt.length%4),Wt=gt.concat([Wt,jt],gn));for(var ln=[],_n=on?Wt.readInt32BE:Wt.readInt32LE,Ut=0;Ut<Wt.length;Ut+=4)ln.push(_n.call(Wt,Ut));return ln}(sn,nn),8*sn.length),vn,nn)}}}).call(this,b("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},b("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(b,g,tt){(function(ot,ut,gt,xt,It,kt,Ft,Xt,qt){gt=b("buffer").Buffer;var jt=b("./sha"),sn=b("./sha256"),Gt=b("./rng"),vn={sha1:jt,sha256:sn,md5:b("./md5")},nn=64,Wt=new gt(nn);function on(ln,_n){var Ut=vn[ln=ln||"sha1"],Qt=[];return Ut||gn("algorithm:",ln,"is not yet supported"),{update:function(tn){return gt.isBuffer(tn)||(tn=new gt(tn)),Qt.push(tn),tn.length,this},digest:function(tn){var bn=gt.concat(Qt),Yt=_n?function(en,un,yn){gt.isBuffer(un)||(un=new gt(un)),gt.isBuffer(yn)||(yn=new gt(yn)),un.length>nn?un=en(un):un.length<nn&&(un=gt.concat([un,Wt],nn));for(var zn=new gt(nn),Yn=new gt(nn),tr=0;tr<nn;tr++)zn[tr]=54^un[tr],Yn[tr]=92^un[tr];var Un=en(gt.concat([zn,yn]));return en(gt.concat([Yn,Un]))}(Ut,_n,bn):Ut(bn);return Qt=null,tn?Yt.toString(tn):Yt}}}function gn(){var ln=[].slice.call(arguments).join(" ");throw new Error([ln,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}Wt.fill(0),tt.createHash=function(ln){return on(ln)},tt.createHmac=on,tt.randomBytes=function(ln,_n){if(!_n||!_n.call)return new gt(Gt(ln));try{_n.call(this,void 0,new gt(Gt(ln)))}catch(Ut){_n(Ut)}},function(ln,_n){for(var Ut in ln)_n(ln[Ut])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(ln){tt[ln]=function(){gn("sorry,",ln,"is not implemented yet")}})}).call(this,b("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},b("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(b,g,tt){(function(ot,ut,gt,xt,It,kt,Ft,Xt,qt){var jt=b("./helpers");function sn(ln,_n){ln[_n>>5]|=128<<_n%32,ln[14+(_n+64>>>9<<4)]=_n;for(var Ut=1732584193,Qt=-271733879,tn=-1732584194,bn=271733878,Yt=0;Yt<ln.length;Yt+=16){var en=Ut,un=Qt,yn=tn,zn=bn;Ut=vn(Ut,Qt,tn,bn,ln[Yt+0],7,-680876936),bn=vn(bn,Ut,Qt,tn,ln[Yt+1],12,-389564586),tn=vn(tn,bn,Ut,Qt,ln[Yt+2],17,606105819),Qt=vn(Qt,tn,bn,Ut,ln[Yt+3],22,-1044525330),Ut=vn(Ut,Qt,tn,bn,ln[Yt+4],7,-176418897),bn=vn(bn,Ut,Qt,tn,ln[Yt+5],12,1200080426),tn=vn(tn,bn,Ut,Qt,ln[Yt+6],17,-1473231341),Qt=vn(Qt,tn,bn,Ut,ln[Yt+7],22,-45705983),Ut=vn(Ut,Qt,tn,bn,ln[Yt+8],7,1770035416),bn=vn(bn,Ut,Qt,tn,ln[Yt+9],12,-1958414417),tn=vn(tn,bn,Ut,Qt,ln[Yt+10],17,-42063),Qt=vn(Qt,tn,bn,Ut,ln[Yt+11],22,-1990404162),Ut=vn(Ut,Qt,tn,bn,ln[Yt+12],7,1804603682),bn=vn(bn,Ut,Qt,tn,ln[Yt+13],12,-40341101),tn=vn(tn,bn,Ut,Qt,ln[Yt+14],17,-1502002290),Ut=nn(Ut,Qt=vn(Qt,tn,bn,Ut,ln[Yt+15],22,1236535329),tn,bn,ln[Yt+1],5,-165796510),bn=nn(bn,Ut,Qt,tn,ln[Yt+6],9,-1069501632),tn=nn(tn,bn,Ut,Qt,ln[Yt+11],14,643717713),Qt=nn(Qt,tn,bn,Ut,ln[Yt+0],20,-373897302),Ut=nn(Ut,Qt,tn,bn,ln[Yt+5],5,-701558691),bn=nn(bn,Ut,Qt,tn,ln[Yt+10],9,38016083),tn=nn(tn,bn,Ut,Qt,ln[Yt+15],14,-660478335),Qt=nn(Qt,tn,bn,Ut,ln[Yt+4],20,-405537848),Ut=nn(Ut,Qt,tn,bn,ln[Yt+9],5,568446438),bn=nn(bn,Ut,Qt,tn,ln[Yt+14],9,-1019803690),tn=nn(tn,bn,Ut,Qt,ln[Yt+3],14,-187363961),Qt=nn(Qt,tn,bn,Ut,ln[Yt+8],20,1163531501),Ut=nn(Ut,Qt,tn,bn,ln[Yt+13],5,-1444681467),bn=nn(bn,Ut,Qt,tn,ln[Yt+2],9,-51403784),tn=nn(tn,bn,Ut,Qt,ln[Yt+7],14,1735328473),Ut=Wt(Ut,Qt=nn(Qt,tn,bn,Ut,ln[Yt+12],20,-1926607734),tn,bn,ln[Yt+5],4,-378558),bn=Wt(bn,Ut,Qt,tn,ln[Yt+8],11,-2022574463),tn=Wt(tn,bn,Ut,Qt,ln[Yt+11],16,1839030562),Qt=Wt(Qt,tn,bn,Ut,ln[Yt+14],23,-35309556),Ut=Wt(Ut,Qt,tn,bn,ln[Yt+1],4,-1530992060),bn=Wt(bn,Ut,Qt,tn,ln[Yt+4],11,1272893353),tn=Wt(tn,bn,Ut,Qt,ln[Yt+7],16,-155497632),Qt=Wt(Qt,tn,bn,Ut,ln[Yt+10],23,-1094730640),Ut=Wt(Ut,Qt,tn,bn,ln[Yt+13],4,681279174),bn=Wt(bn,Ut,Qt,tn,ln[Yt+0],11,-358537222),tn=Wt(tn,bn,Ut,Qt,ln[Yt+3],16,-722521979),Qt=Wt(Qt,tn,bn,Ut,ln[Yt+6],23,76029189),Ut=Wt(Ut,Qt,tn,bn,ln[Yt+9],4,-640364487),bn=Wt(bn,Ut,Qt,tn,ln[Yt+12],11,-421815835),tn=Wt(tn,bn,Ut,Qt,ln[Yt+15],16,530742520),Ut=on(Ut,Qt=Wt(Qt,tn,bn,Ut,ln[Yt+2],23,-995338651),tn,bn,ln[Yt+0],6,-198630844),bn=on(bn,Ut,Qt,tn,ln[Yt+7],10,1126891415),tn=on(tn,bn,Ut,Qt,ln[Yt+14],15,-1416354905),Qt=on(Qt,tn,bn,Ut,ln[Yt+5],21,-57434055),Ut=on(Ut,Qt,tn,bn,ln[Yt+12],6,1700485571),bn=on(bn,Ut,Qt,tn,ln[Yt+3],10,-1894986606),tn=on(tn,bn,Ut,Qt,ln[Yt+10],15,-1051523),Qt=on(Qt,tn,bn,Ut,ln[Yt+1],21,-2054922799),Ut=on(Ut,Qt,tn,bn,ln[Yt+8],6,1873313359),bn=on(bn,Ut,Qt,tn,ln[Yt+15],10,-30611744),tn=on(tn,bn,Ut,Qt,ln[Yt+6],15,-1560198380),Qt=on(Qt,tn,bn,Ut,ln[Yt+13],21,1309151649),Ut=on(Ut,Qt,tn,bn,ln[Yt+4],6,-145523070),bn=on(bn,Ut,Qt,tn,ln[Yt+11],10,-1120210379),tn=on(tn,bn,Ut,Qt,ln[Yt+2],15,718787259),Qt=on(Qt,tn,bn,Ut,ln[Yt+9],21,-343485551),Ut=gn(Ut,en),Qt=gn(Qt,un),tn=gn(tn,yn),bn=gn(bn,zn)}return Array(Ut,Qt,tn,bn)}function Gt(ln,_n,Ut,Qt,tn,bn){return gn((Yt=gn(gn(_n,ln),gn(Qt,bn)))<<(en=tn)|Yt>>>32-en,Ut);var Yt,en}function vn(ln,_n,Ut,Qt,tn,bn,Yt){return Gt(_n&Ut|~_n&Qt,ln,_n,tn,bn,Yt)}function nn(ln,_n,Ut,Qt,tn,bn,Yt){return Gt(_n&Qt|Ut&~Qt,ln,_n,tn,bn,Yt)}function Wt(ln,_n,Ut,Qt,tn,bn,Yt){return Gt(_n^Ut^Qt,ln,_n,tn,bn,Yt)}function on(ln,_n,Ut,Qt,tn,bn,Yt){return Gt(Ut^(_n|~Qt),ln,_n,tn,bn,Yt)}function gn(ln,_n){var Ut=(65535&ln)+(65535&_n);return(ln>>16)+(_n>>16)+(Ut>>16)<<16|65535&Ut}g.exports=function(ln){return jt.hash(ln,sn,16)}}).call(this,b("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},b("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(b,g,tt){(function(ot,ut,gt,xt,It,kt,Ft,Xt,qt){var jt;jt=function(sn){for(var Gt,vn=new Array(sn),nn=0;nn<sn;nn++)!(3&nn)&&(Gt=4294967296*Math.random()),vn[nn]=Gt>>>((3&nn)<<3)&255;return vn},g.exports=jt}).call(this,b("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},b("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(b,g,tt){(function(ot,ut,gt,xt,It,kt,Ft,Xt,qt){var jt=b("./helpers");function sn(nn,Wt){nn[Wt>>5]|=128<<24-Wt%32,nn[15+(Wt+64>>9<<4)]=Wt;for(var on,gn,ln,_n,Ut,Qt=Array(80),tn=1732584193,bn=-271733879,Yt=-1732584194,en=271733878,un=-1009589776,yn=0;yn<nn.length;yn+=16){for(var zn=tn,Yn=bn,tr=Yt,Un=en,Jn=un,hn=0;hn<80;hn++){Qt[hn]=hn<16?nn[yn+hn]:vn(Qt[hn-3]^Qt[hn-8]^Qt[hn-14]^Qt[hn-16],1);var rr=Gt(Gt(vn(tn,5),(ln=bn,_n=Yt,Ut=en,(gn=hn)<20?ln&_n|~ln&Ut:!(gn<40)&&gn<60?ln&_n|ln&Ut|_n&Ut:ln^_n^Ut)),Gt(Gt(un,Qt[hn]),(on=hn)<20?1518500249:on<40?1859775393:on<60?-1894007588:-899497514));un=en,en=Yt,Yt=vn(bn,30),bn=tn,tn=rr}tn=Gt(tn,zn),bn=Gt(bn,Yn),Yt=Gt(Yt,tr),en=Gt(en,Un),un=Gt(un,Jn)}return Array(tn,bn,Yt,en,un)}function Gt(nn,Wt){var on=(65535&nn)+(65535&Wt);return(nn>>16)+(Wt>>16)+(on>>16)<<16|65535&on}function vn(nn,Wt){return nn<<Wt|nn>>>32-Wt}g.exports=function(nn){return jt.hash(nn,sn,20,!0)}}).call(this,b("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},b("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(b,g,tt){(function(ot,ut,gt,xt,It,kt,Ft,Xt,qt){function jt(nn,Wt){var on=(65535&nn)+(65535&Wt);return(nn>>16)+(Wt>>16)+(on>>16)<<16|65535&on}function sn(nn,Wt){return nn>>>Wt|nn<<32-Wt}function Gt(nn,Wt){var on,gn,ln,_n,Ut,Qt,tn,bn,Yt,en,un=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),yn=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),zn=new Array(64);nn[Wt>>5]|=128<<24-Wt%32,nn[15+(Wt+64>>9<<4)]=Wt;for(var Yn,tr,Un,Jn,hn,rr,sr,br,Kn=0;Kn<nn.length;Kn+=16){on=yn[0],gn=yn[1],ln=yn[2],_n=yn[3],Ut=yn[4],Qt=yn[5],tn=yn[6],bn=yn[7];for(var dn=0;dn<64;dn++)zn[dn]=dn<16?nn[dn+Kn]:jt(jt(jt(sn(br=zn[dn-2],17)^sn(br,19)^br>>>10,zn[dn-7]),sn(sr=zn[dn-15],7)^sn(sr,18)^sr>>>3),zn[dn-16]),Yt=jt(jt(jt(jt(bn,sn(rr=Ut,6)^sn(rr,11)^sn(rr,25)),(hn=Ut)&Qt^~hn&tn),un[dn]),zn[dn]),en=jt(sn(Jn=on,2)^sn(Jn,13)^sn(Jn,22),(Yn=on)&(tr=gn)^Yn&(Un=ln)^tr&Un),bn=tn,tn=Qt,Qt=Ut,Ut=jt(_n,Yt),_n=ln,ln=gn,gn=on,on=jt(Yt,en);yn[0]=jt(on,yn[0]),yn[1]=jt(gn,yn[1]),yn[2]=jt(ln,yn[2]),yn[3]=jt(_n,yn[3]),yn[4]=jt(Ut,yn[4]),yn[5]=jt(Qt,yn[5]),yn[6]=jt(tn,yn[6]),yn[7]=jt(bn,yn[7])}return yn}var vn=b("./helpers");g.exports=function(nn){return vn.hash(nn,Gt,32,!0)}}).call(this,b("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},b("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(b,g,tt){(function(ot,ut,gt,xt,It,kt,Ft,Xt,qt){function jt(){}(ot=g.exports={}).nextTick=function(){var sn=typeof window<"u"&&window.setImmediate,Gt=typeof window<"u"&&window.postMessage&&window.addEventListener;if(sn)return function(nn){return window.setImmediate(nn)};if(Gt){var vn=[];return window.addEventListener("message",function(nn){var Wt=nn.source;Wt!==window&&Wt!==null||nn.data!=="process-tick"||(nn.stopPropagation(),0<vn.length&&vn.shift()())},!0),function(nn){vn.push(nn),window.postMessage("process-tick","*")}}return function(nn){setTimeout(nn,0)}}(),ot.title="browser",ot.browser=!0,ot.env={},ot.argv=[],ot.on=jt,ot.addListener=jt,ot.once=jt,ot.off=jt,ot.removeListener=jt,ot.removeAllListeners=jt,ot.emit=jt,ot.binding=function(sn){throw new Error("process.binding is not supported")},ot.cwd=function(){return"/"},ot.chdir=function(sn){throw new Error("process.chdir is not supported")}}).call(this,b("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},b("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(b,g,tt){(function(ot,ut,gt,xt,It,kt,Ft,Xt,qt){tt.read=function(jt,sn,Gt,vn,nn){var Wt,on,gn=8*nn-vn-1,ln=(1<<gn)-1,_n=ln>>1,Ut=-7,Qt=Gt?nn-1:0,tn=Gt?-1:1,bn=jt[sn+Qt];for(Qt+=tn,Wt=bn&(1<<-Ut)-1,bn>>=-Ut,Ut+=gn;0<Ut;Wt=256*Wt+jt[sn+Qt],Qt+=tn,Ut-=8);for(on=Wt&(1<<-Ut)-1,Wt>>=-Ut,Ut+=vn;0<Ut;on=256*on+jt[sn+Qt],Qt+=tn,Ut-=8);if(Wt===0)Wt=1-_n;else{if(Wt===ln)return on?NaN:1/0*(bn?-1:1);on+=Math.pow(2,vn),Wt-=_n}return(bn?-1:1)*on*Math.pow(2,Wt-vn)},tt.write=function(jt,sn,Gt,vn,nn,Wt){var on,gn,ln,_n=8*Wt-nn-1,Ut=(1<<_n)-1,Qt=Ut>>1,tn=nn===23?Math.pow(2,-24)-Math.pow(2,-77):0,bn=vn?0:Wt-1,Yt=vn?1:-1,en=sn<0||sn===0&&1/sn<0?1:0;for(sn=Math.abs(sn),isNaN(sn)||sn===1/0?(gn=isNaN(sn)?1:0,on=Ut):(on=Math.floor(Math.log(sn)/Math.LN2),sn*(ln=Math.pow(2,-on))<1&&(on--,ln*=2),2<=(sn+=1<=on+Qt?tn/ln:tn*Math.pow(2,1-Qt))*ln&&(on++,ln/=2),Ut<=on+Qt?(gn=0,on=Ut):1<=on+Qt?(gn=(sn*ln-1)*Math.pow(2,nn),on+=Qt):(gn=sn*Math.pow(2,Qt-1)*Math.pow(2,nn),on=0));8<=nn;jt[Gt+bn]=255&gn,bn+=Yt,gn/=256,nn-=8);for(on=on<<nn|gn,_n+=nn;0<_n;jt[Gt+bn]=255&on,bn+=Yt,on/=256,_n-=8);jt[Gt+bn-Yt]|=128*en}}).call(this,b("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},b("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function($){var b=function(){function g(Gt){return Ft(Gt,Xt(kt(qt(Gt.length),Gt),1/Gt.length))}function tt(Gt){return kt(jt(Gt),Gt)}function ot(Gt,vn){return Xt(Gt,vn?1/(Gt.length-1):1/Gt.length)}function ut(Gt){var vn=function(Wt){var on,gn=Math.pow(2,-52),ln=1e-64/gn,_n=0,Ut=0,Qt=0,tn=0,bn=0,Yt=sn(Wt),en=Yt.length,un=Yt[0].length;if(en<un)throw"Need more rows than columns";var yn=new Array(un),zn=new Array(un);for(Ut=0;Ut<un;Ut++)yn[Ut]=zn[Ut]=0;var Yn=function Rr(cr,Hr,xs){xs===void 0&&(xs=0);var Ys,ls=cr[xs],oo=Array(ls);if(xs===cr.length-1){for(Ys=ls-2;Ys>=0;Ys-=2)oo[Ys+1]=Hr,oo[Ys]=Hr;return Ys===-1&&(oo[0]=Hr),oo}for(Ys=ls-1;Ys>=0;Ys--)oo[Ys]=Rr(cr,Hr,xs+1);return oo}([un,un],0);function tr(Rr,cr){return(Rr=Math.abs(Rr))>(cr=Math.abs(cr))?Rr*Math.sqrt(1+cr*cr/Rr/Rr):cr==0?Rr:cr*Math.sqrt(1+Rr*Rr/cr/cr)}var Un=0,Jn=0,hn=0,rr=0,sr=0,br=0,Kn=0;for(Ut=0;Ut<un;Ut++){for(yn[Ut]=Jn,Kn=0,bn=Ut+1,Qt=Ut;Qt<en;Qt++)Kn+=Yt[Qt][Ut]*Yt[Qt][Ut];if(Kn<=ln)Jn=0;else for(Un=Yt[Ut][Ut],Jn=Math.sqrt(Kn),Un>=0&&(Jn=-Jn),hn=Un*Jn-Kn,Yt[Ut][Ut]=Un-Jn,Qt=bn;Qt<un;Qt++){for(Kn=0,tn=Ut;tn<en;tn++)Kn+=Yt[tn][Ut]*Yt[tn][Qt];for(Un=Kn/hn,tn=Ut;tn<en;tn++)Yt[tn][Qt]+=Un*Yt[tn][Ut]}for(zn[Ut]=Jn,Kn=0,Qt=bn;Qt<un;Qt++)Kn+=Yt[Ut][Qt]*Yt[Ut][Qt];if(Kn<=ln)Jn=0;else{for(Un=Yt[Ut][Ut+1],Jn=Math.sqrt(Kn),Un>=0&&(Jn=-Jn),hn=Un*Jn-Kn,Yt[Ut][Ut+1]=Un-Jn,Qt=bn;Qt<un;Qt++)yn[Qt]=Yt[Ut][Qt]/hn;for(Qt=bn;Qt<en;Qt++){for(Kn=0,tn=bn;tn<un;tn++)Kn+=Yt[Qt][tn]*Yt[Ut][tn];for(tn=bn;tn<un;tn++)Yt[Qt][tn]+=Kn*yn[tn]}}(sr=Math.abs(zn[Ut])+Math.abs(yn[Ut]))>rr&&(rr=sr)}for(Ut=un-1;Ut!=-1;Ut+=-1){if(Jn!=0){for(hn=Jn*Yt[Ut][Ut+1],Qt=bn;Qt<un;Qt++)Yn[Qt][Ut]=Yt[Ut][Qt]/hn;for(Qt=bn;Qt<un;Qt++){for(Kn=0,tn=bn;tn<un;tn++)Kn+=Yt[Ut][tn]*Yn[tn][Qt];for(tn=bn;tn<un;tn++)Yn[tn][Qt]+=Kn*Yn[tn][Ut]}}for(Qt=bn;Qt<un;Qt++)Yn[Ut][Qt]=0,Yn[Qt][Ut]=0;Yn[Ut][Ut]=1,Jn=yn[Ut],bn=Ut}for(Ut=un-1;Ut!=-1;Ut+=-1){for(bn=Ut+1,Jn=zn[Ut],Qt=bn;Qt<un;Qt++)Yt[Ut][Qt]=0;if(Jn!=0){for(hn=Yt[Ut][Ut]*Jn,Qt=bn;Qt<un;Qt++){for(Kn=0,tn=bn;tn<en;tn++)Kn+=Yt[tn][Ut]*Yt[tn][Qt];for(Un=Kn/hn,tn=Ut;tn<en;tn++)Yt[tn][Qt]+=Un*Yt[tn][Ut]}for(Qt=Ut;Qt<en;Qt++)Yt[Qt][Ut]=Yt[Qt][Ut]/Jn}else for(Qt=Ut;Qt<en;Qt++)Yt[Qt][Ut]=0;Yt[Ut][Ut]+=1}for(gn*=rr,tn=un-1;tn!=-1;tn+=-1)for(var dn=0;dn<50;dn++){var kn=!1;for(bn=tn;bn!=-1;bn+=-1){if(Math.abs(yn[bn])<=gn){kn=!0;break}if(Math.abs(zn[bn-1])<=gn)break}if(!kn){_n=0,Kn=1;var Vn=bn-1;for(Ut=bn;Ut<tn+1&&(Un=Kn*yn[Ut],yn[Ut]=_n*yn[Ut],!(Math.abs(Un)<=gn));Ut++)for(hn=tr(Un,Jn=zn[Ut]),zn[Ut]=hn,_n=Jn/hn,Kn=-Un/hn,Qt=0;Qt<en;Qt++)sr=Yt[Qt][Vn],br=Yt[Qt][Ut],Yt[Qt][Vn]=sr*_n+br*Kn,Yt[Qt][Ut]=-sr*Kn+br*_n}if(br=zn[tn],bn==tn){if(br<0)for(zn[tn]=-br,Qt=0;Qt<un;Qt++)Yn[Qt][tn]=-Yn[Qt][tn];break}if(dn>=49)throw"Error: no convergence.";for(rr=zn[bn],Jn=tr(Un=(((sr=zn[tn-1])-br)*(sr+br)+((Jn=yn[tn-1])-(hn=yn[tn]))*(Jn+hn))/(2*hn*sr),1),Un=Un<0?((rr-br)*(rr+br)+hn*(sr/(Un-Jn)-hn))/rr:((rr-br)*(rr+br)+hn*(sr/(Un+Jn)-hn))/rr,_n=1,Kn=1,Ut=bn+1;Ut<tn+1;Ut++){for(Jn=yn[Ut],sr=zn[Ut],hn=Kn*Jn,Jn*=_n,br=tr(Un,hn),yn[Ut-1]=br,Un=rr*(_n=Un/br)+Jn*(Kn=hn/br),Jn=-rr*Kn+Jn*_n,hn=sr*Kn,sr*=_n,Qt=0;Qt<un;Qt++)rr=Yn[Qt][Ut-1],br=Yn[Qt][Ut],Yn[Qt][Ut-1]=rr*_n+br*Kn,Yn[Qt][Ut]=-rr*Kn+br*_n;for(br=tr(Un,hn),zn[Ut-1]=br,Un=(_n=Un/br)*Jn+(Kn=hn/br)*sr,rr=-Kn*Jn+_n*sr,Qt=0;Qt<en;Qt++)sr=Yt[Qt][Ut-1],br=Yt[Qt][Ut],Yt[Qt][Ut-1]=sr*_n+br*Kn,Yt[Qt][Ut]=-sr*Kn+br*_n}yn[bn]=0,yn[tn]=Un,zn[tn]=rr}for(Ut=0;Ut<zn.length;Ut++)zn[Ut]<gn&&(zn[Ut]=0);for(Ut=0;Ut<un;Ut++)for(Qt=Ut-1;Qt>=0;Qt--)if(zn[Qt]<zn[Ut]){for(_n=zn[Qt],zn[Qt]=zn[Ut],zn[Ut]=_n,tn=0;tn<Yt.length;tn++)on=Yt[tn][Ut],Yt[tn][Ut]=Yt[tn][Qt],Yt[tn][Qt]=on;for(tn=0;tn<Yn.length;tn++)on=Yn[tn][Ut],Yn[tn][Ut]=Yn[tn][Qt],Yn[tn][Qt]=on;Ut=Qt}return{U:Yt,S:zn,V:Yn}}(Gt);console.log(vn);var nn=vn.U;return vn.S.map(function(Wt,on){var gn={};return gn.eigenvalue=Wt,gn.vector=nn.map(function(ln,_n){return-1*ln[on]}),gn})}function gt(Gt,...vn){var nn=vn.map(function(gn){return gn.vector}),Wt=kt(nn,jt(g(Gt))),on=Xt(kt(qt(Gt.length),Gt),-1/Gt.length);return{adjustedData:Wt,formattedAdjustedData:It(Wt,2),avgData:on,selectedVectors:nn}}function xt(Gt){return ut(ot(tt(g(Gt)),!1))}function It(Gt,vn){var nn=Math.pow(10,vn||2);return Gt.map(function(Wt,on){return Wt.map(function(gn){return Math.round(gn*nn)/nn})})}function kt(Gt,vn){if(!(Gt[0]&&vn[0]&&Gt.length&&vn.length))throw new Error("Both A and B should be matrices");if(vn.length!==Gt[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var nn=[],Wt=0;Wt<Gt.length;Wt++){nn[Wt]=[];for(var on=0;on<vn[0].length;on++)for(var gn=0;gn<Gt[0].length;gn++)nn[Wt][on]=nn[Wt][on]?nn[Wt][on]+Gt[Wt][gn]*vn[gn][on]:Gt[Wt][gn]*vn[gn][on]}return nn}function Ft(Gt,vn){if(Gt.length!==vn.length||Gt[0].length!==vn[0].length)throw new Error("Both A and B should have the same dimensions");for(var nn=[],Wt=0;Wt<Gt.length;Wt++){nn[Wt]=[];for(var on=0;on<vn[0].length;on++)nn[Wt][on]=Gt[Wt][on]-vn[Wt][on]}return nn}function Xt(Gt,vn){for(var nn=[],Wt=0;Wt<Gt.length;Wt++){nn[Wt]=[];for(var on=0;on<Gt[0].length;on++)nn[Wt][on]=Gt[Wt][on]*vn}return nn}function qt(Gt){for(var vn=[],nn=0;nn<Gt;nn++){vn[nn]=[];for(var Wt=0;Wt<Gt;Wt++)vn[nn][Wt]=1}return vn}function jt(Gt){return sn(Gt)[0].map(function(vn,nn){return Gt.map(function(Wt){return Wt[nn]})})}function sn(Gt){var vn=JSON.stringify(Gt);return JSON.parse(vn)}return{computeDeviationScores:tt,computeDeviationMatrix:g,computeSVD:ut,computePercentageExplained:function(Gt,...vn){var nn=Gt.map(function(Wt){return Wt.eigenvalue}).reduce(function(Wt,on){return Wt+on});return vn.map(function(Wt){return Wt.eigenvalue}).reduce(function(Wt,on){return Wt+on})/nn},computeOriginalData:function(Gt,vn,nn){var Wt=Ft(jt(kt(jt(vn),Gt)),nn);return{originalData:Wt,formattedOriginalData:It(Wt,2)}},computeVarianceCovariance:ot,computeAdjustedData:gt,getEigenVectors:xt,analyseTopResult:function(Gt){var vn=xt(Gt).sort(function(nn,Wt){return Wt.eigenvalue-nn.eigenvalue});return console.log("Sorted Vectors",vn),gt(Gt,vn[0].vector)},transpose:jt,multiply:kt,clone:sn,scale:Xt}}();$.exports=b},701:function($){var b=[];function g(ut){for(var gt=-1,xt=0;xt<b.length;xt++)if(b[xt].identifier===ut){gt=xt;break}return gt}function tt(ut,gt){for(var xt={},It=[],kt=0;kt<ut.length;kt++){var Ft=ut[kt],Xt=gt.base?Ft[0]+gt.base:Ft[0],qt=xt[Xt]||0,jt="".concat(Xt," ").concat(qt);xt[Xt]=qt+1;var sn=g(jt),Gt={css:Ft[1],media:Ft[2],sourceMap:Ft[3],supports:Ft[4],layer:Ft[5]};if(sn!==-1)b[sn].references++,b[sn].updater(Gt);else{var vn=ot(Gt,gt);gt.byIndex=kt,b.splice(kt,0,{identifier:jt,updater:vn,references:1})}It.push(jt)}return It}function ot(ut,gt){var xt=gt.domAPI(gt);return xt.update(ut),function(It){if(It){if(It.css===ut.css&&It.media===ut.media&&It.sourceMap===ut.sourceMap&&It.supports===ut.supports&&It.layer===ut.layer)return;xt.update(ut=It)}else xt.remove()}}$.exports=function(ut,gt){var xt=tt(ut=ut||[],gt=gt||{});return function(It){It=It||[];for(var kt=0;kt<xt.length;kt++){var Ft=g(xt[kt]);b[Ft].references--}for(var Xt=tt(It,gt),qt=0;qt<xt.length;qt++){var jt=g(xt[qt]);b[jt].references===0&&(b[jt].updater(),b.splice(jt,1))}xt=Xt}}},182:function($){$.exports=function(b){var g=document.createElement("style");return b.setAttributes(g,b.attributes),b.insert(g,b.options),g}},850:function($,b,g){$.exports=function(tt){var ot=g.nc;ot&&tt.setAttribute("nonce",ot)}},236:function($){$.exports=function(b){var g=b.insertStyleElement(b);return{update:function(tt){(function(ot,ut,gt){var xt="";gt.supports&&(xt+="@supports (".concat(gt.supports,") {")),gt.media&&(xt+="@media ".concat(gt.media," {"));var It=gt.layer!==void 0;It&&(xt+="@layer".concat(gt.layer.length>0?" ".concat(gt.layer):""," {")),xt+=gt.css,It&&(xt+="}"),gt.media&&(xt+="}"),gt.supports&&(xt+="}");var kt=gt.sourceMap;kt&&typeof btoa<"u"&&(xt+=`
/`,xt+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(kt))))," *"),xt+="/"),ut.styleTagTransform(xt,ot,ut.options)})(g,b,tt)},remove:function(){(function(tt){if(tt.parentNode===null)return!1;tt.parentNode.removeChild(tt)})(g)}}}},213:function($){$.exports=function(b,g){if(g.styleSheet)g.styleSheet.cssText=b;else{for(;g.firstChild;)g.removeChild(g.firstChild);g.appendChild(document.createTextNode(b))}}},1:function($){$.exports=function(){var b={820:function(ut,gt,xt){var It=xt(537),kt=xt.n(It),Ft=xt(645),Xt=xt.n(Ft)()(kt());Xt.push([ut.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),gt.Z=Xt},645:function(ut){ut.exports=function(gt){var xt=[];return xt.toString=function(){return this.map(function(It){var kt="",Ft=It[5]!==void 0;return It[4]&&(kt+="@supports (".concat(It[4],") {")),It[2]&&(kt+="@media ".concat(It[2]," {")),Ft&&(kt+="@layer".concat(It[5].length>0?" ".concat(It[5]):""," {")),kt+=gt(It),Ft&&(kt+="}"),It[2]&&(kt+="}"),It[4]&&(kt+="}"),kt}).join("")},xt.i=function(It,kt,Ft,Xt,qt){typeof It=="string"&&(It=[[null,It,void 0]]);var jt={};if(Ft)for(var sn=0;sn<this.length;sn++){var Gt=this[sn][0];Gt!=null&&(jt[Gt]=!0)}for(var vn=0;vn<It.length;vn++){var nn=[].concat(It[vn]);Ft&&jt[nn[0]]||(qt!==void 0&&(nn[5]===void 0||(nn[1]="@layer".concat(nn[5].length>0?" ".concat(nn[5]):""," {").concat(nn[1],"}")),nn[5]=qt),kt&&(nn[2]&&(nn[1]="@media ".concat(nn[2]," {").concat(nn[1],"}")),nn[2]=kt),Xt&&(nn[4]?(nn[1]="@supports (".concat(nn[4],") {").concat(nn[1],"}"),nn[4]=Xt):nn[4]="".concat(Xt)),xt.push(nn))}},xt}},537:function(ut){ut.exports=function(gt){var xt=gt[1],It=gt[3];if(!It)return xt;if(typeof btoa=="function"){var kt=btoa(unescape(encodeURIComponent(JSON.stringify(It)))),Ft="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(kt),Xt="/*# ".concat(Ft," */"),qt=It.sources.map(function(jt){return"/*# sourceURL=".concat(It.sourceRoot||"").concat(jt," */")});return[xt].concat(qt).concat([Xt]).join(`
`)}return[xt].join(`
`)}},379:function(ut){var gt=[];function xt(Ft){for(var Xt=-1,qt=0;qt<gt.length;qt++)if(gt[qt].identifier===Ft){Xt=qt;break}return Xt}function It(Ft,Xt){for(var qt={},jt=[],sn=0;sn<Ft.length;sn++){var Gt=Ft[sn],vn=Xt.base?Gt[0]+Xt.base:Gt[0],nn=qt[vn]||0,Wt="".concat(vn," ").concat(nn);qt[vn]=nn+1;var on=xt(Wt),gn={css:Gt[1],media:Gt[2],sourceMap:Gt[3],supports:Gt[4],layer:Gt[5]};if(on!==-1)gt[on].references++,gt[on].updater(gn);else{var ln=kt(gn,Xt);Xt.byIndex=sn,gt.splice(sn,0,{identifier:Wt,updater:ln,references:1})}jt.push(Wt)}return jt}function kt(Ft,Xt){var qt=Xt.domAPI(Xt);return qt.update(Ft),function(jt){if(jt){if(jt.css===Ft.css&&jt.media===Ft.media&&jt.sourceMap===Ft.sourceMap&&jt.supports===Ft.supports&&jt.layer===Ft.layer)return;qt.update(Ft=jt)}else qt.remove()}}ut.exports=function(Ft,Xt){var qt=It(Ft=Ft||[],Xt=Xt||{});return function(jt){jt=jt||[];for(var sn=0;sn<qt.length;sn++){var Gt=xt(qt[sn]);gt[Gt].references--}for(var vn=It(jt,Xt),nn=0;nn<qt.length;nn++){var Wt=xt(qt[nn]);gt[Wt].references===0&&(gt[Wt].updater(),gt.splice(Wt,1))}qt=vn}}},216:function(ut){ut.exports=function(gt){var xt=document.createElement("style");return gt.setAttributes(xt,gt.attributes),gt.insert(xt,gt.options),xt}},636:function(ut,gt,xt){ut.exports=function(It){var kt=xt.nc;kt&&It.setAttribute("nonce",kt)}},795:function(ut){ut.exports=function(gt){var xt=gt.insertStyleElement(gt);return{update:function(It){(function(kt,Ft,Xt){var qt="";Xt.supports&&(qt+="@supports (".concat(Xt.supports,") {")),Xt.media&&(qt+="@media ".concat(Xt.media," {"));var jt=Xt.layer!==void 0;jt&&(qt+="@layer".concat(Xt.layer.length>0?" ".concat(Xt.layer):""," {")),qt+=Xt.css,jt&&(qt+="}"),Xt.media&&(qt+="}"),Xt.supports&&(qt+="}");var sn=Xt.sourceMap;sn&&typeof btoa<"u"&&(qt+=`
/`,qt+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sn))))," *"),qt+="/"),Ft.styleTagTransform(qt,kt,Ft.options)})(xt,gt,It)},remove:function(){(function(It){if(It.parentNode===null)return!1;It.parentNode.removeChild(It)})(xt)}}}},589:function(ut){ut.exports=function(gt,xt){if(xt.styleSheet)xt.styleSheet.cssText=gt;else{for(;xt.firstChild;)xt.removeChild(xt.firstChild);xt.appendChild(document.createTextNode(gt))}}}},g={};function tt(ut){var gt=g[ut];if(gt!==void 0)return gt.exports;var xt=g[ut]={id:ut,exports:{}};return b[ut](xt,xt.exports,tt),xt.exports}tt.n=function(ut){var gt=ut&&ut.__esModule?function(){return ut.default}:function(){return ut};return tt.d(gt,{a:gt}),gt},tt.d=function(ut,gt){for(var xt in gt)tt.o(gt,xt)&&!tt.o(ut,xt)&&Object.defineProperty(ut,xt,{enumerable:!0,get:gt[xt]})},tt.o=function(ut,gt){return Object.prototype.hasOwnProperty.call(ut,gt)},tt.nc=void 0;var ot={};return function(){tt.d(ot,{default:function(){return zn}});var ut=tt(379),gt=tt.n(ut),xt=tt(795),It=tt.n(xt),kt=tt(636),Ft=tt.n(kt),Xt=tt(216),qt=tt.n(Xt),jt=tt(589),sn=tt.n(jt),Gt=tt(820),vn={};Gt.Z&&Gt.Z.locals&&(vn.locals=Gt.Z.locals);var nn,Wt=0,on={};on.styleTagTransform=sn(),on.setAttributes=Ft(),on.insert=function(Yn,tr){(tr.target||document.head).appendChild(Yn)},on.domAPI=It(),on.insertStyleElement=qt(),vn.use=function(Yn){return on.options=Yn||{},Wt++||(nn=gt()(Gt.Z,on)),vn},vn.unuse=function(){Wt>0&&!--Wt&&(nn(),nn=null)};var gn=vn;function ln(Yn,tr){return function(Un){if(Array.isArray(Un))return Un}(Yn)||function(Un,Jn){var hn=Un==null?null:typeof Symbol<"u"&&Un[Symbol.iterator]||Un["@@iterator"];if(hn!=null){var rr,sr,br=[],Kn=!0,dn=!1;try{for(hn=hn.call(Un);!(Kn=(rr=hn.next()).done)&&(br.push(rr.value),!Jn||br.length!==Jn);Kn=!0);}catch(kn){dn=!0,sr=kn}finally{try{Kn||hn.return==null||hn.return()}finally{if(dn)throw sr}}return br}}(Yn,tr)||function(Un,Jn){if(Un){if(typeof Un=="string")return _n(Un,Jn);var hn=Object.prototype.toString.call(Un).slice(8,-1);return hn==="Object"&&Un.constructor&&(hn=Un.constructor.name),hn==="Map"||hn==="Set"?Array.from(Un):hn==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(hn)?_n(Un,Jn):void 0}}(Yn,tr)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function _n(Yn,tr){(tr==null||tr>Yn.length)&&(tr=Yn.length);for(var Un=0,Jn=new Array(tr);Un<tr;Un++)Jn[Un]=Yn[Un];return Jn}function Ut(Yn,tr){var Un=Object.keys(Yn);if(Object.getOwnPropertySymbols){var Jn=Object.getOwnPropertySymbols(Yn);tr&&(Jn=Jn.filter(function(hn){return Object.getOwnPropertyDescriptor(Yn,hn).enumerable})),Un.push.apply(Un,Jn)}return Un}function Qt(Yn){for(var tr=1;tr<arguments.length;tr++){var Un=arguments[tr]!=null?arguments[tr]:{};tr%2?Ut(Object(Un),!0).forEach(function(Jn){tn(Yn,Jn,Un[Jn])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Yn,Object.getOwnPropertyDescriptors(Un)):Ut(Object(Un)).forEach(function(Jn){Object.defineProperty(Yn,Jn,Object.getOwnPropertyDescriptor(Un,Jn))})}return Yn}function tn(Yn,tr,Un){return tr in Yn?Object.defineProperty(Yn,tr,{value:Un,enumerable:!0,configurable:!0,writable:!0}):Yn[tr]=Un,Yn}function bn(Yn,tr){for(var Un=0;Un<tr.length;Un++){var Jn=tr[Un];Jn.enumerable=Jn.enumerable||!1,Jn.configurable=!0,"value"in Jn&&(Jn.writable=!0),Object.defineProperty(Yn,Jn.key,Jn)}}function Yt(Yn){var tr={};return Yn.reduce(function(Un,Jn){return tr[Jn]||(tr[Jn]=!0,Un.push(Jn)),Un},[])}function en(Yn,tr){requestAnimationFrame(function(){tr.enter(),requestAnimationFrame(function(){tr.active(),setTimeout(function(){tr.leave()},Yn)})})}function un(Yn,tr){try{var Un=Yn.liElementsById[tr.parent.id];Un.classList.contains("treejs-node__close")||Un.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(tr,"parent")&&un(Yn,tr.parent)}function yn(Yn,tr){var Un=Yn.liElementsById[tr.id];Un.classList.contains("treejs-node__close")&&Un.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(tr,"children")&&tr.children.forEach(function(Jn){return yn(Yn,Jn)})}var zn=function(){function Yn(hn,rr){(function(sr,br){if(!(sr instanceof br))throw new TypeError("Cannot call a class as a function")})(this,Yn),gn.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=hn,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},rr),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(sr){this.setValues(Yt(sr))}},disables:{get:function(){return this.getDisables()},set:function(sr){this.setDisables(Yt(sr))}},selectedNodes:{get:function(){var sr=[],br=this.nodesById;return Object.keys(br).forEach(function(Kn){if(Object.prototype.hasOwnProperty.call(br,Kn)&&(br[Kn].status===1||br[Kn].status===2)){var dn=Qt({},br[Kn]);delete dn.parent,delete dn.children,sr.push(dn)}}),sr}},disabledNodes:{get:function(){var sr=[],br=this.nodesById;return Object.keys(br).forEach(function(Kn){if(Object.prototype.hasOwnProperty.call(br,Kn)&&br[Kn].disabled){var dn=Qt({},br[Kn]);delete dn.parent,sr.push(dn)}}),sr}}}),this.init(this.options.data)}var tr,Un,Jn;return tr=Yn,Jn=[{key:"onSwitcherClick",value:function(hn){var rr=hn.parentNode,sr=rr.lastChild,br=sr.scrollHeight;rr.classList.contains("treejs-node__close")?en(150,{enter:function(){sr.style.height=0,sr.style.opacity=0},active:function(){sr.style.height="".concat(br,"px"),sr.style.opacity=1},leave:function(){sr.style.height="",sr.style.opacity="",rr.classList.remove("treejs-node__close")}}):en(150,{enter:function(){sr.style.height="".concat(br,"px"),sr.style.opacity=1},active:function(){sr.style.height=0,sr.style.opacity=0},leave:function(){sr.style.height="",sr.style.opacity="",rr.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(hn){var rr,sr=(rr=hn,JSON.parse(JSON.stringify(rr))),br={},Kn={},dn=[],kn=[];return function Vn(Rr,cr){Rr.forEach(function(Hr){br[Hr.id]=Hr,Hr.checked&&dn.push(Hr.id),Hr.disabled&&kn.push(Hr.id),cr&&(Hr.parent=cr),Hr.children&&Hr.children.length?Vn(Hr.children,Hr):Kn[Hr.id]=Hr})}(sr),{treeNodes:sr,nodesById:br,leafNodesById:Kn,defaultValues:dn,defaultDisables:kn}}},{key:"createRootEle",value:function(){var hn=document.createElement("div");return hn.classList.add("treejs"),hn}},{key:"createUlEle",value:function(){var hn=document.createElement("ul");return hn.classList.add("treejs-nodes"),hn}},{key:"createLiEle",value:function(hn,rr){var sr=document.createElement("li");if(sr.classList.add("treejs-node"),rr&&sr.classList.add("treejs-node__close"),hn.children&&hn.children.length){var br=document.createElement("span");br.classList.add("treejs-switcher"),sr.appendChild(br)}else sr.classList.add("treejs-placeholder");var Kn=document.createElement("span");Kn.classList.add("treejs-checkbox"),sr.appendChild(Kn);var dn=document.createElement("span");dn.classList.add("treejs-label");var kn=document.createTextNode(hn.text);return dn.appendChild(kn),sr.appendChild(dn),sr.nodeId=hn.id,sr}}],(Un=[{key:"init",value:function(hn){var rr=Yn.parseTreeData(hn),sr=rr.treeNodes,br=rr.nodesById,Kn=rr.leafNodesById,dn=rr.defaultValues,kn=rr.defaultDisables;this.treeNodes=sr,this.nodesById=br,this.leafNodesById=Kn,this.render(this.treeNodes);var Vn=this.options,Rr=Vn.values,cr=Vn.disables,Hr=Vn.loaded;Rr&&Rr.length?this.setValues(Rr):dn&&dn.length&&this.setValues(dn),cr&&cr.length?this.setDisables(cr):kn&&kn.length&&this.setDisables(kn),typeof Hr=="function"&&Hr.call(this)}},{key:"render",value:function(hn){var rr=Yn.createRootEle();rr.appendChild(this.buildTree(hn,0)),this.bindEvent(rr);var sr=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(br){for(;br.firstChild;)br.removeChild(br.firstChild)})(sr),sr.appendChild(rr)}},{key:"buildTree",value:function(hn,rr){var sr=this,br=Yn.createUlEle();return hn&&hn.length&&hn.forEach(function(Kn){var dn=Yn.createLiEle(Kn,rr===sr.options.closeDepth-1);sr.liElementsById[Kn.id]=dn;var kn=null;Kn.children&&Kn.children.length&&(kn=sr.buildTree(Kn.children,rr+1)),kn&&dn.appendChild(kn),br.appendChild(dn)}),br}},{key:"bindEvent",value:function(hn){var rr=this;hn.addEventListener("click",function(sr){var br=sr.target;br.nodeName==="SPAN"&&br.classList.contains("treejs-checkbox")?rr.onItemClick(br.parentNode.nodeId):br.nodeName==="SPAN"&&br.classList.contains("treejs-label")?rr.onItemLabelClick(br.parentNode.nodeId):br.nodeName==="LI"&&br.classList.contains("treejs-node")?rr.onItemClick(br.nodeId):br.nodeName==="SPAN"&&br.classList.contains("treejs-switcher")&&Yn.onSwitcherClick(br)},!1)}},{key:"onItemClick",value:function(hn){var rr=this.nodesById[hn],sr=this.options.onChange;rr.disabled||(this.setValue(hn),this.updateLiElements()),sr&&sr.call(this)}},{key:"onItemLabelClick",value:function(hn){var rr=this.options.onItemLabelClick;rr&&rr.call(this,hn)}},{key:"setValue",value:function(hn){var rr=this.nodesById[hn];if(rr){var sr=rr.status,br=sr===1||sr===2?0:2;rr.status=br,this.markWillUpdateNode(rr),this.walkUp(rr,"status"),this.walkDown(rr,"status")}}},{key:"getValues",value:function(){var hn=this,rr=[];return Object.keys(this.leafNodesById).forEach(function(sr){Object.prototype.hasOwnProperty.call(hn.leafNodesById,sr)&&(hn.leafNodesById[sr].status!==1&&hn.leafNodesById[sr].status!==2||rr.push(sr))}),rr}},{key:"setValues",value:function(hn){var rr=this;this.emptyNodesCheckStatus(),hn.forEach(function(br){rr.setValue(br)}),this.updateLiElements();var sr=this.options.onChange;sr&&sr.call(this)}},{key:"setDisable",value:function(hn){var rr=this.nodesById[hn];rr&&(rr.disabled||(rr.disabled=!0,this.markWillUpdateNode(rr),this.walkUp(rr,"disabled"),this.walkDown(rr,"disabled")))}},{key:"getDisables",value:function(){var hn=this,rr=[];return Object.keys(this.leafNodesById).forEach(function(sr){Object.prototype.hasOwnProperty.call(hn.leafNodesById,sr)&&hn.leafNodesById[sr].disabled&&rr.push(sr)}),rr}},{key:"setDisables",value:function(hn){var rr=this;this.emptyNodesDisable(),hn.forEach(function(sr){rr.setDisable(sr)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(hn){hn.disabled||(hn.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(hn){hn.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(hn,rr){var sr=ln(rr,2),br=sr[0],Kn=sr[1];return Kn.status!==1&&Kn.status!==2||(hn[br]=Kn),hn},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(hn,rr){var sr=ln(rr,2),br=sr[0],Kn=sr[1];return Kn.disabled&&(hn[br]=Kn),hn},{})}},{key:"updateLiElements",value:function(){var hn=this;Object.values(this.willUpdateNodesById).forEach(function(rr){hn.updateLiElement(rr)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(hn){this.willUpdateNodesById[hn.id]=hn}},{key:"walkUp",value:function(hn,rr){var sr=hn.parent;if(sr){if(rr==="status"){var br,Kn=sr.children.reduce(function(kn,Vn){return Number.isNaN(Vn.status)?kn:kn+Vn.status},0);if(br=Kn?Kn===2*sr.children.length?2:1:0,sr.status===br)return;sr.status=br}else{var dn=sr.children.reduce(function(kn,Vn){return kn&&Vn.disabled},!0);if(sr.disabled===dn)return;sr.disabled=dn}this.markWillUpdateNode(sr),this.walkUp(sr,rr)}}},{key:"walkDown",value:function(hn,rr){var sr=this;hn.children&&hn.children.length&&hn.children.forEach(function(br){rr==="status"&&br.disabled||(br[rr]=hn[rr],sr.markWillUpdateNode(br),sr.walkDown(br,rr))})}},{key:"updateLiElement",value:function(hn){var rr=this.liElementsById[hn.id].classList;switch(hn.status){case 0:rr.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:rr.remove("treejs-node__checked"),rr.add("treejs-node__halfchecked");break;case 2:rr.remove("treejs-node__halfchecked"),rr.add("treejs-node__checked")}switch(hn.disabled){case!0:rr.contains("treejs-node__disabled")||rr.add("treejs-node__disabled");break;case!1:rr.contains("treejs-node__disabled")&&rr.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var hn=this;Object.keys(this.leafNodesById).forEach(function(rr){var sr=hn.leafNodesById[rr];un(hn,sr)})}},{key:"expandAll",value:function(){yn(this,this.treeNodes[0])}}])&&bn(tr.prototype,Un),Jn&&bn(tr,Jn),Object.defineProperty(tr,"prototype",{writable:!1}),Yn}()}(),ot.default}()},8:function($,b){(function(g){class tt{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(en,un){const yn=this._eventListeners;yn[en]===void 0&&(yn[en]=[]),yn[en].includes(un)||yn[en].push(un)}hasEventListener(en,un){const yn=this._eventListeners;return yn[en]!==void 0&&yn[en].includes(un)}removeEventListener(en,un){const yn=this._eventListeners[en];if(yn!==void 0){const zn=yn.indexOf(un);zn!==-1&&yn.splice(zn,1)}}dispatchEvent(en){const un=this._eventListeners[en.type];if(un!==void 0){en.target=this;const yn=un.slice(0);for(let zn=0,Yn=yn.length;zn<Yn;zn++)yn[zn].call(this,en)}}}function ot(){return(typeof performance>"u"?Date:performance).now()}class ut{constructor(en=ut.DECAY_MILLISECONDS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(en)}setDecayTime(en){this.naturalFrequency=1/Math.max(ut.MIN_DECAY_MILLISECONDS,en)}update(en,un,yn,zn){const Yn=2e-4*this.naturalFrequency;if(en==null||zn===0||en===un&&this.velocity===0)return un;if(yn<0)return en;const tr=en-un,Un=this.velocity+this.naturalFrequency*tr,Jn=tr+yn*Un,hn=Math.exp(-this.naturalFrequency*yn),rr=(Un-this.naturalFrequency*Jn)*hn,sr=-this.naturalFrequency*(rr+Un*hn);return Math.abs(rr)<Yn*Math.abs(zn)&&sr*tr>=0?(this.velocity=0,un):(this.velocity=rr,un+Jn*hn)}}async function gt(Yt){return new Promise((en,un)=>{const yn=new Image;yn.onload=()=>en(yn),yn.onerror=un,yn.crossOrigin="anonymous",yn.decoding="sync",yn.src=Yt})}function xt(Yt,en=document.head){const un=document.createElement("style");return un.type="text/css",un.innerText=Yt,en==null||en.appendChild(un),un}ut.SETTLING_TIME=1e4,ut.MIN_DECAY_MILLISECONDS=.001,ut.DECAY_MILLISECONDS=50;const It={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function kt(Yt){return Yt.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function Ft(Yt,en,un){return Yt.replace(new RegExp(kt(en),"g"),un)}const Xt=(Yt,...en)=>String.raw({raw:Yt},...en),qt=(Yt,...en)=>{let un=String.raw({raw:Yt},...en);return un=Ft(un,"%","%25"),un=Ft(un,"> <","><"),un=Ft(un,"; }",";}"),un=Ft(un,"<","%3c"),un=Ft(un,">","%3e"),un=Ft(un,'"',"'"),un=Ft(un,"#","%23"),un=Ft(un,"{","%7b"),un=Ft(un,"}","%7d"),un=Ft(un,"|","%7c"),un=Ft(un,"^","%5e"),un=Ft(un,"`","%60"),un=Ft(un,"@","%40"),un=Ft(un,"&","&amp;"),un=Ft(un,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+un};function jt(Yt,en){const un=window.URL.createObjectURL(Yt),yn=document.createElement("a");yn.style.display="none",yn.href=un,yn.download=en,document.body.appendChild(yn),yn.click(),setTimeout(()=>{document.body.removeChild(yn),window.URL.revokeObjectURL(un)},1e3)}async function sn(Yt){return new Promise((en,un)=>{const yn=new FileReader;yn.onload=zn=>en(yn.result),yn.onerror=zn=>un(yn.error),yn.onabort=zn=>un(new Error("Read aborted")),yn.readAsDataURL(Yt)})}function Gt(Yt,en){let un;do un=Object.getOwnPropertyDescriptor(Yt,en);while(!un&&(Yt=Object.getPrototypeOf(Yt)));return un}function vn(Yt,en,un=!0,yn=!1){const zn=Gt(Yt,en);return!!(zn!=null&&zn.set)||un&&(zn==null?void 0:zn.writable)!==!1&&(zn==null?void 0:zn.get)===void 0||yn&&!zn}function nn(Yt,en,un,yn=!0,zn=!1){return!(!Yt||!vn(Yt,en,yn,zn)||(Yt[en]=un,0))}function Wt(Yt,en){for(let un=Yt.length-1;un>=0;un--)if(en(Yt[un]))return un;return-1}const on={priority:1/0,serialize:(Yt,en)=>Object.fromEntries(Object.entries(Yt).map(([un,yn])=>[un,gn.Serialize(yn,en,!1)])),deserialize:(Yt,en,un)=>Object.assign(en||{},Object.fromEntries(Object.entries(Yt).map(([yn,zn])=>[yn,gn.Deserialize(zn,en==null?void 0:en[yn],un,!1)]))),isType:Yt=>(Yt.constructor||Object)===Object};class gn{static GetSerializer(en){return gn.Serializers.find(un=>un.isType(en))}static RegisterSerializer(...en){var un;for(const yn of en){const zn=(un=yn.priority)!==null&&un!==void 0?un:1e10,Yn=Wt(gn.Serializers,tr=>tr.priority!==void 0&&tr.priority<zn);Yn>=0?gn.Serializers.splice(Yn+1,0,yn):gn.Serializers.push(yn)}}static UnregisterSerializer(...en){for(const un of en){const yn=gn.Serializers.indexOf(un);yn>=0&&gn.Serializers.splice(yn,1)}}static Serialize(en,un,yn=!1){var zn,Yn;if(typeof en=="function")return;if(!yn){const Jn=gn.GetSerializer(en);if(Jn)return Jn.serialize(en,un);if(typeof en.toJSON=="function"){const hn=en.toJSON(un);return en.serializableClassId&&hn&&(hn.serializableClassId=en.serializableClassId),hn}}let tr=(zn=en.constructor)!==null&&zn!==void 0?zn:Object;const Un={};for(;tr&&tr!==Object;){const Jn=(Yn=gn.TypeMap.get(tr))!==null&&Yn!==void 0?Yn:[];for(const[hn,rr]of Jn)Un[hn]=gn.Serialize(en[rr],un,!1);tr=Object.getPrototypeOf(tr)}return en.serializableClassId&&(Un.serializableClassId=en.serializableClassId),Un}static Deserialize(en,un,yn,zn=!1){var Yn,tr;if(en===void 0||un===en)return un;if(en&&typeof en=="object"&&(en.constructor||Object)===Object&&en.resource&&typeof en.resource=="string"&&en.uuid){const Jn=yn==null?void 0:yn[en.resource];if(!Jn)return console.warn(`Resource ${en.resource} not found`),un;if(typeof(en=Jn[en.uuid])=="object"&&(en.__useCount=en.__useCount?en.__useCount+1:1),en||console.warn(`Resource ${en.resource} with uuid ${en.uuid} not found`),un===en)return un;if(en&&typeof en=="object"){if((en.constructor||Object)!==Object)return un&&console.warn("replacing object",un,"with deserialized object from meta",en),en;console.error("Deserialize; meta should only have class instances, not js objects",en,un,yn)}}if(en&&typeof en=="object"&&(en.constructor||Object)!==Object&&!Array.isArray(en)&&console.warn("Data might already be deserialized. It will be cloned, or copied to source",en,"source",un,en.constructor,en.constructor!==Object),en&&typeof en=="object")if(!en.serializableClassId||un&&un.serializableClassId===en.serializableClassId)(en.constructor||Object)!==Object||un?Array.isArray(en)&&!un&&(un=[]):un={};else{const Jn=gn.SerializableClasses.get(en.serializableClassId);Jn&&(un=Jn.DataInConstructor?new Jn(en):new Jn)}if(typeof un=="function")return console.error("cannot deserialize over function",un,en),un;if(!zn){const Jn=gn.GetSerializer(en);if(Jn&&Jn!==on)return Jn.deserialize(en,un,yn)}if(!en||un==null||typeof un!="object")return en;if(!zn&&typeof(un==null?void 0:un.fromJSON)=="function")return un.fromJSON(en,yn),un;let Un=(Yn=un.constructor)!==null&&Yn!==void 0?Yn:Object;if(Un===Object)return on.deserialize(en,un,yn);for(;Un&&Un!==Object;){const Jn=(tr=gn.TypeMap.get(Un))!==null&&tr!==void 0?tr:[];for(const[hn,rr]of Jn){const sr=un[rr],br=gn.Deserialize(en[hn],sr,yn,!1);br!==sr&&nn(un,rr,br,!0)}Un=Object.getPrototypeOf(Un)}return un}}function ln(Yt,en="param"){if(!Yt)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(un,yn)=>{Object.defineProperty(un,yn,{get(){return this[`_oc_${yn}`]},set(zn){var Yn;const tr=this[`_oc_${yn}`];if(tr===zn)return;this[`_oc_${yn}`]=zn;const Un=en==="param"?[yn,zn,tr]:en==="object"?[{key:yn,value:zn,oldValue:tr}]:"";if(typeof Yt=="string")(Yn=this[Yt])===null||Yn===void 0||Yn.call(this,...Un);else if(typeof Yt=="function"){let Jn=!1;if(Yt.name){let hn=this;for(;hn;){if(hn[Yt.name]===Yt){Yt.call(this,...Un),Jn=!0;break}hn=Object.getPrototypeOf(hn)}}Jn||(Yt.name&&this[Yt.name].name===`bound ${Yt.name}`?this[Yt.name](...Un):Yt(...Un))}}})}}function _n(Yt,{backgroundColor:en="",scale:un=1,width:yn=512,height:zn=512}){const Yn=document.createElement("canvas"),tr=Yn.getContext("2d"),Un=un,Jn=yn,hn=zn;return Yn.width=Jn*Un,Yn.height=hn*Un,Yn.style.width=`${Jn}`,Yn.style.height=`${hn}`,(en==null?void 0:en.length)>0&&(tr.fillStyle=en,tr.fillRect(0,0,Yn.width,Yn.height)),tr.drawImage(Yt,0,0,Yn.width,Yn.height),Yn}gn.TypeMap=new Map,gn.SerializableClasses=new Map,gn.Serializers=[{priority:0,isType:Yt=>Array.isArray(Yt),serialize:(Yt,en)=>Yt.map(un=>gn.Serialize(un,en,!1)),deserialize:(Yt,en,un)=>{const yn=Yt.length;Array.isArray(en)||(en=[]);for(let zn=0;zn<yn;zn++){const Yn=Yt[zn],tr=en.length>zn?gn.Deserialize(Yn,en[zn],un,!1):gn.Deserialize(Yn,void 0,un,!1);en.length<=zn?en.push(tr):en[zn]=tr}return en}},{priority:0,isType:Yt=>!Yt||typeof Yt!="object",serialize:Yt=>{if(Yt&&typeof Yt=="number"){if(Yt===1/0)return"Infinity";if(Yt===-1/0)return"-Infinity";if(isNaN(Yt))return"NaN"}return Yt},deserialize:(Yt,en)=>{if(typeof en=="number"){if(Yt==="Infinity")return 1/0;if(Yt==="-Infinity")return-1/0;if(Yt==="NaN")return NaN;if(typeof Yt=="number"||!Yt)return Yt}return Yt}},on];const Ut=async(Yt,en)=>_n(await gt(Yt),en),Qt=async(Yt,en)=>await Ut(Yt,en).then(un=>un.toDataURL("image/png")),tn=async Yt=>sn(await(await fetch(Yt)).blob());function bn(Yt,en,{width:un,height:yn},zn=!0){const Yn=`
<svg viewBox="0 0 ${un} ${yn}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${en}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${Yt}
        </div>
    </foreignObject>
</svg>
    `;return zn?qt(Yn):Yn}g.Damper=ut,g.LinearToSRGB=function(Yt){return Yt<.0031308?12.92*Yt:1.055*Math.pow(Yt,.41666)-.055},g.PointerDragHelper=class extends tt{constructor(){super(...arguments),this._onPointerDown=Yt=>{if(Yt.button!==0||!this._element)return;this._pointerUp=void 0;const en=Yt.clientX/this._element.clientWidth*2-1,un=-Yt.clientY/this._element.clientHeight*2+1,yn=ot();this._pointerDown={x:en,y:un,time:yn},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=Yt=>{if(!this._pointerDown||!this._pointer||!this._element)return;const en=Yt.clientX/this._element.clientWidth*2-1,un=-Yt.clientY/this._element.clientHeight*2+1,yn=ot();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:en-this._pointerDown.x,y:un-this._pointerDown.y,time:yn-this._pointerDown.time},delta:{x:en-this._pointer.x,y:un-this._pointer.y,time:yn-this._pointer.time}}),this._pointer={x:en,y:un,time:ot()},Yt.buttons%2==0&&this._onPointerUp(Yt)},this._onPointerUp=Yt=>{if(Yt.button!==0||!this._pointerDown||!this._element)return;const en=Yt.clientX/this._element.clientWidth*2-1,un=-Yt.clientY/this._element.clientHeight*2+1,yn=ot();this._pointerUp={x:en,y:un,time:yn},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(Yt){this._element!==Yt&&(this._element&&this._removeElement(),this._element=Yt,this._element&&this._addElement())}_removeElement(){var Yt,en,un,yn,zn;(Yt=this._element)===null||Yt===void 0||Yt.removeEventListener("pointerdown",this._onPointerDown),(en=this._element)===null||en===void 0||en.removeEventListener("pointermove",this._onPointerMove),(un=this._element)===null||un===void 0||un.removeEventListener("pointerup",this._onPointerUp),(yn=this._element)===null||yn===void 0||yn.removeEventListener("pointercancel",this._onPointerUp),(zn=this._element)===null||zn===void 0||zn.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var Yt,en,un,yn,zn;(Yt=this._element)===null||Yt===void 0||Yt.addEventListener("pointerdown",this._onPointerDown),(en=this._element)===null||en===void 0||en.addEventListener("pointermove",this._onPointerMove),(un=this._element)===null||un===void 0||un.addEventListener("pointerup",this._onPointerUp),(yn=this._element)===null||yn===void 0||yn.addEventListener("pointercancel",this._onPointerUp),(zn=this._element)===null||zn===void 0||zn.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}},g.SRGBToLinear=function(Yt){return Yt<.04045?.0773993808*Yt:Math.pow(.9478672986*Yt+.0521327014,2.4)},g.Serialization=gn,g.SimpleEventDispatcher=tt,g.TYPED_ARRAYS=It,g.absMax=function(Yt,en){return Math.abs(Yt)>Math.abs(en)?Yt:en},g.aesGcmDecrypt=async function(Yt,en){const un=typeof en=="string"?new TextEncoder().encode(en):en,yn=await crypto.subtle.digest("SHA-256",un),zn=Yt.slice(0,12),Yn={name:"AES-GCM",iv:typeof zn=="string"?new Uint8Array(Array.from(zn).map(hn=>hn.charCodeAt(0))):zn},tr=await crypto.subtle.importKey("raw",yn,Yn,!1,["decrypt"]),Un=Yt.slice(12),Jn=typeof Un=="string"?new Uint8Array(Array.from(Un).map(hn=>hn.charCodeAt(0))):Un;try{const hn=await crypto.subtle.decrypt(Yn,tr,Jn);return typeof Yt=="string"?new TextDecoder().decode(hn):new Uint8Array(hn)}catch{throw new Error("Decrypt failed")}},g.aesGcmEncrypt=async function(Yt,en,un){const yn=typeof en=="string"?new TextEncoder().encode(en):en,zn=await crypto.subtle.digest("SHA-256",yn),Yn=crypto.getRandomValues(new Uint8Array(12)),tr=Array.from(Yn).map(Vn=>String.fromCharCode(Vn)).join(""),Un={name:"AES-GCM",iv:Yn},Jn=await crypto.subtle.importKey("raw",zn,Un,!1,["encrypt"]),hn=typeof Yt=="string"?new TextEncoder().encode(Yt):Yt,rr=await crypto.subtle.encrypt(Un,Jn,hn),sr=new Uint8Array(rr),br=Array.from(sr),Kn=br.map(Vn=>String.fromCharCode(Vn)).join(""),dn=un?typeof un=="string"?un:new TextDecoder().decode(un):"",kn=un?typeof un=="string"?new TextEncoder().encode(un):Array.from(un):[];return typeof Yt=="string"?dn+tr+Kn:new Uint8Array([...kn,...Yn,...br])},g.arrayBufferToBase64=function(Yt){if(!window)return console.warn("window is required"),"";let en="";const un=new Uint8Array(Yt),yn=un.byteLength;for(let zn=0;zn<yn;zn++)en+=String.fromCharCode(un[zn]);return window.btoa(en)},g.base64ToArrayBuffer=function(Yt){if(!window)return console.warn("window is required"),new Uint8Array(0);const en=window.atob(Yt),un=en.length,yn=new Uint8Array(un);for(let zn=0;zn<un;zn++)yn[zn]=en.charCodeAt(zn);return yn.buffer},g.blobToDataURL=sn,g.canvasFlipY=function(Yt){const en=document.createElement("canvas");en.width=Yt.width,en.height=Yt.height;const un=en.getContext("2d");if(!un)throw new Error("Unable to get 2d context");return un.translate(0,Yt.height),un.scale(1,-1),un.drawImage(Yt,0,0),en},g.clearBit=function(Yt,en){return Yt&~(1<<en)},g.colorToDataUrl=function(Yt,en=1,un=1){const yn=document.createElement("canvas");yn.width=en,yn.height=un;const zn=yn.getContext("2d");zn.fillStyle="#"+Yt,zn.fillRect(0,0,en,un);const Yn=yn.toDataURL();return yn.remove(),Yn},g.copyProps=function(Yt,en,un){for(const yn of un){const zn=Yt[yn];zn!==void 0&&nn(en,yn,zn,!0)}return en},g.createCanvasElement=function(){const Yt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return Yt.style.display="block",Yt},g.createDiv=function({innerHTML:Yt="",id:en,classList:un,addToBody:yn=!0,elementTag:zn="div"}){const Yn=document.createElement(zn);return en&&(Yn.id=en),Yn.innerHTML=Yt,un&&Yn.classList.add(...un),yn&&document.body.appendChild(Yn),Yn},g.createImage=gt,g.createScriptFromURL=async function(Yt,en=document.head){return new Promise((un,yn)=>{const zn=document.createElement("script");zn.setAttribute("src",Yt),zn.addEventListener("load",()=>un(zn)),zn.addEventListener("error",yn),en.appendChild(zn)})},g.createStyles=xt,g.css=Xt,g.deepAccessObject=function(Yt,en,un=!1){for(typeof Yt=="string"&&(Yt=Yt.split("."));Yt.length>0;){if(!en)return;const yn=Yt.splice(0,1)[0];if(!(yn.length<1)){if(!(yn in en)){if(un)throw new Error("invalid access, check "+yn+" in "+en);return}en=en[yn]}}return en},g.downloadBlob=jt,g.downloadFile=function(Yt,en){return jt(Yt,en??Yt.name)},g.embedUrlRefs=async function(Yt,en=tn){const un=Yt.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(un)for(const yn of un){const zn=await en(yn);Yt=Yt.replace(yn,zn)}return Yt},g.escapeRegExp=kt,g.getFileHandle=function(){return"showOpenFilePicker"in window?window.showOpenFilePicker().then(Yt=>Yt[0]):window.chooseFileSystemEntries()},g.getFilenameFromPath=function(Yt){return Yt.substring(Yt.lastIndexOf("/")+1)},g.getKeyByValue=function(Yt,en){return Object.keys(Yt).find(un=>Yt[un]===en)},g.getNewFileHandle=function(){if("showSaveFilePicker"in window){const Yt={types:[{description:"Text file",accept:{"text/plain":[".txt"]}}]};return window.showSaveFilePicker(Yt)}return window.chooseFileSystemEntries({type:"save-file",accepts:[{description:"Text file",extensions:["txt"],mimeTypes:["text/plain"]}]})},g.getOrCall=function(Yt,...en){return typeof Yt=="function"&&(Yt=Yt(...en)),Yt},g.getPropertyDescriptor=Gt,g.getTypedArray=function(Yt,en){return new It[Yt](en)},g.getUrlQueryParam=function(Yt,en=null){var un;return(un=new URL(window.location.href).searchParams.get(Yt))!==null&&un!==void 0?un:en},g.glsl=(Yt,...en)=>String.raw({raw:Yt},...en),g.html=(Yt,...en)=>String.raw({raw:Yt},...en),g.htmlToCanvas=async function(Yt,en,un){const yn=bn(Yt,en,un);return await Ut(yn,un)},g.htmlToPng=async function(Yt,en,un){const yn=bn(Yt,en,un);return await Qt(yn,un)},g.htmlToSvg=bn,g.imageBitmapToBase64=function(Yt,en=8192,un=!1){var yn;if(!Yt.width||!Yt.height)return"";const zn=document.createElement("canvas");zn.width=Math.min(en,Yt.width),zn.height=Math.floor(1+zn.width*Yt.height/Yt.width);const Yn=Yt instanceof ImageBitmap,tr=Yn&&un&&Math.abs(zn.width-Yt.width)<.5?zn.getContext("bitmaprenderer"):void 0;tr?tr.transferFromImageBitmap(Yt):(yn=zn.getContext("2d"))===null||yn===void 0||yn.drawImage(Yt,0,0,zn.width,zn.height);const Un=zn.toDataURL("image/png");return zn.remove(),Yn&&un&&Yt.close(),Un},g.imageDataToCanvas=function(Yt){const en=document.createElement("canvas");return en.width=Yt.width,en.height=Yt.height,en.getContext("2d").putImageData(Yt,0,0),en},g.imageToCanvas=_n,g.imageUrlToImageData=async function(Yt){return new Promise((en,un)=>{const yn=new Image;yn.addEventListener("load",()=>{const zn=document.createElement("canvas");zn.width=yn.width,zn.height=yn.height;const Yn=zn.getContext("2d");if(!Yn)return void un(new Error("Could not get 2d context"));Yn.drawImage(yn,0,0,zn.width,zn.height);const tr=Yn.getImageData(0,0,zn.width,zn.height);en(tr),zn.remove(),yn.remove()},!1),yn.addEventListener("error",zn=>{yn.remove(),un(zn)},!1),yn.src=Yt})},g.includesAll=function(Yt,en){for(const un of en)if(!Yt.includes(un))return!1;return!0},g.isPropertyWritable=vn,g.isWebpExportSupported=function(){const Yt=document.createElement("canvas");return!(!Yt.getContext||!Yt.getContext("2d"))&&Yt.toDataURL("image/webp").startsWith("data:image/webp")},g.longestCommonPrefix=function(Yt){return Yt.sort(),Yt[0].split("").map((en,un)=>Yt[Yt.length-1][un]===en?en:"\0").join("").split("\0").at(0)||""},g.makeColorSvg=Yt=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${Yt}'/%3E%3C/svg%3E%0A`,g.makeColorSvgCircle=Yt=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${Yt}'/%3E%3C/svg%3E%0A`,g.makeTextSvg=Yt=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${Yt}%3C/text%3E%3C/svg%3E%0A`,g.mobileAndTabletCheck=function(){let Yt=!1;var en;return en=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(en)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(en.substr(0,4)))&&(Yt=!0),Yt},g.now=ot,g.objectHasOwn=function(Yt,en){return Object.hasOwn?Object.hasOwn(Yt,en):Yt.hasOwnProperty(en)},g.onChange=ln,g.onChange2=function(Yt,en="void"){if(!Yt)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return ln(Yt,en)},g.onChange3=function(Yt,en="object"){if(!Yt)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return ln(Yt,en)},g.parseFileExtension=function(Yt){var en;if(!Yt||Yt===""||Yt.match(/__MACOSX\/.*\._/))return"";const un=(en=(Yt=Yt.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&en!==void 0?en:"",yn=un.lastIndexOf(".");return un===""||yn<1?"":un.slice(yn+1)},g.pathJoin=function(Yt,en="/"){return Yt.join(en)},g.prettyScrollbar=function(Yt=document.head){return xt(Xt`
      ::-webkit-scrollbar
      {
        width: 8px;  /* for vertical scrollbars */
        height: 8px; /* for horizontal scrollbars */
      }
      ::-webkit-scrollbar-track
      {
        background: rgba(64, 64, 64, 0.4);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-thumb
      {
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}
    `,Yt)},g.readFile=function(Yt){return Yt.text?Yt.text():function(en){return new Promise(un=>{const yn=new FileReader;yn.addEventListener("loadend",zn=>{const Yn=zn.srcElement.result;un(Yn)}),yn.readAsText(en)})}(Yt)},g.remoteWorkerURL=function(Yt,en){const un=(en?`var Module = { locateFile: function(s) { return "${en}"; } }; 
`:"")+`importScripts( "${Yt}" );`;return URL.createObjectURL(new Blob([un],{type:"text/javascript"}))},g.replaceAll=Ft,g.safeSetProperty=nn,g.serializable=function(Yt){return en=>(en=class extends en{constructor(){super(...arguments),this.serializableClassId=Yt}},gn.SerializableClasses.set(Yt,en),en)},g.serialize=function(Yt){return(en,un)=>{const yn=en.constructor;if(yn===Object)throw new Error("All properties in an object are serialized by default");gn.TypeMap.has(yn)||gn.TypeMap.set(yn,[]),gn.TypeMap.get(yn).push([Yt||un,un])}},g.setUrlQueryParam=function(Yt,en,un=!1){const yn=new URLSearchParams(location.search);en==null?yn.has(Yt)&&yn.delete(Yt):yn.set(Yt,en),un?window.location.search=yn.toString():window.history.replaceState({},"","?"+yn.toString())},g.svgToCanvas=Ut,g.svgToPng=Qt,g.svgUrl=qt,g.timeout=async function(Yt){return new Promise(en=>setTimeout(en,Math.max(0,Yt)))},g.toTitleCase=function(Yt){return Yt.replace(/\w\S*/g,function(en){return en.charAt(0).toUpperCase()+en.substr(1).toLowerCase()})},g.updateBit=function(Yt,en,un){return Yt&~(1<<en)|(un?1:0)<<en},g.uploadFile=async function(Yt=!1,en=!1,un){const yn=document.createElement("input");yn.type="file",yn.multiple=Yt,yn.accept=un||"*",yn.webkitdirectory=en,yn.style.display="none",document.body.appendChild(yn),yn.click();const zn=await new Promise(Yn=>{yn.onchange=tr=>{Yn(Array.from(yn.files||[]))}});return document.body.removeChild(yn),zn},g.verifyPermission=async function(Yt,en){const un={};return en&&(un.writable=!0,un.mode="readwrite"),await Yt.queryPermission(un)==="granted"||await Yt.requestPermission(un)==="granted"},g.writeFile=async function(Yt,en){if(Yt.createWriter){const yn=await Yt.createWriter();return await yn.write(0,en),void await yn.close()}const un=await Yt.createWritable();await un.write(en),await un.close()}})(b)},819:function($,b){(function(g){const tt="tp";function ot(_n){return Ut=>Qt=>{if(!Ut&&Qt===void 0)return{succeeded:!1,value:void 0};if(Ut&&Qt===void 0)return{succeeded:!0,value:void 0};const tn=_n(Qt);return tn!==void 0?{succeeded:!0,value:tn}:{succeeded:!1,value:void 0}}}function ut(_n){return{custom:Ut=>ot(Ut)(_n),boolean:ot(Ut=>typeof Ut=="boolean"?Ut:void 0)(_n),number:ot(Ut=>typeof Ut=="number"?Ut:void 0)(_n),string:ot(Ut=>typeof Ut=="string"?Ut:void 0)(_n),function:ot(Ut=>typeof Ut=="function"?Ut:void 0)(_n),constant:Ut=>ot(Qt=>Qt===Ut?Ut:void 0)(_n),raw:ot(Ut=>Ut)(_n),object:Ut=>ot(Qt=>{if((tn=Qt)!==null&&typeof tn=="object")return function(bn,Yt){return Object.keys(Yt).reduce((en,un)=>{if(en===void 0)return;const yn=(0,Yt[un])(bn[un]);return yn.succeeded?Object.assign(Object.assign({},en),{[un]:yn.value}):void 0},{})}(Qt,Ut);var tn})(_n),array:Ut=>ot(Qt=>{if(Array.isArray(Qt))return tn=Ut,Qt.reduce((bn,Yt)=>{if(bn===void 0)return;const en=tn(Yt);return en.succeeded&&en.value!==void 0?[...bn,en.value]:void 0},[]);var tn})(_n)}}const gt={optional:ut(!0),required:ut(!1)};function xt(_n){return Ut=>Ut.toFixed(Math.max(Math.min(_n,20),0))}function It(_n){return[_n[0],_n[1],_n[2]]}function kt(_n){return Ut=>function(Qt,tn){const bn=xt(tn==="float"?2:0);return`rgb(${It(Qt.getComponents("rgb",tn)).map(Yt=>bn(Yt)).join(", ")})`}(Ut,_n)}function Ft(_n){return Ut=>function(Qt,tn){const bn=xt(2),Yt=xt(tn==="float"?2:0);return`rgba(${Qt.getComponents("rgb",tn).map((en,un)=>(un===3?bn:Yt)(en)).join(", ")})`}(Ut,_n)}function Xt(_n){return Ut=>function(Qt,tn){const bn=xt(tn==="float"?2:0),Yt=["r","g","b"];return`{${It(Qt.getComponents("rgb",tn)).map((en,un)=>`${Yt[un]}: ${bn(en)}`).join(", ")}}`}(Ut,_n)}function qt(_n){return Ut=>function(Qt,tn){const bn=xt(2),Yt=xt(tn==="float"?2:0),en=["r","g","b","a"];return`{${Qt.getComponents("rgb",tn).map((un,yn)=>`${en[yn]}: ${(yn===3?bn:Yt)(un)}`).join(", ")}}`}(Ut,_n)}function jt(_n,Ut,Qt,tn){return new(Qt||(Qt=Promise))(function(bn,Yt){function en(zn){try{yn(tn.next(zn))}catch(Yn){Yt(Yn)}}function un(zn){try{yn(tn.throw(zn))}catch(Yn){Yt(Yn)}}function yn(zn){var Yn;zn.done?bn(zn.value):(Yn=zn.value,Yn instanceof Qt?Yn:new Qt(function(tr){tr(Yn)})).then(en,un)}yn((tn=tn.apply(_n,Ut||[])).next())})}function sn(_n){return jt(this,void 0,void 0,function*(){const Ut=new Image;return Ut.crossOrigin="anonymous",new Promise((Qt,tn)=>{Ut.src=_n,Ut.onload=()=>{Qt(Ut)},Ut.onerror=tn})})}["int","float"].reduce((_n,Ut)=>[..._n,{format:{alpha:!1,mode:"rgb",notation:"func",type:Ut},stringifier:kt(Ut)},{format:{alpha:!0,mode:"rgb",notation:"func",type:Ut},stringifier:Ft(Ut)},{format:{alpha:!1,mode:"rgb",notation:"object",type:Ut},stringifier:Xt(Ut)},{format:{alpha:!0,mode:"rgb",notation:"object",type:Ut},stringifier:qt(Ut)}],[]);const Gt=(vn="img",(_n,Ut)=>[tt,"-",vn,"v",_n?`_${_n}`:"",Ut?`-${Ut}`:""].join(""));var vn;class nn{constructor(Ut,Qt){this.element=Ut.createElement("div"),this.element.classList.add(Gt()),Qt.viewProps.bindClassModifiers(this.element),this.input=Ut.createElement("input"),this.input.classList.add(Gt("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",Qt.extensions.join(",")),this.image_=Ut.createElement("img"),this.image_.classList.add(Gt("image")),this.image_.classList.add(Gt(`image_${Qt.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=tn=>{Qt.clickCallback?Qt.clickCallback(tn,this.input):this.input.click()},this.element.classList.add(Gt("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(Ut){this.image_.src=Ut}changeDraggingState(Ut){const Qt=this.element;Ut?Qt==null||Qt.classList.add(Gt("area_dragging")):Qt==null||Qt.classList.remove(Gt("area_dragging"))}}let Wt=null;class on{constructor(Ut,Qt){this.value=Qt.value,this.viewProps=Qt.viewProps,this.view=new nn(Ut,{viewProps:this.viewProps,extensions:Qt.extensions,imageFit:Qt.imageFit,clickCallback:Qt.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(Ut){const Qt=(Ut==null?void 0:Ut.target).files;if(!Qt||!Qt.length)return;const tn=Qt[0];this.setValue(tn)}onDrop(Ut){return jt(this,void 0,void 0,function*(){Ut.preventDefault();try{const{dataTransfer:Qt}=Ut,tn=Qt==null?void 0:Qt.files[0];if(tn)this.setValue(tn);else{const bn=Qt==null?void 0:Qt.getData("url");if(!bn)throw new Error("No url");this.setValue(bn)}}catch(Qt){console.error("Could not parse the dropped image",Qt)}finally{this.view.changeDraggingState(!1)}})}onDragOver(Ut){Ut.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(Ut){return jt(this,void 0,void 0,function*(){Ut instanceof HTMLImageElement?this.updateImage(Ut.src):typeof Ut!="string"&&Ut?yield this.setValue(Ut):(Ut!=="placeholder"&&Ut||(Ut=(yield this.handlePlaceholderImage()).src),this.updateImage(Ut))})}updateImage(Ut){this.view.changeImage(Ut)}setValue(Ut){return jt(this,void 0,void 0,function*(){if(Ut instanceof HTMLImageElement)this.value.setRawValue(Ut);else if(Ut instanceof File){const Qt=URL.createObjectURL(Ut)+"#"+Ut.name;Ut.src=Qt;const tn=yield sn(Qt).catch(()=>{});this.value.setRawValue(tn||Ut)}else Ut?this.value.setRawValue(yield sn(Ut)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return jt(this,void 0,void 0,function*(){return Wt||(Wt=yield function(){const Ut=document.createElement("canvas");Ut.width=320,Ut.height=50;const Qt=Ut.getContext("2d");return Qt.fillStyle="#00000004",Qt.fillRect(0,0,Ut.width,Ut.height),Qt.fillStyle="#eee",Qt.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',Qt.textAlign="center",Qt.textBaseline="middle",Qt.fillText("No image",.5*Ut.width,.5*Ut.height),new Promise(tn=>{Ut.toBlob(bn=>{const Yt=new Image;Yt.src=URL.createObjectURL(bn),Yt.isPlaceholder=!0,Yt.onload=()=>{tn(Yt)}})})}()),Wt})}}const gn=[".jpg",".png",".gif"],ln={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us)*3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us)*3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity .16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:.6}",accept(_n,Ut){if(!(_n instanceof HTMLImageElement||typeof _n=="string"))return null;const Qt=gt,tn=function(bn,Yt){const en=gt.required.object(Yt)(bn);return en.succeeded?en.value:void 0}(Ut,{view:Qt.required.constant("input-image"),acceptUrl:Qt.optional.boolean,clickCallback:Qt.optional.function,imageFit:Qt.optional.custom(bn=>bn==="contain"||bn==="cover"?bn:void 0),extensions:Qt.optional.array(Qt.required.string)});return tn?{initialValue:_n,params:tn}:null},binding:{reader(_n){return Ut=>Ut.src!==void 0?Ut.src===""?"placeholder":Ut.src:Ut},writer(_n){return(Ut,Qt)=>{Ut.write(Qt)}}},controller(_n){var Ut,Qt;return new on(_n.document,{value:_n.value,imageFit:(Ut=_n.params.imageFit)!==null&&Ut!==void 0?Ut:"cover",clickCallback:_n.params.clickCallback,viewProps:_n.viewProps,extensions:(Qt=_n.params.extensions)!==null&&Qt!==void 0?Qt:gn})}};g.plugin=ln,Object.defineProperty(g,"__esModule",{value:!0})})(b)},665:function($,b){(function(g){class tt{constructor(ht){this.controller_=ht}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(ht){this.controller_.viewProps.set("disabled",ht)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(ht){this.controller_.viewProps.set("hidden",ht)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class ot{constructor(ht){this.target=ht}}class ut extends ot{constructor(ht,vt,Rt,Kt){super(ht),this.value=vt,this.presetKey=Rt,this.last=Kt==null||Kt}}class gt extends ot{constructor(ht,vt,Rt){super(ht),this.value=vt,this.presetKey=Rt}}class xt extends ot{constructor(ht,vt){super(ht),this.expanded=vt}}class It extends ot{constructor(ht,vt){super(ht),this.index=vt}}function kt(Mt){return Mt==null}function Ft(Mt,ht){if(Mt.length!==ht.length)return!1;for(let vt=0;vt<Mt.length;vt++)if(Mt[vt]!==ht[vt])return!1;return!0}function Xt(Mt,ht){let vt=Mt;do{const Rt=Object.getOwnPropertyDescriptor(vt,ht);if(Rt&&(Rt.set!==void 0||Rt.writable===!0))return!0;vt=Object.getPrototypeOf(vt)}while(vt!==null);return!1}const qt={alreadydisposed:()=>"View has been already disposed",invalidparams:Mt=>`Invalid parameters for '${Mt.name}'`,nomatchingcontroller:Mt=>`No matching controller for '${Mt.key}'`,nomatchingview:Mt=>`No matching view for '${JSON.stringify(Mt.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:Mt=>`Property '${Mt.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class jt{static alreadyDisposed(){return new jt({type:"alreadydisposed"})}static notBindable(){return new jt({type:"notbindable"})}static propertyNotFound(ht){return new jt({type:"propertynotfound",context:{name:ht}})}static shouldNeverHappen(){return new jt({type:"shouldneverhappen"})}constructor(ht){var vt;this.message=(vt=qt[ht.type](ht.context))!==null&&vt!==void 0?vt:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=ht.type}}class sn{constructor(ht,vt,Rt){this.obj_=ht,this.key_=vt,this.presetKey_=Rt??vt}static isBindable(ht){return ht!==null&&typeof ht=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(ht){this.obj_[this.key_]=ht}writeProperty(ht,vt){const Rt=this.read();if(!sn.isBindable(Rt))throw jt.notBindable();if(!(ht in Rt))throw jt.propertyNotFound(ht);Rt[ht]=vt}}class Gt extends tt{get label(){return this.controller_.props.get("label")}set label(ht){this.controller_.props.set("label",ht)}get title(){var ht;return(ht=this.controller_.valueController.props.get("title"))!==null&&ht!==void 0?ht:""}set title(ht){this.controller_.valueController.props.set("title",ht)}on(ht,vt){const Rt=vt.bind(this);return this.controller_.valueController.emitter.on(ht,()=>{Rt(new ot(this))}),this}}class vn{constructor(){this.observers_={}}on(ht,vt){let Rt=this.observers_[ht];return Rt||(Rt=this.observers_[ht]=[]),Rt.push({handler:vt}),this}off(ht,vt){const Rt=this.observers_[ht];return Rt&&(this.observers_[ht]=Rt.filter(Kt=>Kt.handler!==vt)),this}emit(ht,vt){const Rt=this.observers_[ht];Rt&&Rt.forEach(Kt=>{Kt.handler(vt)})}}const nn="tp";function Wt(Mt){return(ht,vt)=>[nn,"-",Mt,"v",ht?`_${ht}`:"",vt?`-${vt}`:""].join("")}function on(Mt){return Mt.rawValue}function gn(Mt,ht){var vt,Rt;Mt.emitter.on("change",(vt=on,Rt=ht,Kt=>Rt(vt(Kt)))),ht(Mt.rawValue)}function ln(Mt,ht,vt){gn(Mt.value(ht),vt)}function _n(Mt,ht){return vt=>{(function(Rt,Kt,In){In?Rt.classList.add(Kt):Rt.classList.remove(Kt)})(Mt,ht,vt)}}function Ut(Mt,ht){gn(Mt,vt=>{ht.textContent=vt??""})}const Qt=Wt("btn");class tn{constructor(ht,vt){this.element=ht.createElement("div"),this.element.classList.add(Qt()),vt.viewProps.bindClassModifiers(this.element);const Rt=ht.createElement("button");Rt.classList.add(Qt("b")),vt.viewProps.bindDisabled(Rt),this.element.appendChild(Rt),this.buttonElement=Rt;const Kt=ht.createElement("div");Kt.classList.add(Qt("t")),Ut(vt.props.value("title"),Kt),this.buttonElement.appendChild(Kt)}}class bn{constructor(ht,vt){this.emitter=new vn,this.onClick_=this.onClick_.bind(this),this.props=vt.props,this.viewProps=vt.viewProps,this.view=new tn(ht,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Yt{constructor(ht,vt){var Rt;this.constraint_=vt==null?void 0:vt.constraint,this.equals_=(Rt=vt==null?void 0:vt.equals)!==null&&Rt!==void 0?Rt:(Kt,In)=>Kt===In,this.emitter=new vn,this.rawValue_=ht}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(ht){this.setRawValue(ht,{forceEmit:!1,last:!0})}setRawValue(ht,vt){const Rt=vt??{forceEmit:!1,last:!0},Kt=this.constraint_?this.constraint_.constrain(ht):ht,In=this.rawValue_;(!this.equals_(In,Kt)||Rt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=Kt,this.emitter.emit("change",{options:Rt,previousRawValue:In,rawValue:Kt,sender:this}))}}class en{constructor(ht){this.emitter=new vn,this.value_=ht}get rawValue(){return this.value_}set rawValue(ht){this.setRawValue(ht,{forceEmit:!1,last:!0})}setRawValue(ht,vt){const Rt=vt??{forceEmit:!1,last:!0},Kt=this.value_;(Kt!==ht||Rt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=ht,this.emitter.emit("change",{options:Rt,previousRawValue:Kt,rawValue:this.value_,sender:this}))}}function un(Mt,ht){const vt=ht==null?void 0:ht.constraint,Rt=ht==null?void 0:ht.equals;return vt||Rt?new Yt(Mt,ht):new en(Mt)}class yn{constructor(ht){this.emitter=new vn,this.valMap_=ht;for(const vt in this.valMap_)this.valMap_[vt].emitter.on("change",()=>{this.emitter.emit("change",{key:vt,sender:this})})}static createCore(ht){return Object.keys(ht).reduce((vt,Rt)=>Object.assign(vt,{[Rt]:un(ht[Rt])}),{})}static fromObject(ht){const vt=this.createCore(ht);return new yn(vt)}get(ht){return this.valMap_[ht].rawValue}set(ht,vt){this.valMap_[ht].rawValue=vt}value(ht){return this.valMap_[ht]}}function zn(Mt){return ht=>vt=>{if(!ht&&vt===void 0)return{succeeded:!1,value:void 0};if(ht&&vt===void 0)return{succeeded:!0,value:void 0};const Rt=Mt(vt);return Rt!==void 0?{succeeded:!0,value:Rt}:{succeeded:!1,value:void 0}}}function Yn(Mt){return{custom:ht=>zn(ht)(Mt),boolean:zn(ht=>typeof ht=="boolean"?ht:void 0)(Mt),number:zn(ht=>typeof ht=="number"?ht:void 0)(Mt),string:zn(ht=>typeof ht=="string"?ht:void 0)(Mt),function:zn(ht=>typeof ht=="function"?ht:void 0)(Mt),constant:ht=>zn(vt=>vt===ht?ht:void 0)(Mt),raw:zn(ht=>ht)(Mt),object:ht=>zn(vt=>{if((Rt=vt)!==null&&typeof Rt=="object")return function(Kt,In){return Object.keys(In).reduce((Bn,hr)=>{if(Bn===void 0)return;const Ir=(0,In[hr])(Kt[hr]);return Ir.succeeded?Object.assign(Object.assign({},Bn),{[hr]:Ir.value}):void 0},{})}(vt,ht);var Rt})(Mt),array:ht=>zn(vt=>{if(Array.isArray(vt))return Rt=ht,vt.reduce((Kt,In)=>{if(Kt===void 0)return;const Bn=Rt(In);return Bn.succeeded&&Bn.value!==void 0?[...Kt,Bn.value]:void 0},[]);var Rt})(Mt)}}const tr={optional:Yn(!0),required:Yn(!1)};function Un(Mt,ht){const vt=tr.required.object(ht)(Mt);return vt.succeeded?vt.value:void 0}function Jn(Mt){console.warn([`Missing '${Mt.key}' of ${Mt.target} in ${Mt.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}class hn{constructor(ht){this.value_=ht}static create(ht){return[new hn(ht),(vt,Rt)=>{ht.setRawValue(vt,Rt)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const rr=Wt("");function sr(Mt,ht){return _n(Mt,rr(void 0,ht))}class br extends yn{constructor(ht){var vt;super(ht),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=hn.create(un(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(vt=this.get("parent"))===null||vt===void 0||vt.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(ht){var vt,Rt,Kt;const In=ht??{};return new br(yn.createCore({disabled:(vt=In.disabled)!==null&&vt!==void 0&&vt,disposed:!1,hidden:(Rt=In.hidden)!==null&&Rt!==void 0&&Rt,parent:(Kt=In.parent)!==null&&Kt!==void 0?Kt:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(ht){gn(this.globalDisabled_,sr(ht,"disabled")),ln(this,"hidden",sr(ht,"hidden"))}bindDisabled(ht){gn(this.globalDisabled_,vt=>{ht.disabled=vt})}bindTabIndex(ht){gn(this.globalDisabled_,vt=>{ht.tabIndex=vt?-1:0})}handleDispose(ht){this.value("disposed").emitter.on("change",vt=>{vt&&ht()})}getGlobalDisabled_(){const ht=this.get("parent");return!!ht&&ht.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(ht){var vt;const Rt=ht.previousRawValue;Rt==null||Rt.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(vt=this.get("parent"))===null||vt===void 0||vt.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const Kn=Wt(""),dn={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class kn{constructor(ht){this.parent_=null,this.blade=ht.blade,this.view=ht.view,this.viewProps=ht.viewProps;const vt=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(Rt=>{vt.classList.remove(Kn(void 0,dn[Rt]))}),this.blade.get("positions").forEach(Rt=>{vt.classList.add(Kn(void 0,dn[Rt]))})}),this.viewProps.handleDispose(()=>{(function(Rt){Rt&&Rt.parentElement&&Rt.parentElement.removeChild(Rt)})(vt)})}get parent(){return this.parent_}set parent(ht){this.parent_=ht,"parent"in this.viewProps.valMap_?this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null):Jn({key:"parent",target:br.name,place:"BladeController.parent"})}}const Vn="http://www.w3.org/2000/svg";function Rr(Mt){Mt.offsetHeight}function cr(Mt){return Mt.ontouchstart!==void 0}function Hr(){return globalThis.document}const xs={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Ys(Mt,ht){const vt=Mt.createElementNS(Vn,"svg");return vt.innerHTML=xs[ht],vt}function ls(Mt,ht,vt){Mt.insertBefore(ht,Mt.children[vt])}function oo(Mt){Mt.parentElement&&Mt.parentElement.removeChild(Mt)}function Ks(Mt){for(;Mt.children.length>0;)Mt.removeChild(Mt.children[0])}function Xo(Mt){return Mt.relatedTarget?Mt.relatedTarget:"explicitOriginalTarget"in Mt?Mt.explicitOriginalTarget:null}const fr=Wt("lbl");class ko{constructor(ht,vt){this.element=ht.createElement("div"),this.element.classList.add(fr()),vt.viewProps.bindClassModifiers(this.element);const Rt=ht.createElement("div");Rt.classList.add(fr("l")),ln(vt.props,"label",In=>{kt(In)?this.element.classList.add(fr(void 0,"nol")):(this.element.classList.remove(fr(void 0,"nol")),function(Bn){for(;Bn.childNodes.length>0;)Bn.removeChild(Bn.childNodes[0])}(Rt),Rt.appendChild(function(Bn,hr){const Ir=Bn.createDocumentFragment();return hr.split(`
`).map(us=>Bn.createTextNode(us)).forEach((us,no)=>{no>0&&Ir.appendChild(Bn.createElement("br")),Ir.appendChild(us)}),Ir}(ht,In)))}),this.element.appendChild(Rt),this.labelElement=Rt;const Kt=ht.createElement("div");Kt.classList.add(fr("v")),this.element.appendChild(Kt),this.valueElement=Kt}}class pu extends kn{constructor(ht,vt){const Rt=vt.valueController.viewProps;super(Object.assign(Object.assign({},vt),{view:new ko(ht,{props:vt.props,viewProps:Rt}),viewProps:Rt})),this.props=vt.props,this.valueController=vt.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Fu={id:"button",type:"blade",accept(Mt){const ht=tr,vt=Un(Mt,{title:ht.required.string,view:ht.required.constant("button"),label:ht.optional.string});return vt?{params:vt}:null},controller(Mt){return new pu(Mt.document,{blade:Mt.blade,props:yn.fromObject({label:Mt.params.label}),valueController:new bn(Mt.document,{props:yn.fromObject({title:Mt.params.title}),viewProps:Mt.viewProps})})},api(Mt){return Mt.controller instanceof pu&&Mt.controller.valueController instanceof bn?new Gt(Mt.controller):null}};class wo extends kn{constructor(ht){super(ht),this.value=ht.value}}function Pl(){return new yn({positions:un([],{equals:Ft})})}class xa extends yn{constructor(ht){super(ht)}static create(ht){const vt={completed:!0,expanded:ht,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},Rt=yn.createCore(vt);return new xa(Rt)}get styleExpanded(){var ht;return(ht=this.get("temporaryExpanded"))!==null&&ht!==void 0?ht:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const ht=this.get("expandedHeight");return this.get("shouldFixHeight")&&!kt(ht)?`${ht}px`:"auto"}bindExpandedClass(ht,vt){const Rt=()=>{this.styleExpanded?ht.classList.add(vt):ht.classList.remove(vt)};ln(this,"expanded",Rt),ln(this,"temporaryExpanded",Rt)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Bl(Mt,ht){ht.style.height=Mt.styleHeight}function po(Mt,ht){Mt.value("expanded").emitter.on("beforechange",()=>{if(Mt.set("completed",!1),kt(Mt.get("expandedHeight"))){const vt=function(Rt,Kt){let In=0;return function(Bn,hr){const Ir=Bn.style.transition;Bn.style.transition="none",hr(),Bn.style.transition=Ir}(Kt,()=>{Rt.set("expandedHeight",null),Rt.set("temporaryExpanded",!0),Rr(Kt),In=Kt.clientHeight,Rt.set("temporaryExpanded",null),Rr(Kt)}),In}(Mt,ht);vt>0&&Mt.set("expandedHeight",vt)}Mt.set("shouldFixHeight",!0),Rr(ht)}),Mt.emitter.on("change",()=>{Bl(Mt,ht)}),Bl(Mt,ht),ht.addEventListener("transitionend",vt=>{vt.propertyName==="height"&&Mt.cleanUpTransition()})}class Go extends tt{constructor(ht,vt){super(ht),this.rackApi_=vt}}class su{constructor(ht){this.emitter=new vn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=ht}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(ht){for(const vt of this.allItems())if(ht(vt))return vt;return null}includes(ht){return this.cache_.has(ht)}add(ht,vt){if(this.includes(ht))throw jt.shouldNeverHappen();const Rt=vt!==void 0?vt:this.items_.length;this.items_.splice(Rt,0,ht),this.cache_.add(ht);const Kt=this.extract_(ht);Kt&&(Kt.emitter.on("add",this.onSubListAdd_),Kt.emitter.on("remove",this.onSubListRemove_),Kt.allItems().forEach(In=>{this.cache_.add(In)})),this.emitter.emit("add",{index:Rt,item:ht,root:this,target:this})}remove(ht){const vt=this.items_.indexOf(ht);if(vt<0)return;this.items_.splice(vt,1),this.cache_.delete(ht);const Rt=this.extract_(ht);Rt&&(Rt.emitter.off("add",this.onSubListAdd_),Rt.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:vt,item:ht,root:this,target:this})}onSubListAdd_(ht){this.cache_.add(ht.item),this.emitter.emit("add",{index:ht.index,item:ht.item,root:this,target:ht.target})}onSubListRemove_(ht){this.cache_.delete(ht.item),this.emitter.emit("remove",{index:ht.index,item:ht.item,root:this,target:ht.target})}}class Ho extends tt{constructor(ht){super(ht),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new vn,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(ht){this.controller_.props.set("label",ht)}on(ht,vt){const Rt=vt.bind(this);return this.emitter_.on(ht,Kt=>{Rt(Kt.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(ht){const vt=ht.sender.target.read();this.emitter_.emit("change",{event:new ut(this,vt,this.controller_.binding.target.presetKey,ht.options.last)})}}class ou extends pu{constructor(ht,vt){super(ht,vt),this.binding=vt.binding}}class Uo extends tt{constructor(ht){super(ht),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new vn,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(ht){this.controller_.props.set("label",ht)}on(ht,vt){const Rt=vt.bind(this);return this.emitter_.on(ht,Kt=>{Rt(Kt.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(ht){const vt=ht.sender.target.read();this.emitter_.emit("update",{event:new gt(this,vt,this.controller_.binding.target.presetKey)})}}class au extends pu{constructor(ht,vt){super(ht,vt),this.binding=vt.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function kp(Mt){return Mt instanceof xl?Mt.apiSet_:Mt instanceof Go?Mt.rackApi_.apiSet_:null}function Ap(Mt,ht){const vt=Mt.find(Rt=>Rt.controller_===ht);if(!vt)throw jt.shouldNeverHappen();return vt}function Cv(Mt,ht,vt){if(!sn.isBindable(Mt))throw jt.notBindable();return new sn(Mt,ht,vt)}class xl extends tt{constructor(ht,vt){super(ht),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new vn,this.apiSet_=new su(kp),this.pool_=vt;const Rt=this.controller_.rack;Rt.emitter.on("add",this.onRackAdd_),Rt.emitter.on("remove",this.onRackRemove_),Rt.emitter.on("inputchange",this.onRackInputChange_),Rt.emitter.on("monitorupdate",this.onRackMonitorUpdate_),Rt.children.forEach(Kt=>{this.setUpApi_(Kt)})}get children(){return this.controller_.rack.children.map(ht=>Ap(this.apiSet_,ht))}addInput(ht,vt,Rt){const Kt=Rt??{},In=this.controller_.view.element.ownerDocument,Bn=this.pool_.createInput(In,Cv(ht,vt,Kt.presetKey),Kt),hr=new Ho(Bn);return this.add(hr,Kt.index)}addMonitor(ht,vt,Rt){const Kt=Rt??{},In=this.controller_.view.element.ownerDocument,Bn=this.pool_.createMonitor(In,Cv(ht,vt),Kt),hr=new Uo(Bn);return this.add(hr,Kt.index)}addFolder(ht){return function(vt,Rt){return vt.addBlade(Object.assign(Object.assign({},Rt),{view:"folder"}))}(this,ht)}addButton(ht){return function(vt,Rt){return vt.addBlade(Object.assign(Object.assign({},Rt),{view:"button"}))}(this,ht)}addSeparator(ht){return function(vt,Rt){const Kt=Rt??{};return vt.addBlade(Object.assign(Object.assign({},Kt),{view:"separator"}))}(this,ht)}addTab(ht){return function(vt,Rt){return vt.addBlade(Object.assign(Object.assign({},Rt),{view:"tab"}))}(this,ht)}add(ht,vt){this.controller_.rack.add(ht.controller_,vt);const Rt=this.apiSet_.find(Kt=>Kt.controller_===ht.controller_);return Rt&&this.apiSet_.remove(Rt),this.apiSet_.add(ht),ht}remove(ht){this.controller_.rack.remove(ht.controller_)}addBlade(ht){const vt=this.controller_.view.element.ownerDocument,Rt=this.pool_.createBlade(vt,ht),Kt=this.pool_.createBladeApi(Rt);return this.add(Kt,ht.index)}on(ht,vt){const Rt=vt.bind(this);return this.emitter_.on(ht,Kt=>{Rt(Kt.event)}),this}setUpApi_(ht){this.apiSet_.find(vt=>vt.controller_===ht)||this.apiSet_.add(this.pool_.createBladeApi(ht))}onRackAdd_(ht){this.setUpApi_(ht.bladeController)}onRackRemove_(ht){if(ht.isRoot){const vt=Ap(this.apiSet_,ht.bladeController);this.apiSet_.remove(vt)}}onRackInputChange_(ht){const vt=ht.bladeController;if(vt instanceof ou){const Rt=Ap(this.apiSet_,vt),Kt=vt.binding;this.emitter_.emit("change",{event:new ut(Rt,Kt.target.read(),Kt.target.presetKey,ht.options.last)})}else if(vt instanceof wo){const Rt=Ap(this.apiSet_,vt);this.emitter_.emit("change",{event:new ut(Rt,vt.value.rawValue,void 0,ht.options.last)})}}onRackMonitorUpdate_(ht){if(!(ht.bladeController instanceof au))throw jt.shouldNeverHappen();const vt=Ap(this.apiSet_,ht.bladeController),Rt=ht.bladeController.binding;this.emitter_.emit("update",{event:new gt(vt,Rt.target.read(),Rt.target.presetKey)})}}class fu extends Go{constructor(ht,vt){super(ht,new xl(ht.rackController,vt)),this.emitter_=new vn,this.controller_.foldable.value("expanded").emitter.on("change",Rt=>{this.emitter_.emit("fold",{event:new xt(this,Rt.sender.rawValue)})}),this.rackApi_.on("change",Rt=>{this.emitter_.emit("change",{event:Rt})}),this.rackApi_.on("update",Rt=>{this.emitter_.emit("update",{event:Rt})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(ht){this.controller_.foldable.set("expanded",ht)}get title(){return this.controller_.props.get("title")}set title(ht){this.controller_.props.set("title",ht)}get children(){return this.rackApi_.children}addInput(ht,vt,Rt){return this.rackApi_.addInput(ht,vt,Rt)}addMonitor(ht,vt,Rt){return this.rackApi_.addMonitor(ht,vt,Rt)}addFolder(ht){return this.rackApi_.addFolder(ht)}addButton(ht){return this.rackApi_.addButton(ht)}addSeparator(ht){return this.rackApi_.addSeparator(ht)}addTab(ht){return this.rackApi_.addTab(ht)}add(ht,vt){return this.rackApi_.add(ht,vt)}remove(ht){this.rackApi_.remove(ht)}addBlade(ht){return this.rackApi_.addBlade(ht)}on(ht,vt){const Rt=vt.bind(this);return this.emitter_.on(ht,Kt=>{Rt(Kt.event)}),this}}class Tm extends kn{constructor(ht){super({blade:ht.blade,view:ht.view,viewProps:ht.rackController.viewProps}),this.rackController=ht.rackController}}class Gl{constructor(ht,vt){const Rt=Wt(vt.viewName);this.element=ht.createElement("div"),this.element.classList.add(Rt()),vt.viewProps.bindClassModifiers(this.element)}}function Io(Mt){return Mt instanceof Zo?Mt.rack:Mt instanceof Tm?Mt.rackController.rack:null}function sp(Mt){const ht=Io(Mt);return ht?ht.bcSet_:null}class To{constructor(ht){var vt,Rt;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new vn,this.blade_=(vt=ht.blade)!==null&&vt!==void 0?vt:null,(Rt=this.blade_)===null||Rt===void 0||Rt.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=ht.viewProps,this.bcSet_=new su(sp),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(ht,vt){var Rt;(Rt=ht.parent)===null||Rt===void 0||Rt.remove(ht),Xt(ht,"parent")?ht.parent=this:(ht.parent_=this,Jn({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(ht,vt)}remove(ht){Xt(ht,"parent")?ht.parent=null:(ht.parent_=null,Jn({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(ht)}find(ht){return this.bcSet_.allItems().filter(vt=>vt instanceof ht)}onSetAdd_(ht){this.updatePositions_();const vt=ht.target===ht.root;if(this.emitter.emit("add",{bladeController:ht.item,index:ht.index,isRoot:vt,sender:this}),!vt)return;const Rt=ht.item;if(Rt.viewProps.emitter.on("change",this.onChildViewPropsChange_),Rt.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),Rt.viewProps.handleDispose(this.onChildDispose_),Rt instanceof ou)Rt.binding.emitter.on("change",this.onChildInputChange_);else if(Rt instanceof au)Rt.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(Rt instanceof wo)Rt.value.emitter.on("change",this.onChildValueChange_);else{const Kt=Io(Rt);if(Kt){const In=Kt.emitter;In.on("layout",this.onDescendantLayout_),In.on("inputchange",this.onDescendantInputChange_),In.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(ht){this.updatePositions_();const vt=ht.target===ht.root;if(this.emitter.emit("remove",{bladeController:ht.item,isRoot:vt,sender:this}),!vt)return;const Rt=ht.item;if(Rt instanceof ou)Rt.binding.emitter.off("change",this.onChildInputChange_);else if(Rt instanceof au)Rt.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(Rt instanceof wo)Rt.value.emitter.off("change",this.onChildValueChange_);else{const Kt=Io(Rt);if(Kt){const In=Kt.emitter;In.off("layout",this.onDescendantLayout_),In.off("inputchange",this.onDescendantInputChange_),In.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const ht=this.bcSet_.items.filter(Kt=>!Kt.viewProps.get("hidden")),vt=ht[0],Rt=ht[ht.length-1];this.bcSet_.items.forEach(Kt=>{const In=[];Kt===vt&&(In.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||In.push("veryfirst")),Kt===Rt&&(In.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||In.push("verylast")),Kt.blade.set("positions",In)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(ht){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(ht=>ht.viewProps.get("disposed")).forEach(ht=>{this.bcSet_.remove(ht)})}onChildInputChange_(ht){const vt=function(Rt,Kt){for(let In=0;In<Rt.length;In++){const Bn=Rt[In];if(Bn instanceof ou&&Bn.binding===Kt)return Bn}return null}(this.find(ou),ht.sender);if(!vt)throw jt.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:vt,options:ht.options,sender:this})}onChildMonitorUpdate_(ht){const vt=function(Rt,Kt){for(let In=0;In<Rt.length;In++){const Bn=Rt[In];if(Bn instanceof au&&Bn.binding===Kt)return Bn}return null}(this.find(au),ht.sender);if(!vt)throw jt.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:vt,sender:this})}onChildValueChange_(ht){const vt=function(Rt,Kt){for(let In=0;In<Rt.length;In++){const Bn=Rt[In];if(Bn instanceof wo&&Bn.value===Kt)return Bn}return null}(this.find(wo),ht.sender);if(!vt)throw jt.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:vt,options:ht.options,sender:this})}onDescendantLayout_(ht){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(ht){this.emitter.emit("inputchange",{bladeController:ht.bladeController,options:ht.options,sender:this})}onDescendantMonitorUpdate_(ht){this.emitter.emit("monitorupdate",{bladeController:ht.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Zo extends kn{constructor(ht,vt){super(Object.assign(Object.assign({},vt),{view:new Gl(ht,{viewName:"brk",viewProps:vt.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const Rt=new To({blade:vt.root?void 0:vt.blade,viewProps:vt.viewProps});Rt.emitter.on("add",this.onRackAdd_),Rt.emitter.on("remove",this.onRackRemove_),this.rack=Rt,this.viewProps.handleDispose(()=>{for(let Kt=this.rack.children.length-1;Kt>=0;Kt--)this.rack.children[Kt].viewProps.set("disposed",!0)})}onRackAdd_(ht){ht.isRoot&&ls(this.view.element,ht.bladeController.view.element,ht.index)}onRackRemove_(ht){ht.isRoot&&oo(ht.bladeController.view.element)}}const Po=Wt("cnt");class Mm{constructor(ht,vt){var Rt;this.className_=Wt((Rt=vt.viewName)!==null&&Rt!==void 0?Rt:"fld"),this.element=ht.createElement("div"),this.element.classList.add(this.className_(),Po()),vt.viewProps.bindClassModifiers(this.element),this.foldable_=vt.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),ln(this.foldable_,"completed",_n(this.element,this.className_(void 0,"cpl")));const Kt=ht.createElement("button");Kt.classList.add(this.className_("b")),ln(vt.props,"title",us=>{kt(us)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),vt.viewProps.bindDisabled(Kt),this.element.appendChild(Kt),this.buttonElement=Kt;const In=ht.createElement("div");In.classList.add(this.className_("i")),this.element.appendChild(In);const Bn=ht.createElement("div");Bn.classList.add(this.className_("t")),Ut(vt.props.value("title"),Bn),this.buttonElement.appendChild(Bn),this.titleElement=Bn;const hr=ht.createElement("div");hr.classList.add(this.className_("m")),this.buttonElement.appendChild(hr);const Ir=vt.containerElement;Ir.classList.add(this.className_("c")),this.element.appendChild(Ir),this.containerElement=Ir}}class Jl extends Tm{constructor(ht,vt){var Rt;const Kt=xa.create((Rt=vt.expanded)===null||Rt===void 0||Rt),In=new Zo(ht,{blade:vt.blade,root:vt.root,viewProps:vt.viewProps});super(Object.assign(Object.assign({},vt),{rackController:In,view:new Mm(ht,{containerElement:In.view.element,foldable:Kt,props:vt.props,viewName:vt.root?"rot":void 0,viewProps:vt.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=vt.props,this.foldable=Kt,po(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const ju={id:"folder",type:"blade",accept(Mt){const ht=tr,vt=Un(Mt,{title:ht.required.string,view:ht.required.constant("folder"),expanded:ht.optional.boolean});return vt?{params:vt}:null},controller(Mt){return new Jl(Mt.document,{blade:Mt.blade,expanded:Mt.params.expanded,props:yn.fromObject({title:Mt.params.title}),viewProps:Mt.viewProps})},api(Mt){return Mt.controller instanceof Jl?new fu(Mt.controller,Mt.pool):null}};class Bs extends wo{constructor(ht,vt){const Rt=vt.valueController.viewProps;super(Object.assign(Object.assign({},vt),{value:vt.valueController.value,view:new ko(ht,{props:vt.props,viewProps:Rt}),viewProps:Rt})),this.props=vt.props,this.valueController=vt.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Ds extends tt{}const Fo=Wt("spr");class Ll{constructor(ht,vt){this.element=ht.createElement("div"),this.element.classList.add(Fo()),vt.viewProps.bindClassModifiers(this.element);const Rt=ht.createElement("hr");Rt.classList.add(Fo("r")),this.element.appendChild(Rt)}}class fs extends kn{constructor(ht,vt){super(Object.assign(Object.assign({},vt),{view:new Ll(ht,{viewProps:vt.viewProps})}))}}const Ns={id:"separator",type:"blade",accept(Mt){const ht=Un(Mt,{view:tr.required.constant("separator")});return ht?{params:ht}:null},controller(Mt){return new fs(Mt.document,{blade:Mt.blade,viewProps:Mt.viewProps})},api(Mt){return Mt.controller instanceof fs?new Ds(Mt.controller):null}},En=Wt("tbi");class Js{constructor(ht,vt){this.element=ht.createElement("div"),this.element.classList.add(En()),vt.viewProps.bindClassModifiers(this.element),ln(vt.props,"selected",In=>{In?this.element.classList.add(En(void 0,"sel")):this.element.classList.remove(En(void 0,"sel"))});const Rt=ht.createElement("button");Rt.classList.add(En("b")),vt.viewProps.bindDisabled(Rt),this.element.appendChild(Rt),this.buttonElement=Rt;const Kt=ht.createElement("div");Kt.classList.add(En("t")),Ut(vt.props.value("title"),Kt),this.buttonElement.appendChild(Kt),this.titleElement=Kt}}class El{constructor(ht,vt){this.emitter=new vn,this.onClick_=this.onClick_.bind(this),this.props=vt.props,this.viewProps=vt.viewProps,this.view=new Js(ht,{props:vt.props,viewProps:vt.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class to{constructor(ht,vt){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new El(ht,{props:vt.itemProps,viewProps:br.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Zo(ht,{blade:Pl(),viewProps:br.create()}),this.props=vt.props,ln(this.props,"selected",Rt=>{this.itemController.props.set("selected",Rt),this.contentController.viewProps.set("hidden",!Rt)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Ls{constructor(ht,vt){this.controller_=ht,this.rackApi_=vt}get title(){var ht;return(ht=this.controller_.itemController.props.get("title"))!==null&&ht!==void 0?ht:""}set title(ht){this.controller_.itemController.props.set("title",ht)}get selected(){return this.controller_.props.get("selected")}set selected(ht){this.controller_.props.set("selected",ht)}get children(){return this.rackApi_.children}addButton(ht){return this.rackApi_.addButton(ht)}addFolder(ht){return this.rackApi_.addFolder(ht)}addSeparator(ht){return this.rackApi_.addSeparator(ht)}addTab(ht){return this.rackApi_.addTab(ht)}add(ht,vt){this.rackApi_.add(ht,vt)}remove(ht){this.rackApi_.remove(ht)}addInput(ht,vt,Rt){return this.rackApi_.addInput(ht,vt,Rt)}addMonitor(ht,vt,Rt){return this.rackApi_.addMonitor(ht,vt,Rt)}addBlade(ht){return this.rackApi_.addBlade(ht)}}class ao extends Go{constructor(ht,vt){super(ht,new xl(ht.rackController,vt)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new vn,this.pageApiMap_=new Map,this.rackApi_.on("change",Rt=>{this.emitter_.emit("change",{event:Rt})}),this.rackApi_.on("update",Rt=>{this.emitter_.emit("update",{event:Rt})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(Rt=>{this.setUpPageApi_(Rt)})}get pages(){return this.controller_.pageSet.items.map(ht=>{const vt=this.pageApiMap_.get(ht);if(!vt)throw jt.shouldNeverHappen();return vt})}addPage(ht){const vt=this.controller_.view.element.ownerDocument,Rt=new to(vt,{itemProps:yn.fromObject({selected:!1,title:ht.title}),props:yn.fromObject({selected:!1})});this.controller_.add(Rt,ht.index);const Kt=this.pageApiMap_.get(Rt);if(!Kt)throw jt.shouldNeverHappen();return Kt}removePage(ht){this.controller_.remove(ht)}on(ht,vt){const Rt=vt.bind(this);return this.emitter_.on(ht,Kt=>{Rt(Kt.event)}),this}setUpPageApi_(ht){const vt=this.rackApi_.apiSet_.find(Kt=>Kt.controller_===ht.contentController);if(!vt)throw jt.shouldNeverHappen();const Rt=new Ls(ht,vt);this.pageApiMap_.set(ht,Rt)}onPageAdd_(ht){this.setUpPageApi_(ht.item)}onPageRemove_(ht){if(!this.pageApiMap_.get(ht.item))throw jt.shouldNeverHappen();this.pageApiMap_.delete(ht.item)}onSelect_(ht){this.emitter_.emit("select",{event:new It(this,ht.rawValue)})}}class wu{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=un(!0),this.selectedIndex=un(-1),this.items_=[]}add(ht,vt){const Rt=vt??this.items_.length;this.items_.splice(Rt,0,ht),ht.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(ht){const vt=this.items_.indexOf(ht);vt<0||(this.items_.splice(vt,1),ht.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const ht=this.items_.findIndex(vt=>vt.rawValue);ht<0?(this.items_.forEach((vt,Rt)=>{vt.rawValue=Rt===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((vt,Rt)=>{vt.rawValue=Rt===ht}),this.selectedIndex.rawValue=ht),this.empty.rawValue=!1}onItemSelectedChange_(ht){if(ht.rawValue){const vt=this.items_.findIndex(Rt=>Rt===ht.sender);this.items_.forEach((Rt,Kt)=>{Rt.rawValue=Kt===vt}),this.selectedIndex.rawValue=vt}else this.keepSelection_()}}const Yo=Wt("tab");class $a{constructor(ht,vt){this.element=ht.createElement("div"),this.element.classList.add(Yo(),Po()),vt.viewProps.bindClassModifiers(this.element),gn(vt.empty,_n(this.element,Yo(void 0,"nop")));const Rt=ht.createElement("div");Rt.classList.add(Yo("t")),this.element.appendChild(Rt),this.itemsElement=Rt;const Kt=ht.createElement("div");Kt.classList.add(Yo("i")),this.element.appendChild(Kt);const In=vt.contentsElement;In.classList.add(Yo("c")),this.element.appendChild(In),this.contentsElement=In}}class $u extends Tm{constructor(ht,vt){const Rt=new Zo(ht,{blade:vt.blade,viewProps:vt.viewProps}),Kt=new wu;super({blade:vt.blade,rackController:Rt,view:new $a(ht,{contentsElement:Rt.view.element,empty:Kt.empty,viewProps:vt.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new su(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=Kt}get pageSet(){return this.pageSet_}add(ht,vt){this.pageSet_.add(ht,vt)}remove(ht){this.pageSet_.remove(this.pageSet_.items[ht])}onPageAdd_(ht){const vt=ht.item;ls(this.view.itemsElement,vt.itemController.view.element,ht.index),vt.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(vt.contentController,ht.index),this.tab.add(vt.props.value("selected"))}onPageRemove_(ht){const vt=ht.item;oo(vt.itemController.view.element),vt.itemController.viewProps.set("parent",null),this.rackController.rack.remove(vt.contentController),this.tab.remove(vt.props.value("selected"))}}const Ko={id:"tab",type:"blade",accept(Mt){const ht=tr,vt=Un(Mt,{pages:ht.required.array(ht.required.object({title:ht.required.string})),view:ht.required.constant("tab")});return vt&&vt.pages.length!==0?{params:vt}:null},controller(Mt){const ht=new $u(Mt.document,{blade:Mt.blade,viewProps:Mt.viewProps});return Mt.params.pages.forEach(vt=>{const Rt=new to(Mt.document,{itemProps:yn.fromObject({selected:!1,title:vt.title}),props:yn.fromObject({selected:!1})});ht.add(Rt)}),ht},api(Mt){return Mt.controller instanceof $u?new ao(Mt.controller,Mt.pool):null}};class Ku{constructor(){this.disabled=!1,this.emitter=new vn}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class op{constructor(ht,vt){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=ht,this.emitter=new vn,this.interval_=vt,this.setTimer_()}get disabled(){return this.disabled_}set disabled(ht){this.disabled_=ht,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const ht=this.doc_.defaultView;ht&&ht.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const ht=this.doc_.defaultView;ht&&(this.timerId_=ht.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ju{constructor(ht){this.onValueChange_=this.onValueChange_.bind(this),this.reader=ht.reader,this.writer=ht.writer,this.emitter=new vn,this.value=ht.value,this.value.emitter.on("change",this.onValueChange_),this.target=ht.target,this.read()}read(){const ht=this.target.read();ht!==void 0&&(this.value.rawValue=this.reader(ht))}write_(ht){this.writer(this.target,ht)}onValueChange_(ht){this.write_(ht.rawValue),this.emitter.emit("change",{options:ht.options,rawValue:ht.rawValue,sender:this})}}function mu(Mt,ht){for(;Mt.length<ht;)Mt.push(void 0)}function Nl(Mt){const ht=[];return mu(ht,Mt),un(ht)}function Km(Mt){const ht=Mt.indexOf(void 0);return ht<0?Mt:Mt.slice(0,ht)}class r0{constructor(ht){this.onTick_=this.onTick_.bind(this),this.reader_=ht.reader,this.target=ht.target,this.emitter=new vn,this.value=ht.value,this.ticker=ht.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const ht=this.target.read();if(ht===void 0)return;const vt=this.value.rawValue,Rt=this.reader_(ht);this.value.rawValue=function(Kt,In){const Bn=[...Km(Kt),In];return Bn.length>Kt.length?Bn.splice(0,Bn.length-Kt.length):mu(Bn,Kt.length),Bn}(vt,Rt),this.emitter.emit("update",{rawValue:Rt,sender:this})}onTick_(ht){this.read()}}class Zl{constructor(ht){this.constraints=ht}constrain(ht){return this.constraints.reduce((vt,Rt)=>Rt.constrain(vt),ht)}}function na(Mt,ht){if(Mt instanceof ht)return Mt;if(Mt instanceof Zl){const vt=Mt.constraints.reduce((Rt,Kt)=>Rt||(Kt instanceof ht?Kt:null),null);if(vt)return vt}return null}class _l{constructor(ht){this.values=yn.fromObject({max:ht.max,min:ht.min})}constrain(ht){const vt=this.values.get("max"),Rt=this.values.get("min");return Math.min(Math.max(ht,Rt),vt)}}class Im{constructor(ht){this.values=yn.fromObject({options:ht})}get options(){return this.values.get("options")}constrain(ht){const vt=this.values.get("options");return vt.length===0||vt.filter(Rt=>Rt.value===ht).length>0?ht:vt[0].value}}class k0{constructor(ht){this.values=yn.fromObject({max:ht.max,min:ht.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(ht){const vt=this.values.get("max"),Rt=this.values.get("min");let Kt=ht;return kt(Rt)||(Kt=Math.max(Kt,Rt)),kt(vt)||(Kt=Math.min(Kt,vt)),Kt}}class Jm{constructor(ht,vt=0){this.step=ht,this.origin=vt}constrain(ht){const vt=this.origin%this.step;return vt+Math.round((ht-vt)/this.step)*this.step}}const Op=Wt("lst");class _c{constructor(ht,vt){this.onValueChange_=this.onValueChange_.bind(this),this.props_=vt.props,this.element=ht.createElement("div"),this.element.classList.add(Op()),vt.viewProps.bindClassModifiers(this.element);const Rt=ht.createElement("select");Rt.classList.add(Op("s")),ln(this.props_,"options",In=>{Ks(Rt),In.forEach((Bn,hr)=>{const Ir=ht.createElement("option");Ir.dataset.index=String(hr),Ir.textContent=Bn.text,Ir.value=String(Bn.value),Rt.appendChild(Ir)})}),vt.viewProps.bindDisabled(Rt),this.element.appendChild(Rt),this.selectElement=Rt;const Kt=ht.createElement("div");Kt.classList.add(Op("m")),Kt.appendChild(Ys(ht,"dropdown")),this.element.appendChild(Kt),vt.value.emitter.on("change",this.onValueChange_),this.value_=vt.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class fm{constructor(ht,vt){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=vt.props,this.value=vt.value,this.viewProps=vt.viewProps,this.view=new _c(ht,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(ht){const vt=ht.currentTarget.selectedOptions.item(0);if(!vt)return;const Rt=Number(vt.dataset.index);this.value.rawValue=this.props.get("options")[Rt].value}}const H_=Wt("pop");class Bp{constructor(ht,vt){this.element=ht.createElement("div"),this.element.classList.add(H_()),vt.viewProps.bindClassModifiers(this.element),gn(vt.shows,_n(this.element,H_(void 0,"v")))}}class O0{constructor(ht,vt){this.shows=un(!1),this.viewProps=vt.viewProps,this.view=new Bp(ht,{shows:this.shows,viewProps:this.viewProps})}}const Jp=Wt("txt");class jr{constructor(ht,vt){this.onChange_=this.onChange_.bind(this),this.element=ht.createElement("div"),this.element.classList.add(Jp()),vt.viewProps.bindClassModifiers(this.element),this.props_=vt.props,this.props_.emitter.on("change",this.onChange_);const Rt=ht.createElement("input");Rt.classList.add(Jp("i")),Rt.type="text",vt.viewProps.bindDisabled(Rt),this.element.appendChild(Rt),this.inputElement=Rt,vt.value.emitter.on("change",this.onChange_),this.value_=vt.value,this.refresh()}refresh(){const ht=this.props_.get("formatter");this.inputElement.value=ht(this.value_.rawValue)}onChange_(){this.refresh()}}class y_{constructor(ht,vt){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=vt.parser,this.props=vt.props,this.value=vt.value,this.viewProps=vt.viewProps,this.view=new jr(ht,{props:vt.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(ht){const vt=ht.currentTarget.value,Rt=this.parser_(vt);kt(Rt)||(this.value.rawValue=Rt),this.view.refresh()}}function ns(Mt){return Mt!=="false"&&!!Mt}function Lp(Mt){return function(ht){return String(ht)}(Mt)}class Pm{constructor(ht){this.text=ht}evaluate(){return Number(this.text)}toString(){return this.text}}const Oo={"**":(Mt,ht)=>Math.pow(Mt,ht),"*":(Mt,ht)=>Mt*ht,"/":(Mt,ht)=>Mt/ht,"%":(Mt,ht)=>Mt%ht,"+":(Mt,ht)=>Mt+ht,"-":(Mt,ht)=>Mt-ht,"<<":(Mt,ht)=>Mt<<ht,">>":(Mt,ht)=>Mt>>ht,">>>":(Mt,ht)=>Mt>>>ht,"&":(Mt,ht)=>Mt&ht,"^":(Mt,ht)=>Mt^ht,"|":(Mt,ht)=>Mt|ht};class $s{constructor(ht,vt,Rt){this.left=vt,this.operator=ht,this.right=Rt}evaluate(){const ht=Oo[this.operator];if(!ht)throw new Error(`unexpected binary operator: '${this.operator}`);return ht(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Tv={"+":Mt=>Mt,"-":Mt=>-Mt,"~":Mt=>~Mt};class By{constructor(ht,vt){this.operator=ht,this.expression=vt}evaluate(){const ht=Tv[this.operator];if(!ht)throw new Error(`unexpected unary operator: '${this.operator}`);return ht(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Q_(Mt){return(ht,vt)=>{for(let Rt=0;Rt<Mt.length;Rt++){const Kt=Mt[Rt](ht,vt);if(Kt!=="")return Kt}return""}}function Rm(Mt,ht){var vt;const Rt=Mt.substr(ht).match(/^\s+/);return(vt=Rt&&Rt[0])!==null&&vt!==void 0?vt:""}function ks(Mt,ht){var vt;const Rt=Mt.substr(ht).match(/^[0-9]+/);return(vt=Rt&&Rt[0])!==null&&vt!==void 0?vt:""}function W_(Mt,ht){const vt=Mt.substr(ht,1);if(ht+=1,vt.toLowerCase()!=="e")return"";const Rt=function(Kt,In){const Bn=ks(Kt,In);if(Bn!=="")return Bn;const hr=Kt.substr(In,1);if(hr!=="-"&&hr!=="+")return"";const Ir=ks(Kt,In+=1);return Ir===""?"":hr+Ir}(Mt,ht);return Rt===""?"":vt+Rt}function B0(Mt,ht){const vt=Mt.substr(ht,1);if(vt==="0")return vt;const Rt=function(Kt,In){const Bn=Kt.substr(In,1);return Bn.match(/^[1-9]$/)?Bn:""}(Mt,ht);return ht+=Rt.length,Rt===""?"":Rt+ks(Mt,ht)}const i0=Q_([function(Mt,ht){const vt=B0(Mt,ht);if(ht+=vt.length,vt==="")return"";const Rt=Mt.substr(ht,1);if(ht+=Rt.length,Rt!==".")return"";const Kt=ks(Mt,ht);return vt+Rt+Kt+W_(Mt,ht+=Kt.length)},function(Mt,ht){const vt=Mt.substr(ht,1);if(ht+=vt.length,vt!==".")return"";const Rt=ks(Mt,ht);return ht+=Rt.length,Rt===""?"":vt+Rt+W_(Mt,ht)},function(Mt,ht){const vt=B0(Mt,ht);return ht+=vt.length,vt===""?"":vt+W_(Mt,ht)}]),Mv=Q_([function(Mt,ht){const vt=Mt.substr(ht,2);if(ht+=vt.length,vt.toLowerCase()!=="0b")return"";const Rt=function(Kt,In){var Bn;const hr=Kt.substr(In).match(/^[01]+/);return(Bn=hr&&hr[0])!==null&&Bn!==void 0?Bn:""}(Mt,ht);return Rt===""?"":vt+Rt},function(Mt,ht){const vt=Mt.substr(ht,2);if(ht+=vt.length,vt.toLowerCase()!=="0o")return"";const Rt=function(Kt,In){var Bn;const hr=Kt.substr(In).match(/^[0-7]+/);return(Bn=hr&&hr[0])!==null&&Bn!==void 0?Bn:""}(Mt,ht);return Rt===""?"":vt+Rt},function(Mt,ht){const vt=Mt.substr(ht,2);if(ht+=vt.length,vt.toLowerCase()!=="0x")return"";const Rt=function(Kt,In){var Bn;const hr=Kt.substr(In).match(/^[0-9a-f]+/i);return(Bn=hr&&hr[0])!==null&&Bn!==void 0?Bn:""}(Mt,ht);return Rt===""?"":vt+Rt}]),Ly=Q_([Mv,i0]);function fx(Mt,ht){var vt;return(vt=function(Rt,Kt){const In=Ly(Rt,Kt);return Kt+=In.length,In===""?null:{evaluable:new Pm(In),cursor:Kt}}(Mt,ht))!==null&&vt!==void 0?vt:function(Rt,Kt){const In=Rt.substr(Kt,1);if(Kt+=In.length,In!=="(")return null;const Bn=L0(Rt,Kt);if(!Bn)return null;Kt=Bn.cursor,Kt+=Rm(Rt,Kt).length;const hr=Rt.substr(Kt,1);return Kt+=hr.length,hr!==")"?null:{evaluable:Bn.evaluable,cursor:Kt}}(Mt,ht)}function Sl(Mt,ht,vt){vt+=Rm(ht,vt).length;const Rt=Mt.filter(Kt=>ht.startsWith(Kt,vt))[0];return Rt?(vt+=Rt.length,{cursor:vt+=Rm(ht,vt).length,operator:Rt}):null}const yl=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((Mt,ht)=>function(vt,Rt){return(Kt,In)=>{const Bn=vt(Kt,In);if(!Bn)return null;In=Bn.cursor;let hr=Bn.evaluable;for(;;){const Ir=Sl(Rt,Kt,In);if(!Ir)break;In=Ir.cursor;const us=vt(Kt,In);if(!us)return null;In=us.cursor,hr=new $s(Ir.operator,hr,us.evaluable)}return hr?{cursor:In,evaluable:hr}:null}}(Mt,ht),function Mt(ht,vt){const Rt=fx(ht,vt);if(Rt)return Rt;const Kt=ht.substr(vt,1);if(vt+=Kt.length,Kt!=="+"&&Kt!=="-"&&Kt!=="~")return null;const In=Mt(ht,vt);return In?{cursor:vt=In.cursor,evaluable:new By(Kt,In.evaluable)}:null});function L0(Mt,ht){return ht+=Rm(Mt,ht).length,yl(Mt,ht)}function zu(Mt){var ht;const vt=function(Rt){const Kt=L0(Rt,0);return Kt?Kt.cursor+Rm(Rt,Kt.cursor).length!==Rt.length?null:Kt.evaluable:null}(Mt);return(ht=vt==null?void 0:vt.evaluate())!==null&&ht!==void 0?ht:null}function A_(Mt){if(typeof Mt=="number")return Mt;if(typeof Mt=="string"){const ht=zu(Mt);if(!kt(ht))return ht}return 0}function gu(Mt){return String(Mt)}function os(Mt){return ht=>ht.toFixed(Math.max(Math.min(Mt,20),0))}const Zu=os(0);function Zm(Mt){return Zu(Mt)+"%"}function s0(Mt){return String(Mt)}function _g(Mt){return Mt}function Gs({primary:Mt,secondary:ht,forward:vt,backward:Rt}){let Kt=!1;function In(Bn){Kt||(Kt=!0,Bn(),Kt=!1)}Mt.emitter.on("change",Bn=>{In(()=>{ht.setRawValue(vt(Mt,ht),Bn.options)})}),ht.emitter.on("change",Bn=>{In(()=>{Mt.setRawValue(Rt(Mt,ht),Bn.options)}),In(()=>{ht.setRawValue(vt(Mt,ht),Bn.options)})}),In(()=>{ht.setRawValue(vt(Mt,ht),{forceEmit:!1,last:!0})})}function yo(Mt,ht){const vt=Mt*(ht.altKey?.1:1)*(ht.shiftKey?10:1);return ht.upKey?+vt:ht.downKey?-vt:0}function b_(Mt){return{altKey:Mt.altKey,downKey:Mt.key==="ArrowDown",shiftKey:Mt.shiftKey,upKey:Mt.key==="ArrowUp"}}function e_(Mt){return{altKey:Mt.altKey,downKey:Mt.key==="ArrowLeft",shiftKey:Mt.shiftKey,upKey:Mt.key==="ArrowRight"}}function RS(Mt){return function(ht){return ht==="ArrowUp"||ht==="ArrowDown"}(Mt)||Mt==="ArrowLeft"||Mt==="ArrowRight"}function Zp(Mt,ht){var vt,Rt;const Kt=ht.ownerDocument.defaultView,In=ht.getBoundingClientRect();return{x:Mt.pageX-(((vt=Kt&&Kt.scrollX)!==null&&vt!==void 0?vt:0)+In.left),y:Mt.pageY-(((Rt=Kt&&Kt.scrollY)!==null&&Rt!==void 0?Rt:0)+In.top)}}class ms{constructor(ht){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=ht,this.emitter=new vn,ht.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),ht.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),ht.addEventListener("touchend",this.onTouchEnd_),ht.addEventListener("mousedown",this.onMouseDown_)}computePosition_(ht){const vt=this.elem_.getBoundingClientRect();return{bounds:{width:vt.width,height:vt.height},point:ht?{x:ht.x,y:ht.y}:null}}onMouseDown_(ht){var vt;ht.preventDefault(),(vt=ht.currentTarget)===null||vt===void 0||vt.focus();const Rt=this.elem_.ownerDocument;Rt.addEventListener("mousemove",this.onDocumentMouseMove_),Rt.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:ht.altKey,data:this.computePosition_(Zp(ht,this.elem_)),sender:this,shiftKey:ht.shiftKey})}onDocumentMouseMove_(ht){this.emitter.emit("move",{altKey:ht.altKey,data:this.computePosition_(Zp(ht,this.elem_)),sender:this,shiftKey:ht.shiftKey})}onDocumentMouseUp_(ht){const vt=this.elem_.ownerDocument;vt.removeEventListener("mousemove",this.onDocumentMouseMove_),vt.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:ht.altKey,data:this.computePosition_(Zp(ht,this.elem_)),sender:this,shiftKey:ht.shiftKey})}onTouchStart_(ht){ht.preventDefault();const vt=ht.targetTouches.item(0),Rt=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:ht.altKey,data:this.computePosition_(vt?{x:vt.clientX-Rt.left,y:vt.clientY-Rt.top}:void 0),sender:this,shiftKey:ht.shiftKey}),this.lastTouch_=vt}onTouchMove_(ht){const vt=ht.targetTouches.item(0),Rt=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:ht.altKey,data:this.computePosition_(vt?{x:vt.clientX-Rt.left,y:vt.clientY-Rt.top}:void 0),sender:this,shiftKey:ht.shiftKey}),this.lastTouch_=vt}onTouchEnd_(ht){var vt;const Rt=(vt=ht.targetTouches.item(0))!==null&&vt!==void 0?vt:this.lastTouch_,Kt=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:ht.altKey,data:this.computePosition_(Rt?{x:Rt.clientX-Kt.left,y:Rt.clientY-Kt.top}:void 0),sender:this,shiftKey:ht.shiftKey})}}function Rl(Mt,ht,vt,Rt,Kt){return Rt+(Mt-ht)/(vt-ht)*(Kt-Rt)}function t_(Mt){return String(Mt.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Pu(Mt,ht,vt){return Math.min(Math.max(Mt,ht),vt)}function mx(Mt,ht){return(Mt%ht+ht)%ht}const Dm=Wt("txt");class zo{constructor(ht,vt){this.onChange_=this.onChange_.bind(this),this.props_=vt.props,this.props_.emitter.on("change",this.onChange_),this.element=ht.createElement("div"),this.element.classList.add(Dm(),Dm(void 0,"num")),vt.arrayPosition&&this.element.classList.add(Dm(void 0,vt.arrayPosition)),vt.viewProps.bindClassModifiers(this.element);const Rt=ht.createElement("input");Rt.classList.add(Dm("i")),Rt.type="text",vt.viewProps.bindDisabled(Rt),this.element.appendChild(Rt),this.inputElement=Rt,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=vt.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Dm()),this.inputElement.classList.add(Dm("i"));const Kt=ht.createElement("div");Kt.classList.add(Dm("k")),this.element.appendChild(Kt),this.knobElement=Kt;const In=ht.createElementNS(Vn,"svg");In.classList.add(Dm("g")),this.knobElement.appendChild(In);const Bn=ht.createElementNS(Vn,"path");Bn.classList.add(Dm("gb")),In.appendChild(Bn),this.guideBodyElem_=Bn;const hr=ht.createElementNS(Vn,"path");hr.classList.add(Dm("gh")),In.appendChild(hr),this.guideHeadElem_=hr;const Ir=ht.createElement("div");Ir.classList.add(Wt("tt")()),this.knobElement.appendChild(Ir),this.tooltipElem_=Ir,vt.value.emitter.on("change",this.onChange_),this.value=vt.value,this.refresh()}onDraggingChange_(ht){if(ht.rawValue===null)return void this.element.classList.remove(Dm(void 0,"drg"));this.element.classList.add(Dm(void 0,"drg"));const vt=ht.rawValue/this.props_.get("draggingScale"),Rt=vt+(vt>0?-1:vt<0?1:0),Kt=Pu(-Rt,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${Rt+Kt},0 L${Rt},4 L${Rt+Kt},8`,`M ${vt},-1 L${vt},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${vt},4`);const In=this.props_.get("formatter");this.tooltipElem_.textContent=In(this.value.rawValue),this.tooltipElem_.style.left=`${vt}px`}refresh(){const ht=this.props_.get("formatter");this.inputElement.value=ht(this.value.rawValue)}onChange_(){this.refresh()}}class XA{constructor(ht,vt){var Rt;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=vt.baseStep,this.parser_=vt.parser,this.props=vt.props,this.sliderProps_=(Rt=vt.sliderProps)!==null&&Rt!==void 0?Rt:null,this.value=vt.value,this.viewProps=vt.viewProps,this.dragging_=un(null),this.view=new zo(ht,{arrayPosition:vt.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const Kt=new ms(this.view.knobElement);Kt.emitter.on("down",this.onPointerDown_),Kt.emitter.on("move",this.onPointerMove_),Kt.emitter.on("up",this.onPointerUp_)}constrainValue_(ht){var vt,Rt;const Kt=(vt=this.sliderProps_)===null||vt===void 0?void 0:vt.get("minValue"),In=(Rt=this.sliderProps_)===null||Rt===void 0?void 0:Rt.get("maxValue");let Bn=ht;return Kt!==void 0&&(Bn=Math.max(Bn,Kt)),In!==void 0&&(Bn=Math.min(Bn,In)),Bn}onInputChange_(ht){const vt=ht.currentTarget.value,Rt=this.parser_(vt);kt(Rt)||(this.value.rawValue=this.constrainValue_(Rt)),this.view.refresh()}onInputKeyDown_(ht){const vt=yo(this.baseStep_,b_(ht));vt!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+vt),{forceEmit:!1,last:!1})}onInputKeyUp_(ht){yo(this.baseStep_,b_(ht))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(ht){if(!ht.point)return null;const vt=ht.point.x-ht.bounds.width/2;return this.constrainValue_(this.originRawValue_+vt*this.props.get("draggingScale"))}onPointerMove_(ht){const vt=this.computeDraggingValue_(ht.data);vt!==null&&(this.value.setRawValue(vt,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(ht){const vt=this.computeDraggingValue_(ht.data);vt!==null&&(this.value.setRawValue(vt,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const gx=Wt("sld");class DS{constructor(ht,vt){this.onChange_=this.onChange_.bind(this),this.props_=vt.props,this.props_.emitter.on("change",this.onChange_),this.element=ht.createElement("div"),this.element.classList.add(gx()),vt.viewProps.bindClassModifiers(this.element);const Rt=ht.createElement("div");Rt.classList.add(gx("t")),vt.viewProps.bindTabIndex(Rt),this.element.appendChild(Rt),this.trackElement=Rt;const Kt=ht.createElement("div");Kt.classList.add(gx("k")),this.trackElement.appendChild(Kt),this.knobElement=Kt,vt.value.emitter.on("change",this.onChange_),this.value=vt.value,this.update_()}update_(){const ht=Pu(Rl(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${ht}%`}onChange_(){this.update_()}}class kS{constructor(ht,vt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=vt.baseStep,this.value=vt.value,this.viewProps=vt.viewProps,this.props=vt.props,this.view=new DS(ht,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ms(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(ht,vt){ht.point&&this.value.setRawValue(Rl(Pu(ht.point.x,0,ht.bounds.width),0,ht.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),vt)}onPointerDownOrMove_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!1,last:!1})}onPointerUp_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!0,last:!0})}onKeyDown_(ht){const vt=yo(this.baseStep_,e_(ht));vt!==0&&this.value.setRawValue(this.value.rawValue+vt,{forceEmit:!1,last:!1})}onKeyUp_(ht){yo(this.baseStep_,e_(ht))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const L1=Wt("sldtxt");class N1{constructor(ht,vt){this.element=ht.createElement("div"),this.element.classList.add(L1());const Rt=ht.createElement("div");Rt.classList.add(L1("s")),this.sliderView_=vt.sliderView,Rt.appendChild(this.sliderView_.element),this.element.appendChild(Rt);const Kt=ht.createElement("div");Kt.classList.add(L1("t")),this.textView_=vt.textView,Kt.appendChild(this.textView_.element),this.element.appendChild(Kt)}}class Ny{constructor(ht,vt){this.value=vt.value,this.viewProps=vt.viewProps,this.sliderC_=new kS(ht,{baseStep:vt.baseStep,props:vt.sliderProps,value:vt.value,viewProps:this.viewProps}),this.textC_=new XA(ht,{baseStep:vt.baseStep,parser:vt.parser,props:vt.textProps,sliderProps:vt.sliderProps,value:vt.value,viewProps:vt.viewProps}),this.view=new N1(ht,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function w_(Mt,ht){Mt.write(ht)}function bp(Mt){const ht=tr;return Array.isArray(Mt)?ht.required.array(ht.required.object({text:ht.required.string,value:ht.required.raw}))(Mt).value:typeof Mt=="object"?ht.required.raw(Mt).value:void 0}function _x(Mt){if(Mt==="inline"||Mt==="popup")return Mt}function wp(Mt){const ht=tr;return ht.required.object({max:ht.optional.number,min:ht.optional.number,step:ht.optional.number})(Mt).value}function YA(Mt){if(Array.isArray(Mt))return Mt;const ht=[];return Object.keys(Mt).forEach(vt=>{ht.push({text:vt,value:Mt[vt]})}),ht}function $A(Mt){return kt(Mt)?null:new Im(YA(Mt))}function vx(Mt,ht){const vt=Mt&&na(Mt,Jm);return vt?t_(vt.step):Math.max(t_(ht),2)}function N0(Mt){const ht=function(vt){const Rt=vt?na(vt,Jm):null;return Rt?Rt.step:null}(Mt);return ht??1}function U0(Mt,ht){var vt;const Rt=Mt&&na(Mt,Jm),Kt=Math.abs((vt=Rt==null?void 0:Rt.step)!==null&&vt!==void 0?vt:ht);return Kt===0?.1:Math.pow(10,Math.floor(Math.log10(Kt))-1)}const eu=Wt("ckb");class Uy{constructor(ht,vt){this.onValueChange_=this.onValueChange_.bind(this),this.element=ht.createElement("div"),this.element.classList.add(eu()),vt.viewProps.bindClassModifiers(this.element);const Rt=ht.createElement("label");Rt.classList.add(eu("l")),this.element.appendChild(Rt);const Kt=ht.createElement("input");Kt.classList.add(eu("i")),Kt.type="checkbox",Rt.appendChild(Kt),this.inputElement=Kt,vt.viewProps.bindDisabled(this.inputElement);const In=ht.createElement("div");In.classList.add(eu("w")),Rt.appendChild(In);const Bn=Ys(ht,"check");In.appendChild(Bn),vt.value.emitter.on("change",this.onValueChange_),this.value=vt.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class KA{constructor(ht,vt){this.onInputChange_=this.onInputChange_.bind(this),this.value=vt.value,this.viewProps=vt.viewProps,this.view=new Uy(ht,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(ht){const vt=ht.currentTarget;this.value.rawValue=vt.checked}}const x_={id:"input-bool",type:"input",accept:(Mt,ht)=>{if(typeof Mt!="boolean")return null;const vt=Un(ht,{options:tr.optional.custom(bp)});return vt?{initialValue:Mt,params:vt}:null},binding:{reader:Mt=>ns,constraint:Mt=>function(ht){const vt=[],Rt=$A(ht.options);return Rt&&vt.push(Rt),new Zl(vt)}(Mt.params),writer:Mt=>w_},controller:Mt=>{const ht=Mt.document,vt=Mt.value,Rt=Mt.constraint,Kt=Rt&&na(Rt,Im);return Kt?new fm(ht,{props:new yn({options:Kt.values.value("options")}),value:vt,viewProps:Mt.viewProps}):new KA(ht,{value:vt,viewProps:Mt.viewProps})}},tu=Wt("col");class OS{constructor(ht,vt){this.element=ht.createElement("div"),this.element.classList.add(tu()),vt.foldable.bindExpandedClass(this.element,tu(void 0,"expanded")),ln(vt.foldable,"completed",_n(this.element,tu(void 0,"cpl")));const Rt=ht.createElement("div");Rt.classList.add(tu("h")),this.element.appendChild(Rt);const Kt=ht.createElement("div");Kt.classList.add(tu("s")),Rt.appendChild(Kt),this.swatchElement=Kt;const In=ht.createElement("div");if(In.classList.add(tu("t")),Rt.appendChild(In),this.textElement=In,vt.pickerLayout==="inline"){const Bn=ht.createElement("div");Bn.classList.add(tu("p")),this.element.appendChild(Bn),this.pickerElement=Bn}else this.pickerElement=null}}function Iv(Mt,ht,vt){const Rt=mx(Mt,360),Kt=Pu(ht/100,0,1),In=Pu(vt/100,0,1),Bn=In*Kt,hr=Bn*(1-Math.abs(Rt/60%2-1)),Ir=In-Bn;let us,no,Fl;return[us,no,Fl]=Rt>=0&&Rt<60?[Bn,hr,0]:Rt>=60&&Rt<120?[hr,Bn,0]:Rt>=120&&Rt<180?[0,Bn,hr]:Rt>=180&&Rt<240?[0,hr,Bn]:Rt>=240&&Rt<300?[hr,0,Bn]:[Bn,0,hr],[255*(us+Ir),255*(no+Ir),255*(Fl+Ir)]}function n_(Mt){return[Mt[0],Mt[1],Mt[2]]}function mm(Mt,ht){return[Mt[0],Mt[1],Mt[2],ht]}const Us={hsl:{hsl:(Mt,ht,vt)=>[Mt,ht,vt],hsv:function(Mt,ht,vt){const Rt=vt+ht*(100-Math.abs(2*vt-100))/200;return[Mt,Rt!==0?ht*(100-Math.abs(2*vt-100))/Rt:0,vt+ht*(100-Math.abs(2*vt-100))/200]},rgb:function(Mt,ht,vt){const Rt=(Mt%360+360)%360,Kt=Pu(ht/100,0,1),In=Pu(vt/100,0,1),Bn=(1-Math.abs(2*In-1))*Kt,hr=Bn*(1-Math.abs(Rt/60%2-1)),Ir=In-Bn/2;let us,no,Fl;return[us,no,Fl]=Rt>=0&&Rt<60?[Bn,hr,0]:Rt>=60&&Rt<120?[hr,Bn,0]:Rt>=120&&Rt<180?[0,Bn,hr]:Rt>=180&&Rt<240?[0,hr,Bn]:Rt>=240&&Rt<300?[hr,0,Bn]:[Bn,0,hr],[255*(us+Ir),255*(no+Ir),255*(Fl+Ir)]}},hsv:{hsl:function(Mt,ht,vt){const Rt=100-Math.abs(vt*(200-ht)/100-100);return[Mt,Rt!==0?ht*vt/Rt:0,vt*(200-ht)/200]},hsv:(Mt,ht,vt)=>[Mt,ht,vt],rgb:Iv},rgb:{hsl:function(Mt,ht,vt){const Rt=Pu(Mt/255,0,1),Kt=Pu(ht/255,0,1),In=Pu(vt/255,0,1),Bn=Math.max(Rt,Kt,In),hr=Math.min(Rt,Kt,In),Ir=Bn-hr;let us=0,no=0;const Fl=(hr+Bn)/2;return Ir!==0&&(no=Ir/(1-Math.abs(Bn+hr-1)),us=Rt===Bn?(Kt-In)/Ir:Kt===Bn?2+(In-Rt)/Ir:4+(Rt-Kt)/Ir,us=us/6+(us<0?1:0)),[360*us,100*no,100*Fl]},hsv:function(Mt,ht,vt){const Rt=Pu(Mt/255,0,1),Kt=Pu(ht/255,0,1),In=Pu(vt/255,0,1),Bn=Math.max(Rt,Kt,In),hr=Bn-Math.min(Rt,Kt,In);let Ir;return Ir=hr===0?0:Bn===Rt?((Kt-In)/hr%6+6)%6*60:Bn===Kt?60*((In-Rt)/hr+2):60*((Rt-Kt)/hr+4),[Ir,100*(Bn===0?0:hr/Bn),100*Bn]},rgb:(Mt,ht,vt)=>[Mt,ht,vt]}};function Fy(Mt,ht){return[ht==="float"?1:Mt==="rgb"?255:360,ht==="float"?1:Mt==="rgb"?255:100,ht==="float"?1:Mt==="rgb"?255:100]}function jy(Mt,ht,vt,Rt){const Kt=Fy(ht,vt),In=Fy(ht,Rt);return Mt.map((Bn,hr)=>Bn/Kt[hr]*In[hr])}function zy(Mt,ht){return typeof Mt=="object"&&!kt(Mt)&&ht in Mt&&typeof Mt[ht]=="number"}class jo{static black(ht="int"){return new jo([0,0,0],"rgb",ht)}static fromObject(ht,vt="int"){const Rt="a"in ht?[ht.r,ht.g,ht.b,ht.a]:[ht.r,ht.g,ht.b];return new jo(Rt,"rgb",vt)}static toRgbaObject(ht,vt="int"){return ht.toRgbaObject(vt)}static isRgbColorObject(ht){return zy(ht,"r")&&zy(ht,"g")&&zy(ht,"b")}static isRgbaColorObject(ht){return this.isRgbColorObject(ht)&&zy(ht,"a")}static isColorObject(ht){return this.isRgbColorObject(ht)}static equals(ht,vt){if(ht.mode!==vt.mode)return!1;const Rt=ht.comps_,Kt=vt.comps_;for(let In=0;In<Rt.length;In++)if(Rt[In]!==Kt[In])return!1;return!0}constructor(ht,vt,Rt="int"){this.mode=vt,this.type=Rt,this.comps_=function(Kt,In,Bn){var hr;const Ir=Fy(In,Bn);return[In==="rgb"?Pu(Kt[0],0,Ir[0]):(us=Kt[0],no=Ir[0],us===no?no:mx(us,no)),Pu(Kt[1],0,Ir[1]),Pu(Kt[2],0,Ir[2]),Pu((hr=Kt[3])!==null&&hr!==void 0?hr:1,0,1)];var us,no}(ht,vt,Rt)}getComponents(ht,vt="int"){return mm(function(Rt,Kt,In){const Bn=jy(Rt,Kt.mode,Kt.type,"int");return jy(Us[Kt.mode][In.mode](...Bn),In.mode,"int",In.type)}(n_(this.comps_),{mode:this.mode,type:this.type},{mode:ht??this.mode,type:vt}),this.comps_[3])}toRgbaObject(ht="int"){const vt=this.getComponents("rgb",ht);return{r:vt[0],g:vt[1],b:vt[2],a:vt[3]}}}const Pv=Wt("colp");class km{constructor(ht,vt){this.alphaViews_=null,this.element=ht.createElement("div"),this.element.classList.add(Pv()),vt.viewProps.bindClassModifiers(this.element);const Rt=ht.createElement("div");Rt.classList.add(Pv("hsv"));const Kt=ht.createElement("div");Kt.classList.add(Pv("sv")),this.svPaletteView_=vt.svPaletteView,Kt.appendChild(this.svPaletteView_.element),Rt.appendChild(Kt);const In=ht.createElement("div");In.classList.add(Pv("h")),this.hPaletteView_=vt.hPaletteView,In.appendChild(this.hPaletteView_.element),Rt.appendChild(In),this.element.appendChild(Rt);const Bn=ht.createElement("div");if(Bn.classList.add(Pv("rgb")),this.textView_=vt.textView,Bn.appendChild(this.textView_.element),this.element.appendChild(Bn),vt.alphaViews){this.alphaViews_={palette:vt.alphaViews.palette,text:vt.alphaViews.text};const hr=ht.createElement("div");hr.classList.add(Pv("a"));const Ir=ht.createElement("div");Ir.classList.add(Pv("ap")),Ir.appendChild(this.alphaViews_.palette.element),hr.appendChild(Ir);const us=ht.createElement("div");us.classList.add(Pv("at")),us.appendChild(this.alphaViews_.text.element),hr.appendChild(us),this.element.appendChild(hr)}}get allFocusableElements(){const ht=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(vt=>vt.inputElement)];return this.alphaViews_&&ht.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),ht}}function Ro(Mt){return Mt==="int"?"int":Mt==="float"?"float":void 0}function U1(Mt){const ht=tr;return Un(Mt,{alpha:ht.optional.boolean,color:ht.optional.object({alpha:ht.optional.boolean,type:ht.optional.custom(Ro)}),expanded:ht.optional.boolean,picker:ht.optional.custom(_x)})}function Nr(Mt){return Mt?.1:1}function xo(Mt){var ht;return(ht=Mt.color)===null||ht===void 0?void 0:ht.type}function gm(Mt,ht){const vt=Mt.match(/^(.+)%$/);return Math.min(vt?.01*parseFloat(vt[1])*ht:parseFloat(Mt),ht)}const BS={deg:Mt=>Mt,grad:Mt=>360*Mt/400,rad:Mt=>360*Mt/(2*Math.PI),turn:Mt=>360*Mt};function LS(Mt){const ht=Mt.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!ht)return parseFloat(Mt);const vt=parseFloat(ht[1]),Rt=ht[2];return BS[Rt](vt)}function F0(Mt){const ht=Mt.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!ht)return null;const vt=[gm(ht[1],255),gm(ht[2],255),gm(ht[3],255)];return isNaN(vt[0])||isNaN(vt[1])||isNaN(vt[2])?null:vt}function Vy(Mt){return ht=>{const vt=F0(ht);return vt?new jo(vt,"rgb",Mt):null}}function yx(Mt){const ht=Mt.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!ht)return null;const vt=[gm(ht[1],255),gm(ht[2],255),gm(ht[3],255),gm(ht[4],1)];return isNaN(vt[0])||isNaN(vt[1])||isNaN(vt[2])||isNaN(vt[3])?null:vt}function j0(Mt){return ht=>{const vt=yx(ht);return vt?new jo(vt,"rgb",Mt):null}}function z0(Mt){const ht=Mt.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!ht)return null;const vt=[LS(ht[1]),gm(ht[2],100),gm(ht[3],100)];return isNaN(vt[0])||isNaN(vt[1])||isNaN(vt[2])?null:vt}function Ax(Mt){return ht=>{const vt=z0(ht);return vt?new jo(vt,"hsl",Mt):null}}function NS(Mt){const ht=Mt.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!ht)return null;const vt=[LS(ht[1]),gm(ht[2],100),gm(ht[3],100),gm(ht[4],1)];return isNaN(vt[0])||isNaN(vt[1])||isNaN(vt[2])||isNaN(vt[3])?null:vt}function F1(Mt){return ht=>{const vt=NS(ht);return vt?new jo(vt,"hsl",Mt):null}}function US(Mt){const ht=Mt.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(ht)return[parseInt(ht[1]+ht[1],16),parseInt(ht[2]+ht[2],16),parseInt(ht[3]+ht[3],16)];const vt=Mt.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return vt?[parseInt(vt[1],16),parseInt(vt[2],16),parseInt(vt[3],16)]:null}function FS(Mt){const ht=Mt.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(ht)return[parseInt(ht[1]+ht[1],16),parseInt(ht[2]+ht[2],16),parseInt(ht[3]+ht[3],16),Rl(parseInt(ht[4]+ht[4],16),0,255,0,1)];const vt=Mt.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return vt?[parseInt(vt[1],16),parseInt(vt[2],16),parseInt(vt[3],16),Rl(parseInt(vt[4],16),0,255,0,1)]:null}function lu(Mt){const ht=Mt.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!ht)return null;const vt=[parseFloat(ht[1]),parseFloat(ht[2]),parseFloat(ht[3])];return isNaN(vt[0])||isNaN(vt[1])||isNaN(vt[2])?null:vt}function r_(Mt){return ht=>{const vt=lu(ht);return vt?new jo(vt,"rgb",Mt):null}}function JA(Mt){const ht=Mt.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!ht)return null;const vt=[parseFloat(ht[1]),parseFloat(ht[2]),parseFloat(ht[3]),parseFloat(ht[4])];return isNaN(vt[0])||isNaN(vt[1])||isNaN(vt[2])||isNaN(vt[3])?null:vt}function Rv(Mt){return ht=>{const vt=JA(ht);return vt?new jo(vt,"rgb",Mt):null}}const ZA=[{parser:US,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:FS,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:F0,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:yx,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:z0,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:NS,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:lu,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:JA,result:{alpha:!0,mode:"rgb",notation:"object"}}];function _b(Mt,ht="int"){const vt=function(Rt){return ZA.reduce((Kt,{parser:In,result:Bn})=>Kt||(In(Rt)?Bn:null),null)}(Mt);return vt?vt.notation==="hex"&&ht!=="float"?Object.assign(Object.assign({},vt),{type:"int"}):vt.notation==="func"?Object.assign(Object.assign({},vt),{type:ht}):null:null}const Yl={int:[function(Mt){const ht=US(Mt);return ht?new jo(ht,"rgb","int"):null},function(Mt){const ht=FS(Mt);return ht?new jo(ht,"rgb","int"):null},Vy("int"),j0("int"),Ax("int"),F1("int"),r_("int"),Rv("int")],float:[Vy("float"),j0("float"),Ax("float"),F1("float"),r_("float"),Rv("float")]};function Cl(Mt){const ht=Yl[Mt];return vt=>ht.reduce((Rt,Kt)=>Rt||Kt(vt),null)}function _h(Mt){const ht=Pu(Math.floor(Mt),0,255).toString(16);return ht.length===1?`0${ht}`:ht}function Om(Mt,ht="#"){return`${ht}${n_(Mt.getComponents("rgb")).map(_h).join("")}`}function j1(Mt,ht="#"){const vt=Mt.getComponents("rgb");return`${ht}${[vt[0],vt[1],vt[2],255*vt[3]].map(_h).join("")}`}function bx(Mt,ht){const vt=os(ht==="float"?2:0);return`rgb(${n_(Mt.getComponents("rgb",ht)).map(Rt=>vt(Rt)).join(", ")})`}function jS(Mt){return ht=>bx(ht,Mt)}function Gy(Mt,ht){const vt=os(2),Rt=os(ht==="float"?2:0);return`rgba(${Mt.getComponents("rgb",ht).map((Kt,In)=>(In===3?vt:Rt)(Kt)).join(", ")})`}function _m(Mt){return ht=>Gy(ht,Mt)}function Nn(Mt,ht){const vt=os(ht==="float"?2:0),Rt=["r","g","b"];return`{${n_(Mt.getComponents("rgb",ht)).map((Kt,In)=>`${Rt[In]}: ${vt(Kt)}`).join(", ")}}`}function wx(Mt){return ht=>Nn(ht,Mt)}function xx(Mt,ht){const vt=os(2),Rt=os(ht==="float"?2:0),Kt=["r","g","b","a"];return`{${Mt.getComponents("rgb",ht).map((In,Bn)=>`${Kt[Bn]}: ${(Bn===3?vt:Rt)(In)}`).join(", ")}}`}function E_(Mt){return ht=>xx(ht,Mt)}const q_=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Om},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:j1},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(Mt){const ht=[os(0),Zm,Zm];return`hsl(${n_(Mt.getComponents("hsl")).map((vt,Rt)=>ht[Rt](vt)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(Mt){const ht=[os(0),Zm,Zm,os(2)];return`hsla(${Mt.getComponents("hsl").map((vt,Rt)=>ht[Rt](vt)).join(", ")})`}},...["int","float"].reduce((Mt,ht)=>[...Mt,{format:{alpha:!1,mode:"rgb",notation:"func",type:ht},stringifier:jS(ht)},{format:{alpha:!0,mode:"rgb",notation:"func",type:ht},stringifier:_m(ht)},{format:{alpha:!1,mode:"rgb",notation:"object",type:ht},stringifier:wx(ht)},{format:{alpha:!0,mode:"rgb",notation:"object",type:ht},stringifier:E_(ht)}],[])];function Np(Mt){return q_.reduce((ht,vt)=>{return ht||(Rt=vt.format,Kt=Mt,Rt.alpha===Kt.alpha&&Rt.mode===Kt.mode&&Rt.notation===Kt.notation&&Rt.type===Kt.type?vt.stringifier:null);var Rt,Kt},null)}const Ru=Wt("apl");class V0{constructor(ht,vt){this.onValueChange_=this.onValueChange_.bind(this),this.value=vt.value,this.value.emitter.on("change",this.onValueChange_),this.element=ht.createElement("div"),this.element.classList.add(Ru()),vt.viewProps.bindClassModifiers(this.element),vt.viewProps.bindTabIndex(this.element);const Rt=ht.createElement("div");Rt.classList.add(Ru("b")),this.element.appendChild(Rt);const Kt=ht.createElement("div");Kt.classList.add(Ru("c")),Rt.appendChild(Kt),this.colorElem_=Kt;const In=ht.createElement("div");In.classList.add(Ru("m")),this.element.appendChild(In),this.markerElem_=In;const Bn=ht.createElement("div");Bn.classList.add(Ru("p")),this.markerElem_.appendChild(Bn),this.previewElem_=Bn,this.update_()}update_(){const ht=this.value.rawValue,vt=ht.getComponents("rgb"),Rt=new jo([vt[0],vt[1],vt[2],0],"rgb"),Kt=new jo([vt[0],vt[1],vt[2],255],"rgb"),In=["to right",Gy(Rt),Gy(Kt)];this.colorElem_.style.background=`linear-gradient(${In.join(",")})`,this.previewElem_.style.backgroundColor=Gy(ht);const Bn=Rl(vt[3],0,1,0,100);this.markerElem_.style.left=`${Bn}%`}onValueChange_(){this.update_()}}class i_{constructor(ht,vt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=vt.value,this.viewProps=vt.viewProps,this.view=new V0(ht,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ms(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(ht,vt){if(!ht.point)return;const Rt=ht.point.x/ht.bounds.width,Kt=this.value.rawValue,[In,Bn,hr]=Kt.getComponents("hsv");this.value.setRawValue(new jo([In,Bn,hr,Rt],"hsv"),vt)}onPointerDown_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!1,last:!1})}onPointerMove_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!1,last:!1})}onPointerUp_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!0,last:!0})}onKeyDown_(ht){const vt=yo(Nr(!0),e_(ht));if(vt===0)return;const Rt=this.value.rawValue,[Kt,In,Bn,hr]=Rt.getComponents("hsv");this.value.setRawValue(new jo([Kt,In,Bn,hr+vt],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ht){yo(Nr(!0),e_(ht))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const xp=Wt("coltxt");class ap{constructor(ht,vt){this.element=ht.createElement("div"),this.element.classList.add(xp()),vt.viewProps.bindClassModifiers(this.element);const Rt=ht.createElement("div");Rt.classList.add(xp("m")),this.modeElem_=function(Bn){const hr=Bn.createElement("select");return hr.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((Ir,us)=>{const no=Bn.createElement("option");return no.textContent=us.text,no.value=us.value,Ir.appendChild(no),Ir},Bn.createDocumentFragment())),hr}(ht),this.modeElem_.classList.add(xp("ms")),Rt.appendChild(this.modeSelectElement),vt.viewProps.bindDisabled(this.modeElem_);const Kt=ht.createElement("div");Kt.classList.add(xp("mm")),Kt.appendChild(Ys(ht,"dropdown")),Rt.appendChild(Kt),this.element.appendChild(Rt);const In=ht.createElement("div");In.classList.add(xp("w")),this.element.appendChild(In),this.textsElem_=In,this.textViews_=vt.textViews,this.applyTextViews_(),gn(vt.colorMode,Bn=>{this.modeElem_.value=Bn})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(ht){this.textViews_=ht,this.applyTextViews_()}applyTextViews_(){Ks(this.textsElem_);const ht=this.element.ownerDocument;this.textViews_.forEach(vt=>{const Rt=ht.createElement("div");Rt.classList.add(xp("c")),Rt.appendChild(vt.element),this.textsElem_.appendChild(Rt)})}}function o0(Mt,ht,vt){const Rt=Fy(Mt,ht)[vt];return new _l({min:0,max:Rt})}function Dv(Mt,ht,vt){return new XA(Mt,{arrayPosition:vt===0?"fst":vt===2?"lst":"mid",baseStep:Nr(!1),parser:ht.parser,props:yn.fromObject({draggingScale:ht.colorType==="float"?.01:1,formatter:(Rt=ht.colorType,os(Rt==="float"?2:0))}),value:un(0,{constraint:o0(ht.colorMode,ht.colorType,vt)}),viewProps:ht.viewProps});var Rt}class ew{constructor(ht,vt){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=vt.colorType,this.parser_=vt.parser,this.value=vt.value,this.viewProps=vt.viewProps,this.colorMode=un(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(ht),this.view=new ap(ht,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(ht){const vt={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},Rt=[Dv(ht,vt,0),Dv(ht,vt,1),Dv(ht,vt,2)];return Rt.forEach((Kt,In)=>{Gs({primary:this.value,secondary:Kt.value,forward:Bn=>Bn.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[In],backward:(Bn,hr)=>{const Ir=this.colorMode.rawValue,us=Bn.rawValue.getComponents(Ir,this.colorType_);return us[In]=hr.rawValue,new jo(mm(n_(us),us[3]),Ir,this.colorType_)}})}),Rt}onModeSelectChange_(ht){const vt=ht.currentTarget;this.colorMode.rawValue=vt.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const G0=Wt("hpl");class H0{constructor(ht,vt){this.onValueChange_=this.onValueChange_.bind(this),this.value=vt.value,this.value.emitter.on("change",this.onValueChange_),this.element=ht.createElement("div"),this.element.classList.add(G0()),vt.viewProps.bindClassModifiers(this.element),vt.viewProps.bindTabIndex(this.element);const Rt=ht.createElement("div");Rt.classList.add(G0("c")),this.element.appendChild(Rt);const Kt=ht.createElement("div");Kt.classList.add(G0("m")),this.element.appendChild(Kt),this.markerElem_=Kt,this.update_()}update_(){const ht=this.value.rawValue,[vt]=ht.getComponents("hsv");this.markerElem_.style.backgroundColor=bx(new jo([vt,100,100],"hsv"));const Rt=Rl(vt,0,360,0,100);this.markerElem_.style.left=`${Rt}%`}onValueChange_(){this.update_()}}class X_{constructor(ht,vt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=vt.value,this.viewProps=vt.viewProps,this.view=new H0(ht,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ms(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(ht,vt){if(!ht.point)return;const Rt=Rl(Pu(ht.point.x,0,ht.bounds.width),0,ht.bounds.width,0,360),Kt=this.value.rawValue,[,In,Bn,hr]=Kt.getComponents("hsv");this.value.setRawValue(new jo([Rt,In,Bn,hr],"hsv"),vt)}onPointerDown_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!1,last:!1})}onPointerMove_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!1,last:!1})}onPointerUp_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!0,last:!0})}onKeyDown_(ht){const vt=yo(Nr(!1),e_(ht));if(vt===0)return;const Rt=this.value.rawValue,[Kt,In,Bn,hr]=Rt.getComponents("hsv");this.value.setRawValue(new jo([Kt+vt,In,Bn,hr],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ht){yo(Nr(!1),e_(ht))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const a0=Wt("svp");class Ex{constructor(ht,vt){this.onValueChange_=this.onValueChange_.bind(this),this.value=vt.value,this.value.emitter.on("change",this.onValueChange_),this.element=ht.createElement("div"),this.element.classList.add(a0()),vt.viewProps.bindClassModifiers(this.element),vt.viewProps.bindTabIndex(this.element);const Rt=ht.createElement("canvas");Rt.height=64,Rt.width=64,Rt.classList.add(a0("c")),this.element.appendChild(Rt),this.canvasElement=Rt;const Kt=ht.createElement("div");Kt.classList.add(a0("m")),this.element.appendChild(Kt),this.markerElem_=Kt,this.update_()}update_(){const ht=function(us){const no=us.ownerDocument.defaultView;return no&&"document"in no?us.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!ht)return;const vt=this.value.rawValue.getComponents("hsv"),Rt=this.canvasElement.width,Kt=this.canvasElement.height,In=ht.getImageData(0,0,Rt,Kt),Bn=In.data;for(let us=0;us<Kt;us++)for(let no=0;no<Rt;no++){const Fl=Rl(no,0,Rt,0,100),Cp=Rl(us,0,Kt,100,0),up=Iv(vt[0],Fl,Cp),l_=4*(us*Rt+no);Bn[l_]=up[0],Bn[l_+1]=up[1],Bn[l_+2]=up[2],Bn[l_+3]=255}ht.putImageData(In,0,0);const hr=Rl(vt[1],0,100,0,100);this.markerElem_.style.left=`${hr}%`;const Ir=Rl(vt[2],0,100,100,0);this.markerElem_.style.top=`${Ir}%`}onValueChange_(){this.update_()}}class tw{constructor(ht,vt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=vt.value,this.viewProps=vt.viewProps,this.view=new Ex(ht,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ms(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(ht,vt){if(!ht.point)return;const Rt=Rl(ht.point.x,0,ht.bounds.width,0,100),Kt=Rl(ht.point.y,0,ht.bounds.height,100,0),[In,,,Bn]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new jo([In,Rt,Kt,Bn],"hsv"),vt)}onPointerDown_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!1,last:!1})}onPointerMove_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!1,last:!1})}onPointerUp_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!0,last:!0})}onKeyDown_(ht){RS(ht.key)&&ht.preventDefault();const[vt,Rt,Kt,In]=this.value.rawValue.getComponents("hsv"),Bn=Nr(!1),hr=yo(Bn,e_(ht)),Ir=yo(Bn,b_(ht));hr===0&&Ir===0||this.value.setRawValue(new jo([vt,Rt+hr,Kt+Ir,In],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ht){const vt=Nr(!1),Rt=yo(vt,e_(ht)),Kt=yo(vt,b_(ht));Rt===0&&Kt===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class z1{constructor(ht,vt){this.value=vt.value,this.viewProps=vt.viewProps,this.hPaletteC_=new X_(ht,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new tw(ht,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=vt.supportsAlpha?{palette:new i_(ht,{value:this.value,viewProps:this.viewProps}),text:new XA(ht,{parser:zu,baseStep:.1,props:yn.fromObject({draggingScale:.01,formatter:os(2)}),value:un(0,{constraint:new _l({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Gs({primary:this.value,secondary:this.alphaIcs_.text.value,forward:Rt=>Rt.rawValue.getComponents()[3],backward:(Rt,Kt)=>{const In=Rt.rawValue.getComponents();return In[3]=Kt.rawValue,new jo(In,Rt.rawValue.mode)}}),this.textC_=new ew(ht,{colorType:vt.colorType,parser:zu,value:this.value,viewProps:this.viewProps}),this.view=new km(ht,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:vt.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const s_=Wt("colsw");class kv{constructor(ht,vt){this.onValueChange_=this.onValueChange_.bind(this),vt.value.emitter.on("change",this.onValueChange_),this.value=vt.value,this.element=ht.createElement("div"),this.element.classList.add(s_()),vt.viewProps.bindClassModifiers(this.element);const Rt=ht.createElement("div");Rt.classList.add(s_("sw")),this.element.appendChild(Rt),this.swatchElem_=Rt;const Kt=ht.createElement("button");Kt.classList.add(s_("b")),vt.viewProps.bindDisabled(Kt),this.element.appendChild(Kt),this.buttonElement=Kt,this.update_()}update_(){const ht=this.value.rawValue;this.swatchElem_.style.backgroundColor=j1(ht)}onValueChange_(){this.update_()}}class Sx{constructor(ht,vt){this.value=vt.value,this.viewProps=vt.viewProps,this.view=new kv(ht,{value:this.value,viewProps:this.viewProps})}}class Q0{constructor(ht,vt){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=vt.value,this.viewProps=vt.viewProps,this.foldable_=xa.create(vt.expanded),this.swatchC_=new Sx(ht,{value:this.value,viewProps:this.viewProps});const Rt=this.swatchC_.view.buttonElement;Rt.addEventListener("blur",this.onButtonBlur_),Rt.addEventListener("click",this.onButtonClick_),this.textC_=new y_(ht,{parser:vt.parser,props:yn.fromObject({formatter:vt.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new OS(ht,{foldable:this.foldable_,pickerLayout:vt.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=vt.pickerLayout==="popup"?new O0(ht,{viewProps:this.viewProps}):null;const Kt=new z1(ht,{colorType:vt.colorType,supportsAlpha:vt.supportsAlpha,value:this.value,viewProps:this.viewProps});Kt.view.allFocusableElements.forEach(In=>{In.addEventListener("blur",this.onPopupChildBlur_),In.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=Kt,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(Kt.view.element),Gs({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:In=>In.rawValue,backward:(In,Bn)=>Bn.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),po(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(ht){if(!this.popC_)return;const vt=this.view.element,Rt=ht.relatedTarget;Rt&&vt.contains(Rt)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(ht){if(!this.popC_)return;const vt=this.popC_.view.element,Rt=Xo(ht);Rt&&vt.contains(Rt)||Rt&&Rt===this.swatchC_.view.buttonElement&&!cr(vt.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(ht){this.popC_?ht.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&ht.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function S_(Mt){return n_(Mt.getComponents("rgb")).reduce((ht,vt)=>ht<<8|255&Math.floor(vt),0)}function nw(Mt){return Mt.getComponents("rgb").reduce((ht,vt,Rt)=>ht<<8|255&Math.floor(Rt===3?255*vt:vt),0)>>>0}function Hy(Mt){return typeof Mt!="number"?jo.black():new jo([(ht=Mt)>>16&255,ht>>8&255,255&ht],"rgb");var ht}function rw(Mt){return typeof Mt!="number"?jo.black():new jo([(ht=Mt)>>24&255,ht>>16&255,ht>>8&255,Rl(255&ht,0,255,0,1)],"rgb");var ht}function W0(Mt){var ht;return!(!(Mt!=null&&Mt.alpha)&&!(!((ht=Mt==null?void 0:Mt.color)===null||ht===void 0)&&ht.alpha))}function Ao(Mt){return Mt?ht=>j1(ht,"0x"):ht=>Om(ht,"0x")}const Qy={id:"input-color-number",type:"input",accept:(Mt,ht)=>{if(typeof Mt!="number"||!function(Rt){return"color"in Rt||"view"in Rt&&Rt.view==="color"}(ht))return null;const vt=U1(ht);return vt?{initialValue:Mt,params:vt}:null},binding:{reader:Mt=>W0(Mt.params)?rw:Hy,equals:jo.equals,writer:Mt=>function(ht){const vt=ht?nw:S_;return(Rt,Kt)=>{w_(Rt,vt(Kt))}}(W0(Mt.params))},controller:Mt=>{const ht=W0(Mt.params),vt="expanded"in Mt.params?Mt.params.expanded:void 0,Rt="picker"in Mt.params?Mt.params.picker:void 0;return new Q0(Mt.document,{colorType:"int",expanded:vt!=null&&vt,formatter:Ao(ht),parser:Cl("int"),pickerLayout:Rt??"popup",supportsAlpha:ht,value:Mt.value,viewProps:Mt.viewProps})}};function o_(Mt){return ht=>function(vt,Rt){return jo.isColorObject(vt)?jo.fromObject(vt,Rt):jo.black(Rt)}(ht,Mt)}function Qo(Mt,ht){return vt=>Mt?xx(vt,ht):Nn(vt,ht)}const lp={id:"input-color-object",type:"input",accept:(Mt,ht)=>{if(!jo.isColorObject(Mt))return null;const vt=U1(ht);return vt?{initialValue:Mt,params:vt}:null},binding:{reader:Mt=>o_(xo(Mt.params)),equals:jo.equals,writer:Mt=>{return Rt=Mt.initialValue,ht=jo.isRgbaColorObject(Rt),vt=xo(Mt.params),(Kt,In)=>{ht?function(Bn,hr,Ir){const us=hr.toRgbaObject(Ir);Bn.writeProperty("r",us.r),Bn.writeProperty("g",us.g),Bn.writeProperty("b",us.b),Bn.writeProperty("a",us.a)}(Kt,In,vt):function(Bn,hr,Ir){const us=hr.toRgbaObject(Ir);Bn.writeProperty("r",us.r),Bn.writeProperty("g",us.g),Bn.writeProperty("b",us.b)}(Kt,In,vt)};var ht,vt,Rt}},controller:Mt=>{var ht;const vt=jo.isRgbaColorObject(Mt.initialValue),Rt="expanded"in Mt.params?Mt.params.expanded:void 0,Kt="picker"in Mt.params?Mt.params.picker:void 0,In=(ht=xo(Mt.params))!==null&&ht!==void 0?ht:"int";return new Q0(Mt.document,{colorType:In,expanded:Rt!=null&&Rt,formatter:Qo(vt,In),parser:Cl(In),pickerLayout:Kt??"popup",supportsAlpha:vt,value:Mt.value,viewProps:Mt.viewProps})}},_f={id:"input-color-string",type:"input",accept:(Mt,ht)=>{if(typeof Mt!="string"||"view"in ht&&ht.view==="text")return null;const vt=_b(Mt,xo(ht));if(!vt||!Np(vt))return null;const Rt=U1(ht);return Rt?{initialValue:Mt,params:Rt}:null},binding:{reader:Mt=>{var ht;return function(vt){const Rt=Yl[vt];return Kt=>{if(typeof Kt!="string")return jo.black(vt);const In=Rt.reduce((Bn,hr)=>Bn||hr(Kt),null);return In??jo.black(vt)}}((ht=xo(Mt.params))!==null&&ht!==void 0?ht:"int")},equals:jo.equals,writer:Mt=>{const ht=_b(Mt.initialValue,xo(Mt.params));if(!ht)throw jt.shouldNeverHappen();const vt=function(Rt){const Kt=Np(Rt);return Kt?(In,Bn)=>{w_(In,Kt(Bn))}:null}(ht);if(!vt)throw jt.notBindable();return vt}},controller:Mt=>{const ht=_b(Mt.initialValue,xo(Mt.params));if(!ht)throw jt.shouldNeverHappen();const vt=Np(ht);if(!vt)throw jt.shouldNeverHappen();const Rt="expanded"in Mt.params?Mt.params.expanded:void 0,Kt="picker"in Mt.params?Mt.params.picker:void 0;return new Q0(Mt.document,{colorType:ht.type,expanded:Rt!=null&&Rt,formatter:vt,parser:Cl(ht.type),pickerLayout:Kt??"popup",supportsAlpha:ht.alpha,value:Mt.value,viewProps:Mt.viewProps})}};class Up{constructor(ht){this.components=ht.components,this.asm_=ht.assembly}constrain(ht){const vt=this.asm_.toComponents(ht).map((Rt,Kt)=>{var In,Bn;return(Bn=(In=this.components[Kt])===null||In===void 0?void 0:In.constrain(Rt))!==null&&Bn!==void 0?Bn:Rt});return this.asm_.fromComponents(vt)}}const _d=Wt("pndtxt");class Wy{constructor(ht,vt){this.textViews=vt.textViews,this.element=ht.createElement("div"),this.element.classList.add(_d()),this.textViews.forEach(Rt=>{const Kt=ht.createElement("div");Kt.classList.add(_d("a")),Kt.appendChild(Rt.element),this.element.appendChild(Kt)})}}class iw{constructor(ht,vt){this.value=vt.value,this.viewProps=vt.viewProps,this.acs_=vt.axes.map((Rt,Kt)=>function(In,Bn,hr){return new XA(In,{arrayPosition:hr===0?"fst":hr===Bn.axes.length-1?"lst":"mid",baseStep:Bn.axes[hr].baseStep,parser:Bn.parser,props:Bn.axes[hr].textProps,value:un(0,{constraint:Bn.axes[hr].constraint}),viewProps:Bn.viewProps})}(ht,vt,Kt)),this.acs_.forEach((Rt,Kt)=>{Gs({primary:this.value,secondary:Rt.value,forward:In=>vt.assembly.toComponents(In.rawValue)[Kt],backward:(In,Bn)=>{const hr=vt.assembly.toComponents(In.rawValue);return hr[Kt]=Bn.rawValue,vt.assembly.fromComponents(hr)}})}),this.view=new Wy(ht,{textViews:this.acs_.map(Rt=>Rt.view)})}}function q0(Mt,ht){return"step"in Mt&&!kt(Mt.step)?new Jm(Mt.step,ht):null}function X0(Mt){return kt(Mt.max)||kt(Mt.min)?kt(Mt.max)&&kt(Mt.min)?null:new k0({max:Mt.max,min:Mt.min}):new _l({max:Mt.max,min:Mt.min})}const Cx={id:"input-number",type:"input",accept:(Mt,ht)=>{if(typeof Mt!="number")return null;const vt=tr,Rt=Un(ht,{format:vt.optional.function,max:vt.optional.number,min:vt.optional.number,options:vt.optional.custom(bp),step:vt.optional.number});return Rt?{initialValue:Mt,params:Rt}:null},binding:{reader:Mt=>A_,constraint:Mt=>function(ht,vt){const Rt=[],Kt=q0(ht,vt);Kt&&Rt.push(Kt);const In=X0(ht);In&&Rt.push(In);const Bn=$A(ht.options);return Bn&&Rt.push(Bn),new Zl(Rt)}(Mt.params,Mt.initialValue),writer:Mt=>w_},controller:Mt=>{var ht;const vt=Mt.value,Rt=Mt.constraint,Kt=Rt&&na(Rt,Im);if(Kt)return new fm(Mt.document,{props:new yn({options:Kt.values.value("options")}),value:vt,viewProps:Mt.viewProps});const In=(ht="format"in Mt.params?Mt.params.format:void 0)!==null&&ht!==void 0?ht:os(vx(Rt,vt.rawValue)),Bn=Rt&&na(Rt,_l);return Bn?new Ny(Mt.document,{baseStep:N0(Rt),parser:zu,sliderProps:new yn({maxValue:Bn.values.value("max"),minValue:Bn.values.value("min")}),textProps:yn.fromObject({draggingScale:U0(Rt,vt.rawValue),formatter:In}),value:vt,viewProps:Mt.viewProps}):new XA(Mt.document,{baseStep:N0(Rt),parser:zu,props:yn.fromObject({draggingScale:U0(Rt,vt.rawValue),formatter:In}),value:vt,viewProps:Mt.viewProps})}};class Y_{constructor(ht=0,vt=0){this.x=ht,this.y=vt}getComponents(){return[this.x,this.y]}static isObject(ht){if(kt(ht))return!1;const vt=ht.x,Rt=ht.y;return typeof vt=="number"&&typeof Rt=="number"}static equals(ht,vt){return ht.x===vt.x&&ht.y===vt.y}toObject(){return{x:this.x,y:this.y}}}const l0={toComponents:Mt=>Mt.getComponents(),fromComponents:Mt=>new Y_(...Mt)},Fp=Wt("p2d");class c0{constructor(ht,vt){this.element=ht.createElement("div"),this.element.classList.add(Fp()),vt.viewProps.bindClassModifiers(this.element),gn(vt.expanded,_n(this.element,Fp(void 0,"expanded")));const Rt=ht.createElement("div");Rt.classList.add(Fp("h")),this.element.appendChild(Rt);const Kt=ht.createElement("button");Kt.classList.add(Fp("b")),Kt.appendChild(Ys(ht,"p2dpad")),vt.viewProps.bindDisabled(Kt),Rt.appendChild(Kt),this.buttonElement=Kt;const In=ht.createElement("div");if(In.classList.add(Fp("t")),Rt.appendChild(In),this.textElement=In,vt.pickerLayout==="inline"){const Bn=ht.createElement("div");Bn.classList.add(Fp("p")),this.element.appendChild(Bn),this.pickerElement=Bn}else this.pickerElement=null}}const Wo=Wt("p2dp");class Y0{constructor(ht,vt){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=vt.invertsY,this.maxValue_=vt.maxValue,this.element=ht.createElement("div"),this.element.classList.add(Wo()),vt.layout==="popup"&&this.element.classList.add(Wo(void 0,"p")),vt.viewProps.bindClassModifiers(this.element);const Rt=ht.createElement("div");Rt.classList.add(Wo("p")),vt.viewProps.bindTabIndex(Rt),this.element.appendChild(Rt),this.padElement=Rt;const Kt=ht.createElementNS(Vn,"svg");Kt.classList.add(Wo("g")),this.padElement.appendChild(Kt),this.svgElem_=Kt;const In=ht.createElementNS(Vn,"line");In.classList.add(Wo("ax")),In.setAttributeNS(null,"x1","0"),In.setAttributeNS(null,"y1","50%"),In.setAttributeNS(null,"x2","100%"),In.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(In);const Bn=ht.createElementNS(Vn,"line");Bn.classList.add(Wo("ax")),Bn.setAttributeNS(null,"x1","50%"),Bn.setAttributeNS(null,"y1","0"),Bn.setAttributeNS(null,"x2","50%"),Bn.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(Bn);const hr=ht.createElementNS(Vn,"line");hr.classList.add(Wo("l")),hr.setAttributeNS(null,"x1","50%"),hr.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(hr),this.lineElem_=hr;const Ir=ht.createElement("div");Ir.classList.add(Wo("m")),this.padElement.appendChild(Ir),this.markerElem_=Ir,vt.value.emitter.on("change",this.onValueChange_),this.value=vt.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[ht,vt]=this.value.rawValue.getComponents(),Rt=this.maxValue_,Kt=Rl(ht,-Rt,+Rt,0,100),In=Rl(vt,-Rt,+Rt,0,100),Bn=this.invertsY_?100-In:In;this.lineElem_.setAttributeNS(null,"x2",`${Kt}%`),this.lineElem_.setAttributeNS(null,"y2",`${Bn}%`),this.markerElem_.style.left=`${Kt}%`,this.markerElem_.style.top=`${Bn}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Bm(Mt,ht,vt){return[yo(ht[0],e_(Mt)),yo(ht[1],b_(Mt))*(vt?1:-1)]}class $_{constructor(ht,vt){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=vt.value,this.viewProps=vt.viewProps,this.baseSteps_=vt.baseSteps,this.maxValue_=vt.maxValue,this.invertsY_=vt.invertsY,this.view=new Y0(ht,{invertsY:this.invertsY_,layout:vt.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ms(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(ht,vt){if(!ht.point)return;const Rt=this.maxValue_,Kt=Rl(ht.point.x,0,ht.bounds.width,-Rt,+Rt),In=Rl(this.invertsY_?ht.bounds.height-ht.point.y:ht.point.y,0,ht.bounds.height,-Rt,+Rt);this.value.setRawValue(new Y_(Kt,In),vt)}onPointerDown_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!1,last:!1})}onPointerMove_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!1,last:!1})}onPointerUp_(ht){this.handlePointerEvent_(ht.data,{forceEmit:!0,last:!0})}onPadKeyDown_(ht){RS(ht.key)&&ht.preventDefault();const[vt,Rt]=Bm(ht,this.baseSteps_,this.invertsY_);vt===0&&Rt===0||this.value.setRawValue(new Y_(this.value.rawValue.x+vt,this.value.rawValue.y+Rt),{forceEmit:!1,last:!1})}onPadKeyUp_(ht){const[vt,Rt]=Bm(ht,this.baseSteps_,this.invertsY_);vt===0&&Rt===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class $0{constructor(ht,vt){var Rt,Kt;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=vt.value,this.viewProps=vt.viewProps,this.foldable_=xa.create(vt.expanded),this.popC_=vt.pickerLayout==="popup"?new O0(ht,{viewProps:this.viewProps}):null;const In=new $_(ht,{baseSteps:[vt.axes[0].baseStep,vt.axes[1].baseStep],invertsY:vt.invertsY,layout:vt.pickerLayout,maxValue:vt.maxValue,value:this.value,viewProps:this.viewProps});In.view.allFocusableElements.forEach(Bn=>{Bn.addEventListener("blur",this.onPopupChildBlur_),Bn.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=In,this.textC_=new iw(ht,{assembly:l0,axes:vt.axes,parser:vt.parser,value:this.value,viewProps:this.viewProps}),this.view=new c0(ht,{expanded:this.foldable_.value("expanded"),pickerLayout:vt.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(Rt=this.view.buttonElement)===null||Rt===void 0||Rt.addEventListener("blur",this.onPadButtonBlur_),(Kt=this.view.buttonElement)===null||Kt===void 0||Kt.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Gs({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Bn=>Bn.rawValue,backward:(Bn,hr)=>hr.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),po(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(ht){if(!this.popC_)return;const vt=this.view.element,Rt=ht.relatedTarget;Rt&&vt.contains(Rt)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(ht){if(!this.popC_)return;const vt=this.popC_.view.element,Rt=Xo(ht);Rt&&vt.contains(Rt)||Rt&&Rt===this.view.buttonElement&&!cr(vt.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(ht){this.popC_?ht.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&ht.key==="Escape"&&this.view.buttonElement.focus()}}class u0{constructor(ht=0,vt=0,Rt=0){this.x=ht,this.y=vt,this.z=Rt}getComponents(){return[this.x,this.y,this.z]}static isObject(ht){if(kt(ht))return!1;const vt=ht.x,Rt=ht.y,Kt=ht.z;return typeof vt=="number"&&typeof Rt=="number"&&typeof Kt=="number"}static equals(ht,vt){return ht.x===vt.x&&ht.y===vt.y&&ht.z===vt.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const V1={toComponents:Mt=>Mt.getComponents(),fromComponents:Mt=>new u0(...Mt)};function G1(Mt){return u0.isObject(Mt)?new u0(Mt.x,Mt.y,Mt.z):new u0}function ga(Mt,ht){Mt.writeProperty("x",ht.x),Mt.writeProperty("y",ht.y),Mt.writeProperty("z",ht.z)}function jp(Mt,ht){return{baseStep:N0(ht),constraint:ht,textProps:yn.fromObject({draggingScale:U0(ht,Mt),formatter:os(vx(ht,Mt))})}}const Vu={id:"input-point3d",type:"input",accept:(Mt,ht)=>{if(!u0.isObject(Mt))return null;const vt=tr,Rt=Un(ht,{x:vt.optional.custom(wp),y:vt.optional.custom(wp),z:vt.optional.custom(wp)});return Rt?{initialValue:Mt,params:Rt}:null},binding:{reader:Mt=>G1,constraint:Mt=>{return ht=Mt.params,vt=Mt.initialValue,new Up({assembly:V1,components:[Ul("x"in ht?ht.x:void 0,vt.x),Ul("y"in ht?ht.y:void 0,vt.y),Ul("z"in ht?ht.z:void 0,vt.z)]});var ht,vt},equals:u0.equals,writer:Mt=>ga},controller:Mt=>{const ht=Mt.value,vt=Mt.constraint;if(!(vt instanceof Up))throw jt.shouldNeverHappen();return new iw(Mt.document,{assembly:V1,axes:[jp(ht.rawValue.x,vt.components[0]),jp(ht.rawValue.y,vt.components[1]),jp(ht.rawValue.z,vt.components[2])],parser:zu,value:ht,viewProps:Mt.viewProps})}};class C_{constructor(ht=0,vt=0,Rt=0,Kt=0){this.x=ht,this.y=vt,this.z=Rt,this.w=Kt}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(ht){if(kt(ht))return!1;const vt=ht.x,Rt=ht.y,Kt=ht.z,In=ht.w;return typeof vt=="number"&&typeof Rt=="number"&&typeof Kt=="number"&&typeof In=="number"}static equals(ht,vt){return ht.x===vt.x&&ht.y===vt.y&&ht.z===vt.z&&ht.w===vt.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const vm={toComponents:Mt=>Mt.getComponents(),fromComponents:Mt=>new C_(...Mt)};function Ep(Mt){return C_.isObject(Mt)?new C_(Mt.x,Mt.y,Mt.z,Mt.w):new C_}function K_(Mt,ht){Mt.writeProperty("x",ht.x),Mt.writeProperty("y",ht.y),Mt.writeProperty("z",ht.z),Mt.writeProperty("w",ht.w)}const T_={id:"input-point4d",type:"input",accept:(Mt,ht)=>{if(!C_.isObject(Mt))return null;const vt=tr,Rt=Un(ht,{x:vt.optional.custom(wp),y:vt.optional.custom(wp),z:vt.optional.custom(wp),w:vt.optional.custom(wp)});return Rt?{initialValue:Mt,params:Rt}:null},binding:{reader:Mt=>Ep,constraint:Mt=>{return ht=Mt.params,vt=Mt.initialValue,new Up({assembly:vm,components:[Ul("x"in ht?ht.x:void 0,vt.x),Ul("y"in ht?ht.y:void 0,vt.y),Ul("z"in ht?ht.z:void 0,vt.z),Ul("w"in ht?ht.w:void 0,vt.w)]});var ht,vt},equals:C_.equals,writer:Mt=>K_},controller:Mt=>{const ht=Mt.value,vt=Mt.constraint;if(!(vt instanceof Up))throw jt.shouldNeverHappen();return new iw(Mt.document,{assembly:vm,axes:ht.rawValue.getComponents().map((Rt,Kt)=>{return In=Rt,{baseStep:N0(Bn=vt.components[Kt]),constraint:Bn,textProps:yn.fromObject({draggingScale:U0(Bn,In),formatter:os(vx(Bn,In))})};var In,Bn}),parser:zu,value:ht,viewProps:Mt.viewProps})}},h0={id:"input-string",type:"input",accept:(Mt,ht)=>{if(typeof Mt!="string")return null;const vt=Un(ht,{options:tr.optional.custom(bp)});return vt?{initialValue:Mt,params:vt}:null},binding:{reader:Mt=>s0,constraint:Mt=>function(ht){const vt=[],Rt=$A(ht.options);return Rt&&vt.push(Rt),new Zl(vt)}(Mt.params),writer:Mt=>w_},controller:Mt=>{const ht=Mt.document,vt=Mt.value,Rt=Mt.constraint,Kt=Rt&&na(Rt,Im);return Kt?new fm(ht,{props:new yn({options:Kt.values.value("options")}),value:vt,viewProps:Mt.viewProps}):new y_(ht,{parser:In=>In,props:yn.fromObject({formatter:_g}),value:vt,viewProps:Mt.viewProps})}},J_={monitor:{defaultInterval:200,defaultLineCount:3}},K0=Wt("mll");class qy{constructor(ht,vt){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=vt.formatter,this.element=ht.createElement("div"),this.element.classList.add(K0()),vt.viewProps.bindClassModifiers(this.element);const Rt=ht.createElement("textarea");Rt.classList.add(K0("i")),Rt.style.height=`calc(var(--bld-us) * ${vt.lineCount})`,Rt.readOnly=!0,vt.viewProps.bindDisabled(Rt),this.element.appendChild(Rt),this.textareaElem_=Rt,vt.value.emitter.on("change",this.onValueUpdate_),this.value=vt.value,this.update_()}update_(){const ht=this.textareaElem_,vt=ht.scrollTop===ht.scrollHeight-ht.clientHeight,Rt=[];this.value.rawValue.forEach(Kt=>{Kt!==void 0&&Rt.push(this.formatter_(Kt))}),ht.textContent=Rt.join(`
`),vt&&(ht.scrollTop=ht.scrollHeight)}onValueUpdate_(){this.update_()}}class Du{constructor(ht,vt){this.value=vt.value,this.viewProps=vt.viewProps,this.view=new qy(ht,{formatter:vt.formatter,lineCount:vt.lineCount,value:this.value,viewProps:this.viewProps})}}const Xy=Wt("sgl");class cp{constructor(ht,vt){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=vt.formatter,this.element=ht.createElement("div"),this.element.classList.add(Xy()),vt.viewProps.bindClassModifiers(this.element);const Rt=ht.createElement("input");Rt.classList.add(Xy("i")),Rt.readOnly=!0,Rt.type="text",vt.viewProps.bindDisabled(Rt),this.element.appendChild(Rt),this.inputElement=Rt,vt.value.emitter.on("change",this.onValueUpdate_),this.value=vt.value,this.update_()}update_(){const ht=this.value.rawValue,vt=ht[ht.length-1];this.inputElement.value=vt!==void 0?this.formatter_(vt):""}onValueUpdate_(){this.update_()}}class sw{constructor(ht,vt){this.value=vt.value,this.viewProps=vt.viewProps,this.view=new cp(ht,{formatter:vt.formatter,value:this.value,viewProps:this.viewProps})}}const Z_={id:"monitor-bool",type:"monitor",accept:(Mt,ht)=>{if(typeof Mt!="boolean")return null;const vt=Un(ht,{lineCount:tr.optional.number});return vt?{initialValue:Mt,params:vt}:null},binding:{reader:Mt=>ns},controller:Mt=>{var ht;return Mt.value.rawValue.length===1?new sw(Mt.document,{formatter:Lp,value:Mt.value,viewProps:Mt.viewProps}):new Du(Mt.document,{formatter:Lp,lineCount:(ht=Mt.params.lineCount)!==null&&ht!==void 0?ht:J_.monitor.defaultLineCount,value:Mt.value,viewProps:Mt.viewProps})}},ep=Wt("grl");class ow{constructor(ht,vt){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=ht.createElement("div"),this.element.classList.add(ep()),vt.viewProps.bindClassModifiers(this.element),this.formatter_=vt.formatter,this.props_=vt.props,this.cursor_=vt.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const Rt=ht.createElementNS(Vn,"svg");Rt.classList.add(ep("g")),Rt.style.height=`calc(var(--bld-us) * ${vt.lineCount})`,this.element.appendChild(Rt),this.svgElem_=Rt;const Kt=ht.createElementNS(Vn,"polyline");this.svgElem_.appendChild(Kt),this.lineElem_=Kt;const In=ht.createElement("div");In.classList.add(ep("t"),Wt("tt")()),this.element.appendChild(In),this.tooltipElem_=In,vt.value.emitter.on("change",this.onValueUpdate_),this.value=vt.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const ht=this.svgElem_.getBoundingClientRect(),vt=this.value.rawValue.length-1,Rt=this.props_.get("minValue"),Kt=this.props_.get("maxValue"),In=[];this.value.rawValue.forEach((no,Fl)=>{if(no===void 0)return;const Cp=Rl(Fl,0,vt,0,ht.width),up=Rl(no,Rt,Kt,ht.height,0);In.push([Cp,up].join(","))}),this.lineElem_.setAttributeNS(null,"points",In.join(" "));const Bn=this.tooltipElem_,hr=this.value.rawValue[this.cursor_.rawValue];if(hr===void 0)return void Bn.classList.remove(ep("t","a"));const Ir=Rl(this.cursor_.rawValue,0,vt,0,ht.width),us=Rl(hr,Rt,Kt,ht.height,0);Bn.style.left=`${Ir}px`,Bn.style.top=`${us}px`,Bn.textContent=`${this.formatter_(hr)}`,Bn.classList.contains(ep("t","a"))||(Bn.classList.add(ep("t","a"),ep("t","in")),Rr(Bn),Bn.classList.remove(ep("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class d0{constructor(ht,vt){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=vt.props,this.value=vt.value,this.viewProps=vt.viewProps,this.cursor_=un(-1),this.view=new ow(ht,{cursor:this.cursor_,formatter:vt.formatter,lineCount:vt.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),cr(ht)){const Rt=new ms(this.view.element);Rt.emitter.on("down",this.onGraphPointerDown_),Rt.emitter.on("move",this.onGraphPointerMove_),Rt.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(ht){const vt=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Rl(ht.offsetX,0,vt.width,0,this.value.rawValue.length))}onGraphPointerDown_(ht){this.onGraphPointerMove_(ht)}onGraphPointerMove_(ht){ht.data.point?this.cursor_.rawValue=Math.floor(Rl(ht.data.point.x,0,ht.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function ps(Mt){return"format"in Mt&&!kt(Mt.format)?Mt.format:os(2)}function _u(Mt){return"view"in Mt&&Mt.view==="graph"}const a_={id:"monitor-number",type:"monitor",accept:(Mt,ht)=>{if(typeof Mt!="number")return null;const vt=tr,Rt=Un(ht,{format:vt.optional.function,lineCount:vt.optional.number,max:vt.optional.number,min:vt.optional.number,view:vt.optional.string});return Rt?{initialValue:Mt,params:Rt}:null},binding:{defaultBufferSize:Mt=>_u(Mt)?64:1,reader:Mt=>A_},controller:Mt=>_u(Mt.params)?function(ht){var vt,Rt,Kt;return new d0(ht.document,{formatter:ps(ht.params),lineCount:(vt=ht.params.lineCount)!==null&&vt!==void 0?vt:J_.monitor.defaultLineCount,props:yn.fromObject({maxValue:(Rt="max"in ht.params?ht.params.max:null)!==null&&Rt!==void 0?Rt:100,minValue:(Kt="min"in ht.params?ht.params.min:null)!==null&&Kt!==void 0?Kt:0}),value:ht.value,viewProps:ht.viewProps})}(Mt):function(ht){var vt;return ht.value.rawValue.length===1?new sw(ht.document,{formatter:ps(ht.params),value:ht.value,viewProps:ht.viewProps}):new Du(ht.document,{formatter:ps(ht.params),lineCount:(vt=ht.params.lineCount)!==null&&vt!==void 0?vt:J_.monitor.defaultLineCount,value:ht.value,viewProps:ht.viewProps})}(Mt)},ev={id:"monitor-string",type:"monitor",accept:(Mt,ht)=>{if(typeof Mt!="string")return null;const vt=tr,Rt=Un(ht,{lineCount:vt.optional.number,multiline:vt.optional.boolean});return Rt?{initialValue:Mt,params:Rt}:null},binding:{reader:Mt=>s0},controller:Mt=>{var ht;const vt=Mt.value;return vt.rawValue.length>1||"multiline"in Mt.params&&Mt.params.multiline?new Du(Mt.document,{formatter:_g,lineCount:(ht=Mt.params.lineCount)!==null&&ht!==void 0?ht:J_.monitor.defaultLineCount,value:vt,viewProps:Mt.viewProps}):new sw(Mt.document,{formatter:_g,value:vt,viewProps:Mt.viewProps})}};function Tx(Mt,ht){return ht===0?new Ku:new op(Mt,ht??J_.monitor.defaultInterval)}class em{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(ht){ht.type==="blade"?this.pluginsMap_.blades.unshift(ht):ht.type==="input"?this.pluginsMap_.inputs.unshift(ht):ht.type==="monitor"&&this.pluginsMap_.monitors.unshift(ht)}createInput(ht,vt,Rt){if(kt(vt.read()))throw new jt({context:{key:vt.key},type:"nomatchingcontroller"});const Kt=this.pluginsMap_.inputs.reduce((In,Bn)=>In??function(hr,Ir){const us=hr.accept(Ir.target.read(),Ir.params);if(kt(us))return null;const no=tr,Fl={target:Ir.target,initialValue:us.initialValue,params:us.params},Cp=hr.binding.reader(Fl),up=hr.binding.constraint?hr.binding.constraint(Fl):void 0,l_=un(Cp(us.initialValue),{constraint:up,equals:hr.binding.equals}),nv=new Ju({reader:Cp,target:Ir.target,value:l_,writer:hr.binding.writer(Fl)}),Ov=no.optional.boolean(Ir.params.disabled).value,aw=no.optional.boolean(Ir.params.hidden).value,Ky=hr.controller({constraint:up,document:Ir.document,initialValue:us.initialValue,params:us.params,value:nv.value,viewProps:br.create({disabled:Ov,hidden:aw})}),f0=no.optional.string(Ir.params.label).value;return new ou(Ir.document,{binding:nv,blade:Pl(),props:yn.fromObject({label:f0??Ir.target.key}),valueController:Ky})}(Bn,{document:ht,target:vt,params:Rt}),null);if(Kt)return Kt;throw new jt({context:{key:vt.key},type:"nomatchingcontroller"})}createMonitor(ht,vt,Rt){const Kt=this.pluginsMap_.monitors.reduce((In,Bn)=>In??function(hr,Ir){var us,no,Fl;const Cp=tr,up=hr.accept(Ir.target.read(),Ir.params);if(kt(up))return null;const l_={target:Ir.target,initialValue:up.initialValue,params:up.params},nv=hr.binding.reader(l_),Ov=(no=(us=Cp.optional.number(Ir.params.bufferSize).value)!==null&&us!==void 0?us:hr.binding.defaultBufferSize&&hr.binding.defaultBufferSize(up.params))!==null&&no!==void 0?no:1,aw=Cp.optional.number(Ir.params.interval).value,Ky=new r0({reader:nv,target:Ir.target,ticker:Tx(Ir.document,aw),value:Nl(Ov)}),f0=Cp.optional.boolean(Ir.params.disabled).value,Jy=Cp.optional.boolean(Ir.params.hidden).value,Ix=hr.controller({document:Ir.document,params:up.params,value:Ky.value,viewProps:br.create({disabled:f0,hidden:Jy})}),hp=(Fl=Cp.optional.string(Ir.params.label).value)!==null&&Fl!==void 0?Fl:Ir.target.key;return new au(Ir.document,{binding:Ky,blade:Pl(),props:yn.fromObject({label:hp}),valueController:Ix})}(Bn,{document:ht,params:Rt,target:vt}),null);if(Kt)return Kt;throw new jt({context:{key:vt.key},type:"nomatchingcontroller"})}createBlade(ht,vt){const Rt=this.pluginsMap_.blades.reduce((Kt,In)=>Kt??function(Bn,hr){const Ir=Bn.accept(hr.params);if(!Ir)return null;const us=tr.optional.boolean(hr.params.disabled).value,no=tr.optional.boolean(hr.params.hidden).value;return Bn.controller({blade:Pl(),document:hr.document,params:Object.assign(Object.assign({},Ir.params),{disabled:us,hidden:no}),viewProps:br.create({disabled:us,hidden:no})})}(In,{document:ht,params:vt}),null);if(!Rt)throw new jt({type:"nomatchingview",context:{params:vt}});return Rt}createBladeApi(ht){if(ht instanceof ou)return new Ho(ht);if(ht instanceof au)return new Uo(ht);if(ht instanceof Zo)return new xl(ht,this);const vt=this.pluginsMap_.blades.reduce((Rt,Kt)=>Rt??Kt.api({controller:ht,pool:this}),null);if(!vt)throw jt.shouldNeverHappen();return vt}}function tv(Mt){return Y_.isObject(Mt)?new Y_(Mt.x,Mt.y):new Y_}function Yy(Mt,ht){Mt.writeProperty("x",ht.x),Mt.writeProperty("y",ht.y)}function Ul(Mt,ht){if(!Mt)return;const vt=[],Rt=q0(Mt,ht);Rt&&vt.push(Rt);const Kt=X0(Mt);return Kt&&vt.push(Kt),new Zl(vt)}function $y(Mt,ht){const[vt,Rt]=Mt?function(In){const Bn=na(In,_l);if(Bn)return[Bn.values.get("min"),Bn.values.get("max")];const hr=na(In,k0);return hr?[hr.minValue,hr.maxValue]:[void 0,void 0]}(Mt):[];if(!kt(vt)||!kt(Rt))return Math.max(Math.abs(vt??0),Math.abs(Rt??0));const Kt=N0(Mt);return Math.max(10*Math.abs(Kt),10*Math.abs(ht))}function Hl(Mt,ht){const vt=ht instanceof Up?ht.components[0]:void 0,Rt=ht instanceof Up?ht.components[1]:void 0,Kt=$y(vt,Mt.x),In=$y(Rt,Mt.y);return Math.max(Kt,In)}function H1(Mt,ht){return{baseStep:N0(ht),constraint:ht,textProps:yn.fromObject({draggingScale:U0(ht,Mt),formatter:os(vx(ht,Mt))})}}function p0(Mt){if(!("y"in Mt))return!1;const ht=Mt.y;return!!ht&&"inverted"in ht&&!!ht.inverted}const Q1={id:"input-point2d",type:"input",accept:(Mt,ht)=>{if(!Y_.isObject(Mt))return null;const vt=tr,Rt=Un(ht,{expanded:vt.optional.boolean,picker:vt.optional.custom(_x),x:vt.optional.custom(wp),y:vt.optional.object({inverted:vt.optional.boolean,max:vt.optional.number,min:vt.optional.number,step:vt.optional.number})});return Rt?{initialValue:Mt,params:Rt}:null},binding:{reader:Mt=>tv,constraint:Mt=>{return ht=Mt.params,vt=Mt.initialValue,new Up({assembly:l0,components:[Ul("x"in ht?ht.x:void 0,vt.x),Ul("y"in ht?ht.y:void 0,vt.y)]});var ht,vt},equals:Y_.equals,writer:Mt=>Yy},controller:Mt=>{const ht=Mt.document,vt=Mt.value,Rt=Mt.constraint;if(!(Rt instanceof Up))throw jt.shouldNeverHappen();const Kt="expanded"in Mt.params?Mt.params.expanded:void 0,In="picker"in Mt.params?Mt.params.picker:void 0;return new $0(ht,{axes:[H1(vt.rawValue.x,Rt.components[0]),H1(vt.rawValue.y,Rt.components[1])],expanded:Kt!=null&&Kt,invertsY:p0(Mt.params),maxValue:Hl(vt.rawValue,Rt),parser:zu,pickerLayout:In??"popup",value:vt,viewProps:Mt.viewProps})}};class J0 extends tt{constructor(ht){super(ht),this.emitter_=new vn,this.controller_.valueController.value.emitter.on("change",vt=>{this.emitter_.emit("change",{event:new ut(this,vt.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(ht){this.controller_.props.set("label",ht)}get options(){return this.controller_.valueController.props.get("options")}set options(ht){this.controller_.valueController.props.set("options",ht)}get value(){return this.controller_.valueController.value.rawValue}set value(ht){this.controller_.valueController.value.rawValue=ht}on(ht,vt){const Rt=vt.bind(this);return this.emitter_.on(ht,Kt=>{Rt(Kt.event)}),this}}class tm extends tt{constructor(ht){super(ht),this.emitter_=new vn,this.controller_.valueController.value.emitter.on("change",vt=>{this.emitter_.emit("change",{event:new ut(this,vt.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(ht){this.controller_.props.set("label",ht)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(ht){this.controller_.valueController.sliderController.props.set("maxValue",ht)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(ht){this.controller_.valueController.sliderController.props.set("minValue",ht)}get value(){return this.controller_.valueController.value.rawValue}set value(ht){this.controller_.valueController.value.rawValue=ht}on(ht,vt){const Rt=vt.bind(this);return this.emitter_.on(ht,Kt=>{Rt(Kt.event)}),this}}class Z0 extends tt{constructor(ht){super(ht),this.emitter_=new vn,this.controller_.valueController.value.emitter.on("change",vt=>{this.emitter_.emit("change",{event:new ut(this,vt.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(ht){this.controller_.props.set("label",ht)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(ht){this.controller_.valueController.props.set("formatter",ht)}get value(){return this.controller_.valueController.value.rawValue}set value(ht){this.controller_.valueController.value.rawValue=ht}on(ht,vt){const Rt=vt.bind(this);return this.emitter_.on(ht,Kt=>{Rt(Kt.event)}),this}}const Sp={id:"list",type:"blade",accept(Mt){const ht=tr,vt=Un(Mt,{options:ht.required.custom(bp),value:ht.required.raw,view:ht.required.constant("list"),label:ht.optional.string});return vt?{params:vt}:null},controller(Mt){const ht=new Im(YA(Mt.params.options)),vt=un(Mt.params.value,{constraint:ht}),Rt=new fm(Mt.document,{props:new yn({options:ht.values.value("options")}),value:vt,viewProps:Mt.viewProps});return new Bs(Mt.document,{blade:Mt.blade,props:yn.fromObject({label:Mt.params.label}),valueController:Rt})},api(Mt){return Mt.controller instanceof Bs&&Mt.controller.valueController instanceof fm?new J0(Mt.controller):null}};class ku extends fu{constructor(ht,vt){super(ht,vt)}get element(){return this.controller_.view.element}importPreset(ht){(function(vt,Rt){vt.forEach(Kt=>{const In=Rt[Kt.target.presetKey];In!==void 0&&Kt.writer(Kt.target,Kt.reader(In))})})(this.controller_.rackController.rack.find(ou).map(vt=>vt.binding),ht),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(ou).map(ht=>ht.binding.target).reduce((ht,vt)=>Object.assign(ht,{[vt.presetKey]:vt.read()}),{})}refresh(){this.controller_.rackController.rack.find(ou).forEach(ht=>{ht.binding.read()}),this.controller_.rackController.rack.find(au).forEach(ht=>{ht.binding.read()})}}class vs extends Jl{constructor(ht,vt){super(ht,{expanded:vt.expanded,blade:vt.blade,props:vt.props,root:!0,viewProps:vt.viewProps})}}const Dl={id:"slider",type:"blade",accept(Mt){const ht=tr,vt=Un(Mt,{max:ht.required.number,min:ht.required.number,view:ht.required.constant("slider"),format:ht.optional.function,label:ht.optional.string,value:ht.optional.number});return vt?{params:vt}:null},controller(Mt){var ht,vt;const Rt=(ht=Mt.params.value)!==null&&ht!==void 0?ht:0,Kt=new _l({max:Mt.params.max,min:Mt.params.min}),In=new Ny(Mt.document,{baseStep:1,parser:zu,sliderProps:new yn({maxValue:Kt.values.value("max"),minValue:Kt.values.value("min")}),textProps:yn.fromObject({draggingScale:U0(void 0,Rt),formatter:(vt=Mt.params.format)!==null&&vt!==void 0?vt:gu}),value:un(Rt,{constraint:Kt}),viewProps:Mt.viewProps});return new Bs(Mt.document,{blade:Mt.blade,props:yn.fromObject({label:Mt.params.label}),valueController:In})},api(Mt){return Mt.controller instanceof Bs&&Mt.controller.valueController instanceof Ny?new tm(Mt.controller):null}},W1={id:"text",type:"blade",accept(Mt){const ht=tr,vt=Un(Mt,{parse:ht.required.function,value:ht.required.raw,view:ht.required.constant("text"),format:ht.optional.function,label:ht.optional.string});return vt?{params:vt}:null},controller(Mt){var ht;const vt=new y_(Mt.document,{parser:Mt.params.parse,props:yn.fromObject({formatter:(ht=Mt.params.format)!==null&&ht!==void 0?ht:Rt=>String(Rt)}),value:un(Mt.params.value),viewProps:Mt.viewProps});return new Bs(Mt.document,{blade:Mt.blade,props:yn.fromObject({label:Mt.params.label}),valueController:vt})},api(Mt){return Mt.controller instanceof Bs&&Mt.controller.valueController instanceof y_?new Z0(Mt.controller):null}};function nm(Mt,ht,vt){if(Mt.querySelector(`style[data-tp-style=${ht}]`))return;const Rt=Mt.createElement("style");Rt.dataset.tpStyle=ht,Rt.textContent=vt,Mt.head.appendChild(Rt)}const Mx=new class{constructor(Mt){const[ht,vt]=Mt.split("-"),Rt=ht.split(".");this.major=parseInt(Rt[0],10),this.minor=parseInt(Rt[1],10),this.patch=parseInt(Rt[2],10),this.prerelease=vt??null}toString(){const Mt=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[Mt,this.prerelease].join("-"):Mt}}("3.1.6");g.BladeApi=tt,g.ButtonApi=Gt,g.FolderApi=fu,g.InputBindingApi=Ho,g.ListApi=J0,g.MonitorBindingApi=Uo,g.Pane=class extends ku{constructor(Mt){var ht,vt;const Rt=Mt??{},Kt=(ht=Rt.document)!==null&&ht!==void 0?ht:Hr(),In=function(){const Bn=new em;return[Q1,Vu,T_,h0,Cx,_f,lp,Qy,x_,Z_,ev,a_,Fu,ju,Ns,Ko].forEach(hr=>{Bn.register(hr)}),Bn}();super(new vs(Kt,{expanded:Rt.expanded,blade:Pl(),props:yn.fromObject({title:Rt.title}),viewProps:br.create()}),In),this.pool_=In,this.containerElem_=(vt=Rt.container)!==null&&vt!==void 0?vt:function(Bn){const hr=Bn.createElement("div");return hr.classList.add(Wt("dfw")()),Bn.body&&Bn.body.appendChild(hr),hr}(Kt),this.containerElem_.appendChild(this.element),this.doc_=Kt,this.usesDefaultWrapper_=!Rt.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw jt.alreadyDisposed();return this.doc_}dispose(){const Mt=this.containerElem_;if(!Mt)throw jt.alreadyDisposed();if(this.usesDefaultWrapper_){const ht=Mt.parentElement;ht&&ht.removeChild(Mt)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(Mt){("plugin"in Mt?[Mt.plugin]:"plugins"in Mt?Mt.plugins:[]).forEach(ht=>{this.pool_.register(ht),this.embedPluginStyle_(ht)})}embedPluginStyle_(Mt){Mt.css&&nm(this.document,`plugin-${Mt.id}`,Mt.css)}setUpDefaultPlugins_(){nm(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(Mt=>{this.embedPluginStyle_(Mt)}),this.registerPlugin({plugins:[Dl,Sp,Ko,W1]})}},g.SeparatorApi=Ds,g.SliderApi=tm,g.TabApi=ao,g.TabPageApi=Ls,g.TextApi=Z0,g.TpChangeEvent=ut,g.VERSION=Mx,Object.defineProperty(g,"__esModule",{value:!0})})(b)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor($){super($),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}transform($,b){return $?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0($,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload($=!0,b=!1){return $&&super.preload(),b&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var $;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),($=eval(jsContent+`
DracoEncoderModule;`))==null?void 0:$()}),this.encoderPending}async initDecoder(){var $;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async b=>b.text()).then(b=>{const g=b.indexOf("/* worker */");if(g<1)throw new Error("unable to load decoder module");return b.substring(0,g-1)});return($=eval(jsContent+`
DracoDecoderModule;`))==null?void 0:$()}async _loadLibrary($,b){return DRACOLoader2.LibraryValueMap[$]?DRACOLoader2.LibraryValueMap[$]:DRACOLoader2.LibraryValueMap[$]=await super._loadLibrary($,b)}static SetDecoderJsString($){this.LibraryValueMap["draco_decoder.js"]=$}}DRACOLoader2.LibraryValueMap={}},988:function($,b,g){g.d(b,{$TI:function(){return gP},$V:function(){return vP},$Vf:function(){return RO},$YQ:function(){return sy},A5E:function(){return Yy},AXT:function(){return pM},Aip:function(){return Wu},B02:function(){return kt},BFQ:function(){return Ko},BG$:function(){return _c},BKK:function(){return EP},BVF:function(){return Kn},BVQ:function(){return Tw},BbS:function(){return hP},Bf4:function(){return po},BtG:function(){return lw},CJI:function(){return Du},CP7:function(){return Ux},CaW:function(){return Km},CdI:function(){return fr},Cne:function(){return LO},CtA:function(){return Yo},CtF:function(){return Hu},D1R:function(){return Gl},D9w:function(){return ao},DT1:function(){return PO},Djp:function(){return Op},DqL:function(){return CM},DvJ:function(){return rv},E2K:function(){return $a},EB7:function(){return mE},EJi:function(){return J2},EoG:function(){return Xo},F5T:function(){return cp},FDw:function(){return Io},FE5:function(){return Kx},FIo:function(){return TC},FM8:function(){return Nr},FT0:function(){return EM},FUD:function(){return jr},FvO:function(){return GM},GG6:function(){return O0},GQ:function(){return CO},GUF:function(){return yo},GVz:function(){return j1},GZb:function(){return OE},G_r:function(){return e_},Gih:function(){return Jp},Gql:function(){return vO},H$k:function(){return $x},HTd:function(){return kp},HW6:function(){return qo},HdW:function(){return Pm},HgB:function(){return vx},HkE:function(){return oE},Hmr:function(){return kM},Hw6:function(){return Rv},Hy8:function(){return hn},Hyl:function(){return p_},IEO:function(){return zx},IFH:function(){return fx},IKL:function(){return wM},ILR:function(){return op},IOt:function(){return Zm},Ilk:function(){return ps},Ir4:function(){return $A},JOQ:function(){return im},JQ4:function(){return Jl},JUT:function(){return bx},JWc:function(){return wp},KI_:function(){return Gs},Kgo:function(){return Mw},KhW:function(){return zn},Kj0:function(){return hp},Kz5:function(){return Mm},L5g:function(){return Hm},L5s:function(){return Gv},LBq:function(){return zM},LSk:function(){return Uy},LY2:function(){return pu},L_r:function(){return KA},Lcc:function(){return UO},LgZ:function(){return Un},LsT:function(){return Po},Ltg:function(){return Cl},Lun:function(){return vw},M5h:function(){return _n},M6v:function(){return xs},M8C:function(){return U1},Mig:function(){return ME},MyG:function(){return zo},N$j:function(){return Hp},N4l:function(){return ln},NDo:function(){return oo},NMF:function(){return W_},NYV:function(){return fm},Ns1:function(){return Ys},NwF:function(){return x0},Ny0:function(){return gE},O7d:function(){return Rw},OAl:function(){return kS},OM3:function(){return Dl},OTo:function(){return fs},OdW:function(){return aA},OoA:function(){return ou},Ox3:function(){return PM},PA7:function(){return s0},PMe:function(){return IM},Pa4:function(){return Nn},PeU:function(){return gt},Pnf:function(){return i0},PpQ:function(){return JA},QM0:function(){return YA},QRU:function(){return Hv},QZ1:function(){return _x},QmN:function(){return ut},Qpg:function(){return Nw},R2R:function(){return SM},REq:function(){return kO},RNb:function(){return H1},ROQ:function(){return H2},RSm:function(){return eP},Rki:function(){return Qv},RlZ:function(){return br},RsA:function(){return ot},RvT:function(){return L1},S2y:function(){return It},S3k:function(){return Qu},S9g:function(){return X0},SJI:function(){return BM},SPe:function(){return z2},SUY:function(){return s1},Se2:function(){return dn},Sm8:function(){return en},So8:function(){return hv},SvJ:function(){return ns},Syv:function(){return ks},T95:function(){return To},TOt:function(){return bC},TUj:function(){return Gm},TUv:function(){return d_},T_1:function(){return WC},T_J:function(){return mx},T__:function(){return hM},T_f:function(){return RM},TlE:function(){return Hl},Tme:function(){return ga},Tn7:function(){return SE},TyD:function(){return Uo},U7:function(){return W2},USm:function(){return q0},UY4:function(){return Ew},UZH:function(){return tt},Uk6:function(){return Jx},UlW:function(){return L0},Uol:function(){return cv},V1s:function(){return zS},V4E:function(){return BO},VLJ:function(){return C0},VYz:function(){return S0},Vdb:function(){return rr},Vj0:function(){return zp},Vkp:function(){return xo},VzW:function(){return ju},W2J:function(){return w_},WMw:function(){return gn},WTc:function(){return p0},WXh:function(){return Ow},Wbm:function(){return tn},WdD:function(){return Eo},Wid:function(){return bM},Wjw:function(){return DO},Wl3:function(){return sn},Wpd:function(){return sr},Wqd:function(){return _M},WwZ:function(){return yl},Wzm:function(){return cM},XZw:function(){return NO},Xaj:function(){return Ut},Xcj:function(){return xO},XvJ:function(){return EE},Y8D:function(){return En},YBo:function(){return xM},YGz:function(){return ko},YKA:function(){return Q_},YLQ:function(){return au},YN5:function(){return TO},YT8:function(){return dM},Ywn:function(){return jS},Z6B:function(){return U0},ZAu:function(){return pp},ZQ6:function(){return fM},ZRs:function(){return Rl},ZTh:function(){return $s},ZZA:function(){return e1},Z_g:function(){return uM},Zp0:function(){return i1},Zr5:function(){return kn},ZzF:function(){return E_},Zzh:function(){return zC},_12:function(){return M_},_3:function(){return MO},_AM:function(){return Ju},_C8:function(){return ru},_Li:function(){return Gt},_MY:function(){return Ft},_YM:function(){return zv},_YX:function(){return HM},_am:function(){return zT},_fP:function(){return _m},_iA:function(){return Xt},_kC:function(){return jm},_lf:function(){return Mv},_sL:function(){return Ly},a$l:function(){return vs},aCh:function(){return _g},aH4:function(){return Ap},aLr:function(){return s_},aNw:function(){return O_},aVm:function(){return J0},ad5:function(){return RS},anP:function(){return Fr},aq0:function(){return wA},av9:function(){return wu},b5g:function(){return oC},bBp:function(){return fP},bGH:function(){return Qt},b_z:function(){return uy},bdR:function(){return on},blk:function(){return lv},bnF:function(){return pA},brP:function(){return to},bsb:function(){return Lp},c8b:function(){return un},cBI:function(){return SO},cBK:function(){return TM},cJO:function(){return Dw},cLu:function(){return Bs},cPb:function(){return rm},cRx:function(){return Js},cU9:function(){return zl},ce8:function(){return ms},cek:function(){return Bw},cum:function(){return Ny},dSO:function(){return Bl},dUE:function(){return t1},dYG:function(){return nP},dZ3:function(){return Fu},dd2:function(){return _h},dj0:function(){return bp},dpR:function(){return RC},dwk:function(){return jt},e62:function(){return ku},eD:function(){return Rr},eMJ:function(){return Dm},eaV:function(){return Nl},ehD:function(){return vn},ejS:function(){return av},ekQ:function(){return na},epp:function(){return lu},fHI:function(){return hA},fO1:function(){return G2},fQA:function(){return bP},fQK:function(){return iC},fSK:function(){return Jn},fY$:function(){return Pl},fto:function(){return r0},g8_:function(){return Go},gH0:function(){return FM},gSk:function(){return Sl},g_z:function(){return yC},ghN:function(){return yn},gi4:function(){return Jm},gti:function(){return mM},hEm:function(){return Ls},hH6:function(){return wm},iAb:function(){return Zo},iDF:function(){return jv},iKG:function(){return HS},iLg:function(){return w0},iMs:function(){return dv},iUV:function(){return Ml},iWC:function(){return Yn},iWj:function(){return Y1},i_9:function(){return OM},iiP:function(){return y_},irR:function(){return Fo},j4z:function(){return N1},j87:function(){return Z0},jAl:function(){return By},jFi:function(){return Wt},jZA:function(){return Im},jfJ:function(){return t_},jwo:function(){return gx},jyi:function(){return ay},jyz:function(){return Bv},k0A:function(){return Ds},k74:function(){return tr},kB5:function(){return oy},kFz:function(){return Gy},kaV:function(){return tP},knz:function(){return gu},kqm:function(){return dP},ksN:function(){return cr},l0P:function(){return Zl},l8J:function(){return N0},lCJ:function(){return Sp},lDi:function(){return OC},lGU:function(){return Tv},lLk:function(){return PC},lRF:function(){return _w},lRj:function(){return Tm},lb7:function(){return bm},lfu:function(){return Qp},lk7:function(){return E0},m7l:function(){return py},mSO:function(){return Zu},mTL:function(){return lP},mXe:function(){return _E},m_w:function(){return IO},mzJ:function(){return bO},nls:function(){return Um},ntZ:function(){return qt},ntt:function(){return b_},nvb:function(){return xP},o8S:function(){return dy},oAp:function(){return VT},oa8:function(){return Yx},oqc:function(){return Pu},p3g:function(){return Om},p7y:function(){return Cw},pBf:function(){return x_},pIN:function(){return B0},pKu:function(){return Bp},pQR:function(){return Xx},ptH:function(){return _l},qhX:function(){return ls},qkB:function(){return El},qlB:function(){return tm},qyh:function(){return fu},rAo:function(){return Q1},rBU:function(){return hs},rDY:function(){return jT},rOj:function(){return bn},r_:function(){return Yt},rnI:function(){return A_},rpg:function(){return su},s4_:function(){return oP},sYA:function(){return fy},tEQ:function(){return TE},tGC:function(){return wP},tJx:function(){return Ay},tUh:function(){return Fm},tf:function(){return FC},tm_:function(){return xt},trn:function(){return WM},u37:function(){return yO},u7G:function(){return r1},u9r:function(){return Kt},uEv:function(){return Rm},uL9:function(){return Ks},uWy:function(){return Ho},uXU:function(){return XA},ub3:function(){return nn},ujx:function(){return OO},v3W:function(){return Ku},v9Y:function(){return eu},vBJ:function(){return a_},vCF:function(){return Vn},vCx:function(){return mu},vZf:function(){return Cv},vmT:function(){return zm},vpT:function(){return Am},vuL:function(){return Oo},vxC:function(){return xa},w$m:function(){return Hr},wJv:function(){return Ll},wem:function(){return xl},wk1:function(){return Ns},woe:function(){return fC},wuA:function(){return $u},x12:function(){return Tl},x5V:function(){return Zp},xEZ:function(){return Yl},xG9:function(){return EO},xJs:function(){return H_},xWb:function(){return jC},xeV:function(){return oM},xfE:function(){return wo},xo$:function(){return kw},xoR:function(){return Z2},xsS:function(){return D_},y$t:function(){return uA},y2t:function(){return k0},y8_:function(){return kE},yC1:function(){return Vv},yGw:function(){return Ao},ybr:function(){return Aw},yj7:function(){return Q2},ylh:function(){return _P},yo9:function(){return yw},yt0:function(){return DS},ywz:function(){return sp},yxD:function(){return iP},z$h:function(){return zu},z81:function(){return os},z8B:function(){return jx},zHn:function(){return W0},zbs:function(){return rP},zf8:function(){return cy}});const tt="152",ot={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ut={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},gt=0,xt=1,It=2,kt=3,Ft=0,Xt=1,qt=2,jt=3,sn=0,Gt=1,vn=2,nn=2,Wt=0,on=1,gn=2,ln=3,_n=4,Ut=5,Qt=100,tn=101,bn=102,Yt=103,en=104,un=200,yn=201,zn=202,Yn=203,tr=204,Un=205,Jn=206,hn=207,rr=208,sr=209,br=210,Kn=0,dn=1,kn=2,Vn=3,Rr=4,cr=5,Hr=6,xs=7,Ys=0,ls=1,oo=2,Ks=0,Xo=1,fr=2,ko=3,pu=4,Fu=5,wo=300,Pl=301,xa=302,Bl=303,po=304,Go=306,su=1e3,Ho=1001,ou=1002,Uo=1003,au=1004,kp=1004,Ap=1005,Cv=1005,xl=1006,fu=1007,Tm=1007,Gl=1008,Io=1008,sp=1009,To=1010,Zo=1011,Po=1012,Mm=1013,Jl=1014,ju=1015,Bs=1016,Ds=1017,Fo=1018,Ll=1020,fs=1021,Ns=1023,En=1024,Js=1025,El=1026,to=1027,Ls=1028,ao=1029,wu=1030,Yo=1031,$a=1033,$u=33776,Ko=33777,Ku=33778,op=33779,Ju=35840,mu=35841,Nl=35842,Km=35843,r0=36196,Zl=37492,na=37496,_l=37808,Im=37809,k0=37810,Jm=37811,Op=37812,_c=37813,fm=37814,H_=37815,Bp=37816,O0=37817,Jp=37818,jr=37819,y_=37820,ns=37821,Lp=36492,Pm=36283,Oo=36284,$s=36285,Tv=36286,By=2200,Q_=2201,Rm=2202,ks=2300,W_=2301,B0=2302,i0=2400,Mv=2401,Ly=2402,fx=2500,Sl=2501,yl=0,L0=1,zu=2,A_=3e3,gu=3001,os=3200,Zu=3201,Zm=0,s0=1,_g="",Gs="srgb",yo="srgb-linear",b_="display-p3",e_="rgbm-16",RS=0,Zp=7680,ms=7681,Rl=7682,t_=7683,Pu=34055,mx=34056,Dm=5386,zo=512,XA=513,gx=514,DS=515,kS=516,L1=517,N1=518,Ny=519,w_=35044,bp=35048,_x=35040,wp=35045,YA=35049,$A=35041,vx=35046,N0=35050,U0=35042,eu="100",Uy="300 es",KA=1035;class x_{addEventListener(a,_e){this._listeners===void 0&&(this._listeners={});const rt=this._listeners;rt[a]===void 0&&(rt[a]=[]),rt[a].indexOf(_e)===-1&&rt[a].push(_e)}hasEventListener(a,_e){if(this._listeners===void 0)return!1;const rt=this._listeners;return rt[a]!==void 0&&rt[a].indexOf(_e)!==-1}removeEventListener(a,_e){if(this._listeners===void 0)return;const rt=this._listeners[a];if(rt!==void 0){const it=rt.indexOf(_e);it!==-1&&rt.splice(it,1)}}dispatchEvent(a){if(this._listeners===void 0)return;const _e=this._listeners[a.type];if(_e!==void 0){a.target=this;const rt=_e.slice(0);for(let it=0,lt=rt.length;it<lt;it++)rt[it].call(this,a);a.target=null}}}const tu=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let OS=1234567;const Iv=Math.PI/180,n_=180/Math.PI;function mm(){const pt=4294967295*Math.random()|0,a=4294967295*Math.random()|0,_e=4294967295*Math.random()|0,rt=4294967295*Math.random()|0;return(tu[255&pt]+tu[pt>>8&255]+tu[pt>>16&255]+tu[pt>>24&255]+"-"+tu[255&a]+tu[a>>8&255]+"-"+tu[a>>16&15|64]+tu[a>>24&255]+"-"+tu[63&_e|128]+tu[_e>>8&255]+"-"+tu[_e>>16&255]+tu[_e>>24&255]+tu[255&rt]+tu[rt>>8&255]+tu[rt>>16&255]+tu[rt>>24&255]).toLowerCase()}function Us(pt,a,_e){return Math.max(a,Math.min(_e,pt))}function Fy(pt,a){return(pt%a+a)%a}function jy(pt,a,_e){return(1-_e)*pt+_e*a}function zy(pt){return(pt&pt-1)==0&&pt!==0}function jo(pt){return Math.pow(2,Math.ceil(Math.log(pt)/Math.LN2))}function Pv(pt){return Math.pow(2,Math.floor(Math.log(pt)/Math.LN2))}function km(pt,a){switch(a.constructor){case Float32Array:return pt;case Uint16Array:return pt/65535;case Uint8Array:return pt/255;case Int16Array:return Math.max(pt/32767,-1);case Int8Array:return Math.max(pt/127,-1);default:throw new Error("Invalid component type.")}}function Ro(pt,a){switch(a.constructor){case Float32Array:return pt;case Uint16Array:return Math.round(65535*pt);case Uint8Array:return Math.round(255*pt);case Int16Array:return Math.round(32767*pt);case Int8Array:return Math.round(127*pt);default:throw new Error("Invalid component type.")}}const U1={DEG2RAD:Iv,RAD2DEG:n_,generateUUID:mm,clamp:Us,euclideanModulo:Fy,mapLinear:function(pt,a,_e,rt,it){return rt+(pt-a)*(it-rt)/(_e-a)},inverseLerp:function(pt,a,_e){return pt!==a?(_e-pt)/(a-pt):0},lerp:jy,damp:function(pt,a,_e,rt){return jy(pt,a,1-Math.exp(-_e*rt))},pingpong:function(pt,a=1){return a-Math.abs(Fy(pt,2*a)-a)},smoothstep:function(pt,a,_e){return pt<=a?0:pt>=_e?1:(pt=(pt-a)/(_e-a))*pt*(3-2*pt)},smootherstep:function(pt,a,_e){return pt<=a?0:pt>=_e?1:(pt=(pt-a)/(_e-a))*pt*pt*(pt*(6*pt-15)+10)},randInt:function(pt,a){return pt+Math.floor(Math.random()*(a-pt+1))},randFloat:function(pt,a){return pt+Math.random()*(a-pt)},randFloatSpread:function(pt){return pt*(.5-Math.random())},seededRandom:function(pt){pt!==void 0&&(OS=pt);let a=OS+=1831565813;return a=Math.imul(a^a>>>15,1|a),a^=a+Math.imul(a^a>>>7,61|a),((a^a>>>14)>>>0)/4294967296},degToRad:function(pt){return pt*Iv},radToDeg:function(pt){return pt*n_},isPowerOfTwo:zy,ceilPowerOfTwo:jo,floorPowerOfTwo:Pv,setQuaternionFromProperEuler:function(pt,a,_e,rt,it){const lt=Math.cos,ft=Math.sin,_t=lt(_e/2),St=ft(_e/2),Et=lt((a+rt)/2),Tt=ft((a+rt)/2),Bt=lt((a-rt)/2),Ot=ft((a-rt)/2),Lt=lt((rt-a)/2),zt=ft((rt-a)/2);switch(it){case"XYX":pt.set(_t*Tt,St*Bt,St*Ot,_t*Et);break;case"YZY":pt.set(St*Ot,_t*Tt,St*Bt,_t*Et);break;case"ZXZ":pt.set(St*Bt,St*Ot,_t*Tt,_t*Et);break;case"XZX":pt.set(_t*Tt,St*zt,St*Lt,_t*Et);break;case"YXY":pt.set(St*Lt,_t*Tt,St*zt,_t*Et);break;case"ZYZ":pt.set(St*zt,St*Lt,_t*Tt,_t*Et);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+it)}},normalize:Ro,denormalize:km};class Nr{constructor(a=0,_e=0){Nr.prototype.isVector2=!0,this.x=a,this.y=_e}get width(){return this.x}set width(a){this.x=a}get height(){return this.y}set height(a){this.y=a}set(a,_e){return this.x=a,this.y=_e,this}setScalar(a){return this.x=a,this.y=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setComponent(a,_e){switch(a){case 0:this.x=_e;break;case 1:this.y=_e;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y)}copy(a){return this.x=a.x,this.y=a.y,this}add(a){return this.x+=a.x,this.y+=a.y,this}addScalar(a){return this.x+=a,this.y+=a,this}addVectors(a,_e){return this.x=a.x+_e.x,this.y=a.y+_e.y,this}addScaledVector(a,_e){return this.x+=a.x*_e,this.y+=a.y*_e,this}sub(a){return this.x-=a.x,this.y-=a.y,this}subScalar(a){return this.x-=a,this.y-=a,this}subVectors(a,_e){return this.x=a.x-_e.x,this.y=a.y-_e.y,this}multiply(a){return this.x*=a.x,this.y*=a.y,this}multiplyScalar(a){return this.x*=a,this.y*=a,this}divide(a){return this.x/=a.x,this.y/=a.y,this}divideScalar(a){return this.multiplyScalar(1/a)}applyMatrix3(a){const _e=this.x,rt=this.y,it=a.elements;return this.x=it[0]*_e+it[3]*rt+it[6],this.y=it[1]*_e+it[4]*rt+it[7],this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this}clamp(a,_e){return this.x=Math.max(a.x,Math.min(_e.x,this.x)),this.y=Math.max(a.y,Math.min(_e.y,this.y)),this}clampScalar(a,_e){return this.x=Math.max(a,Math.min(_e,this.x)),this.y=Math.max(a,Math.min(_e,this.y)),this}clampLength(a,_e){const rt=this.length();return this.divideScalar(rt||1).multiplyScalar(Math.max(a,Math.min(_e,rt)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(a){return this.x*a.x+this.y*a.y}cross(a){return this.x*a.y-this.y*a.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(a){const _e=Math.sqrt(this.lengthSq()*a.lengthSq());if(_e===0)return Math.PI/2;const rt=this.dot(a)/_e;return Math.acos(Us(rt,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const _e=this.x-a.x,rt=this.y-a.y;return _e*_e+rt*rt}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,_e){return this.x+=(a.x-this.x)*_e,this.y+=(a.y-this.y)*_e,this}lerpVectors(a,_e,rt){return this.x=a.x+(_e.x-a.x)*rt,this.y=a.y+(_e.y-a.y)*rt,this}equals(a){return a.x===this.x&&a.y===this.y}fromArray(a,_e=0){return this.x=a[_e],this.y=a[_e+1],this}toArray(a=[],_e=0){return a[_e]=this.x,a[_e+1]=this.y,a}fromBufferAttribute(a,_e){return this.x=a.getX(_e),this.y=a.getY(_e),this}rotateAround(a,_e){const rt=Math.cos(_e),it=Math.sin(_e),lt=this.x-a.x,ft=this.y-a.y;return this.x=lt*rt-ft*it+a.x,this.y=lt*it+ft*rt+a.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class xo{constructor(){xo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(a,_e,rt,it,lt,ft,_t,St,Et){const Tt=this.elements;return Tt[0]=a,Tt[1]=it,Tt[2]=_t,Tt[3]=_e,Tt[4]=lt,Tt[5]=St,Tt[6]=rt,Tt[7]=ft,Tt[8]=Et,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(a){const _e=this.elements,rt=a.elements;return _e[0]=rt[0],_e[1]=rt[1],_e[2]=rt[2],_e[3]=rt[3],_e[4]=rt[4],_e[5]=rt[5],_e[6]=rt[6],_e[7]=rt[7],_e[8]=rt[8],this}extractBasis(a,_e,rt){return a.setFromMatrix3Column(this,0),_e.setFromMatrix3Column(this,1),rt.setFromMatrix3Column(this,2),this}setFromMatrix4(a){const _e=a.elements;return this.set(_e[0],_e[4],_e[8],_e[1],_e[5],_e[9],_e[2],_e[6],_e[10]),this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,_e){const rt=a.elements,it=_e.elements,lt=this.elements,ft=rt[0],_t=rt[3],St=rt[6],Et=rt[1],Tt=rt[4],Bt=rt[7],Ot=rt[2],Lt=rt[5],zt=rt[8],Jt=it[0],Ht=it[3],$t=it[6],rn=it[1],cn=it[4],Rn=it[7],Cn=it[2],Tn=it[5],Gn=it[8];return lt[0]=ft*Jt+_t*rn+St*Cn,lt[3]=ft*Ht+_t*cn+St*Tn,lt[6]=ft*$t+_t*Rn+St*Gn,lt[1]=Et*Jt+Tt*rn+Bt*Cn,lt[4]=Et*Ht+Tt*cn+Bt*Tn,lt[7]=Et*$t+Tt*Rn+Bt*Gn,lt[2]=Ot*Jt+Lt*rn+zt*Cn,lt[5]=Ot*Ht+Lt*cn+zt*Tn,lt[8]=Ot*$t+Lt*Rn+zt*Gn,this}multiplyScalar(a){const _e=this.elements;return _e[0]*=a,_e[3]*=a,_e[6]*=a,_e[1]*=a,_e[4]*=a,_e[7]*=a,_e[2]*=a,_e[5]*=a,_e[8]*=a,this}determinant(){const a=this.elements,_e=a[0],rt=a[1],it=a[2],lt=a[3],ft=a[4],_t=a[5],St=a[6],Et=a[7],Tt=a[8];return _e*ft*Tt-_e*_t*Et-rt*lt*Tt+rt*_t*St+it*lt*Et-it*ft*St}invert(){const a=this.elements,_e=a[0],rt=a[1],it=a[2],lt=a[3],ft=a[4],_t=a[5],St=a[6],Et=a[7],Tt=a[8],Bt=Tt*ft-_t*Et,Ot=_t*St-Tt*lt,Lt=Et*lt-ft*St,zt=_e*Bt+rt*Ot+it*Lt;if(zt===0)return this.set(0,0,0,0,0,0,0,0,0);const Jt=1/zt;return a[0]=Bt*Jt,a[1]=(it*Et-Tt*rt)*Jt,a[2]=(_t*rt-it*ft)*Jt,a[3]=Ot*Jt,a[4]=(Tt*_e-it*St)*Jt,a[5]=(it*lt-_t*_e)*Jt,a[6]=Lt*Jt,a[7]=(rt*St-Et*_e)*Jt,a[8]=(ft*_e-rt*lt)*Jt,this}transpose(){let a;const _e=this.elements;return a=_e[1],_e[1]=_e[3],_e[3]=a,a=_e[2],_e[2]=_e[6],_e[6]=a,a=_e[5],_e[5]=_e[7],_e[7]=a,this}getNormalMatrix(a){return this.setFromMatrix4(a).invert().transpose()}transposeIntoArray(a){const _e=this.elements;return a[0]=_e[0],a[1]=_e[3],a[2]=_e[6],a[3]=_e[1],a[4]=_e[4],a[5]=_e[7],a[6]=_e[2],a[7]=_e[5],a[8]=_e[8],this}setUvTransform(a,_e,rt,it,lt,ft,_t){const St=Math.cos(lt),Et=Math.sin(lt);return this.set(rt*St,rt*Et,-rt*(St*ft+Et*_t)+ft+a,-it*Et,it*St,-it*(-Et*ft+St*_t)+_t+_e,0,0,1),this}scale(a,_e){return this.premultiply(gm.makeScale(a,_e)),this}rotate(a){return this.premultiply(gm.makeRotation(-a)),this}translate(a,_e){return this.premultiply(gm.makeTranslation(a,_e)),this}makeTranslation(a,_e){return this.set(1,0,a,0,1,_e,0,0,1),this}makeRotation(a){const _e=Math.cos(a),rt=Math.sin(a);return this.set(_e,-rt,0,rt,_e,0,0,0,1),this}makeScale(a,_e){return this.set(a,0,0,0,_e,0,0,0,1),this}equals(a){const _e=this.elements,rt=a.elements;for(let it=0;it<9;it++)if(_e[it]!==rt[it])return!1;return!0}fromArray(a,_e=0){for(let rt=0;rt<9;rt++)this.elements[rt]=a[rt+_e];return this}toArray(a=[],_e=0){const rt=this.elements;return a[_e]=rt[0],a[_e+1]=rt[1],a[_e+2]=rt[2],a[_e+3]=rt[3],a[_e+4]=rt[4],a[_e+5]=rt[5],a[_e+6]=rt[6],a[_e+7]=rt[7],a[_e+8]=rt[8],a}clone(){return new this.constructor().fromArray(this.elements)}}const gm=new xo;function BS(pt){for(let a=pt.length-1;a>=0;--a)if(pt[a]>=65535)return!0;return!1}const LS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function F0(pt,a){return new LS[pt](a)}function Vy(pt){return document.createElementNS("http://www.w3.org/1999/xhtml",pt)}const yx={};function j0(pt){pt in yx||(yx[pt]=!0,console.warn(pt))}function z0(pt){return pt<.04045?.0773993808*pt:Math.pow(.9478672986*pt+.0521327014,2.4)}function Ax(pt){return pt<.0031308?12.92*pt:1.055*Math.pow(pt,.41666)-.055}const NS=new xo().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),F1=new xo().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),US={[yo]:pt=>pt,[Gs]:pt=>pt.convertSRGBToLinear(),[b_]:function(pt){return pt.convertSRGBToLinear().applyMatrix3(F1)}},FS={[yo]:pt=>pt,[Gs]:pt=>pt.convertLinearToSRGB(),[b_]:function(pt){return pt.applyMatrix3(NS).convertLinearToSRGB()}},lu={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(pt){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!pt},get workingColorSpace(){return yo},set workingColorSpace(pt){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(pt,a,_e){if(this.enabled===!1||a===_e||!a||!_e)return pt;const rt=US[a],it=FS[_e];if(rt===void 0||it===void 0)throw new Error(`Unsupported color space conversion, "${a}" to "${_e}".`);return it(rt(pt))},fromWorkingColorSpace:function(pt,a){return this.convert(pt,this.workingColorSpace,a)},toWorkingColorSpace:function(pt,a){return this.convert(pt,a,this.workingColorSpace)}};let r_;class JA{static getDataURL(a,_e=!1){if(/^data:/i.test(a.src)||typeof HTMLCanvasElement>"u")return a.src;let rt;if(a instanceof HTMLCanvasElement)rt=a;else{r_===void 0&&(r_=Vy("canvas")),r_.width=a.width,r_.height=a.height;const it=r_.getContext("2d");a instanceof ImageData?it.putImageData(a,0,0):it.drawImage(a,0,0,a.width,a.height),rt=r_}return!_e&&(rt.width>2048||rt.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",a),rt.toDataURL("image/jpeg",.6)):rt.toDataURL("image/png")}static sRGBToLinear(a){if(typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap){const _e=Vy("canvas");_e.width=a.width,_e.height=a.height;const rt=_e.getContext("2d");rt.drawImage(a,0,0,a.width,a.height);const it=rt.getImageData(0,0,a.width,a.height),lt=it.data;for(let ft=0;ft<lt.length;ft++)lt[ft]=255*z0(lt[ft]/255);return rt.putImageData(it,0,0),_e}if(a.data){const _e=a.data.slice(0);for(let rt=0;rt<_e.length;rt++)_e instanceof Uint8Array||_e instanceof Uint8ClampedArray?_e[rt]=Math.floor(255*z0(_e[rt]/255)):_e[rt]=z0(_e[rt]);return{data:_e,width:a.width,height:a.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),a}}class Rv{constructor(a=null){this.isSource=!0,this.uuid=mm(),this.data=a,this.version=0}set needsUpdate(a){a===!0&&this.version++}toJSON(a){const _e=a===void 0||typeof a=="string";if(!_e&&a.images[this.uuid]!==void 0)return a.images[this.uuid];const rt={uuid:this.uuid,url:""},it=this.data;if(it!==null){let lt;if(Array.isArray(it)){lt=[];for(let ft=0,_t=it.length;ft<_t;ft++)it[ft].isDataTexture?lt.push(ZA(it[ft].image)):lt.push(ZA(it[ft]))}else lt=ZA(it);rt.url=lt}return _e||(a.images[this.uuid]=rt),rt}}function ZA(pt){if(typeof HTMLImageElement<"u"&&pt instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&pt instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&pt instanceof ImageBitmap)return JA.getDataURL(pt);if(pt.data){let a=[];try{a=Array.from(pt.data)}catch(_e){_e.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(_e),a=pt.data}return{data:a,width:pt.width,height:pt.height,type:pt.data.constructor.name}}return pt.url!==void 0?pt.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _b=0;class Yl extends x_{constructor(a=Yl.DEFAULT_IMAGE,_e=Yl.DEFAULT_MAPPING,rt=Ho,it=Ho,lt=xl,ft=Gl,_t=Ns,St=sp,Et=Yl.DEFAULT_ANISOTROPY,Tt=_g){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_b++}),this.uuid=mm(),this.name="",this.source=new Rv(a),this.mipmaps=[],this.mapping=_e,this.channel=0,this.wrapS=rt,this.wrapT=it,this.magFilter=lt,this.minFilter=ft,this.anisotropy=Et,this.format=_t,this.internalFormat=null,this.type=St,this.offset=new Nr(0,0),this.repeat=new Nr(1,1),this.center=new Nr(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new xo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof Tt=="string"?this.colorSpace=Tt:(j0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=Tt===gu?Gs:_g),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(a=null){this.source.data=a}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(a){return this.name=a.name,this.source=a.source,this.mipmaps=a.mipmaps.slice(0),this.mapping=a.mapping,this.channel=a.channel,this.wrapS=a.wrapS,this.wrapT=a.wrapT,this.magFilter=a.magFilter,this.minFilter=a.minFilter,this.anisotropy=a.anisotropy,this.format=a.format,this.internalFormat=a.internalFormat,this.type=a.type,this.offset.copy(a.offset),this.repeat.copy(a.repeat),this.center.copy(a.center),this.rotation=a.rotation,this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrix.copy(a.matrix),this.generateMipmaps=a.generateMipmaps,this.premultiplyAlpha=a.premultiplyAlpha,this.flipY=a.flipY,this.unpackAlignment=a.unpackAlignment,this.colorSpace=a.colorSpace,this.userData=JSON.parse(JSON.stringify(a.userData)),this.needsUpdate=!0,this}toJSON(a){const _e=a===void 0||typeof a=="string";if(!_e&&a.textures[this.uuid]!==void 0)return a.textures[this.uuid];const rt={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(a).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===Gs?gu:A_,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(rt.userData=this.userData),_e||(a.textures[this.uuid]=rt),rt}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(a){if(this.mapping!==wo)return a;if(a.applyMatrix3(this.matrix),a.x<0||a.x>1)switch(this.wrapS){case su:a.x=a.x-Math.floor(a.x);break;case Ho:a.x=a.x<0?0:1;break;case ou:Math.abs(Math.floor(a.x)%2)===1?a.x=Math.ceil(a.x)-a.x:a.x=a.x-Math.floor(a.x)}if(a.y<0||a.y>1)switch(this.wrapT){case su:a.y=a.y-Math.floor(a.y);break;case Ho:a.y=a.y<0?0:1;break;case ou:Math.abs(Math.floor(a.y)%2)===1?a.y=Math.ceil(a.y)-a.y:a.y=a.y-Math.floor(a.y)}return this.flipY&&(a.y=1-a.y),a}set needsUpdate(a){a===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return j0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Gs?gu:A_}set encoding(a){j0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=a===gu?Gs:_g}}Yl.DEFAULT_IMAGE=null,Yl.DEFAULT_MAPPING=wo,Yl.DEFAULT_ANISOTROPY=1;class Cl{constructor(a=0,_e=0,rt=0,it=1){Cl.prototype.isVector4=!0,this.x=a,this.y=_e,this.z=rt,this.w=it}get width(){return this.z}set width(a){this.z=a}get height(){return this.w}set height(a){this.w=a}set(a,_e,rt,it){return this.x=a,this.y=_e,this.z=rt,this.w=it,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this.w=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setW(a){return this.w=a,this}setComponent(a,_e){switch(a){case 0:this.x=_e;break;case 1:this.y=_e;break;case 2:this.z=_e;break;case 3:this.w=_e;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w!==void 0?a.w:1,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this}addVectors(a,_e){return this.x=a.x+_e.x,this.y=a.y+_e.y,this.z=a.z+_e.z,this.w=a.w+_e.w,this}addScaledVector(a,_e){return this.x+=a.x*_e,this.y+=a.y*_e,this.z+=a.z*_e,this.w+=a.w*_e,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this.w-=a,this}subVectors(a,_e){return this.x=a.x-_e.x,this.y=a.y-_e.y,this.z=a.z-_e.z,this.w=a.w-_e.w,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this}applyMatrix4(a){const _e=this.x,rt=this.y,it=this.z,lt=this.w,ft=a.elements;return this.x=ft[0]*_e+ft[4]*rt+ft[8]*it+ft[12]*lt,this.y=ft[1]*_e+ft[5]*rt+ft[9]*it+ft[13]*lt,this.z=ft[2]*_e+ft[6]*rt+ft[10]*it+ft[14]*lt,this.w=ft[3]*_e+ft[7]*rt+ft[11]*it+ft[15]*lt,this}divideScalar(a){return this.multiplyScalar(1/a)}setAxisAngleFromQuaternion(a){this.w=2*Math.acos(a.w);const _e=Math.sqrt(1-a.w*a.w);return _e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/_e,this.y=a.y/_e,this.z=a.z/_e),this}setAxisAngleFromRotationMatrix(a){let _e,rt,it,lt;const St=a.elements,Et=St[0],Tt=St[4],Bt=St[8],Ot=St[1],Lt=St[5],zt=St[9],Jt=St[2],Ht=St[6],$t=St[10];if(Math.abs(Tt-Ot)<.01&&Math.abs(Bt-Jt)<.01&&Math.abs(zt-Ht)<.01){if(Math.abs(Tt+Ot)<.1&&Math.abs(Bt+Jt)<.1&&Math.abs(zt+Ht)<.1&&Math.abs(Et+Lt+$t-3)<.1)return this.set(1,0,0,0),this;_e=Math.PI;const cn=(Et+1)/2,Rn=(Lt+1)/2,Cn=($t+1)/2,Tn=(Tt+Ot)/4,Gn=(Bt+Jt)/4,nr=(zt+Ht)/4;return cn>Rn&&cn>Cn?cn<.01?(rt=0,it=.707106781,lt=.707106781):(rt=Math.sqrt(cn),it=Tn/rt,lt=Gn/rt):Rn>Cn?Rn<.01?(rt=.707106781,it=0,lt=.707106781):(it=Math.sqrt(Rn),rt=Tn/it,lt=nr/it):Cn<.01?(rt=.707106781,it=.707106781,lt=0):(lt=Math.sqrt(Cn),rt=Gn/lt,it=nr/lt),this.set(rt,it,lt,_e),this}let rn=Math.sqrt((Ht-zt)*(Ht-zt)+(Bt-Jt)*(Bt-Jt)+(Ot-Tt)*(Ot-Tt));return Math.abs(rn)<.001&&(rn=1),this.x=(Ht-zt)/rn,this.y=(Bt-Jt)/rn,this.z=(Ot-Tt)/rn,this.w=Math.acos((Et+Lt+$t-1)/2),this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this.w=Math.min(this.w,a.w),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this.w=Math.max(this.w,a.w),this}clamp(a,_e){return this.x=Math.max(a.x,Math.min(_e.x,this.x)),this.y=Math.max(a.y,Math.min(_e.y,this.y)),this.z=Math.max(a.z,Math.min(_e.z,this.z)),this.w=Math.max(a.w,Math.min(_e.w,this.w)),this}clampScalar(a,_e){return this.x=Math.max(a,Math.min(_e,this.x)),this.y=Math.max(a,Math.min(_e,this.y)),this.z=Math.max(a,Math.min(_e,this.z)),this.w=Math.max(a,Math.min(_e,this.w)),this}clampLength(a,_e){const rt=this.length();return this.divideScalar(rt||1).multiplyScalar(Math.max(a,Math.min(_e,rt)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,_e){return this.x+=(a.x-this.x)*_e,this.y+=(a.y-this.y)*_e,this.z+=(a.z-this.z)*_e,this.w+=(a.w-this.w)*_e,this}lerpVectors(a,_e,rt){return this.x=a.x+(_e.x-a.x)*rt,this.y=a.y+(_e.y-a.y)*rt,this.z=a.z+(_e.z-a.z)*rt,this.w=a.w+(_e.w-a.w)*rt,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w}fromArray(a,_e=0){return this.x=a[_e],this.y=a[_e+1],this.z=a[_e+2],this.w=a[_e+3],this}toArray(a=[],_e=0){return a[_e]=this.x,a[_e+1]=this.y,a[_e+2]=this.z,a[_e+3]=this.w,a}fromBufferAttribute(a,_e){return this.x=a.getX(_e),this.y=a.getY(_e),this.z=a.getZ(_e),this.w=a.getW(_e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class _h extends x_{constructor(a=1,_e=1,rt={}){super(),this.isWebGLRenderTarget=!0,this.width=a,this.height=_e,this.depth=1,this.scissor=new Cl(0,0,a,_e),this.scissorTest=!1,this.viewport=new Cl(0,0,a,_e);const it={width:a,height:_e,depth:1};rt.encoding!==void 0&&(j0("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),rt.colorSpace=rt.encoding===gu?Gs:_g),this.texture=new Yl(it,rt.mapping,rt.wrapS,rt.wrapT,rt.magFilter,rt.minFilter,rt.format,rt.type,rt.anisotropy,rt.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=rt.generateMipmaps!==void 0&&rt.generateMipmaps,this.texture.internalFormat=rt.internalFormat!==void 0?rt.internalFormat:null,this.texture.minFilter=rt.minFilter!==void 0?rt.minFilter:xl,this.depthBuffer=rt.depthBuffer===void 0||rt.depthBuffer,this.stencilBuffer=rt.stencilBuffer!==void 0&&rt.stencilBuffer,this.depthTexture=rt.depthTexture!==void 0?rt.depthTexture:null,this.samples=rt.samples!==void 0?rt.samples:0}setSize(a,_e,rt=1){this.width===a&&this.height===_e&&this.depth===rt||(this.width=a,this.height=_e,this.depth=rt,this.texture.image.width=a,this.texture.image.height=_e,this.texture.image.depth=rt,this.dispose()),this.viewport.set(0,0,a,_e),this.scissor.set(0,0,a,_e)}clone(){return new this.constructor().copy(this)}copy(a){this.width=a.width,this.height=a.height,this.depth=a.depth,this.scissor.copy(a.scissor),this.scissorTest=a.scissorTest,this.viewport.copy(a.viewport),this.texture=a.texture.clone(),this.texture.isRenderTargetTexture=!0;const _e=Object.assign({},a.texture.image);return this.texture.source=new Rv(_e),this.depthBuffer=a.depthBuffer,this.stencilBuffer=a.stencilBuffer,a.depthTexture!==null&&(this.depthTexture=a.depthTexture.clone()),this.samples=a.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Om extends Yl{constructor(a=null,_e=1,rt=1,it=1){super(null),this.isDataArrayTexture=!0,this.image={data:a,width:_e,height:rt,depth:it},this.magFilter=Uo,this.minFilter=Uo,this.wrapR=Ho,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class j1 extends _h{constructor(a=1,_e=1,rt=1){super(a,_e),this.isWebGLArrayRenderTarget=!0,this.depth=rt,this.texture=new Om(null,a,_e,rt),this.texture.isRenderTargetTexture=!0}}class bx extends Yl{constructor(a=null,_e=1,rt=1,it=1){super(null),this.isData3DTexture=!0,this.image={data:a,width:_e,height:rt,depth:it},this.magFilter=Uo,this.minFilter=Uo,this.wrapR=Ho,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class jS extends _h{constructor(a=1,_e=1,rt=1){super(a,_e),this.isWebGL3DRenderTarget=!0,this.depth=rt,this.texture=new bx(null,a,_e,rt),this.texture.isRenderTargetTexture=!0}}class Gy extends _h{constructor(a=1,_e=1,rt=1,it={}){super(a,_e,it),this.isWebGLMultipleRenderTargets=!0;const lt=this.texture;this.texture=[];for(let ft=0;ft<rt;ft++)this.texture[ft]=lt.clone(),this.texture[ft].isRenderTargetTexture=!0}setSize(a,_e,rt=1){if(this.width!==a||this.height!==_e||this.depth!==rt){this.width=a,this.height=_e,this.depth=rt;for(let it=0,lt=this.texture.length;it<lt;it++)this.texture[it].image.width=a,this.texture[it].image.height=_e,this.texture[it].image.depth=rt;this.dispose()}return this.viewport.set(0,0,a,_e),this.scissor.set(0,0,a,_e),this}copy(a){this.dispose(),this.width=a.width,this.height=a.height,this.depth=a.depth,this.scissor.copy(a.scissor),this.scissorTest=a.scissorTest,this.viewport.copy(a.viewport),this.depthBuffer=a.depthBuffer,this.stencilBuffer=a.stencilBuffer,a.depthTexture!==null&&(this.depthTexture=a.depthTexture.clone()),this.texture.length=0;for(let _e=0,rt=a.texture.length;_e<rt;_e++)this.texture[_e]=a.texture[_e].clone(),this.texture[_e].isRenderTargetTexture=!0;return this}}class _m{constructor(a=0,_e=0,rt=0,it=1){this.isQuaternion=!0,this._x=a,this._y=_e,this._z=rt,this._w=it}static slerpFlat(a,_e,rt,it,lt,ft,_t){let St=rt[it+0],Et=rt[it+1],Tt=rt[it+2],Bt=rt[it+3];const Ot=lt[ft+0],Lt=lt[ft+1],zt=lt[ft+2],Jt=lt[ft+3];if(_t===0)return a[_e+0]=St,a[_e+1]=Et,a[_e+2]=Tt,void(a[_e+3]=Bt);if(_t===1)return a[_e+0]=Ot,a[_e+1]=Lt,a[_e+2]=zt,void(a[_e+3]=Jt);if(Bt!==Jt||St!==Ot||Et!==Lt||Tt!==zt){let Ht=1-_t;const $t=St*Ot+Et*Lt+Tt*zt+Bt*Jt,rn=$t>=0?1:-1,cn=1-$t*$t;if(cn>Number.EPSILON){const Cn=Math.sqrt(cn),Tn=Math.atan2(Cn,$t*rn);Ht=Math.sin(Ht*Tn)/Cn,_t=Math.sin(_t*Tn)/Cn}const Rn=_t*rn;if(St=St*Ht+Ot*Rn,Et=Et*Ht+Lt*Rn,Tt=Tt*Ht+zt*Rn,Bt=Bt*Ht+Jt*Rn,Ht===1-_t){const Cn=1/Math.sqrt(St*St+Et*Et+Tt*Tt+Bt*Bt);St*=Cn,Et*=Cn,Tt*=Cn,Bt*=Cn}}a[_e]=St,a[_e+1]=Et,a[_e+2]=Tt,a[_e+3]=Bt}static multiplyQuaternionsFlat(a,_e,rt,it,lt,ft){const _t=rt[it],St=rt[it+1],Et=rt[it+2],Tt=rt[it+3],Bt=lt[ft],Ot=lt[ft+1],Lt=lt[ft+2],zt=lt[ft+3];return a[_e]=_t*zt+Tt*Bt+St*Lt-Et*Ot,a[_e+1]=St*zt+Tt*Ot+Et*Bt-_t*Lt,a[_e+2]=Et*zt+Tt*Lt+_t*Ot-St*Bt,a[_e+3]=Tt*zt-_t*Bt-St*Ot-Et*Lt,a}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get w(){return this._w}set w(a){this._w=a,this._onChangeCallback()}set(a,_e,rt,it){return this._x=a,this._y=_e,this._z=rt,this._w=it,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this._onChangeCallback(),this}setFromEuler(a,_e){const rt=a._x,it=a._y,lt=a._z,ft=a._order,_t=Math.cos,St=Math.sin,Et=_t(rt/2),Tt=_t(it/2),Bt=_t(lt/2),Ot=St(rt/2),Lt=St(it/2),zt=St(lt/2);switch(ft){case"XYZ":this._x=Ot*Tt*Bt+Et*Lt*zt,this._y=Et*Lt*Bt-Ot*Tt*zt,this._z=Et*Tt*zt+Ot*Lt*Bt,this._w=Et*Tt*Bt-Ot*Lt*zt;break;case"YXZ":this._x=Ot*Tt*Bt+Et*Lt*zt,this._y=Et*Lt*Bt-Ot*Tt*zt,this._z=Et*Tt*zt-Ot*Lt*Bt,this._w=Et*Tt*Bt+Ot*Lt*zt;break;case"ZXY":this._x=Ot*Tt*Bt-Et*Lt*zt,this._y=Et*Lt*Bt+Ot*Tt*zt,this._z=Et*Tt*zt+Ot*Lt*Bt,this._w=Et*Tt*Bt-Ot*Lt*zt;break;case"ZYX":this._x=Ot*Tt*Bt-Et*Lt*zt,this._y=Et*Lt*Bt+Ot*Tt*zt,this._z=Et*Tt*zt-Ot*Lt*Bt,this._w=Et*Tt*Bt+Ot*Lt*zt;break;case"YZX":this._x=Ot*Tt*Bt+Et*Lt*zt,this._y=Et*Lt*Bt+Ot*Tt*zt,this._z=Et*Tt*zt-Ot*Lt*Bt,this._w=Et*Tt*Bt-Ot*Lt*zt;break;case"XZY":this._x=Ot*Tt*Bt-Et*Lt*zt,this._y=Et*Lt*Bt-Ot*Tt*zt,this._z=Et*Tt*zt+Ot*Lt*Bt,this._w=Et*Tt*Bt+Ot*Lt*zt;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+ft)}return _e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(a,_e){const rt=_e/2,it=Math.sin(rt);return this._x=a.x*it,this._y=a.y*it,this._z=a.z*it,this._w=Math.cos(rt),this._onChangeCallback(),this}setFromRotationMatrix(a){const _e=a.elements,rt=_e[0],it=_e[4],lt=_e[8],ft=_e[1],_t=_e[5],St=_e[9],Et=_e[2],Tt=_e[6],Bt=_e[10],Ot=rt+_t+Bt;if(Ot>0){const Lt=.5/Math.sqrt(Ot+1);this._w=.25/Lt,this._x=(Tt-St)*Lt,this._y=(lt-Et)*Lt,this._z=(ft-it)*Lt}else if(rt>_t&&rt>Bt){const Lt=2*Math.sqrt(1+rt-_t-Bt);this._w=(Tt-St)/Lt,this._x=.25*Lt,this._y=(it+ft)/Lt,this._z=(lt+Et)/Lt}else if(_t>Bt){const Lt=2*Math.sqrt(1+_t-rt-Bt);this._w=(lt-Et)/Lt,this._x=(it+ft)/Lt,this._y=.25*Lt,this._z=(St+Tt)/Lt}else{const Lt=2*Math.sqrt(1+Bt-rt-_t);this._w=(ft-it)/Lt,this._x=(lt+Et)/Lt,this._y=(St+Tt)/Lt,this._z=.25*Lt}return this._onChangeCallback(),this}setFromUnitVectors(a,_e){let rt=a.dot(_e)+1;return rt<Number.EPSILON?(rt=0,Math.abs(a.x)>Math.abs(a.z)?(this._x=-a.y,this._y=a.x,this._z=0,this._w=rt):(this._x=0,this._y=-a.z,this._z=a.y,this._w=rt)):(this._x=a.y*_e.z-a.z*_e.y,this._y=a.z*_e.x-a.x*_e.z,this._z=a.x*_e.y-a.y*_e.x,this._w=rt),this.normalize()}angleTo(a){return 2*Math.acos(Math.abs(Us(this.dot(a),-1,1)))}rotateTowards(a,_e){const rt=this.angleTo(a);if(rt===0)return this;const it=Math.min(1,_e/rt);return this.slerp(a,it),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let a=this.length();return a===0?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this._onChangeCallback(),this}multiply(a){return this.multiplyQuaternions(this,a)}premultiply(a){return this.multiplyQuaternions(a,this)}multiplyQuaternions(a,_e){const rt=a._x,it=a._y,lt=a._z,ft=a._w,_t=_e._x,St=_e._y,Et=_e._z,Tt=_e._w;return this._x=rt*Tt+ft*_t+it*Et-lt*St,this._y=it*Tt+ft*St+lt*_t-rt*Et,this._z=lt*Tt+ft*Et+rt*St-it*_t,this._w=ft*Tt-rt*_t-it*St-lt*Et,this._onChangeCallback(),this}slerp(a,_e){if(_e===0)return this;if(_e===1)return this.copy(a);const rt=this._x,it=this._y,lt=this._z,ft=this._w;let _t=ft*a._w+rt*a._x+it*a._y+lt*a._z;if(_t<0?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,_t=-_t):this.copy(a),_t>=1)return this._w=ft,this._x=rt,this._y=it,this._z=lt,this;const St=1-_t*_t;if(St<=Number.EPSILON){const Lt=1-_e;return this._w=Lt*ft+_e*this._w,this._x=Lt*rt+_e*this._x,this._y=Lt*it+_e*this._y,this._z=Lt*lt+_e*this._z,this.normalize(),this._onChangeCallback(),this}const Et=Math.sqrt(St),Tt=Math.atan2(Et,_t),Bt=Math.sin((1-_e)*Tt)/Et,Ot=Math.sin(_e*Tt)/Et;return this._w=ft*Bt+this._w*Ot,this._x=rt*Bt+this._x*Ot,this._y=it*Bt+this._y*Ot,this._z=lt*Bt+this._z*Ot,this._onChangeCallback(),this}slerpQuaternions(a,_e,rt){return this.copy(a).slerp(_e,rt)}random(){const a=Math.random(),_e=Math.sqrt(1-a),rt=Math.sqrt(a),it=2*Math.PI*Math.random(),lt=2*Math.PI*Math.random();return this.set(_e*Math.cos(it),rt*Math.sin(lt),rt*Math.cos(lt),_e*Math.sin(it))}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w}fromArray(a,_e=0){return this._x=a[_e],this._y=a[_e+1],this._z=a[_e+2],this._w=a[_e+3],this._onChangeCallback(),this}toArray(a=[],_e=0){return a[_e]=this._x,a[_e+1]=this._y,a[_e+2]=this._z,a[_e+3]=this._w,a}fromBufferAttribute(a,_e){return this._x=a.getX(_e),this._y=a.getY(_e),this._z=a.getZ(_e),this._w=a.getW(_e),this}toJSON(){return this.toArray()}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Nn{constructor(a=0,_e=0,rt=0){Nn.prototype.isVector3=!0,this.x=a,this.y=_e,this.z=rt}set(a,_e,rt){return rt===void 0&&(rt=this.z),this.x=a,this.y=_e,this.z=rt,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setComponent(a,_e){switch(a){case 0:this.x=_e;break;case 1:this.y=_e;break;case 2:this.z=_e;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this}addVectors(a,_e){return this.x=a.x+_e.x,this.y=a.y+_e.y,this.z=a.z+_e.z,this}addScaledVector(a,_e){return this.x+=a.x*_e,this.y+=a.y*_e,this.z+=a.z*_e,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this}subVectors(a,_e){return this.x=a.x-_e.x,this.y=a.y-_e.y,this.z=a.z-_e.z,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this}multiplyVectors(a,_e){return this.x=a.x*_e.x,this.y=a.y*_e.y,this.z=a.z*_e.z,this}applyEuler(a){return this.applyQuaternion(xx.setFromEuler(a))}applyAxisAngle(a,_e){return this.applyQuaternion(xx.setFromAxisAngle(a,_e))}applyMatrix3(a){const _e=this.x,rt=this.y,it=this.z,lt=a.elements;return this.x=lt[0]*_e+lt[3]*rt+lt[6]*it,this.y=lt[1]*_e+lt[4]*rt+lt[7]*it,this.z=lt[2]*_e+lt[5]*rt+lt[8]*it,this}applyNormalMatrix(a){return this.applyMatrix3(a).normalize()}applyMatrix4(a){const _e=this.x,rt=this.y,it=this.z,lt=a.elements,ft=1/(lt[3]*_e+lt[7]*rt+lt[11]*it+lt[15]);return this.x=(lt[0]*_e+lt[4]*rt+lt[8]*it+lt[12])*ft,this.y=(lt[1]*_e+lt[5]*rt+lt[9]*it+lt[13])*ft,this.z=(lt[2]*_e+lt[6]*rt+lt[10]*it+lt[14])*ft,this}applyQuaternion(a){const _e=this.x,rt=this.y,it=this.z,lt=a.x,ft=a.y,_t=a.z,St=a.w,Et=St*_e+ft*it-_t*rt,Tt=St*rt+_t*_e-lt*it,Bt=St*it+lt*rt-ft*_e,Ot=-lt*_e-ft*rt-_t*it;return this.x=Et*St+Ot*-lt+Tt*-_t-Bt*-ft,this.y=Tt*St+Ot*-ft+Bt*-lt-Et*-_t,this.z=Bt*St+Ot*-_t+Et*-ft-Tt*-lt,this}project(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)}unproject(a){return this.applyMatrix4(a.projectionMatrixInverse).applyMatrix4(a.matrixWorld)}transformDirection(a){const _e=this.x,rt=this.y,it=this.z,lt=a.elements;return this.x=lt[0]*_e+lt[4]*rt+lt[8]*it,this.y=lt[1]*_e+lt[5]*rt+lt[9]*it,this.z=lt[2]*_e+lt[6]*rt+lt[10]*it,this.normalize()}divide(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this}divideScalar(a){return this.multiplyScalar(1/a)}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this}clamp(a,_e){return this.x=Math.max(a.x,Math.min(_e.x,this.x)),this.y=Math.max(a.y,Math.min(_e.y,this.y)),this.z=Math.max(a.z,Math.min(_e.z,this.z)),this}clampScalar(a,_e){return this.x=Math.max(a,Math.min(_e,this.x)),this.y=Math.max(a,Math.min(_e,this.y)),this.z=Math.max(a,Math.min(_e,this.z)),this}clampLength(a,_e){const rt=this.length();return this.divideScalar(rt||1).multiplyScalar(Math.max(a,Math.min(_e,rt)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,_e){return this.x+=(a.x-this.x)*_e,this.y+=(a.y-this.y)*_e,this.z+=(a.z-this.z)*_e,this}lerpVectors(a,_e,rt){return this.x=a.x+(_e.x-a.x)*rt,this.y=a.y+(_e.y-a.y)*rt,this.z=a.z+(_e.z-a.z)*rt,this}cross(a){return this.crossVectors(this,a)}crossVectors(a,_e){const rt=a.x,it=a.y,lt=a.z,ft=_e.x,_t=_e.y,St=_e.z;return this.x=it*St-lt*_t,this.y=lt*ft-rt*St,this.z=rt*_t-it*ft,this}projectOnVector(a){const _e=a.lengthSq();if(_e===0)return this.set(0,0,0);const rt=a.dot(this)/_e;return this.copy(a).multiplyScalar(rt)}projectOnPlane(a){return wx.copy(this).projectOnVector(a),this.sub(wx)}reflect(a){return this.sub(wx.copy(a).multiplyScalar(2*this.dot(a)))}angleTo(a){const _e=Math.sqrt(this.lengthSq()*a.lengthSq());if(_e===0)return Math.PI/2;const rt=this.dot(a)/_e;return Math.acos(Us(rt,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const _e=this.x-a.x,rt=this.y-a.y,it=this.z-a.z;return _e*_e+rt*rt+it*it}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)}setFromSpherical(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)}setFromSphericalCoords(a,_e,rt){const it=Math.sin(_e)*a;return this.x=it*Math.sin(rt),this.y=Math.cos(_e)*a,this.z=it*Math.cos(rt),this}setFromCylindrical(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)}setFromCylindricalCoords(a,_e,rt){return this.x=a*Math.sin(_e),this.y=rt,this.z=a*Math.cos(_e),this}setFromMatrixPosition(a){const _e=a.elements;return this.x=_e[12],this.y=_e[13],this.z=_e[14],this}setFromMatrixScale(a){const _e=this.setFromMatrixColumn(a,0).length(),rt=this.setFromMatrixColumn(a,1).length(),it=this.setFromMatrixColumn(a,2).length();return this.x=_e,this.y=rt,this.z=it,this}setFromMatrixColumn(a,_e){return this.fromArray(a.elements,4*_e)}setFromMatrix3Column(a,_e){return this.fromArray(a.elements,3*_e)}setFromEuler(a){return this.x=a._x,this.y=a._y,this.z=a._z,this}setFromColor(a){return this.x=a.r,this.y=a.g,this.z=a.b,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z}fromArray(a,_e=0){return this.x=a[_e],this.y=a[_e+1],this.z=a[_e+2],this}toArray(a=[],_e=0){return a[_e]=this.x,a[_e+1]=this.y,a[_e+2]=this.z,a}fromBufferAttribute(a,_e){return this.x=a.getX(_e),this.y=a.getY(_e),this.z=a.getZ(_e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const a=2*(Math.random()-.5),_e=Math.random()*Math.PI*2,rt=Math.sqrt(1-a**2);return this.x=rt*Math.cos(_e),this.y=rt*Math.sin(_e),this.z=a,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const wx=new Nn,xx=new _m;class E_{constructor(a=new Nn(1/0,1/0,1/0),_e=new Nn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=a,this.max=_e}set(a,_e){return this.min.copy(a),this.max.copy(_e),this}setFromArray(a){this.makeEmpty();for(let _e=0,rt=a.length;_e<rt;_e+=3)this.expandByPoint(Np.fromArray(a,_e));return this}setFromBufferAttribute(a){this.makeEmpty();for(let _e=0,rt=a.count;_e<rt;_e++)this.expandByPoint(Np.fromBufferAttribute(a,_e));return this}setFromPoints(a){this.makeEmpty();for(let _e=0,rt=a.length;_e<rt;_e++)this.expandByPoint(a[_e]);return this}setFromCenterAndSize(a,_e){const rt=Np.copy(_e).multiplyScalar(.5);return this.min.copy(a).sub(rt),this.max.copy(a).add(rt),this}setFromObject(a,_e=!1){return this.makeEmpty(),this.expandByObject(a,_e)}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(a){return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}expandByObject(a,_e=!1){if(a.updateWorldMatrix(!1,!1),a.boundingBox!==void 0)a.boundingBox===null&&a.computeBoundingBox(),Ru.copy(a.boundingBox),Ru.applyMatrix4(a.matrixWorld),this.union(Ru);else{const it=a.geometry;if(it!==void 0)if(_e&&it.attributes!==void 0&&it.attributes.position!==void 0){const lt=it.attributes.position;for(let ft=0,_t=lt.count;ft<_t;ft++)Np.fromBufferAttribute(lt,ft).applyMatrix4(a.matrixWorld),this.expandByPoint(Np)}else it.boundingBox===null&&it.computeBoundingBox(),Ru.copy(it.boundingBox),Ru.applyMatrix4(a.matrixWorld),this.union(Ru)}const rt=a.children;for(let it=0,lt=rt.length;it<lt;it++)this.expandByObject(rt[it],_e);return this}containsPoint(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z)}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z}getParameter(a,_e){return _e.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)}intersectsSphere(a){return this.clampPoint(a.center,Np),Np.distanceToSquared(a.center)<=a.radius*a.radius}intersectsPlane(a){let _e,rt;return a.normal.x>0?(_e=a.normal.x*this.min.x,rt=a.normal.x*this.max.x):(_e=a.normal.x*this.max.x,rt=a.normal.x*this.min.x),a.normal.y>0?(_e+=a.normal.y*this.min.y,rt+=a.normal.y*this.max.y):(_e+=a.normal.y*this.max.y,rt+=a.normal.y*this.min.y),a.normal.z>0?(_e+=a.normal.z*this.min.z,rt+=a.normal.z*this.max.z):(_e+=a.normal.z*this.max.z,rt+=a.normal.z*this.min.z),_e<=-a.constant&&rt>=-a.constant}intersectsTriangle(a){if(this.isEmpty())return!1;this.getCenter(ew),G0.subVectors(this.max,ew),V0.subVectors(a.a,ew),i_.subVectors(a.b,ew),xp.subVectors(a.c,ew),ap.subVectors(i_,V0),o0.subVectors(xp,i_),Dv.subVectors(V0,xp);let _e=[0,-ap.z,ap.y,0,-o0.z,o0.y,0,-Dv.z,Dv.y,ap.z,0,-ap.x,o0.z,0,-o0.x,Dv.z,0,-Dv.x,-ap.y,ap.x,0,-o0.y,o0.x,0,-Dv.y,Dv.x,0];return!!a0(_e,V0,i_,xp,G0)&&(_e=[1,0,0,0,1,0,0,0,1],!!a0(_e,V0,i_,xp,G0)&&(H0.crossVectors(ap,o0),_e=[H0.x,H0.y,H0.z],a0(_e,V0,i_,xp,G0)))}clampPoint(a,_e){return _e.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,Np).distanceTo(a)}getBoundingSphere(a){return this.isEmpty()?a.makeEmpty():(this.getCenter(a.center),a.radius=.5*this.getSize(Np).length()),a}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}applyMatrix4(a){return this.isEmpty()||(q_[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a),q_[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a),q_[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a),q_[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a),q_[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a),q_[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a),q_[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a),q_[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a),this.setFromPoints(q_)),this}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}const q_=[new Nn,new Nn,new Nn,new Nn,new Nn,new Nn,new Nn,new Nn],Np=new Nn,Ru=new E_,V0=new Nn,i_=new Nn,xp=new Nn,ap=new Nn,o0=new Nn,Dv=new Nn,ew=new Nn,G0=new Nn,H0=new Nn,X_=new Nn;function a0(pt,a,_e,rt,it){for(let lt=0,ft=pt.length-3;lt<=ft;lt+=3){X_.fromArray(pt,lt);const _t=it.x*Math.abs(X_.x)+it.y*Math.abs(X_.y)+it.z*Math.abs(X_.z),St=a.dot(X_),Et=_e.dot(X_),Tt=rt.dot(X_);if(Math.max(-Math.max(St,Et,Tt),Math.min(St,Et,Tt))>_t)return!1}return!0}const Ex=new E_,tw=new Nn,z1=new Nn;class s_{constructor(a=new Nn,_e=-1){this.center=a,this.radius=_e}set(a,_e){return this.center.copy(a),this.radius=_e,this}setFromPoints(a,_e){const rt=this.center;_e!==void 0?rt.copy(_e):Ex.setFromPoints(a).getCenter(rt);let it=0;for(let lt=0,ft=a.length;lt<ft;lt++)it=Math.max(it,rt.distanceToSquared(a[lt]));return this.radius=Math.sqrt(it),this}copy(a){return this.center.copy(a.center),this.radius=a.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(a){return a.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(a){return a.distanceTo(this.center)-this.radius}intersectsSphere(a){const _e=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=_e*_e}intersectsBox(a){return a.intersectsSphere(this)}intersectsPlane(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius}clampPoint(a,_e){const rt=this.center.distanceToSquared(a);return _e.copy(a),rt>this.radius*this.radius&&(_e.sub(this.center).normalize(),_e.multiplyScalar(this.radius).add(this.center)),_e}getBoundingBox(a){return this.isEmpty()?(a.makeEmpty(),a):(a.set(this.center,this.center),a.expandByScalar(this.radius),a)}applyMatrix4(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this}translate(a){return this.center.add(a),this}expandByPoint(a){if(this.isEmpty())return this.center.copy(a),this.radius=0,this;tw.subVectors(a,this.center);const _e=tw.lengthSq();if(_e>this.radius*this.radius){const rt=Math.sqrt(_e),it=.5*(rt-this.radius);this.center.addScaledVector(tw,it/rt),this.radius+=it}return this}union(a){return a.isEmpty()?this:this.isEmpty()?(this.copy(a),this):(this.center.equals(a.center)===!0?this.radius=Math.max(this.radius,a.radius):(z1.subVectors(a.center,this.center).setLength(a.radius),this.expandByPoint(tw.copy(a.center).add(z1)),this.expandByPoint(tw.copy(a.center).sub(z1))),this)}equals(a){return a.center.equals(this.center)&&a.radius===this.radius}clone(){return new this.constructor().copy(this)}}const kv=new Nn,Sx=new Nn,Q0=new Nn,S_=new Nn,nw=new Nn,Hy=new Nn,rw=new Nn;class W0{constructor(a=new Nn,_e=new Nn(0,0,-1)){this.origin=a,this.direction=_e}set(a,_e){return this.origin.copy(a),this.direction.copy(_e),this}copy(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this}at(a,_e){return _e.copy(this.origin).addScaledVector(this.direction,a)}lookAt(a){return this.direction.copy(a).sub(this.origin).normalize(),this}recast(a){return this.origin.copy(this.at(a,kv)),this}closestPointToPoint(a,_e){_e.subVectors(a,this.origin);const rt=_e.dot(this.direction);return rt<0?_e.copy(this.origin):_e.copy(this.origin).addScaledVector(this.direction,rt)}distanceToPoint(a){return Math.sqrt(this.distanceSqToPoint(a))}distanceSqToPoint(a){const _e=kv.subVectors(a,this.origin).dot(this.direction);return _e<0?this.origin.distanceToSquared(a):(kv.copy(this.origin).addScaledVector(this.direction,_e),kv.distanceToSquared(a))}distanceSqToSegment(a,_e,rt,it){Sx.copy(a).add(_e).multiplyScalar(.5),Q0.copy(_e).sub(a).normalize(),S_.copy(this.origin).sub(Sx);const lt=.5*a.distanceTo(_e),ft=-this.direction.dot(Q0),_t=S_.dot(this.direction),St=-S_.dot(Q0),Et=S_.lengthSq(),Tt=Math.abs(1-ft*ft);let Bt,Ot,Lt,zt;if(Tt>0)if(Bt=ft*St-_t,Ot=ft*_t-St,zt=lt*Tt,Bt>=0)if(Ot>=-zt)if(Ot<=zt){const Jt=1/Tt;Bt*=Jt,Ot*=Jt,Lt=Bt*(Bt+ft*Ot+2*_t)+Ot*(ft*Bt+Ot+2*St)+Et}else Ot=lt,Bt=Math.max(0,-(ft*Ot+_t)),Lt=-Bt*Bt+Ot*(Ot+2*St)+Et;else Ot=-lt,Bt=Math.max(0,-(ft*Ot+_t)),Lt=-Bt*Bt+Ot*(Ot+2*St)+Et;else Ot<=-zt?(Bt=Math.max(0,-(-ft*lt+_t)),Ot=Bt>0?-lt:Math.min(Math.max(-lt,-St),lt),Lt=-Bt*Bt+Ot*(Ot+2*St)+Et):Ot<=zt?(Bt=0,Ot=Math.min(Math.max(-lt,-St),lt),Lt=Ot*(Ot+2*St)+Et):(Bt=Math.max(0,-(ft*lt+_t)),Ot=Bt>0?lt:Math.min(Math.max(-lt,-St),lt),Lt=-Bt*Bt+Ot*(Ot+2*St)+Et);else Ot=ft>0?-lt:lt,Bt=Math.max(0,-(ft*Ot+_t)),Lt=-Bt*Bt+Ot*(Ot+2*St)+Et;return rt&&rt.copy(this.origin).addScaledVector(this.direction,Bt),it&&it.copy(Sx).addScaledVector(Q0,Ot),Lt}intersectSphere(a,_e){kv.subVectors(a.center,this.origin);const rt=kv.dot(this.direction),it=kv.dot(kv)-rt*rt,lt=a.radius*a.radius;if(it>lt)return null;const ft=Math.sqrt(lt-it),_t=rt-ft,St=rt+ft;return St<0?null:_t<0?this.at(St,_e):this.at(_t,_e)}intersectsSphere(a){return this.distanceSqToPoint(a.center)<=a.radius*a.radius}distanceToPlane(a){const _e=a.normal.dot(this.direction);if(_e===0)return a.distanceToPoint(this.origin)===0?0:null;const rt=-(this.origin.dot(a.normal)+a.constant)/_e;return rt>=0?rt:null}intersectPlane(a,_e){const rt=this.distanceToPlane(a);return rt===null?null:this.at(rt,_e)}intersectsPlane(a){const _e=a.distanceToPoint(this.origin);return _e===0||a.normal.dot(this.direction)*_e<0}intersectBox(a,_e){let rt,it,lt,ft,_t,St;const Et=1/this.direction.x,Tt=1/this.direction.y,Bt=1/this.direction.z,Ot=this.origin;return Et>=0?(rt=(a.min.x-Ot.x)*Et,it=(a.max.x-Ot.x)*Et):(rt=(a.max.x-Ot.x)*Et,it=(a.min.x-Ot.x)*Et),Tt>=0?(lt=(a.min.y-Ot.y)*Tt,ft=(a.max.y-Ot.y)*Tt):(lt=(a.max.y-Ot.y)*Tt,ft=(a.min.y-Ot.y)*Tt),rt>ft||lt>it?null:((lt>rt||isNaN(rt))&&(rt=lt),(ft<it||isNaN(it))&&(it=ft),Bt>=0?(_t=(a.min.z-Ot.z)*Bt,St=(a.max.z-Ot.z)*Bt):(_t=(a.max.z-Ot.z)*Bt,St=(a.min.z-Ot.z)*Bt),rt>St||_t>it?null:((_t>rt||rt!=rt)&&(rt=_t),(St<it||it!=it)&&(it=St),it<0?null:this.at(rt>=0?rt:it,_e)))}intersectsBox(a){return this.intersectBox(a,kv)!==null}intersectTriangle(a,_e,rt,it,lt){nw.subVectors(_e,a),Hy.subVectors(rt,a),rw.crossVectors(nw,Hy);let ft,_t=this.direction.dot(rw);if(_t>0){if(it)return null;ft=1}else{if(!(_t<0))return null;ft=-1,_t=-_t}S_.subVectors(this.origin,a);const St=ft*this.direction.dot(Hy.crossVectors(S_,Hy));if(St<0)return null;const Et=ft*this.direction.dot(nw.cross(S_));if(Et<0||St+Et>_t)return null;const Tt=-ft*S_.dot(rw);return Tt<0?null:this.at(Tt/_t,lt)}applyMatrix4(a){return this.origin.applyMatrix4(a),this.direction.transformDirection(a),this}equals(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ao{constructor(){Ao.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(a,_e,rt,it,lt,ft,_t,St,Et,Tt,Bt,Ot,Lt,zt,Jt,Ht){const $t=this.elements;return $t[0]=a,$t[4]=_e,$t[8]=rt,$t[12]=it,$t[1]=lt,$t[5]=ft,$t[9]=_t,$t[13]=St,$t[2]=Et,$t[6]=Tt,$t[10]=Bt,$t[14]=Ot,$t[3]=Lt,$t[7]=zt,$t[11]=Jt,$t[15]=Ht,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ao().fromArray(this.elements)}copy(a){const _e=this.elements,rt=a.elements;return _e[0]=rt[0],_e[1]=rt[1],_e[2]=rt[2],_e[3]=rt[3],_e[4]=rt[4],_e[5]=rt[5],_e[6]=rt[6],_e[7]=rt[7],_e[8]=rt[8],_e[9]=rt[9],_e[10]=rt[10],_e[11]=rt[11],_e[12]=rt[12],_e[13]=rt[13],_e[14]=rt[14],_e[15]=rt[15],this}copyPosition(a){const _e=this.elements,rt=a.elements;return _e[12]=rt[12],_e[13]=rt[13],_e[14]=rt[14],this}setFromMatrix3(a){const _e=a.elements;return this.set(_e[0],_e[3],_e[6],0,_e[1],_e[4],_e[7],0,_e[2],_e[5],_e[8],0,0,0,0,1),this}extractBasis(a,_e,rt){return a.setFromMatrixColumn(this,0),_e.setFromMatrixColumn(this,1),rt.setFromMatrixColumn(this,2),this}makeBasis(a,_e,rt){return this.set(a.x,_e.x,rt.x,0,a.y,_e.y,rt.y,0,a.z,_e.z,rt.z,0,0,0,0,1),this}extractRotation(a){const _e=this.elements,rt=a.elements,it=1/Qy.setFromMatrixColumn(a,0).length(),lt=1/Qy.setFromMatrixColumn(a,1).length(),ft=1/Qy.setFromMatrixColumn(a,2).length();return _e[0]=rt[0]*it,_e[1]=rt[1]*it,_e[2]=rt[2]*it,_e[3]=0,_e[4]=rt[4]*lt,_e[5]=rt[5]*lt,_e[6]=rt[6]*lt,_e[7]=0,_e[8]=rt[8]*ft,_e[9]=rt[9]*ft,_e[10]=rt[10]*ft,_e[11]=0,_e[12]=0,_e[13]=0,_e[14]=0,_e[15]=1,this}makeRotationFromEuler(a){const _e=this.elements,rt=a.x,it=a.y,lt=a.z,ft=Math.cos(rt),_t=Math.sin(rt),St=Math.cos(it),Et=Math.sin(it),Tt=Math.cos(lt),Bt=Math.sin(lt);if(a.order==="XYZ"){const Ot=ft*Tt,Lt=ft*Bt,zt=_t*Tt,Jt=_t*Bt;_e[0]=St*Tt,_e[4]=-St*Bt,_e[8]=Et,_e[1]=Lt+zt*Et,_e[5]=Ot-Jt*Et,_e[9]=-_t*St,_e[2]=Jt-Ot*Et,_e[6]=zt+Lt*Et,_e[10]=ft*St}else if(a.order==="YXZ"){const Ot=St*Tt,Lt=St*Bt,zt=Et*Tt,Jt=Et*Bt;_e[0]=Ot+Jt*_t,_e[4]=zt*_t-Lt,_e[8]=ft*Et,_e[1]=ft*Bt,_e[5]=ft*Tt,_e[9]=-_t,_e[2]=Lt*_t-zt,_e[6]=Jt+Ot*_t,_e[10]=ft*St}else if(a.order==="ZXY"){const Ot=St*Tt,Lt=St*Bt,zt=Et*Tt,Jt=Et*Bt;_e[0]=Ot-Jt*_t,_e[4]=-ft*Bt,_e[8]=zt+Lt*_t,_e[1]=Lt+zt*_t,_e[5]=ft*Tt,_e[9]=Jt-Ot*_t,_e[2]=-ft*Et,_e[6]=_t,_e[10]=ft*St}else if(a.order==="ZYX"){const Ot=ft*Tt,Lt=ft*Bt,zt=_t*Tt,Jt=_t*Bt;_e[0]=St*Tt,_e[4]=zt*Et-Lt,_e[8]=Ot*Et+Jt,_e[1]=St*Bt,_e[5]=Jt*Et+Ot,_e[9]=Lt*Et-zt,_e[2]=-Et,_e[6]=_t*St,_e[10]=ft*St}else if(a.order==="YZX"){const Ot=ft*St,Lt=ft*Et,zt=_t*St,Jt=_t*Et;_e[0]=St*Tt,_e[4]=Jt-Ot*Bt,_e[8]=zt*Bt+Lt,_e[1]=Bt,_e[5]=ft*Tt,_e[9]=-_t*Tt,_e[2]=-Et*Tt,_e[6]=Lt*Bt+zt,_e[10]=Ot-Jt*Bt}else if(a.order==="XZY"){const Ot=ft*St,Lt=ft*Et,zt=_t*St,Jt=_t*Et;_e[0]=St*Tt,_e[4]=-Bt,_e[8]=Et*Tt,_e[1]=Ot*Bt+Jt,_e[5]=ft*Tt,_e[9]=Lt*Bt-zt,_e[2]=zt*Bt-Lt,_e[6]=_t*Tt,_e[10]=Jt*Bt+Ot}return _e[3]=0,_e[7]=0,_e[11]=0,_e[12]=0,_e[13]=0,_e[14]=0,_e[15]=1,this}makeRotationFromQuaternion(a){return this.compose(Qo,a,lp)}lookAt(a,_e,rt){const it=this.elements;return _d.subVectors(a,_e),_d.lengthSq()===0&&(_d.z=1),_d.normalize(),_f.crossVectors(rt,_d),_f.lengthSq()===0&&(Math.abs(rt.z)===1?_d.x+=1e-4:_d.z+=1e-4,_d.normalize(),_f.crossVectors(rt,_d)),_f.normalize(),Up.crossVectors(_d,_f),it[0]=_f.x,it[4]=Up.x,it[8]=_d.x,it[1]=_f.y,it[5]=Up.y,it[9]=_d.y,it[2]=_f.z,it[6]=Up.z,it[10]=_d.z,this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,_e){const rt=a.elements,it=_e.elements,lt=this.elements,ft=rt[0],_t=rt[4],St=rt[8],Et=rt[12],Tt=rt[1],Bt=rt[5],Ot=rt[9],Lt=rt[13],zt=rt[2],Jt=rt[6],Ht=rt[10],$t=rt[14],rn=rt[3],cn=rt[7],Rn=rt[11],Cn=rt[15],Tn=it[0],Gn=it[4],nr=it[8],Qn=it[12],ur=it[1],Wn=it[5],Ar=it[9],Cr=it[13],Wr=it[2],is=it[6],Qr=it[10],Pr=it[14],Jr=it[3],rs=it[7],vr=it[11],Br=it[15];return lt[0]=ft*Tn+_t*ur+St*Wr+Et*Jr,lt[4]=ft*Gn+_t*Wn+St*is+Et*rs,lt[8]=ft*nr+_t*Ar+St*Qr+Et*vr,lt[12]=ft*Qn+_t*Cr+St*Pr+Et*Br,lt[1]=Tt*Tn+Bt*ur+Ot*Wr+Lt*Jr,lt[5]=Tt*Gn+Bt*Wn+Ot*is+Lt*rs,lt[9]=Tt*nr+Bt*Ar+Ot*Qr+Lt*vr,lt[13]=Tt*Qn+Bt*Cr+Ot*Pr+Lt*Br,lt[2]=zt*Tn+Jt*ur+Ht*Wr+$t*Jr,lt[6]=zt*Gn+Jt*Wn+Ht*is+$t*rs,lt[10]=zt*nr+Jt*Ar+Ht*Qr+$t*vr,lt[14]=zt*Qn+Jt*Cr+Ht*Pr+$t*Br,lt[3]=rn*Tn+cn*ur+Rn*Wr+Cn*Jr,lt[7]=rn*Gn+cn*Wn+Rn*is+Cn*rs,lt[11]=rn*nr+cn*Ar+Rn*Qr+Cn*vr,lt[15]=rn*Qn+cn*Cr+Rn*Pr+Cn*Br,this}multiplyScalar(a){const _e=this.elements;return _e[0]*=a,_e[4]*=a,_e[8]*=a,_e[12]*=a,_e[1]*=a,_e[5]*=a,_e[9]*=a,_e[13]*=a,_e[2]*=a,_e[6]*=a,_e[10]*=a,_e[14]*=a,_e[3]*=a,_e[7]*=a,_e[11]*=a,_e[15]*=a,this}determinant(){const a=this.elements,_e=a[0],rt=a[4],it=a[8],lt=a[12],ft=a[1],_t=a[5],St=a[9],Et=a[13],Tt=a[2],Bt=a[6],Ot=a[10],Lt=a[14];return a[3]*(+lt*St*Bt-it*Et*Bt-lt*_t*Ot+rt*Et*Ot+it*_t*Lt-rt*St*Lt)+a[7]*(+_e*St*Lt-_e*Et*Ot+lt*ft*Ot-it*ft*Lt+it*Et*Tt-lt*St*Tt)+a[11]*(+_e*Et*Bt-_e*_t*Lt-lt*ft*Bt+rt*ft*Lt+lt*_t*Tt-rt*Et*Tt)+a[15]*(-it*_t*Tt-_e*St*Bt+_e*_t*Ot+it*ft*Bt-rt*ft*Ot+rt*St*Tt)}transpose(){const a=this.elements;let _e;return _e=a[1],a[1]=a[4],a[4]=_e,_e=a[2],a[2]=a[8],a[8]=_e,_e=a[6],a[6]=a[9],a[9]=_e,_e=a[3],a[3]=a[12],a[12]=_e,_e=a[7],a[7]=a[13],a[13]=_e,_e=a[11],a[11]=a[14],a[14]=_e,this}setPosition(a,_e,rt){const it=this.elements;return a.isVector3?(it[12]=a.x,it[13]=a.y,it[14]=a.z):(it[12]=a,it[13]=_e,it[14]=rt),this}invert(){const a=this.elements,_e=a[0],rt=a[1],it=a[2],lt=a[3],ft=a[4],_t=a[5],St=a[6],Et=a[7],Tt=a[8],Bt=a[9],Ot=a[10],Lt=a[11],zt=a[12],Jt=a[13],Ht=a[14],$t=a[15],rn=Bt*Ht*Et-Jt*Ot*Et+Jt*St*Lt-_t*Ht*Lt-Bt*St*$t+_t*Ot*$t,cn=zt*Ot*Et-Tt*Ht*Et-zt*St*Lt+ft*Ht*Lt+Tt*St*$t-ft*Ot*$t,Rn=Tt*Jt*Et-zt*Bt*Et+zt*_t*Lt-ft*Jt*Lt-Tt*_t*$t+ft*Bt*$t,Cn=zt*Bt*St-Tt*Jt*St-zt*_t*Ot+ft*Jt*Ot+Tt*_t*Ht-ft*Bt*Ht,Tn=_e*rn+rt*cn+it*Rn+lt*Cn;if(Tn===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Gn=1/Tn;return a[0]=rn*Gn,a[1]=(Jt*Ot*lt-Bt*Ht*lt-Jt*it*Lt+rt*Ht*Lt+Bt*it*$t-rt*Ot*$t)*Gn,a[2]=(_t*Ht*lt-Jt*St*lt+Jt*it*Et-rt*Ht*Et-_t*it*$t+rt*St*$t)*Gn,a[3]=(Bt*St*lt-_t*Ot*lt-Bt*it*Et+rt*Ot*Et+_t*it*Lt-rt*St*Lt)*Gn,a[4]=cn*Gn,a[5]=(Tt*Ht*lt-zt*Ot*lt+zt*it*Lt-_e*Ht*Lt-Tt*it*$t+_e*Ot*$t)*Gn,a[6]=(zt*St*lt-ft*Ht*lt-zt*it*Et+_e*Ht*Et+ft*it*$t-_e*St*$t)*Gn,a[7]=(ft*Ot*lt-Tt*St*lt+Tt*it*Et-_e*Ot*Et-ft*it*Lt+_e*St*Lt)*Gn,a[8]=Rn*Gn,a[9]=(zt*Bt*lt-Tt*Jt*lt-zt*rt*Lt+_e*Jt*Lt+Tt*rt*$t-_e*Bt*$t)*Gn,a[10]=(ft*Jt*lt-zt*_t*lt+zt*rt*Et-_e*Jt*Et-ft*rt*$t+_e*_t*$t)*Gn,a[11]=(Tt*_t*lt-ft*Bt*lt-Tt*rt*Et+_e*Bt*Et+ft*rt*Lt-_e*_t*Lt)*Gn,a[12]=Cn*Gn,a[13]=(Tt*Jt*it-zt*Bt*it+zt*rt*Ot-_e*Jt*Ot-Tt*rt*Ht+_e*Bt*Ht)*Gn,a[14]=(zt*_t*it-ft*Jt*it-zt*rt*St+_e*Jt*St+ft*rt*Ht-_e*_t*Ht)*Gn,a[15]=(ft*Bt*it-Tt*_t*it+Tt*rt*St-_e*Bt*St-ft*rt*Ot+_e*_t*Ot)*Gn,this}scale(a){const _e=this.elements,rt=a.x,it=a.y,lt=a.z;return _e[0]*=rt,_e[4]*=it,_e[8]*=lt,_e[1]*=rt,_e[5]*=it,_e[9]*=lt,_e[2]*=rt,_e[6]*=it,_e[10]*=lt,_e[3]*=rt,_e[7]*=it,_e[11]*=lt,this}getMaxScaleOnAxis(){const a=this.elements,_e=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],rt=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],it=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(_e,rt,it))}makeTranslation(a,_e,rt){return this.set(1,0,0,a,0,1,0,_e,0,0,1,rt,0,0,0,1),this}makeRotationX(a){const _e=Math.cos(a),rt=Math.sin(a);return this.set(1,0,0,0,0,_e,-rt,0,0,rt,_e,0,0,0,0,1),this}makeRotationY(a){const _e=Math.cos(a),rt=Math.sin(a);return this.set(_e,0,rt,0,0,1,0,0,-rt,0,_e,0,0,0,0,1),this}makeRotationZ(a){const _e=Math.cos(a),rt=Math.sin(a);return this.set(_e,-rt,0,0,rt,_e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(a,_e){const rt=Math.cos(_e),it=Math.sin(_e),lt=1-rt,ft=a.x,_t=a.y,St=a.z,Et=lt*ft,Tt=lt*_t;return this.set(Et*ft+rt,Et*_t-it*St,Et*St+it*_t,0,Et*_t+it*St,Tt*_t+rt,Tt*St-it*ft,0,Et*St-it*_t,Tt*St+it*ft,lt*St*St+rt,0,0,0,0,1),this}makeScale(a,_e,rt){return this.set(a,0,0,0,0,_e,0,0,0,0,rt,0,0,0,0,1),this}makeShear(a,_e,rt,it,lt,ft){return this.set(1,rt,lt,0,a,1,ft,0,_e,it,1,0,0,0,0,1),this}compose(a,_e,rt){const it=this.elements,lt=_e._x,ft=_e._y,_t=_e._z,St=_e._w,Et=lt+lt,Tt=ft+ft,Bt=_t+_t,Ot=lt*Et,Lt=lt*Tt,zt=lt*Bt,Jt=ft*Tt,Ht=ft*Bt,$t=_t*Bt,rn=St*Et,cn=St*Tt,Rn=St*Bt,Cn=rt.x,Tn=rt.y,Gn=rt.z;return it[0]=(1-(Jt+$t))*Cn,it[1]=(Lt+Rn)*Cn,it[2]=(zt-cn)*Cn,it[3]=0,it[4]=(Lt-Rn)*Tn,it[5]=(1-(Ot+$t))*Tn,it[6]=(Ht+rn)*Tn,it[7]=0,it[8]=(zt+cn)*Gn,it[9]=(Ht-rn)*Gn,it[10]=(1-(Ot+Jt))*Gn,it[11]=0,it[12]=a.x,it[13]=a.y,it[14]=a.z,it[15]=1,this}decompose(a,_e,rt){const it=this.elements;let lt=Qy.set(it[0],it[1],it[2]).length();const ft=Qy.set(it[4],it[5],it[6]).length(),_t=Qy.set(it[8],it[9],it[10]).length();this.determinant()<0&&(lt=-lt),a.x=it[12],a.y=it[13],a.z=it[14],o_.copy(this);const St=1/lt,Et=1/ft,Tt=1/_t;return o_.elements[0]*=St,o_.elements[1]*=St,o_.elements[2]*=St,o_.elements[4]*=Et,o_.elements[5]*=Et,o_.elements[6]*=Et,o_.elements[8]*=Tt,o_.elements[9]*=Tt,o_.elements[10]*=Tt,_e.setFromRotationMatrix(o_),rt.x=lt,rt.y=ft,rt.z=_t,this}makePerspective(a,_e,rt,it,lt,ft){const _t=this.elements,St=2*lt/(_e-a),Et=2*lt/(rt-it),Tt=(_e+a)/(_e-a),Bt=(rt+it)/(rt-it),Ot=-(ft+lt)/(ft-lt),Lt=-2*ft*lt/(ft-lt);return _t[0]=St,_t[4]=0,_t[8]=Tt,_t[12]=0,_t[1]=0,_t[5]=Et,_t[9]=Bt,_t[13]=0,_t[2]=0,_t[6]=0,_t[10]=Ot,_t[14]=Lt,_t[3]=0,_t[7]=0,_t[11]=-1,_t[15]=0,this}makeOrthographic(a,_e,rt,it,lt,ft){const _t=this.elements,St=1/(_e-a),Et=1/(rt-it),Tt=1/(ft-lt),Bt=(_e+a)*St,Ot=(rt+it)*Et,Lt=(ft+lt)*Tt;return _t[0]=2*St,_t[4]=0,_t[8]=0,_t[12]=-Bt,_t[1]=0,_t[5]=2*Et,_t[9]=0,_t[13]=-Ot,_t[2]=0,_t[6]=0,_t[10]=-2*Tt,_t[14]=-Lt,_t[3]=0,_t[7]=0,_t[11]=0,_t[15]=1,this}equals(a){const _e=this.elements,rt=a.elements;for(let it=0;it<16;it++)if(_e[it]!==rt[it])return!1;return!0}fromArray(a,_e=0){for(let rt=0;rt<16;rt++)this.elements[rt]=a[rt+_e];return this}toArray(a=[],_e=0){const rt=this.elements;return a[_e]=rt[0],a[_e+1]=rt[1],a[_e+2]=rt[2],a[_e+3]=rt[3],a[_e+4]=rt[4],a[_e+5]=rt[5],a[_e+6]=rt[6],a[_e+7]=rt[7],a[_e+8]=rt[8],a[_e+9]=rt[9],a[_e+10]=rt[10],a[_e+11]=rt[11],a[_e+12]=rt[12],a[_e+13]=rt[13],a[_e+14]=rt[14],a[_e+15]=rt[15],a}}const Qy=new Nn,o_=new Ao,Qo=new Nn(0,0,0),lp=new Nn(1,1,1),_f=new Nn,Up=new Nn,_d=new Nn,Wy=new Ao,iw=new _m;class q0{constructor(a=0,_e=0,rt=0,it=q0.DEFAULT_ORDER){this.isEuler=!0,this._x=a,this._y=_e,this._z=rt,this._order=it}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get order(){return this._order}set order(a){this._order=a,this._onChangeCallback()}set(a,_e,rt,it=this._order){return this._x=a,this._y=_e,this._z=rt,this._order=it,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this._onChangeCallback(),this}setFromRotationMatrix(a,_e=this._order,rt=!0){const it=a.elements,lt=it[0],ft=it[4],_t=it[8],St=it[1],Et=it[5],Tt=it[9],Bt=it[2],Ot=it[6],Lt=it[10];switch(_e){case"XYZ":this._y=Math.asin(Us(_t,-1,1)),Math.abs(_t)<.9999999?(this._x=Math.atan2(-Tt,Lt),this._z=Math.atan2(-ft,lt)):(this._x=Math.atan2(Ot,Et),this._z=0);break;case"YXZ":this._x=Math.asin(-Us(Tt,-1,1)),Math.abs(Tt)<.9999999?(this._y=Math.atan2(_t,Lt),this._z=Math.atan2(St,Et)):(this._y=Math.atan2(-Bt,lt),this._z=0);break;case"ZXY":this._x=Math.asin(Us(Ot,-1,1)),Math.abs(Ot)<.9999999?(this._y=Math.atan2(-Bt,Lt),this._z=Math.atan2(-ft,Et)):(this._y=0,this._z=Math.atan2(St,lt));break;case"ZYX":this._y=Math.asin(-Us(Bt,-1,1)),Math.abs(Bt)<.9999999?(this._x=Math.atan2(Ot,Lt),this._z=Math.atan2(St,lt)):(this._x=0,this._z=Math.atan2(-ft,Et));break;case"YZX":this._z=Math.asin(Us(St,-1,1)),Math.abs(St)<.9999999?(this._x=Math.atan2(-Tt,Et),this._y=Math.atan2(-Bt,lt)):(this._x=0,this._y=Math.atan2(_t,Lt));break;case"XZY":this._z=Math.asin(-Us(ft,-1,1)),Math.abs(ft)<.9999999?(this._x=Math.atan2(Ot,Et),this._y=Math.atan2(_t,lt)):(this._x=Math.atan2(-Tt,Lt),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+_e)}return this._order=_e,rt===!0&&this._onChangeCallback(),this}setFromQuaternion(a,_e,rt){return Wy.makeRotationFromQuaternion(a),this.setFromRotationMatrix(Wy,_e,rt)}setFromVector3(a,_e=this._order){return this.set(a.x,a.y,a.z,_e)}reorder(a){return iw.setFromEuler(this),this.setFromQuaternion(iw,a)}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order}fromArray(a){return this._x=a[0],this._y=a[1],this._z=a[2],a[3]!==void 0&&(this._order=a[3]),this._onChangeCallback(),this}toArray(a=[],_e=0){return a[_e]=this._x,a[_e+1]=this._y,a[_e+2]=this._z,a[_e+3]=this._order,a}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}q0.DEFAULT_ORDER="XYZ";class X0{constructor(){this.mask=1}set(a){this.mask=(1<<a|0)>>>0}enable(a){this.mask|=1<<a|0}enableAll(){this.mask=-1}toggle(a){this.mask^=1<<a|0}disable(a){this.mask&=~(1<<a|0)}disableAll(){this.mask=0}test(a){return(this.mask&a.mask)!=0}isEnabled(a){return(this.mask&(1<<a|0))!=0}}let Cx=0;const Y_=new Nn,l0=new _m,Fp=new Ao,c0=new Nn,Wo=new Nn,Y0=new Nn,Bm=new _m,$_=new Nn(1,0,0),$0=new Nn(0,1,0),u0=new Nn(0,0,1),V1={type:"added"},G1={type:"removed"};class ga extends x_{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Cx++}),this.uuid=mm(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ga.DEFAULT_UP.clone();const a=new Nn,_e=new q0,rt=new _m,it=new Nn(1,1,1);_e._onChange(function(){rt.setFromEuler(_e,!1)}),rt._onChange(function(){_e.setFromQuaternion(rt,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:a},rotation:{configurable:!0,enumerable:!0,value:_e},quaternion:{configurable:!0,enumerable:!0,value:rt},scale:{configurable:!0,enumerable:!0,value:it},modelViewMatrix:{value:new Ao},normalMatrix:{value:new xo}}),this.matrix=new Ao,this.matrixWorld=new Ao,this.matrixAutoUpdate=ga.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=ga.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new X0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(a,_e,rt,it,lt,ft){this.dispatchEvent({type:"beforeRender",renderer:a,scene:_e,camera:rt,geometry:it,material:lt,group:ft})}onAfterRender(){}applyMatrix4(a){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(a),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(a){return this.quaternion.premultiply(a),this}setRotationFromAxisAngle(a,_e){this.quaternion.setFromAxisAngle(a,_e)}setRotationFromEuler(a){this.quaternion.setFromEuler(a,!0)}setRotationFromMatrix(a){this.quaternion.setFromRotationMatrix(a)}setRotationFromQuaternion(a){this.quaternion.copy(a)}rotateOnAxis(a,_e){return l0.setFromAxisAngle(a,_e),this.quaternion.multiply(l0),this}rotateOnWorldAxis(a,_e){return l0.setFromAxisAngle(a,_e),this.quaternion.premultiply(l0),this}rotateX(a){return this.rotateOnAxis($_,a)}rotateY(a){return this.rotateOnAxis($0,a)}rotateZ(a){return this.rotateOnAxis(u0,a)}translateOnAxis(a,_e){return Y_.copy(a).applyQuaternion(this.quaternion),this.position.add(Y_.multiplyScalar(_e)),this}translateX(a){return this.translateOnAxis($_,a)}translateY(a){return this.translateOnAxis($0,a)}translateZ(a){return this.translateOnAxis(u0,a)}localToWorld(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(this.matrixWorld)}worldToLocal(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(Fp.copy(this.matrixWorld).invert())}lookAt(a,_e,rt){a.isVector3?c0.copy(a):c0.set(a,_e,rt);const it=this.parent;this.updateWorldMatrix(!0,!1),Wo.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Fp.lookAt(Wo,c0,this.up):Fp.lookAt(c0,Wo,this.up),this.quaternion.setFromRotationMatrix(Fp),it&&(Fp.extractRotation(it.matrixWorld),l0.setFromRotationMatrix(Fp),this.quaternion.premultiply(l0.invert()))}add(a){if(arguments.length>1){for(let _e=0;_e<arguments.length;_e++)this.add(arguments[_e]);return this}return a===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this):(a&&a.isObject3D?(a.parent!==null&&a.parent.remove(a),a.parent=this,this.children.push(a),a.dispatchEvent(V1)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a),this)}remove(a){if(arguments.length>1){for(let rt=0;rt<arguments.length;rt++)this.remove(arguments[rt]);return this}const _e=this.children.indexOf(a);return _e!==-1&&(a.parent=null,this.children.splice(_e,1),a.dispatchEvent(G1)),this}removeFromParent(){const a=this.parent;return a!==null&&a.remove(this),this}clear(){for(let a=0;a<this.children.length;a++){const _e=this.children[a];_e.parent=null,_e.dispatchEvent(G1)}return this.children.length=0,this}attach(a){return this.updateWorldMatrix(!0,!1),Fp.copy(this.matrixWorld).invert(),a.parent!==null&&(a.parent.updateWorldMatrix(!0,!1),Fp.multiply(a.parent.matrixWorld)),a.applyMatrix4(Fp),this.add(a),a.updateWorldMatrix(!1,!0),this}getObjectById(a){return this.getObjectByProperty("id",a)}getObjectByName(a){return this.getObjectByProperty("name",a)}getObjectByProperty(a,_e){if(this[a]===_e)return this;for(let rt=0,it=this.children.length;rt<it;rt++){const lt=this.children[rt].getObjectByProperty(a,_e);if(lt!==void 0)return lt}}getObjectsByProperty(a,_e){let rt=[];this[a]===_e&&rt.push(this);for(let it=0,lt=this.children.length;it<lt;it++){const ft=this.children[it].getObjectsByProperty(a,_e);ft.length>0&&(rt=rt.concat(ft))}return rt}getWorldPosition(a){return this.updateWorldMatrix(!0,!1),a.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wo,a,Y0),a}getWorldScale(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wo,Bm,a),a}getWorldDirection(a){this.updateWorldMatrix(!0,!1);const _e=this.matrixWorld.elements;return a.set(_e[8],_e[9],_e[10]).normalize()}raycast(){}traverse(a){a(this);const _e=this.children;for(let rt=0,it=_e.length;rt<it;rt++)_e[rt].traverse(a)}traverseVisible(a){if(this.visible===!1)return;a(this);const _e=this.children;for(let rt=0,it=_e.length;rt<it;rt++)_e[rt].traverseVisible(a)}traverseAncestors(a){const _e=this.parent;_e!==null&&(a(_e),_e.traverseAncestors(a))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);const _e=this.children;for(let rt=0,it=_e.length;rt<it;rt++){const lt=_e[rt];lt.matrixWorldAutoUpdate!==!0&&a!==!0||lt.updateMatrixWorld(a)}}updateWorldMatrix(a,_e){const rt=this.parent;if(a===!0&&rt!==null&&rt.matrixWorldAutoUpdate===!0&&rt.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),_e===!0){const it=this.children;for(let lt=0,ft=it.length;lt<ft;lt++){const _t=it[lt];_t.matrixWorldAutoUpdate===!0&&_t.updateWorldMatrix(!1,!0)}}}toJSON(a){const _e=a===void 0||typeof a=="string",rt={};_e&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},rt.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const it={};function lt(_t,St){return _t[St.uuid]===void 0&&(_t[St.uuid]=St.toJSON(a)),St.uuid}if(it.uuid=this.uuid,it.type=this.type,this.name!==""&&(it.name=this.name),this.castShadow===!0&&(it.castShadow=!0),this.receiveShadow===!0&&(it.receiveShadow=!0),this.visible===!1&&(it.visible=!1),this.frustumCulled===!1&&(it.frustumCulled=!1),this.renderOrder!==0&&(it.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(it.userData=this.userData),it.layers=this.layers.mask,it.matrix=this.matrix.toArray(),it.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(it.matrixAutoUpdate=!1),this.isInstancedMesh&&(it.type="InstancedMesh",it.count=this.count,it.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(it.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?it.background=this.background.toJSON():this.background.isTexture&&(it.background=this.background.toJSON(a).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(it.environment=this.environment.toJSON(a).uuid);else if(this.isMesh||this.isLine||this.isPoints){it.geometry=lt(a.geometries,this.geometry);const _t=this.geometry.parameters;if(_t!==void 0&&_t.shapes!==void 0){const St=_t.shapes;if(Array.isArray(St))for(let Et=0,Tt=St.length;Et<Tt;Et++){const Bt=St[Et];lt(a.shapes,Bt)}else lt(a.shapes,St)}}if(this.isSkinnedMesh&&(it.bindMode=this.bindMode,it.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(lt(a.skeletons,this.skeleton),it.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const _t=[];for(let St=0,Et=this.material.length;St<Et;St++)_t.push(lt(a.materials,this.material[St]));it.material=_t}else it.material=lt(a.materials,this.material);if(this.children.length>0){it.children=[];for(let _t=0;_t<this.children.length;_t++)it.children.push(this.children[_t].toJSON(a).object)}if(this.animations.length>0){it.animations=[];for(let _t=0;_t<this.animations.length;_t++){const St=this.animations[_t];it.animations.push(lt(a.animations,St))}}if(_e){const _t=ft(a.geometries),St=ft(a.materials),Et=ft(a.textures),Tt=ft(a.images),Bt=ft(a.shapes),Ot=ft(a.skeletons),Lt=ft(a.animations),zt=ft(a.nodes);_t.length>0&&(rt.geometries=_t),St.length>0&&(rt.materials=St),Et.length>0&&(rt.textures=Et),Tt.length>0&&(rt.images=Tt),Bt.length>0&&(rt.shapes=Bt),Ot.length>0&&(rt.skeletons=Ot),Lt.length>0&&(rt.animations=Lt),zt.length>0&&(rt.nodes=zt)}return rt.object=it,rt;function ft(_t){const St=[];for(const Et in _t){const Tt=_t[Et];delete Tt.metadata,St.push(Tt)}return St}}clone(a){return new this.constructor().copy(this,a)}copy(a,_e=!0){this.name=a.name,this.up.copy(a.up),this.position.copy(a.position),this.rotation.order=a.rotation.order,this.quaternion.copy(a.quaternion),this.scale.copy(a.scale),this.matrix.copy(a.matrix),this.matrixWorld.copy(a.matrixWorld),this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=a.matrixWorldAutoUpdate,this.layers.mask=a.layers.mask,this.visible=a.visible,this.castShadow=a.castShadow,this.receiveShadow=a.receiveShadow,this.frustumCulled=a.frustumCulled,this.renderOrder=a.renderOrder,this.animations=a.animations,this.userData={};for(const[rt,it]of Object.entries(a.userData))this.userData[rt]=!it||it&&(it.isTexture||it.isObject3D)?it:JSON.parse(JSON.stringify(it));if(_e===!0)for(let rt=0;rt<a.children.length;rt++){const it=a.children[rt];this.add(it.clone())}return this}}ga.DEFAULT_UP=new Nn(0,1,0),ga.DEFAULT_MATRIX_AUTO_UPDATE=!0,ga.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const jp=new Nn,Vu=new Nn,C_=new Nn,vm=new Nn,Ep=new Nn,K_=new Nn,T_=new Nn,h0=new Nn,J_=new Nn,K0=new Nn;let qy=!1;class Du{constructor(a=new Nn,_e=new Nn,rt=new Nn){this.a=a,this.b=_e,this.c=rt}static getNormal(a,_e,rt,it){it.subVectors(rt,_e),jp.subVectors(a,_e),it.cross(jp);const lt=it.lengthSq();return lt>0?it.multiplyScalar(1/Math.sqrt(lt)):it.set(0,0,0)}static getBarycoord(a,_e,rt,it,lt){jp.subVectors(it,_e),Vu.subVectors(rt,_e),C_.subVectors(a,_e);const ft=jp.dot(jp),_t=jp.dot(Vu),St=jp.dot(C_),Et=Vu.dot(Vu),Tt=Vu.dot(C_),Bt=ft*Et-_t*_t;if(Bt===0)return lt.set(-2,-1,-1);const Ot=1/Bt,Lt=(Et*St-_t*Tt)*Ot,zt=(ft*Tt-_t*St)*Ot;return lt.set(1-Lt-zt,zt,Lt)}static containsPoint(a,_e,rt,it){return this.getBarycoord(a,_e,rt,it,vm),vm.x>=0&&vm.y>=0&&vm.x+vm.y<=1}static getUV(a,_e,rt,it,lt,ft,_t,St){return qy===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),qy=!0),this.getInterpolation(a,_e,rt,it,lt,ft,_t,St)}static getInterpolation(a,_e,rt,it,lt,ft,_t,St){return this.getBarycoord(a,_e,rt,it,vm),St.setScalar(0),St.addScaledVector(lt,vm.x),St.addScaledVector(ft,vm.y),St.addScaledVector(_t,vm.z),St}static isFrontFacing(a,_e,rt,it){return jp.subVectors(rt,_e),Vu.subVectors(a,_e),jp.cross(Vu).dot(it)<0}set(a,_e,rt){return this.a.copy(a),this.b.copy(_e),this.c.copy(rt),this}setFromPointsAndIndices(a,_e,rt,it){return this.a.copy(a[_e]),this.b.copy(a[rt]),this.c.copy(a[it]),this}setFromAttributeAndIndices(a,_e,rt,it){return this.a.fromBufferAttribute(a,_e),this.b.fromBufferAttribute(a,rt),this.c.fromBufferAttribute(a,it),this}clone(){return new this.constructor().copy(this)}copy(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this}getArea(){return jp.subVectors(this.c,this.b),Vu.subVectors(this.a,this.b),.5*jp.cross(Vu).length()}getMidpoint(a){return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(a){return Du.getNormal(this.a,this.b,this.c,a)}getPlane(a){return a.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(a,_e){return Du.getBarycoord(a,this.a,this.b,this.c,_e)}getUV(a,_e,rt,it,lt){return qy===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),qy=!0),Du.getInterpolation(a,this.a,this.b,this.c,_e,rt,it,lt)}getInterpolation(a,_e,rt,it,lt){return Du.getInterpolation(a,this.a,this.b,this.c,_e,rt,it,lt)}containsPoint(a){return Du.containsPoint(a,this.a,this.b,this.c)}isFrontFacing(a){return Du.isFrontFacing(this.a,this.b,this.c,a)}intersectsBox(a){return a.intersectsTriangle(this)}closestPointToPoint(a,_e){const rt=this.a,it=this.b,lt=this.c;let ft,_t;Ep.subVectors(it,rt),K_.subVectors(lt,rt),h0.subVectors(a,rt);const St=Ep.dot(h0),Et=K_.dot(h0);if(St<=0&&Et<=0)return _e.copy(rt);J_.subVectors(a,it);const Tt=Ep.dot(J_),Bt=K_.dot(J_);if(Tt>=0&&Bt<=Tt)return _e.copy(it);const Ot=St*Bt-Tt*Et;if(Ot<=0&&St>=0&&Tt<=0)return ft=St/(St-Tt),_e.copy(rt).addScaledVector(Ep,ft);K0.subVectors(a,lt);const Lt=Ep.dot(K0),zt=K_.dot(K0);if(zt>=0&&Lt<=zt)return _e.copy(lt);const Jt=Lt*Et-St*zt;if(Jt<=0&&Et>=0&&zt<=0)return _t=Et/(Et-zt),_e.copy(rt).addScaledVector(K_,_t);const Ht=Tt*zt-Lt*Bt;if(Ht<=0&&Bt-Tt>=0&&Lt-zt>=0)return T_.subVectors(lt,it),_t=(Bt-Tt)/(Bt-Tt+(Lt-zt)),_e.copy(it).addScaledVector(T_,_t);const $t=1/(Ht+Jt+Ot);return ft=Jt*$t,_t=Ot*$t,_e.copy(rt).addScaledVector(Ep,ft).addScaledVector(K_,_t)}equals(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}}let Xy=0;class cp extends x_{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Xy++}),this.uuid=mm(),this.name="",this.type="Material",this.blending=on,this.side=sn,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=tr,this.blendDst=Un,this.blendEquation=Qt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Vn,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ny,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Zp,this.stencilZFail=Zp,this.stencilZPass=Zp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(a){this._alphaTest>0!=a>0&&this.version++,this._alphaTest=a}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(a){if(a!==void 0)for(const _e in a){const rt=a[_e];if(rt===void 0){console.warn(`THREE.Material: parameter '${_e}' has value of undefined.`);continue}const it=this[_e];it!==void 0&&(it&&it.isColor?it.set(rt):it&&it.isVector3&&rt&&rt.isVector3?it.copy(rt):Array.isArray(rt)&&it&&typeof it.fromArray=="function"?it.fromArray(rt):this[_e]=rt)}}toJSON(a){const _e=a===void 0||typeof a=="string";_e&&(a={textures:{},images:{}});const rt={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function it(lt){const ft=[];for(const _t in lt){const St=lt[_t];delete St.metadata,ft.push(St)}return ft}if(rt.uuid=this.uuid,rt.type=this.type,this.name!==""&&(rt.name=this.name),this.color&&this.color.isColor&&(rt.color=this.color.getHex()),this.roughness!==void 0&&(rt.roughness=this.roughness),this.metalness!==void 0&&(rt.metalness=this.metalness),this.sheen!==void 0&&(rt.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(rt.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(rt.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(rt.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(rt.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(rt.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(rt.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(rt.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(rt.shininess=this.shininess),this.clearcoat!==void 0&&(rt.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(rt.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(rt.clearcoatMap=this.clearcoatMap.toJSON(a).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(rt.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(a).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(rt.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(a).uuid,rt.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(rt.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(rt.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(rt.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(rt.iridescenceMap=this.iridescenceMap.toJSON(a).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(rt.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(a).uuid),this.map&&this.map.isTexture&&(rt.map=this.map.toJSON(a).uuid),this.matcap&&this.matcap.isTexture&&(rt.matcap=this.matcap.toJSON(a).uuid),this.alphaMap&&this.alphaMap.isTexture&&(rt.alphaMap=this.alphaMap.toJSON(a).uuid),this.lightMap&&this.lightMap.isTexture&&(rt.lightMap=this.lightMap.toJSON(a).uuid,rt.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(rt.aoMap=this.aoMap.toJSON(a).uuid,rt.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(rt.bumpMap=this.bumpMap.toJSON(a).uuid,rt.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(rt.normalMap=this.normalMap.toJSON(a).uuid,rt.normalMapType=this.normalMapType,rt.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(rt.displacementMap=this.displacementMap.toJSON(a).uuid,rt.displacementScale=this.displacementScale,rt.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(rt.roughnessMap=this.roughnessMap.toJSON(a).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(rt.metalnessMap=this.metalnessMap.toJSON(a).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(rt.emissiveMap=this.emissiveMap.toJSON(a).uuid),this.specularMap&&this.specularMap.isTexture&&(rt.specularMap=this.specularMap.toJSON(a).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(rt.specularIntensityMap=this.specularIntensityMap.toJSON(a).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(rt.specularColorMap=this.specularColorMap.toJSON(a).uuid),this.envMap&&this.envMap.isTexture&&(rt.envMap=this.envMap.toJSON(a).uuid,this.combine!==void 0&&(rt.combine=this.combine)),this.envMapIntensity!==void 0&&(rt.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(rt.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(rt.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(rt.gradientMap=this.gradientMap.toJSON(a).uuid),this.transmission!==void 0&&(rt.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(rt.transmissionMap=this.transmissionMap.toJSON(a).uuid),this.thickness!==void 0&&(rt.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(rt.thicknessMap=this.thicknessMap.toJSON(a).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(rt.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(rt.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(rt.size=this.size),this.shadowSide!==null&&(rt.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(rt.sizeAttenuation=this.sizeAttenuation),this.blending!==on&&(rt.blending=this.blending),this.side!==sn&&(rt.side=this.side),this.vertexColors&&(rt.vertexColors=!0),this.opacity<1&&(rt.opacity=this.opacity),this.transparent===!0&&(rt.transparent=this.transparent),rt.depthFunc=this.depthFunc,rt.depthTest=this.depthTest,rt.depthWrite=this.depthWrite,rt.colorWrite=this.colorWrite,rt.stencilWrite=this.stencilWrite,rt.stencilWriteMask=this.stencilWriteMask,rt.stencilFunc=this.stencilFunc,rt.stencilRef=this.stencilRef,rt.stencilFuncMask=this.stencilFuncMask,rt.stencilFail=this.stencilFail,rt.stencilZFail=this.stencilZFail,rt.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(rt.rotation=this.rotation),this.polygonOffset===!0&&(rt.polygonOffset=!0),this.polygonOffsetFactor!==0&&(rt.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(rt.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(rt.linewidth=this.linewidth),this.dashSize!==void 0&&(rt.dashSize=this.dashSize),this.gapSize!==void 0&&(rt.gapSize=this.gapSize),this.scale!==void 0&&(rt.scale=this.scale),this.dithering===!0&&(rt.dithering=!0),this.alphaTest>0&&(rt.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(rt.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(rt.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(rt.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(rt.wireframe=this.wireframe),this.wireframeLinewidth>1&&(rt.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(rt.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(rt.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(rt.flatShading=this.flatShading),this.visible===!1&&(rt.visible=!1),this.toneMapped===!1&&(rt.toneMapped=!1),this.fog===!1&&(rt.fog=!1),Object.keys(this.userData).length>0&&(rt.userData=this.userData),_e){const lt=it(a.textures),ft=it(a.images);lt.length>0&&(rt.textures=lt),ft.length>0&&(rt.images=ft)}return rt}clone(){return new this.constructor().copy(this)}copy(a){this.name=a.name,this.blending=a.blending,this.side=a.side,this.vertexColors=a.vertexColors,this.opacity=a.opacity,this.transparent=a.transparent,this.blendSrc=a.blendSrc,this.blendDst=a.blendDst,this.blendEquation=a.blendEquation,this.blendSrcAlpha=a.blendSrcAlpha,this.blendDstAlpha=a.blendDstAlpha,this.blendEquationAlpha=a.blendEquationAlpha,this.depthFunc=a.depthFunc,this.depthTest=a.depthTest,this.depthWrite=a.depthWrite,this.stencilWriteMask=a.stencilWriteMask,this.stencilFunc=a.stencilFunc,this.stencilRef=a.stencilRef,this.stencilFuncMask=a.stencilFuncMask,this.stencilFail=a.stencilFail,this.stencilZFail=a.stencilZFail,this.stencilZPass=a.stencilZPass,this.stencilWrite=a.stencilWrite;const _e=a.clippingPlanes;let rt=null;if(_e!==null){const it=_e.length;rt=new Array(it);for(let lt=0;lt!==it;++lt)rt[lt]=_e[lt].clone()}return this.clippingPlanes=rt,this.clipIntersection=a.clipIntersection,this.clipShadows=a.clipShadows,this.shadowSide=a.shadowSide,this.colorWrite=a.colorWrite,this.precision=a.precision,this.polygonOffset=a.polygonOffset,this.polygonOffsetFactor=a.polygonOffsetFactor,this.polygonOffsetUnits=a.polygonOffsetUnits,this.dithering=a.dithering,this.alphaTest=a.alphaTest,this.alphaToCoverage=a.alphaToCoverage,this.premultipliedAlpha=a.premultipliedAlpha,this.forceSinglePass=a.forceSinglePass,this.visible=a.visible,this.toneMapped=a.toneMapped,this.userData=sw({},a.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(a){a===!0&&this.version++}}function sw(pt,a){if(!a)return pt;for(const _e of Object.keys(a)){if(_e.startsWith("__")||typeof pt[_e]=="function"||typeof a[_e]=="function")continue;const rt=a[_e],it=!rt||rt.isTexture||rt.isObject3D||rt.isMaterial;it||typeof a[_e].clone!="function"?it||typeof a[_e]!="object"&&!Array.isArray(a[_e])?pt[_e]=a[_e]:pt[_e]=sw(Array.isArray(a[_e])?[]:{},a[_e]):pt[_e]=a[_e].clone()}return pt}const Z_={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ep={h:0,s:0,l:0},ow={h:0,s:0,l:0};function d0(pt,a,_e){return _e<0&&(_e+=1),_e>1&&(_e-=1),_e<1/6?pt+6*(a-pt)*_e:_e<.5?a:_e<2/3?pt+6*(a-pt)*(2/3-_e):pt}class ps{constructor(a,_e,rt){return this.isColor=!0,this.r=1,this.g=1,this.b=1,_e===void 0&&rt===void 0?this.set(a):this.setRGB(a,_e,rt)}set(a){return a&&a.isColor?this.copy(a):typeof a=="number"?this.setHex(a):typeof a=="string"&&this.setStyle(a),this}setScalar(a){return this.r=a,this.g=a,this.b=a,this}setHex(a,_e=Gs){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,lu.toWorkingColorSpace(this,_e),this}setRGB(a,_e,rt,it=lu.workingColorSpace){return this.r=a,this.g=_e,this.b=rt,lu.toWorkingColorSpace(this,it),this}setHSL(a,_e,rt,it=lu.workingColorSpace){if(a=Fy(a,1),_e=Us(_e,0,1),rt=Us(rt,0,1),_e===0)this.r=this.g=this.b=rt;else{const lt=rt<=.5?rt*(1+_e):rt+_e-rt*_e,ft=2*rt-lt;this.r=d0(ft,lt,a+1/3),this.g=d0(ft,lt,a),this.b=d0(ft,lt,a-1/3)}return lu.toWorkingColorSpace(this,it),this}setStyle(a,_e=Gs){function rt(lt){lt!==void 0&&parseFloat(lt)<1&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}let it;if(it=/^(\w+)\(([^\)]*)\)/.exec(a)){let lt;const ft=it[1],_t=it[2];switch(ft){case"rgb":case"rgba":if(lt=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(_t))return rt(lt[4]),this.setRGB(Math.min(255,parseInt(lt[1],10))/255,Math.min(255,parseInt(lt[2],10))/255,Math.min(255,parseInt(lt[3],10))/255,_e);if(lt=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(_t))return rt(lt[4]),this.setRGB(Math.min(100,parseInt(lt[1],10))/100,Math.min(100,parseInt(lt[2],10))/100,Math.min(100,parseInt(lt[3],10))/100,_e);break;case"hsl":case"hsla":if(lt=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(_t))return rt(lt[4]),this.setHSL(parseFloat(lt[1])/360,parseFloat(lt[2])/100,parseFloat(lt[3])/100,_e);break;default:console.warn("THREE.Color: Unknown color model "+a)}}else if(it=/^\#([A-Fa-f\d]+)$/.exec(a)){const lt=it[1],ft=lt.length;if(ft===3)return this.setRGB(parseInt(lt.charAt(0),16)/15,parseInt(lt.charAt(1),16)/15,parseInt(lt.charAt(2),16)/15,_e);if(ft===6)return this.setHex(parseInt(lt,16),_e);console.warn("THREE.Color: Invalid hex color "+a)}else if(a&&a.length>0)return this.setColorName(a,_e);return this}setColorName(a,_e=Gs){const rt=Z_[a.toLowerCase()];return rt!==void 0?this.setHex(rt,_e):console.warn("THREE.Color: Unknown color "+a),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(a){return this.r=a.r,this.g=a.g,this.b=a.b,this}copySRGBToLinear(a){return this.r=z0(a.r),this.g=z0(a.g),this.b=z0(a.b),this}copyLinearToSRGB(a){return this.r=Ax(a.r),this.g=Ax(a.g),this.b=Ax(a.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(a=Gs){return lu.fromWorkingColorSpace(_u.copy(this),a),65536*Math.round(Us(255*_u.r,0,255))+256*Math.round(Us(255*_u.g,0,255))+Math.round(Us(255*_u.b,0,255))}getHexString(a=Gs){return("000000"+this.getHex(a).toString(16)).slice(-6)}getHSL(a,_e=lu.workingColorSpace){lu.fromWorkingColorSpace(_u.copy(this),_e);const rt=_u.r,it=_u.g,lt=_u.b,ft=Math.max(rt,it,lt),_t=Math.min(rt,it,lt);let St,Et;const Tt=(_t+ft)/2;if(_t===ft)St=0,Et=0;else{const Bt=ft-_t;switch(Et=Tt<=.5?Bt/(ft+_t):Bt/(2-ft-_t),ft){case rt:St=(it-lt)/Bt+(it<lt?6:0);break;case it:St=(lt-rt)/Bt+2;break;case lt:St=(rt-it)/Bt+4}St/=6}return a.h=St,a.s=Et,a.l=Tt,a}getRGB(a,_e=lu.workingColorSpace){return lu.fromWorkingColorSpace(_u.copy(this),_e),a.r=_u.r,a.g=_u.g,a.b=_u.b,a}getStyle(a=Gs){lu.fromWorkingColorSpace(_u.copy(this),a);const _e=_u.r,rt=_u.g,it=_u.b;return a!==Gs?`color(${a} ${_e.toFixed(3)} ${rt.toFixed(3)} ${it.toFixed(3)})`:`rgb(${Math.round(255*_e)},${Math.round(255*rt)},${Math.round(255*it)})`}offsetHSL(a,_e,rt){return this.getHSL(ep),ep.h+=a,ep.s+=_e,ep.l+=rt,this.setHSL(ep.h,ep.s,ep.l),this}add(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this}addColors(a,_e){return this.r=a.r+_e.r,this.g=a.g+_e.g,this.b=a.b+_e.b,this}addScalar(a){return this.r+=a,this.g+=a,this.b+=a,this}sub(a){return this.r=Math.max(0,this.r-a.r),this.g=Math.max(0,this.g-a.g),this.b=Math.max(0,this.b-a.b),this}multiply(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this}multiplyScalar(a){return this.r*=a,this.g*=a,this.b*=a,this}lerp(a,_e){return this.r+=(a.r-this.r)*_e,this.g+=(a.g-this.g)*_e,this.b+=(a.b-this.b)*_e,this}lerpColors(a,_e,rt){return this.r=a.r+(_e.r-a.r)*rt,this.g=a.g+(_e.g-a.g)*rt,this.b=a.b+(_e.b-a.b)*rt,this}lerpHSL(a,_e){this.getHSL(ep),a.getHSL(ow);const rt=jy(ep.h,ow.h,_e),it=jy(ep.s,ow.s,_e),lt=jy(ep.l,ow.l,_e);return this.setHSL(rt,it,lt),this}setFromVector3(a){return this.r=a.x,this.g=a.y,this.b=a.z,this}applyMatrix3(a){const _e=this.r,rt=this.g,it=this.b,lt=a.elements;return this.r=lt[0]*_e+lt[3]*rt+lt[6]*it,this.g=lt[1]*_e+lt[4]*rt+lt[7]*it,this.b=lt[2]*_e+lt[5]*rt+lt[8]*it,this}equals(a){return a.r===this.r&&a.g===this.g&&a.b===this.b}fromArray(a,_e=0){return this.r=a[_e],this.g=a[_e+1],this.b=a[_e+2],this}toArray(a=[],_e=0){return a[_e]=this.r,a[_e+1]=this.g,a[_e+2]=this.b,a}fromBufferAttribute(a,_e){return this.r=a.getX(_e),this.g=a.getY(_e),this.b=a.getZ(_e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _u=new ps;ps.NAMES=Z_;class a_ extends cp{constructor(a){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ps(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ys,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}}const ev=Tx();function Tx(){const pt=new ArrayBuffer(4),a=new Float32Array(pt),_e=new Uint32Array(pt),rt=new Uint32Array(512),it=new Uint32Array(512);for(let St=0;St<256;++St){const Et=St-127;Et<-27?(rt[St]=0,rt[256|St]=32768,it[St]=24,it[256|St]=24):Et<-14?(rt[St]=1024>>-Et-14,rt[256|St]=1024>>-Et-14|32768,it[St]=-Et-1,it[256|St]=-Et-1):Et<=15?(rt[St]=Et+15<<10,rt[256|St]=Et+15<<10|32768,it[St]=13,it[256|St]=13):Et<128?(rt[St]=31744,rt[256|St]=64512,it[St]=24,it[256|St]=24):(rt[St]=31744,rt[256|St]=64512,it[St]=13,it[256|St]=13)}const lt=new Uint32Array(2048),ft=new Uint32Array(64),_t=new Uint32Array(64);for(let St=1;St<1024;++St){let Et=St<<13,Tt=0;for(;!(8388608&Et);)Et<<=1,Tt-=8388608;Et&=-8388609,Tt+=947912704,lt[St]=Et|Tt}for(let St=1024;St<2048;++St)lt[St]=939524096+(St-1024<<13);for(let St=1;St<31;++St)ft[St]=St<<23;ft[31]=1199570944,ft[32]=2147483648;for(let St=33;St<63;++St)ft[St]=2147483648+(St-32<<23);ft[63]=3347054592;for(let St=1;St<64;++St)St!==32&&(_t[St]=1024);return{floatView:a,uint32View:_e,baseTable:rt,shiftTable:it,mantissaTable:lt,exponentTable:ft,offsetTable:_t}}function em(pt){Math.abs(pt)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),pt=Us(pt,-65504,65504),ev.floatView[0]=pt;const a=ev.uint32View[0],_e=a>>23&511;return ev.baseTable[_e]+((8388607&a)>>ev.shiftTable[_e])}function tv(pt){const a=pt>>10;return ev.uint32View[0]=ev.mantissaTable[ev.offsetTable[a]+(1023&pt)]+ev.exponentTable[a],ev.floatView[0]}const Yy={toHalfFloat:em,fromHalfFloat:tv},Ul=new Nn,$y=new Nr;class Hl{constructor(a,_e,rt=!1){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=a,this.itemSize=_e,this.count=a!==void 0?a.length/_e:0,this.normalized=rt,this.usage=w_,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(a){a===!0&&this.version++}setUsage(a){return this.usage=a,this}copy(a){return this.name=a.name,this.array=new a.array.constructor(a.array),this.itemSize=a.itemSize,this.count=a.count,this.normalized=a.normalized,this.usage=a.usage,this}copyAt(a,_e,rt){a*=this.itemSize,rt*=_e.itemSize;for(let it=0,lt=this.itemSize;it<lt;it++)this.array[a+it]=_e.array[rt+it];return this}copyArray(a){return this.array.set(a),this}applyMatrix3(a){if(this.itemSize===2)for(let _e=0,rt=this.count;_e<rt;_e++)$y.fromBufferAttribute(this,_e),$y.applyMatrix3(a),this.setXY(_e,$y.x,$y.y);else if(this.itemSize===3)for(let _e=0,rt=this.count;_e<rt;_e++)Ul.fromBufferAttribute(this,_e),Ul.applyMatrix3(a),this.setXYZ(_e,Ul.x,Ul.y,Ul.z);return this}applyMatrix4(a){for(let _e=0,rt=this.count;_e<rt;_e++)Ul.fromBufferAttribute(this,_e),Ul.applyMatrix4(a),this.setXYZ(_e,Ul.x,Ul.y,Ul.z);return this}applyNormalMatrix(a){for(let _e=0,rt=this.count;_e<rt;_e++)Ul.fromBufferAttribute(this,_e),Ul.applyNormalMatrix(a),this.setXYZ(_e,Ul.x,Ul.y,Ul.z);return this}transformDirection(a){for(let _e=0,rt=this.count;_e<rt;_e++)Ul.fromBufferAttribute(this,_e),Ul.transformDirection(a),this.setXYZ(_e,Ul.x,Ul.y,Ul.z);return this}set(a,_e=0){return this.array.set(a,_e),this}getX(a){let _e=this.array[a*this.itemSize];return this.normalized&&(_e=km(_e,this.array)),_e}setX(a,_e){return this.normalized&&(_e=Ro(_e,this.array)),this.array[a*this.itemSize]=_e,this}getY(a){let _e=this.array[a*this.itemSize+1];return this.normalized&&(_e=km(_e,this.array)),_e}setY(a,_e){return this.normalized&&(_e=Ro(_e,this.array)),this.array[a*this.itemSize+1]=_e,this}getZ(a){let _e=this.array[a*this.itemSize+2];return this.normalized&&(_e=km(_e,this.array)),_e}setZ(a,_e){return this.normalized&&(_e=Ro(_e,this.array)),this.array[a*this.itemSize+2]=_e,this}getW(a){let _e=this.array[a*this.itemSize+3];return this.normalized&&(_e=km(_e,this.array)),_e}setW(a,_e){return this.normalized&&(_e=Ro(_e,this.array)),this.array[a*this.itemSize+3]=_e,this}setXY(a,_e,rt){return a*=this.itemSize,this.normalized&&(_e=Ro(_e,this.array),rt=Ro(rt,this.array)),this.array[a+0]=_e,this.array[a+1]=rt,this}setXYZ(a,_e,rt,it){return a*=this.itemSize,this.normalized&&(_e=Ro(_e,this.array),rt=Ro(rt,this.array),it=Ro(it,this.array)),this.array[a+0]=_e,this.array[a+1]=rt,this.array[a+2]=it,this}setXYZW(a,_e,rt,it,lt){return a*=this.itemSize,this.normalized&&(_e=Ro(_e,this.array),rt=Ro(rt,this.array),it=Ro(it,this.array),lt=Ro(lt,this.array)),this.array[a+0]=_e,this.array[a+1]=rt,this.array[a+2]=it,this.array[a+3]=lt,this}onUpload(a){return this.onUploadCallback=a,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const a={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(a.name=this.name),this.usage!==w_&&(a.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(a.updateRange=this.updateRange),a}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class H1 extends Hl{constructor(a,_e,rt){super(new Int8Array(a),_e,rt)}}class p0 extends Hl{constructor(a,_e,rt){super(new Uint8Array(a),_e,rt)}}class Q1 extends Hl{constructor(a,_e,rt){super(new Uint8ClampedArray(a),_e,rt)}}class J0 extends Hl{constructor(a,_e,rt){super(new Int16Array(a),_e,rt)}}class tm extends Hl{constructor(a,_e,rt){super(new Uint16Array(a),_e,rt)}}class Z0 extends Hl{constructor(a,_e,rt){super(new Int32Array(a),_e,rt)}}class Sp extends Hl{constructor(a,_e,rt){super(new Uint32Array(a),_e,rt)}}class ku extends Hl{constructor(a,_e,rt){super(new Uint16Array(a),_e,rt),this.isFloat16BufferAttribute=!0}getX(a){let _e=tv(this.array[a*this.itemSize]);return this.normalized&&(_e=km(_e,this.array)),_e}setX(a,_e){return this.normalized&&(_e=Ro(_e,this.array)),this.array[a*this.itemSize]=em(_e),this}getY(a){let _e=tv(this.array[a*this.itemSize+1]);return this.normalized&&(_e=km(_e,this.array)),_e}setY(a,_e){return this.normalized&&(_e=Ro(_e,this.array)),this.array[a*this.itemSize+1]=em(_e),this}getZ(a){let _e=tv(this.array[a*this.itemSize+2]);return this.normalized&&(_e=km(_e,this.array)),_e}setZ(a,_e){return this.normalized&&(_e=Ro(_e,this.array)),this.array[a*this.itemSize+2]=em(_e),this}getW(a){let _e=tv(this.array[a*this.itemSize+3]);return this.normalized&&(_e=km(_e,this.array)),_e}setW(a,_e){return this.normalized&&(_e=Ro(_e,this.array)),this.array[a*this.itemSize+3]=em(_e),this}setXY(a,_e,rt){return a*=this.itemSize,this.normalized&&(_e=Ro(_e,this.array),rt=Ro(rt,this.array)),this.array[a+0]=em(_e),this.array[a+1]=em(rt),this}setXYZ(a,_e,rt,it){return a*=this.itemSize,this.normalized&&(_e=Ro(_e,this.array),rt=Ro(rt,this.array),it=Ro(it,this.array)),this.array[a+0]=em(_e),this.array[a+1]=em(rt),this.array[a+2]=em(it),this}setXYZW(a,_e,rt,it,lt){return a*=this.itemSize,this.normalized&&(_e=Ro(_e,this.array),rt=Ro(rt,this.array),it=Ro(it,this.array),lt=Ro(lt,this.array)),this.array[a+0]=em(_e),this.array[a+1]=em(rt),this.array[a+2]=em(it),this.array[a+3]=em(lt),this}}class vs extends Hl{constructor(a,_e,rt){super(new Float32Array(a),_e,rt)}}class Dl extends Hl{constructor(a,_e,rt){super(new Float64Array(a),_e,rt)}}let W1=0;const nm=new Ao,Mx=new ga,Mt=new Nn,ht=new E_,vt=new E_,Rt=new Nn;class Kt extends x_{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:W1++}),this.uuid=mm(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(a){return Array.isArray(a)?this.index=new(BS(a)?Sp:tm)(a,1):this.index=a,this}getAttribute(a){return this.attributes[a]}setAttribute(a,_e){return this.attributes[a]=_e,this}deleteAttribute(a){return delete this.attributes[a],this}hasAttribute(a){return this.attributes[a]!==void 0}addGroup(a,_e,rt=0){this.groups.push({start:a,count:_e,materialIndex:rt})}clearGroups(){this.groups=[]}setDrawRange(a,_e){this.drawRange.start=a,this.drawRange.count=_e}applyMatrix4(a){const _e=this.attributes.position;_e!==void 0&&(_e.applyMatrix4(a),_e.needsUpdate=!0);const rt=this.attributes.normal;if(rt!==void 0){const lt=new xo().getNormalMatrix(a);rt.applyNormalMatrix(lt),rt.needsUpdate=!0}const it=this.attributes.tangent;return it!==void 0&&(it.transformDirection(a),it.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(a){return nm.makeRotationFromQuaternion(a),this.applyMatrix4(nm),this}rotateX(a){return nm.makeRotationX(a),this.applyMatrix4(nm),this}rotateY(a){return nm.makeRotationY(a),this.applyMatrix4(nm),this}rotateZ(a){return nm.makeRotationZ(a),this.applyMatrix4(nm),this}translate(a,_e,rt){return nm.makeTranslation(a,_e,rt),this.applyMatrix4(nm),this}scale(a,_e,rt){return nm.makeScale(a,_e,rt),this.applyMatrix4(nm),this}lookAt(a){return Mx.lookAt(a),Mx.updateMatrix(),this.applyMatrix4(Mx.matrix),this}center(a=void 0){return this.computeBoundingBox(),this.boundingBox.getCenter(Mt).negate(),this.translate(Mt.x,Mt.y,Mt.z),a&&a.copy(Mt),this}setFromPoints(a){const _e=[];for(let rt=0,it=a.length;rt<it;rt++){const lt=a[rt];_e.push(lt.x,lt.y,lt.z||0)}return this.setAttribute("position",new vs(_e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new E_);const a=this.attributes.position,_e=this.morphAttributes.position;if(a&&a.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Nn(-1/0,-1/0,-1/0),new Nn(1/0,1/0,1/0));if(a!==void 0){if(this.boundingBox.setFromBufferAttribute(a),_e)for(let rt=0,it=_e.length;rt<it;rt++){const lt=_e[rt];ht.setFromBufferAttribute(lt),this.morphTargetsRelative?(Rt.addVectors(this.boundingBox.min,ht.min),this.boundingBox.expandByPoint(Rt),Rt.addVectors(this.boundingBox.max,ht.max),this.boundingBox.expandByPoint(Rt)):(this.boundingBox.expandByPoint(ht.min),this.boundingBox.expandByPoint(ht.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new s_);const a=this.attributes.position,_e=this.morphAttributes.position;if(a&&a.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Nn,1/0);if(a){const rt=this.boundingSphere.center;if(ht.setFromBufferAttribute(a),_e)for(let lt=0,ft=_e.length;lt<ft;lt++){const _t=_e[lt];vt.setFromBufferAttribute(_t),this.morphTargetsRelative?(Rt.addVectors(ht.min,vt.min),ht.expandByPoint(Rt),Rt.addVectors(ht.max,vt.max),ht.expandByPoint(Rt)):(ht.expandByPoint(vt.min),ht.expandByPoint(vt.max))}ht.getCenter(rt);let it=0;for(let lt=0,ft=a.count;lt<ft;lt++)Rt.fromBufferAttribute(a,lt),it=Math.max(it,rt.distanceToSquared(Rt));if(_e)for(let lt=0,ft=_e.length;lt<ft;lt++){const _t=_e[lt],St=this.morphTargetsRelative;for(let Et=0,Tt=_t.count;Et<Tt;Et++)Rt.fromBufferAttribute(_t,Et),St&&(Mt.fromBufferAttribute(a,Et),Rt.add(Mt)),it=Math.max(it,rt.distanceToSquared(Rt))}this.boundingSphere.radius=Math.sqrt(it),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const a=this.index,_e=this.attributes;if(a===null||_e.position===void 0||_e.normal===void 0||_e.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const rt=a.array,it=_e.position.array,lt=_e.normal.array,ft=_e.uv.array,_t=it.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Hl(new Float32Array(4*_t),4));const St=this.getAttribute("tangent").array,Et=[],Tt=[];for(let ur=0;ur<_t;ur++)Et[ur]=new Nn,Tt[ur]=new Nn;const Bt=new Nn,Ot=new Nn,Lt=new Nn,zt=new Nr,Jt=new Nr,Ht=new Nr,$t=new Nn,rn=new Nn;function cn(ur,Wn,Ar){Bt.fromArray(it,3*ur),Ot.fromArray(it,3*Wn),Lt.fromArray(it,3*Ar),zt.fromArray(ft,2*ur),Jt.fromArray(ft,2*Wn),Ht.fromArray(ft,2*Ar),Ot.sub(Bt),Lt.sub(Bt),Jt.sub(zt),Ht.sub(zt);const Cr=1/(Jt.x*Ht.y-Ht.x*Jt.y);isFinite(Cr)&&($t.copy(Ot).multiplyScalar(Ht.y).addScaledVector(Lt,-Jt.y).multiplyScalar(Cr),rn.copy(Lt).multiplyScalar(Jt.x).addScaledVector(Ot,-Ht.x).multiplyScalar(Cr),Et[ur].add($t),Et[Wn].add($t),Et[Ar].add($t),Tt[ur].add(rn),Tt[Wn].add(rn),Tt[Ar].add(rn))}let Rn=this.groups;Rn.length===0&&(Rn=[{start:0,count:rt.length}]);for(let ur=0,Wn=Rn.length;ur<Wn;++ur){const Ar=Rn[ur],Cr=Ar.start;for(let Wr=Cr,is=Cr+Ar.count;Wr<is;Wr+=3)cn(rt[Wr+0],rt[Wr+1],rt[Wr+2])}const Cn=new Nn,Tn=new Nn,Gn=new Nn,nr=new Nn;function Qn(ur){Gn.fromArray(lt,3*ur),nr.copy(Gn);const Wn=Et[ur];Cn.copy(Wn),Cn.sub(Gn.multiplyScalar(Gn.dot(Wn))).normalize(),Tn.crossVectors(nr,Wn);const Ar=Tn.dot(Tt[ur])<0?-1:1;St[4*ur]=Cn.x,St[4*ur+1]=Cn.y,St[4*ur+2]=Cn.z,St[4*ur+3]=Ar}for(let ur=0,Wn=Rn.length;ur<Wn;++ur){const Ar=Rn[ur],Cr=Ar.start;for(let Wr=Cr,is=Cr+Ar.count;Wr<is;Wr+=3)Qn(rt[Wr+0]),Qn(rt[Wr+1]),Qn(rt[Wr+2])}}computeVertexNormals(){const a=this.index,_e=this.getAttribute("position");if(_e!==void 0){let rt=this.getAttribute("normal");if(rt===void 0)rt=new Hl(new Float32Array(3*_e.count),3),this.setAttribute("normal",rt);else for(let Ot=0,Lt=rt.count;Ot<Lt;Ot++)rt.setXYZ(Ot,0,0,0);const it=new Nn,lt=new Nn,ft=new Nn,_t=new Nn,St=new Nn,Et=new Nn,Tt=new Nn,Bt=new Nn;if(a)for(let Ot=0,Lt=a.count;Ot<Lt;Ot+=3){const zt=a.getX(Ot+0),Jt=a.getX(Ot+1),Ht=a.getX(Ot+2);it.fromBufferAttribute(_e,zt),lt.fromBufferAttribute(_e,Jt),ft.fromBufferAttribute(_e,Ht),Tt.subVectors(ft,lt),Bt.subVectors(it,lt),Tt.cross(Bt),_t.fromBufferAttribute(rt,zt),St.fromBufferAttribute(rt,Jt),Et.fromBufferAttribute(rt,Ht),_t.add(Tt),St.add(Tt),Et.add(Tt),rt.setXYZ(zt,_t.x,_t.y,_t.z),rt.setXYZ(Jt,St.x,St.y,St.z),rt.setXYZ(Ht,Et.x,Et.y,Et.z)}else for(let Ot=0,Lt=_e.count;Ot<Lt;Ot+=3)it.fromBufferAttribute(_e,Ot+0),lt.fromBufferAttribute(_e,Ot+1),ft.fromBufferAttribute(_e,Ot+2),Tt.subVectors(ft,lt),Bt.subVectors(it,lt),Tt.cross(Bt),rt.setXYZ(Ot+0,Tt.x,Tt.y,Tt.z),rt.setXYZ(Ot+1,Tt.x,Tt.y,Tt.z),rt.setXYZ(Ot+2,Tt.x,Tt.y,Tt.z);this.normalizeNormals(),rt.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const a=this.attributes.normal;for(let _e=0,rt=a.count;_e<rt;_e++)Rt.fromBufferAttribute(a,_e),Rt.normalize(),a.setXYZ(_e,Rt.x,Rt.y,Rt.z)}toNonIndexed(){function a(_t,St){const Et=_t.array,Tt=_t.itemSize,Bt=_t.normalized,Ot=new Et.constructor(St.length*Tt);let Lt=0,zt=0;for(let Jt=0,Ht=St.length;Jt<Ht;Jt++){Lt=_t.isInterleavedBufferAttribute?St[Jt]*_t.data.stride+_t.offset:St[Jt]*Tt;for(let $t=0;$t<Tt;$t++)Ot[zt++]=Et[Lt++]}return new Hl(Ot,Tt,Bt)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const _e=new Kt,rt=this.index.array,it=this.attributes;for(const _t in it){const St=a(it[_t],rt);_e.setAttribute(_t,St)}const lt=this.morphAttributes;for(const _t in lt){const St=[],Et=lt[_t];for(let Tt=0,Bt=Et.length;Tt<Bt;Tt++){const Ot=a(Et[Tt],rt);St.push(Ot)}_e.morphAttributes[_t]=St}_e.morphTargetsRelative=this.morphTargetsRelative;const ft=this.groups;for(let _t=0,St=ft.length;_t<St;_t++){const Et=ft[_t];_e.addGroup(Et.start,Et.count,Et.materialIndex)}return _e}toJSON(){const a={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,this.name!==""&&(a.name=this.name),Object.keys(this.userData).length>0&&(a.userData=this.userData),this.parameters!==void 0){const St=this.parameters;for(const Et in St)St[Et]!==void 0&&(a[Et]=St[Et]);return a}a.data={attributes:{}};const _e=this.index;_e!==null&&(a.data.index={type:_e.array.constructor.name,array:Array.prototype.slice.call(_e.array)});const rt=this.attributes;for(const St in rt){const Et=rt[St];a.data.attributes[St]=Et.toJSON(a.data)}const it={};let lt=!1;for(const St in this.morphAttributes){const Et=this.morphAttributes[St],Tt=[];for(let Bt=0,Ot=Et.length;Bt<Ot;Bt++){const Lt=Et[Bt];Tt.push(Lt.toJSON(a.data))}Tt.length>0&&(it[St]=Tt,lt=!0)}lt&&(a.data.morphAttributes=it,a.data.morphTargetsRelative=this.morphTargetsRelative);const ft=this.groups;ft.length>0&&(a.data.groups=JSON.parse(JSON.stringify(ft)));const _t=this.boundingSphere;return _t!==null&&(a.data.boundingSphere={center:_t.center.toArray(),radius:_t.radius}),a}clone(){return new this.constructor().copy(this)}copy(a){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const _e={};this.name=a.name;const rt=a.index;rt!==null&&this.setIndex(rt.clone(_e));const it=a.attributes;for(const Et in it){const Tt=it[Et];this.setAttribute(Et,Tt.clone(_e))}const lt=a.morphAttributes;for(const Et in lt){const Tt=[],Bt=lt[Et];for(let Ot=0,Lt=Bt.length;Ot<Lt;Ot++)Tt.push(Bt[Ot].clone(_e));this.morphAttributes[Et]=Tt}this.morphTargetsRelative=a.morphTargetsRelative;const ft=a.groups;for(let Et=0,Tt=ft.length;Et<Tt;Et++){const Bt=ft[Et];this.addGroup(Bt.start,Bt.count,Bt.materialIndex)}const _t=a.boundingBox;_t!==null&&(this.boundingBox=_t.clone());const St=a.boundingSphere;return St!==null&&(this.boundingSphere=St.clone()),this.drawRange.start=a.drawRange.start,this.drawRange.count=a.drawRange.count,this.userData=a.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const In=new Ao,Bn=new W0,hr=new s_,Ir=new Nn,us=new Nn,no=new Nn,Fl=new Nn,Cp=new Nn,up=new Nn,l_=new Nr,nv=new Nr,Ov=new Nr,aw=new Nn,Ky=new Nn,f0=new Nn,Jy=new Nn,Ix=new Nn;class hp extends ga{constructor(a=new Kt,_e=new a_){super(),this.isMesh=!0,this.type="Mesh",this.geometry=a,this.material=_e,this.updateMorphTargets()}copy(a,_e){return super.copy(a,_e),a.isMesh?(a.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=a.morphTargetInfluences.slice()),a.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary)),this.material=a.material,this.geometry=a.geometry,this):this}updateMorphTargets(){const a=this.geometry.morphAttributes,_e=Object.keys(a);if(_e.length>0){const rt=a[_e[0]];if(rt!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let it=0,lt=rt.length;it<lt;it++){const ft=rt[it].name||String(it);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ft]=it}}}}getVertexPosition(a,_e){const rt=this.geometry,it=rt.attributes.position,lt=rt.morphAttributes.position,ft=rt.morphTargetsRelative;_e.fromBufferAttribute(it,a);const _t=this.morphTargetInfluences;if(lt&&_t){up.set(0,0,0);for(let St=0,Et=lt.length;St<Et;St++){const Tt=_t[St],Bt=lt[St];Tt!==0&&(Cp.fromBufferAttribute(Bt,a),ft?up.addScaledVector(Cp,Tt):up.addScaledVector(Cp.sub(_e),Tt))}_e.add(up)}return _e}raycast(a,_e){const rt=this.geometry,it=this.material,lt=this.matrixWorld;if(it!==void 0){if(rt.boundingSphere===null&&rt.computeBoundingSphere(),hr.copy(rt.boundingSphere),hr.applyMatrix4(lt),Bn.copy(a.ray).recast(a.near),hr.containsPoint(Bn.origin)===!1&&(Bn.intersectSphere(hr,Ir)===null||Bn.origin.distanceToSquared(Ir)>(a.far-a.near)**2))return;In.copy(lt).invert(),Bn.copy(a.ray).applyMatrix4(In),rt.boundingBox!==null&&Bn.intersectsBox(rt.boundingBox)===!1||this._computeIntersections(a,_e)}}_computeIntersections(a,_e){let rt;const it=this.geometry,lt=this.material,ft=it.index,_t=it.attributes.position,St=it.attributes.uv,Et=it.attributes.uv1,Tt=it.attributes.normal,Bt=it.groups,Ot=it.drawRange;if(ft!==null)if(Array.isArray(lt))for(let Lt=0,zt=Bt.length;Lt<zt;Lt++){const Jt=Bt[Lt],Ht=lt[Jt.materialIndex];for(let $t=Math.max(Jt.start,Ot.start),rn=Math.min(ft.count,Math.min(Jt.start+Jt.count,Ot.start+Ot.count));$t<rn;$t+=3){const cn=ft.getX($t),Rn=ft.getX($t+1),Cn=ft.getX($t+2);rt=Px(this,Ht,a,Bn,St,Et,Tt,cn,Rn,Cn),rt&&(rt.faceIndex=Math.floor($t/3),rt.face.materialIndex=Jt.materialIndex,_e.push(rt))}}else for(let Lt=Math.max(0,Ot.start),zt=Math.min(ft.count,Ot.start+Ot.count);Lt<zt;Lt+=3){const Jt=ft.getX(Lt),Ht=ft.getX(Lt+1),$t=ft.getX(Lt+2);rt=Px(this,lt,a,Bn,St,Et,Tt,Jt,Ht,$t),rt&&(rt.faceIndex=Math.floor(Lt/3),_e.push(rt))}else if(_t!==void 0)if(Array.isArray(lt))for(let Lt=0,zt=Bt.length;Lt<zt;Lt++){const Jt=Bt[Lt],Ht=lt[Jt.materialIndex];for(let $t=Math.max(Jt.start,Ot.start),rn=Math.min(_t.count,Math.min(Jt.start+Jt.count,Ot.start+Ot.count));$t<rn;$t+=3)rt=Px(this,Ht,a,Bn,St,Et,Tt,$t,$t+1,$t+2),rt&&(rt.faceIndex=Math.floor($t/3),rt.face.materialIndex=Jt.materialIndex,_e.push(rt))}else for(let Lt=Math.max(0,Ot.start),zt=Math.min(_t.count,Ot.start+Ot.count);Lt<zt;Lt+=3)rt=Px(this,lt,a,Bn,St,Et,Tt,Lt,Lt+1,Lt+2),rt&&(rt.faceIndex=Math.floor(Lt/3),_e.push(rt))}}function Px(pt,a,_e,rt,it,lt,ft,_t,St,Et){pt.getVertexPosition(_t,us),pt.getVertexPosition(St,no),pt.getVertexPosition(Et,Fl);const Tt=function(Bt,Ot,Lt,zt,Jt,Ht,$t,rn){let cn;if(cn=Ot.side===Gt?zt.intersectTriangle($t,Ht,Jt,!0,rn):zt.intersectTriangle(Jt,Ht,$t,Ot.side===sn,rn),cn===null)return null;Ix.copy(rn),Ix.applyMatrix4(Bt.matrixWorld);const Rn=Lt.ray.origin.distanceTo(Ix);return Rn<Lt.near||Rn>Lt.far?null:{distance:Rn,point:Ix.clone(),object:Bt}}(pt,a,_e,rt,us,no,Fl,Jy);if(Tt){it&&(l_.fromBufferAttribute(it,_t),nv.fromBufferAttribute(it,St),Ov.fromBufferAttribute(it,Et),Tt.uv=Du.getInterpolation(Jy,us,no,Fl,l_,nv,Ov,new Nr)),lt&&(l_.fromBufferAttribute(lt,_t),nv.fromBufferAttribute(lt,St),Ov.fromBufferAttribute(lt,Et),Tt.uv1=Du.getInterpolation(Jy,us,no,Fl,l_,nv,Ov,new Nr),Tt.uv2=Tt.uv1),ft&&(aw.fromBufferAttribute(ft,_t),Ky.fromBufferAttribute(ft,St),f0.fromBufferAttribute(ft,Et),Tt.normal=Du.getInterpolation(Jy,us,no,Fl,aw,Ky,f0,new Nn),Tt.normal.dot(rt.direction)>0&&Tt.normal.multiplyScalar(-1));const Bt={a:_t,b:St,c:Et,normal:new Nn,materialIndex:0};Du.getNormal(us,no,Fl,Bt.normal),Tt.face=Bt}return Tt}class rv extends Kt{constructor(a=1,_e=1,rt=1,it=1,lt=1,ft=1){super(),this.type="BoxGeometry",this.parameters={width:a,height:_e,depth:rt,widthSegments:it,heightSegments:lt,depthSegments:ft};const _t=this;it=Math.floor(it),lt=Math.floor(lt),ft=Math.floor(ft);const St=[],Et=[],Tt=[],Bt=[];let Ot=0,Lt=0;function zt(Jt,Ht,$t,rn,cn,Rn,Cn,Tn,Gn,nr,Qn){const ur=Rn/Gn,Wn=Cn/nr,Ar=Rn/2,Cr=Cn/2,Wr=Tn/2,is=Gn+1,Qr=nr+1;let Pr=0,Jr=0;const rs=new Nn;for(let vr=0;vr<Qr;vr++){const Br=vr*Wn-Cr;for(let es=0;es<is;es++){const zr=es*ur-Ar;rs[Jt]=zr*rn,rs[Ht]=Br*cn,rs[$t]=Wr,Et.push(rs.x,rs.y,rs.z),rs[Jt]=0,rs[Ht]=0,rs[$t]=Tn>0?1:-1,Tt.push(rs.x,rs.y,rs.z),Bt.push(es/Gn),Bt.push(1-vr/nr),Pr+=1}}for(let vr=0;vr<nr;vr++)for(let Br=0;Br<Gn;Br++){const es=Ot+Br+is*vr,zr=Ot+Br+is*(vr+1),as=Ot+(Br+1)+is*(vr+1),ro=Ot+(Br+1)+is*vr;St.push(es,zr,ro),St.push(zr,as,ro),Jr+=6}_t.addGroup(Lt,Jr,Qn),Lt+=Jr,Ot+=Pr}zt("z","y","x",-1,-1,rt,_e,a,ft,lt,0),zt("z","y","x",1,-1,rt,_e,-a,ft,lt,1),zt("x","z","y",1,1,a,rt,_e,it,ft,2),zt("x","z","y",1,-1,a,rt,-_e,it,ft,3),zt("x","y","z",1,-1,a,_e,rt,it,lt,4),zt("x","y","z",-1,-1,a,_e,-rt,it,lt,5),this.setIndex(St),this.setAttribute("position",new vs(Et,3)),this.setAttribute("normal",new vs(Tt,3)),this.setAttribute("uv",new vs(Bt,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new rv(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments)}}function Zy(pt){const a={};for(const _e in pt){a[_e]={};for(const rt in pt[_e]){const it=pt[_e][rt];it&&(it.isColor||it.isMatrix3||it.isMatrix4||it.isVector2||it.isVector3||it.isVector4||it.isTexture||it.isQuaternion)?it.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),a[_e][rt]=null):a[_e][rt]=it.clone():Array.isArray(it)?a[_e][rt]=it.slice():a[_e][rt]=it}}return a}function ym(pt){const a={};for(let _e=0;_e<pt.length;_e++){const rt=Zy(pt[_e]);for(const it in rt)a[it]=rt[it]}return a}function q1(pt){return pt.getRenderTarget()===null?pt.outputColorSpace:yo}const jT={clone:Zy,merge:ym};class Bv extends cp{constructor(a){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,a!==void 0&&this.setValues(a)}copy(a){return super.copy(a),this.fragmentShader=a.fragmentShader,this.vertexShader=a.vertexShader,this.uniforms=Zy(a.uniforms),this.uniformsGroups=function(_e){const rt=[];for(let it=0;it<_e.length;it++)rt.push(_e[it].clone());return rt}(a.uniformsGroups),this.defines=Object.assign({},a.defines),this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.fog=a.fog,this.lights=a.lights,this.clipping=a.clipping,this.extensions=Object.assign({},a.extensions),this.glslVersion=a.glslVersion,this}toJSON(a){const _e=super.toJSON(a);_e.glslVersion=this.glslVersion,_e.uniforms={};for(const it in this.uniforms){const lt=this.uniforms[it].value;lt&&lt.isTexture?_e.uniforms[it]={type:"t",value:lt.toJSON(a).uuid}:lt&&lt.isColor?_e.uniforms[it]={type:"c",value:lt.getHex()}:lt&&lt.isVector2?_e.uniforms[it]={type:"v2",value:lt.toArray()}:lt&&lt.isVector3?_e.uniforms[it]={type:"v3",value:lt.toArray()}:lt&&lt.isVector4?_e.uniforms[it]={type:"v4",value:lt.toArray()}:lt&&lt.isMatrix3?_e.uniforms[it]={type:"m3",value:lt.toArray()}:lt&&lt.isMatrix4?_e.uniforms[it]={type:"m4",value:lt.toArray()}:_e.uniforms[it]={value:lt}}Object.keys(this.defines).length>0&&(_e.defines=this.defines),_e.vertexShader=this.vertexShader,_e.fragmentShader=this.fragmentShader,_e.lights=this.lights,_e.clipping=this.clipping;const rt={};for(const it in this.extensions)this.extensions[it]===!0&&(rt[it]=!0);return Object.keys(rt).length>0&&(_e.extensions=rt),_e}}class zS extends ga{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ao,this.projectionMatrix=new Ao,this.projectionMatrixInverse=new Ao}copy(a,_e){return super.copy(a,_e),this.matrixWorldInverse.copy(a.matrixWorldInverse),this.projectionMatrix.copy(a.projectionMatrix),this.projectionMatrixInverse.copy(a.projectionMatrixInverse),this}getWorldDirection(a){this.updateWorldMatrix(!0,!1);const _e=this.matrixWorld.elements;return a.set(-_e[8],-_e[9],-_e[10]).normalize()}updateMatrixWorld(a){super.updateMatrixWorld(a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(a,_e){super.updateWorldMatrix(a,_e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class rm extends zS{constructor(a=50,_e=1,rt=.1,it=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=a,this.zoom=1,this.near=rt,this.far=it,this.focus=10,this.aspect=_e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(a,_e){return super.copy(a,_e),this.fov=a.fov,this.zoom=a.zoom,this.near=a.near,this.far=a.far,this.focus=a.focus,this.aspect=a.aspect,this.view=a.view===null?null:Object.assign({},a.view),this.filmGauge=a.filmGauge,this.filmOffset=a.filmOffset,this}setFocalLength(a){const _e=.5*this.getFilmHeight()/a;this.fov=2*n_*Math.atan(_e),this.updateProjectionMatrix()}getFocalLength(){const a=Math.tan(.5*Iv*this.fov);return .5*this.getFilmHeight()/a}getEffectiveFOV(){return 2*n_*Math.atan(Math.tan(.5*Iv*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(a,_e,rt,it,lt,ft){this.aspect=a/_e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=_e,this.view.offsetX=rt,this.view.offsetY=it,this.view.width=lt,this.view.height=ft,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const a=this.near;let _e=a*Math.tan(.5*Iv*this.fov)/this.zoom,rt=2*_e,it=this.aspect*rt,lt=-.5*it;const ft=this.view;if(this.view!==null&&this.view.enabled){const St=ft.fullWidth,Et=ft.fullHeight;lt+=ft.offsetX*it/St,_e-=ft.offsetY*rt/Et,it*=ft.width/St,rt*=ft.height/Et}const _t=this.filmOffset;_t!==0&&(lt+=a*_t/this.getFilmWidth()),this.projectionMatrix.makePerspective(lt,lt+it,_e,_e-rt,a,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){const _e=super.toJSON(a);return _e.object.fov=this.fov,_e.object.zoom=this.zoom,_e.object.near=this.near,_e.object.far=this.far,_e.object.focus=this.focus,_e.object.aspect=this.aspect,this.view!==null&&(_e.object.view=Object.assign({},this.view)),_e.object.filmGauge=this.filmGauge,_e.object.filmOffset=this.filmOffset,_e}}const eA=-90;class zT extends ga{constructor(a,_e,rt){super(),this.type="CubeCamera",this.renderTarget=rt;const it=new rm(eA,1,a,_e);it.layers=this.layers,it.up.set(0,1,0),it.lookAt(1,0,0),this.add(it);const lt=new rm(eA,1,a,_e);lt.layers=this.layers,lt.up.set(0,1,0),lt.lookAt(-1,0,0),this.add(lt);const ft=new rm(eA,1,a,_e);ft.layers=this.layers,ft.up.set(0,0,-1),ft.lookAt(0,1,0),this.add(ft);const _t=new rm(eA,1,a,_e);_t.layers=this.layers,_t.up.set(0,0,1),_t.lookAt(0,-1,0),this.add(_t);const St=new rm(eA,1,a,_e);St.layers=this.layers,St.up.set(0,1,0),St.lookAt(0,0,1),this.add(St);const Et=new rm(eA,1,a,_e);Et.layers=this.layers,Et.up.set(0,1,0),Et.lookAt(0,0,-1),this.add(Et)}update(a,_e){this.parent===null&&this.updateMatrixWorld();const rt=this.renderTarget,[it,lt,ft,_t,St,Et]=this.children,Tt=a.getRenderTarget(),Bt=a.toneMapping,Ot=a.xr.enabled;a.toneMapping=Ks,a.xr.enabled=!1;const Lt=rt.texture.generateMipmaps;rt.texture.generateMipmaps=!1,a.setRenderTarget(rt,0),a.render(_e,it),a.setRenderTarget(rt,1),a.render(_e,lt),a.setRenderTarget(rt,2),a.render(_e,ft),a.setRenderTarget(rt,3),a.render(_e,_t),a.setRenderTarget(rt,4),a.render(_e,St),rt.texture.generateMipmaps=Lt,a.setRenderTarget(rt,5),a.render(_e,Et),a.setRenderTarget(Tt),a.toneMapping=Bt,a.xr.enabled=Ot,rt.texture.needsPMREMUpdate=!0}}class lw extends Yl{constructor(a,_e,rt,it,lt,ft,_t,St,Et,Tt){super(a=a!==void 0?a:[],_e=_e!==void 0?_e:Pl,rt,it,lt,ft,_t,St,Et,Tt),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(a){this.image=a}}class VT extends _h{constructor(a=1,_e={}){super(a,a,_e),this.isWebGLCubeRenderTarget=!0;const rt={width:a,height:a,depth:1},it=[rt,rt,rt,rt,rt,rt];_e.encoding!==void 0&&(j0("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),_e.colorSpace=_e.encoding===gu?Gs:_g),this.texture=new lw(it,_e.mapping,_e.wrapS,_e.wrapT,_e.magFilter,_e.minFilter,_e.format,_e.type,_e.anisotropy,_e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=_e.generateMipmaps!==void 0&&_e.generateMipmaps,this.texture.minFilter=_e.minFilter!==void 0?_e.minFilter:xl}fromEquirectangularTexture(a,_e){this.texture.type=_e.type,this.texture.colorSpace=_e.colorSpace,this.texture.generateMipmaps=_e.generateMipmaps,this.texture.minFilter=_e.minFilter,this.texture.magFilter=_e.magFilter;const rt={tEquirect:{value:null}},it=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,lt=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,ft=new rv(5,5,5),_t=new Bv({name:"CubemapFromEquirect",uniforms:Zy(rt),vertexShader:it,fragmentShader:lt,side:Gt,blending:Wt});_t.uniforms.tEquirect.value=_e;const St=new hp(ft,_t),Et=_e.minFilter;return _e.minFilter===Gl&&(_e.minFilter=xl),new zT(1,10,this).update(a,St),_e.minFilter=Et,St.geometry.dispose(),St.material.dispose(),this}clear(a,_e,rt,it){const lt=a.getRenderTarget();for(let ft=0;ft<6;ft++)a.setRenderTarget(this,ft),a.clear(_e,rt,it);a.setRenderTarget(lt)}}const VS=new Nn,WD=new Nn,qD=new xo;class im{constructor(a=new Nn(1,0,0),_e=0){this.isPlane=!0,this.normal=a,this.constant=_e}set(a,_e){return this.normal.copy(a),this.constant=_e,this}setComponents(a,_e,rt,it){return this.normal.set(a,_e,rt),this.constant=it,this}setFromNormalAndCoplanarPoint(a,_e){return this.normal.copy(a),this.constant=-_e.dot(this.normal),this}setFromCoplanarPoints(a,_e,rt){const it=VS.subVectors(rt,_e).cross(WD.subVectors(a,_e)).normalize();return this.setFromNormalAndCoplanarPoint(it,a),this}copy(a){return this.normal.copy(a.normal),this.constant=a.constant,this}normalize(){const a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(a){return this.normal.dot(a)+this.constant}distanceToSphere(a){return this.distanceToPoint(a.center)-a.radius}projectPoint(a,_e){return _e.copy(a).addScaledVector(this.normal,-this.distanceToPoint(a))}intersectLine(a,_e){const rt=a.delta(VS),it=this.normal.dot(rt);if(it===0)return this.distanceToPoint(a.start)===0?_e.copy(a.start):null;const lt=-(a.start.dot(this.normal)+this.constant)/it;return lt<0||lt>1?null:_e.copy(a.start).addScaledVector(rt,lt)}intersectsLine(a){const _e=this.distanceToPoint(a.start),rt=this.distanceToPoint(a.end);return _e<0&&rt>0||rt<0&&_e>0}intersectsBox(a){return a.intersectsPlane(this)}intersectsSphere(a){return a.intersectsPlane(this)}coplanarPoint(a){return a.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(a,_e){const rt=_e||qD.getNormalMatrix(a),it=this.coplanarPoint(VS).applyMatrix4(a),lt=this.normal.applyMatrix3(rt).normalize();return this.constant=-it.dot(lt),this}translate(a){return this.constant-=a.dot(this.normal),this}equals(a){return a.normal.equals(this.normal)&&a.constant===this.constant}clone(){return new this.constructor().copy(this)}}const m0=new s_,X1=new Nn;class Y1{constructor(a=new im,_e=new im,rt=new im,it=new im,lt=new im,ft=new im){this.planes=[a,_e,rt,it,lt,ft]}set(a,_e,rt,it,lt,ft){const _t=this.planes;return _t[0].copy(a),_t[1].copy(_e),_t[2].copy(rt),_t[3].copy(it),_t[4].copy(lt),_t[5].copy(ft),this}copy(a){const _e=this.planes;for(let rt=0;rt<6;rt++)_e[rt].copy(a.planes[rt]);return this}setFromProjectionMatrix(a){const _e=this.planes,rt=a.elements,it=rt[0],lt=rt[1],ft=rt[2],_t=rt[3],St=rt[4],Et=rt[5],Tt=rt[6],Bt=rt[7],Ot=rt[8],Lt=rt[9],zt=rt[10],Jt=rt[11],Ht=rt[12],$t=rt[13],rn=rt[14],cn=rt[15];return _e[0].setComponents(_t-it,Bt-St,Jt-Ot,cn-Ht).normalize(),_e[1].setComponents(_t+it,Bt+St,Jt+Ot,cn+Ht).normalize(),_e[2].setComponents(_t+lt,Bt+Et,Jt+Lt,cn+$t).normalize(),_e[3].setComponents(_t-lt,Bt-Et,Jt-Lt,cn-$t).normalize(),_e[4].setComponents(_t-ft,Bt-Tt,Jt-zt,cn-rn).normalize(),_e[5].setComponents(_t+ft,Bt+Tt,Jt+zt,cn+rn).normalize(),this}intersectsObject(a){if(a.boundingSphere!==void 0)a.boundingSphere===null&&a.computeBoundingSphere(),m0.copy(a.boundingSphere).applyMatrix4(a.matrixWorld);else{const _e=a.geometry;_e.boundingSphere===null&&_e.computeBoundingSphere(),m0.copy(_e.boundingSphere).applyMatrix4(a.matrixWorld)}return this.intersectsSphere(m0)}intersectsSprite(a){return m0.center.set(0,0,0),m0.radius=.7071067811865476,m0.applyMatrix4(a.matrixWorld),this.intersectsSphere(m0)}intersectsSphere(a){const _e=this.planes,rt=a.center,it=-a.radius;for(let lt=0;lt<6;lt++)if(_e[lt].distanceToPoint(rt)<it)return!1;return!0}intersectsBox(a){const _e=this.planes;for(let rt=0;rt<6;rt++){const it=_e[rt];if(X1.x=it.normal.x>0?a.max.x:a.min.x,X1.y=it.normal.y>0?a.max.y:a.min.y,X1.z=it.normal.z>0?a.max.z:a.min.z,it.distanceToPoint(X1)<0)return!1}return!0}containsPoint(a){const _e=this.planes;for(let rt=0;rt<6;rt++)if(_e[rt].distanceToPoint(a)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function GT(){let pt=null,a=!1,_e=null,rt=null;function it(lt,ft){_e(lt,ft),rt=pt.requestAnimationFrame(it)}return{start:function(){a!==!0&&_e!==null&&(rt=pt.requestAnimationFrame(it),a=!0)},stop:function(){pt.cancelAnimationFrame(rt),a=!1},setAnimationLoop:function(lt){_e=lt},setContext:function(lt){pt=lt}}}function h2(pt,a){const _e=a.isWebGL2,rt=new WeakMap;return{get:function(it){return it.isInterleavedBufferAttribute&&(it=it.data),rt.get(it)},remove:function(it){it.isInterleavedBufferAttribute&&(it=it.data);const lt=rt.get(it);lt&&(pt.deleteBuffer(lt.buffer),rt.delete(it))},update:function(it,lt){if(it.isGLBufferAttribute){const _t=rt.get(it);return void((!_t||_t.version<it.version)&&rt.set(it,{buffer:it.buffer,type:it.type,bytesPerElement:it.elementSize,version:it.version}))}it.isInterleavedBufferAttribute&&(it=it.data);const ft=rt.get(it);ft===void 0?rt.set(it,function(_t,St){const Et=_t.array,Tt=_t.usage,Bt=pt.createBuffer();let Ot;if(pt.bindBuffer(St,Bt),pt.bufferData(St,Et,Tt),_t.onUploadCallback(),Et instanceof Float32Array)Ot=pt.FLOAT;else if(Et instanceof Uint16Array)if(_t.isFloat16BufferAttribute){if(!_e)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");Ot=pt.HALF_FLOAT}else Ot=pt.UNSIGNED_SHORT;else if(Et instanceof Int16Array)Ot=pt.SHORT;else if(Et instanceof Uint32Array)Ot=pt.UNSIGNED_INT;else if(Et instanceof Int32Array)Ot=pt.INT;else if(Et instanceof Int8Array)Ot=pt.BYTE;else if(Et instanceof Uint8Array)Ot=pt.UNSIGNED_BYTE;else{if(!(Et instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+Et);Ot=pt.UNSIGNED_BYTE}return{buffer:Bt,type:Ot,bytesPerElement:Et.BYTES_PER_ELEMENT,version:_t.version}}(it,lt)):ft.version<it.version&&(function(_t,St,Et){const Tt=St.array,Bt=St.updateRange;pt.bindBuffer(Et,_t),Bt.count===-1?pt.bufferSubData(Et,0,Tt):(_e?pt.bufferSubData(Et,Bt.offset*Tt.BYTES_PER_ELEMENT,Tt,Bt.offset,Bt.count):pt.bufferSubData(Et,Bt.offset*Tt.BYTES_PER_ELEMENT,Tt.subarray(Bt.offset,Bt.offset+Bt.count)),Bt.count=-1),St.onUploadCallback()}(ft.buffer,it,lt),ft.version=it.version)}}}class M_ extends Kt{constructor(a=1,_e=1,rt=1,it=1){super(),this.type="PlaneGeometry",this.parameters={width:a,height:_e,widthSegments:rt,heightSegments:it};const lt=a/2,ft=_e/2,_t=Math.floor(rt),St=Math.floor(it),Et=_t+1,Tt=St+1,Bt=a/_t,Ot=_e/St,Lt=[],zt=[],Jt=[],Ht=[];for(let $t=0;$t<Tt;$t++){const rn=$t*Ot-ft;for(let cn=0;cn<Et;cn++){const Rn=cn*Bt-lt;zt.push(Rn,-rn,0),Jt.push(0,0,1),Ht.push(cn/_t),Ht.push(1-$t/St)}}for(let $t=0;$t<St;$t++)for(let rn=0;rn<_t;rn++){const cn=rn+Et*$t,Rn=rn+Et*($t+1),Cn=rn+1+Et*($t+1),Tn=rn+1+Et*$t;Lt.push(cn,Rn,Tn),Lt.push(Rn,Cn,Tn)}this.setIndex(Lt),this.setAttribute("position",new vs(zt,3)),this.setAttribute("normal",new vs(Jt,3)),this.setAttribute("uv",new vs(Ht,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new M_(a.width,a.height,a.widthSegments,a.heightSegments)}}const Eo={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vAlphaMapUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
		#if defined( FIX_ENV_DIRECTION )
			vec3 worldNormal = normal;
		#else
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#endif
			worldNormal = transformDirection(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#if !defined( FIX_ENV_DIRECTION )
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			#endif
			reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#ifdef USE_NORMALMAP_TANGENTSPACE
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	#ifndef WebGL2Context
	#define textureLod texture2DLodEXT
	#define textureSize(s, lod) vec2(1024./pow(2.,float(lod)),1024./pow(2.,float(lod)))
	#define isinf(x) (x > 1e20 || x < -1e20)
	#endif
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		if(roughness == 0.0) return transmissionSamplerMapTexelToLinear( texture2D( transmissionSamplerMap, fragCoord.xy ) );
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return transmissionSamplerMapTexelToLinear( textureBicubic( transmissionSamplerMap, fragCoord.xy, lod ) );
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) || attenuationDistance == 0.0) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`#ifdef HAS_TEXTURE
varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
#endif
void main() {
#ifdef HAS_TEXTURE
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
#endif
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`#ifdef HAS_TEXTURE
uniform sampler2D t2D;
varying vec2 vUv;
#endif
uniform float backgroundIntensity;
uniform vec3 backgroundColor;
void main() {
#ifdef HAS_TEXTURE
	vec4 texColor = texture2D( t2D, vUv );
#else
	vec4 texColor = vec4( 1.0 );
#endif
	texColor.rgb *= backgroundColor * backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#include <envmap_common_pars_fragment>
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
void main() {
	vec3 vReflect = vWorldDirection;
	vReflect = transformDirection(vReflect, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vReflect, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	texColor.rgb *= envMapIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},hs={common:{diffuse:{value:new ps(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new xo},alphaMap:{value:null},alphaMapTransform:{value:new xo},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new xo}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new xo}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new xo}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new xo},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new xo},normalScale:{value:new Nr(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new xo},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new xo}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new xo}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new xo}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ps(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ps(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new xo}},sprite:{diffuse:{value:new ps(16777215)},opacity:{value:1},center:{value:new Nr(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new xo},alphaMap:{value:null},alphaTest:{value:0}}},zp={basic:{uniforms:ym([hs.common,hs.specularmap,hs.envmap,hs.aomap,hs.lightmap,hs.fog]),vertexShader:Eo.meshbasic_vert,fragmentShader:Eo.meshbasic_frag},lambert:{uniforms:ym([hs.common,hs.specularmap,hs.envmap,hs.aomap,hs.lightmap,hs.emissivemap,hs.bumpmap,hs.normalmap,hs.displacementmap,hs.fog,hs.lights,{emissive:{value:new ps(0)}}]),vertexShader:Eo.meshlambert_vert,fragmentShader:Eo.meshlambert_frag},phong:{uniforms:ym([hs.common,hs.specularmap,hs.envmap,hs.aomap,hs.lightmap,hs.emissivemap,hs.bumpmap,hs.normalmap,hs.displacementmap,hs.fog,hs.lights,{emissive:{value:new ps(0)},specular:{value:new ps(1118481)},shininess:{value:30}}]),vertexShader:Eo.meshphong_vert,fragmentShader:Eo.meshphong_frag},standard:{uniforms:ym([hs.common,hs.envmap,hs.aomap,hs.lightmap,hs.emissivemap,hs.bumpmap,hs.normalmap,hs.displacementmap,hs.roughnessmap,hs.metalnessmap,hs.fog,hs.lights,{emissive:{value:new ps(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Eo.meshphysical_vert,fragmentShader:Eo.meshphysical_frag},toon:{uniforms:ym([hs.common,hs.aomap,hs.lightmap,hs.emissivemap,hs.bumpmap,hs.normalmap,hs.displacementmap,hs.gradientmap,hs.fog,hs.lights,{emissive:{value:new ps(0)}}]),vertexShader:Eo.meshtoon_vert,fragmentShader:Eo.meshtoon_frag},matcap:{uniforms:ym([hs.common,hs.bumpmap,hs.normalmap,hs.displacementmap,hs.fog,{matcap:{value:null}}]),vertexShader:Eo.meshmatcap_vert,fragmentShader:Eo.meshmatcap_frag},points:{uniforms:ym([hs.points,hs.fog]),vertexShader:Eo.points_vert,fragmentShader:Eo.points_frag},dashed:{uniforms:ym([hs.common,hs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Eo.linedashed_vert,fragmentShader:Eo.linedashed_frag},depth:{uniforms:ym([hs.common,hs.displacementmap]),vertexShader:Eo.depth_vert,fragmentShader:Eo.depth_frag},normal:{uniforms:ym([hs.common,hs.bumpmap,hs.normalmap,hs.displacementmap,{opacity:{value:1}}]),vertexShader:Eo.meshnormal_vert,fragmentShader:Eo.meshnormal_frag},sprite:{uniforms:ym([hs.sprite,hs.fog]),vertexShader:Eo.sprite_vert,fragmentShader:Eo.sprite_frag},background:{uniforms:{uvTransform:{value:new xo},t2D:{value:null},backgroundIntensity:{value:1},backgroundColor:{value:new ps(16777215)},flipX:{value:!1},flipY:{value:!1}},vertexShader:Eo.background_vert,fragmentShader:Eo.background_frag},backgroundCube:{uniforms:{envMap:{value:null},envMapRotation:{value:0},envMapIntensity:{value:1},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Eo.backgroundCube_vert,fragmentShader:Eo.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Eo.cube_vert,fragmentShader:Eo.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Eo.equirect_vert,fragmentShader:Eo.equirect_frag},distanceRGBA:{uniforms:ym([hs.common,hs.displacementmap,{referencePosition:{value:new Nn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Eo.distanceRGBA_vert,fragmentShader:Eo.distanceRGBA_frag},shadow:{uniforms:ym([hs.lights,hs.fog,{color:{value:new ps(0)},opacity:{value:1}}]),vertexShader:Eo.shadow_vert,fragmentShader:Eo.shadow_frag}};zp.physical={uniforms:ym([zp.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new xo},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new xo},clearcoatNormalScale:{value:new Nr(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new xo},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new xo},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new xo},sheen:{value:0},sheenColor:{value:new ps(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new xo},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new xo},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new xo},transmissionSamplerSize:{value:new Nr},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new xo},attenuationDistance:{value:0},attenuationColor:{value:new ps(0)},specularColor:{value:new ps(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new xo},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new xo}}]),vertexShader:Eo.meshphysical_vert,fragmentShader:Eo.meshphysical_frag};const GS={r:0,b:0,g:0};function XD(pt,a,_e,rt,it,lt,ft){const _t=new ps(0);let St,Et,Tt=lt===!0?0:1,Bt=null,Ot=0,Lt=null;function zt(Jt,Ht){Jt.getRGB(GS,q1(pt)),rt.buffers.color.setClear(GS.r,GS.g,GS.b,Ht,ft)}return{getClearColor:function(){return _t},setClearColor:function(Jt,Ht=1){_t.set(Jt),Tt=Ht,zt(_t,Tt)},getClearAlpha:function(){return Tt},setClearAlpha:function(Jt){Tt=Jt,zt(_t,Tt)},getPlaneMesh:function(){return St},getBoxMesh:function(){return Et},getBoxMesh2:function(){return Et===void 0&&(Et=new hp(new rv(1,1,1),new Bv({name:"BackgroundCubeMaterial",uniforms:Zy(zp.backgroundCube.uniforms),vertexShader:zp.backgroundCube.vertexShader,fragmentShader:zp.backgroundCube.fragmentShader,side:Gt,depthTest:!1,depthWrite:!1,fog:!1})),Et.geometry.deleteAttribute("normal"),Et.geometry.deleteAttribute("uv"),Et.onBeforeRender=function(Jt,Ht,$t){this.matrixWorld.copyPosition($t.matrixWorld)},Object.defineProperty(Et.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),it.update(Et)),Et},render:function(Jt,Ht){let $t=!1,rn=Ht.isScene===!0?Ht.background:null;const cn=Ht.isScene&&Ht.backgroundColor!==void 0?Ht.backgroundColor:null;switch(rn==="environment"&&(rn=Ht.environment),rn&&rn.isTexture&&(rn=(Ht.backgroundBlurriness>0?_e:a).get(rn)),rn===null?zt(_t,Tt):rn&&rn.isColor&&(zt(rn,1),$t=!0),pt.xr.getEnvironmentBlendMode()){case"opaque":$t=!0;break;case"additive":rt.buffers.color.setClear(0,0,0,1,ft),$t=!0;break;case"alpha-blend":rt.buffers.color.setClear(0,0,0,0,ft),$t=!0}if((pt.autoClear||$t)&&pt.clear(pt.autoClearColor,pt.autoClearDepth,pt.autoClearStencil),rn&&(rn.isCubeTexture||rn.mapping===Go))Et===void 0&&(Et=new hp(new rv(1,1,1),new Bv({name:"BackgroundCubeMaterial",uniforms:Zy(zp.backgroundCube.uniforms),vertexShader:zp.backgroundCube.vertexShader,fragmentShader:zp.backgroundCube.fragmentShader,side:Gt,depthTest:!1,depthWrite:!1,fog:!1})),Et.geometry.deleteAttribute("normal"),Et.geometry.deleteAttribute("uv"),Et.onBeforeRender=function(Rn,Cn,Tn){this.matrixWorld.copyPosition(Tn.matrixWorld)},Object.defineProperty(Et.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),it.update(Et)),Et.material.uniforms.envMap.value=rn,Et.material.uniforms.envMapRotation.value=rn&&rn.rotation||0,Et.material.uniforms.envMapIntensity.value=rn===Ht.environment&&Ht.envMapIntensity||1,Et.material.uniforms.flipEnvMap.value=rn.isCubeTexture&&rn.isRenderTargetTexture===!1?-1:1,Et.material.uniforms.backgroundBlurriness.value=Ht.backgroundBlurriness,Et.material.uniforms.backgroundIntensity.value=Ht.backgroundIntensity,Et.material.toneMapped=rn.colorSpace!==Gs,Bt===rn&&Ot===rn.version&&Lt===pt.toneMapping||(Et.material.needsUpdate=!0,Bt=rn,Ot=rn.version,Lt=pt.toneMapping),Et.layers.enableAll(),Jt.unshift(Et,Et.geometry,Et.material,0,0,null);else if(rn&&rn.isTexture||!rn&&cn){St===void 0&&(St=new hp(new M_(2,2),new Bv({name:"BackgroundMaterial",uniforms:Zy(zp.background.uniforms),vertexShader:zp.background.vertexShader,fragmentShader:zp.background.fragmentShader,side:sn,depthTest:!1,depthWrite:!1,fog:!1})),St.geometry.deleteAttribute("normal"),Object.defineProperty(St.material,"map",{get:function(){return this.uniforms.t2D.value}}),it.update(St)),St.material.uniforms.backgroundColor.value.set(cn||16777215),St.material.uniforms.t2D.value=rn,St.material.uniforms.backgroundIntensity.value=Ht.backgroundIntensity,rn?(St.material.toneMapped=rn.colorSpace!==Gs,St.material.uniforms.flipX.value=rn.userData.flipX||!1,St.material.uniforms.flipY.value=rn.userData.flipY||!1,rn.matrixAutoUpdate===!0&&rn.updateMatrix(),St.material.uniforms.uvTransform.value.copy(rn.matrix),St.material.defines.HAS_TEXTURE="1"):St.material.defines.HAS_TEXTURE&&delete St.material.defines.HAS_TEXTURE;const Rn=rn?rn.version:-1;Bt===rn&&Ot===Rn&&Lt===pt.toneMapping||(St.material.needsUpdate=!0,Bt=rn,Ot=Rn,Lt=pt.toneMapping),St.layers.enableAll(),Jt.unshift(St,St.geometry,St.material,0,0,null)}}}}function YD(pt,a,_e,rt){const it=pt.getParameter(pt.MAX_VERTEX_ATTRIBS),lt=rt.isWebGL2?null:a.get("OES_vertex_array_object"),ft=rt.isWebGL2||lt!==null,_t={},St=Lt(null);let Et=St,Tt=!1;function Bt(Cn){return rt.isWebGL2?pt.bindVertexArray(Cn):lt.bindVertexArrayOES(Cn)}function Ot(Cn){return rt.isWebGL2?pt.deleteVertexArray(Cn):lt.deleteVertexArrayOES(Cn)}function Lt(Cn){const Tn=[],Gn=[],nr=[];for(let Qn=0;Qn<it;Qn++)Tn[Qn]=0,Gn[Qn]=0,nr[Qn]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Tn,enabledAttributes:Gn,attributeDivisors:nr,object:Cn,attributes:{},index:null}}function zt(){const Cn=Et.newAttributes;for(let Tn=0,Gn=Cn.length;Tn<Gn;Tn++)Cn[Tn]=0}function Jt(Cn){Ht(Cn,0)}function Ht(Cn,Tn){const Gn=Et.newAttributes,nr=Et.enabledAttributes,Qn=Et.attributeDivisors;Gn[Cn]=1,nr[Cn]===0&&(pt.enableVertexAttribArray(Cn),nr[Cn]=1),Qn[Cn]!==Tn&&((rt.isWebGL2?pt:a.get("ANGLE_instanced_arrays"))[rt.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Cn,Tn),Qn[Cn]=Tn)}function $t(){const Cn=Et.newAttributes,Tn=Et.enabledAttributes;for(let Gn=0,nr=Tn.length;Gn<nr;Gn++)Tn[Gn]!==Cn[Gn]&&(pt.disableVertexAttribArray(Gn),Tn[Gn]=0)}function rn(Cn,Tn,Gn,nr,Qn,ur){rt.isWebGL2!==!0||Gn!==pt.INT&&Gn!==pt.UNSIGNED_INT?pt.vertexAttribPointer(Cn,Tn,Gn,nr,Qn,ur):pt.vertexAttribIPointer(Cn,Tn,Gn,Qn,ur)}function cn(){Rn(),Tt=!0,Et!==St&&(Et=St,Bt(Et.object))}function Rn(){St.geometry=null,St.program=null,St.wireframe=!1}return{setup:function(Cn,Tn,Gn,nr,Qn){let ur=!1;if(ft){const Wn=function(Ar,Cr,Wr){const is=Wr.wireframe===!0;let Qr=_t[Ar.id];Qr===void 0&&(Qr={},_t[Ar.id]=Qr);let Pr=Qr[Cr.id];Pr===void 0&&(Pr={},Qr[Cr.id]=Pr);let Jr=Pr[is];return Jr===void 0&&(Jr=Lt(rt.isWebGL2?pt.createVertexArray():lt.createVertexArrayOES()),Pr[is]=Jr),Jr}(nr,Gn,Tn);Et!==Wn&&(Et=Wn,Bt(Et.object)),ur=function(Ar,Cr,Wr,is){const Qr=Et.attributes,Pr=Cr.attributes;let Jr=0;const rs=Wr.getAttributes();for(const vr in rs)if(rs[vr].location>=0){const Br=Qr[vr];let es=Pr[vr];if(es===void 0&&(vr==="instanceMatrix"&&Ar.instanceMatrix&&(es=Ar.instanceMatrix),vr==="instanceColor"&&Ar.instanceColor&&(es=Ar.instanceColor)),Br===void 0||Br.attribute!==es||es&&Br.data!==es.data)return!0;Jr++}return Et.attributesNum!==Jr||Et.index!==is}(Cn,nr,Gn,Qn),ur&&function(Ar,Cr,Wr,is){const Qr={},Pr=Cr.attributes;let Jr=0;const rs=Wr.getAttributes();for(const vr in rs)if(rs[vr].location>=0){let Br=Pr[vr];Br===void 0&&(vr==="instanceMatrix"&&Ar.instanceMatrix&&(Br=Ar.instanceMatrix),vr==="instanceColor"&&Ar.instanceColor&&(Br=Ar.instanceColor));const es={};es.attribute=Br,Br&&Br.data&&(es.data=Br.data),Qr[vr]=es,Jr++}Et.attributes=Qr,Et.attributesNum=Jr,Et.index=is}(Cn,nr,Gn,Qn)}else{const Wn=Tn.wireframe===!0;Et.geometry===nr.id&&Et.program===Gn.id&&Et.wireframe===Wn||(Et.geometry=nr.id,Et.program=Gn.id,Et.wireframe=Wn,ur=!0)}Qn!==null&&_e.update(Qn,pt.ELEMENT_ARRAY_BUFFER),(ur||Tt)&&(Tt=!1,function(Wn,Ar,Cr,Wr){if(rt.isWebGL2===!1&&(Wn.isInstancedMesh||Wr.isInstancedBufferGeometry)&&a.get("ANGLE_instanced_arrays")===null)return;zt();const is=Wr.attributes,Qr=Cr.getAttributes(),Pr=Ar.defaultAttributeValues;for(const Jr in Qr){const rs=Qr[Jr];if(rs.location>=0){let vr=is[Jr];if(vr===void 0&&(Jr==="instanceMatrix"&&Wn.instanceMatrix&&(vr=Wn.instanceMatrix),Jr==="instanceColor"&&Wn.instanceColor&&(vr=Wn.instanceColor)),vr!==void 0){const Br=vr.normalized,es=vr.itemSize,zr=_e.get(vr);if(zr===void 0)continue;const as=zr.buffer,ro=zr.type,Hn=zr.bytesPerElement;if(vr.isInterleavedBufferAttribute){const Dn=vr.data,pr=Dn.stride,$n=vr.offset;if(Dn.isInstancedInterleavedBuffer){for(let Fn=0;Fn<rs.locationSize;Fn++)Ht(rs.location+Fn,Dn.meshPerAttribute);Wn.isInstancedMesh!==!0&&Wr._maxInstanceCount===void 0&&(Wr._maxInstanceCount=Dn.meshPerAttribute*Dn.count)}else for(let Fn=0;Fn<rs.locationSize;Fn++)Jt(rs.location+Fn);pt.bindBuffer(pt.ARRAY_BUFFER,as);for(let Fn=0;Fn<rs.locationSize;Fn++)rn(rs.location+Fn,es/rs.locationSize,ro,Br,pr*Hn,($n+es/rs.locationSize*Fn)*Hn)}else{if(vr.isInstancedBufferAttribute){for(let Dn=0;Dn<rs.locationSize;Dn++)Ht(rs.location+Dn,vr.meshPerAttribute);Wn.isInstancedMesh!==!0&&Wr._maxInstanceCount===void 0&&(Wr._maxInstanceCount=vr.meshPerAttribute*vr.count)}else for(let Dn=0;Dn<rs.locationSize;Dn++)Jt(rs.location+Dn);pt.bindBuffer(pt.ARRAY_BUFFER,as);for(let Dn=0;Dn<rs.locationSize;Dn++)rn(rs.location+Dn,es/rs.locationSize,ro,Br,es*Hn,es/rs.locationSize*Dn*Hn)}}else if(Pr!==void 0){const Br=Pr[Jr];if(Br!==void 0)switch(Br.length){case 2:pt.vertexAttrib2fv(rs.location,Br);break;case 3:pt.vertexAttrib3fv(rs.location,Br);break;case 4:pt.vertexAttrib4fv(rs.location,Br);break;default:pt.vertexAttrib1fv(rs.location,Br)}}}}$t()}(Cn,Tn,Gn,nr),Qn!==null&&pt.bindBuffer(pt.ELEMENT_ARRAY_BUFFER,_e.get(Qn).buffer))},reset:cn,resetDefaultState:Rn,dispose:function(){cn();for(const Cn in _t){const Tn=_t[Cn];for(const Gn in Tn){const nr=Tn[Gn];for(const Qn in nr)Ot(nr[Qn].object),delete nr[Qn];delete Tn[Gn]}delete _t[Cn]}},releaseStatesOfGeometry:function(Cn){if(_t[Cn.id]===void 0)return;const Tn=_t[Cn.id];for(const Gn in Tn){const nr=Tn[Gn];for(const Qn in nr)Ot(nr[Qn].object),delete nr[Qn];delete Tn[Gn]}delete _t[Cn.id]},releaseStatesOfProgram:function(Cn){for(const Tn in _t){const Gn=_t[Tn];if(Gn[Cn.id]===void 0)continue;const nr=Gn[Cn.id];for(const Qn in nr)Ot(nr[Qn].object),delete nr[Qn];delete Gn[Cn.id]}},initAttributes:zt,enableAttribute:Jt,disableUnusedAttributes:$t}}function $D(pt,a,_e,rt){const it=rt.isWebGL2;let lt;this.setMode=function(ft){lt=ft},this.render=function(ft,_t){pt.drawArrays(lt,ft,_t),_e.update(_t,lt,1)},this.renderInstances=function(ft,_t,St){if(St===0)return;let Et,Tt;if(it)Et=pt,Tt="drawArraysInstanced";else if(Et=a.get("ANGLE_instanced_arrays"),Tt="drawArraysInstancedANGLE",Et===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Et[Tt](lt,ft,_t,St),_e.update(_t,lt,St)}}function HT(pt,a,_e){let rt;function it(Rn){if(Rn==="highp"){if(pt.getShaderPrecisionFormat(pt.VERTEX_SHADER,pt.HIGH_FLOAT).precision>0&&pt.getShaderPrecisionFormat(pt.FRAGMENT_SHADER,pt.HIGH_FLOAT).precision>0)return"highp";Rn="mediump"}return Rn==="mediump"&&pt.getShaderPrecisionFormat(pt.VERTEX_SHADER,pt.MEDIUM_FLOAT).precision>0&&pt.getShaderPrecisionFormat(pt.FRAGMENT_SHADER,pt.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const lt=typeof WebGL2RenderingContext<"u"&&pt.constructor.name==="WebGL2RenderingContext";let ft=_e.precision!==void 0?_e.precision:"highp";const _t=it(ft);_t!==ft&&(console.warn("THREE.WebGLRenderer:",ft,"not supported, using",_t,"instead."),ft=_t);const St=lt||a.has("WEBGL_draw_buffers"),Et=_e.logarithmicDepthBuffer===!0,Tt=pt.getParameter(pt.MAX_TEXTURE_IMAGE_UNITS),Bt=pt.getParameter(pt.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Ot=pt.getParameter(pt.MAX_TEXTURE_SIZE),Lt=pt.getParameter(pt.MAX_CUBE_MAP_TEXTURE_SIZE),zt=pt.getParameter(pt.MAX_VERTEX_ATTRIBS),Jt=pt.getParameter(pt.MAX_VERTEX_UNIFORM_VECTORS),Ht=pt.getParameter(pt.MAX_VARYING_VECTORS),$t=pt.getParameter(pt.MAX_FRAGMENT_UNIFORM_VECTORS),rn=Bt>0,cn=lt||a.has("OES_texture_float");return{isWebGL2:lt,drawBuffers:St,getMaxAnisotropy:function(){if(rt!==void 0)return rt;if(a.has("EXT_texture_filter_anisotropic")===!0){const Rn=a.get("EXT_texture_filter_anisotropic");rt=pt.getParameter(Rn.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else rt=0;return rt},getMaxPrecision:it,precision:ft,logarithmicDepthBuffer:Et,maxTextures:Tt,maxVertexTextures:Bt,maxTextureSize:Ot,maxCubemapSize:Lt,maxAttributes:zt,maxVertexUniforms:Jt,maxVaryings:Ht,maxFragmentUniforms:$t,vertexTextures:rn,floatFragmentTextures:cn,floatVertexTextures:rn&&cn,maxSamples:lt?pt.getParameter(pt.MAX_SAMPLES):0}}function d2(pt){const a=this;let _e=null,rt=0,it=!1,lt=!1;const ft=new im,_t=new xo,St={value:null,needsUpdate:!1};function Et(Tt,Bt,Ot,Lt){const zt=Tt!==null?Tt.length:0;let Jt=null;if(zt!==0){if(Jt=St.value,Lt!==!0||Jt===null){const Ht=Ot+4*zt,$t=Bt.matrixWorldInverse;_t.getNormalMatrix($t),(Jt===null||Jt.length<Ht)&&(Jt=new Float32Array(Ht));for(let rn=0,cn=Ot;rn!==zt;++rn,cn+=4)ft.copy(Tt[rn]).applyMatrix4($t,_t),ft.normal.toArray(Jt,cn),Jt[cn+3]=ft.constant}St.value=Jt,St.needsUpdate=!0}return a.numPlanes=zt,a.numIntersection=0,Jt}this.uniform=St,this.numPlanes=0,this.numIntersection=0,this.init=function(Tt,Bt){const Ot=Tt.length!==0||Bt||rt!==0||it;return it=Bt,rt=Tt.length,Ot},this.beginShadows=function(){lt=!0,Et(null)},this.endShadows=function(){lt=!1},this.setGlobalState=function(Tt,Bt){_e=Et(Tt,Bt,0)},this.setState=function(Tt,Bt,Ot){const Lt=Tt.clippingPlanes,zt=Tt.clipIntersection,Jt=Tt.clipShadows,Ht=pt.get(Tt);if(!it||Lt===null||Lt.length===0||lt&&!Jt)lt?Et(null):(St.value!==_e&&(St.value=_e,St.needsUpdate=rt>0),a.numPlanes=rt,a.numIntersection=0);else{const $t=lt?0:rt,rn=4*$t;let cn=Ht.clippingState||null;St.value=cn,cn=Et(Lt,Bt,rn,Ot);for(let Rn=0;Rn!==rn;++Rn)cn[Rn]=_e[Rn];Ht.clippingState=cn,this.numIntersection=zt?this.numPlanes:0,this.numPlanes+=$t}}}function KD(pt){let a=new WeakMap;function _e(it,lt){return lt===Bl?it.mapping=Pl:lt===po&&(it.mapping=xa),it}function rt(it){const lt=it.target;lt.removeEventListener("dispose",rt);const ft=a.get(lt);ft!==void 0&&(a.delete(lt),ft.dispose())}return{get:function(it){if(it&&it.isTexture&&it.isRenderTargetTexture===!1){const lt=it.mapping;if(lt===Bl||lt===po){if(a.has(it)){const ft=a.get(it).texture;return ft.rotation=it.rotation,_e(ft,it.mapping)}{const ft=it.image;if(ft&&ft.height>0){const _t=new VT(ft.height/2);return _t.fromEquirectangularTexture(pt,it),_t.texture.rotation=it.rotation,a.set(it,_t),it.addEventListener("dispose",rt),_e(_t.texture,it.mapping)}return null}}}return it},dispose:function(){a=new WeakMap}}}class HS extends zS{constructor(a=-1,_e=1,rt=1,it=-1,lt=.1,ft=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=a,this.right=_e,this.top=rt,this.bottom=it,this.near=lt,this.far=ft,this.updateProjectionMatrix()}copy(a,_e){return super.copy(a,_e),this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this.near=a.near,this.far=a.far,this.zoom=a.zoom,this.view=a.view===null?null:Object.assign({},a.view),this}setViewOffset(a,_e,rt,it,lt,ft){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=_e,this.view.offsetX=rt,this.view.offsetY=it,this.view.width=lt,this.view.height=ft,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const a=(this.right-this.left)/(2*this.zoom),_e=(this.top-this.bottom)/(2*this.zoom),rt=(this.right+this.left)/2,it=(this.top+this.bottom)/2;let lt=rt-a,ft=rt+a,_t=it+_e,St=it-_e;if(this.view!==null&&this.view.enabled){const Et=(this.right-this.left)/this.view.fullWidth/this.zoom,Tt=(this.top-this.bottom)/this.view.fullHeight/this.zoom;lt+=Et*this.view.offsetX,ft=lt+Et*this.view.width,_t-=Tt*this.view.offsetY,St=_t-Tt*this.view.height}this.projectionMatrix.makeOrthographic(lt,ft,_t,St,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){const _e=super.toJSON(a);return _e.object.zoom=this.zoom,_e.object.left=this.left,_e.object.right=this.right,_e.object.top=this.top,_e.object.bottom=this.bottom,_e.object.near=this.near,_e.object.far=this.far,this.view!==null&&(_e.object.view=Object.assign({},this.view)),_e}}const p2=[.125,.215,.35,.446,.526,.582],$1=20,cw=new HS,QS=new ps;let WS=null;const ey=(1+Math.sqrt(5))/2,uw=1/ey,QT=[new Nn(1,1,1),new Nn(-1,1,1),new Nn(1,1,-1),new Nn(-1,1,-1),new Nn(0,ey,uw),new Nn(0,ey,-uw),new Nn(uw,0,ey),new Nn(-uw,0,ey),new Nn(ey,uw,0),new Nn(-ey,uw,0)];class Fr{constructor(a){this._renderer=a,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(a,_e=0,rt=.1,it=100){WS=this._renderer.getRenderTarget(),this._setSize(256);const lt=this._allocateTargets();return lt.depthBuffer=!0,this._sceneToCubeUV(a,rt,it,lt),_e>0&&this._blur(lt,0,0,_e),this._applyPMREM(lt),this._cleanup(lt),lt}fromEquirectangular(a,_e=null){return this._fromTexture(a,_e)}fromCubemap(a,_e=null){return this._fromTexture(a,_e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=hw(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=qS(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(a){this._lodMax=Math.floor(Math.log2(a)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let a=0;a<this._lodPlanes.length;a++)this._lodPlanes[a].dispose()}_cleanup(a){this._renderer.setRenderTarget(WS),a.scissorTest=!1,g0(a,0,0,a.width,a.height)}_fromTexture(a,_e){a.mapping===Pl||a.mapping===xa?this._setSize(a.image.length===0?16:a.image[0].width||a.image[0].image.width):this._setSize(a.image.width/4),WS=this._renderer.getRenderTarget();const rt=_e||this._allocateTargets();return this._textureToCubeUV(a,rt),this._applyPMREM(rt),this._cleanup(rt),rt}_allocateTargets(){const a=3*Math.max(this._cubeSize,112),_e=4*this._cubeSize,rt={magFilter:xl,minFilter:xl,generateMipmaps:!1,type:Bs,format:Ns,colorSpace:yo,depthBuffer:!1},it=WT(a,_e,rt);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==a||this._pingPongRenderTarget.height!==_e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=WT(a,_e,rt);const{_lodMax:lt}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(ft){const _t=[],St=[],Et=[];let Tt=ft;const Bt=ft-4+1+p2.length;for(let Ot=0;Ot<Bt;Ot++){const Lt=Math.pow(2,Tt);St.push(Lt);let zt=1/Lt;Ot>ft-4?zt=p2[Ot-ft+4-1]:Ot===0&&(zt=0),Et.push(zt);const Jt=1/(Lt-2),Ht=-Jt,$t=1+Jt,rn=[Ht,Ht,$t,Ht,$t,$t,Ht,Ht,$t,$t,Ht,$t],cn=6,Rn=6,Cn=3,Tn=2,Gn=1,nr=new Float32Array(Cn*Rn*cn),Qn=new Float32Array(Tn*Rn*cn),ur=new Float32Array(Gn*Rn*cn);for(let Ar=0;Ar<cn;Ar++){const Cr=Ar%3*2/3-1,Wr=Ar>2?0:-1,is=[Cr,Wr,0,Cr+2/3,Wr,0,Cr+2/3,Wr+1,0,Cr,Wr,0,Cr+2/3,Wr+1,0,Cr,Wr+1,0];nr.set(is,Cn*Rn*Ar),Qn.set(rn,Tn*Rn*Ar);const Qr=[Ar,Ar,Ar,Ar,Ar,Ar];ur.set(Qr,Gn*Rn*Ar)}const Wn=new Kt;Wn.setAttribute("position",new Hl(nr,Cn)),Wn.setAttribute("uv",new Hl(Qn,Tn)),Wn.setAttribute("faceIndex",new Hl(ur,Gn)),_t.push(Wn),Tt>4&&Tt--}return{lodPlanes:_t,sizeLods:St,sigmas:Et}}(lt)),this._blurMaterial=function(ft,_t,St){const Et=new Float32Array($1),Tt=new Nn(0,1,0);return new Bv({name:"SphericalGaussianBlur",defines:{n:$1,CUBEUV_TEXEL_WIDTH:1/_t,CUBEUV_TEXEL_HEIGHT:1/St,CUBEUV_MAX_MIP:`${ft}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:Et},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:Tt}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Wt,depthTest:!1,depthWrite:!1})}(lt,a,_e)}return it}_compileMaterial(a){const _e=new hp(this._lodPlanes[0],a);this._renderer.compile(_e,cw)}_sceneToCubeUV(a,_e,rt,it){const lt=new rm(90,1,_e,rt),ft=[1,-1,1,1,1,1],_t=[1,1,1,-1,-1,-1],St=this._renderer,Et=St.autoClear,Tt=St.toneMapping;St.getClearColor(QS),St.toneMapping=Ks,St.autoClear=!1;const Bt=new a_({name:"PMREM.Background",side:Gt,depthWrite:!1,depthTest:!1}),Ot=new hp(new rv,Bt);let Lt=!1;const zt=a.background;zt?zt.isColor&&(Bt.color.copy(zt),a.background=null,Lt=!0):(Bt.color.copy(QS),Lt=!0);for(let Jt=0;Jt<6;Jt++){const Ht=Jt%3;Ht===0?(lt.up.set(0,ft[Jt],0),lt.lookAt(_t[Jt],0,0)):Ht===1?(lt.up.set(0,0,ft[Jt]),lt.lookAt(0,_t[Jt],0)):(lt.up.set(0,ft[Jt],0),lt.lookAt(0,0,_t[Jt]));const $t=this._cubeSize;g0(it,Ht*$t,Jt>2?$t:0,$t,$t),St.setRenderTarget(it),Lt&&St.render(Ot,lt),St.render(a,lt)}Ot.geometry.dispose(),Ot.material.dispose(),St.toneMapping=Tt,St.autoClear=Et,a.background=zt}_textureToCubeUV(a,_e){const rt=this._renderer,it=a.mapping===Pl||a.mapping===xa;it?(this._cubemapMaterial===null&&(this._cubemapMaterial=hw()),this._cubemapMaterial.uniforms.flipEnvMap.value=a.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=qS());const lt=it?this._cubemapMaterial:this._equirectMaterial,ft=new hp(this._lodPlanes[0],lt);lt.uniforms.envMap.value=a;const _t=this._cubeSize;g0(_e,0,0,3*_t,2*_t),rt.setRenderTarget(_e),rt.render(ft,cw)}_applyPMREM(a){const _e=this._renderer,rt=_e.autoClear;_e.autoClear=!1;for(let it=1;it<this._lodPlanes.length;it++){const lt=Math.sqrt(this._sigmas[it]*this._sigmas[it]-this._sigmas[it-1]*this._sigmas[it-1]),ft=QT[(it-1)%QT.length];this._blur(a,it-1,it,lt,ft)}_e.autoClear=rt}_blur(a,_e,rt,it,lt){const ft=this._pingPongRenderTarget;this._halfBlur(a,ft,_e,rt,it,"latitudinal",lt),this._halfBlur(ft,a,rt,rt,it,"longitudinal",lt)}_halfBlur(a,_e,rt,it,lt,ft,_t){const St=this._renderer,Et=this._blurMaterial;ft!=="latitudinal"&&ft!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const Tt=new hp(this._lodPlanes[it],Et),Bt=Et.uniforms,Ot=this._sizeLods[rt]-1,Lt=isFinite(lt)?Math.PI/(2*Ot):2*Math.PI/39,zt=lt/Lt,Jt=isFinite(lt)?1+Math.floor(3*zt):$1;Jt>$1&&console.warn(`sigmaRadians, ${lt}, is too large and will clip, as it requested ${Jt} samples when the maximum is set to 20`);const Ht=[];let $t=0;for(let Rn=0;Rn<$1;++Rn){const Cn=Rn/zt,Tn=Math.exp(-Cn*Cn/2);Ht.push(Tn),Rn===0?$t+=Tn:Rn<Jt&&($t+=2*Tn)}for(let Rn=0;Rn<Ht.length;Rn++)Ht[Rn]=Ht[Rn]/$t;Bt.envMap.value=a.texture,Bt.samples.value=Jt,Bt.weights.value=Ht,Bt.latitudinal.value=ft==="latitudinal",_t&&(Bt.poleAxis.value=_t);const{_lodMax:rn}=this;Bt.dTheta.value=Lt,Bt.mipInt.value=rn-rt;const cn=this._sizeLods[it];g0(_e,3*cn*(it>rn-4?it-rn+4:0),4*(this._cubeSize-cn),3*cn,2*cn),St.setRenderTarget(_e),St.render(Tt,cw)}}function WT(pt,a,_e){const rt=new _h(pt,a,_e);return rt.texture.mapping=Go,rt.texture.name="PMREM.cubeUv",rt.scissorTest=!0,rt}function g0(pt,a,_e,rt,it){pt.viewport.set(a,_e,rt,it),pt.scissor.set(a,_e,rt,it)}function qS(){return new Bv({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Wt,depthTest:!1,depthWrite:!1})}function hw(){return new Bv({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Wt,depthTest:!1,depthWrite:!1})}function I_(pt){let a=new WeakMap,_e=null;function rt(it){const lt=it.target;lt.removeEventListener("dispose",rt);const ft=a.get(lt);ft!==void 0&&(a.delete(lt),ft.dispose())}return{get:function(it){if(it&&it.isTexture){const lt=it.mapping,ft=lt===Bl||lt===po,_t=lt===Pl||lt===xa;if(ft||_t){if(it.isRenderTargetTexture&&it.needsPMREMUpdate===!0){it.needsPMREMUpdate=!1;let St=a.get(it);return _e===null&&(_e=new Fr(pt)),St=ft?_e.fromEquirectangular(it,St):_e.fromCubemap(it,St),a.set(it,St),St.texture}if(a.has(it))return a.get(it).texture;{const St=it.image;if(ft&&St&&St.height>0||_t&&St&&function(Et){let Tt=0;for(let Bt=0;Bt<6;Bt++)Et[Bt]!==void 0&&Tt++;return Tt===6}(St)){_e===null&&(_e=new Fr(pt));const Et=ft?_e.fromEquirectangular(it):_e.fromCubemap(it);return a.set(it,Et),it.addEventListener("dispose",rt),Et.texture}return null}}}return it},dispose:function(){a=new WeakMap,_e!==null&&(_e.dispose(),_e=null)}}}function XS(pt){const a={};function _e(rt){if(a[rt]!==void 0)return a[rt];let it;switch(rt){case"WEBGL_depth_texture":it=pt.getExtension("WEBGL_depth_texture")||pt.getExtension("MOZ_WEBGL_depth_texture")||pt.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":it=pt.getExtension("EXT_texture_filter_anisotropic")||pt.getExtension("MOZ_EXT_texture_filter_anisotropic")||pt.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":it=pt.getExtension("WEBGL_compressed_texture_s3tc")||pt.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||pt.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":it=pt.getExtension("WEBGL_compressed_texture_pvrtc")||pt.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:it=pt.getExtension(rt)}return a[rt]=it,it}return{has:function(rt){return _e(rt)!==null},init:function(rt){rt.isWebGL2?_e("EXT_color_buffer_float"):(_e("WEBGL_depth_texture"),_e("OES_texture_float"),_e("OES_texture_half_float"),_e("OES_texture_half_float_linear"),_e("OES_standard_derivatives"),_e("OES_element_index_uint"),_e("OES_vertex_array_object"),_e("ANGLE_instanced_arrays")),_e("OES_texture_float_linear"),_e("EXT_color_buffer_half_float"),_e("WEBGL_multisampled_render_to_texture")},get:function(rt){const it=_e(rt);return it===null&&console.warn("THREE.WebGLRenderer: "+rt+" extension not supported."),it}}}function JD(pt,a,_e,rt){const it={},lt=new WeakMap;function ft(St){const Et=St.target;Et.index!==null&&a.remove(Et.index);for(const Bt in Et.attributes)a.remove(Et.attributes[Bt]);Et.removeEventListener("dispose",ft),delete it[Et.id];const Tt=lt.get(Et);Tt&&(a.remove(Tt),lt.delete(Et)),rt.releaseStatesOfGeometry(Et),Et.isInstancedBufferGeometry===!0&&delete Et._maxInstanceCount,_e.memory.geometries--}function _t(St){const Et=[],Tt=St.index,Bt=St.attributes.position;let Ot=0;if(Tt!==null){const Jt=Tt.array;Ot=Tt.version;for(let Ht=0,$t=Jt.length;Ht<$t;Ht+=3){const rn=Jt[Ht+0],cn=Jt[Ht+1],Rn=Jt[Ht+2];Et.push(rn,cn,cn,Rn,Rn,rn)}}else{const Jt=Bt.array;Ot=Bt.version;for(let Ht=0,$t=Jt.length/3-1;Ht<$t;Ht+=3){const rn=Ht+0,cn=Ht+1,Rn=Ht+2;Et.push(rn,cn,cn,Rn,Rn,rn)}}const Lt=new(BS(Et)?Sp:tm)(Et,1);Lt.version=Ot;const zt=lt.get(St);zt&&a.remove(zt),lt.set(St,Lt)}return{get:function(St,Et){return it[Et.id]===!0||(Et.addEventListener("dispose",ft),it[Et.id]=!0,_e.memory.geometries++),Et},update:function(St){const Et=St.attributes;for(const Bt in Et)a.update(Et[Bt],pt.ARRAY_BUFFER);const Tt=St.morphAttributes;for(const Bt in Tt){const Ot=Tt[Bt];for(let Lt=0,zt=Ot.length;Lt<zt;Lt++)a.update(Ot[Lt],pt.ARRAY_BUFFER)}},getWireframeAttribute:function(St){const Et=lt.get(St);if(Et){const Tt=St.index;Tt!==null&&Et.version<Tt.version&&_t(St)}else _t(St);return lt.get(St)}}}function ZD(pt,a,_e,rt){const it=rt.isWebGL2;let lt,ft,_t;this.setMode=function(St){lt=St},this.setIndex=function(St){ft=St.type,_t=St.bytesPerElement},this.render=function(St,Et){pt.drawElements(lt,Et,ft,St*_t),_e.update(Et,lt,1)},this.renderInstances=function(St,Et,Tt){if(Tt===0)return;let Bt,Ot;if(it)Bt=pt,Ot="drawElementsInstanced";else if(Bt=a.get("ANGLE_instanced_arrays"),Ot="drawElementsInstancedANGLE",Bt===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Bt[Ot](lt,Et,ft,St*_t,Tt),_e.update(Et,lt,Tt)}}function Lv(pt){const a={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:a,programs:null,autoReset:!0,reset:function(){a.frame++,a.calls=0,a.triangles=0,a.points=0,a.lines=0},update:function(_e,rt,it){switch(a.calls++,rt){case pt.TRIANGLES:a.triangles+=it*(_e/3);break;case pt.LINES:a.lines+=it*(_e/2);break;case pt.LINE_STRIP:a.lines+=it*(_e-1);break;case pt.LINE_LOOP:a.lines+=it*_e;break;case pt.POINTS:a.points+=it*_e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",rt)}}}}function f2(pt,a){return pt[0]-a[0]}function ty(pt,a){return Math.abs(a[1])-Math.abs(pt[1])}function YS(pt,a,_e){const rt={},it=new Float32Array(8),lt=new WeakMap,ft=new Cl,_t=[];for(let St=0;St<8;St++)_t[St]=[St,0];return{update:function(St,Et,Tt){const Bt=St.morphTargetInfluences;if(a.isWebGL2===!0){const Ot=Et.morphAttributes.position||Et.morphAttributes.normal||Et.morphAttributes.color,Lt=Ot!==void 0?Ot.length:0;let zt=lt.get(Et);if(zt===void 0||zt.count!==Lt){zt!==void 0&&zt.texture.dispose();const $t=Et.morphAttributes.position!==void 0,rn=Et.morphAttributes.normal!==void 0,cn=Et.morphAttributes.color!==void 0,Rn=Et.morphAttributes.position||[],Cn=Et.morphAttributes.normal||[],Tn=Et.morphAttributes.color||[];let Gn=0;$t===!0&&(Gn=1),rn===!0&&(Gn=2),cn===!0&&(Gn=3);let nr=Et.attributes.position.count*Gn,Qn=1;nr>a.maxTextureSize&&(Qn=Math.ceil(nr/a.maxTextureSize),nr=a.maxTextureSize);const ur=new Float32Array(nr*Qn*4*Lt),Wn=new Om(ur,nr,Qn,Lt);Wn.type=ju,Wn.needsUpdate=!0;const Ar=4*Gn;for(let Cr=0;Cr<Lt;Cr++){const Wr=Rn[Cr],is=Cn[Cr],Qr=Tn[Cr],Pr=nr*Qn*4*Cr;for(let Jr=0;Jr<Wr.count;Jr++){const rs=Jr*Ar;$t===!0&&(ft.fromBufferAttribute(Wr,Jr),ur[Pr+rs+0]=ft.x,ur[Pr+rs+1]=ft.y,ur[Pr+rs+2]=ft.z,ur[Pr+rs+3]=0),rn===!0&&(ft.fromBufferAttribute(is,Jr),ur[Pr+rs+4]=ft.x,ur[Pr+rs+5]=ft.y,ur[Pr+rs+6]=ft.z,ur[Pr+rs+7]=0),cn===!0&&(ft.fromBufferAttribute(Qr,Jr),ur[Pr+rs+8]=ft.x,ur[Pr+rs+9]=ft.y,ur[Pr+rs+10]=ft.z,ur[Pr+rs+11]=Qr.itemSize===4?ft.w:1)}}zt={count:Lt,texture:Wn,size:new Nr(nr,Qn)},lt.set(Et,zt),Et.addEventListener("dispose",function Cr(){Wn.dispose(),lt.delete(Et),Et.removeEventListener("dispose",Cr)})}let Jt=0;for(let $t=0;$t<Bt.length;$t++)Jt+=Bt[$t];const Ht=Et.morphTargetsRelative?1:1-Jt;Tt.getUniforms().setValue(pt,"morphTargetBaseInfluence",Ht),Tt.getUniforms().setValue(pt,"morphTargetInfluences",Bt),Tt.getUniforms().setValue(pt,"morphTargetsTexture",zt.texture,_e),Tt.getUniforms().setValue(pt,"morphTargetsTextureSize",zt.size)}else{const Ot=Bt===void 0?0:Bt.length;let Lt=rt[Et.id];if(Lt===void 0||Lt.length!==Ot){Lt=[];for(let rn=0;rn<Ot;rn++)Lt[rn]=[rn,0];rt[Et.id]=Lt}for(let rn=0;rn<Ot;rn++){const cn=Lt[rn];cn[0]=rn,cn[1]=Bt[rn]}Lt.sort(ty);for(let rn=0;rn<8;rn++)rn<Ot&&Lt[rn][1]?(_t[rn][0]=Lt[rn][0],_t[rn][1]=Lt[rn][1]):(_t[rn][0]=Number.MAX_SAFE_INTEGER,_t[rn][1]=0);_t.sort(f2);const zt=Et.morphAttributes.position,Jt=Et.morphAttributes.normal;let Ht=0;for(let rn=0;rn<8;rn++){const cn=_t[rn],Rn=cn[0],Cn=cn[1];Rn!==Number.MAX_SAFE_INTEGER&&Cn?(zt&&Et.getAttribute("morphTarget"+rn)!==zt[Rn]&&Et.setAttribute("morphTarget"+rn,zt[Rn]),Jt&&Et.getAttribute("morphNormal"+rn)!==Jt[Rn]&&Et.setAttribute("morphNormal"+rn,Jt[Rn]),it[rn]=Cn,Ht+=Cn):(zt&&Et.hasAttribute("morphTarget"+rn)===!0&&Et.deleteAttribute("morphTarget"+rn),Jt&&Et.hasAttribute("morphNormal"+rn)===!0&&Et.deleteAttribute("morphNormal"+rn),it[rn]=0)}const $t=Et.morphTargetsRelative?1:1-Ht;Tt.getUniforms().setValue(pt,"morphTargetBaseInfluence",$t),Tt.getUniforms().setValue(pt,"morphTargetInfluences",it)}}}}function m2(pt,a,_e,rt){let it=new WeakMap;function lt(ft){const _t=ft.target;_t.removeEventListener("dispose",lt),_e.remove(_t.instanceMatrix),_t.instanceColor!==null&&_e.remove(_t.instanceColor)}return{update:function(ft){const _t=rt.render.frame,St=ft.geometry,Et=a.get(ft,St);return it.get(Et)!==_t&&(a.update(Et),it.set(Et,_t)),ft.isInstancedMesh&&(ft.hasEventListener("dispose",lt)===!1&&ft.addEventListener("dispose",lt),_e.update(ft.instanceMatrix,pt.ARRAY_BUFFER),ft.instanceColor!==null&&_e.update(ft.instanceColor,pt.ARRAY_BUFFER)),Et},dispose:function(){it=new WeakMap}}}const _0=new Yl,ny=new Om,qT=new bx,iv=new lw,Rx=[],K1=[],$S=new Float32Array(16),dw=new Float32Array(9),Dx=new Float32Array(4);function v0(pt,a,_e){const rt=pt[0];if(rt<=0||rt>0)return pt;const it=a*_e;let lt=Rx[it];if(lt===void 0&&(lt=new Float32Array(it),Rx[it]=lt),a!==0){rt.toArray(lt,0);for(let ft=1,_t=0;ft!==a;++ft)_t+=_e,pt[ft].toArray(lt,_t)}return lt}function dp(pt,a){if(pt.length!==a.length)return!1;for(let _e=0,rt=pt.length;_e<rt;_e++)if(pt[_e]!==a[_e])return!1;return!0}function Gu(pt,a){for(let _e=0,rt=a.length;_e<rt;_e++)pt[_e]=a[_e]}function Lm(pt,a){let _e=K1[a];_e===void 0&&(_e=new Int32Array(a),K1[a]=_e);for(let rt=0;rt!==a;++rt)_e[rt]=pt.allocateTextureUnit();return _e}function Nv(pt,a){const _e=this.cache;_e[0]!==a&&(pt.uniform1f(this.addr,a),_e[0]=a)}function J1(pt,a){const _e=this.cache;if(a.x!==void 0)_e[0]===a.x&&_e[1]===a.y||(pt.uniform2f(this.addr,a.x,a.y),_e[0]=a.x,_e[1]=a.y);else{if(dp(_e,a))return;pt.uniform2fv(this.addr,a),Gu(_e,a)}}function g2(pt,a){const _e=this.cache;if(a.x!==void 0)_e[0]===a.x&&_e[1]===a.y&&_e[2]===a.z||(pt.uniform3f(this.addr,a.x,a.y,a.z),_e[0]=a.x,_e[1]=a.y,_e[2]=a.z);else if(a.r!==void 0)_e[0]===a.r&&_e[1]===a.g&&_e[2]===a.b||(pt.uniform3f(this.addr,a.r,a.g,a.b),_e[0]=a.r,_e[1]=a.g,_e[2]=a.b);else{if(dp(_e,a))return;pt.uniform3fv(this.addr,a),Gu(_e,a)}}function XT(pt,a){const _e=this.cache;if(a.x!==void 0)_e[0]===a.x&&_e[1]===a.y&&_e[2]===a.z&&_e[3]===a.w||(pt.uniform4f(this.addr,a.x,a.y,a.z,a.w),_e[0]=a.x,_e[1]=a.y,_e[2]=a.z,_e[3]=a.w);else{if(dp(_e,a))return;pt.uniform4fv(this.addr,a),Gu(_e,a)}}function Z1(pt,a){const _e=this.cache,rt=a.elements;if(rt===void 0){if(dp(_e,a))return;pt.uniformMatrix2fv(this.addr,!1,a),Gu(_e,a)}else{if(dp(_e,rt))return;Dx.set(rt),pt.uniformMatrix2fv(this.addr,!1,Dx),Gu(_e,rt)}}function pw(pt,a){const _e=this.cache,rt=a.elements;if(rt===void 0){if(dp(_e,a))return;pt.uniformMatrix3fv(this.addr,!1,a),Gu(_e,a)}else{if(dp(_e,rt))return;dw.set(rt),pt.uniformMatrix3fv(this.addr,!1,dw),Gu(_e,rt)}}function ry(pt,a){const _e=this.cache,rt=a.elements;if(rt===void 0){if(dp(_e,a))return;pt.uniformMatrix4fv(this.addr,!1,a),Gu(_e,a)}else{if(dp(_e,rt))return;$S.set(rt),pt.uniformMatrix4fv(this.addr,!1,$S),Gu(_e,rt)}}function Uv(pt,a){const _e=this.cache;_e[0]!==a&&(pt.uniform1i(this.addr,a),_e[0]=a)}function _2(pt,a){const _e=this.cache;if(a.x!==void 0)_e[0]===a.x&&_e[1]===a.y||(pt.uniform2i(this.addr,a.x,a.y),_e[0]=a.x,_e[1]=a.y);else{if(dp(_e,a))return;pt.uniform2iv(this.addr,a),Gu(_e,a)}}function P_(pt,a){const _e=this.cache;if(a.x!==void 0)_e[0]===a.x&&_e[1]===a.y&&_e[2]===a.z||(pt.uniform3i(this.addr,a.x,a.y,a.z),_e[0]=a.x,_e[1]=a.y,_e[2]=a.z);else{if(dp(_e,a))return;pt.uniform3iv(this.addr,a),Gu(_e,a)}}function v2(pt,a){const _e=this.cache;if(a.x!==void 0)_e[0]===a.x&&_e[1]===a.y&&_e[2]===a.z&&_e[3]===a.w||(pt.uniform4i(this.addr,a.x,a.y,a.z,a.w),_e[0]=a.x,_e[1]=a.y,_e[2]=a.z,_e[3]=a.w);else{if(dp(_e,a))return;pt.uniform4iv(this.addr,a),Gu(_e,a)}}function kx(pt,a){const _e=this.cache;_e[0]!==a&&(pt.uniform1ui(this.addr,a),_e[0]=a)}function y2(pt,a){const _e=this.cache;if(a.x!==void 0)_e[0]===a.x&&_e[1]===a.y||(pt.uniform2ui(this.addr,a.x,a.y),_e[0]=a.x,_e[1]=a.y);else{if(dp(_e,a))return;pt.uniform2uiv(this.addr,a),Gu(_e,a)}}function _k(pt,a){const _e=this.cache;if(a.x!==void 0)_e[0]===a.x&&_e[1]===a.y&&_e[2]===a.z||(pt.uniform3ui(this.addr,a.x,a.y,a.z),_e[0]=a.x,_e[1]=a.y,_e[2]=a.z);else{if(dp(_e,a))return;pt.uniform3uiv(this.addr,a),Gu(_e,a)}}function tA(pt,a){const _e=this.cache;if(a.x!==void 0)_e[0]===a.x&&_e[1]===a.y&&_e[2]===a.z&&_e[3]===a.w||(pt.uniform4ui(this.addr,a.x,a.y,a.z,a.w),_e[0]=a.x,_e[1]=a.y,_e[2]=a.z,_e[3]=a.w);else{if(dp(_e,a))return;pt.uniform4uiv(this.addr,a),Gu(_e,a)}}function YT(pt,a,_e){const rt=this.cache,it=_e.allocateTextureUnit();rt[0]!==it&&(pt.uniform1i(this.addr,it),rt[0]=it),_e.setTexture2D(a||_0,it)}function A2(pt,a,_e){const rt=this.cache,it=_e.allocateTextureUnit();rt[0]!==it&&(pt.uniform1i(this.addr,it),rt[0]=it),_e.setTexture3D(a||qT,it)}function $T(pt,a,_e){const rt=this.cache,it=_e.allocateTextureUnit();rt[0]!==it&&(pt.uniform1i(this.addr,it),rt[0]=it),_e.setTextureCube(a||iv,it)}function Vp(pt,a,_e){const rt=this.cache,it=_e.allocateTextureUnit();rt[0]!==it&&(pt.uniform1i(this.addr,it),rt[0]=it),_e.setTexture2DArray(a||ny,it)}function iy(pt,a){pt.uniform1fv(this.addr,a)}function KT(pt,a){const _e=v0(a,this.size,2);pt.uniform2fv(this.addr,_e)}function nA(pt,a){const _e=v0(a,this.size,3);pt.uniform3fv(this.addr,_e)}function b2(pt,a){const _e=v0(a,this.size,4);pt.uniform4fv(this.addr,_e)}function R_(pt,a){const _e=v0(a,this.size,4);pt.uniformMatrix2fv(this.addr,!1,_e)}function JT(pt,a){const _e=v0(a,this.size,9);pt.uniformMatrix3fv(this.addr,!1,_e)}function eO(pt,a){const _e=v0(a,this.size,16);pt.uniformMatrix4fv(this.addr,!1,_e)}function tO(pt,a){pt.uniform1iv(this.addr,a)}function eE(pt,a){pt.uniform2iv(this.addr,a)}function w2(pt,a){pt.uniform3iv(this.addr,a)}function x2(pt,a){pt.uniform4iv(this.addr,a)}function E2(pt,a){pt.uniform1uiv(this.addr,a)}function tE(pt,a){pt.uniform2uiv(this.addr,a)}function S2(pt,a){pt.uniform3uiv(this.addr,a)}function fw(pt,a){pt.uniform4uiv(this.addr,a)}function Ox(pt,a,_e){const rt=this.cache,it=a.length,lt=Lm(_e,it);dp(rt,lt)||(pt.uniform1iv(this.addr,lt),Gu(rt,lt));for(let ft=0;ft!==it;++ft)_e.setTexture2D(a[ft]||_0,lt[ft])}function nE(pt,a,_e){const rt=this.cache,it=a.length,lt=Lm(_e,it);dp(rt,lt)||(pt.uniform1iv(this.addr,lt),Gu(rt,lt));for(let ft=0;ft!==it;++ft)_e.setTexture3D(a[ft]||qT,lt[ft])}function KS(pt,a,_e){const rt=this.cache,it=a.length,lt=Lm(_e,it);dp(rt,lt)||(pt.uniform1iv(this.addr,lt),Gu(rt,lt));for(let ft=0;ft!==it;++ft)_e.setTextureCube(a[ft]||iv,lt[ft])}function Bx(pt,a,_e){const rt=this.cache,it=a.length,lt=Lm(_e,it);dp(rt,lt)||(pt.uniform1iv(this.addr,lt),Gu(rt,lt));for(let ft=0;ft!==it;++ft)_e.setTexture2DArray(a[ft]||ny,lt[ft])}class rE{constructor(a,_e,rt){this.id=a,this.addr=rt,this.cache=[],this.setValue=function(it){switch(it){case 5126:return Nv;case 35664:return J1;case 35665:return g2;case 35666:return XT;case 35674:return Z1;case 35675:return pw;case 35676:return ry;case 5124:case 35670:return Uv;case 35667:case 35671:return _2;case 35668:case 35672:return P_;case 35669:case 35673:return v2;case 5125:return kx;case 36294:return y2;case 36295:return _k;case 36296:return tA;case 35678:case 36198:case 36298:case 36306:case 35682:return YT;case 35679:case 36299:case 36307:return A2;case 35680:case 36300:case 36308:case 36293:return $T;case 36289:case 36303:case 36311:case 36292:return Vp}}(_e.type)}}class C2{constructor(a,_e,rt){this.id=a,this.addr=rt,this.cache=[],this.size=_e.size,this.setValue=function(it){switch(it){case 5126:return iy;case 35664:return KT;case 35665:return nA;case 35666:return b2;case 35674:return R_;case 35675:return JT;case 35676:return eO;case 5124:case 35670:return tO;case 35667:case 35671:return eE;case 35668:case 35672:return w2;case 35669:case 35673:return x2;case 5125:return E2;case 36294:return tE;case 36295:return S2;case 36296:return fw;case 35678:case 36198:case 36298:case 36306:case 35682:return Ox;case 35679:case 36299:case 36307:return nE;case 35680:case 36300:case 36308:case 36293:return KS;case 36289:case 36303:case 36311:case 36292:return Bx}}(_e.type)}}class T2{constructor(a){this.id=a,this.seq=[],this.map={}}setValue(a,_e,rt){const it=this.seq;for(let lt=0,ft=it.length;lt!==ft;++lt){const _t=it[lt];_t.setValue(a,_e[_t.id],rt)}}}const Lx=/(\w+)(\])?(\[|\.)?/g;function rA(pt,a){pt.seq.push(a),pt.map[a.id]=a}function ZT(pt,a,_e){const rt=pt.name,it=rt.length;for(Lx.lastIndex=0;;){const lt=Lx.exec(rt),ft=Lx.lastIndex;let _t=lt[1];const St=lt[2]==="]",Et=lt[3];if(St&&(_t|=0),Et===void 0||Et==="["&&ft+2===it){rA(_e,Et===void 0?new rE(_t,pt,a):new C2(_t,pt,a));break}{let Tt=_e.map[_t];Tt===void 0&&(Tt=new T2(_t),rA(_e,Tt)),_e=Tt}}}class sv{constructor(a,_e){this.seq=[],this.map={};const rt=a.getProgramParameter(_e,a.ACTIVE_UNIFORMS);for(let it=0;it<rt;++it){const lt=a.getActiveUniform(_e,it);ZT(lt,a.getUniformLocation(_e,lt.name),this)}}setValue(a,_e,rt,it){const lt=this.map[_e];lt!==void 0&&lt.setValue(a,rt,it)}setOptional(a,_e,rt){const it=_e[rt];it!==void 0&&this.setValue(a,rt,it)}static upload(a,_e,rt,it){for(let lt=0,ft=_e.length;lt!==ft;++lt){const _t=_e[lt],St=rt[_t.id];St.needsUpdate!==!1&&_t.setValue(a,St.value,it)}}static seqWithValue(a,_e){const rt=[];for(let it=0,lt=a.length;it!==lt;++it){const ft=a[it];ft.id in _e&&rt.push(ft)}return rt}}function eM(pt,a,_e){const rt=pt.createShader(a);return pt.shaderSource(rt,_e),pt.compileShader(rt),rt}let M2=0;function JS(pt){switch(pt){case _g:case yo:return["Linear","( value )"];case Gs:return["sRGB","( value )"];case e_:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",pt),["Linear","( value )"]}}function ZS(pt,a,_e){const rt=pt.getShaderParameter(a,pt.COMPILE_STATUS),it=pt.getShaderInfoLog(a).trim();if(rt&&it==="")return"";const lt=/ERROR: 0:(\d+)/.exec(it);if(lt){const ft=parseInt(lt[1]);return _e.toUpperCase()+`

`+it+`

`+function(_t,St){const Et=_t.split(`
`),Tt=[],Bt=Math.max(St-6,0),Ot=Math.min(St+6,Et.length);for(let Lt=Bt;Lt<Ot;Lt++){const zt=Lt+1;Tt.push(`${zt===St?">":" "} ${zt}: ${Et[Lt]}`)}return Tt.join(`
`)}(pt.getShaderSource(a),ft)}return it}function tM(pt,a){const _e=JS(a);return"vec4 "+pt+"( vec4 value ) { return "+_e[0]+"ToLinear"+_e[1]+"; }"}function mw(pt,a){const _e=JS(a);return"vec4 "+pt+"( vec4 value ) { return LinearTo"+_e[0]+_e[1]+"; }"}function c_(pt,a){let _e;switch(a){case Xo:_e="Linear";break;case fr:_e="Reinhard";break;case ko:_e="OptimizedCineon";break;case pu:_e="ACESFilmic";break;case Fu:_e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",a),_e="Linear"}return"vec3 "+pt+"( vec3 color ) { return "+_e+"ToneMapping( color ); }"}function ov(pt){return pt!==""}function vu(pt,a){const _e=a.numSpotLightShadows+a.numSpotLightMaps-a.numSpotLightShadowsWithMaps;return pt.replace(/NUM_DIR_LIGHTS/g,a.numDirLights).replace(/NUM_SPOT_LIGHTS/g,a.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,a.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,_e).replace(/NUM_RECT_AREA_LIGHTS/g,a.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,a.numPointLights).replace(/NUM_HEMI_LIGHTS/g,a.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,a.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,a.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,a.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,a.numPointLightShadows)}function nM(pt,a){return pt.replace(/NUM_CLIPPING_PLANES/g,a.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,a.numClippingPlanes-a.numClipIntersection)}const rM=/^[ \t]*#include +<([\w\d./]+)>/gm;function eC(pt){return pt.replace(rM,I2)}function I2(pt,a){const _e=Eo[a];if(_e===void 0)throw new Error("Can not resolve #include <"+a+">");return eC(_e)}const P2=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function R2(pt){return pt.replace(P2,nO)}function nO(pt,a,_e,rt){let it="";for(let lt=parseInt(a);lt<parseInt(_e);lt++)it+=rt.replace(/\[\s*i\s*\]/g,"[ "+lt+" ]").replace(/UNROLLED_LOOP_INDEX/g,lt);return it}function D2(pt){let a="precision "+pt.precision+` float;
precision `+pt.precision+" int;";return pt.precision==="highp"?a+=`
#define HIGH_PRECISION`:pt.precision==="mediump"?a+=`
#define MEDIUM_PRECISION`:pt.precision==="lowp"&&(a+=`
#define LOW_PRECISION`),a}function rO(pt,a,_e,rt){const it=pt.getContext(),lt=_e.defines;let ft=_e.vertexShader,_t=_e.fragmentShader;const St=function(Qn){let ur="SHADOWMAP_TYPE_BASIC";return Qn.shadowMapType===Xt?ur="SHADOWMAP_TYPE_PCF":Qn.shadowMapType===qt?ur="SHADOWMAP_TYPE_PCF_SOFT":Qn.shadowMapType===jt&&(ur="SHADOWMAP_TYPE_VSM"),ur}(_e),Et=function(Qn){let ur="ENVMAP_TYPE_CUBE";if(Qn.envMap)switch(Qn.envMapMode){case Pl:case xa:ur="ENVMAP_TYPE_CUBE";break;case Go:ur="ENVMAP_TYPE_CUBE_UV"}return ur}(_e),Tt=function(Qn){let ur="ENVMAP_MODE_REFLECTION";return Qn.envMap&&Qn.envMapMode===xa&&(ur="ENVMAP_MODE_REFRACTION"),ur}(_e),Bt=function(Qn){let ur="ENVMAP_BLENDING_NONE";if(Qn.envMap)switch(Qn.combine){case Ys:ur="ENVMAP_BLENDING_MULTIPLY";break;case ls:ur="ENVMAP_BLENDING_MIX";break;case oo:ur="ENVMAP_BLENDING_ADD"}return ur}(_e),Ot=function(Qn){const ur=Qn.envMapCubeUVHeight;if(ur===null)return null;const Wn=Math.log2(ur)-2,Ar=1/ur;return{texelWidth:1/(3*Math.max(Math.pow(2,Wn),112)),texelHeight:Ar,maxMip:Wn}}(_e),Lt=_e.isWebGL2?"":function(Qn){return[Qn.extensionDerivatives||Qn.envMapCubeUVHeight||Qn.bumpMap||Qn.normalMapTangentSpace||Qn.clearcoatNormalMap||Qn.flatShading||Qn.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Qn.extensionFragDepth||Qn.logarithmicDepthBuffer)&&Qn.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Qn.extensionDrawBuffers&&Qn.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Qn.extensionShaderTextureLOD||Qn.envMap||Qn.transmission)&&Qn.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ov).join(`
`)}(_e),zt=function(Qn){const ur=[];for(const Wn in Qn){const Ar=Qn[Wn];Ar!==!1&&ur.push("#define "+Wn+" "+Ar)}return ur.join(`
`)}(lt),Jt=it.createProgram();let Ht,$t,rn=_e.glslVersion?"#version "+_e.glslVersion+`
`:"";_e.isRawShaderMaterial?(Ht=[zt].filter(ov).join(`
`),Ht.length>0&&(Ht+=`
`),$t=[Lt,zt].filter(ov).join(`
`),$t.length>0&&($t+=`
`)):(Ht=[D2(_e),"#define SHADER_NAME "+_e.shaderName,zt,_e.instancing?"#define USE_INSTANCING":"",_e.instancingColor?"#define USE_INSTANCING_COLOR":"",_e.useFog&&_e.fog?"#define USE_FOG":"",_e.useFog&&_e.fogExp2?"#define FOG_EXP2":"",_e.map?"#define USE_MAP":"",_e.envMap?"#define USE_ENVMAP":"",_e.envMap?"#define "+Tt:"",_e.lightMap?"#define USE_LIGHTMAP":"",_e.aoMap?"#define USE_AOMAP":"",_e.bumpMap?"#define USE_BUMPMAP":"",_e.normalMap?"#define USE_NORMALMAP":"",_e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",_e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",_e.displacementMap?"#define USE_DISPLACEMENTMAP":"",_e.emissiveMap?"#define USE_EMISSIVEMAP":"",_e.clearcoatMap?"#define USE_CLEARCOATMAP":"",_e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",_e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",_e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",_e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",_e.specularMap?"#define USE_SPECULARMAP":"",_e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",_e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",_e.roughnessMap?"#define USE_ROUGHNESSMAP":"",_e.metalnessMap?"#define USE_METALNESSMAP":"",_e.alphaMap?"#define USE_ALPHAMAP":"",_e.transmission?"#define USE_TRANSMISSION":"",_e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",_e.thicknessMap?"#define USE_THICKNESSMAP":"",_e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",_e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",_e.mapUv?"#define MAP_UV "+_e.mapUv:"",_e.alphaMapUv?"#define ALPHAMAP_UV "+_e.alphaMapUv:"",_e.lightMapUv?"#define LIGHTMAP_UV "+_e.lightMapUv:"",_e.aoMapUv?"#define AOMAP_UV "+_e.aoMapUv:"",_e.emissiveMapUv?"#define EMISSIVEMAP_UV "+_e.emissiveMapUv:"",_e.bumpMapUv?"#define BUMPMAP_UV "+_e.bumpMapUv:"",_e.normalMapUv?"#define NORMALMAP_UV "+_e.normalMapUv:"",_e.displacementMapUv?"#define DISPLACEMENTMAP_UV "+_e.displacementMapUv:"",_e.metalnessMapUv?"#define METALNESSMAP_UV "+_e.metalnessMapUv:"",_e.roughnessMapUv?"#define ROUGHNESSMAP_UV "+_e.roughnessMapUv:"",_e.clearcoatMapUv?"#define CLEARCOATMAP_UV "+_e.clearcoatMapUv:"",_e.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+_e.clearcoatNormalMapUv:"",_e.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+_e.clearcoatRoughnessMapUv:"",_e.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+_e.iridescenceMapUv:"",_e.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+_e.iridescenceThicknessMapUv:"",_e.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+_e.sheenColorMapUv:"",_e.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+_e.sheenRoughnessMapUv:"",_e.specularMapUv?"#define SPECULARMAP_UV "+_e.specularMapUv:"",_e.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+_e.specularColorMapUv:"",_e.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+_e.specularIntensityMapUv:"",_e.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+_e.transmissionMapUv:"",_e.thicknessMapUv?"#define THICKNESSMAP_UV "+_e.thicknessMapUv:"",_e.vertexTangents?"#define USE_TANGENT":"",_e.vertexColors?"#define USE_COLOR":"",_e.vertexAlphas?"#define USE_COLOR_ALPHA":"",_e.vertexUv1s?"#define USE_UV1":"",_e.vertexUv2s?"#define USE_UV2":"",_e.vertexUv3s?"#define USE_UV3":"",_e.pointsUvs?"#define USE_POINTS_UV":"",_e.flatShading?"#define FLAT_SHADED":"",_e.skinning?"#define USE_SKINNING":"",_e.morphTargets?"#define USE_MORPHTARGETS":"",_e.morphNormals&&_e.flatShading===!1?"#define USE_MORPHNORMALS":"",_e.morphColors&&_e.isWebGL2?"#define USE_MORPHCOLORS":"",_e.morphTargetsCount>0&&_e.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",_e.morphTargetsCount>0&&_e.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+_e.morphTextureStride:"",_e.morphTargetsCount>0&&_e.isWebGL2?"#define MORPHTARGETS_COUNT "+_e.morphTargetsCount:"",_e.doubleSided?"#define DOUBLE_SIDED":"",_e.flipSided?"#define FLIP_SIDED":"",_e.shadowMapEnabled?"#define USE_SHADOWMAP":"",_e.shadowMapEnabled?"#define "+St:"",_e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",_e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",_e.logarithmicDepthBuffer&&_e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ov).join(`
`),$t=[Lt,D2(_e),"#define SHADER_NAME "+_e.shaderName,zt,_e.instancing?"#define USE_INSTANCING":"",_e.instancingColor?"#define USE_INSTANCING_COLOR":"",_e.useFog&&_e.fog?"#define USE_FOG":"",_e.useFog&&_e.fogExp2?"#define FOG_EXP2":"",_e.map?"#define USE_MAP":"",_e.matcap?"#define USE_MATCAP":"",_e.envMap?"#define USE_ENVMAP":"",_e.envMap?"#define "+Et:"",_e.envMap?"#define "+Tt:"",_e.envMap?"#define "+Bt:"",Ot?"#define CUBEUV_TEXEL_WIDTH "+Ot.texelWidth:"",Ot?"#define CUBEUV_TEXEL_HEIGHT "+Ot.texelHeight:"",Ot?"#define CUBEUV_MAX_MIP "+Ot.maxMip+".0":"",_e.lightMap?"#define USE_LIGHTMAP":"",_e.aoMap?"#define USE_AOMAP":"",_e.bumpMap?"#define USE_BUMPMAP":"",_e.normalMap?"#define USE_NORMALMAP":"",_e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",_e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",_e.emissiveMap?"#define USE_EMISSIVEMAP":"",_e.clearcoat?"#define USE_CLEARCOAT":"",_e.clearcoatMap?"#define USE_CLEARCOATMAP":"",_e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",_e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",_e.iridescence?"#define USE_IRIDESCENCE":"",_e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",_e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",_e.specularMap?"#define USE_SPECULARMAP":"",_e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",_e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",_e.roughnessMap?"#define USE_ROUGHNESSMAP":"",_e.metalnessMap?"#define USE_METALNESSMAP":"",_e.alphaMap?"#define USE_ALPHAMAP":"",_e.alphaTest?"#define USE_ALPHATEST":"",_e.sheen?"#define USE_SHEEN":"",_e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",_e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",_e.transmission?"#define USE_TRANSMISSION":"",_e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",_e.thicknessMap?"#define USE_THICKNESSMAP":"",_e.vertexTangents?"#define USE_TANGENT":"",_e.vertexColors||_e.instancingColor?"#define USE_COLOR":"",_e.vertexAlphas?"#define USE_COLOR_ALPHA":"",_e.vertexUv1s?"#define USE_UV1":"",_e.vertexUv2s?"#define USE_UV2":"",_e.vertexUv3s?"#define USE_UV3":"",_e.pointsUvs?"#define USE_POINTS_UV":"",_e.gradientMap?"#define USE_GRADIENTMAP":"",_e.flatShading?"#define FLAT_SHADED":"",_e.doubleSided?"#define DOUBLE_SIDED":"",_e.flipSided?"#define FLIP_SIDED":"",_e.shadowMapEnabled?"#define USE_SHADOWMAP":"",_e.shadowMapEnabled?"#define "+St:"",_e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",_e.useLegacyLights?"#define LEGACY_LIGHTS":"",_e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",_e.logarithmicDepthBuffer&&_e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",_e.toneMapping!==Ks?"#define TONE_MAPPING":"",_e.toneMapping!==Ks?Eo.tonemapping_pars_fragment:"",_e.toneMapping!==Ks?c_("toneMapping",_e.toneMapping):"",_e.dithering?"#define DITHERING":"",_e.opaque?"#define OPAQUE":"",Eo.encodings_pars_fragment,mw("linearToOutputTexel",_e.outputColorSpace),_e.transmissionSamplerMapEncoding?tM("transmissionSamplerMapTexelToLinear",_e.transmissionSamplerMapEncoding):"",_e.useDepthPacking?"#define DEPTH_PACKING "+_e.depthPacking:"",`
`].filter(ov).join(`
`)),ft=eC(ft),ft=vu(ft,_e),ft=nM(ft,_e),_t=eC(_t),_t=vu(_t,_e),_t=nM(_t,_e),ft=R2(ft),_t=R2(_t),_e.isWebGL2&&_e.isRawShaderMaterial!==!0&&(rn=`#version 300 es
`,Ht=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Ht,$t=["#define varying in",_e.glslVersion===Uy?"":"layout(location = 0) out highp vec4 pc_fragColor;",_e.glslVersion===Uy?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad","#define WebGL2Context 1"].join(`
`)+`
`+$t);const cn=rn+Ht+ft,Rn=rn+$t+_t,Cn=eM(it,it.VERTEX_SHADER,cn),Tn=eM(it,it.FRAGMENT_SHADER,Rn);if(it.attachShader(Jt,Cn),it.attachShader(Jt,Tn),_e.index0AttributeName!==void 0?it.bindAttribLocation(Jt,0,_e.index0AttributeName):_e.morphTargets===!0&&it.bindAttribLocation(Jt,0,"position"),it.linkProgram(Jt),pt.debug.checkShaderErrors){const Qn=it.getProgramInfoLog(Jt).trim(),ur=it.getShaderInfoLog(Cn).trim(),Wn=it.getShaderInfoLog(Tn).trim();let Ar=!0,Cr=!0;if(it.getProgramParameter(Jt,it.LINK_STATUS)===!1)if(Ar=!1,typeof pt.debug.onShaderError=="function")pt.debug.onShaderError(it,Jt,Cn,Tn);else{const Wr=ZS(it,Cn,"vertex"),is=ZS(it,Tn,"fragment");console.error("THREE.WebGLProgram: Shader Error "+it.getError()+" - VALIDATE_STATUS "+it.getProgramParameter(Jt,it.VALIDATE_STATUS)+`

Program Info Log: `+Qn+`
`+Wr+`
`+is)}else Qn!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Qn):ur!==""&&Wn!==""||(Cr=!1);Cr&&(this.diagnostics={runnable:Ar,programLog:Qn,vertexShader:{log:ur,prefix:Ht},fragmentShader:{log:Wn,prefix:$t}})}let Gn,nr;return it.deleteShader(Cn),it.deleteShader(Tn),this.getUniforms=function(){return Gn===void 0&&(Gn=new sv(it,Jt)),Gn},this.getAttributes=function(){return nr===void 0&&(nr=function(Qn,ur){const Wn={},Ar=Qn.getProgramParameter(ur,Qn.ACTIVE_ATTRIBUTES);for(let Cr=0;Cr<Ar;Cr++){const Wr=Qn.getActiveAttrib(ur,Cr),is=Wr.name;let Qr=1;Wr.type===Qn.FLOAT_MAT2&&(Qr=2),Wr.type===Qn.FLOAT_MAT3&&(Qr=3),Wr.type===Qn.FLOAT_MAT4&&(Qr=4),Wn[is]={type:Wr.type,location:Qn.getAttribLocation(ur,is),locationSize:Qr}}return Wn}(it,Jt)),nr},this.destroy=function(){rt.releaseStatesOfProgram(this),it.deleteProgram(Jt),this.program=void 0},this.name=_e.shaderName,this.id=M2++,this.cacheKey=a,this.usedTimes=1,this.program=Jt,this.vertexShader=Cn,this.fragmentShader=Tn,this}let iO=0;class sO{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(a){const _e=a.vertexShader,rt=a.fragmentShader,it=this._getShaderStage(_e),lt=this._getShaderStage(rt),ft=this._getShaderCacheForMaterial(a);return ft.has(it)===!1&&(ft.add(it),it.usedTimes++),ft.has(lt)===!1&&(ft.add(lt),lt.usedTimes++),this}remove(a){const _e=this.materialCache.get(a);for(const rt of _e)rt.usedTimes--,rt.usedTimes===0&&this.shaderCache.delete(rt.code);return this.materialCache.delete(a),this}getVertexShaderID(a){return this._getShaderStage(a.vertexShader).id}getFragmentShaderID(a){return this._getShaderStage(a.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(a){const _e=this.materialCache;let rt=_e.get(a);return rt===void 0&&(rt=new Set,_e.set(a,rt)),rt}_getShaderStage(a){const _e=this.shaderCache;let rt=_e.get(a);return rt===void 0&&(rt=new iM(a),_e.set(a,rt)),rt}}class iM{constructor(a){this.id=iO++,this.code=a,this.usedTimes=0}}function tC(pt,a,_e,rt,it,lt,ft){const _t=new X0,St=new sO,Et=[],Tt=it.isWebGL2,Bt=it.logarithmicDepthBuffer,Ot=it.vertexTextures;let Lt=it.precision;const zt={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function Jt(Ht){return Ht===1?"uv1":Ht===2?"uv2":Ht===3?"uv3":"uv"}return{getParameters:function(Ht,$t,rn,cn,Rn){const Cn=cn.fog,Tn=Rn.geometry,Gn=Ht.isMeshStandardMaterial?cn.environment:null,nr=(Ht.isMeshStandardMaterial?_e:a).get(Ht.envMap||Gn),Qn=nr&&nr.mapping===Go?nr.image.height:null,ur=zt[Ht.type];Ht.precision!==null&&(Lt=it.getMaxPrecision(Ht.precision),Lt!==Ht.precision&&console.warn("THREE.WebGLProgram.getParameters:",Ht.precision,"not supported, using",Lt,"instead."));const Wn=Tn.morphAttributes.position||Tn.morphAttributes.normal||Tn.morphAttributes.color,Ar=Wn!==void 0?Wn.length:0;let Cr,Wr,is,Qr,Pr=0;if(Tn.morphAttributes.position!==void 0&&(Pr=1),Tn.morphAttributes.normal!==void 0&&(Pr=2),Tn.morphAttributes.color!==void 0&&(Pr=3),ur){const u1=zp[ur];Cr=u1.vertexShader,Wr=u1.fragmentShader}else Cr=Ht.vertexShader,Wr=Ht.fragmentShader,St.update(Ht),is=St.getVertexShaderID(Ht),Qr=St.getFragmentShaderID(Ht);const Jr=pt.getRenderTarget(),rs=pt.userData&&pt.userData.transmissionRenderTarget,vr=Jr?Array.isArray(Jr.texture)?Jr.texture[0]:Jr.texture:null,Br=Rn.isInstancedMesh===!0,es=!!Ht.map,zr=!!Ht.matcap,as=!!nr,ro=!!Ht.aoMap,Hn=!!Ht.lightMap,Dn=!!Ht.bumpMap,pr=!!Ht.normalMap,$n=!!Ht.displacementMap,Fn=!!Ht.emissiveMap,ir=!!Ht.metalnessMap,xn=!!Ht.roughnessMap,qn=Ht.clearcoat>0,Xn=Ht.iridescence>0,Tr=Ht.sheen>0,Er=Ht.transmission>0,Or=qn&&!!Ht.clearcoatMap,ss=qn&&!!Ht.clearcoatNormalMap,ys=qn&&!!Ht.clearcoatRoughnessMap,Fs=Xn&&!!Ht.iridescenceMap,gs=Xn&&!!Ht.iridescenceThicknessMap,uo=Tr&&!!Ht.sheenColorMap,lo=Tr&&!!Ht.sheenRoughnessMap,js=!!Ht.specularMap,Wl=!!Ht.specularColorMap,am=!!Ht.specularIntensityMap,So=Er&&!!Ht.transmissionMap,Al=Er&&!!Ht.thicknessMap,Il=!!Ht.gradientMap,by=!!Ht.alphaMap,wr=Ht.alphaTest>0,xA=!!Ht.extensions,BE=!!Tn.attributes.uv1,Qm=!!Tn.attributes.uv2,LE=!!Tn.attributes.uv3;return{isWebGL2:Tt,shaderID:ur,shaderName:Ht.type,vertexShader:Cr,fragmentShader:Wr,defines:Ht.defines,customVertexShaderID:is,customFragmentShaderID:Qr,isRawShaderMaterial:Ht.isRawShaderMaterial===!0,glslVersion:Ht.glslVersion,precision:Lt,instancing:Br,instancingColor:Br&&Rn.instanceColor!==null,supportsVertexTextures:Ot,outputColorSpace:Jr===null?pt.outputColorSpace:Jr.isXRRenderTarget===!0||vr.colorSpace&&vr.colorSpace!==Gs?vr.colorSpace:yo,map:es,matcap:zr,envMap:as,envMapMode:as&&nr.mapping,envMapCubeUVHeight:Qn,aoMap:ro,lightMap:Hn,bumpMap:Dn,normalMap:pr,displacementMap:Ot&&$n,emissiveMap:Fn,normalMapObjectSpace:pr&&Ht.normalMapType===s0,normalMapTangentSpace:pr&&Ht.normalMapType===Zm,metalnessMap:ir,roughnessMap:xn,clearcoat:qn,clearcoatMap:Or,clearcoatNormalMap:ss,clearcoatRoughnessMap:ys,iridescence:Xn,iridescenceMap:Fs,iridescenceThicknessMap:gs,sheen:Tr,sheenColorMap:uo,sheenRoughnessMap:lo,specularMap:js,specularColorMap:Wl,specularIntensityMap:am,transmission:Er,transmissionMap:So,thicknessMap:Al,transmissionSamplerMapEncoding:rs&&rs.texture.colorSpace||yo,gradientMap:Il,opaque:Ht.transparent===!1&&Ht.blending===on&&!(Ht.transmission>0),alphaMap:by,alphaTest:wr,combine:Ht.combine,mapUv:es&&Jt(Ht.map.channel),aoMapUv:ro&&Jt(Ht.aoMap.channel),lightMapUv:Hn&&Jt(Ht.lightMap.channel),bumpMapUv:Dn&&Jt(Ht.bumpMap.channel),normalMapUv:pr&&Jt(Ht.normalMap.channel),displacementMapUv:$n&&Jt(Ht.displacementMap.channel),emissiveMapUv:Fn&&Jt(Ht.emissiveMap.channel),metalnessMapUv:ir&&Jt(Ht.metalnessMap.channel),roughnessMapUv:xn&&Jt(Ht.roughnessMap.channel),clearcoatMapUv:Or&&Jt(Ht.clearcoatMap.channel),clearcoatNormalMapUv:ss&&Jt(Ht.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ys&&Jt(Ht.clearcoatRoughnessMap.channel),iridescenceMapUv:Fs&&Jt(Ht.iridescenceMap.channel),iridescenceThicknessMapUv:gs&&Jt(Ht.iridescenceThicknessMap.channel),sheenColorMapUv:uo&&Jt(Ht.sheenColorMap.channel),sheenRoughnessMapUv:lo&&Jt(Ht.sheenRoughnessMap.channel),specularMapUv:js&&Jt(Ht.specularMap.channel),specularColorMapUv:Wl&&Jt(Ht.specularColorMap.channel),specularIntensityMapUv:am&&Jt(Ht.specularIntensityMap.channel),transmissionMapUv:So&&Jt(Ht.transmissionMap.channel),thicknessMapUv:Al&&Jt(Ht.thicknessMap.channel),alphaMapUv:by&&Jt(Ht.alphaMap.channel),vertexTangents:pr&&!!Tn.attributes.tangent,vertexColors:Ht.vertexColors,vertexAlphas:Ht.vertexColors===!0&&!!Tn.attributes.color&&Tn.attributes.color.itemSize===4,vertexUv1s:BE,vertexUv2s:Qm,vertexUv3s:LE,pointsUvs:Rn.isPoints===!0&&!!Tn.attributes.uv&&(es||by),fog:!!Cn,useFog:Ht.fog===!0,fogExp2:Cn&&Cn.isFogExp2,flatShading:Ht.flatShading===!0,sizeAttenuation:Ht.sizeAttenuation===!0,logarithmicDepthBuffer:Bt,skinning:Rn.isSkinnedMesh===!0,morphTargets:Tn.morphAttributes.position!==void 0,morphNormals:Tn.morphAttributes.normal!==void 0,morphColors:Tn.morphAttributes.color!==void 0,morphTargetsCount:Ar,morphTextureStride:Pr,numDirLights:$t.directional.length,numPointLights:$t.point.length,numSpotLights:$t.spot.length,numSpotLightMaps:$t.spotLightMap.length,numRectAreaLights:$t.rectArea.length,numHemiLights:$t.hemi.length,numDirLightShadows:$t.directionalShadowMap.length,numPointLightShadows:$t.pointShadowMap.length,numSpotLightShadows:$t.spotShadowMap.length,numSpotLightShadowsWithMaps:$t.numSpotLightShadowsWithMaps,numClippingPlanes:ft.numPlanes,numClipIntersection:ft.numIntersection,dithering:Ht.dithering,shadowMapEnabled:pt.shadowMap.enabled&&rn.length>0,shadowMapType:pt.shadowMap.type,toneMapping:Ht.toneMapped?pt.toneMapping:Ks,useLegacyLights:pt.useLegacyLights,premultipliedAlpha:Ht.premultipliedAlpha,doubleSided:Ht.side===vn,flipSided:Ht.side===Gt,useDepthPacking:Ht.depthPacking>=0,depthPacking:Ht.depthPacking||0,index0AttributeName:Ht.index0AttributeName,extensionDerivatives:xA&&Ht.extensions.derivatives===!0,extensionFragDepth:xA&&Ht.extensions.fragDepth===!0,extensionDrawBuffers:xA&&Ht.extensions.drawBuffers===!0,extensionShaderTextureLOD:xA&&Ht.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:Tt||rt.has("EXT_frag_depth"),rendererExtensionDrawBuffers:Tt||rt.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:Tt||rt.has("EXT_shader_texture_lod"),customProgramCacheKey:Ht.customProgramCacheKey()}},getProgramCacheKey:function(Ht){const $t=[];if(Ht.shaderID?$t.push(Ht.shaderID):($t.push(Ht.customVertexShaderID),$t.push(Ht.customFragmentShaderID)),Ht.defines!==void 0)for(const rn in Ht.defines)$t.push(rn),$t.push(Ht.defines[rn]);return Ht.isRawShaderMaterial===!1&&(function(rn,cn){rn.push(cn.precision),rn.push(cn.outputColorSpace),rn.push(cn.envMapMode),rn.push(cn.envMapCubeUVHeight),rn.push(cn.mapUv),rn.push(cn.alphaMapUv),rn.push(cn.lightMapUv),rn.push(cn.aoMapUv),rn.push(cn.bumpMapUv),rn.push(cn.normalMapUv),rn.push(cn.displacementMapUv),rn.push(cn.emissiveMapUv),rn.push(cn.metalnessMapUv),rn.push(cn.roughnessMapUv),rn.push(cn.clearcoatMapUv),rn.push(cn.clearcoatNormalMapUv),rn.push(cn.clearcoatRoughnessMapUv),rn.push(cn.iridescenceMapUv),rn.push(cn.iridescenceThicknessMapUv),rn.push(cn.sheenColorMapUv),rn.push(cn.sheenRoughnessMapUv),rn.push(cn.specularMapUv),rn.push(cn.specularColorMapUv),rn.push(cn.specularIntensityMapUv),rn.push(cn.transmissionMapUv),rn.push(cn.thicknessMapUv),rn.push(cn.combine),rn.push(cn.fogExp2),rn.push(cn.sizeAttenuation),rn.push(cn.morphTargetsCount),rn.push(cn.morphAttributeCount),rn.push(cn.numDirLights),rn.push(cn.numPointLights),rn.push(cn.numSpotLights),rn.push(cn.numSpotLightMaps),rn.push(cn.numHemiLights),rn.push(cn.numRectAreaLights),rn.push(cn.numDirLightShadows),rn.push(cn.numPointLightShadows),rn.push(cn.numSpotLightShadows),rn.push(cn.numSpotLightShadowsWithMaps),rn.push(cn.shadowMapType),rn.push(cn.toneMapping),rn.push(cn.numClippingPlanes),rn.push(cn.numClipIntersection),rn.push(cn.depthPacking)}($t,Ht),function(rn,cn){_t.disableAll(),cn.isWebGL2&&_t.enable(0),cn.supportsVertexTextures&&_t.enable(1),cn.instancing&&_t.enable(2),cn.instancingColor&&_t.enable(3),cn.matcap&&_t.enable(4),cn.envMap&&_t.enable(5),cn.normalMapObjectSpace&&_t.enable(6),cn.normalMapTangentSpace&&_t.enable(7),cn.clearcoat&&_t.enable(8),cn.iridescence&&_t.enable(9),cn.alphaTest&&_t.enable(10),cn.vertexColors&&_t.enable(11),cn.vertexAlphas&&_t.enable(12),cn.vertexUv1s&&_t.enable(13),cn.vertexUv2s&&_t.enable(14),cn.vertexUv3s&&_t.enable(15),cn.vertexTangents&&_t.enable(16),rn.push(_t.mask),_t.disableAll(),cn.fog&&_t.enable(0),cn.useFog&&_t.enable(1),cn.flatShading&&_t.enable(2),cn.logarithmicDepthBuffer&&_t.enable(3),cn.skinning&&_t.enable(4),cn.morphTargets&&_t.enable(5),cn.morphNormals&&_t.enable(6),cn.morphColors&&_t.enable(7),cn.premultipliedAlpha&&_t.enable(8),cn.shadowMapEnabled&&_t.enable(9),cn.useLegacyLights&&_t.enable(10),cn.doubleSided&&_t.enable(11),cn.flipSided&&_t.enable(12),cn.useDepthPacking&&_t.enable(13),cn.dithering&&_t.enable(14),cn.transmission&&_t.enable(15),cn.sheen&&_t.enable(16),cn.opaque&&_t.enable(17),cn.pointsUvs&&_t.enable(18),rn.push(_t.mask)}($t,Ht),$t.push(pt.outputColorSpace)),$t.push(Ht.customProgramCacheKey),$t.join()},getUniforms:function(Ht){const $t=zt[Ht.type];let rn;if($t){const cn=zp[$t];rn=jT.clone(cn.uniforms)}else rn=Ht.uniforms;return rn},acquireProgram:function(Ht,$t){let rn;for(let cn=0,Rn=Et.length;cn<Rn;cn++){const Cn=Et[cn];if(Cn.cacheKey===$t){rn=Cn,++rn.usedTimes;break}}return rn===void 0&&(rn=new rO(pt,$t,Ht,lt),Et.push(rn)),rn},releaseProgram:function(Ht){if(--Ht.usedTimes==0){const $t=Et.indexOf(Ht);Et[$t]=Et[Et.length-1],Et.pop(),Ht.destroy()}},releaseShaderCache:function(Ht){St.remove(Ht)},programs:Et,dispose:function(){St.dispose()}}}function nu(){let pt=new WeakMap;return{get:function(a){let _e=pt.get(a);return _e===void 0&&(_e={},pt.set(a,_e)),_e},remove:function(a){pt.delete(a)},update:function(a,_e,rt){pt.get(a)[_e]=rt},dispose:function(){pt=new WeakMap}}}function k2(pt,a){return pt.groupOrder!==a.groupOrder?pt.groupOrder-a.groupOrder:pt.renderOrder!==a.renderOrder?pt.renderOrder-a.renderOrder:pt.material.id!==a.material.id?pt.material.id-a.material.id:pt.z!==a.z?pt.z-a.z:pt.id-a.id}function sM(pt,a){return pt.groupOrder!==a.groupOrder?pt.groupOrder-a.groupOrder:pt.renderOrder!==a.renderOrder?pt.renderOrder-a.renderOrder:pt.z!==a.z?a.z-pt.z:pt.id-a.id}function iE(){const pt=[];let a=0;const _e=[],rt=[],it=[];function lt(ft,_t,St,Et,Tt,Bt){let Ot=pt[a];return Ot===void 0?(Ot={id:ft.id,object:ft,geometry:_t,material:St,groupOrder:Et,renderOrder:ft.renderOrder,z:Tt,group:Bt},pt[a]=Ot):(Ot.id=ft.id,Ot.object=ft,Ot.geometry=_t,Ot.material=St,Ot.groupOrder=Et,Ot.renderOrder=ft.renderOrder,Ot.z=Tt,Ot.group=Bt),a++,Ot}return{opaque:_e,transmissive:rt,transparent:it,init:function(){a=0,_e.length=0,rt.length=0,it.length=0},push:function(ft,_t,St,Et,Tt,Bt){const Ot=lt(ft,_t,St,Et,Tt,Bt);St.transmission>0?rt.push(Ot):St.transparent===!0?it.push(Ot):_e.push(Ot)},unshift:function(ft,_t,St,Et,Tt,Bt){const Ot=lt(ft,_t,St,Et,Tt,Bt);St.transmission>0?rt.unshift(Ot):St.transparent===!0?it.unshift(Ot):_e.unshift(Ot)},finish:function(){for(let ft=a,_t=pt.length;ft<_t;ft++){const St=pt[ft];if(St.id===null)break;St.id=null,St.object=null,St.geometry=null,St.material=null,St.group=null}},sort:function(ft,_t){_e.length>1&&_e.sort(ft||k2),rt.length>1&&rt.sort(_t||sM),it.length>1&&it.sort(_t||sM)}}}function nC(){let pt=new WeakMap;return{get:function(a,_e){const rt=pt.get(a);let it;return rt===void 0?(it=new iE,pt.set(a,[it])):_e>=rt.length?(it=new iE,rt.push(it)):it=rt[_e],it},dispose:function(){pt=new WeakMap}}}function y0(){const pt={};return{get:function(a){if(pt[a.id]!==void 0)return pt[a.id];let _e;switch(a.type){case"DirectionalLight":_e={direction:new Nn,color:new ps};break;case"SpotLight":_e={position:new Nn,direction:new Nn,color:new ps,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":_e={position:new Nn,color:new ps,distance:0,decay:0};break;case"HemisphereLight":_e={direction:new Nn,skyColor:new ps,groundColor:new ps};break;case"RectAreaLight":_e={color:new ps,position:new Nn,halfWidth:new Nn,halfHeight:new Nn}}return pt[a.id]=_e,_e}}}let O2=0;function sE(pt,a){return(a.castShadow?2:0)-(pt.castShadow?2:0)+(a.map?1:0)-(pt.map?1:0)}function gw(pt,a){const _e=new y0,rt=function(){const St={};return{get:function(Et){if(St[Et.id]!==void 0)return St[Et.id];let Tt;switch(Et.type){case"DirectionalLight":case"SpotLight":Tt={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Nr};break;case"PointLight":Tt={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Nr,shadowCameraNear:1,shadowCameraFar:1e3}}return St[Et.id]=Tt,Tt}}}(),it={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let St=0;St<9;St++)it.probe.push(new Nn);const lt=new Nn,ft=new Ao,_t=new Ao;return{setup:function(St,Et){let Tt=0,Bt=0,Ot=0;for(let Qn=0;Qn<9;Qn++)it.probe[Qn].set(0,0,0);let Lt=0,zt=0,Jt=0,Ht=0,$t=0,rn=0,cn=0,Rn=0,Cn=0,Tn=0;St.sort(sE);const Gn=Et===!0?Math.PI:1;for(let Qn=0,ur=St.length;Qn<ur;Qn++){const Wn=St[Qn],Ar=Wn.color,Cr=Wn.intensity,Wr=Wn.distance,is=Wn.shadow&&Wn.shadow.map?Wn.shadow.map.texture:null;if(Wn.isAmbientLight)Tt+=Ar.r*Cr*Gn,Bt+=Ar.g*Cr*Gn,Ot+=Ar.b*Cr*Gn;else if(Wn.isLightProbe)for(let Qr=0;Qr<9;Qr++)it.probe[Qr].addScaledVector(Wn.sh.coefficients[Qr],Cr);else if(Wn.isDirectionalLight){const Qr=_e.get(Wn);if(Qr.color.copy(Wn.color).multiplyScalar(Wn.intensity*Gn),Wn.castShadow){const Pr=Wn.shadow,Jr=rt.get(Wn);Jr.shadowBias=Pr.bias,Jr.shadowNormalBias=Pr.normalBias,Jr.shadowRadius=Pr.radius,Jr.shadowMapSize=Pr.mapSize,it.directionalShadow[Lt]=Jr,it.directionalShadowMap[Lt]=is,it.directionalShadowMatrix[Lt]=Wn.shadow.matrix,rn++}it.directional[Lt]=Qr,Lt++}else if(Wn.isSpotLight){const Qr=_e.get(Wn);Qr.position.setFromMatrixPosition(Wn.matrixWorld),Qr.color.copy(Ar).multiplyScalar(Cr*Gn),Qr.distance=Wr,Qr.coneCos=Math.cos(Wn.angle),Qr.penumbraCos=Math.cos(Wn.angle*(1-Wn.penumbra)),Qr.decay=Wn.decay,it.spot[Jt]=Qr;const Pr=Wn.shadow;if(Wn.map&&(it.spotLightMap[Cn]=Wn.map,Cn++,Pr.updateMatrices(Wn),Wn.castShadow&&Tn++),it.spotLightMatrix[Jt]=Pr.matrix,Wn.castShadow){const Jr=rt.get(Wn);Jr.shadowBias=Pr.bias,Jr.shadowNormalBias=Pr.normalBias,Jr.shadowRadius=Pr.radius,Jr.shadowMapSize=Pr.mapSize,it.spotShadow[Jt]=Jr,it.spotShadowMap[Jt]=is,Rn++}Jt++}else if(Wn.isRectAreaLight){const Qr=_e.get(Wn);Qr.color.copy(Ar).multiplyScalar(Cr),Qr.halfWidth.set(.5*Wn.width,0,0),Qr.halfHeight.set(0,.5*Wn.height,0),it.rectArea[Ht]=Qr,Ht++}else if(Wn.isPointLight){const Qr=_e.get(Wn);if(Qr.color.copy(Wn.color).multiplyScalar(Wn.intensity*Gn),Qr.distance=Wn.distance,Qr.decay=Wn.decay,Wn.castShadow){const Pr=Wn.shadow,Jr=rt.get(Wn);Jr.shadowBias=Pr.bias,Jr.shadowNormalBias=Pr.normalBias,Jr.shadowRadius=Pr.radius,Jr.shadowMapSize=Pr.mapSize,Jr.shadowCameraNear=Pr.camera.near,Jr.shadowCameraFar=Pr.camera.far,it.pointShadow[zt]=Jr,it.pointShadowMap[zt]=is,it.pointShadowMatrix[zt]=Wn.shadow.matrix,cn++}it.point[zt]=Qr,zt++}else if(Wn.isHemisphereLight){const Qr=_e.get(Wn);Qr.skyColor.copy(Wn.color).multiplyScalar(Cr*Gn),Qr.groundColor.copy(Wn.groundColor).multiplyScalar(Cr*Gn),it.hemi[$t]=Qr,$t++}}Ht>0&&(a.isWebGL2||pt.has("OES_texture_float_linear")===!0?(it.rectAreaLTC1=hs.LTC_FLOAT_1,it.rectAreaLTC2=hs.LTC_FLOAT_2):pt.has("OES_texture_half_float_linear")===!0?(it.rectAreaLTC1=hs.LTC_HALF_1,it.rectAreaLTC2=hs.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),it.ambient[0]=Tt,it.ambient[1]=Bt,it.ambient[2]=Ot;const nr=it.hash;nr.directionalLength===Lt&&nr.pointLength===zt&&nr.spotLength===Jt&&nr.rectAreaLength===Ht&&nr.hemiLength===$t&&nr.numDirectionalShadows===rn&&nr.numPointShadows===cn&&nr.numSpotShadows===Rn&&nr.numSpotMaps===Cn||(it.directional.length=Lt,it.spot.length=Jt,it.rectArea.length=Ht,it.point.length=zt,it.hemi.length=$t,it.directionalShadow.length=rn,it.directionalShadowMap.length=rn,it.pointShadow.length=cn,it.pointShadowMap.length=cn,it.spotShadow.length=Rn,it.spotShadowMap.length=Rn,it.directionalShadowMatrix.length=rn,it.pointShadowMatrix.length=cn,it.spotLightMatrix.length=Rn+Cn-Tn,it.spotLightMap.length=Cn,it.numSpotLightShadowsWithMaps=Tn,nr.directionalLength=Lt,nr.pointLength=zt,nr.spotLength=Jt,nr.rectAreaLength=Ht,nr.hemiLength=$t,nr.numDirectionalShadows=rn,nr.numPointShadows=cn,nr.numSpotShadows=Rn,nr.numSpotMaps=Cn,it.version=O2++)},setupView:function(St,Et){let Tt=0,Bt=0,Ot=0,Lt=0,zt=0;const Jt=Et.matrixWorldInverse;for(let Ht=0,$t=St.length;Ht<$t;Ht++){const rn=St[Ht];if(rn.isDirectionalLight){const cn=it.directional[Tt];cn.direction.setFromMatrixPosition(rn.matrixWorld),lt.setFromMatrixPosition(rn.target.matrixWorld),cn.direction.sub(lt),cn.direction.transformDirection(Jt),Tt++}else if(rn.isSpotLight){const cn=it.spot[Ot];cn.position.setFromMatrixPosition(rn.matrixWorld),cn.position.applyMatrix4(Jt),cn.direction.setFromMatrixPosition(rn.matrixWorld),lt.setFromMatrixPosition(rn.target.matrixWorld),cn.direction.sub(lt),cn.direction.transformDirection(Jt),Ot++}else if(rn.isRectAreaLight){const cn=it.rectArea[Lt];cn.position.setFromMatrixPosition(rn.matrixWorld),cn.position.applyMatrix4(Jt),_t.identity(),ft.copy(rn.matrixWorld),ft.premultiply(Jt),_t.extractRotation(ft),cn.halfWidth.set(.5*rn.width,0,0),cn.halfHeight.set(0,.5*rn.height,0),cn.halfWidth.applyMatrix4(_t),cn.halfHeight.applyMatrix4(_t),Lt++}else if(rn.isPointLight){const cn=it.point[Bt];cn.position.setFromMatrixPosition(rn.matrixWorld),cn.position.applyMatrix4(Jt),Bt++}else if(rn.isHemisphereLight){const cn=it.hemi[zt];cn.direction.setFromMatrixPosition(rn.matrixWorld),cn.direction.transformDirection(Jt),zt++}}},state:it}}function Nx(pt,a){const _e=new gw(pt,a),rt=[],it=[];return{init:function(){rt.length=0,it.length=0},state:{lightsArray:rt,shadowsArray:it,lights:_e},setupLights:function(lt){_e.setup(rt,lt)},setupLightsView:function(lt){_e.setupView(rt,lt)},pushLight:function(lt){rt.push(lt)},pushShadow:function(lt){it.push(lt)}}}function rC(pt,a){let _e=new WeakMap;return{get:function(rt,it=0){const lt=_e.get(rt);let ft;return lt===void 0?(ft=new Nx(pt,a),_e.set(rt,[ft])):it>=lt.length?(ft=new Nx(pt,a),lt.push(ft)):ft=lt[it],ft},dispose:function(){_e=new WeakMap}}}class _w extends cp{constructor(a){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=os,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(a)}copy(a){return super.copy(a),this.depthPacking=a.depthPacking,this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this}}class vw extends cp{constructor(a){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(a)}copy(a){return super.copy(a),this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this}}const oO=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,aO=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function B2(pt,a,_e){let rt=new Y1;const it=new Nr,lt=new Nr,ft=new Cl,_t=new _w({depthPacking:Zu}),St=new vw,Et={},Tt=_e.maxTextureSize,Bt={[sn]:Gt,[Gt]:sn,[vn]:vn},Ot=new Bv({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Nr},radius:{value:4}},vertexShader:oO,fragmentShader:aO}),Lt=Ot.clone();Lt.defines.HORIZONTAL_PASS=1;const zt=new Kt;zt.setAttribute("position",new Hl(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Jt=new hp(zt,Ot),Ht=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Xt;let $t=this.type;function rn(Cn,Tn){const Gn=a.update(Jt);Ot.defines.VSM_SAMPLES!==Cn.blurSamples&&(Ot.defines.VSM_SAMPLES=Cn.blurSamples,Lt.defines.VSM_SAMPLES=Cn.blurSamples,Ot.needsUpdate=!0,Lt.needsUpdate=!0),Cn.mapPass===null&&(Cn.mapPass=new _h(it.x,it.y)),Ot.uniforms.shadow_pass.value=Cn.map.texture,Ot.uniforms.resolution.value=Cn.mapSize,Ot.uniforms.radius.value=Cn.radius,pt.setRenderTarget(Cn.mapPass),pt.clear(),pt.renderBufferDirect(Tn,null,Gn,Ot,Jt,null),Lt.uniforms.shadow_pass.value=Cn.mapPass.texture,Lt.uniforms.resolution.value=Cn.mapSize,Lt.uniforms.radius.value=Cn.radius,pt.setRenderTarget(Cn.map),pt.clear(),pt.renderBufferDirect(Tn,null,Gn,Lt,Jt,null)}function cn(Cn,Tn,Gn,nr){let Qn=null;const ur=Gn.isPointLight===!0?Cn.customDistanceMaterial:Cn.customDepthMaterial;if(ur!==void 0)Qn=ur;else if(Qn=Gn.isPointLight===!0?St:_t,pt.localClippingEnabled&&Tn.clipShadows===!0&&Array.isArray(Tn.clippingPlanes)&&Tn.clippingPlanes.length!==0||Tn.displacementMap&&Tn.displacementScale!==0||Tn.alphaMap&&Tn.alphaTest>0||Tn.map&&Tn.alphaTest>0){const Wn=Qn.uuid,Ar=Tn.uuid;let Cr=Et[Wn];Cr===void 0&&(Cr={},Et[Wn]=Cr);let Wr=Cr[Ar];Wr===void 0&&(Wr=Qn.clone(),Cr[Ar]=Wr),Qn=Wr}return Qn.visible=Tn.visible,Qn.wireframe=Tn.wireframe,Qn.side=nr===jt?Tn.shadowSide!==null?Tn.shadowSide:Tn.side:Tn.shadowSide!==null?Tn.shadowSide:Bt[Tn.side],Qn.alphaMap=Tn.alphaMap,Qn.alphaTest=Tn.alphaTest,Qn.map=Tn.map,Qn.clipShadows=Tn.clipShadows,Qn.clippingPlanes=Tn.clippingPlanes,Qn.clipIntersection=Tn.clipIntersection,Qn.displacementMap=Tn.displacementMap,Qn.displacementScale=Tn.displacementScale,Qn.displacementBias=Tn.displacementBias,Qn.wireframeLinewidth=Tn.wireframeLinewidth,Qn.linewidth=Tn.linewidth,Gn.isPointLight===!0&&Qn.isMeshDistanceMaterial===!0&&(pt.properties.get(Qn).light=Gn),Qn}function Rn(Cn,Tn,Gn,nr,Qn){if(Cn.visible===!1)return;if(Cn.layers.test(Tn.layers)&&(Cn.isMesh||Cn.isLine||Cn.isPoints)&&(Cn.castShadow||Cn.receiveShadow&&Qn===jt)&&(!Cn.frustumCulled||rt.intersectsObject(Cn))){Cn.modelViewMatrix.multiplyMatrices(Gn.matrixWorldInverse,Cn.matrixWorld);const Wn=a.update(Cn),Ar=Cn.material;if(Array.isArray(Ar)){const Cr=Wn.groups;for(let Wr=0,is=Cr.length;Wr<is;Wr++){const Qr=Cr[Wr],Pr=Ar[Qr.materialIndex];if(Pr&&Pr.visible){const Jr=cn(Cn,Pr,nr,Qn);pt.renderBufferDirect(Gn,null,Wn,Jr,Cn,Qr)}}}else if(Ar.visible){const Cr=cn(Cn,Ar,nr,Qn);pt.renderBufferDirect(Gn,null,Wn,Cr,Cn,null)}}const ur=Cn.children;for(let Wn=0,Ar=ur.length;Wn<Ar;Wn++)Rn(ur[Wn],Tn,Gn,nr,Qn)}this.render=function(Cn,Tn,Gn){if(Ht.enabled===!1||Ht.autoUpdate===!1&&Ht.needsUpdate===!1||Cn.length===0)return;const nr=pt.getRenderTarget(),Qn=pt.getActiveCubeFace(),ur=pt.getActiveMipmapLevel(),Wn=pt.state;Wn.setBlending(Wt),Wn.buffers.color.setClear(1,1,1,1),Wn.buffers.depth.setTest(!0),Wn.setScissorTest(!1);const Ar=$t!==jt&&this.type===jt,Cr=$t===jt&&this.type!==jt;for(let Wr=0,is=Cn.length;Wr<is;Wr++){const Qr=Cn[Wr],Pr=Qr.shadow;if(Pr===void 0){console.warn("THREE.WebGLShadowMap:",Qr,"has no shadow.");continue}if(Pr.autoUpdate===!1&&Pr.needsUpdate===!1)continue;it.copy(Pr.mapSize);const Jr=Pr.getFrameExtents();if(it.multiply(Jr),lt.copy(Pr.mapSize),(it.x>Tt||it.y>Tt)&&(it.x>Tt&&(lt.x=Math.floor(Tt/Jr.x),it.x=lt.x*Jr.x,Pr.mapSize.x=lt.x),it.y>Tt&&(lt.y=Math.floor(Tt/Jr.y),it.y=lt.y*Jr.y,Pr.mapSize.y=lt.y)),Pr.map===null||Ar===!0||Cr===!0){const vr=this.type!==jt?{minFilter:Uo,magFilter:Uo}:{};Pr.map!==null&&Pr.map.dispose(),Pr.map=new _h(it.x,it.y,vr),Pr.map.texture.name=Qr.name+".shadowMap",Pr.camera.updateProjectionMatrix()}pt.setRenderTarget(Pr.map),pt.clear();const rs=Pr.getViewportCount();for(let vr=0;vr<rs;vr++){const Br=Pr.getViewport(vr);ft.set(lt.x*Br.x,lt.y*Br.y,lt.x*Br.z,lt.y*Br.w),Wn.viewport(ft),Pr.updateMatrices(Qr,vr),rt=Pr.getFrustum(),Rn(Tn,Gn,Pr.camera,Qr,this.type)}Pr.isPointLightShadow!==!0&&this.type===jt&&rn(Pr,Gn),Pr.needsUpdate=!1}$t=this.type,Ht.needsUpdate=!1,pt.setRenderTarget(nr,Qn,ur)}}function L2(pt,a,_e){const rt=_e.isWebGL2,it=new function(){let xn=!1;const qn=new Cl;let Xn=null;const Tr=new Cl(0,0,0,0);return{setMask:function(Er){Xn===Er||xn||(pt.colorMask(Er,Er,Er,Er),Xn=Er)},setLocked:function(Er){xn=Er},setClear:function(Er,Or,ss,ys,Fs){Fs===!0&&(Er*=ys,Or*=ys,ss*=ys),qn.set(Er,Or,ss,ys),Tr.equals(qn)===!1&&(pt.clearColor(Er,Or,ss,ys),Tr.copy(qn))},reset:function(){xn=!1,Xn=null,Tr.set(-1,0,0,0)}}},lt=new function(){let xn=!1,qn=null,Xn=null,Tr=null;return{setTest:function(Er){Er?as(pt.DEPTH_TEST):ro(pt.DEPTH_TEST)},setMask:function(Er){qn===Er||xn||(pt.depthMask(Er),qn=Er)},setFunc:function(Er){if(Xn!==Er){switch(Er){case Kn:pt.depthFunc(pt.NEVER);break;case dn:pt.depthFunc(pt.ALWAYS);break;case kn:pt.depthFunc(pt.LESS);break;case Vn:pt.depthFunc(pt.LEQUAL);break;case Rr:pt.depthFunc(pt.EQUAL);break;case cr:pt.depthFunc(pt.GEQUAL);break;case Hr:pt.depthFunc(pt.GREATER);break;case xs:pt.depthFunc(pt.NOTEQUAL);break;default:pt.depthFunc(pt.LEQUAL)}Xn=Er}},setLocked:function(Er){xn=Er},setClear:function(Er){Tr!==Er&&(pt.clearDepth(Er),Tr=Er)},reset:function(){xn=!1,qn=null,Xn=null,Tr=null}}},ft=new function(){let xn=!1,qn=null,Xn=null,Tr=null,Er=null,Or=null,ss=null,ys=null,Fs=null;return{setTest:function(gs){xn||(gs?as(pt.STENCIL_TEST):ro(pt.STENCIL_TEST))},setMask:function(gs){qn===gs||xn||(pt.stencilMask(gs),qn=gs)},setFunc:function(gs,uo,lo){Xn===gs&&Tr===uo&&Er===lo||(pt.stencilFunc(gs,uo,lo),Xn=gs,Tr=uo,Er=lo)},setOp:function(gs,uo,lo){Or===gs&&ss===uo&&ys===lo||(pt.stencilOp(gs,uo,lo),Or=gs,ss=uo,ys=lo)},setLocked:function(gs){xn=gs},setClear:function(gs){Fs!==gs&&(pt.clearStencil(gs),Fs=gs)},reset:function(){xn=!1,qn=null,Xn=null,Tr=null,Er=null,Or=null,ss=null,ys=null,Fs=null}}},_t=new WeakMap,St=new WeakMap;let Et={},Tt={},Bt=new WeakMap,Ot=[],Lt=null,zt=!1,Jt=null,Ht=null,$t=null,rn=null,cn=null,Rn=null,Cn=null,Tn=!1,Gn=null,nr=null,Qn=null,ur=null,Wn=null;const Ar=pt.getParameter(pt.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Cr=!1,Wr=0;const is=pt.getParameter(pt.VERSION);is.indexOf("WebGL")!==-1?(Wr=parseFloat(/^WebGL (\d)/.exec(is)[1]),Cr=Wr>=1):is.indexOf("OpenGL ES")!==-1&&(Wr=parseFloat(/^OpenGL ES (\d)/.exec(is)[1]),Cr=Wr>=2);let Qr=null,Pr={};const Jr=pt.getParameter(pt.SCISSOR_BOX),rs=pt.getParameter(pt.VIEWPORT),vr=new Cl().fromArray(Jr),Br=new Cl().fromArray(rs);function es(xn,qn,Xn,Tr){const Er=new Uint8Array(4),Or=pt.createTexture();pt.bindTexture(xn,Or),pt.texParameteri(xn,pt.TEXTURE_MIN_FILTER,pt.NEAREST),pt.texParameteri(xn,pt.TEXTURE_MAG_FILTER,pt.NEAREST);for(let ss=0;ss<Xn;ss++)!rt||xn!==pt.TEXTURE_3D&&xn!==pt.TEXTURE_2D_ARRAY?pt.texImage2D(qn+ss,0,pt.RGBA,1,1,0,pt.RGBA,pt.UNSIGNED_BYTE,Er):pt.texImage3D(qn,0,pt.RGBA,1,1,Tr,0,pt.RGBA,pt.UNSIGNED_BYTE,Er);return Or}const zr={};function as(xn){Et[xn]!==!0&&(pt.enable(xn),Et[xn]=!0)}function ro(xn){Et[xn]!==!1&&(pt.disable(xn),Et[xn]=!1)}zr[pt.TEXTURE_2D]=es(pt.TEXTURE_2D,pt.TEXTURE_2D,1),zr[pt.TEXTURE_CUBE_MAP]=es(pt.TEXTURE_CUBE_MAP,pt.TEXTURE_CUBE_MAP_POSITIVE_X,6),rt&&(zr[pt.TEXTURE_2D_ARRAY]=es(pt.TEXTURE_2D_ARRAY,pt.TEXTURE_2D_ARRAY,1,1),zr[pt.TEXTURE_3D]=es(pt.TEXTURE_3D,pt.TEXTURE_3D,1,1)),it.setClear(0,0,0,1),lt.setClear(1),ft.setClear(0),as(pt.DEPTH_TEST),lt.setFunc(Vn),$n(!1),Fn(xt),as(pt.CULL_FACE),pr(Wt);const Hn={[Qt]:pt.FUNC_ADD,[tn]:pt.FUNC_SUBTRACT,[bn]:pt.FUNC_REVERSE_SUBTRACT};if(rt)Hn[Yt]=pt.MIN,Hn[en]=pt.MAX;else{const xn=a.get("EXT_blend_minmax");xn!==null&&(Hn[Yt]=xn.MIN_EXT,Hn[en]=xn.MAX_EXT)}const Dn={[un]:pt.ZERO,[yn]:pt.ONE,[zn]:pt.SRC_COLOR,[tr]:pt.SRC_ALPHA,[br]:pt.SRC_ALPHA_SATURATE,[rr]:pt.DST_COLOR,[Jn]:pt.DST_ALPHA,[Yn]:pt.ONE_MINUS_SRC_COLOR,[Un]:pt.ONE_MINUS_SRC_ALPHA,[sr]:pt.ONE_MINUS_DST_COLOR,[hn]:pt.ONE_MINUS_DST_ALPHA};function pr(xn,qn,Xn,Tr,Er,Or,ss,ys){if(xn!==Wt){if(zt===!1&&(as(pt.BLEND),zt=!0),xn===Ut)Er=Er||qn,Or=Or||Xn,ss=ss||Tr,qn===Ht&&Er===cn||(pt.blendEquationSeparate(Hn[qn],Hn[Er]),Ht=qn,cn=Er),Xn===$t&&Tr===rn&&Or===Rn&&ss===Cn||(pt.blendFuncSeparate(Dn[Xn],Dn[Tr],Dn[Or],Dn[ss]),$t=Xn,rn=Tr,Rn=Or,Cn=ss),Jt=xn,Tn=!1;else if(xn!==Jt||ys!==Tn){if(Ht===Qt&&cn===Qt||(pt.blendEquation(pt.FUNC_ADD),Ht=Qt,cn=Qt),ys)switch(xn){case on:pt.blendFuncSeparate(pt.ONE,pt.ONE_MINUS_SRC_ALPHA,pt.ONE,pt.ONE_MINUS_SRC_ALPHA);break;case gn:pt.blendFunc(pt.ONE,pt.ONE);break;case ln:pt.blendFuncSeparate(pt.ZERO,pt.ONE_MINUS_SRC_COLOR,pt.ZERO,pt.ONE);break;case _n:pt.blendFuncSeparate(pt.ZERO,pt.SRC_COLOR,pt.ZERO,pt.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",xn)}else switch(xn){case on:pt.blendFuncSeparate(pt.SRC_ALPHA,pt.ONE_MINUS_SRC_ALPHA,pt.ONE,pt.ONE_MINUS_SRC_ALPHA);break;case gn:pt.blendFunc(pt.SRC_ALPHA,pt.ONE);break;case ln:pt.blendFuncSeparate(pt.ZERO,pt.ONE_MINUS_SRC_COLOR,pt.ZERO,pt.ONE);break;case _n:pt.blendFunc(pt.ZERO,pt.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",xn)}$t=null,rn=null,Rn=null,Cn=null,Jt=xn,Tn=ys}}else zt===!0&&(ro(pt.BLEND),zt=!1)}function $n(xn){Gn!==xn&&(xn?pt.frontFace(pt.CW):pt.frontFace(pt.CCW),Gn=xn)}function Fn(xn){xn!==gt?(as(pt.CULL_FACE),xn!==nr&&(xn===xt?pt.cullFace(pt.BACK):xn===It?pt.cullFace(pt.FRONT):pt.cullFace(pt.FRONT_AND_BACK))):ro(pt.CULL_FACE),nr=xn}function ir(xn,qn,Xn){xn?(as(pt.POLYGON_OFFSET_FILL),ur===qn&&Wn===Xn||(pt.polygonOffset(qn,Xn),ur=qn,Wn=Xn)):ro(pt.POLYGON_OFFSET_FILL)}return{buffers:{color:it,depth:lt,stencil:ft},enable:as,disable:ro,bindFramebuffer:function(xn,qn){return Tt[xn]!==qn&&(pt.bindFramebuffer(xn,qn),Tt[xn]=qn,rt&&(xn===pt.DRAW_FRAMEBUFFER&&(Tt[pt.FRAMEBUFFER]=qn),xn===pt.FRAMEBUFFER&&(Tt[pt.DRAW_FRAMEBUFFER]=qn)),!0)},drawBuffers:function(xn,qn){let Xn=Ot,Tr=!1;if(xn)if(Xn=Bt.get(qn),Xn===void 0&&(Xn=[],Bt.set(qn,Xn)),xn.isWebGLMultipleRenderTargets){const Er=xn.texture;if(Xn.length!==Er.length||Xn[0]!==pt.COLOR_ATTACHMENT0){for(let Or=0,ss=Er.length;Or<ss;Or++)Xn[Or]=pt.COLOR_ATTACHMENT0+Or;Xn.length=Er.length,Tr=!0}}else Xn[0]!==pt.COLOR_ATTACHMENT0&&(Xn[0]=pt.COLOR_ATTACHMENT0,Tr=!0);else Xn[0]!==pt.BACK&&(Xn[0]=pt.BACK,Tr=!0);Tr&&(_e.isWebGL2?pt.drawBuffers(Xn):a.get("WEBGL_draw_buffers").drawBuffersWEBGL(Xn))},useProgram:function(xn){return Lt!==xn&&(pt.useProgram(xn),Lt=xn,!0)},setBlending:pr,setMaterial:function(xn,qn){xn.side===vn?ro(pt.CULL_FACE):as(pt.CULL_FACE);let Xn=xn.side===Gt;qn&&(Xn=!Xn),$n(Xn),xn.blending===on&&xn.transparent===!1?pr(Wt):pr(xn.blending,xn.blendEquation,xn.blendSrc,xn.blendDst,xn.blendEquationAlpha,xn.blendSrcAlpha,xn.blendDstAlpha,xn.premultipliedAlpha),lt.setFunc(xn.depthFunc),lt.setTest(xn.depthTest),lt.setMask(xn.depthWrite),it.setMask(xn.colorWrite);const Tr=xn.stencilWrite;ft.setTest(Tr),Tr&&(ft.setMask(xn.stencilWriteMask),ft.setFunc(xn.stencilFunc,xn.stencilRef,xn.stencilFuncMask),ft.setOp(xn.stencilFail,xn.stencilZFail,xn.stencilZPass)),ir(xn.polygonOffset,xn.polygonOffsetFactor,xn.polygonOffsetUnits),xn.alphaToCoverage===!0?as(pt.SAMPLE_ALPHA_TO_COVERAGE):ro(pt.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:$n,setCullFace:Fn,setLineWidth:function(xn){xn!==Qn&&(Cr&&pt.lineWidth(xn),Qn=xn)},setPolygonOffset:ir,setScissorTest:function(xn){xn?as(pt.SCISSOR_TEST):ro(pt.SCISSOR_TEST)},activeTexture:function(xn){xn===void 0&&(xn=pt.TEXTURE0+Ar-1),Qr!==xn&&(pt.activeTexture(xn),Qr=xn)},bindTexture:function(xn,qn,Xn){Xn===void 0&&(Xn=Qr===null?pt.TEXTURE0+Ar-1:Qr);let Tr=Pr[Xn];Tr===void 0&&(Tr={type:void 0,texture:void 0},Pr[Xn]=Tr),Tr.type===xn&&Tr.texture===qn||(Qr!==Xn&&(pt.activeTexture(Xn),Qr=Xn),pt.bindTexture(xn,qn||zr[xn]),Tr.type=xn,Tr.texture=qn)},unbindTexture:function(){const xn=Pr[Qr];xn!==void 0&&xn.type!==void 0&&(pt.bindTexture(xn.type,null),xn.type=void 0,xn.texture=void 0)},compressedTexImage2D:function(){try{pt.compressedTexImage2D.apply(pt,arguments)}catch(xn){console.error("THREE.WebGLState:",xn)}},compressedTexImage3D:function(){try{pt.compressedTexImage3D.apply(pt,arguments)}catch(xn){console.error("THREE.WebGLState:",xn)}},texImage2D:function(){try{pt.texImage2D.apply(pt,arguments)}catch(xn){console.error("THREE.WebGLState:",xn)}},texImage3D:function(){try{pt.texImage3D.apply(pt,arguments)}catch(xn){console.error("THREE.WebGLState:",xn)}},updateUBOMapping:function(xn,qn){let Xn=St.get(qn);Xn===void 0&&(Xn=new WeakMap,St.set(qn,Xn));let Tr=Xn.get(xn);Tr===void 0&&(Tr=pt.getUniformBlockIndex(qn,xn.name),Xn.set(xn,Tr))},uniformBlockBinding:function(xn,qn){const Xn=St.get(qn).get(xn);_t.get(qn)!==Xn&&(pt.uniformBlockBinding(qn,Xn,xn.__bindingPointIndex),_t.set(qn,Xn))},texStorage2D:function(){try{pt.texStorage2D.apply(pt,arguments)}catch(xn){console.error("THREE.WebGLState:",xn)}},texStorage3D:function(){try{pt.texStorage3D.apply(pt,arguments)}catch(xn){console.error("THREE.WebGLState:",xn)}},texSubImage2D:function(){try{pt.texSubImage2D.apply(pt,arguments)}catch(xn){console.error("THREE.WebGLState:",xn)}},texSubImage3D:function(){try{pt.texSubImage3D.apply(pt,arguments)}catch(xn){console.error("THREE.WebGLState:",xn)}},compressedTexSubImage2D:function(){try{pt.compressedTexSubImage2D.apply(pt,arguments)}catch(xn){console.error("THREE.WebGLState:",xn)}},compressedTexSubImage3D:function(){try{pt.compressedTexSubImage3D.apply(pt,arguments)}catch(xn){console.error("THREE.WebGLState:",xn)}},scissor:function(xn){vr.equals(xn)===!1&&(pt.scissor(xn.x,xn.y,xn.z,xn.w),vr.copy(xn))},viewport:function(xn){Br.equals(xn)===!1&&(pt.viewport(xn.x,xn.y,xn.z,xn.w),Br.copy(xn))},reset:function(){pt.disable(pt.BLEND),pt.disable(pt.CULL_FACE),pt.disable(pt.DEPTH_TEST),pt.disable(pt.POLYGON_OFFSET_FILL),pt.disable(pt.SCISSOR_TEST),pt.disable(pt.STENCIL_TEST),pt.disable(pt.SAMPLE_ALPHA_TO_COVERAGE),pt.blendEquation(pt.FUNC_ADD),pt.blendFunc(pt.ONE,pt.ZERO),pt.blendFuncSeparate(pt.ONE,pt.ZERO,pt.ONE,pt.ZERO),pt.colorMask(!0,!0,!0,!0),pt.clearColor(0,0,0,0),pt.depthMask(!0),pt.depthFunc(pt.LESS),pt.clearDepth(1),pt.stencilMask(4294967295),pt.stencilFunc(pt.ALWAYS,0,4294967295),pt.stencilOp(pt.KEEP,pt.KEEP,pt.KEEP),pt.clearStencil(0),pt.cullFace(pt.BACK),pt.frontFace(pt.CCW),pt.polygonOffset(0,0),pt.activeTexture(pt.TEXTURE0),pt.bindFramebuffer(pt.FRAMEBUFFER,null),rt===!0&&(pt.bindFramebuffer(pt.DRAW_FRAMEBUFFER,null),pt.bindFramebuffer(pt.READ_FRAMEBUFFER,null)),pt.useProgram(null),pt.lineWidth(1),pt.scissor(0,0,pt.canvas.width,pt.canvas.height),pt.viewport(0,0,pt.canvas.width,pt.canvas.height),Et={},Qr=null,Pr={},Tt={},Bt=new WeakMap,Ot=[],Lt=null,zt=!1,Jt=null,Ht=null,$t=null,rn=null,cn=null,Rn=null,Cn=null,Tn=!1,Gn=null,nr=null,Qn=null,ur=null,Wn=null,vr.set(0,0,pt.canvas.width,pt.canvas.height),Br.set(0,0,pt.canvas.width,pt.canvas.height),it.reset(),lt.reset(),ft.reset()}}}function Bo(pt,a,_e,rt,it,lt,ft){const _t=it.isWebGL2,St=it.maxTextures,Et=it.maxCubemapSize,Tt=it.maxTextureSize,Bt=it.maxSamples,Ot=a.has("WEBGL_multisampled_render_to_texture")?a.get("WEBGL_multisampled_render_to_texture"):null,Lt=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),zt=new WeakMap;let Jt;const Ht=new WeakMap;let $t=!1;try{$t=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function rn(Hn,Dn){return $t?new OffscreenCanvas(Hn,Dn):Vy("canvas")}function cn(Hn,Dn,pr,$n){let Fn=1;if((Hn.width>$n||Hn.height>$n)&&(Fn=$n/Math.max(Hn.width,Hn.height)),Fn<1||Dn===!0){if(typeof HTMLImageElement<"u"&&Hn instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Hn instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Hn instanceof ImageBitmap){const ir=Dn?Pv:Math.floor,xn=ir(Fn*Hn.width),qn=ir(Fn*Hn.height);Jt===void 0&&(Jt=rn(xn,qn));const Xn=pr?rn(xn,qn):Jt;return Xn.width=xn,Xn.height=qn,Xn.getContext("2d").drawImage(Hn,0,0,xn,qn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Hn.width+"x"+Hn.height+") to ("+xn+"x"+qn+")."),Xn}return"data"in Hn&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Hn.width+"x"+Hn.height+")."),Hn}return Hn}function Rn(Hn){return zy(Hn.width)&&zy(Hn.height)}function Cn(Hn,Dn){return Hn.generateMipmaps&&Dn&&Hn.minFilter!==Uo&&Hn.minFilter!==xl}function Tn(Hn){pt.generateMipmap(Hn)}function Gn(Hn,Dn,pr,$n,Fn=!1){if(_t===!1)return Dn;if(Hn!==null){if(pt[Hn]!==void 0)return pt[Hn];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Hn+"'")}let ir=Dn;return Dn===pt.RED&&(pr===pt.FLOAT&&(ir=pt.R32F),pr===pt.HALF_FLOAT&&(ir=pt.R16F),pr===pt.UNSIGNED_BYTE&&(ir=pt.R8)),Dn===pt.RG&&(pr===pt.FLOAT&&(ir=pt.RG32F),pr===pt.HALF_FLOAT&&(ir=pt.RG16F),pr===pt.UNSIGNED_BYTE&&(ir=pt.RG8)),Dn===pt.RGBA&&(pr===pt.FLOAT&&(ir=pt.RGBA32F),pr===pt.HALF_FLOAT&&(ir=pt.RGBA16F),pr===pt.UNSIGNED_BYTE&&(ir=$n===Gs&&Fn===!1?pt.SRGB8_ALPHA8:pt.RGBA8),pr===pt.UNSIGNED_SHORT_4_4_4_4&&(ir=pt.RGBA4),pr===pt.UNSIGNED_SHORT_5_5_5_1&&(ir=pt.RGB5_A1)),ir!==pt.R16F&&ir!==pt.R32F&&ir!==pt.RG16F&&ir!==pt.RG32F&&ir!==pt.RGBA16F&&ir!==pt.RGBA32F||a.get("EXT_color_buffer_float"),ir}function nr(Hn,Dn,pr){return Cn(Hn,pr)===!0||Hn.isFramebufferTexture&&Hn.minFilter!==Uo&&Hn.minFilter!==xl?Math.log2(Math.max(Dn.width,Dn.height))+1:Hn.mipmaps!==void 0&&Hn.mipmaps.length>0?Hn.mipmaps.length:Hn.isCompressedTexture&&Array.isArray(Hn.image)?Dn.mipmaps.length:1}function Qn(Hn){return Hn===Uo||Hn===au||Hn===Ap?pt.NEAREST:pt.LINEAR}function ur(Hn){const Dn=Hn.target;Dn.removeEventListener("dispose",ur),function(pr){const $n=rt.get(pr);if($n.__webglInit===void 0)return;const Fn=pr.source,ir=Ht.get(Fn);if(ir){const xn=ir[$n.__cacheKey];xn.usedTimes--,xn.usedTimes===0&&Ar(pr),Object.keys(ir).length===0&&Ht.delete(Fn)}rt.remove(pr)}(Dn),Dn.isVideoTexture&&zt.delete(Dn)}function Wn(Hn){const Dn=Hn.target;Dn.removeEventListener("dispose",Wn),function(pr){const $n=pr.texture,Fn=rt.get(pr),ir=rt.get($n);if(ir.__webglTexture!==void 0&&(pt.deleteTexture(ir.__webglTexture),ft.memory.textures--),pr.depthTexture&&pr.depthTexture.dispose(),pr.isWebGLCubeRenderTarget)for(let xn=0;xn<6;xn++)pt.deleteFramebuffer(Fn.__webglFramebuffer[xn]),Fn.__webglDepthbuffer&&pt.deleteRenderbuffer(Fn.__webglDepthbuffer[xn]);else{if(pt.deleteFramebuffer(Fn.__webglFramebuffer),Fn.__webglDepthbuffer&&pt.deleteRenderbuffer(Fn.__webglDepthbuffer),Fn.__webglMultisampledFramebuffer&&pt.deleteFramebuffer(Fn.__webglMultisampledFramebuffer),Fn.__webglColorRenderbuffer)for(let xn=0;xn<Fn.__webglColorRenderbuffer.length;xn++)Fn.__webglColorRenderbuffer[xn]&&pt.deleteRenderbuffer(Fn.__webglColorRenderbuffer[xn]);Fn.__webglDepthRenderbuffer&&pt.deleteRenderbuffer(Fn.__webglDepthRenderbuffer)}if(pr.isWebGLMultipleRenderTargets)for(let xn=0,qn=$n.length;xn<qn;xn++){const Xn=rt.get($n[xn]);Xn.__webglTexture&&(pt.deleteTexture(Xn.__webglTexture),ft.memory.textures--),rt.remove($n[xn])}rt.remove($n),rt.remove(pr)}(Dn)}function Ar(Hn){const Dn=rt.get(Hn);pt.deleteTexture(Dn.__webglTexture);const pr=Hn.source;delete Ht.get(pr)[Dn.__cacheKey],ft.memory.textures--}let Cr=0;function Wr(Hn,Dn){const pr=rt.get(Hn);if(Hn.isVideoTexture&&function($n){const Fn=ft.render.frame;zt.get($n)!==Fn&&(zt.set($n,Fn),$n.update())}(Hn),Hn.isRenderTargetTexture===!1&&Hn.version>0&&pr.__version!==Hn.version){const $n=Hn.image;if($n===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if($n.complete!==!1)return void rs(pr,Hn,Dn);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}_e.bindTexture(pt.TEXTURE_2D,pr.__webglTexture,pt.TEXTURE0+Dn)}const is={[su]:pt.REPEAT,[Ho]:pt.CLAMP_TO_EDGE,[ou]:pt.MIRRORED_REPEAT},Qr={[Uo]:pt.NEAREST,[au]:pt.NEAREST_MIPMAP_NEAREST,[Ap]:pt.NEAREST_MIPMAP_LINEAR,[xl]:pt.LINEAR,[fu]:pt.LINEAR_MIPMAP_NEAREST,[Gl]:pt.LINEAR_MIPMAP_LINEAR};function Pr(Hn,Dn,pr){if(pr?(pt.texParameteri(Hn,pt.TEXTURE_WRAP_S,is[Dn.wrapS]),pt.texParameteri(Hn,pt.TEXTURE_WRAP_T,is[Dn.wrapT]),Hn!==pt.TEXTURE_3D&&Hn!==pt.TEXTURE_2D_ARRAY||pt.texParameteri(Hn,pt.TEXTURE_WRAP_R,is[Dn.wrapR]),pt.texParameteri(Hn,pt.TEXTURE_MAG_FILTER,Qr[Dn.magFilter]),pt.texParameteri(Hn,pt.TEXTURE_MIN_FILTER,Qr[Dn.minFilter])):(pt.texParameteri(Hn,pt.TEXTURE_WRAP_S,pt.CLAMP_TO_EDGE),pt.texParameteri(Hn,pt.TEXTURE_WRAP_T,pt.CLAMP_TO_EDGE),Hn!==pt.TEXTURE_3D&&Hn!==pt.TEXTURE_2D_ARRAY||pt.texParameteri(Hn,pt.TEXTURE_WRAP_R,pt.CLAMP_TO_EDGE),Dn.wrapS===Ho&&Dn.wrapT===Ho||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),pt.texParameteri(Hn,pt.TEXTURE_MAG_FILTER,Qn(Dn.magFilter)),pt.texParameteri(Hn,pt.TEXTURE_MIN_FILTER,Qn(Dn.minFilter)),Dn.minFilter!==Uo&&Dn.minFilter!==xl&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),a.has("EXT_texture_filter_anisotropic")===!0){const $n=a.get("EXT_texture_filter_anisotropic");if(Dn.magFilter===Uo||Dn.minFilter!==Ap&&Dn.minFilter!==Gl||Dn.type===ju&&a.has("OES_texture_float_linear")===!1||_t===!1&&Dn.type===Bs&&a.has("OES_texture_half_float_linear")===!1)return;(Dn.anisotropy>1||rt.get(Dn).__currentAnisotropy)&&(pt.texParameterf(Hn,$n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Dn.anisotropy,it.getMaxAnisotropy())),rt.get(Dn).__currentAnisotropy=Dn.anisotropy)}}function Jr(Hn,Dn){let pr=!1;Hn.__webglInit===void 0&&(Hn.__webglInit=!0,Dn.addEventListener("dispose",ur));const $n=Dn.source;let Fn=Ht.get($n);Fn===void 0&&(Fn={},Ht.set($n,Fn));const ir=function(xn){const qn=[];return qn.push(xn.wrapS),qn.push(xn.wrapT),qn.push(xn.wrapR||0),qn.push(xn.magFilter),qn.push(xn.minFilter),qn.push(xn.anisotropy),qn.push(xn.internalFormat),qn.push(xn.format),qn.push(xn.type),qn.push(xn.generateMipmaps),qn.push(xn.premultiplyAlpha),qn.push(xn.flipY),qn.push(xn.unpackAlignment),qn.push(xn.colorSpace),qn.join()}(Dn);if(ir!==Hn.__cacheKey){Fn[ir]===void 0&&(Fn[ir]={texture:pt.createTexture(),usedTimes:0},ft.memory.textures++,pr=!0),Fn[ir].usedTimes++;const xn=Fn[Hn.__cacheKey];xn!==void 0&&(Fn[Hn.__cacheKey].usedTimes--,xn.usedTimes===0&&Ar(Dn)),Hn.__cacheKey=ir,Hn.__webglTexture=Fn[ir].texture}return pr}function rs(Hn,Dn,pr){let $n=pt.TEXTURE_2D;(Dn.isDataArrayTexture||Dn.isCompressedArrayTexture)&&($n=pt.TEXTURE_2D_ARRAY),Dn.isData3DTexture&&($n=pt.TEXTURE_3D);const Fn=Jr(Hn,Dn),ir=Dn.source;_e.bindTexture($n,Hn.__webglTexture,pt.TEXTURE0+pr);const xn=rt.get(ir);if(ir.version!==xn.__version||Fn===!0){_e.activeTexture(pt.TEXTURE0+pr),pt.pixelStorei(pt.UNPACK_FLIP_Y_WEBGL,Dn.flipY),pt.pixelStorei(pt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Dn.premultiplyAlpha),pt.pixelStorei(pt.UNPACK_ALIGNMENT,Dn.unpackAlignment),pt.pixelStorei(pt.UNPACK_COLORSPACE_CONVERSION_WEBGL,pt.NONE);const qn=function(js){return!_t&&(js.wrapS!==Ho||js.wrapT!==Ho||js.minFilter!==Uo&&js.minFilter!==xl)}(Dn)&&Rn(Dn.image)===!1;let Xn=cn(Dn.image,qn,!1,Tt);Xn=ro(Dn,Xn);const Tr=Rn(Xn)||_t,Er=lt.convert(Dn.format,Dn.colorSpace);let Or,ss=lt.convert(Dn.type),ys=Gn(Dn.internalFormat,Er,ss,Dn.colorSpace);Pr($n,Dn,Tr);const Fs=Dn.mipmaps,gs=_t&&Dn.isVideoTexture!==!0,uo=xn.__version===void 0||Fn===!0,lo=nr(Dn,Xn,Tr);if(Dn.isDepthTexture)ys=pt.DEPTH_COMPONENT,_t?ys=Dn.type===ju?pt.DEPTH_COMPONENT32F:Dn.type===Jl?pt.DEPTH_COMPONENT24:Dn.type===Ll?pt.DEPTH24_STENCIL8:pt.DEPTH_COMPONENT16:Dn.type===ju&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Dn.format===El&&ys===pt.DEPTH_COMPONENT&&Dn.type!==Po&&Dn.type!==Jl&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Dn.type=Jl,ss=lt.convert(Dn.type)),Dn.format===to&&ys===pt.DEPTH_COMPONENT&&(ys=pt.DEPTH_STENCIL,Dn.type!==Ll&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Dn.type=Ll,ss=lt.convert(Dn.type))),uo&&(gs?_e.texStorage2D(pt.TEXTURE_2D,1,ys,Xn.width,Xn.height):_e.texImage2D(pt.TEXTURE_2D,0,ys,Xn.width,Xn.height,0,Er,ss,null));else if(Dn.isDataTexture)if(Fs.length>0&&Tr){gs&&uo&&_e.texStorage2D(pt.TEXTURE_2D,lo,ys,Fs[0].width,Fs[0].height);for(let js=0,Wl=Fs.length;js<Wl;js++)Or=Fs[js],gs?_e.texSubImage2D(pt.TEXTURE_2D,js,0,0,Or.width,Or.height,Er,ss,Or.data):_e.texImage2D(pt.TEXTURE_2D,js,ys,Or.width,Or.height,0,Er,ss,Or.data);Dn.generateMipmaps=!1}else gs?(uo&&_e.texStorage2D(pt.TEXTURE_2D,lo,ys,Xn.width,Xn.height),_e.texSubImage2D(pt.TEXTURE_2D,0,0,0,Xn.width,Xn.height,Er,ss,Xn.data)):_e.texImage2D(pt.TEXTURE_2D,0,ys,Xn.width,Xn.height,0,Er,ss,Xn.data);else if(Dn.isCompressedTexture)if(Dn.isCompressedArrayTexture){gs&&uo&&_e.texStorage3D(pt.TEXTURE_2D_ARRAY,lo,ys,Fs[0].width,Fs[0].height,Xn.depth);for(let js=0,Wl=Fs.length;js<Wl;js++)Or=Fs[js],Dn.format!==Ns?Er!==null?gs?_e.compressedTexSubImage3D(pt.TEXTURE_2D_ARRAY,js,0,0,0,Or.width,Or.height,Xn.depth,Er,Or.data,0,0):_e.compressedTexImage3D(pt.TEXTURE_2D_ARRAY,js,ys,Or.width,Or.height,Xn.depth,0,Or.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):gs?_e.texSubImage3D(pt.TEXTURE_2D_ARRAY,js,0,0,0,Or.width,Or.height,Xn.depth,Er,ss,Or.data):_e.texImage3D(pt.TEXTURE_2D_ARRAY,js,ys,Or.width,Or.height,Xn.depth,0,Er,ss,Or.data)}else{gs&&uo&&_e.texStorage2D(pt.TEXTURE_2D,lo,ys,Fs[0].width,Fs[0].height);for(let js=0,Wl=Fs.length;js<Wl;js++)Or=Fs[js],Dn.format!==Ns?Er!==null?gs?_e.compressedTexSubImage2D(pt.TEXTURE_2D,js,0,0,Or.width,Or.height,Er,Or.data):_e.compressedTexImage2D(pt.TEXTURE_2D,js,ys,Or.width,Or.height,0,Or.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):gs?_e.texSubImage2D(pt.TEXTURE_2D,js,0,0,Or.width,Or.height,Er,ss,Or.data):_e.texImage2D(pt.TEXTURE_2D,js,ys,Or.width,Or.height,0,Er,ss,Or.data)}else if(Dn.isDataArrayTexture)gs?(uo&&_e.texStorage3D(pt.TEXTURE_2D_ARRAY,lo,ys,Xn.width,Xn.height,Xn.depth),_e.texSubImage3D(pt.TEXTURE_2D_ARRAY,0,0,0,0,Xn.width,Xn.height,Xn.depth,Er,ss,Xn.data)):_e.texImage3D(pt.TEXTURE_2D_ARRAY,0,ys,Xn.width,Xn.height,Xn.depth,0,Er,ss,Xn.data);else if(Dn.isData3DTexture)gs?(uo&&_e.texStorage3D(pt.TEXTURE_3D,lo,ys,Xn.width,Xn.height,Xn.depth),_e.texSubImage3D(pt.TEXTURE_3D,0,0,0,0,Xn.width,Xn.height,Xn.depth,Er,ss,Xn.data)):_e.texImage3D(pt.TEXTURE_3D,0,ys,Xn.width,Xn.height,Xn.depth,0,Er,ss,Xn.data);else if(Dn.isFramebufferTexture){if(uo)if(gs)_e.texStorage2D(pt.TEXTURE_2D,lo,ys,Xn.width,Xn.height);else{let js=Xn.width,Wl=Xn.height;for(let am=0;am<lo;am++)_e.texImage2D(pt.TEXTURE_2D,am,ys,js,Wl,0,Er,ss,null),js>>=1,Wl>>=1}}else if(Fs.length>0&&Tr){gs&&uo&&_e.texStorage2D(pt.TEXTURE_2D,lo,ys,Fs[0].width,Fs[0].height);for(let js=0,Wl=Fs.length;js<Wl;js++)Or=Fs[js],gs?_e.texSubImage2D(pt.TEXTURE_2D,js,0,0,Er,ss,Or):_e.texImage2D(pt.TEXTURE_2D,js,ys,Er,ss,Or);Dn.generateMipmaps=!1}else gs?(uo&&_e.texStorage2D(pt.TEXTURE_2D,lo,ys,Xn.width,Xn.height),_e.texSubImage2D(pt.TEXTURE_2D,0,0,0,Er,ss,Xn)):_e.texImage2D(pt.TEXTURE_2D,0,ys,Er,ss,Xn);Cn(Dn,Tr)&&Tn($n),xn.__version=ir.version,Dn.onUpdate&&Dn.onUpdate(Dn)}Hn.__version=Dn.version}function vr(Hn,Dn,pr,$n,Fn){const ir=lt.convert(pr.format,pr.colorSpace),xn=lt.convert(pr.type),qn=Gn(pr.internalFormat,ir,xn,pr.colorSpace);rt.get(Dn).__hasExternalTextures||(Fn===pt.TEXTURE_3D||Fn===pt.TEXTURE_2D_ARRAY?_e.texImage3D(Fn,0,qn,Dn.width,Dn.height,Dn.depth,0,ir,xn,null):_e.texImage2D(Fn,0,qn,Dn.width,Dn.height,0,ir,xn,null)),_e.bindFramebuffer(pt.FRAMEBUFFER,Hn),as(Dn)?Ot.framebufferTexture2DMultisampleEXT(pt.FRAMEBUFFER,$n,Fn,rt.get(pr).__webglTexture,0,zr(Dn)):(Fn===pt.TEXTURE_2D||Fn>=pt.TEXTURE_CUBE_MAP_POSITIVE_X&&Fn<=pt.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&pt.framebufferTexture2D(pt.FRAMEBUFFER,$n,Fn,rt.get(pr).__webglTexture,0),_e.bindFramebuffer(pt.FRAMEBUFFER,null)}function Br(Hn,Dn,pr){if(pt.bindRenderbuffer(pt.RENDERBUFFER,Hn),Dn.depthBuffer&&!Dn.stencilBuffer){let $n=pt.DEPTH_COMPONENT16;if(pr||as(Dn)){const Fn=Dn.depthTexture;Fn&&Fn.isDepthTexture&&(Fn.type===ju?$n=pt.DEPTH_COMPONENT32F:Fn.type===Jl&&($n=pt.DEPTH_COMPONENT24));const ir=zr(Dn);as(Dn)?Ot.renderbufferStorageMultisampleEXT(pt.RENDERBUFFER,ir,$n,Dn.width,Dn.height):pt.renderbufferStorageMultisample(pt.RENDERBUFFER,ir,$n,Dn.width,Dn.height)}else pt.renderbufferStorage(pt.RENDERBUFFER,$n,Dn.width,Dn.height);pt.framebufferRenderbuffer(pt.FRAMEBUFFER,pt.DEPTH_ATTACHMENT,pt.RENDERBUFFER,Hn)}else if(Dn.depthBuffer&&Dn.stencilBuffer){const $n=zr(Dn);pr&&as(Dn)===!1?pt.renderbufferStorageMultisample(pt.RENDERBUFFER,$n,pt.DEPTH24_STENCIL8,Dn.width,Dn.height):as(Dn)?Ot.renderbufferStorageMultisampleEXT(pt.RENDERBUFFER,$n,pt.DEPTH24_STENCIL8,Dn.width,Dn.height):pt.renderbufferStorage(pt.RENDERBUFFER,pt.DEPTH_STENCIL,Dn.width,Dn.height),pt.framebufferRenderbuffer(pt.FRAMEBUFFER,pt.DEPTH_STENCIL_ATTACHMENT,pt.RENDERBUFFER,Hn)}else{const $n=Dn.isWebGLMultipleRenderTargets===!0?Dn.texture:[Dn.texture];for(let Fn=0;Fn<$n.length;Fn++){const ir=$n[Fn],xn=lt.convert(ir.format,ir.colorSpace),qn=lt.convert(ir.type),Xn=Gn(ir.internalFormat,xn,qn,ir.colorSpace),Tr=zr(Dn);pr&&as(Dn)===!1?pt.renderbufferStorageMultisample(pt.RENDERBUFFER,Tr,Xn,Dn.width,Dn.height):as(Dn)?Ot.renderbufferStorageMultisampleEXT(pt.RENDERBUFFER,Tr,Xn,Dn.width,Dn.height):pt.renderbufferStorage(pt.RENDERBUFFER,Xn,Dn.width,Dn.height)}}pt.bindRenderbuffer(pt.RENDERBUFFER,null)}function es(Hn){const Dn=rt.get(Hn),pr=Hn.isWebGLCubeRenderTarget===!0;if(Hn.depthTexture&&!Dn.__autoAllocateDepthBuffer){if(pr)throw new Error("target.depthTexture not supported in Cube render targets");(function($n,Fn){if(Fn&&Fn.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(_e.bindFramebuffer(pt.FRAMEBUFFER,$n),!Fn.depthTexture||!Fn.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");rt.get(Fn.depthTexture).__webglTexture&&Fn.depthTexture.image.width===Fn.width&&Fn.depthTexture.image.height===Fn.height||(Fn.depthTexture.image.width=Fn.width,Fn.depthTexture.image.height=Fn.height,Fn.depthTexture.needsUpdate=!0),Wr(Fn.depthTexture,0);const ir=rt.get(Fn.depthTexture).__webglTexture,xn=zr(Fn);if(Fn.depthTexture.format===El)as(Fn)?Ot.framebufferTexture2DMultisampleEXT(pt.FRAMEBUFFER,pt.DEPTH_ATTACHMENT,pt.TEXTURE_2D,ir,0,xn):pt.framebufferTexture2D(pt.FRAMEBUFFER,pt.DEPTH_ATTACHMENT,pt.TEXTURE_2D,ir,0);else{if(Fn.depthTexture.format!==to)throw new Error("Unknown depthTexture format");as(Fn)?Ot.framebufferTexture2DMultisampleEXT(pt.FRAMEBUFFER,pt.DEPTH_STENCIL_ATTACHMENT,pt.TEXTURE_2D,ir,0,xn):pt.framebufferTexture2D(pt.FRAMEBUFFER,pt.DEPTH_STENCIL_ATTACHMENT,pt.TEXTURE_2D,ir,0)}})(Dn.__webglFramebuffer,Hn)}else if(pr){Dn.__webglDepthbuffer=[];for(let $n=0;$n<6;$n++)_e.bindFramebuffer(pt.FRAMEBUFFER,Dn.__webglFramebuffer[$n]),Dn.__webglDepthbuffer[$n]=pt.createRenderbuffer(),Br(Dn.__webglDepthbuffer[$n],Hn,!1)}else _e.bindFramebuffer(pt.FRAMEBUFFER,Dn.__webglFramebuffer),Dn.__webglDepthbuffer=pt.createRenderbuffer(),Br(Dn.__webglDepthbuffer,Hn,!1);_e.bindFramebuffer(pt.FRAMEBUFFER,null)}function zr(Hn){return Math.min(Bt,Hn.samples)}function as(Hn){const Dn=rt.get(Hn);return _t&&Hn.samples>0&&a.has("WEBGL_multisampled_render_to_texture")===!0&&Dn.__useRenderToTexture!==!1}function ro(Hn,Dn){const pr=Hn.colorSpace,$n=Hn.format,Fn=Hn.type;return Hn.isCompressedTexture===!0||Hn.format===KA||pr!==yo&&pr!==_g&&(pr===Gs?_t===!1?a.has("EXT_sRGB")===!0&&$n===Ns?(Hn.format=KA,Hn.minFilter=xl,Hn.generateMipmaps=!1):Dn=JA.sRGBToLinear(Dn):$n===Ns&&Fn===sp||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):pr===e_||console.error("THREE.WebGLTextures: Unsupported texture color space:",pr)),Dn}this.allocateTextureUnit=function(){const Hn=Cr;return Hn>=St&&console.warn("THREE.WebGLTextures: Trying to use "+Hn+" texture units while this GPU supports only "+St),Cr+=1,Hn},this.resetTextureUnits=function(){Cr=0},this.setTexture2D=Wr,this.setTexture2DArray=function(Hn,Dn){const pr=rt.get(Hn);Hn.version>0&&pr.__version!==Hn.version?rs(pr,Hn,Dn):_e.bindTexture(pt.TEXTURE_2D_ARRAY,pr.__webglTexture,pt.TEXTURE0+Dn)},this.setTexture3D=function(Hn,Dn){const pr=rt.get(Hn);Hn.version>0&&pr.__version!==Hn.version?rs(pr,Hn,Dn):_e.bindTexture(pt.TEXTURE_3D,pr.__webglTexture,pt.TEXTURE0+Dn)},this.setTextureCube=function(Hn,Dn){const pr=rt.get(Hn);Hn.version>0&&pr.__version!==Hn.version?function($n,Fn,ir){if(Fn.image.length!==6)return;const xn=Jr($n,Fn),qn=Fn.source;_e.bindTexture(pt.TEXTURE_CUBE_MAP,$n.__webglTexture,pt.TEXTURE0+ir);const Xn=rt.get(qn);if(qn.version!==Xn.__version||xn===!0){_e.activeTexture(pt.TEXTURE0+ir),pt.pixelStorei(pt.UNPACK_FLIP_Y_WEBGL,Fn.flipY),pt.pixelStorei(pt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Fn.premultiplyAlpha),pt.pixelStorei(pt.UNPACK_ALIGNMENT,Fn.unpackAlignment),pt.pixelStorei(pt.UNPACK_COLORSPACE_CONVERSION_WEBGL,pt.NONE);const Tr=Fn.isCompressedTexture||Fn.image[0].isCompressedTexture,Er=Fn.image[0]&&Fn.image[0].isDataTexture,Or=[];for(let So=0;So<6;So++)Or[So]=Tr||Er?Er?Fn.image[So].image:Fn.image[So]:cn(Fn.image[So],!1,!0,Et),Or[So]=ro(Fn,Or[So]);const ss=Or[0],ys=Rn(ss)||_t,Fs=lt.convert(Fn.format,Fn.colorSpace),gs=lt.convert(Fn.type),uo=Gn(Fn.internalFormat,Fs,gs,Fn.colorSpace),lo=_t&&Fn.isVideoTexture!==!0,js=Xn.__version===void 0||xn===!0;let Wl,am=nr(Fn,ss,ys);if(Pr(pt.TEXTURE_CUBE_MAP,Fn,ys),Tr){lo&&js&&_e.texStorage2D(pt.TEXTURE_CUBE_MAP,am,uo,ss.width,ss.height);for(let So=0;So<6;So++){Wl=Or[So].mipmaps;for(let Al=0;Al<Wl.length;Al++){const Il=Wl[Al];Fn.format!==Ns?Fs!==null?lo?_e.compressedTexSubImage2D(pt.TEXTURE_CUBE_MAP_POSITIVE_X+So,Al,0,0,Il.width,Il.height,Fs,Il.data):_e.compressedTexImage2D(pt.TEXTURE_CUBE_MAP_POSITIVE_X+So,Al,uo,Il.width,Il.height,0,Il.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):lo?_e.texSubImage2D(pt.TEXTURE_CUBE_MAP_POSITIVE_X+So,Al,0,0,Il.width,Il.height,Fs,gs,Il.data):_e.texImage2D(pt.TEXTURE_CUBE_MAP_POSITIVE_X+So,Al,uo,Il.width,Il.height,0,Fs,gs,Il.data)}}}else{Wl=Fn.mipmaps,lo&&js&&(Wl.length>0&&am++,_e.texStorage2D(pt.TEXTURE_CUBE_MAP,am,uo,Or[0].width,Or[0].height));for(let So=0;So<6;So++)if(Er){lo?_e.texSubImage2D(pt.TEXTURE_CUBE_MAP_POSITIVE_X+So,0,0,0,Or[So].width,Or[So].height,Fs,gs,Or[So].data):_e.texImage2D(pt.TEXTURE_CUBE_MAP_POSITIVE_X+So,0,uo,Or[So].width,Or[So].height,0,Fs,gs,Or[So].data);for(let Al=0;Al<Wl.length;Al++){const Il=Wl[Al].image[So].image;lo?_e.texSubImage2D(pt.TEXTURE_CUBE_MAP_POSITIVE_X+So,Al+1,0,0,Il.width,Il.height,Fs,gs,Il.data):_e.texImage2D(pt.TEXTURE_CUBE_MAP_POSITIVE_X+So,Al+1,uo,Il.width,Il.height,0,Fs,gs,Il.data)}}else{lo?_e.texSubImage2D(pt.TEXTURE_CUBE_MAP_POSITIVE_X+So,0,0,0,Fs,gs,Or[So]):_e.texImage2D(pt.TEXTURE_CUBE_MAP_POSITIVE_X+So,0,uo,Fs,gs,Or[So]);for(let Al=0;Al<Wl.length;Al++){const Il=Wl[Al];lo?_e.texSubImage2D(pt.TEXTURE_CUBE_MAP_POSITIVE_X+So,Al+1,0,0,Fs,gs,Il.image[So]):_e.texImage2D(pt.TEXTURE_CUBE_MAP_POSITIVE_X+So,Al+1,uo,Fs,gs,Il.image[So])}}}Cn(Fn,ys)&&Tn(pt.TEXTURE_CUBE_MAP),Xn.__version=qn.version,Fn.onUpdate&&Fn.onUpdate(Fn)}$n.__version=Fn.version}(pr,Hn,Dn):_e.bindTexture(pt.TEXTURE_CUBE_MAP,pr.__webglTexture,pt.TEXTURE0+Dn)},this.rebindTextures=function(Hn,Dn,pr){const $n=rt.get(Hn);Dn!==void 0&&vr($n.__webglFramebuffer,Hn,Hn.texture,pt.COLOR_ATTACHMENT0,pt.TEXTURE_2D),pr!==void 0&&es(Hn)},this.setupRenderTarget=function(Hn){const Dn=Hn.texture,pr=rt.get(Hn),$n=rt.get(Dn);Hn.addEventListener("dispose",Wn),Hn.isWebGLMultipleRenderTargets!==!0&&($n.__webglTexture===void 0&&($n.__webglTexture=pt.createTexture()),$n.__version=Dn.version,ft.memory.textures++);const Fn=Hn.isWebGLCubeRenderTarget===!0,ir=Hn.isWebGLMultipleRenderTargets===!0,xn=Rn(Hn)||_t;if(Fn){pr.__webglFramebuffer=[];for(let qn=0;qn<6;qn++)pr.__webglFramebuffer[qn]=pt.createFramebuffer()}else{if(pr.__webglFramebuffer=pt.createFramebuffer(),ir)if(it.drawBuffers){const qn=Hn.texture;for(let Xn=0,Tr=qn.length;Xn<Tr;Xn++){const Er=rt.get(qn[Xn]);Er.__webglTexture===void 0&&(Er.__webglTexture=pt.createTexture(),ft.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(_t&&Hn.samples>0&&as(Hn)===!1){const qn=ir?Dn:[Dn];pr.__webglMultisampledFramebuffer=pt.createFramebuffer(),pr.__webglColorRenderbuffer=[],_e.bindFramebuffer(pt.FRAMEBUFFER,pr.__webglMultisampledFramebuffer);for(let Xn=0;Xn<qn.length;Xn++){const Tr=qn[Xn];pr.__webglColorRenderbuffer[Xn]=pt.createRenderbuffer(),pt.bindRenderbuffer(pt.RENDERBUFFER,pr.__webglColorRenderbuffer[Xn]);const Er=lt.convert(Tr.format,Tr.colorSpace),Or=lt.convert(Tr.type),ss=Gn(Tr.internalFormat,Er,Or,Tr.colorSpace,Hn.isXRRenderTarget===!0),ys=zr(Hn);pt.renderbufferStorageMultisample(pt.RENDERBUFFER,ys,ss,Hn.width,Hn.height),pt.framebufferRenderbuffer(pt.FRAMEBUFFER,pt.COLOR_ATTACHMENT0+Xn,pt.RENDERBUFFER,pr.__webglColorRenderbuffer[Xn])}pt.bindRenderbuffer(pt.RENDERBUFFER,null),Hn.depthBuffer&&(pr.__webglDepthRenderbuffer=pt.createRenderbuffer(),Br(pr.__webglDepthRenderbuffer,Hn,!0)),_e.bindFramebuffer(pt.FRAMEBUFFER,null)}}if(Fn){_e.bindTexture(pt.TEXTURE_CUBE_MAP,$n.__webglTexture),Pr(pt.TEXTURE_CUBE_MAP,Dn,xn);for(let qn=0;qn<6;qn++)vr(pr.__webglFramebuffer[qn],Hn,Dn,pt.COLOR_ATTACHMENT0,pt.TEXTURE_CUBE_MAP_POSITIVE_X+qn);Cn(Dn,xn)&&Tn(pt.TEXTURE_CUBE_MAP),_e.unbindTexture()}else if(ir){const qn=Hn.texture;for(let Xn=0,Tr=qn.length;Xn<Tr;Xn++){const Er=qn[Xn],Or=rt.get(Er);_e.bindTexture(pt.TEXTURE_2D,Or.__webglTexture),Pr(pt.TEXTURE_2D,Er,xn),vr(pr.__webglFramebuffer,Hn,Er,pt.COLOR_ATTACHMENT0+Xn,pt.TEXTURE_2D),Cn(Er,xn)&&Tn(pt.TEXTURE_2D)}_e.unbindTexture()}else{let qn=pt.TEXTURE_2D;(Hn.isWebGL3DRenderTarget||Hn.isWebGLArrayRenderTarget)&&(_t?qn=Hn.isWebGL3DRenderTarget?pt.TEXTURE_3D:pt.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),_e.bindTexture(qn,$n.__webglTexture),Pr(qn,Dn,xn),vr(pr.__webglFramebuffer,Hn,Dn,pt.COLOR_ATTACHMENT0,qn),Cn(Dn,xn)&&Tn(qn),_e.unbindTexture()}Hn.depthBuffer&&es(Hn)},this.updateRenderTargetMipmap=function(Hn){const Dn=Rn(Hn)||_t,pr=Hn.isWebGLMultipleRenderTargets===!0?Hn.texture:[Hn.texture],$n=Hn.isWebGLCubeRenderTarget?pt.TEXTURE_CUBE_MAP:pt.TEXTURE_2D;for(let Fn=0,ir=pr.length;Fn<ir;Fn++){const xn=pr[Fn],qn=rt.get(xn),Xn=qn.__webglTexture;qn.__version!==xn.version&&(_e.bindTexture($n,Xn),Pr($n,xn,Dn),_e.unbindTexture(),qn.__version=xn.version),Cn(xn,Dn)&&(_e.bindTexture($n,Xn),Tn($n),_e.unbindTexture())}},this.updateMultisampleRenderTarget=function(Hn){if(_t&&Hn.samples>0&&as(Hn)===!1){const Dn=Hn.isWebGLMultipleRenderTargets?Hn.texture:[Hn.texture],pr=Hn.width,$n=Hn.height;let Fn=pt.COLOR_BUFFER_BIT;const ir=[],xn=Hn.stencilBuffer?pt.DEPTH_STENCIL_ATTACHMENT:pt.DEPTH_ATTACHMENT,qn=rt.get(Hn),Xn=Hn.isWebGLMultipleRenderTargets===!0;if(Xn)for(let Tr=0;Tr<Dn.length;Tr++)_e.bindFramebuffer(pt.FRAMEBUFFER,qn.__webglMultisampledFramebuffer),pt.framebufferRenderbuffer(pt.FRAMEBUFFER,pt.COLOR_ATTACHMENT0+Tr,pt.RENDERBUFFER,null),_e.bindFramebuffer(pt.FRAMEBUFFER,qn.__webglFramebuffer),pt.framebufferTexture2D(pt.DRAW_FRAMEBUFFER,pt.COLOR_ATTACHMENT0+Tr,pt.TEXTURE_2D,null,0);_e.bindFramebuffer(pt.READ_FRAMEBUFFER,qn.__webglMultisampledFramebuffer),_e.bindFramebuffer(pt.DRAW_FRAMEBUFFER,qn.__webglFramebuffer);for(let Tr=0;Tr<Dn.length;Tr++){ir.push(pt.COLOR_ATTACHMENT0+Tr),Hn.depthBuffer&&ir.push(xn);const Er=qn.__ignoreDepthValues!==void 0&&qn.__ignoreDepthValues;if(Er===!1&&(Hn.depthBuffer&&(Fn|=pt.DEPTH_BUFFER_BIT),Hn.stencilBuffer&&(Fn|=pt.STENCIL_BUFFER_BIT)),Xn&&pt.framebufferRenderbuffer(pt.READ_FRAMEBUFFER,pt.COLOR_ATTACHMENT0,pt.RENDERBUFFER,qn.__webglColorRenderbuffer[Tr]),Er===!0&&(pt.invalidateFramebuffer(pt.READ_FRAMEBUFFER,[xn]),pt.invalidateFramebuffer(pt.DRAW_FRAMEBUFFER,[xn])),Xn){const Or=rt.get(Dn[Tr]).__webglTexture;pt.framebufferTexture2D(pt.DRAW_FRAMEBUFFER,pt.COLOR_ATTACHMENT0,pt.TEXTURE_2D,Or,0)}pt.blitFramebuffer(0,0,pr,$n,0,0,pr,$n,Fn,pt.NEAREST),Lt&&pt.invalidateFramebuffer(pt.READ_FRAMEBUFFER,ir)}if(_e.bindFramebuffer(pt.READ_FRAMEBUFFER,null),_e.bindFramebuffer(pt.DRAW_FRAMEBUFFER,null),Xn)for(let Tr=0;Tr<Dn.length;Tr++){_e.bindFramebuffer(pt.FRAMEBUFFER,qn.__webglMultisampledFramebuffer),pt.framebufferRenderbuffer(pt.FRAMEBUFFER,pt.COLOR_ATTACHMENT0+Tr,pt.RENDERBUFFER,qn.__webglColorRenderbuffer[Tr]);const Er=rt.get(Dn[Tr]).__webglTexture;_e.bindFramebuffer(pt.FRAMEBUFFER,qn.__webglFramebuffer),pt.framebufferTexture2D(pt.DRAW_FRAMEBUFFER,pt.COLOR_ATTACHMENT0+Tr,pt.TEXTURE_2D,Er,0)}_e.bindFramebuffer(pt.DRAW_FRAMEBUFFER,qn.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=es,this.setupFrameBufferTexture=vr,this.useMultisampledRTT=as}function iC(pt,a,_e){const rt=_e.isWebGL2;return{convert:function(it,lt=_g){let ft;if(it===sp)return pt.UNSIGNED_BYTE;if(it===Ds)return pt.UNSIGNED_SHORT_4_4_4_4;if(it===Fo)return pt.UNSIGNED_SHORT_5_5_5_1;if(it===To)return pt.BYTE;if(it===Zo)return pt.SHORT;if(it===Po)return pt.UNSIGNED_SHORT;if(it===Mm)return pt.INT;if(it===Jl)return pt.UNSIGNED_INT;if(it===ju)return pt.FLOAT;if(it===Bs)return rt?pt.HALF_FLOAT:(ft=a.get("OES_texture_half_float"),ft!==null?ft.HALF_FLOAT_OES:null);if(it===fs)return pt.ALPHA;if(it===Ns)return pt.RGBA;if(it===En)return pt.LUMINANCE;if(it===Js)return pt.LUMINANCE_ALPHA;if(it===El)return pt.DEPTH_COMPONENT;if(it===to)return pt.DEPTH_STENCIL;if(it===KA)return ft=a.get("EXT_sRGB"),ft!==null?ft.SRGB_ALPHA_EXT:null;if(it===Ls)return pt.RED;if(it===ao)return pt.RED_INTEGER;if(it===wu)return pt.RG;if(it===Yo)return pt.RG_INTEGER;if(it===$a)return pt.RGBA_INTEGER;if(it===$u||it===Ko||it===Ku||it===op)if(lt===Gs){if(ft=a.get("WEBGL_compressed_texture_s3tc_srgb"),ft===null)return null;if(it===$u)return ft.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(it===Ko)return ft.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(it===Ku)return ft.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(it===op)return ft.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(ft=a.get("WEBGL_compressed_texture_s3tc"),ft===null)return null;if(it===$u)return ft.COMPRESSED_RGB_S3TC_DXT1_EXT;if(it===Ko)return ft.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(it===Ku)return ft.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(it===op)return ft.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(it===Ju||it===mu||it===Nl||it===Km){if(ft=a.get("WEBGL_compressed_texture_pvrtc"),ft===null)return null;if(it===Ju)return ft.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(it===mu)return ft.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(it===Nl)return ft.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(it===Km)return ft.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(it===r0)return ft=a.get("WEBGL_compressed_texture_etc1"),ft!==null?ft.COMPRESSED_RGB_ETC1_WEBGL:null;if(it===Zl||it===na){if(ft=a.get("WEBGL_compressed_texture_etc"),ft===null)return null;if(it===Zl)return lt===Gs?ft.COMPRESSED_SRGB8_ETC2:ft.COMPRESSED_RGB8_ETC2;if(it===na)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:ft.COMPRESSED_RGBA8_ETC2_EAC}if(it===_l||it===Im||it===k0||it===Jm||it===Op||it===_c||it===fm||it===H_||it===Bp||it===O0||it===Jp||it===jr||it===y_||it===ns){if(ft=a.get("WEBGL_compressed_texture_astc"),ft===null)return null;if(it===_l)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:ft.COMPRESSED_RGBA_ASTC_4x4_KHR;if(it===Im)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:ft.COMPRESSED_RGBA_ASTC_5x4_KHR;if(it===k0)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:ft.COMPRESSED_RGBA_ASTC_5x5_KHR;if(it===Jm)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:ft.COMPRESSED_RGBA_ASTC_6x5_KHR;if(it===Op)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:ft.COMPRESSED_RGBA_ASTC_6x6_KHR;if(it===_c)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:ft.COMPRESSED_RGBA_ASTC_8x5_KHR;if(it===fm)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:ft.COMPRESSED_RGBA_ASTC_8x6_KHR;if(it===H_)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:ft.COMPRESSED_RGBA_ASTC_8x8_KHR;if(it===Bp)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:ft.COMPRESSED_RGBA_ASTC_10x5_KHR;if(it===O0)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:ft.COMPRESSED_RGBA_ASTC_10x6_KHR;if(it===Jp)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:ft.COMPRESSED_RGBA_ASTC_10x8_KHR;if(it===jr)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:ft.COMPRESSED_RGBA_ASTC_10x10_KHR;if(it===y_)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:ft.COMPRESSED_RGBA_ASTC_12x10_KHR;if(it===ns)return lt===Gs?ft.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:ft.COMPRESSED_RGBA_ASTC_12x12_KHR}if(it===Lp){if(ft=a.get("EXT_texture_compression_bptc"),ft===null)return null;if(it===Lp)return lt===Gs?ft.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:ft.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(it===Pm||it===Oo||it===$s||it===Tv){if(ft=a.get("EXT_texture_compression_rgtc"),ft===null)return null;if(it===Lp)return ft.COMPRESSED_RED_RGTC1_EXT;if(it===Oo)return ft.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(it===$s)return ft.COMPRESSED_RED_GREEN_RGTC2_EXT;if(it===Tv)return ft.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return it===Ll?rt?pt.UNSIGNED_INT_24_8:(ft=a.get("WEBGL_depth_texture"),ft!==null?ft.UNSIGNED_INT_24_8_WEBGL:null):pt[it]!==void 0?pt[it]:null}}}class oE extends rm{constructor(a=[]){super(),this.isArrayCamera=!0,this.cameras=a}}class pp extends ga{constructor(){super(),this.isGroup=!0,this.type="Group"}}const lO={type:"move"};class sC{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new pp,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new pp,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Nn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Nn),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new pp,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Nn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Nn),this._grip}dispatchEvent(a){return this._targetRay!==null&&this._targetRay.dispatchEvent(a),this._grip!==null&&this._grip.dispatchEvent(a),this._hand!==null&&this._hand.dispatchEvent(a),this}connect(a){if(a&&a.hand){const _e=this._hand;if(_e)for(const rt of a.hand.values())this._getHandJoint(_e,rt)}return this.dispatchEvent({type:"connected",data:a}),this}disconnect(a){return this.dispatchEvent({type:"disconnected",data:a}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(a,_e,rt){let it=null,lt=null,ft=null;const _t=this._targetRay,St=this._grip,Et=this._hand;if(a&&_e.session.visibilityState!=="visible-blurred"){if(Et&&a.hand){ft=!0;for(const Jt of a.hand.values()){const Ht=_e.getJointPose(Jt,rt),$t=this._getHandJoint(Et,Jt);Ht!==null&&($t.matrix.fromArray(Ht.transform.matrix),$t.matrix.decompose($t.position,$t.rotation,$t.scale),$t.matrixWorldNeedsUpdate=!0,$t.jointRadius=Ht.radius),$t.visible=Ht!==null}const Tt=Et.joints["index-finger-tip"],Bt=Et.joints["thumb-tip"],Ot=Tt.position.distanceTo(Bt.position),Lt=.02,zt=.005;Et.inputState.pinching&&Ot>Lt+zt?(Et.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:a.handedness,target:this})):!Et.inputState.pinching&&Ot<=Lt-zt&&(Et.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:a.handedness,target:this}))}else St!==null&&a.gripSpace&&(lt=_e.getPose(a.gripSpace,rt),lt!==null&&(St.matrix.fromArray(lt.transform.matrix),St.matrix.decompose(St.position,St.rotation,St.scale),St.matrixWorldNeedsUpdate=!0,lt.linearVelocity?(St.hasLinearVelocity=!0,St.linearVelocity.copy(lt.linearVelocity)):St.hasLinearVelocity=!1,lt.angularVelocity?(St.hasAngularVelocity=!0,St.angularVelocity.copy(lt.angularVelocity)):St.hasAngularVelocity=!1));_t!==null&&(it=_e.getPose(a.targetRaySpace,rt),it===null&&lt!==null&&(it=lt),it!==null&&(_t.matrix.fromArray(it.transform.matrix),_t.matrix.decompose(_t.position,_t.rotation,_t.scale),_t.matrixWorldNeedsUpdate=!0,it.linearVelocity?(_t.hasLinearVelocity=!0,_t.linearVelocity.copy(it.linearVelocity)):_t.hasLinearVelocity=!1,it.angularVelocity?(_t.hasAngularVelocity=!0,_t.angularVelocity.copy(it.angularVelocity)):_t.hasAngularVelocity=!1,this.dispatchEvent(lO)))}return _t!==null&&(_t.visible=it!==null),St!==null&&(St.visible=lt!==null),Et!==null&&(Et.visible=ft!==null),this}_getHandJoint(a,_e){if(a.joints[_e.jointName]===void 0){const rt=new pp;rt.matrixAutoUpdate=!1,rt.visible=!1,a.joints[_e.jointName]=rt,a.add(rt)}return a.joints[_e.jointName]}}class sy extends Yl{constructor(a,_e,rt,it,lt,ft,_t,St,Et,Tt){if((Tt=Tt!==void 0?Tt:El)!==El&&Tt!==to)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");rt===void 0&&Tt===El&&(rt=Jl),rt===void 0&&Tt===to&&(rt=Ll),super(null,it,lt,ft,_t,St,Tt,rt,Et),this.isDepthTexture=!0,this.image={width:a,height:_e},this.magFilter=_t!==void 0?_t:Uo,this.minFilter=St!==void 0?St:Uo,this.flipY=!1,this.generateMipmaps=!1}}class Gp extends x_{constructor(a,_e){super();const rt=this;let it=null,lt=1,ft=null,_t="local-floor",St=1,Et=null,Tt=null,Bt=null,Ot=null,Lt=null,zt=null;const Jt=_e.getContextAttributes();let Ht=null,$t=null;const rn=[],cn=[],Rn=new Set,Cn=new Map,Tn=new rm;Tn.layers.enable(1),Tn.viewport=new Cl;const Gn=new rm;Gn.layers.enable(2),Gn.viewport=new Cl;const nr=[Tn,Gn],Qn=new oE;Qn.layers.enable(1),Qn.layers.enable(2);let ur=null,Wn=null;function Ar(vr){const Br=cn.indexOf(vr.inputSource);if(Br===-1)return;const es=rn[Br];es!==void 0&&(es.update(vr.inputSource,vr.frame,Et||ft),es.dispatchEvent({type:vr.type,data:vr.inputSource}))}function Cr(){it.removeEventListener("select",Ar),it.removeEventListener("selectstart",Ar),it.removeEventListener("selectend",Ar),it.removeEventListener("squeeze",Ar),it.removeEventListener("squeezestart",Ar),it.removeEventListener("squeezeend",Ar),it.removeEventListener("end",Cr),it.removeEventListener("inputsourceschange",Wr);for(let vr=0;vr<rn.length;vr++){const Br=cn[vr];Br!==null&&(cn[vr]=null,rn[vr].disconnect(Br))}ur=null,Wn=null,a.setRenderTarget(Ht),Lt=null,Ot=null,Bt=null,it=null,$t=null,rs.stop(),rt.isPresenting=!1,rt.dispatchEvent({type:"sessionend"})}function Wr(vr){for(let Br=0;Br<vr.removed.length;Br++){const es=vr.removed[Br],zr=cn.indexOf(es);zr>=0&&(cn[zr]=null,rn[zr].disconnect(es))}for(let Br=0;Br<vr.added.length;Br++){const es=vr.added[Br];let zr=cn.indexOf(es);if(zr===-1){for(let ro=0;ro<rn.length;ro++){if(ro>=cn.length){cn.push(es),zr=ro;break}if(cn[ro]===null){cn[ro]=es,zr=ro;break}}if(zr===-1)break}const as=rn[zr];as&&as.connect(es)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(vr){let Br=rn[vr];return Br===void 0&&(Br=new sC,rn[vr]=Br),Br.getTargetRaySpace()},this.getControllerGrip=function(vr){let Br=rn[vr];return Br===void 0&&(Br=new sC,rn[vr]=Br),Br.getGripSpace()},this.getHand=function(vr){let Br=rn[vr];return Br===void 0&&(Br=new sC,rn[vr]=Br),Br.getHandSpace()},this.setFramebufferScaleFactor=function(vr){lt=vr,rt.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(vr){_t=vr,rt.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return Et||ft},this.setReferenceSpace=function(vr){Et=vr},this.getBaseLayer=function(){return Ot!==null?Ot:Lt},this.getBinding=function(){return Bt},this.getFrame=function(){return zt},this.getSession=function(){return it},this.setSession=async function(vr){if(it=vr,it!==null){if(Ht=a.getRenderTarget(),it.addEventListener("select",Ar),it.addEventListener("selectstart",Ar),it.addEventListener("selectend",Ar),it.addEventListener("squeeze",Ar),it.addEventListener("squeezestart",Ar),it.addEventListener("squeezeend",Ar),it.addEventListener("end",Cr),it.addEventListener("inputsourceschange",Wr),Jt.xrCompatible!==!0&&await _e.makeXRCompatible(),it.renderState.layers===void 0||a.capabilities.isWebGL2===!1){const Br={antialias:it.renderState.layers!==void 0||Jt.antialias,alpha:!0,depth:Jt.depth,stencil:Jt.stencil,framebufferScaleFactor:lt};Lt=new XRWebGLLayer(it,_e,Br),it.updateRenderState({baseLayer:Lt}),$t=new _h(Lt.framebufferWidth,Lt.framebufferHeight,{format:Ns,type:sp,colorSpace:a.outputColorSpace,stencilBuffer:Jt.stencil})}else{let Br=null,es=null,zr=null;Jt.depth&&(zr=Jt.stencil?_e.DEPTH24_STENCIL8:_e.DEPTH_COMPONENT24,Br=Jt.stencil?to:El,es=Jt.stencil?Ll:Jl);const as={colorFormat:_e.RGBA8,depthFormat:zr,scaleFactor:lt};Bt=new XRWebGLBinding(it,_e),Ot=Bt.createProjectionLayer(as),it.updateRenderState({layers:[Ot]}),$t=new _h(Ot.textureWidth,Ot.textureHeight,{format:Ns,type:sp,depthTexture:new sy(Ot.textureWidth,Ot.textureHeight,es,void 0,void 0,void 0,void 0,void 0,void 0,Br),stencilBuffer:Jt.stencil,colorSpace:a.outputColorSpace,samples:Jt.antialias?4:0}),a.properties.get($t).__ignoreDepthValues=Ot.ignoreDepthValues}$t.isXRRenderTarget=!0,this.setFoveation(St),Et=null,ft=await it.requestReferenceSpace(_t),rs.setContext(it),rs.start(),rt.isPresenting=!0,rt.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(it!==null)return it.environmentBlendMode};const is=new Nn,Qr=new Nn;function Pr(vr,Br){Br===null?vr.matrixWorld.copy(vr.matrix):vr.matrixWorld.multiplyMatrices(Br.matrixWorld,vr.matrix),vr.matrixWorldInverse.copy(vr.matrixWorld).invert()}this.updateCamera=function(vr){if(it===null)return;Qn.near=Gn.near=Tn.near=vr.near,Qn.far=Gn.far=Tn.far=vr.far,ur===Qn.near&&Wn===Qn.far||(it.updateRenderState({depthNear:Qn.near,depthFar:Qn.far}),ur=Qn.near,Wn=Qn.far);const Br=vr.parent,es=Qn.cameras;Pr(Qn,Br);for(let zr=0;zr<es.length;zr++)Pr(es[zr],Br);es.length===2?function(zr,as,ro){is.setFromMatrixPosition(as.matrixWorld),Qr.setFromMatrixPosition(ro.matrixWorld);const Hn=is.distanceTo(Qr),Dn=as.projectionMatrix.elements,pr=ro.projectionMatrix.elements,$n=Dn[14]/(Dn[10]-1),Fn=Dn[14]/(Dn[10]+1),ir=(Dn[9]+1)/Dn[5],xn=(Dn[9]-1)/Dn[5],qn=(Dn[8]-1)/Dn[0],Xn=(pr[8]+1)/pr[0],Tr=$n*qn,Er=$n*Xn,Or=Hn/(-qn+Xn),ss=Or*-qn;as.matrixWorld.decompose(zr.position,zr.quaternion,zr.scale),zr.translateX(ss),zr.translateZ(Or),zr.matrixWorld.compose(zr.position,zr.quaternion,zr.scale),zr.matrixWorldInverse.copy(zr.matrixWorld).invert();const ys=$n+Or,Fs=Fn+Or,gs=Tr-ss,uo=Er+(Hn-ss),lo=ir*Fn/Fs*ys,js=xn*Fn/Fs*ys;zr.projectionMatrix.makePerspective(gs,uo,lo,js,ys,Fs),zr.projectionMatrixInverse.copy(zr.projectionMatrix).invert()}(Qn,Tn,Gn):Qn.projectionMatrix.copy(Tn.projectionMatrix),function(zr,as,ro){ro===null?zr.matrix.copy(as.matrixWorld):(zr.matrix.copy(ro.matrixWorld),zr.matrix.invert(),zr.matrix.multiply(as.matrixWorld)),zr.matrix.decompose(zr.position,zr.quaternion,zr.scale),zr.updateMatrixWorld(!0);const Hn=zr.children;for(let Dn=0,pr=Hn.length;Dn<pr;Dn++)Hn[Dn].updateMatrixWorld(!0);zr.projectionMatrix.copy(as.projectionMatrix),zr.projectionMatrixInverse.copy(as.projectionMatrixInverse),zr.isPerspectiveCamera&&(zr.fov=2*n_*Math.atan(1/zr.projectionMatrix.elements[5]),zr.zoom=1)}(vr,Qn,Br)},this.getCamera=function(){return Qn},this.getFoveation=function(){if(Ot!==null||Lt!==null)return St},this.setFoveation=function(vr){St=vr,Ot!==null&&(Ot.fixedFoveation=vr),Lt!==null&&Lt.fixedFoveation!==void 0&&(Lt.fixedFoveation=vr)},this.getPlanes=function(){return Rn};let Jr=null;this.onPreAnimationFrameCallback=null;const rs=new GT;rs.setAnimationLoop(function(vr,Br){if(rt.onPreAnimationFrameCallback&&rt.onPreAnimationFrameCallback(vr,Br),Tt=Br.getViewerPose(Et||ft),zt=Br,Tt!==null){const es=Tt.views;Lt!==null&&(a.setRenderTargetFramebuffer($t,Lt.framebuffer),a.setRenderTarget($t));let zr=!1;es.length!==Qn.cameras.length&&(Qn.cameras.length=0,zr=!0);for(let as=0;as<es.length;as++){const ro=es[as];let Hn=null;if(Lt!==null)Hn=Lt.getViewport(ro);else{const pr=Bt.getViewSubImage(Ot,ro);Hn=pr.viewport,as===0&&(a.setRenderTargetTextures($t,pr.colorTexture,Ot.ignoreDepthValues?void 0:pr.depthStencilTexture),a.setRenderTarget($t))}let Dn=nr[as];Dn===void 0&&(Dn=new rm,Dn.layers.enable(as),Dn.viewport=new Cl,nr[as]=Dn),Dn.matrix.fromArray(ro.transform.matrix),Dn.matrix.decompose(Dn.position,Dn.quaternion,Dn.scale),Dn.projectionMatrix.fromArray(ro.projectionMatrix),Dn.projectionMatrixInverse.copy(Dn.projectionMatrix).invert(),Dn.viewport.set(Hn.x,Hn.y,Hn.width,Hn.height),as===0&&(Qn.matrix.copy(Dn.matrix),Qn.matrix.decompose(Qn.position,Qn.quaternion,Qn.scale)),zr===!0&&Qn.cameras.push(Dn)}}for(let es=0;es<rn.length;es++){const zr=cn[es],as=rn[es];zr!==null&&as!==void 0&&as.update(zr,Br,Et||ft)}if(Jr&&Jr(vr,Br),Br.detectedPlanes){rt.dispatchEvent({type:"planesdetected",data:Br.detectedPlanes});let es=null;for(const zr of Rn)Br.detectedPlanes.has(zr)||(es===null&&(es=[]),es.push(zr));if(es!==null)for(const zr of es)Rn.delete(zr),Cn.delete(zr),rt.dispatchEvent({type:"planeremoved",data:zr});for(const zr of Br.detectedPlanes)if(Rn.has(zr)){const as=Cn.get(zr);zr.lastChangedTime>as&&(Cn.set(zr,zr.lastChangedTime),rt.dispatchEvent({type:"planechanged",data:zr}))}else Rn.add(zr),Cn.set(zr,Br.lastChangedTime),rt.dispatchEvent({type:"planeadded",data:zr})}zt=null}),this.setAnimationLoop=function(vr){Jr=vr},this.dispose=function(){}}}function Ql(pt,a){function _e(it,lt){it.matrixAutoUpdate===!0&&it.updateMatrix(),lt.value.copy(it.matrix)}function rt(it,lt){it.opacity.value=lt.opacity,lt.color&&it.diffuse.value.copy(lt.color),lt.emissive&&it.emissive.value.copy(lt.emissive).multiplyScalar(lt.emissiveIntensity),lt.map&&(it.map.value=lt.map,_e(lt.map,it.mapTransform)),lt.alphaMap&&(it.alphaMap.value=lt.alphaMap,_e(lt.alphaMap,it.alphaMapTransform)),lt.bumpMap&&(it.bumpMap.value=lt.bumpMap,_e(lt.bumpMap,it.bumpMapTransform),it.bumpScale.value=lt.bumpScale,lt.side===Gt&&(it.bumpScale.value*=-1)),lt.normalMap&&(it.normalMap.value=lt.normalMap,_e(lt.normalMap,it.normalMapTransform),it.normalScale.value.copy(lt.normalScale),lt.side===Gt&&it.normalScale.value.negate()),lt.displacementMap&&(it.displacementMap.value=lt.displacementMap,_e(lt.displacementMap,it.displacementMapTransform),it.displacementScale.value=lt.displacementScale,it.displacementBias.value=lt.displacementBias),lt.emissiveMap&&(it.emissiveMap.value=lt.emissiveMap,_e(lt.emissiveMap,it.emissiveMapTransform)),lt.specularMap&&(it.specularMap.value=lt.specularMap,_e(lt.specularMap,it.specularMapTransform)),lt.alphaTest>0&&(it.alphaTest.value=lt.alphaTest);const ft=a.get(lt).envMap;if(ft){it.envMap.value=ft;const _t=a.get(lt).environment||ft;it.envMapRotation.value=_t?_t.rotation:0,it.flipEnvMap.value=ft.isCubeTexture&&ft.isRenderTargetTexture===!1?-1:1,it.reflectivity.value=lt.reflectivity,it.ior.value=lt.ior,it.refractionRatio.value=lt.refractionRatio}if(lt.lightMap){it.lightMap.value=lt.lightMap;const _t=pt.useLegacyLights===!0?Math.PI:1;it.lightMapIntensity.value=lt.lightMapIntensity*_t,_e(lt.lightMap,it.lightMapTransform)}lt.aoMap&&(it.aoMap.value=lt.aoMap,it.aoMapIntensity.value=lt.aoMapIntensity,_e(lt.aoMap,it.aoMapTransform))}return{refreshTransformUniform:_e,refreshFogUniforms:function(it,lt){lt.color.getRGB(it.fogColor.value,q1(pt)),lt.isFog?(it.fogNear.value=lt.near,it.fogFar.value=lt.far):lt.isFogExp2&&(it.fogDensity.value=lt.density)},refreshMaterialUniforms:function(it,lt,ft,_t,St){lt.isMeshBasicMaterial||lt.isMeshLambertMaterial?rt(it,lt):lt.isMeshToonMaterial?(rt(it,lt),function(Et,Tt){Tt.gradientMap&&(Et.gradientMap.value=Tt.gradientMap)}(it,lt)):lt.isMeshPhongMaterial?(rt(it,lt),function(Et,Tt){Et.specular.value.copy(Tt.specular),Et.shininess.value=Math.max(Tt.shininess,1e-4)}(it,lt)):lt.isMeshStandardMaterial?(rt(it,lt),function(Et,Tt){Et.metalness.value=Tt.metalness,Tt.metalnessMap&&(Et.metalnessMap.value=Tt.metalnessMap,_e(Tt.metalnessMap,Et.metalnessMapTransform)),Et.roughness.value=Tt.roughness,Tt.roughnessMap&&(Et.roughnessMap.value=Tt.roughnessMap,_e(Tt.roughnessMap,Et.roughnessMapTransform)),a.get(Tt).envMap&&(Et.envMapIntensity.value=Tt.envMapIntensity)}(it,lt),lt.isMeshPhysicalMaterial&&function(Et,Tt,Bt){Et.ior.value=Tt.ior,Tt.sheen>0&&(Et.sheenColor.value.copy(Tt.sheenColor).multiplyScalar(Tt.sheen),Et.sheenRoughness.value=Tt.sheenRoughness,Tt.sheenColorMap&&(Et.sheenColorMap.value=Tt.sheenColorMap,_e(Tt.sheenColorMap,Et.sheenColorMapTransform)),Tt.sheenRoughnessMap&&(Et.sheenRoughnessMap.value=Tt.sheenRoughnessMap,_e(Tt.sheenRoughnessMap,Et.sheenRoughnessMapTransform))),Tt.clearcoat>0&&(Et.clearcoat.value=Tt.clearcoat,Et.clearcoatRoughness.value=Tt.clearcoatRoughness,Tt.clearcoatMap&&(Et.clearcoatMap.value=Tt.clearcoatMap,_e(Tt.clearcoatMap,Et.clearcoatMapTransform)),Tt.clearcoatRoughnessMap&&(Et.clearcoatRoughnessMap.value=Tt.clearcoatRoughnessMap,_e(Tt.clearcoatRoughnessMap,Et.clearcoatRoughnessMapTransform)),Tt.clearcoatNormalMap&&(Et.clearcoatNormalMap.value=Tt.clearcoatNormalMap,_e(Tt.clearcoatNormalMap,Et.clearcoatNormalMapTransform),Et.clearcoatNormalScale.value.copy(Tt.clearcoatNormalScale),Tt.side===Gt&&Et.clearcoatNormalScale.value.negate())),Tt.iridescence>0&&(Et.iridescence.value=Tt.iridescence,Et.iridescenceIOR.value=Tt.iridescenceIOR,Et.iridescenceThicknessMinimum.value=Tt.iridescenceThicknessRange[0],Et.iridescenceThicknessMaximum.value=Tt.iridescenceThicknessRange[1],Tt.iridescenceMap&&(Et.iridescenceMap.value=Tt.iridescenceMap,_e(Tt.iridescenceMap,Et.iridescenceMapTransform)),Tt.iridescenceThicknessMap&&(Et.iridescenceThicknessMap.value=Tt.iridescenceThicknessMap,_e(Tt.iridescenceThicknessMap,Et.iridescenceThicknessMapTransform))),Tt.transmission>0&&(Et.transmission.value=Tt.transmission,Et.transmissionSamplerMap.value=Bt.texture,Et.transmissionSamplerSize.value.set(Bt.width,Bt.height),Tt.transmissionMap&&(Et.transmissionMap.value=Tt.transmissionMap,_e(Tt.transmissionMap,Et.transmissionMapTransform)),Et.thickness.value=Tt.thickness,Tt.thicknessMap&&(Et.thicknessMap.value=Tt.thicknessMap,_e(Tt.thicknessMap,Et.thicknessMapTransform)),Et.attenuationDistance.value=Tt.attenuationDistance,Et.attenuationColor.value.copy(Tt.attenuationColor)),Et.specularIntensity.value=Tt.specularIntensity,Et.specularColor.value.copy(Tt.specularColor),Tt.specularColorMap&&(Et.specularColorMap.value=Tt.specularColorMap,_e(Tt.specularColorMap,Et.specularColorMapTransform)),Tt.specularIntensityMap&&(Et.specularIntensityMap.value=Tt.specularIntensityMap,_e(Tt.specularIntensityMap,Et.specularIntensityMapTransform))}(it,lt,St)):lt.isMeshMatcapMaterial?(rt(it,lt),function(Et,Tt){Tt.matcap&&(Et.matcap.value=Tt.matcap)}(it,lt)):lt.isMeshDepthMaterial?rt(it,lt):lt.isMeshDistanceMaterial?(rt(it,lt),function(Et,Tt){const Bt=a.get(Tt).light;Et.referencePosition.value.setFromMatrixPosition(Bt.matrixWorld),Et.nearDistance.value=Bt.shadow.camera.near,Et.farDistance.value=Bt.shadow.camera.far}(it,lt)):lt.isMeshNormalMaterial?rt(it,lt):lt.isLineBasicMaterial?(function(Et,Tt){Et.diffuse.value.copy(Tt.color),Et.opacity.value=Tt.opacity,Tt.map&&(Et.map.value=Tt.map,_e(Tt.map,Et.mapTransform))}(it,lt),lt.isLineDashedMaterial&&function(Et,Tt){Et.dashSize.value=Tt.dashSize,Et.totalSize.value=Tt.dashSize+Tt.gapSize,Et.scale.value=Tt.scale}(it,lt)):lt.isPointsMaterial?function(Et,Tt,Bt,Ot){Et.diffuse.value.copy(Tt.color),Et.opacity.value=Tt.opacity,Et.size.value=Tt.size*Bt,Et.scale.value=.5*Ot,Tt.map&&(Et.map.value=Tt.map,_e(Tt.map,Et.uvTransform)),Tt.alphaMap&&(Et.alphaMap.value=Tt.alphaMap),Tt.alphaTest>0&&(Et.alphaTest.value=Tt.alphaTest)}(it,lt,ft,_t):lt.isSpriteMaterial?function(Et,Tt){Et.diffuse.value.copy(Tt.color),Et.opacity.value=Tt.opacity,Et.rotation.value=Tt.rotation,Tt.map&&(Et.map.value=Tt.map,_e(Tt.map,Et.mapTransform)),Tt.alphaMap&&(Et.alphaMap.value=Tt.alphaMap),Tt.alphaTest>0&&(Et.alphaTest.value=Tt.alphaTest)}(it,lt):lt.isShadowMaterial?(it.color.value.copy(lt.color),it.opacity.value=lt.opacity):lt.isShaderMaterial&&(lt.transmission!==void 0&&(it.transmission&&(it.transmission.value=lt.transmission),it.transmissionSamplerMap&&St&&(it.transmissionSamplerMap.value=St?St.texture:null),it.transmissionSamplerSize&&St&&it.transmissionSamplerSize.value.set(St.width,St.height)),lt.uniformsNeedUpdate=!1)}}}function cO(pt,a,_e,rt){let it={},lt={},ft=[];const _t=_e.isWebGL2?pt.getParameter(pt.MAX_UNIFORM_BUFFER_BINDINGS):0;function St(Bt,Ot,Lt){const zt=Bt.value;if(Lt[Ot]===void 0){if(typeof zt=="number")Lt[Ot]=zt;else{const Jt=Array.isArray(zt)?zt:[zt],Ht=[];for(let $t=0;$t<Jt.length;$t++)Ht.push(Jt[$t].clone());Lt[Ot]=Ht}return!0}if(typeof zt=="number"){if(Lt[Ot]!==zt)return Lt[Ot]=zt,!0}else{const Jt=Array.isArray(Lt[Ot])?Lt[Ot]:[Lt[Ot]],Ht=Array.isArray(zt)?zt:[zt];for(let $t=0;$t<Jt.length;$t++){const rn=Jt[$t];if(rn.equals(Ht[$t])===!1)return rn.copy(Ht[$t]),!0}}return!1}function Et(Bt){const Ot={boundary:0,storage:0};return typeof Bt=="number"?(Ot.boundary=4,Ot.storage=4):Bt.isVector2?(Ot.boundary=8,Ot.storage=8):Bt.isVector3||Bt.isColor?(Ot.boundary=16,Ot.storage=12):Bt.isVector4?(Ot.boundary=16,Ot.storage=16):Bt.isMatrix3?(Ot.boundary=48,Ot.storage=48):Bt.isMatrix4?(Ot.boundary=64,Ot.storage=64):Bt.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",Bt),Ot}function Tt(Bt){const Ot=Bt.target;Ot.removeEventListener("dispose",Tt);const Lt=ft.indexOf(Ot.__bindingPointIndex);ft.splice(Lt,1),pt.deleteBuffer(it[Ot.id]),delete it[Ot.id],delete lt[Ot.id]}return{bind:function(Bt,Ot){const Lt=Ot.program;rt.uniformBlockBinding(Bt,Lt)},update:function(Bt,Ot){let Lt=it[Bt.id];Lt===void 0&&(function(Ht){const $t=Ht.uniforms;let rn=0,cn=0;for(let Rn=0,Cn=$t.length;Rn<Cn;Rn++){const Tn=$t[Rn],Gn={boundary:0,storage:0},nr=Array.isArray(Tn.value)?Tn.value:[Tn.value];for(let Qn=0,ur=nr.length;Qn<ur;Qn++){const Wn=Et(nr[Qn]);Gn.boundary+=Wn.boundary,Gn.storage+=Wn.storage}Tn.__data=new Float32Array(Gn.storage/Float32Array.BYTES_PER_ELEMENT),Tn.__offset=rn,Rn>0&&(cn=rn%16,cn!==0&&16-cn-Gn.boundary<0&&(rn+=16-cn,Tn.__offset=rn)),rn+=Gn.storage}cn=rn%16,cn>0&&(rn+=16-cn),Ht.__size=rn,Ht.__cache={}}(Bt),Lt=function(Ht){const $t=function(){for(let Cn=0;Cn<_t;Cn++)if(ft.indexOf(Cn)===-1)return ft.push(Cn),Cn;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();Ht.__bindingPointIndex=$t;const rn=pt.createBuffer(),cn=Ht.__size,Rn=Ht.usage;return pt.bindBuffer(pt.UNIFORM_BUFFER,rn),pt.bufferData(pt.UNIFORM_BUFFER,cn,Rn),pt.bindBuffer(pt.UNIFORM_BUFFER,null),pt.bindBufferBase(pt.UNIFORM_BUFFER,$t,rn),rn}(Bt),it[Bt.id]=Lt,Bt.addEventListener("dispose",Tt));const zt=Ot.program;rt.updateUBOMapping(Bt,zt);const Jt=a.render.frame;lt[Bt.id]!==Jt&&(function(Ht){const $t=it[Ht.id],rn=Ht.uniforms,cn=Ht.__cache;pt.bindBuffer(pt.UNIFORM_BUFFER,$t);for(let Rn=0,Cn=rn.length;Rn<Cn;Rn++){const Tn=rn[Rn];if(St(Tn,Rn,cn)===!0){const Gn=Tn.__offset,nr=Array.isArray(Tn.value)?Tn.value:[Tn.value];let Qn=0;for(let ur=0;ur<nr.length;ur++){const Wn=nr[ur],Ar=Et(Wn);typeof Wn=="number"?(Tn.__data[0]=Wn,pt.bufferSubData(pt.UNIFORM_BUFFER,Gn+Qn,Tn.__data)):Wn.isMatrix3?(Tn.__data[0]=Wn.elements[0],Tn.__data[1]=Wn.elements[1],Tn.__data[2]=Wn.elements[2],Tn.__data[3]=Wn.elements[0],Tn.__data[4]=Wn.elements[3],Tn.__data[5]=Wn.elements[4],Tn.__data[6]=Wn.elements[5],Tn.__data[7]=Wn.elements[0],Tn.__data[8]=Wn.elements[6],Tn.__data[9]=Wn.elements[7],Tn.__data[10]=Wn.elements[8],Tn.__data[11]=Wn.elements[0]):(Wn.toArray(Tn.__data,Qn),Qn+=Ar.storage/Float32Array.BYTES_PER_ELEMENT)}pt.bufferSubData(pt.UNIFORM_BUFFER,Gn,Tn.__data)}}pt.bindBuffer(pt.UNIFORM_BUFFER,null)}(Bt),lt[Bt.id]=Jt)},dispose:function(){for(const Bt in it)pt.deleteBuffer(it[Bt]);ft=[],it={},lt={}}}}function uO(){const pt=Vy("canvas");return pt.style.display="block",pt}class Ux{constructor(a={}){const{canvas:_e=uO(),context:rt=null,depth:it=!0,stencil:lt=!0,alpha:ft=!1,antialias:_t=!1,premultipliedAlpha:St=!0,preserveDrawingBuffer:Et=!1,powerPreference:Tt="default",failIfMajorPerformanceCaveat:Bt=!1}=a;let Ot;this.isWebGLRenderer=!0,Ot=rt!==null?rt.getContextAttributes().alpha:ft;let Lt=null,zt=null;const Jt=[],Ht=[];this.domElement=_e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=Gs,this.useLegacyLights=!0,this.toneMapping=Ks,this.toneMappingExposure=1,this.userData={},this.onContextLost=()=>{},this.onContextRestore=()=>{},this.onContextCreationError=()=>{};const $t=this;let rn=!1,cn=0,Rn=0,Cn=null,Tn=-1,Gn=null;const nr=new Cl,Qn=new Cl;let ur=null,Wn=_e.width,Ar=_e.height,Cr=1,Wr=null,is=null;const Qr=new Cl(0,0,Wn,Ar),Pr=new Cl(0,0,Wn,Ar);let Jr=!1;const rs=new Y1;let vr=!1,Br=!1,es=null;const zr=new Ao,as=new Nn,ro={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Hn(){return Cn===null?Cr:1}let Dn,pr,$n,Fn,ir,xn,qn,Xn,Tr,Er,Or,ss,ys,Fs,gs,uo,lo,js,Wl,am,So,Al,Il,by,wr=rt;function xA(jn,Sr){for(let Lr=0;Lr<jn.length;Lr++){const Dr=jn[Lr],Xr=_e.getContext(Dr,Sr);if(Xr!==null)return Xr}return null}try{const jn={alpha:!0,depth:it,stencil:lt,antialias:_t,premultipliedAlpha:St,preserveDrawingBuffer:Et,powerPreference:Tt,failIfMajorPerformanceCaveat:Bt};if("setAttribute"in _e&&_e.setAttribute("data-engine",`three.js r${tt}`),_e.addEventListener("webglcontextlost",LE,!1),_e.addEventListener("webglcontextrestored",u1,!1),_e.addEventListener("webglcontextcreationerror",NE,!1),wr===null){const Sr=["webgl2","webgl","experimental-webgl"];if($t.isWebGL1Renderer===!0&&Sr.shift(),wr=xA(Sr,jn),wr===null)throw xA(Sr)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}wr.getShaderPrecisionFormat===void 0&&(wr.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(jn){throw console.error("THREE.WebGLRenderer: "+jn.message),jn}function BE(){Dn=new XS(wr),pr=new HT(wr,Dn,a),Dn.init(pr),Al=new iC(wr,Dn,pr),$n=new L2(wr,Dn,pr),Fn=new Lv(wr),ir=new nu,xn=new Bo(wr,Dn,$n,ir,pr,Al,Fn),qn=new KD($t),Xn=new I_($t),Tr=new h2(wr,pr),Il=new YD(wr,Dn,Tr,pr),Er=new JD(wr,Tr,Fn,Il),Or=new m2(wr,Er,Tr,Fn),Wl=new YS(wr,pr,xn),uo=new d2(ir),ss=new tC($t,qn,Xn,Dn,pr,Il,uo),ys=new Ql($t,ir),Fs=new nC,gs=new rC(Dn,pr),js=new XD($t,qn,Xn,$n,Or,Ot,St),lo=new B2($t,Or,pr),by=new cO(wr,Fn,pr,$n),am=new $D(wr,Dn,Fn,pr),So=new ZD(wr,Dn,Fn,pr),Fn.programs=ss.programs,$t.capabilities=pr,$t.extensions=Dn,$t.properties=ir,$t.renderLists=Fs,$t.shadowMap=lo,$t.state=$n,$t.info=Fn,$t.background=js,$t.cubemaps=qn,$t.cubeuvmaps=Xn,$t.materials=ys}BE();const Qm=new Gp($t,wr);function LE(jn){jn.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),rn=!0,$t.onContextLost(jn)}function u1(){console.log("THREE.WebGLRenderer: Context Restored."),rn=!1;const jn=$t.info?$t.info.autoReset:void 0,Sr=lo.enabled,Lr=lo.autoUpdate,Dr=lo.needsUpdate,Xr=lo.type;BE(),$t.info&&jn!==void 0&&($t.info.autoReset=jn),lo.enabled=Sr,lo.autoUpdate=Lr,lo.needsUpdate=Dr,lo.type=Xr,$t.onContextRestore&&$t.onContextRestore(),console.log("restored")}function NE(jn){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",jn.statusMessage),$t.onContextCreationError(jn)}function SP(jn){const Sr=jn.target;Sr.removeEventListener("dispose",SP),function(Lr){(function(Dr){const Xr=ir.get(Dr).programs;Xr!==void 0&&(Xr.forEach(function(Es){ss.releaseProgram(Es)}),Dr.isShaderMaterial&&ss.releaseShaderCache(Dr))})(Lr),ir.remove(Lr)}(Sr)}this.xr=Qm,this.getContext=function(){return wr},this.getContextAttributes=function(){return wr.getContextAttributes()},this.forceContextLoss=function(){const jn=Dn.get("WEBGL_lose_context");jn&&jn.loseContext()},this.forceContextRestore=function(){const jn=Dn.get("WEBGL_lose_context");jn&&jn.restoreContext()},this.getPixelRatio=function(){return Cr},this.setPixelRatio=function(jn){jn!==void 0&&(Cr=jn,this.setSize(Wn,Ar,!1))},this.getSize=function(jn){return jn.set(Wn,Ar)},this.setSize=function(jn,Sr,Lr=!0){Qm.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Wn=jn,Ar=Sr,_e.width=Math.floor(jn*Cr),_e.height=Math.floor(Sr*Cr),Lr===!0&&(_e.style.width=jn+"px",_e.style.height=Sr+"px"),this.setViewport(0,0,jn,Sr))},this.getDrawingBufferSize=function(jn){return jn.set(Wn*Cr,Ar*Cr).floor()},this.setDrawingBufferSize=function(jn,Sr,Lr){Wn=jn,Ar=Sr,Cr=Lr,_e.width=Math.floor(jn*Lr),_e.height=Math.floor(Sr*Lr),this.setViewport(0,0,jn,Sr)},this.getCurrentViewport=function(jn){return jn.copy(nr)},this.getViewport=function(jn){return jn.copy(Qr)},this.setViewport=function(jn,Sr,Lr,Dr){jn.isVector4?Qr.set(jn.x,jn.y,jn.z,jn.w):Qr.set(jn,Sr,Lr,Dr),$n.viewport(nr.copy(Qr).multiplyScalar(Cr).floor())},this.getScissor=function(jn){return jn.copy(Pr)},this.setScissor=function(jn,Sr,Lr,Dr){jn.isVector4?Pr.set(jn.x,jn.y,jn.z,jn.w):Pr.set(jn,Sr,Lr,Dr),$n.scissor(Qn.copy(Pr).multiplyScalar(Cr).floor())},this.getScissorTest=function(){return Jr},this.setScissorTest=function(jn){$n.setScissorTest(Jr=jn)},this.setOpaqueSort=function(jn){Wr=jn},this.setTransparentSort=function(jn){is=jn},this.getClearColor=function(jn){return jn.copy(js.getClearColor())},this.setClearColor=function(){js.setClearColor.apply(js,arguments)},this.getClearAlpha=function(){return js.getClearAlpha()},this.setClearAlpha=function(){js.setClearAlpha.apply(js,arguments)},this.clear=function(jn=!0,Sr=!0,Lr=!0){let Dr=0;jn&&(Dr|=wr.COLOR_BUFFER_BIT),Sr&&(Dr|=wr.DEPTH_BUFFER_BIT),Lr&&(Dr|=wr.STENCIL_BUFFER_BIT),wr.clear(Dr)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){_e.removeEventListener("webglcontextlost",LE,!1),_e.removeEventListener("webglcontextrestored",u1,!1),_e.removeEventListener("webglcontextcreationerror",NE,!1),Fs.dispose(),gs.dispose(),ir.dispose(),qn.dispose(),Xn.dispose(),Or.dispose(),Il.dispose(),by.dispose(),ss.dispose(),Qm.dispose(),Qm.removeEventListener("sessionstart",qC),Qm.removeEventListener("sessionend",Wv),es&&(es.dispose(),es=null),pv.stop()},this.renderBufferDirect=function(jn,Sr,Lr,Dr,Xr,Es){Sr===null&&(Sr=ro);const ba=Xr.isMesh&&Xr.matrixWorld.determinant()<0,Zs=function(tp,T0,fp,fo,np){T0.isScene!==!0&&(T0=ro),xn.resetTextureUnits();const XM=T0.fog,TP=fo.isMeshStandardMaterial?T0.environment:null,MP=Cn===null?$t.outputColorSpace:Cn.isXRRenderTarget===!0||Cn.texture.colorSpace&&Cn.texture.colorSpace!==Gs?Cn.texture.colorSpace:yo,M0=(fo.isMeshStandardMaterial?Xn:qn).get(fo.envMap||TP),IP=fo.vertexColors===!0&&!!fp.attributes.color&&fp.attributes.color.itemSize===4,YM=!!fo.normalMap&&!!fp.attributes.tangent,$M=!!fp.morphAttributes.position,PP=!!fp.morphAttributes.normal,RP=!!fp.morphAttributes.color,Fw=fo.toneMapped?$t.toneMapping:Ks,KM=fp.morphAttributes.position||fp.morphAttributes.normal||fp.morphAttributes.color,$C=KM!==void 0?KM.length:0,$l=ir.get(fo),p1=zt.state.lights;if(vr===!0&&(Br===!0||tp!==Gn)){const Au=tp===Gn&&fo.id===Tn;uo.setState(fo,tp,Au)}let fv=!1;fo.version===$l.__version?$l.needsLights&&$l.lightsStateVersion!==p1.state.version||$l.outputColorSpace!==MP||np.isInstancedMesh&&$l.instancing===!1?fv=!0:np.isInstancedMesh||$l.instancing!==!0?np.isSkinnedMesh&&$l.skinning===!1?fv=!0:np.isSkinnedMesh||$l.skinning!==!0?$l.envMap!==M0||fo.fog===!0&&$l.fog!==XM?fv=!0:$l.numClippingPlanes===void 0||$l.numClippingPlanes===uo.numPlanes&&$l.numIntersection===uo.numIntersection?($l.vertexAlphas!==IP||$l.vertexTangents!==YM||$l.morphTargets!==$M||$l.morphNormals!==PP||$l.morphColors!==RP||$l.toneMapping!==Fw||pr.isWebGL2===!0&&$l.morphTargetsCount!==$C)&&(fv=!0):fv=!0:fv=!0:fv=!0:(fv=!0,$l.__version=fo.version);let wy=$l.currentProgram;fv===!0&&(wy=UE(fo,T0,np));let JM=!1,jw=!1,KC=!1;const yu=wy.getUniforms(),EA=$l.uniforms;if($n.useProgram(wy.program)&&(JM=!0,jw=!0,KC=!0),fo.id!==Tn&&(Tn=fo.id,jw=!0),JM||Gn!==tp){if(yu.setValue(wr,"projectionMatrix",tp.projectionMatrix),pr.logarithmicDepthBuffer&&yu.setValue(wr,"logDepthBufFC",2/(Math.log(tp.far+1)/Math.LN2)),Gn!==tp&&(Gn=tp,jw=!0,KC=!0),fo.isShaderMaterial||fo.isMeshPhongMaterial||fo.isMeshToonMaterial||fo.isMeshStandardMaterial||fo.envMap){const Au=yu.map.cameraPosition;Au!==void 0&&Au.setValue(wr,as.setFromMatrixPosition(tp.matrixWorld))}(fo.isMeshPhongMaterial||fo.isMeshToonMaterial||fo.isMeshLambertMaterial||fo.isMeshBasicMaterial||fo.isMeshStandardMaterial||fo.isShaderMaterial)&&yu.setValue(wr,"isOrthographic",tp.isOrthographicCamera===!0),(fo.isMeshPhongMaterial||fo.isMeshToonMaterial||fo.isMeshLambertMaterial||fo.isMeshBasicMaterial||fo.isMeshStandardMaterial||fo.isShaderMaterial||fo.isShadowMaterial||np.isSkinnedMesh)&&yu.setValue(wr,"viewMatrix",tp.matrixWorldInverse)}if(np.isSkinnedMesh){yu.setOptional(wr,np,"bindMatrix"),yu.setOptional(wr,np,"bindMatrixInverse");const Au=np.skeleton;Au&&(pr.floatVertexTextures?(Au.boneTexture===null&&Au.computeBoneTexture(),yu.setValue(wr,"boneTexture",Au.boneTexture,xn),yu.setValue(wr,"boneTextureSize",Au.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const ZM=fp.morphAttributes;var qv,Xv;(ZM.position!==void 0||ZM.normal!==void 0||ZM.color!==void 0&&pr.isWebGL2===!0)&&Wl.update(np,fp,wy),(jw||$l.receiveShadow!==np.receiveShadow)&&($l.receiveShadow=np.receiveShadow,yu.setValue(wr,"receiveShadow",np.receiveShadow)),fo.isMeshGouraudMaterial&&fo.envMap!==null&&(EA.envMap.value=M0,EA.flipEnvMap.value=M0.isCubeTexture&&M0.isRenderTargetTexture===!1?-1:1),jw&&(yu.setValue(wr,"toneMappingExposure",$t.toneMappingExposure),$l.needsLights&&(Xv=KC,(qv=EA).ambientLightColor.needsUpdate=Xv,qv.lightProbe.needsUpdate=Xv,qv.directionalLights.needsUpdate=Xv,qv.directionalLightShadows.needsUpdate=Xv,qv.pointLights.needsUpdate=Xv,qv.pointLightShadows.needsUpdate=Xv,qv.spotLights.needsUpdate=Xv,qv.spotLightShadows.needsUpdate=Xv,qv.rectAreaLights.needsUpdate=Xv,qv.hemisphereLights.needsUpdate=Xv),XM&&fo.fog===!0&&ys.refreshFogUniforms(EA,XM),ys.refreshMaterialUniforms(EA,fo,Cr,Ar,$t.userData.transmissionRenderTarget||es),sv.upload(wr,$l.uniformsList,EA,xn)),fo.isShaderMaterial&&fo.uniformsNeedUpdate===!0&&(sv.upload(wr,$l.uniformsList,EA,xn),fo.uniformsNeedUpdate=!1),fo.isSpriteMaterial&&yu.setValue(wr,"center",np.center),yu.setValue(wr,"modelViewMatrix",np.modelViewMatrix),yu.setValue(wr,"normalMatrix",np.normalMatrix),yu.setValue(wr,"modelMatrix",np.matrixWorld);const DP=fo.extraUniformsToUpload;if(DP&&Object.entries(DP).forEach(([Au,FE])=>yu.setValue(wr,Au,FE.value,xn)),fo.isShaderMaterial||fo.isRawShaderMaterial){const Au=fo.uniformsGroups;for(let FE=0,kP=Au.length;FE<kP;FE++)if(pr.isWebGL2){const eI=Au[FE];by.update(eI,wy),by.bind(eI,wy)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return wy}(jn,Sr,Lr,Dr,Xr);$n.setMaterial(Dr,ba);let Vo=Lr.index,Vl=1;Dr.wireframe===!0&&(Vo=Er.getWireframeAttribute(Lr),Vl=2);const $o=Lr.drawRange,Lo=Lr.attributes.position;let lm=$o.start*Vl,Wp=($o.start+$o.count)*Vl;Es!==null&&(lm=Math.max(lm,Es.start*Vl),Wp=Math.min(Wp,(Es.start+Es.count)*Vl)),Vo!==null?(lm=Math.max(lm,0),Wp=Math.min(Wp,Vo.count)):Lo!=null&&(lm=Math.max(lm,0),Wp=Math.min(Wp,Lo.count));const qu=Wp-lm;if(qu<0||qu===1/0)return;let Uw;Il.setup(Xr,Dr,Zs,Lr,Vo);let Cu=am;if(Vo!==null&&(Uw=Tr.get(Vo),Cu=So,Cu.setIndex(Uw)),Xr.isMesh)Dr.wireframe===!0?($n.setLineWidth(Dr.wireframeLinewidth*Hn()),Cu.setMode(wr.LINES)):Cu.setMode(wr.TRIANGLES);else if(Xr.isLine){let tp=Dr.linewidth;tp===void 0&&(tp=1),$n.setLineWidth(tp*Hn()),Xr.isLineSegments?Cu.setMode(wr.LINES):Xr.isLineLoop?Cu.setMode(wr.LINE_LOOP):Cu.setMode(wr.LINE_STRIP)}else Xr.isPoints?Cu.setMode(wr.POINTS):Xr.isSprite&&Cu.setMode(wr.TRIANGLES);if(Xr.isInstancedMesh)Cu.renderInstances(lm,qu,Xr.count);else if(Lr.isInstancedBufferGeometry){const tp=Lr._maxInstanceCount!==void 0?Lr._maxInstanceCount:1/0,T0=Math.min(Lr.instanceCount,tp);Cu.renderInstances(lm,qu,T0)}else Cu.render(lm,qu)},this.compile=function(jn,Sr){function Lr(Dr,Xr,Es){Dr.transparent===!0&&Dr.side===vn&&Dr.forceSinglePass===!1?(Dr.side=Gt,Dr.needsUpdate=!0,UE(Dr,Xr,Es),Dr.side=sn,Dr.needsUpdate=!0,UE(Dr,Xr,Es),Dr.side=vn):UE(Dr,Xr,Es)}zt=gs.get(jn),zt.init(),Ht.push(zt),jn.traverseVisible(function(Dr){Dr.isLight&&Dr.layers.test(Sr.layers)&&(zt.pushLight(Dr),Dr.castShadow&&zt.pushShadow(Dr))}),zt.setupLights($t.useLegacyLights),jn.traverse(function(Dr){const Xr=Dr.material;if(Xr)if(Array.isArray(Xr))for(let Es=0;Es<Xr.length;Es++)Lr(Xr[Es],jn,Dr);else Lr(Xr,jn,Dr)}),Ht.pop(),zt=null};let h1=null;function qC(){pv.stop()}function Wv(){pv.start()}const pv=new GT;function XC(jn,Sr,Lr,Dr){if(jn.visible===!1)return;if(jn.layers.test(Sr.layers)){if(jn.isGroup)Lr=jn.renderOrder;else if(jn.isLOD)jn.autoUpdate===!0&&jn.update(Sr);else if(jn.isLight)zt.pushLight(jn),jn.castShadow&&zt.pushShadow(jn);else if(jn.isSprite){if(!jn.frustumCulled||rs.intersectsSprite(jn)){Dr&&as.setFromMatrixPosition(jn.matrixWorld).applyMatrix4(zr);const Es=Or.update(jn),ba=jn.material;ba.visible&&Lt.push(jn,Es,ba,Lr,as.z,null)}}else if((jn.isMesh||jn.isLine||jn.isPoints)&&(!jn.frustumCulled||rs.intersectsObject(jn))){jn.isSkinnedMesh&&jn.skeleton.frame!==Fn.render.frame&&(jn.skeleton.update(),jn.skeleton.frame=Fn.render.frame);const Es=Or.update(jn),ba=jn.material;if(Dr&&(Es.boundingSphere===null&&Es.computeBoundingSphere(),as.copy(Es.boundingSphere.center).applyMatrix4(jn.matrixWorld).applyMatrix4(zr)),Array.isArray(ba)){const Zs=Es.groups;for(let Vo=0,Vl=Zs.length;Vo<Vl;Vo++){const $o=Zs[Vo],Lo=ba[$o.materialIndex];Lo&&Lo.visible&&Lt.push(jn,Es,Lo,Lr,as.z,$o)}}else ba.visible&&Lt.push(jn,Es,ba,Lr,as.z,null)}}const Xr=jn.children;for(let Es=0,ba=Xr.length;Es<ba;Es++)XC(Xr[Es],Sr,Lr,Dr)}function qM(jn,Sr,Lr,Dr){const Xr=jn.opaque,Es=jn.transmissive,ba=jn.transparent;if(zt.setupLightsView(Lr),vr===!0&&uo.setGlobalState($t.clippingPlanes,Lr),$t.userData.transmissionRender===void 0&&$t.userData.renderTransmissionPass!==!1&&Es.length>0&&function(Zs,Vo,Vl,$o){if(console.warn("three.js internal render transmission pass should not be called"),es===null){const qu=pr.isWebGL2;es=new _h(1024,1024,{generateMipmaps:!0,type:Dn.has("EXT_color_buffer_half_float")?Bs:sp,minFilter:Gl,samples:qu&&_t===!0?4:0})}const Lo=$t.getRenderTarget();$t.setRenderTarget(es),$t.clear();const lm=$t.toneMapping;$t.toneMapping=Ks,d1(Zs,Vl,$o),xn.updateMultisampleRenderTarget(es),xn.updateRenderTargetMipmap(es);let Wp=!1;for(let qu=0,Uw=Vo.length;qu<Uw;qu++){const Cu=Vo[qu],tp=Cu.object,T0=Cu.geometry,fp=Cu.material,fo=Cu.group;if(fp.side===vn&&tp.layers.test($o.layers)){const np=fp.side;fp.side=Gt,fp.needsUpdate=!0,CP(tp,Vl,$o,T0,fp,fo),fp.side=np,fp.needsUpdate=!0,Wp=!0}}Wp===!0&&(xn.updateMultisampleRenderTarget(es),xn.updateRenderTargetMipmap(es)),$t.setRenderTarget(Lo),$t.toneMapping=lm}([...Xr,...ba],Es,Sr,Lr),Dr&&$n.viewport(nr.copy(Dr)),$t.userData.opaqueRender!==!1&&Xr.length>0&&d1(Xr,Sr,Lr),$t.userData.transparentRender!==!1&&ba.length>0&&d1(ba,Sr,Lr),$t.userData.transmissionRender!==!1&&Es.length>0){es||(es=new _h(1,1));const Zs=($t.userData.transmissionRenderTarget||es).texture,Vo=pr.isWebGL2,Vl=Zs.generateMipmaps,$o=Zs.minFilter;Vo&&$t.userData.blurTransmissionTarget&&$t.userData.transmissionRenderTarget&&(Zs.generateMipmaps=!0,Zs.minFilter=Gl,Zs.needsUpdate=!0,xn.updateMultisampleRenderTarget($t.userData.transmissionRenderTarget),xn.updateRenderTargetMipmap($t.userData.transmissionRenderTarget)),d1(Es,Sr,Lr),Vo&&$t.userData.blurTransmissionTarget&&$t.userData.transmissionRenderTarget&&(Zs.generateMipmaps=Vl,Zs.minFilter=$o,Zs.needsUpdate=!0,xn.updateMultisampleRenderTarget($t.userData.transmissionRenderTarget),xn.updateRenderTargetMipmap($t.userData.transmissionRenderTarget))}$n.buffers.depth.setTest(!0),$n.buffers.depth.setMask(!0),$n.buffers.color.setMask(!0),$n.setPolygonOffset(!1)}function d1(jn,Sr,Lr){const Dr={...$t.userData};$t.userData.opaqueRender=void 0,$t.userData.transparentRender=void 0,$t.userData.transmissionRender=void 0,$t.userData.backgroundRender=void 0;const Xr=Sr.isScene===!0?Sr.overrideMaterial:null;for(let Es=0,ba=jn.length;Es<ba;Es++){const Zs=jn[Es],Vo=Zs.object,Vl=Zs.geometry,$o=Xr===null?Zs.material:Xr,Lo=Zs.group;Vo.layers.test(Lr.layers)&&CP(Vo,Sr,Lr,Vl,$o,Lo)}Object.assign($t.userData,Dr)}function CP(jn,Sr,Lr,Dr,Xr,Es){jn.onBeforeRender($t,Sr,Lr,Dr,Xr,Es),jn.modelViewMatrix.multiplyMatrices(Lr.matrixWorldInverse,jn.matrixWorld),jn.normalMatrix.getNormalMatrix(jn.modelViewMatrix),Xr.onBeforeRender($t,Sr,Lr,Dr,jn,Es),Xr.transparent===!0&&Xr.side===vn&&Xr.forceSinglePass===!1?(Xr.side=Gt,Xr.needsUpdate=!0,$t.renderBufferDirect(Lr,Sr,Dr,Xr,jn,Es),Xr.side=sn,Xr.needsUpdate=!0,$t.renderBufferDirect(Lr,Sr,Dr,Xr,jn,Es),Xr.side=vn):$t.renderBufferDirect(Lr,Sr,Dr,Xr,jn,Es),jn.onAfterRender($t,Sr,Lr,Dr,Xr,Es),Xr.onAfterRender($t,Sr,Lr,Dr,jn,Es)}function UE(jn,Sr,Lr){Sr.isScene!==!0&&(Sr=ro);const Dr=ir.get(jn),Xr=zt.state.lights,Es=zt.state.shadowsArray,ba=Xr.state.version,Zs=ss.getParameters(jn,Xr.state,Es,Sr,Lr),Vo=ss.getProgramCacheKey(Zs);let Vl=Dr.programs;Dr.environment=jn.isMeshStandardMaterial?Sr.environment:null,Dr.fog=Sr.fog,Dr.envMap=(jn.isMeshStandardMaterial?Xn:qn).get(jn.envMap||Dr.environment),Vl===void 0&&(jn.addEventListener("dispose",SP),Vl=new Map,Dr.programs=Vl);let $o=Vl.get(Vo);if($o!==void 0){if(Dr.currentProgram===$o&&Dr.lightsStateVersion===ba)return YC(jn,Zs),$o}else Zs.uniforms=ss.getUniforms(jn),jn.onBuild(Lr,Zs,$t),jn.onBeforeCompile(Zs,$t),$o=ss.acquireProgram(Zs,Vo),Vl.set(Vo,$o),Dr.uniforms=Zs.uniforms;const Lo=Dr.uniforms;(jn.isShaderMaterial||jn.isRawShaderMaterial)&&jn.clipping!==!0||(Lo.clippingPlanes=uo.uniform),YC(jn,Zs),Dr.needsLights=function(qu){return qu.isMeshLambertMaterial||qu.isMeshToonMaterial||qu.isMeshPhongMaterial||qu.isMeshStandardMaterial||qu.isShadowMaterial||qu.isShaderMaterial&&qu.lights===!0}(jn),Dr.lightsStateVersion=ba,Dr.needsLights&&(Lo.ambientLightColor.value=Xr.state.ambient,Lo.lightProbe.value=Xr.state.probe,Lo.directionalLights.value=Xr.state.directional,Lo.directionalLightShadows.value=Xr.state.directionalShadow,Lo.spotLights.value=Xr.state.spot,Lo.spotLightShadows.value=Xr.state.spotShadow,Lo.rectAreaLights.value=Xr.state.rectArea,Lo.ltc_1.value=Xr.state.rectAreaLTC1,Lo.ltc_2.value=Xr.state.rectAreaLTC2,Lo.pointLights.value=Xr.state.point,Lo.pointLightShadows.value=Xr.state.pointShadow,Lo.hemisphereLights.value=Xr.state.hemi,Lo.directionalShadowMap.value=Xr.state.directionalShadowMap,Lo.directionalShadowMatrix.value=Xr.state.directionalShadowMatrix,Lo.spotShadowMap.value=Xr.state.spotShadowMap,Lo.spotLightMatrix.value=Xr.state.spotLightMatrix,Lo.spotLightMap.value=Xr.state.spotLightMap,Lo.pointShadowMap.value=Xr.state.pointShadowMap,Lo.pointShadowMatrix.value=Xr.state.pointShadowMatrix);const lm=$o.getUniforms(),Wp=sv.seqWithValue(lm.seq,Lo);return Dr.currentProgram=$o,Dr.uniformsList=Wp,$o}function YC(jn,Sr){const Lr=ir.get(jn);Lr.outputColorSpace=Sr.outputColorSpace,Lr.instancing=Sr.instancing,Lr.skinning=Sr.skinning,Lr.morphTargets=Sr.morphTargets,Lr.morphNormals=Sr.morphNormals,Lr.morphColors=Sr.morphColors,Lr.morphTargetsCount=Sr.morphTargetsCount,Lr.numClippingPlanes=Sr.numClippingPlanes,Lr.numIntersection=Sr.numClipIntersection,Lr.vertexAlphas=Sr.vertexAlphas,Lr.vertexTangents=Sr.vertexTangents,Lr.toneMapping=Sr.toneMapping}pv.setAnimationLoop(function(jn){h1&&h1(jn)}),typeof self<"u"&&pv.setContext(self),this.setAnimationLoop=function(jn){h1=jn,Qm.setAnimationLoop(jn),jn===null?pv.stop():pv.start()},Qm.addEventListener("sessionstart",qC),Qm.addEventListener("sessionend",Wv),this.render=function(jn,Sr){if(Sr===void 0||Sr.isCamera===!0){if(rn!==!0){if(jn.matrixWorldAutoUpdate===!0&&jn.updateMatrixWorld(),Sr.parent===null&&Sr.matrixWorldAutoUpdate===!0&&Sr.updateMatrixWorld(),Qm.enabled===!0&&Qm.isPresenting===!0&&(Qm.cameraAutoUpdate===!0&&Qm.updateCamera(Sr),Sr=Qm.getCamera()),jn.isScene===!0&&jn.onBeforeRender($t,jn,Sr,Cn),zt=gs.get(jn,Ht.length),zt.init(),Ht.push(zt),zr.multiplyMatrices(Sr.projectionMatrix,Sr.matrixWorldInverse),rs.setFromProjectionMatrix(zr),Br=this.localClippingEnabled,vr=uo.init(this.clippingPlanes,Br),Lt=Fs.get(jn,Jt.length),Lt.init(),Jt.push(Lt),XC(jn,Sr,0,$t.sortObjects),Lt.finish(),$t.sortObjects===!0&&Lt.sort(Wr,is),$t.userData.shadowMapRender!==!1){vr===!0&&uo.beginShadows();const Lr=zt.state.shadowsArray;Lr.length>0&&lo.render(Lr,jn,Sr),vr===!0&&uo.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),$t.userData.backgroundRender!==!1&&js.render(Lt,jn),$t.userData.sceneRender!==!1)if(zt.setupLights($t.useLegacyLights),Sr.isArrayCamera){const Lr=Sr.cameras;for(let Dr=0,Xr=Lr.length;Dr<Xr;Dr++){const Es=Lr[Dr];qM(Lt,jn,Es,Es.viewport)}}else qM(Lt,jn,Sr);Cn!==null&&(xn.updateMultisampleRenderTarget(Cn),xn.updateRenderTargetMipmap(Cn)),jn.isScene===!0&&jn.onAfterRender($t,jn,Sr),Il.resetDefaultState(),Tn=-1,Gn=null,Ht.pop(),zt=Ht.length>0?Ht[Ht.length-1]:null,Jt.pop(),Lt=Jt.length>0?Jt[Jt.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return cn},this.getActiveMipmapLevel=function(){return Rn},this.getRenderTarget=function(){return Cn},this.setRenderTargetTextures=function(jn,Sr,Lr){ir.get(jn.texture).__webglTexture=Sr,ir.get(jn.depthTexture).__webglTexture=Lr;const Dr=ir.get(jn);Dr.__hasExternalTextures=!0,Dr.__hasExternalTextures&&(Dr.__autoAllocateDepthBuffer=Lr===void 0,Dr.__autoAllocateDepthBuffer||Dn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Dr.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(jn,Sr){const Lr=ir.get(jn);Lr.__webglFramebuffer=Sr,Lr.__useDefaultFramebuffer=Sr===void 0},this.setRenderTarget=function(jn,Sr=0,Lr=0){Cn=jn,cn=Sr,Rn=Lr;let Dr=!0,Xr=null,Es=!1,ba=!1;if(jn){const Zs=ir.get(jn);Zs.__useDefaultFramebuffer!==void 0?($n.bindFramebuffer(wr.FRAMEBUFFER,null),Dr=!1):Zs.__webglFramebuffer===void 0?xn.setupRenderTarget(jn):Zs.__hasExternalTextures&&xn.rebindTextures(jn,ir.get(jn.texture).__webglTexture,ir.get(jn.depthTexture).__webglTexture);const Vo=jn.texture;(Vo.isData3DTexture||Vo.isDataArrayTexture||Vo.isCompressedArrayTexture)&&(ba=!0);const Vl=ir.get(jn).__webglFramebuffer;jn.isWebGLCubeRenderTarget?(Xr=Vl[Sr],Es=!0):Xr=pr.isWebGL2&&jn.samples>0&&xn.useMultisampledRTT(jn)===!1?ir.get(jn).__webglMultisampledFramebuffer:Vl,nr.copy(jn.viewport),Qn.copy(jn.scissor),ur=jn.scissorTest}else nr.copy(Qr).multiplyScalar(Cr).floor(),Qn.copy(Pr).multiplyScalar(Cr).floor(),ur=Jr;if($n.bindFramebuffer(wr.FRAMEBUFFER,Xr)&&pr.drawBuffers&&Dr&&$n.drawBuffers(jn,Xr),$n.viewport(nr),$n.scissor(Qn),$n.setScissorTest(ur),Es){const Zs=ir.get(jn.texture);wr.framebufferTexture2D(wr.FRAMEBUFFER,wr.COLOR_ATTACHMENT0,wr.TEXTURE_CUBE_MAP_POSITIVE_X+Sr,Zs.__webglTexture,Lr)}else if(ba){const Zs=ir.get(jn.texture),Vo=Sr||0;wr.framebufferTextureLayer(wr.FRAMEBUFFER,wr.COLOR_ATTACHMENT0,Zs.__webglTexture,Lr||0,Vo)}Tn=-1},this.readRenderTargetPixels=function(jn,Sr,Lr,Dr,Xr,Es,ba){if(!jn||!jn.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Zs=ir.get(jn).__webglFramebuffer;if(jn.isWebGLCubeRenderTarget&&ba!==void 0&&(Zs=Zs[ba]),Zs){$n.bindFramebuffer(wr.FRAMEBUFFER,Zs);try{const Vo=jn.texture,Vl=Vo.format,$o=Vo.type;if(Vl!==Ns&&Al.convert(Vl)!==wr.getParameter(wr.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Lo=$o===Bs&&(Dn.has("EXT_color_buffer_half_float")||pr.isWebGL2&&Dn.has("EXT_color_buffer_float"));if(!($o===sp||Al.convert($o)===wr.getParameter(wr.IMPLEMENTATION_COLOR_READ_TYPE)||$o===ju&&(pr.isWebGL2||Dn.has("OES_texture_float")||Dn.has("WEBGL_color_buffer_float"))||Lo))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Sr>=0&&Sr<=jn.width-Dr&&Lr>=0&&Lr<=jn.height-Xr&&wr.readPixels(Sr,Lr,Dr,Xr,Al.convert(Vl),Al.convert($o),Es)}finally{const Vo=Cn?ir.get(Cn).__webglFramebuffer:null;$n.bindFramebuffer(wr.FRAMEBUFFER,Vo)}}},this.copyFramebufferToTexture=function(jn,Sr,Lr=0){const Dr=Math.pow(2,-Lr),Xr=Math.floor(Sr.image.width*Dr),Es=Math.floor(Sr.image.height*Dr);xn.setTexture2D(Sr,0),wr.copyTexSubImage2D(wr.TEXTURE_2D,Lr,0,0,jn.x,jn.y,Xr,Es),$n.unbindTexture()},this.copyTextureToTexture=function(jn,Sr,Lr,Dr=0){const Xr=Sr.image.width,Es=Sr.image.height,ba=Al.convert(Lr.format),Zs=Al.convert(Lr.type);xn.setTexture2D(Lr,0),wr.pixelStorei(wr.UNPACK_FLIP_Y_WEBGL,Lr.flipY),wr.pixelStorei(wr.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Lr.premultiplyAlpha),wr.pixelStorei(wr.UNPACK_ALIGNMENT,Lr.unpackAlignment),Sr.isDataTexture?wr.texSubImage2D(wr.TEXTURE_2D,Dr,jn.x,jn.y,Xr,Es,ba,Zs,Sr.image.data):Sr.isCompressedTexture?wr.compressedTexSubImage2D(wr.TEXTURE_2D,Dr,jn.x,jn.y,Sr.mipmaps[0].width,Sr.mipmaps[0].height,ba,Sr.mipmaps[0].data):wr.texSubImage2D(wr.TEXTURE_2D,Dr,jn.x,jn.y,ba,Zs,Sr.image),Dr===0&&Lr.generateMipmaps&&wr.generateMipmap(wr.TEXTURE_2D),$n.unbindTexture()},this.copyTextureToTexture3D=function(jn,Sr,Lr,Dr,Xr=0){if($t.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Es=jn.max.x-jn.min.x+1,ba=jn.max.y-jn.min.y+1,Zs=jn.max.z-jn.min.z+1,Vo=Al.convert(Dr.format),Vl=Al.convert(Dr.type);let $o;if(Dr.isData3DTexture)xn.setTexture3D(Dr,0),$o=wr.TEXTURE_3D;else{if(!Dr.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");xn.setTexture2DArray(Dr,0),$o=wr.TEXTURE_2D_ARRAY}wr.pixelStorei(wr.UNPACK_FLIP_Y_WEBGL,Dr.flipY),wr.pixelStorei(wr.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Dr.premultiplyAlpha),wr.pixelStorei(wr.UNPACK_ALIGNMENT,Dr.unpackAlignment);const Lo=wr.getParameter(wr.UNPACK_ROW_LENGTH),lm=wr.getParameter(wr.UNPACK_IMAGE_HEIGHT),Wp=wr.getParameter(wr.UNPACK_SKIP_PIXELS),qu=wr.getParameter(wr.UNPACK_SKIP_ROWS),Uw=wr.getParameter(wr.UNPACK_SKIP_IMAGES),Cu=Lr.isCompressedTexture?Lr.mipmaps[0]:Lr.image;wr.pixelStorei(wr.UNPACK_ROW_LENGTH,Cu.width),wr.pixelStorei(wr.UNPACK_IMAGE_HEIGHT,Cu.height),wr.pixelStorei(wr.UNPACK_SKIP_PIXELS,jn.min.x),wr.pixelStorei(wr.UNPACK_SKIP_ROWS,jn.min.y),wr.pixelStorei(wr.UNPACK_SKIP_IMAGES,jn.min.z),Lr.isDataTexture||Lr.isData3DTexture?wr.texSubImage3D($o,Xr,Sr.x,Sr.y,Sr.z,Es,ba,Zs,Vo,Vl,Cu.data):Lr.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),wr.compressedTexSubImage3D($o,Xr,Sr.x,Sr.y,Sr.z,Es,ba,Zs,Vo,Cu.data)):wr.texSubImage3D($o,Xr,Sr.x,Sr.y,Sr.z,Es,ba,Zs,Vo,Vl,Cu),wr.pixelStorei(wr.UNPACK_ROW_LENGTH,Lo),wr.pixelStorei(wr.UNPACK_IMAGE_HEIGHT,lm),wr.pixelStorei(wr.UNPACK_SKIP_PIXELS,Wp),wr.pixelStorei(wr.UNPACK_SKIP_ROWS,qu),wr.pixelStorei(wr.UNPACK_SKIP_IMAGES,Uw),Xr===0&&Dr.generateMipmaps&&wr.generateMipmap($o),$n.unbindTexture()},this.initTexture=function(jn){jn.isCubeTexture?xn.setTextureCube(jn,0):jn.isData3DTexture?xn.setTexture3D(jn,0):jn.isDataArrayTexture||jn.isCompressedArrayTexture?xn.setTexture2DArray(jn,0):xn.setTexture2D(jn,0),$n.unbindTexture()},this.resetState=function(){cn=0,Rn=0,Cn=null,$n.reset(),Il.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(a){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!a}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Gs?gu:A_}set outputEncoding(a){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=a===gu?Gs:yo}}class oC extends Ux{}oC.prototype.isWebGL1Renderer=!0;class yw{constructor(a,_e=25e-5){this.isFogExp2=!0,this.name="",this.color=new ps(a),this.density=_e}clone(){return new yw(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Aw{constructor(a,_e=1,rt=1e3){this.isFog=!0,this.name="",this.color=new ps(a),this.near=_e,this.far=rt}clone(){return new Aw(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class D_ extends ga{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(a,_e){return super.copy(a,_e),a.background!==null&&(this.background=a.background.clone()),a.environment!==null&&(this.environment=a.environment.clone()),a.fog!==null&&(this.fog=a.fog.clone()),this.backgroundBlurriness=a.backgroundBlurriness,this.backgroundIntensity=a.backgroundIntensity,a.overrideMaterial!==null&&(this.overrideMaterial=a.overrideMaterial.clone()),this.matrixAutoUpdate=a.matrixAutoUpdate,this}toJSON(a){const _e=super.toJSON(a);return this.fog!==null&&(_e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(_e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(_e.object.backgroundIntensity=this.backgroundIntensity),_e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(a){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=a}}class Am{constructor(a,_e){this.isInterleavedBuffer=!0,this.array=a,this.stride=_e,this.count=a!==void 0?a.length/_e:0,this.usage=w_,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=mm()}onUploadCallback(){}set needsUpdate(a){a===!0&&this.version++}setUsage(a){return this.usage=a,this}copy(a){return this.array=new a.array.constructor(a.array),this.count=a.count,this.stride=a.stride,this.usage=a.usage,this}copyAt(a,_e,rt){a*=this.stride,rt*=_e.stride;for(let it=0,lt=this.stride;it<lt;it++)this.array[a+it]=_e.array[rt+it];return this}set(a,_e=0){return this.array.set(a,_e),this}clone(a){a.arrayBuffers===void 0&&(a.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=mm()),a.arrayBuffers[this.array.buffer._uuid]===void 0&&(a.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const _e=new this.array.constructor(a.arrayBuffers[this.array.buffer._uuid]),rt=new this.constructor(_e,this.stride);return rt.setUsage(this.usage),rt}onUpload(a){return this.onUploadCallback=a,this}toJSON(a){return a.arrayBuffers===void 0&&(a.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=mm()),a.arrayBuffers[this.array.buffer._uuid]===void 0&&(a.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Tp=new Nn;class oy{constructor(a,_e,rt,it=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=a,this.itemSize=_e,this.offset=rt,this.normalized=it}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(a){this.data.needsUpdate=a}applyMatrix4(a){for(let _e=0,rt=this.data.count;_e<rt;_e++)Tp.fromBufferAttribute(this,_e),Tp.applyMatrix4(a),this.setXYZ(_e,Tp.x,Tp.y,Tp.z);return this}applyNormalMatrix(a){for(let _e=0,rt=this.count;_e<rt;_e++)Tp.fromBufferAttribute(this,_e),Tp.applyNormalMatrix(a),this.setXYZ(_e,Tp.x,Tp.y,Tp.z);return this}transformDirection(a){for(let _e=0,rt=this.count;_e<rt;_e++)Tp.fromBufferAttribute(this,_e),Tp.transformDirection(a),this.setXYZ(_e,Tp.x,Tp.y,Tp.z);return this}setX(a,_e){return this.normalized&&(_e=Ro(_e,this.array)),this.data.array[a*this.data.stride+this.offset]=_e,this}setY(a,_e){return this.normalized&&(_e=Ro(_e,this.array)),this.data.array[a*this.data.stride+this.offset+1]=_e,this}setZ(a,_e){return this.normalized&&(_e=Ro(_e,this.array)),this.data.array[a*this.data.stride+this.offset+2]=_e,this}setW(a,_e){return this.normalized&&(_e=Ro(_e,this.array)),this.data.array[a*this.data.stride+this.offset+3]=_e,this}getX(a){let _e=this.data.array[a*this.data.stride+this.offset];return this.normalized&&(_e=km(_e,this.array)),_e}getY(a){let _e=this.data.array[a*this.data.stride+this.offset+1];return this.normalized&&(_e=km(_e,this.array)),_e}getZ(a){let _e=this.data.array[a*this.data.stride+this.offset+2];return this.normalized&&(_e=km(_e,this.array)),_e}getW(a){let _e=this.data.array[a*this.data.stride+this.offset+3];return this.normalized&&(_e=km(_e,this.array)),_e}setXY(a,_e,rt){return a=a*this.data.stride+this.offset,this.normalized&&(_e=Ro(_e,this.array),rt=Ro(rt,this.array)),this.data.array[a+0]=_e,this.data.array[a+1]=rt,this}setXYZ(a,_e,rt,it){return a=a*this.data.stride+this.offset,this.normalized&&(_e=Ro(_e,this.array),rt=Ro(rt,this.array),it=Ro(it,this.array)),this.data.array[a+0]=_e,this.data.array[a+1]=rt,this.data.array[a+2]=it,this}setXYZW(a,_e,rt,it,lt){return a=a*this.data.stride+this.offset,this.normalized&&(_e=Ro(_e,this.array),rt=Ro(rt,this.array),it=Ro(it,this.array),lt=Ro(lt,this.array)),this.data.array[a+0]=_e,this.data.array[a+1]=rt,this.data.array[a+2]=it,this.data.array[a+3]=lt,this}clone(a){if(a===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const _e=[];for(let rt=0;rt<this.count;rt++){const it=rt*this.data.stride+this.offset;for(let lt=0;lt<this.itemSize;lt++)_e.push(this.data.array[it+lt])}return new Hl(new this.array.constructor(_e),this.itemSize,this.normalized)}return a.interleavedBuffers===void 0&&(a.interleavedBuffers={}),a.interleavedBuffers[this.data.uuid]===void 0&&(a.interleavedBuffers[this.data.uuid]=this.data.clone(a)),new oy(a.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(a){if(a===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const _e=[];for(let rt=0;rt<this.count;rt++){const it=rt*this.data.stride+this.offset;for(let lt=0;lt<this.itemSize;lt++)_e.push(this.data.array[it+lt])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:_e,normalized:this.normalized}}return a.interleavedBuffers===void 0&&(a.interleavedBuffers={}),a.interleavedBuffers[this.data.uuid]===void 0&&(a.interleavedBuffers[this.data.uuid]=this.data.toJSON(a)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class oM extends cp{constructor(a){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ps(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.rotation=a.rotation,this.sizeAttenuation=a.sizeAttenuation,this.fog=a.fog,this}}let k_;const bw=new Nn,iA=new Nn,sA=new Nn,oA=new Nr,aE=new Nr,N2=new Ao,aC=new Nn,lE=new Nn,cE=new Nn,Fx=new Nr,lC=new Nr,cC=new Nr;class ay extends ga{constructor(a){if(super(),this.isSprite=!0,this.type="Sprite",k_===void 0){k_=new Kt;const _e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),rt=new Am(_e,5);k_.setIndex([0,1,2,0,2,3]),k_.setAttribute("position",new oy(rt,3,0,!1)),k_.setAttribute("uv",new oy(rt,2,3,!1))}this.geometry=k_,this.material=a!==void 0?a:new oM,this.center=new Nr(.5,.5)}raycast(a,_e){a.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),iA.setFromMatrixScale(this.matrixWorld),N2.copy(a.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(a.camera.matrixWorldInverse,this.matrixWorld),sA.setFromMatrixPosition(this.modelViewMatrix),a.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&iA.multiplyScalar(-sA.z);const rt=this.material.rotation;let it,lt;rt!==0&&(lt=Math.cos(rt),it=Math.sin(rt));const ft=this.center;uE(aC.set(-.5,-.5,0),sA,ft,iA,it,lt),uE(lE.set(.5,-.5,0),sA,ft,iA,it,lt),uE(cE.set(.5,.5,0),sA,ft,iA,it,lt),Fx.set(0,0),lC.set(1,0),cC.set(1,1);let _t=a.ray.intersectTriangle(aC,lE,cE,!1,bw);if(_t===null&&(uE(lE.set(-.5,.5,0),sA,ft,iA,it,lt),lC.set(0,1),_t=a.ray.intersectTriangle(aC,cE,lE,!1,bw),_t===null))return;const St=a.ray.origin.distanceTo(bw);St<a.near||St>a.far||_e.push({distance:St,point:bw.clone(),uv:Du.getInterpolation(bw,aC,lE,cE,Fx,lC,cC,new Nr),face:null,object:this})}copy(a,_e){return super.copy(a,_e),a.center!==void 0&&this.center.copy(a.center),this.material=a.material,this}}function uE(pt,a,_e,rt,it,lt){oA.subVectors(pt,_e).addScalar(.5).multiply(rt),it!==void 0?(aE.x=lt*oA.x-it*oA.y,aE.y=it*oA.x+lt*oA.y):aE.copy(oA),pt.copy(a),pt.x+=aE.x,pt.y+=aE.y,pt.applyMatrix4(N2)}const u_=new Nn,h_=new Nn;class jx extends ga{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(a){super.copy(a,!1);const _e=a.levels;for(let rt=0,it=_e.length;rt<it;rt++){const lt=_e[rt];this.addLevel(lt.object.clone(),lt.distance,lt.hysteresis)}return this.autoUpdate=a.autoUpdate,this}addLevel(a,_e=0,rt=0){_e=Math.abs(_e);const it=this.levels;let lt;for(lt=0;lt<it.length&&!(_e<it[lt].distance);lt++);return it.splice(lt,0,{distance:_e,hysteresis:rt,object:a}),this.add(a),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(a){const _e=this.levels;if(_e.length>0){let rt,it;for(rt=1,it=_e.length;rt<it;rt++){let lt=_e[rt].distance;if(_e[rt].object.visible&&(lt-=lt*_e[rt].hysteresis),a<lt)break}return _e[rt-1].object}return null}raycast(a,_e){if(this.levels.length>0){u_.setFromMatrixPosition(this.matrixWorld);const rt=a.ray.origin.distanceTo(u_);this.getObjectForDistance(rt).raycast(a,_e)}}update(a){const _e=this.levels;if(_e.length>1){u_.setFromMatrixPosition(a.matrixWorld),h_.setFromMatrixPosition(this.matrixWorld);const rt=u_.distanceTo(h_)/a.zoom;let it,lt;for(_e[0].object.visible=!0,it=1,lt=_e.length;it<lt;it++){let ft=_e[it].distance;if(_e[it].object.visible&&(ft-=ft*_e[it].hysteresis),!(rt>=ft))break;_e[it-1].object.visible=!1,_e[it].object.visible=!0}for(this._currentLevel=it-1;it<lt;it++)_e[it].object.visible=!1}}toJSON(a){const _e=super.toJSON(a);this.autoUpdate===!1&&(_e.object.autoUpdate=!1),_e.object.levels=[];const rt=this.levels;for(let it=0,lt=rt.length;it<lt;it++){const ft=rt[it];_e.object.levels.push({object:ft.object.uuid,distance:ft.distance,hysteresis:ft.hysteresis})}return _e}}const uC=new Nn,Nm=new Cl,U2=new Cl,hO=new Nn,hC=new Ao,ww=new Nn;class d_ extends hp{constructor(a,_e){super(a,_e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ao,this.bindMatrixInverse=new Ao,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const a=this.geometry;this.boundingBox===null&&(this.boundingBox=new E_),this.boundingBox.makeEmpty();const _e=a.getAttribute("position");for(let rt=0;rt<_e.count;rt++)ww.fromBufferAttribute(_e,rt),this.applyBoneTransform(rt,ww),this.boundingBox.expandByPoint(ww)}computeBoundingSphere(){const a=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new s_),this.boundingSphere.makeEmpty();const _e=a.getAttribute("position");for(let rt=0;rt<_e.count;rt++)ww.fromBufferAttribute(_e,rt),this.applyBoneTransform(rt,ww),this.boundingSphere.expandByPoint(ww)}copy(a,_e){return super.copy(a,_e),this.bindMode=a.bindMode,this.bindMatrix.copy(a.bindMatrix),this.bindMatrixInverse.copy(a.bindMatrixInverse),this.skeleton=a.skeleton,this}getVertexPosition(a,_e){return super.getVertexPosition(a,_e),this.applyBoneTransform(a,_e),_e}bind(a,_e){this.skeleton=a,_e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),_e=this.matrixWorld),this.bindMatrix.copy(_e),this.bindMatrixInverse.copy(_e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const a=new Cl,_e=this.geometry.attributes.skinWeight;for(let rt=0,it=_e.count;rt<it;rt++){a.fromBufferAttribute(_e,rt);const lt=1/a.manhattanLength();lt!==1/0?a.multiplyScalar(lt):a.set(1,0,0,0),_e.setXYZW(rt,a.x,a.y,a.z,a.w)}}updateMatrixWorld(a){super.updateMatrixWorld(a),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(a,_e){const rt=this.skeleton,it=this.geometry;Nm.fromBufferAttribute(it.attributes.skinIndex,a),U2.fromBufferAttribute(it.attributes.skinWeight,a),uC.copy(_e).applyMatrix4(this.bindMatrix),_e.set(0,0,0);for(let lt=0;lt<4;lt++){const ft=U2.getComponent(lt);if(ft!==0){const _t=Nm.getComponent(lt);hC.multiplyMatrices(rt.bones[_t].matrixWorld,rt.boneInverses[_t]),_e.addScaledVector(hO.copy(uC).applyMatrix4(hC),ft)}}return _e.applyMatrix4(this.bindMatrixInverse)}boneTransform(a,_e){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(a,_e)}}class Hp extends ga{constructor(){super(),this.isBone=!0,this.type="Bone"}}class zx extends Yl{constructor(a=null,_e=1,rt=1,it,lt,ft,_t,St,Et=Uo,Tt=Uo,Bt,Ot){super(null,ft,_t,St,Et,Tt,it,lt,Bt,Ot),this.isDataTexture=!0,this.image={data:a,width:_e,height:rt},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const F2=new Ao,Vx=new Ao;class aA{constructor(a=[],_e=[]){this.uuid=mm(),this.bones=a.slice(0),this.boneInverses=_e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const a=this.bones,_e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*a.length),_e.length===0)this.calculateInverses();else if(a.length!==_e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let rt=0,it=this.bones.length;rt<it;rt++)this.boneInverses.push(new Ao)}}calculateInverses(){this.boneInverses.length=0;for(let a=0,_e=this.bones.length;a<_e;a++){const rt=new Ao;this.bones[a]&&rt.copy(this.bones[a].matrixWorld).invert(),this.boneInverses.push(rt)}}pose(){for(let a=0,_e=this.bones.length;a<_e;a++){const rt=this.bones[a];rt&&rt.matrixWorld.copy(this.boneInverses[a]).invert()}for(let a=0,_e=this.bones.length;a<_e;a++){const rt=this.bones[a];rt&&(rt.parent&&rt.parent.isBone?(rt.matrix.copy(rt.parent.matrixWorld).invert(),rt.matrix.multiply(rt.matrixWorld)):rt.matrix.copy(rt.matrixWorld),rt.matrix.decompose(rt.position,rt.quaternion,rt.scale))}}update(){const a=this.bones,_e=this.boneInverses,rt=this.boneMatrices,it=this.boneTexture;for(let lt=0,ft=a.length;lt<ft;lt++){const _t=a[lt]?a[lt].matrixWorld:Vx;F2.multiplyMatrices(_t,_e[lt]),F2.toArray(rt,16*lt)}it!==null&&(it.needsUpdate=!0)}clone(){return new aA(this.bones,this.boneInverses)}computeBoneTexture(){let a=Math.sqrt(4*this.bones.length);a=jo(a),a=Math.max(a,4);const _e=new Float32Array(a*a*4);_e.set(this.boneMatrices);const rt=new zx(_e,a,a,Ns,ju);return rt.needsUpdate=!0,this.boneMatrices=_e,this.boneTexture=rt,this.boneTextureSize=a,this}getBoneByName(a){for(let _e=0,rt=this.bones.length;_e<rt;_e++){const it=this.bones[_e];if(it.name===a)return it}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(a,_e){this.uuid=a.uuid;for(let rt=0,it=a.bones.length;rt<it;rt++){const lt=a.bones[rt];let ft=_e[lt];ft===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",lt),ft=new Hp),this.bones.push(ft),this.boneInverses.push(new Ao().fromArray(a.boneInverses[rt]))}return this.init(),this}toJSON(){const a={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};a.uuid=this.uuid;const _e=this.bones,rt=this.boneInverses;for(let it=0,lt=_e.length;it<lt;it++){const ft=_e[it];a.bones.push(ft.uuid);const _t=rt[it];a.boneInverses.push(_t.toArray())}return a}}class bm extends Hl{constructor(a,_e,rt,it=1){super(a,_e,rt),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=it}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}toJSON(){const a=super.toJSON();return a.meshPerAttribute=this.meshPerAttribute,a.isInstancedBufferAttribute=!0,a}}const Fv=new Ao,lA=new Ao,sm=[],Gx=new E_,j2=new Ao,hE=new hp,Hx=new s_;class z2 extends hp{constructor(a,_e,rt){super(a,_e),this.isInstancedMesh=!0,this.instanceMatrix=new bm(new Float32Array(16*rt),16),this.instanceColor=null,this.sourceTrs=null,this.count=rt,this.boundingBox=null,this.boundingSphere=null;for(let it=0;it<rt;it++)this.setMatrixAt(it,j2)}computeBoundingBox(){const a=this.geometry,_e=this.count;this.boundingBox===null&&(this.boundingBox=new E_),a.boundingBox===null&&a.computeBoundingBox(),this.boundingBox.makeEmpty();for(let rt=0;rt<_e;rt++)this.getMatrixAt(rt,Fv),Gx.copy(a.boundingBox).applyMatrix4(Fv),this.boundingBox.union(Gx)}computeBoundingSphere(){const a=this.geometry,_e=this.count;this.boundingSphere===null&&(this.boundingSphere=new s_),a.boundingSphere===null&&a.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let rt=0;rt<_e;rt++)this.getMatrixAt(rt,Fv),Hx.copy(a.boundingSphere).applyMatrix4(Fv),this.boundingSphere.union(Hx)}copy(a,_e){return super.copy(a,_e),a.isInstancedMesh?(this.instanceMatrix.copy(a.instanceMatrix),a.instanceColor!==null&&(this.instanceColor=a.instanceColor.clone()),this.count=a.count,this):this}getColorAt(a,_e){_e.fromArray(this.instanceColor.array,3*a)}getMatrixAt(a,_e){_e.fromArray(this.instanceMatrix.array,16*a)}raycast(a,_e){const rt=this.matrixWorld,it=this.count;if(hE.geometry=this.geometry,hE.material=this.material,hE.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Hx.copy(this.boundingSphere),Hx.applyMatrix4(rt),a.ray.intersectsSphere(Hx)!==!1))for(let lt=0;lt<it;lt++){this.getMatrixAt(lt,Fv),lA.multiplyMatrices(rt,Fv),hE.matrixWorld=lA,hE.raycast(a,sm);for(let ft=0,_t=sm.length;ft<_t;ft++){const St=sm[ft];St.instanceId=lt,St.object=this,_e.push(St)}sm.length=0}}setColorAt(a,_e){this.instanceColor===null&&(this.instanceColor=new bm(new Float32Array(3*this.instanceMatrix.count),3)),_e.toArray(this.instanceColor.array,3*a)}setMatrixAt(a,_e){_e.toArray(this.instanceMatrix.array,16*a)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Um extends cp{constructor(a){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ps(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.linewidth=a.linewidth,this.linecap=a.linecap,this.linejoin=a.linejoin,this.fog=a.fog,this}}const aM=new Nn,lM=new Nn,om=new Ao,_a=new W0,xw=new s_;class Tl extends ga{constructor(a=new Kt,_e=new Um){super(),this.isLine=!0,this.type="Line",this.geometry=a,this.material=_e,this.updateMorphTargets()}copy(a,_e){return super.copy(a,_e),this.material=a.material,this.geometry=a.geometry,this}computeLineDistances(){const a=this.geometry;if(a.index===null){const _e=a.attributes.position,rt=[0];for(let it=1,lt=_e.count;it<lt;it++)aM.fromBufferAttribute(_e,it-1),lM.fromBufferAttribute(_e,it),rt[it]=rt[it-1],rt[it]+=aM.distanceTo(lM);a.setAttribute("lineDistance",new vs(rt,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(a,_e){const rt=this.geometry,it=this.matrixWorld,lt=a.params.Line.threshold,ft=rt.drawRange;if(rt.boundingSphere===null&&rt.computeBoundingSphere(),xw.copy(rt.boundingSphere),xw.applyMatrix4(it),xw.radius+=lt,a.ray.intersectsSphere(xw)===!1)return;om.copy(it).invert(),_a.copy(a.ray).applyMatrix4(om);const _t=lt/((this.scale.x+this.scale.y+this.scale.z)/3),St=_t*_t,Et=new Nn,Tt=new Nn,Bt=new Nn,Ot=new Nn,Lt=this.isLineSegments?2:1,zt=rt.index,Jt=rt.attributes.position;if(zt!==null)for(let Ht=Math.max(0,ft.start),$t=Math.min(zt.count,ft.start+ft.count)-1;Ht<$t;Ht+=Lt){const rn=zt.getX(Ht),cn=zt.getX(Ht+1);if(Et.fromBufferAttribute(Jt,rn),Tt.fromBufferAttribute(Jt,cn),_a.distanceSqToSegment(Et,Tt,Ot,Bt)>St)continue;Ot.applyMatrix4(this.matrixWorld);const Rn=a.ray.origin.distanceTo(Ot);Rn<a.near||Rn>a.far||_e.push({distance:Rn,point:Bt.clone().applyMatrix4(this.matrixWorld),index:Ht,face:null,faceIndex:null,object:this})}else for(let Ht=Math.max(0,ft.start),$t=Math.min(Jt.count,ft.start+ft.count)-1;Ht<$t;Ht+=Lt){if(Et.fromBufferAttribute(Jt,Ht),Tt.fromBufferAttribute(Jt,Ht+1),_a.distanceSqToSegment(Et,Tt,Ot,Bt)>St)continue;Ot.applyMatrix4(this.matrixWorld);const rn=a.ray.origin.distanceTo(Ot);rn<a.near||rn>a.far||_e.push({distance:rn,point:Bt.clone().applyMatrix4(this.matrixWorld),index:Ht,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const a=this.geometry.morphAttributes,_e=Object.keys(a);if(_e.length>0){const rt=a[_e[0]];if(rt!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let it=0,lt=rt.length;it<lt;it++){const ft=rt[it].name||String(it);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ft]=it}}}}}const V2=new Nn,dC=new Nn;class av extends Tl{constructor(a,_e){super(a,_e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const a=this.geometry;if(a.index===null){const _e=a.attributes.position,rt=[];for(let it=0,lt=_e.count;it<lt;it+=2)V2.fromBufferAttribute(_e,it),dC.fromBufferAttribute(_e,it+1),rt[it]=it===0?0:rt[it-1],rt[it+1]=rt[it]+V2.distanceTo(dC);a.setAttribute("lineDistance",new vs(rt,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class lv extends Tl{constructor(a,_e){super(a,_e),this.isLineLoop=!0,this.type="LineLoop"}}class Ew extends cp{constructor(a){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ps(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.size=a.size,this.sizeAttenuation=a.sizeAttenuation,this.fog=a.fog,this}}const dE=new Ao,pC=new W0,Qx=new s_,pE=new Nn;class fC extends ga{constructor(a=new Kt,_e=new Ew){super(),this.isPoints=!0,this.type="Points",this.geometry=a,this.material=_e,this.updateMorphTargets()}copy(a,_e){return super.copy(a,_e),this.material=a.material,this.geometry=a.geometry,this}raycast(a,_e){const rt=this.geometry,it=this.matrixWorld,lt=a.params.Points.threshold,ft=rt.drawRange;if(rt.boundingSphere===null&&rt.computeBoundingSphere(),Qx.copy(rt.boundingSphere),Qx.applyMatrix4(it),Qx.radius+=lt,a.ray.intersectsSphere(Qx)===!1)return;dE.copy(it).invert(),pC.copy(a.ray).applyMatrix4(dE);const _t=lt/((this.scale.x+this.scale.y+this.scale.z)/3),St=_t*_t,Et=rt.index,Tt=rt.attributes.position;if(Et!==null)for(let Bt=Math.max(0,ft.start),Ot=Math.min(Et.count,ft.start+ft.count);Bt<Ot;Bt++){const Lt=Et.getX(Bt);pE.fromBufferAttribute(Tt,Lt),fE(pE,Lt,St,it,a,_e,this)}else for(let Bt=Math.max(0,ft.start),Ot=Math.min(Tt.count,ft.start+ft.count);Bt<Ot;Bt++)pE.fromBufferAttribute(Tt,Bt),fE(pE,Bt,St,it,a,_e,this)}updateMorphTargets(){const a=this.geometry.morphAttributes,_e=Object.keys(a);if(_e.length>0){const rt=a[_e[0]];if(rt!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let it=0,lt=rt.length;it<lt;it++){const ft=rt[it].name||String(it);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ft]=it}}}}}function fE(pt,a,_e,rt,it,lt,ft){const _t=pC.distanceSqToPoint(pt);if(_t<_e){const St=new Nn;pC.closestPointToPoint(pt,St),St.applyMatrix4(rt);const Et=it.ray.origin.distanceTo(St);if(Et<it.near||Et>it.far)return;lt.push({distance:Et,distanceToRay:Math.sqrt(_t),point:St,index:a,face:null,object:ft})}}class G2 extends Yl{constructor(a,_e,rt,it,lt,ft,_t,St,Et){super(a,_e,rt,it,lt,ft,_t,St,Et),this.isVideoTexture=!0,this.minFilter=ft!==void 0?ft:xl,this.magFilter=lt!==void 0?lt:xl,this.generateMipmaps=!1;const Tt=this;"requestVideoFrameCallback"in a&&a.requestVideoFrameCallback(function Bt(){Tt.needsUpdate=!0,a.requestVideoFrameCallback(Bt)})}clone(){return new this.constructor(this.image).copy(this)}update(){const a=this.image;!("requestVideoFrameCallback"in a)&&a.readyState>=a.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class cM extends Yl{constructor(a,_e,rt){super({width:a,height:_e}),this.isFramebufferTexture=!0,this.format=rt,this.magFilter=Uo,this.minFilter=Uo,this.generateMipmaps=!1,this.needsUpdate=!0}}class mE extends Yl{constructor(a,_e,rt,it,lt,ft,_t,St,Et,Tt,Bt,Ot){super(null,ft,_t,St,Et,Tt,it,lt,Bt,Ot),this.isCompressedTexture=!0,this.image={width:_e,height:rt},this.mipmaps=a,this.flipY=!1,this.generateMipmaps=!1}}class uM extends mE{constructor(a,_e,rt,it,lt,ft){super(a,_e,rt,lt,ft),this.isCompressedArrayTexture=!0,this.image.depth=it,this.wrapR=Ho}}class H2 extends Yl{constructor(a,_e,rt,it,lt,ft,_t,St,Et){super(a,_e,rt,it,lt,ft,_t,St,Et),this.isCanvasTexture=!0,this.needsUpdate=!0}}class p_{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(a,_e){const rt=this.getUtoTmapping(a);return this.getPoint(rt,_e)}getPoints(a=5){const _e=[];for(let rt=0;rt<=a;rt++)_e.push(this.getPoint(rt/a));return _e}getSpacedPoints(a=5){const _e=[];for(let rt=0;rt<=a;rt++)_e.push(this.getPointAt(rt/a));return _e}getLength(){const a=this.getLengths();return a[a.length-1]}getLengths(a=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const _e=[];let rt,it=this.getPoint(0),lt=0;_e.push(0);for(let ft=1;ft<=a;ft++)rt=this.getPoint(ft/a),lt+=rt.distanceTo(it),_e.push(lt),it=rt;return this.cacheArcLengths=_e,_e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(a,_e){const rt=this.getLengths();let it=0;const lt=rt.length;let ft;ft=_e||a*rt[lt-1];let _t,St=0,Et=lt-1;for(;St<=Et;)if(it=Math.floor(St+(Et-St)/2),_t=rt[it]-ft,_t<0)St=it+1;else{if(!(_t>0)){Et=it;break}Et=it-1}if(it=Et,rt[it]===ft)return it/(lt-1);const Tt=rt[it];return(it+(ft-Tt)/(rt[it+1]-Tt))/(lt-1)}getTangent(a,_e){let it=a-1e-4,lt=a+1e-4;it<0&&(it=0),lt>1&&(lt=1);const ft=this.getPoint(it),_t=this.getPoint(lt),St=_e||(ft.isVector2?new Nr:new Nn);return St.copy(_t).sub(ft).normalize(),St}getTangentAt(a,_e){const rt=this.getUtoTmapping(a);return this.getTangent(rt,_e)}computeFrenetFrames(a,_e){const rt=new Nn,it=[],lt=[],ft=[],_t=new Nn,St=new Ao;for(let Lt=0;Lt<=a;Lt++){const zt=Lt/a;it[Lt]=this.getTangentAt(zt,new Nn)}lt[0]=new Nn,ft[0]=new Nn;let Et=Number.MAX_VALUE;const Tt=Math.abs(it[0].x),Bt=Math.abs(it[0].y),Ot=Math.abs(it[0].z);Tt<=Et&&(Et=Tt,rt.set(1,0,0)),Bt<=Et&&(Et=Bt,rt.set(0,1,0)),Ot<=Et&&rt.set(0,0,1),_t.crossVectors(it[0],rt).normalize(),lt[0].crossVectors(it[0],_t),ft[0].crossVectors(it[0],lt[0]);for(let Lt=1;Lt<=a;Lt++){if(lt[Lt]=lt[Lt-1].clone(),ft[Lt]=ft[Lt-1].clone(),_t.crossVectors(it[Lt-1],it[Lt]),_t.length()>Number.EPSILON){_t.normalize();const zt=Math.acos(Us(it[Lt-1].dot(it[Lt]),-1,1));lt[Lt].applyMatrix4(St.makeRotationAxis(_t,zt))}ft[Lt].crossVectors(it[Lt],lt[Lt])}if(_e===!0){let Lt=Math.acos(Us(lt[0].dot(lt[a]),-1,1));Lt/=a,it[0].dot(_t.crossVectors(lt[0],lt[a]))>0&&(Lt=-Lt);for(let zt=1;zt<=a;zt++)lt[zt].applyMatrix4(St.makeRotationAxis(it[zt],Lt*zt)),ft[zt].crossVectors(it[zt],lt[zt])}return{tangents:it,normals:lt,binormals:ft}}clone(){return new this.constructor().copy(this)}copy(a){return this.arcLengthDivisions=a.arcLengthDivisions,this}toJSON(){const a={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return a.arcLengthDivisions=this.arcLengthDivisions,a.type=this.type,a}fromJSON(a){return this.arcLengthDivisions=a.arcLengthDivisions,this}}class gE extends p_{constructor(a=0,_e=0,rt=1,it=1,lt=0,ft=2*Math.PI,_t=!1,St=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=a,this.aY=_e,this.xRadius=rt,this.yRadius=it,this.aStartAngle=lt,this.aEndAngle=ft,this.aClockwise=_t,this.aRotation=St}getPoint(a,_e){const rt=_e||new Nr,it=2*Math.PI;let lt=this.aEndAngle-this.aStartAngle;const ft=Math.abs(lt)<Number.EPSILON;for(;lt<0;)lt+=it;for(;lt>it;)lt-=it;lt<Number.EPSILON&&(lt=ft?0:it),this.aClockwise!==!0||ft||(lt===it?lt=-it:lt-=it);const _t=this.aStartAngle+a*lt;let St=this.aX+this.xRadius*Math.cos(_t),Et=this.aY+this.yRadius*Math.sin(_t);if(this.aRotation!==0){const Tt=Math.cos(this.aRotation),Bt=Math.sin(this.aRotation),Ot=St-this.aX,Lt=Et-this.aY;St=Ot*Tt-Lt*Bt+this.aX,Et=Ot*Bt+Lt*Tt+this.aY}return rt.set(St,Et)}copy(a){return super.copy(a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this}toJSON(){const a=super.toJSON();return a.aX=this.aX,a.aY=this.aY,a.xRadius=this.xRadius,a.yRadius=this.yRadius,a.aStartAngle=this.aStartAngle,a.aEndAngle=this.aEndAngle,a.aClockwise=this.aClockwise,a.aRotation=this.aRotation,a}fromJSON(a){return super.fromJSON(a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this}}class hM extends gE{constructor(a,_e,rt,it,lt,ft){super(a,_e,rt,rt,it,lt,ft),this.isArcCurve=!0,this.type="ArcCurve"}}function mC(){let pt=0,a=0,_e=0,rt=0;function it(lt,ft,_t,St){pt=lt,a=_t,_e=-3*lt+3*ft-2*_t-St,rt=2*lt-2*ft+_t+St}return{initCatmullRom:function(lt,ft,_t,St,Et){it(ft,_t,Et*(_t-lt),Et*(St-ft))},initNonuniformCatmullRom:function(lt,ft,_t,St,Et,Tt,Bt){let Ot=(ft-lt)/Et-(_t-lt)/(Et+Tt)+(_t-ft)/Tt,Lt=(_t-ft)/Tt-(St-ft)/(Tt+Bt)+(St-_t)/Bt;Ot*=Tt,Lt*=Tt,it(ft,_t,Ot,Lt)},calc:function(lt){const ft=lt*lt;return pt+a*lt+_e*ft+rt*(ft*lt)}}}const cA=new Nn,gC=new mC,_C=new mC,xu=new mC;class dM extends p_{constructor(a=[],_e=!1,rt="centripetal",it=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=a,this.closed=_e,this.curveType=rt,this.tension=it}getPoint(a,_e=new Nn){const rt=_e,it=this.points,lt=it.length,ft=(lt-(this.closed?0:1))*a;let _t,St,Et=Math.floor(ft),Tt=ft-Et;this.closed?Et+=Et>0?0:(Math.floor(Math.abs(Et)/lt)+1)*lt:Tt===0&&Et===lt-1&&(Et=lt-2,Tt=1),this.closed||Et>0?_t=it[(Et-1)%lt]:(cA.subVectors(it[0],it[1]).add(it[0]),_t=cA);const Bt=it[Et%lt],Ot=it[(Et+1)%lt];if(this.closed||Et+2<lt?St=it[(Et+2)%lt]:(cA.subVectors(it[lt-1],it[lt-2]).add(it[lt-1]),St=cA),this.curveType==="centripetal"||this.curveType==="chordal"){const Lt=this.curveType==="chordal"?.5:.25;let zt=Math.pow(_t.distanceToSquared(Bt),Lt),Jt=Math.pow(Bt.distanceToSquared(Ot),Lt),Ht=Math.pow(Ot.distanceToSquared(St),Lt);Jt<1e-4&&(Jt=1),zt<1e-4&&(zt=Jt),Ht<1e-4&&(Ht=Jt),gC.initNonuniformCatmullRom(_t.x,Bt.x,Ot.x,St.x,zt,Jt,Ht),_C.initNonuniformCatmullRom(_t.y,Bt.y,Ot.y,St.y,zt,Jt,Ht),xu.initNonuniformCatmullRom(_t.z,Bt.z,Ot.z,St.z,zt,Jt,Ht)}else this.curveType==="catmullrom"&&(gC.initCatmullRom(_t.x,Bt.x,Ot.x,St.x,this.tension),_C.initCatmullRom(_t.y,Bt.y,Ot.y,St.y,this.tension),xu.initCatmullRom(_t.z,Bt.z,Ot.z,St.z,this.tension));return rt.set(gC.calc(Tt),_C.calc(Tt),xu.calc(Tt)),rt}copy(a){super.copy(a),this.points=[];for(let _e=0,rt=a.points.length;_e<rt;_e++){const it=a.points[_e];this.points.push(it.clone())}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this}toJSON(){const a=super.toJSON();a.points=[];for(let _e=0,rt=this.points.length;_e<rt;_e++){const it=this.points[_e];a.points.push(it.toArray())}return a.closed=this.closed,a.curveType=this.curveType,a.tension=this.tension,a}fromJSON(a){super.fromJSON(a),this.points=[];for(let _e=0,rt=a.points.length;_e<rt;_e++){const it=a.points[_e];this.points.push(new Nn().fromArray(it))}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this}}function vC(pt,a,_e,rt,it){const lt=.5*(rt-a),ft=.5*(it-_e),_t=pt*pt;return(2*_e-2*rt+lt+ft)*(pt*_t)+(-3*_e+3*rt-2*lt-ft)*_t+lt*pt+_e}function ly(pt,a,_e,rt){return function(it,lt){const ft=1-it;return ft*ft*lt}(pt,a)+function(it,lt){return 2*(1-it)*it*lt}(pt,_e)+function(it,lt){return it*it*lt}(pt,rt)}function Sw(pt,a,_e,rt,it){return function(lt,ft){const _t=1-lt;return _t*_t*_t*ft}(pt,a)+function(lt,ft){const _t=1-lt;return 3*_t*_t*lt*ft}(pt,_e)+function(lt,ft){return 3*(1-lt)*lt*lt*ft}(pt,rt)+function(lt,ft){return lt*lt*lt*ft}(pt,it)}class pM extends p_{constructor(a=new Nr,_e=new Nr,rt=new Nr,it=new Nr){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=a,this.v1=_e,this.v2=rt,this.v3=it}getPoint(a,_e=new Nr){const rt=_e,it=this.v0,lt=this.v1,ft=this.v2,_t=this.v3;return rt.set(Sw(a,it.x,lt.x,ft.x,_t.x),Sw(a,it.y,lt.y,ft.y,_t.y)),rt}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this}}class Q2 extends p_{constructor(a=new Nn,_e=new Nn,rt=new Nn,it=new Nn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=a,this.v1=_e,this.v2=rt,this.v3=it}getPoint(a,_e=new Nn){const rt=_e,it=this.v0,lt=this.v1,ft=this.v2,_t=this.v3;return rt.set(Sw(a,it.x,lt.x,ft.x,_t.x),Sw(a,it.y,lt.y,ft.y,_t.y),Sw(a,it.z,lt.z,ft.z,_t.z)),rt}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this}}class yC extends p_{constructor(a=new Nr,_e=new Nr){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=a,this.v2=_e}getPoint(a,_e=new Nr){const rt=_e;return a===1?rt.copy(this.v2):(rt.copy(this.v2).sub(this.v1),rt.multiplyScalar(a).add(this.v1)),rt}getPointAt(a,_e){return this.getPoint(a,_e)}getTangent(a,_e=new Nr){return _e.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,_e){return this.getTangent(a,_e)}copy(a){return super.copy(a),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class W2 extends p_{constructor(a=new Nn,_e=new Nn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=a,this.v2=_e}getPoint(a,_e=new Nn){const rt=_e;return a===1?rt.copy(this.v2):(rt.copy(this.v2).sub(this.v1),rt.multiplyScalar(a).add(this.v1)),rt}getPointAt(a,_e){return this.getPoint(a,_e)}getTangent(a,_e=new Nn){return _e.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,_e){return this.getTangent(a,_e)}copy(a){return super.copy(a),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class fM extends p_{constructor(a=new Nr,_e=new Nr,rt=new Nr){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=a,this.v1=_e,this.v2=rt}getPoint(a,_e=new Nr){const rt=_e,it=this.v0,lt=this.v1,ft=this.v2;return rt.set(ly(a,it.x,lt.x,ft.x),ly(a,it.y,lt.y,ft.y)),rt}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class _E extends p_{constructor(a=new Nn,_e=new Nn,rt=new Nn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=a,this.v1=_e,this.v2=rt}getPoint(a,_e=new Nn){const rt=_e,it=this.v0,lt=this.v1,ft=this.v2;return rt.set(ly(a,it.x,lt.x,ft.x),ly(a,it.y,lt.y,ft.y),ly(a,it.z,lt.z,ft.z)),rt}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class mM extends p_{constructor(a=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=a}getPoint(a,_e=new Nr){const rt=_e,it=this.points,lt=(it.length-1)*a,ft=Math.floor(lt),_t=lt-ft,St=it[ft===0?ft:ft-1],Et=it[ft],Tt=it[ft>it.length-2?it.length-1:ft+1],Bt=it[ft>it.length-3?it.length-1:ft+2];return rt.set(vC(_t,St.x,Et.x,Tt.x,Bt.x),vC(_t,St.y,Et.y,Tt.y,Bt.y)),rt}copy(a){super.copy(a),this.points=[];for(let _e=0,rt=a.points.length;_e<rt;_e++){const it=a.points[_e];this.points.push(it.clone())}return this}toJSON(){const a=super.toJSON();a.points=[];for(let _e=0,rt=this.points.length;_e<rt;_e++){const it=this.points[_e];a.points.push(it.toArray())}return a}fromJSON(a){super.fromJSON(a),this.points=[];for(let _e=0,rt=a.points.length;_e<rt;_e++){const it=a.points[_e];this.points.push(new Nr().fromArray(it))}return this}}var gM=Object.freeze({__proto__:null,ArcCurve:hM,CatmullRomCurve3:dM,CubicBezierCurve:pM,CubicBezierCurve3:Q2,EllipseCurve:gE,LineCurve:yC,LineCurve3:W2,QuadraticBezierCurve:fM,QuadraticBezierCurve3:_E,SplineCurve:mM});class _M extends p_{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(a){this.curves.push(a)}closePath(){const a=this.curves[0].getPoint(0),_e=this.curves[this.curves.length-1].getPoint(1);a.equals(_e)||this.curves.push(new yC(_e,a))}getPoint(a,_e){const rt=a*this.getLength(),it=this.getCurveLengths();let lt=0;for(;lt<it.length;){if(it[lt]>=rt){const ft=it[lt]-rt,_t=this.curves[lt],St=_t.getLength(),Et=St===0?0:1-ft/St;return _t.getPointAt(Et,_e)}lt++}return null}getLength(){const a=this.getCurveLengths();return a[a.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const a=[];let _e=0;for(let rt=0,it=this.curves.length;rt<it;rt++)_e+=this.curves[rt].getLength(),a.push(_e);return this.cacheLengths=a,a}getSpacedPoints(a=40){const _e=[];for(let rt=0;rt<=a;rt++)_e.push(this.getPoint(rt/a));return this.autoClose&&_e.push(_e[0]),_e}getPoints(a=12){const _e=[];let rt;for(let it=0,lt=this.curves;it<lt.length;it++){const ft=lt[it],_t=ft.isEllipseCurve?2*a:ft.isLineCurve||ft.isLineCurve3?1:ft.isSplineCurve?a*ft.points.length:a,St=ft.getPoints(_t);for(let Et=0;Et<St.length;Et++){const Tt=St[Et];rt&&rt.equals(Tt)||(_e.push(Tt),rt=Tt)}}return this.autoClose&&_e.length>1&&!_e[_e.length-1].equals(_e[0])&&_e.push(_e[0]),_e}copy(a){super.copy(a),this.curves=[];for(let _e=0,rt=a.curves.length;_e<rt;_e++){const it=a.curves[_e];this.curves.push(it.clone())}return this.autoClose=a.autoClose,this}toJSON(){const a=super.toJSON();a.autoClose=this.autoClose,a.curves=[];for(let _e=0,rt=this.curves.length;_e<rt;_e++){const it=this.curves[_e];a.curves.push(it.toJSON())}return a}fromJSON(a){super.fromJSON(a),this.autoClose=a.autoClose,this.curves=[];for(let _e=0,rt=a.curves.length;_e<rt;_e++){const it=a.curves[_e];this.curves.push(new gM[it.type]().fromJSON(it))}return this}}class uA extends _M{constructor(a){super(),this.type="Path",this.currentPoint=new Nr,a&&this.setFromPoints(a)}setFromPoints(a){this.moveTo(a[0].x,a[0].y);for(let _e=1,rt=a.length;_e<rt;_e++)this.lineTo(a[_e].x,a[_e].y);return this}moveTo(a,_e){return this.currentPoint.set(a,_e),this}lineTo(a,_e){const rt=new yC(this.currentPoint.clone(),new Nr(a,_e));return this.curves.push(rt),this.currentPoint.set(a,_e),this}quadraticCurveTo(a,_e,rt,it){const lt=new fM(this.currentPoint.clone(),new Nr(a,_e),new Nr(rt,it));return this.curves.push(lt),this.currentPoint.set(rt,it),this}bezierCurveTo(a,_e,rt,it,lt,ft){const _t=new pM(this.currentPoint.clone(),new Nr(a,_e),new Nr(rt,it),new Nr(lt,ft));return this.curves.push(_t),this.currentPoint.set(lt,ft),this}splineThru(a){const _e=[this.currentPoint.clone()].concat(a),rt=new mM(_e);return this.curves.push(rt),this.currentPoint.copy(a[a.length-1]),this}arc(a,_e,rt,it,lt,ft){const _t=this.currentPoint.x,St=this.currentPoint.y;return this.absarc(a+_t,_e+St,rt,it,lt,ft),this}absarc(a,_e,rt,it,lt,ft){return this.absellipse(a,_e,rt,rt,it,lt,ft),this}ellipse(a,_e,rt,it,lt,ft,_t,St){const Et=this.currentPoint.x,Tt=this.currentPoint.y;return this.absellipse(a+Et,_e+Tt,rt,it,lt,ft,_t,St),this}absellipse(a,_e,rt,it,lt,ft,_t,St){const Et=new gE(a,_e,rt,it,lt,ft,_t,St);if(this.curves.length>0){const Bt=Et.getPoint(0);Bt.equals(this.currentPoint)||this.lineTo(Bt.x,Bt.y)}this.curves.push(Et);const Tt=Et.getPoint(1);return this.currentPoint.copy(Tt),this}copy(a){return super.copy(a),this.currentPoint.copy(a.currentPoint),this}toJSON(){const a=super.toJSON();return a.currentPoint=this.currentPoint.toArray(),a}fromJSON(a){return super.fromJSON(a),this.currentPoint.fromArray(a.currentPoint),this}}class Cw extends Kt{constructor(a=[new Nr(0,-.5),new Nr(.5,0),new Nr(0,.5)],_e=12,rt=0,it=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:a,segments:_e,phiStart:rt,phiLength:it},_e=Math.floor(_e),it=Us(it,0,2*Math.PI);const lt=[],ft=[],_t=[],St=[],Et=[],Tt=1/_e,Bt=new Nn,Ot=new Nr,Lt=new Nn,zt=new Nn,Jt=new Nn;let Ht=0,$t=0;for(let rn=0;rn<=a.length-1;rn++)switch(rn){case 0:Ht=a[rn+1].x-a[rn].x,$t=a[rn+1].y-a[rn].y,Lt.x=1*$t,Lt.y=-Ht,Lt.z=0*$t,Jt.copy(Lt),Lt.normalize(),St.push(Lt.x,Lt.y,Lt.z);break;case a.length-1:St.push(Jt.x,Jt.y,Jt.z);break;default:Ht=a[rn+1].x-a[rn].x,$t=a[rn+1].y-a[rn].y,Lt.x=1*$t,Lt.y=-Ht,Lt.z=0*$t,zt.copy(Lt),Lt.x+=Jt.x,Lt.y+=Jt.y,Lt.z+=Jt.z,Lt.normalize(),St.push(Lt.x,Lt.y,Lt.z),Jt.copy(zt)}for(let rn=0;rn<=_e;rn++){const cn=rt+rn*Tt*it,Rn=Math.sin(cn),Cn=Math.cos(cn);for(let Tn=0;Tn<=a.length-1;Tn++){Bt.x=a[Tn].x*Rn,Bt.y=a[Tn].y,Bt.z=a[Tn].x*Cn,ft.push(Bt.x,Bt.y,Bt.z),Ot.x=rn/_e,Ot.y=Tn/(a.length-1),_t.push(Ot.x,Ot.y);const Gn=St[3*Tn+0]*Rn,nr=St[3*Tn+1],Qn=St[3*Tn+0]*Cn;Et.push(Gn,nr,Qn)}}for(let rn=0;rn<_e;rn++)for(let cn=0;cn<a.length-1;cn++){const Rn=cn+rn*a.length,Cn=Rn,Tn=Rn+a.length,Gn=Rn+a.length+1,nr=Rn+1;lt.push(Cn,Tn,nr),lt.push(Gn,nr,Tn)}this.setIndex(lt),this.setAttribute("position",new vs(ft,3)),this.setAttribute("uv",new vs(_t,2)),this.setAttribute("normal",new vs(Et,3))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Cw(a.points,a.segments,a.phiStart,a.phiLength)}}class Tw extends Cw{constructor(a=1,_e=1,rt=4,it=8){const lt=new uA;lt.absarc(0,-_e/2,a,1.5*Math.PI,0),lt.absarc(0,_e/2,a,0,.5*Math.PI),super(lt.getPoints(rt),it),this.type="CapsuleGeometry",this.parameters={radius:a,height:_e,capSegments:rt,radialSegments:it}}static fromJSON(a){return new Tw(a.radius,a.length,a.capSegments,a.radialSegments)}}class cy extends Kt{constructor(a=1,_e=32,rt=0,it=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:a,segments:_e,thetaStart:rt,thetaLength:it},_e=Math.max(3,_e);const lt=[],ft=[],_t=[],St=[],Et=new Nn,Tt=new Nr;ft.push(0,0,0),_t.push(0,0,1),St.push(.5,.5);for(let Bt=0,Ot=3;Bt<=_e;Bt++,Ot+=3){const Lt=rt+Bt/_e*it;Et.x=a*Math.cos(Lt),Et.y=a*Math.sin(Lt),ft.push(Et.x,Et.y,Et.z),_t.push(0,0,1),Tt.x=(ft[Ot]/a+1)/2,Tt.y=(ft[Ot+1]/a+1)/2,St.push(Tt.x,Tt.y)}for(let Bt=1;Bt<=_e;Bt++)lt.push(Bt,Bt+1,0);this.setIndex(lt),this.setAttribute("position",new vs(ft,3)),this.setAttribute("normal",new vs(_t,3)),this.setAttribute("uv",new vs(St,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new cy(a.radius,a.segments,a.thetaStart,a.thetaLength)}}class hA extends Kt{constructor(a=1,_e=1,rt=1,it=32,lt=1,ft=!1,_t=0,St=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:a,radiusBottom:_e,height:rt,radialSegments:it,heightSegments:lt,openEnded:ft,thetaStart:_t,thetaLength:St};const Et=this;it=Math.floor(it),lt=Math.floor(lt);const Tt=[],Bt=[],Ot=[],Lt=[];let zt=0;const Jt=[],Ht=rt/2;let $t=0;function rn(cn){const Rn=zt,Cn=new Nr,Tn=new Nn;let Gn=0;const nr=cn===!0?a:_e,Qn=cn===!0?1:-1;for(let Wn=1;Wn<=it;Wn++)Bt.push(0,Ht*Qn,0),Ot.push(0,Qn,0),Lt.push(.5,.5),zt++;const ur=zt;for(let Wn=0;Wn<=it;Wn++){const Ar=Wn/it*St+_t,Cr=Math.cos(Ar),Wr=Math.sin(Ar);Tn.x=nr*Wr,Tn.y=Ht*Qn,Tn.z=nr*Cr,Bt.push(Tn.x,Tn.y,Tn.z),Ot.push(0,Qn,0),Cn.x=.5*Cr+.5,Cn.y=.5*Wr*Qn+.5,Lt.push(Cn.x,Cn.y),zt++}for(let Wn=0;Wn<it;Wn++){const Ar=Rn+Wn,Cr=ur+Wn;cn===!0?Tt.push(Cr,Cr+1,Ar):Tt.push(Cr+1,Cr,Ar),Gn+=3}Et.addGroup($t,Gn,cn===!0?1:2),$t+=Gn}(function(){const cn=new Nn,Rn=new Nn;let Cn=0;const Tn=(_e-a)/rt;for(let Gn=0;Gn<=lt;Gn++){const nr=[],Qn=Gn/lt,ur=Qn*(_e-a)+a;for(let Wn=0;Wn<=it;Wn++){const Ar=Wn/it,Cr=Ar*St+_t,Wr=Math.sin(Cr),is=Math.cos(Cr);Rn.x=ur*Wr,Rn.y=-Qn*rt+Ht,Rn.z=ur*is,Bt.push(Rn.x,Rn.y,Rn.z),cn.set(Wr,Tn,is).normalize(),Ot.push(cn.x,cn.y,cn.z),Lt.push(Ar,1-Qn),nr.push(zt++)}Jt.push(nr)}for(let Gn=0;Gn<it;Gn++)for(let nr=0;nr<lt;nr++){const Qn=Jt[nr][Gn],ur=Jt[nr+1][Gn],Wn=Jt[nr+1][Gn+1],Ar=Jt[nr][Gn+1];Tt.push(Qn,ur,Ar),Tt.push(ur,Wn,Ar),Cn+=6}Et.addGroup($t,Cn,0),$t+=Cn})(),ft===!1&&(a>0&&rn(!0),_e>0&&rn(!1)),this.setIndex(Tt),this.setAttribute("position",new vs(Bt,3)),this.setAttribute("normal",new vs(Ot,3)),this.setAttribute("uv",new vs(Lt,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new hA(a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength)}}class uy extends hA{constructor(a=1,_e=1,rt=32,it=1,lt=!1,ft=0,_t=2*Math.PI){super(0,a,_e,rt,it,lt,ft,_t),this.type="ConeGeometry",this.parameters={radius:a,height:_e,radialSegments:rt,heightSegments:it,openEnded:lt,thetaStart:ft,thetaLength:_t}}static fromJSON(a){return new uy(a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength)}}class cv extends Kt{constructor(a=[],_e=[],rt=1,it=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:a,indices:_e,radius:rt,detail:it};const lt=[],ft=[];function _t(Ot,Lt,zt,Jt){const Ht=Jt+1,$t=[];for(let rn=0;rn<=Ht;rn++){$t[rn]=[];const cn=Ot.clone().lerp(zt,rn/Ht),Rn=Lt.clone().lerp(zt,rn/Ht),Cn=Ht-rn;for(let Tn=0;Tn<=Cn;Tn++)$t[rn][Tn]=Tn===0&&rn===Ht?cn:cn.clone().lerp(Rn,Tn/Cn)}for(let rn=0;rn<Ht;rn++)for(let cn=0;cn<2*(Ht-rn)-1;cn++){const Rn=Math.floor(cn/2);cn%2==0?(St($t[rn][Rn+1]),St($t[rn+1][Rn]),St($t[rn][Rn])):(St($t[rn][Rn+1]),St($t[rn+1][Rn+1]),St($t[rn+1][Rn]))}}function St(Ot){lt.push(Ot.x,Ot.y,Ot.z)}function Et(Ot,Lt){const zt=3*Ot;Lt.x=a[zt+0],Lt.y=a[zt+1],Lt.z=a[zt+2]}function Tt(Ot,Lt,zt,Jt){Jt<0&&Ot.x===1&&(ft[Lt]=Ot.x-1),zt.x===0&&zt.z===0&&(ft[Lt]=Jt/2/Math.PI+.5)}function Bt(Ot){return Math.atan2(Ot.z,-Ot.x)}(function(Ot){const Lt=new Nn,zt=new Nn,Jt=new Nn;for(let Ht=0;Ht<_e.length;Ht+=3)Et(_e[Ht+0],Lt),Et(_e[Ht+1],zt),Et(_e[Ht+2],Jt),_t(Lt,zt,Jt,Ot)})(it),function(Ot){const Lt=new Nn;for(let zt=0;zt<lt.length;zt+=3)Lt.x=lt[zt+0],Lt.y=lt[zt+1],Lt.z=lt[zt+2],Lt.normalize().multiplyScalar(Ot),lt[zt+0]=Lt.x,lt[zt+1]=Lt.y,lt[zt+2]=Lt.z}(rt),function(){const Ot=new Nn;for(let zt=0;zt<lt.length;zt+=3){Ot.x=lt[zt+0],Ot.y=lt[zt+1],Ot.z=lt[zt+2];const Jt=Bt(Ot)/2/Math.PI+.5,Ht=(Lt=Ot,Math.atan2(-Lt.y,Math.sqrt(Lt.x*Lt.x+Lt.z*Lt.z))/Math.PI+.5);ft.push(Jt,1-Ht)}var Lt;(function(){const zt=new Nn,Jt=new Nn,Ht=new Nn,$t=new Nn,rn=new Nr,cn=new Nr,Rn=new Nr;for(let Cn=0,Tn=0;Cn<lt.length;Cn+=9,Tn+=6){zt.set(lt[Cn+0],lt[Cn+1],lt[Cn+2]),Jt.set(lt[Cn+3],lt[Cn+4],lt[Cn+5]),Ht.set(lt[Cn+6],lt[Cn+7],lt[Cn+8]),rn.set(ft[Tn+0],ft[Tn+1]),cn.set(ft[Tn+2],ft[Tn+3]),Rn.set(ft[Tn+4],ft[Tn+5]),$t.copy(zt).add(Jt).add(Ht).divideScalar(3);const Gn=Bt($t);Tt(rn,Tn+0,zt,Gn),Tt(cn,Tn+2,Jt,Gn),Tt(Rn,Tn+4,Ht,Gn)}})(),function(){for(let zt=0;zt<ft.length;zt+=6){const Jt=ft[zt+0],Ht=ft[zt+2],$t=ft[zt+4],rn=Math.max(Jt,Ht,$t),cn=Math.min(Jt,Ht,$t);rn>.9&&cn<.1&&(Jt<.2&&(ft[zt+0]+=1),Ht<.2&&(ft[zt+2]+=1),$t<.2&&(ft[zt+4]+=1))}}()}(),this.setAttribute("position",new vs(lt,3)),this.setAttribute("normal",new vs(lt.slice(),3)),this.setAttribute("uv",new vs(ft,2)),it===0?this.computeVertexNormals():this.normalizeNormals()}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new cv(a.vertices,a.indices,a.radius,a.details)}}class Mw extends cv{constructor(a=1,_e=0){const rt=(1+Math.sqrt(5))/2,it=1/rt;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-it,-rt,0,-it,rt,0,it,-rt,0,it,rt,-it,-rt,0,-it,rt,0,it,-rt,0,it,rt,0,-rt,0,-it,rt,0,-it,-rt,0,it,rt,0,it],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,_e),this.type="DodecahedronGeometry",this.parameters={radius:a,detail:_e}}static fromJSON(a){return new Mw(a.radius,a.detail)}}const AC=new Nn,dA=new Nn,Wx=new Nn,vE=new Du;class bC extends Kt{constructor(a=null,_e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:a,thresholdAngle:_e},a!==null){const it=Math.pow(10,4),lt=Math.cos(Iv*_e),ft=a.getIndex(),_t=a.getAttribute("position"),St=ft?ft.count:_t.count,Et=[0,0,0],Tt=["a","b","c"],Bt=new Array(3),Ot={},Lt=[];for(let zt=0;zt<St;zt+=3){ft?(Et[0]=ft.getX(zt),Et[1]=ft.getX(zt+1),Et[2]=ft.getX(zt+2)):(Et[0]=zt,Et[1]=zt+1,Et[2]=zt+2);const{a:Jt,b:Ht,c:$t}=vE;if(Jt.fromBufferAttribute(_t,Et[0]),Ht.fromBufferAttribute(_t,Et[1]),$t.fromBufferAttribute(_t,Et[2]),vE.getNormal(Wx),Bt[0]=`${Math.round(Jt.x*it)},${Math.round(Jt.y*it)},${Math.round(Jt.z*it)}`,Bt[1]=`${Math.round(Ht.x*it)},${Math.round(Ht.y*it)},${Math.round(Ht.z*it)}`,Bt[2]=`${Math.round($t.x*it)},${Math.round($t.y*it)},${Math.round($t.z*it)}`,Bt[0]!==Bt[1]&&Bt[1]!==Bt[2]&&Bt[2]!==Bt[0])for(let rn=0;rn<3;rn++){const cn=(rn+1)%3,Rn=Bt[rn],Cn=Bt[cn],Tn=vE[Tt[rn]],Gn=vE[Tt[cn]],nr=`${Rn}_${Cn}`,Qn=`${Cn}_${Rn}`;Qn in Ot&&Ot[Qn]?(Wx.dot(Ot[Qn].normal)<=lt&&(Lt.push(Tn.x,Tn.y,Tn.z),Lt.push(Gn.x,Gn.y,Gn.z)),Ot[Qn]=null):nr in Ot||(Ot[nr]={index0:Et[rn],index1:Et[cn],normal:Wx.clone()})}}for(const zt in Ot)if(Ot[zt]){const{index0:Jt,index1:Ht}=Ot[zt];AC.fromBufferAttribute(_t,Jt),dA.fromBufferAttribute(_t,Ht),Lt.push(AC.x,AC.y,AC.z),Lt.push(dA.x,dA.y,dA.z)}this.setAttribute("position",new vs(Lt,3))}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}}class pA extends uA{constructor(a){super(a),this.uuid=mm(),this.type="Shape",this.holes=[]}getPointsHoles(a){const _e=[];for(let rt=0,it=this.holes.length;rt<it;rt++)_e[rt]=this.holes[rt].getPoints(a);return _e}extractPoints(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}}copy(a){super.copy(a),this.holes=[];for(let _e=0,rt=a.holes.length;_e<rt;_e++){const it=a.holes[_e];this.holes.push(it.clone())}return this}toJSON(){const a=super.toJSON();a.uuid=this.uuid,a.holes=[];for(let _e=0,rt=this.holes.length;_e<rt;_e++){const it=this.holes[_e];a.holes.push(it.toJSON())}return a}fromJSON(a){super.fromJSON(a),this.uuid=a.uuid,this.holes=[];for(let _e=0,rt=a.holes.length;_e<rt;_e++){const it=a.holes[_e];this.holes.push(new uA().fromJSON(it))}return this}}function q2(pt,a,_e,rt,it){let lt,ft;if(it===function(_t,St,Et,Tt){let Bt=0;for(let Ot=St,Lt=Et-Tt;Ot<Et;Ot+=Tt)Bt+=(_t[Lt]-_t[Ot])*(_t[Ot+1]+_t[Lt+1]),Lt=Ot;return Bt}(pt,a,_e,rt)>0)for(lt=a;lt<_e;lt+=rt)ft=$2(lt,pt[lt],pt[lt+1],ft);else for(lt=_e-rt;lt>=a;lt-=rt)ft=$2(lt,pt[lt],pt[lt+1],ft);return ft&&bE(ft,ft.next)&&(Pw(ft),ft=ft.next),ft}function hy(pt,a){if(!pt)return pt;a||(a=pt);let _e,rt=pt;do if(_e=!1,rt.steiner||!bE(rt,rt.next)&&Eu(rt.prev,rt,rt.next)!==0)rt=rt.next;else{if(Pw(rt),rt=a=rt.prev,rt===rt.next)break;_e=!0}while(_e||rt!==a);return a}function A0(pt,a,_e,rt,it,lt,ft){if(!pt)return;!ft&&lt&&function(Tt,Bt,Ot,Lt){let zt=Tt;do zt.z===0&&(zt.z=AE(zt.x,zt.y,Bt,Ot,Lt)),zt.prevZ=zt.prev,zt.nextZ=zt.next,zt=zt.next;while(zt!==Tt);zt.prevZ.nextZ=null,zt.prevZ=null,function(Jt){let Ht,$t,rn,cn,Rn,Cn,Tn,Gn,nr=1;do{for($t=Jt,Jt=null,Rn=null,Cn=0;$t;){for(Cn++,rn=$t,Tn=0,Ht=0;Ht<nr&&(Tn++,rn=rn.nextZ,rn);Ht++);for(Gn=nr;Tn>0||Gn>0&&rn;)Tn!==0&&(Gn===0||!rn||$t.z<=rn.z)?(cn=$t,$t=$t.nextZ,Tn--):(cn=rn,rn=rn.nextZ,Gn--),Rn?Rn.nextZ=cn:Jt=cn,cn.prevZ=Rn,Rn=cn;$t=rn}Rn.nextZ=null,nr*=2}while(Cn>1)}(zt)}(pt,rt,it,lt);let _t,St,Et=pt;for(;pt.prev!==pt.next;)if(_t=pt.prev,St=pt.next,lt?dO(pt,rt,it,lt):vM(pt))a.push(_t.i/_e|0),a.push(pt.i/_e|0),a.push(St.i/_e|0),Pw(pt),pt=St.next,Et=St.next;else if((pt=St)===Et){ft?ft===1?A0(pt=yE(hy(pt),a,_e),a,_e,rt,it,lt,2):ft===2&&qx(pt,a,_e,rt,it,lt):A0(hy(pt),a,_e,rt,it,lt,1);break}}function vM(pt){const a=pt.prev,_e=pt,rt=pt.next;if(Eu(a,_e,rt)>=0)return!1;const it=a.x,lt=_e.x,ft=rt.x,_t=a.y,St=_e.y,Et=rt.y,Tt=it<lt?it<ft?it:ft:lt<ft?lt:ft,Bt=_t<St?_t<Et?_t:Et:St<Et?St:Et,Ot=it>lt?it>ft?it:ft:lt>ft?lt:ft,Lt=_t>St?_t>Et?_t:Et:St>Et?St:Et;let zt=rt.next;for(;zt!==a;){if(zt.x>=Tt&&zt.x<=Ot&&zt.y>=Bt&&zt.y<=Lt&&Iw(it,_t,lt,St,ft,Et,zt.x,zt.y)&&Eu(zt.prev,zt,zt.next)>=0)return!1;zt=zt.next}return!0}function dO(pt,a,_e,rt){const it=pt.prev,lt=pt,ft=pt.next;if(Eu(it,lt,ft)>=0)return!1;const _t=it.x,St=lt.x,Et=ft.x,Tt=it.y,Bt=lt.y,Ot=ft.y,Lt=_t<St?_t<Et?_t:Et:St<Et?St:Et,zt=Tt<Bt?Tt<Ot?Tt:Ot:Bt<Ot?Bt:Ot,Jt=_t>St?_t>Et?_t:Et:St>Et?St:Et,Ht=Tt>Bt?Tt>Ot?Tt:Ot:Bt>Ot?Bt:Ot,$t=AE(Lt,zt,a,_e,rt),rn=AE(Jt,Ht,a,_e,rt);let cn=pt.prevZ,Rn=pt.nextZ;for(;cn&&cn.z>=$t&&Rn&&Rn.z<=rn;){if(cn.x>=Lt&&cn.x<=Jt&&cn.y>=zt&&cn.y<=Ht&&cn!==it&&cn!==ft&&Iw(_t,Tt,St,Bt,Et,Ot,cn.x,cn.y)&&Eu(cn.prev,cn,cn.next)>=0||(cn=cn.prevZ,Rn.x>=Lt&&Rn.x<=Jt&&Rn.y>=zt&&Rn.y<=Ht&&Rn!==it&&Rn!==ft&&Iw(_t,Tt,St,Bt,Et,Ot,Rn.x,Rn.y)&&Eu(Rn.prev,Rn,Rn.next)>=0))return!1;Rn=Rn.nextZ}for(;cn&&cn.z>=$t;){if(cn.x>=Lt&&cn.x<=Jt&&cn.y>=zt&&cn.y<=Ht&&cn!==it&&cn!==ft&&Iw(_t,Tt,St,Bt,Et,Ot,cn.x,cn.y)&&Eu(cn.prev,cn,cn.next)>=0)return!1;cn=cn.prevZ}for(;Rn&&Rn.z<=rn;){if(Rn.x>=Lt&&Rn.x<=Jt&&Rn.y>=zt&&Rn.y<=Ht&&Rn!==it&&Rn!==ft&&Iw(_t,Tt,St,Bt,Et,Ot,Rn.x,Rn.y)&&Eu(Rn.prev,Rn,Rn.next)>=0)return!1;Rn=Rn.nextZ}return!0}function yE(pt,a,_e){let rt=pt;do{const it=rt.prev,lt=rt.next.next;!bE(it,lt)&&yM(it,rt,rt.next,lt)&&xE(it,lt)&&xE(lt,it)&&(a.push(it.i/_e|0),a.push(rt.i/_e|0),a.push(lt.i/_e|0),Pw(rt),Pw(rt.next),rt=pt=lt),rt=rt.next}while(rt!==pt);return hy(rt)}function qx(pt,a,_e,rt,it,lt){let ft=pt;do{let _t=ft.next.next;for(;_t!==ft.prev;){if(ft.i!==_t.i&&Y2(ft,_t)){let St=EC(ft,_t);return ft=hy(ft,ft.next),St=hy(St,St.next),A0(ft,a,_e,rt,it,lt,0),void A0(St,a,_e,rt,it,lt,0)}_t=_t.next}ft=ft.next}while(ft!==pt)}function pO(pt,a){return pt.x-a.x}function fO(pt,a){const _e=function(it,lt){let ft,_t=lt,St=-1/0;const Et=it.x,Tt=it.y;do{if(Tt<=_t.y&&Tt>=_t.next.y&&_t.next.y!==_t.y){const Ht=_t.x+(Tt-_t.y)*(_t.next.x-_t.x)/(_t.next.y-_t.y);if(Ht<=Et&&Ht>St&&(St=Ht,ft=_t.x<_t.next.x?_t:_t.next,Ht===Et))return ft}_t=_t.next}while(_t!==lt);if(!ft)return null;const Bt=ft,Ot=ft.x,Lt=ft.y;let zt,Jt=1/0;_t=ft;do Et>=_t.x&&_t.x>=Ot&&Et!==_t.x&&Iw(Tt<Lt?Et:St,Tt,Ot,Lt,Tt<Lt?St:Et,Tt,_t.x,_t.y)&&(zt=Math.abs(Tt-_t.y)/(Et-_t.x),xE(_t,it)&&(zt<Jt||zt===Jt&&(_t.x>ft.x||_t.x===ft.x&&X2(ft,_t)))&&(ft=_t,Jt=zt)),_t=_t.next;while(_t!==Bt);return ft}(pt,a);if(!_e)return a;const rt=EC(_e,pt);return hy(rt,rt.next),hy(_e,_e.next)}function X2(pt,a){return Eu(pt.prev,pt,a.prev)<0&&Eu(a.next,pt,pt.next)<0}function AE(pt,a,_e,rt,it){return(pt=1431655765&((pt=858993459&((pt=252645135&((pt=16711935&((pt=(pt-_e)*it|0)|pt<<8))|pt<<4))|pt<<2))|pt<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-rt)*it|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function wC(pt){let a=pt,_e=pt;do(a.x<_e.x||a.x===_e.x&&a.y<_e.y)&&(_e=a),a=a.next;while(a!==pt);return _e}function Iw(pt,a,_e,rt,it,lt,ft,_t){return(it-ft)*(a-_t)>=(pt-ft)*(lt-_t)&&(pt-ft)*(rt-_t)>=(_e-ft)*(a-_t)&&(_e-ft)*(lt-_t)>=(it-ft)*(rt-_t)}function Y2(pt,a){return pt.next.i!==a.i&&pt.prev.i!==a.i&&!function(_e,rt){let it=_e;do{if(it.i!==_e.i&&it.next.i!==_e.i&&it.i!==rt.i&&it.next.i!==rt.i&&yM(it,it.next,_e,rt))return!0;it=it.next}while(it!==_e);return!1}(pt,a)&&(xE(pt,a)&&xE(a,pt)&&function(_e,rt){let it=_e,lt=!1;const ft=(_e.x+rt.x)/2,_t=(_e.y+rt.y)/2;do it.y>_t!=it.next.y>_t&&it.next.y!==it.y&&ft<(it.next.x-it.x)*(_t-it.y)/(it.next.y-it.y)+it.x&&(lt=!lt),it=it.next;while(it!==_e);return lt}(pt,a)&&(Eu(pt.prev,pt,a.prev)||Eu(pt,a.prev,a))||bE(pt,a)&&Eu(pt.prev,pt,pt.next)>0&&Eu(a.prev,a,a.next)>0)}function Eu(pt,a,_e){return(a.y-pt.y)*(_e.x-a.x)-(a.x-pt.x)*(_e.y-a.y)}function bE(pt,a){return pt.x===a.x&&pt.y===a.y}function yM(pt,a,_e,rt){const it=wE(Eu(pt,a,_e)),lt=wE(Eu(pt,a,rt)),ft=wE(Eu(_e,rt,pt)),_t=wE(Eu(_e,rt,a));return it!==lt&&ft!==_t||!(it!==0||!xC(pt,_e,a))||!(lt!==0||!xC(pt,rt,a))||!(ft!==0||!xC(_e,pt,rt))||!(_t!==0||!xC(_e,a,rt))}function xC(pt,a,_e){return a.x<=Math.max(pt.x,_e.x)&&a.x>=Math.min(pt.x,_e.x)&&a.y<=Math.max(pt.y,_e.y)&&a.y>=Math.min(pt.y,_e.y)}function wE(pt){return pt>0?1:pt<0?-1:0}function xE(pt,a){return Eu(pt.prev,pt,pt.next)<0?Eu(pt,a,pt.next)>=0&&Eu(pt,pt.prev,a)>=0:Eu(pt,a,pt.prev)<0||Eu(pt,pt.next,a)<0}function EC(pt,a){const _e=new SC(pt.i,pt.x,pt.y),rt=new SC(a.i,a.x,a.y),it=pt.next,lt=a.prev;return pt.next=a,a.prev=pt,_e.next=it,it.prev=_e,rt.next=_e,_e.prev=rt,lt.next=rt,rt.prev=lt,rt}function $2(pt,a,_e,rt){const it=new SC(pt,a,_e);return rt?(it.next=rt.next,it.prev=rt,rt.next.prev=it,rt.next=it):(it.prev=it,it.next=it),it}function Pw(pt){pt.next.prev=pt.prev,pt.prev.next=pt.next,pt.prevZ&&(pt.prevZ.nextZ=pt.nextZ),pt.nextZ&&(pt.nextZ.prevZ=pt.prevZ)}function SC(pt,a,_e){this.i=pt,this.x=a,this.y=_e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class jv{static area(a){const _e=a.length;let rt=0;for(let it=_e-1,lt=0;lt<_e;it=lt++)rt+=a[it].x*a[lt].y-a[lt].x*a[it].y;return .5*rt}static isClockWise(a){return jv.area(a)<0}static triangulateShape(a,_e){const rt=[],it=[],lt=[];K2(a),AM(rt,a);let ft=a.length;_e.forEach(K2);for(let St=0;St<_e.length;St++)it.push(ft),ft+=_e[St].length,AM(rt,_e[St]);const _t=function(St,Et,Tt=2){const Bt=Et&&Et.length,Ot=Bt?Et[0]*Tt:St.length;let Lt=q2(St,0,Ot,Tt,!0);const zt=[];if(!Lt||Lt.next===Lt.prev)return zt;let Jt,Ht,$t,rn,cn,Rn,Cn;if(Bt&&(Lt=function(Tn,Gn,nr,Qn){const ur=[];let Wn,Ar,Cr,Wr,is;for(Wn=0,Ar=Gn.length;Wn<Ar;Wn++)Cr=Gn[Wn]*Qn,Wr=Wn<Ar-1?Gn[Wn+1]*Qn:Tn.length,is=q2(Tn,Cr,Wr,Qn,!1),is===is.next&&(is.steiner=!0),ur.push(wC(is));for(ur.sort(pO),Wn=0;Wn<ur.length;Wn++)nr=fO(ur[Wn],nr);return nr}(St,Et,Lt,Tt)),St.length>80*Tt){Jt=$t=St[0],Ht=rn=St[1];for(let Tn=Tt;Tn<Ot;Tn+=Tt)cn=St[Tn],Rn=St[Tn+1],cn<Jt&&(Jt=cn),Rn<Ht&&(Ht=Rn),cn>$t&&($t=cn),Rn>rn&&(rn=Rn);Cn=Math.max($t-Jt,rn-Ht),Cn=Cn!==0?32767/Cn:0}return A0(Lt,zt,Tt,Jt,Ht,Cn,0),zt}(rt,it);for(let St=0;St<_t.length;St+=3)lt.push(_t.slice(St,St+3));return lt}}function K2(pt){const a=pt.length;a>2&&pt[a-1].equals(pt[0])&&pt.pop()}function AM(pt,a){for(let _e=0;_e<a.length;_e++)pt.push(a[_e].x),pt.push(a[_e].y)}class Rw extends Kt{constructor(a=new pA([new Nr(.5,.5),new Nr(-.5,.5),new Nr(-.5,-.5),new Nr(.5,-.5)]),_e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:a,options:_e},a=Array.isArray(a)?a:[a];const rt=this,it=[],lt=[];for(let _t=0,St=a.length;_t<St;_t++)ft(a[_t]);function ft(_t){const St=[],Et=_e.curveSegments!==void 0?_e.curveSegments:12,Tt=_e.steps!==void 0?_e.steps:1,Bt=_e.depth!==void 0?_e.depth:1;let Ot=_e.bevelEnabled===void 0||_e.bevelEnabled,Lt=_e.bevelThickness!==void 0?_e.bevelThickness:.2,zt=_e.bevelSize!==void 0?_e.bevelSize:Lt-.1,Jt=_e.bevelOffset!==void 0?_e.bevelOffset:0,Ht=_e.bevelSegments!==void 0?_e.bevelSegments:3;const $t=_e.extrudePath,rn=_e.UVGenerator!==void 0?_e.UVGenerator:mO;let cn,Rn,Cn,Tn,Gn,nr=!1;$t&&(cn=$t.getSpacedPoints(Tt),nr=!0,Ot=!1,Rn=$t.computeFrenetFrames(Tt,!1),Cn=new Nn,Tn=new Nn,Gn=new Nn),Ot||(Ht=0,Lt=0,zt=0,Jt=0);const Qn=_t.extractPoints(Et);let ur=Qn.shape;const Wn=Qn.holes;if(!jv.isClockWise(ur)){ur=ur.reverse();for(let $n=0,Fn=Wn.length;$n<Fn;$n++){const ir=Wn[$n];jv.isClockWise(ir)&&(Wn[$n]=ir.reverse())}}const Ar=jv.triangulateShape(ur,Wn),Cr=ur;for(let $n=0,Fn=Wn.length;$n<Fn;$n++){const ir=Wn[$n];ur=ur.concat(ir)}function Wr($n,Fn,ir){return Fn||console.error("THREE.ExtrudeGeometry: vec does not exist"),$n.clone().addScaledVector(Fn,ir)}const is=ur.length,Qr=Ar.length;function Pr($n,Fn,ir){let xn,qn,Xn;const Tr=$n.x-Fn.x,Er=$n.y-Fn.y,Or=ir.x-$n.x,ss=ir.y-$n.y,ys=Tr*Tr+Er*Er,Fs=Tr*ss-Er*Or;if(Math.abs(Fs)>Number.EPSILON){const gs=Math.sqrt(ys),uo=Math.sqrt(Or*Or+ss*ss),lo=Fn.x-Er/gs,js=Fn.y+Tr/gs,Wl=((ir.x-ss/uo-lo)*ss-(ir.y+Or/uo-js)*Or)/(Tr*ss-Er*Or);xn=lo+Tr*Wl-$n.x,qn=js+Er*Wl-$n.y;const am=xn*xn+qn*qn;if(am<=2)return new Nr(xn,qn);Xn=Math.sqrt(am/2)}else{let gs=!1;Tr>Number.EPSILON?Or>Number.EPSILON&&(gs=!0):Tr<-Number.EPSILON?Or<-Number.EPSILON&&(gs=!0):Math.sign(Er)===Math.sign(ss)&&(gs=!0),gs?(xn=-Er,qn=Tr,Xn=Math.sqrt(ys)):(xn=Tr,qn=Er,Xn=Math.sqrt(ys/2))}return new Nr(xn/Xn,qn/Xn)}const Jr=[];for(let $n=0,Fn=Cr.length,ir=Fn-1,xn=$n+1;$n<Fn;$n++,ir++,xn++)ir===Fn&&(ir=0),xn===Fn&&(xn=0),Jr[$n]=Pr(Cr[$n],Cr[ir],Cr[xn]);const rs=[];let vr,Br=Jr.concat();for(let $n=0,Fn=Wn.length;$n<Fn;$n++){const ir=Wn[$n];vr=[];for(let xn=0,qn=ir.length,Xn=qn-1,Tr=xn+1;xn<qn;xn++,Xn++,Tr++)Xn===qn&&(Xn=0),Tr===qn&&(Tr=0),vr[xn]=Pr(ir[xn],ir[Xn],ir[Tr]);rs.push(vr),Br=Br.concat(vr)}for(let $n=0;$n<Ht;$n++){const Fn=$n/Ht,ir=Lt*Math.cos(Fn*Math.PI/2),xn=zt*Math.sin(Fn*Math.PI/2)+Jt;for(let qn=0,Xn=Cr.length;qn<Xn;qn++){const Tr=Wr(Cr[qn],Jr[qn],xn);as(Tr.x,Tr.y,-ir)}for(let qn=0,Xn=Wn.length;qn<Xn;qn++){const Tr=Wn[qn];vr=rs[qn];for(let Er=0,Or=Tr.length;Er<Or;Er++){const ss=Wr(Tr[Er],vr[Er],xn);as(ss.x,ss.y,-ir)}}}const es=zt+Jt;for(let $n=0;$n<is;$n++){const Fn=Ot?Wr(ur[$n],Br[$n],es):ur[$n];nr?(Tn.copy(Rn.normals[0]).multiplyScalar(Fn.x),Cn.copy(Rn.binormals[0]).multiplyScalar(Fn.y),Gn.copy(cn[0]).add(Tn).add(Cn),as(Gn.x,Gn.y,Gn.z)):as(Fn.x,Fn.y,0)}for(let $n=1;$n<=Tt;$n++)for(let Fn=0;Fn<is;Fn++){const ir=Ot?Wr(ur[Fn],Br[Fn],es):ur[Fn];nr?(Tn.copy(Rn.normals[$n]).multiplyScalar(ir.x),Cn.copy(Rn.binormals[$n]).multiplyScalar(ir.y),Gn.copy(cn[$n]).add(Tn).add(Cn),as(Gn.x,Gn.y,Gn.z)):as(ir.x,ir.y,Bt/Tt*$n)}for(let $n=Ht-1;$n>=0;$n--){const Fn=$n/Ht,ir=Lt*Math.cos(Fn*Math.PI/2),xn=zt*Math.sin(Fn*Math.PI/2)+Jt;for(let qn=0,Xn=Cr.length;qn<Xn;qn++){const Tr=Wr(Cr[qn],Jr[qn],xn);as(Tr.x,Tr.y,Bt+ir)}for(let qn=0,Xn=Wn.length;qn<Xn;qn++){const Tr=Wn[qn];vr=rs[qn];for(let Er=0,Or=Tr.length;Er<Or;Er++){const ss=Wr(Tr[Er],vr[Er],xn);nr?as(ss.x,ss.y+cn[Tt-1].y,cn[Tt-1].x+ir):as(ss.x,ss.y,Bt+ir)}}}function zr($n,Fn){let ir=$n.length;for(;--ir>=0;){const xn=ir;let qn=ir-1;qn<0&&(qn=$n.length-1);for(let Xn=0,Tr=Tt+2*Ht;Xn<Tr;Xn++){const Er=is*Xn,Or=is*(Xn+1);Hn(Fn+xn+Er,Fn+qn+Er,Fn+qn+Or,Fn+xn+Or)}}}function as($n,Fn,ir){St.push($n),St.push(Fn),St.push(ir)}function ro($n,Fn,ir){Dn($n),Dn(Fn),Dn(ir);const xn=it.length/3,qn=rn.generateTopUV(rt,it,xn-3,xn-2,xn-1);pr(qn[0]),pr(qn[1]),pr(qn[2])}function Hn($n,Fn,ir,xn){Dn($n),Dn(Fn),Dn(xn),Dn(Fn),Dn(ir),Dn(xn);const qn=it.length/3,Xn=rn.generateSideWallUV(rt,it,qn-6,qn-3,qn-2,qn-1);pr(Xn[0]),pr(Xn[1]),pr(Xn[3]),pr(Xn[1]),pr(Xn[2]),pr(Xn[3])}function Dn($n){it.push(St[3*$n+0]),it.push(St[3*$n+1]),it.push(St[3*$n+2])}function pr($n){lt.push($n.x),lt.push($n.y)}(function(){const $n=it.length/3;if(Ot){let Fn=0,ir=is*Fn;for(let xn=0;xn<Qr;xn++){const qn=Ar[xn];ro(qn[2]+ir,qn[1]+ir,qn[0]+ir)}Fn=Tt+2*Ht,ir=is*Fn;for(let xn=0;xn<Qr;xn++){const qn=Ar[xn];ro(qn[0]+ir,qn[1]+ir,qn[2]+ir)}}else{for(let Fn=0;Fn<Qr;Fn++){const ir=Ar[Fn];ro(ir[2],ir[1],ir[0])}for(let Fn=0;Fn<Qr;Fn++){const ir=Ar[Fn];ro(ir[0]+is*Tt,ir[1]+is*Tt,ir[2]+is*Tt)}}rt.addGroup($n,it.length/3-$n,0)})(),function(){const $n=it.length/3;let Fn=0;zr(Cr,Fn),Fn+=Cr.length;for(let ir=0,xn=Wn.length;ir<xn;ir++){const qn=Wn[ir];zr(qn,Fn),Fn+=qn.length}rt.addGroup($n,it.length/3-$n,1)}()}this.setAttribute("position",new vs(it,3)),this.setAttribute("uv",new vs(lt,2)),this.computeVertexNormals()}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON();return function(_e,rt,it){if(it.shapes=[],Array.isArray(_e))for(let lt=0,ft=_e.length;lt<ft;lt++){const _t=_e[lt];it.shapes.push(_t.uuid)}else it.shapes.push(_e.uuid);return it.options=Object.assign({},rt),rt.extrudePath!==void 0&&(it.options.extrudePath=rt.extrudePath.toJSON()),it}(this.parameters.shapes,this.parameters.options,a)}static fromJSON(a,_e){const rt=[];for(let lt=0,ft=a.shapes.length;lt<ft;lt++){const _t=_e[a.shapes[lt]];rt.push(_t)}const it=a.options.extrudePath;return it!==void 0&&(a.options.extrudePath=new gM[it.type]().fromJSON(it)),new Rw(rt,a.options)}}const mO={generateTopUV:function(pt,a,_e,rt,it){const lt=a[3*_e],ft=a[3*_e+1],_t=a[3*rt],St=a[3*rt+1],Et=a[3*it],Tt=a[3*it+1];return[new Nr(lt,ft),new Nr(_t,St),new Nr(Et,Tt)]},generateSideWallUV:function(pt,a,_e,rt,it,lt){const ft=a[3*_e],_t=a[3*_e+1],St=a[3*_e+2],Et=a[3*rt],Tt=a[3*rt+1],Bt=a[3*rt+2],Ot=a[3*it],Lt=a[3*it+1],zt=a[3*it+2],Jt=a[3*lt],Ht=a[3*lt+1],$t=a[3*lt+2];return Math.abs(_t-Tt)<Math.abs(ft-Et)?[new Nr(ft,1-St),new Nr(Et,1-Bt),new Nr(Ot,1-zt),new Nr(Jt,1-$t)]:[new Nr(_t,1-St),new Nr(Tt,1-Bt),new Nr(Lt,1-zt),new Nr(Ht,1-$t)]}};class Dw extends cv{constructor(a=1,_e=0){const rt=(1+Math.sqrt(5))/2;super([-1,rt,0,1,rt,0,-1,-rt,0,1,-rt,0,0,-1,rt,0,1,rt,0,-1,-rt,0,1,-rt,rt,0,-1,rt,0,1,-rt,0,-1,-rt,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,_e),this.type="IcosahedronGeometry",this.parameters={radius:a,detail:_e}}static fromJSON(a){return new Dw(a.radius,a.detail)}}class Xx extends cv{constructor(a=1,_e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,_e),this.type="OctahedronGeometry",this.parameters={radius:a,detail:_e}}static fromJSON(a){return new Xx(a.radius,a.detail)}}class dy extends Kt{constructor(a=.5,_e=1,rt=32,it=1,lt=0,ft=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:a,outerRadius:_e,thetaSegments:rt,phiSegments:it,thetaStart:lt,thetaLength:ft},rt=Math.max(3,rt);const _t=[],St=[],Et=[],Tt=[];let Bt=a;const Ot=(_e-a)/(it=Math.max(1,it)),Lt=new Nn,zt=new Nr;for(let Jt=0;Jt<=it;Jt++){for(let Ht=0;Ht<=rt;Ht++){const $t=lt+Ht/rt*ft;Lt.x=Bt*Math.cos($t),Lt.y=Bt*Math.sin($t),St.push(Lt.x,Lt.y,Lt.z),Et.push(0,0,1),zt.x=(Lt.x/_e+1)/2,zt.y=(Lt.y/_e+1)/2,Tt.push(zt.x,zt.y)}Bt+=Ot}for(let Jt=0;Jt<it;Jt++){const Ht=Jt*(rt+1);for(let $t=0;$t<rt;$t++){const rn=$t+Ht,cn=rn,Rn=rn+rt+1,Cn=rn+rt+2,Tn=rn+1;_t.push(cn,Rn,Tn),_t.push(Rn,Cn,Tn)}}this.setIndex(_t),this.setAttribute("position",new vs(St,3)),this.setAttribute("normal",new vs(Et,3)),this.setAttribute("uv",new vs(Tt,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new dy(a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength)}}class Yx extends Kt{constructor(a=new pA([new Nr(0,.5),new Nr(-.5,-.5),new Nr(.5,-.5)]),_e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:a,curveSegments:_e};const rt=[],it=[],lt=[],ft=[];let _t=0,St=0;if(Array.isArray(a)===!1)Et(a);else for(let Tt=0;Tt<a.length;Tt++)Et(a[Tt]),this.addGroup(_t,St,Tt),_t+=St,St=0;function Et(Tt){const Bt=it.length/3,Ot=Tt.extractPoints(_e);let Lt=Ot.shape;const zt=Ot.holes;jv.isClockWise(Lt)===!1&&(Lt=Lt.reverse());for(let Ht=0,$t=zt.length;Ht<$t;Ht++){const rn=zt[Ht];jv.isClockWise(rn)===!0&&(zt[Ht]=rn.reverse())}const Jt=jv.triangulateShape(Lt,zt);for(let Ht=0,$t=zt.length;Ht<$t;Ht++){const rn=zt[Ht];Lt=Lt.concat(rn)}for(let Ht=0,$t=Lt.length;Ht<$t;Ht++){const rn=Lt[Ht];it.push(rn.x,rn.y,0),lt.push(0,0,1),ft.push(rn.x,rn.y)}for(let Ht=0,$t=Jt.length;Ht<$t;Ht++){const rn=Jt[Ht],cn=rn[0]+Bt,Rn=rn[1]+Bt,Cn=rn[2]+Bt;rt.push(cn,Rn,Cn),St+=3}}this.setIndex(rt),this.setAttribute("position",new vs(it,3)),this.setAttribute("normal",new vs(lt,3)),this.setAttribute("uv",new vs(ft,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON();return function(_e,rt){if(rt.shapes=[],Array.isArray(_e))for(let it=0,lt=_e.length;it<lt;it++){const ft=_e[it];rt.shapes.push(ft.uuid)}else rt.shapes.push(_e.uuid);return rt}(this.parameters.shapes,a)}static fromJSON(a,_e){const rt=[];for(let it=0,lt=a.shapes.length;it<lt;it++){const ft=_e[a.shapes[it]];rt.push(ft)}return new Yx(rt,a.curveSegments)}}class kw extends Kt{constructor(a=1,_e=32,rt=16,it=0,lt=2*Math.PI,ft=0,_t=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:a,widthSegments:_e,heightSegments:rt,phiStart:it,phiLength:lt,thetaStart:ft,thetaLength:_t},_e=Math.max(3,Math.floor(_e)),rt=Math.max(2,Math.floor(rt));const St=Math.min(ft+_t,Math.PI);let Et=0;const Tt=[],Bt=new Nn,Ot=new Nn,Lt=[],zt=[],Jt=[],Ht=[];for(let $t=0;$t<=rt;$t++){const rn=[],cn=$t/rt;let Rn=0;$t===0&&ft===0?Rn=.5/_e:$t===rt&&St===Math.PI&&(Rn=-.5/_e);for(let Cn=0;Cn<=_e;Cn++){const Tn=Cn/_e;Bt.x=-a*Math.cos(it+Tn*lt)*Math.sin(ft+cn*_t),Bt.y=a*Math.cos(ft+cn*_t),Bt.z=a*Math.sin(it+Tn*lt)*Math.sin(ft+cn*_t),zt.push(Bt.x,Bt.y,Bt.z),Ot.copy(Bt).normalize(),Jt.push(Ot.x,Ot.y,Ot.z),Ht.push(Tn+Rn,1-cn),rn.push(Et++)}Tt.push(rn)}for(let $t=0;$t<rt;$t++)for(let rn=0;rn<_e;rn++){const cn=Tt[$t][rn+1],Rn=Tt[$t][rn],Cn=Tt[$t+1][rn],Tn=Tt[$t+1][rn+1];($t!==0||ft>0)&&Lt.push(cn,Rn,Tn),($t!==rt-1||St<Math.PI)&&Lt.push(Rn,Cn,Tn)}this.setIndex(Lt),this.setAttribute("position",new vs(zt,3)),this.setAttribute("normal",new vs(Jt,3)),this.setAttribute("uv",new vs(Ht,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new kw(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength)}}class $x extends cv{constructor(a=1,_e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,_e),this.type="TetrahedronGeometry",this.parameters={radius:a,detail:_e}}static fromJSON(a){return new $x(a.radius,a.detail)}}class EE extends Kt{constructor(a=1,_e=.4,rt=12,it=48,lt=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:a,tube:_e,radialSegments:rt,tubularSegments:it,arc:lt},rt=Math.floor(rt),it=Math.floor(it);const ft=[],_t=[],St=[],Et=[],Tt=new Nn,Bt=new Nn,Ot=new Nn;for(let Lt=0;Lt<=rt;Lt++)for(let zt=0;zt<=it;zt++){const Jt=zt/it*lt,Ht=Lt/rt*Math.PI*2;Bt.x=(a+_e*Math.cos(Ht))*Math.cos(Jt),Bt.y=(a+_e*Math.cos(Ht))*Math.sin(Jt),Bt.z=_e*Math.sin(Ht),_t.push(Bt.x,Bt.y,Bt.z),Tt.x=a*Math.cos(Jt),Tt.y=a*Math.sin(Jt),Ot.subVectors(Bt,Tt).normalize(),St.push(Ot.x,Ot.y,Ot.z),Et.push(zt/it),Et.push(Lt/rt)}for(let Lt=1;Lt<=rt;Lt++)for(let zt=1;zt<=it;zt++){const Jt=(it+1)*Lt+zt-1,Ht=(it+1)*(Lt-1)+zt-1,$t=(it+1)*(Lt-1)+zt,rn=(it+1)*Lt+zt;ft.push(Jt,Ht,rn),ft.push(Ht,$t,rn)}this.setIndex(ft),this.setAttribute("position",new vs(_t,3)),this.setAttribute("normal",new vs(St,3)),this.setAttribute("uv",new vs(Et,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new EE(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc)}}class Kx extends Kt{constructor(a=1,_e=.4,rt=64,it=8,lt=2,ft=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:a,tube:_e,tubularSegments:rt,radialSegments:it,p:lt,q:ft},rt=Math.floor(rt),it=Math.floor(it);const _t=[],St=[],Et=[],Tt=[],Bt=new Nn,Ot=new Nn,Lt=new Nn,zt=new Nn,Jt=new Nn,Ht=new Nn,$t=new Nn;for(let cn=0;cn<=rt;++cn){const Rn=cn/rt*lt*Math.PI*2;rn(Rn,lt,ft,a,Lt),rn(Rn+.01,lt,ft,a,zt),Ht.subVectors(zt,Lt),$t.addVectors(zt,Lt),Jt.crossVectors(Ht,$t),$t.crossVectors(Jt,Ht),Jt.normalize(),$t.normalize();for(let Cn=0;Cn<=it;++Cn){const Tn=Cn/it*Math.PI*2,Gn=-_e*Math.cos(Tn),nr=_e*Math.sin(Tn);Bt.x=Lt.x+(Gn*$t.x+nr*Jt.x),Bt.y=Lt.y+(Gn*$t.y+nr*Jt.y),Bt.z=Lt.z+(Gn*$t.z+nr*Jt.z),St.push(Bt.x,Bt.y,Bt.z),Ot.subVectors(Bt,Lt).normalize(),Et.push(Ot.x,Ot.y,Ot.z),Tt.push(cn/rt),Tt.push(Cn/it)}}for(let cn=1;cn<=rt;cn++)for(let Rn=1;Rn<=it;Rn++){const Cn=(it+1)*(cn-1)+(Rn-1),Tn=(it+1)*cn+(Rn-1),Gn=(it+1)*cn+Rn,nr=(it+1)*(cn-1)+Rn;_t.push(Cn,Tn,nr),_t.push(Tn,Gn,nr)}function rn(cn,Rn,Cn,Tn,Gn){const nr=Math.cos(cn),Qn=Math.sin(cn),ur=Cn/Rn*cn,Wn=Math.cos(ur);Gn.x=Tn*(2+Wn)*.5*nr,Gn.y=Tn*(2+Wn)*Qn*.5,Gn.z=Tn*Math.sin(ur)*.5}this.setIndex(_t),this.setAttribute("position",new vs(St,3)),this.setAttribute("normal",new vs(Et,3)),this.setAttribute("uv",new vs(Tt,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Kx(a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q)}}class Ow extends Kt{constructor(a=new _E(new Nn(-1,-1,0),new Nn(-1,1,0),new Nn(1,1,0)),_e=64,rt=1,it=8,lt=!1){super(),this.type="TubeGeometry",this.parameters={path:a,tubularSegments:_e,radius:rt,radialSegments:it,closed:lt};const ft=a.computeFrenetFrames(_e,lt);this.tangents=ft.tangents,this.normals=ft.normals,this.binormals=ft.binormals;const _t=new Nn,St=new Nn,Et=new Nr;let Tt=new Nn;const Bt=[],Ot=[],Lt=[],zt=[];function Jt(Ht){Tt=a.getPointAt(Ht/_e,Tt);const $t=ft.normals[Ht],rn=ft.binormals[Ht];for(let cn=0;cn<=it;cn++){const Rn=cn/it*Math.PI*2,Cn=Math.sin(Rn),Tn=-Math.cos(Rn);St.x=Tn*$t.x+Cn*rn.x,St.y=Tn*$t.y+Cn*rn.y,St.z=Tn*$t.z+Cn*rn.z,St.normalize(),Ot.push(St.x,St.y,St.z),_t.x=Tt.x+rt*St.x,_t.y=Tt.y+rt*St.y,_t.z=Tt.z+rt*St.z,Bt.push(_t.x,_t.y,_t.z)}}(function(){for(let Ht=0;Ht<_e;Ht++)Jt(Ht);Jt(lt===!1?_e:0),function(){for(let Ht=0;Ht<=_e;Ht++)for(let $t=0;$t<=it;$t++)Et.x=Ht/_e,Et.y=$t/it,Lt.push(Et.x,Et.y)}(),function(){for(let Ht=1;Ht<=_e;Ht++)for(let $t=1;$t<=it;$t++){const rn=(it+1)*(Ht-1)+($t-1),cn=(it+1)*Ht+($t-1),Rn=(it+1)*Ht+$t,Cn=(it+1)*(Ht-1)+$t;zt.push(rn,cn,Cn),zt.push(cn,Rn,Cn)}}()})(),this.setIndex(zt),this.setAttribute("position",new vs(Bt,3)),this.setAttribute("normal",new vs(Ot,3)),this.setAttribute("uv",new vs(Lt,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON();return a.path=this.parameters.path.toJSON(),a}static fromJSON(a){return new Ow(new gM[a.path.type]().fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed)}}class Jx extends Kt{constructor(a=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:a},a!==null){const _e=[],rt=new Set,it=new Nn,lt=new Nn;if(a.index!==null){const ft=a.attributes.position,_t=a.index;let St=a.groups;St.length===0&&(St=[{start:0,count:_t.count,materialIndex:0}]);for(let Et=0,Tt=St.length;Et<Tt;++Et){const Bt=St[Et],Ot=Bt.start;for(let Lt=Ot,zt=Ot+Bt.count;Lt<zt;Lt+=3)for(let Jt=0;Jt<3;Jt++){const Ht=_t.getX(Lt+Jt),$t=_t.getX(Lt+(Jt+1)%3);it.fromBufferAttribute(ft,Ht),lt.fromBufferAttribute(ft,$t),CC(it,lt,rt)===!0&&(_e.push(it.x,it.y,it.z),_e.push(lt.x,lt.y,lt.z))}}}else{const ft=a.attributes.position;for(let _t=0,St=ft.count/3;_t<St;_t++)for(let Et=0;Et<3;Et++){const Tt=3*_t+Et,Bt=3*_t+(Et+1)%3;it.fromBufferAttribute(ft,Tt),lt.fromBufferAttribute(ft,Bt),CC(it,lt,rt)===!0&&(_e.push(it.x,it.y,it.z),_e.push(lt.x,lt.y,lt.z))}}this.setAttribute("position",new vs(_e,3))}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}}function CC(pt,a,_e){const rt=`${pt.x},${pt.y},${pt.z}-${a.x},${a.y},${a.z}`,it=`${a.x},${a.y},${a.z}-${pt.x},${pt.y},${pt.z}`;return _e.has(rt)!==!0&&_e.has(it)!==!0&&(_e.add(rt),_e.add(it),!0)}var Zx=Object.freeze({__proto__:null,BoxGeometry:rv,CapsuleGeometry:Tw,CircleGeometry:cy,ConeGeometry:uy,CylinderGeometry:hA,DodecahedronGeometry:Mw,EdgesGeometry:bC,ExtrudeGeometry:Rw,IcosahedronGeometry:Dw,LatheGeometry:Cw,OctahedronGeometry:Xx,PlaneGeometry:M_,PolyhedronGeometry:cv,RingGeometry:dy,ShapeGeometry:Yx,SphereGeometry:kw,TetrahedronGeometry:$x,TorusGeometry:EE,TorusKnotGeometry:Kx,TubeGeometry:Ow,WireframeGeometry:Jx});class SE extends cp{constructor(a){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ps(0),this.transparent=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.fog=a.fog,this}}class TC extends Bv{constructor(a){super(a),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class bM extends cp{constructor(a){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ps(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ps(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zm,this.normalScale=new Nr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.defines={STANDARD:""},this.color.copy(a.color),this.roughness=a.roughness,this.metalness=a.metalness,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.roughnessMap=a.roughnessMap,this.metalnessMap=a.metalnessMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapIntensity=a.envMapIntensity,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class J2 extends bM{constructor(a){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Nr(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Us(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(_e){this.ior=(1+.4*_e)/(1-.4*_e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ps(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ps(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ps(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(a)}get sheen(){return this._sheen}set sheen(a){this._sheen>0!=a>0&&this.version++,this._sheen=a}get clearcoat(){return this._clearcoat}set clearcoat(a){this._clearcoat>0!=a>0&&this.version++,this._clearcoat=a}get iridescence(){return this._iridescence}set iridescence(a){this._iridescence>0!=a>0&&this.version++,this._iridescence=a}get transmission(){return this._transmission}set transmission(a){this._transmission>0!=a>0&&this.version++,this._transmission=a}copy(a){return super.copy(a),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=a.clearcoat,this.clearcoatMap=a.clearcoatMap,this.clearcoatRoughness=a.clearcoatRoughness,this.clearcoatRoughnessMap=a.clearcoatRoughnessMap,this.clearcoatNormalMap=a.clearcoatNormalMap,this.clearcoatNormalScale.copy(a.clearcoatNormalScale),this.ior=a.ior,this.iridescence=a.iridescence,this.iridescenceMap=a.iridescenceMap,this.iridescenceIOR=a.iridescenceIOR,this.iridescenceThicknessRange=[...a.iridescenceThicknessRange],this.iridescenceThicknessMap=a.iridescenceThicknessMap,this.sheen=a.sheen,this.sheenColor.copy(a.sheenColor),this.sheenColorMap=a.sheenColorMap,this.sheenRoughness=a.sheenRoughness,this.sheenRoughnessMap=a.sheenRoughnessMap,this.transmission=a.transmission,this.transmissionMap=a.transmissionMap,this.thickness=a.thickness,this.thicknessMap=a.thicknessMap,this.attenuationDistance=a.attenuationDistance,this.attenuationColor.copy(a.attenuationColor),this.specularIntensity=a.specularIntensity,this.specularIntensityMap=a.specularIntensityMap,this.specularColor.copy(a.specularColor),this.specularColorMap=a.specularColorMap,this}}class Z2 extends cp{constructor(a){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ps(16777215),this.specular=new ps(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ps(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zm,this.normalScale=new Nr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ys,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.specular.copy(a.specular),this.shininess=a.shininess,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class wM extends cp{constructor(a){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ps(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ps(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zm,this.normalScale=new Nr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.gradientMap=a.gradientMap,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}}class eP extends cp{constructor(a){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zm,this.normalScale=new Nr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(a)}copy(a){return super.copy(a),this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.flatShading=a.flatShading,this}}class xM extends cp{constructor(a){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ps(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ps(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zm,this.normalScale=new Nr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ys,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class tP extends cp{constructor(a){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ps(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zm,this.normalScale=new Nr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.defines={MATCAP:""},this.color.copy(a.color),this.matcap=a.matcap,this.map=a.map,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.flatShading=a.flatShading,this.fog=a.fog,this}}class EM extends Um{constructor(a){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(a)}copy(a){return super.copy(a),this.scale=a.scale,this.dashSize=a.dashSize,this.gapSize=a.gapSize,this}}function uv(pt,a,_e){return fA(pt)?new pt.constructor(pt.subarray(a,_e!==void 0?_e:pt.length)):pt.slice(a,_e)}function b0(pt,a,_e){return!pt||!_e&&pt.constructor===a?pt:typeof a.BYTES_PER_ELEMENT=="number"?new a(pt):Array.prototype.slice.call(pt)}function fA(pt){return ArrayBuffer.isView(pt)&&!(pt instanceof DataView)}function MC(pt){const a=pt.length,_e=new Array(a);for(let rt=0;rt!==a;++rt)_e[rt]=rt;return _e.sort(function(rt,it){return pt[rt]-pt[it]}),_e}function IC(pt,a,_e){const rt=pt.length,it=new pt.constructor(rt);for(let lt=0,ft=0;ft!==rt;++lt){const _t=_e[lt]*a;for(let St=0;St!==a;++St)it[ft++]=pt[_t+St]}return it}function CE(pt,a,_e,rt){let it=1,lt=pt[0];for(;lt!==void 0&&lt[rt]===void 0;)lt=pt[it++];if(lt===void 0)return;let ft=lt[rt];if(ft!==void 0)if(Array.isArray(ft))do ft=lt[rt],ft!==void 0&&(a.push(lt.time),_e.push.apply(_e,ft)),lt=pt[it++];while(lt!==void 0);else if(ft.toArray!==void 0)do ft=lt[rt],ft!==void 0&&(a.push(lt.time),ft.toArray(_e,_e.length)),lt=pt[it++];while(lt!==void 0);else do ft=lt[rt],ft!==void 0&&(a.push(lt.time),_e.push(ft)),lt=pt[it++];while(lt!==void 0)}const e1={arraySlice:uv,convertArray:b0,isTypedArray:fA,getKeyframeOrder:MC,sortedArray:IC,flattenJSON:CE,subclip:function(pt,a,_e,rt,it=30){const lt=pt.clone();lt.name=a;const ft=[];for(let St=0;St<lt.tracks.length;++St){const Et=lt.tracks[St],Tt=Et.getValueSize(),Bt=[],Ot=[];for(let Lt=0;Lt<Et.times.length;++Lt){const zt=Et.times[Lt]*it;if(!(zt<_e||zt>=rt)){Bt.push(Et.times[Lt]);for(let Jt=0;Jt<Tt;++Jt)Ot.push(Et.values[Lt*Tt+Jt])}}Bt.length!==0&&(Et.times=b0(Bt,Et.times.constructor),Et.values=b0(Ot,Et.values.constructor),ft.push(Et))}lt.tracks=ft;let _t=1/0;for(let St=0;St<lt.tracks.length;++St)_t>lt.tracks[St].times[0]&&(_t=lt.tracks[St].times[0]);for(let St=0;St<lt.tracks.length;++St)lt.tracks[St].shift(-1*_t);return lt.resetDuration(),lt},makeClipAdditive:function(pt,a=0,_e=pt,rt=30){rt<=0&&(rt=30);const it=_e.tracks.length,lt=a/rt;for(let ft=0;ft<it;++ft){const _t=_e.tracks[ft],St=_t.ValueTypeName;if(St==="bool"||St==="string")continue;const Et=pt.tracks.find(function($t){return $t.name===_t.name&&$t.ValueTypeName===St});if(Et===void 0)continue;let Tt=0;const Bt=_t.getValueSize();_t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(Tt=Bt/3);let Ot=0;const Lt=Et.getValueSize();Et.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(Ot=Lt/3);const zt=_t.times.length-1;let Jt;if(lt<=_t.times[0]){const $t=Tt,rn=Bt-Tt;Jt=uv(_t.values,$t,rn)}else if(lt>=_t.times[zt]){const $t=zt*Bt+Tt,rn=$t+Bt-Tt;Jt=uv(_t.values,$t,rn)}else{const $t=_t.createInterpolant(),rn=Tt,cn=Bt-Tt;$t.evaluate(lt),Jt=uv($t.resultBuffer,rn,cn)}St==="quaternion"&&new _m().fromArray(Jt).normalize().conjugate().toArray(Jt);const Ht=Et.times.length;for(let $t=0;$t<Ht;++$t){const rn=$t*Lt+Ot;if(St==="quaternion")_m.multiplyQuaternionsFlat(Et.values,rn,Jt,0,Et.values,rn);else{const cn=Lt-2*Ot;for(let Rn=0;Rn<cn;++Rn)Et.values[rn+Rn]-=Jt[Rn]}}}return pt.blendMode=Sl,pt}};class ru{constructor(a,_e,rt,it){this.parameterPositions=a,this._cachedIndex=0,this.resultBuffer=it!==void 0?it:new _e.constructor(rt),this.sampleValues=_e,this.valueSize=rt,this.settings=null,this.DefaultSettings_={}}evaluate(a){const _e=this.parameterPositions;let rt=this._cachedIndex,it=_e[rt],lt=_e[rt-1];e:{t:{let ft;n:{r:if(!(a<it)){for(let _t=rt+2;;){if(it===void 0){if(a<lt)break r;return rt=_e.length,this._cachedIndex=rt,this.copySampleValue_(rt-1)}if(rt===_t)break;if(lt=it,it=_e[++rt],a<it)break t}ft=_e.length;break n}if(a>=lt)break e;{const _t=_e[1];a<_t&&(rt=2,lt=_t);for(let St=rt-2;;){if(lt===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(rt===St)break;if(it=lt,lt=_e[--rt-1],a>=lt)break t}ft=rt,rt=0}}for(;rt<ft;){const _t=rt+ft>>>1;a<_e[_t]?ft=_t:rt=_t+1}if(it=_e[rt],lt=_e[rt-1],lt===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(it===void 0)return rt=_e.length,this._cachedIndex=rt,this.copySampleValue_(rt-1)}this._cachedIndex=rt,this.intervalChanged_(rt,lt,it)}return this.interpolate_(rt,lt,a,it)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(a){const _e=this.resultBuffer,rt=this.sampleValues,it=this.valueSize,lt=a*it;for(let ft=0;ft!==it;++ft)_e[ft]=rt[lt+ft];return _e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class nP extends ru{constructor(a,_e,rt,it){super(a,_e,rt,it),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:i0,endingEnd:i0}}intervalChanged_(a,_e,rt){const it=this.parameterPositions;let lt=a-2,ft=a+1,_t=it[lt],St=it[ft];if(_t===void 0)switch(this.getSettings_().endingStart){case Mv:lt=a,_t=2*_e-rt;break;case Ly:lt=it.length-2,_t=_e+it[lt]-it[lt+1];break;default:lt=a,_t=rt}if(St===void 0)switch(this.getSettings_().endingEnd){case Mv:ft=a,St=2*rt-_e;break;case Ly:ft=1,St=rt+it[1]-it[0];break;default:ft=a-1,St=_e}const Et=.5*(rt-_e),Tt=this.valueSize;this._weightPrev=Et/(_e-_t),this._weightNext=Et/(St-rt),this._offsetPrev=lt*Tt,this._offsetNext=ft*Tt}interpolate_(a,_e,rt,it){const lt=this.resultBuffer,ft=this.sampleValues,_t=this.valueSize,St=a*_t,Et=St-_t,Tt=this._offsetPrev,Bt=this._offsetNext,Ot=this._weightPrev,Lt=this._weightNext,zt=(rt-_e)/(it-_e),Jt=zt*zt,Ht=Jt*zt,$t=-Ot*Ht+2*Ot*Jt-Ot*zt,rn=(1+Ot)*Ht+(-1.5-2*Ot)*Jt+(-.5+Ot)*zt+1,cn=(-1-Lt)*Ht+(1.5+Lt)*Jt+.5*zt,Rn=Lt*Ht-Lt*Jt;for(let Cn=0;Cn!==_t;++Cn)lt[Cn]=$t*ft[Tt+Cn]+rn*ft[Et+Cn]+cn*ft[St+Cn]+Rn*ft[Bt+Cn];return lt}}class Qp extends ru{constructor(a,_e,rt,it){super(a,_e,rt,it)}interpolate_(a,_e,rt,it){const lt=this.resultBuffer,ft=this.sampleValues,_t=this.valueSize,St=a*_t,Et=St-_t,Tt=(rt-_e)/(it-_e),Bt=1-Tt;for(let Ot=0;Ot!==_t;++Ot)lt[Ot]=ft[Et+Ot]*Bt+ft[St+Ot]*Tt;return lt}}class zl extends ru{constructor(a,_e,rt,it){super(a,_e,rt,it)}interpolate_(a){return this.copySampleValue_(a-1)}}class Fm{constructor(a,_e,rt,it){if(a===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(_e===void 0||_e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+a);this.name=a,this.times=b0(_e,this.TimeBufferType),this.values=b0(rt,this.ValueBufferType),this.setInterpolation(it||this.DefaultInterpolation)}static toJSON(a){const _e=a.constructor;let rt;if(_e.toJSON!==this.toJSON)rt=_e.toJSON(a);else{rt={name:a.name,times:b0(a.times,Array),values:b0(a.values,Array)};const it=a.getInterpolation();it!==a.DefaultInterpolation&&(rt.interpolation=it)}return rt.type=a.ValueTypeName,rt}InterpolantFactoryMethodDiscrete(a){return new zl(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodLinear(a){return new Qp(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodSmooth(a){return new nP(this.times,this.values,this.getValueSize(),a)}setInterpolation(a){let _e;switch(a){case ks:_e=this.InterpolantFactoryMethodDiscrete;break;case W_:_e=this.InterpolantFactoryMethodLinear;break;case B0:_e=this.InterpolantFactoryMethodSmooth}if(_e===void 0){const rt="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(a===this.DefaultInterpolation)throw new Error(rt);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",rt),this}return this.createInterpolant=_e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ks;case this.InterpolantFactoryMethodLinear:return W_;case this.InterpolantFactoryMethodSmooth:return B0}}getValueSize(){return this.values.length/this.times.length}shift(a){if(a!==0){const _e=this.times;for(let rt=0,it=_e.length;rt!==it;++rt)_e[rt]+=a}return this}scale(a){if(a!==1){const _e=this.times;for(let rt=0,it=_e.length;rt!==it;++rt)_e[rt]*=a}return this}trim(a,_e){const rt=this.times,it=rt.length;let lt=0,ft=it-1;for(;lt!==it&&rt[lt]<a;)++lt;for(;ft!==-1&&rt[ft]>_e;)--ft;if(++ft,lt!==0||ft!==it){lt>=ft&&(ft=Math.max(ft,1),lt=ft-1);const _t=this.getValueSize();this.times=uv(rt,lt,ft),this.values=uv(this.values,lt*_t,ft*_t)}return this}validate(){let a=!0;const _e=this.getValueSize();_e-Math.floor(_e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),a=!1);const rt=this.times,it=this.values,lt=rt.length;lt===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),a=!1);let ft=null;for(let _t=0;_t!==lt;_t++){const St=rt[_t];if(typeof St=="number"&&isNaN(St)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,_t,St),a=!1;break}if(ft!==null&&ft>St){console.error("THREE.KeyframeTrack: Out of order keys.",this,_t,St,ft),a=!1;break}ft=St}if(it!==void 0&&fA(it))for(let _t=0,St=it.length;_t!==St;++_t){const Et=it[_t];if(isNaN(Et)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,_t,Et),a=!1;break}}return a}optimize(){const a=uv(this.times),_e=uv(this.values),rt=this.getValueSize(),it=this.getInterpolation()===B0,lt=a.length-1;let ft=1;for(let _t=1;_t<lt;++_t){let St=!1;const Et=a[_t];if(Et!==a[_t+1]&&(_t!==1||Et!==a[0]))if(it)St=!0;else{const Tt=_t*rt,Bt=Tt-rt,Ot=Tt+rt;for(let Lt=0;Lt!==rt;++Lt){const zt=_e[Tt+Lt];if(zt!==_e[Bt+Lt]||zt!==_e[Ot+Lt]){St=!0;break}}}if(St){if(_t!==ft){a[ft]=a[_t];const Tt=_t*rt,Bt=ft*rt;for(let Ot=0;Ot!==rt;++Ot)_e[Bt+Ot]=_e[Tt+Ot]}++ft}}if(lt>0){a[ft]=a[lt];for(let _t=lt*rt,St=ft*rt,Et=0;Et!==rt;++Et)_e[St+Et]=_e[_t+Et];++ft}return ft!==a.length?(this.times=uv(a,0,ft),this.values=uv(_e,0,ft*rt)):(this.times=a,this.values=_e),this}clone(){const a=uv(this.times,0),_e=uv(this.values,0),rt=new this.constructor(this.name,a,_e);return rt.createInterpolant=this.createInterpolant,rt}}Fm.prototype.TimeBufferType=Float32Array,Fm.prototype.ValueBufferType=Float32Array,Fm.prototype.DefaultInterpolation=W_;class zv extends Fm{}zv.prototype.ValueTypeName="bool",zv.prototype.ValueBufferType=Array,zv.prototype.DefaultInterpolation=ks,zv.prototype.InterpolantFactoryMethodLinear=void 0,zv.prototype.InterpolantFactoryMethodSmooth=void 0;class SM extends Fm{}SM.prototype.ValueTypeName="color";class t1 extends Fm{}t1.prototype.ValueTypeName="number";class rP extends ru{constructor(a,_e,rt,it){super(a,_e,rt,it)}interpolate_(a,_e,rt,it){const lt=this.resultBuffer,ft=this.sampleValues,_t=this.valueSize,St=(rt-_e)/(it-_e);let Et=a*_t;for(let Tt=Et+_t;Et!==Tt;Et+=4)_m.slerpFlat(lt,0,ft,Et-_t,ft,Et,St);return lt}}class w0 extends Fm{InterpolantFactoryMethodLinear(a){return new rP(this.times,this.values,this.getValueSize(),a)}}w0.prototype.ValueTypeName="quaternion",w0.prototype.DefaultInterpolation=W_,w0.prototype.InterpolantFactoryMethodSmooth=void 0;class x0 extends Fm{}x0.prototype.ValueTypeName="string",x0.prototype.ValueBufferType=Array,x0.prototype.DefaultInterpolation=ks,x0.prototype.InterpolantFactoryMethodLinear=void 0,x0.prototype.InterpolantFactoryMethodSmooth=void 0;class Vv extends Fm{}Vv.prototype.ValueTypeName="vector";class py{constructor(a,_e=-1,rt,it=fx){this.name=a,this.tracks=rt,this.duration=_e,this.blendMode=it,this.uuid=mm(),this.duration<0&&this.resetDuration()}static parse(a){const _e=[],rt=a.tracks,it=1/(a.fps||1);for(let ft=0,_t=rt.length;ft!==_t;++ft)_e.push(mA(rt[ft]).scale(it));const lt=new this(a.name,a.duration,_e,a.blendMode);return lt.uuid=a.uuid,lt}static toJSON(a){const _e=[],rt=a.tracks,it={name:a.name,duration:a.duration,tracks:_e,uuid:a.uuid,blendMode:a.blendMode};for(let lt=0,ft=rt.length;lt!==ft;++lt)_e.push(Fm.toJSON(rt[lt]));return it}static CreateFromMorphTargetSequence(a,_e,rt,it){const lt=_e.length,ft=[];for(let _t=0;_t<lt;_t++){let St=[],Et=[];St.push((_t+lt-1)%lt,_t,(_t+1)%lt),Et.push(0,1,0);const Tt=MC(St);St=IC(St,1,Tt),Et=IC(Et,1,Tt),it||St[0]!==0||(St.push(lt),Et.push(Et[0])),ft.push(new t1(".morphTargetInfluences["+_e[_t].name+"]",St,Et).scale(1/rt))}return new this(a,-1,ft)}static findByName(a,_e){let rt=a;if(!Array.isArray(a)){const it=a;rt=it.geometry&&it.geometry.animations||it.animations}for(let it=0;it<rt.length;it++)if(rt[it].name===_e)return rt[it];return null}static CreateClipsFromMorphTargetSequences(a,_e,rt){const it={},lt=/^([\w-]*?)([\d]+)$/;for(let _t=0,St=a.length;_t<St;_t++){const Et=a[_t],Tt=Et.name.match(lt);if(Tt&&Tt.length>1){const Bt=Tt[1];let Ot=it[Bt];Ot||(it[Bt]=Ot=[]),Ot.push(Et)}}const ft=[];for(const _t in it)ft.push(this.CreateFromMorphTargetSequence(_t,it[_t],_e,rt));return ft}static parseAnimation(a,_e){if(!a)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const rt=function(Tt,Bt,Ot,Lt,zt){if(Ot.length!==0){const Jt=[],Ht=[];CE(Ot,Jt,Ht,Lt),Jt.length!==0&&zt.push(new Tt(Bt,Jt,Ht))}},it=[],lt=a.name||"default",ft=a.fps||30,_t=a.blendMode;let St=a.length||-1;const Et=a.hierarchy||[];for(let Tt=0;Tt<Et.length;Tt++){const Bt=Et[Tt].keys;if(Bt&&Bt.length!==0)if(Bt[0].morphTargets){const Ot={};let Lt;for(Lt=0;Lt<Bt.length;Lt++)if(Bt[Lt].morphTargets)for(let zt=0;zt<Bt[Lt].morphTargets.length;zt++)Ot[Bt[Lt].morphTargets[zt]]=-1;for(const zt in Ot){const Jt=[],Ht=[];for(let $t=0;$t!==Bt[Lt].morphTargets.length;++$t){const rn=Bt[Lt];Jt.push(rn.time),Ht.push(rn.morphTarget===zt?1:0)}it.push(new t1(".morphTargetInfluence["+zt+"]",Jt,Ht))}St=Ot.length*ft}else{const Ot=".bones["+_e[Tt].name+"]";rt(Vv,Ot+".position",Bt,"pos",it),rt(w0,Ot+".quaternion",Bt,"rot",it),rt(Vv,Ot+".scale",Bt,"scl",it)}}return it.length===0?null:new this(lt,St,it,_t)}resetDuration(){let a=0;for(let _e=0,rt=this.tracks.length;_e!==rt;++_e){const it=this.tracks[_e];a=Math.max(a,it.times[it.times.length-1])}return this.duration=a,this}trim(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this}validate(){let a=!0;for(let _e=0;_e<this.tracks.length;_e++)a=a&&this.tracks[_e].validate();return a}optimize(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}clone(){const a=[];for(let _e=0;_e<this.tracks.length;_e++)a.push(this.tracks[_e].clone());return new this.constructor(this.name,this.duration,a,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function mA(pt){if(pt.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const a=function(_e){switch(_e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return t1;case"vector":case"vector2":case"vector3":case"vector4":return Vv;case"color":return SM;case"quaternion":return w0;case"bool":case"boolean":return zv;case"string":return x0}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+_e)}(pt.type);if(pt.times===void 0){const _e=[],rt=[];CE(pt.keys,_e,rt,"value"),pt.times=_e,pt.values=rt}return a.parse!==void 0?a.parse(pt):new a(pt.name,pt.times,pt.values,pt.interpolation)}const Hu={enabled:!1,files:{},add:function(pt,a){this.enabled!==!1&&(this.files[pt]=a)},get:function(pt,a){return this.enabled===!1?a?Promise.resolve():void 0:a?Promise.resolve(this.files[pt]):this.files[pt]},remove:function(pt){delete this.files[pt]},clear:function(){this.files={}}};class PC{constructor(a,_e,rt){const it=this;let lt,ft=!1,_t=0,St=0;const Et=[];this.onStart=void 0,this.onLoad=a,this.onProgress=_e,this.onError=rt,this.itemStart=function(Tt){St++,ft===!1&&it.onStart!==void 0&&it.onStart(Tt,_t,St),ft=!0},this.itemEnd=function(Tt){_t++,it.onProgress!==void 0&&it.onProgress(Tt,_t,St),_t===St&&(ft=!1,it.onLoad!==void 0&&it.onLoad())},this.itemError=function(Tt){it.onError!==void 0&&it.onError(Tt)},this.resolveURL=function(Tt){return lt?lt(Tt):Tt},this.setURLModifier=function(Tt){return lt=Tt,this},this.addHandler=function(Tt,Bt){return Et.push(Tt,Bt),this},this.removeHandler=function(Tt){const Bt=Et.indexOf(Tt);return Bt!==-1&&Et.splice(Bt,2),this},this.getHandler=function(Tt){for(let Bt=0,Ot=Et.length;Bt<Ot;Bt+=2){const Lt=Et[Bt],zt=Et[Bt+1];if(Lt.global&&(Lt.lastIndex=0),Lt.test(Tt))return zt}return null}}}const TE=new PC;class O_{constructor(a){this.manager=a!==void 0?a:TE,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(a,_e){const rt=this;return new Promise(function(it,lt){rt.load(a,it,_e,lt)})}parse(){}setCrossOrigin(a){return this.crossOrigin=a,this}setWithCredentials(a){return this.withCredentials=a,this}setPath(a){return this.path=a,this}setResourcePath(a){return this.resourcePath=a,this}setRequestHeader(a){return this.requestHeader=a,this}}const B_={};class gA extends Error{constructor(a,_e){super(a),this.response=_e}}class wm extends O_{constructor(a){super(a),this.responseType="text",this.useCache=!0}load(a,_e,rt,it){a===void 0&&(a=""),this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a),(this.useCache?Hu.get(a,this.responseType,this.mimeType):Promise.resolve(void 0)).then(lt=>{if(lt!==void 0)return this.manager.itemStart(a),setTimeout(()=>{_e&&_e(lt),this.manager.itemEnd(a)},0),lt;if(B_[a]!==void 0)return void B_[a].push({onLoad:_e,onProgress:rt,onError:it});B_[a]=[],B_[a].push({onLoad:_e,onProgress:rt,onError:it});const ft=new Request(a,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),_t=this.mimeType,St=this.responseType;fetch(ft).then(Et=>{if(Et.status===200||Et.status===0){if(Et.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||Et.body===void 0||Et.body.getReader===void 0)return Et;const Tt=B_[a],Bt=Et.body.getReader(),Ot=Et.headers.get("Content-Length")||Et.headers.get("X-File-Size"),Lt=Ot?parseInt(Ot):0,zt=Lt!==0;let Jt=0;const Ht=new ReadableStream({start($t){(function rn(){Bt.read().then(({done:cn,value:Rn})=>{if(cn)$t.close();else{Jt+=Rn.byteLength;const Cn=new ProgressEvent("progress",{lengthComputable:zt,loaded:Jt,total:Lt});for(let Tn=0,Gn=Tt.length;Tn<Gn;Tn++){const nr=Tt[Tn];nr.onProgress&&nr.onProgress(Cn)}$t.enqueue(Rn),rn()}})})()}});return new Response(Ht)}throw new gA(`fetch for "${Et.url}" responded with ${Et.status}: ${Et.statusText}`,Et)}).then(Et=>{switch(St){case"arraybuffer":return Et.arrayBuffer();case"blob":return Et.blob();case"document":return Et.text().then(Tt=>new DOMParser().parseFromString(Tt,_t));case"json":return Et.json();default:if(_t===void 0)return Et.text();{const Tt=/charset="?([^;"\s]*)"?/i.exec(_t),Bt=Tt&&Tt[1]?Tt[1].toLowerCase():void 0,Ot=new TextDecoder(Bt);return Et.arrayBuffer().then(Lt=>Ot.decode(Lt))}}}).then(Et=>{this.useCache&&Hu.add(a,Et,this.responseType);const Tt=B_[a];delete B_[a];for(let Bt=0,Ot=Tt.length;Bt<Ot;Bt++){const Lt=Tt[Bt];Lt.onLoad&&Lt.onLoad(Et)}}).catch(Et=>{const Tt=B_[a];if(Tt===void 0)throw this.manager.itemError(a),Et;delete B_[a];for(let Bt=0,Ot=Tt.length;Bt<Ot;Bt++){const Lt=Tt[Bt];Lt.onError&&Lt.onError(Et)}this.manager.itemError(a)}).finally(()=>{this.useCache&&this.manager.itemEnd(a)}),this.useCache&&this.manager.itemStart(a)})}setResponseType(a){return this.responseType=a,this}setMimeType(a){return this.mimeType=a,this}}class fy extends O_{constructor(a){super(a)}load(a,_e,rt,it){const lt=this,ft=new wm(this.manager);ft.setPath(this.path),ft.setRequestHeader(this.requestHeader),ft.setWithCredentials(this.withCredentials),ft.load(a,function(_t){try{_e(lt.parse(JSON.parse(_t)))}catch(St){it?it(St):console.error(St),lt.manager.itemError(a)}},rt,it)}parse(a){const _e=[];for(let rt=0;rt<a.length;rt++){const it=py.parse(a[rt]);_e.push(it)}return _e}}class CM extends O_{constructor(a){super(a)}load(a,_e,rt,it){const lt=this,ft=[],_t=new mE,St=new wm(this.manager);St.setPath(this.path),St.setResponseType("arraybuffer"),St.setRequestHeader(this.requestHeader),St.setWithCredentials(lt.withCredentials);let Et=0;function Tt(Bt){St.load(a[Bt],function(Ot){const Lt=lt.parse(Ot,!0);ft[Bt]={width:Lt.width,height:Lt.height,format:Lt.format,mipmaps:Lt.mipmaps},Et+=1,Et===6&&(Lt.mipmapCount===1&&(_t.minFilter=xl),_t.image=ft,_t.format=Lt.format,_t.needsUpdate=!0,_e&&_e(_t))},rt,it)}if(Array.isArray(a))for(let Bt=0,Ot=a.length;Bt<Ot;++Bt)Tt(Bt);else St.load(a,function(Bt){const Ot=lt.parse(Bt,!0);if(Ot.isCubemap){const Lt=Ot.mipmaps.length/Ot.mipmapCount;for(let zt=0;zt<Lt;zt++){ft[zt]={mipmaps:[]};for(let Jt=0;Jt<Ot.mipmapCount;Jt++)ft[zt].mipmaps.push(Ot.mipmaps[zt*Ot.mipmapCount+Jt]),ft[zt].format=Ot.format,ft[zt].width=Ot.width,ft[zt].height=Ot.height}_t.image=ft}else _t.image.width=Ot.width,_t.image.height=Ot.height,_t.mipmaps=Ot.mipmaps;Ot.mipmapCount===1&&(_t.minFilter=xl),_t.format=Ot.format,_t.needsUpdate=!0,_e&&_e(_t)},rt,it);return _t}}class Qu extends O_{constructor(a){super(a)}load(a,_e,rt,it){const lt=a;this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const ft=this,_t=Hu.get(a);if(_t!==void 0)return ft.manager.itemStart(a),setTimeout(function(){_e&&_e(_t),ft.manager.itemEnd(a)},0),_t;const St=Vy("img");function Et(){Bt(),Hu.add(a,this),_e&&_e(this),ft.manager.itemEnd(a)}function Tt(Ot){Bt(),it&&it(Ot),ft.manager.itemError(a),ft.manager.itemEnd(a)}function Bt(){St.removeEventListener("load",Et,!1),St.removeEventListener("error",Tt,!1)}return St.addEventListener("load",Et,!1),St.addEventListener("error",Tt,!1),a.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(St.crossOrigin=this.crossOrigin),ft.manager.itemStart(a),Hu.get(a,"blob").then(Ot=>{if(Ot!==void 0&&!Ot.type.startsWith("text/plain"))return Ot.type||(a.endsWith(".svg")||a.startsWith("data:image/svg"))&&(Ot=new Blob([Ot],{type:"image/svg+xml"})),void(St.src=URL.createObjectURL(Ot));const Lt=new wm(this.manager);Lt.useCache=!1,Lt.setPath(this.path),Lt.setCrossOrigin(this.crossOrigin),Lt.setResponseType("blob"),Lt.load(lt,function(zt){zt.type||(a.endsWith(".svg")||a.startsWith("data:image/svg"))&&(zt=new Blob([zt],{type:"image/svg+xml"})),Hu.add(a,zt,"blob"),St.src=URL.createObjectURL(zt)},rt,zt=>{Bt(),it&&it(zt)})}),St}}class TM extends O_{constructor(a){super(a)}load(a,_e,rt,it){const lt=new lw,ft=new Qu(this.manager);ft.setCrossOrigin(this.crossOrigin),ft.setPath(this.path);let _t=0;function St(Et){ft.load(a[Et],function(Tt){lt.images[Et]=Tt,_t++,_t===6&&(lt.needsUpdate=!0,_e&&_e(lt))},void 0,it)}for(let Et=0;Et<a.length;++Et)St(Et);return lt}}class iP extends O_{constructor(a){super(a)}load(a,_e,rt,it){const lt=this,ft=new zx,_t=new wm(this.manager);return _t.setResponseType("arraybuffer"),_t.setRequestHeader(this.requestHeader),_t.setPath(this.path),_t.setWithCredentials(lt.withCredentials),_t.load(a,function(St){const Et=lt.parse(St);Et&&(Et.image!==void 0?ft.image=Et.image:Et.data!==void 0&&(ft.image.width=Et.width,ft.image.height=Et.height,ft.image.data=Et.data,ft.image.complete=!0),ft.wrapS=Et.wrapS!==void 0?Et.wrapS:Ho,ft.wrapT=Et.wrapT!==void 0?Et.wrapT:Ho,ft.magFilter=Et.magFilter!==void 0?Et.magFilter:xl,ft.minFilter=Et.minFilter!==void 0?Et.minFilter:xl,ft.anisotropy=Et.anisotropy!==void 0?Et.anisotropy:1,Et.colorSpace!==void 0?ft.colorSpace=Et.colorSpace:Et.encoding!==void 0&&(ft.encoding=Et.encoding),Et.flipY!==void 0&&(ft.flipY=Et.flipY),Et.format!==void 0&&(ft.format=Et.format),Et.type!==void 0&&(ft.type=Et.type),Et.mipmaps!==void 0&&(ft.mipmaps=Et.mipmaps,ft.minFilter=Gl),Et.mipmapCount===1&&(ft.minFilter=xl),Et.generateMipmaps!==void 0&&(ft.generateMipmaps=Et.generateMipmaps),ft.needsUpdate=!0,_e&&_e(ft,Et))},rt,it),ft}}class RC extends O_{constructor(a){super(a)}load(a,_e,rt,it){const lt=new Yl,ft=new Qu(this.manager);return ft.setCrossOrigin(this.crossOrigin),ft.setPath(this.path),ft.load(a,function(_t){lt.image=_t,lt.needsUpdate=!0,_e!==void 0&&_e(lt)},rt,it),lt}}class jm extends ga{constructor(a,_e=1){super(),this.isLight=!0,this.type="Light",this.color=new ps(a),this.intensity=_e}dispose(){}copy(a,_e){return super.copy(a,_e),this.color.copy(a.color),this.intensity=a.intensity,this}toJSON(a){const _e=super.toJSON(a);return _e.object.color=this.color.getHex(),_e.object.intensity=this.intensity,this.groundColor!==void 0&&(_e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(_e.object.distance=this.distance),this.angle!==void 0&&(_e.object.angle=this.angle),this.decay!==void 0&&(_e.object.decay=this.decay),this.penumbra!==void 0&&(_e.object.penumbra=this.penumbra),this.shadow!==void 0&&(_e.object.shadow=this.shadow.toJSON()),_e}}class zm extends jm{constructor(a,_e,rt){super(a,rt),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ga.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ps(_e)}copy(a,_e){return super.copy(a,_e),this.groundColor.copy(a.groundColor),this}}const DC=new Ao,f_=new Nn,kC=new Nn;class MM{constructor(a){this.camera=a,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Nr(512,512),this.map=null,this.mapPass=null,this.matrix=new Ao,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Y1,this._frameExtents=new Nr(1,1),this._viewportCount=1,this._viewports=[new Cl(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(a){const _e=this.camera,rt=this.matrix;f_.setFromMatrixPosition(a.matrixWorld),_e.position.copy(f_),kC.setFromMatrixPosition(a.target.matrixWorld),_e.lookAt(kC),_e.updateMatrixWorld(),DC.multiplyMatrices(_e.projectionMatrix,_e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(DC),rt.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),rt.multiply(DC)}getViewport(a){return this._viewports[a]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(a){return this.camera=a.camera.clone(),this.bias=a.bias,this.normalBias=a.normalBias,this.radius=a.radius,this.mapSize.copy(a.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const a={};return this.bias!==0&&(a.bias=this.bias),this.normalBias!==0&&(a.normalBias=this.normalBias),this.radius!==1&&(a.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(a.mapSize=this.mapSize.toArray()),a.camera=this.camera.toJSON(!1).object,delete a.camera.matrix,a}}class gO extends MM{constructor(){super(new rm(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(a){const _e=this.camera,rt=2*n_*a.angle*this.focus,it=this.mapSize.width/this.mapSize.height,lt=a.distance||_e.far;rt===_e.fov&&it===_e.aspect&&lt===_e.far||(_e.fov=rt,_e.aspect=it,_e.far=lt,_e.updateProjectionMatrix()),super.updateMatrices(a)}copy(a){return super.copy(a),this.focus=a.focus,this}}class IM extends jm{constructor(a,_e,rt=0,it=Math.PI/3,lt=0,ft=2){super(a,_e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ga.DEFAULT_UP),this.updateMatrix(),this.target=new ga,this.distance=rt,this.angle=it,this.penumbra=lt,this.decay=ft,this.map=null,this.shadow=new gO}get power(){return this.intensity*Math.PI}set power(a){this.intensity=a/Math.PI}dispose(){this.shadow.dispose()}copy(a,_e){return super.copy(a,_e),this.distance=a.distance,this.angle=a.angle,this.penumbra=a.penumbra,this.decay=a.decay,this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}const n1=new Ao,_A=new Nn,Vm=new Nn;class _O extends MM{constructor(){super(new rm(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Nr(4,2),this._viewportCount=6,this._viewports=[new Cl(2,1,1,1),new Cl(0,1,1,1),new Cl(3,1,1,1),new Cl(1,1,1,1),new Cl(3,0,1,1),new Cl(1,0,1,1)],this._cubeDirections=[new Nn(1,0,0),new Nn(-1,0,0),new Nn(0,0,1),new Nn(0,0,-1),new Nn(0,1,0),new Nn(0,-1,0)],this._cubeUps=[new Nn(0,1,0),new Nn(0,1,0),new Nn(0,1,0),new Nn(0,1,0),new Nn(0,0,1),new Nn(0,0,-1)]}updateMatrices(a,_e=0){const rt=this.camera,it=this.matrix,lt=a.distance||rt.far;lt!==rt.far&&(rt.far=lt,rt.updateProjectionMatrix()),_A.setFromMatrixPosition(a.matrixWorld),rt.position.copy(_A),Vm.copy(rt.position),Vm.add(this._cubeDirections[_e]),rt.up.copy(this._cubeUps[_e]),rt.lookAt(Vm),rt.updateMatrixWorld(),it.makeTranslation(-_A.x,-_A.y,-_A.z),n1.multiplyMatrices(rt.projectionMatrix,rt.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n1)}}class Bw extends jm{constructor(a,_e,rt=0,it=2){super(a,_e),this.isPointLight=!0,this.type="PointLight",this.distance=rt,this.decay=it,this.shadow=new _O}get power(){return 4*this.intensity*Math.PI}set power(a){this.intensity=a/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(a,_e){return super.copy(a,_e),this.distance=a.distance,this.decay=a.decay,this.shadow=a.shadow.clone(),this}}class sP extends MM{constructor(){super(new HS(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class PM extends jm{constructor(a,_e){super(a,_e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ga.DEFAULT_UP),this.updateMatrix(),this.target=new ga,this.shadow=new sP}dispose(){this.shadow.dispose()}copy(a){return super.copy(a),this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}class ME extends jm{constructor(a,_e){super(a,_e),this.isAmbientLight=!0,this.type="AmbientLight"}}class RM extends jm{constructor(a,_e,rt=10,it=10){super(a,_e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=rt,this.height=it}get power(){return this.intensity*this.width*this.height*Math.PI}set power(a){this.intensity=a/(this.width*this.height*Math.PI)}copy(a){return super.copy(a),this.width=a.width,this.height=a.height,this}toJSON(a){const _e=super.toJSON(a);return _e.object.width=this.width,_e.object.height=this.height,_e}}class OC{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let a=0;a<9;a++)this.coefficients.push(new Nn)}set(a){for(let _e=0;_e<9;_e++)this.coefficients[_e].copy(a[_e]);return this}zero(){for(let a=0;a<9;a++)this.coefficients[a].set(0,0,0);return this}getAt(a,_e){const rt=a.x,it=a.y,lt=a.z,ft=this.coefficients;return _e.copy(ft[0]).multiplyScalar(.282095),_e.addScaledVector(ft[1],.488603*it),_e.addScaledVector(ft[2],.488603*lt),_e.addScaledVector(ft[3],.488603*rt),_e.addScaledVector(ft[4],rt*it*1.092548),_e.addScaledVector(ft[5],it*lt*1.092548),_e.addScaledVector(ft[6],.315392*(3*lt*lt-1)),_e.addScaledVector(ft[7],rt*lt*1.092548),_e.addScaledVector(ft[8],.546274*(rt*rt-it*it)),_e}getIrradianceAt(a,_e){const rt=a.x,it=a.y,lt=a.z,ft=this.coefficients;return _e.copy(ft[0]).multiplyScalar(.886227),_e.addScaledVector(ft[1],1.023328*it),_e.addScaledVector(ft[2],1.023328*lt),_e.addScaledVector(ft[3],1.023328*rt),_e.addScaledVector(ft[4],.858086*rt*it),_e.addScaledVector(ft[5],.858086*it*lt),_e.addScaledVector(ft[6],.743125*lt*lt-.247708),_e.addScaledVector(ft[7],.858086*rt*lt),_e.addScaledVector(ft[8],.429043*(rt*rt-it*it)),_e}add(a){for(let _e=0;_e<9;_e++)this.coefficients[_e].add(a.coefficients[_e]);return this}addScaledSH(a,_e){for(let rt=0;rt<9;rt++)this.coefficients[rt].addScaledVector(a.coefficients[rt],_e);return this}scale(a){for(let _e=0;_e<9;_e++)this.coefficients[_e].multiplyScalar(a);return this}lerp(a,_e){for(let rt=0;rt<9;rt++)this.coefficients[rt].lerp(a.coefficients[rt],_e);return this}equals(a){for(let _e=0;_e<9;_e++)if(!this.coefficients[_e].equals(a.coefficients[_e]))return!1;return!0}copy(a){return this.set(a.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(a,_e=0){const rt=this.coefficients;for(let it=0;it<9;it++)rt[it].fromArray(a,_e+3*it);return this}toArray(a=[],_e=0){const rt=this.coefficients;for(let it=0;it<9;it++)rt[it].toArray(a,_e+3*it);return a}static getBasisAt(a,_e){const rt=a.x,it=a.y,lt=a.z;_e[0]=.282095,_e[1]=.488603*it,_e[2]=.488603*lt,_e[3]=.488603*rt,_e[4]=1.092548*rt*it,_e[5]=1.092548*it*lt,_e[6]=.315392*(3*lt*lt-1),_e[7]=1.092548*rt*lt,_e[8]=.546274*(rt*rt-it*it)}}class E0 extends jm{constructor(a=new OC,_e=1){super(void 0,_e),this.isLightProbe=!0,this.sh=a}copy(a){return super.copy(a),this.sh.copy(a.sh),this}fromJSON(a){return this.intensity=a.intensity,this.sh.fromArray(a.sh),this}toJSON(a){const _e=super.toJSON(a);return _e.object.sh=this.sh.toArray(),_e}}class r1 extends O_{constructor(a){super(a),this.textures={}}load(a,_e,rt,it){const lt=this,ft=new wm(lt.manager);ft.setPath(lt.path),ft.setRequestHeader(lt.requestHeader),ft.setWithCredentials(lt.withCredentials),ft.load(a,function(_t){try{_e(lt.parse(JSON.parse(_t)))}catch(St){it?it(St):console.error(St),lt.manager.itemError(a)}},rt,it)}parse(a){const _e=this.textures;function rt(ft){return _e[ft]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",ft),_e[ft]}const it=a.metadata&&a.metadata.version<=4.5?yo:void 0,lt=r1.createMaterialFromType(a.type);if(a.uuid!==void 0&&(lt.uuid=a.uuid),a.name!==void 0&&(lt.name=a.name),a.color!==void 0&&lt.color!==void 0&&lt.color.setHex(a.color,it),a.roughness!==void 0&&(lt.roughness=a.roughness),a.metalness!==void 0&&(lt.metalness=a.metalness),a.sheen!==void 0&&(lt.sheen=a.sheen),a.sheenColor!==void 0&&(lt.sheenColor=new ps().setHex(a.sheenColor,it)),a.sheenRoughness!==void 0&&(lt.sheenRoughness=a.sheenRoughness),a.emissive!==void 0&&lt.emissive!==void 0&&lt.emissive.setHex(a.emissive,it),a.specular!==void 0&&lt.specular!==void 0&&lt.specular.setHex(a.specular,it),a.specularIntensity!==void 0&&(lt.specularIntensity=a.specularIntensity),a.specularColor!==void 0&&lt.specularColor!==void 0&&lt.specularColor.setHex(a.specularColor,it),a.shininess!==void 0&&(lt.shininess=a.shininess),a.clearcoat!==void 0&&(lt.clearcoat=a.clearcoat),a.clearcoatRoughness!==void 0&&(lt.clearcoatRoughness=a.clearcoatRoughness),a.iridescence!==void 0&&(lt.iridescence=a.iridescence),a.iridescenceIOR!==void 0&&(lt.iridescenceIOR=a.iridescenceIOR),a.iridescenceThicknessRange!==void 0&&(lt.iridescenceThicknessRange=a.iridescenceThicknessRange),a.transmission!==void 0&&(lt.transmission=a.transmission),a.thickness!==void 0&&(lt.thickness=a.thickness),a.attenuationDistance!==void 0&&(lt.attenuationDistance=a.attenuationDistance),a.attenuationColor!==void 0&&lt.attenuationColor!==void 0&&lt.attenuationColor.setHex(a.attenuationColor,it),a.fog!==void 0&&(lt.fog=a.fog),a.flatShading!==void 0&&(lt.flatShading=a.flatShading),a.blending!==void 0&&(lt.blending=a.blending),a.combine!==void 0&&(lt.combine=a.combine),a.side!==void 0&&(lt.side=a.side),a.shadowSide!==void 0&&(lt.shadowSide=a.shadowSide),a.opacity!==void 0&&(lt.opacity=a.opacity),a.transparent!==void 0&&(lt.transparent=a.transparent),a.alphaTest!==void 0&&(lt.alphaTest=a.alphaTest),a.depthTest!==void 0&&(lt.depthTest=a.depthTest),a.depthWrite!==void 0&&(lt.depthWrite=a.depthWrite),a.colorWrite!==void 0&&(lt.colorWrite=a.colorWrite),a.stencilWrite!==void 0&&(lt.stencilWrite=a.stencilWrite),a.stencilWriteMask!==void 0&&(lt.stencilWriteMask=a.stencilWriteMask),a.stencilFunc!==void 0&&(lt.stencilFunc=a.stencilFunc),a.stencilRef!==void 0&&(lt.stencilRef=a.stencilRef),a.stencilFuncMask!==void 0&&(lt.stencilFuncMask=a.stencilFuncMask),a.stencilFail!==void 0&&(lt.stencilFail=a.stencilFail),a.stencilZFail!==void 0&&(lt.stencilZFail=a.stencilZFail),a.stencilZPass!==void 0&&(lt.stencilZPass=a.stencilZPass),a.wireframe!==void 0&&(lt.wireframe=a.wireframe),a.wireframeLinewidth!==void 0&&(lt.wireframeLinewidth=a.wireframeLinewidth),a.wireframeLinecap!==void 0&&(lt.wireframeLinecap=a.wireframeLinecap),a.wireframeLinejoin!==void 0&&(lt.wireframeLinejoin=a.wireframeLinejoin),a.rotation!==void 0&&(lt.rotation=a.rotation),a.linewidth!==1&&(lt.linewidth=a.linewidth),a.dashSize!==void 0&&(lt.dashSize=a.dashSize),a.gapSize!==void 0&&(lt.gapSize=a.gapSize),a.scale!==void 0&&(lt.scale=a.scale),a.polygonOffset!==void 0&&(lt.polygonOffset=a.polygonOffset),a.polygonOffsetFactor!==void 0&&(lt.polygonOffsetFactor=a.polygonOffsetFactor),a.polygonOffsetUnits!==void 0&&(lt.polygonOffsetUnits=a.polygonOffsetUnits),a.dithering!==void 0&&(lt.dithering=a.dithering),a.alphaToCoverage!==void 0&&(lt.alphaToCoverage=a.alphaToCoverage),a.premultipliedAlpha!==void 0&&(lt.premultipliedAlpha=a.premultipliedAlpha),a.forceSinglePass!==void 0&&(lt.forceSinglePass=a.forceSinglePass),a.visible!==void 0&&(lt.visible=a.visible),a.toneMapped!==void 0&&(lt.toneMapped=a.toneMapped),a.userData!==void 0&&(lt.userData=a.userData),a.vertexColors!==void 0&&(typeof a.vertexColors=="number"?lt.vertexColors=a.vertexColors>0:lt.vertexColors=a.vertexColors),a.uniforms!==void 0)for(const ft in a.uniforms){const _t=a.uniforms[ft];switch(lt.uniforms[ft]={},_t.type){case"t":lt.uniforms[ft].value=rt(_t.value);break;case"c":lt.uniforms[ft].value=new ps().setHex(_t.value,it);break;case"v2":lt.uniforms[ft].value=new Nr().fromArray(_t.value);break;case"v3":lt.uniforms[ft].value=new Nn().fromArray(_t.value);break;case"v4":lt.uniforms[ft].value=new Cl().fromArray(_t.value);break;case"m3":lt.uniforms[ft].value=new xo().fromArray(_t.value);break;case"m4":lt.uniforms[ft].value=new Ao().fromArray(_t.value);break;default:lt.uniforms[ft].value=_t.value}}if(a.defines!==void 0&&(lt.defines=a.defines),a.vertexShader!==void 0&&(lt.vertexShader=a.vertexShader),a.fragmentShader!==void 0&&(lt.fragmentShader=a.fragmentShader),a.glslVersion!==void 0&&(lt.glslVersion=a.glslVersion),a.extensions!==void 0)for(const ft in a.extensions)lt.extensions[ft]=a.extensions[ft];if(a.lights!==void 0&&(lt.lights=a.lights),a.clipping!==void 0&&(lt.clipping=a.clipping),a.size!==void 0&&(lt.size=a.size),a.sizeAttenuation!==void 0&&(lt.sizeAttenuation=a.sizeAttenuation),a.map!==void 0&&(lt.map=rt(a.map)),a.matcap!==void 0&&(lt.matcap=rt(a.matcap)),a.alphaMap!==void 0&&(lt.alphaMap=rt(a.alphaMap)),a.bumpMap!==void 0&&(lt.bumpMap=rt(a.bumpMap)),a.bumpScale!==void 0&&(lt.bumpScale=a.bumpScale),a.normalMap!==void 0&&(lt.normalMap=rt(a.normalMap)),a.normalMapType!==void 0&&(lt.normalMapType=a.normalMapType),a.normalScale!==void 0){let ft=a.normalScale;Array.isArray(ft)===!1&&(ft=[ft,ft]),lt.normalScale=new Nr().fromArray(ft)}return a.displacementMap!==void 0&&(lt.displacementMap=rt(a.displacementMap)),a.displacementScale!==void 0&&(lt.displacementScale=a.displacementScale),a.displacementBias!==void 0&&(lt.displacementBias=a.displacementBias),a.roughnessMap!==void 0&&(lt.roughnessMap=rt(a.roughnessMap)),a.metalnessMap!==void 0&&(lt.metalnessMap=rt(a.metalnessMap)),a.emissiveMap!==void 0&&(lt.emissiveMap=rt(a.emissiveMap)),a.emissiveIntensity!==void 0&&(lt.emissiveIntensity=a.emissiveIntensity),a.specularMap!==void 0&&(lt.specularMap=rt(a.specularMap)),a.specularIntensityMap!==void 0&&(lt.specularIntensityMap=rt(a.specularIntensityMap)),a.specularColorMap!==void 0&&(lt.specularColorMap=rt(a.specularColorMap)),a.envMap!==void 0&&(lt.envMap=rt(a.envMap)),a.envMapIntensity!==void 0&&(lt.envMapIntensity=a.envMapIntensity),a.reflectivity!==void 0&&(lt.reflectivity=a.reflectivity),a.refractionRatio!==void 0&&(lt.refractionRatio=a.refractionRatio),a.lightMap!==void 0&&(lt.lightMap=rt(a.lightMap)),a.lightMapIntensity!==void 0&&(lt.lightMapIntensity=a.lightMapIntensity),a.aoMap!==void 0&&(lt.aoMap=rt(a.aoMap)),a.aoMapIntensity!==void 0&&(lt.aoMapIntensity=a.aoMapIntensity),a.gradientMap!==void 0&&(lt.gradientMap=rt(a.gradientMap)),a.clearcoatMap!==void 0&&(lt.clearcoatMap=rt(a.clearcoatMap)),a.clearcoatRoughnessMap!==void 0&&(lt.clearcoatRoughnessMap=rt(a.clearcoatRoughnessMap)),a.clearcoatNormalMap!==void 0&&(lt.clearcoatNormalMap=rt(a.clearcoatNormalMap)),a.clearcoatNormalScale!==void 0&&(lt.clearcoatNormalScale=new Nr().fromArray(a.clearcoatNormalScale)),a.iridescenceMap!==void 0&&(lt.iridescenceMap=rt(a.iridescenceMap)),a.iridescenceThicknessMap!==void 0&&(lt.iridescenceThicknessMap=rt(a.iridescenceThicknessMap)),a.transmissionMap!==void 0&&(lt.transmissionMap=rt(a.transmissionMap)),a.thicknessMap!==void 0&&(lt.thicknessMap=rt(a.thicknessMap)),a.sheenColorMap!==void 0&&(lt.sheenColorMap=rt(a.sheenColorMap)),a.sheenRoughnessMap!==void 0&&(lt.sheenRoughnessMap=rt(a.sheenRoughnessMap)),lt}setTextures(a){return this.textures=a,this}static createMaterialFromType(a){return new{ShadowMaterial:SE,SpriteMaterial:oM,RawShaderMaterial:TC,ShaderMaterial:Bv,PointsMaterial:Ew,MeshPhysicalMaterial:J2,MeshStandardMaterial:bM,MeshPhongMaterial:Z2,MeshToonMaterial:wM,MeshNormalMaterial:eP,MeshLambertMaterial:xM,MeshDepthMaterial:_w,MeshDistanceMaterial:vw,MeshBasicMaterial:a_,MeshMatcapMaterial:tP,LineDashedMaterial:EM,LineBasicMaterial:Um,Material:cp}[a]}}class i1{static decodeText(a){if(typeof TextDecoder<"u")return new TextDecoder().decode(a);let _e="";for(let rt=0,it=a.length;rt<it;rt++)_e+=String.fromCharCode(a[rt]);try{return decodeURIComponent(escape(_e))}catch{return _e}}static extractUrlBase(a){const _e=a.lastIndexOf("/");return _e===-1?"./":a.slice(0,_e+1)}static resolveURL(a,_e){return typeof a!="string"||a===""?"":(/^https?:\/\//i.test(_e)&&/^\//.test(a)&&(_e=_e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:_e+a)}}class Gv extends Kt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(a){return super.copy(a),this.instanceCount=a.instanceCount,this}toJSON(){const a=super.toJSON();return a.instanceCount=this.instanceCount,a.isInstancedBufferGeometry=!0,a}}class oP extends O_{constructor(a){super(a)}load(a,_e,rt,it){const lt=this,ft=new wm(lt.manager);ft.setPath(lt.path),ft.setRequestHeader(lt.requestHeader),ft.setWithCredentials(lt.withCredentials),ft.load(a,function(_t){try{_e(lt.parse(JSON.parse(_t)))}catch(St){it?it(St):console.error(St),lt.manager.itemError(a)}},rt,it)}parse(a){const _e={},rt={};function it(Bt,Ot){if(_e[Ot]!==void 0)return _e[Ot];const Lt=Bt.interleavedBuffers[Ot],zt=function($t,rn){if(rt[rn]!==void 0)return rt[rn];const cn=$t.arrayBuffers[rn],Rn=new Uint32Array(cn).buffer;return rt[rn]=Rn,Rn}(Bt,Lt.buffer),Jt=F0(Lt.type,zt),Ht=new Am(Jt,Lt.stride);return Ht.uuid=Lt.uuid,_e[Ot]=Ht,Ht}const lt=a.isInstancedBufferGeometry?new Gv:new Kt,ft=a.data.index;if(ft!==void 0){const Bt=F0(ft.type,ft.array);lt.setIndex(new Hl(Bt,1))}const _t=a.data.attributes;for(const Bt in _t){const Ot=_t[Bt];let Lt;if(Ot.isInterleavedBufferAttribute){const zt=it(a.data,Ot.data);Lt=new oy(zt,Ot.itemSize,Ot.offset,Ot.normalized)}else{const zt=F0(Ot.type,Ot.array);Lt=new(Ot.isInstancedBufferAttribute?bm:Hl)(zt,Ot.itemSize,Ot.normalized)}Ot.name!==void 0&&(Lt.name=Ot.name),Ot.usage!==void 0&&Lt.setUsage(Ot.usage),Ot.updateRange!==void 0&&(Lt.updateRange.offset=Ot.updateRange.offset,Lt.updateRange.count=Ot.updateRange.count),lt.setAttribute(Bt,Lt)}const St=a.data.morphAttributes;if(St)for(const Bt in St){const Ot=St[Bt],Lt=[];for(let zt=0,Jt=Ot.length;zt<Jt;zt++){const Ht=Ot[zt];let $t;if(Ht.isInterleavedBufferAttribute){const rn=it(a.data,Ht.data);$t=new oy(rn,Ht.itemSize,Ht.offset,Ht.normalized)}else{const rn=F0(Ht.type,Ht.array);$t=new Hl(rn,Ht.itemSize,Ht.normalized)}Ht.name!==void 0&&($t.name=Ht.name),Lt.push($t)}lt.morphAttributes[Bt]=Lt}a.data.morphTargetsRelative&&(lt.morphTargetsRelative=!0);const Et=a.data.groups||a.data.drawcalls||a.data.offsets;if(Et!==void 0)for(let Bt=0,Ot=Et.length;Bt!==Ot;++Bt){const Lt=Et[Bt];lt.addGroup(Lt.start,Lt.count,Lt.materialIndex)}const Tt=a.data.boundingSphere;if(Tt!==void 0){const Bt=new Nn;Tt.center!==void 0&&Bt.fromArray(Tt.center),lt.boundingSphere=new s_(Bt,Tt.radius)}return a.name&&(lt.name=a.name),a.userData&&(lt.userData=a.userData),lt}}class vO extends O_{constructor(a){super(a)}load(a,_e,rt,it){const lt=this,ft=this.path===""?i1.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||ft;const _t=new wm(this.manager);_t.setPath(this.path),_t.setRequestHeader(this.requestHeader),_t.setWithCredentials(this.withCredentials),_t.load(a,function(St){let Et=null;try{Et=JSON.parse(St)}catch(Bt){return it!==void 0&&it(Bt),void console.error("THREE:ObjectLoader: Can't parse "+a+".",Bt.message)}const Tt=Et.metadata;if(Tt===void 0||Tt.type===void 0||Tt.type.toLowerCase()==="geometry")return it!==void 0&&it(new Error("THREE.ObjectLoader: Can't load "+a)),void console.error("THREE.ObjectLoader: Can't load "+a);lt.parse(Et,_e)},rt,it)}async loadAsync(a,_e){const rt=this.path===""?i1.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||rt;const it=new wm(this.manager);it.setPath(this.path),it.setRequestHeader(this.requestHeader),it.setWithCredentials(this.withCredentials);const lt=await it.loadAsync(a,_e),ft=JSON.parse(lt),_t=ft.metadata;if(_t===void 0||_t.type===void 0||_t.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+a);return await this.parseAsync(ft)}parse(a,_e){const rt=this.parseAnimations(a.animations),it=this.parseShapes(a.shapes),lt=this.parseGeometries(a.geometries,it),ft=this.parseImages(a.images,function(){_e!==void 0&&_e(Et)}),_t=this.parseTextures(a.textures,ft),St=this.parseMaterials(a.materials,_t),Et=this.parseObject(a.object,lt,St,_t,rt),Tt=this.parseSkeletons(a.skeletons,Et);if(this.bindSkeletons(Et,Tt),_e!==void 0){let Bt=!1;for(const Ot in ft)if(ft[Ot].data instanceof HTMLImageElement){Bt=!0;break}Bt===!1&&_e(Et)}return Et}async parseAsync(a){const _e=this.parseAnimations(a.animations),rt=this.parseShapes(a.shapes),it=this.parseGeometries(a.geometries,rt),lt=await this.parseImagesAsync(a.images),ft=this.parseTextures(a.textures,lt),_t=this.parseMaterials(a.materials,ft),St=this.parseObject(a.object,it,_t,ft,_e),Et=this.parseSkeletons(a.skeletons,St);return this.bindSkeletons(St,Et),St}parseShapes(a){const _e={};if(a!==void 0)for(let rt=0,it=a.length;rt<it;rt++){const lt=new pA().fromJSON(a[rt]);_e[lt.uuid]=lt}return _e}parseSkeletons(a,_e){const rt={},it={};if(_e.traverse(function(lt){lt.isBone&&(it[lt.uuid]=lt)}),a!==void 0)for(let lt=0,ft=a.length;lt<ft;lt++){const _t=new aA().fromJSON(a[lt],it);rt[_t.uuid]=_t}return rt}parseGeometries(a,_e){const rt={};if(a!==void 0){const it=new oP;for(let lt=0,ft=a.length;lt<ft;lt++){let _t;const St=a[lt];switch(St.type){case"BufferGeometry":case"InstancedBufferGeometry":_t=it.parse(St);break;default:St.type in Zx?_t=Zx[St.type].fromJSON(St,_e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${St.type}"`)}_t.uuid=St.uuid,St.name!==void 0&&(_t.name=St.name),St.userData!==void 0&&(_t.userData=St.userData),rt[St.uuid]=_t}}return rt}parseMaterials(a,_e){const rt={},it={};if(a!==void 0){const lt=new r1;lt.setTextures(_e);for(let ft=0,_t=a.length;ft<_t;ft++){const St=a[ft];rt[St.uuid]===void 0&&(rt[St.uuid]=lt.parse(St)),it[St.uuid]=rt[St.uuid]}}return it}parseAnimations(a){const _e={};if(a!==void 0)for(let rt=0;rt<a.length;rt++){const it=a[rt],lt=py.parse(it);_e[lt.uuid]=lt}return _e}parseImages(a,_e){const rt=this,it={};let lt;function ft(_t){if(typeof _t=="string"){const St=_t;return function(Et){return rt.manager.itemStart(Et),lt.load(Et,function(){rt.manager.itemEnd(Et)},void 0,function(){rt.manager.itemError(Et),rt.manager.itemEnd(Et)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(St)?St:rt.resourcePath+St)}return _t.data?{data:F0(_t.type,_t.data),width:_t.width,height:_t.height,complete:!0}:null}if(a!==void 0&&a.length>0){const _t=new PC(_e);lt=new Qu(_t),lt.setCrossOrigin(this.crossOrigin);for(let St=0,Et=a.length;St<Et;St++){const Tt=a[St],Bt=Tt.url;if(Array.isArray(Bt)){const Ot=[];for(let Lt=0,zt=Bt.length;Lt<zt;Lt++){const Jt=ft(Bt[Lt]);Jt!==null&&(Jt instanceof HTMLImageElement?Ot.push(Jt):Ot.push(new zx(Jt.data,Jt.width,Jt.height)))}it[Tt.uuid]=new Rv(Ot)}else{const Ot=ft(Tt.url);it[Tt.uuid]=new Rv(Ot)}}}return it}async parseImagesAsync(a){const _e=this,rt={};let it;async function lt(ft){if(typeof ft=="string"){const _t=ft,St=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(_t)?_t:_e.resourcePath+_t;return await it.loadAsync(St)}return ft.data?{data:F0(ft.type,ft.data),width:ft.width,height:ft.height,complete:!0}:null}if(a!==void 0&&a.length>0){it=new Qu(this.manager),it.setCrossOrigin(this.crossOrigin);for(let ft=0,_t=a.length;ft<_t;ft++){const St=a[ft],Et=St.url;if(Array.isArray(Et)){const Tt=[];for(let Bt=0,Ot=Et.length;Bt<Ot;Bt++){const Lt=Et[Bt],zt=await lt(Lt);zt!==null&&(zt instanceof HTMLImageElement?Tt.push(zt):Tt.push(new zx(zt.data,zt.width,zt.height)))}rt[St.uuid]=new Rv(Tt)}else{const Tt=await lt(St.url);rt[St.uuid]=new Rv(Tt)}}}return rt}parseTextures(a,_e){function rt(lt,ft){return typeof lt=="number"?lt:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",lt),ft[lt])}const it={};if(a!==void 0)for(let lt=0,ft=a.length;lt<ft;lt++){const _t=a[lt];_t.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',_t.uuid),_e[_t.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",_t.image);const St=_e[_t.image],Et=St?St.data:void 0;let Tt;Array.isArray(Et)?(Tt=new lw,Et.length===6&&(Tt.needsUpdate=!0)):(Tt=Et&&Et.data?new zx:new Yl,Et&&Et.complete&&(Tt.needsUpdate=!0)),Tt.source=St,Tt.uuid=_t.uuid,_t.name!==void 0&&(Tt.name=_t.name),_t.mapping!==void 0&&(Tt.mapping=rt(_t.mapping,aP)),_t.channel!==void 0&&(Tt.channel=_t.channel),_t.offset!==void 0&&Tt.offset.fromArray(_t.offset),_t.repeat!==void 0&&Tt.repeat.fromArray(_t.repeat),_t.center!==void 0&&Tt.center.fromArray(_t.center),_t.rotation!==void 0&&(Tt.rotation=_t.rotation),_t.wrap!==void 0&&(Tt.wrapS=rt(_t.wrap[0],BC),Tt.wrapT=rt(_t.wrap[1],BC)),_t.format!==void 0&&(Tt.format=_t.format),_t.internalFormat!==void 0&&(Tt.internalFormat=_t.internalFormat),_t.type!==void 0&&(Tt.type=_t.type),_t.colorSpace!==void 0?Tt.colorSpace=_t.colorSpace:_t.encoding!==void 0&&(Tt.encoding=_t.encoding),_t.minFilter!==void 0&&(Tt.minFilter=rt(_t.minFilter,DM)),_t.magFilter!==void 0&&(Tt.magFilter=rt(_t.magFilter,DM)),_t.anisotropy!==void 0&&(Tt.anisotropy=_t.anisotropy),_t.flipY!==void 0&&(Tt.flipY=_t.flipY),_t.generateMipmaps!==void 0&&(Tt.generateMipmaps=_t.generateMipmaps),_t.premultiplyAlpha!==void 0&&(Tt.premultiplyAlpha=_t.premultiplyAlpha),_t.unpackAlignment!==void 0&&(Tt.unpackAlignment=_t.unpackAlignment),_t.userData!==void 0&&(Tt.userData=_t.userData),it[_t.uuid]=Tt}return it}parseObject(a,_e,rt,it,lt){let ft;const _t=a.metadata&&a.metadata.version<=4.5?yo:void 0;function St(Lt){return _e[Lt]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",Lt),_e[Lt]}function Et(Lt){if(Lt!==void 0){if(Array.isArray(Lt)){const zt=[];for(let Jt=0,Ht=Lt.length;Jt<Ht;Jt++){const $t=Lt[Jt];rt[$t]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",$t),zt.push(rt[$t])}return zt}return rt[Lt]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Lt),rt[Lt]}}function Tt(Lt){return it[Lt]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",Lt),it[Lt]}let Bt,Ot;switch(a.type){case"Scene":ft=new D_,a.background!==void 0&&(Number.isInteger(a.background)?ft.background=new ps().setHex(a.background,_t):ft.background=Tt(a.background)),a.environment!==void 0&&(ft.environment=Tt(a.environment)),a.fog!==void 0&&(a.fog.type==="Fog"?ft.fog=new Aw(a.fog.color,a.fog.near,a.fog.far):a.fog.type==="FogExp2"&&(ft.fog=new yw(a.fog.color,a.fog.density))),a.backgroundBlurriness!==void 0&&(ft.backgroundBlurriness=a.backgroundBlurriness),a.backgroundIntensity!==void 0&&(ft.backgroundIntensity=a.backgroundIntensity);break;case"PerspectiveCamera":ft=new rm(a.fov,a.aspect,a.near,a.far),a.focus!==void 0&&(ft.focus=a.focus),a.zoom!==void 0&&(ft.zoom=a.zoom),a.filmGauge!==void 0&&(ft.filmGauge=a.filmGauge),a.filmOffset!==void 0&&(ft.filmOffset=a.filmOffset),a.view!==void 0&&(ft.view=Object.assign({},a.view));break;case"OrthographicCamera":ft=new HS(a.left,a.right,a.top,a.bottom,a.near,a.far),a.zoom!==void 0&&(ft.zoom=a.zoom),a.view!==void 0&&(ft.view=Object.assign({},a.view));break;case"AmbientLight":ft=new ME(a.color,a.intensity);break;case"DirectionalLight":ft=new PM(a.color,a.intensity);break;case"PointLight":ft=new Bw(a.color,a.intensity,a.distance,a.decay);break;case"RectAreaLight":ft=new RM(a.color,a.intensity,a.width,a.height);break;case"SpotLight":ft=new IM(a.color,a.intensity,a.distance,a.angle,a.penumbra,a.decay);break;case"HemisphereLight":ft=new zm(a.color,a.groundColor,a.intensity);break;case"LightProbe":ft=new E0().fromJSON(a);break;case"SkinnedMesh":Bt=St(a.geometry),Ot=Et(a.material),ft=new d_(Bt,Ot),a.bindMode!==void 0&&(ft.bindMode=a.bindMode),a.bindMatrix!==void 0&&ft.bindMatrix.fromArray(a.bindMatrix),a.skeleton!==void 0&&(ft.skeleton=a.skeleton);break;case"Mesh":Bt=St(a.geometry),Ot=Et(a.material),ft=new hp(Bt,Ot);break;case"InstancedMesh":Bt=St(a.geometry),Ot=Et(a.material);const Lt=a.count,zt=a.instanceMatrix,Jt=a.instanceColor;ft=new z2(Bt,Ot,Lt),ft.instanceMatrix=new bm(new Float32Array(zt.array),16),Jt!==void 0&&(ft.instanceColor=new bm(new Float32Array(Jt.array),Jt.itemSize));break;case"LOD":ft=new jx;break;case"Line":ft=new Tl(St(a.geometry),Et(a.material));break;case"LineLoop":ft=new lv(St(a.geometry),Et(a.material));break;case"LineSegments":ft=new av(St(a.geometry),Et(a.material));break;case"PointCloud":case"Points":ft=new fC(St(a.geometry),Et(a.material));break;case"Sprite":ft=new ay(Et(a.material));break;case"Group":ft=new pp;break;case"Bone":ft=new Hp;break;default:ft=new ga}if(ft.uuid=a.uuid,a.name!==void 0&&(ft.name=a.name),a.matrix!==void 0?(ft.matrix.fromArray(a.matrix),a.matrixAutoUpdate!==void 0&&(ft.matrixAutoUpdate=a.matrixAutoUpdate),ft.matrixAutoUpdate&&ft.matrix.decompose(ft.position,ft.quaternion,ft.scale)):(a.position!==void 0&&ft.position.fromArray(a.position),a.rotation!==void 0&&ft.rotation.fromArray(a.rotation),a.quaternion!==void 0&&ft.quaternion.fromArray(a.quaternion),a.scale!==void 0&&ft.scale.fromArray(a.scale)),a.up!==void 0&&ft.up.fromArray(a.up),a.castShadow!==void 0&&(ft.castShadow=a.castShadow),a.receiveShadow!==void 0&&(ft.receiveShadow=a.receiveShadow),a.shadow&&(a.shadow.bias!==void 0&&(ft.shadow.bias=a.shadow.bias),a.shadow.normalBias!==void 0&&(ft.shadow.normalBias=a.shadow.normalBias),a.shadow.radius!==void 0&&(ft.shadow.radius=a.shadow.radius),a.shadow.mapSize!==void 0&&ft.shadow.mapSize.fromArray(a.shadow.mapSize),a.shadow.camera!==void 0&&(ft.shadow.camera=this.parseObject(a.shadow.camera))),a.visible!==void 0&&(ft.visible=a.visible),a.frustumCulled!==void 0&&(ft.frustumCulled=a.frustumCulled),a.renderOrder!==void 0&&(ft.renderOrder=a.renderOrder),a.userData!==void 0&&(ft.userData=a.userData),a.layers!==void 0&&(ft.layers.mask=a.layers),a.children!==void 0){const Lt=a.children;for(let zt=0;zt<Lt.length;zt++)ft.add(this.parseObject(Lt[zt],_e,rt,it,lt))}if(a.animations!==void 0){const Lt=a.animations;for(let zt=0;zt<Lt.length;zt++){const Jt=Lt[zt];ft.animations.push(lt[Jt])}}if(a.type==="LOD"){a.autoUpdate!==void 0&&(ft.autoUpdate=a.autoUpdate);const Lt=a.levels;for(let zt=0;zt<Lt.length;zt++){const Jt=Lt[zt],Ht=ft.getObjectByProperty("uuid",Jt.object);Ht!==void 0&&ft.addLevel(Ht,Jt.distance,Jt.hysteresis)}}return ft}bindSkeletons(a,_e){Object.keys(_e).length!==0&&a.traverse(function(rt){if(rt.isSkinnedMesh===!0&&rt.skeleton!==void 0){const it=_e[rt.skeleton];it===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",rt.skeleton):rt.bind(it,rt.bindMatrix)}})}}const aP={UVMapping:wo,CubeReflectionMapping:Pl,CubeRefractionMapping:xa,EquirectangularReflectionMapping:Bl,EquirectangularRefractionMapping:po,CubeUVReflectionMapping:Go},BC={RepeatWrapping:su,ClampToEdgeWrapping:Ho,MirroredRepeatWrapping:ou},DM={NearestFilter:Uo,NearestMipmapNearestFilter:au,NearestMipmapLinearFilter:Ap,LinearFilter:xl,LinearMipmapNearestFilter:fu,LinearMipmapLinearFilter:Gl};class Hv extends O_{constructor(a){super(a),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(a){return this.options=a,this}load(a,_e,rt,it){a===void 0&&(a=""),this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const lt=this;Hu.get(a,"blob").then(ft=>{if(ft!==void 0)return lt.manager.itemStart(a),void createImageBitmap(ft,Object.assign(lt.options,{colorSpaceConversion:"none"})).then(function(St){_e&&_e(St),lt.manager.itemEnd(a)}).catch(function(St){it&&it(St),lt.manager.itemError(a),lt.manager.itemEnd(a)});const _t={};_t.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",_t.headers=this.requestHeader,fetch(a,_t).then(function(St){return St.blob()}).then(function(St){return Hu.add(a,St,"blob"),createImageBitmap(St,Object.assign(lt.options,{colorSpaceConversion:"none"}))}).then(function(St){_e&&_e(St),lt.manager.itemEnd(a)}).catch(function(St){it&&it(St),lt.manager.itemError(a),lt.manager.itemEnd(a)}),lt.manager.itemStart(a)})}}let LC;class kM{static getContext(){return LC===void 0&&(LC=new(window.AudioContext||window.webkitAudioContext)),LC}static setContext(a){LC=a}}class lP extends O_{constructor(a){super(a)}load(a,_e,rt,it){const lt=this,ft=new wm(this.manager);function _t(St){it?it(St):console.error(St),lt.manager.itemError(a)}ft.setResponseType("arraybuffer"),ft.setPath(this.path),ft.setRequestHeader(this.requestHeader),ft.setWithCredentials(this.withCredentials),ft.load(a,function(St){try{const Et=St.slice(0);kM.getContext().decodeAudioData(Et,function(Tt){_e(Tt)},_t)}catch(Et){_t(Et)}},rt,it)}}class hv extends E0{constructor(a,_e,rt=1){super(void 0,rt),this.isHemisphereLightProbe=!0;const it=new ps().set(a),lt=new ps().set(_e),ft=new Nn(it.r,it.g,it.b),_t=new Nn(lt.r,lt.g,lt.b),St=Math.sqrt(Math.PI),Et=St*Math.sqrt(.75);this.sh.coefficients[0].copy(ft).add(_t).multiplyScalar(St),this.sh.coefficients[1].copy(ft).sub(_t).multiplyScalar(Et)}}class OM extends E0{constructor(a,_e=1){super(void 0,_e),this.isAmbientLightProbe=!0;const rt=new ps().set(a);this.sh.coefficients[0].set(rt.r,rt.g,rt.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const cP=new Ao,uP=new Ao,Lw=new Ao;class yO{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new rm,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new rm,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(a){const _e=this._cache;if(_e.focus!==a.focus||_e.fov!==a.fov||_e.aspect!==a.aspect*this.aspect||_e.near!==a.near||_e.far!==a.far||_e.zoom!==a.zoom||_e.eyeSep!==this.eyeSep){_e.focus=a.focus,_e.fov=a.fov,_e.aspect=a.aspect*this.aspect,_e.near=a.near,_e.far=a.far,_e.zoom=a.zoom,_e.eyeSep=this.eyeSep,Lw.copy(a.projectionMatrix);const rt=_e.eyeSep/2,it=rt*_e.near/_e.focus,lt=_e.near*Math.tan(Iv*_e.fov*.5)/_e.zoom;let ft,_t;uP.elements[12]=-rt,cP.elements[12]=rt,ft=-lt*_e.aspect+it,_t=lt*_e.aspect+it,Lw.elements[0]=2*_e.near/(_t-ft),Lw.elements[8]=(_t+ft)/(_t-ft),this.cameraL.projectionMatrix.copy(Lw),ft=-lt*_e.aspect-it,_t=lt*_e.aspect-it,Lw.elements[0]=2*_e.near/(_t-ft),Lw.elements[8]=(_t+ft)/(_t-ft),this.cameraR.projectionMatrix.copy(Lw)}this.cameraL.matrixWorld.copy(a.matrixWorld).multiply(uP),this.cameraR.matrixWorld.copy(a.matrixWorld).multiply(cP)}}class s1{constructor(a=!0){this.autoStart=a,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=xm(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let a=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const _e=xm();a=(_e-this.oldTime)/1e3,this.oldTime=_e,this.elapsedTime+=a}return a}}function xm(){return(typeof performance>"u"?Date:performance).now()}const vA=new Nn,NC=new _m,my=new Nn,gy=new Nn;class BM extends ga{constructor(){super(),this.type="AudioListener",this.context=kM.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new s1}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(a){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=a,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(a){return this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01),this}updateMatrixWorld(a){super.updateMatrixWorld(a);const _e=this.context.listener,rt=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(vA,NC,my),gy.set(0,0,-1).applyQuaternion(NC),_e.positionX){const it=this.context.currentTime+this.timeDelta;_e.positionX.linearRampToValueAtTime(vA.x,it),_e.positionY.linearRampToValueAtTime(vA.y,it),_e.positionZ.linearRampToValueAtTime(vA.z,it),_e.forwardX.linearRampToValueAtTime(gy.x,it),_e.forwardY.linearRampToValueAtTime(gy.y,it),_e.forwardZ.linearRampToValueAtTime(gy.z,it),_e.upX.linearRampToValueAtTime(rt.x,it),_e.upY.linearRampToValueAtTime(rt.y,it),_e.upZ.linearRampToValueAtTime(rt.z,it)}else _e.setPosition(vA.x,vA.y,vA.z),_e.setOrientation(gy.x,gy.y,gy.z,rt.x,rt.y,rt.z)}}class hP extends ga{constructor(a){super(),this.type="Audio",this.listener=a,this.context=a.context,this.gain=this.context.createGain(),this.gain.connect(a.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(a){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=a,this.connect(),this}setMediaElementSource(a){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(a),this.connect(),this}setMediaStreamSource(a){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(a),this.connect(),this}setBuffer(a){return this.buffer=a,this.sourceType="buffer",this.autoplay&&this.play(),this}play(a=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+a;const _e=this.context.createBufferSource();return _e.buffer=this.buffer,_e.loop=this.loop,_e.loopStart=this.loopStart,_e.loopEnd=this.loopEnd,_e.onended=this.onEnded.bind(this),_e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=_e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let a=1,_e=this.filters.length;a<_e;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let a=1,_e=this.filters.length;a<_e;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(a){return a||(a=[]),this._connected===!0?(this.disconnect(),this.filters=a.slice(),this.connect()):this.filters=a.slice(),this}setDetune(a){if(this.detune=a,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(a){return this.setFilters(a?[a]:[])}setPlaybackRate(a){if(this.hasPlaybackControl!==!1)return this.playbackRate=a,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(a){if(this.hasPlaybackControl!==!1)return this.loop=a,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(a){return this.loopStart=a,this}setLoopEnd(a){return this.loopEnd=a,this}getVolume(){return this.gain.gain.value}setVolume(a){return this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01),this}}const yA=new Nn,UC=new _m,LM=new Nn,_y=new Nn;class S0 extends hP{constructor(a){super(a),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(a){return this.panner.refDistance=a,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(a){return this.panner.rolloffFactor=a,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(a){return this.panner.distanceModel=a,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(a){return this.panner.maxDistance=a,this}setDirectionalCone(a,_e,rt){return this.panner.coneInnerAngle=a,this.panner.coneOuterAngle=_e,this.panner.coneOuterGain=rt,this}updateMatrixWorld(a){if(super.updateMatrixWorld(a),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(yA,UC,LM),_y.set(0,0,1).applyQuaternion(UC);const _e=this.panner;if(_e.positionX){const rt=this.context.currentTime+this.listener.timeDelta;_e.positionX.linearRampToValueAtTime(yA.x,rt),_e.positionY.linearRampToValueAtTime(yA.y,rt),_e.positionZ.linearRampToValueAtTime(yA.z,rt),_e.orientationX.linearRampToValueAtTime(_y.x,rt),_e.orientationY.linearRampToValueAtTime(_y.y,rt),_e.orientationZ.linearRampToValueAtTime(_y.z,rt)}else _e.setPosition(yA.x,yA.y,yA.z),_e.setOrientation(_y.x,_y.y,_y.z)}}class dP{constructor(a,_e=2048){this.analyser=a.context.createAnalyser(),this.analyser.fftSize=_e,this.data=new Uint8Array(this.analyser.frequencyBinCount),a.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let a=0;const _e=this.getFrequencyData();for(let rt=0;rt<_e.length;rt++)a+=_e[rt];return a/_e.length}}class FC{constructor(a,_e,rt){let it,lt,ft;switch(this.binding=a,this.valueSize=rt,_e){case"quaternion":it=this._slerp,lt=this._slerpAdditive,ft=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*rt),this._workIndex=5;break;case"string":case"bool":it=this._select,lt=this._select,ft=this._setAdditiveIdentityOther,this.buffer=new Array(5*rt);break;default:it=this._lerp,lt=this._lerpAdditive,ft=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*rt)}this._mixBufferRegion=it,this._mixBufferRegionAdditive=lt,this._setIdentity=ft,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(a,_e){const rt=this.buffer,it=this.valueSize,lt=a*it+it;let ft=this.cumulativeWeight;if(ft===0){for(let _t=0;_t!==it;++_t)rt[lt+_t]=rt[_t];ft=_e}else{ft+=_e;const _t=_e/ft;this._mixBufferRegion(rt,lt,0,_t,it)}this.cumulativeWeight=ft}accumulateAdditive(a){const _e=this.buffer,rt=this.valueSize,it=rt*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(_e,it,0,a,rt),this.cumulativeWeightAdditive+=a}apply(a){const _e=this.valueSize,rt=this.buffer,it=a*_e+_e,lt=this.cumulativeWeight,ft=this.cumulativeWeightAdditive,_t=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,lt<1){const St=_e*this._origIndex;this._mixBufferRegion(rt,it,St,1-lt,_e)}ft>0&&this._mixBufferRegionAdditive(rt,it,this._addIndex*_e,1,_e);for(let St=_e,Et=_e+_e;St!==Et;++St)if(rt[St]!==rt[St+_e]){_t.setValue(rt,it);break}}saveOriginalState(){const a=this.binding,_e=this.buffer,rt=this.valueSize,it=rt*this._origIndex;a.getValue(_e,it);for(let lt=rt,ft=it;lt!==ft;++lt)_e[lt]=_e[it+lt%rt];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const a=3*this.valueSize;this.binding.setValue(this.buffer,a)}_setAdditiveIdentityNumeric(){const a=this._addIndex*this.valueSize,_e=a+this.valueSize;for(let rt=a;rt<_e;rt++)this.buffer[rt]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const a=this._origIndex*this.valueSize,_e=this._addIndex*this.valueSize;for(let rt=0;rt<this.valueSize;rt++)this.buffer[_e+rt]=this.buffer[a+rt]}_select(a,_e,rt,it,lt){if(it>=.5)for(let ft=0;ft!==lt;++ft)a[_e+ft]=a[rt+ft]}_slerp(a,_e,rt,it){_m.slerpFlat(a,_e,a,_e,a,rt,it)}_slerpAdditive(a,_e,rt,it,lt){const ft=this._workIndex*lt;_m.multiplyQuaternionsFlat(a,ft,a,_e,a,rt),_m.slerpFlat(a,_e,a,_e,a,ft,it)}_lerp(a,_e,rt,it,lt){const ft=1-it;for(let _t=0;_t!==lt;++_t){const St=_e+_t;a[St]=a[St]*ft+a[rt+_t]*it}}_lerpAdditive(a,_e,rt,it,lt){for(let ft=0;ft!==lt;++ft){const _t=_e+ft;a[_t]=a[_t]+a[rt+ft]*it}}}const NM="\\[\\]\\.:\\/",UM=new RegExp("["+NM+"]","g"),AA="[^"+NM+"]",AO="[^"+NM.replace("\\.","")+"]",vy=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",AA)+/(WCOD+)?/.source.replace("WCOD",AO)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",AA)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",AA)+"$"),pP=["material","materials","bones","map"];class Ml{constructor(a,_e,rt){this.path=_e,this.parsedPath=rt||Ml.parseTrackName(_e),this.node=Ml.findNode(a,this.parsedPath.nodeName),this.rootNode=a,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(a,_e,rt){return a&&a.isAnimationObjectGroup?new Ml.Composite(a,_e,rt):new Ml(a,_e,rt)}static sanitizeNodeName(a){return a.replace(/\s/g,"_").replace(UM,"")}static parseTrackName(a){const _e=vy.exec(a);if(_e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+a);const rt={nodeName:_e[2],objectName:_e[3],objectIndex:_e[4],propertyName:_e[5],propertyIndex:_e[6]},it=rt.nodeName&&rt.nodeName.lastIndexOf(".");if(it!==void 0&&it!==-1){const lt=rt.nodeName.substring(it+1);pP.indexOf(lt)!==-1&&(rt.nodeName=rt.nodeName.substring(0,it),rt.objectName=lt)}if(rt.propertyName===null||rt.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+a);return rt}static findNode(a,_e){if(_e===void 0||_e===""||_e==="."||_e===-1||_e===a.name||_e===a.uuid)return a;if(a.skeleton){const rt=a.skeleton.getBoneByName(_e);if(rt!==void 0)return rt}if(a.children){const rt=function(lt){for(let ft=0;ft<lt.length;ft++){const _t=lt[ft];if(_t.name===_e||_t.uuid===_e)return _t;const St=rt(_t.children);if(St)return St}return null},it=rt(a.children);if(it)return it}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(a,_e){a[_e]=this.targetObject[this.propertyName]}_getValue_array(a,_e){const rt=this.resolvedProperty;for(let it=0,lt=rt.length;it!==lt;++it)a[_e++]=rt[it]}_getValue_arrayElement(a,_e){a[_e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(a,_e){this.resolvedProperty.toArray(a,_e)}_setValue_direct(a,_e){this.targetObject[this.propertyName]=a[_e]}_setValue_direct_setNeedsUpdate(a,_e){this.targetObject[this.propertyName]=a[_e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(a,_e){this.targetObject[this.propertyName]=a[_e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(a,_e){const rt=this.resolvedProperty;for(let it=0,lt=rt.length;it!==lt;++it)rt[it]=a[_e++]}_setValue_array_setNeedsUpdate(a,_e){const rt=this.resolvedProperty;for(let it=0,lt=rt.length;it!==lt;++it)rt[it]=a[_e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(a,_e){const rt=this.resolvedProperty;for(let it=0,lt=rt.length;it!==lt;++it)rt[it]=a[_e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(a,_e){this.resolvedProperty[this.propertyIndex]=a[_e]}_setValue_arrayElement_setNeedsUpdate(a,_e){this.resolvedProperty[this.propertyIndex]=a[_e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(a,_e){this.resolvedProperty[this.propertyIndex]=a[_e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(a,_e){this.resolvedProperty.fromArray(a,_e)}_setValue_fromArray_setNeedsUpdate(a,_e){this.resolvedProperty.fromArray(a,_e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(a,_e){this.resolvedProperty.fromArray(a,_e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(a,_e){this.bind(),this.getValue(a,_e)}_setValue_unbound(a,_e){this.bind(),this.setValue(a,_e)}bind(){let a=this.node;const _e=this.parsedPath,rt=_e.objectName,it=_e.propertyName;let lt=_e.propertyIndex;if(a||(a=Ml.findNode(this.rootNode,_e.nodeName),this.node=a),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!a)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(rt){let Et=_e.objectIndex;switch(rt){case"materials":if(!a.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!a.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);a=a.material.materials;break;case"bones":if(!a.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);a=a.skeleton.bones;for(let Tt=0;Tt<a.length;Tt++)if(a[Tt].name===Et){Et=Tt;break}break;case"map":if("map"in a){a=a.map;break}if(!a.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!a.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);a=a.material.map;break;default:if(a[rt]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);a=a[rt]}if(Et!==void 0){if(a[Et]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,a);a=a[Et]}}const ft=a[it];if(ft===void 0){const Et=_e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+Et+"."+it+" but it wasn't found.",a)}let _t=this.Versioning.None;this.targetObject=a,a.needsUpdate!==void 0?_t=this.Versioning.NeedsUpdate:a.matrixWorldNeedsUpdate!==void 0&&(_t=this.Versioning.MatrixWorldNeedsUpdate);let St=this.BindingType.Direct;if(lt!==void 0){if(it==="morphTargetInfluences"){if(!a.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!a.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);a.morphTargetDictionary[lt]!==void 0&&(lt=a.morphTargetDictionary[lt])}St=this.BindingType.ArrayElement,this.resolvedProperty=ft,this.propertyIndex=lt}else ft.fromArray!==void 0&&ft.toArray!==void 0?(St=this.BindingType.HasFromToArray,this.resolvedProperty=ft):Array.isArray(ft)?(St=this.BindingType.EntireArray,this.resolvedProperty=ft):this.propertyName=it;this.getValue=this.GetterByBindingType[St],this.setValue=this.SetterByBindingTypeAndVersioning[St][_t]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ml.Composite=class{constructor(pt,a,_e){const rt=_e||Ml.parseTrackName(a);this._targetGroup=pt,this._bindings=pt.subscribe_(a,rt)}getValue(pt,a){this.bind();const _e=this._targetGroup.nCachedObjects_,rt=this._bindings[_e];rt!==void 0&&rt.getValue(pt,a)}setValue(pt,a){const _e=this._bindings;for(let rt=this._targetGroup.nCachedObjects_,it=_e.length;rt!==it;++rt)_e[rt].setValue(pt,a)}bind(){const pt=this._bindings;for(let a=this._targetGroup.nCachedObjects_,_e=pt.length;a!==_e;++a)pt[a].bind()}unbind(){const pt=this._bindings;for(let a=this._targetGroup.nCachedObjects_,_e=pt.length;a!==_e;++a)pt[a].unbind()}},Ml.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ml.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ml.prototype.GetterByBindingType=[Ml.prototype._getValue_direct,Ml.prototype._getValue_array,Ml.prototype._getValue_arrayElement,Ml.prototype._getValue_toArray],Ml.prototype.SetterByBindingTypeAndVersioning=[[Ml.prototype._setValue_direct,Ml.prototype._setValue_direct_setNeedsUpdate,Ml.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ml.prototype._setValue_array,Ml.prototype._setValue_array_setNeedsUpdate,Ml.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ml.prototype._setValue_arrayElement,Ml.prototype._setValue_arrayElement_setNeedsUpdate,Ml.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ml.prototype._setValue_fromArray,Ml.prototype._setValue_fromArray_setNeedsUpdate,Ml.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class bO{constructor(){this.isAnimationObjectGroup=!0,this.uuid=mm(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const a={};this._indicesByUUID=a;for(let rt=0,it=arguments.length;rt!==it;++rt)a[arguments[rt].uuid]=rt;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const _e=this;this.stats={objects:{get total(){return _e._objects.length},get inUse(){return this.total-_e.nCachedObjects_}},get bindingsPerObject(){return _e._bindings.length}}}add(){const a=this._objects,_e=this._indicesByUUID,rt=this._paths,it=this._parsedPaths,lt=this._bindings,ft=lt.length;let _t,St=a.length,Et=this.nCachedObjects_;for(let Tt=0,Bt=arguments.length;Tt!==Bt;++Tt){const Ot=arguments[Tt],Lt=Ot.uuid;let zt=_e[Lt];if(zt===void 0){zt=St++,_e[Lt]=zt,a.push(Ot);for(let Jt=0,Ht=ft;Jt!==Ht;++Jt)lt[Jt].push(new Ml(Ot,rt[Jt],it[Jt]))}else if(zt<Et){_t=a[zt];const Jt=--Et,Ht=a[Jt];_e[Ht.uuid]=zt,a[zt]=Ht,_e[Lt]=Jt,a[Jt]=Ot;for(let $t=0,rn=ft;$t!==rn;++$t){const cn=lt[$t],Rn=cn[Jt];let Cn=cn[zt];cn[zt]=Rn,Cn===void 0&&(Cn=new Ml(Ot,rt[$t],it[$t])),cn[Jt]=Cn}}else a[zt]!==_t&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=Et}remove(){const a=this._objects,_e=this._indicesByUUID,rt=this._bindings,it=rt.length;let lt=this.nCachedObjects_;for(let ft=0,_t=arguments.length;ft!==_t;++ft){const St=arguments[ft],Et=St.uuid,Tt=_e[Et];if(Tt!==void 0&&Tt>=lt){const Bt=lt++,Ot=a[Bt];_e[Ot.uuid]=Tt,a[Tt]=Ot,_e[Et]=Bt,a[Bt]=St;for(let Lt=0,zt=it;Lt!==zt;++Lt){const Jt=rt[Lt],Ht=Jt[Bt],$t=Jt[Tt];Jt[Tt]=Ht,Jt[Bt]=$t}}}this.nCachedObjects_=lt}uncache(){const a=this._objects,_e=this._indicesByUUID,rt=this._bindings,it=rt.length;let lt=this.nCachedObjects_,ft=a.length;for(let _t=0,St=arguments.length;_t!==St;++_t){const Et=arguments[_t].uuid,Tt=_e[Et];if(Tt!==void 0)if(delete _e[Et],Tt<lt){const Bt=--lt,Ot=a[Bt],Lt=--ft,zt=a[Lt];_e[Ot.uuid]=Tt,a[Tt]=Ot,_e[zt.uuid]=Bt,a[Bt]=zt,a.pop();for(let Jt=0,Ht=it;Jt!==Ht;++Jt){const $t=rt[Jt],rn=$t[Bt],cn=$t[Lt];$t[Tt]=rn,$t[Bt]=cn,$t.pop()}}else{const Bt=--ft,Ot=a[Bt];Bt>0&&(_e[Ot.uuid]=Tt),a[Tt]=Ot,a.pop();for(let Lt=0,zt=it;Lt!==zt;++Lt){const Jt=rt[Lt];Jt[Tt]=Jt[Bt],Jt.pop()}}}this.nCachedObjects_=lt}subscribe_(a,_e){const rt=this._bindingsIndicesByPath;let it=rt[a];const lt=this._bindings;if(it!==void 0)return lt[it];const ft=this._paths,_t=this._parsedPaths,St=this._objects,Et=St.length,Tt=this.nCachedObjects_,Bt=new Array(Et);it=lt.length,rt[a]=it,ft.push(a),_t.push(_e),lt.push(Bt);for(let Ot=Tt,Lt=St.length;Ot!==Lt;++Ot){const zt=St[Ot];Bt[Ot]=new Ml(zt,a,_e)}return Bt}unsubscribe_(a){const _e=this._bindingsIndicesByPath,rt=_e[a];if(rt!==void 0){const it=this._paths,lt=this._parsedPaths,ft=this._bindings,_t=ft.length-1,St=ft[_t];_e[a[_t]]=rt,ft[rt]=St,ft.pop(),lt[rt]=lt[_t],lt.pop(),it[rt]=it[_t],it.pop()}}}class fP{constructor(a,_e,rt=null,it=_e.blendMode){this._mixer=a,this._clip=_e,this._localRoot=rt,this.blendMode=it;const lt=_e.tracks,ft=lt.length,_t=new Array(ft),St={endingStart:i0,endingEnd:i0};for(let Et=0;Et!==ft;++Et){const Tt=lt[Et].createInterpolant(null);_t[Et]=Tt,Tt.settings=St}this._interpolantSettings=St,this._interpolants=_t,this._propertyBindings=new Array(ft),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Q_,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(a){return this._startTime=a,this}setLoop(a,_e){return this.loop=a,this.repetitions=_e,this}setEffectiveWeight(a){return this.weight=a,this._effectiveWeight=this.enabled?a:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(a){return this._scheduleFading(a,0,1)}fadeOut(a){return this._scheduleFading(a,1,0)}crossFadeFrom(a,_e,rt){if(a.fadeOut(_e),this.fadeIn(_e),rt){const it=this._clip.duration,lt=a._clip.duration,ft=lt/it,_t=it/lt;a.warp(1,ft,_e),this.warp(_t,1,_e)}return this}crossFadeTo(a,_e,rt){return a.crossFadeFrom(this,_e,rt)}stopFading(){const a=this._weightInterpolant;return a!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this}setEffectiveTimeScale(a){return this.timeScale=a,this._effectiveTimeScale=this.paused?0:a,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(a){return this.timeScale=this._clip.duration/a,this.stopWarping()}syncWith(a){return this.time=a.time,this.timeScale=a.timeScale,this.stopWarping()}halt(a){return this.warp(this._effectiveTimeScale,0,a)}warp(a,_e,rt){const it=this._mixer,lt=it.time,ft=this.timeScale;let _t=this._timeScaleInterpolant;_t===null&&(_t=it._lendControlInterpolant(),this._timeScaleInterpolant=_t);const St=_t.parameterPositions,Et=_t.sampleValues;return St[0]=lt,St[1]=lt+rt,Et[0]=a/ft,Et[1]=_e/ft,this}stopWarping(){const a=this._timeScaleInterpolant;return a!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(a,_e,rt,it){if(!this.enabled)return void this._updateWeight(a);const lt=this._startTime;if(lt!==null){const St=(a-lt)*rt;St<0||rt===0?_e=0:(this._startTime=null,_e=rt*St)}_e*=this._updateTimeScale(a);const ft=this._updateTime(_e),_t=this._updateWeight(a);if(_t>0){const St=this._interpolants,Et=this._propertyBindings;if(this.blendMode===Sl)for(let Tt=0,Bt=St.length;Tt!==Bt;++Tt)St[Tt].evaluate(ft),Et[Tt].accumulateAdditive(_t);else for(let Tt=0,Bt=St.length;Tt!==Bt;++Tt)St[Tt].evaluate(ft),Et[Tt].accumulate(it,_t)}}_updateWeight(a){let _e=0;if(this.enabled){_e=this.weight;const rt=this._weightInterpolant;if(rt!==null){const it=rt.evaluate(a)[0];_e*=it,a>rt.parameterPositions[1]&&(this.stopFading(),it===0&&(this.enabled=!1))}}return this._effectiveWeight=_e,_e}_updateTimeScale(a){let _e=0;if(!this.paused){_e=this.timeScale;const rt=this._timeScaleInterpolant;rt!==null&&(_e*=rt.evaluate(a)[0],a>rt.parameterPositions[1]&&(this.stopWarping(),_e===0?this.paused=!0:this.timeScale=_e))}return this._effectiveTimeScale=_e,_e}_updateTime(a){const _e=this._clip.duration,rt=this.loop;let it=this.time+a,lt=this._loopCount;const ft=rt===Rm;if(a===0)return lt===-1?it:ft&&(1&lt)==1?_e-it:it;if(rt===By){lt===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(it>=_e)it=_e;else{if(!(it<0)){this.time=it;break e}it=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=it,this._mixer.dispatchEvent({type:"finished",action:this,direction:a<0?-1:1})}}else{if(lt===-1&&(a>=0?(lt=0,this._setEndings(!0,this.repetitions===0,ft)):this._setEndings(this.repetitions===0,!0,ft)),it>=_e||it<0){const _t=Math.floor(it/_e);it-=_e*_t,lt+=Math.abs(_t);const St=this.repetitions-lt;if(St<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,it=a>0?_e:0,this.time=it,this._mixer.dispatchEvent({type:"finished",action:this,direction:a>0?1:-1});else{if(St===1){const Et=a<0;this._setEndings(Et,!Et,ft)}else this._setEndings(!1,!1,ft);this._loopCount=lt,this.time=it,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:_t})}}else this.time=it;if(ft&&(1&lt)==1)return _e-it}return it}_setEndings(a,_e,rt){const it=this._interpolantSettings;rt?(it.endingStart=Mv,it.endingEnd=Mv):(it.endingStart=a?this.zeroSlopeAtStart?Mv:i0:Ly,it.endingEnd=_e?this.zeroSlopeAtEnd?Mv:i0:Ly)}_scheduleFading(a,_e,rt){const it=this._mixer,lt=it.time;let ft=this._weightInterpolant;ft===null&&(ft=it._lendControlInterpolant(),this._weightInterpolant=ft);const _t=ft.parameterPositions,St=ft.sampleValues;return _t[0]=lt,St[0]=_e,_t[1]=lt+a,St[1]=rt,this}}const wO=new Float32Array(1);class xO extends x_{constructor(a){super(),this._root=a,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(a,_e){const rt=a._localRoot||this._root,it=a._clip.tracks,lt=it.length,ft=a._propertyBindings,_t=a._interpolants,St=rt.uuid,Et=this._bindingsByRootAndName;let Tt=Et[St];Tt===void 0&&(Tt={},Et[St]=Tt);for(let Bt=0;Bt!==lt;++Bt){const Ot=it[Bt],Lt=Ot.name;let zt=Tt[Lt];if(zt!==void 0)++zt.referenceCount,ft[Bt]=zt;else{if(zt=ft[Bt],zt!==void 0){zt._cacheIndex===null&&(++zt.referenceCount,this._addInactiveBinding(zt,St,Lt));continue}const Jt=_e&&_e._propertyBindings[Bt].binding.parsedPath;zt=new FC(Ml.create(rt,Lt,Jt),Ot.ValueTypeName,Ot.getValueSize()),++zt.referenceCount,this._addInactiveBinding(zt,St,Lt),ft[Bt]=zt}_t[Bt].resultBuffer=zt.buffer}}_activateAction(a){if(!this._isActiveAction(a)){if(a._cacheIndex===null){const rt=(a._localRoot||this._root).uuid,it=a._clip.uuid,lt=this._actionsByClip[it];this._bindAction(a,lt&&lt.knownActions[0]),this._addInactiveAction(a,it,rt)}const _e=a._propertyBindings;for(let rt=0,it=_e.length;rt!==it;++rt){const lt=_e[rt];lt.useCount++==0&&(this._lendBinding(lt),lt.saveOriginalState())}this._lendAction(a)}}_deactivateAction(a){if(this._isActiveAction(a)){const _e=a._propertyBindings;for(let rt=0,it=_e.length;rt!==it;++rt){const lt=_e[rt];--lt.useCount==0&&(lt.restoreOriginalState(),this._takeBackBinding(lt))}this._takeBackAction(a)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}}_isActiveAction(a){const _e=a._cacheIndex;return _e!==null&&_e<this._nActiveActions}_addInactiveAction(a,_e,rt){const it=this._actions,lt=this._actionsByClip;let ft=lt[_e];if(ft===void 0)ft={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,lt[_e]=ft;else{const _t=ft.knownActions;a._byClipCacheIndex=_t.length,_t.push(a)}a._cacheIndex=it.length,it.push(a),ft.actionByRoot[rt]=a}_removeInactiveAction(a){const _e=this._actions,rt=_e[_e.length-1],it=a._cacheIndex;rt._cacheIndex=it,_e[it]=rt,_e.pop(),a._cacheIndex=null;const lt=a._clip.uuid,ft=this._actionsByClip,_t=ft[lt],St=_t.knownActions,Et=St[St.length-1],Tt=a._byClipCacheIndex;Et._byClipCacheIndex=Tt,St[Tt]=Et,St.pop(),a._byClipCacheIndex=null,delete _t.actionByRoot[(a._localRoot||this._root).uuid],St.length===0&&delete ft[lt],this._removeInactiveBindingsForAction(a)}_removeInactiveBindingsForAction(a){const _e=a._propertyBindings;for(let rt=0,it=_e.length;rt!==it;++rt){const lt=_e[rt];--lt.referenceCount==0&&this._removeInactiveBinding(lt)}}_lendAction(a){const _e=this._actions,rt=a._cacheIndex,it=this._nActiveActions++,lt=_e[it];a._cacheIndex=it,_e[it]=a,lt._cacheIndex=rt,_e[rt]=lt}_takeBackAction(a){const _e=this._actions,rt=a._cacheIndex,it=--this._nActiveActions,lt=_e[it];a._cacheIndex=it,_e[it]=a,lt._cacheIndex=rt,_e[rt]=lt}_addInactiveBinding(a,_e,rt){const it=this._bindingsByRootAndName,lt=this._bindings;let ft=it[_e];ft===void 0&&(ft={},it[_e]=ft),ft[rt]=a,a._cacheIndex=lt.length,lt.push(a)}_removeInactiveBinding(a){const _e=this._bindings,rt=a.binding,it=rt.rootNode.uuid,lt=rt.path,ft=this._bindingsByRootAndName,_t=ft[it],St=_e[_e.length-1],Et=a._cacheIndex;St._cacheIndex=Et,_e[Et]=St,_e.pop(),delete _t[lt],Object.keys(_t).length===0&&delete ft[it]}_lendBinding(a){const _e=this._bindings,rt=a._cacheIndex,it=this._nActiveBindings++,lt=_e[it];a._cacheIndex=it,_e[it]=a,lt._cacheIndex=rt,_e[rt]=lt}_takeBackBinding(a){const _e=this._bindings,rt=a._cacheIndex,it=--this._nActiveBindings,lt=_e[it];a._cacheIndex=it,_e[it]=a,lt._cacheIndex=rt,_e[rt]=lt}_lendControlInterpolant(){const a=this._controlInterpolants,_e=this._nActiveControlInterpolants++;let rt=a[_e];return rt===void 0&&(rt=new Qp(new Float32Array(2),new Float32Array(2),1,wO),rt.__cacheIndex=_e,a[_e]=rt),rt}_takeBackControlInterpolant(a){const _e=this._controlInterpolants,rt=a.__cacheIndex,it=--this._nActiveControlInterpolants,lt=_e[it];a.__cacheIndex=it,_e[it]=a,lt.__cacheIndex=rt,_e[rt]=lt}clipAction(a,_e,rt){const it=_e||this._root,lt=it.uuid;let ft=typeof a=="string"?py.findByName(it,a):a;const _t=ft!==null?ft.uuid:a,St=this._actionsByClip[_t];let Et=null;if(rt===void 0&&(rt=ft!==null?ft.blendMode:fx),St!==void 0){const Bt=St.actionByRoot[lt];if(Bt!==void 0&&Bt.blendMode===rt)return Bt;Et=St.knownActions[0],ft===null&&(ft=Et._clip)}if(ft===null)return null;const Tt=new fP(this,ft,_e,rt);return this._bindAction(Tt,Et),this._addInactiveAction(Tt,_t,lt),Tt}existingAction(a,_e){const rt=_e||this._root,it=rt.uuid,lt=typeof a=="string"?py.findByName(rt,a):a,ft=lt?lt.uuid:a,_t=this._actionsByClip[ft];return _t!==void 0&&_t.actionByRoot[it]||null}stopAllAction(){const a=this._actions;for(let _e=this._nActiveActions-1;_e>=0;--_e)a[_e].stop();return this}update(a){a*=this.timeScale;const _e=this._actions,rt=this._nActiveActions,it=this.time+=a,lt=Math.sign(a),ft=this._accuIndex^=1;for(let Et=0;Et!==rt;++Et)_e[Et]._update(it,a,lt,ft);const _t=this._bindings,St=this._nActiveBindings;for(let Et=0;Et!==St;++Et)_t[Et].apply(ft);return this}setTime(a){this.time=0;for(let _e=0;_e<this._actions.length;_e++)this._actions[_e].time=0;return this.update(a)}getRoot(){return this._root}uncacheClip(a){const _e=this._actions,rt=a.uuid,it=this._actionsByClip,lt=it[rt];if(lt!==void 0){const ft=lt.knownActions;for(let _t=0,St=ft.length;_t!==St;++_t){const Et=ft[_t];this._deactivateAction(Et);const Tt=Et._cacheIndex,Bt=_e[_e.length-1];Et._cacheIndex=null,Et._byClipCacheIndex=null,Bt._cacheIndex=Tt,_e[Tt]=Bt,_e.pop(),this._removeInactiveBindingsForAction(Et)}delete it[rt]}}uncacheRoot(a){const _e=a.uuid,rt=this._actionsByClip;for(const lt in rt){const ft=rt[lt].actionByRoot[_e];ft!==void 0&&(this._deactivateAction(ft),this._removeInactiveAction(ft))}const it=this._bindingsByRootAndName[_e];if(it!==void 0)for(const lt in it){const ft=it[lt];ft.restoreOriginalState(),this._removeInactiveBinding(ft)}}uncacheAction(a,_e){const rt=this.existingAction(a,_e);rt!==null&&(this._deactivateAction(rt),this._removeInactiveAction(rt))}}class jC{constructor(a){this.value=a}clone(){return new jC(this.value.clone===void 0?this.value:this.value.clone())}}let mP=0;class FM extends x_{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:mP++}),this.name="",this.usage=w_,this.uniforms=[]}add(a){return this.uniforms.push(a),this}remove(a){const _e=this.uniforms.indexOf(a);return _e!==-1&&this.uniforms.splice(_e,1),this}setName(a){return this.name=a,this}setUsage(a){return this.usage=a,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(a){this.name=a.name,this.usage=a.usage;const _e=a.uniforms;this.uniforms.length=0;for(let rt=0,it=_e.length;rt<it;rt++)this.uniforms.push(_e[rt].clone());return this}clone(){return new this.constructor().copy(this)}}class gP extends Am{constructor(a,_e,rt=1){super(a,_e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=rt}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}clone(a){const _e=super.clone(a);return _e.meshPerAttribute=this.meshPerAttribute,_e}toJSON(a){const _e=super.toJSON(a);return _e.isInstancedInterleavedBuffer=!0,_e.meshPerAttribute=this.meshPerAttribute,_e}}class _P{constructor(a,_e,rt,it,lt){this.isGLBufferAttribute=!0,this.name="",this.buffer=a,this.type=_e,this.itemSize=rt,this.elementSize=it,this.count=lt,this.version=0}set needsUpdate(a){a===!0&&this.version++}setBuffer(a){return this.buffer=a,this}setType(a,_e){return this.type=a,this.elementSize=_e,this}setItemSize(a){return this.itemSize=a,this}setCount(a){return this.count=a,this}}class dv{constructor(a,_e,rt=0,it=1/0){this.ray=new W0(a,_e),this.near=rt,this.far=it,this.camera=null,this.layers=new X0,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(a,_e){this.ray.set(a,_e)}setFromCamera(a,_e){_e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(_e.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(_e).sub(this.ray.origin).normalize(),this.camera=_e):_e.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(_e.near+_e.far)/(_e.near-_e.far)).unproject(_e),this.ray.direction.set(0,0,-1).transformDirection(_e.matrixWorld),this.camera=_e):console.error("THREE.Raycaster: Unsupported camera type: "+_e.type)}intersectObject(a,_e=!0,rt=[]){return jM(a,this,rt,_e),rt.sort(IE),rt}intersectObjects(a,_e=!0,rt=[]){for(let it=0,lt=a.length;it<lt;it++)jM(a[it],this,rt,_e);return rt.sort(IE),rt}}function IE(pt,a){return pt.distance-a.distance}function jM(pt,a,_e,rt){if(pt.layers.test(a.layers)&&pt.raycast(a,_e),rt===!0){const it=pt.children;for(let lt=0,ft=it.length;lt<ft;lt++)jM(it[lt],a,_e,!0)}}class vP{constructor(a=1,_e=0,rt=0){return this.radius=a,this.phi=_e,this.theta=rt,this}set(a,_e,rt){return this.radius=a,this.phi=_e,this.theta=rt,this}copy(a){return this.radius=a.radius,this.phi=a.phi,this.theta=a.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(a){return this.setFromCartesianCoords(a.x,a.y,a.z)}setFromCartesianCoords(a,_e,rt){return this.radius=Math.sqrt(a*a+_e*_e+rt*rt),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(a,rt),this.phi=Math.acos(Us(_e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class zM{constructor(a=1,_e=0,rt=0){return this.radius=a,this.theta=_e,this.y=rt,this}set(a,_e,rt){return this.radius=a,this.theta=_e,this.y=rt,this}copy(a){return this.radius=a.radius,this.theta=a.theta,this.y=a.y,this}setFromVector3(a){return this.setFromCartesianCoords(a.x,a.y,a.z)}setFromCartesianCoords(a,_e,rt){return this.radius=Math.sqrt(a*a+rt*rt),this.theta=Math.atan2(a,rt),this.y=_e,this}clone(){return new this.constructor().copy(this)}}const VM=new Nr;class Gm{constructor(a=new Nr(1/0,1/0),_e=new Nr(-1/0,-1/0)){this.isBox2=!0,this.min=a,this.max=_e}set(a,_e){return this.min.copy(a),this.max.copy(_e),this}setFromPoints(a){this.makeEmpty();for(let _e=0,rt=a.length;_e<rt;_e++)this.expandByPoint(a[_e]);return this}setFromCenterAndSize(a,_e){const rt=VM.copy(_e).multiplyScalar(.5);return this.min.copy(a).sub(rt),this.max.copy(a).add(rt),this}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(a){return this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}containsPoint(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y)}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y}getParameter(a,_e){return _e.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y)}clampPoint(a,_e){return _e.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,VM).distanceTo(a)}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}const Em=new Nn,bA=new Nn;class zC{constructor(a=new Nn,_e=new Nn){this.start=a,this.end=_e}set(a,_e){return this.start.copy(a),this.end.copy(_e),this}copy(a){return this.start.copy(a.start),this.end.copy(a.end),this}getCenter(a){return a.addVectors(this.start,this.end).multiplyScalar(.5)}delta(a){return a.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(a,_e){return this.delta(_e).multiplyScalar(a).add(this.start)}closestPointToPointParameter(a,_e){Em.subVectors(a,this.start),bA.subVectors(this.end,this.start);const rt=bA.dot(bA);let it=bA.dot(Em)/rt;return _e&&(it=Us(it,0,1)),it}closestPointToPoint(a,_e,rt){const it=this.closestPointToPointParameter(a,_e);return this.delta(rt).multiplyScalar(it).add(this.start)}applyMatrix4(a){return this.start.applyMatrix4(a),this.end.applyMatrix4(a),this}equals(a){return a.start.equals(this.start)&&a.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const PE=new Nn;class GM extends ga{constructor(a,_e){super(),this.light=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=_e,this.type="SpotLightHelper";const rt=new Kt,it=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let ft=0,_t=1,St=32;ft<St;ft++,_t++){const Et=ft/St*Math.PI*2,Tt=_t/St*Math.PI*2;it.push(Math.cos(Et),Math.sin(Et),1,Math.cos(Tt),Math.sin(Tt),1)}rt.setAttribute("position",new vs(it,3));const lt=new Um({fog:!1,toneMapped:!1});this.cone=new av(rt,lt),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const a=this.light.distance?this.light.distance:1e3,_e=a*Math.tan(this.light.angle);this.cone.scale.set(_e,_e,a),PE.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(PE),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const yy=new Nn,RE=new Ao,VC=new Ao;class HM extends av{constructor(a){const _e=QM(a),rt=new Kt,it=[],lt=[],ft=new ps(0,0,1),_t=new ps(0,1,0);for(let St=0;St<_e.length;St++){const Et=_e[St];Et.parent&&Et.parent.isBone&&(it.push(0,0,0),it.push(0,0,0),lt.push(ft.r,ft.g,ft.b),lt.push(_t.r,_t.g,_t.b))}rt.setAttribute("position",new vs(it,3)),rt.setAttribute("color",new vs(lt,3)),super(rt,new Um({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=a,this.bones=_e,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(a){const _e=this.bones,rt=this.geometry,it=rt.getAttribute("position");VC.copy(this.root.matrixWorld).invert();for(let lt=0,ft=0;lt<_e.length;lt++){const _t=_e[lt];_t.parent&&_t.parent.isBone&&(RE.multiplyMatrices(VC,_t.matrixWorld),yy.setFromMatrixPosition(RE),it.setXYZ(ft,yy.x,yy.y,yy.z),RE.multiplyMatrices(VC,_t.parent.matrixWorld),yy.setFromMatrixPosition(RE),it.setXYZ(ft+1,yy.x,yy.y,yy.z),ft+=2)}rt.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(a)}dispose(){this.geometry.dispose(),this.material.dispose()}}function QM(pt){const a=[];pt.isBone===!0&&a.push(pt);for(let _e=0;_e<pt.children.length;_e++)a.push.apply(a,QM(pt.children[_e]));return a}class EO extends hp{constructor(a,_e,rt){super(new kw(_e,4,2),new a_({wireframe:!0,fog:!1,toneMapped:!1})),this.light=a,this.color=rt,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const yP=new Nn,GC=new ps,cu=new ps;class Nw extends ga{constructor(a,_e,rt){super(),this.light=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=rt,this.type="HemisphereLightHelper";const it=new Xx(_e);it.rotateY(.5*Math.PI),this.material=new a_({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const lt=it.getAttribute("position"),ft=new Float32Array(3*lt.count);it.setAttribute("color",new Hl(ft,3)),this.add(new hp(it,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const a=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const _e=a.geometry.getAttribute("color");GC.copy(this.light.color),cu.copy(this.light.groundColor);for(let rt=0,it=_e.count;rt<it;rt++){const lt=rt<it/2?GC:cu;_e.setXYZ(rt,lt.r,lt.g,lt.b)}_e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),a.lookAt(yP.setFromMatrixPosition(this.light.matrixWorld).negate())}}class C0 extends av{constructor(a=10,_e=10,rt=4473924,it=8947848){rt=new ps(rt),it=new ps(it);const lt=_e/2,ft=a/_e,_t=a/2,St=[],Et=[];for(let Bt=0,Ot=0,Lt=-_t;Bt<=_e;Bt++,Lt+=ft){St.push(-_t,0,Lt,_t,0,Lt),St.push(Lt,0,-_t,Lt,0,_t);const zt=Bt===lt?rt:it;zt.toArray(Et,Ot),Ot+=3,zt.toArray(Et,Ot),Ot+=3,zt.toArray(Et,Ot),Ot+=3,zt.toArray(Et,Ot),Ot+=3}const Tt=new Kt;Tt.setAttribute("position",new vs(St,3)),Tt.setAttribute("color",new vs(Et,3)),super(Tt,new Um({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class wA extends av{constructor(a=10,_e=16,rt=8,it=64,lt=4473924,ft=8947848){lt=new ps(lt),ft=new ps(ft);const _t=[],St=[];if(_e>1)for(let Tt=0;Tt<_e;Tt++){const Bt=Tt/_e*(2*Math.PI),Ot=Math.sin(Bt)*a,Lt=Math.cos(Bt)*a;_t.push(0,0,0),_t.push(Ot,0,Lt);const zt=1&Tt?lt:ft;St.push(zt.r,zt.g,zt.b),St.push(zt.r,zt.g,zt.b)}for(let Tt=0;Tt<rt;Tt++){const Bt=1&Tt?lt:ft,Ot=a-a/rt*Tt;for(let Lt=0;Lt<it;Lt++){let zt=Lt/it*(2*Math.PI),Jt=Math.sin(zt)*Ot,Ht=Math.cos(zt)*Ot;_t.push(Jt,0,Ht),St.push(Bt.r,Bt.g,Bt.b),zt=(Lt+1)/it*(2*Math.PI),Jt=Math.sin(zt)*Ot,Ht=Math.cos(zt)*Ot,_t.push(Jt,0,Ht),St.push(Bt.r,Bt.g,Bt.b)}}const Et=new Kt;Et.setAttribute("position",new vs(_t,3)),Et.setAttribute("color",new vs(St,3)),super(Et,new Um({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const o1=new Nn,HC=new Nn,AP=new Nn;class SO extends ga{constructor(a,_e,rt){super(),this.light=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=rt,this.type="DirectionalLightHelper",_e===void 0&&(_e=1);let it=new Kt;it.setAttribute("position",new vs([-_e,_e,0,_e,_e,0,_e,-_e,0,-_e,-_e,0,-_e,_e,0],3));const lt=new Um({fog:!1,toneMapped:!1});this.lightPlane=new Tl(it,lt),this.add(this.lightPlane),it=new Kt,it.setAttribute("position",new vs([0,0,0,0,0,1],3)),this.targetLine=new Tl(it,lt),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),o1.setFromMatrixPosition(this.light.matrixWorld),HC.setFromMatrixPosition(this.light.target.matrixWorld),AP.subVectors(HC,o1),this.lightPlane.lookAt(HC),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(HC),this.targetLine.scale.z=AP.length()}}const QC=new Nn,Su=new zS;class Qv extends av{constructor(a){const _e=new Kt,rt=new Um({color:16777215,vertexColors:!0,toneMapped:!1}),it=[],lt=[],ft={};function _t(zt,Jt){St(zt),St(Jt)}function St(zt){it.push(0,0,0),lt.push(0,0,0),ft[zt]===void 0&&(ft[zt]=[]),ft[zt].push(it.length/3-1)}_t("n1","n2"),_t("n2","n4"),_t("n4","n3"),_t("n3","n1"),_t("f1","f2"),_t("f2","f4"),_t("f4","f3"),_t("f3","f1"),_t("n1","f1"),_t("n2","f2"),_t("n3","f3"),_t("n4","f4"),_t("p","n1"),_t("p","n2"),_t("p","n3"),_t("p","n4"),_t("u1","u2"),_t("u2","u3"),_t("u3","u1"),_t("c","t"),_t("p","c"),_t("cn1","cn2"),_t("cn3","cn4"),_t("cf1","cf2"),_t("cf3","cf4"),_e.setAttribute("position",new vs(it,3)),_e.setAttribute("color",new vs(lt,3)),super(_e,rt),this.type="CameraHelper",this.camera=a,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=ft,this.update();const Et=new ps(16755200),Tt=new ps(16711680),Bt=new ps(43775),Ot=new ps(16777215),Lt=new ps(3355443);this.setColors(Et,Tt,Bt,Ot,Lt)}setColors(a,_e,rt,it,lt){const ft=this.geometry.getAttribute("color");ft.setXYZ(0,a.r,a.g,a.b),ft.setXYZ(1,a.r,a.g,a.b),ft.setXYZ(2,a.r,a.g,a.b),ft.setXYZ(3,a.r,a.g,a.b),ft.setXYZ(4,a.r,a.g,a.b),ft.setXYZ(5,a.r,a.g,a.b),ft.setXYZ(6,a.r,a.g,a.b),ft.setXYZ(7,a.r,a.g,a.b),ft.setXYZ(8,a.r,a.g,a.b),ft.setXYZ(9,a.r,a.g,a.b),ft.setXYZ(10,a.r,a.g,a.b),ft.setXYZ(11,a.r,a.g,a.b),ft.setXYZ(12,a.r,a.g,a.b),ft.setXYZ(13,a.r,a.g,a.b),ft.setXYZ(14,a.r,a.g,a.b),ft.setXYZ(15,a.r,a.g,a.b),ft.setXYZ(16,a.r,a.g,a.b),ft.setXYZ(17,a.r,a.g,a.b),ft.setXYZ(18,a.r,a.g,a.b),ft.setXYZ(19,a.r,a.g,a.b),ft.setXYZ(20,a.r,a.g,a.b),ft.setXYZ(21,a.r,a.g,a.b),ft.setXYZ(22,a.r,a.g,a.b),ft.setXYZ(23,a.r,a.g,a.b),ft.setXYZ(24,_e.r,_e.g,_e.b),ft.setXYZ(25,_e.r,_e.g,_e.b),ft.setXYZ(26,_e.r,_e.g,_e.b),ft.setXYZ(27,_e.r,_e.g,_e.b),ft.setXYZ(28,_e.r,_e.g,_e.b),ft.setXYZ(29,_e.r,_e.g,_e.b),ft.setXYZ(30,_e.r,_e.g,_e.b),ft.setXYZ(31,_e.r,_e.g,_e.b),ft.setXYZ(32,rt.r,rt.g,rt.b),ft.setXYZ(33,rt.r,rt.g,rt.b),ft.setXYZ(34,rt.r,rt.g,rt.b),ft.setXYZ(35,rt.r,rt.g,rt.b),ft.setXYZ(36,rt.r,rt.g,rt.b),ft.setXYZ(37,rt.r,rt.g,rt.b),ft.setXYZ(38,it.r,it.g,it.b),ft.setXYZ(39,it.r,it.g,it.b),ft.setXYZ(40,lt.r,lt.g,lt.b),ft.setXYZ(41,lt.r,lt.g,lt.b),ft.setXYZ(42,lt.r,lt.g,lt.b),ft.setXYZ(43,lt.r,lt.g,lt.b),ft.setXYZ(44,lt.r,lt.g,lt.b),ft.setXYZ(45,lt.r,lt.g,lt.b),ft.setXYZ(46,lt.r,lt.g,lt.b),ft.setXYZ(47,lt.r,lt.g,lt.b),ft.setXYZ(48,lt.r,lt.g,lt.b),ft.setXYZ(49,lt.r,lt.g,lt.b),ft.needsUpdate=!0}update(){const a=this.geometry,_e=this.pointMap;Su.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ou("c",_e,a,Su,0,0,-1),Ou("t",_e,a,Su,0,0,1),Ou("n1",_e,a,Su,-1,-1,-1),Ou("n2",_e,a,Su,1,-1,-1),Ou("n3",_e,a,Su,-1,1,-1),Ou("n4",_e,a,Su,1,1,-1),Ou("f1",_e,a,Su,-1,-1,1),Ou("f2",_e,a,Su,1,-1,1),Ou("f3",_e,a,Su,-1,1,1),Ou("f4",_e,a,Su,1,1,1),Ou("u1",_e,a,Su,.7,1.1,-1),Ou("u2",_e,a,Su,-.7,1.1,-1),Ou("u3",_e,a,Su,0,2,-1),Ou("cf1",_e,a,Su,-1,0,1),Ou("cf2",_e,a,Su,1,0,1),Ou("cf3",_e,a,Su,0,-1,1),Ou("cf4",_e,a,Su,0,1,1),Ou("cn1",_e,a,Su,-1,0,-1),Ou("cn2",_e,a,Su,1,0,-1),Ou("cn3",_e,a,Su,0,-1,-1),Ou("cn4",_e,a,Su,0,1,-1),a.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ou(pt,a,_e,rt,it,lt,ft){QC.set(it,lt,ft).unproject(rt);const _t=a[pt];if(_t!==void 0){const St=_e.getAttribute("position");for(let Et=0,Tt=_t.length;Et<Tt;Et++)St.setXYZ(_t[Et],QC.x,QC.y,QC.z)}}const a1=new E_;class bP extends av{constructor(a,_e=16776960){const rt=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),it=new Float32Array(24),lt=new Kt;lt.setIndex(new Hl(rt,1)),lt.setAttribute("position",new Hl(it,3)),super(lt,new Um({color:_e,toneMapped:!1})),this.object=a,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(a){if(a!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&a1.setFromObject(this.object),a1.isEmpty())return;const _e=a1.min,rt=a1.max,it=this.geometry.attributes.position,lt=it.array;lt[0]=rt.x,lt[1]=rt.y,lt[2]=rt.z,lt[3]=_e.x,lt[4]=rt.y,lt[5]=rt.z,lt[6]=_e.x,lt[7]=_e.y,lt[8]=rt.z,lt[9]=rt.x,lt[10]=_e.y,lt[11]=rt.z,lt[12]=rt.x,lt[13]=rt.y,lt[14]=_e.z,lt[15]=_e.x,lt[16]=rt.y,lt[17]=_e.z,lt[18]=_e.x,lt[19]=_e.y,lt[20]=_e.z,lt[21]=rt.x,lt[22]=_e.y,lt[23]=_e.z,it.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(a){return this.object=a,this.update(),this}copy(a,_e){return super.copy(a,_e),this.object=a.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class CO extends av{constructor(a,_e=16776960){const rt=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),it=new Kt;it.setIndex(new Hl(rt,1)),it.setAttribute("position",new vs([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(it,new Um({color:_e,toneMapped:!1})),this.box=a,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(a){const _e=this.box;_e.isEmpty()||(_e.getCenter(this.position),_e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(a))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Ay extends Tl{constructor(a,_e=1,rt=16776960){const it=rt,lt=new Kt;lt.setAttribute("position",new vs([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),lt.computeBoundingSphere(),super(lt,new Um({color:it,toneMapped:!1})),this.type="PlaneHelper",this.plane=a,this.size=_e;const ft=new Kt;ft.setAttribute("position",new vs([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),ft.computeBoundingSphere(),this.add(new hp(ft,new a_({color:it,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(a){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(a)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const l1=new Nn;let c1,DE;class wP extends ga{constructor(a=new Nn(0,0,1),_e=new Nn(0,0,0),rt=1,it=16776960,lt=.2*rt,ft=.2*lt){super(),this.type="ArrowHelper",c1===void 0&&(c1=new Kt,c1.setAttribute("position",new vs([0,0,0,0,1,0],3)),DE=new hA(0,.5,1,5,1),DE.translate(0,-.5,0)),this.position.copy(_e),this.line=new Tl(c1,new Um({color:it,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new hp(DE,new a_({color:it,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(a),this.setLength(rt,lt,ft)}setDirection(a){if(a.y>.99999)this.quaternion.set(0,0,0,1);else if(a.y<-.99999)this.quaternion.set(1,0,0,0);else{l1.set(a.z,0,-a.x).normalize();const _e=Math.acos(a.y);this.quaternion.setFromAxisAngle(l1,_e)}}setLength(a,_e=.2*a,rt=.2*_e){this.line.scale.set(1,Math.max(1e-4,a-_e),1),this.line.updateMatrix(),this.cone.scale.set(rt,_e,rt),this.cone.position.y=a,this.cone.updateMatrix()}setColor(a){this.line.material.color.set(a),this.cone.material.color.set(a)}copy(a){return super.copy(a,!1),this.line.copy(a.line),this.cone.copy(a.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class kE extends av{constructor(a=1){const _e=[0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a],rt=new Kt;rt.setAttribute("position",new vs(_e,3)),rt.setAttribute("color",new vs([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(rt,new Um({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(a,_e,rt){const it=new ps,lt=this.geometry.attributes.color.array;return it.set(a),it.toArray(lt,0),it.toArray(lt,3),it.set(_e),it.toArray(lt,6),it.toArray(lt,9),it.set(rt),it.toArray(lt,12),it.toArray(lt,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class WC{constructor(){this.type="ShapePath",this.color=new ps,this.subPaths=[],this.currentPath=null}moveTo(a,_e){return this.currentPath=new uA,this.subPaths.push(this.currentPath),this.currentPath.moveTo(a,_e),this}lineTo(a,_e){return this.currentPath.lineTo(a,_e),this}quadraticCurveTo(a,_e,rt,it){return this.currentPath.quadraticCurveTo(a,_e,rt,it),this}bezierCurveTo(a,_e,rt,it,lt,ft){return this.currentPath.bezierCurveTo(a,_e,rt,it,lt,ft),this}splineThru(a){return this.currentPath.splineThru(a),this}toShapes(a){function _e(Ht,$t){const rn=$t.length;let cn=!1;for(let Rn=rn-1,Cn=0;Cn<rn;Rn=Cn++){let Tn=$t[Rn],Gn=$t[Cn],nr=Gn.x-Tn.x,Qn=Gn.y-Tn.y;if(Math.abs(Qn)>Number.EPSILON){if(Qn<0&&(Tn=$t[Cn],nr=-nr,Gn=$t[Rn],Qn=-Qn),Ht.y<Tn.y||Ht.y>Gn.y)continue;if(Ht.y===Tn.y){if(Ht.x===Tn.x)return!0}else{const ur=Qn*(Ht.x-Tn.x)-nr*(Ht.y-Tn.y);if(ur===0)return!0;if(ur<0)continue;cn=!cn}}else{if(Ht.y!==Tn.y)continue;if(Gn.x<=Ht.x&&Ht.x<=Tn.x||Tn.x<=Ht.x&&Ht.x<=Gn.x)return!0}}return cn}const rt=jv.isClockWise,it=this.subPaths;if(it.length===0)return[];let lt,ft,_t;const St=[];if(it.length===1)return ft=it[0],_t=new pA,_t.curves=ft.curves,St.push(_t),St;let Et=!rt(it[0].getPoints());Et=a?!Et:Et;const Tt=[],Bt=[];let Ot,Lt,zt=[],Jt=0;Bt[Jt]=void 0,zt[Jt]=[];for(let Ht=0,$t=it.length;Ht<$t;Ht++)ft=it[Ht],Ot=ft.getPoints(),lt=rt(Ot),lt=a?!lt:lt,lt?(!Et&&Bt[Jt]&&Jt++,Bt[Jt]={s:new pA,p:Ot},Bt[Jt].s.curves=ft.curves,Et&&Jt++,zt[Jt]=[]):zt[Jt].push({h:ft,p:Ot[0]});if(!Bt[0])return function(Ht){const $t=[];for(let rn=0,cn=Ht.length;rn<cn;rn++){const Rn=Ht[rn],Cn=new pA;Cn.curves=Rn.curves,$t.push(Cn)}return $t}(it);if(Bt.length>1){let Ht=!1,$t=0;for(let rn=0,cn=Bt.length;rn<cn;rn++)Tt[rn]=[];for(let rn=0,cn=Bt.length;rn<cn;rn++){const Rn=zt[rn];for(let Cn=0;Cn<Rn.length;Cn++){const Tn=Rn[Cn];let Gn=!0;for(let nr=0;nr<Bt.length;nr++)_e(Tn.p,Bt[nr].p)&&(rn!==nr&&$t++,Gn?(Gn=!1,Tt[nr].push(Tn)):Ht=!0);Gn&&Tt[rn].push(Tn)}}$t>0&&Ht===!1&&(zt=Tt)}for(let Ht=0,$t=Bt.length;Ht<$t;Ht++){_t=Bt[Ht].s,St.push(_t),Lt=zt[Ht];for(let rn=0,cn=Lt.length;rn<cn;rn++)_t.holes.push(Lt[rn].h)}return St}}class xP extends rv{constructor(a,_e,rt,it,lt,ft){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(a,_e,rt,it,lt,ft)}}class TO extends Tw{constructor(a,_e,rt,it){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(a,_e,rt,it)}}class WM extends cy{constructor(a,_e,rt,it){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(a,_e,rt,it)}}class MO extends uy{constructor(a,_e,rt,it,lt,ft,_t){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(a,_e,rt,it,lt,ft,_t)}}class IO extends hA{constructor(a,_e,rt,it,lt,ft,_t,St){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(a,_e,rt,it,lt,ft,_t,St)}}class PO extends Mw{constructor(a,_e){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(a,_e)}}class RO extends Rw{constructor(a,_e){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(a,_e)}}class DO extends Dw{constructor(a,_e){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(a,_e)}}class OE extends Cw{constructor(a,_e,rt,it){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(a,_e,rt,it)}}class kO extends Xx{constructor(a,_e){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(a,_e)}}class EP extends M_{constructor(a,_e,rt,it){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(a,_e,rt,it)}}class OO extends cv{constructor(a,_e,rt,it){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(a,_e,rt,it)}}class BO extends dy{constructor(a,_e,rt,it,lt,ft){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(a,_e,rt,it,lt,ft)}}class qo extends Yx{constructor(a,_e){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(a,_e)}}class Wu extends kw{constructor(a,_e,rt,it,lt,ft,_t){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(a,_e,rt,it,lt,ft,_t)}}class Hm extends $x{constructor(a,_e){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(a,_e)}}class LO extends EE{constructor(a,_e,rt,it,lt){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(a,_e,rt,it,lt)}}class NO extends Kx{constructor(a,_e,rt,it,lt,ft){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(a,_e,rt,it,lt,ft)}}class UO extends Ow{constructor(a,_e,rt,it,lt){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(a,_e,rt,it,lt)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:tt}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=tt)},553:function($,b,g){g.d(b,{_:function(){return ut}});var tt=g(988);const ot=new WeakMap;class ut extends tt.aNw{constructor(It){super(It),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(It){return this.decoderPath=It,this}setDecoderConfig(It){return this.decoderConfig=It,this}setWorkerLimit(It){return this.workerLimit=It,this}load(It,kt,Ft,Xt){const qt=new tt.hH6(this.manager);qt.setPath(this.path),qt.setResponseType("arraybuffer"),qt.setRequestHeader(this.requestHeader),qt.setWithCredentials(this.withCredentials),qt.load(It,jt=>{this.parse(jt,kt,Xt)},Ft,Xt)}parse(It,kt,Ft){this.decodeDracoFile(It,kt,null,null,tt.KI_).catch(Ft)}decodeDracoFile(It,kt,Ft,Xt,qt=tt.GUF){const jt={attributeIDs:Ft||this.defaultAttributeIDs,attributeTypes:Xt||this.defaultAttributeTypes,useUniqueIDs:!!Ft,vertexColorSpace:qt};return this.decodeGeometry(It,jt).then(kt)}decodeGeometry(It,kt){const Ft=JSON.stringify(kt);if(ot.has(It)){const Gt=ot.get(It);if(Gt.key===Ft)return Gt.promise;if(It.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let Xt;const qt=this.workerNextTaskID++,jt=It.byteLength,sn=this._getWorker(qt,jt).then(Gt=>(Xt=Gt,new Promise((vn,nn)=>{Xt._callbacks[qt]={resolve:vn,reject:nn},Xt.postMessage({type:"decode",id:qt,taskConfig:kt,buffer:It},[It])}))).then(Gt=>this._createGeometry(Gt.geometry));return sn.catch(()=>!0).then(()=>{Xt&&qt&&this._releaseTask(Xt,qt)}),ot.set(It,{key:Ft,promise:sn}),sn}_createGeometry(It){const kt=new tt.u9r;It.index&&kt.setIndex(new tt.TlE(It.index.array,1));for(let Ft=0;Ft<It.attributes.length;Ft++){const Xt=It.attributes[Ft],qt=Xt.name,jt=Xt.array,sn=Xt.itemSize,Gt=new tt.TlE(jt,sn);qt==="color"&&this._assignVertexColorSpace(Gt,Xt.vertexColorSpace),kt.setAttribute(qt,Gt)}return kt}_assignVertexColorSpace(It,kt){if(kt!==tt.KI_)return;const Ft=new tt.Ilk;for(let Xt=0,qt=It.count;Xt<qt;Xt++)Ft.fromBufferAttribute(It,Xt).convertSRGBToLinear(),It.setXYZ(Xt,Ft.r,Ft.g,Ft.b)}_loadLibrary(It,kt){const Ft=new tt.hH6(this.manager);return Ft.setPath(this.decoderPath),Ft.setResponseType(kt),Ft.setWithCredentials(this.withCredentials),new Promise((Xt,qt)=>{Ft.load(It,Xt,void 0,qt)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const It=typeof WebAssembly!="object"||this.decoderConfig.type==="js",kt=[];return It?kt.push(this._loadLibrary("draco_decoder.js","text")):(kt.push(this._loadLibrary("draco_wasm_wrapper.js","text")),kt.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(kt).then(Ft=>{const Xt=Ft[0];It||(this.decoderConfig.wasmBinary=Ft[1]);const qt=gt,jt=["/* draco decoder */",Xt,"","/* worker */",qt.substring(qt.indexOf("{")+1,qt.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([jt]))}),this.decoderPending}_getWorker(It,kt){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const Xt=new Worker(this.workerSourceURL);Xt._callbacks={},Xt._taskCosts={},Xt._taskLoad=0,Xt.postMessage({type:"init",decoderConfig:this.decoderConfig}),Xt.onmessage=function(qt){const jt=qt.data;switch(jt.type){case"decode":Xt._callbacks[jt.id].resolve(jt);break;case"error":Xt._callbacks[jt.id].reject(jt);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+jt.type+'"')}},this.workerPool.push(Xt)}else this.workerPool.sort(function(Xt,qt){return Xt._taskLoad>qt._taskLoad?-1:1});const Ft=this.workerPool[this.workerPool.length-1];return Ft._taskCosts[It]=kt,Ft._taskLoad+=kt,Ft})}_releaseTask(It,kt){It._taskLoad-=It._taskCosts[kt],delete It._callbacks[kt],delete It._taskCosts[kt]}debug(){console.log("Task load: ",this.workerPool.map(It=>It._taskLoad))}dispose(){for(let It=0;It<this.workerPool.length;++It)this.workerPool[It].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}const gt=`
function DRACOWorker() {

	let decoderConfig;
	let decoderPending;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				decoderConfig = message.decoderConfig;
				decoderPending = new Promise( function ( resolve/*, reject*/ ) {

					decoderConfig.onModuleLoaded = function ( draco ) {

						// Module is Promise-like. Wrap before resolving to avoid loop.
						resolve( { draco: draco } );

					};

					DracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef

				} );
				break;

			case 'decode':
				const buffer = message.buffer;
				const taskConfig = message.taskConfig;
				decoderPending.then( ( module ) => {

					const draco = module.draco;
					const decoder = new draco.Decoder();

					try {

						const geometry = decodeGeometry( draco, decoder, new Int8Array( buffer ), taskConfig );

						const buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );

						if ( geometry.index ) buffers.push( geometry.index.array.buffer );

						self.postMessage( { type: 'decode', id: message.id, geometry }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					} finally {

						draco.destroy( decoder );

					}

				} );
				break;

		}

	};

	function decodeGeometry( draco, decoder, array, taskConfig ) {

		const attributeIDs = taskConfig.attributeIDs;
		const attributeTypes = taskConfig.attributeTypes;

		let dracoGeometry;
		let decodingStatus;

		const geometryType = decoder.GetEncodedGeometryType( array );

		if ( geometryType === draco.TRIANGULAR_MESH ) {

			dracoGeometry = new draco.Mesh();
			decodingStatus = decoder.DecodeArrayToMesh( array, array.byteLength, dracoGeometry );

		} else if ( geometryType === draco.POINT_CLOUD ) {

			dracoGeometry = new draco.PointCloud();
			decodingStatus = decoder.DecodeArrayToPointCloud( array, array.byteLength, dracoGeometry );

		} else {

			throw new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );

		}

		if ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {

			throw new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );

		}

		const geometry = { index: null, attributes: [] };

		// Gather all vertex attributes.
		for ( const attributeName in attributeIDs ) {

			const attributeType = self[ attributeTypes[ attributeName ] ];

			let attribute;
			let attributeID;

			// A Draco file may be created with default vertex attributes, whose attribute IDs
			// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
			// a Draco file may contain a custom set of attributes, identified by known unique
			// IDs. glTF files always do the latter, and .drc files typically do the former.
			if ( taskConfig.useUniqueIDs ) {

				attributeID = attributeIDs[ attributeName ];
				attribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );

			} else {

				attributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );

				if ( attributeID === - 1 ) continue;

				attribute = decoder.GetAttribute( dracoGeometry, attributeID );

			}

			const attributeResult = decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute );

			if ( attributeName === 'color' ) {

				attributeResult.vertexColorSpace = taskConfig.vertexColorSpace;

			}

			geometry.attributes.push( attributeResult );

		}

		// Add index.
		if ( geometryType === draco.TRIANGULAR_MESH ) {

			geometry.index = decodeIndex( draco, decoder, dracoGeometry );

		}

		draco.destroy( dracoGeometry );

		return geometry;

	}

	function decodeIndex( draco, decoder, dracoGeometry ) {

		const numFaces = dracoGeometry.num_faces();
		const numIndices = numFaces * 3;
		const byteLength = numIndices * 4;

		const ptr = draco._malloc( byteLength );
		decoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );
		const index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();
		draco._free( ptr );

		return { array: index, itemSize: 1 };

	}

	function decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {

		const numComponents = attribute.num_components();
		const numPoints = dracoGeometry.num_points();
		const numValues = numPoints * numComponents;
		const byteLength = numValues * attributeType.BYTES_PER_ELEMENT;
		const dataType = getDracoDataType( draco, attributeType );

		const ptr = draco._malloc( byteLength );
		decoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );
		const array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();
		draco._free( ptr );

		return {
			name: attributeName,
			array: array,
			itemSize: numComponents
		};

	}

	function getDracoDataType( draco, attributeType ) {

		switch ( attributeType ) {

			case Float32Array: return draco.DT_FLOAT32;
			case Int8Array: return draco.DT_INT8;
			case Int16Array: return draco.DT_INT16;
			case Int32Array: return draco.DT_INT32;
			case Uint8Array: return draco.DT_UINT8;
			case Uint16Array: return draco.DT_UINT16;
			case Uint32Array: return draco.DT_UINT32;

		}

	}

}
`}},__webpackgi_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpackgi_require__($){var b=__webpackgi_module_cache__[$];if(b!==void 0)return b.exports;var g=__webpackgi_module_cache__[$]={id:$,exports:{}};return __webpackgi_modules__[$].call(g.exports,g,g.exports,__webpackgi_require__),g.exports}__webpackgi_require__.m=__webpackgi_modules__,__webpackgi_require__.n=function($){var b=$&&$.__esModule?function(){return $.default}:function(){return $};return __webpackgi_require__.d(b,{a:b}),b},getProto=Object.getPrototypeOf?function($){return Object.getPrototypeOf($)}:function($){return $.__proto__},__webpackgi_require__.t=function($,b){if(1&b&&($=this($)),8&b||typeof $=="object"&&$&&(4&b&&$.__esModule||16&b&&typeof $.then=="function"))return $;var g=Object.create(null);__webpackgi_require__.r(g);var tt={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var ot=2&b&&$;typeof ot=="object"&&!~leafPrototypes.indexOf(ot);ot=getProto(ot))Object.getOwnPropertyNames(ot).forEach(function(ut){tt[ut]=function(){return $[ut]}});return tt.default=function(){return $},__webpackgi_require__.d(g,tt),g},__webpackgi_require__.d=function($,b){for(var g in b)__webpackgi_require__.o(b,g)&&!__webpackgi_require__.o($,g)&&Object.defineProperty($,g,{enumerable:!0,get:b[g]})},__webpackgi_require__.f={},__webpackgi_require__.e=function($){return Promise.all(Object.keys(__webpackgi_require__.f).reduce(function(b,g){return __webpackgi_require__.f[g]($,b),b},[]))},__webpackgi_require__.u=function($){return $+".mjs"},__webpackgi_require__.o=function($,b){return Object.prototype.hasOwnProperty.call($,b)},inProgress={},dataWebpackPrefix="webgi:",__webpackgi_require__.l=function($,b,g,tt){if(inProgress[$])inProgress[$].push(b);else{var ot,ut;if(g!==void 0)for(var gt=document.getElementsByTagName("script"),xt=0;xt<gt.length;xt++){var It=gt[xt];if(It.getAttribute("src")==$||It.getAttribute("data-webpack")==dataWebpackPrefix+g){ot=It;break}}ot||(ut=!0,(ot=document.createElement("script")).type="module",ot.charset="utf-8",ot.timeout=120,__webpackgi_require__.nc&&ot.setAttribute("nonce",__webpackgi_require__.nc),ot.setAttribute("data-webpack",dataWebpackPrefix+g),ot.src=$),inProgress[$]=[b];var kt=function(Xt,qt){ot.onerror=ot.onload=null,clearTimeout(Ft);var jt=inProgress[$];if(delete inProgress[$],ot.parentNode&&ot.parentNode.removeChild(ot),jt&&jt.forEach(function(sn){return sn(qt)}),Xt)return Xt(qt)},Ft=setTimeout(kt.bind(null,void 0,{type:"timeout",target:ot}),12e4);ot.onerror=kt.bind(null,ot.onerror),ot.onload=kt.bind(null,ot.onload),ut&&document.head.appendChild(ot)}},__webpackgi_require__.r=function($){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty($,Symbol.toStringTag,{value:"Module"}),Object.defineProperty($,"__esModule",{value:!0})},function(){var $;if(typeof import.meta.url=="string"&&($=import.meta.url),!$)throw new Error("Automatic publicPath is not supported in this browser");$=$.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpackgi_require__.p=$+"../../"}(),function(){var $={698:0};__webpackgi_require__.f.j=function(tt,ot){var ut=__webpackgi_require__.o($,tt)?$[tt]:void 0;if(ut!==0)if(ut)ot.push(ut[2]);else{var gt=new Promise(function(kt,Ft){ut=$[tt]=[kt,Ft]});ot.push(ut[2]=gt);var xt=__webpackgi_require__.p+__webpackgi_require__.u(tt),It=new Error;__webpackgi_require__.l(xt,function(kt){if(__webpackgi_require__.o($,tt)&&((ut=$[tt])!==0&&($[tt]=void 0),ut)){var Ft=kt&&(kt.type==="load"?"missing":kt.type),Xt=kt&&kt.target&&kt.target.src;It.message="Loading chunk "+tt+` failed.
(`+Ft+": "+Xt+")",It.name="ChunkLoadError",It.type=Ft,It.request=Xt,ut[1](It)}},"chunk-"+tt,tt)}};var b=function(tt,ot){var ut,gt,xt=ot[0],It=ot[1],kt=ot[2],Ft=0;if(xt.some(function(Xt){return $[Xt]!==0})){for(ut in It)__webpackgi_require__.o(It,ut)&&(__webpackgi_require__.m[ut]=It[ut]);kt&&kt(__webpackgi_require__)}for(tt&&tt(ot);Ft<xt.length;Ft++)gt=xt[Ft],__webpackgi_require__.o($,gt)&&$[gt]&&$[gt][0](),$[gt]=0},g=self.webpackChunkwebgi=self.webpackChunkwebgi||[];g.forEach(b.bind(null,0)),g.push=b.bind(null,g.push.bind(g))}(),__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};(function(){var $;__webpackgi_require__.d(__webpackgi_exports__,{MWW:function(){return eT},LY2:function(){return g.LY2},GYo:function(){return nD},GPz:function(){return PR},HRj:function(){return N0},li4:function(){return XN},FO5:function(){return Ww},Nlh:function(){return YN},Mp4:function(){return Zm},QvI:function(){return ms},PrA:function(){return t0},JHp:function(){return YT},bGH:function(){return g.bGH},NDo:function(){return g.NDo},gSk:function(){return g.gSk},WMw:function(){return g.WMw},OTo:function(){return g.OTo},Se2:function(){return g.Se2},cum:function(){return g.cum},Mig:function(){return g.Mig},B$7:function(){return rw},i_9:function(){return g.i_9},bBp:function(){return g.bBp},m7l:function(){return g.m7l},sYA:function(){return g.sYA},Xcj:function(){return g.Xcj},mzJ:function(){return g.mzJ},ZZA:function(){return g.ZZA},$Ph:function(){return Nm},T__:function(){return g.T__},HkE:function(){return g.HkE},tGC:function(){return g.tGC},g1S:function(){return w3},I$C:function(){return b1},QIH:function(){return WS},_JE:function(){return zP},SwW:function(){return oI},ksm:function(){return Fr},jl_:function(){return up},b7R:function(){return Bv},BDV:function(){return In},Ea_:function(){return aw},qff:function(){return up},tmC:function(){return us},BON:function(){return HS},P40:function(){return Zy},wLL:function(){return XD},iHO:function(){return Ix},BbS:function(){return g.BbS},kqm:function(){return g.kqm},Hmr:function(){return g.Hmr},SJI:function(){return g.SJI},mTL:function(){return g.mTL},y8_:function(){return g.y8_},_Li:function(){return g._Li},w7U:function(){return w2},g56:function(){return m_},bj3:function(){return Ko},z81:function(){return g.z81},_MY:function(){return g._MY},yEv:function(){return L4},dFZ:function(){return P_},N$j:function(){return g.N$j},_YM:function(){return g._YM},TUj:function(){return g.TUj},ZzF:function(){return g.ZzF},qzb:function(){return Wt},GQ:function(){return g.GQ},nvb:function(){return g.nvb},DvJ:function(){return g.DvJ},fQA:function(){return g.fQA},cPz:function(){return tM},TlE:function(){return g.TlE},u9r:function(){return g.u9r},s4_:function(){return g.s4_},T95:function(){return g.T95},F5w:function(){return TI},NlP:function(){return UI},$8Z:function(){return qw},YYN:function(){return OA},CtF:function(){return g.CtF},V1s:function(){return g.V1s},jOv:function(){return zu},Rki:function(){return g.Rki},pzV:function(){return t2},itZ:function(){return Qp},MMq:function(){return zA},qKx:function(){return zl},Hmi:function(){return WA},X4S:function(){return EI},vlJ:function(){return ND},nPO:function(){return Cy},zcQ:function(){return dC},GH1:function(){return lv},ROQ:function(){return g.ROQ},YN5:function(){return g.YN5},BVQ:function(){return g.BVQ},YT8:function(){return g.YT8},_DE:function(){return Dx},YGz:function(){return g.YGz},trn:function(){return g.trn},zf8:function(){return g.zf8},uWy:function(){return g.uWy},wYQ:function(){return hv},SUY:function(){return g.SUY},Ilk:function(){return g.Ilk},R2R:function(){return g.R2R},epp:function(){return g.epp},xmJ:function(){return Lv},GD$:function(){return Cp},Z_g:function(){return g.Z_g},EB7:function(){return g.EB7},DqL:function(){return g.DqL},_3:function(){return g._3},b_z:function(){return g.b_z},OCn:function(){return Jv},N_j:function(){return y8},hNv:function(){return i3},_am:function(){return g._am},kB7:function(){return Gx},fY$:function(){return g.fY$},vxC:function(){return g.vxC},BtG:function(){return g.BtG},cBK:function(){return g.cBK},g8_:function(){return g.g8_},AXT:function(){return g.AXT},yj7:function(){return g.yj7},dYG:function(){return g.dYG},tm_:function(){return g.tm_},S2y:function(){return g.S2y},B02:function(){return g.B02},PeU:function(){return g.PeU},Hyl:function(){return g.Hyl},Wqd:function(){return g.Wqd},c0Q:function(){return zU},re0:function(){return VU},Xaj:function(){return g.Xaj},DUb:function(){return pp},dZ3:function(){return g.dZ3},m_w:function(){return g.m_w},fHI:function(){return g.fHI},LBq:function(){return g.LBq},Qww:function(){return Sx.Q},CGV:function(){return b.Damper},JUT:function(){return g.JUT},p3g:function(){return g.p3g},IEO:function(){return g.IEO},yxD:function(){return g.yxD},CUS:function(){return u3},A5E:function(){return g.A5E},zqG:function(){return vy},PfX:function(){return WD},Q1o:function(){return jT},jfJ:function(){return g.jfJ},T_J:function(){return g.T_J},tEQ:function(){return g.tEQ},gb4:function(){return Kt},qkB:function(){return g.qkB},cvk:function(){return tA},HWo:function(){return nA},brP:function(){return g.brP},$YQ:function(){return g.$YQ},X8d:function(){return FI},Zdt:function(){return oL},yNB:function(){return _a},h7x:function(){return Tl},Ox3:function(){return g.Ox3},qtn:function(){return S_},cBI:function(){return g.cBI},cU9:function(){return g.cU9},ntt:function(){return g.ntt},DT1:function(){return g.DT1},Kgo:function(){return g.Kgo},ehD:function(){return g.ehD},fhJ:function(){return WT},y1s:function(){return g0},fSK:function(){return g.fSK},Vdb:function(){return g.Vdb},l8J:function(){return g.l8J},dj0:function(){return g.dj0},QM0:function(){return g.QM0},n94:function(){return XP},OIS:function(){return HO},q8b:function(){return fA},TOt:function(){return g.TOt},xaN:function(){return qt},Ny0:function(){return g.Ny0},NeD:function(){return LB},Zof:function(){return qD},N1Y:function(){return uI},itK:function(){return x2},eD:function(){return g.eD},jwo:function(){return g.jwo},dSO:function(){return g.dSO},Bf4:function(){return g.Bf4},USm:function(){return g.USm},pBf:function(){return g.pBf},eBg:function(){return UL},$Vf:function(){return g.$Vf},O7d:function(){return g.O7d},ksq:function(){return Ht},hFL:function(){return hT},gXf:function(){return GO},hH6:function(){return g.hH6},izP:function(){return jI},kpi:function(){return rE},DwZ:function(){return um},kN3:function(){return cL},e62:function(){return g.e62},a$l:function(){return g.a$l},OM3:function(){return g.OM3},VzW:function(){return g.VzW},ybr:function(){return g.ybr},yo9:function(){return g.yo9},Dzq:function(){return d_},zCA:function(){return Hp},$Bt:function(){return iy},Wzm:function(){return g.Wzm},Wl3:function(){return g.Wl3},iWj:function(){return g.iWj},DNz:function(){return Vm},m1M:function(){return zo},ylh:function(){return g.ylh},v9Y:function(){return g.v9Y},LSk:function(){return g.LSk},LHE:function(){return Ql},KE0:function(){return MB},KCF:function(){return zN},a4n:function(){return hB},NKC:function(){return RM},jrv:function(){return E0},zIH:function(){return xx},Hfk:function(){return a0},png:function(){return H0},tAj:function(){return X_},Eb_:function(){return Ex},SJj:function(){return sP},cF0:function(){return Ju},BT2:function(){return qO},_8p:function(){return y3},V5Z:function(){return aP},s5b:function(){return BC},BHZ:function(){return E2},hkn:function(){return e_},GFY:function(){return t_},w$m:function(){return g.w$m},ksN:function(){return g.ksN},j4z:function(){return g.j4z},OAl:function(){return g.OAl},VLJ:function(){return g.VLJ},C73:function(){return gv},ZAu:function(){return g.ZAu},ibP:function(){return Ov},lth:function(){return TM},_fI:function(){return Cp},hUN:function(){return bm},cLu:function(){return g.cLu},vmT:function(){return g.vmT},Qpg:function(){return g.Qpg},So8:function(){return g.So8},eOv:function(){return JI},Wjw:function(){return g.Wjw},cJO:function(){return g.cJO},QRU:function(){return g.QRU},S3k:function(){return g.S3k},OPJ:function(){return $N},PpQ:function(){return g.PpQ},q_9:function(){return eu},ZRs:function(){return g.ZRs},oqc:function(){return g.oqc},T_x:function(){return Ir},lb7:function(){return g.lb7},L5s:function(){return g.L5s},$TI:function(){return g.$TI},SPe:function(){return g.SPe},aVm:function(){return g.aVm},j87:function(){return g.j87},RNb:function(){return g.RNb},Kz5:function(){return g.Kz5},vpT:function(){return g.vpT},kB5:function(){return g.kB5},_C8:function(){return g._C8},Syv:function(){return g.Syv},NMF:function(){return g.NMF},pIN:function(){return g.pIN},eMJ:function(){return g.eMJ},rN7:function(){return UM},iUp:function(){return AA},GFd:function(){return sB},x5V:function(){return g.x5V},tUh:function(){return g.tUh},z8B:function(){return g.z8B},vcl:function(){return Qu},GZb:function(){return g.GZb},p7y:function(){return g.p7y},S9g:function(){return g.S9g},Zr5:function(){return g.Zr5},vCF:function(){return g.vCF},yt0:function(){return g.yt0},uXU:function(){return g.uXU},_kC:function(){return g._kC},lk7:function(){return g.lk7},USc:function(){return ZI},x12:function(){return g.x12},w_R:function(){return iB},Zzh:function(){return g.Zzh},nls:function(){return g.nls},g_z:function(){return g.g_z},U7:function(){return g.U7},FT0:function(){return g.FT0},L1_:function(){return aI},blk:function(){return g.blk},YRm:function(){return sv},ejS:function(){return g.ejS},wUb:function(){return QP},zOz:function(){return rA},rnI:function(){return g.rnI},wem:function(){return g.wem},lfu:function(){return g.lfu},FDw:function(){return g.FDw},lRj:function(){return g.lRj},D1R:function(){return g.D1R},qyh:function(){return g.qyh},GUF:function(){return g.GUF},EoG:function(){return g.EoG},aNw:function(){return g.aNw},Zp0:function(){return g.Zp0},lLk:function(){return g.lLk},NHT:function(){return Kl},jAl:function(){return g.jAl},uEv:function(){return g.uEv},YKA:function(){return g.YKA},cRx:function(){return g.cRx},Y8D:function(){return g.Y8D},RsA:function(){return g.RsA},Y0m:function(){return pP},F5T:function(){return g.F5T},EDU:function(){return Rn},z$Q:function(){return zw},KA8:function(){return Zu},ZqF:function(){return S2},XUj:function(){return BP},Me$:function(){return SA},u7G:function(){return g.u7G},PEk:function(){return U0},BG4:function(){return cn},M8C:function(){return g.M8C},Vkp:function(){return g.Vkp},yGw:function(){return g.yGw},Sm8:function(){return g.Sm8},Kj0:function(){return g.Kj0},vBJ:function(){return g.vBJ},QfV:function(){return wp},lRF:function(){return g.lRF},Lun:function(){return g.Lun},YBo:function(){return g.YBo},kaV:function(){return g.kaV},RSm:function(){return g.RSm},xoR:function(){return g.xoR},EJi:function(){return g.EJi},Wid:function(){return g.Wid},iuj:function(){return bp},IKL:function(){return g.IKL},r_:function(){return g.r_},OoA:function(){return g.OoA},qhX:function(){return g.qhX},CRe:function(){return iP},qPT:function(){return v0},M5h:function(){return g.M5h},Ns1:function(){return g.Ns1},TyD:function(){return g.TyD},vZf:function(){return g.vZf},HTd:function(){return g.HTd},aH4:function(){return g.aH4},YLQ:function(){return g.YLQ},BVF:function(){return g.BVF},MyG:function(){return g.MyG},jFi:function(){return g.jFi},aCh:function(){return g.aCh},uL9:function(){return g.uL9},TNj:function(){return f_},IFH:function(){return g.IFH},bdR:function(){return g.bdR},RPs:function(){return k_},kM_:function(){return j2},M6v:function(){return g.M6v},RvT:function(){return g.RvT},dUE:function(){return g.dUE},oe_:function(){return vP},BuN:function(){return zM},Tme:function(){return g.Tme},N9P:function(){return Uy},tfP:function(){return TS},Gql:function(){return g.Gql},$XY:function(){return Np},O9d:function(){return C2},zEO:function(){return x_},qfx:function(){return Ty},PA7:function(){return g.PA7},REq:function(){return g.REq},pQR:function(){return g.pQR},ghN:function(){return g.ghN},Hy8:function(){return g.Hy8},Wpd:function(){return g.Wpd},LgZ:function(){return g.LgZ},iWC:function(){return g.iWC},mqn:function(){return XH},SKe:function(){return yl},iKG:function(){return g.iKG},rCq:function(){return xI},_iA:function(){return g._iA},ntZ:function(){return g.ntZ},anP:function(){return g.anP},X2e:function(){return GN},oxT:function(){return zm},FCo:function(){return P0},y$t:function(){return g.y$t},cPb:function(){return g.cPb},lmx:function(){return Bo},JOQ:function(){return g.JOQ},BKK:function(){return g.BKK},_12:function(){return g._12},tJx:function(){return g.tJx},mjX:function(){return tE},cek:function(){return g.cek},qD0:function(){return Hy},xG9:function(){return g.xG9},eqi:function(){return b.PointerDragHelper},wI8:function(){return Zw},Sgv:function(){return uL},woe:function(){return g.woe},UY4:function(){return g.UY4},aq0:function(){return g.aq0},ujx:function(){return g.ujx},Uol:function(){return g.Uol},JiH:function(){return fT},VYz:function(){return g.VYz},B2H:function(){return eE},_Pm:function(){return fw},EsW:function(){return Vp},iUV:function(){return g.iUV},tf:function(){return g.tf},ZQ6:function(){return g.ZQ6},mXe:function(){return g.mXe},_fP:function(){return g._fP},iLg:function(){return g.iLg},zbs:function(){return g.zbs},ZTh:function(){return g.ZTh},HdW:function(){return g.HdW},UZH:function(){return g.UZH},mSO:function(){return g.mSO},wk1:function(){return g.wk1},E2K:function(){return g.E2K},FUD:function(){return g.FUD},pKu:function(){return g.pKu},GG6:function(){return g.GG6},Gih:function(){return g.Gih},iiP:function(){return g.iiP},SvJ:function(){return g.SvJ},ptH:function(){return g.ptH},jZA:function(){return g.jZA},y2t:function(){return g.y2t},gi4:function(){return g.gi4},Djp:function(){return g.Djp},BG$:function(){return g.BG$},NYV:function(){return g.NYV},xJs:function(){return g.xJs},bsb:function(){return g.bsb},ekQ:function(){return g.ekQ},CaW:function(){return g.CaW},eaV:function(){return g.eaV},BFQ:function(){return g.BFQ},v3W:function(){return g.v3W},ILR:function(){return g.ILR},G_r:function(){return g.G_r},N3F:function(){return rr},fto:function(){return g.fto},l0P:function(){return g.l0P},vCx:function(){return g.vCx},_AM:function(){return g._AM},wuA:function(){return g.wuA},av9:function(){return g.av9},CtA:function(){return g.CtA},BvQ:function(){return Fx},FZJ:function(){return ay},FIo:function(){return g.FIo},zHn:function(){return g.zHn},iMs:function(){return g.iMs},T_f:function(){return g.T_f},hEm:function(){return g.hEm},D9w:function(){return g.D9w},sHH:function(){return zE},CdI:function(){return g.CdI},rkc:function(){return Zv},rpg:function(){return g.rpg},ce8:function(){return g.ce8},rOj:function(){return g.rOj},P6m:function(){return xy},JA6:function(){return qp},V4E:function(){return g.V4E},o8S:function(){return g.o8S},flB:function(){return gu},lGU:function(){return g.lGU},vuL:function(){return g.vuL},KI_:function(){return g.KI_},iLN:function(){return Z1},X6w:function(){return i1},rz_:function(){return Gv},jsw:function(){return sm},srG:function(){return Tp},i6Z:function(){return jx},vfv:function(){return WO},xsS:function(){return g.xsS},or:function(){return e2},EQj:function(){return Hu},Rnn:function(){return hL},TyN:function(){return R1},ov0:function(){return ZS},WdD:function(){return g.WdD},Vj0:function(){return g.Vj0},jyz:function(){return g.jyz},mTM:function(){return s0},Mn1:function(){return _g},Hlq:function(){return yo},Fi7:function(){return mv},Tn7:function(){return g.Tn7},bnF:function(){return g.bnF},HW6:function(){return g.HW6},oa8:function(){return g.oa8},T_1:function(){return g.T_1},zHJ:function(){return Av},iDF:function(){return g.iDF},iAb:function(){return g.iAb},d4E:function(){return A1},lBg:function(){return $I},JeJ:function(){return k4},FKY:function(){return b.SimpleEventDispatcher},zlZ:function(){return h3},vkg:function(){return tu},brh:function(){return d3},kZK:function(){return bv},puG:function(){return KI},OdW:function(){return g.OdW},_YX:function(){return g._YX},TUv:function(){return g.TUv},Hw6:function(){return g.Hw6},aLr:function(){return g.aLr},Aip:function(){return g.Aip},xo$:function(){return g.xo$},bIn:function(){return YH},$V:function(){return g.$V},lDi:function(){return g.lDi},gti:function(){return g.gti},PMe:function(){return g.PMe},iwP:function(){return nw},FvO:function(){return g.FvO},jyi:function(){return g.jyi},xeV:function(){return g.xeV},k74:function(){return g.k74},RlZ:function(){return g.RlZ},KhW:function(){return g.KhW},HgB:function(){return g.HgB},W2J:function(){return g.W2J},JWc:function(){return g.JWc},u37:function(){return g.u37},Z6B:function(){return g.Z6B},QZ1:function(){return g.QZ1},Ir4:function(){return g.Ir4},NwF:function(){return g.NwF},Wbm:function(){return g.Wbm},N4l:function(){return g.N4l},Jxm:function(){return VO},ej9:function(){return Vw},QmN:function(){return g.QmN},Y4W:function(){return b.TYPED_ARRAYS},IOt:function(){return g.IOt},NOD:function(){return n1},L5g:function(){return g.L5g},H$k:function(){return g.H$k},cuP:function(){return Yp},xEZ:function(){return g.xEZ},dpR:function(){return g.dpR},wOD:function(){return R_},KNb:function(){return QT},IiN:function(){return Rx},Cne:function(){return g.Cne},XvJ:function(){return g.XvJ},XZw:function(){return g.XZw},FE5:function(){return g.FE5},Mck:function(){return ex},lVp:function(){return B2},CJI:function(){return g.CJI},z$h:function(){return g.z$h},UlW:function(){return g.UlW},WwZ:function(){return g.WwZ},zG7:function(){return Hv},Lcc:function(){return g.Lcc},WXh:function(){return g.WXh},Vjr:function(){return OB},LuM:function(){return TD},LP5:function(){return FF},ub3:function(){return g.ub3},OV:function(){return z_},G_n:function(){return xv},xfE:function(){return g.xfE},qlB:function(){return g.qlB},lCJ:function(){return g.lCJ},WTc:function(){return g.WTc},rAo:function(){return g.rAo},LZj:function(){return qT},xWb:function(){return g.xWb},gH0:function(){return g.gH0},rBU:function(){return g.rBU},rDY:function(){return g.rDY},ywz:function(){return g.ywz},wJv:function(){return g.wJv},JQ4:function(){return g.JQ4},k0A:function(){return g.k0A},irR:function(){return g.irR},LsT:function(){return g.LsT},q5h:function(){return p2},TKh:function(){return KD},tyg:function(){return d2},Ro5:function(){return rv},dwk:function(){return g.dwk},t0w:function(){return GI},M7$:function(){return PT},ML4:function(){return VI},FM8:function(){return g.FM8},Pa4:function(){return g.Pa4},Ltg:function(){return g.Ltg},yC1:function(){return g.yC1},lHq:function(){return B_},fO1:function(){return g.fO1},oMA:function(){return I_},JzW:function(){return $},QEt:function(){return py},IFZ:function(){return gS},b5g:function(){return g.b5g},Ywn:function(){return g.Ywn},GVz:function(){return g.GVz},oAp:function(){return g.oAp},kFz:function(){return g.kFz},dd2:function(){return g.dd2},CP7:function(){return g.CP7},fQK:function(){return g.fQK},Wd$:function(){return s3},t1_:function(){return kL},v27:function(){return JS},Uk6:function(){return g.Uk6},H7Z:function(){return ZT},_sL:function(){return g._sL},czO:function(){return R0},Pnf:function(){return g.Pnf},c8b:function(){return g.c8b},_lf:function(){return g._lf},ad5:function(){return g.ad5},sZV:function(){return YD},TfA:function(){return GS},sKX:function(){return QS},UdM:function(){return zp},P0y:function(){return Jy},L_r:function(){return g.L_r},zC5:function(){return b.absMax},Bve:function(){return FP},b5G:function(){return _2},UeO:function(){return Q0},qCx:function(){return d4},$nx:function(){return dB},Bk6:function(){return V0},EER:function(){return CM},y4l:function(){return Iv},P39:function(){return r1},HI1:function(){return b.aesGcmDecrypt},ZYi:function(){return b.aesGcmEncrypt},wXW:function(){return Il},r5x:function(){return am},MSI:function(){return xA},EUu:function(){return n8},jtH:function(){return b0},T0T:function(){return e1},gAb:function(){return UD},je_:function(){return $j},wBP:function(){return CE},LU2:function(){return mC},wQL:function(){return r8},Zs7:function(){return jn},sMc:function(){return b.arrayBufferToBase64},x7s:function(){return Uw},Mnd:function(){return s8},A0_:function(){return o8},d73:function(){return Xn},HCD:function(){return oo},YQ8:function(){return op},RG9:function(){return Ks},G2P:function(){return p_},XLf:function(){return hM},CGN:function(){return gE},RGi:function(){return b.base64ToArrayBuffer},mvg:function(){return Tr},Hiy:function(){return _x},XMc:function(){return So},N7M:function(){return js},iv:function(){return by},n55:function(){return b.blobToDataURL},IaC:function(){return ir},h9t:function(){return gC},yDW:function(){return _C},gJv:function(){return cA},l$g:function(){return eU},vQi:function(){return LU},$MY:function(){return L1},wJl:function(){return DS},Z7Y:function(){return mE},X7D:function(){return H2},BnX:function(){return uM},uZ5:function(){return ly},zVI:function(){return ss},Wz1:function(){return b.colorToDataUrl},DpF:function(){return y2},nNb:function(){return l_},cqZ:function(){return nv},pKN:function(){return CR},CN8:function(){return aM},DdI:function(){return IB},rrX:function(){return TR},uqj:function(){return ln},Z9P:function(){return zn},KlC:function(){return Hx},KVn:function(){return hn},oau:function(){return YC},aw9:function(){return Jl},Aap:function(){return _l},Dxg:function(){return b.copyProps},MjT:function(){return Bs},F7Q:function(){return pE},IFq:function(){return KL},IJl:function(){return Qx},O5A:function(){return b.createCanvasElement},wCn:function(){return b.createDiv},gGT:function(){return pC},pEc:function(){return WN},Bi6:function(){return b.createImage},fi_:function(){return fp},TT:function(){return SP},q2Z:function(){return GH},NyK:function(){return Ku},bgu:function(){return b.createScriptFromURL},kcS:function(){return b.createStyles},rRN:function(){return FB},ivY:function(){return b.css},_s1:function(){return _8},_HO:function(){return xs},tpL:function(){return Ys},DMK:function(){return Yx},LjN:function(){return zS},iFs:function(){return rm},qTg:function(){return b.deepAccessObject},J4G:function(){return Qt},Zj8:function(){return e8},Wtl:function(){return Bn},DmK:function(){return hr},Htt:function(){return s4},Nv0:function(){return bn},tCp:function(){return Yt},Hx7:function(){return ao},imt:function(){return to},US6:function(){return Lo},vZs:function(){return lM},TE$:function(){return a8},lmu:function(){return b.downloadBlob},SvO:function(){return b.downloadFile},YQY:function(){return fE},mZN:function(){return cM},VvG:function(){return G2},omp:function(){return b.embedUrlRefs},utz:function(){return Or},TFV:function(){return XS},hrz:function(){return b.escapeRegExp},H$s:function(){return en},JKM:function(){return qC},jZf:function(){return qL},RjL:function(){return SD},RRI:function(){return lm},RUq:function(){return ZN},_t4:function(){return Q_},YHh:function(){return Rm},R8g:function(){return sr},f1L:function(){return b.getFileHandle},Bbl:function(){return b.getFilenameFromPath},V9r:function(){return b.getKeyByValue},a95:function(){return b.getNewFileHandle},PZ2:function(){return b.getOrCall},w7A:function(){return b.getPropertyDescriptor},N6S:function(){return dn},Uxp:function(){return kn},tAz:function(){return Kn},R$F:function(){return Rr},N33:function(){return Vn},JFD:function(){return br},gw2:function(){return ey},rfc:function(){return b.getTypedArray},wo6:function(){return b.getUrlQueryParam},V4T:function(){return E_},H4P:function(){return b.glsl},NLp:function(){return OC},swA:function(){return Ky},_Z3:function(){return f0},ivc:function(){return l_},rZ1:function(){return nv},CpZ:function(){return T0},dyc:function(){return b.html},MxZ:function(){return b.htmlToCanvas},btp:function(){return b.htmlToPng},mXy:function(){return b.htmlToSvg},Ej0:function(){return Zl},ep4:function(){return Mm},DQP:function(){return na},VNr:function(){return ju},V7q:function(){return b.imageBitmapToBase64},hiB:function(){return b.imageDataToCanvas},zEk:function(){return b.imageToCanvas},qfq:function(){return b.imageUrlToImageData},piB:function(){return b.includesAll},IIc:function(){return t8},rrF:function(){return no},naq:function(){return Fl},zlD:function(){return tn},sXR:function(){return Dw},p5I:function(){return IC},wps:function(){return FD},wuo:function(){return JL},GpE:function(){return b.isPropertyWritable},F4b:function(){return dy},NN$:function(){return Bw},t$v:function(){return qn},tdn:function(){return zv},Y9t:function(){return SM},GEo:function(){return fC},GGm:function(){return b.longestCommonPrefix},DH3:function(){return Al},uxM:function(){return b.makeColorSvg},zH3:function(){return b.makeColorSvgCircle},MLs:function(){return Rl},xXG:function(){return Po},YM4:function(){return MC},B3r:function(){return XL},iAx:function(){return b.makeTextSvg},lDn:function(){return Hr},P1O:function(){return Ut},iib:function(){return Jn},qf5:function(){return Un},n4s:function(){return _n},fr:function(){return Yn},Z9s:function(){return un},oaQ:function(){return dE},CD7:function(){return cy},Rc0:function(){return AE},iPG:function(){return Rw},TIc:function(){return b.mobileAndTabletCheck},xsC:function(){return BE},zOc:function(){return b.now},i8W:function(){return b.objectHasOwn},r46:function(){return Sr},z2C:function(){return b.onChange},N4A:function(){return b.onChange2},hjq:function(){return b.onChange3},_X$:function(){return b.parseFileExtension},_yn:function(){return Gs},Dyg:function(){return b.pathJoin},cUc:function(){return w_},zGw:function(){return Pw},Ctq:function(){return lo},$ch:function(){return l8},k5b:function(){return Fs},kZl:function(){return NE},OCg:function(){return d1},Kd3:function(){return b.prettyScrollbar},YjH:function(){return qu},Ui8:function(){return b3},YD2:function(){return Tw},vi9:function(){return i4},ij3:function(){return Wl},pJq:function(){return b.readFile},YPW:function(){return gs},_tY:function(){return b.remoteWorkerURL},Bg1:function(){return WH},kon:function(){return b.replaceAll},M3g:function(){return Ew},F2z:function(){return xn},pJF:function(){return JN},knz:function(){return g.knz},Ejo:function(){return b.safeSetProperty},BgY:function(){return Yo},qCG:function(){return En},HD9:function(){return Ls},Rgz:function(){return $a},fEB:function(){return Js},Udc:function(){return r0},ZQg:function(){return Km},ofC:function(){return ls},yRy:function(){return b.setUrlQueryParam},_NL:function(){return b8},LCA:function(){return Nl},Sy1:function(){return HF},Vs_:function(){return QF},j1w:function(){return KA},i8J:function(){return A8},p7C:function(){return os},ZAS:function(){return rP},ipH:function(){return c8},$TF:function(){return a4},uZI:function(){return u8},VWG:function(){return rn},pQ7:function(){return Fm},STw:function(){return uA},jc8:function(){return Ny},BL_:function(){return Er},S6:function(){return v8},T8U:function(){return m0},TD6:function(){return im},akS:function(){return b.svgToCanvas},QKE:function(){return b.svgToPng},dKx:function(){return b.svgUrl},OvX:function(){return e4},doP:function(){return Ll},$jA:function(){return Ds},T99:function(){return Fo},LJS:function(){return fs},VsW:function(){return b.timeout},LZE:function(){return tr},YMc:function(){return o4},aPg:function(){return Xo},LFn:function(){return b.toTitleCase},VsX:function(){return yn},wey:function(){return Fn},MaE:function(){return Oo},s4x:function(){return Tv},FJA:function(){return Jp},vIA:function(){return Pm},Spv:function(){return ks},w8l:function(){return By},riG:function(){return $s},Kbh:function(){return y_},BFq:function(){return W_},t8K:function(){return ns},Q7n:function(){return jr},KGF:function(){return Lp},e5:function(){return cr},Rik:function(){return $1},GZo:function(){return cw},Bds:function(){return ym},HTu:function(){return q1},cTq:function(){return b.uploadFile},X_Y:function(){return kS},dA8:function(){return gx},NSm:function(){return B0},bwS:function(){return uo},Lks:function(){return h8},Rvq:function(){return r4},P4F:function(){return b.verifyPermission},Pd0:function(){return Ru},Pjo:function(){return ys},Tum:function(){return i_},dRH:function(){return ap},RX0:function(){return xp},reQ:function(){return d8},cWm:function(){return wr},NC9:function(){return b.writeFile},$Re:function(){return $D},Xo9:function(){return HT},LNO:function(){return hp},iZP:function(){return Px}}),function(h){h[h.Error=-2]="Error",h[h.Destroyed=-1]="Destroyed",h[h.None=0]="None",h[h.Running=1]="Running",h[h.Paused=2]="Paused"}($||($={}));var b=__webpackgi_require__(8),g=__webpackgi_require__(988);const tt={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class ot{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const ut=new g.iKG(-1,1,1,-1,0,1),gt=new g.u9r;gt.setAttribute("position",new g.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),gt.setAttribute("uv",new g.a$l([0,2,0,0,2,0],2));class xt{constructor(e){this._mesh=new g.Kj0(gt,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,ut)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class It extends ot{constructor(e,i){super(),this.textureID=i!==void 0?i:"tDiffuse",e instanceof g.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=g.rDY.clone(e.uniforms),this.material=new g.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new xt(this.material),this.useExistingRenderTarget=!1}render(e,i,s){this.uniforms[this.textureID]&&s&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(i||null),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class kt extends ot{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,i,s){const o=e.getContext(),c=e.state;let _,j;c.buffers.color.setMask(!1),c.buffers.depth.setMask(!1),c.buffers.color.setLocked(!0),c.buffers.depth.setLocked(!0),this.inverse?(_=0,j=1):(_=1,j=0),c.buffers.stencil.setTest(!0),c.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),c.buffers.stencil.setFunc(o.ALWAYS,_,4294967295),c.buffers.stencil.setClear(j),c.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),c.buffers.color.setLocked(!1),c.buffers.depth.setLocked(!1),c.buffers.stencil.setLocked(!1),c.buffers.stencil.setFunc(o.EQUAL,1,4294967295),c.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),c.buffers.stencil.setLocked(!0)}}class Ft extends ot{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Xt{constructor(e,i){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),i===void 0){const s=e.getSize(new g.FM8);this._width=s.width,this._height=s.height,(i=new g.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new It(tt),this.clock=new g.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,i){this.passes.splice(i,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const i=this.passes.indexOf(e);i!==-1&&this.passes.splice(i,1)}isLastEnabledPass(e){for(let i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const i=this.renderer.getRenderTarget();let s=!1;for(let o=0,c=this.passes.length;o<c;o++){const _=this.passes[o];if(_.enabled!==!1){if(_.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(o),_.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),_.needsSwap){if(s){const j=this.renderer.getContext(),et=this.renderer.state.buffers.stencil;et.setFunc(j.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),et.setFunc(j.EQUAL,1,4294967295)}this.swapBuffers()}kt!==void 0&&(_ instanceof kt?s=!0:_ instanceof Ft&&(s=!1))}}this.renderer.setRenderTarget(i)}reset(e){if(e===void 0){const i=this.renderer.getSize(new g.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,i){this._width=e,this._height=i;const s=this._width*this._pixelRatio,o=this._height*this._pixelRatio;this.renderTarget1.setSize(s,o),this.renderTarget2.setSize(s,o);for(let c=0;c<this.passes.length;c++)this.passes[c].setSize(s,o)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class qt extends Xt{constructor(e,i){super(e,i)}setPixelRatio(e,i=!0){const s=this.setSize;i||(this.setSize=()=>{}),super.setPixelRatio(e),i||(this.setSize=s)}}const jt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function sn(){const h=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(jt[255&h]+jt[h>>8&255]+jt[h>>16&255]+jt[h>>24&255]+"-"+jt[255&e]+jt[e>>8&255]+"-"+jt[e>>16&15|64]+jt[e>>24&255]+"-"+jt[63&i|128]+jt[i>>8&255]+"-"+jt[i>>16&255]+jt[i>>24&255]+jt[255&s]+jt[s>>8&255]+jt[s>>16&255]+jt[s>>24&255]).toLowerCase()}function Gt(h,e,i){return Math.max(e,Math.min(i,h))}function vn(h,e,i){return(1-i)*h+i*e}class nn{constructor(e=0,i=0){nn.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,s=this.y,o=e.elements;return this.x=o[0]*i+o[3]*s+o[6],this.y=o[1]*i+o[4]*s+o[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(Gt(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y;return i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const s=Math.cos(i),o=Math.sin(i),c=this.x-e.x,_=this.y-e.y;return this.x=c*s-_*o+e.x,this.y=c*o+_*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Wt extends g.ZzF{expandByObject(e,i=!1,s=!1,o){var _;if(((_=e.userData)==null?void 0:_.bboxVisible)===!1)return this;if(!e.visible&&s)return this;if(o&&o(e))return this;if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),on.copy(e.boundingBox),on.applyMatrix4(e.matrixWorld),this.union(on);else{const j=e.geometry;if(j!==void 0)if(i&&j.attributes!=null&&j.attributes.position!==void 0){const et=j.attributes.position;for(let nt=0,st=et.count;nt<st;nt++)gn.fromBufferAttribute(et,nt).applyMatrix4(e.matrixWorld),this.expandByPoint(gn)}else j.boundingBox===null&&j.computeBoundingBox(),on.copy(j.boundingBox),on.applyMatrix4(e.matrixWorld),this.union(on)}const c=e.children;for(let j=0,et=c.length;j<et;j++)this.expandByObject(c[j],i,s,o);return this}expandByObjects(e,i=!1,s=!1,o){for(let c=0,_=e.length;c<_;c++)this.expandByObject(e[c],i,s,o);return this}getPoints(){return[new g.Pa4(this.min.x,this.min.y,this.min.z),new g.Pa4(this.min.x,this.min.y,this.max.z),new g.Pa4(this.min.x,this.max.y,this.min.z),new g.Pa4(this.min.x,this.max.y,this.max.z),new g.Pa4(this.max.x,this.min.y,this.min.z),new g.Pa4(this.max.x,this.min.y,this.max.z),new g.Pa4(this.max.x,this.max.y,this.min.z),new g.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const i=this.getPoints(),s=new g.TUj;for(const o of i){const c=o.project(e);s.min.min(c),s.max.max(c)}return s}}const on=new Wt,gn=new g.Pa4;function ln(h,e,i=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!h.hasAttribute("position")||!h.hasAttribute("normal")||!h.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function s(_){if(_.normalized||_.isInterleavedBufferAttribute){const j=new Float32Array(_.count*_.itemSize);for(let et=0,nt=0;et<_.count;et++)j[nt++]=_.getX(et),j[nt++]=_.getY(et),_.itemSize>2&&(j[nt++]=_.getZ(et));return j}return _.array instanceof Float32Array?_.array:new Float32Array(_.array)}const o=h.index?h.toNonIndexed():h,c=e.generateTangents(s(o.attributes.position),s(o.attributes.normal),s(o.attributes.uv));if(i)for(let _=3;_<c.length;_+=4)c[_]*=-1;return o.setAttribute("tangent",new g.TlE(c,4)),h!==o&&h.copy(o),h}function _n(h,e=!1){const i=h[0].index!==null,s=new Set(Object.keys(h[0].attributes)),o=new Set(Object.keys(h[0].morphAttributes)),c={},_={},j=h[0].morphTargetsRelative,et=new g.u9r;let nt=0;for(let st=0;st<h.length;++st){const at=h[st];let ct=0;if(i!==(at.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+st+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const dt in at.attributes){if(!s.has(dt))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+st+'. All geometries must have compatible attributes; make sure "'+dt+'" attribute exists among all geometries, or in none of them.'),null;c[dt]===void 0&&(c[dt]=[]),c[dt].push(at.attributes[dt]),ct++}if(ct!==s.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+st+". Make sure all geometries have the same number of attributes."),null;if(j!==at.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+st+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const dt in at.morphAttributes){if(!o.has(dt))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+st+".  .morphAttributes must be consistent throughout all geometries."),null;_[dt]===void 0&&(_[dt]=[]),_[dt].push(at.morphAttributes[dt])}if(e){let dt;if(i)dt=at.index.count;else{if(at.attributes.position===void 0)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+st+". The geometry must have either an index or a position attribute"),null;dt=at.attributes.position.count}et.addGroup(nt,dt,st),nt+=dt}}if(i){let st=0;const at=[];for(let ct=0;ct<h.length;++ct){const dt=h[ct].index;for(let mt=0;mt<dt.count;++mt)at.push(dt.getX(mt)+st);st+=h[ct].attributes.position.count}et.setIndex(at)}for(const st in c){const at=Ut(c[st]);if(!at)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+st+" attribute."),null;et.setAttribute(st,at)}for(const st in _){const at=_[st][0].length;if(at===0)break;et.morphAttributes=et.morphAttributes||{},et.morphAttributes[st]=[];for(let ct=0;ct<at;++ct){const dt=[];for(let yt=0;yt<_[st].length;++yt)dt.push(_[st][yt][ct]);const mt=Ut(dt);if(!mt)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+st+" morphAttribute."),null;et.morphAttributes[st].push(mt)}}return et}function Ut(h){let e,i,s,o=0;for(let j=0;j<h.length;++j){const et=h[j];if(et.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=et.array.constructor),e!==et.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=et.itemSize),i!==et.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(s===void 0&&(s=et.normalized),s!==et.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;o+=et.array.length}const c=new e(o);let _=0;for(let j=0;j<h.length;++j)c.set(h[j].array,_),_+=h[j].array.length;return new g.TlE(c,i,s)}function Qt(h){return h.isInstancedInterleavedBufferAttribute||h.isInterleavedBufferAttribute?bn(h):h.isInstancedBufferAttribute?new g.lb7().copy(h):new g.TlE().copy(h)}function tn(h){let e,i=0,s=0;for(let nt=0,st=h.length;nt<st;++nt){const at=h[nt];if(e===void 0&&(e=at.array.constructor),e!==at.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;i+=at.array.length,s+=at.itemSize}const o=new g.vpT(new e(i),s);let c=0;const _=[],j=["getX","getY","getZ","getW"],et=["setX","setY","setZ","setW"];for(let nt=0,st=h.length;nt<st;nt++){const at=h[nt],ct=at.itemSize,dt=at.count,mt=new g.kB5(o,ct,c,at.normalized);_.push(mt),c+=ct;for(let yt=0;yt<dt;yt++)for(let wt=0;wt<ct;wt++)mt[et[wt]](yt,at[j[wt]](yt))}return _}function bn(h){const e=h.data.array.constructor,i=h.count,s=h.itemSize,o=h.normalized,c=new e(i*s);let _;_=h.isInstancedInterleavedBufferAttribute?new g.lb7(c,s,o,h.meshPerAttribute):new g.TlE(c,s,o);for(let j=0;j<i;j++)_.setX(j,h.getX(j)),s>=2&&_.setY(j,h.getY(j)),s>=3&&_.setZ(j,h.getZ(j)),s>=4&&_.setW(j,h.getW(j));return _}function Yt(h){const e=h.attributes,i=h.morphTargets,s=new Map;for(const o in e){const c=e[o];c.isInterleavedBufferAttribute&&(s.has(c)||s.set(c,bn(c)),e[o]=s.get(c))}for(const o in i){const c=i[o];c.isInterleavedBufferAttribute&&(s.has(c)||s.set(c,bn(c)),i[o]=s.get(c))}}function en(h){let e=0;for(const s in h.attributes){const o=h.getAttribute(s);e+=o.count*o.itemSize*o.array.BYTES_PER_ELEMENT}const i=h.getIndex();return e+=i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0,e}function un(h,e=1e-4){const i=e>0;e=Math.max(e,Number.EPSILON);const s={},o=h.getIndex(),c=h.getAttribute("position"),_=o?o.count:c.count;let j=0;const et=Object.keys(h.attributes),nt={},st={},at=[],ct=["getX","getY","getZ","getW"],dt=["setX","setY","setZ","setW"];for(let Ct=0,bt=et.length;Ct<bt;Ct++){const At=et[Ct],Pt=h.attributes[At];nt[At]=new g.TlE(new Pt.array.constructor(Pt.count*Pt.itemSize),Pt.itemSize,Pt.normalized);const Dt=h.morphAttributes[At];Dt&&(st[At]=new g.TlE(new Dt.array.constructor(Dt.count*Dt.itemSize),Dt.itemSize,Dt.normalized))}const mt=Math.log10(1/e),yt=Math.pow(10,mt);for(let Ct=0;Ct<_;Ct++){const bt=o?o.getX(Ct):Ct;let At="";for(let Pt=0,Dt=et.length;Pt<Dt&&i;Pt++){const Nt=et[Pt],Vt=h.getAttribute(Nt),Zt=Vt.itemSize;for(let an=0;an<Zt;an++)At+=~~(Vt[ct[an]](bt)*yt)+","}if(i&&At in s)at.push(s[At]);else{for(let Pt=0,Dt=et.length;Pt<Dt;Pt++){const Nt=et[Pt],Vt=h.getAttribute(Nt),Zt=h.morphAttributes[Nt],an=Vt.itemSize,fn=nt[Nt],mn=st[Nt];for(let Sn=0;Sn<an;Sn++){const An=ct[Sn],wn=dt[Sn];if(fn[wn](j,Vt[An](bt)),Zt)for(let Mn=0,Pn=Zt.length;Mn<Pn;Mn++)mn[Mn][wn](j,Zt[Mn][An](bt))}}i&&(s[At]=j),at.push(j),j++}}const wt=h.clone();for(const Ct in h.attributes){const bt=nt[Ct];if(wt.setAttribute(Ct,new g.TlE(bt.array.slice(0,j*bt.itemSize),bt.itemSize,bt.normalized)),Ct in st)for(let At=0;At<st[Ct].length;At++){const Pt=st[Ct][At];wt.morphAttributes[Ct][At]=new g.TlE(Pt.array.slice(0,j*Pt.itemSize),Pt.itemSize,Pt.normalized)}}return wt.setIndex(at),wt}function yn(h,e){if(e===g.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),h;if(e===g.z$h||e===g.UlW){let i=h.getIndex();if(i===null){const _=[],j=h.getAttribute("position");if(j===void 0)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),h;for(let et=0;et<j.count;et++)_.push(et);h.setIndex(_),i=h.getIndex()}const s=i.count-2,o=[];if(e===g.z$h)for(let _=1;_<=s;_++)o.push(i.getX(0)),o.push(i.getX(_)),o.push(i.getX(_+1));else for(let _=0;_<s;_++)_%2==0?(o.push(i.getX(_)),o.push(i.getX(_+1)),o.push(i.getX(_+2))):(o.push(i.getX(_+2)),o.push(i.getX(_+1)),o.push(i.getX(_)));o.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const c=h.clone();return c.setIndex(o),c.clearGroups(),c}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),h}function zn(h){const e=new g.Pa4,i=new g.Pa4,s=new g.Pa4,o=new g.Pa4,c=new g.Pa4,_=new g.Pa4,j=new g.Pa4,et=new g.Pa4,nt=new g.Pa4;function st(On,er,Zn,yr,lr,ar,Mr,xr){e.fromBufferAttribute(er,lr),i.fromBufferAttribute(er,ar),s.fromBufferAttribute(er,Mr);const qr=On.morphTargetInfluences;if(Zn&&qr){j.set(0,0,0),et.set(0,0,0),nt.set(0,0,0);for(let Zr=0,ds=Zn.length;Zr<ds;Zr++){const Hs=qr[Zr],Ps=Zn[Zr];Hs!==0&&(o.fromBufferAttribute(Ps,lr),c.fromBufferAttribute(Ps,ar),_.fromBufferAttribute(Ps,Mr),yr?(j.addScaledVector(o,Hs),et.addScaledVector(c,Hs),nt.addScaledVector(_,Hs)):(j.addScaledVector(o.sub(e),Hs),et.addScaledVector(c.sub(i),Hs),nt.addScaledVector(_.sub(s),Hs)))}e.add(j),i.add(et),s.add(nt)}On.isSkinnedMesh&&(On.applyBoneTransform(lr,e),On.applyBoneTransform(ar,i),On.applyBoneTransform(Mr,s)),xr[3*lr+0]=e.x,xr[3*lr+1]=e.y,xr[3*lr+2]=e.z,xr[3*ar+0]=i.x,xr[3*ar+1]=i.y,xr[3*ar+2]=i.z,xr[3*Mr+0]=s.x,xr[3*Mr+1]=s.y,xr[3*Mr+2]=s.z}const at=h.geometry,ct=h.material;let dt,mt,yt;const wt=at.index,Ct=at.attributes.position,bt=at.morphAttributes.position,At=at.morphTargetsRelative,Pt=at.attributes.normal,Dt=at.morphAttributes.position,Nt=at.groups,Vt=at.drawRange;let Zt,an,fn,mn,Sn,An,wn;const Mn=new Float32Array(Ct.count*Ct.itemSize),Pn=new Float32Array(Pt.count*Pt.itemSize);if(wt!==null)if(Array.isArray(ct))for(Zt=0,fn=Nt.length;Zt<fn;Zt++)for(Sn=Nt[Zt],An=Math.max(Sn.start,Vt.start),wn=Math.min(Sn.start+Sn.count,Vt.start+Vt.count),an=An,mn=wn;an<mn;an+=3)dt=wt.getX(an),mt=wt.getX(an+1),yt=wt.getX(an+2),st(h,Ct,bt,At,dt,mt,yt,Mn),st(h,Pt,Dt,At,dt,mt,yt,Pn);else for(An=Math.max(0,Vt.start),wn=Math.min(wt.count,Vt.start+Vt.count),Zt=An,fn=wn;Zt<fn;Zt+=3)dt=wt.getX(Zt),mt=wt.getX(Zt+1),yt=wt.getX(Zt+2),st(h,Ct,bt,At,dt,mt,yt,Mn),st(h,Pt,Dt,At,dt,mt,yt,Pn);else if(Array.isArray(ct))for(Zt=0,fn=Nt.length;Zt<fn;Zt++)for(Sn=Nt[Zt],An=Math.max(Sn.start,Vt.start),wn=Math.min(Sn.start+Sn.count,Vt.start+Vt.count),an=An,mn=wn;an<mn;an+=3)dt=an,mt=an+1,yt=an+2,st(h,Ct,bt,At,dt,mt,yt,Mn),st(h,Pt,Dt,At,dt,mt,yt,Pn);else for(An=Math.max(0,Vt.start),wn=Math.min(Ct.count,Vt.start+Vt.count),Zt=An,fn=wn;Zt<fn;Zt+=3)dt=Zt,mt=Zt+1,yt=Zt+2,st(h,Ct,bt,At,dt,mt,yt,Mn),st(h,Pt,Dt,At,dt,mt,yt,Pn);return{positionAttribute:Ct,normalAttribute:Pt,morphedPositionAttribute:new g.a$l(Mn,3),morphedNormalAttribute:new g.a$l(Pn,3)}}function Yn(h){if(h.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),h;let e=h.groups;if(e=e.sort((_,j)=>_.materialIndex!==j.materialIndex?_.materialIndex-j.materialIndex:_.start-j.start),h.getIndex()===null){const _=h.getAttribute("position"),j=[];for(let et=0;et<_.count;et+=3)j.push(et,et+1,et+2);h.setIndex(j)}const i=h.getIndex(),s=[];for(let _=0;_<e.length;_++){const j=e[_],et=j.start,nt=et+j.count;for(let st=et;st<nt;st++)s.push(i.getX(st))}h.dispose(),h.setIndex(s);let o=0;for(let _=0;_<e.length;_++){const j=e[_];j.start=o,o+=j.count}let c=e[0];h.groups=[c];for(let _=1;_<e.length;_++){const j=e[_];c.materialIndex===j.materialIndex?c.count+=j.count:(c=j,h.groups.push(c))}return h}function tr(h,e=Math.PI/3){const i=Math.cos(e),s=100*(1+1e-10),o=[new g.Pa4,new g.Pa4,new g.Pa4],c=new g.Pa4,_=new g.Pa4,j=new g.Pa4,et=new g.Pa4;function nt(yt){return`${~~(yt.x*s)},${~~(yt.y*s)},${~~(yt.z*s)}`}const st=h.toNonIndexed(),at=st.attributes.position,ct={};for(let yt=0,wt=at.count/3;yt<wt;yt++){const Ct=3*yt,bt=o[0].fromBufferAttribute(at,Ct+0),At=o[1].fromBufferAttribute(at,Ct+1),Pt=o[2].fromBufferAttribute(at,Ct+2);c.subVectors(Pt,At),_.subVectors(bt,At);const Dt=new g.Pa4().crossVectors(c,_).normalize();for(let Nt=0;Nt<3;Nt++){const Vt=nt(o[Nt]);Vt in ct||(ct[Vt]=[]),ct[Vt].push(Dt)}}const dt=new Float32Array(3*at.count),mt=new g.TlE(dt,3,!1);for(let yt=0,wt=at.count/3;yt<wt;yt++){const Ct=3*yt,bt=o[0].fromBufferAttribute(at,Ct+0),At=o[1].fromBufferAttribute(at,Ct+1),Pt=o[2].fromBufferAttribute(at,Ct+2);c.subVectors(Pt,At),_.subVectors(bt,At),j.crossVectors(c,_).normalize();for(let Dt=0;Dt<3;Dt++){const Nt=ct[nt(o[Dt])];et.set(0,0,0);for(let Vt=0,Zt=Nt.length;Vt<Zt;Vt++){const an=Nt[Vt];j.dot(an)>i&&et.add(an)}et.normalize(),mt.setXYZ(Ct+Dt,et.x,et.y,et.z)}}return st.setAttribute("normal",mt),st}function Un(h,e=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),_n(h,e)}function Jn(h){return console.warn("THREE.BufferGeometryUtils: mergeBufferAttributes() has been renamed to mergeAttributes()."),Ut(h)}function hn(h,e){let i,s;if(Array.isArray(h))for(const c of h){const _=hn(c,e);i===void 0||s===void 0?(i=_.min.clone(),s=_.max.clone()):(i.min(_.min),s.max(_.max))}const o=h;if(o.geometry!==void 0){const c=o.geometry.vertices;if(c===void 0&&o.geometry.attributes!==void 0&&"position"in o.geometry.attributes){const _=new g.Pa4,j=o.geometry.attributes.position;for(let et=0;et<j.count*j.itemSize;et+=j.itemSize){_.set(j.array[et],j.array[et+1],j.array[3]);const nt=_.applyMatrix4(h.matrixWorld).project(e),st=new nn(nt.x,nt.y);i===void 0||s===void 0?(i=st.clone(),s=st.clone()):(i.min(st),s.max(st))}}else for(const _ of c){const j=_.clone().applyMatrix4(h.matrixWorld).project(e),et=new nn(j.x,j.y);i===void 0||s===void 0?(i=et.clone(),s=et.clone()):(i.min(et),s.max(et))}}if(h.children!==void 0)for(const c of h.children){const _=hn(c,e);i===void 0||s===void 0?(i=_.min.clone(),s=_.max.clone()):(i.min(_.min),s.max(_.max))}return new g.TUj(i,s)}const rr="rgbm-16";function sr(h){switch(h){case g.aCh:case g.GUF:return["Linear","( value )"];case g.KI_:return["sRGB","( value )"];case rr:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported colorSpace:",h),["Linear","( value )"]}}function br(h,e){let i;return h&&h.isTexture?i=h.colorSpace:h&&h.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=h.texture.colorSpace):i=g.GUF,e&&h&&h.isTexture&&h.format===g.wk1&&h.type===g.ywz&&h.colorSpace===g.KI_&&(i=g.GUF),i}function Kn(h,e){const i=sr(e);return"vec4 "+h+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function dn(h,e,i){return Kn(h+"TexelToLinear",br(e,i))+`
`}function kn(h,e){return Kn(h+"TexelToLinear",e)+`
`}function Vn(h,e){const i=sr(e);return"vec4 "+h+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Rr(h,e,i){return Vn(h,br(e,i))}function cr({uniforms:h,propKey:e,thisTarget:i=!1}={}){const s=!!h,o=!!e,c=i;return(_,j)=>{const et=nt=>{const st=c?nt:s?h:nt.uniforms||nt._uniforms;let at=o?e:j;c&&(at="_"+at);let ct=st[at];return ct||(ct={value:null},st[at]=ct),ct};Object.defineProperty(_,j,{get(){return et(this).value},set(nt){et(this).value=nt,(0,b.safeSetProperty)(this,"uniformsNeedUpdate",!0,!0)}})}}function Hr(h,e,i=!1,s){const o=!!e,c=!!h;return(_,j)=>{const et=nt=>({t:o?e:nt.defines||nt._defines,p:c?h:j});Object.defineProperty(_,j,{get(){const{t:nt,p:st}=et(i?this:this.material);return nt[st]},set(nt){const{t:st,p:at}=et(i?this:this.material);if((0,b.safeSetProperty)(st,at,nt,!0),typeof s=="function"){const ct=[at,nt];if(s.name){const dt=this[s.name];dt===s?s.call(this,...ct):dt.name===`bound ${s.name}`?dt(...ct):s(...ct)}else s(...ct)}else(0,b.safeSetProperty)(i?this:this.material,"needsUpdate",!0,!0)}})}}function xs(h){const e=new g.IEO(new Uint8Array([Math.floor(255*h.r),Math.floor(255*h.g),Math.floor(255*h.b),255]),1,1,g.wk1,g.ywz);return e.needsUpdate=!0,e.colorSpace=g.aCh,e}function Ys(h){const e=new g.IEO(new Uint8Array([Math.floor(255*h.x),Math.floor(255*h.y),Math.floor(255*h.z),Math.floor(255*h.w)]),1,1,g.wk1,g.ywz);return e.needsUpdate=!0,e}function ls(h,e,i){const s=h.userData,{backgroundRender:o,transparentRender:c,shadowMapRender:_,mainRenderPass:j,opaqueRender:et,transmissionRender:nt,sceneRender:st,screenSpaceRendering:at}=s;e.backgroundRender!==void 0&&(s.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(s.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(s.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(s.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(s.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(s.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(s.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(s.screenSpaceRendering=e.screenSpaceRendering),i(),s.backgroundRender=o,s.transparentRender=c,s.shadowMapRender=_,s.mainRenderPass=j,s.opaqueRender=et,s.sceneRender=st,s.transmissionRender=nt,s.screenSpaceRendering=at}function oo(h){const e=new Wt().expandByObject(h,!0,!0).getCenter(new g.Pa4);h.position.sub(e),h.updateMatrix(),h.userData.autoCentered=!0,h.userData.isCentered=!0}function Ks(h,e,i){const s=.5*new Wt().expandByObject(h,!0,!0).getSize(new g.Pa4).length();e===void 0&&(e=h.userData.autoScaleRadius||1);const o=e/s;return isFinite(o)&&(h.userData.pseudoCentered?h.children.forEach(c=>{c.scale.multiplyScalar(o)}):h.scale.multiplyScalar(o),(i||h.userData.isCentered)&&h.position.multiplyScalar(o),h.traverse(c=>{var _,j;c.isLight&&((j=(_=c.shadow)==null?void 0:_.camera)!=null&&j.right)&&(c.shadow.camera.right*=o,c.shadow.camera.left*=o,c.shadow.camera.top*=o,c.shadow.camera.bottom*=o),c.isCamera&&c.right&&(c.right*=o,c.left*=o,c.top*=o,c.bottom*=o)}),h.userData.autoScaled=!0,h.userData.autoScaleRadius=e,h.dispatchEvent({type:"objectUpdate"})),h}function Xo(h,e=-1){return un(h,e)}const fr=2,ko=3,pu=0,Fu=1,wo=3,Pl=4,xa=1006,Bl=3001,po="srgb",Go="srgb-linear",su="display-p3";class Ho{constructor(){Ho.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,i,s,o,c,_,j,et,nt){const st=this.elements;return st[0]=e,st[1]=o,st[2]=j,st[3]=i,st[4]=c,st[5]=et,st[6]=s,st[7]=_,st[8]=nt,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this}extractBasis(e,i,s){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,o=i.elements,c=this.elements,_=s[0],j=s[3],et=s[6],nt=s[1],st=s[4],at=s[7],ct=s[2],dt=s[5],mt=s[8],yt=o[0],wt=o[3],Ct=o[6],bt=o[1],At=o[4],Pt=o[7],Dt=o[2],Nt=o[5],Vt=o[8];return c[0]=_*yt+j*bt+et*Dt,c[3]=_*wt+j*At+et*Nt,c[6]=_*Ct+j*Pt+et*Vt,c[1]=nt*yt+st*bt+at*Dt,c[4]=nt*wt+st*At+at*Nt,c[7]=nt*Ct+st*Pt+at*Vt,c[2]=ct*yt+dt*bt+mt*Dt,c[5]=ct*wt+dt*At+mt*Nt,c[8]=ct*Ct+dt*Pt+mt*Vt,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[1],o=e[2],c=e[3],_=e[4],j=e[5],et=e[6],nt=e[7],st=e[8];return i*_*st-i*j*nt-s*c*st+s*j*et+o*c*nt-o*_*et}invert(){const e=this.elements,i=e[0],s=e[1],o=e[2],c=e[3],_=e[4],j=e[5],et=e[6],nt=e[7],st=e[8],at=st*_-j*nt,ct=j*et-st*c,dt=nt*c-_*et,mt=i*at+s*ct+o*dt;if(mt===0)return this.set(0,0,0,0,0,0,0,0,0);const yt=1/mt;return e[0]=at*yt,e[1]=(o*nt-st*s)*yt,e[2]=(j*s-o*_)*yt,e[3]=ct*yt,e[4]=(st*i-o*et)*yt,e[5]=(o*c-j*i)*yt,e[6]=dt*yt,e[7]=(s*et-nt*i)*yt,e[8]=(_*i-s*c)*yt,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,s,o,c,_,j){const et=Math.cos(c),nt=Math.sin(c);return this.set(s*et,s*nt,-s*(et*_+nt*j)+_+e,-o*nt,o*et,-o*(-nt*_+et*j)+j+i,0,0,1),this}scale(e,i){return this.premultiply(ou.makeScale(e,i)),this}rotate(e){return this.premultiply(ou.makeRotation(-e)),this}translate(e,i){return this.premultiply(ou.makeTranslation(e,i)),this}makeTranslation(e,i){return this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,s,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,s=e.elements;for(let o=0;o<9;o++)if(i[o]!==s[o])return!1;return!0}fromArray(e,i=0){for(let s=0;s<9;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const ou=new Ho;function Uo(h){return h<.04045?.0773993808*h:Math.pow(.9478672986*h+.0521327014,2.4)}function au(h){return h<.0031308?12.92*h:1.055*Math.pow(h,.41666)-.055}const kp=new Ho().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),Ap=new Ho().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),Cv={[Go]:h=>h,[po]:h=>h.convertSRGBToLinear(),[su]:function(h){return h.convertSRGBToLinear().applyMatrix3(Ap)}},xl={[Go]:h=>h,[po]:h=>h.convertLinearToSRGB(),[su]:function(h){return h.applyMatrix3(kp).convertLinearToSRGB()}},fu={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(h){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!h},get workingColorSpace(){return Go},set workingColorSpace(h){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(h,e,i){if(this.enabled===!1||e===i||!e||!i)return h;const s=Cv[e],o=xl[i];if(s===void 0||o===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${i}".`);return o(s(h))},fromWorkingColorSpace:function(h,e){return this.convert(h,this.workingColorSpace,e)},toWorkingColorSpace:function(h,e){return this.convert(h,e,this.workingColorSpace)}},Tm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gl={h:0,s:0,l:0},Io={h:0,s:0,l:0};function sp(h,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?h+6*(e-h)*i:i<.5?e:i<2/3?h+6*(e-h)*(2/3-i):h}class To{constructor(e,i,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,i===void 0&&s===void 0?this.set(e):this.setRGB(e,i,s)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=po){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,fu.toWorkingColorSpace(this,i),this}setRGB(e,i,s,o=fu.workingColorSpace){return this.r=e,this.g=i,this.b=s,fu.toWorkingColorSpace(this,o),this}setHSL(e,i,s,o=fu.workingColorSpace){if(e=function(c,_){return(c%_+_)%_}(e,1),i=Gt(i,0,1),s=Gt(s,0,1),i===0)this.r=this.g=this.b=s;else{const c=s<=.5?s*(1+i):s+i-s*i,_=2*s-c;this.r=sp(_,c,e+1/3),this.g=sp(_,c,e),this.b=sp(_,c,e-1/3)}return fu.toWorkingColorSpace(this,o),this}setStyle(e,i=po){function s(c){c!==void 0&&parseFloat(c)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let o;if(o=/^(\w+)\(([^\)]*)\)/.exec(e)){let c;const _=o[1],j=o[2];switch(_){case"rgb":case"rgba":if(c=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(j))return s(c[4]),this.setRGB(Math.min(255,parseInt(c[1],10))/255,Math.min(255,parseInt(c[2],10))/255,Math.min(255,parseInt(c[3],10))/255,i);if(c=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(j))return s(c[4]),this.setRGB(Math.min(100,parseInt(c[1],10))/100,Math.min(100,parseInt(c[2],10))/100,Math.min(100,parseInt(c[3],10))/100,i);break;case"hsl":case"hsla":if(c=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(j))return s(c[4]),this.setHSL(parseFloat(c[1])/360,parseFloat(c[2])/100,parseFloat(c[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(e)){const c=o[1],_=c.length;if(_===3)return this.setRGB(parseInt(c.charAt(0),16)/15,parseInt(c.charAt(1),16)/15,parseInt(c.charAt(2),16)/15,i);if(_===6)return this.setHex(parseInt(c,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=po){const s=Tm[e.toLowerCase()];return s!==void 0?this.setHex(s,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Uo(e.r),this.g=Uo(e.g),this.b=Uo(e.b),this}copyLinearToSRGB(e){return this.r=au(e.r),this.g=au(e.g),this.b=au(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=po){return fu.fromWorkingColorSpace(Zo.copy(this),e),65536*Math.round(Gt(255*Zo.r,0,255))+256*Math.round(Gt(255*Zo.g,0,255))+Math.round(Gt(255*Zo.b,0,255))}getHexString(e=po){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=fu.workingColorSpace){fu.fromWorkingColorSpace(Zo.copy(this),i);const s=Zo.r,o=Zo.g,c=Zo.b,_=Math.max(s,o,c),j=Math.min(s,o,c);let et,nt;const st=(j+_)/2;if(j===_)et=0,nt=0;else{const at=_-j;switch(nt=st<=.5?at/(_+j):at/(2-_-j),_){case s:et=(o-c)/at+(o<c?6:0);break;case o:et=(c-s)/at+2;break;case c:et=(s-o)/at+4}et/=6}return e.h=et,e.s=nt,e.l=st,e}getRGB(e,i=fu.workingColorSpace){return fu.fromWorkingColorSpace(Zo.copy(this),i),e.r=Zo.r,e.g=Zo.g,e.b=Zo.b,e}getStyle(e=po){fu.fromWorkingColorSpace(Zo.copy(this),e);const i=Zo.r,s=Zo.g,o=Zo.b;return e!==po?`color(${e} ${i.toFixed(3)} ${s.toFixed(3)} ${o.toFixed(3)})`:`rgb(${Math.round(255*i)},${Math.round(255*s)},${Math.round(255*o)})`}offsetHSL(e,i,s){return this.getHSL(Gl),Gl.h+=e,Gl.s+=i,Gl.l+=s,this.setHSL(Gl.h,Gl.s,Gl.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,s){return this.r=e.r+(i.r-e.r)*s,this.g=e.g+(i.g-e.g)*s,this.b=e.b+(i.b-e.b)*s,this}lerpHSL(e,i){this.getHSL(Gl),e.getHSL(Io);const s=vn(Gl.h,Io.h,i),o=vn(Gl.s,Io.s,i),c=vn(Gl.l,Io.l,i);return this.setHSL(s,o,c),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,s=this.g,o=this.b,c=e.elements;return this.r=c[0]*i+c[3]*s+c[6]*o,this.g=c[1]*i+c[4]*s+c[7]*o,this.b=c[2]*i+c[5]*s+c[8]*o,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Zo=new To;function Po(h,e){return{type:"folder",label:e+" Sampler",hidden:()=>!h[e],children:[()=>({type:"vec2",label:"Repeat",bounds:[-100,100],stepSize:.001,property:[h[e],"repeat"],onChange:h==null?void 0:h.setDirty}),()=>({type:"vec2",label:"Offset",bounds:[-2,2],stepSize:.001,property:[h[e],"offset"],onChange:h==null?void 0:h.setDirty}),()=>({type:"vec2",label:"Center",bounds:[-2,2],stepSize:.001,property:[h[e],"center"],onChange:h==null?void 0:h.setDirty}),()=>({type:"input",label:"Rotation",stepSize:.001,bounds:[-Math.PI,Math.PI],property:[h[e],"rotation"],onChange:h==null?void 0:h.setDirty}),()=>({type:"dropdown",label:"Color Space",property:[h[e],"colorSpace"],children:[["Linear",g.GUF],["sRGB",g.KI_]].map(i=>({label:i[0],value:i[1]})),onChange:[()=>{const i=h[e];i&&(i.needsUpdate=!0)},h==null?void 0:h.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var i;return((i=h[e])==null?void 0:i.flipY)??!1},setValue:i=>{var o;const s=h[e];if(s&&s.flipY!==i)if(s.image&&ImageBitmap&&s.image instanceof ImageBitmap){const c=s,_=s.source.data;createImageBitmap(_,{imageOrientation:"flipY"}).then(j=>{var et;_.close&&_.close(),c.flipY=i,c.source.data=j,c.source.needsUpdate=!0,c.needsUpdate=!0,(et=h==null?void 0:h.setDirty)==null||et.call(h)})}else s.flipY=i,s.needsUpdate=!0,(o=h==null?void 0:h.setDirty)==null||o.call(h)}}),()=>({type:"dropdown",label:"Wrap S",property:[h[e],"wrapS"],children:[["ClampToEdge",g.uWy],["MirroredRepeat",g.OoA],["Repeat",g.rpg]].map(i=>({label:i[0],value:i[1]})),onChange:[()=>{h[e]&&(h[e].needsUpdate=!0)},h==null?void 0:h.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[h[e],"wrapT"],children:[["ClampToEdge",g.uWy],["MirroredRepeat",g.OoA],["Repeat",g.rpg]].map(i=>({label:i[0],value:i[1]})),onChange:[()=>{h[e]&&(h[e].needsUpdate=!0)},h==null?void 0:h.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[h[e],"anisotropy"],onChange:[()=>{h[e]&&(h[e].needsUpdate=!0),h.needsUpdate=!0},h==null?void 0:h.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[h[e],"minFilter"],children:[["Linear",xa],["Nearest",g.TyD],["NearestMipmapNearest",g.YLQ],["NearestMipmapLinear",g.vZf],["LinearMipmapNearest",g.qyh],["LinearMipmapLinear",g.D1R]].map(i=>({label:i[0],value:i[1]})),onChange:[()=>{h[e]&&(h[e].needsUpdate=!0)},h==null?void 0:h.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[h[e],"magFilter"],children:[["Linear",xa],["Nearest",g.TyD]].map(i=>({label:i[0],value:i[1]})),onChange:[()=>{h[e]&&(h[e].needsUpdate=!0)},h==null?void 0:h.setDirty]})]}}To.NAMES=Tm;const Mm=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function Jl(h,e,i=!0){if(!e)return h;for(const s of Object.keys(e)){if(i&&Mm.includes(s)||s.startsWith("__"))continue;const o=e[s];if(typeof h[s]=="function"||typeof o=="function")continue;const c=!o||o.isTexture||o.isObject3D||o.isMaterial;c||typeof o.clone!="function"?c||typeof o!="object"&&!Array.isArray(o)?h[s]=o:h[s]=Jl(Array.isArray(o)?[]:{},o,!1):h[s]=o.clone()}return h}const ju=["appliedMaterials","uuid"];function Bs(h,e){if(e)for(const i of Object.keys(e))ju.includes(i)||i.startsWith("__")||typeof h[i]!="function"&&typeof e[i]!="function"&&(h[i]=e[i]);return h}function Ds(h,e,i){const s=(i==null?void 0:i.data)??new Uint8ClampedArray(h.height*h.width*4),o=h.data instanceof Float32Array,c=h.data instanceof Uint16Array;for(let _=0;_<s.length;_++)s[_]=o?255*h.data[_]:c?255*g.A5E.fromHalfFloat(h.data[_]):h.data[_],e===g.GUF&&(s[_]=255*(0,b.LinearToSRGB)(s[_]/255));return i??new ImageData(s,h.width,h.height)}function Fo(h,e,i=!1){let s;return s=h.isDataTexture?Ds(h.image,h.colorSpace):h.image,Ll(s,e,i)}function Ll(h,e,i=!1){const s=document.createElement("canvas");s.width=Math.min(e,h.width),s.height=Math.floor(1+s.width*h.height/h.width);const o=s.getContext("2d");if(!o)return console.error("textureToDataUrl: could not get canvas context"),s;i===!0&&(o.translate(0,s.height),o.scale(1,-1));let c=!1;if(h.data!==void 0){const _=h;if(h.width!==s.width||h.height!==s.height){const j=document.createElement("canvas");j.width=h.width,j.height=h.height;const et=j.getContext("2d");et?(et.putImageData(_,0,0),o.drawImage(j,0,0,s.width,s.height)):(console.error("textureToDataUrl: could not get temp canvas context"),o.putImageData(_,0,0))}else o.putImageData(_,0,0),i&&(c=!0)}else o.drawImage(h,0,0,s.width,s.height);return c?(0,b.canvasFlipY)(s):s}function fs(h,e,i,s,o){return Fo(h,e,i).toDataURL(s,o)}String.prototype.replaceAll||(String.prototype.replaceAll=function(h,e){return Object.prototype.toString.call(h).toLowerCase()==="[object regexp]"?this.replace(h,e):this.replace(new RegExp(h,"g"),e)});const Ns=new Map;function En(h){return(e,i)=>{const s=e.constructor;if(s===Object)throw new Error("All properties in an object are serialized by default");Ns.has(s)||Ns.set(s,[]),Ns.get(s).push([h||i,i])}}const Js={obj:(h,e)=>Object.fromEntries(Object.entries(h).map(([i,s])=>[i,Ls(s,!1,e)])),vec4:h=>({x:h.x,y:h.y,z:h.z,w:h.w,isVector4:!0}),vec3:h=>({x:h.x,y:h.y,z:h.z,isVector3:!0}),vec2:h=>({x:h.x,y:h.y,isVector2:!0}),color:h=>({r:h.r,g:h.g,b:h.b,isColor:!0}),quat:h=>({x:h.x,y:h.y,z:h.z,w:h.w,isQuaternion:!0}),texture:(h,e)=>{var j;if(!(h!=null&&h.isTexture))throw new Error("Expected a texture");if(e!=null&&e.textures[h.uuid])return{uuid:h.uuid,resource:"textures"};if(h.isRenderTargetTexture&&!((j=h.userData)!=null&&j.serializableRenderTarget))return;const i=h.source.data,s=!h.isRenderTargetTexture&&h.userData.rootPath;s&&h.source.data&&(h.userData.__embedUrlImagePreviews?h.source.data=Fo(h,16,h.flipY):h.source.data=null);const o=h.userData;h.userData={};const c={images:{}};let _=h.toJSON(e||c);return!e&&_.image&&(_.image=s&&!h.userData.__embedUrlImagePreviews?void 0:c.images[_.image]),h.userData=o,_.userData=Ls(Bs({},o),!1,e),s&&(e&&!h.userData.__embedUrlImagePreviews&&delete e.images[h.source.uuid],h.source.data=i),e!=null&&e.textures&&!_.resource&&(e.textures[_.uuid]||(e.textures[_.uuid]=_),_={uuid:_.uuid,resource:"textures"}),_},material:(h,e)=>{if(!(h!=null&&h.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[h.uuid])return{uuid:h.uuid,resource:"materials"};h.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const i=e??{textures:{},images:{}},s={},o={};for(const[_,j]of Object.entries(h))if(j!=null&&j.isTexture&&!_.startsWith("__")){const et=Js.texture(j,i);s[_]=et,o[_]=j,h[_]=et?{isTexture:!0,toJSON:()=>et}:null}let c=h.toJSON(e);for(const[_,j]of Object.entries(o))h[_]=j,delete o[_];if(e){for(const[_,j]of Object.entries(s))j&&(c[_]=j);e!=null&&e.materials&&(e.materials[c.uuid]||(e.materials[c.uuid]=c),c={uuid:c.uuid,resource:"materials"})}else{for(const[_,j]of Object.entries(s))j&&(c[_]=j.uuid);c.textures=Object.values(i.textures),c.images=Object.values(i.images)}return c}},El=h=>(e,i)=>{var s;return((s=i==null?void 0:i.copy)==null?void 0:s.call(i,e))??new h().copy(e)},to={obj:(h,e,i)=>Object.assign(e,Object.fromEntries(Object.entries(h).map(([s,o])=>[s,ao(o,e==null?void 0:e[s],!1,i)]))),vec4:El(g.Ltg),vec3:El(g.Pa4),vec2:El(nn),color:El(To),quat:El(g._fP)};function Ls(h,e,i){var c;if(typeof h=="function")return;if(Array.isArray(h))return h.map(_=>Ls(_,!1,i));if(typeof h!="object"){if(typeof h=="number"){if(h===1/0)return"Infinity";if(h===-1/0)return"-Infinity";if(isNaN(h))return"NaN"}return h}if(!h)return h;let s=h.constructor??Object;if(s===Object)return Js.obj(h,i);if(h.isVector2)return Js.vec2(h);if(h.isVector3)return Js.vec3(h);if(h.isVector4)return Js.vec4(h);if(h.isColor)return Js.color(h);if(h.isQuaternion)return Js.quat(h);if(h.isTexture)return Js.texture(h,i);if(h.isMaterial)return Js.material(h,i);if(!e&&typeof h.toJSON=="function"){const _=h.toJSON(i);return h.serializableClassId&&_&&(_.serializableClassId=h.serializableClassId),_}const o={};for(;s&&s!==Object;)(c=Ns.get(s))==null||c.forEach(([_,j])=>{const et=h[j];o[_]=Ls(et,!1,i)}),s=Object.getPrototypeOf(s);return h.serializableClassId&&(o.serializableClassId=h.serializableClassId),o}function ao(h,e,i,s){var j,et;let o=e;if(h===void 0)return o;if(typeof e=="number"){if(h==="Infinity")return 1/0;if(h==="-Infinity")return-1/0;if(h==="NaN")return NaN;if(typeof h=="number"||!h)return h}if(Array.isArray(h)){const nt=h.length;Array.isArray(o)||(o=[]);for(let st=0;st<nt;st++){const at=h[st],ct=o.length>st?ao(at,o[st],!1,s):ao(at,void 0,!1,s);o.length<=st?o.push(ct):o[st]=ct}return o}let c=!1;if(h&&h.resource&&typeof h.resource=="string"&&(h=(j=s[h.resource])==null?void 0:j[h.uuid],c=!0),!o&&h&&!c)if(h.serializableClassId){const nt=wu.get(h.serializableClassId);nt&&(o=nt.DataInConstructor?new nt(h):new nt)}else typeof h!="object"||h.constructor&&h.constructor!==Object||(o={});if(typeof o=="function")return console.error("cannot deserialize over function",o,h),o;if(h&&typeof h=="object"&&!c){if(h.isVector2)return to.vec2(h,o);if(h.isVector3)return to.vec3(h,o);if(h.isVector4)return to.vec4(h,o);if(h.isColor)return to.color(h,o);if(h.isQuaternion)return to.quat(h,o)}if(h==null||o==null||typeof o!="object"||o.isTexture)return c&&(h?h.__useCount=h.__useCount?h.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),h;let _=o.constructor??Object;if(_===Object)return to.obj(h,o,s);if(!i&&typeof o.fromJSON=="function")return o.isMaterial&&(Object.entries(h).forEach(([nt,st])=>{var ct;if(!st||!st.resource||typeof st.resource!="string")return;const at=(ct=s[st.resource])==null?void 0:ct[st.uuid];h[nt]=at||null}),h.userData&&(h.userData=ao(h.userData,void 0,!1,s))),o.fromJSON(h,s),o;for(;_&&_!==Object;)(et=Ns.get(_))==null||et.forEach(([nt,st])=>{const at=o[st],ct=ao(h[nt],at,!1,s);ct!==at&&(0,b.safeSetProperty)(o,st,ct,!0)}),_=Object.getPrototypeOf(_);return o}const wu=new Map;function Yo(h){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=h}},wu.set(h,e),e)}function $a(h,e,i,s){var _,j,et;if(e!=null&&e.extras[h.uuid])return{uuid:h.uuid,resource:"extras"};let o="";if((_=h.source)!=null&&_._sourceImgBuffer||h.userData.__sourceBuffer){const nt=new Uint8Array(((j=h.source)==null?void 0:j._sourceImgBuffer)||h.userData.__sourceBuffer),st=s||h.userData.mimeType||"";o={data:Array.from(nt),type:nt.constructor.name,path:((et=h.userData.__sourceBlob)==null?void 0:et.name)||h.userData.rootPath||"file."+st.split("/")[1]},st&&(o.mimeType=st)}else h.userData.rootPath?o=h.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const c={uuid:h.uuid,url:o,userData:Bs({},h.userData),type:h.type,name:i||h.name};return e!=null&&e.extras?(e.extras[h.uuid]=c,{uuid:h.uuid,resource:"extras"}):c}var $u=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Ko=class extends b.SimpleEventDispatcher{get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(h){h!==this._displayCanvasScaling&&(this._displayCanvasScaling=h,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}get totalFrameCount(){return this._totalFrameCount}set pipeline(h){this._pipeline=h,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){const h=this._passes,e=[],i={};for(const s of h){if(s.enabled===!1)continue;const o={after:s.after??[],before:s.before??[],dependencies:new Set(s.required??[])};i[s.passId]=o}for(const[s,o]of Object.entries(i)){const c=new Set([...o.after,...o.before]);o.dependencies.forEach(_=>c.has(_)&&c.delete(_)),c.forEach(_=>{const j=i[_];if(j){if(j.dependencies.has(s))throw console.error("cyclic",s,_),"Cyclic dependency";o.dependencies.add(_)}})}for(;;){let s=!1;const o=[...Object.entries(i)];for(const[c,_]of o)if(!e.includes(c)&&(0,b.includesAll)(e,_.dependencies.values())){const j=Math.max(-1,..._.after.map(nt=>e.indexOf(nt))),et=Math.min(e.length,..._.before.map(nt=>{const st=e.indexOf(nt);return st<0?e.length:st}));if(j>=et)throw console.error(_,h,e,j,et),"Not possible";e.splice(_.after.length>0?j+1:et,0,c),s=!0,delete i[c]}if(Object.keys(i).length<1)break;if(!s)throw console.error(o,i,e),"Not possible 2"}return this.pipeline=e,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(h,e){const i=h-this._lastTime;this._lastTime=h,this.frameWaitTime-=i,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:i,time:h,renderer:this,xrFrame:e}))}get clock(){return this._composer.clock}registerPass(h,e=!0){var i;if(e)for(const s of[...this._passes])h.passId===s.passId&&this.unregisterPass(s);this._passes.push(h),(i=h.onRegister)==null||i.call(h,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(h){var i;const e=this._passes.indexOf(h);e>=0&&((i=h.onUnregister)==null||i.call(h,this),this._passes.splice(e,1),this._passesNeedsUpdate=!0,this._updated())}constructor({animationLoop:h,canvas:e,alpha:i=!0,targetOptions:s}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new g.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._totalFrameCount=0,this.stableNoise=!1,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new g.CP7({canvas:e,antialias:!1,alpha:i,premultipliedAlpha:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"}),this._renderer.useLegacyLights=!1,this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderer.onContextLost=o=>{this.dispatchEvent({type:"contextLost",event:o})},this._renderer.onContextRestore=()=>{this.dispatchEvent({type:"contextRestored"})},this._renderSize=new g.FM8(e.clientWidth,e.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=g.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputColorSpace=g.aCh,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=g._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(s,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new qt(this._renderer,this._composerTarget),h&&this.addEventListener("animationLoop",h)}setSize(h,e,i=!1){!i&&(h?Math.abs(h-this._renderSize.width):0)+(e?Math.abs(e-this._renderSize.height):0)<.1||(h&&(this._renderSize.width=h),e&&(this._renderSize.height=e),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(s=>{const o=s,c=o.sizeMultiplier;if(c){const _=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*c);o.setSize(Math.floor(_.width),Math.floor(_.height))}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(h,e,{viewport:i,material:s,shader:o,pass:c,clear:_=!0}={}){const j=this._composer.copyPass,{renderToScreen:et,material:nt,uniforms:st,clear:at}=j;s&&(j.material=s);const ct=this._renderer.getViewport(new g.Ltg),dt=this._renderer.autoClear,mt=this._renderer.getRenderTarget();i&&this._renderer.setViewport(new g.Ltg().fromArray(i)),this._renderer.autoClear=!1,j.uniforms=j.material.uniforms,j.renderToScreen=!1,j.clear=_,ls(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{j.render(this._renderer,e??null,{texture:h},0,!1)}),j.renderToScreen=et,j.clear=at,j.material=nt,j.uniforms=st,this._renderer.autoClear=dt,i&&this._renderer.setViewport(ct),this._renderer.setRenderTarget(mt)}clearColor({r:h,g:e,b:i,a:s,target:o,depth:c=!0,stencil:_=!0}){const j=this._renderer.getClearColor(new g.Ilk),et=this._renderer.getClearAlpha();this._renderer.setClearAlpha(s??et),this._renderer.setClearColor(new g.Ilk(h??j.r,e??j.g,i??j.b));const nt=this._renderer.getRenderTarget(),st=this._renderer.getActiveCubeFace(),at=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget(o??null),this._renderer.clear(!0,c,_),this._renderer.setRenderTarget(nt,st,at),this._renderer.setClearColor(j),this._renderer.setClearAlpha(et)}renderModel(h,e){this._renderer.render(h.modelObject,e.cameraObject)}renderScene(h){const e=h.activeCamera;e&&this.renderModel(h,e)}_updated(){this.dispatchEvent({type:"update"})}render(h=!0){var e;this._passesNeedsUpdate&&this.refreshPasses();for(const i of this._passes)i.passObject.enabled&&((e=i.update)==null||e.call(i));this._composer.renderToScreen=h,this._composer.render(),this._composer.renderToScreen=!0,h&&(this._frameCount+=1,this._totalFrameCount+=1),this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(h=>h.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const h=[];for(const e of this._pipeline){const i=this._passes.find(s=>s.passId===e);i?h.push(i.passObject):console.warn("Unable to find pass: ",e)}[...this._composer.passes].forEach(e=>this._composer.removePass(e)),h.forEach(e=>this._composer.addPass(e)),this._updated()}dispose(){this._trackedTargets.forEach(h=>h.dispose()),this._trackedTargets=[],this._renderer.dispose()}trackTarget(h){this._trackedTargets.push(h)}removeTrackedTarget(h){const e=this._trackedTargets.indexOf(h);e>=0&&this._trackedTargets.splice(e,1)}createTarget({sizeMultiplier:h,samples:e=0,colorSpace:i=g.aCh,type:s=g.ywz,format:o=g.wk1,depthBuffer:c=!0,depthTexture:_=!1,size:j,textureCount:et=1,...nt}={},st=!0){this.isWebGL2||(e=0),h!==void 0&&j!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),(j=j||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(h=h||1))).width=Math.floor(j.width),j.height=Math.floor(j.height);const at=_?new g.$YQ(j.width,j.height,g.ywz):void 0,ct=this.createTargetCustom(et>1?{width:j.width,height:j.height,count:et}:j,{samples:e,colorSpace:i,type:s,format:o,depthBuffer:c,depthTexture:at},et>1?g.kFz:g.dd2);return this._processNewTarget(ct,h,st),this._setTargetOptions(ct,nt),ct}_processNewTarget(h,e,i){return e!==void 0&&(h.sizeMultiplier=e),i&&this.trackTarget(h),h}disposeTarget(h){if(h){if(h.isTemporary)return this.releaseTempTarget(h);this.removeTrackedTarget(h),h.dispose()}}createTargetCustom({width:h,height:e,count:i},s={},o){const c=this._processNewTarget,_=this.renderTargetToDataUrl.bind(this);this.renderTargetToBuffer.bind(this);let j=[h,e];if(i&&i>1&&j.push(i),(o==null?void 0:o.prototype)===g.oAp.prototype){if(h!==e)throw"Width and height of cube render target must be equal";j=[h]}s={format:g.wk1,minFilter:g.wem,magFilter:g.wem,generateMipmaps:!1,type:g.ywz,colorSpace:g.aCh,...s};const et=[this,...j,s];return new class extends(o??g.dd2){constructor(nt,...st){super(...st),this.renderer=nt,this.assetType="renderTarget",this.name="RenderTarget",Array.isArray(this.texture)?this.texture.forEach(at=>{at.colorSpace=s.colorSpace,at.toJSON=()=>(console.warn("Multiple render target texture.toJSON not supported yet."),{})}):(this.texture.__toJSON=this.texture.toJSON,this.texture.__target=this,this.texture.toJSON=function(at){console.warn("Render target texture.toJSON might be buggy."),this.source.data.url=_(this.__target,"image/png",90);const ct=this.__toJSON.call(this,at);return delete this.source.data.url,ct.isRenderTargetTexture=!0,ct})}setSize(nt,st,at){super.setSize(Math.floor(nt),Math.floor(st),at)}clone(nt=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const st=super.clone();return st.texture.isRenderTargetTexture=!0,c(st,this.sizeMultiplier||1,nt)}}(...et)}getTempTarget(h={}){var s;const e=Ku(h);let i;return(s=this._tempTargets[e])!=null&&s.length&&(i=this._tempTargets[e].pop()),i?this._setTargetOptions(i,h):(i=this.createTarget(h),this._processNewTempTarget(i,e)),i}_processNewTempTarget(h,e){return h.isTemporary=!0,h.targetKey=e,this._tempTargets[e]===void 0&&(this._tempTargets[e]=[]),h}releaseTempTarget(h){const e=h.targetKey;if(!e||!h.isTemporary)throw"Not a temp target";this._tempTargets[e].length>this.maxTempPerKey?h.dispose():this._tempTargets[e].push(h)}updateShaderProperties(h){return this.stableNoise?h.uniforms.frameCount?h.uniforms.frameCount.value=this._totalFrameCount:console.warn("BaseRenderer: no uniform: frameCount"):h.uniforms.frameCount?h.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),h.uniforms.frameCount2&&(h.uniforms.frameCount2.value=this.frameCount),this}_setTargetOptions(h,e){h.texture.minFilter=e.minFilter??g.wem,h.texture.magFilter=e.magFilter??g.wem,h.texture.generateMipmaps=e.generateMipmaps??!1,h.texture.generateMipmaps&&h.texture.minFilter===g.wem&&(h.texture.minFilter=g.FDw),h.texture.generateMipmaps||h.texture.minFilter!==g.FDw||(h.texture.minFilter=g.wem)}renderTargetToDataUrl(h,e="image/png",i=90){const s=document.createElement("canvas");s.width=h.width,s.height=h.height;const o=s.getContext("2d");if(!o)throw new Error("Unable to get 2d context");const c=o.createImageData(h.width,h.height,{colorSpace:["display-p3","srgb"].includes(h.texture.colorSpace)?h.texture.colorSpace:void 0});if(h.texture.type===g.cLu){const j=new Uint16Array(h.width*h.height*4);this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,j),Ds({data:j,width:h.width,height:h.height},h.texture.colorSpace,c)}else if(h.texture.type===g.VzW){const j=new Float32Array(h.width*h.height*4);this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,j),Ds({data:j,width:h.width,height:h.height},h.texture.colorSpace,c)}else this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,c.data);o.putImageData(c,0,0);const _=s.toDataURL(e,i);return s.remove(),_}renderTargetToBuffer(h){const e=h.texture.type===g.cLu?new Uint16Array(h.width*h.height*4):new Uint8Array(h.width*h.height*4);return this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,e),e}get useLegacyLights(){return this.rendererObject.useLegacyLights}set useLegacyLights(h){this.rendererObject.useLegacyLights=h,this._updated(),this.resetShadows()}get useTotalFrameCount(){return console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise}set useTotalFrameCount(h){console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise=h}get renderScale(){return this.displayCanvasScaling}set renderScale(h){this.displayCanvasScaling=h}};function Ku(h={}){var e,i;return[h.sizeMultiplier,h.samples,h.colorSpace,h.type,h.format,h.depthBuffer,h.depthTexture,(e=h.size)==null?void 0:e.width,(i=h.size)==null?void 0:i.height].join(";")}function op(h){var c,_,j,et,nt,st,at,ct,dt;if(!h.isMaterial&&!h.isBufferGeometry)return;const e=Array.from(h.userData.__appliedMeshes).filter(mt=>!mt.isInstancedMesh&&!!mt.parent&&mt.children.length===0&&!Array.isArray(mt.material));if(e.length<2)return;const i=new Map;for(const mt of e){const yt=(s=mt).parent.uuid+"_"+s.geometry.uuid+"_"+((c=s.material)==null?void 0:c.uuid);i.has(yt)||i.set(yt,[]),i.get(yt).push(mt),mt.updateMatrix()}var s;const o=i.keys();for(const mt of o){const yt=i.get(mt),wt=yt[0];if(!wt||yt.length<2)continue;const Ct=new g.SPe(wt.geometry,wt.material,yt.length),bt=wt.userData;wt.userData={},Ct.copy(wt),_l(Ct.userData,bt);const At=wt.parent;Ct.position.set(0,0,0),Ct.rotation.set(0,0,0),Ct.scale.set(1,1,1),Ct.updateMatrix();const Pt=new Float32Array(3*Ct.count),Dt=new Float32Array(4*Ct.count),Nt=new Float32Array(3*Ct.count);for(let Vt=0;Vt<yt.length;Vt++){const Zt=yt[Vt],an=Zt.matrix;an.determinant()<0&&(an.elements[0]*=-1,an.elements[1]*=-1,an.elements[2]*=-1),Ct.setMatrixAt(Vt,an),Zt.position.toArray(Pt,3*Vt),Zt.quaternion.toArray(Dt,4*Vt),Zt.scale.toArray(Nt,3*Vt),Zt.removeFromParent(),(et=(j=(_=Zt.material)==null?void 0:_.userData)==null?void 0:j.__appliedMeshes)==null||et.delete(Zt),(at=(st=(nt=Zt.geometry)==null?void 0:nt.userData)==null?void 0:st.__appliedMeshes)==null||at.delete(Zt)}(dt=(ct=Ct.material.userData)==null?void 0:ct.__appliedMeshes)==null||dt.add(Ct),Ct.geometry.userData.__appliedMeshes.add(Ct),Ct.sourceTrs={TRANSLATION:new g.TlE(Pt,3),ROTATION:new g.TlE(Dt,4),SCALE:new g.TlE(Nt,3)},Ct.instanceMatrix.needsUpdate=!0,At.add(Ct),At.setDirty()}}$u([En()],Ko.prototype,"stableNoise",void 0),$u([En()],Ko.prototype,"useLegacyLights",null),Ko=$u([Yo("RenderManager")],Ko);class Ju{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,i){if(!e.isInstancedMesh)return;const s=this.writer,o=e;let c=o.sourceTrs;if(!c){const _=new Float32Array(3*o.count),j=new Float32Array(4*o.count),et=new Float32Array(3*o.count),nt=new g.yGw,st=new g.Pa4,at=new g._fP,ct=new g.Pa4;for(let dt=0;dt<o.count;dt++)o.getMatrixAt(dt,nt),nt.decompose(st,at,ct),st.toArray(_,3*dt),at.toArray(j,4*dt),ct.toArray(et,3*dt);c={TRANSLATION:new g.TlE(_,3),ROTATION:new g.TlE(j,4),SCALE:new g.TlE(et,3)}}c={TRANSLATION:s.processAccessor(c.TRANSLATION),ROTATION:s.processAccessor(c.ROTATION),SCALE:s.processAccessor(c.SCALE)},o.instanceColor&&(c.COLOR=s.processAccessor(new g.TlE(o.instanceColor.array,3))),s.extensionsUsed[this.name]=!0,s.extensionsRequired[this.name]=!0,i.extensions=i.extensions||{},i.extensions[this.name]={attributes:c}}}function mu(h,e){if(h.uiConfig)return h.uiConfig;const i={type:"folder",label:()=>h.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[h,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{h.dispatchEvent({type:"select",ui:!0,value:h,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!h.parent,value:()=>{const c=h.parent;c&&c.dispatchEvent({type:"select",ui:!0,value:c})}},{type:"input",label:"Name",property:[h,"name"],onChange:c=>{var _;c.last&&((_=h.setDirty)==null||_.call(h,{sceneUpdate:!0,refreshUi:!0}))}},{type:"checkbox",label:"Casts Shadow",hidden:()=>!h.isMesh,property:[h,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!h.isMesh,property:[h,"receiveShadow"]},{type:"checkbox",label:"Frustum culled",property:[h,"frustumCulled"]},{type:"vec3",label:"Position",property:[h,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[h,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[h,"scale"]},{type:"input",label:"Render Order",property:[h,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",h.userData.autoScaleRadius||"2",!0],value:c=>{if(!c)return;const _=parseFloat(c);Math.abs(_)>0&&Ks(h,_)}},{type:"button",label:"Auto Center",value:()=>{confirm("Auto Center: Object will be centered, are you sure you want to proceed?")&&oo(h)}},{type:"folder",label:"Rotate model",children:["X +","X -","Y +","Y -","Z +","Z -"].map(c=>({type:"button",label:"Rotate "+c+"90",value:()=>{var _;h.rotateOnAxis(new g.Pa4(c.includes("X")?1:0,c.includes("Y")?1:0,c.includes("Z")?1:0),Math.PI/2*(c.includes("-")?-1:1)),(_=h.setDirty)==null||_.call(h,{sceneUpdate:!0,refreshUi:!1})}}))},h.userData.license!==void 0?{type:"input",label:"License/Credits",property:[h.userData,"license"],limitedUi:!0}:{}]},s=h;if(s!=null&&s.isMesh&&e!==!1){const c=[()=>{const _=Object.entries(s.morphTargetDictionary||{});return _.length?{label:"Morph Targets",type:"folder",children:_.map(([j,et])=>({type:"slider",label:j,bounds:[0,1],stepSize:1e-4,property:[s.morphTargetInfluences,et],onChange:nt=>{var st;(st=h.setDirty)==null||st.call(h,{sceneUpdate:nt.last,frameFade:!1,refreshUi:!1})}}))}:void 0},()=>{var _;return(_=s.geometry)==null?void 0:_.uiConfig},()=>{var _;return Array.isArray(s.material)?s.material.length<1?void 0:{label:"Materials",type:"folder",children:s.material.map(j=>j==null?void 0:j.uiConfig).filter(j=>j)}:(_=s.material)==null?void 0:_.uiConfig}];i.children.push(...c)}const o=h;if(o!=null&&o.isCamera){const c=[{type:"button",label:"Set View",value:()=>{var _;h.dispatchEvent({type:"setView",ui:!0,camera:h}),(_=i.uiRefresh)==null||_.call(i,"postFrame",!0)}},{type:"button",label:"Activate main",hidden:()=>{var _;return(_=h.userData.iCamera)==null?void 0:_.isActiveCamera},value:()=>{var _;h.dispatchEvent({type:"activateMain",ui:!0,camera:h}),(_=i.uiRefresh)==null||_.call(i,"postFrame",!0)}},{type:"button",label:"Deactivate main",hidden:()=>{var _;return!((_=h.userData.iCamera)!=null&&_.isActiveCamera)},value:()=>{var _;h.dispatchEvent({type:"activateMain",ui:!0,camera:void 0}),(_=i.uiRefresh)==null||_.call(i,"postFrame",!0)}},{type:"checkbox",label:"Auto LookAt Target",getValue:()=>h.userData.autoLookAtTarget??!1,setValue:_=>{var j;h.userData.autoLookAtTarget=_,(j=i.uiRefresh)==null||j.call(i,"postFrame",!0)}}];i.children.push(...c)}return h.uiConfig=i,i}function Nl(h,e,i){if(!h)return void console.warn("setupIModel: object is undefined");if(h.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",h),delete h.__disposed),h.userData||(h.userData={}),h.userData.__iModelSetup&&h.modelObject)return h;h.userData.__iModelSetup=!0;let s=[];s.push(()=>{[...h.children].forEach(st=>{var at;(at=st==null?void 0:st.dispose)==null||at.call(st),h.add(st)}),h.parent&&h.removeFromParent()}),h.isLight&&!h.assetType?(h.assetType="light",h.lightObject=h):h.isCamera?(h.assetType="camera",h.cameraObject=h):h.assetType||(h.assetType="model"),h.modelObject||(h.modelObject=h),h.setDirty||(h.setDirty=(st={})=>{h.dispatchEvent({...st,type:"objectUpdate",object:h})},h.userData.setDirty&&console.warn("userData.setDirty already defined",h.userData.setDirty,h),h.userData.setDirty=st=>{var at;console.warn("userData.setDirty is deprecated, use setDirty directly"),(at=h.setDirty)==null||at.call(h,st)}),h.addEventListener("added",st=>{var ct,dt;const at=((ct=h.parent)==null?void 0:ct.userData.parentRoot)??h.parent;at!==h.userData.parentRoot&&h.traverse(mt=>{mt.userData.parentRoot=at}),(dt=h.setDirty)==null||dt.call(h,{change:"addedToParent"})}),h.addEventListener("removed",()=>{var st;(st=h.setDirty)==null||st.call(h,{change:"removedFromParent"}),h.userData.parentRoot!==void 0&&h.traverse(at=>{at.userData.parentRoot=void 0})}),s.push(()=>{});const o=h.dispose;h.dispose=()=>{h.dispatchEvent({type:"dispose"}),o==null||o.call(h)},h.userData.dispose&&console.warn("userData.dispose already defined"),h.userData.dispose=()=>{var st;console.warn("userData.dispose is deprecated, use dispose directly"),(st=h.dispose)==null||st.call(h)};const c=h;!c.isMesh&&!c.isLine||c.userData.__meshSetup||(c.userData.__meshSetup=!0,c.setMaterial||(c.setMaterial=st=>Km(c,st)),c.setGeometry||(c.setGeometry=(st,at=!1)=>r0(c,st,at),c.setGeometry(c.geometry,!0)),h.userData.setMaterial&&console.warn("userData.setMaterial already defined"),h.userData.setMaterial=st=>{var at;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),(at=h.setMaterial)==null||at.call(h,st)},h.userData.setGeometry&&console.warn("userData.setGeometry already defined"),h.userData.setGeometry=(st,...at)=>{var ct;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),(ct=h.setGeometry)==null||ct.call(h,st,...at)},h.userData.__keepShadowDef||(h.castShadow=!0,h.receiveShadow=!0,h.userData.__keepShadowDef=!0),s.push(()=>{var ct,dt,mt,yt,wt,Ct;const st=((ct=c.setMaterial)==null?void 0:ct.call(c,void 0))||[],at=(dt=c.setGeometry)==null?void 0:dt.call(c,void 0);for(const bt of st)bt&&bt.userData&&((mt=bt.userData.__appliedMeshes)==null?void 0:mt.size)===0&&bt.userData.disposeOnIdle!==!1&&bt.dispose();at&&at.userData&&((yt=at.userData.__appliedMeshes)==null?void 0:yt.size)===0&&at.userData.disposeOnIdle!==!1&&at.dispose(),(wt=c.setMaterial)==null||wt.call(c,st),(Ct=c.setGeometry)==null||Ct.call(c,at)})),h.uiConfig||h.assetType!=="model"&&h.assetType!=="camera"||(mu(h),s.push(()=>{})),h.addEventListener("objectUpdate",({refreshUi:st})=>{var at,ct;return st!==!1&&((ct=(at=h.uiConfig)==null?void 0:at.uiRefresh)==null?void 0:ct.call(at,"postFrame",!0,1))}),h.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(h.userData.__autoParentDispatchEvents=h.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select","materialChanged","textureUpdate"],h.isCamera&&h.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(h.userData.parentRoot=e);const _=h.dispatchEvent;h.dispatchEvent=st=>{var at;(at=h.userData.__autoParentDispatchEvents)!=null&&at.includes(st.type)&&(st.parentDispatch=!0),st.parentDispatch&&(ct=>{const dt=h.userData.parentRoot??h.parent;dt!=null&&dt.modelObject&&dt.dispatchEvent(ct)})(st),_.call(h,st)};const j=h.clone;h.clone=(...st)=>{const at=h.userData;h.userData={};let ct=j.call(h,...st);h.userData=at,_l(ct.userData,at);const dt=h.userData.parentRoot;return dt&&dt.assetType!=="model"&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),ct=Nl(ct,dt,i),ct.userData.cloneParent=h.uuid,ct};const et=h.copy;h.copy=(st,...at)=>{const ct=st.userData;st.userData={};const dt=et.call(h,st,...at);return st.userData=ct,_l(h.userData,st),dt};const nt=h.add;return h.add=(...st)=>(st.forEach(at=>Nl(at,h.userData.parentRoot||h,i)),nt.call(h,...st)),(h=(i==null?void 0:i(h))??h).addEventListener("dispose",()=>{s.forEach(st=>st()),s=[]}),[...h.children].forEach(st=>Nl(st,h,i)),h}function Km(h,e){var c,_,j,et;const i=(Array.isArray(e)?e:[e]).map(nt=>nt==null?void 0:nt.materialObject).filter(nt=>nt);if(h.material==i||i.length===1&&h.material===i[0])return[];h.userData.__materialUpdater||(h.userData.__materialUpdater=()=>{h.dispatchEvent({type:"materialUpdate"})}),h.userData.__textureUpdater||(h.userData.__textureUpdater=()=>{h.dispatchEvent({type:"textureUpdate"})});const s=Array.isArray(h.material)?[...h.material]:[h.material];for(const nt of s)nt&&(nt.removeEventListener("materialUpdate",h.userData.__materialUpdater),nt.removeEventListener("textureUpdate",h.userData.__textureUpdater),(_=(c=nt.userData)==null?void 0:c.__appliedMeshes)==null||_.delete(h));const o=[];for(const nt of i)nt.userData.__appliedMeshes||(nt.userData.__appliedMeshes=new Set),o.push(nt),nt&&(nt.addEventListener("materialUpdate",h.userData.__materialUpdater),nt.addEventListener("textureUpdate",h.userData.__textureUpdater),nt.userData.__appliedMeshes.add(h));return h.material=o.length!==1?o:o[0]??void 0,h.dispatchEvent({type:"materialChanged",material:e,mesh:h}),(et=(j=h.uiConfig)==null?void 0:j.uiRefresh)==null||et.call(j,"postFrame",!0),s}function r0(h,e,i=!1){var c,_,j,et,nt,st;h.userData.__objectUpdater||(h.userData.__objectUpdater=at=>{h.dispatchEvent({...at,type:"objectUpdate"})});let s=h.geometry;const o=s;return(s!==e||i)&&(s&&(s.removeEventListener("geometryUpdate",h.userData.__objectUpdater),(_=(c=s.userData)==null?void 0:c.__appliedMeshes)==null||_.delete(h)),s=e,s&&!s.userData.__appliedMeshes&&(s.userData.__appliedMeshes=new Set),h.geometry=s??void 0,s&&(h.updateMorphTargets(),s.addEventListener("geometryUpdate",h.userData.__objectUpdater),(et=(j=s.userData)==null?void 0:j.__appliedMeshes)==null||et.add(h))),e&&!e.uiConfig&&(e.uiConfig=function(at){return{label:"Geometry",type:"folder",children:[{type:"input",property:[at,"uuid"],disabled:!0},{type:"input",property:[at,"name"]},{type:"button",label:"Center Geometry",value:()=>{at.center()}},{type:"button",label:"Center Geometry (keep position)",value:()=>{const ct=new g.Pa4;at.center(ct),at.userData.__appliedMeshes.forEach(dt=>{dt.position.sub(ct),dt.setDirty&&dt.setDirty()})}},{type:"button",label:"Compute vertex normals",value:()=>{at.computeVertexNormals()}},{type:"button",label:"Compute vertex tangents",value:()=>{at.computeTangents()}},{type:"button",label:"Normalize normals",value:()=>{at.normalizeNormals()}},{type:"button",label:"Convert to indexed",hidden:()=>!!at.index,value:()=>{if(at.attributes.index)return;const ct=parseFloat(prompt("Tolerance","-1")??"-1");Xo(at,ct)}},{type:"button",label:"Convert to non-indexed",hidden:()=>!at.index,value:()=>{at.attributes.index&&at.toNonIndexed()}},{type:"button",label:"Create uv1 from uv",value:()=>{at.hasAttribute("uv1")&&!confirm("uv1 already exists, replace with uv data?")||at.setAttribute("uv1",at.getAttribute("uv"))}},{type:"button",label:"Remove vertex color attribute",hidden:()=>!at.hasAttribute("color"),value:()=>{at.hasAttribute("color")?confirm("Remove color attribute?")&&at.deleteAttribute("color"):prompt("No color attribute found")}},{type:"button",label:"Auto GPU Instances",hidden:()=>!at.userData.__appliedMeshes||at.userData.__appliedMeshes.size<2,value:()=>{op(at)}},{type:"input",label:"Mesh count",get value(){var ct,dt;return((dt=(ct=at.userData)==null?void 0:ct.__appliedMeshes)==null?void 0:dt.size)??0},set value(ct){},disabled:!0}]}}(h.geometry)),h.dispatchEvent({type:"geometryChanged",geometry:e}),(st=(nt=h.uiConfig)==null?void 0:nt.uiRefresh)==null||st.call(nt,"postFrame",!0),o===s?void 0:o||void 0}const Zl=["appliedMeshes"],na=["parentRoot","iCamera","iModel"];function _l(h,e){if(e)for(const i of Object.keys(e))na.includes(i)||i.startsWith("__")||typeof h[i]!="function"&&typeof e[i]!="function"&&(h[i]=e[i]);return h}var Im,k0=new Uint8Array(16);function Jm(){if(!Im&&!(Im=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Im(k0)}for(var Op=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,_c=[],fm=0;fm<256;++fm)_c.push((fm+256).toString(16).substr(1));var H_=function(h){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=(_c[h[e+0]]+_c[h[e+1]]+_c[h[e+2]]+_c[h[e+3]]+"-"+_c[h[e+4]]+_c[h[e+5]]+"-"+_c[h[e+6]]+_c[h[e+7]]+"-"+_c[h[e+8]]+_c[h[e+9]]+"-"+_c[h[e+10]]+_c[h[e+11]]+_c[h[e+12]]+_c[h[e+13]]+_c[h[e+14]]+_c[h[e+15]]).toLowerCase();if(!function(s){return typeof s=="string"&&Op.test(s)}(i))throw TypeError("Stringified UUID is invalid");return i},Bp=function(h,e,i){var s=(h=h||{}).random||(h.rng||Jm)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(var o=0;o<16;++o)e[i+o]=s[o];return e}return H_(s)};const O0=new Map;function Jp(h,e){return(i,s)=>{const o=i.constructor;if(o===Object)throw new Error("All properties in an object are serialized by default");O0.has(o)||O0.set(o,[]);const c=O0.get(o);if(!(c.findIndex(_=>_.propKey===s)<0))throw new Error(`Property ${s} already has a uiConfig decorator`);c.push({params:e||{},propKey:s,uiType:h})}}function jr(h,e){return Jp("checkbox",{label:h,params:e})}function y_(h,e){return Jp("monitor",{label:h,params:e})}function ns(h,e,i,s){return Jp("slider",{label:h,bounds:e,stepSize:i,params:s})}function Lp(h,e,i,s){return Jp("vec",{label:h,bounds:e,stepSize:i,params:s})}function Pm(h,e,i){return Jp("dropdown",{label:h,children:e,params:i})}function Oo(h,e){return Jp("button",{label:h,params:e})}function $s(h,e){return Jp("input",{label:h,params:e})}function Tv(h,e){return Jp("color",{label:h,params:e})}function By(h,e){return Jp("image",{label:h,params:e})}function Q_(h){let e=h==null?void 0:h.constructor;if(!h||!e)return[];const i=[],s=[];for(;e&&e!==Object;)s.push(e),e=Object.getPrototypeOf(e);if(!s.length){const o=typeof h=="object"?Object.keys(h):Array.isArray(h)?h.map((c,_)=>_):[];for(const c of o){const _=h[c];if(_==null)continue;const j=_==null?void 0:_.uiConfig;if(j)i.push(j);else{const et=B0(_);et==="folder"?i.push(Rm(c+"",_)):et&&i.push({type:et,label:c+"",property:[h,c]})}}}return s.reverse().forEach(o=>{var c;(c=O0.get(o))==null||c.forEach(({params:_,propKey:j,uiType:et})=>{let nt;if(!et){const st=h[j];nt=st==null?void 0:st.uiConfig,nt?i.push(nt):st!=null&&((et=B0(st))==="folder"?nt=Rm(j+"",st):et&&(nt={type:et,label:j+"",property:[h,j]}))}if(nt||(nt={property:[h,j],type:et||"input"}),_){const st=typeof _.params=="function"?_.params(h):_.params||{};delete _.params,Object.assign(nt,{..._,...st})}i.push(nt)})}),i}function Rm(h,e,i={},s="folder"){return{type:s,label:h,children:Q_(e),uuid:Bp(),...i}}function ks(h,e,i="folder"){return s=>class extends s{constructor(){super(...arguments),this.uiConfig=Rm(h,this,e||{},i)}}}function W_(h,e){return ks(h,e,"panel")}function B0(h){return h==null?null:Array.isArray(h)?"folder":typeof h=="boolean"?"checkbox":typeof h=="number"?"number":typeof h=="string"?"input":typeof h=="function"?"button":typeof h.x=="number"?"vec":typeof h.r=="number"?"color":h.isTexture?"image":typeof h=="object"?"folder":null}const i0={type:"change"},Mv={type:"start"},Ly={type:"end"};class fx extends g.pBf{constructor(e,i){super(),this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new g.Pa4,this.minDistance=1e-5,this.maxDistance=1/0,this.autoPushTarget=!0,this.autoPullTarget=!0,this.clampMax=new g.Pa4(1/0,1/0,1/0),this.clampMin=new g.Pa4(-1/0,-1/0,-1/0),this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.throttleUpdate=0,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:g.RsA.ROTATE,MIDDLE:g.RsA.DOLLY,RIGHT:g.RsA.PAN},this.touches={ONE:g.QmN.ROTATE,TWO:g.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return j.phi},this.getAzimuthalAngle=function(){return j.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(gr){gr.addEventListener("keydown",ds),this._domElementKeyEvents=gr},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",ds),this._domElementKeyEvents=null},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(i0),s.update(),c=o.NONE},this.update=function(){const gr=new g.Pa4,kr=new g._fP().setFromUnitVectors(e.up,new g.Pa4(0,1,0)),$r=kr.clone().invert(),co=new g.Pa4,Do=new g._fP,_o=2*Math.PI;return function(){if(this.throttleUpdate&&this.throttleUpdate>=1&&Date.now()-0<1e3/this.throttleUpdate)return;const io=s.object.position;gr.copy(io).sub(s.target),gr.applyQuaternion(kr),j.setFromVector3(gr),s.autoRotate&&c===o.NONE&&Zt(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(j.theta+=et.theta*s.dampingFactor,j.phi+=et.phi*s.dampingFactor):(j.theta+=et.theta,j.phi+=et.phi);let so=s.minAzimuthAngle,ws=s.maxAzimuthAngle;isFinite(so)&&isFinite(ws)&&(so<-Math.PI?so+=_o:so>Math.PI&&(so-=_o),ws<-Math.PI?ws+=_o:ws>Math.PI&&(ws-=_o),j.theta=so<=ws?Math.max(so,Math.min(ws,j.theta)):j.theta>(so+ws)/2?Math.max(so,j.theta):Math.min(ws,j.theta)),j.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,j.phi)),j.makeSafe(),Math.abs(et.radius)>0&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*(1+et.radius*(s.enableDamping?s.dampingFactor:1)))),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&(et.radius=0)),j.radius*=1+et.radius*(s.enableDamping?s.dampingFactor:1)),Math.abs(nt-1)>1e-5&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*nt)),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&(nt=1)),j.radius*=nt);let dr=0;s.autoPushTarget&&j.radius<s.minDistance&&(dr=s.minDistance-j.radius),s.autoPullTarget&&j.radius>s.maxDistance&&(dr=s.maxDistance-j.radius),j.radius=Math.max(s.minDistance,Math.min(s.maxDistance,j.radius)),s.enableDamping===!0?s.target.addScaledVector(st,s.dampingFactor):s.target.add(st),gr.setFromSpherical(j),gr.applyQuaternion($r),io.copy(s.target).add(gr),s.target.add(gr.normalize().multiplyScalar(-dr)),io.clamp(s.clampMin,s.clampMax),s.target.clamp(s.clampMin,s.clampMax),s.object.lookAt(s.target);let Yr=!1;return s.enableDamping===!0&&Math.abs(et.theta)+Math.abs(et.phi)+Math.abs(et.radius)+st.length()>.001?(et.theta*=1-s.dampingFactor,et.phi*=1-s.dampingFactor,et.radius*=1-s.dampingFactor,st.multiplyScalar(1-s.dampingFactor),Yr=!0):(et.set(0,0,0),st.set(0,0,0)),nt=1,!!(at||Yr||co.distanceToSquared(s.object.position)>_||8*(1-Do.dot(s.object.quaternion))>_)&&(s.dispatchEvent(i0),co.copy(s.object.position),Do.copy(s.object.quaternion),at=!1,!0)}}(),this.stopDamping=function(){et.set(0,0,0),st.set(0,0,0)},this.dispose=function(){s.domElement.removeEventListener("contextmenu",Hs),s.domElement.removeEventListener("pointerdown",Mr),s.domElement.removeEventListener("pointercancel",qr),s.domElement.removeEventListener("wheel",Zr),s.domElement.removeEventListener("pointermove",xr),s.domElement.removeEventListener("pointerup",qr),s._domElementKeyEvents!==null&&(s._domElementKeyEvents.removeEventListener("keydown",ds),s._domElementKeyEvents=null)};const s=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=o.NONE;const _=1e-6,j=new g.$V,et=new g.$V(0,0,0);let nt=1;const st=new g.Pa4;let at=!1;const ct=new g.FM8,dt=new g.FM8,mt=new g.FM8,yt=new g.FM8,wt=new g.FM8,Ct=new g.FM8,bt=new g.FM8,At=new g.FM8,Pt=new g.FM8,Dt=[],Nt={};function Vt(){return s.enableDamping?1:Math.pow(.95,s.zoomSpeed)}function Zt(gr){et.theta-=gr}function an(gr){et.phi-=gr}this.rotateUp=an,this.rotateLeft=Zt;const fn=function(){const gr=new g.Pa4;return function(kr,$r){gr.setFromMatrixColumn($r,0),gr.multiplyScalar(-kr),st.add(gr)}}(),mn=function(){const gr=new g.Pa4;return function(kr,$r){s.screenSpacePanning===!0?gr.setFromMatrixColumn($r,1):(gr.setFromMatrixColumn($r,0),gr.crossVectors(s.object.up,gr)),gr.multiplyScalar(kr),st.add(gr)}}(),Sn=function(){const gr=new g.Pa4;return function(kr,$r){const co=s.domElement;if(s.object.isPerspectiveCamera){const Do=s.object.position;gr.copy(Do).sub(s.target);let _o=gr.length();_o*=Math.tan(s.object.fov/2*Math.PI/180),fn(2*kr*_o/co.clientHeight,s.object.matrix),mn(2*$r*_o/co.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(fn(kr*(s.object.right-s.object.left)/s.object.zoom/co.clientWidth,s.object.matrix),mn($r*(s.object.top-s.object.bottom)/s.object.zoom/co.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function An(gr,kr=0){s.object.isPerspectiveCamera?(nt/=gr,et.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,et.radius-kr))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*gr)),s.object.updateProjectionMatrix(),at=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function wn(gr,kr=0){s.object.isPerspectiveCamera?(nt*=gr,et.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,et.radius+kr))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/gr)),s.object.updateProjectionMatrix(),at=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function Mn(gr){ct.set(gr.clientX,gr.clientY)}function Pn(gr){yt.set(gr.clientX,gr.clientY)}function On(){if(Dt.length===1)ct.set(Dt[0].pageX,Dt[0].pageY);else{const gr=.5*(Dt[0].pageX+Dt[1].pageX),kr=.5*(Dt[0].pageY+Dt[1].pageY);ct.set(gr,kr)}}function er(){if(Dt.length===1)yt.set(Dt[0].pageX,Dt[0].pageY);else{const gr=.5*(Dt[0].pageX+Dt[1].pageX),kr=.5*(Dt[0].pageY+Dt[1].pageY);yt.set(gr,kr)}}function Zn(){const gr=Dt[0].pageX-Dt[1].pageX,kr=Dt[0].pageY-Dt[1].pageY,$r=Math.sqrt(gr*gr+kr*kr);bt.set(0,$r)}function yr(gr){if(Dt.length==1)dt.set(gr.pageX,gr.pageY);else{const $r=Os(gr),co=.5*(gr.pageX+$r.x),Do=.5*(gr.pageY+$r.y);dt.set(co,Do)}mt.subVectors(dt,ct).multiplyScalar(s.rotateSpeed);const kr=s.domElement;Zt(2*Math.PI*mt.x/kr.clientHeight),an(2*Math.PI*mt.y/kr.clientHeight),ct.copy(dt)}function lr(gr){if(Dt.length===1)wt.set(gr.pageX,gr.pageY);else{const kr=Os(gr),$r=.5*(gr.pageX+kr.x),co=.5*(gr.pageY+kr.y);wt.set($r,co)}Ct.subVectors(wt,yt).multiplyScalar(s.panSpeed),Sn(Ct.x,Ct.y),yt.copy(wt)}function ar(gr){const kr=Os(gr),$r=gr.pageX-kr.x,co=gr.pageY-kr.y,Do=Math.sqrt($r*$r+co*co);At.set(0,Do),Pt.set(0,Math.pow(At.y/bt.y,6*s.zoomSpeed)),An(Pt.y),bt.copy(At)}function Mr(gr){s.enabled!==!1&&(Dt.length===0&&(s.domElement.setPointerCapture(gr.pointerId),s.domElement.addEventListener("pointermove",xr),s.domElement.addEventListener("pointerup",qr)),function(kr){Dt.push(kr)}(gr),gr.pointerType==="touch"?function(kr){switch(Ps(kr),Dt.length){case 1:switch(s.touches.ONE){case g.QmN.ROTATE:if(s.enableRotate===!1)return;On(),c=o.TOUCH_ROTATE;break;case g.QmN.PAN:if(s.enablePan===!1)return;er(),c=o.TOUCH_PAN;break;default:c=o.NONE}break;case 2:switch(s.touches.TWO){case g.QmN.DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;s.enableZoom&&Zn(),s.enablePan&&er(),c=o.TOUCH_DOLLY_PAN;break;case g.QmN.DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;s.enableZoom&&Zn(),s.enableRotate&&On(),c=o.TOUCH_DOLLY_ROTATE;break;default:c=o.NONE}break;default:c=o.NONE}c!==o.NONE&&s.dispatchEvent(Mv)}(gr):function(kr){let $r;switch(kr.button){case 0:$r=s.mouseButtons.LEFT;break;case 1:$r=s.mouseButtons.MIDDLE;break;case 2:$r=s.mouseButtons.RIGHT;break;default:$r=-1}switch($r){case g.RsA.DOLLY:if(s.enableZoom===!1)return;(function(co){bt.set(co.clientX,co.clientY)})(kr),c=o.DOLLY;break;case g.RsA.ROTATE:if(kr.ctrlKey||kr.metaKey||kr.shiftKey){if(s.enablePan===!1)return;Pn(kr),c=o.PAN}else{if(s.enableRotate===!1)return;Mn(kr),c=o.ROTATE}break;case g.RsA.PAN:if(kr.ctrlKey||kr.metaKey||kr.shiftKey){if(s.enableRotate===!1)return;Mn(kr),c=o.ROTATE}else{if(s.enablePan===!1)return;Pn(kr),c=o.PAN}break;default:c=o.NONE}c!==o.NONE&&s.dispatchEvent(Mv)}(gr))}function xr(gr){s.enabled!==!1&&(gr.pointerType==="touch"?function(kr){switch(Ps(kr),c){case o.TOUCH_ROTATE:if(s.enableRotate===!1)return;yr(kr),s.update();break;case o.TOUCH_PAN:if(s.enablePan===!1)return;lr(kr),s.update();break;case o.TOUCH_DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;(function($r){s.enableZoom&&ar($r),s.enablePan&&lr($r)})(kr),s.update();break;case o.TOUCH_DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;(function($r){s.enableZoom&&ar($r),s.enableRotate&&yr($r)})(kr),s.update();break;default:c=o.NONE}}(gr):function(kr){switch(c){case o.ROTATE:if(s.enableRotate===!1)return;(function($r){dt.set($r.clientX,$r.clientY),mt.subVectors(dt,ct).multiplyScalar(s.rotateSpeed);const co=s.domElement;Zt(2*Math.PI*mt.x/co.clientHeight),an(2*Math.PI*mt.y/co.clientHeight),ct.copy(dt),s.update()})(kr);break;case o.DOLLY:if(s.enableZoom===!1)return;(function($r){At.set($r.clientX,$r.clientY),Pt.subVectors(At,bt),Pt.y>0?An(Vt()):Pt.y<0&&wn(Vt()),bt.copy(At),s.update()})(kr);break;case o.PAN:if(s.enablePan===!1)return;(function($r){wt.set($r.clientX,$r.clientY),Ct.subVectors(wt,yt).multiplyScalar(s.panSpeed),Sn(Ct.x,Ct.y),yt.copy(wt),s.update()})(kr)}}(gr))}function qr(gr){(function(kr){delete Nt[kr.pointerId];for(let $r=0;$r<Dt.length;$r++)if(Dt[$r].pointerId==kr.pointerId)return void Dt.splice($r,1)})(gr),Dt.length===0&&(s.domElement.releasePointerCapture(gr.pointerId),s.domElement.removeEventListener("pointermove",xr),s.domElement.removeEventListener("pointerup",qr)),s.dispatchEvent(Ly),c=o.NONE}function Zr(gr){s.enabled!==!1&&s.enableZoom!==!1&&c===o.NONE&&(gr.preventDefault(),s.dispatchEvent(Mv),function(kr){let $r=0;switch(kr.deltaMode){case 2:$r+=1*kr.deltaY;break;case 1:$r+=.4*kr.deltaY;break;default:$r+=.01*kr.deltaY}kr.deltaY<0?wn(1,$r*s.zoomSpeed):kr.deltaY>0&&An(1,-$r*s.zoomSpeed),s.update()}(gr),s.dispatchEvent(Ly))}function ds(gr){s.enabled!==!1&&s.enablePan!==!1&&function(kr){let $r=!1;switch(kr.code){case s.keys.UP:kr.ctrlKey||kr.metaKey||kr.shiftKey?an(2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):Sn(0,s.keyPanSpeed),$r=!0;break;case s.keys.BOTTOM:kr.ctrlKey||kr.metaKey||kr.shiftKey?an(-2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):Sn(0,-s.keyPanSpeed),$r=!0;break;case s.keys.LEFT:kr.ctrlKey||kr.metaKey||kr.shiftKey?Zt(2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):Sn(s.keyPanSpeed,0),$r=!0;break;case s.keys.RIGHT:kr.ctrlKey||kr.metaKey||kr.shiftKey?Zt(-2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):Sn(-s.keyPanSpeed,0),$r=!0}$r&&(kr.preventDefault(),s.update())}(gr)}function Hs(gr){s.enabled!==!1&&gr.preventDefault()}function Ps(gr){let kr=Nt[gr.pointerId];kr===void 0&&(kr=new g.FM8,Nt[gr.pointerId]=kr),kr.set(gr.pageX,gr.pageY)}function Os(gr){const kr=gr.pointerId===Dt[0].pointerId?Dt[1]:Dt[0];return Nt[kr.pointerId]}this.zoomIn=function(gr){An(1,gr*s.zoomSpeed)},this.zoomOut=function(gr){wn(1,gr*s.zoomSpeed)},s.domElement.addEventListener("contextmenu",Hs),s.domElement.addEventListener("pointerdown",Mr),s.domElement.addEventListener("pointercancel",qr),s.domElement.addEventListener("wheel",Zr,{passive:!1}),this.update()}}var Sl=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let yl=class extends fx{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.autoPullTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.clampMin=new g.Pa4(-1e4,-1e4,-1e4),this.clampMax=new g.Pa4(1e4,1e4,1e4),this.screenSpacePanning=!0,this.keyPanSpeed=7,this.throttleUpdate=60}zoomIn(h){super.zoomIn(h)}zoomOut(h){super.zoomOut(h)}dispatchEvent(h){super.dispatchEvent(h)}};Sl([En()],yl.prototype,"type",void 0),Sl([jr()],yl.prototype,"enabled",void 0),Sl([jr(),En()],yl.prototype,"dollyZoom",void 0),Sl([jr(),En()],yl.prototype,"enableDamping",void 0),Sl([$s(),En()],yl.prototype,"dampingFactor",void 0),Sl([jr(),En()],yl.prototype,"autoRotate",void 0),Sl([$s(),En()],yl.prototype,"autoRotateSpeed",void 0),Sl([jr(),En()],yl.prototype,"enableZoom",void 0),Sl([$s(),En()],yl.prototype,"zoomSpeed",void 0),Sl([$s(),En()],yl.prototype,"maxZoomSpeed",void 0),Sl([jr(),En()],yl.prototype,"enableRotate",void 0),Sl([$s(),En()],yl.prototype,"rotateSpeed",void 0),Sl([jr(),En()],yl.prototype,"enablePan",void 0),Sl([$s(),En()],yl.prototype,"panSpeed",void 0),Sl([$s(),En()],yl.prototype,"autoPushTarget",void 0),Sl([$s(),En()],yl.prototype,"autoPullTarget",void 0),Sl([$s(),En()],yl.prototype,"minDistance",void 0),Sl([$s(),En()],yl.prototype,"maxDistance",void 0),Sl([$s(),En()],yl.prototype,"minZoom",void 0),Sl([$s(),En()],yl.prototype,"maxZoom",void 0),Sl([$s(),En()],yl.prototype,"minPolarAngle",void 0),Sl([$s(),En()],yl.prototype,"maxPolarAngle",void 0),Sl([$s(),En()],yl.prototype,"minAzimuthAngle",void 0),Sl([$s(),En()],yl.prototype,"maxAzimuthAngle",void 0),Sl([Lp(),En()],yl.prototype,"clampMin",void 0),Sl([Lp(),En()],yl.prototype,"clampMax",void 0),Sl([En()],yl.prototype,"screenSpacePanning",void 0),Sl([En()],yl.prototype,"keyPanSpeed",void 0),yl=Sl([W_("Orbit Controls")],yl);var L0=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class zu extends b.SimpleEventDispatcher{get controls(){return this._controls}getControls(){return this._controls}get userData(){return this._camera.modelObject.userData}set userData(e){this._camera.modelObject.userData=e}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const i=this._target.sub(e).length()>0;this._target.copy(e),i&&this.targetUpdated()}get position(){return this._position}set position(e){const i=this._position.sub(e).length()>0;this._position.copy(e),i&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,i=!0){var o,c;const s={...e};(o=s.position)!=null&&o.isVector3&&(s.position=[s.position.x,s.position.y,s.position.z]),(c=s.target)!=null&&c.isVector3&&(s.target=[s.target.x,s.target.y,s.target.z]),Object.keys(s).forEach(_=>_!=="frustumSize"&&s[_]===void 0&&delete s[_]),Object.assign(this._options,s),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),i&&this.setDirty()}_refreshCameraOptions(e=!0){let i=this._camera.modelObject;if(this._options.type!==i.type){const o=this._options.type==="PerspectiveCamera"?new g.cPb:new g.iKG;o.name=this._camera.name,o.near=this._camera.modelObject.near,o.far=this._camera.modelObject.far,o.zoom=this._camera.modelObject.zoom,o.scale.copy(this._camera.modelObject.scale);const c=this._isActiveCamera;c&&this.deactivateMain(),this._camera=this._setCameraObject(o),i=this._camera.modelObject,c&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let s=this._options.aspect;if(s==="auto"&&(s=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionUpdated(!1),this._options.type==="PerspectiveCamera"&&(i.fov=this._options.fov,i.focus=this._options.focus,i.aspect=s),this._options.type==="OrthographicCamera"){const o=this._options.frustumSize;o!==void 0?(i.top=o/2,i.bottom=-o/2,i.left=s*o/2,i.right=-s*o/2):(i.top=this._options.top,i.bottom=this._options.bottom,i.left=this._options.left,i.right=this._options.right)}i.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=Nl(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled&&this._options.controlsMode!==""}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}constructor(e,i,s){super(),this._controlsMode="",this._isActiveCamera=!1,this._cameraObjectUpdate=_=>{this.setDirty(_)},this._interactionsEnabled=!0,this.autoLookAtTarget=!1,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new g.Pa4(0,0,10),this._target=new g.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(_,j)=>{const et=new yl(_,j.ownerDocument?j:j.documentElement);return et.screenSpacePanning=!0,et}]]),this._positionWorld=new g.Pa4,this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>this.refreshCameraOptions(),limitedUi:!0},{type:"checkbox",label:"Auto Near far",getValue:()=>this._camera.userData.autoNearFar??!0,setValue:_=>this._camera.userData.autoNearFar=_,onChange:()=>this.setDirty()},{type:"input",label:()=>this._camera.userData.autoNearFar??1?"Min Near":"Near",getValue:()=>this._camera.userData.minNearPlane??.5,setValue:_=>this._camera.userData.minNearPlane=_,onChange:()=>this.setDirty()},{type:"input",label:()=>this._camera.userData.autoNearFar??1?"Max Far":"Far",getValue:()=>this._camera.userData.maxFarPlane??1e3,setValue:_=>this._camera.userData.maxFarPlane=_,onChange:()=>this.setDirty()},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map(_=>({label:_===""?"none":_,value:_})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var _;return(_=this._controls)!=null&&_.zoomIn?{type:"button",label:"Zoom in",value:()=>{var j;(j=this._controls)==null||j.zoomIn(1)}}:{}},()=>{var _;return(_=this._controls)!=null&&_.zoomOut?{type:"button",label:"Zoom out",value:()=>{var j;(j=this._controls)==null||j.zoomOut(1)}}:{}},()=>{var _;return(_=this._controls)==null?void 0:_.uiConfig}]},this.assetType="model",this.uuid=sn(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=s??document.body;const o={...i};this._camera=this._setCameraObject(e??(o.type==="OrthographicCamera"?new g.iKG(-1,1,1,-1):new g.cPb)),this._camera.modelObject.userData.iCamera=this;const c=e;e&&(c.isPerspectiveCamera?(o.fov=c.fov,o.focus=c.focus,o.aspect=c.aspect<=0||c.userData.autoAspect?"auto":c.aspect,o.zoom=c.zoom):c.isOrthographicCamera&&(o.left=c.left,o.right=c.right,o.top=c.top,o.bottom=c.bottom,o.zoom=c.zoom),this.near=c.near,this.far=c.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),this.setCameraOptions(o)}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(e=4){var i;(i=this._controls)!=null&&i.enabled&&this._controls.target?this._target.copy(this._controls.target):this.cameraObject.getWorldDirection(this._target).multiplyScalar(e).add(this.cameraObject.getWorldPosition(new g.Pa4))}setControlsCtor(e,i,s=!1){s||!this._controlsCtors.has(e)?this._controlsCtors.set(e,i):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var i,s;const e=this._options.controlsMode;this._controls=((i=this._controlsCtors.get(e))==null?void 0:i(this._camera.modelObject,this._container))??void 0,this._controls||e===""||console.error("Unable to create controls with mode "+e+". Are you missing a plugin?"),(s=this._controls)==null||s.addEventListener("change",this.setDirty),this._controlsMode=this._controls?e:""}_disposeCameraControls(){var e,i;this._controlsMode,(e=this._controls)==null||e.removeEventListener("change",this.setDirty),(i=this._controls)==null||i.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var i,s;if(this._options.controlsEnabled){const o=this._options.controlsMode;this._controls?this._controlsMode===o&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=o}if(this._controls){const o=this.interactionsEnabled;this._controls.enabled=o,o&&this._camera.modelObject.up.copy(g.Tme.DEFAULT_UP)}e&&this.setDirty(),(s=(i=this.uiConfig).uiRefresh)==null||s.call(i,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),this.cameraObject.getWorldPosition(this._positionWorld),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)==null?void 0:s.call(i,"postFrame",!1,1)})}activateMain(e=!0){var i,s;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new g.Pa4)),e&&(this.refreshCameraControls(!1),this._refreshCameraOptions(!0)),(s=(i=this._camera).setDirty)==null||s.call(i,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var s,o;const i=this.target;(o=(s=this._controls)==null?void 0:s.target)==null||o.set(i.x,i.y,i.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this._camera.userData.autoLookAtTarget!==void 0&&(this.autoLookAtTarget=this._camera.userData.autoLookAtTarget),this.autoLookAtTarget&&this._camera.modelObject.lookAt(i),e&&this.setDirty())}positionUpdated(e=!0){const i=this.position;this._camera.modelObject.position.set(i.x,i.y,i.z),this.targetUpdated(e)}positionTargetUpdated(e=!0){this.positionUpdated(e)}copyFromCamera(e,i=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(i).add(this._position),this.positionUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var i,s,o,c;return(s=(i=e.uniforms.cameraPositionWorld)==null?void 0:i.value)==null||s.copy(this._positionWorld),(c=(o=e.uniforms.cameraNearFar)==null?void 0:o.value)==null||c.set(this._camera.modelObject.near,this._camera.modelObject.far),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){const i={};return _l(i,this.userData),Object.assign({userData:i},Ls(this,!0,e))}fromJSON(e,i){return e.userData&&(_l(this.userData,e.userData),delete(e={...e}).userData),ao(e,this,!0,i),this.positionUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}L0([En("camControls")],zu.prototype,"_controls",void 0),L0([(0,b.onChange)(zu.prototype._nearFarChanged)],zu.prototype,"near",void 0),L0([(0,b.onChange)(zu.prototype._nearFarChanged)],zu.prototype,"far",void 0),L0([En("camOptions")],zu.prototype,"_options",void 0),L0([En("position")],zu.prototype,"_position",void 0),L0([En("target")],zu.prototype,"_target",void 0);var A_=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class gu extends g.xsS{get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const i=this.activeCamera;if(e||(e=this.defaultCamera),i!==e){if(i&&(i.deactivateMain(),i.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let s=this._cameras.indexOf(e);s<0&&(this._cameras.push(e),s=this._cameras.length-1),this._activeCamera=s}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:i,camera:e}),this.setDirty()}}get renderCamera(){return this._renderCamera??this.activeCamera}set renderCamera(e){const i=this._renderCamera;this._renderCamera=e,this.dispatchEvent({type:"renderCameraChange",lastCamera:i,camera:e})}get modelObject(){return this}constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new Wt,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this.fixedEnvMapDirection=!1,this.backgroundIntensity=1,this._dummyCam=new zu(new g.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.backgroundColor=null,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("materialChanged",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=Nl(new g.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new g.GQ(this.getBounds())}addModel(e,i={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,i)}addWidget(e,i={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,i={}){return this._addObject3D(e==null?void 0:e.modelObject,i)}addSceneObject(e,i){if(!e)return e;const s=e.assetType;let o=!1;switch(s){case"model":o=e.modelObject.isCamera,o&&(i={...i,autoScale:!1}),this._addModel(e,i);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,i);break;default:console.warn("Unknown asset imported",e,s)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:i=!0,autoScaleRadius:s=2,addToRoot:o=!1}={}){const c=e;c?(i&&!c.userData.autoScaled&&Ks(c,c.userData.autoScaleRadius||s),c.traverse(_=>{_.isMesh&&!_.userData.__keepShadowDef&&(_.castShadow=!0,_.receiveShadow=!0,_.userData.__keepShadowDef=!0)}),o?this.modelObject.add(c):this.modelRoot.add(c),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){[...this.modelRoot.children].forEach(e=>{var i;(e.dispose??((i=e.modelObject)==null?void 0:i.removeFromParent))()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){var e;((e=this.environment)==null?void 0:e.mapping)===g.xfE&&(this.environment.mapping=g.dSO,this.environment.needsUpdate=!0),this.dispatchEvent({type:"environmentChanged",environment:this.environment}),this._onSceneUpdate({geometryChanged:!1})}_onBackgroundChange(){this.dispatchEvent({type:"backgroundChanged",background:this.background,backgroundColor:this.backgroundColor}),this._onSceneUpdate({geometryChanged:!1})}add(...e){return super.add(...e.map(i=>Nl(i))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return void(this.environment=null);if(!e.isTexture)return void console.error("Unknown Environment type",e);e.assetType!=="texture"&&console.warn("Environment asset not processed",e);const i=e.textureObject||e;this.environment=i}getEnvironment(){return this.environment}setBackground(e){let i;if(!e||e.assetType==="texture"||e.isTexture||e.isColor||e==="environment")i=((e==null?void 0:e.assetType)==="texture"||e.isTexture)&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);i=new g.Ilk(e)}this.background=i}setBackgroundColor(e){this.backgroundColor=e?new g.Ilk(e):null}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate||e!=null&&e.refreshScene?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var i,s,o;return e.sceneUpdate===!1&&e.refreshScene===!1?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(o=(s=(i=this.boxHelper)==null?void 0:i.box)==null?void 0:s.copy)==null||o.call(s,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new g.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){var e;this.disposeSceneModels(),this.clear(),(e=this.environment)==null||e.dispose()}findObjectsByName(e,i){const s=[];return(i??this.modelObject).traverse(o=>{o.name===e&&s.push(o)}),s}addLight(e,i={}){this.addSceneObject(e,i)}_addLight(e,{addToRoot:i=!1}={}){var o;const s=e.lightObject;s&&((o=s.children)==null||o.length,i?this.add(s):this.modelRoot.add(s))}getBounds(e=!1,i=!0,s=!0,o){return new Wt().expandByObject(this.modelObject,e,i,c=>!(!s||c.assetType!=="widget")||((o==null?void 0:o(c))??!1))}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;if(e.cameraObject.userData.autoNearFar===!1)return e.near=e.cameraObject.userData.minNearPlane??.5,void(e.far=e.cameraObject.userData.maxFarPlane??1e3);const i=this.getBounds(!1),s=e.cameraObject.getWorldPosition(new g.Pa4).sub(i.getCenter(new g.Pa4)),o=1.5*i.getSize(new g.Pa4).length()/2,c=Math.max(.1,-s.clone().normalize().dot(e.cameraObject.getWorldDirection(new g.Pa4))),_=s.length(),j=Math.max(Math.max(e.cameraObject.userData.minNearPlane??.5,.001),c*(_-o)),et=Math.min(Math.max(j+o,c*(_+o)),e.cameraObject.userData.maxFarPlane??1e3);e.near=j,e.far=et}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return Ls(this,!0,e)}fromJSON(e,i){const s=e.environment;return s!==void 0&&(this.setEnvironment(ao(s,this.getEnvironment(),!1,i)),delete e.environment),ao(e,this,!0,i),e.environment=s,this}addEventListener(e,i){super.addEventListener(e,i)}removeEventListener(e,i){super.removeEventListener(e,i)}get minNearDistance(){return console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera.userData.minNearPlane??.5}set minNearDistance(e){console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera&&(this.activeCamera.userData.minNearPlane=e)}}A_([En()],gu.prototype,"defaultCamera",void 0),A_([(0,b.onChange2)(gu.prototype.setDirty),En()],gu.prototype,"envMapIntensity",void 0),A_([(0,b.onChange2)(gu.prototype.setDirty),En()],gu.prototype,"fixedEnvMapDirection",void 0),A_([(0,b.onChange2)(gu.prototype.setDirty),En()],gu.prototype,"backgroundIntensity",void 0),A_([En(),(0,b.onChange)(gu.prototype._onEnvironmentChange.name)],gu.prototype,"environment",void 0),A_([En(),(0,b.onChange)(gu.prototype._onBackgroundChange)],gu.prototype,"background",void 0),A_([En(),(0,b.onChange)(gu.prototype._onBackgroundChange)],gu.prototype,"backgroundColor",void 0);function os(h,e,i,{replaceAll:s=!1,prepend:o=!1,append:c=!1}={}){if(!h.includes(e))return console.error(`${e} not found in shader`),h;let _=i;return o?_=i+e:c&&(_=e+i),s?h.replaceAll(e,_):h.replace(e,_)}class Zu{static ApplyMaterialExtensions(e,i,s,o){for(const c of s)this.ApplyMaterialExtension(e,i,c,o)}static ApplyMaterialExtension(e,i,s,o){let c=(0,b.getOrCall)(s.parsFragmentSnippet,o,e)??"";c.length&&(i.fragmentShader=os(i.fragmentShader,this.VoidMain,`
`+c+`
`,{prepend:!0})),c=(0,b.getOrCall)(s.parsVertexSnippet,o,e)??"",c.length&&(i.vertexShader=os(i.vertexShader,this.VoidMain,`
`+c+`
`,{prepend:!0})),s.extraUniforms&&(i.uniforms=Object.assign(i.uniforms,s.extraUniforms)),s.extraDefines&&function(_,j){let et=!1;j.materialObject&&j.materialObject.defines===void 0&&(j.materialObject.defines={});const nt=Object.entries(_);for(const[st,at]of nt)at===void 0?j.materialObject.defines[st]!==void 0&&(delete j.materialObject.defines[st],et=!0):j.materialObject.defines[st]!==at&&(j.materialObject.defines[st]=at,et=!0);et&&(j.materialObject.needsUpdate=!0)}(s.extraDefines,e),s.shaderExtender&&s.shaderExtender(i,e,o),e.lastShader=i}static CacheKeyForExtensions(e,i){let s="";for(const o of i)s+=this.CacheKeyForExtension(e,o);return s}static CacheKeyForExtension(e,i){let s="";return i.customCacheKey&&(s+=i.customCacheKey),i.computeCacheKey&&(s+=i.computeCacheKey(e)),i.extraDefines&&Object.values(i.extraDefines).forEach(o=>s+=o),s}static RegisterExtensions(e,i){const s=[];if(i)for(const o of i)o.isCompatible&&o.isCompatible(e)&&(s.push(o),o.uuid||(o.uuid=Bp()),o.__setDirty||(o.__setDirty=()=>{o.updateVersion||(o.updateVersion=0),o.updateVersion++}),o.setDirty||(o.setDirty=o.__setDirty));return e.materialExtensions=s,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",o=>function(c,{object:_,renderer:j}){var et;if(c.materialExtensions)for(const nt of c.materialExtensions){if((et=nt.onObjectRender)==null||et.call(nt,_,c,j),c.lastShader){const st=(0,b.getOrCall)(nt.updaters)||[];for(const at of st)at&&at.updateShaderProperties(c.lastShader)}nt.updateVersion!==c.materialObject.userData["_"+nt.uuid+"_version"]&&(c.materialObject.userData["_"+nt.uuid+"_version"]=nt.updateVersion,c.materialObject.needsUpdate=!0)}}(e,o))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",o=>function(c,{object:_,renderer:j}){var et;if(c.materialExtensions)for(const nt of c.materialExtensions)(et=nt.onAfterRender)==null||et.call(nt,_,c,j)}(e,o))),s}}Zu.VoidMain="void main()";class Zm extends g.jyz{constructor(e,i=!1){super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.isRawShaderMaterial=!1,this.extraUniformsToUpload={},i&&(this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"),this.materialExtensions=Zu.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Zu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,i){Zu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:i}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+Zu.CacheKeyForExtensions(this,this.materialExtensions)}onBeforeRender(e,i,s,o,c){super.onBeforeRender(e,i,s,o,c),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}onAfterRender(e,i,s,o,c){super.onAfterRender(e,i,s,o,c),this.dispatchEvent({type:"afterRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}class s0 extends Zm{constructor(){super(...arguments),this.typeSlug="shaderMat"}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}}class _g extends s0{constructor(e,i){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(i)}setTextureIds(e){this.textures.map(i=>i.id).join(";")!==e.join(";")&&(this.textures=e.map(i=>({id:i,colorSpace:g.aCh})),this.setDirty())}_setUniformTexSize(e,i){var _,j;if(!i||!e)return;const s=((_=i.image)==null?void 0:_.width)??512,o=((j=i.image)==null?void 0:j.height)??512,c=e.value;c.isVector2||console.warn("uniform is not a Vector2"),c&&Math.abs(c.x-s)+Math.abs(c.y-o)>.1&&(c.x=s,c.y=o,this.uniformsNeedUpdate=!0)}onBeforeRender(e,i,s,o,c){var _,j;this._setUniformTexSize(this.uniforms.screenSize,(_=e.getRenderTarget())==null?void 0:_.texture);for(const et of this.textures){const nt=et.id,st=(j=this.uniforms[nt])==null?void 0:j.value;st&&(this._setUniformTexSize(this.uniforms[nt+"Size"],st),st.colorSpace!==et.colorSpace&&(et.colorSpace=st.colorSpace,this.needsUpdate=!0))}super.onBeforeRender(e,i,s,o,c)}onBeforeCompile(e,i){e.fragmentShader=this.textures.map(s=>`uniform sampler2D ${s.id}; 
`+kn(s.id??"input",s.colorSpace??g.aCh)).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.colorSpace).join(";")}}function Gs(h,...e){const i=h.fragmentShader;return new _g({defines:Object.assign({},h.defines),uniforms:h.uniforms,vertexShader:h.vertexShader,fragmentShader:i},e)}class yo extends It{constructor(e,...i){super(e.isMaterial?e:Gs(e,...i),i.length<1?yo.DEFAULT_TEX_ID:i[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,i,s,o;(i=(e=this.material)==null?void 0:e.dispose)==null||i.call(e),(o=(s=this.fsQuad)==null?void 0:s.dispose)==null||o.call(s),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(i=>i==null?void 0:i.updateShaderProperties(this.material)))}render(e,i,s,o,c){this.enabled&&super.render(e,i||null,s,o,c)}}yo.DEFAULT_TEX_ID="tDiffuse",function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);c>3&&_&&Object.defineProperty(e,i,_)}([jr("Enabled"),En()],yo.prototype,"enabled",void 0);class b_ extends ot{constructor(e,i,s,o,c){super(),this.scene=e,this.camera=i,this.overrideMaterial=s,this.clearColor=o,this.clearAlpha=c!==void 0?c:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new g.Ilk}render(e,i,s,o,c,_){if(!this.scene||!this.camera)return;const j=e.autoClear;let et,nt;if(e.autoClear=!1,this.overrideMaterial!==void 0&&(nt=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),et=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),_){const st=e.getContext();st.framebufferRenderbuffer(st.FRAMEBUFFER,st.DEPTH_ATTACHMENT,st.RENDERBUFFER,_)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),_){const st=e.getContext();st.framebufferRenderbuffer(st.FRAMEBUFFER,st.DEPTH_ATTACHMENT,st.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,et),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=nt),e.autoClear=j}}class e_ extends yo{constructor(e,i="c = a + b;",s="",o){super({vertexShader:tt.vertexShader,fragmentShader:b.glsl`
                varying vec2 vUv;
                
                ${s}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${i}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:o},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class RS extends s0{constructor(e=!0){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#if IS_GLSL3 > 0
out vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
uniform float alphaTest;
#endif
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <alphamap_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;
#if IS_GLSL3 > 0
in vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
vec2 pack16(float value){float f=clamp(value,0.,1.)*255.;float digitLow=fract(f);float digitHigh=floor(f)/255.;return vec2(digitHigh,digitLow);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){
#glMarker mainStart
#ifdef USE_ALPHAMAP
#ifdef ALPHA_I_RGBA_PACKING
if(1.-unpackRGBAToDepth(texture2D(alphaMap,vAlphaMapUv))<alphaTest)
#else
if(texture2D(alphaMap,vAlphaMapUv).g<alphaTest)
#endif
discard;
#endif
#include <normal_fragment_begin>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:{cameraNearFar:{value:new g.FM8(.1,1e3)},alphaMap:{value:null},displacementMap:{value:null},displacementScale:{value:null},displacementBias:{value:null},displacementMapTransform:{value:new g.Vkp},alphaTest:{value:0},alphaMapTransform:{value:new g.Vkp},flags:{value:new g.Ltg(255,255,255,255)}},defines:{IS_GLSL3:e?"1":"0"},glslVersion:e?g.LSk:g.v9Y}),this._updaters=[]}onBeforeRender(e,i,s,o,c){super.onBeforeRender(e,i,s,o,c);let _=c.material;Array.isArray(_)&&(_=_[0]),this.uniforms.alphaMap.value=(_==null?void 0:_.alphaMap)??null,this.uniforms.alphaMap.value&&e.materials.refreshTransformUniform(this.uniforms.alphaMap.value,this.uniforms.alphaMapTransform),this.uniforms.alphaTest.value=!_||!_.alphaTest||_.alphaTest<1e-7?.001:_.alphaTest,this.uniforms.displacementMap.value=(_==null?void 0:_.displacementMap)??null,this.uniforms.displacementMap.value&&e.materials.refreshTransformUniform(this.uniforms.displacementMap.value,this.uniforms.displacementMapTransform),this.uniforms.displacementScale.value=(_==null?void 0:_.displacementScale)??1,this.uniforms.displacementBias.value=(_==null?void 0:_.displacementBias)??0,this.uniforms.flags.value.set(255,255,255,255),this.uniforms.flags.value.z=(_!=null&&_.userData.matId?_==null?void 0:_.userData.matId:0)/255,this._updaters.forEach(et=>{et(c,this.uniforms.flags.value)}),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let j=this.uniforms.alphaMap.value?1:void 0;j!==this.defines.USE_ALPHAMAP&&(j===void 0?(delete this.defines.USE_ALPHAMAP,delete this.defines.ALPHAMAP_UV):(this.defines.USE_ALPHAMAP=j,this.defines.ALPHAMAP_UV="uv"),this.needsUpdate=!0),j=this.uniforms.displacementMap.value?1:void 0,j!==this.defines.USE_DISPLACEMENTMAP&&(j===void 0?(delete this.defines.USE_DISPLACEMENTMAP,delete this.defines.DISPLACEMENTMAP_UV):(this.defines.USE_DISPLACEMENTMAP=j,this.defines.DISPLACEMENTMAP_UV="uv"),this.needsUpdate=!0),j=_.userData.ALPHA_I_RGBA_PACKING?1:void 0,j!==this.defines.ALPHA_I_RGBA_PACKING&&(j===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=j,this.needsUpdate=!0),j=_.userData.forcedLinearDepth??void 0,j!==this.defines.FORCED_LINEAR_DEPTH&&(j===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=j,this.needsUpdate=!0),this.side=_.side??g.ehD}addGBufferUpdater(e){this._updaters.push(e)}removeGBufferUpdater(e){const i=this._updaters.indexOf(e);i!==-1&&this._updaters.splice(i,1)}}var Zp=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return value.x+value.y/255.;}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
ivec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return ivec4(texture2D(tGBufferFlags,uv)*255.);
#else
return ivec4(1);
#endif
}
#endif
`;class ms extends b.SimpleEventDispatcher{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this.enabled&&this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const i=Ls(this,!0,e);return i.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:i}),i}fromJSON(e,i){return e.type!==this.constructor.PluginType?null:(ao(e,this,!0,i),this.dispatchEvent({type:"deserialize",data:e,meta:i}),this)}_storeKey(e){return(e??"webgi")+"_"+(this.constructor.PluginType||this.constructor.name)}exportState(){var e,i,s;return((i=(e=this._viewer)==null?void 0:e.getPluginByType("AssetManager"))==null?void 0:i.exportPluginPreset(this))??((s=this.toJSON)==null?void 0:s.call(this))}async importState(e){var s,o;const i=(s=this._viewer)==null?void 0:s.getPluginByType("AssetManager");i?await i.importPluginPreset(e,this):(o=this.fromJSON)==null||o.call(this,e)}storeState(e,i,s){(i=i||(window?window.localStorage:void 0))?(s===void 0&&(s=this.exportState()),s&&i.setItem(this._storeKey(e),JSON.stringify(s))):console.warn("Unable to store state")}async loadState(e,i){if(!(i=i||(window?window.localStorage:void 0)))return void console.warn("Unable to load state");const s=i.getItem(this._storeKey(e));s&&await this.importState(JSON.parse(s))}}function Rl(h,e,i){return{...e,get dirty(){return e.dirty||!1},set dirty(s){(0,b.safeSetProperty)(e,"dirty",s,!0)},update(){var s,o,c;this.passObject.enabled&&((o=(s=this.passObject).updateShaderProperties)==null||o.call(s,(0,b.getOrCall)(i)),(c=e.update)==null||c.call(this))},onRegister(s){var o,c,_;this.passObject.materialExtension&&((c=(o=h.getPluginByType("AssetManager"))==null?void 0:o.materials)==null||c.registerMaterialExtension(this.passObject.materialExtension)),(_=e.onRegister)==null||_.call(this,s)},onUnregister(s){var o,c,_;this.passObject.materialExtension&&((c=(o=h.getPluginByType("AssetManager"))==null?void 0:o.materials)==null||c.unregisterMaterialExtension(this.passObject.materialExtension)),(_=e.onUnregister)==null||_.call(this,s)},dispose(){var s,o,c;(o=(s=this.passObject).dispose)==null||o.call(s),(c=e.dispose)==null||c.call(this)}}}class t_ extends ms{_update(e){var i;return((i=this._pass)==null?void 0:i.enabled)&&this.enabled||!1}get enabled(){var e,i;return((i=(e=this._pass)==null?void 0:e.passObject)==null?void 0:i.enabled)??this._enabledTemp}set enabled(e){var i;(i=this._pass)!=null&&i.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}constructor(){super(),this._enabledTemp=!0}async onAdded(e){await super.onAdded(e);const i={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(s){s&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=Rl(e,i),i.passObject.onDirty!==void 0&&i.passObject.onDirty.push(()=>i.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var i,s;this._pass&&e.renderer.unregisterPass(this._pass),(s=(i=this._pass)==null?void 0:i.dispose)==null||s.call(i),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){const i=super.toJSON(e);if(!i.type)return i;const s=this.pass;return s&&(i.pass=Ls((s==null?void 0:s.passObject)??s,!1,e)),i}fromJSON(e,i){if(!super.fromJSON(e,i))return null;if(e.pass){const s=this.pass;s&&ao(e.pass,(s==null?void 0:s.passObject)??s,!1,i)}return this}}(function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);c>3&&_&&Object.defineProperty(e,i,_)})([En()],t_.prototype,"enabled",null);const Pu=new Set,mx=new Set;class Dm extends b_{constructor(e,i,s=new To(1,1,1),o=1){super(void 0,void 0,i,s,o),this.target=e}render(e,i,s,o,c){var nt;const _=e.getRenderTarget(),j=e.getActiveCubeFace(),et=e.getActiveMipmapLevel();(nt=this.scene)==null||nt.traverse(({material:st})=>{st&&((st.transparent&&st.userData.renderToDepth||!st.transparent&&st.transmission===0&&st.userData.renderToDepth===!1)&&(Pu.add(st),st.transparent=!st.transparent),Math.abs(st.transmission||0)>0&&st.userData.renderToDepth&&(mx.add([st,st.transmission]),st.transmission=0))}),ls(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,i,this.target,o,c)),Pu.forEach(st=>st.transparent=!st.transparent),Pu.clear(),mx.forEach(([st,at])=>st.transmission=at),mx.clear(),e.setRenderTarget(_,j,et)}}class zo extends t_{get material(){return this._material}passCtor(e){var o,c;const i=((o=this._viewer)==null?void 0:o.renderer.isWebGL2)&&this.renderFlagsBuffer,s=e.renderer.createTarget({depthBuffer:!0,samples:((c=this._viewer)==null?void 0:c.renderer.composerTarget.samples)||0,type:g.ywz,textureCount:i?2:1});return Array.isArray(s.texture)?(s.texture[0].name="gbufferDepthNormal",s.texture[1].name="gbufferFlags",this._gbufferTextures=s.texture):(s.texture.name="gbufferDepthNormal",this._gbufferTextures.push(s.texture)),this._gbufferTarget=s,this._material=new RS(i),this._material.userData.isGBufferMaterial=!0,new Dm(s,this._material)}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.renderCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.renderCamera.cameraObject,!0}constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return Zp}updateShaderProperties(e){var i;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=this.getDepthNormal()??void 0:(i=this._viewer)==null||i.console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=this.getFlagsTexture()??void 0;const s=e.uniforms.tGBufferFlags.value?1:0;s!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=s,e.needsUpdate=!0)}return this}registerGBufferUpdater(e){this._material&&this._material.addGBufferUpdater(e)}}zo.PluginType="GBuffer";class XA extends b_{get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,colorSpace:g.aCh,type:this._viewer.renderer.rendererObject.extensions.has("EXT_color_buffer_half_float")?g.cLu:g.ywz,format:g.wk1,minFilter:g.wem,magFilter:g.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}constructor(e,i=!0){super(),this.blurTransmissionTarget=!0,this.preserveTransparentTarget=!1,this._viewer=e,this._doTransmissionFix=i,this.clear=!0,this.clearColor=new To(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new e_({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}render(e,i,s,o,c){var at;let _=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,i,s,o,c),this.needsSwap=_,void(e.userData.mainRenderPass=void 0);const j=e.userData;j||console.error("threejs is not patched?");const et=this._viewer.useGBufferDepth;let nt;if(et){const ct=(at=this._viewer.getPlugin(zo))==null?void 0:at.getTarget();if(ct){const dt=e.properties.get(ct);nt=dt.__webglDepthRenderbuffer||dt.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let st=(ct=!1)=>{super.render(e,void 0,s,o,c,nt)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(_=!1,e.info&&!e.info.autoReset)throw"renderer.info.autoReset must be true";{const ct=e.autoClearDepth;e.autoClearDepth=!et,ls(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},st),e.autoClearDepth=ct}if(!et){const ct=e.properties.get(s);nt=ct.__webglDepthRenderbuffer||ct.__webglDepthbuffer}st=()=>{super.render(e,void 0,this.transparentTarget,o,c,nt)};{const ct=this.clear,dt=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,ls(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},st),this.clear=ct,e.autoClearDepth=dt}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,o,c),_=!0);{const ct=this.clear;this.clear=!1,j.transmissionRenderTarget=_?i:s,j.blurTransmissionTarget=this.blurTransmissionTarget&&j.transmissionRenderTarget.samples===0,ls(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},st),j.blurTransmissionTarget=void 0,j.transmissionRenderTarget=void 0,this.clear=ct}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,o,c),_=!0)}}else{{const ct=this.clear,dt=e.autoClearDepth;e.autoClearDepth=!et,this.clear=!0,ls(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},st),this.clear=ct,e.autoClearDepth=dt}{this._viewer.renderer.blit(s.texture,i,{clear:!0});const ct=this.clear;this.clear=!1,j.transmissionRenderTarget=i,j.blurTransmissionTarget=this.blurTransmissionTarget,ls(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},st),j.blurTransmissionTarget=void 0,j.transmissionRenderTarget=void 0,this.clear=ct}_=!1}this.preserveTransparentTarget||this._releaseTransparentTarget(),this.needsSwap=_,e.userData.mainRenderPass=void 0}dispose(){this._releaseTransparentTarget(),super.dispose()}}function gx(h,e){return h.multiplyScalar(h.w*e),h.w=1,h}function DS(h,e){return gx(h,e),new To(h.x,h.y,h.z)}function kS(h,e){const i=Math.max(h.x,Math.max(h.y,h.z));let s=Math.max(Math.min(i/e,1),0);return s=Math.ceil(255*s)/255,h.divideScalar(s*e),h.w=s,h}function L1(h,e){return kS(new g.Ltg(h.r,h.g,h.b,1),e)}const N1={name:"",blending:g.bdR,side:g.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:g.k74,blendDst:g.LgZ,blendEquation:g.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:g.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:g.cum,stencilRef:0,stencilFuncMask:255,stencilFail:g.x5V,stencilZFail:g.x5V,stencilZPass:g.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaToCoverage:!1,premultipliedAlpha:!1,forceSinglePass:!1,visible:!0,toneMapped:!0,userData:{},alphaTest:0},Ny={...N1,color:"#ffffff",roughness:1,metalness:0,map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,emissive:"#000000",emissiveIntensity:1,emissiveMap:null,bumpMap:null,bumpScale:1,normalMap:null,normalMapType:g.IOt,normalScale:new g.FM8(1,1),displacementMap:null,displacementScale:1,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:1,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",flatShading:!1,fog:!0},w_={...Ny,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new g.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,iridescence:0,iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null,sheen:0,sheenColor:new To(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:1/0,attenuationColor:new To(1,1,1),specularIntensity:1,specularIntensityMap:null,specularColor:new To(1,1,1),specularColorMap:null};class bp extends g.EJi{constructor(e){super(e),this.typeSlug=bp.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.fog=!1,this.attenuationDistance=0,this.materialExtensions=Zu.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)==null?void 0:i.uiRefresh)==null||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Zu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"checkbox",property:[this,"vertexColors"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Po(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},Po(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},Po(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[-.1,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},Po(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",g.IOt],["ObjectSpace",g.PA7]].map(e=>({label:e[0],value:e[1]}))},Po(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},Po(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},Po(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},Po(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},Po(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},Po(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},Po(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},Po(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,4],property:[this,"ior"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},Po(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},Po(this,"thicknessMap"),{type:"input",property:[this,"attenuationDistance"]},{type:"color",property:[this,"attenuationColor"]}]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",g.BVF],["Always",g.Se2],["Less",g.Zr5],["LessEqual",g.vCF],["Equal",g.eD],["GreaterEqual",g.ksN],["Greater",g.w$m],["NotEqual",g.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",pu],["Normal",Fu],["Additive",g.WMw],["Subtractive",wo],["Multiply",Pl]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Po(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Po(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Po(this,"lightMap")]},{type:"folder",label:"Iridescence",children:[{type:"slider",bounds:[0,3],label:"Intensity",property:[this,"iridescence"]},{type:"slider",bounds:[0,3],label:"IOR",property:[this,"iridescenceIOR"]},{type:"slider",bounds:[0,500],label:"Thickness0",property:[this.iridescenceThicknessRange,"0"],onChange:this.setDirty},{type:"slider",bounds:[0,500],label:"Thickness1",property:[this.iridescenceThicknessRange,"1"],onChange:this.setDirty},{type:"image",property:[this,"iridescenceMap"]},Po(this,"iridescenceMap"),{type:"image",property:[this,"iridescenceThicknessMap"]},Po(this,"iridescenceThicknessMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",g.Wl3],["Back",g._Li],["Double",g.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>{var e,i;return((i=(e=this.userData)==null?void 0:e.__appliedMeshes)==null?void 0:i.size)??0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(Ls(this,!1),null,2)],{type:"application/json"});(0,b.downloadBlob)(e,`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)==null?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],o=[["#include <uv_vertex>","mainStart"]];for(const c of o)e.vertexShader=os(e.vertexShader,c[0],"#glMarker "+c[1]+`
`+c[0]);for(const c of s)e.fragmentShader=os(e.fragmentShader,c[0],"#glMarker "+c[1]+`
`+c[0]);Zu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+Zu.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,o,c){super.onBeforeRender(e,i,s,o,c),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||i.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=i.envMapIntensity),this.envMap!==void 0&&i.fixedEnvMapDirection!==void 0&&(i.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:o,object:c});const _=this.userData.inverseAlphaMap?1:0;_!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=_,this.needsUpdate=!0)}onAfterRender(e,i,s,o,c){super.onAfterRender(e,i,s,o,c),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}copyProps(e,i=!1,s=!0){if(!i&&!["MeshStandardMaterial",bp.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const o={},c=Array.from(Object.keys(w_));(0,b.copyProps)(e,o,c);const _=o.userData;delete o.userData;for(const j of Object.keys(o))o[j]===void 0&&delete o[j];if(this.setValues(o),s)for(const j of Mm)this.userData[j]!==void 0&&this.userData[j];return _&&Jl(this.userData,_),isFinite(this.attenuationDistance)||(this.attenuationDistance=0),this.setDirty(),this}toJSON(e){var c,_;const i=this.userData;this.userData={};const s=super.toJSON(e);this.userData=i,s.userData={},Jl(s.userData,i),s.userData.uuid=this.userData.uuid;const o=e||{textures:Object.fromEntries(((c=s.textures)==null?void 0:c.map(j=>[j.uuid,j]))||[]),images:Object.fromEntries(((_=s.images)==null?void 0:_.map(j=>[j.uuid,j]))||[])};s.userData=Ls(s.userData,!1,o),e||(Object.keys(o.textures).length>0&&(s.textures=Object.values(o.textures)),Object.keys(o.images).length>0&&(s.images=Object.values(o.images))),s.type=bp.TYPE;for(const j of Object.keys(s))s[j]===void 0&&delete s[j];return s}fromJSON(e,i,s=!1){return this.copyProps(e,s)}clone(){return super.clone()}}bp.TypeSlug="pmat",bp.TYPE="MeshStandardMaterial2";const _x={...N1,color:"#ffffff",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,specularMap:null,alphaMap:null,envMap:null,combine:g.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",skinning:!1,fog:!0};class wp extends g.vBJ{constructor(e){super(e),this.typeSlug=wp.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},!this.defines&&(this.defines={}),this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.materialExtensions=Zu.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)==null?void 0:i.uiRefresh)==null||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Zu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Po(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",pu],["Normal",Fu],["Additive",g.WMw],["Subtractive",wo],["Multiply",Pl]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Po(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Po(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Po(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",g.Wl3],["Back",g._Li],["Double",g.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,i;return((i=(e=this.userData)==null?void 0:e.__appliedMeshes)==null?void 0:i.size)??0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(Ls(this,!1),null,2)],{type:"application/json"});(0,b.downloadBlob)(e,`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)==null?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],o=[["#include <uv_vertex>","mainStart"]];for(const c of o)e.vertexShader=os(e.vertexShader,c[0],"#glMarker "+c[1]+`
`+c[0]);for(const c of s)e.fragmentShader=os(e.fragmentShader,c[0],"#glMarker "+c[1]+`
`+c[0]);Zu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:i}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+Zu.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,o,c){super.onBeforeRender(e,i,s,o,c),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}onAfterRender(e,i,s,o,c){super.onAfterRender(e,i,s,o,c),this.dispatchEvent({type:"afterRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}copyProps(e,i=!1){if(!i&&!["MeshBasicMaterial",wp.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const s={},o=Array.from(Object.keys(_x));(0,b.copyProps)(e,s,o);const c=s.userData;delete s.userData;for(const _ of Object.keys(s))s[_]===void 0&&delete s[_];return this.setValues(s),c&&Jl(this.userData,c),this.setDirty(),this}toJSON(e){var c,_;const i=this.userData;this.userData={};const s=super.toJSON(e);this.userData=i,s.userData={},Jl(s.userData,i),s.userData.uuid=this.userData.uuid;const o=e||{textures:Object.fromEntries(((c=s.textures)==null?void 0:c.map(j=>[j.uuid,j]))||[]),images:Object.fromEntries(((_=s.images)==null?void 0:_.map(j=>[j.uuid,j]))||[])};s.userData=Ls(s.userData,!1,o),e||(Object.keys(o.textures).length>0&&(s.textures=Object.values(o.textures)),Object.keys(o.images).length>0&&(s.images=Object.values(o.images))),s.type=wp.TYPE;for(const j of Object.keys(s))s[j]===void 0&&delete s[j];return s}fromJSON(e,i,s=!1){return this.copyProps(e,s)}clone(){return super.clone()}}wp.TypeSlug="bmat",wp.TYPE="MeshBasicMaterial2";const YA={materialType:bp.TYPE,name:"standard",color:"#ffffff"},$A={materialType:wp.TYPE,name:"basic",color:"#ffffff"},vx={[bp.TYPE]:YA.name,MeshStandardMaterial:YA.name,MeshPhysicalMaterial:YA.name,[wp.TYPE]:$A.name,MeshBasicMaterial:$A.name};class N0 extends b.SimpleEventDispatcher{constructor(){super(),this._templates=[YA,$A],this._materials=[],this._disposeMaterial=e=>{const i=e.target;if(!i||i.assetType!=="material")return;this._refreshTextureRefs();const s=this._getMapsForMaterial(i),o=[];s.forEach(c=>{const _=c.userData.__appliedMaterials;_==null||_.delete(i),_&&c.userData.disposeOnIdle!==!1&&_.size===0&&o.push(c)}),o.forEach(c=>{c.dispose()}),this.unregisterMaterial(i)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,i){let s=this.findMaterial(e);return s||(s=this.generateFromTemplate(e,i)),s}generateFromTemplate(e,i){const s=this.findTemplate(e);if(s)return this._generateFromTemplate(s,i??{})}generateFromTemplateType(e,i){const s=this._templates.find(o=>o.materialType===e);if(s)return this._generateFromTemplate(s,i??{})}findTemplate(e){return this._templates.find(i=>i.name===e)}_refreshTextureRefs(e){(e||this.getAllMaterials()).forEach(i=>{this._getMapsForMaterial(i).forEach(s=>{let o=s.userData.__appliedMaterials;o||(s.userData.__appliedMaterials=o=new Set),s.addEventListener("update",()=>i.dispatchEvent({type:"textureUpdate",texture:s})),o.add(i)})})}_getMapsForMaterial(e){const i=new Set;for(const s of Object.values(e))s&&s.isTexture&&i.add(s);for(const s of Object.values(e.userData??{}))s&&s.isTexture&&i.add(s);return i}registerMaterial(e){if(this._materials.includes(e))return;const i=this.findMaterial(e.uuid);i?console.warn("Material UUID already exists",e,i):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e),this._refreshTextureRefs([e]))}registerMaterialObject(e){const i=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(i),i}unregisterMaterial(e){this._materials=this._materials.filter(i=>i.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=Bp());const i=this._templates.find(s=>s.templateUUID===e.templateUUID);i?console.warn("MaterialTemplate already exists",e,i):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(i=>i.templateUUID!==e.templateUUID)}dispose(e=!0){const i=this._materials;this._materials=[];for(const s of i)e||!s.userData.runtimeMaterial?s.dispose():this._materials.push(s)}findMaterial(e){return e?this._materials.find(i=>i.uuid===e):void 0}findMaterialsByName(e,i=!1){return this._materials.filter(s=>typeof e!="string"||i?s.name.match(typeof e=="string"?"^"+e+"$":e)!==null:s.name===e)}getMaterialsOfType(e){return e?this._materials.filter(i=>i.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,i){const s=this._processModel(e,i);return(0,b.safeSetProperty)(e,"modelObject",s),e}_processMaterial(e,i){var o,c;if(!e)return;if((o=e.materialObject)!=null&&o.isMaterial)return e;let s=e.mmMaterial;if(!s){const _=((c=e.userData)==null?void 0:c.uuid)||e.uuid;if(s=this.findMaterial(_),s)s.copyProps(e);else{const j=i.useSourceMaterial===!1||!e.isMaterial,et=i.materialTemplate||(j?"standard":vx[e.type]||"standard");s=this.generateFromTemplate(et,j?{}:e)}e.mmMaterial=s}return s}processMaterial(e,i){return e.materialObject||(e=this._processMaterial(e,{...i,register:!1})),i.register!==!1&&this.registerMaterial(e),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const i=this._materialExtensions.indexOf(e);i>=0&&this._materialExtensions.splice(i,1)}exportMaterial(e,i,s=!0,o=!1){const c=Ls(e,!1),_=JSON.stringify(c,null,s?0:2),j=(i||e.name||"physical_material")+"."+e.typeSlug,et=new File([_],j,{type:"application/json"});return o&&(0,b.downloadFile)(et),et}applyMaterial(e,i){var _;const s=Object.getPrototypeOf(e).constructor.TYPE;let o=this.findMaterialsByName(i,!0);(!o||o.length<1)&&(o=[this.findMaterial(i)]);let c=!1;for(const j of o)if(j&&!j.userData.__isVariation&&j!==e)if(Object.getPrototypeOf(j).constructor.TYPE===s){const et=j.name;j.copyProps(e),j.name=et,c=!0}else{const et=j["__"+s]||this.generateFromTemplateType(s);if(!et)continue;const nt=j.name;et.copyProps(e),et.name=nt;const st=j.userData.__appliedMeshes;for(const at of[...st??[]])(_=at==null?void 0:at.setMaterial)==null||_.call(at,et),at&&(c=!0);j["__"+s]=et}return c}}class U0 extends N0{_generateFromTemplate(e,i){var j,et,nt,st,at;let s;const o={...e};o.customMaterialExtensions=[...o.customMaterialExtensions??[],...this._materialExtensions];const c=(i==null?void 0:i.metadata)&&(i==null?void 0:i.metadata.version)<=4.5;c&&(g.epp.enabled=!1);let _={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":i&&(0,b.copyProps)(i,o,Array.from(Object.keys(w_))),(i==null?void 0:i.type)==="MeshBasicMaterial"&&(o.roughness=.9,o.metalness=0,(j=o.userData)!=null&&j.uuid&&delete o.userData.uuid),_=(et=o.userData)==null?void 0:et.uuid,_&&delete o.userData.uuid,s=new bp({customMaterialExtensions:o.customMaterialExtensions}).fromJSON(o,void 0,!0),_&&(s.uuid=_),s.userData.uuid=s.uuid,s.setDirty(),i!=null&&i.isMaterial&&i.userData!==void 0&&(i.userData.iMaterial=s);break;case"MeshBasicMaterial2":case"basic":case"unlit":i&&(0,b.copyProps)(i,o,Array.from(Object.keys(_x))),_=(nt=o.userData)==null?void 0:nt.uuid,_&&delete o.userData.uuid,s=new wp({customMaterialExtensions:o.customMaterialExtensions}).fromJSON(o,void 0,!0),_&&(s.uuid=_,o.userData.uuid=_),s.userData.uuid=s.uuid,s.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:_=null,i&&i.userData&&(_=i.userData,delete i.userData),s=((st=e.generator)==null?void 0:st.call(e,o,i))||void 0,i&&_&&(i.userData=_),_&&s&&(Jl(s.userData,_),_!=null&&_.uuid&&(s.uuid=_.uuid),_=null),s&&(s.userData.uuid=s.uuid)}if(s){i.runtimeMaterial&&(s.userData.__runtimeMaterial=!0);const ct=s;if(s.clone=()=>{ct.userData.cloneId||(ct.userData.cloneId="0"),ct.userData.cloneCount||(ct.userData.cloneCount=0),ct.userData.cloneCount+=1;const dt=this.generateFromTemplate(e.name);return dt&&(dt.copyProps(ct),dt.userData.cloneId=dt.userData.cloneId+"_"+ct.userData.cloneCount,dt.userData.cloneCount=0,dt.name=dt.name+"_"+dt.userData.cloneId,dt.userData.uuid=dt.uuid),dt==null?void 0:dt.materialObject},i){let dt=this.findMaterial(i==null?void 0:i.uuid);dt&&this.unregisterMaterial(dt),dt=this.findMaterial((at=i==null?void 0:i.materialObject)==null?void 0:at.uuid),dt&&this.unregisterMaterial(dt)}}return c&&(g.epp.enabled=!0),s?this.registerMaterialObject(s):void 0}_processModel(e,i){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let s=e.material;if(!s&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),s=this._defaultMaterial,e.material=s),s){let o=!0;Array.isArray(s)||(s=[s],o=!1);const c=[];for(const _ of s){const j=this._processMaterial(_,i);c.push(j==null?void 0:j.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(o?c:c[0]))}if(i.recursive!==!1)for(let o=0;o<e.modelObject.children.length;o++)e.modelObject.children[o]=this._processModel(e.modelObject.children[o],i);return e}}class eu{ctor(e){const i=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(i,e):i}constructor(e,i,s,o){this.cls=e,this.ext=i,this.root=s,this.onCtor=o}}class Uy{get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}constructor(e,{pseudoCenter:i=!1,autoCenter:s=!1,autoScale:o=!1,autoScaleRadius:c=2,license:_=""}={}){if(this.assetType="model",this._modelObject=Nl(new g.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!i||e.userData.pseudoCentered||e.userData.isCentered)!s||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?i||s||(e.userData.isCentered=!0):oo(e),this._modelObject=e;else{s&&console.error("cannot use pseudoCenter and autoCenter at the same time");const j=new Wt().expandByObject(e,!0,!0).getCenter(new g.Pa4);this._modelObject.position.copy(j).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,e.userData.iModel=this}o&&!this._modelObject.userData.autoScaled?Ks(this._modelObject,e.userData.autoScaleRadius||c):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=_}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,i){this._modelObject.addEventListener(e,i)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,i){return this._modelObject.hasEventListener(e,i)}removeEventListener(e,i){this._modelObject.removeEventListener(e,i)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var i,s,o,c;(s=(i=this._modelObject)==null?void 0:i.setDirty)==null||s.call(i,e),(c=(o=this._uiConfig)==null?void 0:o.uiRefresh)==null||c.call(o,"postFrame",!0)}setMaterial(e){var i,s;return this._modelObject.isMesh?((s=(i=this._modelObject).setMaterial)==null?void 0:s.call(i,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,i=!1){var s,o;if(this._modelObject.isMesh)return(o=(s=this._modelObject).setGeometry)==null?void 0:o.call(s,e,i);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=mu(this._modelObject,!1)),this._uiConfig}clone(){return new Uy(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function KA(h,e){return[h.modelObject,...h.modelObject.children].forEach(i=>{Nl(i,i!==h.modelObject?h:void 0,e)}),h}class x_{constructor(){this._processors=new Map}add(e,i){var s;this._processors.has(e)||this._processors.set(e,[]),(s=this._processors.get(e))==null||s.push(i)}remove(e,i){const s=this._processors.get(e),o=(s==null?void 0:s.indexOf(i))||(s==null?void 0:s.findIndex(c=>c.process&&c.process===i.process||c.processAsync&&c.processAsync===i.processAsync));!s||!o||o<0||s.splice(o,1)}get(e){return this._processors.get(e)??[]}async process(e,i,s){var _,j;const o=this.get(e),c=i.assetType;for(const et of o)et.forAssetType===c&&(i=((_=et.process)==null?void 0:_.call(et,i,s))??i,i=await((j=et.processAsync)==null?void 0:j.call(et,i,s))??i);return i}dispose(){this._processors.clear()}}class tu extends g.hH6{load(e,i,s,o){return super.load(e,c=>{try{if(typeof c!="string")throw new Error("Invalid JSON");i==null||i(JSON.parse(c))}catch(_){o==null||o(_)}},s,o)}}class OS extends g.yxD{constructor(e){super(e),this.type=g.cLu}parse(e){const i=function(et,nt){switch(et){case 1:console.error("THREE.RGBELoader Read Error: "+(nt||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(nt||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(nt||""));break;default:console.error("THREE.RGBELoader: Error: "+(nt||""))}return-1},s=function(et,nt,st){nt=nt||1024;let at=et.pos,ct=-1,dt=0,mt="",yt=String.fromCharCode.apply(null,new Uint16Array(et.subarray(at,at+128)));for(;0>(ct=yt.indexOf(`
`))&&dt<nt&&at<et.byteLength;)mt+=yt,dt+=yt.length,at+=128,yt+=String.fromCharCode.apply(null,new Uint16Array(et.subarray(at,at+128)));return-1<ct&&(st!==!1&&(et.pos+=dt+ct+1),mt+yt.slice(0,ct))},o=function(et,nt,st,at){const ct=et[nt+3],dt=Math.pow(2,ct-128)/255;st[at+0]=et[nt+0]*dt,st[at+1]=et[nt+1]*dt,st[at+2]=et[nt+2]*dt,st[at+3]=1},c=function(et,nt,st,at){const ct=et[nt+3],dt=Math.pow(2,ct-128)/255;st[at+0]=g.A5E.toHalfFloat(Math.min(et[nt+0]*dt,65504)),st[at+1]=g.A5E.toHalfFloat(Math.min(et[nt+1]*dt,65504)),st[at+2]=g.A5E.toHalfFloat(Math.min(et[nt+2]*dt,65504)),st[at+3]=g.A5E.toHalfFloat(1)},_=new Uint8Array(e);_.pos=0;const j=function(et){const nt=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,st=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,at=/^\s*FORMAT=(\S+)\s*$/,ct=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,dt={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let mt,yt;if(et.pos>=et.byteLength||!(mt=s(et)))return i(1,"no header found");if(!(yt=mt.match(/^#\?(\S+)/)))return i(3,"bad initial token");for(dt.valid|=1,dt.programtype=yt[1],dt.string+=mt+`
`;mt=s(et),mt!==!1;)if(dt.string+=mt+`
`,mt.charAt(0)!=="#"){if((yt=mt.match(nt))&&(dt.gamma=parseFloat(yt[1])),(yt=mt.match(st))&&(dt.exposure=parseFloat(yt[1])),(yt=mt.match(at))&&(dt.valid|=2,dt.format=yt[1]),(yt=mt.match(ct))&&(dt.valid|=4,dt.height=parseInt(yt[1],10),dt.width=parseInt(yt[2],10)),2&dt.valid&&4&dt.valid)break}else dt.comments+=mt+`
`;return 2&dt.valid?4&dt.valid?dt:i(3,"missing image size specifier"):i(3,"missing format specifier")}(_);if(j!==-1){const et=j.width,nt=j.height,st=function(at,ct,dt){const mt=ct;if(mt<8||mt>32767||at[0]!==2||at[1]!==2||128&at[2])return new Uint8Array(at);if(mt!==(at[2]<<8|at[3]))return i(3,"wrong scanline width");const yt=new Uint8Array(4*ct*dt);if(!yt.length)return i(4,"unable to allocate buffer space");let wt=0,Ct=0;const bt=4*mt,At=new Uint8Array(4),Pt=new Uint8Array(bt);let Dt=dt;for(;Dt>0&&Ct<at.byteLength;){if(Ct+4>at.byteLength)return i(1);if(At[0]=at[Ct++],At[1]=at[Ct++],At[2]=at[Ct++],At[3]=at[Ct++],At[0]!=2||At[1]!=2||(At[2]<<8|At[3])!=mt)return i(3,"bad rgbe scanline format");let Nt,Vt=0;for(;Vt<bt&&Ct<at.byteLength;){Nt=at[Ct++];const an=Nt>128;if(an&&(Nt-=128),Nt===0||Vt+Nt>bt)return i(3,"bad scanline data");if(an){const fn=at[Ct++];for(let mn=0;mn<Nt;mn++)Pt[Vt++]=fn}else Pt.set(at.subarray(Ct,Ct+Nt),Vt),Vt+=Nt,Ct+=Nt}const Zt=mt;for(let an=0;an<Zt;an++){let fn=0;yt[wt]=Pt[an+fn],fn+=mt,yt[wt+1]=Pt[an+fn],fn+=mt,yt[wt+2]=Pt[an+fn],fn+=mt,yt[wt+3]=Pt[an+fn],wt+=4}Dt--}return yt}(_.subarray(_.pos),et,nt);if(st!==-1){let at,ct,dt;switch(this.type){case g.VzW:dt=st.length/4;const mt=new Float32Array(4*dt);for(let wt=0;wt<dt;wt++)o(st,4*wt,mt,4*wt);at=mt,ct=g.VzW;break;case g.cLu:dt=st.length/4;const yt=new Uint16Array(4*dt);for(let wt=0;wt<dt;wt++)c(st,4*wt,yt,4*wt);at=yt,ct=g.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:et,height:nt,data:at,header:j.string,gamma:j.gamma,exposure:j.exposure,type:ct}}}return null}setDataType(e){return this.type=e,this}load(e,i,s,o){return super.load(e,function(c,_){switch(c.type){case g.VzW:case g.cLu:c.colorSpace=g.GUF,c.minFilter=g.wem,c.magFilter=g.wem,c.generateMipmaps=!1,c.flipY=!0}i&&i(c,_)},s,o)}}function Iv(h){return new eu(class extends OS{constructor(e){super(e),this.setDataType(ey(h.renderer.rendererObject))}},["hdr"],!1)}class n_ extends g.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new jo(i)}),this.register(function(i){return new gm(i)}),this.register(function(i){return new BS(i)}),this.register(function(i){return new LS(i)}),this.register(function(i){return new km(i)}),this.register(function(i){return new Ro(i)}),this.register(function(i){return new U1(i)}),this.register(function(i){return new Nr(i)}),this.register(function(i){return new zy(i)}),this.register(function(i){return new xo(i)}),this.register(function(i){return new Pv(i)}),this.register(function(i){return new Fy(i)}),this.register(function(i){return new F0(i)}),this.register(function(i){return new Vy(i)})}load(e,i,s,o){const c=this;let _;_=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:g.Zp0.extractUrlBase(e),this.manager.itemStart(e);const j=function(nt){o?o(nt):console.error(nt),c.manager.itemError(e),c.manager.itemEnd(e)},et=new g.hH6(this.manager);et.setPath(this.path),et.setResponseType("arraybuffer"),et.setRequestHeader(this.requestHeader),et.setWithCredentials(this.withCredentials),et.load(e,function(nt){try{c.parse(nt,_,function(st){i(st),c.manager.itemEnd(e)},j,e)}catch(st){j(st)}},s,j)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,o,c){let _;const j={},et={},nt=new TextDecoder;if(typeof e=="string")_=JSON.parse(e);else if(e instanceof ArrayBuffer)if(nt.decode(new Uint8Array(e,0,4))===yx){try{j[Us.KHR_BINARY_GLTF]=new j0(e)}catch(at){return void(o&&o(at))}_=JSON.parse(j[Us.KHR_BINARY_GLTF].content)}else _=JSON.parse(nt.decode(e));else _=e;if(_.asset===void 0||_.asset.version[0]<2)return void(o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const st=new Nn(_,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});st.fileLoader.setRequestHeader(this.requestHeader);for(let at=0;at<this.pluginCallbacks.length;at++){const ct=this.pluginCallbacks[at](st);et[ct.name]=ct,j[ct.name]=!0}if(_.extensionsUsed)for(let at=0;at<_.extensionsUsed.length;++at){const ct=_.extensionsUsed[at],dt=_.extensionsRequired||[];switch(ct){case Us.KHR_MATERIALS_UNLIT:j[ct]=new jy;break;case Us.KHR_DRACO_MESH_COMPRESSION:j[ct]=new z0(_,this.dracoLoader);break;case Us.KHR_TEXTURE_TRANSFORM:j[ct]=new Ax;break;case Us.KHR_MESH_QUANTIZATION:j[ct]=new NS;break;default:dt.indexOf(ct)>=0&&et[ct]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+ct+'".')}}st.setExtensions(j),st.setPlugins(et),st.parse(s,o)}parseAsync(e,i){const s=this;return new Promise(function(o,c){s.parse(e,i,o,c)})}}function mm(){let h={};return{get:function(e){return h[e]},add:function(e,i){h[e]=i},remove:function(e){delete h[e]},removeAll:function(){h={}}}}const Us={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Fy{constructor(e){this.parser=e,this.name=Us.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let s=0,o=i.length;s<o;s++){const c=i[s];c.extensions&&c.extensions[this.name]&&c.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,c.extensions[this.name].light)}}_loadLight(e){const i=this.parser,s="light:"+e;let o=i.cache.get(s);if(o)return o;const c=i.json,_=((c.extensions&&c.extensions[this.name]||{}).lights||[])[e];let j;const et=new g.Ilk(16777215);_.color!==void 0&&et.fromArray(_.color);const nt=_.range!==void 0?_.range:0;switch(_.type){case"directional":j=new g.Ox3(et),j.target.position.set(0,0,-1),j.add(j.target);break;case"point":j=new g.cek(et),j.distance=nt;break;case"spot":j=new g.PMe(et),j.distance=nt,_.spot=_.spot||{},_.spot.innerConeAngle=_.spot.innerConeAngle!==void 0?_.spot.innerConeAngle:0,_.spot.outerConeAngle=_.spot.outerConeAngle!==void 0?_.spot.outerConeAngle:Math.PI/4,j.angle=_.spot.outerConeAngle,j.penumbra=1-_.spot.innerConeAngle/_.spot.outerConeAngle,j.target.position.set(0,0,-1),j.add(j.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+_.type)}return j.position.set(0,0,0),j.decay=2,Om(j,_),_.intensity!==void 0&&(j.intensity=_.intensity),j.name=i.createUniqueName(_.name||"light_"+e),o=Promise.resolve(j),i.cache.add(s,o),o}getDependency(e,i){if(e==="light")return this._loadLight(i)}createNodeAttachment(e){const i=this,s=this.parser,o=s.json.nodes[e],c=(o.extensions&&o.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(_){return s._getNodeRef(i.cache,c,_)})}}class jy{constructor(){this.name=Us.KHR_MATERIALS_UNLIT}getMaterialType(){return g.vBJ}extendParams(e,i,s){const o=[];e.color=new g.Ilk(1,1,1),e.opacity=1;const c=i.pbrMetallicRoughness;if(c){if(Array.isArray(c.baseColorFactor)){const _=c.baseColorFactor;e.color.fromArray(_),e.opacity=_[3]}c.baseColorTexture!==void 0&&o.push(s.assignTexture(e,"map",c.baseColorTexture,g.KI_))}return Promise.all(o)}}class zy{constructor(e){this.parser=e,this.name=Us.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name].emissiveStrength;return o!==void 0&&(i.emissiveIntensity=o),Promise.resolve()}}class jo{constructor(e){this.parser=e,this.name=Us.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?g.EJi:null}extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],_=o.extensions[this.name];if(_.clearcoatFactor!==void 0&&(i.clearcoat=_.clearcoatFactor),_.clearcoatTexture!==void 0&&c.push(s.assignTexture(i,"clearcoatMap",_.clearcoatTexture)),_.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=_.clearcoatRoughnessFactor),_.clearcoatRoughnessTexture!==void 0&&c.push(s.assignTexture(i,"clearcoatRoughnessMap",_.clearcoatRoughnessTexture)),_.clearcoatNormalTexture!==void 0&&(c.push(s.assignTexture(i,"clearcoatNormalMap",_.clearcoatNormalTexture)),_.clearcoatNormalTexture.scale!==void 0)){const j=_.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new g.FM8(j,j)}return Promise.all(c)}}class Pv{constructor(e){this.parser=e,this.name=Us.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?g.EJi:null}extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],_=o.extensions[this.name];return _.iridescenceFactor!==void 0&&(i.iridescence=_.iridescenceFactor),_.iridescenceTexture!==void 0&&c.push(s.assignTexture(i,"iridescenceMap",_.iridescenceTexture)),_.iridescenceIor!==void 0&&(i.iridescenceIOR=_.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),_.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=_.iridescenceThicknessMinimum),_.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=_.iridescenceThicknessMaximum),_.iridescenceThicknessTexture!==void 0&&c.push(s.assignTexture(i,"iridescenceThicknessMap",_.iridescenceThicknessTexture)),Promise.all(c)}}class km{constructor(e){this.parser=e,this.name=Us.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?g.EJi:null}extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[];i.sheenColor=new g.Ilk(0,0,0),i.sheenRoughness=0,i.sheen=1;const _=o.extensions[this.name];return _.sheenColorFactor!==void 0&&i.sheenColor.fromArray(_.sheenColorFactor),_.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=_.sheenRoughnessFactor),_.sheenColorTexture!==void 0&&c.push(s.assignTexture(i,"sheenColorMap",_.sheenColorTexture,g.KI_)),_.sheenRoughnessTexture!==void 0&&c.push(s.assignTexture(i,"sheenRoughnessMap",_.sheenRoughnessTexture)),o.extras&&o.extras.sheenFactor!==void 0&&(i.sheen=o.extras.sheenFactor,delete o.extras.sheenFactor),Promise.all(c)}}class Ro{constructor(e){this.parser=e,this.name=Us.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?g.EJi:null}extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],_=o.extensions[this.name];return _.transmissionFactor!==void 0&&(i.transmission=_.transmissionFactor),_.transmissionTexture!==void 0&&c.push(s.assignTexture(i,"transmissionMap",_.transmissionTexture)),Promise.all(c)}}class U1{constructor(e){this.parser=e,this.name=Us.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?g.EJi:null}extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],_=o.extensions[this.name];i.thickness=_.thicknessFactor!==void 0?_.thicknessFactor:0,_.thicknessTexture!==void 0&&c.push(s.assignTexture(i,"thicknessMap",_.thicknessTexture)),i.attenuationDistance=_.attenuationDistance||1/0;const j=_.attenuationColor||[1,1,1];return i.attenuationColor=new g.Ilk(j[0],j[1],j[2]),Promise.all(c)}}class Nr{constructor(e){this.parser=e,this.name=Us.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?g.EJi:null}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return i.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class xo{constructor(e){this.parser=e,this.name=Us.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?g.EJi:null}extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],_=o.extensions[this.name];i.specularIntensity=_.specularFactor!==void 0?_.specularFactor:1,_.specularTexture!==void 0&&c.push(s.assignTexture(i,"specularIntensityMap",_.specularTexture));const j=_.specularColorFactor||[1,1,1];return i.specularColor=new g.Ilk(j[0],j[1],j[2]),_.specularColorTexture!==void 0&&c.push(s.assignTexture(i,"specularColorMap",_.specularColorTexture,g.KI_)),Promise.all(c)}}class gm{constructor(e){this.parser=e,this.name=Us.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,s=i.json,o=s.textures[e];if(!o.extensions||!o.extensions[this.name])return null;const c=o.extensions[this.name],_=i.options.ktx2Loader;if(!_){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,c.source,_)}}class BS{constructor(e){this.parser=e,this.name=Us.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const i=this.name,s=this.parser,o=s.json,c=o.textures[e];if(!c.extensions||!c.extensions[i])return null;const _=c.extensions[i],j=o.images[_.source];let et=s.textureLoader;if(j.uri){const nt=s.options.manager.getHandler(j.uri);nt!==null&&(et=nt)}return this.detectSupport().then(function(nt){if(nt)return s.loadTextureImage(e,_.source,et);if(o.extensionsRequired&&o.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class LS{constructor(e){this.parser=e,this.name=Us.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const i=this.name,s=this.parser,o=s.json,c=o.textures[e];if(!c.extensions||!c.extensions[i])return null;const _=c.extensions[i],j=o.images[_.source];let et=s.textureLoader;if(j.uri){const nt=s.options.manager.getHandler(j.uri);nt!==null&&(et=nt)}return this.detectSupport().then(function(nt){if(nt)return s.loadTextureImage(e,_.source,et);if(o.extensionsRequired&&o.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class F0{constructor(e){this.name=Us.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,s=i.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const o=s.extensions[this.name],c=this.parser.getDependency("buffer",o.buffer),_=this.parser.options.meshoptDecoder;if(!_||!_.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return c.then(function(j){const et=o.byteOffset||0,nt=o.byteLength||0,st=o.count,at=o.byteStride,ct=new Uint8Array(j,et,nt);return _.decodeGltfBufferAsync?_.decodeGltfBufferAsync(st,at,ct,o.mode,o.filter).then(function(dt){return dt.buffer}):_.ready.then(function(){const dt=new ArrayBuffer(st*at);return _.decodeGltfBuffer(new Uint8Array(dt),st,at,ct,o.mode,o.filter),dt})})}return null}}class Vy{constructor(e){this.name=Us.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const i=this.parser.json,s=i.nodes[e];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const o=i.meshes[s.mesh];for(const et of o.primitives)if(et.mode!==lu.TRIANGLES&&et.mode!==lu.TRIANGLE_STRIP&&et.mode!==lu.TRIANGLE_FAN&&et.mode!==void 0)return null;const c=s.extensions[this.name].attributes,_=[],j={};for(const et in c)_.push(this.parser.getDependency("accessor",c[et]).then(nt=>(j[et]=nt,j[et])));return _.length<1?null:(_.push(this.parser.createNodeMesh(e)),Promise.all(_).then(et=>{const nt=et.pop(),st=nt.isGroup?nt.children:[nt],at=et[0].count,ct=[];for(const dt of st){const mt=new g.yGw,yt=new g.Pa4,wt=new g._fP,Ct=new g.Pa4(1,1,1),bt=new g.SPe(dt.geometry,dt.material,at);for(let At=0;At<at;At++)j.TRANSLATION&&yt.fromBufferAttribute(j.TRANSLATION,At),j.ROTATION&&wt.fromBufferAttribute(j.ROTATION,At),j.SCALE&&Ct.fromBufferAttribute(j.SCALE,At),bt.setMatrixAt(At,mt.compose(yt,wt,Ct));bt.sourceTrs=j;for(const At in j)At!=="TRANSLATION"&&At!=="ROTATION"&&At!=="SCALE"&&dt.geometry.setAttribute(At,j[At]);g.Tme.prototype.copy.call(bt,dt),this.parser.assignFinalMaterial(bt),ct.push(bt)}return nt.isGroup?(nt.clear(),nt.add(...ct),nt):ct[0]}))}}const yx="glTF";class j0{constructor(e){this.name=Us.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,12),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==yx)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const o=this.header.length-12,c=new DataView(e,12);let _=0;for(;_<o;){const j=c.getUint32(_,!0);_+=4;const et=c.getUint32(_,!0);if(_+=4,et===1313821514){const nt=new Uint8Array(e,12+_,j);this.content=s.decode(nt)}else if(et===5130562){const nt=12+_;this.body=e.slice(nt,nt+j)}_+=j}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class z0{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Us.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const s=this.json,o=this.dracoLoader,c=e.extensions[this.name].bufferView,_=e.extensions[this.name].attributes,j={},et={},nt={};for(const st in _){const at=_b[st]||st.toLowerCase();j[at]=_[st]}for(const st in e.attributes){const at=_b[st]||st.toLowerCase();if(_[st]!==void 0){const ct=s.accessors[e.attributes[st]],dt=r_[ct.componentType];nt[at]=dt.name,et[at]=ct.normalized===!0}}return i.getDependency("bufferView",c).then(function(st){return new Promise(function(at){o.decodeDracoFile(st,function(ct){for(const dt in ct.attributes){const mt=ct.attributes[dt],yt=et[dt];yt!==void 0&&(mt.normalized=yt)}at(ct)},j,nt)})})}}class Ax{constructor(){this.name=Us.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return(i.texCoord!==void 0&&i.texCoord!==e.channel||i.offset!==void 0||i.rotation!==void 0||i.scale!==void 0)&&(i.texCoord!==void 0&&(e.channel=i.texCoord),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class NS{constructor(){this.name=Us.KHR_MESH_QUANTIZATION}}class F1 extends g._C8{constructor(e,i,s,o){super(e,i,s,o)}copySampleValue_(e){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,c=e*o*3+o;for(let _=0;_!==o;_++)i[_]=s[c+_];return i}interpolate_(e,i,s,o){const c=this.resultBuffer,_=this.sampleValues,j=this.valueSize,et=2*j,nt=3*j,st=o-i,at=(s-i)/st,ct=at*at,dt=ct*at,mt=e*nt,yt=mt-nt,wt=-2*dt+3*ct,Ct=dt-ct,bt=1-wt,At=Ct-ct+at;for(let Pt=0;Pt!==j;Pt++){const Dt=_[yt+Pt+j],Nt=_[yt+Pt+et]*st,Vt=_[mt+Pt+j],Zt=_[mt+Pt]*st;c[Pt]=bt*Dt+At*Nt+wt*Vt+Ct*Zt}return c}}const US=new g._fP;class FS extends F1{interpolate_(e,i,s,o){const c=super.interpolate_(e,i,s,o);return US.fromArray(c).normalize().toArray(c),c}}const lu={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},r_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},JA={9728:g.TyD,9729:g.wem,9984:g.YLQ,9985:g.qyh,9986:g.aH4,9987:g.D1R},Rv={33071:g.uWy,33648:g.OoA,10497:g.rpg},ZA={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_b={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Yl={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Cl={CUBICSPLINE:void 0,LINEAR:g.NMF,STEP:g.Syv};function _h(h,e,i){for(const s in i.extensions)h[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=i.extensions[s])}function Om(h,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(h.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function j1(h,e){if(h.updateMorphTargets(),e.weights!==void 0)for(let i=0,s=e.weights.length;i<s;i++)h.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(h.morphTargetInfluences.length===i.length){h.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++)h.morphTargetDictionary[i[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function bx(h){const e=h.extensions&&h.extensions[Us.KHR_DRACO_MESH_COMPRESSION];let i;return i=e?"draco:"+e.bufferView+":"+e.indices+":"+jS(e.attributes):h.indices+":"+jS(h.attributes)+":"+h.mode,i}function jS(h){let e="";const i=Object.keys(h).sort();for(let s=0,o=i.length;s<o;s++)e+=i[s]+":"+h[i[s]]+";";return e}function Gy(h){switch(h){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const _m=new g.yGw;class Nn{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new mm,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,o=!1,c=-1;typeof navigator<"u"&&(s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,o=navigator.userAgent.indexOf("Firefox")>-1,c=o?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||s||o&&c<98?this.textureLoader=new g.dpR(this.options.manager):this.textureLoader=new g.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new g.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const s=this,o=this.json,c=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(_){return _._markDefs&&_._markDefs()}),Promise.all(this._invokeAll(function(_){return _.beforeRoot&&_.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(_){const j={scene:_[0][o.scene||0],scenes:_[0],animations:_[1],cameras:_[2],asset:o.asset,parser:s,userData:{}};_h(c,j,o),Om(j,o),Promise.all(s._invokeAll(function(et){return et.afterRoot&&et.afterRoot(j)})).then(function(){e(j)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],s=this.json.meshes||[];for(let o=0,c=i.length;o<c;o++){const _=i[o].joints;for(let j=0,et=_.length;j<et;j++)e[_[j]].isBone=!0}for(let o=0,c=e.length;o<c;o++){const _=e[o];_.mesh!==void 0&&(this._addNodeRef(this.meshCache,_.mesh),_.skin!==void 0&&(s[_.mesh].isSkinnedMesh=!0)),_.camera!==void 0&&this._addNodeRef(this.cameraCache,_.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,s){if(e.refs[i]<=1)return s;const o=s.clone(),c=(_,j)=>{const et=this.associations.get(_);et!=null&&this.associations.set(j,et);for(const[nt,st]of _.children.entries())c(st,j.children[nt])};return c(s,o),o.name+="_instance_"+e.uses[i]++,o}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let s=0;s<i.length;s++){const o=e(i[s]);if(o)return o}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const s=[];for(let o=0;o<i.length;o++){const c=e(i[o]);c&&s.push(c)}return s}getDependency(e,i){const s=e+":"+i;let o=this.cache.get(s);if(!o){switch(e){case"scene":o=this.loadScene(i);break;case"node":o=this._invokeOne(function(c){return c.loadNode&&c.loadNode(i)});break;case"mesh":o=this._invokeOne(function(c){return c.loadMesh&&c.loadMesh(i)});break;case"accessor":o=this.loadAccessor(i);break;case"bufferView":o=this._invokeOne(function(c){return c.loadBufferView&&c.loadBufferView(i)});break;case"buffer":o=this.loadBuffer(i);break;case"material":o=this._invokeOne(function(c){return c.loadMaterial&&c.loadMaterial(i)});break;case"texture":o=this._invokeOne(function(c){return c.loadTexture&&c.loadTexture(i)});break;case"skin":o=this.loadSkin(i);break;case"animation":o=this._invokeOne(function(c){return c.loadAnimation&&c.loadAnimation(i)});break;case"camera":o=this.loadCamera(i);break;default:if(o=this._invokeOne(function(c){return c!=this&&c.getDependency&&c.getDependency(e,i)}),!o)throw new Error("Unknown type: "+e)}this.cache.add(s,o)}return o}getDependencies(e){let i=this.cache.get(e);if(!i){const s=this,o=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(o.map(function(c,_){return s.getDependency(e,_)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],s=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[Us.KHR_BINARY_GLTF].body);const o=this.options;return new Promise(function(c,_){s.load(g.Zp0.resolveURL(i.uri,o.path),c,void 0,function(){_(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(s){const o=i.byteLength||0,c=i.byteOffset||0;return s.slice(c,c+o)})}loadAccessor(e){const i=this,s=this.json,o=this.json.accessors[e];if(o.bufferView===void 0&&o.sparse===void 0){const _=ZA[o.type],j=r_[o.componentType],et=o.normalized===!0,nt=new j(o.count*_);return Promise.resolve(new g.TlE(nt,_,et))}const c=[];return o.bufferView!==void 0?c.push(this.getDependency("bufferView",o.bufferView)):c.push(null),o.sparse!==void 0&&(c.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),c.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(c).then(function(_){const j=_[0],et=ZA[o.type],nt=r_[o.componentType],st=nt.BYTES_PER_ELEMENT,at=st*et,ct=o.byteOffset||0,dt=o.bufferView!==void 0?s.bufferViews[o.bufferView].byteStride:void 0,mt=o.normalized===!0;let yt,wt;if(dt&&dt!==at){const Ct=Math.floor(ct/dt),bt="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+Ct+":"+o.count;let At=i.cache.get(bt);At||(yt=new nt(j,Ct*dt,o.count*dt/st),At=new g.vpT(yt,dt/st),i.cache.add(bt,At)),wt=new g.kB5(At,et,ct%dt/st,mt)}else yt=j===null?new nt(o.count*et):new nt(j,ct,o.count*et),wt=new g.TlE(yt,et,mt);if(o.sparse!==void 0){const Ct=ZA.SCALAR,bt=r_[o.sparse.indices.componentType],At=o.sparse.indices.byteOffset||0,Pt=o.sparse.values.byteOffset||0,Dt=new bt(_[1],At,o.sparse.count*Ct),Nt=new nt(_[2],Pt,o.sparse.count*et);j!==null&&(wt=new g.TlE(wt.array.slice(),wt.itemSize,wt.normalized));for(let Vt=0,Zt=Dt.length;Vt<Zt;Vt++){const an=Dt[Vt];if(wt.setX(an,Nt[Vt*et]),et>=2&&wt.setY(an,Nt[Vt*et+1]),et>=3&&wt.setZ(an,Nt[Vt*et+2]),et>=4&&wt.setW(an,Nt[Vt*et+3]),et>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return wt})}loadTexture(e){const i=this.json,s=this.options,o=i.textures[e].source,c=i.images[o];let _=this.textureLoader;if(c.uri){const j=s.manager.getHandler(c.uri);j!==null&&(_=j)}return this.loadTextureImage(e,o,_)}loadTextureImage(e,i,s){const o=this,c=this.json,_=c.textures[e],j=c.images[i],et=(j.uri||j.bufferView)+":"+_.sampler;if(this.textureCache[et])return this.textureCache[et];const nt=this.loadImageSource(i,s).then(function(st){st.name=_.name||j.name||"",st.name===""&&typeof j.uri=="string"&&j.uri.startsWith("data:image/")===!1&&(st.name=j.uri);const at=(c.samplers||{})[_.sampler]||{};return st.magFilter=JA[at.magFilter]||g.wem,st.minFilter=JA[at.minFilter]||g.D1R,st.wrapS=Rv[at.wrapS]||g.rpg,st.wrapT=Rv[at.wrapT]||g.rpg,at.extras&&at.extras.uuid!==void 0&&(st.uuid=at.extras.uuid),o.associations.set(st,{textures:e}),st}).catch(function(){return null});return this.textureCache[et]=nt,nt}loadImageSource(e,i,s=!1,o=!1){const c=this,_=this.json,j=this.options;if(!o&&this.sourceCache[e]!==void 0)return this.sourceCache[e].then(mt=>mt.clone());const et=_.images[e],nt=self.URL||self.webkitURL;et.uri===void 0&&et.extras&&et.extras.uri&&(et.uri=et.extras.uri);let st=et.uri||"",at=!1,ct=null;if(et.bufferView===void 0||s&&st){if(et.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView")}else st=c.getDependency("bufferView",et.bufferView).then(function(mt){at=!0;const yt=new Blob([mt],{type:et.mimeType});return st=nt.createObjectURL(yt),ct=yt,st});const dt=Promise.resolve(st).then(function(mt){return new Promise(function(yt,wt){let Ct=yt;i.isImageBitmapLoader===!0&&(Ct=function(bt){const At=new g.xEZ(bt);At.needsUpdate=!0,yt(At)}),i.load(g.Zp0.resolveURL(mt,j.path),Ct,void 0,function(bt){i.isImageBitmapLoader===!0?(i=new g.dpR(c.options.manager),Ct=yt,i.setCrossOrigin(c.options.crossOrigin),i.setRequestHeader(c.options.requestHeader),i.load(g.Zp0.resolveURL(mt,j.path),Ct,void 0,wt)):wt(bt)})})}).then(function(mt){var yt;if(at===!0&&nt.revokeObjectURL(st),mt.userData.mimeType=et.mimeType||((yt=et.uri).search(/\.jpe?g($|\?)/i)>0||yt.search(/^data\:image\/jpeg/)===0?"image/jpeg":yt.search(/\.webp($|\?)/i)>0||yt.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),mt.flipY=!1,et.extras){if(et.extras.flipY!==void 0){if(i.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){let wt=mt;const Ct=et.extras.flipY&&!wt.flipY;createImageBitmap(wt.source.data,{imageOrientation:Ct?"flipY":"none"}).then(function(bt){wt._newTex&&(wt=wt._newTex),wt.source.data.close&&wt.source.data.close(),wt.source.data=bt,wt.source.needsUpdate=!0,wt.needsUpdate=!0})}mt.flipY=et.extras.flipY,mt.needsUpdate=!0,delete et.extras.flipY}et.extras.uuid!==void 0&&(mt.source.uuid=et.extras.uuid),et.extras.t_uuid!==void 0&&(mt.uuid=et.extras.t_uuid)}return et.uri&&typeof et.uri=="string"&&at===!1&&!et.uri.startsWith("/")&&(mt.userData.rootPath=g.Zp0.resolveURL(et.uri,j.path)),ct&&(mt.userData.__sourceBlob=ct),!s&&et.uri&&et.uri!==st&&c.loadImageSource(e,i,!0,!0).then(function(wt){mt.source.data&&mt.source.data.close&&mt.source.data.close(),mt.dispose(),mt.source=wt.source,mt.source.needsUpdate=!0,mt.needsUpdate=!0,mt.uuid=wt.uuid,mt.flipY=wt.flipY,mt.userData=wt.userData,mt.setDirty&&mt.setDirty(),wt._newTex=mt}),mt}).catch(function(mt){throw console.error("THREE.GLTFLoader: Couldn't load texture",st),mt});return this.sourceCache[e]=dt,dt}assignTexture(e,i,s,o){const c=this;return this.getDependency("texture",s.index).then(function(_){if(!_)return null;if(s.texCoord!==void 0&&s.texCoord>0&&((_=_.clone()).channel=s.texCoord),c.extensions[Us.KHR_TEXTURE_TRANSFORM]){const j=s.extensions!==void 0?s.extensions[Us.KHR_TEXTURE_TRANSFORM]:void 0;if(j){const et=c.associations.get(_);_=c.extensions[Us.KHR_TEXTURE_TRANSFORM].extendTexture(_,j),c.associations.set(_,et)}}return o!==void 0&&(_.colorSpace=o),e[i]=_,_})}assignFinalMaterial(e){const i=e.geometry;let s=e.material;const o=i.attributes.tangent===void 0,c=i.attributes.color!==void 0,_=i.attributes.normal===void 0;if(e.isPoints){const j="PointsMaterial:"+s.uuid;let et=this.cache.get(j);et||(et=new g.UY4,g.F5T.prototype.copy.call(et,s),et.color.copy(s.color),et.map=s.map,et.sizeAttenuation=!1,this.cache.add(j,et)),s=et}else if(e.isLine){const j="LineBasicMaterial:"+s.uuid;let et=this.cache.get(j);et||(et=new g.nls,g.F5T.prototype.copy.call(et,s),et.color.copy(s.color),et.map=s.map,this.cache.add(j,et)),s=et}if(o||c||_){let j="ClonedMaterial:"+s.uuid+":";o&&(j+="derivative-tangents:"),c&&(j+="vertex-colors:"),_&&(j+="flat-shading:");let et=this.cache.get(j);et||(et=s.clone(),c&&(et.vertexColors=!0),_&&(et.flatShading=!0),o&&(et.normalScale&&(et.normalScale.y*=-1),et.clearcoatNormalScale&&(et.clearcoatNormalScale.y*=-1)),this.cache.add(j,et),this.associations.set(et,this.associations.get(s))),s=et}e.material=s}getMaterialType(){return g.Wid}loadMaterial(e){const i=this,s=this.json,o=this.extensions,c=s.materials[e];let _;const j={},et=[];if((c.extensions||{})[Us.KHR_MATERIALS_UNLIT]){const st=o[Us.KHR_MATERIALS_UNLIT];_=st.getMaterialType(),et.push(st.extendParams(j,c,i))}else{const st=c.pbrMetallicRoughness||{};if(j.color=new g.Ilk(1,1,1),j.opacity=1,Array.isArray(st.baseColorFactor)){const at=st.baseColorFactor;j.color.fromArray(at),j.opacity=at[3]}st.baseColorTexture!==void 0&&et.push(i.assignTexture(j,"map",st.baseColorTexture,g.KI_)),j.metalness=st.metallicFactor!==void 0?st.metallicFactor:1,j.roughness=st.roughnessFactor!==void 0?st.roughnessFactor:1,st.metallicRoughnessTexture!==void 0&&(et.push(i.assignTexture(j,"metalnessMap",st.metallicRoughnessTexture)),et.push(i.assignTexture(j,"roughnessMap",st.metallicRoughnessTexture))),_=this._invokeOne(function(at){return at.getMaterialType&&at.getMaterialType(e)}),et.push(Promise.all(this._invokeAll(function(at){return at.extendMaterialParams&&at.extendMaterialParams(e,j)})))}c.doubleSided===!0&&(j.side=g.ehD);const nt=c.alphaMode||"OPAQUE";if(nt==="BLEND"?(j.transparent=!0,j.depthWrite=!1):(j.transparent=!1,nt==="MASK"&&(j.alphaTest=c.alphaCutoff!==void 0?c.alphaCutoff:.5)),c.normalTexture!==void 0&&_!==g.vBJ&&(et.push(i.assignTexture(j,"normalMap",c.normalTexture)),j.normalScale=new g.FM8(1,1),c.normalTexture.scale!==void 0)){const st=c.normalTexture.scale;j.normalScale.set(st,st)}return c.occlusionTexture!==void 0&&_!==g.vBJ&&(et.push(i.assignTexture(j,"aoMap",c.occlusionTexture)),c.occlusionTexture.strength!==void 0&&(j.aoMapIntensity=c.occlusionTexture.strength)),c.emissiveFactor!==void 0&&_!==g.vBJ&&(j.emissive=new g.Ilk().fromArray(c.emissiveFactor)),c.emissiveTexture!==void 0&&_!==g.vBJ&&et.push(i.assignTexture(j,"emissiveMap",c.emissiveTexture,g.KI_)),Promise.all(et).then(function(){const st=new _(j);return c.name&&(st.name=c.name),Om(st,c),i.associations.set(st,{materials:e}),c.extensions&&_h(o,st,c),st})}createUniqueName(e){const i=g.iUV.sanitizeNodeName(e||"");let s=i;for(let o=1;this.nodeNamesUsed[s];++o)s=i+"_"+o;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const i=this,s=this.extensions,o=this.primitiveCache;function c(j){return s[Us.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(j,i).then(function(et){return wx(et,j,i)})}const _=[];for(let j=0,et=e.length;j<et;j++){const nt=e[j],st=bx(nt),at=o[st];if(at)_.push(at.promise);else{let ct;ct=nt.extensions&&nt.extensions[Us.KHR_DRACO_MESH_COMPRESSION]?c(nt):wx(new g.u9r,nt,i),o[st]={primitive:nt,promise:ct},_.push(ct)}}return Promise.all(_)}loadMesh(e){const i=this,s=this.json,o=this.extensions,c=s.meshes[e],_=c.primitives,j=[];for(let nt=0,st=_.length;nt<st;nt++){const at=_[nt].material===void 0?((et=this.cache).DefaultMaterial===void 0&&(et.DefaultMaterial=new g.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:g.Wl3})),et.DefaultMaterial):this.getDependency("material",_[nt].material);j.push(at)}var et;return j.push(i.loadGeometries(_)),Promise.all(j).then(function(nt){const st=nt.slice(0,nt.length-1),at=nt[nt.length-1],ct=[];for(let mt=0,yt=at.length;mt<yt;mt++){const wt=at[mt],Ct=_[mt];let bt;const At=st[mt];if(Ct.mode===lu.TRIANGLES||Ct.mode===lu.TRIANGLE_STRIP||Ct.mode===lu.TRIANGLE_FAN||Ct.mode===void 0)bt=c.isSkinnedMesh===!0?new g.TUv(wt,At):new g.Kj0(wt,At),bt.isSkinnedMesh===!0&&bt.normalizeSkinWeights(),Ct.mode===lu.TRIANGLE_STRIP?bt.geometry=yn(bt.geometry,g.UlW):Ct.mode===lu.TRIANGLE_FAN&&(bt.geometry=yn(bt.geometry,g.z$h));else if(Ct.mode===lu.LINES)bt=new g.ejS(wt,At);else if(Ct.mode===lu.LINE_STRIP)bt=new g.x12(wt,At);else if(Ct.mode===lu.LINE_LOOP)bt=new g.blk(wt,At);else{if(Ct.mode!==lu.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+Ct.mode);bt=new g.woe(wt,At)}Object.keys(bt.geometry.morphAttributes).length>0&&j1(bt,c),bt.name=i.createUniqueName(c.name||"mesh_"+e),bt.geometry&&c.extras&&c.extras.isGeometryUserData?(Om(bt.geometry,c),Ct.extensions&&_h(o,bt.geometry,Ct)):(Om(bt,c),Ct.extensions&&_h(o,bt,Ct)),i.assignFinalMaterial(bt),ct.push(bt)}c.extensions&&ct.forEach(mt=>_h(o,mt,c));for(let mt=0,yt=ct.length;mt<yt;mt++)i.associations.set(ct[mt],{meshes:e,primitives:mt});if(ct.length===1)return ct[0];const dt=new g.ZAu;i.associations.set(dt,{meshes:e});for(let mt=0,yt=ct.length;mt<yt;mt++)dt.add(ct[mt]);return dt})}loadCamera(e){let i;const s=this.json.cameras[e],o=s[s.type];if(o)return s.type==="perspective"?i=new g.cPb(g.M8C.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):s.type==="orthographic"&&(i=new g.iKG(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),s.name&&(i.name=this.createUniqueName(s.name)),Om(i,s),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const i=this.json.skins[e],s=[];for(let o=0,c=i.joints.length;o<c;o++)s.push(this._loadNodeShallow(i.joints[o]));return i.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",i.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(o){const c=o.pop(),_=o,j=[],et=[];for(let nt=0,st=_.length;nt<st;nt++){const at=_[nt];if(at){j.push(at);const ct=new g.yGw;c!==null&&ct.fromArray(c.array,16*nt),et.push(ct)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[nt])}return new g.OdW(j,et)})}loadAnimation(e){const i=this.json.animations[e],s=i.name?i.name:"animation_"+e,o=[],c=[],_=[],j=[],et=[];for(let nt=0,st=i.channels.length;nt<st;nt++){const at=i.channels[nt],ct=i.samplers[at.sampler],dt=at.target,mt=dt.node,yt=i.parameters!==void 0?i.parameters[ct.input]:ct.input,wt=i.parameters!==void 0?i.parameters[ct.output]:ct.output;dt.node!==void 0&&(o.push(this.getDependency("node",mt)),c.push(this.getDependency("accessor",yt)),_.push(this.getDependency("accessor",wt)),j.push(ct),et.push(dt))}return Promise.all([Promise.all(o),Promise.all(c),Promise.all(_),Promise.all(j),Promise.all(et)]).then(function(nt){const st=nt[0],at=nt[1],ct=nt[2],dt=nt[3],mt=nt[4],yt=[];for(let wt=0,Ct=st.length;wt<Ct;wt++){const bt=st[wt],At=at[wt],Pt=ct[wt],Dt=dt[wt],Nt=mt[wt];if(bt===void 0)continue;let Vt;switch(bt.updateMatrix(),Yl[Nt.path]){case Yl.weights:Vt=g.dUE;break;case Yl.rotation:Vt=g.iLg;break;default:Vt=g.yC1}const Zt=bt.name?bt.name:bt.uuid,an=Dt.interpolation!==void 0?Cl[Dt.interpolation]:g.NMF,fn=[];Yl[Nt.path]===Yl.weights?bt.traverse(function(Sn){Sn.morphTargetInfluences&&fn.push(Sn.name?Sn.name:Sn.uuid)}):fn.push(Zt);let mn=Pt.array;if(Pt.normalized){const Sn=Gy(mn.constructor),An=new Float32Array(mn.length);for(let wn=0,Mn=mn.length;wn<Mn;wn++)An[wn]=mn[wn]*Sn;mn=An}for(let Sn=0,An=fn.length;Sn<An;Sn++){const wn=new Vt(fn[Sn]+"."+Yl[Nt.path],At.array,mn,an);Dt.interpolation==="CUBICSPLINE"&&(wn.createInterpolant=function(Mn){return new(this instanceof g.iLg?FS:F1)(this.times,this.values,this.getValueSize()/3,Mn)},wn.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),yt.push(wn)}}return new g.m7l(s,void 0,yt)})}createNodeMesh(e){const i=this.json,s=this,o=i.nodes[e];return o.mesh===void 0?null:s.getDependency("mesh",o.mesh).then(function(c){const _=s._getNodeRef(s.meshCache,o.mesh,c);return o.weights!==void 0&&_.traverse(function(j){if(j.isMesh)for(let et=0,nt=o.weights.length;et<nt;et++)j.morphTargetInfluences[et]=o.weights[et]}),_})}loadNode(e){const i=this,s=this.json.nodes[e],o=i._loadNodeShallow(e),c=[],_=s.children||[];for(let et=0,nt=_.length;et<nt;et++)c.push(i.getDependency("node",_[et]));const j=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([o,Promise.all(c),j]).then(function(et){const nt=et[0],st=et[1],at=et[2];at!==null&&nt.traverse(function(ct){ct.isSkinnedMesh&&ct.bind(at,_m)});for(let ct=0,dt=st.length;ct<dt;ct++)nt.add(st[ct]);return nt})}_loadNodeShallow(e){const i=this.json,s=this.extensions,o=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const c=i.nodes[e],_=c.name?o.createUniqueName(c.name):"",j=[],et=o._invokeOne(function(nt){return nt.createNodeMesh&&nt.createNodeMesh(e)});return et&&j.push(et),c.camera!==void 0&&j.push(o.getDependency("camera",c.camera).then(function(nt){return o._getNodeRef(o.cameraCache,c.camera,nt)})),o._invokeAll(function(nt){return nt.createNodeAttachment&&nt.createNodeAttachment(e)}).forEach(function(nt){j.push(nt)}),this.nodeCache[e]=Promise.all(j).then(function(nt){let st;if(st=c.isBone===!0?new g.N$j:nt.length>1?new g.ZAu:nt.length===1?nt[0]:new g.Tme,st!==nt[0])for(let at=0,ct=nt.length;at<ct;at++)st.add(nt[at]);if(c.name&&(st.userData.name=c.name,st.name=_),Om(st,c),c.extensions&&_h(s,st,c),c.matrix!==void 0){const at=new g.yGw;at.fromArray(c.matrix),st.applyMatrix4(at)}else c.translation!==void 0&&st.position.fromArray(c.translation),c.rotation!==void 0&&st.quaternion.fromArray(c.rotation),c.scale!==void 0&&st.scale.fromArray(c.scale);return o.associations.has(st)||o.associations.set(st,{}),o.associations.get(st).nodes=e,st}),this.nodeCache[e]}loadScene(e){const i=this.extensions,s=this.json.scenes[e],o=this,c=new g.ZAu;s.name&&(c.name=o.createUniqueName(s.name)),Om(c,s),s.extensions&&_h(i,c,s);const _=s.nodes||[],j=[];for(let et=0,nt=_.length;et<nt;et++)j.push(o.getDependency("node",_[et]));return Promise.all(j).then(function(et){for(let nt=0,st=et.length;nt<st;nt++)c.add(et[nt]);return o.associations=(nt=>{const st=new Map;for(const[at,ct]of o.associations)(at instanceof g.F5T||at instanceof g.xEZ)&&st.set(at,ct);return nt.traverse(at=>{const ct=o.associations.get(at);ct!=null&&st.set(at,ct)}),st})(c),c})}}function wx(h,e,i){const s=e.attributes,o=[];function c(_,j){return i.getDependency("accessor",_).then(function(et){h.setAttribute(j,et)})}for(const _ in s){const j=_b[_]||_.toLowerCase();j in h.attributes||o.push(c(s[_],j))}if(e.indices!==void 0&&!h.index){const _=i.getDependency("accessor",e.indices).then(function(j){h.setIndex(j)});o.push(_)}return Om(h,e),function(_,j,et){const nt=j.attributes,st=new g.ZzF;if(nt.POSITION===void 0)return;{const dt=et.json.accessors[nt.POSITION],mt=dt.min,yt=dt.max;if(mt===void 0||yt===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(st.set(new g.Pa4(mt[0],mt[1],mt[2]),new g.Pa4(yt[0],yt[1],yt[2])),dt.normalized){const wt=Gy(r_[dt.componentType]);st.min.multiplyScalar(wt),st.max.multiplyScalar(wt)}}const at=j.targets;if(at!==void 0){const dt=new g.Pa4,mt=new g.Pa4;for(let yt=0,wt=at.length;yt<wt;yt++){const Ct=at[yt];if(Ct.POSITION!==void 0){const bt=et.json.accessors[Ct.POSITION],At=bt.min,Pt=bt.max;if(At!==void 0&&Pt!==void 0){if(mt.setX(Math.max(Math.abs(At[0]),Math.abs(Pt[0]))),mt.setY(Math.max(Math.abs(At[1]),Math.abs(Pt[1]))),mt.setZ(Math.max(Math.abs(At[2]),Math.abs(Pt[2]))),bt.normalized){const Dt=Gy(r_[bt.componentType]);mt.multiplyScalar(Dt)}dt.max(mt)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}st.expandByVector(dt)}_.boundingBox=st;const ct=new g.aLr;st.getCenter(ct.center),ct.radius=st.min.distanceTo(st.max)/2,_.boundingSphere=ct}(h,e,i),Promise.all(o).then(function(){return e.targets!==void 0?function(_,j,et){let nt=!1,st=!1,at=!1;for(let yt=0,wt=j.length;yt<wt;yt++){const Ct=j[yt];if(Ct.POSITION!==void 0&&(nt=!0),Ct.NORMAL!==void 0&&(st=!0),Ct.COLOR_0!==void 0&&(at=!0),nt&&st&&at)break}if(!nt&&!st&&!at)return Promise.resolve(_);const ct=[],dt=[],mt=[];for(let yt=0,wt=j.length;yt<wt;yt++){const Ct=j[yt];if(nt){const bt=Ct.POSITION!==void 0?et.getDependency("accessor",Ct.POSITION):_.attributes.position;ct.push(bt)}if(st){const bt=Ct.NORMAL!==void 0?et.getDependency("accessor",Ct.NORMAL):_.attributes.normal;dt.push(bt)}if(at){const bt=Ct.COLOR_0!==void 0?et.getDependency("accessor",Ct.COLOR_0):_.attributes.color;mt.push(bt)}}return Promise.all([Promise.all(ct),Promise.all(dt),Promise.all(mt)]).then(function(yt){const wt=yt[0],Ct=yt[1],bt=yt[2];return nt&&(_.morphAttributes.position=wt),st&&(_.morphAttributes.normal=Ct),at&&(_.morphAttributes.color=bt),_.morphTargetsRelative=!0,_})}(h,e.targets,i):h})}class xx extends n_{constructor(e){super(e),this.isGLTFLoader2=!0,this.preparsers=[],this.preparsers.push(E_)}async preparse(e,i){for(const s of this.preparsers)e=await s.process(e,i);return e}parse(e,i,s,o,c){this.preparse.call(this,e,c||i).then(_=>_?super.parse(_,i,s,o):o&&o(new ErrorEvent("no data"))).catch(_=>{console.error(_),o&&o(_??new ErrorEvent("unknown error"))})}transform(e,i){const s=e?e.scene||(e.scenes&&e.scenes.length>0?e.scenes[0]:void 0):void 0;return s&&e.animations.length>0&&(s.animations=e.animations),s==null||s.traverse(o=>{o.userData.gltfUUID&&(o.uuid=o.userData.gltfUUID,delete o.userData.gltfUUID)}),s}register(e){return super.register(e)}}const E_={key:(h,e,i)=>h.key||window&&window.prompt&&window.prompt("GLTFEncryption: Please enter the password/key for the model: "+i)||"",async process(h,e){var et;if(typeof h=="string"||!new TextDecoder().decode(new Uint8Array(h,0,100)).includes("WebGiGLBWrapper"))return h;const i=new j0(h),s=JSON.parse(i.content||"{}");let o=i.body||h;const c=(et=s.asset)==null?void 0:et.encryption;if(!c)return o;const _=c.type,j=c.version;if(_==="aesgcm"&&j===1){const nt=await(0,b.getOrCall)(this.key,c,s,e)||"";try{o=(await(0,b.aesGcmDecrypt)(new Uint8Array(o),nt)).buffer}catch{throw new ErrorEvent("decryption error")}}return o}};class q_ extends g.hH6{constructor(e){super(e),this.type=g.cLu}async loadAsync(e,i){const s=await this.parseAsync(e,i,!1),o=new g.IEO(s.data,s.width,s.height,g.wk1,this.type);return o.needsUpdate=!0,o.flipY=!0,o.colorSpace=g.KI_,o.minFilter=g.wem,o.magFilter=g.wem,o.source.data.complete=!0,o}async parseAsync(e,i,s=!1){let o=!1;if(!e.startsWith("data:")&&!e.startsWith("blob:")){this.responseType="blob";const et=await super.loadAsync(e,i);e=URL.createObjectURL(et),o=!0}const c=await(0,b.imageUrlToImageData)(e);o&&URL.revokeObjectURL(e);let _=Uint8Array;return this.type===g.cLu?_=Uint16Array:this.type===g.VzW&&(_=Uint32Array),{data:function(et,nt=3,st=Uint16Array,at=!1){let ct;const dt=et.byteLength>>2,mt=new st(dt*nt);for(let yt=0;yt<dt;yt++)ct=Math.pow(2,et[4*yt+3]-136),at?(mt[yt*nt]=Math.min(et[4*yt]*ct,65504),mt[yt*nt+1]=Math.min(et[4*yt+1]*ct,65504),mt[yt*nt+2]=Math.min(et[4*yt+2]*ct,65504)):(mt[yt*nt]=g.A5E.toHalfFloat(Math.min(et[4*yt]*ct,65504)),mt[yt*nt+1]=g.A5E.toHalfFloat(Math.min(et[4*yt+1]*ct,65504)),mt[yt*nt+2]=g.A5E.toHalfFloat(Math.min(et[4*yt+2]*ct,65504))),nt===4&&(mt[yt*nt+3]=g.A5E.toHalfFloat(1));return mt}(c.data,4,_,s),width:c.width,height:c.height}}setDataType(e){return this.type=e,this}}class Np extends g.Gql{constructor(e){super(e),this._imageLoader=new g.S3k(e)}static async LoadRootPathTextures(e,i,s,o=!0){var _;const c=[];for(const j of Array.isArray(e)?e:Object.values(e??{})){const et=(_=j==null?void 0:j.userData)==null?void 0:_.rootPath,nt=o&&j.image&&i[j.image];if(!et)continue;const st=s.importPath(et,{processImported:!1}).then(at=>{const ct=at==null?void 0:at[0],dt=ct==null?void 0:ct.source;if(!ct||!dt)return null;const mt=new g.Hw6(dt.data);return j.image&&(mt.uuid=j.image),j.image=mt.uuid,nt||(i[mt.uuid]=mt),ct.dispose(),mt}).catch(at=>(console.error(at),delete j.userData.rootPath,null));nt?j.rootPathPromise=st:c.push(st)}await Promise.allSettled(c)}parseTextures2(e,i,s){var _,j;for(const et of e){const nt=(_=et==null?void 0:et.userData)==null?void 0:_.rootPath;if(nt&&(!et.image||!i[et.image])){const st=new g.Hw6(this._imageLoader.load(nt,s));if(!st)continue;et.image&&(st.uuid=et.image),i[st.uuid]=st,et.image=st.uuid}et.userData=ao(et.userData,void 0,!1,{images:i})}const o=super.parseTextures(e,i),c={...o};for(const et of e)(j=et.rootPathPromise)==null||j.then(nt=>{if(!nt)return;const st=c[et.uuid];st.dispose(),st.source=nt,st.source.needsUpdate=!0,st.needsUpdate=!0});return o}parseMaterials2(e,i,s){const o={};return e.forEach(c=>{if(!c)return;const _={...c},j=Object.keys(_);for(const nt of j)if(nt==="map"||nt.endsWith("Map")){const st=_[nt];typeof st=="string"&&(i[st]?_[nt]=i[st]:(console.warn(`Texture ${st} not found`),delete _[nt]))}_.userData&&(_.userData=ao(_.userData,void 0,!1,{textures:i}),_.userData.cloneId&&_.userData.uuid!==c.uuid&&(_.userData.uuid=c.uuid));const et=s.generateFromTemplateType(_.type,_);et&&(o[c.uuid]=et)}),o}}const Ru="WEBGI_viewer";function V0(h){return new eu(xx,["gltf","glb","data:model/gltf"],!0,(e,i)=>{if(!e)return e;const s=e,o=new Np(i.loadingManager);return s.register(Dv(o,h)),s.register(o0()),s.register(ew(o)),s.register(c=>new tw(c)),s.register(c=>new z1(c)),s.register(c=>new s_(c)),s.register(c=>new kv(c)),s.register(c=>{var ct,dt,mt,yt,wt,Ct,bt,At,Pt;const _=c.getDependency;c.getDependency=async(Dt,Nt)=>{const Vt=await _.call(c,Dt,Nt);if(Vt.userData){const Zt=Vt.userData.gltfExtensions;delete Vt.userData.gltfExtensions,Vt.userData=ao(Vt.userData,{},!1,{}),Vt.userData.gltfExtensions=Zt}return Vt};const j=Bp()+".drc",et=Bp()+".ktx2",nt=(mt=(dt=(ct=c.json)==null?void 0:ct.extensionsRequired)==null?void 0:dt.includes)==null?void 0:mt.call(dt,"KHR_draco_mesh_compression");if(nt){const Dt=i.registerFile(j);Dt&&s.setDRACOLoader(Dt)}((Ct=(wt=(yt=c.json)==null?void 0:yt.extensionsUsed)==null?void 0:wt.includes)==null?void 0:Ct.call(wt,"EXT_meshopt_compression"))&&(window.MeshoptDecoder?(s.setMeshoptDecoder(window.MeshoptDecoder),c.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const at=(Pt=(At=(bt=c.json)==null?void 0:bt.extensionsUsed)==null?void 0:At.includes)==null?void 0:Pt.call(At,"KHR_texture_basisu");if(at){const Dt=i.registerFile(et);Dt&&(s.setKTX2Loader(Dt),c.options.ktx2Loader=Dt)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async Dt=>{nt&&i.unregisterFile(j),at&&i.unregisterFile(et);const Nt=await G0(c,h,o);Dt.scene&&(Dt.scene.__importedViewerConfig=Nt)}}}),s})}const i_="WEBGI_light_extras",xp="WEBGI_object3d_extras",ap="WEBGI_material_extras",o0=h=>e=>({name:"__"+xp,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(o=>{var j,et;if(!o.isObject3D)return;const c=(et=(j=o.userData)==null?void 0:j.gltfExtensions)==null?void 0:et[xp];if(!c)return void(o.isLight&&!o.isAmbientLight&&(o.castShadow=!0));const _=c.castShadow!==void 0||c.receiveShadow!==void 0;c.castShadow!==void 0&&(o.castShadow=c.castShadow),c.receiveShadow!==void 0&&(o.receiveShadow=c.receiveShadow),c.visible!==void 0&&(o.visible=c.visible),c.frustumCulled!==void 0&&(o.frustumCulled=c.frustumCulled),c.renderOrder!==void 0&&(o.renderOrder=c.renderOrder),c.layers!==void 0&&(o.layers.mask=c.layers),_&&(o.userData.__keepShadowDef=!0),delete o.userData.gltfExtensions[xp]})})}}),Dv=(h,e)=>i=>({name:"__"+ap,afterRoot:async s=>{var c,_,j;const o=s.scenes||(s.scene?[s.scene]:[]);for(const et of o){const nt=(_=(c=et.userData)==null?void 0:c.gltfExtensions)==null?void 0:_[ap],st=nt&&await((j=e.getPlugin(Fr))==null?void 0:j.importConfigResources(nt.resources||{}))||{};et.traverse(at=>{var mt,yt;const ct=at==null?void 0:at.material;if(!(ct!=null&&ct.isMaterial))return;const dt=(yt=(mt=ct.userData)==null?void 0:mt.gltfExtensions)==null?void 0:yt[ap];dt&&(dt.emissiveIntensity!==void 0&&(ct.emissiveIntensity=dt.emissiveIntensity),dt.fog!==void 0&&(ct.fog=dt.fog),dt.flatShading!==void 0&&(ct.flatShading=dt.flatShading),dt.blending!==void 0&&(ct.blending=dt.blending),dt.side!==void 0&&(ct.side=dt.side),dt.shadowSide!==void 0&&(ct.shadowSide=dt.shadowSide),dt.depthFunc!==void 0&&(ct.depthFunc=dt.depthFunc),dt.depthTest!==void 0&&(ct.depthTest=dt.depthTest),dt.depthWrite!==void 0&&(ct.depthWrite=dt.depthWrite),dt.colorWrite!==void 0&&(ct.colorWrite=dt.colorWrite),dt.vertexColors!==void 0&&(ct.vertexColors=dt.vertexColors),dt.alphaTest!==void 0&&(ct.alphaTest=dt.alphaTest),dt.wireframe!==void 0&&(ct.wireframe=dt.wireframe),dt.wireframeLinewidth!==void 0&&(ct.wireframeLinewidth=dt.wireframeLinewidth),dt.wireframeLinecap!==void 0&&(ct.wireframeLinecap=dt.wireframeLinecap),dt.wireframeLinejoin!==void 0&&(ct.wireframeLinejoin=dt.wireframeLinejoin),dt.rotation!==void 0&&(ct.rotation=dt.rotation),dt.polygonOffset!==void 0&&(ct.polygonOffset=dt.polygonOffset),dt.polygonOffsetFactor!==void 0&&(ct.polygonOffsetFactor=dt.polygonOffsetFactor),dt.polygonOffsetUnits!==void 0&&(ct.polygonOffsetUnits=dt.polygonOffsetUnits),dt.dithering!==void 0&&(ct.dithering=dt.dithering),dt.alphaToCoverage!==void 0&&(ct.alphaToCoverage=dt.alphaToCoverage),dt.premultipliedAlpha!==void 0&&(ct.premultipliedAlpha=dt.premultipliedAlpha),dt.toneMapped!==void 0&&(ct.toneMapped=dt.toneMapped),dt.normalScale!==void 0&&ct.normalScale!==void 0&&(Array.isArray(dt.normalScale)?ct.normalScale.fromArray(dt.normalScale):typeof dt.normalScale=="number"?ct.normalScale.set(dt.normalScale,dt.normalScale):e.console.warn("normalScale is not an array or number",dt.normalScale)),dt.reflectivity!==void 0&&(ct.reflectivity=dt.reflectivity),Object.entries(dt).forEach(([wt,Ct])=>{wt.startsWith("_")||Ct&&Ct.resource&&typeof Ct.resource=="string"&&(ct[wt]=ao(Ct,ct[wt],!1,st))}),delete ct.userData.gltfExtensions[ap])}),nt&&delete et.userData.gltfExtensions[ap]}}}),ew=h=>e=>({name:"__"+i_,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(o=>{var _,j;if(!o.isLight)return;const c=(j=(_=o.userData)==null?void 0:_.gltfExtensions)==null?void 0:j[i_];c&&(!o.shadow&&c.shadow&&console.error("Light has no shadow, cannot import",o,c),c.shadow&&o.shadow&&(c.shadow.bias!==void 0&&(o.shadow.bias=c.shadow.bias),c.shadow.normalBias!==void 0&&(o.shadow.normalBias=c.shadow.normalBias),c.shadow.radius!==void 0&&(o.shadow.radius=c.shadow.radius),c.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(c.shadow.mapSize),c.shadow.camera!==void 0&&(o.shadow.camera=h.parseObject(c.shadow.camera))),delete o.userData.gltfExtensions[i_])})})}});async function G0(h,e,i,s){var et,nt,st;if(!s){const at=h.json.scenes||[];if(at.length!==1){for(const ct of at)await G0(h,e,i,ct);return}s=at[0]}const o=(et=s.extensions)==null?void 0:et[Ru];if(!o)return;const c=[];Object.values(o.resources).forEach(at=>{Object.values(at).forEach(ct=>{ct.url&&(ct.url.type==="Uint16Array"&&ct.url.data&&c.push(ct.url),ct.url.type==="Uint8Array"&&ct.url.data&&c.push(ct.url))})});for(const at of c){const ct=at.data.image,dt=h.json.images[ct],mt=await h.getDependency("bufferView",dt.bufferView);if(dt.mimeType.startsWith("image/")&&at.type==="Uint16Array"&&at.encoding==="rgbe"){const yt=new Blob([mt]);let wt=URL.createObjectURL(yt);(at.encodingVersion||1)<2&&(wt="data:image/png;base64,"+btoa(await yt.text())),at.data=(await new q_().parseAsync(wt,void 0,!0)).data,URL.revokeObjectURL(wt),delete at.encoding,delete at.encodingVersion}else at.data=mt}const _={textures:{},materials:{}},j=o.resources;if(j.textures&&h.json.textures)for(const[at,ct]of[...Object.entries(j.textures)]){if(ct.uuid||!at)continue;delete j.textures[at];const dt=h.json.textures.findIndex(mt=>{var yt,wt,Ct,bt,At,Pt,Dt;return((yt=mt.extras)==null?void 0:yt.uuid)===at||((bt=(Ct=(wt=h.json.samplers)==null?void 0:wt[mt.sampler])==null?void 0:Ct.extras)==null?void 0:bt.uuid)===at||((Dt=(Pt=(At=h.json.images)==null?void 0:At[mt.source])==null?void 0:Pt.extras)==null?void 0:Dt.t_uuid)===at});dt>=0&&(_.textures[at]=await h.getDependency("texture",dt))}if(j.materials&&h.json.materials)for(const[at,ct]of[...Object.entries(j.materials)]){if(ct.uuid||!at)continue;delete j.materials[at];const dt=h.json.materials.findIndex(mt=>{var yt;return((yt=mt.extras)==null?void 0:yt.uuid)===at});dt>=0&&(_.materials[at]=await h.getDependency("material",dt),_.materials[at]=(st=(nt=e.getPlugin(Fr))==null?void 0:nt.materials)==null?void 0:st.processMaterial(_.materials[at],{}))}return o.resources=await e.getPlugin(Fr).importConfigResources(j||{},i,_),o}const H0="WEBGI_materials_bumpmap",X_="WEBGI_materials_displacementmap",a0="WEBGI_materials_alphamap",Ex="WEBGI_materials_lightmap";class tw{constructor(e){this.parser=e,this.name=H0}async extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],_=o.extensions[this.name];return _.bumpScale!==void 0&&(i.bumpScale=_.bumpScale),_.bumpTexture!==void 0&&c.push(s.assignTexture(i,"bumpMap",_.bumpTexture)),Promise.all(c)}}class z1{constructor(e){this.parser=e,this.name=X_}async extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],_=o.extensions[this.name];return _.displacementScale!==void 0&&(i.displacementScale=_.displacementScale),_.displacementBias!==void 0&&(i.displacementBias=_.displacementBias),_.displacementTexture!==void 0&&c.push(s.assignTexture(i,"displacementMap",_.displacementTexture)),Promise.all(c)}}class s_{constructor(e){this.parser=e,this.name=Ex}async extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],_=o.extensions[this.name];return _.lightMapIntensity!==void 0&&(i.lightMapIntensity=_.lightMapIntensity),_.lightMapTexture!==void 0&&c.push(s.assignTexture(i,"lightMap",_.lightMapTexture)),Promise.all(c)}}class kv{constructor(e){this.parser=e,this.name=a0}async extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],_=o.extensions[this.name];return _.alphaTexture!==void 0&&c.push(s.assignTexture(i,"alphaMap",_.alphaTexture)),Promise.all(c)}}var Sx=__webpackgi_require__(23);function Q0(){return new eu(Sx.Q,["drc"],!0)}class S_ extends g.Ox3{get lightObject(){return this}get modelObject(){return this}constructor(e,i){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new g.Ilk(e),this.intensity=i||1,this.target.position.set(0,0,-1),this.add(this.target)}copy(e,i){const s=this.target,o=e.userData;return e.userData={},super.copy(e,i),_l(this.userData,o),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)==null||e.dispose(),(i=this.shadow.mapPass)==null||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const o=super.toJSON(e);return o.userData=Ls(_l({},i),!1),this.userData={},this.children=s,o.type="DirectionalLight2",o.target=this.target.position.toArray(),Object.assign(o,Ls(this,!0,e))}fromJSON(e,i){if(e.type!=="DirectionalLight2")return null;const s=e.target,o=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,ao(e,this,!0,i),s&&(e.target=s),o&&(o.color!==void 0&&this.color.set(o.color),o.intensity!==void 0&&(this.intensity=o.intensity),e.object=o),this}}class nw extends g.PMe{get lightObject(){return this}get modelObject(){return this}constructor(e,i,s,o,c,_){super(e,i,s,o,c,_),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}copy(e,i){const s=this.target,o=e.userData;return e.userData={},super.copy(e,i),_l(this.userData,o),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)==null||e.dispose(),(i=this.shadow.mapPass)==null||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const o=super.toJSON(e);return o.userData=Ls(_l({},i),!1),this.userData={},this.children=s,o.type="SpotLight2",o.target=this.target.position.toArray(),Object.assign(o,Ls(this,!0,e))}fromJSON(e,i){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),ao(e,this,!0,i),this):this)}}class Hy extends g.cek{get lightObject(){return this}get modelObject(){return this}constructor(e,i,s,o){super(e,i,s,o),this.assetType="light"}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),_l(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)==null||e.dispose(),(i=this.shadow.mapPass)==null||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=Ls(_l({},i),!1),this.userData={},s.type="PointLight2",Object.assign(s,Ls(this,!0,e))}fromJSON(e,i){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),ao(e,this,!0,i),this):this}}class rw extends g.Mig{get lightObject(){return this}get modelObject(){return this}constructor(e,i){super(e,i),this.assetType="light"}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),_l(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=Ls(_l({},i),!1),this.userData={},s.type="AmbientLight2",Object.assign(s,Ls(this,!0,e))}fromJSON(e,i){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),ao(e,this,!0,i),this):this}}class W0 extends g.aNw{load(e,i,s,o){const c=new g.hH6(this.manager);c.setPath(this.path),c.setResponseType("text"),c.load(e,_=>{try{i(this.parse(_))}catch(j){o?o(j):console.error(j),this.manager.itemError(e)}},s,o)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let i=null,s=null;const o=new g.Pa4(0,0,0),c=new g.Pa4(1,1,1),_=e.split(/[\n\r]+/g);let j=null,et=0;for(let at=0,ct=_.length;at<ct;at++){const dt=_[at].trim(),mt=dt.split(/\s/g);switch(mt[0]){case"TITLE":i=dt.substring(7,dt.length-1);break;case"LUT_3D_SIZE":const yt=mt[1];s=parseFloat(yt),j=new Uint8Array(s*s*s*4);break;case"DOMAIN_MIN":o.x=parseFloat(mt[1]),o.y=parseFloat(mt[2]),o.z=parseFloat(mt[3]);break;case"DOMAIN_MAX":c.x=parseFloat(mt[1]),c.y=parseFloat(mt[2]),c.z=parseFloat(mt[3]);break;default:const wt=parseFloat(mt[0]),Ct=parseFloat(mt[1]),bt=parseFloat(mt[2]);if(wt>1||wt<0||Ct>1||Ct<0||bt>1||bt<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");j[et+0]=255*wt,j[et+1]=255*Ct,j[et+2]=255*bt,j[et+3]=255,et+=4}}const nt=new g.IEO;nt.image.data=j,nt.image.width=s,nt.image.height=s*s,nt.type=g.ywz,nt.magFilter=g.wem,nt.minFilter=g.wem,nt.wrapS=g.uWy,nt.wrapT=g.uWy,nt.generateMipmaps=!1,nt.needsUpdate=!0;const st=new g.JUT;return st.image.data=j,st.image.width=s,st.image.height=s,st.image.depth=s,st.type=g.ywz,st.magFilter=g.wem,st.minFilter=g.wem,st.wrapS=g.uWy,st.wrapT=g.uWy,st.wrapR=g.uWy,st.generateMipmaps=!1,st.needsUpdate=!0,{title:i,size:s,domainMin:o,domainMax:c,texture:nt,texture3D:st}}}let Ao=class{constructor({domainMax:h,domainMin:e,size:i,texture:s,texture3D:o,title:c}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=h,this.domainMin=e,this.size=i,this.texture=s,this.texture3D=o,this.title=c,this.uuid=sn(),this.userData.__needsSourceBuffer=!0}fromJSON(h,e){return h.type!==this.type&&console.warn("type mismatch while import",h,this),console.error("not supported"),this}toJSON(h){return $a(this,h,this.texture.name)}};Ao=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_}([Yo("LUTCubeTextureWrapper")],Ao);class Qy extends W0{parse(e){const i=super.parse(e);return new Ao(i)}}var o_={},Qo=Uint8Array,lp=Uint16Array,_f=Uint32Array,Up=new Qo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_d=new Qo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Wy=new Qo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),iw=function(h,e){for(var i=new lp(31),s=0;s<31;++s)i[s]=e+=1<<h[s-1];var o=new _f(i[30]);for(s=1;s<30;++s)for(var c=i[s];c<i[s+1];++c)o[c]=c-i[s]<<5|s;return[i,o]},q0=iw(Up,2),X0=q0[0],Cx=q0[1];X0[28]=258,Cx[258]=28;for(var Y_=iw(_d,0),l0=Y_[0],Fp=Y_[1],c0=new lp(32768),Wo=0;Wo<32768;++Wo){var Y0=(43690&Wo)>>>1|(21845&Wo)<<1;Y0=(61680&(Y0=(52428&Y0)>>>2|(13107&Y0)<<2))>>>4|(3855&Y0)<<4,c0[Wo]=((65280&Y0)>>>8|(255&Y0)<<8)>>>1}var Bm=function(h,e,i){for(var s=h.length,o=0,c=new lp(e);o<s;++o)++c[h[o]-1];var _,j=new lp(e);for(o=0;o<e;++o)j[o]=j[o-1]+c[o-1]<<1;if(i){_=new lp(1<<e);var et=15-e;for(o=0;o<s;++o)if(h[o])for(var nt=o<<4|h[o],st=e-h[o],at=j[h[o]-1]++<<st,ct=at|(1<<st)-1;at<=ct;++at)_[c0[at]>>>et]=nt}else for(_=new lp(s),o=0;o<s;++o)h[o]&&(_[o]=c0[j[h[o]-1]++]>>>15-h[o]);return _},$_=new Qo(288);for(Wo=0;Wo<144;++Wo)$_[Wo]=8;for(Wo=144;Wo<256;++Wo)$_[Wo]=9;for(Wo=256;Wo<280;++Wo)$_[Wo]=7;for(Wo=280;Wo<288;++Wo)$_[Wo]=8;var $0=new Qo(32);for(Wo=0;Wo<32;++Wo)$0[Wo]=5;var u0=Bm($_,9,0),V1=Bm($_,9,1),G1=Bm($0,5,0),ga=Bm($0,5,1),jp=function(h){for(var e=h[0],i=1;i<h.length;++i)h[i]>e&&(e=h[i]);return e},Vu=function(h,e,i){var s=e/8|0;return(h[s]|h[s+1]<<8)>>(7&e)&i},C_=function(h,e){var i=e/8|0;return(h[i]|h[i+1]<<8|h[i+2]<<16)>>(7&e)},vm=function(h){return(h/8|0)+(7&h&&1)},Ep=function(h,e,i){(e==null||e<0)&&(e=0),(i==null||i>h.length)&&(i=h.length);var s=new(h instanceof lp?lp:h instanceof _f?_f:Qo)(i-e);return s.set(h.subarray(e,i)),s},K_=function(h,e,i){var s=h.length;if(!s||i&&!i.l&&s<5)return e||new Qo(0);var o=!e||i,c=!i||i.i;i||(i={}),e||(e=new Qo(3*s));var _=function(Zr){var ds=e.length;if(Zr>ds){var Hs=new Qo(Math.max(2*ds,Zr));Hs.set(e),e=Hs}},j=i.f||0,et=i.p||0,nt=i.b||0,st=i.l,at=i.d,ct=i.m,dt=i.n,mt=8*s;do{if(!st){i.f=j=Vu(h,et,1);var yt=Vu(h,et+1,3);if(et+=3,!yt){var wt=h[(mn=vm(et)+4)-4]|h[mn-3]<<8,Ct=mn+wt;if(Ct>s){if(c)throw"unexpected EOF";break}o&&_(nt+wt),e.set(h.subarray(mn,Ct),nt),i.b=nt+=wt,i.p=et=8*Ct;continue}if(yt==1)st=V1,at=ga,ct=9,dt=5;else{if(yt!=2)throw"invalid block type";var bt=Vu(h,et,31)+257,At=Vu(h,et+10,15)+4,Pt=bt+Vu(h,et+5,31)+1;et+=14;for(var Dt=new Qo(Pt),Nt=new Qo(19),Vt=0;Vt<At;++Vt)Nt[Wy[Vt]]=Vu(h,et+3*Vt,7);et+=3*At;var Zt=jp(Nt),an=(1<<Zt)-1,fn=Bm(Nt,Zt,1);for(Vt=0;Vt<Pt;){var mn,Sn=fn[Vu(h,et,an)];if(et+=15&Sn,(mn=Sn>>>4)<16)Dt[Vt++]=mn;else{var An=0,wn=0;for(mn==16?(wn=3+Vu(h,et,3),et+=2,An=Dt[Vt-1]):mn==17?(wn=3+Vu(h,et,7),et+=3):mn==18&&(wn=11+Vu(h,et,127),et+=7);wn--;)Dt[Vt++]=An}}var Mn=Dt.subarray(0,bt),Pn=Dt.subarray(bt);ct=jp(Mn),dt=jp(Pn),st=Bm(Mn,ct,1),at=Bm(Pn,dt,1)}if(et>mt){if(c)throw"unexpected EOF";break}}o&&_(nt+131072);for(var On=(1<<ct)-1,er=(1<<dt)-1,Zn=et;;Zn=et){var yr=(An=st[C_(h,et)&On])>>>4;if((et+=15&An)>mt){if(c)throw"unexpected EOF";break}if(!An)throw"invalid length/literal";if(yr<256)e[nt++]=yr;else{if(yr==256){Zn=et,st=null;break}var lr=yr-254;if(yr>264){var ar=Up[Vt=yr-257];lr=Vu(h,et,(1<<ar)-1)+X0[Vt],et+=ar}var Mr=at[C_(h,et)&er],xr=Mr>>>4;if(!Mr)throw"invalid distance";if(et+=15&Mr,Pn=l0[xr],xr>3&&(ar=_d[xr],Pn+=C_(h,et)&(1<<ar)-1,et+=ar),et>mt){if(c)throw"unexpected EOF";break}o&&_(nt+131072);for(var qr=nt+lr;nt<qr;nt+=4)e[nt]=e[nt-Pn],e[nt+1]=e[nt+1-Pn],e[nt+2]=e[nt+2-Pn],e[nt+3]=e[nt+3-Pn];nt=qr}}i.l=st,i.p=Zn,i.b=nt,st&&(j=1,i.m=ct,i.d=at,i.n=dt)}while(!j);return nt==e.length?e:Ep(e,0,nt)},T_=function(h,e,i){i<<=7&e;var s=e/8|0;h[s]|=i,h[s+1]|=i>>>8},h0=function(h,e,i){i<<=7&e;var s=e/8|0;h[s]|=i,h[s+1]|=i>>>8,h[s+2]|=i>>>16},J_=function(h,e){for(var i=[],s=0;s<h.length;++s)h[s]&&i.push({s,f:h[s]});var o=i.length,c=i.slice();if(!o)return[Z_,0];if(o==1){var _=new Qo(i[0].s+1);return _[i[0].s]=1,[_,1]}i.sort(function(Dt,Nt){return Dt.f-Nt.f}),i.push({s:-1,f:25001});var j=i[0],et=i[1],nt=0,st=1,at=2;for(i[0]={s:-1,f:j.f+et.f,l:j,r:et};st!=o-1;)j=i[i[nt].f<i[at].f?nt++:at++],et=i[nt!=st&&i[nt].f<i[at].f?nt++:at++],i[st++]={s:-1,f:j.f+et.f,l:j,r:et};var ct=c[0].s;for(s=1;s<o;++s)c[s].s>ct&&(ct=c[s].s);var dt=new lp(ct+1),mt=K0(i[st-1],dt,0);if(mt>e){s=0;var yt=0,wt=mt-e,Ct=1<<wt;for(c.sort(function(Dt,Nt){return dt[Nt.s]-dt[Dt.s]||Dt.f-Nt.f});s<o;++s){var bt=c[s].s;if(!(dt[bt]>e))break;yt+=Ct-(1<<mt-dt[bt]),dt[bt]=e}for(yt>>>=wt;yt>0;){var At=c[s].s;dt[At]<e?yt-=1<<e-dt[At]++-1:++s}for(;s>=0&&yt;--s){var Pt=c[s].s;dt[Pt]==e&&(--dt[Pt],++yt)}mt=e}return[new Qo(dt),mt]},K0=function(h,e,i){return h.s==-1?Math.max(K0(h.l,e,i+1),K0(h.r,e,i+1)):e[h.s]=i},qy=function(h){for(var e=h.length;e&&!h[--e];);for(var i=new lp(++e),s=0,o=h[0],c=1,_=function(et){i[s++]=et},j=1;j<=e;++j)if(h[j]==o&&j!=e)++c;else{if(!o&&c>2){for(;c>138;c-=138)_(32754);c>2&&(_(c>10?c-11<<5|28690:c-3<<5|12305),c=0)}else if(c>3){for(_(o),--c;c>6;c-=6)_(8304);c>2&&(_(c-3<<5|8208),c=0)}for(;c--;)_(o);c=1,o=h[j]}return[i.subarray(0,s),e]},Du=function(h,e){for(var i=0,s=0;s<e.length;++s)i+=h[s]*e[s];return i},Xy=function(h,e,i){var s=i.length,o=vm(e+2);h[o]=255&s,h[o+1]=s>>>8,h[o+2]=255^h[o],h[o+3]=255^h[o+1];for(var c=0;c<s;++c)h[o+c+4]=i[c];return 8*(o+4+s)},cp=function(h,e,i,s,o,c,_,j,et,nt,st){T_(e,st++,i),++o[256];for(var at=J_(o,15),ct=at[0],dt=at[1],mt=J_(c,15),yt=mt[0],wt=mt[1],Ct=qy(ct),bt=Ct[0],At=Ct[1],Pt=qy(yt),Dt=Pt[0],Nt=Pt[1],Vt=new lp(19),Zt=0;Zt<bt.length;++Zt)Vt[31&bt[Zt]]++;for(Zt=0;Zt<Dt.length;++Zt)Vt[31&Dt[Zt]]++;for(var an=J_(Vt,7),fn=an[0],mn=an[1],Sn=19;Sn>4&&!fn[Wy[Sn-1]];--Sn);var An,wn,Mn,Pn,On=nt+5<<3,er=Du(o,$_)+Du(c,$0)+_,Zn=Du(o,ct)+Du(c,yt)+_+14+3*Sn+Du(Vt,fn)+(2*Vt[16]+3*Vt[17]+7*Vt[18]);if(On<=er&&On<=Zn)return Xy(e,st,h.subarray(et,et+nt));if(T_(e,st,1+(Zn<er)),st+=2,Zn<er){An=Bm(ct,dt,0),wn=ct,Mn=Bm(yt,wt,0),Pn=yt;var yr=Bm(fn,mn,0);for(T_(e,st,At-257),T_(e,st+5,Nt-1),T_(e,st+10,Sn-4),st+=14,Zt=0;Zt<Sn;++Zt)T_(e,st+3*Zt,fn[Wy[Zt]]);st+=3*Sn;for(var lr=[bt,Dt],ar=0;ar<2;++ar){var Mr=lr[ar];for(Zt=0;Zt<Mr.length;++Zt){var xr=31&Mr[Zt];T_(e,st,yr[xr]),st+=fn[xr],xr>15&&(T_(e,st,Mr[Zt]>>>5&127),st+=Mr[Zt]>>>12)}}}else An=u0,wn=$_,Mn=G1,Pn=$0;for(Zt=0;Zt<j;++Zt)if(s[Zt]>255){xr=s[Zt]>>>18&31,h0(e,st,An[xr+257]),st+=wn[xr+257],xr>7&&(T_(e,st,s[Zt]>>>23&31),st+=Up[xr]);var qr=31&s[Zt];h0(e,st,Mn[qr]),st+=Pn[qr],qr>3&&(h0(e,st,s[Zt]>>>5&8191),st+=_d[qr])}else h0(e,st,An[s[Zt]]),st+=wn[s[Zt]];return h0(e,st,An[256]),st+wn[256]},sw=new _f([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Z_=new Qo(0),ep=function(h,e,i,s,o,c){var _=h.length,j=new Qo(s+_+5*(1+Math.ceil(_/7e3))+o),et=j.subarray(s,j.length-o),nt=0;if(!e||_<8)for(var st=0;st<=_;st+=65535){var at=st+65535;at<_?nt=Xy(et,nt,h.subarray(st,at)):(et[st]=c,nt=Xy(et,nt,h.subarray(st,_)))}else{for(var ct=sw[e-1],dt=ct>>>13,mt=8191&ct,yt=(1<<i)-1,wt=new lp(32768),Ct=new lp(yt+1),bt=Math.ceil(i/3),At=2*bt,Pt=function(kr){return(h[kr]^h[kr+1]<<bt^h[kr+2]<<At)&yt},Dt=new _f(25e3),Nt=new lp(288),Vt=new lp(32),Zt=0,an=0,fn=(st=0,0),mn=0,Sn=0;st<_;++st){var An=Pt(st),wn=32767&st,Mn=Ct[An];if(wt[wn]=Mn,Ct[An]=wn,mn<=st){var Pn=_-st;if((Zt>7e3||fn>24576)&&Pn>423){nt=cp(h,et,0,Dt,Nt,Vt,an,fn,Sn,st-Sn,nt),fn=Zt=an=0,Sn=st;for(var On=0;On<286;++On)Nt[On]=0;for(On=0;On<30;++On)Vt[On]=0}var er=2,Zn=0,yr=mt,lr=wn-Mn&32767;if(Pn>2&&An==Pt(st-lr))for(var ar=Math.min(dt,Pn)-1,Mr=Math.min(32767,st),xr=Math.min(258,Pn);lr<=Mr&&--yr&&wn!=Mn;){if(h[st+er]==h[st+er-lr]){for(var qr=0;qr<xr&&h[st+qr]==h[st+qr-lr];++qr);if(qr>er){if(er=qr,Zn=lr,qr>ar)break;var Zr=Math.min(lr,qr-2),ds=0;for(On=0;On<Zr;++On){var Hs=st-lr+On+32768&32767,Ps=Hs-wt[Hs]+32768&32767;Ps>ds&&(ds=Ps,Mn=Hs)}}}lr+=(wn=Mn)-(Mn=wt[wn])+32768&32767}if(Zn){Dt[fn++]=268435456|Cx[er]<<18|Fp[Zn];var Os=31&Cx[er],gr=31&Fp[Zn];an+=Up[Os]+_d[gr],++Nt[257+Os],++Vt[gr],mn=st+er,++Zt}else Dt[fn++]=h[st],++Nt[h[st]]}}nt=cp(h,et,c,Dt,Nt,Vt,an,fn,Sn,st-Sn,nt),!c&&7&nt&&(nt=Xy(et,nt+1,Z_))}return Ep(j,0,s+vm(nt)+o)},ow=function(){for(var h=new Int32Array(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(1&i&&-306674912)^i>>>1;h[e]=i}return h}(),d0=function(){var h=-1;return{p:function(e){for(var i=h,s=0;s<e.length;++s)i=ow[255&i^e[s]]^i>>>8;h=i},d:function(){return~h}}},ps=function(){var h=1,e=0;return{p:function(i){for(var s=h,o=e,c=i.length,_=0;_!=c;){for(var j=Math.min(_+2655,c);_<j;++_)o+=s+=i[_];s=(65535&s)+15*(s>>16),o=(65535&o)+15*(o>>16)}h=s,e=o},d:function(){return(255&(h%=65521))<<24|h>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},_u=function(h,e,i,s,o){return ep(h,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(h.length)))):12+e.mem,i,s,!o)},a_=function(h,e){var i={};for(var s in h)i[s]=h[s];for(var s in e)i[s]=e[s];return i},ev=function(h,e,i){for(var s=h(),o=h.toString(),c=o.slice(o.indexOf("[")+1,o.lastIndexOf("]")).replace(/ /g,"").split(","),_=0;_<s.length;++_){var j=s[_],et=c[_];if(typeof j=="function"){e+=";"+et+"=";var nt=j.toString();if(j.prototype)if(nt.indexOf("[native code]")!=-1){var st=nt.indexOf(" ",8)+1;e+=nt.slice(st,nt.indexOf("(",st))}else for(var at in e+=nt,j.prototype)e+=";"+et+".prototype."+at+"="+j.prototype[at].toString();else e+=nt}else i[et]=j}return[e,i]},Tx=[],em=function(h,e,i,s){var o;if(!Tx[i]){for(var c="",_={},j=h.length-1,et=0;et<j;++et)c=(o=ev(h[et],c,_))[0],_=o[1];Tx[i]=ev(h[j],c,_)}var nt=a_({},Tx[i][1]);return function(st,at,ct,dt,mt){var yt=new Worker(o_[at]||(o_[at]=URL.createObjectURL(new Blob([st],{type:"text/javascript"}))));return yt.onerror=function(wt){return mt(wt.error,null)},yt.onmessage=function(wt){return mt(null,wt.data)},yt.postMessage(ct,dt),yt}(Tx[i][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",i,nt,function(st){var at=[];for(var ct in st)(st[ct]instanceof Qo||st[ct]instanceof lp||st[ct]instanceof _f)&&at.push((st[ct]=new st[ct].constructor(st[ct])).buffer);return at}(nt),s)},tv=function(){return[Qo,lp,_f,Up,_d,Wy,X0,l0,V1,ga,c0,Bm,jp,Vu,C_,vm,Ep,K_,Fl,p0,Q1]},Yy=function(){return[Qo,lp,_f,Up,_d,Wy,Cx,Fp,u0,$_,G1,$0,c0,sw,Z_,Bm,T_,h0,J_,K0,qy,Du,Xy,cp,vm,Ep,ep,_u,hr,p0]},Ul=function(){return[W1,Mt,Dl,d0,ow]},$y=function(){return[nm,Mx]},Hl=function(){return[ht,Dl,ps]},H1=function(){return[vt]},p0=function(h){return postMessage(h,[h.buffer])},Q1=function(h){return h&&h.size&&new Qo(h.size)},J0=function(h,e,i,s,o,c){var _=em(i,s,o,function(j,et){_.terminate(),c(j,et)});return _.postMessage([h,e],e.consume?[h.buffer]:[]),function(){_.terminate()}},tm=function(h){return h.ondata=function(e,i){return postMessage([e,i],[e.buffer])},function(e){return h.push(e.data[0],e.data[1])}},Z0=function(h,e,i,s,o){var c,_=em(h,s,o,function(j,et){j?(_.terminate(),e.ondata.call(e,j)):(et[1]&&_.terminate(),e.ondata.call(e,j,et[0],et[1]))});_.postMessage(i),e.push=function(j,et){if(c)throw"stream finished";if(!e.ondata)throw"no stream handler";_.postMessage([j,c=et],[j.buffer])},e.terminate=function(){_.terminate()}},Sp=function(h,e){return h[e]|h[e+1]<<8},ku=function(h,e){return(h[e]|h[e+1]<<8|h[e+2]<<16|h[e+3]<<24)>>>0},vs=function(h,e){return ku(h,e)+4294967296*ku(h,e+4)},Dl=function(h,e,i){for(;i;++e)h[e]=i,i>>>=8},W1=function(h,e){var i=e.filename;if(h[0]=31,h[1]=139,h[2]=8,h[8]=e.level<2?4:e.level==9?2:0,h[9]=3,e.mtime!=0&&Dl(h,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),i){h[3]=8;for(var s=0;s<=i.length;++s)h[s+10]=i.charCodeAt(s)}},nm=function(h){if(h[0]!=31||h[1]!=139||h[2]!=8)throw"invalid gzip data";var e=h[3],i=10;4&e&&(i+=h[10]|2+(h[11]<<8));for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!h[i++]);return i+(2&e)},Mx=function(h){var e=h.length;return(h[e-4]|h[e-3]<<8|h[e-2]<<16|h[e-1]<<24)>>>0},Mt=function(h){return 10+(h.filename&&h.filename.length+1||0)},ht=function(h,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;h[0]=120,h[1]=s<<6|(s?32-2*s:1)},vt=function(h){if((15&h[0])!=8||h[0]>>>4>7||(h[0]<<8|h[1])%31)throw"invalid zlib data";if(32&h[1])throw"invalid zlib data: preset dictionaries not supported"};function Rt(h,e){return e||typeof h!="function"||(e=h,h={}),this.ondata=e,h}var Kt=function(){function h(e,i){i||typeof e!="function"||(i=e,e={}),this.ondata=i,this.o=e||{}}return h.prototype.p=function(e,i){this.ondata(_u(e,this.o,0,0,!i),i)},h.prototype.push=function(e,i){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=i,this.p(e,i||!1)},h}(),In=function(){return function(h,e){Z0([Yy,function(){return[tm,Kt]}],this,Rt.call(this,h,e),function(i){var s=new Kt(i.data);onmessage=tm(s)},6)}}();function Bn(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return J0(h,e,[Yy],function(s){return p0(hr(s.data[0],s.data[1]))},0,i)}function hr(h,e){return _u(h,e||{},0,0)}var Ir=function(){function h(e){this.s={},this.p=new Qo(0),this.ondata=e}return h.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var i=this.p.length,s=new Qo(i+e.length);s.set(this.p),s.set(e,i),this.p=s},h.prototype.c=function(e){this.d=this.s.i=e||!1;var i=this.s.b,s=K_(this.p,this.o,this.s);this.ondata(Ep(s,i,this.s.b),this.d),this.o=Ep(s,this.s.b-32768),this.s.b=this.o.length,this.p=Ep(this.p,this.s.p/8|0),this.s.p&=7},h.prototype.push=function(e,i){this.e(e),this.c(i)},h}(),us=function(){return function(h){this.ondata=h,Z0([tv,function(){return[tm,Ir]}],this,0,function(){var e=new Ir;onmessage=tm(e)},7)}}();function no(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return J0(h,e,[tv],function(s){return p0(Fl(s.data[0],Q1(s.data[1])))},1,i)}function Fl(h,e){return K_(h,e)}var Cp=function(){function h(e,i){this.c=d0(),this.l=0,this.v=1,Kt.call(this,e,i)}return h.prototype.push=function(e,i){Kt.prototype.push.call(this,e,i)},h.prototype.p=function(e,i){this.c.p(e),this.l+=e.length;var s=_u(e,this.o,this.v&&Mt(this.o),i&&8,!i);this.v&&(W1(s,this.o),this.v=0),i&&(Dl(s,s.length-8,this.c.d()),Dl(s,s.length-4,this.l)),this.ondata(s,i)},h}(),up=function(){return function(h,e){Z0([Yy,Ul,function(){return[tm,Kt,Cp]}],this,Rt.call(this,h,e),function(i){var s=new Cp(i.data);onmessage=tm(s)},8)}}();function l_(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return J0(h,e,[Yy,Ul,function(){return[nv]}],function(s){return p0(nv(s.data[0],s.data[1]))},2,i)}function nv(h,e){e||(e={});var i=d0(),s=h.length;i.p(h);var o=_u(h,e,Mt(e),8),c=o.length;return W1(o,e),Dl(o,c-8,i.d()),Dl(o,c-4,s),o}var Ov=function(){function h(e){this.v=1,Ir.call(this,e)}return h.prototype.push=function(e,i){if(Ir.prototype.e.call(this,e),this.v){var s=this.p.length>3?nm(this.p):4;if(s>=this.p.length&&!i)return;this.p=this.p.subarray(s),this.v=0}if(i){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Ir.prototype.c.call(this,i)},h}(),aw=function(){return function(h){this.ondata=h,Z0([tv,$y,function(){return[tm,Ir,Ov]}],this,0,function(){var e=new Ov;onmessage=tm(e)},9)}}();function Ky(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return J0(h,e,[tv,$y,function(){return[f0]}],function(s){return p0(f0(s.data[0]))},3,i)}function f0(h,e){return K_(h.subarray(nm(h),-8),e||new Qo(Mx(h)))}var Jy=function(){function h(e,i){this.c=ps(),this.v=1,Kt.call(this,e,i)}return h.prototype.push=function(e,i){Kt.prototype.push.call(this,e,i)},h.prototype.p=function(e,i){this.c.p(e);var s=_u(e,this.o,this.v&&2,i&&4,!i);this.v&&(ht(s,this.o),this.v=0),i&&Dl(s,s.length-4,this.c.d()),this.ondata(s,i)},h}(),Ix=function(){return function(h,e){Z0([Yy,Hl,function(){return[tm,Kt,Jy]}],this,Rt.call(this,h,e),function(i){var s=new Jy(i.data);onmessage=tm(s)},10)}}();function hp(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return J0(h,e,[Yy,Hl,function(){return[Px]}],function(s){return p0(Px(s.data[0],s.data[1]))},4,i)}function Px(h,e){e||(e={});var i=ps();i.p(h);var s=_u(h,e,2,4);return ht(s,e),Dl(s,s.length-4,i.d()),s}var rv=function(){function h(e){this.v=1,Ir.call(this,e)}return h.prototype.push=function(e,i){if(Ir.prototype.e.call(this,e),this.v){if(this.p.length<2&&!i)return;this.p=this.p.subarray(2),this.v=0}if(i){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Ir.prototype.c.call(this,i)},h}(),Zy=function(){return function(h){this.ondata=h,Z0([tv,H1,function(){return[tm,Ir,rv]}],this,0,function(){var e=new rv;onmessage=tm(e)},11)}}();function ym(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return J0(h,e,[tv,H1,function(){return[q1]}],function(s){return p0(q1(s.data[0],Q1(s.data[1])))},5,i)}function q1(h,e){return K_((vt(h),h.subarray(2,-4)),e)}var jT=function(){function h(e){this.G=Ov,this.I=Ir,this.Z=rv,this.ondata=e}return h.prototype.push=function(e,i){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,i);else{if(this.p&&this.p.length){var s=new Qo(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var o=this,c=function(){o.ondata.apply(o,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(c):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(c):new this.Z(c),this.s.push(this.p,i),this.p=null}}},h}(),Bv=function(){function h(e){this.G=aw,this.I=us,this.Z=Zy,this.ondata=e}return h.prototype.push=function(e,i){jT.prototype.push.call(this,e,i)},h}();function zS(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return h[0]==31&&h[1]==139&&h[2]==8?Ky(h,e,i):(15&h[0])!=8||h[0]>>4>7||(h[0]<<8|h[1])%31?no(h,e,i):ym(h,e,i)}function rm(h,e){return h[0]==31&&h[1]==139&&h[2]==8?f0(h,e):(15&h[0])!=8||h[0]>>4>7||(h[0]<<8|h[1])%31?Fl(h,e):q1(h,e)}var eA=function(h,e,i,s){for(var o in h){var c=h[o],_=e+o;c instanceof Qo?i[_]=[c,s]:Array.isArray(c)?i[_]=[c[0],a_(s,c[1])]:eA(c,_+"/",i,s)}},zT=typeof TextEncoder<"u"&&new TextEncoder,lw=typeof TextDecoder<"u"&&new TextDecoder,VT=0;try{lw.decode(Z_,{stream:!0}),VT=1}catch{}var VS=function(h){for(var e="",i=0;;){var s=h[i++],o=(s>127)+(s>223)+(s>239);if(i+o>h.length)return[e,Ep(h,i-1)];o?o==3?(s=((15&s)<<18|(63&h[i++])<<12|(63&h[i++])<<6|63&h[i++])-65536,e+=String.fromCharCode(55296|s>>10,56320|1023&s)):e+=1&o?String.fromCharCode((31&s)<<6|63&h[i++]):String.fromCharCode((15&s)<<12|(63&h[i++])<<6|63&h[i++]):e+=String.fromCharCode(s)}},WD=function(){function h(e){this.ondata=e,VT?this.t=new TextDecoder:this.p=Z_}return h.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(i=!!i,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),i),i){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var s=new Qo(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var o=VS(s),c=o[0],_=o[1];if(i){if(_.length)throw"invalid utf-8 data";this.p=null}else this.p=_;this.ondata(c,i)}},h}(),qD=function(){function h(e){this.ondata=e}return h.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(im(e),this.d=i||!1)},h}();function im(h,e){if(e){for(var i=new Qo(h.length),s=0;s<h.length;++s)i[s]=h.charCodeAt(s);return i}if(zT)return zT.encode(h);var o=h.length,c=new Qo(h.length+(h.length>>1)),_=0,j=function(st){c[_++]=st};for(s=0;s<o;++s){if(_+5>c.length){var et=new Qo(_+8+(o-s<<1));et.set(c),c=et}var nt=h.charCodeAt(s);nt<128||e?j(nt):nt<2048?(j(192|nt>>6),j(128|63&nt)):nt>55295&&nt<57344?(j(240|(nt=65536+(1047552&nt)|1023&h.charCodeAt(++s))>>18),j(128|nt>>12&63),j(128|nt>>6&63),j(128|63&nt)):(j(224|nt>>12),j(128|nt>>6&63),j(128|63&nt))}return Ep(c,0,_)}function m0(h,e){if(e){for(var i="",s=0;s<h.length;s+=16384)i+=String.fromCharCode.apply(null,h.subarray(s,s+16384));return i}if(lw)return lw.decode(h);var o=VS(h),c=o[0];if(o[1].length)throw"invalid utf-8 data";return c}var X1=function(h){return h==1?3:h<6?2:h==9?1:0},Y1=function(h,e){return e+30+Sp(h,e+26)+Sp(h,e+28)},GT=function(h,e,i){var s=Sp(h,e+28),o=m0(h.subarray(e+46,e+46+s),!(2048&Sp(h,e+8))),c=e+46+s,_=ku(h,e+20),j=i&&_==4294967295?h2(h,c):[_,ku(h,e+24),ku(h,e+42)],et=j[0],nt=j[1],st=j[2];return[Sp(h,e+10),et,nt,o,c+Sp(h,e+30)+Sp(h,e+32),st]},h2=function(h,e){for(;Sp(h,e)!=1;e+=4+Sp(h,e+2));return[vs(h,e+12),vs(h,e+4),vs(h,e+20)]},M_=function(h){var e=0;if(h)for(var i in h){var s=h[i].length;if(s>65535)throw"extra field too long";e+=s+4}return e},Eo=function(h,e,i,s,o,c,_,j){var et=s.length,nt=i.extra,st=j&&j.length,at=M_(nt);Dl(h,e,_!=null?33639248:67324752),e+=4,_!=null&&(h[e++]=20,h[e++]=i.os),h[e]=20,e+=2,h[e++]=i.flag<<1|(c==null&&8),h[e++]=o&&8,h[e++]=255&i.compression,h[e++]=i.compression>>8;var ct=new Date(i.mtime==null?Date.now():i.mtime),dt=ct.getFullYear()-1980;if(dt<0||dt>119)throw"date not in range 1980-2099";if(Dl(h,e,dt<<25|ct.getMonth()+1<<21|ct.getDate()<<16|ct.getHours()<<11|ct.getMinutes()<<5|ct.getSeconds()>>>1),e+=4,c!=null&&(Dl(h,e,i.crc),Dl(h,e+4,c),Dl(h,e+8,i.size)),Dl(h,e+12,et),Dl(h,e+14,at),e+=16,_!=null&&(Dl(h,e,st),Dl(h,e+6,i.attrs),Dl(h,e+10,_),e+=14),h.set(s,e),e+=et,at)for(var mt in nt){var yt=nt[mt],wt=yt.length;Dl(h,e,+mt),Dl(h,e+2,wt),h.set(yt,e+4),e+=4+wt}return st&&(h.set(j,e),e+=st),e},hs=function(h,e,i,s,o){Dl(h,e,101010256),Dl(h,e+8,i),Dl(h,e+10,i),Dl(h,e+12,s),Dl(h,e+16,o)},zp=function(){function h(e){this.filename=e,this.c=d0(),this.size=0,this.compression=0}return h.prototype.process=function(e,i){this.ondata(null,e,i)},h.prototype.push=function(e,i){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,i&&(this.crc=this.c.d()),this.process(e,i||!1)},h}(),GS=function(){function h(e,i){var s=this;i||(i={}),zp.call(this,e),this.d=new Kt(i,function(o,c){s.ondata(null,o,c)}),this.compression=8,this.flag=X1(i.level)}return h.prototype.process=function(e,i){try{this.d.push(e,i)}catch(s){this.ondata(s,null,i)}},h.prototype.push=function(e,i){zp.prototype.push.call(this,e,i)},h}(),XD=function(){function h(e,i){var s=this;i||(i={}),zp.call(this,e),this.d=new In(i,function(o,c,_){s.ondata(o,c,_)}),this.compression=8,this.flag=X1(i.level),this.terminate=this.d.terminate}return h.prototype.process=function(e,i){this.d.push(e,i)},h.prototype.push=function(e,i){zp.prototype.push.call(this,e,i)},h}(),YD=function(){function h(e){this.ondata=e,this.u=[],this.d=1}return h.prototype.add=function(e){var i=this;if(2&this.d)throw"stream finished";var s=im(e.filename),o=s.length,c=e.comment,_=c&&im(c),j=o!=e.filename.length||_&&c.length!=_.length,et=o+M_(e.extra)+30;if(o>65535)throw"filename too long";var nt=new Qo(et);Eo(nt,0,e,s,j);var st=[nt],at=function(){for(var wt=0,Ct=st;wt<Ct.length;wt++){var bt=Ct[wt];i.ondata(null,bt,!1)}st=[]},ct=this.d;this.d=0;var dt=this.u.length,mt=a_(e,{f:s,u:j,o:_,t:function(){e.terminate&&e.terminate()},r:function(){if(at(),ct){var wt=i.u[dt+1];wt?wt.r():i.d=1}ct=1}}),yt=0;e.ondata=function(wt,Ct,bt){if(wt)i.ondata(wt,Ct,bt),i.terminate();else if(yt+=Ct.length,st.push(Ct),bt){var At=new Qo(16);Dl(At,0,134695760),Dl(At,4,e.crc),Dl(At,8,yt),Dl(At,12,e.size),st.push(At),mt.c=yt,mt.b=et+yt+16,mt.crc=e.crc,mt.size=e.size,ct&&mt.r(),ct=1}else ct&&at()},this.u.push(mt)},h.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},h.prototype.e=function(){for(var e=0,i=0,s=0,o=0,c=this.u;o<c.length;o++)s+=46+(nt=c[o]).f.length+M_(nt.extra)+(nt.o?nt.o.length:0);for(var _=new Qo(s+22),j=0,et=this.u;j<et.length;j++){var nt=et[j];Eo(_,e,nt,nt.f,nt.u,nt.c,i,nt.o),e+=46+nt.f.length+M_(nt.extra)+(nt.o?nt.o.length:0),i+=nt.b}hs(_,e,this.u.length,s,i),this.ondata(null,_,!0),this.d=2},h.prototype.terminate=function(){for(var e=0,i=this.u;e<i.length;e++)i[e].t();this.d=2},h}();function $D(h,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";var s={};eA(h,"",s,e);var o=Object.keys(s),c=o.length,_=0,j=0,et=c,nt=new Array(c),st=[],at=function(){for(var yt=0;yt<st.length;++yt)st[yt]()},ct=function(){var yt=new Qo(j+22),wt=_,Ct=j-_;j=0;for(var bt=0;bt<et;++bt){var At=nt[bt];try{var Pt=At.c.length;Eo(yt,j,At,At.f,At.u,Pt);var Dt=30+At.f.length+M_(At.extra),Nt=j+Dt;yt.set(At.c,Nt),Eo(yt,_,At,At.f,At.u,Pt,j,At.m),_+=16+Dt+(At.m?At.m.length:0),j=Nt+Pt}catch(Vt){return i(Vt,null)}}hs(yt,_,nt.length,Ct,wt),i(null,yt)};c||ct();for(var dt=function(yt){var wt=o[yt],Ct=s[wt],bt=Ct[0],At=Ct[1],Pt=d0(),Dt=bt.length;Pt.p(bt);var Nt=im(wt),Vt=Nt.length,Zt=At.comment,an=Zt&&im(Zt),fn=an&&an.length,mn=M_(At.extra),Sn=At.level==0?0:8,An=function(wn,Mn){if(wn)at(),i(wn,null);else{var Pn=Mn.length;nt[yt]=a_(At,{size:Dt,crc:Pt.d(),c:Mn,f:Nt,m:an,u:Vt!=wt.length||an&&Zt.length!=fn,compression:Sn}),_+=30+Vt+mn+Pn,j+=76+2*(Vt+mn)+(fn||0)+Pn,--c||ct()}};if(Vt>65535&&An("filename too long",null),Sn)if(Dt<16e4)try{An(null,hr(bt,At))}catch(wn){An(wn,null)}else st.push(Bn(bt,At,An));else An(null,bt)},mt=0;mt<et;++mt)dt(mt);return at}function HT(h,e){e||(e={});var i={},s=[];eA(h,"",i,e);var o=0,c=0;for(var _ in i){var j=i[_],et=j[0],nt=j[1],st=nt.level==0?0:8,at=(Vt=im(_)).length,ct=nt.comment,dt=ct&&im(ct),mt=dt&&dt.length,yt=M_(nt.extra);if(at>65535)throw"filename too long";var wt=st?hr(et,nt):et,Ct=wt.length,bt=d0();bt.p(et),s.push(a_(nt,{size:et.length,crc:bt.d(),c:wt,f:Vt,m:dt,u:at!=_.length||dt&&ct.length!=mt,o,compression:st})),o+=30+at+yt+Ct,c+=76+2*(at+yt)+(mt||0)+Ct}for(var At=new Qo(c+22),Pt=o,Dt=c-o,Nt=0;Nt<s.length;++Nt){var Vt=s[Nt];Eo(At,Vt.o,Vt,Vt.f,Vt.u,Vt.c.length);var Zt=30+Vt.f.length+M_(Vt.extra);At.set(Vt.c,Vt.o+Zt),Eo(At,o,Vt,Vt.f,Vt.u,Vt.c.length,Vt.o,Vt.m),o+=16+Zt+(Vt.m?Vt.m.length:0)}return hs(At,o,s.length,Dt,Pt),At}var d2=function(){function h(){}return h.prototype.push=function(e,i){this.ondata(null,e,i)},h.compression=0,h}(),KD=function(){function h(){var e=this;this.i=new Ir(function(i,s){e.ondata(null,i,s)})}return h.prototype.push=function(e,i){try{this.i.push(e,i)}catch(s){this.ondata(s,e,i)}},h.compression=8,h}(),HS=function(){function h(e,i){var s=this;i<32e4?this.i=new Ir(function(o,c){s.ondata(null,o,c)}):(this.i=new us(function(o,c,_){s.ondata(o,c,_)}),this.terminate=this.i.terminate)}return h.prototype.push=function(e,i){this.i.terminate&&(e=Ep(e,0)),this.i.push(e,i)},h.compression=8,h}(),p2=function(){function h(e){this.onfile=e,this.k=[],this.o={0:d2},this.p=Z_}return h.prototype.push=function(e,i){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var o=Math.min(this.c,e.length),c=e.subarray(0,o);if(this.c-=o,this.d?this.d.push(c,!this.c):this.k[0].push(c),(e=e.subarray(o)).length)return this.push(e,i)}else{var _=0,j=0,et=void 0,nt=void 0;this.p.length?e.length?((nt=new Qo(this.p.length+e.length)).set(this.p),nt.set(e,this.p.length)):nt=this.p:nt=e;for(var st=nt.length,at=this.c,ct=at&&this.d,dt=function(){var wt,Ct=ku(nt,j);if(Ct==67324752){_=1,et=j,mt.d=null,mt.c=0;var bt=Sp(nt,j+6),At=Sp(nt,j+8),Pt=2048&bt,Dt=8&bt,Nt=Sp(nt,j+26),Vt=Sp(nt,j+28);if(st>j+30+Nt+Vt){var Zt=[];mt.k.unshift(Zt),_=2;var an,fn=ku(nt,j+18),mn=ku(nt,j+22),Sn=m0(nt.subarray(j+30,j+=30+Nt),!Pt);fn==4294967295?(wt=Dt?[-2]:h2(nt,j),fn=wt[0],mn=wt[1]):Dt&&(fn=-1),j+=Vt,mt.c=fn;var An={name:Sn,compression:At,start:function(){if(!An.ondata)throw"no callback";if(fn){var wn=s.o[At];if(!wn)throw"unknown compression type "+At;(an=fn<0?new wn(Sn):new wn(Sn,fn,mn)).ondata=function(er,Zn,yr){An.ondata(er,Zn,yr)};for(var Mn=0,Pn=Zt;Mn<Pn.length;Mn++){var On=Pn[Mn];an.push(On,!1)}s.k[0]==Zt&&s.c?s.d=an:an.push(Z_,!0)}else An.ondata(null,Z_,!0)},terminate:function(){an&&an.terminate&&an.terminate()}};fn>=0&&(An.size=fn,An.originalSize=mn),mt.onfile(An)}return"break"}if(at){if(Ct==134695760)return et=j+=12+(at==-2&&8),_=3,mt.c=0,"break";if(Ct==33639248)return et=j-=4,_=3,mt.c=0,"break"}},mt=this;j<st-4&&dt()!=="break";++j);if(this.p=Z_,at<0){var yt=_?nt.subarray(0,et-12-(at==-2&&8)-(ku(nt,et-16)==134695760&&4)):nt.subarray(0,j);ct?ct.push(yt,!!_):this.k[+(_==2)].push(yt)}if(2&_)return this.push(nt.subarray(j),i);this.p=nt.subarray(j)}if(i){if(this.c)throw"invalid zip file";this.p=null}},h.prototype.register=function(e){this.o[e.compression]=e},h}();function $1(h,e){if(typeof e!="function")throw"no callback";for(var i=[],s=function(){for(var ct=0;ct<i.length;++ct)i[ct]()},o={},c=h.length-22;ku(h,c)!=101010256;--c)if(!c||h.length-c>65558)return void e("invalid zip file",null);var _=Sp(h,c+8);_||e(null,{});var j=_,et=ku(h,c+16),nt=et==4294967295;if(nt){if(c=ku(h,c-12),ku(h,c)!=101075792)return void e("invalid zip file",null);j=_=ku(h,c+32),et=ku(h,c+48)}for(var st=function(ct){var dt=GT(h,et,nt),mt=dt[0],yt=dt[1],wt=dt[2],Ct=dt[3],bt=dt[4],At=dt[5],Pt=Y1(h,At);et=bt;var Dt=function(Vt,Zt){Vt?(s(),e(Vt,null)):(o[Ct]=Zt,--_||e(null,o))};if(mt)if(mt==8){var Nt=h.subarray(Pt,Pt+yt);if(yt<32e4)try{Dt(null,Fl(Nt,new Qo(wt)))}catch(Vt){Dt(Vt,null)}else i.push(no(Nt,{size:wt},Dt))}else Dt("unknown compression type "+mt,null);else Dt(null,Ep(h,Pt,Pt+yt))},at=0;at<j;++at)st();return s}function cw(h){for(var e={},i=h.length-22;ku(h,i)!=101010256;--i)if(!i||h.length-i>65558)throw"invalid zip file";var s=Sp(h,i+8);if(!s)return{};var o=ku(h,i+16),c=o==4294967295;if(c){if(i=ku(h,i-12),ku(h,i)!=101075792)throw"invalid zip file";s=ku(h,i+32),o=ku(h,i+48)}for(var _=0;_<s;++_){var j=GT(h,o,c),et=j[0],nt=j[1],st=j[2],at=j[3],ct=j[4],dt=j[5],mt=Y1(h,dt);if(o=ct,et){if(et!=8)throw"unknown compression type "+et;e[at]=Fl(h.subarray(mt,mt+nt),new Qo(st))}else e[at]=Ep(h,mt,mt+nt)}return e}class QS extends g.hH6{load(e,i,s,o){return this.setResponseType("arraybuffer"),super.load(e,c=>{const _=cw(new Uint8Array(c)),j=new Map(Object.entries(_).map(([et,nt])=>[et,new File([nt],et)]));i==null||i(j)},s,o)}}class WS extends b.SimpleEventDispatcher{get cachedAssets(){return this._cachedAssets}get processors(){return this._processors}get loadingManager(){return this._loadingManager}constructor(e,i=!1){super(),this._processors=new x_,this._logger=console.log,this.Importers=[new eu(tu,["json"],!1),new eu(g.hH6,["txt"],!1),new eu(q_,["rgbe.png","hdr.png","hdrpng"],!1),new eu(g.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new eu(Qy,["cube"],!1),new eu(QS,["zip"],!0)],this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],i||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new g.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),this.Importers.push(Iv(e)),this.Importers.push(V0(e)),this.Importers.push(Q0())}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,i,s){this.dispatchEvent({type:"onProgress",url:e,loaded:i,total:s})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,i,s){this.dispatchEvent({type:"onStart",url:e,loaded:i,total:s})}_urlModifier(e){var c;let i=decodeURI(e);const s=(c=this._rootContext)==null?void 0:c.rootUrl;i.includes("://")||!s||i.startsWith(s)||(i=s+i),i=i.replace("./",""),i=i.replace(/^(\/\/)/,"/"),i=i.replace(/\?.*$/,"");const o=this._fileDatabase.get(i);return o?o.ext?(o.objectUrl||(o.objectUrl=URL.createObjectURL(o)+"#"+i),o.objectUrl):(console.error("Unable to determine file extension",o),e):e}_createLoader(e){const i=this._getImporter(e),s=i==null?void 0:i.ctor(this);return s&&(i==null||i.ext.forEach(o=>{const c=new RegExp(o.startsWith("data:")?"^"+o+"\\/":"\\."+o+"$","i");this._loadingManager.addHandler(c,s)})),s&&(this._loaderCache.push({loader:s,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:s})),s}addEventListener(e,i){if(super.addEventListener(e,i),e==="loaderCreate")for(const s of this._loaderCache)this.dispatchEvent({type:"loaderCreate",loader:s.loader})}async importFiles(e,i={}){const s=new Map;let{allowedExtensions:o}=i;if(o&&o.length<1&&(o=void 0),e.size===0)return s;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const c=[],_=[];if(e.forEach((j,et)=>{this.registerFile(et,j);const nt=j.ext;nt&&((o==null?void 0:o.includes(nt.toLowerCase()))??1)&&(this._isRootFileExtension(nt)?c.push(et):_.push(et))}),c.length>0)for(const j of c){let et=await this._importFile(j,void 0,i);et&&(et=await this.processImported(et,i)),s.set(j,et)}else for(const j of _){let et=await this._importFile(j,void 0,i);et&&(et=await this.processImported(et,i)),s.set(j,et)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((j,et)=>{this.unregisterFile(et)}),s}registerFile(e,i){var c;e=e.replace(/\?.*$/,"");const s=(i==null?void 0:i.ext)??((c=(0,b.parseFileExtension)((i==null?void 0:i.name)??e))==null?void 0:c.toLowerCase());i&&(i.ext||(i.ext=s),this._fileDatabase.set(e,i));let o=this._getLoader(e);if(o||(o=this._createLoader(i??{name:e,ext:s})),o){for(const _ of this._loaderCache)if(_.loader===o){_.files.push(e);break}}return o}unregisterFile(e){e=e.replace(/\?.*$/,"");const i=this._fileDatabase.get(e);i!=null&&i.objectUrl&&(URL.revokeObjectURL(i.objectUrl),i.objectUrl=void 0),i&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return this.Importers.find(i=>i.root&&i.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,i,s={},o){var _;if(i!=null&&i.__imported)return i.__imported;let c;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,i);const j=this.resolveURL(e),et=e.replace(/\?.*$/,""),nt=s.fileHandler??(await this._loadingManager.getHandler(et)||(i?await this._loadingManager.getHandler(i.name||i.ext||""):void 0));if(!nt)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:j,rootUrl:g.Zp0.extractUrlBase(e),baseUrl:g.Zp0.extractUrlBase(j)},c=await nt.loadAsync(e+(s.queryString?(e.includes("?")?"&":"?")+s.queryString:""),st=>{o&&o(st),this.dispatchEvent({type:"importFile",path:e,state:"downloading",loadedBytes:st.loaded||void 0,totalBytes:st.total||void 0,progress:st.total>0?st.loaded/st.total:1})}),nt.transform&&(c=await nt.transform(c,s)),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),i?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),i&&this.unregisterFile(e)}catch(j){return console.error("AssetImporter: Unable to import file",e,i),console.error(j),console.error(j==null?void 0:j.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:j}),i&&this.unregisterFile(e),[]}if(this.dispatchEvent({type:"importFile",path:e,state:"done"}),i){i.__imported=c;let j=[];Array.isArray(c)?j=c:(_=c.userData)!=null&&_.rootSceneModelRoot?j.push(...c.children):j.push(c),j.forEach(et=>{var nt;(nt=et.addEventListener)==null||nt.call(et,"dispose",()=>{i.__imported=void 0})})}if(c&&typeof c=="object"){c.__rootPath=e;const j=i||this._fileDatabase.get(e);j&&(c.__rootBlob=j)}return c}_getImporter(e,i=!1){return this.Importers.find(s=>{if(i&&!s.root)return!1;const o=s.ext.find(c=>{var _,j,et;return e.ext&&c===e.ext.toLowerCase()||((j=(_=e.name)==null?void 0:_.toLowerCase())==null?void 0:j.endsWith("."+c.toLowerCase()))||(c==null?void 0:c.startsWith("data:"))&&((et=e.name)==null?void 0:et.startsWith(c))});return!!o&&(e.ext=o,!0)})}_getLoader(e){return this._loadingManager.getHandler(e)??void 0}async importAsset(e,i={},s){var _,j,et;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const st=this._cachedAssets.find(at=>at.path===e.path);st&&Object.assign(e,st)}const nt=this._cachedAssets.findIndex(st=>st.path===e.path);nt>=0&&this._cachedAssets.splice(nt,1),this._cachedAssets.push(e)}let o;if(e!=null&&e.preImported&&(o=await e.preImported),!i.forceImport&&o){const nt=await this.processImported(o,i);let st=!1;for(const at of nt){if((_=at.userData)!=null&&_.rootSceneModelRoot&&[...at.children,...at.__processedChildren||[]].find(ct=>ct.__disposed)){st=!0;break}if(at.__disposed){st=!0;break}}if(!st||i.reimportDisposed===!1)return nt}const c=i.pathOverride||e.path;if(e.preImported=this._importFile(c,typeof((j=e.file)==null?void 0:j.arrayBuffer)=="function"?e.file:void 0,i,s),o=await e.preImported,o&&(this.dispatchEvent({type:"processFileStart",path:c,result:o}),o=await this.processImported(o,i),this.dispatchEvent({type:"processFileEnd",path:c,result:o})),o){const nt=[];Array.isArray(o)?nt.push(...o):(et=o.userData)!=null&&et.rootSceneModelRoot?nt.push(...o.children):nt.push(o),nt.forEach(st=>{var at;return(at=st.addEventListener)==null?void 0:at.call(st,"dispose",()=>{e!=null&&e.preImported&&(e.preImported=void 0)})})}return o}async importSingle(e,i={}){var s;return typeof e=="string"?await this.importSinglePath(e,i):(s=await this.importAsset(e,i))==null?void 0:s[0]}async importSinglePath(e,i){var s;return(s=await this.importPath(e,i))==null?void 0:s[0]}async importPath(e,i={}){const s={...i};delete s.pathOverride,delete s.forceImport,delete s.reimportDisposed,delete s.fileHandler,delete s.importedFile;const o=JSON.stringify(s);let c;return c=this._cachedAssets.find(_=>_.path===e&&_._options===o)||{path:e},c._options=o,i.importedFile&&(c.file=i.importedFile),await this.importAsset(c,i)}async processImportedSingle(e,i={}){return(await this.processImported(e,i))[0]}async processImported(e,i={}){var _,j,et,nt,st,at,ct,dt;let s=e;if(!s)return[];if(i.processImported===!1)return[s];if(Array.isArray(s)){const mt=[];for(const yt of s)mt.push(...await this.processImported(yt,i));return mt}if((_=s.userData)!=null&&_.rootSceneModelRoot){if(i._rootSceneImported=!0,s.__processedChildren&&!i.forceImporterReprocess)return s.__processedChildren;if(!(s.children.length<1))return s.animations&&(s.children[0].animations||(s.children[0].animations=[]),s.children[0].animations.push(...s.animations)),s.__importedViewerConfig&&(s.children[0].__importedViewerConfig=s.__importedViewerConfig),s.userData.__importData&&(s.children[0].userData.__importData=s.userData.__importData),s.__processedChildren=await this.processImported([...s.children],i),s.__processedChildren;if(((j=s.animations)==null?void 0:j.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",s.animations),!s.__importedViewerConfig)return[];s=s.__importedViewerConfig}if((et=s.userData)!=null&&et.iModel&&(s=s.userData.iModel),(nt=s.userData)!=null&&nt.iMaterial&&(s=s.userData.iMaterial),s.assetImporterProcessed&&!i.forceImporterReprocess)return[s];const o=s.__rootPath,c=s.__rootBlob;if(!s.assetType){if(s.isBufferGeometry&&(s=new g.Kj0(s,new g.Wid)),s.isObject3D)if(s.isLight)s=uw(s);else{const mt=[];s.traverse(yt=>{yt!==s&&yt.isLight&&mt.push(yt)});for(const yt of mt)uw(yt);s=new Uy(s,i)}s.isTexture&&(s.assetType="texture",i._testDataTextureComplete&&(s.isDataTexture&&((st=s.image)!=null&&st.data)&&(s.image.complete=!0),(at=s.image)!=null&&at.complete&&(s.needsUpdate=!0)),i.generateMipmaps!==void 0&&(s.generateMipmaps=i.generateMipmaps),s.generateMipmaps||s.isRenderTargetTexture||(s.minFilter=s.minFilter===g.D1R?g.wem:s.minFilter,s.magFilter=s.magFilter===g.D1R?g.wem:s.magFilter)),s.isMaterial&&(s.assetType="material")}if(s.assetType!=null)return s.userData&&(s.userData.rootPath||!o||o.startsWith("blob:")||o.startsWith("/")||(s.userData.rootPath=o),c&&(s.userData.__sourceBlob=c,s.userData.__needsSourceBuffer&&(s.userData.__sourceBuffer=await c.arrayBuffer(),delete s.userData.__needsSourceBuffer))),s=await this._processors.process(s.assetType,s,{}),s.assetImporterProcessed=!0,[s];if(s instanceof Map)return[...(await this.importFiles(s,i)).values()].flat();if(s.type&&s.type!=="ViewerApp"&&s.type!=="ThreeViewer"){const mt=this._viewer.getPluginByType(s.type);if(mt){let yt=s._importedResources||{};return s.resources&&(yt=await((ct=this._viewer.getManager())==null?void 0:ct.importConfigResources(s.resources)),delete s.resources,s._importedResources=yt),typeof mt.fromJSON=="function"&&(await Promise.resolve(mt.fromJSON(s,yt)),s.assetImporterProcessed=!1),[]}}return s.plugins||s.type==="ViewerApp"||s.type==="ThreeViewer"?(s.resources=await((dt=this._viewer.getManager())==null?void 0:dt.importConfigResources(s.resources)),await this._viewer.getManager().importViewerConfig(s),s.assetImporterProcessed=!1,[]):(console.warn("unknown/null asset type: ",s,s.plugins),[s])}dispose(){var e;this.clearCache(),(e=this._processors)==null||e.dispose()}clearLoaderCache(){this._loaderCache.forEach(e=>{e.loader.dispose&&e.loader.dispose()}),this._loaderCache=[]}clearCache(){this.clearLoaderCache(),this._cachedAssets=[]}}function ey(h){if(!h)return g.ywz;const e=h.extensions.has("EXT_color_buffer_half_float")||h.capabilities.isWebGL2&&h.extensions.has("EXT_color_buffer_float"),i=h.capabilities.isWebGL2||h.extensions.has("OES_texture_float")||h.extensions.has("WEBGL_color_buffer_float");return e?g.cLu:i?g.VzW:g.ywz}function uw(h){var i,s;if(!h.isLight||h.assetType==="light")return h;if(h.uiConfig)return console.warn("ui config already exists, not supported",h),h;let e;if(h.children.length,h.isDirectionalLight&&(e=new S_),h.isAmbientLight&&(e=new rw),h.isSpotLight&&(e=new nw),h.isPointLight&&(e=new Hy),e){(s=(i=e.lightObject).copy)==null||s.call(i,h);const o=h.parent;o!=null&&o.isObject3D&&(o.remove(h),h.dispose(),h.userData.iModel=e,o.add(e.lightObject),e.uuid=h.uuid),Nl(e.lightObject,o)}else console.warn("unknown light type: ",h);return e}class QT extends g.u7G{constructor(e){super(e)}async loadAsync(e,i){var c;const s=new g.hH6(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,i);try{const _=JSON.parse(o);if(_.images&&this.importer){const j={};let et=_.images;Array.isArray(et)||(et=Object.values(et));for(const nt of _.images){if(!nt.url||!nt.uuid)continue;const st=(c=await this.importer.importPath(nt.url,{processImported:!1}))==null?void 0:c[0],at=st==null?void 0:st.source;if(!st||!at)continue;const ct=new g.Hw6(at.data);ct.uuid=nt.uuid,j[ct.uuid]=ct,st.dispose()}return await Np.LoadRootPathTextures(_.textures,j||_.images,this.importer),this.parse(_,j)}return this.parse(_)}catch(_){throw console.error(_),this.manager.itemError(e),_}}parse(e,i){var et;let s;const o={p:new Promise(nt=>{s=nt})};if(e.images||e.textures){const nt=new Np(this.manager);let st={};const at=yt=>{s(),o.p=void 0,Object.values(st).forEach(wt=>{var Ct;wt.isTexture&&((Ct=wt.image)!=null&&Ct.complete)&&(wt.needsUpdate=!0)})};let ct=e.images||[];Array.isArray(ct)||(ct=Object.values(ct));const dt=i||nt.parseImages(ct,at);let mt=e.textures;Array.isArray(mt)||(mt=Object.values(mt)),st=nt.parseTextures2(mt,dt,at),this.setTextures(st)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const c={...e};if(Object.entries(c).forEach(([nt,st])=>{st&&typeof st=="string"&&this.textures[st]&&(c[nt]=this.textures[st])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?c.vertexColors=e.vertexColors>0:c.vertexColors=e.vertexColors),e.normalScale!==void 0){const nt=e.normalScale;Array.isArray(nt)===!1&&(c.normalScale=[nt,nt])}let _=e.type;_!=="MeshPhysicalMaterial"&&_!=="MeshStandardMaterial"&&_!=="PhysicalMaterial"||(_=bp.TYPE),c.userData=ao(c.userData,void 0,!1,this);const j=((et=this.materials)==null?void 0:et.generateFromTemplateType(_,c))??super.parse(e);return this.setTextures({}),j.userData.imageLoadAwaiter=o,j}}class Fr extends b.SimpleEventDispatcher{constructor(e,i,{simpleCache:s=!1,storage:o}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(s||o)&&(s&&(g.CtF.enabled=!0),o&&window.Cache&&typeof window.Cache=="function"&&o instanceof window.Cache)){const c={...g.CtF};g.CtF.get=(_,j,et)=>j?_.startsWith("data:")||_.startsWith("blob")||_.startsWith("chrome-extension")?Promise.resolve(void 0):o.match(_).then(nt=>{if(nt)switch(j){case"arraybuffer":return nt.arrayBuffer();case"blob":return nt.blob();case"document":return nt.text().then(st=>new DOMParser().parseFromString(st,et??"text/html"));case"json":return nt.json();default:if(et===void 0)return nt.text();{const st=/charset="?([^;"\s]*)"?/i.exec(et),at=st&&st[1]?st[1].toLowerCase():void 0,ct=new TextDecoder(at);return nt.arrayBuffer().then(dt=>ct.decode(dt))}}}):c.get(_),g.CtF.add=async(_,j,et)=>{if(!et)return c.add(_,j);_.startsWith("data:")||_.startsWith("blob")||_.startsWith("chrome-extension")||(await o.match(_)&&await o.delete(_),await o.put(_,new Response(j,{status:200})))},g.CtF.remove=(_,j)=>{if(!j)return c.remove(_);o.delete(_)}}this.storage=o,this._importer=e,this._materials=i}async addAsset(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importAsset(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}async addFromPath(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importPath(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}addProcessedAssets(e,i){return e.map(s=>{var o;return(o=this._viewer)==null?void 0:o.scene.addSceneObject(s,i)})}async addAssetSingle(e,i={}){var s;return e?(s=await(typeof e=="string"?this.addFromPath:this.addAsset).call(this,e,i))==null?void 0:s[0]:void 0}async addImported(e,i={}){var s;return(s=this._importer)==null?void 0:s.processImported(e,i).then(o=>(this.addProcessedAssets(o,i),o))}async addImportedSingle(e,i={}){return this.addImported(e,i).then(s=>s==null?void 0:s[0])}_sceneUpdated(e){var i;if(e.type==="addSceneObject"){const s=e.object;s.assetType==="material"&&((i=this._materials)==null||i.processMaterial(s,{}))}else console.error("Unexpected")}onAdded(e){this._viewer=e,this._materials||(this._materials=new U0,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new WS(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(s,o)=>(KA(s,c=>{var _;return(_=this._materials)==null?void 0:_.processModel(c,{recursive:!1})}),s)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(s,o)=>{var c;return(c=this.materials)!=null&&c.findMaterial(s.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),s.uuid=sn(),s.userData.uuid&&(s.userData.uuid=s.uuid)),this._materials.processMaterial(s,o)}})),this._importer.Importers.push(new eu(QT,[bp.TypeSlug],!1,s=>(s&&(s.materials=this._materials),s&&(s.importer=this._importer),s)));const i=this.importViewerConfig.bind(this);this._importer.Importers.push(new eu(class extends tu{async loadAsync(s,o){return i(await super.loadAsync(s,o))}},[Fr.ViewerTypeSlug],!0))}onRemove(e){var i,s;e===this._viewer&&((i=this._importer)==null||i.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(s=this._materials)==null||s.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,i;return(i=(e=this._viewer)==null?void 0:e.getPluginByType("AssetExporterPlugin"))==null?void 0:i.exporter}get materials(){return this._materials}exportViewerConfig(e=!0,i){if(!this._viewer)return{};const s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...i},o=this._viewer.toJSON(s);return e||Object.values(s).forEach(c=>{c&&Object.values(c).forEach(_=>{_.url&&(_.url.data instanceof ArrayBuffer||Array.isArray(_.url.data))&&(_.url.type==="Uint16Array"?(_.url.data instanceof Uint16Array||(_.url.data=new Uint16Array(_.url.data)),_.url.data="data:application/octet-stream;base64,"+(0,b.arrayBufferToBase64)(_.url.data.buffer)):_.url.type==="Uint8Array"?(_.url.data instanceof Uint8Array||(_.url.data=new Uint8Array(_.url.data)),_.url.data="data:application/octet-stream;base64,"+(0,b.arrayBufferToBase64)(_.url.data.buffer)):_.url.data instanceof ArrayBuffer?_.url.data="data:application/octet-stream;base64,"+(0,b.arrayBufferToBase64)(_.url.data.buffer):console.warn("Unsupported buffer type",_.url.type))})}),o.resources=s,o}exportPluginPresets(e){var s;const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:(s=this._viewer)==null?void 0:s.serializePlugins(i,e),resources:i}}exportPluginPreset(e){if(!e.toJSON)return;const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}},s=e.toJSON(i);return s.resources=i,s}async importPluginPreset(e,i){var _;const s=e.type;if(!(i=i||((_=this._viewer)==null?void 0:_.getPluginByType(s))))return void console.warn(`No plugin found for type ${s} to import preset`);if(!i.fromJSON)return void console.warn(`Plugin ${s} does not support importing presets`);const o=e.resources||{};e.resources&&delete e.resources;const c=await this.importConfigResources(o);return await i.fromJSON(e,c),c&&(e.resources=c),i}async importViewerConfig(e,i){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const s=await this.importConfigResources(e.resources||{},i);this.applyViewerConfig(e,s)}applyViewerConfig(e,i){var s;if(this._viewer&&this._importer)if((i=i||e.resources).__isLoadedResources){this._viewer.fromJSON(e,i);for(const o of Object.values(i.materials))o.__useCount?delete o.__useCount:(s=this._materials)==null||s.unregisterMaterial(o);for(const o of Object.values(i.textures))o.__useCount&&delete o.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,i,s){var _,j,et;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const o={};Object.values(e).forEach(nt=>{nt&&Object.values(nt).forEach(st=>{if(!st||!st.url||typeof st.url.data!="string")return;const at=st.url.data.match(/^data:.*;base64,(.*)$/);at!=null&&at[1]?st.url.data=(0,b.base64ToArrayBuffer)(at==null?void 0:at[1]):(st.url.type!=="Uint8Array"&&console.error("Unsupported buffer type string for ",st.url.type,"use base64"),st.url.data=new TextEncoder().encode(st.url.data).buffer)})}),i=i??new Np(this._importer.loadingManager),o.animations=e.animations?i.parseAnimations(e.animations):{},s&&s.animations&&(o.animations={...o.animations,...s.animations}),o.shapes=e.shapes?i.parseShapes(e.shapes):{},s&&s.shapes&&(o.shapes={...o.shapes,...s.shapes}),o.geometries=e.geometries?i.parseGeometries(e.geometries,o.shapes):{},s&&s.geometries&&(o.geometries={...o.geometries,...s.geometries}),o.images=e.images?await i.parseImagesAsync(Object.values(e.images)):{},s&&s.images&&(o.images={...o.images,...s.images}),await Np.LoadRootPathTextures(e.textures,o.images,this._importer),o.textures=e.textures?i.parseTextures2(Object.values(e.textures),o.images,()=>{Object.values(o.textures).forEach(nt=>{var st;nt.isTexture&&((st=nt.image)!=null&&st.complete)&&(nt.needsUpdate=!0)})}):{};for(const nt of Object.entries(o.textures))nt[1]=(_=await this._importer.processImported(nt[1],{}))==null?void 0:_[0],nt[1]?o.textures[nt[0]]=nt[1]:delete o.textures[nt[0]];s&&s.textures&&(o.textures={...o.textures,...s.textures});const c=e.materials?Object.values(e.materials):[];for(const nt of c)Object.entries(nt).forEach(([st,at])=>{at&&at.resource&&at.uuid&&at.resource==="textures"&&(nt[st]=at.uuid)});if(o.materials=i.parseMaterials2(c,o.textures,this._materials),s&&s.materials&&(o.materials={...o.materials,...s.materials}),e.object&&(o.object=i.parseObject(e.object,o.geometries,o.materials,o.textures,o.animations),e.skeletons&&(o.skeletons=i.parseSkeletons(e.skeletons,o.object),i.bindSkeletons(o.object,o.skeletons))),e.extras){o.extras=e.extras;for(const nt of Object.values(e.extras))if(nt.uuid&&nt.url)if(typeof nt.url=="string"){const st=await((j=this._importer)==null?void 0:j.importPath(nt.url));(st==null?void 0:st.length)>0&&(o.extras[nt.uuid]=st[0])}else if(nt.url.data){const st=new File([(0,b.getTypedArray)(nt.url.type,nt.url.data)],nt.url.path),at=await((et=this._importer)==null?void 0:et.importAsset({path:st.name,file:st}));(at==null?void 0:at.length)>0&&(o.extras[nt.uuid]=at[0])}else console.warn("invalid URL type while loading extra resource")}return s&&s.extras&&(o.extras={...o.extras,...s.extras}),o.__isLoadedResources=!0,o}}Fr.PluginType="AssetManager",Fr.ViewerTypeSlug="vjson";class WT{get inputEl(){return this._inputEl}get el(){return this._el}constructor(e,i,s){this._el=e,this._inputEl=i,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),i==null||i.addEventListener("change",this._onSelect),s&&Object.entries(s).forEach(([o,c])=>c&&this.on(o,c))}on(e,i){return this._listeners[e].push(i),this}_emit(e,i){return this._listeners[e].forEach(s=>s(i)),this}destroy(){const e=this._el,i=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),i==null||i.removeEventListener("change",this._onSelect)}_onDrop(e){var o,c;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const i=Array.from(((o=e.dataTransfer)==null?void 0:o.files)||[]),s=Array.from(((c=e.dataTransfer)==null?void 0:c.items)||[]);if(i.length!==0||s.length!==0)if(s.length>0){const _=s.map(j=>j.webkitGetAsEntry());this._loadNextEntry(new Map,_)}else this._emit("drop",{files:new Map(i.map(_=>(_.filePath=_.name,[_.filePath,_])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const i=[].slice.call(this._inputEl.files??new FileList),s=new Map;i.forEach(o=>{o.filePath=o.webkitRelativePath||o.name,s.set(o.filePath,o)}),this._emit("drop",{files:s})}_loadNextEntry(e,i){const s=i.pop();if(s)if(s.isFile)s.file(o=>{o.filePath=s.fullPath,e.set(s.fullPath,o),this._loadNextEntry(e,i)},()=>console.error("Could not load file: %s",s.fullPath));else if(s.isDirectory){const o=s.createReader(),c=_=>{_.length?(i=i.concat(_),o.readEntries(c)):this._loadNextEntry(e,i)};o.readEntries(c)}else console.warn("Unknown asset type: "+s.fullPath),this._loadNextEntry(e,i);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class g0 extends b.SimpleEventDispatcher{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new g.Pa4(.5,.5,3)},this.dependencies=[Fr],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]},{label:"Select local file",type:"button",value:()=>this.promptForFile()}]}}onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new WT(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var c,_,j;if(!e)return;const i=this._viewer;if(!i)return;if(this._allowedExtensions!==void 0)for(const et of e.keys())this._allowedExtensions.includes(((c=et.split(".").pop())==null?void 0:c.toLowerCase())??"")||e.delete(et);if(e.size<1)return;const s=i.getPlugin(Fr),o={type:"drop",files:e};if(this.importerParams.autoImport){const et={allowedExtensions:this.allowedExtensions,...this.importerParams};if(o.imported=await((_=s.importer)==null?void 0:_.importFiles(e,et)),this.importerParams.autoAdd){const nt=[...((j=o.imported)==null?void 0:j.values())??[]].flat(2).filter(st=>!!st)??[];if(o.assets=s.addProcessedAssets(nt,{...this.importerParams}),!et._rootSceneImported)for(const st of o.assets)st.modelObject&&st.modelObject.dispatchEvent({type:"select",value:st.modelObject})}}this.dispatchEvent(o)}promptForFile(){var e;(e=this._inputEl)==null||e.click()}onRemove(e){var i;(i=this._dropzone)==null||i.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(i=>"."+i).join(", "):"")}}g0.PluginType="Dropzone";var qS=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};function hw(h){return Object.getPrototypeOf(h).constructor.PluginType}class I_ extends b.SimpleEventDispatcher{get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}constructor({isAntialiased:e=!1,useRgbm:i=!0,useGBufferDepth:s=!0,screenShader:o="",...c}){super(),this.console=console,this._state=$.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(at=>this.resize()):void 0,this._lastSize=new g.FM8,this._onContextRestore=at=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=at=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this._sceneEnvironmentChanged=()=>{this._rawBackground===XS&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=at=>{var mt;if(!at||!at.object)return;const ct=at.object.__importedViewerConfig||((mt=at.object.modelObject)==null?void 0:mt.__importedViewerConfig);if(!ct)return;const dt=this.getManager();dt?dt.applyViewerConfig(ct,ct.resources):this.fromJSON(ct,ct.resources)},this.alert=async at=>alert(at),this.confirm=async at=>confirm(at),this.prompt=async(at,ct,dt=!0)=>prompt(at,ct),this._useRgbm=i,this._useGBufferDepth=s,this._screenShader=o,this._canvas=c.canvas||(0,b.createCanvasElement)();let _=c.container;if(_&&!c.canvas&&_.appendChild(this._canvas),_||(_=this._canvas.parentElement??void 0),!_)throw new Error("No container.");this._container=_,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){var yt;const at=window.location.href,ct="https://dev-sandbox.pixotronics.com/webgi/";if(!at.startsWith(ct)||(0,b.getUrlQueryParam)("noUpdate")!==null)return!0;const dt=(yt=at.match(/\/webgi\/([0-9.a-zA-Z-]+)/))==null?void 0:yt[1],mt=(await(await fetch(ct+"version.txt")).text()).split(`
`)[0];if(dt&&dt!==mt){if(confirm(`New version ${mt} is available, do you want to open?`)){const wt=window.location.href.replace(dt,mt);return window.location.href=wt,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const j=new zu(void 0,void 0,this._canvas);j.autoLookAtTarget=!0,this.addEventListener("postFrame",()=>{var ct,dt;const at=nt.scene.activeCamera;if(at&&at.interactionsEnabled){const mt=(ct=this.getPluginByType("Progressive"))==null?void 0:ct.postFrameConvergedRecordingDelta();if(mt!==void 0&&mt===0)return;(dt=at.controls)==null||dt.update()}}),this.scene=new gu(j),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new Ko({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,colorSpace:i?rr:g.aCh,type:i?g.ywz:g.cLu,depthBuffer:!s,generateMipmaps:!!e,minFilter:e?g.FDw:g.wem}}),this._isAntialiased=e&&this._renderer.isWebGL2;let et=!0;this._renderer.rendererObject.userData||(et=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!et;const nt=this;this.renderFilter={passId:"render",passObject:new XA(this,et),update(){const at=this.passObject;at.scene=nt.scene.modelObject,at.camera=nt.scene.renderCamera.cameraObject}};const st={passId:"screen",after:["render"],required:["render"],passObject:JD(o)};[this.renderFilter,st].forEach(at=>this._renderer.registerPass(at)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("textureUpdate",at=>this.setDirty(this.scene,at)),this.scene.addEventListener("sceneMaterialUpdate",at=>this.setDirty(this.scene,at)),this.scene.addEventListener("sceneUpdate",at=>{this.setDirty(this.scene,at),at.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",at=>this.setDirty(this.scene,at)),this._renderer.addEventListener("update",at=>this.setDirty(this._renderer,at)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.scene.setBackgroundColor("#ffffff"),c.assetManager&&this.addPluginSync(new Fr(void 0,void 0,typeof c.assetManager=="boolean"?{}:c.assetManager)),c.dropzone&&this.addPluginSync(new g0),this.console.log("WebGi Viewer instance initialized, version: ",I_.VERSION)}setDirty(e,i){this._needsReset=!0,e=e??this,this.dispatchEvent({...i??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;for(const i of[...Object.values(this.plugins)])this.removePlugin(i,!0);this.scene.dispose(),this.renderer.dispose(),this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)==null||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_renderEnabledChanged(){this.dispatchEvent({type:this.renderEnabled?"renderEnabled":"renderDisabled"})}_animationLoop({time:e,deltaTime:i,xrFrame:s}){var o,c;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let _=0;_<this.maxFramePerLoop;_++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const nt=[this._canvas.clientWidth,this._canvas.clientHeight];if(s){const st=(c=(o=this._renderer.rendererObject.xr.getCamera())==null?void 0:o.cameras[0])==null?void 0:c.viewport;st?(st.x===0&&st.y===0||this.console.warn("x and y must be 0?"),nt[0]=st.width,nt[1]=st.height,this.console.log("resize for xr",nt)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...nt),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:i,xrFrame:s});const j=Object.values(this.plugins).filter(nt=>nt.dirty);j.length>0&&this.setDirty(j),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const et=this._renderer.dirty;if(et){this.dispatchEvent({type:"preRender",target:this});try{this.scene.renderCamera=this.scene.activeCamera,this._renderer.render(!0)}catch(nt){this.console.error(nt),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!et)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return typeof e=="string"?this.getPluginByType(e):this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async getOrAddPlugin(e,...i){return this.getPlugin(e)||this.addPlugin(e,...i)}getOrAddPluginSync(e,...i){return this.getPlugin(e)||this.addPluginSync(e,...i)}async addPlugin(e,...i){let s;if(e.prototype){const c=this.getPlugin(e);if(c)return console.error(`Plugin of type ${hw(c)} already exists, no new plugin created`,c),c;s=new e(...i)}else s=e;const o=hw(s);if(!o)return this.console.error("PluginType is not defined for",s),s;for(const c of s.dependencies||[])await this.getOrAddPlugin(c);return this.plugins[o]&&(this.console.error(`Plugin of type ${o} already exists, old plugin will be removed and disposed`,this.plugins[o],s),await this.removePlugin(this.plugins[o],!0)),this.plugins[o]=s,await s.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:s}),this.setDirty(s),s}addPluginSync(e,...i){let s;if(e.prototype){const c=this.getPlugin(e);if(c)return console.error(`Plugin of type ${hw(c)} already exists, no new plugin created`,c),c;s=new e(...i)}else s=e;const o=hw(s);if(!o)return this.console.error("PluginType is not defined for",s),s;for(const c of s.dependencies||[])this.getOrAddPluginSync(c);return this.plugins[o]&&(this.console.error(`Plugin of type ${o} already exists, old plugin will be removed and disposed`,this.plugins[o],s),this.removePluginSync(this.plugins[o],!0)),this.plugins[o]=s,s.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:s}),this.setDirty(s),s}async addPlugins(e){for(const i of e)await this.addPlugin(i)}async addPluginsSync(e){for(const i of e)this.addPluginSync(i)}async removePlugin(e,i=!0){const s=hw(e);this.plugins[s]&&(await e.onRemove(this),delete this.plugins[s],i&&e.onDispose&&await e.onDispose(this),this.setDirty(e))}removePluginSync(e,i=!0){const s=hw(e);this.plugins[s]&&(e.onRemove(this),delete this.plugins[s],i&&e.onDispose&&e.onDispose(this),this.setDirty(e))}createCamera(e){const i=e.userData.iCamera??new zu(e,{controlsMode:"",aspect:"auto"},this._canvas);return e.userData.autoLookAtTarget===void 0?(i.autoLookAtTarget=!1,e.userData.autoLookAtTarget=!1):i.autoLookAtTarget=e.userData.autoLookAtTarget,i}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}async doOnce(e,i){return new Promise(s=>{const o=async(...c)=>{this.removeEventListener(e,o),s(await(i==null?void 0:i(...c)))};this.addEventListener(e,o)})}setBackgroundColor(e){return console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackgroundColor instead."),this.setBackgroundColor(e)}setBackground(e){if(console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackground instead."),this._rawBackground=e,e==null||typeof e!="string"&&typeof e!="number"&&!e.isColor)!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode");else if(e===XS)return this.scene.setBackground("environment");!e||e!=null&&e.isTexture?(this.scene.setBackground(e),e||this.scene.setBackgroundColor(e)):this.scene.setBackgroundColor(e)}getBackground(e=!1){if(console.warn("viewer.getBackground is deprecated, use viewer.scene.background instead."),e)return this._rawBackground;let i=this._rawBackground??this.scene.getBackground();return i?(i!=null&&i.isVector4&&(i=DS(i,7).getHexString()),i!=null&&i.isColor?i.getHexString():this._rawBackground===XS?this.scene.getEnvironment():i):null}getManager(){return this.getPluginByType("AssetManager")||this.addPluginSync(Fr)}resetCamera({rootObject:e,centerOffset:i=new g.Pa4(1,1,1),targetOffset:s=new g.Pa4(0,0,0),...o}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const c=e?new Wt().expandByObject(e,!0,!0):this.scene.getBounds(!0),_=c.getCenter(new g.Pa4),j=.5*c.getSize(new g.Pa4).length();_.add(s.clone().multiplyScalar(j)),this.scene.activeCamera.position=new g.Pa4(_.x+i.x*j,_.y+i.y*j,_.z+i.z*j),this.scene.activeCamera.target=_,this.setDirty()}}async fitToView(e,i=1.5,s,o){var _;const c=this.getPluginByType("CameraViews");c?await(c==null?void 0:c.animateToFitObject(e,i,s,o,{min:(((_=this.scene.activeCamera.getControls())==null?void 0:_.minDistance)??.5)+.5,max:1e3})):this.console.error("CameraViews plugin is required for fitToView to work")}async createObject3D(e){var i;return(i=this.getManager())==null?void 0:i.addImportedSingle(e||new g.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,i){var s,o,c,_;if(i!=null&&i.isMaterial){const j=(o=(s=this.getManager())==null?void 0:s.materials)==null?void 0:o.findMaterial(i.uuid);if(j)return j}return(_=(c=this.getManager())==null?void 0:c.materials)==null?void 0:_.generateFromTemplate(e,i)}serializePlugins(e,i){return Object.entries(this.plugins).map(s=>{var o,c;if(!i||i.includes(s[1].constructor.PluginType))return s[1].serializeWithViewer!==!1?(c=(o=s[1]).toJSON)==null?void 0:c.call(o,e):void 0}).filter(s=>!!s)}deserializePlugins(e,i){return e.forEach(s=>{var c;if(!s.type)return void this.console.warn("Invalid plugin to import ",s);const o=this.getPluginByType(s.type);o&&((c=o.fromJSON)==null||c.call(o,s,i))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,i){const s=Object.assign({version:I_.VERSION,type:"ViewerApp",metadata:{generator:"WebGiViewerApp",version:1},plugins:this.serializePlugins(e,i)},Ls(this,!0,e));return s.backgroundIntensity=this.scene.backgroundIntensity,s.useLegacyLights=this.renderer.useLegacyLights,s.background=s.scene.background||s.scene.backgroundColor,s.background==="environment"&&(s.background="envMapBackground"),s}fromJSON(e,i){var o,c,_,j,et;const s={...e};return s.backgroundIntensity!==void 0&&((o=s.scene)==null?void 0:o.backgroundIntensity)===void 0&&(this.console.warn("old file format, backgroundIntensity moved to RootScene"),this.scene.backgroundIntensity=s.backgroundIntensity,delete s.backgroundIntensity),s.useLegacyLights!==void 0&&((c=s.renderManager)==null?void 0:c.useLegacyLights)===void 0&&(this.console.warn("old file format, useLegacyLights moved to BaseRenderer"),this.renderer.useLegacyLights=s.useLegacyLights,delete s.useLegacyLights),s.background!==void 0&&((_=s.scene)==null?void 0:_.background)===void 0&&(this.console.warn("old file format, background moved to RootScene"),s.background==="envMapBackground"?s.background="environment":typeof s.background=="number"?s.background=new To().setHex(s.background,g.GUF):typeof s.background=="string"?s.background=new To().setStyle(s.background,g.GUF):(j=s.background)!=null&&j.isColor&&(s.background=new To(s.background)),(et=s.background)!=null&&et.isColor?(this.scene.backgroundColor=s.background,this.scene.background=null):s.background?(this.scene.backgroundColor=new To("#ffffff"),s.scene.background=s.background):(this.scene.backgroundColor=null,this.scene.background=null),delete s.background),ao(s,this,!0,i),Array.isArray(s.plugins)&&this.deserializePlugins(s.plugins,i),this}get renderManager(){return this._renderer}get assetManager(){return this.getManager()}async load(e,i){if(e)return await this.assetManager.addAssetSingle(e,i)}async setEnvironmentMap(e,{setBackground:i=!1,...s}={}){return this.scene.environment=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,s)||null:e||null,i?this.setBackgroundMap(this.scene.environment):this.scene.environment}async setBackgroundMap(e,{setEnvironment:i=!1,...s}={}){return this.scene.background=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,s)||null:e||null,i?this.setEnvironmentMap(this.scene.background):this.scene.background}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void this.console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}I_.VERSION="0.9.1",qS([En("renderManager")],I_.prototype,"_renderer",void 0),qS([En()],I_.prototype,"scene",void 0),qS([(0,b.onChange)(I_.prototype._renderEnabledChanged)],I_.prototype,"renderEnabled",void 0);const XS="envMapBackground";function JD(h){return h!=null&&h.isShaderPass2?h:new yo({...tt,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(h)?h[0]:(h==null?void 0:h.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(h)?h[1]:typeof h=="string"?h:(h==null?void 0:h.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}class ZD extends yo{constructor(e){super({vertexShader:tt.vertexShader,uniforms:{tDiffuse:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},tTransparent:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                    
                    gl_FragColor.rgb *= gl_FragColor.a; // premultiply alpha
                }
                `},"tDiffuse","tTransparent"),this.uiConfig=void 0,this.material.transparent=!1,this.material.side=g.Wl3}render(e,i,s,o,c){super.render(e,i,s,o,c),this._lastReadBuffer=s,this.needsSwap=!0}reRender(e,i,s,o){this._lastReadBuffer&&this.render(e,i,this._lastReadBuffer,s,o)}dispose(){this._lastReadBuffer=void 0,super.dispose()}}class Lv extends t_{get renderToScreen(){return this._renderToScreen}constructor(e=!0,i=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[zo],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render","screen"],this._requiredFilters=["render"],this._renderToScreen=!0,this._postFrame=()=>{var s,o;this._needsReRender&&this._renderToScreen&&this._viewer&&this.pass&&(this._needsReRender=!1,(o=(s=this.pass).update)==null||o.call(s),this.pass.passObject.reRender(this._viewer.renderer.rendererObject,null))},this._needsReRender=!1,this._setDirty=this._setDirty.bind(this),this._renderToScreen=i}async onAdded(e){var i,s;return(s=(i=this._viewer)==null?void 0:i.screenShader)!=null&&s.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&(0,b.safeSetProperty)(e.renderer.passes.find(o=>o.passId==="screen"),"enabled",!1,!0,!0),e.addEventListener("postFrame",this._postFrame),super.onAdded(e)}async onRemove(e){return this._renderToScreen&&(0,b.safeSetProperty)(e.renderer.passes.find(i=>i.passId==="screen"),"enabled",!0,!0,!0),super.onRemove(e)}passCtor(e){var c,_;const i=e.screenShader,s=["",""];this._renderToScreen&&!i.isShaderPass2&&(s[0]=Array.isArray(i)?i[0]:(i==null?void 0:i.pars)||"",s[1]=Array.isArray(i)?i[1]:typeof i=="string"?i:(i==null?void 0:i.main)||"");const o=new ZD(s);return(0,b.safeSetProperty)((_=(c=o.uiConfig)==null?void 0:c.children)==null?void 0:_.find(j=>(j==null?void 0:j.label)==="Enabled"),"hidden",!0,!0),o}_update(e){var i,s,o;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((i=this._viewer)==null?void 0:i.getPlugin(zo)),this._pass.passObject.material.uniforms.tTransparent.value=((o=(s=this._viewer)==null?void 0:s.renderFilter.passObject.transparentTarget)==null?void 0:o.texture)||null,!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,i;return((i=(e=this.pass)==null?void 0:e.passObject)==null?void 0:i.uiConfig)??{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}reRender(){this._renderToScreen?this._needsReRender=!0:this._setDirty()}}Lv.PluginType="CombinedPostPlugin";var f2=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class ty extends ms{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Lv]}get uiConfig(){var e;return(e=this._extension)==null?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var i;await super.onAdded(e),this._extension=this.generateExtension(e),(i=e.getPlugin(Lv))==null||i.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}function YS(h,e,i){return h&~(1<<e)|(i?1:0)<<e}function m2(h,e){return h&~(1<<e)}f2([En("extension")],ty.prototype,"_extension",void 0),f2([En()],ty.prototype,"enabled",void 0);var _0,ny=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};const qT=g.dZ3;let iv=_0=class{constructor(h,e=!0){this.depthTonemap=e,this.toneMapping=g.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this.saturation=1,this.contrast=1,this.renderDepth=!1,this.enabled=!0,this._rendererState={},this.extraUniforms={opacity:{value:1},toneMappingContrast:{value:1},toneMappingSaturation:{value:1}},this.parsFragmentSnippet=(i,s)=>this.enabled?b.glsl`
            ${this.depthTonemap?Zp:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            uniform float toneMappingContrast;
            uniform float toneMappingSaturation;
            ${`int getToneMapBit(in int number){
#ifdef WebGL2Context
return(number/2)%2;
#else
return int(mod(floor(float(number)/2.),2.));
#endif
}vec3 TonemappingSaturation(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);vec3 intensity=vec3(dot(rgb,W));return mix(intensity,rgb,toneMappingSaturation);}vec3 TonemappingContrast(vec3 color){return(color-vec3(0.5))*toneMappingContrast+vec3(0.5);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getToneMapBit(getGBufferFlags(vUv).a)>0;float depth=getDepth(vUv);vec4 transparentCol=tTransparentTexelToLinear(texture2D(tTransparent,vUv));
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.99&&transparentCol.a<0.001;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);outColor.rgb=TonemappingContrast(outColor.rgb);outColor.rgb=TonemappingSaturation(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;if(depth>0.99&&transparentCol.a>=0.001)outColor.a=transparentCol.a;
#endif
if(depth<0.00001)outColor.a=0.;
#if defined(DEBUG_DEPTH) && DEBUG_DEPTH > 0
outColor.rgb=vec3(sRGBToLinear(vec4((1.-depth))).x);
#endif
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=h.getPlugin(Lv),this._setDirty=this._setDirty.bind(this),this.depthTonemap=e}shaderExtender(h,e,i){this.enabled&&(h.fragmentShader=os(h.fragmentShader,"#glMarker",`
gl_FragColor = ToneMapping(gl_FragColor);
`,{prepend:!0}))}onObjectRender(h,e,i){if(!this.enabled)return;const{toneMapping:s,toneMappingExposure:o,outputColorSpace:c}=i;this._rendererState.toneMapping=s,this._rendererState.toneMappingExposure=o,this._rendererState.outputColorSpace=c;let _=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==_&&(e.materialObject.defines.TONEMAP_BACKGROUND=_,e.materialObject.needsUpdate=!0),_=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==_&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=_,e.materialObject.needsUpdate=!0),_=this.renderDepth?"1":"0",e.materialObject.defines.DEBUG_DEPTH!==_&&(e.materialObject.defines.DEBUG_DEPTH=_,e.materialObject.needsUpdate=!0),i.toneMapping=this.toneMapping,i.toneMappingExposure=this.exposure,i.outputColorSpace=g.KI_,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0,this.extraUniforms.toneMappingContrast.value=this.contrast,this.extraUniforms.toneMappingSaturation.value=this.saturation}onAfterRender(h,e,i){i.toneMapping=this._rendererState.toneMapping,i.toneMappingExposure=this._rendererState.toneMappingExposure,i.outputColorSpace=this._rendererState.outputColorSpace}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)==null||h.call(this),this._setDirty()}};iv.PluginType="Tonemap",ny([Pm("Mode",[["Linear",g.EoG],["Reinhard",g.CdI],["Cineon",g.YGz],["ACESFilmic",g.LY2],["Uncharted2",qT]].map(h=>({label:h[0],value:h[1]})),{limitedUi:!0}),(0,b.onChange)(_0.prototype._setDirty),En()],iv.prototype,"toneMapping",void 0),ny([(0,b.onChange)(_0.prototype._setDirty),jr("Tonemap Background",{limitedUi:!0}),En()],iv.prototype,"tonemapBackground",void 0),ny([(0,b.onChange)(_0.prototype._setDirty),jr("Clip Background"),En()],iv.prototype,"clipBackground",void 0),ny([(0,b.onChange)(_0.prototype._setDirty),ns("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),En()],iv.prototype,"exposure",void 0),ny([(0,b.onChange)(_0.prototype._setDirty),ns("Saturation",[0,2],.01,{limitedUi:!0}),En()],iv.prototype,"saturation",void 0),ny([(0,b.onChange)(_0.prototype._setDirty),ns("Contrast",[0,2],.01,{limitedUi:!0}),En()],iv.prototype,"contrast",void 0),ny([(0,b.onChange)(_0.prototype._setDirty),jr("Render Depth")],iv.prototype,"renderDepth",void 0),iv=_0=ny([ks("Tonemapping")],iv);class Rx extends ty{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(e,i){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,i)}async onAdded(e){var i;await super.onAdded(e),(i=e.getPlugin(zo))==null||i.registerGBufferUpdater(this.updateGBuffer)}generateExtension(e){return new iv(e,this.depthTonemap)}get exposure(){var e;return((e=this._extension)==null?void 0:e.exposure)??1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get saturation(){var e;return((e=this._extension)==null?void 0:e.saturation)??1}set saturation(e){this._extension&&(this._extension.saturation=e,this._extension.setDirty())}get contrast(){var e;return((e=this._extension)==null?void 0:e.contrast)??1}set contrast(e){this._extension&&(this._extension.contrast=e,this._extension.setDirty())}get toneMapping(){var e;return((e=this._extension)==null?void 0:e.toneMapping)??g.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}updateGBuffer(e,i){var s,o;if(e instanceof g.Kj0&&((s=e.material)!=null&&s.userData)){const c=((o=e.material)==null?void 0:o.userData.postTonemap)===!1?0:1;i.w=YS(i.w,1,c)}}}Rx.PluginType="Tonemap",g.WdD.tonemapping_pars_fragment=g.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var K1,$S=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let dw=K1=class{constructor(h){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?b.glsl`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=h.getPlugin(Lv),this._setDirty=this._setDirty.bind(this)}shaderExtender(h,e,i){this.enabled&&(h.fragmentShader=os(h.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(h,e,i){this.enabled&&(e.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)==null||h.call(this),this._setDirty()}};dw.PluginType="ChromaticAberration",$S([(0,b.onChange)(K1.prototype._setDirty),jr("Enable"),En()],dw.prototype,"enabled",void 0),$S([(0,b.onChange)(K1.prototype._setDirty),ns("Intensity",[0,.1],.001,{limitedUi:!0}),En()],dw.prototype,"aberrationIntensity",void 0),dw=K1=$S([ks("ChromaticAberration")],dw);class Dx extends ty{constructor(){super()}generateExtension(e){return new dw(e)}get intensity(){var e;return((e=this._extension)==null?void 0:e.aberrationIntensity)??1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}Dx.PluginType="ChromaticAberration";class v0 extends ms{get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}constructor(){super(),this._pipeline=[]}async onAdded(e){await super.onAdded(e);const i=this.createPasses(e);this._passes=Object.fromEntries(i.map(s=>(s.passId||(console.warn("no id found for pass",s),s.passId=Bp()),e.renderer.registerPass(s,!0),[s.passId,s])))}async onRemove(e){var i;if(this._passes){for(const s of[...Object.values(this._passes)]){const o=s;e.renderer.unregisterPass(o),(i=o==null?void 0:o.dispose)==null||i.call(o)}this._passes=void 0}await super.onRemove(e)}toJSON(e){const i=super.toJSON(e);if(!i.type)return i;const s=Object.entries(this.passes);i.passes={};for(const[o,c]of s)i.passes[o]=Ls((c==null?void 0:c.passObject)??c,!1,e);return i}fromJSON(e,i){if(!super.fromJSON(e,i))return null;if(e.passes){const s=Object.entries(this.passes);for(const[o,c]of s)ao(e.passes[o],(c==null?void 0:c.passObject)??c,!1,i)}return this}}var dp=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class Gu extends yo{constructor(e,i,s="rgba"){super({vertexShader:tt.vertexShader,fragmentShader:i+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new g.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new g.FM8}},defines:{B_SRC_ACCESSOR:s}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,i,s,o,c){var _,j,et,nt;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((_=this.uniforms.tDiffuse.value)==null?void 0:_.image.width)||0,((j=this.uniforms.tDiffuse.value)==null?void 0:j.image.height)||0),super.render(e,i,this._target,o,c),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=i.texture,this.uniforms.tDiffuseSize.value.set(((et=this.uniforms.tDiffuse.value)==null?void 0:et.image.width)||0,((nt=this.uniforms.tDiffuse.value)==null?void 0:nt.image.height)||0),super.render(e,this._target,i,o,c))}}dp([En(),cr()],Gu.prototype,"smoothEnabled",void 0),dp([En(),cr()],Gu.prototype,"edgeSharpness",void 0);var Lm="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",Nv=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,J1=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,g2=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class XT extends yo{constructor(e,i,s){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},screenSize:{value:new g.FM8(512,512)},saoData:{value:new g.Ltg},frameCount:{value:0},cameraNearFar:{value:new g.FM8(.1,1e3)},projection:{value:new g.yGw},saoBiasEpsilon:{value:new g.Pa4(1,1,1)}},vertexShader:Lm,fragmentShader:`

${Nv}

${s}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);int getSelectionBit(in int number){
#ifdef WebGL2Context
return(number/4)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;bool disableAO=getSelectionBit(getGBufferFlags(vUv).a)>0?true:false;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(o,c,_)=>{o.defines.SSAO_ENABLED&&(o.fragmentShader=o.fragmentShader.replace("#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#else
#include <aomap_fragment>
#endif
#endif
`))},onObjectRender:(o,c,_)=>{var st,at;this.materialExtension.extraUniforms.tSSAOMap.value=(st=this._target)==null?void 0:st.texture;const j=c.materialObject,et=!j.transparent&&j.transmission<.001;let nt=this.enabled&&et&&_.userData.screenSpaceRendering!==!1&&!((at=c.userData)!=null&&at.ssaoDisabled)?1:0;j.defines.SSAO_ENABLED!==nt&&(j.defines.SSAO_ENABLED=nt,j.needsUpdate=!0),nt=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==nt&&(this.materialExtension.extraUniforms.tSSAOMap.value=nt,j.needsUpdate=!0)},parsFragmentSnippet:o=>{var c;return b.glsl`
             uniform sampler2D tSSAOMap;
             ${dn("tSSAOMap",(c=this._target)==null?void 0:c.texture,o.capabilities.isWebGL2)}
            ${J1}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:o=>{var c,_;return this.enabled?"1":"0"+((_=(c=this._target)==null?void 0:c.texture)==null?void 0:_.colorSpace)},isCompatible:o=>{var c;return!((c=o.materialObject.userData)!=null&&c.ssaoDisabled)&&o.isMeshStandardMaterial2}},this._renderer=e,this._target=i,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new Gu(this._target,s,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,i,s,o,c){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,i,{}),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,o,c),this._smoothEnabled&&this.bilateralPass.render(e,i,s,o,c))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const i=this.material.uniforms.saoBiasEpsilon.value;i.x=this.parameters.bias,i.y=.001,i.z=this.parameters.falloff}}g2([En()],XT.prototype,"bilateralPass",void 0),g2([En()],XT.prototype,"parameters",void 0);class Z1 extends v0{get aoTarget(){return this._aoTarget}constructor(){super(),this.dependencies=[Fr,zo],this.setDirty=this.setDirty.bind(this)}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var i;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[Rl(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new XT(e.renderer,this._aoTarget,((i=e.getPlugin(zo))==null?void 0:i.getUnpackSnippet())??""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(zo)])}},()=>[e.getPlugin(zo),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get enabled(){var e,i;return((i=(e=this.passes.ssao)==null?void 0:e.passObject)==null?void 0:i.enabled)||!1}set enabled(e){var i;(i=this.passes.ssao)!=null&&i.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var s;if(this._uiConfig)return this._uiConfig;const e=this,i=e.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[i,"enabled"],onChange:e.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[i.parameters,"intensity"],onChange:e.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[i.parameters,"occlusionWorldRadius"],onChange:e.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[i.parameters,"bias"],onChange:e.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[i.parameters,"falloff"],onChange:e.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(s=i.material)==null?void 0:s.defines,"NUM_SAMPLES"],onChange:[()=>i.material.needsUpdate=!0,e.setDirty]},{type:"checkbox",property:[i.bilateralPass,"smoothEnabled"],onChange:e.setDirty},{type:"vec4",property:[i.bilateralPass,"edgeSharpness"],onChange:e.setDirty}]}}}Z1.PluginType="SSAO";var pw,ry=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Uv=pw=class extends yo{constructor(){super({vertexShader:tt.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new g.FM8},weight:{value:1},tNormalDepth:{value:null},tGBufferFlags:{value:null}},fragmentShader:Zp+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}int getBloomBit(in int number){
#ifdef WebGL2Context
return(number/4)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}void main(){
#if PASS_STEP == 0 
int doBloom=getBloomBit(getGBufferFlags(vUv).a);gl_FragColor=float(doBloom)*weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new g.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(h,e,i,s,o){const c=h.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const _=i;let j=.5,et=_.width*j,nt=_.height*j;const st=[];let at=c.getTempTarget({sizeMultiplier:1,type:g.cLu});st.push(at);let ct=_;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(h,at,ct,s,o),ct=at;let dt=1;for(;dt<this.bloomIterations&&(et/=2,nt/=2,j/=2,!(nt<2||et<2));dt++){at=c.getTempTarget({sizeMultiplier:j,type:g.cLu}),st.push(at),this.material.defines.PASS_STEP=1;let yt=this._weights[dt];yt=this._weights[dt-1]!==0?this._weights[dt]/this._weights[dt-1]:this._weights[dt],this.material.uniforms.weight.value=yt,this.material.needsUpdate=!0,super.render(h,at,ct,s,o),ct=at}this.clear=!1;const mt=h.autoClear;for(h.autoClear=!1,dt-=2;dt>=0;dt--)at=st[dt],st[dt]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=g.WMw,this.material.needsUpdate=!0,h.autoClear=!1,super.render(h,at,ct,s,o),this.material.blending=g.jFi,c.releaseTempTarget(ct),ct=at;this.clear=!0,h.autoClear=mt,h.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(h,e,ct,s,o)):(this.uniforms.tSource.value=_.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(h,e,ct,s,o),this.uniforms.tSource.value=null),c.releaseTempTarget(ct)}_updateWeights(){if(!this._weights)return;const h=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let i=0;i<this.bloomIterations;i++){let s=i*e+.1,o=1.2-s;s=Math.pow(s,this.power),o=Math.pow(o,this.power),this._weights[i]=o*(1-h)+s*h}this.setDirty()}};function _2(h){const e=h==null?void 0:h.userData;return!!e&&(e[P_.PluginType]||(e[P_.PluginType]={}),e[P_.PluginType].enable=!0,h.isMaterial&&(h.needsUpdate=!0),!0)}ry([cr()],Uv.prototype,"prefilter",void 0),ry([ns("Threshold",[0,2]),(0,b.onChange)(pw.prototype._thresholdsUpdated),En()],Uv.prototype,"threshold",void 0),ry([ns("Soft Threshold",[0,1]),(0,b.onChange)(pw.prototype._thresholdsUpdated),En()],Uv.prototype,"softThreshold",void 0),ry([ns("Intensity",[0,3]),En(),cr()],Uv.prototype,"intensity",void 0),ry([ns("Iterations",[0,7],1),(0,b.onChange)(pw.prototype._updateWeights),En()],Uv.prototype,"bloomIterations",void 0),ry([ns("Radius",[0,1],.01),(0,b.onChange)(pw.prototype._updateWeights),En()],Uv.prototype,"radius",void 0),ry([ns("Power",[.2,10],.01),(0,b.onChange)(pw.prototype._updateWeights),En()],Uv.prototype,"power",void 0),ry([jr("Debug")],Uv.prototype,"bloomDebug",void 0),Uv=pw=ry([ks("Bloom")],Uv);class P_ extends t_{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"],this.materialExtension={uuid:Bp(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const i=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=i,i},isCompatible:e=>!0}}setDirty(){this.pass.dirty=!0}_getUiConfig(e){const i={type:"folder",label:"Bloom",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=e.materialObject.userData[P_.PluginType])==null?void 0:s.enable)??!0},set value(s){var c;const o=e.materialObject.userData[P_.PluginType];s!==(o==null?void 0:o.enable)&&(o||_2(e.materialObject),e.materialObject.userData[P_.PluginType].enable=s,(c=i.uiRefresh)==null||c.call(i,"postFrame",!0))},onChange:this.setDirty}]};return i}passCtor(e){const i=new Uv;return this.updateGBuffer=this.updateGBuffer.bind(this),this.setDirty=this.setDirty.bind(this),i}async onAdded(e){var s,o;await super.onAdded(e),(s=e.getPlugin(zo))==null||s.registerGBufferUpdater(this.updateGBuffer);const i=e.getPlugin(Fr);(o=i==null?void 0:i.materials)==null||o.registerMaterialExtension(this.materialExtension)}updateGBuffer(e,i){var s,o;if(e instanceof g.Kj0&&((s=e.material)!=null&&s.userData)){const c=(o=e.material)==null?void 0:o.userData[P_.PluginType],_=(c==null?void 0:c.enable)===!1?0:1;i.w=YS(i.w,2,_)}}_update(e){var i,s;return(s=e.getPlugin(zo))==null||s.updateShaderProperties((i=this.pass)==null?void 0:i.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}P_.PluginType="Bloom";var v2="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",kx=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};const y2={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new g.FM8},cameraNearFar:{value:new g.FM8}},vertexShader:Lm,fragmentShader:Zp+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},_k=(Gs({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new g.FM8},direction:{value:new g.FM8}},vertexShader:Lm,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),Gs({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new g.FM8},direction:{value:new g.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:Lm,fragmentShader:Nv+`
`+v2+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class tA extends yo{constructor(){super(y2,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=_k,this.nearFarBlurScale=new g.FM8(.25,.25),this.focalDepthRange=new g.FM8(.5,1.5),this.crossCenter=new g.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new To(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=Gs({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:Lm,fragmentShader:Zp+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=Gs({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new g.FM8},direction:{value:new g.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:Lm,fragmentShader:Zp+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,i,s,o,c){if(!this.enabled)return;const _=e.baseRenderer,j={minFilter:g.TyD,magFilter:g.TyD,type:g.cLu,encoding:g.rnI,sizeMultiplier:.5,isAntialiased:!1,format:g.wk1,depthBuffer:!1,generateMipmaps:!1},et=_.getTempTarget(j),nt=_.getTempTarget(j);if(this.computeCocMaterial.uniforms.colorTexture.value=s.texture,_.blit(void 0,et,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=et.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),_.blit(void 0,nt,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=nt.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),_.blit(void 0,et,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=et.texture,_.blit(void 0,nt,{material:this.dofBlurMaterial});else{const st=_.getTempTarget(j);this.dofBlurMaterial.uniforms.cocTexture.value=et.texture,this.dofBlurMaterial.uniforms.colorTexture.value=et.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),_.blit(void 0,st,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=st.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),_.blit(void 0,nt,{material:this.dofBlurMaterial}),_.releaseTempTarget(st)}this.material.uniforms.blurTexture.value=nt.texture,this.material.uniforms.cocTexture.value=et.texture,super.render(e,i,s,o,c),_.releaseTempTarget(et),_.releaseTempTarget(nt)}}kx([En(),cr()],tA.prototype,"nearFarBlurScale",void 0),kx([En(),cr()],tA.prototype,"focalDepthRange",void 0),kx([cr()],tA.prototype,"crossCenter",void 0),kx([cr()],tA.prototype,"crossRadius",void 0),kx([cr()],tA.prototype,"crossAlpha",void 0),kx([cr()],tA.prototype,"crossColor",void 0);class YT extends yo{constructor(e){super({vertexShader:tt.vertexShader,fragmentShader:b.glsl`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new g.Ltg(1,1,1,1)},weight2:{value:new g.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}var A2=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};const $T=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class Vp extends v0{constructor(e=2*$T.length){super(),this._lastFrames=new Map,this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=i=>{const s=i.object;(s.modelObject||s.lightObject)&&(s.modelObject||s.lightObject).traverse(o=>{var c;(c=o==null?void 0:o.shadow)!=null&&c.camera&&o.shadow.mapSize&&this.trackedJitterCameras.add([o.shadow.camera,o.shadow.mapSize])})},this._jitterCamera=i=>{var o;const s=i.target;if(this.jitter&&s.renderer.frameCount>1){const c=(j,et)=>{const nt={...$T[s.renderer.frameCount%$T.length]};j.setViewOffset(et.width,et.height,nt.x,nt.y,et.width,et.height)},_=s.scene.activeCamera.cameraObject;c(_,{width:s.canvas.clientWidth*s.renderer.displayCanvasScaling,height:s.canvas.clientHeight*s.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(j=>c(...j)),this._hasSetOffset=!0,(o=this._viewer)==null||o.renderer.resetShadows()}},this._resetCameraJitter=i=>{const s=i.target;this._hasSetOffset&&(s.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=Rm("Progressive",this),this.maxFrameCount=e}async onAdded(e){return await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrames.forEach(i=>e.renderer.disposeTarget(i)),this._lastFrames.clear(),await super.onRemove(e)}get lastFrame(){var e;return this._lastFrames.get((e=this._viewer)==null?void 0:e.scene.renderCamera.cameraObject.uuid)}getLastFrame(e){return e?this._lastFrames.get(e.cameraObject.uuid):this.lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const i=this;return[Rl(e,{passId:"progressive",get dirty(){var s;return i.jitter&&(((s=i._viewer)==null?void 0:s.renderer.frameCount)||0)<i.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends YT{render(s,o,c,_,j){if(i.lastFrame){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((c==null?void 0:c.texture)&&e.renderer.blit(c.texture,i.lastFrame,{}));this.needsSwap=!0,super.render(s,o,c,_,j),e.renderer.blit(o.texture,i.lastFrame,{})}else e.console.error("lastFrame render target undefined")}},update(){if(!i.lastFrame&&e.scene.renderCamera&&i._lastFrames.set(e.scene.renderCamera.cameraObject.uuid,e.renderer.composerTarget.clone(!0)),!i.lastFrame)return void console.error("lastFrame render target undefined");let s=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(s,s,s,s),s=1-s,this.passObject.weights2.set(s,s,s,s),this.passObject.blendTexture=i.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var i;return(((i=this._viewer)==null?void 0:i.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var i;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=((i=this.lastFrame)==null?void 0:i.texture)??void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const i=this._viewer.getPluginByType(e);return i&&i.isRecording()&&i.convergeMode?this.isConverged(!0)?1/i.videoFrameRate:0:-1}}Vp.PluginType="Progressive",A2([En(),$s("Frame count")],Vp.prototype,"maxFrameCount",void 0),A2([En(),jr("Jitter")],Vp.prototype,"jitter",void 0);class iy extends t_{async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:g.wem,magFilter:g.wem,colorSpace:this._viewer.renderer.composerTarget.texture.colorSpace})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await(0,b.timeout)(e))}stopTransition(){this._fadeTimeState=0}constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[Vp],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(e.fadeDuration||1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(e.fadeDuration||200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(e.fadeDuration||500)},this._onPointerMove=e=>{var _;const i=(_=this._viewer)==null?void 0:_.canvas;if(!i)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==i)return void(this.pointerEnabled=!0);const s=i.getBoundingClientRect(),o=(e.clientX-s.left)/s.width,c=(e.clientY-s.top)/s.height;this.pointerEnabled=o<0||o>1||c<0||c>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const i=this,s=e.getPlugin(Vp),o=new class extends YT{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=Rm("Frame Fade",this)}render(c,_,j,et,nt){this.needsSwap=!1;const st=i._target;if(!st||!i.pointerEnabled||!this.enabled||!i.dirty||i._fadeTimeState<.001||e.scene.renderCamera!==e.scene.activeCamera)return;i._toSaveFrame&&s.lastFrame&&(e.renderer.blit(s.lastFrame.texture,st),this._lastTime=0,i._toSaveFrame=!1),this.blendTexture=st==null?void 0:st.texture;const at=i._fadeTimeState/i._fadeTime;this.weights2.setScalar(at),this.weights2.w=1,this.weights1.setScalar(1-at),this.weights1.w=1,super.render(c,_,j,et,nt),this.needsSwap=!0;const ct=(0,b.now)();this._lastTime<10&&(this._lastTime=ct-10);const dt=ct-this._lastTime;this._lastTime=ct,i._fadeTimeState-=dt}};return o.enabled=!0,o}setDirty(){var e;this.enabled&&((e=this._viewer)==null||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,i;return(i=(e=this.pass)==null?void 0:e.passObject)==null?void 0:i.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const i=this._disabledBy.indexOf(e);i>=0&&this._disabledBy.splice(i,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}iy.PluginType="FrameFade";var KT=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class nA extends t_{passCtor(e){return new tA}constructor(e=!0,i=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[zo],this.enableEdit=!1,this._focalPointHit=new g.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new g.Pa4,this.enabled=e,this.enableEdit=i,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}setFocalPoint(e,i=!0,s=!1){var o,c;this._focalPointHit.copy(e),i&&((c=(o=this._viewer)==null?void 0:o.getPlugin(iy))==null||c.startTransition(this._frameFadeTime)),s&&(this._focalPointHitTime=(0,b.now)()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e;return((e=this.pass)==null?void 0:e.passObject.focalDepthRange.y)??0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e;return((e=this.pass)==null?void 0:e.passObject.nearFarBlurScale.x)??0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e;return((e=this.pass)==null?void 0:e.passObject.nearFarBlurScale.y)??0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var i,s;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(s=(i=this._viewer)==null?void 0:i.getPlugin(iy))==null||s.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var i;await super.onAdded(e),(i=e.getPluginByType("Picking"))==null||i.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var i;return(i=e.getPluginByType("Picking"))==null||i.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}_update(e){var _,j;if(!super._update(e))return!1;const i=(_=this.pass)==null?void 0:_.passObject;if(!i)return!1;const s=e.getPlugin(zo);s==null||s.updateShaderProperties(i.material),i.dofBlurMaterial.uniforms.frameCount&&((j=e.renderer)==null||j.updateShaderProperties(i.dofBlurMaterial));const o=e.scene.renderCamera;if(!o)return!1;o.cameraObject.updateMatrixWorld(!0),o.updateShaderProperties(i.material),o.cameraObject.getWorldPosition(this._tempVec),this._tempVec.subVectors(this._focalPointHit,this._tempVec),i.focalDepthRange.x=this._tempVec.length(),i.focalDepthRange.x*=o.cameraObject.getWorldDirection(new g.Pa4).dot(this._tempVec.normalize());let c=((0,b.now)()-this._focalPointHitTime)/this.crossFadeTime;if(c=1-Math.min(1,Math.max(0,c)),Math.abs(c-i.crossAlpha)>.01&&(i.crossAlpha=c,this.setDirty()),c>0){const et=this._tempVec.copy(this._focalPointHit).project(o.cameraObject).addScalar(1).divideScalar(2);i.crossCenter.set(et.x,et.y),i.computeCocMaterial.uniformsNeedUpdate=!0,i.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var i,s,o,c,_;if(this._uiConfig)return this._uiConfig;const e=(s=(i=this._pass)==null?void 0:i.passObject)==null?void 0:s.uiConfig;return e?((c=(o=e.children)==null?void 0:o.map(j=>(0,b.getOrCall)(j)))==null||c.flat(2).forEach(j=>j&&(j.onChange=this.setDirty)),(_=e.children)==null||_.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=e,e):{}}}nA.PluginType="DepthOfField",KT([En()],nA.prototype,"enableEdit",void 0),KT([En("focalPoint")],nA.prototype,"_focalPointHit",void 0),KT([En()],nA.prototype,"crossFadeTime",void 0);var b2=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let R_=class extends ms{addThinFilmLayer(h){return JT(h.materialObject)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new eO(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Fr],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new g.Ltg},thinNoiseLayerFactors:{value:new g.Ltg},thinColorNoiseParams:{value:new g.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(h,e)=>{var i;return this.enabled&&((i=e==null?void 0:e.materialObject.userData._thinFilmLayer)!=null&&i.hasThinFilm)?Nv+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(h,e,i)=>{var o;if(!this.enabled||!((o=e.materialObject.userData._thinFilmLayer)!=null&&o.hasThinFilm))return;const s="#glMarker beforeAccumulation";h.fragmentShader=h.fragmentShader.replace(s,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+s),h.defines.USE_UV=""},onObjectRender:(h,e)=>{var o;const i=(o=e.materialObject.userData)==null?void 0:o._thinFilmLayer;if(!(i!=null&&i.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(i.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(i.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(i.colorNoiseParams),this._uniforms.thinFilmFactor.value=i.filmFactor;const s=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==s&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=s,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i;return(this.enabled?"1":"0")+((i=(e=h.materialObject.userData)==null?void 0:e._thinFilmLayer)!=null&&i.hasThinFilm?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2||h.isDiamondMaterial,updaters:()=>[],getUiConfig:h=>{const e=this._viewer,i={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=h.materialObject.userData._thinFilmLayer)==null?void 0:s.hasThinFilm)||!1},set value(s){var o,c;s!==((o=h.materialObject.userData._thinFilmLayer)==null?void 0:o.hasThinFilm)&&(s?JT(h.materialObject)||e.alert("Cannot add thin film."):h.materialObject.userData._thinFilmLayer&&(h.materialObject.userData._thinFilmLayer.hasThinFilm=!1,h.materialObject.needsUpdate=!0),(c=i.uiRefresh)==null||c.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var s;return!((s=h.materialObject.userData._thinFilmLayer)!=null&&s.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var s;return!((s=h.materialObject.userData._thinFilmLayer)!=null&&s.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var s;return!((s=h.materialObject.userData._thinFilmLayer)!=null&&s.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var s;return!((s=h.materialObject.userData._thinFilmLayer)!=null&&s.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var h;(h=this._viewer)==null||h.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,_;await super.onAdded(h);const e=h.getPlugin(Fr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(_=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||_.push(tO)}async onRemove(h){var e,i,s,o;return(i=(e=h.getPlugin(Fr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),(o=(s=h.getPlugin(Fr))==null?void 0:s.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};function JT(h){const e=h==null?void 0:h.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const i=e._thinFilmLayer;return i.hasThinFilm=!0,i.baseLayerFactors===void 0&&(i.baseLayerFactors=[.3,.6,1,.9]),i.noiseLayerFactors===void 0&&(i.noiseLayerFactors=[.7,.5,.9,.7]),i.colorNoiseParams===void 0&&(i.colorNoiseParams=[.5,.5,.5,.7]),i.filmFactor===void 0&&(i.filmFactor=.3),h.isMaterial&&(h.needsUpdate=!0),!0}R_.PluginType="ThinFilmLayerPlugin",R_.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",b2([jr("Enabled",h=>({onChange:h.setDirty})),En()],R_.prototype,"enabled",void 0),R_=b2([ks("ThinFilmLayer Materials")],R_);class eO{constructor(e){this.parser=e,this.name=R_.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return i.userData||(i.userData={}),JT(i),i.userData._thinFilmLayer=ao(o,i.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const tO=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;i.extensions=i.extensions||{};const s=Ls(e.userData._thinFilmLayer,!1);i.extensions[R_.THIN_FILM_LAYER_GLTF_EXTENSION]=s,h.extensionsUsed[R_.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});class eE{async apply(e,i,s){var c,_,j,et;if(!i)return void(this.selected=void 0);let o=this.presets.find(nt=>function(st,at){return(typeof st=="string"?st:st.path)===(typeof at=="string"?at:at.path)}(nt,i));return o||(this.presets.push(i),o=i),this.selected=o,typeof o!="string"?(_=(c=e.getManager())==null?void 0:c.importer)==null?void 0:_.importAsset(o,s):(et=(j=e.getManager())==null?void 0:j.importer)==null?void 0:et.importPath(o,s)}constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}}class w2 extends eE{constructor(){super(...arguments),this.name="Background"}async apply(e,i){const s=await super.apply(e,i),o=s==null?void 0:s[0];return o&&(o.colorSpace=g.KI_,e.scene.background=o),o}}class x2 extends eE{constructor(){super(...arguments),this.name="Environment"}async apply(e,i){const s=await super.apply(e,i),o=s==null?void 0:s[0];return o&&(e.scene.environment=o),o}}class E2 extends eE{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,i){const s=await super.apply(e,i),o=s==null?void 0:s[0];return(0,b.safeSetProperty)(e.getPluginByType("Diamond"),"envMap",o),o}}class tE extends eE{async apply(e,i){var o,c;const s=await super.apply(e,i,{processImported:!1});return s?(c=(o=e.getManager())==null?void 0:o.importer)==null?void 0:c.processImported(s):void 0}}class S2 extends tE{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,i){const s=await super.apply(e,i);return s&&await e.alert("Material Library successfully imported."),s}}class fw extends ms{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(i=>{var s;return{label:((s=Ox(i))==null?void 0:s.split("/").pop())||"",value:Ox(i)}})],getValue:()=>Ox(e.selected)||"",setValue:i=>{e.apply(this._viewer,e.presets.find(s=>Ox(s)===i))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();(0,b.downloadFile)(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",limitedUi:!1,value:()=>{const e=this.exportPresetGroups();(0,b.downloadFile)(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var i,s;await super.onAdded(e),this.presetGroups.push(new w2),this.presetGroups.push(new x2),this.presetGroups.push(new E2),this.presetGroups.push(new tE("Ground")),this.presetGroups.push(new tE("CameraViews")),this.presetGroups.push(new tE("MaterialConfiguration")),this.presetGroups.push(new S2),(s=(i=this.uiConfig).uiRefresh)==null||s.call(i,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(i=>[i.name,Ox(i.selected)||void 0]).filter(([,i])=>i));return e.type=fw.PluginType,e}async fromJSON(e,i){var c,_;if(!super.fromJSON(e,i))return null;const s={...e};delete s.type;const o=[];for(const[j,et]of Object.entries(s)){const nt=this.presetGroups.find(ct=>ct.name===j),st=nt==null?void 0:nt.presets;if(!nt||!st)continue;const at=typeof et=="string"?{path:et}:et;o.push(nt.apply(this._viewer,at))}return await Promise.all(o),(_=(c=this.uiConfig).uiRefresh)==null||_.call(c,"postFrame",!0),this}async loadPresetGroups(e){var i;typeof e=="string"&&e.startsWith("http")&&(e=await fetch(e).then(async s=>s.json()));for(const[s,o]of Object.entries(e)){const c=(i=this.presetGroups.find(_=>_.name===s))==null?void 0:i.presets;c==null||c.push(...o)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(Ox)]).filter(([,e])=>e.length>0))}}function Ox(h){return h&&typeof h!="string"?h.path:h}fw.PluginType="PresetLibraryPlugin";var nE,KS=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Bx=nE=class{constructor(h){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?b.glsl`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=h.getPlugin(Lv),this._setDirty=this._setDirty.bind(this)}shaderExtender(h,e,i){this.enabled&&(h.fragmentShader=os(h.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(h,e,i){this.enabled&&(e.materialObject.uniforms.grainIntensity.value=this.grainIntensity,e.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)==null||h.call(this),this._setDirty()}};KS([(0,b.onChange)(nE.prototype._setDirty),jr("Enable"),En()],Bx.prototype,"enabled",void 0),KS([(0,b.onChange)(nE.prototype._setDirty),jr("Multiply"),En()],Bx.prototype,"grainMultiply",void 0),KS([(0,b.onChange)(nE.prototype._setDirty),ns("Intensity",[0,20],.01,{limitedUi:!0}),En()],Bx.prototype,"grainIntensity",void 0),Bx=nE=KS([ks("FilmicGrain")],Bx);class rE extends ty{constructor(){super()}generateExtension(e){return new Bx(e)}get intensity(){var e;return((e=this._extension)==null?void 0:e.grainIntensity)??1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e;return((e=this._extension)==null?void 0:e.grainMultiply)??!1}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}rE.PluginType="FilmicGrain";class C2 extends b.SimpleEventDispatcher{get scene(){return this._scene}set scene(e){var i;(i=this._scene)==null||i.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}constructor(e,i,s,o){super(),this.hoverEnabled=!1,this._scene=e,this._camera=s??this._scene.activeCamera,this.domElement=i,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=o??(c=>c.userData.userSelectable!==!1&&c.userData.bboxVisible!==!1&&c.material!=null&&c.material.type!=="ShadowMaterial"),this.raycaster=new g.iMs,this.mouse=new g.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",c=>this.onPointerMove(c)),this.domElement.addEventListener("pointerleave",c=>this.onPointerLeave(c)),this.domElement.addEventListener("pointerout",c=>this.onPointerLeave(c)),this.domElement.addEventListener("pointercancel",c=>this.onPointerCancel(c)),this.domElement.addEventListener("pointerenter",c=>this.onPointerEnter(c)),this.domElement.addEventListener("pointerdown",c=>this.onPointerDown(c)),this.domElement.addEventListener("pointerup",c=>this.onPointerUp(c))}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=(0,b.now)(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){var i;e.isPrimary!==!1&&(this.updateMouseFromEvent(e),this.hoverEnabled&&(this.hoverObject=((i=this.checkIntersection())==null?void 0:i.intersects[0].object)??null))}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,(this.hoverEnabled||this.hoverObject)&&(this.hoverObject=null))}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const i=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-i.x)/i.width*2-1,this.mouse.y=-(e.clientY-i.y)/i.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const i=this.checkIntersection();i&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:i}),this.selectedObject=(i==null?void 0:i.selectedObject)||null}addPasses(){}checkIntersection(){var et;const e=(et=this._camera)==null?void 0:et.cameraObject;if(!e)return null;this.raycaster.setFromCamera(this.mouse,e);let i=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);const s=[];i=i.filter(nt=>!s.includes(nt.object.id)&&(s.push(nt.object.id),!0));let c,_=null;const j=[];for(const nt of i){for(_=nt.object,c=nt;!(_==null||_.visible&&this.selectionCondition(_));)_=_.parent;_!=null&&j.push(nt)}if(i=j,i.length>0){if(_=i[0].object,c=i[0],this._firstHit&&_.id!==this._firstHit.id)_=c.object;else for(let nt=0;nt<i.length;nt++)if(this.selectedObject&&this.selectedObject.id===i[nt].object.id){const st=nt+1;if(!(st<i.length))return null;c=i[st],_=c.object}this._firstHit=i[0].object}return _&&c&&_?{selectedObject:_,intersect:c,intersects:i,mouse:this.mouse.toArray()}:null}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}const T2=new g.ZzF,Lx=new g.Pa4;class rA extends g.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new g.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new g.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const i=this.attributes.instanceStart,s=this.attributes.instanceEnd;return i!==void 0&&(i.applyMatrix4(e),s.applyMatrix4(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new g.$TI(i,6,1);return this.setAttribute("instanceStart",new g.kB5(s,3,0)),this.setAttribute("instanceEnd",new g.kB5(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new g.$TI(i,6,1);return this.setAttribute("instanceColorStart",new g.kB5(s,3,0)),this.setAttribute("instanceColorEnd",new g.kB5(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new g.Uk6(e.geometry)),this}fromLineSegments(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new g.ZzF);const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;e!==void 0&&i!==void 0&&(this.boundingBox.setFromBufferAttribute(e),T2.setFromBufferAttribute(i),this.boundingBox.union(T2))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new g.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(e!==void 0&&i!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let o=0;for(let c=0,_=e.count;c<_;c++)Lx.fromBufferAttribute(e,c),o=Math.max(o,s.distanceToSquared(Lx)),Lx.fromBufferAttribute(i,c),o=Math.max(o,s.distanceToSquared(Lx));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class ZT extends rA{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new g.Uk6(e))}}g.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new g.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},g.Vj0.line={uniforms:g.rDY.merge([g.rBU.common,g.rBU.fog,g.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class sv extends g.jyz{constructor(e){super({type:"LineMaterial",uniforms:g.rDY.clone(g.Vj0.line.uniforms),vertexShader:g.Vj0.line.vertexShader,fragmentShader:g.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(i){this.uniforms.diffuse.value=i}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(i){i===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(i){this.uniforms.linewidth.value=i}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(i){!!i!="USE_DASH"in this.defines&&(this.needsUpdate=!0),i===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(i){this.uniforms.dashScale.value=i}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(i){this.uniforms.dashSize.value=i}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(i){this.uniforms.dashOffset.value=i}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(i){this.uniforms.gapSize.value=i}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(i){this.uniforms.opacity.value=i}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(i){this.uniforms.resolution.value.copy(i)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(i){!!i!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),i===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const eM=new g.Pa4,M2=new g.Pa4;class JS extends g.Kj0{constructor(e=new rA,i=new sv({color:16777215*Math.random()})){super(e,i),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,s=e.attributes.instanceEnd,o=new Float32Array(2*i.count);for(let _=0,j=0,et=i.count;_<et;_++,j+=2)eM.fromBufferAttribute(i,_),M2.fromBufferAttribute(s,_),o[j]=j===0?0:o[j-1],o[j+1]=o[j]+eM.distanceTo(M2);const c=new g.$TI(o,2,1);return e.setAttribute("instanceDistanceStart",new g.kB5(c,1,0)),e.setAttribute("instanceDistanceEnd",new g.kB5(c,1,1)),this}}class ZS extends g.ZAu{_updater(){const e=this._object;if(e){const i=new Wt().expandByObject(e,!1);i.getCenter(this.position);const s=i.getBoundingSphere(new g.aLr).radius;this.scale.setScalar(s*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_initGeometry(e){if(this._geometry)return;const i=new ZT(e);this._geometry=i;const s=new sv({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new g.FM8(1024,1024),dashed:!1,toneMapped:!1}),o=new JS(i,s);o.computeLineDistances(),o.scale.set(1,1,1),o.visible=!0,this.add(o)}setVisible(e){var i;e!==this.visible&&(this.visible=e,(i=this.setDirty)==null||i.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)==null||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class tM extends ZS{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new g.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new Wt().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}const mw=new g.iMs,c_=new g.Pa4,ov=new g.Pa4,vu=new g._fP,nM={X:new g.Pa4(1,0,0),Y:new g.Pa4(0,1,0),Z:new g.Pa4(0,0,1)},rM={type:"change"},eC={type:"mouseDown"},I2={type:"mouseUp",mode:null},P2={type:"objectChange"};class R2 extends g.Tme{constructor(e,i){super(),i===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const s=new oO;this._gizmo=s,this.add(s);const o=new aO;this._plane=o,this.add(o);const c=this;function _(Ct,bt){let At=bt;Object.defineProperty(c,Ct,{get:function(){return At!==void 0?At:bt},set:function(Pt){At!==Pt&&(At=Pt,o[Ct]=Pt,s[Ct]=Pt,c.dispatchEvent({type:Ct+"-changed",value:Pt}),c.dispatchEvent(rM))}}),c[Ct]=bt,o[Ct]=bt,s[Ct]=bt}_("camera",e),_("object",void 0),_("enabled",!0),_("axis",null),_("mode","translate"),_("translationSnap",null),_("rotationSnap",null),_("scaleSnap",null),_("space","world"),_("size",1),_("dragging",!1),_("showX",!0),_("showY",!0),_("showZ",!0);const j=new g.Pa4,et=new g.Pa4,nt=new g._fP,st=new g._fP,at=new g.Pa4,ct=new g._fP,dt=new g.Pa4,mt=new g.Pa4,yt=new g.Pa4,wt=new g.Pa4;_("worldPosition",j),_("worldPositionStart",et),_("worldQuaternion",nt),_("worldQuaternionStart",st),_("cameraPosition",at),_("cameraQuaternion",ct),_("pointStart",dt),_("pointEnd",mt),_("rotationAxis",yt),_("rotationAngle",0),_("eye",wt),this._offset=new g.Pa4,this._startNorm=new g.Pa4,this._endNorm=new g.Pa4,this._cameraScale=new g.Pa4,this._parentPosition=new g.Pa4,this._parentQuaternion=new g._fP,this._parentQuaternionInv=new g._fP,this._parentScale=new g.Pa4,this._worldScaleStart=new g.Pa4,this._worldQuaternionInv=new g._fP,this._worldScale=new g.Pa4,this._positionStart=new g.Pa4,this._quaternionStart=new g._fP,this._scaleStart=new g.Pa4,this._getPointer=nO.bind(this),this._onPointerDown=rO.bind(this),this._onPointerHover=D2.bind(this),this._onPointerMove=iO.bind(this),this._onPointerUp=sO.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;mw.setFromCamera(e,this.camera);const i=iM(this._gizmo.picker[this.mode],mw);this.axis=i?i.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){mw.setFromCamera(e,this.camera);const i=iM(this._plane,mw,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,eC.mode=this.mode,this.dispatchEvent(eC)}}pointerMove(e){const i=this.axis,s=this.mode,o=this.object;let c=this.space;if(s==="scale"?c="local":i!=="E"&&i!=="XYZE"&&i!=="XYZ"||(c="world"),o===void 0||i===null||this.dragging===!1||e.button!==-1)return;mw.setFromCamera(e,this.camera);const _=iM(this._plane,mw,!0);if(_){if(this.pointEnd.copy(_.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),c==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),c==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),o.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(c==="local"&&(o.position.applyQuaternion(vu.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(o.position.x=Math.round(o.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(o.position.y=Math.round(o.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(o.position.z=Math.round(o.position.z/this.translationSnap)*this.translationSnap),o.position.applyQuaternion(this._quaternionStart)),c==="world"&&(o.parent&&o.position.add(c_.setFromMatrixPosition(o.parent.matrixWorld)),i.search("X")!==-1&&(o.position.x=Math.round(o.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(o.position.y=Math.round(o.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(o.position.z=Math.round(o.position.z/this.translationSnap)*this.translationSnap),o.parent&&o.position.sub(c_.setFromMatrixPosition(o.parent.matrixWorld))));else if(s==="scale"){if(i.search("XYZ")!==-1){let j=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(j*=-1),ov.set(j,j,j)}else c_.copy(this.pointStart),ov.copy(this.pointEnd),c_.applyQuaternion(this._worldQuaternionInv),ov.applyQuaternion(this._worldQuaternionInv),ov.divide(c_),i.search("X")===-1&&(ov.x=1),i.search("Y")===-1&&(ov.y=1),i.search("Z")===-1&&(ov.z=1);o.scale.copy(this._scaleStart).multiply(ov),this.scaleSnap&&(i.search("X")!==-1&&(o.scale.x=Math.round(o.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(o.scale.y=Math.round(o.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(o.scale.z=Math.round(o.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const j=20/this.worldPosition.distanceTo(c_.setFromMatrixPosition(this.camera.matrixWorld));i==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(c_.copy(this.rotationAxis).cross(this.eye))*j):i!=="X"&&i!=="Y"&&i!=="Z"||(this.rotationAxis.copy(nM[i]),c_.copy(nM[i]),c==="local"&&c_.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(c_.cross(this.eye).normalize())*j),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),c==="local"&&i!=="E"&&i!=="XYZE"?(o.quaternion.copy(this._quaternionStart),o.quaternion.multiply(vu.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),o.quaternion.copy(vu.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),o.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(rM),this.dispatchEvent(P2)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(I2.mode=this.mode,this.dispatchEvent(I2)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(rM),this.dispatchEvent(P2),this.pointStart.copy(this.pointEnd))}getRaycaster(){return mw}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function nO(h){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:h.button};{const e=this.domElement.getBoundingClientRect();return{x:(h.clientX-e.left)/e.width*2-1,y:-(h.clientY-e.top)/e.height*2+1,button:h.button}}}function D2(h){if(this.enabled)switch(h.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(h))}}function rO(h){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(h.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(h)),this.pointerDown(this._getPointer(h)))}function iO(h){this.enabled&&this.pointerMove(this._getPointer(h))}function sO(h){this.enabled&&(this.domElement.releasePointerCapture(h.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(h)))}function iM(h,e,i){const s=e.intersectObject(h,!0);for(let o=0;o<s.length;o++)if(s[o].object.visible||i)return s[o];return!1}const tC=new g.USm,nu=new g.Pa4(0,1,0),k2=new g.Pa4(0,0,0),sM=new g.yGw,iE=new g._fP,nC=new g._fP,y0=new g.Pa4,O2=new g.yGw,sE=new g.Pa4(1,0,0),gw=new g.Pa4(0,1,0),Nx=new g.Pa4(0,0,1),rC=new g.Pa4,_w=new g.Pa4,vw=new g.Pa4;class oO extends g.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new g.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new g.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const o=i.clone();o.opacity=.5;const c=e.clone();c.color.setHex(16711680);const _=e.clone();_.color.setHex(65280);const j=e.clone();j.color.setHex(255);const et=e.clone();et.color.setHex(16711680),et.opacity=.5;const nt=e.clone();nt.color.setHex(65280),nt.opacity=.5;const st=e.clone();st.color.setHex(255),st.opacity=.5;const at=e.clone();at.opacity=.25;const ct=e.clone();ct.color.setHex(16776960),ct.opacity=.25,e.clone().color.setHex(16776960);const dt=e.clone();dt.color.setHex(7895160);const mt=new g.fHI(0,.04,.1,12);mt.translate(0,.05,0);const yt=new g.DvJ(.08,.08,.08);yt.translate(0,.04,0);const wt=new g.u9r;wt.setAttribute("position",new g.a$l([0,0,0,1,0,0],3));const Ct=new g.fHI(.0075,.0075,.5,3);function bt(An,wn){const Mn=new g.XvJ(An,.0075,3,64,wn*Math.PI*2);return Mn.rotateY(Math.PI/2),Mn.rotateX(Math.PI/2),Mn}Ct.translate(0,.25,0);const At={X:[[new g.Kj0(mt,c),[.5,0,0],[0,0,-Math.PI/2]],[new g.Kj0(mt,c),[-.5,0,0],[0,0,Math.PI/2]],[new g.Kj0(Ct,c),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new g.Kj0(mt,_),[0,.5,0]],[new g.Kj0(mt,_),[0,-.5,0],[Math.PI,0,0]],[new g.Kj0(Ct,_)]],Z:[[new g.Kj0(mt,j),[0,0,.5],[Math.PI/2,0,0]],[new g.Kj0(mt,j),[0,0,-.5],[-Math.PI/2,0,0]],[new g.Kj0(Ct,j),null,[Math.PI/2,0,0]]],XYZ:[[new g.Kj0(new g.pQR(.1,0),at.clone()),[0,0,0]]],XY:[[new g.Kj0(new g.DvJ(.15,.15,.01),st.clone()),[.15,.15,0]]],YZ:[[new g.Kj0(new g.DvJ(.15,.15,.01),et.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new g.Kj0(new g.DvJ(.15,.15,.01),nt.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},Pt={X:[[new g.Kj0(new g.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new g.Kj0(new g.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new g.Kj0(new g.fHI(.2,0,.6,4),s),[0,.3,0]],[new g.Kj0(new g.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new g.Kj0(new g.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new g.Kj0(new g.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new g.Kj0(new g.pQR(.2,0),s)]],XY:[[new g.Kj0(new g.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new g.Kj0(new g.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new g.Kj0(new g.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},Dt={START:[[new g.Kj0(new g.pQR(.01,2),o),null,null,null,"helper"]],END:[[new g.Kj0(new g.pQR(.01,2),o),null,null,null,"helper"]],DELTA:[[new g.x12(function(){const An=new g.u9r;return An.setAttribute("position",new g.a$l([0,0,0,1,1,1],3)),An}(),o),null,null,null,"helper"]],X:[[new g.x12(wt,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new g.x12(wt,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new g.x12(wt,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Nt={XYZE:[[new g.Kj0(bt(.5,1),dt),null,[0,Math.PI/2,0]]],X:[[new g.Kj0(bt(.5,.5),c)]],Y:[[new g.Kj0(bt(.5,.5),_),null,[0,0,-Math.PI/2]]],Z:[[new g.Kj0(bt(.5,.5),j),null,[0,Math.PI/2,0]]],E:[[new g.Kj0(bt(.75,1),ct),null,[0,Math.PI/2,0]]]},Vt={AXIS:[[new g.x12(wt,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Zt={XYZE:[[new g.Kj0(new g.xo$(.25,10,8),s)]],X:[[new g.Kj0(new g.XvJ(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new g.Kj0(new g.XvJ(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new g.Kj0(new g.XvJ(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new g.Kj0(new g.XvJ(.75,.1,2,24),s)]]},an={X:[[new g.Kj0(yt,c),[.5,0,0],[0,0,-Math.PI/2]],[new g.Kj0(Ct,c),[0,0,0],[0,0,-Math.PI/2]],[new g.Kj0(yt,c),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new g.Kj0(yt,_),[0,.5,0]],[new g.Kj0(Ct,_)],[new g.Kj0(yt,_),[0,-.5,0],[0,0,Math.PI]]],Z:[[new g.Kj0(yt,j),[0,0,.5],[Math.PI/2,0,0]],[new g.Kj0(Ct,j),[0,0,0],[Math.PI/2,0,0]],[new g.Kj0(yt,j),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new g.Kj0(new g.DvJ(.15,.15,.01),st),[.15,.15,0]]],YZ:[[new g.Kj0(new g.DvJ(.15,.15,.01),et),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new g.Kj0(new g.DvJ(.15,.15,.01),nt),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new g.Kj0(new g.DvJ(.1,.1,.1),at.clone())]]},fn={X:[[new g.Kj0(new g.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new g.Kj0(new g.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new g.Kj0(new g.fHI(.2,0,.6,4),s),[0,.3,0]],[new g.Kj0(new g.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new g.Kj0(new g.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new g.Kj0(new g.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new g.Kj0(new g.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new g.Kj0(new g.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new g.Kj0(new g.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new g.Kj0(new g.DvJ(.2,.2,.2),s),[0,0,0]]]},mn={X:[[new g.x12(wt,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new g.x12(wt,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new g.x12(wt,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function Sn(An){const wn=new g.Tme;for(const Mn in An)for(let Pn=An[Mn].length;Pn--;){const On=An[Mn][Pn][0].clone(),er=An[Mn][Pn][1],Zn=An[Mn][Pn][2],yr=An[Mn][Pn][3],lr=An[Mn][Pn][4];On.name=Mn,On.tag=lr,er&&On.position.set(er[0],er[1],er[2]),Zn&&On.rotation.set(Zn[0],Zn[1],Zn[2]),yr&&On.scale.set(yr[0],yr[1],yr[2]),On.updateMatrix();const ar=On.geometry.clone();ar.applyMatrix4(On.matrix),On.geometry=ar,On.renderOrder=1/0,On.position.set(0,0,0),On.rotation.set(0,0,0),On.scale.set(1,1,1),wn.add(On)}return wn}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Sn(At)),this.add(this.gizmo.rotate=Sn(Nt)),this.add(this.gizmo.scale=Sn(an)),this.add(this.picker.translate=Sn(Pt)),this.add(this.picker.rotate=Sn(Zt)),this.add(this.picker.scale=Sn(fn)),this.add(this.helper.translate=Sn(Dt)),this.add(this.helper.rotate=Sn(Vt)),this.add(this.helper.scale=Sn(mn)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:nC;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let o=0;o<s.length;o++){const c=s[o];let _;c.visible=!0,c.rotation.set(0,0,0),c.position.copy(this.worldPosition),_=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),c.scale.set(1,1,1).multiplyScalar(_*this.size/4),c.tag!=="helper"?(c.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(c.name==="X"&&Math.abs(nu.copy(sE).applyQuaternion(i).dot(this.eye))>.99&&(c.scale.set(1e-10,1e-10,1e-10),c.visible=!1),c.name==="Y"&&Math.abs(nu.copy(gw).applyQuaternion(i).dot(this.eye))>.99&&(c.scale.set(1e-10,1e-10,1e-10),c.visible=!1),c.name==="Z"&&Math.abs(nu.copy(Nx).applyQuaternion(i).dot(this.eye))>.99&&(c.scale.set(1e-10,1e-10,1e-10),c.visible=!1),c.name==="XY"&&Math.abs(nu.copy(Nx).applyQuaternion(i).dot(this.eye))<.2&&(c.scale.set(1e-10,1e-10,1e-10),c.visible=!1),c.name==="YZ"&&Math.abs(nu.copy(sE).applyQuaternion(i).dot(this.eye))<.2&&(c.scale.set(1e-10,1e-10,1e-10),c.visible=!1),c.name==="XZ"&&Math.abs(nu.copy(gw).applyQuaternion(i).dot(this.eye))<.2&&(c.scale.set(1e-10,1e-10,1e-10),c.visible=!1)):this.mode==="rotate"&&(iE.copy(i),nu.copy(this.eye).applyQuaternion(vu.copy(i).invert()),c.name.search("E")!==-1&&c.quaternion.setFromRotationMatrix(sM.lookAt(this.eye,k2,gw)),c.name==="X"&&(vu.setFromAxisAngle(sE,Math.atan2(-nu.y,nu.z)),vu.multiplyQuaternions(iE,vu),c.quaternion.copy(vu)),c.name==="Y"&&(vu.setFromAxisAngle(gw,Math.atan2(nu.x,nu.z)),vu.multiplyQuaternions(iE,vu),c.quaternion.copy(vu)),c.name==="Z"&&(vu.setFromAxisAngle(Nx,Math.atan2(nu.y,nu.x)),vu.multiplyQuaternions(iE,vu),c.quaternion.copy(vu))),c.visible=c.visible&&(c.name.indexOf("X")===-1||this.showX),c.visible=c.visible&&(c.name.indexOf("Y")===-1||this.showY),c.visible=c.visible&&(c.name.indexOf("Z")===-1||this.showZ),c.visible=c.visible&&(c.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),c.material._color=c.material._color||c.material.color.clone(),c.material._opacity=c.material._opacity||c.material.opacity,c.material.color.copy(c.material._color),c.material.opacity=c.material._opacity,this.enabled&&this.axis&&(c.name===this.axis||this.axis.split("").some(function(j){return c.name===j}))&&(c.material.color.setHex(16776960),c.material.opacity=1)):(c.visible=!1,c.name==="AXIS"?(c.visible=!!this.axis,this.axis==="X"&&(vu.setFromEuler(tC.set(0,0,0)),c.quaternion.copy(i).multiply(vu),Math.abs(nu.copy(sE).applyQuaternion(i).dot(this.eye))>.9&&(c.visible=!1)),this.axis==="Y"&&(vu.setFromEuler(tC.set(0,0,Math.PI/2)),c.quaternion.copy(i).multiply(vu),Math.abs(nu.copy(gw).applyQuaternion(i).dot(this.eye))>.9&&(c.visible=!1)),this.axis==="Z"&&(vu.setFromEuler(tC.set(0,Math.PI/2,0)),c.quaternion.copy(i).multiply(vu),Math.abs(nu.copy(Nx).applyQuaternion(i).dot(this.eye))>.9&&(c.visible=!1)),this.axis==="XYZE"&&(vu.setFromEuler(tC.set(0,Math.PI/2,0)),nu.copy(this.rotationAxis),c.quaternion.setFromRotationMatrix(sM.lookAt(k2,nu,gw)),c.quaternion.multiply(vu),c.visible=this.dragging),this.axis==="E"&&(c.visible=!1)):c.name==="START"?(c.position.copy(this.worldPositionStart),c.visible=this.dragging):c.name==="END"?(c.position.copy(this.worldPosition),c.visible=this.dragging):c.name==="DELTA"?(c.position.copy(this.worldPositionStart),c.quaternion.copy(this.worldQuaternionStart),c_.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),c_.applyQuaternion(this.worldQuaternionStart.clone().invert()),c.scale.copy(c_),c.visible=this.dragging):(c.quaternion.copy(i),this.dragging?c.position.copy(this.worldPositionStart):c.position.copy(this.worldPosition),this.axis&&(c.visible=this.axis.search(c.name)!==-1)))}super.updateMatrixWorld(e)}}class aO extends g.Kj0{constructor(){super(new g._12(1e5,1e5,2,2),new g.vBJ({visible:!1,wireframe:!0,side:g.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),rC.copy(sE).applyQuaternion(i==="local"?this.worldQuaternion:nC),_w.copy(gw).applyQuaternion(i==="local"?this.worldQuaternion:nC),vw.copy(Nx).applyQuaternion(i==="local"?this.worldQuaternion:nC),nu.copy(_w),this.mode){case"translate":case"scale":switch(this.axis){case"X":nu.copy(this.eye).cross(rC),y0.copy(rC).cross(nu);break;case"Y":nu.copy(this.eye).cross(_w),y0.copy(_w).cross(nu);break;case"Z":nu.copy(this.eye).cross(vw),y0.copy(vw).cross(nu);break;case"XY":y0.copy(vw);break;case"YZ":y0.copy(rC);break;case"XZ":nu.copy(vw),y0.copy(_w);break;case"XYZ":case"E":y0.set(0,0,0)}break;default:y0.set(0,0,0)}y0.length()===0?this.quaternion.copy(this.cameraQuaternion):(O2.lookAt(c_.set(0,0,0),y0,nu),this.quaternion.setFromRotationMatrix(O2)),super.updateMatrixWorld(e)}}class B2 extends R2{_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(g.M8C.degToRad(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var i;(i=this==null?void 0:this.object)==null||i.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",i=>{const s=e==null?void 0:e.getPlugin(iy);s&&(s.enabled=!i.value),this._scene.activeCamera.interactionsEnabled=!i.value}),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var L2=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class Bo extends ms{get picker(){return this._picker}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}constructor(e=tM,i=!1,s=!0,o=!1){super(),this.enabled=!0,this._enableWidget=!0,this.autoFocus=!1,this._onObjectHit=c=>{this._viewer&&(this.enabled?this.dispatchEvent(c):c.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const c=this.getSelectedObject();this.autoFocus&&c&&this.setSelectedObject(c,!0)}}],e&&(this._widget=new e),this._controls=i,this._pickUi=s,this.autoFocus=o}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)==null?void 0:e.selectedObject)||void 0}setSelectedObject(e,i=!1){if(!this.enabled||!this._picker)return;const s=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=s,(s||i)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new C2(e.scene,e.canvas,void 0,i=>{if(!i.material)return!1;let s=i,o=!1;for(;s;){if(!s.visible||((s.userData.iModel??s).assetType==="model"&&(o=!0),(s.userData.iModel??s).assetType==="widget")||s.userData.userSelectable===!1||s.userData.bboxVisible===!1)return!1;s=s.parent}return o}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new B2(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",i=>{var _,j,et;this.dispatchEvent(i);const s=((_=this._picker)==null?void 0:_.selectedObject)||void 0;if(this._pickUi){const nt=s==null?void 0:s.uiConfig,st=this.uiConfig;st.children=[...this._uiConfigChildren],nt&&st.children.push(nt),(j=st.uiRefresh)==null||j.call(st)}const o=this._widget;o&&this._enableWidget&&(s?o.attach(s):o.detach());const c=this._transformControls;c&&((et=this._viewer)!=null&&et.scene.activeCamera.controls)&&(s&&c.enabled?c.attach(s):c.detach()),e.setDirty(),this.autoFocus&&this.focusObject(s)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",i=>{i.value===void 0?console.warn("e.value must be set for picking, can be null to unselect"):this.setSelectedObject(i.value,this.autoFocus||i.focusCamera)}),e.scene.addEventListener("addSceneObject",async i=>{var c,_;const s=i.object,o=this.getSelectedObject();if(o&&(s==null?void 0:s.assetType)==="material"&&typeof(o==null?void 0:o.setMaterial)=="function"&&((c=o==null?void 0:o.modelObject)!=null&&c.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const j=o.material;if(Array.isArray(j))console.warn("Dropping on material array not yet fully supported."),o.setMaterial(s);else{let et=Array.from((j==null?void 0:j.userData.__appliedMeshes)??[]);(et.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):et.length<1)&&(et=[o]);for(const nt of et)nt&&((_=nt.setMaterial)==null||_.call(nt,s))}}}),e.scene.addEventListener("sceneUpdate",i=>{if(!i.hierarchyChanged)return;const s=this.getSelectedObject();let o=!1;s==null||s.traverseAncestors(c=>{c===e.scene.modelObject&&(o=!0)}),o||this.setSelectedObject(void 0)})}async focusObject(e){var s,o,c;const i=(s=this._viewer)==null?void 0:s.getPluginByType("CameraViews");await(i==null?void 0:i.animateToFitObject(e,1.25,1e3,"easeOut",{min:(((c=(o=this._viewer)==null?void 0:o.scene.activeCamera.getControls())==null?void 0:c.minDistance)??.5)+.5,max:50}))}enableWidget(e){var i,s,o;if(this._enableWidget=e,e){const c=((i=this._picker)==null?void 0:i.selectedObject)||void 0;c&&((s=this._widget)==null||s.attach(c))}else(o=this._widget)==null||o.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}Bo.PluginType="Picking",L2([En()],Bo.prototype,"enabled",void 0),L2([En()],Bo.prototype,"autoFocus",void 0);var iC,oE=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let pp=iC=class extends ms{enableCustomBump(h,e,i){var o;const s=(o=h.materialObject)==null?void 0:o.userData;if(!s)return!1;if(s._hasCustomBump===void 0){const c=s.__appliedMeshes;let _=!0;if(c)for(const{geometry:j}of c)!j||j.attributes.position&&j.attributes.normal&&j.attributes.uv||(_=!1);if(!_)return!1}return s._hasCustomBump=!0,s._customBumpScale=i??s._customBumpScale??.001,s._customBumpMap=e??s._customBumpMap,h.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new lO(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Fr],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new g.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(h,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic_cb(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic_cb(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic_cb(fxy.x);vec4 ycubic=cubic_cb(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(h,e,i)=>{var o;if(!this.enabled||!e.materialObject.userData._hasCustomBump)return;((o=e.materialObject.userData)==null?void 0:o._customBumpMap)&&(h.fragmentShader=os(h.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),h.vertexShader=os(h.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),h.vertexShader=os(h.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),h.defines.USE_UV="")},onObjectRender:(h,e)=>{var _;const i=e.materialObject.userData;if(!(i!=null&&i._hasCustomBump))return;const s=h;if(!s.isMesh||!s.geometry)return;const o=(_=i._customBumpMap)!=null&&_.isTexture?i._customBumpMap:null;this._uniforms.customBumpMap.value=o,this._uniforms.customBumpScale.value=o?i._customBumpScale:0,o&&(o.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(o.matrix));let c=this.enabled&&o?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==c&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=c,e.materialObject.needsUpdate=!0),c=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==c&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=c,e.materialObject.needsUpdate=!0),c=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==c&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=c,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i,s;return(this.enabled?"1":"0")+((e=h.materialObject.userData)!=null&&e._hasCustomBump?"1":"0")+((s=(i=h.materialObject.userData)==null?void 0:i._customBumpMap)==null?void 0:s.uuid)},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:h=>{const e=this._viewer,i=this.enableCustomBump,s={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return h.materialObject.userData._hasCustomBump||!1},set value(o){var c;o!==h.materialObject.userData._hasCustomBump&&(o?i(h)||e.alert("One or more geometries cannot be made anisotropic."):(h.materialObject.userData._hasCustomBump=!1,h.materialObject.needsUpdate=!0),(c=s.uiRefresh)==null||c.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",bounds:[-1,1],hidden:()=>!h.materialObject.userData._hasCustomBump,property:[h.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!h.materialObject.userData._hasCustomBump,property:[h.materialObject.userData,"_customBumpMap"],onChange:()=>{h.materialObject.needsUpdate=!0,this.setDirty()}},Po(h.materialObject.userData,"_customBumpMap")]};return s}},this.setDirty=()=>{var h,e,i;(e=(h=this.materialExtension).setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()},this.enableCustomBumpSelected=()=>{var e,i,s;const h=(s=(i=(e=this._viewer)==null?void 0:e.getPlugin(Bo))==null?void 0:i.getSelectedObject())==null?void 0:s.material;return(h==null?void 0:h.assetType)==="material"&&this.enableCustomBump(h)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,_;await super.onAdded(h);const e=h.getPlugin(Fr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(_=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||_.push(sC)}async onRemove(h){var i,s,o,c,_,j,et,nt,st,at,ct,dt;(s=(i=h.getPlugin(Fr))==null?void 0:i.materials)==null||s.unregisterMaterialExtension(this.materialExtension),(c=(o=h.getPlugin(Fr))==null?void 0:o.importer)==null||c.removeEventListener("loaderCreate",this._loaderCreate);const e=(nt=(et=(j=(_=h.getPlugin(Fr))==null?void 0:_.exporter)==null?void 0:j.getExporter("gltf","glb"))==null?void 0:et.extensions)==null?void 0:nt.indexOf(sC);return e!==void 0&&e!==-1&&((dt=(ct=(at=(st=h.getPlugin(Fr))==null?void 0:st.exporter)==null?void 0:at.getExporter("gltf","glb"))==null?void 0:ct.extensions)==null||dt.splice(e,1)),super.onRemove(h)}};pp.PluginType="CustomBumpMapPlugin",pp.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",oE([jr("Enabled",h=>({onChange:h.setDirty})),En()],pp.prototype,"enabled",void 0),oE([jr("Bicubic",h=>({onChange:h.setDirty})),Hr("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,iC.prototype.setDirty),En()],pp.prototype,"bicubicFiltering",void 0),oE([Oo("Enable CustomBumpMap",h=>({hidden:()=>{var e;return!((e=h._viewer)!=null&&e.getPlugin(Bo))}}))],pp.prototype,"enableCustomBumpSelected",void 0),pp=iC=oE([ks("CustomBumpMap Materials")],pp);class lO{constructor(e){this.parser=e,this.name=pp.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],_=o.extensions[this.name];i.userData||(i.userData={}),i.userData._hasCustomBump=!0,i.userData._customBumpScale=_.customBumpScale??0;const j=_.customBumpMap;return j&&c.push(s.assignTexture(i.userData,"_customBumpMap",j).then(et=>{et.colorSpace=g.KI_})),Promise.all(c)}}const sC=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const o={index:h.processTexture(e.userData._customBumpMap)};h.applyTextureTransform(o,e.userData._customBumpMap),s.customBumpMap=o}i.extensions[pp.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=s,h.extensionsUsed[pp.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var sy,Gp=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Ql=sy=class extends ms{get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}setTime(h){this._animationTime=Math.max(0,Math.min(h,this._animationDuration))}_wheel({deltaY:h}){this.enabled&&Math.abs(h)>.001&&(this._scrollAnimationState=-1*Math.sign(h))}_drag(h){this.enabled&&this._viewer&&(this.dragAxis==="x"?this._dragAnimationState=h.delta.x*this._viewer.canvas.width/4:this._dragAnimationState=h.delta.y*this._viewer.canvas.height/4)}_postFrame(){var c,_;if(!this._viewer)return;const h=this._viewer,e=this.animateOnScroll,i=this.animateOnDrag;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!e&&!i)return this._lastFrameTime=0,void(this._fadeDisabled&&((c=this._viewer.getPluginByType("FrameFade"))==null||c.enable(sy.PluginType),this._fadeDisabled=!1));if(this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"}),this.autoIncrementTime){const j=(0,b.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=j-1/30);let et=j-this._lastFrameTime;if(et*=this.animationSpeed,this._lastFrameTime=j,e&&i?et*=(0,b.absMax)(this._scrollAnimationState,this._dragAnimationState):e?et*=this._scrollAnimationState:i&&(et*=this._dragAnimationState),Math.abs(et)<1e-4)return;const nt=(_=this._viewer.getPluginByType("Progressive"))==null?void 0:_.postFrameConvergedRecordingDelta();if(nt&&nt>0&&(et=nt),nt===0)return;const st=Math.abs(this.timeScale);this._animationTime+=et*(st>0?st:1)}const s=this._animationTime-this._lastAnimationTime;this._lastAnimationTime=this._animationTime;const o=this.timeScale<0?(isFinite(this._animationDuration)?this._animationDuration:0)-this._animationTime:this._animationTime;if(this.animations.map(j=>{j.mixer.setTime(o)}),!(Math.abs(s)<1e-5)){if(Math.abs(this._scrollAnimationState)<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,Math.abs(this._dragAnimationState)<.001?this._dragAnimationState=0:this._dragAnimationState*=1-this.dragAnimationDamping,this.dispatchEvent({type:"animationStep",delta:s,time:o}),h.scene.activeCamera.cameraObject.userData.__animatingCamera&&h.scene.activeCamera.setDirty(),h.scene.refreshActiveCameraNearFar(),h.renderer.resetShadows(),h.setDirty(),!this._fadeDisabled){const j=this._viewer.getPluginByType("FrameFade");j&&(j.disable(sy.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}constructor(){super(),this.enabled=!0,this._lastAnimationTime=0,this.autoIncrementTime=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=1,this.animationSpeed=1,this.animateOnScroll=!1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.animateOnDrag=!1,this.dragAxis="y",this.autoplayOnLoad=!1,this.syncMaxDuration=!1,this._dragAnimationState=0,this.dragAnimationDamping=.3,this.dependencies=[Fr],this._pointerDragHelper=new b.PointerDragHelper,this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=h=>{const e=h.object;if(e.assetType!=="model"||!e.modelObject||!this._viewer)return;let i=!1;e.modelObject.traverse(s=>{const o=s.animations;if(o.length<1)return;const c=Math.max(...o.map(et=>et.duration));(e.modelObject.userData.gltfAnim_SyncMaxDuration??this.syncMaxDuration)&&(o.forEach(et=>et.duration=c),e.modelObject.userData.gltfAnim_SyncMaxDuration=!0);const _=new g.Xcj(this._viewer.scene.modelRoot.modelObject),j=o.map(et=>_.clipAction(et).setLoop(this.loopAnimations?g.YKA:g.jAl,this.loopRepetitions));j.forEach(et=>et.clampWhenFinished=!0),this.animations.push({mixer:_,clips:o,actions:j,duration:c}),i=!0}),i&&(this._onPropertyChange(!this.autoplayOnLoad),this.autoplayOnLoad&&this.playAnimation())},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this._onPropertyChange=this._onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this._pointerDragHelper.addEventListener("drag",this._drag.bind(this))}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new cO(e,this))}async onAdded(h){var i,s,o,c,_,j;(s=(i=h.getPlugin(Fr))==null?void 0:i.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),h.scene.addEventListener("addSceneObject",this._objectAdded),(j=(_=(c=(o=h.getPlugin(Fr))==null?void 0:o.exporter)==null?void 0:c.getExporter("gltf","glb"))==null?void 0:_.extensions)==null||j.push(uO),h.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),this._pointerDragHelper.element=h.canvas;let e=-1;return Object.defineProperty(h.scene.modelRoot,"currentTimelineMarker",{get:()=>e,set:et=>h.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[e=et]})}),h.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:et})=>{var st;if(!this._viewer)return;if(!et)return this._viewer.scene.activeCamera=(st=this._viewer)==null?void 0:st.scene.defaultCamera,void this._viewer.setDirty();const nt=et.camera;nt&&(nt.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(nt))}),super.onAdded(h)}async onRemove(h){var e,i;for(;this.animations.length;)this.animations.pop();return h.scene.removeEventListener("addSceneObject",this._objectAdded),(i=(e=h.getPlugin(Fr))==null?void 0:e.importer)==null||i.addEventListener("loaderCreate",this._loaderCreate),h.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),this._pointerDragHelper.element=void 0,super.onRemove(h)}_onPropertyChange(h=!0){this._animationDuration=Math.max(...this.animations.map(({duration:e})=>e))*(this.loopAnimations?this.loopRepetitions:1),this._animationState==="playing"&&h&&this.playAnimation()}onStateChange(){var h,e;(e=(h=this.uiConfig)==null?void 0:h.children)==null||e.map(i=>i&&(0,b.getOrCall)(i)).flat(2).forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)==null?void 0:s.call(i)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(h,e=!1){return this.playClips([h],e)}async playClips(h,e=!1){const i=[];return this.animations.forEach(({actions:s})=>{s.forEach(o=>{h.includes(o.getClip().name)&&i.push(o)})}),this.playAnimation(e,i)}async playAnimation(h=!1,e){var _;if(!this.enabled)return;let i=!1;this._animationState==="playing"&&(this.stopAnimation(!1),i=!0);let s=0;const o=!e;e||(e=[],this.animations.forEach(({mixer:j,actions:et,clips:nt})=>{e.push(...et)})),i?this.resetAnimation():this.animationState!=="paused"&&(e.forEach(j=>{j.reset()}),this._animationTime=0);const c=Bp();this._lastAnimId=c;for(const j of e)j.setLoop(this.loopAnimations?g.YKA:g.jAl,this.loopRepetitions),j.play(),s=Math.max(s,j.getClip().duration/Math.abs(j.timeScale));if(this._animationState="playing",(_=this._viewer)==null||_.setDirty(),o){if(!isFinite(this._animationDuration))return;await new Promise((j,et)=>{const nt=()=>{this.removeEventListener("checkpointEnd",nt),j()};this.addEventListener("checkpointEnd",nt)})}else{const j=this.loopAnimations?this.loopRepetitions:1;if(s*=j,!isFinite(s))return;await new Promise((et,nt)=>{const st=at=>{at.time>=s&&(this.removeEventListener("animationStep",st),et())};this.addEventListener("animationStep",st)})}c===this._lastAnimId&&this.stopAnimation(h)}pauseAnimation(){var h;this._animationState==="playing"?(this._animationState="paused",(h=this._viewer)==null||h.setDirty()):console.warn("pauseAnimation called when animation was not playing.")}resumeAnimation(){var h;this._animationState==="paused"?(this._animationState="playing",(h=this._viewer)==null||h.setDirty()):console.warn("resumeAnimation called when animation was not paused.")}stopAnimation(h=!1){var e,i;this._animationState="stopped",h?this.resetAnimation():(e=this._viewer)==null||e.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((i=this._viewer.getPluginByType("FrameFade"))==null||i.enable(sy.PluginType),this._fadeDisabled=!1)}resetAnimation(){var h;this._animationState==="stopped"||this._animationState==="none"?(this.animations.forEach(({mixer:e,actions:i,clips:s})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(h=this._viewer)==null||h.setDirty()):this.stopAnimation(!0)}};Ql.PluginType="GLTFAnimation",Ql.AnimationMarkersExtension="WEBGI_animation_markers",Gp([En()],Ql.prototype,"autoIncrementTime",void 0),Gp([y_()],Ql.prototype,"animationState",null),Gp([y_()],Ql.prototype,"animationTime",null),Gp([y_()],Ql.prototype,"animationDuration",null),Gp([(0,b.onChange2)(sy.prototype._onPropertyChange),jr("Loop",{limitedUi:!0}),En()],Ql.prototype,"loopAnimations",void 0),Gp([(0,b.onChange2)(sy.prototype._onPropertyChange),En()],Ql.prototype,"loopRepetitions",void 0),Gp([ns("Timescale",[-2,2],.01),En()],Ql.prototype,"timeScale",void 0),Gp([ns("Speed",[.1,4],.1,{limitedUi:!0}),En()],Ql.prototype,"animationSpeed",void 0),Gp([jr(),En()],Ql.prototype,"animateOnScroll",void 0),Gp([jr(),En()],Ql.prototype,"animateOnDrag",void 0),Gp([Pm("Drag Axis",[{label:"x"},{label:"y"}]),En()],Ql.prototype,"dragAxis",void 0),Gp([jr(),En()],Ql.prototype,"autoplayOnLoad",void 0),Gp([jr("syncMaxDuration(dev)"),En()],Ql.prototype,"syncMaxDuration",void 0),Gp([(0,b.onChange)(sy.prototype.onStateChange)],Ql.prototype,"_animationState",void 0),Gp([Oo("Play/Pause",h=>({label:()=>h.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],Ql.prototype,"playPauseAnimation",null),Gp([Oo("Stop",{limitedUi:!0})],Ql.prototype,"stopAnimation",null),Gp([Oo("Reset",{limitedUi:!0})],Ql.prototype,"resetAnimation",null),Ql=sy=Gp([ks("GLTF Animations")],Ql);class cO{constructor(e,i){this.parser=e,this.name=Ql.AnimationMarkersExtension,this.plugin=i}async afterRoot(e){let i=[];for(const at of this.parser.json.scenes||[]){if(!at.extensions)continue;const ct=at.extensions[this.name];for(const dt of(ct==null?void 0:ct.markers)||[]){const mt=dt.camera!==void 0?await this.parser.getDependency("camera",dt.camera):void 0;dt.time===void 0&&(dt.time=dt.frame/30,console.error("Update timeline markers plugin for correct times.")),i.push({name:dt.name,frame:dt.frame,time:dt.time,camera:mt})}}if(i.length<1)return;i=i.sort((at,ct)=>at.frame-ct.frame);const s=e.scene??e.scenes[0];if(!s)return;s.userData.__markers=i;const o=this.plugin.timelineMarkers,c=i.map(at=>at.time);let _=o.length;const j=i.map(at=>_++),et=Math.max(...c)+.01;o.push(...i);const nt=new g.dUE(".currentTimelineMarker",c,j,2300),st=new g.m7l("animationTimelineMarker",et,[nt]);st.__gltfExport=!1,e.animations.push(st)}}const uO=h=>({afterParse(e){const i=h.json.scenes[h.json.scene||0];i.extensions=i.extensions||{};const s={markers:[]},o=[];if((Array.isArray(e)?e:[e]).forEach(c=>c.traverse(_=>{_.userData.__markers&&o.push(..._.userData.__markers)})),o.sort((c,_)=>c.frame-_.frame),!(o.length<1)){for(const c of o){const _=c.camera;if(_){const j=h.nodeMap.get(_);if(j===void 0){console.warn("Camera not found in gltf export",_,h.nodeMap);continue}const et=h.json.nodes[j].camera;c.camera=et,s.markers.push(c)}}i.extensions[Ql.AnimationMarkersExtension]=s,h.extensionsUsed[Ql.AnimationMarkersExtension]=!0}}});var Ux=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,oC=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,yw=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,Aw=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,D_=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class Am extends yo{get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}constructor(e,i,s,o=!1){super({vertexShader:Lm,fragmentShader:`

${Aw}
${Ux}
${Nv}
${oC}
${s}

${yw}

varying vec2 vUv;uniform float frameCount2;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount2+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount2)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount2<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount2)/(frameCount2+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!o},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},frameCount2:{value:0},projection:{value:new g.yGw},screenSize:{value:new g.FM8},cameraPositionWorld:{value:new g.Pa4},cameraNearFar:{value:new g.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:o?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(c,_,j)=>{var at;if(!c.defines.SSRTAO_ENABLED)return;this.materialExtension.extraUniforms.tSSGIMap.value=(at=this._target)==null?void 0:at.texture;const et=_.materialObject;let nt=this.material.defines.SSGI_ENABLED;et.defines.SSGI_ENABLED!==nt&&(et.defines.SSGI_ENABLED=nt,et.needsUpdate=!0),nt=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==nt&&(this.materialExtension.extraUniforms.tSSGIMap.value=nt,et.needsUpdate=!0);const st="vec3 totalDiffuse =";c.fragmentShader=c.fragmentShader.replace(st,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${st}`),c.fragmentShader=c.fragmentShader.replace("#include <aomap_fragment>",""),c.defines.USE_UV=""},onObjectRender:(c,_,j)=>{var at,ct;const et=_.materialObject,nt=!et.transparent&&et.transmission<.001,st=this.enabled&&nt&&(this.renderWithCamera||this._renderer.frameCount>1)&&j.userData.screenSpaceRendering!==!1&&!((at=et.userData)!=null&&at.ssrtaoDisabled)&&!((ct=et.userData)!=null&&ct.ssaoDisabled)?1:0;et.defines.SSRTAO_ENABLED!==st&&(et.defines.SSRTAO_ENABLED=st,et.needsUpdate=!0)},parsFragmentSnippet:c=>{var _;return b.glsl`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${dn("tSSGIMap",(_=this._target)==null?void 0:_.texture,c.capabilities.isWebGL2)}

            ${J1}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:c=>{var _,j,et,nt;return this.enabled?"1":"0"+((j=(_=this._target)==null?void 0:_.texture)==null?void 0:j.colorSpace)+((nt=(et=this._target)==null?void 0:et.texture)==null?void 0:nt.uuid)+this.material.defines.SSGI_ENABLED},isCompatible:c=>{var _;return!((_=c.materialObject.userData)!=null&&_.ssaoDisabled)&&c.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...Q_(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=i,this.needsSwap=!0,this._giActivated=o,this.ssgiEnabled=o,this.bilateralPass=new Gu(this._target,s,"rgba")}render(e,i,s,o,c){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,i),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,o,c),this.smoothEnabled&&this.bilateralPass.render(e,i,s,o,c))}}D_([En()],Am.prototype,"bilateralPass",void 0),D_([ns("Intensity",[0,4]),En(),cr()],Am.prototype,"intensity",void 0),D_([ns("Power",[0,3]),En(),cr()],Am.prototype,"power",void 0),D_([jr("Auto radius"),En(),cr()],Am.prototype,"autoRadius",void 0),D_([ns("Object Radius",[.01,10]),En(),cr()],Am.prototype,"objectRadius",void 0),D_([ns("Tolerance",[.1,5]),En(),cr()],Am.prototype,"tolerance",void 0),D_([ns("Bias",[-.3,.3]),En(),cr()],Am.prototype,"bias",void 0),D_([ns("Falloff",[1e-4,4]),En(),cr()],Am.prototype,"falloff",void 0),D_([ns("Ray Count",[1,5],1),En(),cr()],Am.prototype,"rayCount",void 0),D_([ns("Step count",[1,16],1),En(),Hr("RTAO_STEP_COUNT")],Am.prototype,"stepCount",void 0),D_([jr("Smooth Enabled"),En()],Am.prototype,"smoothEnabled",void 0),D_([jr("Render with Camera")],Am.prototype,"renderWithCamera",void 0);class Tp extends v0{get rtgiTarget(){return this._rtgiTarget}constructor(e=!0){super(),this.dependencies=[Fr,zo,Vp],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}async onAdded(e){var i,s;await super.onAdded(e),this.enabled=this._initEnabled,(s=(i=this.uiConfig).uiRefresh)==null||s.call(i,"postFrame",!0)}get enabled(){var e,i;return((i=(e=this.passes.ssrtgi)==null?void 0:e.passObject)==null?void 0:i.enabled)||!1}set enabled(e){var i;(i=this.passes.ssrtgi)!=null&&i.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var i,s;return this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1}),(i=this._viewer)==null||i.getPluginByType("debug"),[Rl(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Am(e.renderer,this._rtgiTarget,((s=e.getPlugin(zo))==null?void 0:s.getUnpackSnippet())??"",!0),update:()=>{var c;const o=this.enabled;if(o){const _=(c=this._viewer)==null?void 0:c.getPluginByType("SSAO");_!=null&&_.enabled&&(_.enabled=!1)}o&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(zo)])}},()=>[e.getPlugin(zo),e.getPlugin(Vp),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var i,s,o,c;const e=((s=(i=this.passes.ssrtgi)==null?void 0:i.passObject)==null?void 0:s.uiConfig)??{};return(c=(o=e.children)==null?void 0:o.map(_=>(0,b.getOrCall)(_)))==null||c.flat(2).forEach(_=>_&&(_.onChange=this.setDirty)),e}}Tp.PluginType="SSGI";let oy=class extends b_{constructor(h,e,i){super(h,e,i??new oM,new To(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(h,e,i,s,o){this.enabled&&super.render(h,e,i,s,o)}};oy=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_}([ks("High precision Normal Buffer")],oy);class oM extends g.RSm{constructor(){super()}onBeforeRender(e,i,s,o,c){let _=c.material;Array.isArray(_)&&(_=_[0]),this.normalMap=(_==null?void 0:_.normalMap)??null,this.bumpMap=(_==null?void 0:_.bumpMap)??null,this.bumpScale=_==null?void 0:_.bumpScale,_!=null&&_.normalScale&&this.normalScale.copy(_==null?void 0:_.normalScale),this.needsUpdate=!0,this.side=_.side??g.ehD}}class k_ extends t_{passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:g.cLu,minFilter:g.TyD,magFilter:g.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const i=this._normalTarget,s=new Set,o=new Set;return new class extends oy{render(c,_,j,et,nt){const st=c.getRenderTarget(),at=c.getActiveCubeFace(),ct=c.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:dt})=>{dt&&((dt.transparent&&dt.userData.renderToDepth||!dt.transparent&&dt.transmission===0&&dt.userData.renderToDepth===!1)&&(s.add(dt),dt.transparent=!dt.transparent),Math.abs(dt.transmission||0)>0&&dt.userData.renderToDepth&&(o.add([dt,dt.transmission]),dt.transmission=0))}),ls(c,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(c,_,i,et,nt)),s.forEach(dt=>dt.transparent=!dt.transparent),s.clear(),o.forEach(([dt,mt])=>dt.transmission=mt),o.clear(),c.setRenderTarget(st,at,ct))}}}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,i.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var i,s;return e.renderer.disposeTarget((s=(i=this._normalTarget)==null?void 0:i.dispose)==null?void 0:s.call(i)),super.onRemove(e)}updateShaderProperties(e){var i;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled?((i=this.getNormalBuffer())==null?void 0:i.texture)??null:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}k_.PluginType="NormalBufferPlugin";var bw=function(h,e){return bw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(i[o]=s[o])},bw(h,e)};function iA(h,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=h}bw(h,e),h.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var sA,oA=function(){function h(){}return h._xfnv1a=function(e){for(var i=2166136261,s=0;s<e.length;s++)i=Math.imul(i^e.charCodeAt(s),16777619);return function(){return i+=i<<13,i^=i>>>7,i+=i<<3,i^=i>>>17,(i+=i<<5)>>>0}},h}(),aE=function(h){function e(i){var s=h.call(this)||this;return s.a=e._xfnv1a(i)(),s}return iA(e,h),e.prototype.next=function(){var i=this.a+=1831565813;return i=Math.imul(i^i>>>15,1|i),(((i^=i+Math.imul(i^i>>>7,61|i))^i>>>14)>>>0)/4294967296},e}(oA),N2=function(h){function e(i){var s=h.call(this)||this,o=e._xfnv1a(i);return s.a=o(),s.b=o(),s.c=o(),s.d=o(),s}return iA(e,h),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var i=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,i=i+this.d|0,this.c=this.c+i|0,(i>>>0)/4294967296},e}(oA),aC=function(h){function e(i){var s=h.call(this)||this,o=e._xfnv1a(i);return s.a=o(),s.b=o(),s.c=o(),s.d=o(),s}return iA(e,h),e.prototype.next=function(){var i=this.b<<9,s=5*this.a;return s=s<<7|9*(s>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=i,this.d=this.d<<11|this.d>>>21,(s>>>0)/4294967296},e}(oA);(function(h){h.sfc32="sfc32",h.mulberry32="mulberry32",h.xoshiro128ss="xoshiro128ss"})(sA||(sA={}));var lE=function(){function h(e,i){i===void 0&&(i=sA.sfc32),this.str=e,this.prng=i,this.generator=this._initializeGenerator()}return h.prototype.next=function(){return this.generator.next()},h.prototype._initializeGenerator=function(){if(function(i){return i===null}(e=this.str)||function(i){return i===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new N2(this.str);case"mulberry32":return new aE(this.str);case"xoshiro128ss":return new aC(this.str);default:return this.wrap()}},h.prototype.wrap=function(){return{next:function(){return Math.random()}}},h}(),cE=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class Fx extends S_{constructor(e,i,s,o){super(e,i),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new g.Pa4(10,10,10),normalDirection:new g.Pa4(.01,.98,.01).normalize(),direction:new g.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=s??{},this.randomParams=o??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,i=null,s=null){const o=new lE(e.toString()),c=new g.FM8(o.next()*Math.PI*2,Math.asin(2*o.next()-1));let _=new g.Pa4(Math.cos(c.x)*Math.cos(c.y),Math.sin(c.y),Math.sin(c.x)*Math.cos(c.y));const j=new g.FM8;for(let et=0;et<5;et++){j.set(o.next(),o.next()),_=lC(j,this._randomParams.normalDirection,.4),o.next()<Math.sqrt(i??this._randomParams.focus)&&(j.set(o.next(),o.next()),_=lC(j,this._randomParams.direction,Math.pow((s??this._randomParams.spread)/2,2)));const nt=_.dot(this._randomParams.normalDirection);if(nt>0&&nt<.4)break}_.normalize(),_.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(_.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new g.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,i){return super.fromJSON(e,i)?(this.updateShadowParams(),this):null}}function lC(h,e,i){e=e.clone().normalize();const s=new g.Pa4(0,-e.z,e.y).normalize(),o=new g.Pa4().crossVectors(e,s).normalize(),c=h;c.x=2*c.x*Math.PI,c.y=1-c.y*i;const _=Math.sqrt(1-c.y*c.y);return s.multiplyScalar(Math.cos(c.x)*_).add(o.multiplyScalar(Math.sin(c.x)*_)).add(e.multiplyScalar(c.y))}cE([En("shadowParams")],Fx.prototype,"_shadowParams",void 0),cE([En("randomParams")],Fx.prototype,"_randomParams",void 0);var cC=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class ay extends ms{get cameraHelper(){return this._cameraHelper}constructor(e=!0){super(),this.enabled=!0,this.light=new Fx("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var s,o;if(!this.enabled)return void(this.light.layers.mask=0);const i=((s=this._viewer)==null?void 0:s.renderer.frameCount)??0;this.light.randomizePosition(i<5?0:i),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(o=this._cameraHelper)==null||o.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}async onAdded(e){await super.onAdded(e),this._cameraHelper=new g.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var i,s;e?(i=this._viewer)==null||i.scene.setDirty():(s=this._viewer)==null||s.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.05,.05],property:[this.light.shadowParams,"normalBias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}ay.PluginType="RandomizedDirectionalLight",cC([En()],ay.prototype,"enabled",void 0),cC([En("rdLight")],ay.prototype,"light",void 0),cC([En()],ay.prototype,"lightLayers",void 0);var uE=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,u_=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let h_=class extends yo{constructor(h,e,i,s=!0){super({vertexShader:Lm,fragmentShader:`

varying vec2 vUv;

${Aw}
${Ux}
${Nv}
${oC}
${i}

${yw}

${uE}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new g.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new g.yGw},cameraPositionWorld:{value:new g.Pa4},cameraNearFar:{value:new g.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:s?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(o,c,_)=>{var nt,st,at;let j=this.enabled&&_.userData.screenSpaceRendering!==!1&&!((nt=c.materialObject.userData)!=null&&nt.ssreflDisabled)?1:0;if(c.materialObject.defines.SSR_ENABLED!==j&&(c.materialObject.defines.SSR_ENABLED=j,c.materialObject.needsUpdate=!0),!o.defines.SSR_ENABLED)return;j=this.material.defines.SSR_STEP_COUNT,c.materialObject.defines.SSR_STEP_COUNT!==j&&(c.materialObject.defines.SSR_STEP_COUNT=j,c.materialObject.needsUpdate=!0),j=this.material.defines.SSR_LOW_QUALITY_FRAMES,c.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==j&&(c.materialObject.defines.SSR_LOW_QUALITY_FRAMES=j,c.materialObject.needsUpdate=!0),j=this.material.defines.PERSPECTIVE_CAMERA,c.materialObject.defines.PERSPECTIVE_CAMERA!==j&&(c.materialObject.defines.PERSPECTIVE_CAMERA=j,c.materialObject.needsUpdate=!0),j=this.material.defines.SSR_INLINE,c.materialObject.defines.SSR_INLINE!==j&&(c.materialObject.defines.SSR_INLINE=j,c.materialObject.needsUpdate=!0),j=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,c.materialObject.defines.SSR_MASK_FRONT_RAYS!==j&&(c.materialObject.defines.SSR_MASK_FRONT_RAYS=j,c.materialObject.needsUpdate=!0),j=(st=c.materialObject.userData)!=null&&st.ssreflNonPhysical?"1":"0",c.materialObject.defines.SSR_NON_PHYSICAL!==j&&(c.materialObject.defines.SSR_NON_PHYSICAL=j,c.materialObject.needsUpdate=!0),j=((at=this._target)==null?void 0:at.texture)??null,this.materialExtension.extraUniforms.tSSRMap.value!==j&&(this.materialExtension.extraUniforms.tSSRMap.value=j,c.materialObject.needsUpdate=!0);const et="#glMarker beforeModulation";o.fragmentShader=o.fragmentShader.replace(et,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${et}`)},onObjectRender:(o,c,_)=>{var et;const j=this.enabled&&_.userData.screenSpaceRendering!==!1&&!((et=c.materialObject.userData)!=null&&et.ssreflDisabled)?1:0;c.materialObject.defines.SSR_ENABLED!==j&&(c.materialObject.defines.SSR_ENABLED=j,c.materialObject.needsUpdate=!0)},parsFragmentSnippet:(o,c)=>{var _,j;return!this.enabled||o.userData.screenSpaceRendering===!1||(_=c==null?void 0:c.materialObject.userData)!=null&&_.ssreflDisabled?"":`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+dn("tSSRMap",(j=this._target)==null?void 0:j.texture,o.capabilities.isWebGL2)+dn("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,o.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${Aw}
    
    #define THREE_PACKING_INCLUDED
    ${Ux}
    
    ${Nv}
    ${oC}
    ${Zp}
    
    ${yw}
    
    ${uE}
// #endif // SSR_INLINE
#endif
`:"")+`
${J1}
        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:o=>{var c,_,j;return this.enabled?"1":"0"+((_=(c=this._target)==null?void 0:c.texture)==null?void 0:_.colorSpace)+(this.enabled&&!((j=o.materialObject.userData)!=null&&j.ssreflDisabled)?1:0)+Object.values(this.material.defines).map(et=>et+"").join(",")},isCompatible:o=>{var c;return!((c=o.materialObject.userData)!=null&&c.ssreflDisabled)&&o.isMeshStandardMaterial2}},this.intensity=1,this.boost=new g.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=h,this._target=e,this.needsSwap=!1,this._inline=s}render(h,e,i,s,o){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(h,this._target,i,s,o),this.needsSwap=!1}}};u_([ns("Intensity",[0,4]),En(),cr()],h_.prototype,"intensity",void 0),u_([Lp("Boost"),En(),cr()],h_.prototype,"boost",void 0),u_([ns("Object Radius",[.01,2]),En(),cr()],h_.prototype,"objectRadius",void 0),u_([jr("Auto radius"),En(),cr()],h_.prototype,"autoRadius",void 0),u_([ns("Power",[0,3]),En(),cr()],h_.prototype,"power",void 0),u_([ns("Tolerance",[.1,5]),En(),cr()],h_.prototype,"tolerance",void 0),u_([ns("Step count",[1,32],1),En(),Hr("SSR_STEP_COUNT")],h_.prototype,"stepCount",void 0),u_([ns("Low Quality Frames",[0,4],1),En(),Hr("SSR_LOW_QUALITY_FRAMES")],h_.prototype,"lowQualityFrames",void 0),u_([jr("Ignore front rays"),En(),Hr("SSR_MASK_FRONT_RAYS")],h_.prototype,"maskFrontRays",void 0),u_([ns("Mask front rays factor",[-1,1],.01,h=>({hidden:()=>!h.maskFrontRays})),En(),cr()],h_.prototype,"maskFrontFactor",void 0),h_=u_([ks("Screen Space Reflections")],h_);class jx extends v0{get ssrTarget(){return this._ssrTarget}constructor(){super(),this.dependencies=[Fr,zo,Vp],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get enabled(){var e,i;return((i=(e=this.passes.ssr)==null?void 0:e.passObject)==null?void 0:i.enabled)||!1}set enabled(e){var i;(i=this.passes.ssr)!=null&&i.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var i,s;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(s=(i=this.uiConfig).uiRefresh)==null||s.call(i,"postFrame",!0)}createPasses(e){var i;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[Rl(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new h_(e.renderer,this._ssrTarget,((i=e.getPlugin(zo))==null?void 0:i.getUnpackSnippet())??"",this.inlineSSR)},()=>[e.getPlugin(zo),e.getPlugin(Vp),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var i,s,o,c;const e=((s=(i=this.passes.ssr)==null?void 0:i.passObject)==null?void 0:s.uiConfig)??{};return(c=(o=e.children)==null?void 0:o.map(_=>(0,b.getOrCall)(_)))==null||c.flat(2).forEach(_=>_&&(_.onChange=this.setDirty)),e}}jx.PluginType="SSReflection";var uC=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Nm=class extends ms{makeAnisotropic(h){var i;const e=(i=h.materialObject)==null?void 0:i.userData;if(!e)return!1;if(e._isAnisotropic===void 0){const s=e.__appliedMeshes;let o=!0;if(s)for(const{geometry:c}of s)!c||c.index&&c.attributes.position&&c.attributes.normal&&c.attributes.uv||(o=!1),o&&!c.attributes.tangent&&c.computeTangents();if(!o)return!1}return e._isAnisotropic=!0,e._anisotropyFactor===void 0&&(e._anisotropyFactor=1),e._anisotropyNoise===void 0&&(e._anisotropyNoise=0),e._anisotropyDirectionMode===void 0&&(e._anisotropyDirectionMode="DIRECTION"),h.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new U2(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Fr],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(h,e,i)=>{var j;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const s=(j=e.materialObject.userData)==null?void 0:j._anisotropyDirectionMap,o=b.glsl`
                //#if ANISOTROPY_ENABLED
                ${Nv}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(s?dn("anisotropyDirectionMap",s,i.capabilities.isWebGL2):"")+`
`;h.fragmentShader=os(h.fragmentShader,"#include <common>",o,{append:!0}),h.fragmentShader=h.fragmentShader.replace("#include <lights_fragment_begin>",g.WdD.lights_fragment_begin),h.fragmentShader=os(os(h.fragmentShader,"IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tbn[0]*rot2.x+tbn[1]*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));`,{prepend:!0}),"RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )",{replaceAll:!0});let c=os(g.WdD.lights_physical_pars_fragment,"void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {");c=os(c,"BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )"),h.fragmentShader=os(h.fragmentShader,"#include <lights_physical_pars_fragment>",c),h.fragmentShader=os(h.fragmentShader,"#include <normal_fragment_begin>",g.WdD.normal_fragment_begin),h.fragmentShader=os(h.fragmentShader,"#ifdef USE_NORMALMAP_TANGENTSPACE","#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_TANGENT )");let _=b.glsl`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+g.WdD.lights_fragment_maps;_=os(_,"getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )"),_=os(_,"getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )"),h.fragmentShader=os(h.fragmentShader,"#include <lights_fragment_maps>",_),h.defines.USE_UV="",h.vertexTangents=!0},onObjectRender:(h,e)=>{var c;const i=e.materialObject.userData;if(!(i!=null&&i._isAnisotropic))return;const s=h;if(!s.isMesh||!s.geometry)return;if(!s.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=i._anisotropyFactor,this._uniforms.anisotropyNoise.value=i._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=(c=i._anisotropyDirectionMap)!=null&&c.isTexture?i._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=i._anisotropyDirection;let o=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==o&&(e.materialObject.defines.ANISOTROPY_ENABLED=o,e.materialObject.needsUpdate=!0),o=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==o&&(e.materialObject.defines.ANISOTROPY_DEBUG=o,e.materialObject.needsUpdate=!0),o=i._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(o="CONSTANT"),o=o==="DIRECTION"?2:o==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==o&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=o,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i,s;return(this.enabled?"1":"0")+((e=h.materialObject.userData)!=null&&e._isAnisotropic?"1":"0")+((s=(i=h.materialObject.userData)==null?void 0:i._anisotropyDirectionMap)==null?void 0:s.uuid)},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>{var h;return[(h=this._viewer)==null?void 0:h.renderer]},getUiConfig:h=>{const e=this._viewer,i=this.makeAnisotropic,s={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return h.materialObject.userData._isAnisotropic||!1},set value(o){var c;o!==h.materialObject.userData._isAnisotropic&&(o?i(h)||e.alert("One or more geometries cannot be made anisotropic."):(h.materialObject.userData._isAnisotropic=!1,h.materialObject.needsUpdate=!0),(c=s.uiRefresh)==null||c.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{h.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(o=>({label:o})),onChange:()=>{h.materialObject.needsUpdate=!0,this.setDirty()}}]};return s}},this.setDirty=()=>{var h,e,i;(e=(h=this.materialExtension).setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()},this.makeSelectedAnisotropic=()=>{var e,i,s;const h=(s=(i=(e=this._viewer)==null?void 0:e.getPlugin(Bo))==null?void 0:i.getSelectedObject())==null?void 0:s.material;return(h==null?void 0:h.assetType)==="material"&&this.makeAnisotropic(h)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,_;await super.onAdded(h);const e=h.getPlugin(Fr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(_=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||_.push(hO)}async onRemove(h){var e,i,s,o;return(i=(e=h.getPlugin(Fr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),(o=(s=h.getPlugin(Fr))==null?void 0:s.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};Nm.PluginType="AnisotropyPlugin",Nm.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",uC([jr("Enabled",h=>({onChange:h.setDirty})),En()],Nm.prototype,"enabled",void 0),uC([Oo("Make Anisotropy",h=>({hidden:()=>{var e;return!((e=h._viewer)!=null&&e.getPlugin(Bo))}}))],Nm.prototype,"makeSelectedAnisotropic",void 0),Nm=uC([ks("Anisotropy Materials")],Nm);class U2{constructor(e){this.parser=e,this.name=Nm.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser,o=s.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const c=[],_=o.extensions[this.name];i.userData||(i.userData={}),i.userData._isAnisotropic=!0,i.userData._anisotropyFactor=_.anisotropyFactor??0,i.userData._anisotropyNoise=_.anisotropyNoiseFactor??_.anisotropyNoise??0;let{anisotropyDirectionMode:j,anisotropyDirection:et}=_;return j||(j=_.anisotropyTextureMode),et||(et=_.anisotropyRotation),i.userData._anisotropyDirectionMode=j&&typeof(et==null?void 0:et.index)=="number"?j:"CONSTANT",j==="ROTATION"||j==="DIRECTION"?c.push(s.assignTexture(i.userData,"_anisotropyDirectionMap",et).then(nt=>{nt.colorSpace=g.KI_})):i.userData._anisotropyDirection=et??0,Promise.all(c)}afterRoot(e){var i;return(i=e.scene)==null||i.traverse(s=>{var _,j;if(!((j=(_=s.material)==null?void 0:_.userData)==null?void 0:j._isAnisotropic))return;const c=s.geometry;c.attributes.tangent||(c.computeTangents(),c.attributes.tangent.needsUpdate=!0)}),null}}const hO=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.anisotropyFactor=e.userData._anisotropyFactor||1,s.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,s.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&s.anisotropyDirectionMode!=="CONSTANT"){const o={index:h.processTexture(e.userData._anisotropyDirectionMap)};h.applyTextureTransform(o,e.userData._anisotropyDirectionMap),s.anisotropyDirection=o}else s.anisotropyDirectionMode="CONSTANT",s.anisotropyDirection=e.userData._anisotropyDirection||0;i.extensions[Nm.ANISOTROPY_GLTF_EXTENSION]=s,h.extensionsUsed[Nm.ANISOTROPY_GLTF_EXTENSION]=!0}});var hC,ww=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let d_=hC=class extends ms{static AddFragmentClipping(h,e,i,s,o){var j;const c=(j=h.materialObject)==null?void 0:j.userData;if(!c)return!1;c._fragmentClippingExt||(c._fragmentClippingExt={});const _=c._fragmentClippingExt;return _.clipEnabled=!0,_.clipPosition===void 0&&(_.clipPosition=(e==null?void 0:e.toArray())??[0,0,0,0]),_.clipParams===void 0&&(_.clipParams=(i==null?void 0:i.toArray())??[1,0,0,0]),_.clipMode===void 0&&(_.clipMode=s??Hp.Circle),_.clipInvert===void 0&&(_.clipInvert=o??!1),h.materialObject.isMaterial&&(h.needsUpdate=!0),!0}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new zx(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Fr,zo],this._plane=new g.JOQ,this._viewNormalMatrix=new g.Vkp,this._defines={FRAG_CLIPPING_DEBUG:!1},this._uniforms={fragClippingPosition:{value:new g.Ltg},fragClippingParams:{value:new g.Ltg},fragClippingCamAspect:{value:1}},this.materialExtension={parsFragmentSnippet:(h,e)=>{var i;return this.enabled&&((i=e==null?void 0:e.materialObject.userData._fragmentClippingExt)!=null&&i.clipEnabled)?J1+b.glsl`
uniform vec4 fragClippingPosition;
uniform vec4 fragClippingParams;
uniform float fragClippingCamAspect;
#if FRAG_CLIPPING_MODE == ${Hp.Circle}
float fragClippingCircle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    float radius = fragClippingParams.x;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#elif FRAG_CLIPPING_MODE == ${Hp.Ellipse}
float fragClippingEllipse(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length((pos - center) / radius) - 1.0;
}
#elif FRAG_CLIPPING_MODE == ${Hp.Rectangle}
float fragClippingRectangle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    vec2 d = abs(pos - center) - radius;
    return min(max(d.x,d.y),0.0) + length(max(d,0.0));
}
#elif FRAG_CLIPPING_MODE == ${Hp.Plane}
float fragClippingPlane(){
    vec3 pos = vViewPosition.xyz;
    vec3 normal = fragClippingParams.xyz;
    float d = dot(pos, normal) - fragClippingParams.w;
    return d;
}
#elif FRAG_CLIPPING_MODE == ${Hp.Sphere}
float fragClippingSphere(){
    vec3 pos = vViewPosition.xyz;
    vec3 center = fragClippingPosition.xyz;
    float radius = fragClippingParams.x;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#endif
        `:""},shaderExtender:(h,e,i)=>{var s;this.enabled&&((s=e.materialObject.userData._fragmentClippingExt)!=null&&s.clipEnabled)&&(h.fragmentShader=os(h.fragmentShader,"#glMarker mainStart",b.glsl`
    float fragClippingDist = 0.0;
    #if FRAG_CLIPPING_MODE == ${Hp.Circle}
    fragClippingDist = fragClippingCircle();
    #elif FRAG_CLIPPING_MODE == ${Hp.Ellipse}
    fragClippingDist = fragClippingEllipse();
    #elif FRAG_CLIPPING_MODE == ${Hp.Rectangle}
    fragClippingDist = fragClippingRectangle();
    #elif FRAG_CLIPPING_MODE == ${Hp.Plane}
    fragClippingDist = fragClippingPlane();
    #elif FRAG_CLIPPING_MODE == ${Hp.Sphere}
    fragClippingDist = fragClippingSphere();
    #endif
    #if FRAG_CLIPPING_DEBUG
    gl_FragColor = vec4(max(fragClippingDist, 0.0), 0.0, 0.0, 1.0); 
//    gl_FragColor = vec4(vViewPosition.xyz, 1.0);
    #include <encodings_fragment>
    return;
    #endif
    
    #if FRAG_CLIPPING_INVERSE == 1
    if (fragClippingDist > 0.0) discard;
    #else
    if (fragClippingDist < 0.0) discard;
    #endif
            `,{append:!0}))},onObjectRender:(h,e)=>{var o,c,_,j,et,nt;let i=(o=e.materialObject.userData)==null?void 0:o._fragmentClippingExt;if(e.materialObject.userData.isGBufferMaterial&&h&&(i=(_=(c=h.material)==null?void 0:c.userData)==null?void 0:_._fragmentClippingExt),!(i!=null&&i.clipEnabled))return;if(this._uniforms.fragClippingPosition.value.fromArray(i.clipPosition),i.clipMode===Hp.Plane){const st=(j=this._viewer)==null?void 0:j.scene.activeCamera.cameraObject.matrixWorldInverse;this._plane.normal.set(i.clipParams[0],i.clipParams[1],i.clipParams[2]),this._plane.constant=i.clipParams[3],this._viewNormalMatrix.getNormalMatrix(st),this._plane.applyMatrix4(st,this._viewNormalMatrix),this._uniforms.fragClippingParams.value.set(this._plane.normal.x,this._plane.normal.y,this._plane.normal.z,this._plane.constant)}else this._uniforms.fragClippingParams.value.fromArray(i.clipParams);((et=this._viewer)==null?void 0:et.scene.activeCamera.cameraObject)instanceof g.cPb?this._uniforms.fragClippingCamAspect.value=(nt=this._viewer)==null?void 0:nt.scene.activeCamera.cameraObject.aspect:this._uniforms.fragClippingCamAspect.value=1;let s=this.enabled?1:0;s=+this._defines.FRAG_CLIPPING_DEBUG,e.materialObject.defines.FRAG_CLIPPING_DEBUG!==s&&(e.materialObject.defines.FRAG_CLIPPING_DEBUG=s,e.materialObject.needsUpdate=!0),s=+i.clipMode,e.materialObject.defines.FRAG_CLIPPING_MODE!==s&&(e.materialObject.defines.FRAG_CLIPPING_MODE=s,e.materialObject.needsUpdate=!0),s=+i.clipInvert,e.materialObject.defines.FRAG_CLIPPING_INVERSE!==s&&(e.materialObject.defines.FRAG_CLIPPING_INVERSE=s,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i;return(this.enabled?"1":"0")+((i=(e=h.materialObject.userData)==null?void 0:e._fragmentClippingExt)!=null&&i.clipEnabled?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2||h.userData.isGBufferMaterial,updaters:()=>[],getUiConfig:h=>{const e=this._viewer,i={type:"folder",label:"FragmentClipping",children:[{type:"checkbox",label:"Enabled",getValue:()=>{var s;return((s=h.materialObject.userData._fragmentClippingExt)==null?void 0:s.clipEnabled)||!1},setValue:s=>{var o,c;s!==((o=h.materialObject.userData._fragmentClippingExt)==null?void 0:o.clipEnabled)&&(s?hC.AddFragmentClipping(h.materialObject)||e.alert("Cannot add fragment clipping extension."):h.materialObject.userData._fragmentClippingExt&&(h.materialObject.userData._fragmentClippingExt.clipEnabled=!1,h.materialObject.needsUpdate=!0),(c=i.uiRefresh)==null||c.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"dropdown",label:"Mode",children:Object.entries(Hp).map(s=>({label:s[0],value:s[1]})),hidden:()=>{var s;return!((s=h.materialObject.userData._fragmentClippingExt)!=null&&s.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipMode"],onChange:this.setDirty}),()=>({type:"vec4",label:"Position",bounds:[-1,1],hidden:()=>{var s;return!((s=h.materialObject.userData._fragmentClippingExt)!=null&&s.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipPosition"],onChange:this.setDirty}),()=>({type:"vec4",label:"Params",bounds:[0,1],hidden:()=>{var s;return!((s=h.materialObject.userData._fragmentClippingExt)!=null&&s.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipParams"],onChange:this.setDirty}),()=>({type:"toggle",label:"Invert",hidden:()=>{var s;return!((s=h.materialObject.userData._fragmentClippingExt)!=null&&s.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipInvert"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var h,e,i;(e=(h=this.materialExtension).setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,_,j,et;await super.onAdded(h);const e=h.getPlugin(Fr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(_=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||_.push(F2),(et=(j=h.getPlugin(zo))==null?void 0:j.material)==null||et.registerMaterialExtensions([this.materialExtension])}async onRemove(h){var e,i,s,o;return(i=(e=h.getPlugin(Fr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),(o=(s=h.getPlugin(Fr))==null?void 0:s.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};var Hp;d_.PluginType="FragmentClippingExtensionPlugin1",d_.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION="WEBGI_materials_fragment_clipping_extension",ww([jr("Enabled",h=>({onChange:h.setDirty})),En()],d_.prototype,"enabled",void 0),d_=hC=ww([ks("FragmentClipping Materials")],d_),function(h){h[h.Circle=0]="Circle",h[h.Ellipse=1]="Ellipse",h[h.Rectangle=2]="Rectangle",h[h.Plane=3]="Plane",h[h.Sphere=4]="Sphere"}(Hp||(Hp={}));class zx{constructor(e){this.parser=e,this.name=d_.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return i.userData||(i.userData={}),d_.AddFragmentClipping(i),i.userData._fragmentClippingExt=ao(o,i.userData._fragmentClippingExt,!1,{}),Promise.resolve()}}const F2=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._fragmentClippingExt||!e.userData._fragmentClippingExt.clipEnabled)return;i.extensions=i.extensions||{};const s=Ls(e.userData._fragmentClippingExt,!1);i.extensions[d_.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=s,h.extensionsUsed[d_.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=!0}});var Vx,aA=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let bm=Vx=class extends ms{constructor(h=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this.originPosition=new g.Pa4(0,0,0),this._paramsChanged=this._paramsChanged.bind(this),this.enabled=h,this.addEventListener("deserialize",this._paramsChanged)}_paramsChanged(){var s,o,c;if(!this._viewer)return;const h=this._viewer.scene.background;if(this.enabled&&h!==this._viewer.scene.environment&&h!=="environment")if(h&&h.isDataTexture)h.mapping=g.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const _=this._viewer.getPluginByType("SimpleBackgroundEnvUiPlugin1");_?(_.envmapBg=!0,(o=(s=_.uiConfig).uiRefresh)==null||o.call(s,"postFrame",!0)):this._viewer.scene.setBackground("environment")}else this.enabled=!1;const e=(c=this._viewer.renderer.rendererObject.background.getBoxMesh2())==null?void 0:c.material,i=(e==null?void 0:e.uniforms)??g.Vj0.backgroundCube.uniforms;i.tripodHeight||(i.tripodHeight={value:1}),i.worldRadius||(i.worldRadius={value:1}),i.originPosition||(i.originPosition={value:new g.Pa4}),i.tripodHeight.value=this.tripodHeight,i.worldRadius.value=this.worldRadius,i.originPosition.value.copy(this.originPosition),e&&(!this.enabled&&e.defines.HDRi_GROUND_PROJ?delete e.defines.HDRi_GROUND_PROJ:this.enabled&&(e.defines.HDRi_GROUND_PROJ="1"),e.needsUpdate=!0),this._viewer.setDirty()}async onAdded(h){var e,i,s;await super.onAdded(h),(s=(i=(e=this._viewer)==null?void 0:e.renderer)==null?void 0:i.rendererObject)!=null&&s.background.getBoxMesh()&&h.console.error("HDRi Ground Plugin must be added before setting any cube or env map"),g.Vj0.backgroundCube.fragmentShader.includes("#ifdef HDRi_GROUND_PROJ")||(g.Vj0.backgroundCube.fragmentShader=os(g.Vj0.backgroundCube.fragmentShader,"void main() {",`#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;uniform vec3 originPosition;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,originPosition,worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),originPosition+vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif
`,{prepend:!0}),g.Vj0.backgroundCube.fragmentShader=os(g.Vj0.backgroundCube.fragmentShader,"vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`)),h.scene.addEventListener("environmentChanged",this._paramsChanged)}};bm.PluginType="HDRiGroundPlugin",aA([En(),(0,b.onChange)(Vx.prototype._paramsChanged),jr("Enabled")],bm.prototype,"enabled",void 0),aA([En(),(0,b.onChange)(Vx.prototype._paramsChanged),ns("World Radius",[1,1e3],.01)],bm.prototype,"worldRadius",void 0),aA([En(),(0,b.onChange)(Vx.prototype._paramsChanged),ns("Tripod height",[0,50],.01)],bm.prototype,"tripodHeight",void 0),aA([En(),(0,b.onChange)(Vx.prototype._paramsChanged),Lp("Origin Position",void 0,.001,h=>({onChange:h._paramsChanged}))],bm.prototype,"originPosition",void 0),bm=Vx=aA([ks("HDRi Ground")],bm);var Fv,lA=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let sm=Fv=class extends ms{constructor(h=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[zo,Fr],this.materialExtension={shaderExtender:(e,i,s)=>{if(!e.defines.SSCS_ENABLED)return;const o=b.glsl`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,c=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${Aw}
    
    #define THREE_PACKING_INCLUDED
    ${Ux}
    
    ${Zp}
    ${Nv}
    
    ${yw}

#endif
            
            `+g.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${o}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",c),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",g.WdD.lights_fragment_begin),e.fragmentShader=os(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;"),e.fragmentShader=os(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,i,s)=>{var _;const o=i.materialObject;let c=this.enabled&&s.userData.screenSpaceRendering!==!1&&!((_=o.userData)!=null&&_.sscsDisabled)?1:0;o.defines.SSCS_ENABLED!==c&&(o.defines.SSCS_ENABLED=c,o.needsUpdate=!0),c=this._defines.SSCS_STEP_COUNT,o.defines.SSCS_STEP_COUNT!==c&&(o.defines.SSCS_STEP_COUNT=c,o.needsUpdate=!0),c=+this._defines.SSCS_DEBUG,o.defines.SSCS_DEBUG!==c&&(o.defines.SSCS_DEBUG=c,o.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...Fv._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,i,s,o,c;return[(e=this._viewer)==null?void 0:e.getPlugin(zo),(i=this._viewer)==null?void 0:i.getPlugin(Vp),(s=this._viewer)==null?void 0:s.scene.renderCamera,(o=this._viewer)==null?void 0:o.renderer,(c=this._viewer)==null?void 0:c.scene]}},this.enabled=h,this.userData={setDirty:()=>{var e;(e=this._viewer)==null||e.setDirty()}}}async onAdded(h){var e,i;await super.onAdded(h),(i=(e=h.getPlugin(Fr))==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension)}async onRemove(h){var e,i;return(i=(e=h.getPlugin(Fr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),super.onRemove(h)}};sm.PluginType="SSContactShadows",sm._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new g.yGw},cameraPositionWorld:{value:new g.Pa4},cameraNearFar:{value:new g.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},lA([jr("Enabled"),En()],sm.prototype,"enabled",void 0),lA([cr({uniforms:Fv._uniforms,propKey:"sscsRadius"}),ns("Radius",[1e-4,.1],1e-4),En()],sm.prototype,"radius",void 0),lA([cr({uniforms:Fv._uniforms,propKey:"sscsIntensity"}),ns("Intensity",[1e-4,1],1e-4),En()],sm.prototype,"intensity",void 0),lA([cr({uniforms:Fv._uniforms,propKey:"sscsTolerance"}),ns("Tolerance",[.1,5]),En()],sm.prototype,"tolerance",void 0),lA([Hr("SSCS_DEBUG",void 0,!0),jr("Debug only SSCS"),En()],sm.prototype,"onlySSCSDebug",void 0),lA([Hr("SSCS_STEP_COUNT",void 0,!0),ns("Step count",[1,8],1),En()],sm.prototype,"stepCount",void 0),sm=Fv=lA([ks("Screen Space Contact Shadows")],sm);class Gx{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new g.xsS,this._mesh=new g.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new j2}dispose(){var e;(e=this._mesh.geometry)==null||e.dispose(),this._mesh.material.dispose(),this.disposeAllTargets()}disposeTarget(e){e.split(";").forEach(i=>{var s;return(s=this._normalsCache[i])==null?void 0:s.dispose()})}disposeAllTargets(){Object.values(this._normalsCache).forEach(e=>e.dispose())}hasCapturedNormalMap(e){return!!e.userData._normalsCaptureMap}captureNormalMap(e,i,s=512){if(!e)throw"No geometry";if(this.hasCapturedNormalMap(e))return!1;const o=i==null?void 0:i.split(";").find(j=>this._normalsCache[j]);if(o){const j=this._normalsCache[o];return i==null||i.split(";").forEach(et=>et!==o&&(this._normalsCache[et]=j)),j.width!==s&&console.warn("last cacheKey normalMapRes mismatch, check model",s),e.userData._normalsCaptureMap=j,!1}const c=this._renderer.createTargetCustom({width:s,height:s},{minFilter:g.TyD,magFilter:g.TyD,generateMipmaps:!1,type:g.cLu},g.oAp);if(c.attachedGeometries=[],c.autoDispose=Gx.AutoDisposeTargets,!c)throw"Unable to create render target";const _=()=>{const j=new g._am(1e-4,100,c);this._scene.add(j);const et=e.userData.normalsCaptureOffsets;et.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.fromArray(et.center),et.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.fromArray(et.offsetMatrixInv),et.radius!==void 0&&(this._mesh.material.uniforms.radius.value=et.radius),this._mesh.geometry=e,j.update(this._renderer.rendererObject,this._scene),this._scene.remove(j),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=c};return _(),this._renderer.addEventListener("contextRestored",_),c.attachedGeometries.push(e),e.addEventListener("dispose",()=>{var j;c.attachedGeometries=((j=c.attachedGeometries)==null?void 0:j.filter(et=>et!==e))??[],delete e.userData._normalsCaptureMap,this._renderer.removeEventListener("contextRestored",_),c.autoDispose&&!c.attachedGeometries.length&&c.dispose()}),i==null||i.split(";").forEach(j=>this._normalsCache[j]=c),c.addEventListener("dispose",()=>{i==null||i.split(";").forEach(j=>delete this._normalsCache[j]),this._renderer.removeEventListener("contextRestored",_),delete e.userData._normalsCaptureMap}),!0}}Gx.AutoDisposeTargets=!0;class j2 extends g.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:g.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new g.yGw().identity()},offsetCenter:{value:new g.Pa4}}})}}var hE=__webpackgi_require__(654);function Hx(h){const e=new g.Pa4(0,0,0),i=new g.Pa4(0,0,0),s=new g.Pa4(0,0,0),o=new g.Pa4(0,0,0),c=h.getAttribute("position"),_=h.index;if(_)for(let ct=Math.max(0,h.drawRange.start),dt=Math.min(_.count,h.drawRange.start+h.drawRange.count)-1;ct<dt/3;ct+=3){const mt=_.getX(ct),yt=_.getX(ct+1),wt=_.getX(ct+2);i.set(c.getX(mt),c.getY(mt),c.getZ(mt)),s.set(c.getX(yt),c.getY(yt),c.getZ(yt)),o.set(c.getX(wt),c.getY(wt),c.getZ(wt)),s.sub(i),o.sub(i),o.cross(s),o.normalize(),e.add(o)}else for(let ct=0;ct<c.count;ct+=3)i.set(c.getX(ct),c.getY(ct),c.getZ(ct)),s.set(c.getX(ct+1),c.getY(ct+1),c.getZ(ct+1)),o.set(c.getX(ct+2),c.getY(ct+2),c.getZ(ct+2)),s.sub(i),o.sub(i),o.cross(s),o.normalize(),e.add(o);e.normalize();let j=!1,et=0;for(;!j;){const ct=et/3,dt=_?_.getX(ct):ct,mt=_?_.getX(ct+1):ct+1;i.set(c.getX(dt),c.getY(dt),c.getZ(dt)),s.set(c.getX(mt),c.getY(mt),c.getZ(mt)),i.sub(s),i.normalize();const yt=e.dot(i);Math.abs(yt-1)>.001&&i.length()>.5&&(j=!0),et+=3}s.crossVectors(i,e),s.normalize(),i.crossVectors(e,s),i.normalize();const nt=new g.yGw;nt.elements[0]=i.x,nt.elements[1]=i.y,nt.elements[2]=i.z,nt.elements[3]=0,nt.elements[4]=e.x,nt.elements[5]=e.y,nt.elements[6]=e.z,nt.elements[7]=0,nt.elements[8]=s.x,nt.elements[9]=s.y,nt.elements[10]=s.z,nt.elements[11]=0,nt.elements[12]=0,nt.elements[13]=0,nt.elements[14]=0,nt.elements[15]=1,h.computeBoundingSphere();const st=h.boundingSphere.radius,at=new g.yGw().makeScale(st,st,st);return nt.multiply(at),nt}function z2(h,e,i){const s=new g.Pa4().copy(h),o=new g.Pa4().copy(e),c=new g.Pa4().copy(i);return s.dot(o.cross(c))/6}function Um(h,e,i){const s=new g.Pa4().copy(h),o=new g.Pa4().copy(e),c=new g.Pa4().copy(i);return o.sub(s),c.sub(s),c.cross(o),.5*c.length()}function aM(h){const e=h.getAttribute("position"),i=h.getAttribute("normal");if(e.count/3>500)return console.warn("DiamondPlugin:: Too many faces. Mirror/Topology issues will not be fixed",e.count/3),Hx(h);const s=new g.Pa4(0,0,0),o=new g.Pa4(0,0,0),c=new g.Pa4(0,0,0),_=h.index,j=[];if(_)for(let Ct=Math.max(0,h.drawRange.start),bt=Math.min(_.count,h.drawRange.start+h.drawRange.count)-1;Ct<bt;Ct+=3){const At=_.getX(Ct),Pt=_.getX(Ct+1),Dt=_.getX(Ct+2);s.set(e.getX(At),e.getY(At),e.getZ(At)),o.set(e.getX(Pt),e.getY(Pt),e.getZ(Pt)),c.set(e.getX(Dt),e.getY(Dt),e.getZ(Dt)),j.push(s.toArray(),o.toArray(),c.toArray())}else for(let Ct=0;Ct<e.count;Ct++)s.set(e.getX(Ct),e.getY(Ct),e.getZ(Ct)),j.push(s.toArray());const et=function(Ct,bt){const At=new g.Pa4;for(let mn=0;mn<Ct.length;mn+=3)At.x+=Ct[mn],At.y+=Ct[mn+1],At.z+=Ct[mn+2];At.multiplyScalar(1/(Ct.length/3));const Pt=new g.Pa4,Dt=new g.Pa4,Nt=new g.Pa4,Vt=new g.Pa4,Zt=new g.Pa4;let an=0,fn=0;for(let mn=0;mn<bt.length;mn+=3){Pt.set(bt[mn][0],bt[mn][1],bt[mn][2]),Dt.set(bt[mn+1][0],bt[mn+1][1],bt[mn+1][2]),Nt.set(bt[mn+2][0],bt[mn+2][1],bt[mn+2][2]),Zt.copy(Pt).add(Dt).add(Nt);const Sn=Um(Pt,Dt,Nt);Zt.multiplyScalar(Sn/3),Vt.add(Zt),an+=Sn,fn+=z2(Pt,Dt,Nt)}return Vt.multiplyScalar(1/an),{centre:At,com:Vt,volume:fn,area:an}}(e.array,j);if(et.volume<0){console.warn("DiamondPlugin:: Negative Volume, Fixing Normals");for(let Ct=0;Ct<i.count;Ct++)i.setX(Ct,-i.getX(Ct)),i.setY(Ct,-i.getY(Ct)),i.setZ(Ct,-i.getZ(Ct));i.needsUpdate=!0}const nt=[];for(let Ct=0;Ct<e.array.length;Ct+=3)nt.push([e.array[Ct],e.array[Ct+1],e.array[Ct+2]]);const st=console.log;console.log=()=>{};const at=(0,hE.getEigenVectors)(nt);console.log=st;const ct=new g.yGw;ct.elements[0]=at[0].vector[0],ct.elements[1]=at[0].vector[1],ct.elements[2]=at[0].vector[2],ct.elements[3]=0,ct.elements[4]=at[1].vector[0],ct.elements[5]=at[1].vector[1],ct.elements[6]=at[1].vector[2],ct.elements[7]=0,ct.elements[8]=at[2].vector[0],ct.elements[9]=at[2].vector[1],ct.elements[10]=at[2].vector[2],ct.elements[11]=0,ct.elements[12]=0,ct.elements[13]=0,ct.elements[14]=0,ct.elements[15]=1;const dt=new g.Pa4;dt.copy(et.com).sub(et.centre),dt.normalize();const mt=new g.Pa4(at[2].vector[0],at[2].vector[1],at[2].vector[2]);dt.dot(mt)<0&&(ct.elements[4]=-at[1].vector[0],ct.elements[5]=-at[1].vector[1],ct.elements[6]=-at[1].vector[2],ct.elements[8]=-at[2].vector[0],ct.elements[9]=-at[2].vector[1],ct.elements[10]=-at[2].vector[2]),h.computeBoundingSphere();const yt=h.boundingSphere.radius,wt=new g.yGw().makeScale(yt,yt,yt);return ct.multiply(wt),ct}const lM={...N1,color:new To(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new g.Pa4(.892,.892,.98595025),wireframe:!1,envMapRotationOffset:0,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0,envMapIndex:0};var om=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class _a extends g.jyz{get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,i,s,o,c){var et,nt;super.onBeforeRender(e,i,s,o,c),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||i.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=i.envMapIntensity),this.envMap!==void 0&&i.fixedEnvMapDirection!==void 0&&(i.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.uniforms.envMapRotation.value=(((et=this.envMap)==null?void 0:et.rotation)||0)+this.envMapRotationOffset,this.extraUniformsToUpload.inverseModelMatrix.value.copy(c.matrixWorld).invert();const _=o.userData.normalsCaptureOffsets;_&&(this.extraUniformsToUpload.centerOffset.value.fromArray(_.centerOffset),this.extraUniformsToUpload.modelOffsetMatrix.value.fromArray(_.offsetMatrix).premultiply(c.matrixWorld),this.extraUniformsToUpload.modelOffsetMatrixInv.value.copy(this.extraUniformsToUpload.modelOffsetMatrix.value).invert(),this.extraUniformsToUpload.radius.value=_.radius);const j=(nt=o.userData._normalsCaptureMap)==null?void 0:nt.texture;this.normalsCaptureMap!==j&&(this.normalsCaptureMap=j),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}onAfterRender(e,i,s,o,c){super.onAfterRender(e,i,s,o,c),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:i,camera:s,geometry:o,object:c})}constructor(e){super({side:g.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;
#ifdef USE_INSTANCING
uniform mat4 inverseModelMatrix;uniform mat4 modelOffsetMatrix;varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#endif
void main(){
#ifdef USE_INSTANCING
vWorldNormal=(modelMatrix*instanceMatrix*vec4(normal,0.)).xyz;
#else
vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#endif
#include <beginnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <project_vertex>
vViewPosition=-mvPosition.xyz;vUv=uv;
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;
#ifdef USE_INSTANCING
vModelInstanceOffsetMatrix=modelMatrix*instanceMatrix*inverseModelMatrix*modelOffsetMatrix;vModelInstanceOffsetMatrixInv=inverse(vModelInstanceOffsetMatrix);
#endif
}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;uniform float radius;uniform vec3 centerOffset;
#ifdef USE_INSTANCING
varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#define MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrixInv
#else
uniform mat4 modelOffsetMatrixInv;uniform mat4 modelOffsetMatrix;
#define MODEL_OFFSET_MATRIX  modelOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  modelOffsetMatrixInv
#endif
#define CENTER_OFFSET  (centerOffset) 
uniform mat4 projectionMatrix;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.y*=-1.;direction.z*=-1.;
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContribution(vec3 direction){
#if DIA_ORIENT_ENVMAP < 1
direction=mat3(MODEL_OFFSET_MATRIX)*direction;
#endif
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=CENTER_OFFSET;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+CENTER_OFFSET+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-CENTER_OFFSET);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=CENTER_OFFSET+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-CENTER_OFFSET);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=CENTER_OFFSET+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 getRefractionColor(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);int count=0;mat4 invModelOffsetMatrix=INV_MODEL_OFFSET_MATRIX;newDirection=normalize((invModelOffsetMatrix*vec4(newDirection,0.)).xyz);origin=(invModelOffsetMatrix*vec4(origin,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-CENTER_OFFSET);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;vec3 origin2=(MODEL_OFFSET_MATRIX*vec4(intersectedPos,1)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=mat3(MODEL_OFFSET_MATRIX)*oldDir;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(oldDir).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=normalize(mat3(MODEL_OFFSET_MATRIX)*newDirection);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 reflectedDirection=reflect(viewVector,normalizedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normalizedNormal,vec3(f0),0.);vec3 reflectionColor=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;vec3 refractionColor=getRefractionColor(vWorldPosition,viewVector,normalizedNormal);vec3 normal=normalize(vNormal);vec3 diffuseColor=vec3(1.);
#glMarker beforeAccumulation
gl_FragColor=vec4((refractionColor.rgb+reflectionColor.rgb)*diffuseColor,1.);gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(gammaFactor));
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new g.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new g.Pa4(1,1,1)}}}),this.typeSlug=_a.TypeSlug,this.assetType="material",this.__envMap=[],this.isDiamondMaterial=!0,this.color=new To(1,1,1),this.envMapIntensity=1,this.envMapRotationOffset=0,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new g.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new g.yGw().identity()},radius:{value:1},centerOffset:{value:new g.Pa4(0,0,0)},modelOffsetMatrix:{value:new g.yGw().identity()},modelOffsetMatrixInv:{value:new g.yGw().identity()}},this.envMapIndex=0,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.userData.separateEnvMapIntensity=!0,this.setValues(e),this.materialExtensions=Zu.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Zu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,i){Zu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:i}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+Zu.CacheKeyForExtensions(this,this.materialExtensions)}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)==null?void 0:i.uiRefresh)==null||s.call(i,"postFrame",!0,1)}set envMaps(e){this.__envMap=e,this.refreshEnvUniform()}refreshEnvUniform(){var e;this.uniforms.envMap.value=this.envMap,this.defines.ENV_MAP_TYPE=(e=this.uniforms.envMap.value)!=null&&e.isCubeTexture?0:1,this.needsUpdate=!0}get envMap(){return this.__envMap[this.envMapIndex]??this.__envMap[0]??null}set envMap(e){console.error("Setting separate envmap for indivisual diamond material not supported yet.")}clone(){return super.clone()}toJSON(e){const i={metadata:{version:4.6,type:"DiamondMaterial",generator:"DiamondMaterial.toJSON"}};return i.name=this.name,i.uuid=this.uuid,i.color=this.color.getHex(),i.envMapIntensity=this.envMapIntensity,i.envMapIndex=this.envMapIndex,i.envMapRotationOffset=this.envMapRotationOffset,i.dispersion=this.dispersion,i.squashFactor=this.squashFactor,i.geometryFactor=this.geometryFactor,i.gammaFactor=this.gammaFactor,i.absorptionFactor=this.absorptionFactor,i.reflectivity=this.reflectivity,i.refractiveIndex=this.refractiveIndex,i.rayBounces=this.rayBounces,i.diamondOrientedEnvMap=this.diamondOrientedEnvMap,i.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},i.transmission=this.transmission,i.isDiamondMaterialParameters=!0,i.type=_a.TYPE,i.userData={},Jl(i.userData,this.userData),i.userData.uuid=this.userData.uuid,i}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"dropdown",label:"Environment",property:[this,"envMapIndex"],children:[0,1,2].map(i=>({label:"env"+(i+1),value:i}))},...Q_(this),{type:"input",label:"Mesh count",get value(){var i,s;return((s=(i=e.userData)==null?void 0:i.__appliedMeshes)==null?void 0:s.size)??0},set value(i){},disabled:!0},{type:"input",label:"uuid",get value(){return e.uuid},set value(i){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(i){e.userData.renderToDepth=i||void 0}},{type:"button",label:"Download .dmat",value:()=>{const i=new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"});(0,b.downloadBlob)(i,"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(i=>{var s;return(s=i.getUiConfig)==null?void 0:s.call(i,this)})].filter(i=>i),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==_a.TYPE)return console.warn("Material type is not supported",e),this;const i={},s=Array.from(Object.keys(lM));(0,b.copyProps)(e,i,s);const o=i.userData;return delete i.userData,this.setValues(i),Jl(this.userData,o),this.setDirty(),this}fromJSON(e,i){return this.copyProps(e)}}_a.TypeSlug="dmat",_a.TYPE="DiamondMaterial",om([Tv("Color",{limitedUi:!0}),cr()],_a.prototype,"color",void 0),om([ns("Env Intensity",[0,5],.01,{limitedUi:!0}),cr()],_a.prototype,"envMapIntensity",void 0),om([ns("Env Rotation Offset",[-Math.PI,Math.PI],.01),(0,b.onChange2)(_a.prototype.setDirty)],_a.prototype,"envMapRotationOffset",void 0),om([ns("Dispersion",[0,.1],1e-4,{limitedUi:!0}),cr({propKey:"rIndexDelta"})],_a.prototype,"dispersion",void 0),om([ns("Absorption",[0,15],.01,{limitedUi:!0}),cr()],_a.prototype,"absorptionFactor",void 0),om([ns("Refractive Index",[0,4],.01,{limitedUi:!0}),cr()],_a.prototype,"refractiveIndex",void 0),om([cr()],_a.prototype,"squashFactor",void 0),om([cr()],_a.prototype,"geometryFactor",void 0),om([ns("Gamma",[.1,4],.01,{limitedUi:!0}),cr()],_a.prototype,"gammaFactor",void 0),om([Lp("RGB Boost",void 0,void 0,{limitedUi:!0}),cr()],_a.prototype,"boostFactors",void 0),om([ns("Transmission",[0,1],.01,{limitedUi:!0}),cr()],_a.prototype,"transmission",void 0),om([ns("Reflectivity",[0,2],.01,{limitedUi:!0}),cr()],_a.prototype,"reflectivity",void 0),om([Hr("RAY_BOUNCES",void 0,!0),ns("Ray Bounces",[1,16],1)],_a.prototype,"rayBounces",void 0),om([Hr("DIA_ORIENT_ENVMAP",void 0,!0),ns("Diamond Oriented Lighting",[0,1],1)],_a.prototype,"diamondOrientedEnvMap",void 0),om([cr({propKey:"tCubeMapNormals"})],_a.prototype,"normalsCaptureMap",void 0),om([(0,b.onChange)(_a.prototype.refreshEnvUniform)],_a.prototype,"envMapIndex",void 0);var xw=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class Tl extends ms{get envMapRotation(){var e;return((e=this.envMap)==null?void 0:e.rotation)??0}set envMapRotation(e){var s;const i=[this.envMap,this.envMap2,this.envMap3];for(const o of i)o&&(o.rotation=e,(s=this._viewer)==null||s.scene.setDirty())}refreshEnvMaps(){var s,o,c;if(!this._viewer)return;const e=this.getEnvMaps(),i=((o=(s=this._viewer.getPlugin(Fr))==null?void 0:s.materials)==null?void 0:o.getMaterialsOfType(_a.TypeSlug))||[];for(const _ of i)_&&(_.envMaps=e);(c=this._viewer)==null||c.scene.setDirty()}constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.envMap2=null,this.envMap3=null,this.forceSceneEnvMap=!1,this.getEnvMaps=()=>{var i;if(!this.forceSceneEnvMap&&this.envMap)return[this.envMap,this.envMap2,this.envMap3];const e=((i=this._viewer)==null?void 0:i.scene.getEnvironment())||null;return[e,e,e]},this._modelProcessor={forAssetType:"model",processAsync:async(e,i)=>{const s=[];return e.modelObject.traverse(o=>{var _,j,et,nt;const c=(j=(_=o.userData)==null?void 0:_.gltfExtensions)==null?void 0:j[Tl.DIAMOND_GLTF_EXTENSION];c&&o.geometry&&(this.prepareDiamondMesh(o,c),delete o.userData.gltfExtensions[Tl.DIAMOND_GLTF_EXTENSION]),o.material&&!s.includes(o.material)&&((nt=(et=o.material.userData)==null?void 0:et.gltfExtensions)!=null&&nt[Tl.DIAMOND_GLTF_EXTENSION])&&(o.material.materialObject||console.warn("material not processed",o.material),s.push(o.material))}),s.forEach(o=>{const c=o.userData.gltfExtensions[Tl.DIAMOND_GLTF_EXTENSION];c&&this._convertToDiamondMaterial(o,c)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"checkbox",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"image",label:"Environment 2",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap2"]},{type:"image",label:"Environment 3",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap3"]},{type:"button",label:"Make Diamond",hidden:()=>{var i,s,o;const e=(o=(s=(i=this._viewer)==null?void 0:i.getPlugin(Bo))==null?void 0:s.getSelectedObject())==null?void 0:o.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==bp.TypeSlug},value:async()=>{var o,c,_,j,et,nt;const e=(c=(o=this._viewer)==null?void 0:o.getPlugin(Bo))==null?void 0:c.getSelectedObject();if(!(e!=null&&e.material))return;const i=await((_=this._viewer)==null?void 0:_.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let s=parseInt(await((j=this._viewer)==null?void 0:j.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite(s)||(s=512),s<64&&(s=64),((et=e.material.userData)==null?void 0:et.__appliedMeshes.size)>1&&await((nt=this._viewer)==null?void 0:nt.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(e.material,{cacheKey:i||void 0,normalMapRes:s},{}):this.makeDiamondMesh(e,{cacheKey:i||void 0,normalMapRes:s},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var i,s,o;const e=(o=(s=(i=this._viewer)==null?void 0:i.getPlugin(Bo))==null?void 0:s.getSelectedObject())==null?void 0:o.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==_a.TypeSlug},value:async()=>{var c,_,j,et,nt,st,at,ct;const e=(_=(c=this._viewer)==null?void 0:c.getPlugin(Bo))==null?void 0:_.getSelectedObject(),i=e==null?void 0:e.material;if(!i)return;const s=i.userData._baseMaterial;let o=(nt=(et=(j=this._viewer)==null?void 0:j.getManager())==null?void 0:et.materials)==null?void 0:nt.findMaterial(s);if(o&&!o.isDiamondMaterial||(o=(st=this._viewer)==null?void 0:st.createPhysicalMaterial({color:i.color})),o){const dt=i.userData.__appliedMeshes.size>1&&await((at=this._viewer)==null?void 0:at.confirm("Convert all with this material?"))?Array.from(i.userData.__appliedMeshes):[e];for(const mt of dt)(ct=mt==null?void 0:mt.setMaterial)==null||ct.call(mt,o)}this.refreshUi()},limitedUi:!0},{type:"button",label:"Auto Instance Diamonds (dev)",hidden:()=>{var i,s,o,c;const e=(o=(s=(i=this._viewer)==null?void 0:i.getPlugin(Bo))==null?void 0:s.getSelectedObject())==null?void 0:o.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==_a.TypeSlug||((c=e.userData.__appliedMeshes)==null?void 0:c.size)<2},value:async()=>{var s,o;const e=(o=(s=this._viewer)==null?void 0:s.getPlugin(Bo))==null?void 0:o.getSelectedObject();if(!e)return;const i=e.material;i&&!Array.isArray(i)&&op(i)}},{type:"button",label:"Clear Cache",value:()=>{this.disposeAllCacheMaps()}}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}refreshUi(){var e,i,s;(e=this._viewer)==null||e.setDirty(),(s=(i=this.uiConfig)==null?void 0:i.uiRefresh)==null||s.call(i,"postFrame",!0)}async onAdded(e){var c,_,j,et,nt,st,at;this._normalCapture=new Gx(e.renderer),this.offsetCache={},e.scene.addEventListener("materialChanged",ct=>{var dt,mt,yt,wt;if((dt=ct.material)!=null&&dt.isDiamondMaterial){const Ct=ct.material,bt=ct.mesh||ct.object;if(bt.geometry&&!((mt=this._normalCapture)!=null&&mt.hasCapturedNormalMap(bt))){const Pt=((wt=(yt=Ct==null?void 0:Ct.userData)==null?void 0:yt.gltfExtensions)==null?void 0:wt[Tl.DIAMOND_GLTF_EXTENSION])??{};Pt.cacheKey===void 0&&!bt.userData._diamondCacheKey&&(Ct!=null&&Ct.name)&&(Pt.cacheKey=Ct.name),this.prepareDiamondMesh(bt,Pt)}const At=this.getEnvMaps();Ct.envMaps=At}}),e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const i=e.getPlugin(Fr);(c=i==null?void 0:i.importer)==null||c.processors.add("model",this._modelProcessor),(_=e.getPlugin(Bo))==null||_.addEventListener("selectedObjectChanged",this.refreshUi);const s=this.getEnvMaps,o=new eu(class extends tu{async loadAsync(ct,dt){var yt;const mt=await super.loadAsync(ct,dt);return mt.type===_a.TYPE||mt.isDiamondMaterialParameters?(mt.envMap=s(),(yt=i==null?void 0:i.materials)==null?void 0:yt.generateFromTemplate("diamond",mt)):(console.error("Invalid material type for Diamond Material.",mt),null)}},[_a.TypeSlug],!1);return(j=i==null?void 0:i.importer)==null||j.Importers.push(o),(st=(nt=(et=i==null?void 0:i.exporter)==null?void 0:et.getExporter("gltf","glb"))==null?void 0:nt.extensions)==null||st.push(V2),(at=i==null?void 0:i.materials)==null||at.registerMaterialTemplate({name:"diamond",materialType:_a.TYPE,isDiamondMaterialParameters:!0,generator:(ct,dt)=>{const mt=!(dt!=null&&dt.metadata||!dt.isDiamondMaterialParameters)||(dt==null?void 0:dt.metadata)&&(dt==null?void 0:dt.metadata.version)<=4.5,yt=dt==null?void 0:dt.color;mt&&typeof dt.color=="number"&&(dt.color=new To().setHex(dt.color,g.GUF).getHex());const wt=new _a(ct);return wt.envMaps=this.getEnvMaps(),dt&&wt.copyProps(dt),dt.color=yt,wt}}),super.onAdded(e)}async onRemove(e){var i,s,o,c;return(i=this._normalCapture)==null||i.dispose(),this._normalCapture=void 0,this.offsetCache={},(o=(s=e.getPlugin(Fr))==null?void 0:s.importer)==null||o.processors.remove("model",this._modelProcessor),(c=e.getPlugin(Bo))==null||c.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:i,normalMapRes:s}){var _,j;e.userData._diamondCacheKey=i??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=s??e.userData._diamondNormalMapRes,i=i&&i.length>0?i.includes(";"+e.geometry.uuid)?i:i+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const o=((_=this._normalCapture)==null?void 0:_.captureNormalMap(e.geometry,i,s))??[void 0,!1],c=(j=this._viewer)==null?void 0:j.getPluginByType("debug");c&&o&&(c.counters.normalsCapture||(c.counters.normalsCapture=0),c.counters.normalsCapture++,console.log("DEBUG: new normal map captured",c.counters.normalsCapture,i),c.addTexture("normal"+c.counters.normalsCapture,()=>{var et,nt;return(nt=(et=e.geometry)==null?void 0:et.userData._normalsCaptureMap)==null?void 0:nt.texture},[40,110*c.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,i,s){var o;Array.from((e==null?void 0:e.userData.__appliedMeshes)??[]).forEach(c=>{c!=null&&c.isMesh&&c.geometry&&this.prepareDiamondMesh(c,i)}),this._convertToDiamondMaterial(e,s),(o=this._viewer)==null||o.setDirty()}makeDiamondMesh(e,i,s){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,i);const o=Array.isArray(e.material)?e.material[0]:e.material,c=this._convertToDiamondMaterial(o,s,!1);e.setMaterial(c)}_convertToDiamondMaterial(e,i={isDiamond:!0},s=!0){var _,j,et;let o={...i??{}};o.isDiamond||o.isDiamondMaterialParameters?Array.isArray(o.boostFactors)&&(o.boostFactors=new g.Pa4().fromArray(o.boostFactors)):o={isDiamondMaterialParameters:!0},o.color=o.color??(e==null?void 0:e.color)??new To(1,1,1),o.name=o.name??(e==null?void 0:e.name)??"diamond";const c=(et=(j=(_=this._viewer)==null?void 0:_.getManager())==null?void 0:j.materials)==null?void 0:et.generateFromTemplate("diamond",o);if(c&&e&&!e.isDiamondMaterial&&(c.userData._baseMaterial=e.uuid),s){const nt=st=>st.setMaterial??(at=>{st.material=at.materialObject});Array.from((e==null?void 0:e.userData.__appliedMeshes)??[]).forEach(st=>{nt(st)(c),this.prepareDiamondMesh(st,i)})}return c}_computeOffsets(e,i,s=!1){if(e.userData.normalsCaptureOffsets){if((0,b.getUrlQueryParam)("recomputeOffsets")===null)return e.userData.normalsCaptureOffsets;console.warn("recomputeOffsets",e.userData.normalsCaptureOffsets)}e.computeBoundingBox();const o=e.boundingBox.getCenter(new g.Pa4).toArray(),c=aM(e).toArray(),_=new g.yGw().fromArray(c).invert(),j=new g.Pa4().fromArray(o).applyMatrix4(_).toArray(),et={center:o,offsetMatrix:c,offsetMatrixInv:_.toArray(),radius:1,centerOffset:j};return e.userData.normalsCaptureOffsets=et,(0,b.getUrlQueryParam)("recomputeOffsets")!==null&&console.warn("recomputeOffsets",et),et}disposeCacheMap(e){var i;(i=this._normalCapture)==null||i.disposeTarget(e)}disposeAllCacheMaps(){var e;(e=this._normalCapture)==null||e.disposeAllTargets()}}Tl.PluginType="Diamond",Tl.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",xw([(0,b.onChange)(Tl.prototype.refreshEnvMaps),En()],Tl.prototype,"envMap",void 0),xw([(0,b.onChange)(Tl.prototype.refreshEnvMaps),En()],Tl.prototype,"envMap2",void 0),xw([(0,b.onChange)(Tl.prototype.refreshEnvMaps),En()],Tl.prototype,"envMap3",void 0),xw([(0,b.onChange)(Tl.prototype.refreshEnvMaps),En()],Tl.prototype,"forceSceneEnvMap",void 0);const V2=h=>({writeMaterial:(e,i)=>{e.isDiamondMaterial&&(i.extensions=i.extensions||{},i.extensions[Tl.DIAMOND_GLTF_EXTENSION]=e.toJSON(),h.extensionsUsed[Tl.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,i)=>{var o,c;if(!(e!=null&&e.material.isDiamondMaterial))return;i.extensions=i.extensions||{};const s={};(c=(o=e.userData)==null?void 0:o.gltfExtensions)==null||delete c[Tl.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(s.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondCacheKey&&(s.cacheKey=e.userData._diamondCacheKey),i.extensions[Tl.DIAMOND_GLTF_EXTENSION]=s,h.extensionsUsed[Tl.DIAMOND_GLTF_EXTENSION]=!0}});class dC{static async GetClonedCanvas(e,{rect:i={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:s=1,scale:o=1}){var et,nt,st;const c=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");c.width=i.width*o*s,c.height=i.height*o*s,i.assumeClientRect&&(i.x*=e.width/(s*e.clientWidth),i.y*=e.height/(s*e.clientHeight),i.width*=e.width/(s*e.clientWidth),i.height*=e.height/(s*e.clientHeight));const _=c.getContext("2d");if(!_)return console.error("snapshot: cannot create context"),c;const j=e.style.background||((et=e.parentElement)==null?void 0:et.style.background)||"";if(j.includes("url")){const at=(nt=/url\("(.*)"\)/gi.exec(j))==null?void 0:nt[1];if(at){const ct=new Image;ct.src=at,await new Promise((dt,mt)=>{ct.onload=()=>dt(),ct.onerror=()=>mt(),ct.complete&&dt()}),_.drawImage(ct,ct.width*i.x*s/e.width,ct.height*i.y*s/e.height,ct.width*i.width*s/e.width,ct.height*i.height*s/e.height,0,0,c.width,c.height)}}else _.fillStyle=e.style.background||((st=e.parentElement)==null?void 0:st.style.backgroundColor)||"#00000000",_.fillRect(0,0,c.width,c.height);return _==null||_.drawImage(e,i.x*s,i.y*s,i.width*s,i.height*s,0,0,c.width,c.height),this.Debug&&(document.body.appendChild(c),c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.borderWidth="2px",c.style.borderColor="#ff00ff",setTimeout(()=>c.remove(),5e3)),c}static async GetDataUrl(e,{mimeType:i="image/png",...s}){const o=await this.GetClonedCanvas(e,s),c=o.toDataURL(i);return this.Debug||o.remove(),c}static async GetImage(e,{mimeType:i="image/png",...s}={}){const o=await this.GetDataUrl(e,s);return new Promise((c,_)=>{const j=new Image;j.onload=()=>{c(j)},j.src=o})}static async GetBlob(e,i={}){const s=await this.GetClonedCanvas(e,i),o=await new Promise((c,_)=>{s.toBlob(j=>{j?c(j):_()},i.mimeType??"image/png")});return this.Debug||s.remove(),o}static async GetFile(e,i="image.png",s={}){return s.getDataUrl?await this.GetDataUrl(e,s):new File([await this.GetBlob(e,s)],i,{type:s.mimeType??"image/png",lastModified:(0,b.now)()})}}dC.Debug=!1;var av=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let lv=class extends ms{constructor(){super(),this.enabled=!0,this.filename="snapshot.png",this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(h,e={waitForProgressive:!0}){return e.getDataUrl=!1,await this._getFile(h||this.filename,e)}async getDataUrl(h={}){return h.getDataUrl=!0,await this._getFile("",h)??""}async _getFile(h,e={}){var s,o;const i=(s=this._viewer)==null?void 0:s.canvas;if(i){const c=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==c&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const _=(o=this._viewer)==null?void 0:o.getPlugin(Vp);if(e.waitForProgressive&&_&&e.timeout===void 0)for(;!_.isConverged(!0);)await(0,b.timeout)(64);else await(0,b.timeout)(e.timeout??200);e.displayPixelRatio=1;const j=await dC.GetFile(i,h,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=c,j}}async downloadSnapshot(h,e={waitForProgressive:!0}){const i=await this.getFile(h,e);i&&await this._downloadBlob(i,i.name)}async _downloadBlob(h,e){var s,o;const i=(s=this._viewer)==null?void 0:s.getPluginByType("FileTransferPlugin");i?await i.exportFile(h,e):(o=this._viewer)==null||o.console.error("FileTransferPlugin required to export/download file")}};lv.PluginType="CanvasSnipper",av([$s("Filename"),En()],lv.prototype,"filename",void 0),av([Oo("Download .png",{limitedUi:!0})],lv.prototype,"downloadSnapshot",null),lv=av([ks("Image Export")],lv);var Ew=function(h){return function(e){return 1-h(1-e)}},dE=function(h){return function(e){return e<=.5?h(2*e)/2:(2-h(2*(1-e)))/2}},pC=function(h){return function(e){return Math.pow(e,h)}},Qx=function(h){return function(e){return e*e*((h+1)*e-h)}},pE=function(h){var e=Qx(h);return function(i){return(i*=2)<1?.5*e(i):.5*(2-Math.pow(2,-10*(i-1)))}},fC=function(h){return h},fE=pC(2),G2=Ew(fE),cM=dE(fE),mE=function(h){return 1-Math.sin(Math.acos(h))},uM=Ew(mE),H2=dE(uM),p_=Qx(1.525),gE=Ew(p_),hM=dE(p_),mC=pE(1.525),cA=function(h){if(h===1||h===0)return h;var e=h*h;return h<.36363636363636365?7.5625*e:h<.7272727272727273?9.075*e-9.9*h+3.4:h<.9?12.066481994459833*e-19.63545706371191*h+8.898060941828255:10.8*h*h-20.52*h+10.72},gC=Ew(cA),_C=function(h){return h<.5?.5*(1-cA(1-2*h)):.5*cA(2*h-1)+.5},xu=function(){return xu=Object.assign||function(h){for(var e,i=1,s=arguments.length;i<s;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(h[o]=e[o]);return h},xu.apply(this,arguments)};function dM(h,e){var i={};for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&e.indexOf(s)<0&&(i[s]=h[s]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(s=Object.getOwnPropertySymbols(h);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(h,s[o])&&(i[s[o]]=h[s[o]])}return i}var vC=function(){},ly=function(h,e,i){return Math.min(Math.max(i,h),e)},Sw=.001,pM=.01,Q2=10,yC=.05,W2=1,fM=12;function _E(h,e){return h*Math.sqrt(1-e*e)}var mM=["duration","bounce"],gM=["stiffness","damping","mass"];function _M(h,e){return e.some(function(i){return h[i]!==void 0})}function uA(h){var e=h.from,i=e===void 0?0:e,s=h.to,o=s===void 0?1:s,c=h.restSpeed,_=c===void 0?2:c,j=h.restDelta,et=dM(h,["from","to","restSpeed","restDelta"]),nt={done:!1,value:i},st=function(Pt){var Dt=xu({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},Pt);if(!_M(Pt,gM)&&_M(Pt,mM)){var Nt=function(Vt){var Zt,an,fn=Vt.duration,mn=fn===void 0?800:fn,Sn=Vt.bounce,An=Sn===void 0?.25:Sn,wn=Vt.velocity,Mn=wn===void 0?0:wn,Pn=Vt.mass,On=Pn===void 0?1:Pn,er=1-An;er=ly(yC,W2,er),mn=ly(pM,Q2,mn/1e3),er<1?(Zt=function(lr){var ar=lr*er,Mr=ar*mn,xr=ar-Mn,qr=_E(lr,er),Zr=Math.exp(-Mr);return Sw-xr/qr*Zr},an=function(lr){var ar=lr*er*mn,Mr=ar*Mn+Mn,xr=Math.pow(er,2)*Math.pow(lr,2)*mn,qr=Math.exp(-ar),Zr=_E(Math.pow(lr,2),er);return(-Zt(lr)+Sw>0?-1:1)*((Mr-xr)*qr)/Zr}):(Zt=function(lr){return Math.exp(-lr*mn)*((lr-Mn)*mn+1)-Sw},an=function(lr){return Math.exp(-lr*mn)*(mn*mn*(Mn-lr))});var Zn=function(lr,ar,Mr){for(var xr=Mr,qr=1;qr<fM;qr++)xr-=lr(xr)/ar(xr);return xr}(Zt,an,5/mn);if(mn*=1e3,isNaN(Zn))return{stiffness:100,damping:10,duration:mn};var yr=Math.pow(Zn,2)*On;return{stiffness:yr,damping:2*er*Math.sqrt(On*yr),duration:mn}}(Pt);(Dt=xu(xu(xu({},Dt),Nt),{velocity:0,mass:1})).isResolvedFromDuration=!0}return Dt}(et),at=st.stiffness,ct=st.damping,dt=st.mass,mt=st.velocity,yt=st.duration,wt=st.isResolvedFromDuration,Ct=Cw,bt=Cw;function At(){var Pt=mt?-mt/1e3:0,Dt=o-i,Nt=ct/(2*Math.sqrt(at*dt)),Vt=Math.sqrt(at/dt)/1e3;if(j!=null||(j=Math.abs(o-i)<=1?.01:.4),Nt<1){var Zt=_E(Vt,Nt);Ct=function(fn){var mn=Math.exp(-Nt*Vt*fn);return o-mn*((Pt+Nt*Vt*Dt)/Zt*Math.sin(Zt*fn)+Dt*Math.cos(Zt*fn))},bt=function(fn){var mn=Math.exp(-Nt*Vt*fn);return Nt*Vt*mn*(Math.sin(Zt*fn)*(Pt+Nt*Vt*Dt)/Zt+Dt*Math.cos(Zt*fn))-mn*(Math.cos(Zt*fn)*(Pt+Nt*Vt*Dt)-Zt*Dt*Math.sin(Zt*fn))}}else if(Nt===1)Ct=function(fn){return o-Math.exp(-Vt*fn)*(Dt+(Pt+Vt*Dt)*fn)};else{var an=Vt*Math.sqrt(Nt*Nt-1);Ct=function(fn){var mn=Math.exp(-Nt*Vt*fn),Sn=Math.min(an*fn,300);return o-mn*((Pt+Nt*Vt*Dt)*Math.sinh(Sn)+an*Dt*Math.cosh(Sn))/an}}}return At(),{next:function(Pt){var Dt=Ct(Pt);if(wt)nt.done=Pt>=yt;else{var Nt=1e3*bt(Pt),Vt=Math.abs(Nt)<=_,Zt=Math.abs(o-Dt)<=j;nt.done=Vt&&Zt}return nt.value=nt.done?o:Dt,nt},flipTarget:function(){var Pt;mt=-mt,i=(Pt=[o,i])[0],o=Pt[1],At()}}}uA.needsInterpolation=function(h,e){return typeof h=="string"||typeof e=="string"};var Cw=function(h){return 0},Tw=function(h,e,i){var s=e-h;return s===0?1:(i-h)/s},cy=function(h,e,i){return-i*h+i*e+h},hA=function(h,e){return function(i){return Math.max(Math.min(i,e),h)}},uy=function(h){return h%1?Number(h.toFixed(5)):h},cv=/(-)?([\d]*\.?[\d])+/g,Mw=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,AC=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function dA(h){return typeof h=="string"}var Wx={test:function(h){return typeof h=="number"},parse:parseFloat,transform:function(h){return h}},vE=xu(xu({},Wx),{transform:hA(0,1)}),bC=(xu(xu({},Wx),{default:1}),function(h,e){return function(i){return!!(dA(i)&&AC.test(i)&&i.startsWith(h)||e&&Object.prototype.hasOwnProperty.call(i,e))}}),pA=function(h,e,i){return function(s){var o;if(!dA(s))return s;var c=s.match(cv),_=c[0],j=c[1],et=c[2],nt=c[3];return(o={})[h]=parseFloat(_),o[e]=parseFloat(j),o[i]=parseFloat(et),o.alpha=nt!==void 0?parseFloat(nt):1,o}},q2=hA(0,255),hy=xu(xu({},Wx),{transform:function(h){return Math.round(q2(h))}}),A0={test:bC("rgb","red"),parse:pA("red","green","blue"),transform:function(h){var e=h.red,i=h.green,s=h.blue,o=h.alpha,c=o===void 0?1:o;return"rgba("+hy.transform(e)+", "+hy.transform(i)+", "+hy.transform(s)+", "+uy(vE.transform(c))+")"}},vM={test:bC("#"),parse:function(h){var e="",i="",s="",o="";return h.length>5?(e=h.substr(1,2),i=h.substr(3,2),s=h.substr(5,2),o=h.substr(7,2)):(e=h.substr(1,1),i=h.substr(2,1),s=h.substr(3,1),o=h.substr(4,1),e+=e,i+=i,s+=s,o+=o),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(s,16),alpha:o?parseInt(o,16)/255:1}},transform:A0.transform},dO=function(h){return{test:function(e){return dA(e)&&e.endsWith(h)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+h}}},yE=dO("%"),qx=(xu(xu({},yE),{parse:function(h){return yE.parse(h)/100},transform:function(h){return yE.transform(100*h)}}),{test:bC("hsl","hue"),parse:pA("hue","saturation","lightness"),transform:function(h){var e=h.hue,i=h.saturation,s=h.lightness,o=h.alpha,c=o===void 0?1:o;return"hsla("+Math.round(e)+", "+yE.transform(uy(i))+", "+yE.transform(uy(s))+", "+uy(vE.transform(c))+")"}}),pO=function(h,e,i){var s=h*h,o=e*e;return Math.sqrt(Math.max(0,i*(o-s)+s))},fO=[vM,A0,qx],X2=function(h){return fO.find(function(e){return e.test(h)})},AE=function(h,e){var i=X2(h),s=X2(e);if(vC(i.transform===s.transform),!i||!s||i.transform!==s.transform)return function(et){return""+(et>0?e:h)};var o=i.parse(h),c=s.parse(e),_=xu({},o),j=i===qx?cy:pO;return function(et){for(var nt in _)nt!=="alpha"&&(_[nt]=j(o[nt],c[nt],et));return _.alpha=cy(o.alpha,c.alpha,et),i.transform(_)}},wC={test:function(h){return A0.test(h)||vM.test(h)||qx.test(h)},parse:function(h){return A0.test(h)?A0.parse(h):qx.test(h)?qx.parse(h):vM.parse(h)},transform:function(h){return dA(h)?h:h.hasOwnProperty("red")?A0.transform(h):qx.transform(h)}},Iw="${c}",Y2="${n}";function Eu(h){typeof h=="number"&&(h=""+h);var e=[],i=0,s=h.match(Mw);s&&(i=s.length,h=h.replace(Mw,Iw),e.push.apply(e,s.map(wC.parse)));var o=h.match(cv);return o&&(h=h.replace(cv,Y2),e.push.apply(e,o.map(Wx.parse))),{values:e,numColors:i,tokenised:h}}function bE(h){return Eu(h).values}function yM(h){var e=Eu(h),i=e.values,s=e.numColors,o=e.tokenised,c=i.length;return function(_){for(var j=o,et=0;et<c;et++)j=j.replace(et<s?Iw:Y2,et<s?wC.transform(_[et]):uy(_[et]));return j}}var xC=function(h){return typeof h=="number"?0:h},wE={test:function(h){var e,i,s,o;return isNaN(h)&&dA(h)&&((i=(e=h.match(cv))===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0)+((o=(s=h.match(Mw))===null||s===void 0?void 0:s.length)!==null&&o!==void 0?o:0)>0},parse:bE,createTransformer:yM,getAnimatableNone:function(h){var e=bE(h);return yM(h)(e.map(xC))}},xE={x:0,y:0,z:0},EC=function(h){return typeof h=="number"},$2=function(h,e){return function(i){return e(h(i))}},Pw=function(){for(var h=[],e=0;e<arguments.length;e++)h[e]=arguments[e];return h.reduce($2)};function SC(h,e){return EC(h)?function(i){return cy(h,e,i)}:wC.test(h)?AE(h,e):Rw(h,e)}var jv=function(h,e){var i=function(c,_,j){if(j||arguments.length===2)for(var et,nt=0,st=_.length;nt<st;nt++)!et&&nt in _||(et||(et=Array.prototype.slice.call(_,0,nt)),et[nt]=_[nt]);return c.concat(et||Array.prototype.slice.call(_))}([],h),s=i.length,o=h.map(function(c,_){return SC(c,e[_])});return function(c){for(var _=0;_<s;_++)i[_]=o[_](c);return i}},K2=function(h,e){var i=xu(xu({},h),e),s={};for(var o in i)h[o]!==void 0&&e[o]!==void 0&&(s[o]=SC(h[o],e[o]));return function(c){for(var _ in s)i[_]=s[_](c);return i}};function AM(h){for(var e=wE.parse(h),i=e.length,s=0,o=0,c=0,_=0;_<i;_++)s||typeof e[_]=="number"?s++:e[_].hue!==void 0?c++:o++;return{parsed:e,numNumbers:s,numRGB:o,numHSL:c}}var Rw=function(h,e){var i=wE.createTransformer(e),s=AM(h),o=AM(e);return s.numHSL===o.numHSL&&s.numRGB===o.numRGB&&s.numNumbers>=o.numNumbers?Pw(jv(s.parsed,o.parsed),i):function(c){return""+(c>0?e:h)}},mO=function(h,e){return function(i){return cy(h,e,i)}};function Dw(h,e,i){var s=i===void 0?{}:i,o=s.clamp,c=o===void 0||o,_=s.ease,j=s.mixer,et=h.length;vC(et===e.length),vC(!_||!Array.isArray(_)||_.length===et-1),h[0]>h[et-1]&&(h=[].concat(h),e=[].concat(e),h.reverse(),e.reverse());var nt=function(at,ct,dt){for(var mt=[],yt=dt||(typeof(Pt=at[0])=="number"?mO:typeof Pt=="string"?wC.test(Pt)?AE:Rw:Array.isArray(Pt)?jv:typeof Pt=="object"?K2:void 0),wt=at.length-1,Ct=0;Ct<wt;Ct++){var bt=yt(at[Ct],at[Ct+1]);if(ct){var At=Array.isArray(ct)?ct[Ct]:ct;bt=Pw(At,bt)}mt.push(bt)}var Pt;return mt}(e,_,j),st=et===2?function(at,ct){var dt=at[0],mt=at[1],yt=ct[0];return function(wt){return yt(Tw(dt,mt,wt))}}(h,nt):function(at,ct){var dt=at.length,mt=dt-1;return function(yt){var wt=0,Ct=!1;if(yt<=at[0]?Ct=!0:yt>=at[mt]&&(wt=mt-1,Ct=!0),!Ct){for(var bt=1;bt<dt&&!(at[bt]>yt||bt===mt);bt++);wt=bt-1}var At=Tw(at[wt],at[wt+1],yt);return ct[wt](At)}}(h,nt);return c?function(at){return st(ly(h[0],h[et-1],at))}:st}function Xx(h,e){return h.map(function(){return e||cM}).splice(0,h.length-1)}function dy(h){var e=h.from,i=e===void 0?0:e,s=h.to,o=s===void 0?1:s,c=h.ease,_=h.offset,j=h.duration,et=j===void 0?300:j,nt={done:!1,value:i},st=Array.isArray(o)?o:[i,o],at=function(mt,yt){return mt.map(function(wt){return wt*yt})}(_&&_.length===st.length?_:function(mt){var yt=mt.length;return mt.map(function(wt,Ct){return Ct!==0?Ct/(yt-1):0})}(st),et);function ct(){return Dw(at,st,{ease:Array.isArray(c)?c:Xx(st,c)})}var dt=ct();return{next:function(mt){return nt.value=dt(mt),nt.done=mt>=et,nt},flipTarget:function(){st.reverse(),dt=ct()}}}function Yx(h){var e=h.velocity,i=e===void 0?0:e,s=h.from,o=s===void 0?0:s,c=h.power,_=c===void 0?.8:c,j=h.timeConstant,et=j===void 0?350:j,nt=h.restDelta,st=nt===void 0?.5:nt,at=h.modifyTarget,ct={done:!1,value:o},dt=_*i,mt=o+dt,yt=at===void 0?mt:at(mt);return yt!==mt&&(dt=yt-o),{next:function(wt){var Ct=-dt*Math.exp(-wt/et);return ct.done=!(Ct>st||Ct<-st),ct.value=ct.done?yt:yt+Ct,ct},flipTarget:function(){}}}var kw={keyframes:dy,spring:uA,decay:Yx},$x=1/60*1e3,EE=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},Kx=typeof window<"u"?function(h){return window.requestAnimationFrame(h)}:function(h){return setTimeout(function(){return h(EE())},$x)},Ow=!0,Jx=!1,CC=!1,Zx={delta:0,timestamp:0},SE=["read","update","preRender","render","postRender"],TC=SE.reduce(function(h,e){return h[e]=function(i){var s=[],o=[],c=0,_=!1,j=new WeakSet,et={schedule:function(nt,st,at){st===void 0&&(st=!1),at===void 0&&(at=!1);var ct=at&&_,dt=ct?s:o;return st&&j.add(nt),dt.indexOf(nt)===-1&&(dt.push(nt),ct&&_&&(c=s.length)),nt},cancel:function(nt){var st=o.indexOf(nt);st!==-1&&o.splice(st,1),j.delete(nt)},process:function(nt){var st;if(_=!0,s=(st=[o,s])[0],(o=st[1]).length=0,c=s.length)for(var at=0;at<c;at++){var ct=s[at];ct(nt),j.has(ct)&&(et.schedule(ct),i())}_=!1}};return et}(function(){return Jx=!0}),h},{}),bM=SE.reduce(function(h,e){var i=TC[e];return h[e]=function(s,o,c){return o===void 0&&(o=!1),c===void 0&&(c=!1),Jx||eP(),i.schedule(s,o,c)},h},{}),J2=SE.reduce(function(h,e){return h[e]=TC[e].cancel,h},{}),Z2=function(h){return TC[h].process(Zx)},wM=function(h){Jx=!1,Zx.delta=Ow?$x:Math.max(Math.min(h-Zx.timestamp,40),1),Zx.timestamp=h,CC=!0,SE.forEach(Z2),CC=!1,Jx&&(Ow=!1,Kx(wM))},eP=function(){Jx=!0,Ow=!0,CC||Kx(wM)},xM=function(){return Zx},tP=bM;function EM(h,e,i){return i===void 0&&(i=0),h-e-i}var uv=function(h){var e=function(i){var s=i.delta;return h(s)};return{start:function(){return tP.update(e,!0)},stop:function(){return J2.update(e)}}};function b0(h){var e,i,s,o,c,_=h.from,j=h.autoplay,et=j===void 0||j,nt=h.driver,st=nt===void 0?uv:nt,at=h.elapsed,ct=at===void 0?0:at,dt=h.repeat,mt=dt===void 0?0:dt,yt=h.repeatType,wt=yt===void 0?"loop":yt,Ct=h.repeatDelay,bt=Ct===void 0?0:Ct,At=h.onPlay,Pt=h.onStop,Dt=h.onComplete,Nt=h.onRepeat,Vt=h.onUpdate,Zt=dM(h,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),an=Zt.to,fn=0,mn=Zt.duration,Sn=!1,An=!0,wn=function(Pn){if(Array.isArray(Pn.to))return dy;if(kw[Pn.type])return kw[Pn.type];var On=new Set(Object.keys(Pn));return On.has("ease")||On.has("duration")&&!On.has("dampingRatio")?dy:On.has("dampingRatio")||On.has("stiffness")||On.has("mass")||On.has("damping")||On.has("restSpeed")||On.has("restDelta")?uA:dy}(Zt);!((i=(e=wn).needsInterpolation)===null||i===void 0)&&i.call(e,_,an)&&(c=Dw([0,100],[_,an],{clamp:!1}),_=0,an=100);var Mn=wn(xu(xu({},Zt),{from:_,to:an}));return et&&(At==null||At(),(s=st(function(Pn){if(An||(Pn=-Pn),ct+=Pn,!Sn){var On=Mn.next(Math.max(0,ct));o=On.value,c&&(o=c(o)),Sn=An?On.done:ct<=0}Vt==null||Vt(o),Sn&&(fn===0&&(mn!=null||(mn=ct)),fn<mt?function(er,Zn,yr,lr){return lr?er>=Zn+yr:er<=-yr}(ct,mn,bt,An)&&(fn++,wt==="reverse"?ct=function(er,Zn,yr,lr){return yr===void 0&&(yr=0),lr===void 0&&(lr=!0),lr?EM(Zn+-er,Zn,yr):Zn-(er-Zn)+yr}(ct,mn,bt,An=fn%2==0):(ct=EM(ct,mn,bt),wt==="mirror"&&Mn.flipTarget()),Sn=!1,Nt&&Nt()):(s.stop(),Dt&&Dt()))})).start()),{stop:function(){Pt==null||Pt(),s.stop()}}}const fA={linear:fC,easeIn:fE,easeOut:G2,easeInOut:cM,circIn:mE,circOut:uM,circInOut:H2,backIn:p_,backOut:gE,backInOut:hM,anticipate:mC,bounceOut:cA,bounceIn:gC,bounceInOut:_C,easeInOutSine:function(h){return-(Math.cos(Math.PI*h)-1)/2}};function MC(h,e,i){const s=h[e],o=()=>{typeof(h==null?void 0:h.setDirty)=="function"&&h.setDirty(),i==null||i()};return s.isVector3||s.isVector2||s.isVector4?c=>{s.copy(c),o()}:c=>{h[e]=c,o()}}function IC(h){return typeof h!="boolean"}async function CE(h,e,i,s){e in h||console.error("invalid key",e,h);const o=MC(h,e),c=h[e],_=j=>{var et;o(j),(et=i.onUpdate)==null||et.call(i,j)};if(IC(c))return typeof i.to=="function"&&(i={...i,to:i.to(c,h)}),e1({...i,from:c,onUpdate:_},s);{const{duration:j}=i;return(0,b.timeout)(j??0).then(()=>_(i.to))}}async function e1(h,e){const i=h.onComplete,s=h.onStop,o=h.onEnd;return h={...h},new Promise((c,_)=>{h.onComplete=()=>{try{i==null||i()}catch(et){return o==null||o(),void _(et)}o==null||o(),c()},h.onStop=()=>{try{s==null||s()}catch(et){return o==null||o(),void _(et)}o==null||o(),c()};const j=b0(h);e&&e.push(j)})}var ru=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let nP=1,Qp=class{constructor(h,e,i,s,o){this.position=new g.Pa4,this.target=new g.Pa4,this.quaternion=new g._fP,this.up=new g.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.updateView=()=>{},this.uiConfig=Rm(this.name,this),h&&(this.position=h),e&&(this.target=e),i&&(this.up=i),s&&(this.quaternion=s),o&&(this.snap=o),this.name="#view"+nP++}_nameChanged(){var h,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(h=this.uiConfig).uiRefresh)==null||e.call(h))}};ru([En(),Lp()],Qp.prototype,"position",void 0),ru([En(),Lp()],Qp.prototype,"target",void 0),ru([En(),Lp()],Qp.prototype,"quaternion",void 0),ru([En(),Lp()],Qp.prototype,"up",void 0),ru([En(),$s()],Qp.prototype,"name",void 0),ru([By()],Qp.prototype,"snap",void 0),ru([Oo()],Qp.prototype,"focusView",void 0),ru([Oo()],Qp.prototype,"deleteView",void 0),ru([Oo()],Qp.prototype,"updateView",void 0),Qp=ru([Yo("CameraView")],Qp);class zl extends ms{get animationLooping(){return this._animationLooping}get animating(){return this._animating}constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(i=>i.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=-1),i+=1,e?i%=this._cameraViews.length:i=Math.min(i,this._cameraViews.length-1),this.focusView(this._cameraViews[i])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=0),i-=1,i=e?(i+this._cameraViews.length)%this._cameraViews.length:Math.max(i,0),this.focusView(this._cameraViews[i])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...Q_(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var i;if(this.enabled&&!this._animating&&this.seekOnScroll){const s=(i=this._viewer)==null?void 0:i.scene.activeCamera;if(!s)return;const o=new g.$V,c=s.position,_=s.target,j=new g._fP().setFromUnitVectors(s.cameraObject.up,new g.Pa4(0,1,0)),et=j.clone().invert(),nt=c.clone().sub(_);nt.applyQuaternion(j),o.setFromVector3(nt),o.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,o.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,o.makeSafe(),nt.setFromSpherical(o),nt.applyQuaternion(et),c.copy(_).add(nt),s.positionUpdated(!1),s.targetUpdated()}}async onAdded(e){await super.onAdded(e);let i=!1;e.addEventListener("preFrame",s=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,i=!0):i&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,i=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var o,c;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((o=this._viewer.getPluginByType("FrameFade"))==null||o.enable(zl.PluginType),this._fadeDisabled=!1));const e=(0,b.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=e-1/60);let i=e-this._lastFrameTime;this._lastFrameTime=e,i*=this.animateOnScroll?this._scrollAnimationState:1;const s=(c=this._viewer.getPluginByType("Progressive"))==null?void 0:c.postFrameConvergedRecordingDelta();if(s&&s>0&&(i=s),s!==0&&(i*=1e3,!(i<=0||(this._updaters.forEach(_=>{let j=i;_.time+j<0&&(j=-_.time),_.time+=j,Math.abs(j)>.001&&_.u(j)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const _=this._viewer.getPluginByType("FrameFade");_&&(_.disable(zl.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await(0,b.timeout)(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await(0,b.timeout)(2))}async recordAllViews(e,i=!0){var o;if(!this.enabled)return;const s=(o=this._viewer)==null?void 0:o.getPluginByType("CanvasRecorder");if(s&&s.enabled&&!(this._cameraViews.length<1)){if(await this.resetToFirstView(),!s.isRecording())return new Promise((c,_)=>{const j=()=>{s.removeEventListener("start",et),s.removeEventListener("stop",j),s.removeEventListener("error",nt)},et=async()=>{var at;j(),e==null||e(),await this.animateAllViews();const st=await s.stopRecording();if(i){const ct=await((at=this._viewer)==null?void 0:at.prompt("Canvas Recorder: Save file as","recording.mp4"));ct!==null&&st&&await this._downloadBlob(st,ct||"recording.mp4")}c(st)},nt=async()=>{j(),_()};s.addEventListener("start",et),s.addEventListener("stop",j),s.addEventListener("error",nt),s.startRecording()||console.error("cannot start recording")});console.error("CanvasRecorderPlugin is already recording")}}async addCurrentView(){var s,o,c;if(!this.enabled)return;const e=(s=this._viewer)==null?void 0:s.scene.activeCamera;if(!e)return;const i=this.getCurrentCameraView(e);i.snap=await((c=(o=this._viewer)==null?void 0:o.getPlugin(lv))==null?void 0:c.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this.addView(i)}addView(e){var i,s;this._cameraViews.push(e),(s=(i=this.uiConfig).uiRefresh)==null||s.call(i),this.dispatchEvent({type:"viewAdd",view:e})}getCurrentCameraView(e,i=!0,s){var st,at,ct;if(e||(e=(st=this._viewer)==null?void 0:st.scene.activeCamera),!e)return new Qp;const o=new g.Pa4;e.cameraObject.updateWorldMatrix(!0,!1);const c=e.cameraObject.matrixWorld;o.x=c.elements[4],o.y=c.elements[5],o.z=c.elements[6],o.normalize();const _=e.target.clone(),j=e.position.clone(),et=e.cameraObject.parent;et&&(i?j.applyMatrix4(et.matrixWorld):o.transformDirection(et.matrixWorld.clone().invert()));const nt=i?e.cameraObject.getWorldQuaternion(new g._fP):e.cameraObject.quaternion.clone();return s?(s.position.copy(j),s.target.copy(_),s.up.copy(o),s.quaternion.copy(nt)):((s=new Qp(j,_,o,nt,"")).focusView=async()=>s&&this.focusView(s),s.deleteView=()=>s&&this.deleteView(s),s.updateView=()=>this.getCurrentCameraView(e,i,s)),(ct=(at=s.uiConfig).uiRefresh)==null||ct.call(at,"postFrame",!0),s}setCurrentCameraView(e){var s;const i=(s=this._viewer)==null?void 0:s.scene.activeCamera;i&&(i.position.copy(e.position),i.target.copy(e.target),i.cameraObject.up.copy(e.up),i.cameraObject.quaternion.copy(e.quaternion),i.positionUpdated())}async focusView(e){return this.animateToView(e)}deleteView(e){var s,o;const i=this._cameraViews.indexOf(e);i>=0&&this._cameraViews.splice(i,1),(o=(s=this.uiConfig).uiRefresh)==null||o.call(s),this.dispatchEvent({type:"viewDelete",view:e})}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var i;return(i=e==null?void 0:e.stop)==null?void 0:i.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await(0,b.timeout)(100)}async animateToView(e,i,s,o=!1){var st,at;const c=(st=this._viewer)==null?void 0:st.scene.activeCamera;if(!c)return;if(this._animating){this._popAnimations.forEach(dt=>(dt==null?void 0:dt.stop)&&dt.stop()),this._popAnimations=[];let ct=0;for(;this._animating&&(await(0,b.timeout)(100),!(ct++>20)););if(this._animating)return void console.warn("Unable to stop all animations, maybe because of viewLooping?")}this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),i===void 0&&(i=this.animDuration),i=Math.max(10,i);const _=typeof s=="function"?s:fA[s||this.animEase],j=this._driver,et=[];this._popAnimations=[];const nt=this._popAnimations;if(this.interpolateMode==="spherical")et.push(async function(ct,dt,mt,yt,wt,Ct,bt){const At=ct.target.clone(),Pt=new g.Pa4,Dt=new g.Pa4,Nt=ct.cameraObject.parent,Vt=ct.cameraObject.up.clone(),Zt=Fm({position:ct.cameraObject.getWorldPosition(new g.Pa4),up:Nt?Vt.transformDirection(Nt.matrixWorld):Vt},At),an=Fm(dt,dt.target),fn=new g.$V;function mn(){ct.position.copy(Nt?Nt.worldToLocal(Dt):Dt),ct.target.copy(Pt),ct.positionUpdated()}return e1({from:0,to:1,duration:mt,ease:yt,driver:wt,onUpdate:Sn=>{fn.phi=zv(Zt.phi,an.phi,Sn),fn.theta=zv(Zt.theta,an.theta,Sn),fn.radius=vn(Zt.radius,an.radius,Sn),Pt.copy(At).lerp(dt.target,Sn),Dt.setFromSpherical(fn),Dt.add(Pt),mn()},onComplete:()=>{Dt.copy(dt.position),Pt.copy(dt.target),mn()},onStop:()=>{throw new Error("Animation Stopped")}},Ct)}(c,e,i,_,j,nt));else if(this.interpolateMode==="linear"){et.push(e1({from:c.position.clone(),to:e.position.clone(),duration:i,ease:_,driver:j,onUpdate:mt=>c.position=mt,onComplete:()=>c.position=e.position,onStop:()=>{throw new Error("Animation stopped")}},nt)),et.push(e1({from:c.target.clone(),to:e.target.clone(),duration:i,ease:_,driver:j,onUpdate:mt=>{c.target=mt,c.targetUpdated()},onComplete:()=>{c.target=e.target,c.targetUpdated()}},nt));const ct=c.cameraObject.quaternion.clone(),dt=new g._fP;et.push(e1({from:0,to:1,duration:i,ease:_,driver:j,onUpdate:mt=>{dt.copy(ct).slerp(e.quaternion,mt),c.cameraObject.quaternion.copy(dt),c.cameraObject.updateProjectionMatrix()},onComplete:()=>{c.cameraObject.quaternion.copy(e.quaternion),c.cameraObject.updateProjectionMatrix()}},nt))}await Promise.allSettled(et).catch(ct=>{if(o)throw ct}),(at=this._viewer)==null||at.setDirty(),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await(0,b.timeout)(10)}fromJSON(e,i){var s,o;return this._cameraViews.forEach(c=>this.deleteView(c)),super.fromJSON(e,i)?(this._cameraViews.forEach(c=>c.focusView=async()=>this.focusView(c)),this._cameraViews.forEach(c=>c.deleteView=()=>this.deleteView(c)),(o=(s=this.uiConfig).uiRefresh)==null||o.call(s),this):null}async animateToObject(e,i=4,s,o,c={min:.5,max:5}){if(!this._viewer)return;const _=new Wt().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),j=_.getCenter(new g.Pa4),et=_.getSize(new g.Pa4).length()/2;await this.animateToTarget(Math.min(c.max,Math.max(c.min,et*i)),j,s,o)}async animateToFitObject(e,i=1.5,s=1e3,o,c={min:.5,max:50}){if(!this._viewer)return;const _=new Wt().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),j=_.getCenter(new g.Pa4),et=_.getSize(new g.Pa4);let nt=this._viewer.scene.activeCamera.cameraObject,st=1;if(nt.isPerspectiveCamera){const at=nt.fov*(Math.PI/180),ct=2*Math.atan(Math.tan(at/2)*nt.aspect),dt=et.z/2+Math.abs(et.x/2/Math.tan(ct/2)),mt=et.z/2+Math.abs(et.y/2/Math.tan(at/2));st=Math.max(dt,mt)}await this.animateToTarget(Math.min(c.max,Math.max(c.min,st*i)),j,s,o)}async animateToTarget(e,i,s,o){const c=this.getCurrentCameraView();c.target.copy(i);const _=new g.Pa4().subVectors(c.target,c.position).normalize();c.position.copy(_.multiplyScalar(-e).add(c.target)),await this.animateToView(c,s,o)}async _downloadBlob(e,i){var o,c;const s=(o=this._viewer)==null?void 0:o.getPluginByType("FileTransferPlugin");s?await s.exportFile(e,i):(c=this._viewer)==null||c.console.error("FileTransferPlugin required to export/download file")}}function Fm(h,e){const i=h.position.clone();i.sub(e);const s=new g.$V().setFromVector3(i);return s.makeSafe(),s}function zv(h,e,i){const s=e-h;return s>=Math.PI?h+(s-2*Math.PI)*i:s<=-Math.PI?h+(s+2*Math.PI)*i:h+s*i}function SM(h,e,i){const s=(1-i)*Math.cos(h)+i*Math.cos(e),o=(1-i)*Math.sin(h)+i*Math.sin(e);return Math.atan2(o,s)}zl.PluginType="CameraViews",ru([En("cameraViews")],zl.prototype,"_cameraViews",void 0),ru([(0,b.onChange)(zl.prototype._animationLoop),En(),jr("Loop All Views",{limitedUi:!0})],zl.prototype,"viewLooping",void 0),ru([En(),$s("View Pause Time")],zl.prototype,"viewPauseTime",void 0),ru([En(),Pm("Ease",Object.keys(fA).map(h=>({label:h})))],zl.prototype,"animEase",void 0),ru([En(),ns("Duration",[10,1e4],10,{limitedUi:!0})],zl.prototype,"animDuration",void 0),ru([En(),ns("RotationOffset",[.2,.75],.01)],zl.prototype,"rotationOffset",void 0),ru([En(),Pm("Interpolation",["spherical","linear"].map(h=>({label:h})))],zl.prototype,"interpolateMode",void 0),ru([jr(),En()],zl.prototype,"seekOnScroll",void 0),ru([Oo("Animate All Views",{limitedUi:!0})],zl.prototype,"animateAllViews",null),ru([Oo("Record All Views")],zl.prototype,"recordAllViews",null),ru([Oo("Add Current View")],zl.prototype,"addCurrentView",null),ru([Oo("Focus Next")],zl.prototype,"focusNext",void 0),ru([Oo("Focus Previous")],zl.prototype,"focusPrevious",void 0);const t1=new g.Pa4;function rP(h,e,i){let s=h.dot(e);s=Math.min(Math.max(s,-1),1);const o=Math.acos(s)*i;return t1.copy(h).multiplyScalar(s).sub(e).negate().normalize(),h.multiplyScalar(Math.cos(o)).add(t1.multiplyScalar(Math.sin(o)))}var w0,x0=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Vv=w0=class{constructor(h){this.enabled=!1,this.power=.5,this.bgcolor=new g.Ilk(0),this.extraUniforms={power:{value:.5},bgcolor:{value:new g.Ilk}},this.parsFragmentSnippet=(e,i)=>this.enabled?b.glsl`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=h.getPlugin(Lv),this._setDirty=this._setDirty.bind(this)}shaderExtender(h,e,i){this.enabled&&(h.fragmentShader=os(h.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(h,e,i){this.enabled&&(e.materialObject.uniforms.power.value=this.power,e.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)==null||h.call(this),this._setDirty()}};Vv.PluginType="Vignette",x0([(0,b.onChange)(w0.prototype._setDirty),jr("Enable"),En()],Vv.prototype,"enabled",void 0),x0([(0,b.onChange)(w0.prototype._setDirty),ns("Power",[.1,4],.01,{limitedUi:!0}),En()],Vv.prototype,"power",void 0),x0([(0,b.onChange)(w0.prototype._setDirty),Tv("Color"),En()],Vv.prototype,"bgcolor",void 0),Vv=w0=x0([ks("Vignette")],Vv);class py extends ty{constructor(){super()}generateExtension(e){return new Vv(e)}get power(){var e;return((e=this._extension)==null?void 0:e.power)??1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e;return((e=this._extension)==null?void 0:e.bgcolor)??new g.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}py.PluginType="Vignette";var mA=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Hu=class extends ms{constructor(){super(),this.enabled=!0,this.dependencies=[Fr],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const h=await(0,b.uploadFile)(!0,!1,"model/gltf");await this.loadScenes(h)}async loadScenes(h){var i,s;const e=await Promise.all(h.map(async o=>await o.arrayBuffer()));for(let o=0;o<h.length;o++){const c=h[o];this.scenes.push({[c.name]:new Uint8Array(e[o])}),this.assets[c.name]={path:c.name,file:c}}(s=(i=this.uiConfig)==null?void 0:i.uiRefresh)==null||s.call(i)}async play(){var o;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const h=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin")??this._viewer.getPluginByType("LoadingScreenPlugin");h==null||h.enabled,h&&(h.enabled=!1);const e=this._viewer.getPluginByType("FrameFade"),i=this._viewer.getPluginByType("GLTFAnimation"),s=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const c of this.scenes){if(!this._isPlaying)break;const _=Object.keys(c);i==null||i.stopAnimation(!1),await(s==null?void 0:s.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const et of _){let nt=this.assets[et];nt||(nt={path:et,file:new File([c[et]],et)},this.assets[et]=nt),await((o=this._viewer.getManager())==null?void 0:o.addAssetSingle(nt,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,h&&(h.enabled=!1),e&&(e.enabled=!0,await e.startTransition(1e3));const j=[(0,b.timeout)(this.minSceneTime)];i&&j.push(i.playAnimation()),s&&j.push(s.animateAllViews()),await Promise.all(j)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const h={};for(const s of this.scenes)for(const o of Object.keys(s)){const c=h[o]?o+"_":o;h[c]=s[c]}const e=HT(h),i=new Blob([e],{type:"application/zip"});(0,b.downloadBlob)(i,"scenes.glbloop")}async onAdded(h){var i,s;await super.onAdded(h);const e=this;(s=(i=h.getManager())==null?void 0:i.importer)==null||s.Importers.push(new eu(class extends QS{load(o,c,_,j){super.load(o,et=>{e.loadScenes([...et.values()]),c==null||c(null),(0,b.timeout)(100).then(e.play)},_,j)}},["glbloop"],!0))}};Hu.PluginType="SceneLoopPlugin",mA([y_("Loaded scenes")],Hu.prototype,"loadedScenes",null),mA([Oo("Load Scenes")],Hu.prototype,"promptLoadScenes",null),mA([y_("Playing")],Hu.prototype,"_isPlaying",void 0),mA([$s("Min Scene Time")],Hu.prototype,"minSceneTime",void 0),mA([Oo("Play")],Hu.prototype,"play",null),mA([Oo("Stop")],Hu.prototype,"stop",null),mA([Oo("Download Scenes")],Hu.prototype,"downloadScenes",null),Hu=mA([ks("Scene Loop")],Hu);var PC=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let TE=class extends b_{constructor(h,e,i){super(h,e,i??new O_,new g.Ilk(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(h,e,i,s,o){if(!this.enabled||!this.camera)return;const c=this.overrideMaterial;c.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(c.uniforms.lastProjectionViewMatrix.value.copy(c.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(h,e,i,s,o),c.uniforms.lastProjectionViewMatrix.value.copy(c.uniforms.currentProjectionViewMatrix.value)}};PC([jr("Enabled")],TE.prototype,"enabled",void 0),TE=PC([ks("Velocity Buffer (TAA)")],TE);class O_ extends g.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new g.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},alphaMapTransform:{value:new g.Vkp},currentProjectionViewMatrix:{value:new g.yGw},lastProjectionViewMatrix:{value:new g.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new g.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,i,s,o,c){const _=this._previousWorldMatrices[c.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(_??c.matrixWorld),_?_.copy(c.matrixWorld):this._previousWorldMatrices[c.uuid]=c.matrixWorld.clone();let j=c.material;Array.isArray(j)&&(j=j[0]),this.uniforms.alphaMap.value=(j==null?void 0:j.alphaMap)??null,this.uniforms.alphaTest.value=!j||!j.alphaTest||j.alphaTest<1e-7?.001:j.alphaTest;let et=this.uniforms.alphaMap.value?1:void 0;et!==this.defines.USE_ALPHAMAP&&(et===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=et,this.needsUpdate=!0),et=j.userData.ALPHA_I_RGBA_PACKING?1:void 0,et!==this.defines.ALPHA_I_RGBA_PACKING&&(et===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=et,this.needsUpdate=!0),this.side=j.side??g.ehD}}class B_ extends t_{passCtor(e){const i=e.renderer.createTarget({depthBuffer:!0,type:g.ywz});i.texture.name="velocityBuffer",this._velocityBuffers.push(i),e.getPluginByType("debug");const s=new Set,o=new Set;return new class extends TE{render(c,_,j,et,nt){var dt;if(e.renderer.frameCount>0)return;const st=c.getRenderTarget(),at=c.getActiveCubeFace(),ct=c.getActiveMipmapLevel();(dt=this.scene)==null||dt.traverse(({material:mt})=>{mt&&((mt.transparent&&mt.userData.renderToDepth||!mt.transparent&&mt.transmission===0&&mt.userData.renderToDepth===!1)&&(s.add(mt),mt.transparent=!mt.transparent),Math.abs(mt.transmission||0)>0&&mt.userData.renderToDepth&&(o.add([mt,mt.transmission]),mt.transmission=0))}),ls(c,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(c,_,i,et,nt)),s.forEach(mt=>mt.transparent=!mt.transparent),s.clear(),o.forEach(([mt,yt])=>mt.transmission=yt),o.clear(),c.setRenderTarget(st,at,ct)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.renderCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.renderCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(i=>{var s;return e.renderer.disposeTarget((s=i==null?void 0:i.dispose)==null?void 0:s.call(i))}),super.onRemove(e)}updateShaderProperties(e){var i;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled?((i=this.getVelocityBuffer())==null?void 0:i.texture)??null:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}B_.PluginType="VelocityBuffer";var gA,wm=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let fy=gA=class{constructor(h){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1},lut3d:{value:null},lut3d1:{value:null},lut3d2:{value:null},lut2d:{value:null},lut2d1:{value:null},lut2d2:{value:null}},this.extraDefines={USE_LUT:0,USE_LUT1:0,USE_LUT2:0,USE_3DTEXTURE:0,LUT_BACKGROUND:0},this.parsFragmentSnippet=(e,i)=>this.enabled?`#if (USE_LUT == 1 || USE_LUT1 == 1 || USE_LUT2 == 1)
uniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;
#if USE_LUT == 1
uniform sampler3D lut3d;
#endif
#if USE_LUT1 == 1
uniform sampler3D lut3d1;
#endif
#if USE_LUT2 == 1
uniform sampler3D lut3d2;
#endif
#else
#if USE_LUT == 1
uniform sampler2D lut2d;
#endif
#if USE_LUT1 == 1
uniform sampler2D lut2d1;
#endif
#if USE_LUT2 == 1
uniform sampler2D lut2d2;
#endif
vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
int getLUTBit(in int number){
#ifdef WebGL2Context
return number%2;
#else
return int(mod(float(number),2.));
#endif
}int getLUTIndex(in int number){
#ifdef WebGL2Context
return number%8;
#else
return int(mod(float(number),8.));
#endif
}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=float(getLUTBit(getGBufferFlags(vUv).a));float lutIndex=float(getLUTIndex(getGBufferFlags(vUv).g));
#if USE_3DTEXTURE == 1
if(lutIndex==0.){
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);
#endif
}else{
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}
#else
if(lutIndex==0.){outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(lutLookup(lut2d1,lutSize,getUVW(lutSize1,color)),color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(lutLookup(lut2d2,lutSize,getUVW(lutSize2,color)),color.a);
#endif
}else{outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._viewer=h,this._combinedPostPlugin=h.getPlugin(Lv),this._setDirty=this._setDirty.bind(this),this.setDirty=this.setDirty.bind(this)}_updateParams(){if(!this.enabled)return;const h=this._viewer.renderer.rendererObject.capabilities.isWebGL2?1:0;let e=h?this.extraUniforms.lut3d:this.extraUniforms.lut2d;this._updateLUTMap(this.lutMap,e,this.extraUniforms.lutSize,h),this.extraDefines.USE_LUT=this.lutMap?1:0,e=h?this.extraUniforms.lut3d1:this.extraUniforms.lut2d1,this._updateLUTMap(this.lutMap1,e,this.extraUniforms.lutSize1,h),this.extraDefines.USE_LUT1=this.lutMap1?1:0,e=h?this.extraUniforms.lut3d2:this.extraUniforms.lut2d2,this._updateLUTMap(this.lutMap2,e,this.extraUniforms.lutSize2,h),this.extraDefines.USE_LUT2=this.lutMap2?1:0,this.extraUniforms.intensity.value=this.intensity,this.extraDefines.LUT_BACKGROUND=this.lutBackground?1:0,this.extraDefines.USE_3DTEXTURE=h,this._setDirty()}_updateLUTMap(h,e,i,s){if(h){let o=1;s==1?(e.value=h.texture3D,o=h.texture3D.image.width):h.texture&&(e.value=h.texture,o=h.texture.image.width),e.value.needsUpdate=!0,i.value=o}}shaderExtender(h,e,i){this.enabled&&(h.fragmentShader=os(h.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                bool isBackground = getDepth(vUv)>0.9999;
                #if LUT_BACKGROUND == 1
                    gl_FragColor = colorLookUp(gl_FragColor);
                #else
                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);
                #endif
            #endif
            #glMarker
        `))}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){var h;(h=this.__setDirty)==null||h.call(this),this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};function CM(h){const e=h==null?void 0:h.userData;if(!e)return!1;e[Qu.PluginType]||(e[Qu.PluginType]={});const i=e[Qu.PluginType];return i.enable=!0,i.index===void 0&&(i.index=0),h.isMaterial&&(h.needsUpdate=!0),!0}wm([En(),(0,b.onChange)(gA.prototype._updateParams),jr("Enable")],fy.prototype,"enabled",void 0),wm([En(),(0,b.onChange)(gA.prototype._updateParams),jr("LUT Background")],fy.prototype,"lutBackground",void 0),wm([En(),(0,b.onChange)(gA.prototype._updateParams),ns("Intensity")],fy.prototype,"intensity",void 0),wm([(0,b.onChange)(gA.prototype._updateParams),By("LUT"),En()],fy.prototype,"lutMap",void 0),wm([(0,b.onChange)(gA.prototype._updateParams),By("LUT1"),En()],fy.prototype,"lutMap1",void 0),wm([(0,b.onChange)(gA.prototype._updateParams),By("LUT2"),En()],fy.prototype,"lutMap2",void 0),fy=gA=wm([ks("LUT")],fy);class Qu extends ty{_getUiConfig(e){var s,o;const i={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){var c;return((c=e.materialObject.userData[Qu.PluginType])==null?void 0:c.enable)??!0},set value(c){var j;const _=e.materialObject.userData[Qu.PluginType];c!==(_==null?void 0:_.enable)&&(_||CM(e.materialObject),e.materialObject.userData[Qu.PluginType].enable=c,(j=i.uiRefresh)==null||j.call(i,"postFrame",!0))},onChange:(s=this._extension)==null?void 0:s.setDirty},{type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map(c=>({label:c[0],value:c[1]})),label:"index",hidden:()=>{const c=e.materialObject.userData[Qu.PluginType];return!!c&&!c.enable},get value(){var c;return((c=e.materialObject.userData[Qu.PluginType])==null?void 0:c.index)??0},set value(c){var _;e.materialObject.userData[Qu.PluginType]||CM(e.materialObject),e.materialObject.userData[Qu.PluginType].index=c,(_=i.uiRefresh)==null||_.call(i,"postFrame",!0)},onChange:(o=this._extension)==null?void 0:o.setDirty}]};return i}constructor(){super(),this.materialExtension={uuid:Bp(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const i=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=i,i},computeCacheKey:e=>{var i;return(this.enabled?"1":"0")+((i=e.materialObject.userData[Qu.PluginType])!=null&&i.enable?"1":"0")},isCompatible:e=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(e){var s,o;await super.onAdded(e),(s=e.getPlugin(zo))==null||s.registerGBufferUpdater(this.updateGBuffer);const i=e.getPlugin(Fr);(o=i==null?void 0:i.materials)==null||o.registerMaterialExtension(this.materialExtension)}generateExtension(e){return new fy(e)}updateGBuffer(e,i){var s,o;if(e instanceof g.Kj0&&((s=e.material)!=null&&s.userData)){const c=(o=e.material)==null?void 0:o.userData[Qu.PluginType];if(c){const _=c.enable===!1?0:1;i.w=YS(i.w,0,_);for(let et=0;et<3;et++)i.y=m2(i.y,et);let j=c.enable?c.index:0;j=Math.min(j,7),i.y=i.y|j}else i.w=YS(i.w,0,1)}}}Qu.PluginType="LUTPlugin1";class TM{constructor(e){this._zee=new g.Pa4(0,0,1),this._euler=new g.USm,this._q0=new g._fP,this._q1=new g._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._q2=new g._fP,this._initQuaternionDest=new g._fP,this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this.onDeviceOrientationChangeEvent=i=>{this.deviceOrientation=i},this._isConnected=!1,this._viewer=e}getOffsetFromCenter(e=!0){if(!this.deviceOrientation)return new g.FM8;this.getQuaternion(e,this._q2);const i=new g.Pa4(0,0,1);return i.applyQuaternion(this._q2),new g.FM8(i.x,i.y)}getQuaternion(e,i){if(i||(i=new g._fP),!this.deviceOrientation)return i.identity();const s=this.deviceOrientation,o=s.alpha!==null?g.M8C.degToRad(s.alpha):0,c=s.beta!==null?g.M8C.degToRad(s.beta):0,_=s.gamma!==null?g.M8C.degToRad(s.gamma):0,j=this.screenOrientation?g.M8C.degToRad(this.screenOrientation.angle):0;return this._toQuaternion(i,o,c,_,j,e),i}_toQuaternion(e,i,s,o,c,_){this._euler.set(s,i,-o,"YXZ"),e.setFromEuler(this._euler),e.multiply(this._q1);const j=document.getElementById("debug");return j&&(j.textContent=c+""),e.multiply(this._q0.setFromAxisAngle(this._zee,-c)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(e).invert(),this._initQuaternionDest.__init=!0),_&&e.premultiply(this._initQuaternionDest),e}static IsCompatible(){return window.DeviceOrientationEvent!==void 0&&"ontouchstart"in window}addPermissionMessage(){this.permissionMessage=document.createElement("div"),this.permissionMessage.innerHTML="Tap on the screen to allow gyroscope",this.permissionMessage.style.visibility="visible",this.permissionMessage.style.width="100%",this.permissionMessage.style.height="40px",this.permissionMessage.style.color="black",this.permissionMessage.style.position="absolute",this.permissionMessage.style.textAlign="center",this.permissionMessage.style.fontSize="12px",this.permissionMessage.style.bottom="20%",this._viewer.container.appendChild(this.permissionMessage)}connect(){var e;if(!this._isConnected)return this._isConnected=!0,this.onScreenOrientationChangeEvent(),!!window.DeviceOrientationEvent&&(this.askPermission(),(e=this._viewer)==null||e.renderer.rendererObject.domElement.addEventListener("click",this.askPermission.bind(this)),window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),!0)}askPermission(){this.onScreenOrientationChangeEvent(),typeof DeviceMotionEvent.requestPermission=="function"&&(this.addPermissionMessage(),DeviceOrientationEvent.requestPermission().then(e=>{e=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._viewer.container.removeChild(this.permissionMessage))}).catch(e=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",e)}))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternionDest=new g._fP)}}class iP{constructor(){this._mousePos=new g.FM8(0,0),this._isConnected=!1}getOffsetFromCenter(){return new g.FM8(this._mousePos.x/window.innerWidth*2-1,-(this._mousePos.y/window.innerHeight*2-1))}connect(){this._isConnected||(this._isConnected=!0,window.addEventListener("mousemove",this._onMouseMove.bind(this)))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("mousemove",this._onMouseMove.bind(this)))}_onMouseMove(e){this._mousePos.set(e.clientX,e.clientY)}}var RC,jm=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let zm=RC=class extends ms{constructor(){super(),this.enabled=!1,this.enableEdit=!1,this.invert=!1,this.sensitivity=.5,this.focalPointHit=new g.Pa4(0,0,0),this.damping=.5,this.cameraView="",this._target=new g.Pa4,this._center=new g.Pa4,this._pointerDown=!1,this._focalDistance=100,this._updateProjectionMatrix=()=>{var j,et;if(!this.enabled)return void((et=(j=this._object)._updateProjectionMatrixParallax)==null?void 0:et.call(j));const h=this._object,e=h.near;let i=e*Math.tan(.5*g.M8C.DEG2RAD*h.fov)/h.zoom,s=2*i,o=h.aspect*s,c=-.5*o;if(h.view!==null&&h.view.enabled){const nt=h.view.fullWidth,st=h.view.fullHeight;c+=h.view.offsetX*o/nt,i-=h.view.offsetY*s/st,o*=h.view.width/nt,s*=h.view.height/st}c-=this._offX*e/this._focalDistance,i-=this._offY*e/this._focalDistance;const _=h.filmOffset;_!==0&&(c+=e*_/h.getFilmWidth()),h.projectionMatrix.makePerspective(c,c+o,i,i-s,e,h.far),h.projectionMatrixInverse.copy(h.projectionMatrix).invert()},this._preFrame=h=>{this.update(h.deltaTime)},this._offX=0,this._offY=0,this._xDamper=new b.Damper,this._yDamper=new b.Damper,this._onEnabledChange=this._onEnabledChange.bind(this),this._onDampingChange=this._onDampingChange.bind(this),this._onObjectHit=this._onObjectHit.bind(this),this._onActiveCameraChange=this._onActiveCameraChange.bind(this)}async onAdded(h){var e,i,s;await super.onAdded(h),TM.IsCompatible()?this._input=new TM(h):this._input=new iP,h.scene.addEventListener("activeCameraChange",this._onActiveCameraChange),this.addIndicator(),h.addEventListener("preFrame",this._preFrame),(e=this._viewer)==null||e.container.addEventListener("pointerdown",this.onPointerDown.bind(this)),(i=this._viewer)==null||i.container.addEventListener("pointerup",this.onPointerUp.bind(this)),(s=h.getPluginByType("Picking"))==null||s.addEventListener("hitObject",this._onObjectHit),this._onEnabledChange()}_onActiveCameraChange(){var h,e,i,s;this._object&&((h=this._object)!=null&&h._updateProjectionMatrixParallax)&&(this._object.updateProjectionMatrix=this._object._updateProjectionMatrixParallax,delete this._object._updateProjectionMatrixParallax),this._focalDistance=.01,this._object=(e=this._viewer)==null?void 0:e.scene.activeCamera.cameraObject,(i=this._object)!=null&&i.isOrthographicCamera?(s=this._viewer)==null||s.console.warn("ParallaxCameraControllerPlugin: Orthographic camera is not supported"):this.enabled&&(this._object._updateProjectionMatrixParallax=this._object.updateProjectionMatrix,this._object.updateProjectionMatrix=this._updateProjectionMatrix)}addIndicator(){var h;this._viewer&&(this._indicator&&this._indicator.remove(),this._indicator=document.createElement("div"),this._indicator.style.width="40px",this._indicator.style.height="40px",this._indicator.style.borderRadius="100%",this._indicator.style.border="4px solid #ff4444",this._indicator.style.transform="translate(-50%, -50%)",this._indicator.style.position="absolute",this._indicator.style.top="0",this._indicator.style.left="0",this._indicator.style.zIndex="10000",this._indicator.style.opacity="0",this._indicator.style.transition="opacity 0.5s",this._indicator.style.pointerEvents="none",(h=this._viewer)==null||h.container.appendChild(this._indicator))}onPointerDown(h){this.enabled&&this._viewer&&(this._pointerDown=!0,this.enableEdit&&this._indicator&&(this._indicator.style.top=h.clientY-this._viewer.container.offsetTop+"px",this._indicator.style.left=h.clientX-this._viewer.container.offsetLeft+"px"))}onPointerUp(){this._pointerDown=!1}update(h){if(!this.enabled||this._pointerDown||!this._input||!this._object||!this._viewer)return;this._viewer.scene.activeCamera.interactionsEnabled=!1,this._updateFocalDistance();const e=this._object.matrixWorld.elements,i=new g.Pa4(e[0],e[1],e[2]),s=new g.Pa4(e[4],e[5],e[6]);this._object.position.copy(this._center),this._viewer.scene.activeCamera.positionUpdated();let o=this.sensitivity;this.invert&&(o*=-1),this._offX=this._xDamper.update(this._offX,this._input.getOffsetFromCenter().x*o,h,1),this._offY=this._yDamper.update(this._offY,this._input.getOffsetFromCenter().y*o,h,1);const c=this._object;c.position.add(s.multiplyScalar(this._offY)).add(i.multiplyScalar(this._offX)),c.updateProjectionMatrix(),c.updateMatrixWorld(),this._dirty=!0}_onObjectHit(h){var e,i;h.intersects.intersect&&this.enableEdit&&(this.focalPointHit.copy(h.intersects.intersect.point),h.intersects.selectedObject=null,(i=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||i.call(e,"postFrame",!0),this._indicator&&(this._indicator.style.display="block",this._indicator.style.opacity="1",setTimeout(()=>{var s,o;this._indicator.style.opacity="0",setTimeout(()=>this._indicator.style.display="none",600),(o=(s=this.uiConfig)==null?void 0:s.uiRefresh)==null||o.call(s,"postFrame",!0)},200)))}_updateFocalDistance(){if(!this._object)return;const h=this._object,e=new g.Pa4;h.getWorldDirection(e),e.normalize(),this._focalDistance=this.focalPointHit.clone().sub(h.position).dot(e)}_onEnabledChange(){var h,e,i;if(this._viewer){if(this.enabled){if((h=this._input)==null||h.connect(),this._onActiveCameraChange(),!this._object)return;this._viewer.scene.activeCamera.interactionsEnabled=!1;const s=this._viewer.getPluginByType("CameraViews"),o=s==null?void 0:s.camViews.find(c=>c.name===this.cameraView);s&&o&&s.setCurrentCameraView(o),this._updateFocalDistance(),this._center.copy(this._object.position),this._object.lookAt(this._viewer.scene.activeCamera.target)}else if(this._object){this._onActiveCameraChange(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._object.position.copy(this._center),this._object.lookAt(this._viewer.scene.activeCamera.target);const s=this._object;s.updateProjectionMatrix(),s.updateMatrixWorld()}(i=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||i.call(e,"postFrame",!0)}}_onDampingChange(){this._xDamper&&this._yDamper&&(this._xDamper.setDecayTime(100*this.damping),this._yDamper.setDecayTime(100*this.damping))}dispose(){var h;(h=this._input)==null||h.disconnect()}};zm.PluginType="ParallaxCameraControllerPlugin",jm([(0,b.onChange)(RC.prototype._onEnabledChange),En(),jr("Enabled")],zm.prototype,"enabled",void 0),jm([En(),jr("enableEdit")],zm.prototype,"enableEdit",void 0),jm([En(),jr("Invert")],zm.prototype,"invert",void 0),jm([En(),ns("Sensitivity",[.1,2],.01)],zm.prototype,"sensitivity",void 0),jm([En("focalPoint"),Lp("Focal Point Hit",void 0,.001)],zm.prototype,"focalPointHit",void 0),jm([(0,b.onChange)(RC.prototype._onDampingChange),En(),ns("Damping",[0,1],.001)],zm.prototype,"damping",void 0),jm([En(),$s("Camera View")],zm.prototype,"cameraView",void 0),zm=RC=jm([ks("Parallax Camera Controller")],zm);var DC=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let f_=class extends ms{addNoiseBumpMaterial(h){return kC(h.materialObject)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new MM(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Fr],this._uniforms={noiseBumpParams:{value:new g.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},flakeParams:{value:new g.Ltg(0,1,3,0)},flakeFallOffParams:{value:new g.Pa4(0,1,0)},useColorFlakes:{value:!1}},this.materialExtension={parsFragmentSnippet:(h,e)=>{var i;return this.enabled&&((i=e==null?void 0:e.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)?Nv+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform bool useColorFlakes;uniform vec4 flakeParams;uniform vec3 flakeFallOffParams;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(h,e,i)=>{var o;if(!this.enabled||!((o=e.materialObject.userData._noiseBumpMat)!=null&&o.hasBump))return;const s="#glMarker beforeAccumulation";h.fragmentShader=h.fragmentShader.replace(s,`vec3 outColor,outColor1,outColor2,outColor3,outColor4,outColor5;float distFac=length(vViewPosition.xyz);float level=1.;vec2 uvMod=noiseBumpFlakeScale*noiseBumpParams.xy*vUv*level;float voronoiDist=clamp(voronoi_f1_2d(uvMod,1.,noiseFlakeClamp,noiseFlakeRadius,outColor),0.,1.);vec3 oldNormal=normal;normal=perturbNormalArb_nb(-vViewPosition,normal,(2.*outColor.xy-1.)*noiseBumpScale,faceDirection);float oldRoughnessFactor=roughnessFactor;float oldMetalnessFactor=metalnessFactor;roughnessFactor=mix(roughnessFactor,flakeParams.x,1.-voronoiDist);metalnessFactor=mix(metalnessFactor,flakeParams.y,1.-voronoiDist);
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
vec3 sparkleRadiance=getIBLRadiance(normalize(vViewPosition),normal,roughnessFactor);float sparkleIntensity=length(sparkleRadiance);float sparkleIntensityMultiplier=sparkleIntensity>1.3?flakeParams.z:1.;vec3 oldDiffuseColor=diffuseColor.rgb;vec2 cellPosition_=floor(uvMod);vec3 colorRGB=useColorFlakes?hash3(cellPosition_):vec3(1.);float fallOff_=mix(1.,1./(1.+flakeFallOffParams.y*distFac+flakeFallOffParams.z*distFac*distFac),flakeFallOffParams.x);diffuseColor.rgb*=mix(vec3(1.),sparkleIntensityMultiplier*colorRGB*fallOff_,vec3(1.-voronoiDist));if(sparkleIntensity<flakeParams.w){float mixFactor=1.;roughnessFactor=mix(roughnessFactor,oldRoughnessFactor,mixFactor);metalnessFactor=mix(metalnessFactor,oldMetalnessFactor,mixFactor);normal=normalize(mix(normal,oldNormal,mixFactor));diffuseColor.rgb=mix(diffuseColor.rgb,oldDiffuseColor,mixFactor);}
#endif

`+s),h.defines.USE_UV="",h.extensionDerivatives=!0},onObjectRender:(h,e)=>{var o;const i=(o=e.materialObject.userData)==null?void 0:o._noiseBumpMat;if(!(i!=null&&i.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(i.bumpNoiseParams),this._uniforms.noiseBumpScale.value=i.bumpScale,this._uniforms.noiseBumpFlakeScale.value=i.flakeScale,this._uniforms.noiseFlakeClamp.value=i.flakeClamp,this._uniforms.noiseFlakeRadius.value=i.flakeRadius,i.flakeParams&&this._uniforms.flakeParams.value.copy(i.flakeParams),i.flakeFallOffParams&&this._uniforms.flakeFallOffParams.value.copy(i.flakeFallOffParams),this._uniforms.useColorFlakes.value=i.useColorFlakes;const s=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==s&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=s,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i;return(this.enabled?"1":"0")+((i=(e=h.materialObject.userData)==null?void 0:e._noiseBumpMat)!=null&&i.hasBump?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:h=>{const e=this._viewer,i={type:"folder",label:"SparkleBump (NoiseBump)",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.hasBump)||!1},set value(s){var o,c;s!==((o=h.materialObject.userData._noiseBumpMat)==null?void 0:o.hasBump)&&(s?kC(h.materialObject)||e.alert("Cannot add noise bump."):h.materialObject.userData._noiseBumpMat&&(h.materialObject.userData._noiseBumpMat.hasBump=!1,h.materialObject.needsUpdate=!0),(c=i.uiRefresh)==null||c.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var s;return!((s=h.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.001],stepSize:1e-5,hidden:()=>{var s;return!((s=h.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var s;return!((s=h.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var s;return!((s=h.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.01,1],stepSize:.001,hidden:()=>{var s;return!((s=h.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>{var s;return{type:"slider",label:"Flake Roughness",bounds:[0,1],stepSize:.01,hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeParams,"x"],onChange:this.setDirty}},()=>{var s;return{type:"slider",label:"Flake Metalness",bounds:[0,1],stepSize:.01,hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeParams,"y"],onChange:this.setDirty}},()=>{var s;return{type:"slider",label:"Flake Strength",bounds:[0,100],stepSize:.001,hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeParams,"z"],onChange:this.setDirty}},()=>{var s;return{type:"slider",label:"Flake Threshold",bounds:[.1,10],stepSize:.001,hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeParams,"w"],onChange:this.setDirty}},()=>{var s;return{type:"slider",label:"Falloff",stepSize:1,bounds:[0,1],hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeFallOffParams,"x"],onChange:this.setDirty}},()=>{var s;return{type:"slider",label:"Linear falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeFallOffParams,"y"],onChange:this.setDirty}},()=>{var s;return{type:"slider",label:"Quadratic falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var o;return!((o=h.materialObject.userData._noiseBumpMat)!=null&&o.hasBump)},property:[(s=h.materialObject.userData._noiseBumpMat)==null?void 0:s.flakeFallOffParams,"z"],onChange:this.setDirty}},()=>({type:"checkbox",label:"Colored Flakes",hidden:()=>{var s;return!((s=h.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"useColorFlakes"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var h,e,i;(e=(h=this.materialExtension).setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,_;await super.onAdded(h);const e=h.getPlugin(Fr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(_=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||_.push(gO)}async onRemove(h){var e,i,s,o;return(i=(e=h.getPlugin(Fr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),(o=(s=h.getPlugin(Fr))==null?void 0:s.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};function kC(h){const e=h==null?void 0:h.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const i=e._noiseBumpMat;return i.hasBump=!0,i.bumpNoiseParams===void 0&&(i.bumpNoiseParams=[.5,.5]),i.bumpScale===void 0&&(i.bumpScale=.05),i.flakeScale===void 0&&(i.flakeScale=.05),i.flakeClamp===void 0&&(i.flakeClamp=1),i.flakeRadius===void 0&&(i.flakeRadius=.3),i.useColorFlakes===void 0&&(i.useColorFlakes=!1),i.flakeParams===void 0&&(i.flakeParams=new g.Ltg(0,1,3,0)),i.flakeFallOffParams===void 0&&(i.flakeFallOffParams=new g.Pa4(0,1,0)),h.isMaterial&&(h.needsUpdate=!0),!0}f_.PluginType="NoiseBumpMaterialPlugin",f_.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",DC([jr("Enabled",h=>({onChange:h.setDirty})),En()],f_.prototype,"enabled",void 0),f_=DC([ks("NoiseBump Materials")],f_);class MM{constructor(e){this.parser=e,this.name=f_.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return i.userData||(i.userData={}),kC(i),i.userData._noiseBumpMat=ao(o,i.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const gO=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;i.extensions=i.extensions||{};const s=Ls(e.userData._noiseBumpMat,!1);i.extensions[f_.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=s,h.extensionsUsed[f_.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});class IM extends yo{constructor(e,i){super({vertexShader:tt.vertexShader,fragmentShader:i+`
`+Ux+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(1,1,getDepth(uv+offset.yy*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zy*texelSize));vec3 dtl=vec3(-1,1,getDepth(uv+offset.xy*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.xz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.yz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.xx*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zx*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.yx*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);
#if HAS_VELOCITY_BUFFER == 0
vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=texture2D(tVelocity,c_frag.xy).xy*2.-1.;screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new g.FM8},cameraNearFar:{value:new g.FM8},lastProjectionViewMatrix:{value:new g.yGw},currentProjectionViewMatrix:{value:new g.yGw},projection:{value:new g.yGw},inverseViewMatrix:{value:new g.yGw},jitterSample:{value:new g.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new g.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",stepSize:1e-4,property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,i,s,o,c){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const _=this.uniforms.tVelocity.value?1:0;_!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=_,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,i,s,o,c),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,i){super.setSize(e,i),this.onSizeUpdate()}}(function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);c>3&&_&&Object.defineProperty(e,i,_)})([En(),cr()],IM.prototype,"feedBack",void 0);class n1 extends t_{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[zo],this._stableNoise=!0,this._stableNoiseConfig={label:"Stable Noise (Use Total Frame Count)",type:"checkbox",property:[this,"stableNoise"]}}passCtor(e){if(!e.getPlugin(Vp))throw"Add ProgressivePlugin before TAA";const i=new IM(e.getPlugin(Vp).lastFrame,e.getPlugin(zo).getUnpackSnippet());return e.renderer.addEventListener("resize",i.onSizeUpdate),i}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const i=e.renderer.frameCount,s=this._pass.passObject;if(s.taaEnabled=i<=1&&e.scene.renderCamera===e.scene.activeCamera,!s.taaEnabled)return!1;const o=e.scene.renderCamera;return s.updateShaderProperties([e.getPlugin(zo),o,e.getPluginByType("VelocityBuffer")]),s.target=e.getPlugin(Vp).lastFrame,s.updateCameraProperties(o==null?void 0:o.cameraObject),!0}async onAdded(e){await super.onAdded(e),this.stableNoise=this._stableNoise}get stableNoise(){var e;return((e=this._viewer)==null?void 0:e.renderer.stableNoise)??this._stableNoise}set stableNoise(e){this._viewer&&(this._viewer.renderer.stableNoise=e),this._stableNoise=e}get uiConfig(){var i;const e=(i=this.pass)==null?void 0:i.passObject.uiConfig;if(e&&e.children)return e.children.includes(this._stableNoiseConfig)||e.children.push(this._stableNoiseConfig),e}}n1.PluginType="TAA";var _A=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Vm=class extends ms{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=h=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const i=this._lastFsElement||((e=this._viewer)==null?void 0:e.canvas);i&&(i.style.width=this._lastSize[0],i.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(h){var i;if(this.isFullScreen())return;const e=h||((i=this._viewer)==null?void 0:i.canvas);return e?(this._lastFsElement=e,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[e.style.width,e.style.height],e.style.width="100%",e.style.height="100%",e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(h){return this.isFullScreen()?this.exit():this.enter(h)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};Vm.PluginType="FullScreenPlugin",_A([Oo("Enter FullScreen")],Vm.prototype,"enter",null),_A([Oo("Exit FullScreen")],Vm.prototype,"exit",null),_A([Oo("Toggle FullScreen")],Vm.prototype,"toggle",null),Vm=_A([ks("Full Screen")],Vm);const _O=(h,e)=>{const i={};for(const s of h.mappings)for(const o of s.variants)i[e[o]]={material:null,gltfMaterialIndex:s.material};return i},Bw="KHR_materials_variants";class sP{constructor(e){this.parser=e,this.name=Bw}async afterRoot(e){const i=this.parser,s=i.json;if(!s.extensions||!s.extensions[this.name])return;const o=(c=>{const _=[],j=new Set;for(const et of c){let nt=et,st=0;for(;j.has(nt);)nt=et+"."+ ++st;j.add(nt),_.push(nt)}return _})((s.extensions[this.name].variants||[]).map(c=>c.name));for(const c of e.scenes)c.traverse(_=>{const j=i.associations.get(_);if(!j||j.meshes===void 0||j.primitives===void 0)return;const et=s.meshes[j.meshes].primitives[j.primitives].extensions;et&&et[this.name]&&(_.userData._variantMaterials=_O(et[this.name],o))});await Promise.all(e.scenes.map(async c=>{const _=[];return c.traverse(j=>{return(et=j).material!==void 0&&et.userData&&et.userData._variantMaterials&&_.push((async nt=>{const st=nt.material,at=nt.userData._variantMaterials,ct=[];for(const dt in at){const mt=at[dt];if(mt.material)continue;const yt=mt.gltfMaterialIndex;ct.push(i.getDependency("material",yt).then(wt=>{nt.material=wt,i.assignFinalMaterial(nt),at[dt].material=nt.material}))}return Promise.all(ct).then(()=>{nt.material=st})})(j));var et}),c.userData.__importData||(c.userData.__importData={}),c.userData.__importData[Bw]={names:o},Promise.all(_)}))}}const PM=h=>h.material!==void 0&&h.userData&&h.userData._variantMaterials&&!!Object.values(h.userData._variantMaterials).filter(e=>ME(e==null?void 0:e.material)),ME=h=>h&&h.isMaterial&&!Array.isArray(h);class RM{constructor(e){this.writer=e,this.name=Bw,this.variantNames=[]}beforeParse(e){const i=new Set;for(const s of e)s.traverse(o=>{if(!PM(o))return;const c=o.userData._variantMaterials;for(const _ in c){const j=c[_];ME(j.material)&&i.add(_)}});i.forEach(s=>this.variantNames.push(s))}writeMesh(e,i){if(!PM(e))return;const s=e.userData,o=s._variantMaterials,c={};for(const et in o){const nt=o[et].material;if(!ME(nt))continue;const st=this.variantNames.indexOf(et),at=this.writer.processMaterial(nt);c[at]||(c[at]={material:at,variants:[]}),c[at].variants.push(st)}const _=Object.values(c).map(et=>et.variants.sort((nt,st)=>nt-st)&&et).sort((et,nt)=>et.material-nt.material);if(_.length===0)return;const j=ME(s._originalMaterial)?this.writer.processMaterial(s._originalMaterial)??-1:-1;for(const et of i.primitives)j>=0&&(et.material=j),et.extensions=et.extensions||{},et.extensions[this.name]={mappings:_}}afterParse(e){if(this.variantNames.length===0)return;const i=this.writer.json;i.extensions=i.extensions||{};const s=this.variantNames.map(o=>({name:o}));i.extensions[this.name]={variants:s},this.writer.extensionsUsed[this.name]=!0}}function OC(h){return new RM(h)}class E0 extends ms{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[Fr],this.variants={},this.selectedVariant="",this._objectAdded=e=>{var s,o;const i=e.object;(i==null?void 0:i.assetType)==="model"&&i.modelObject&&this._viewer&&(i.modelObject.traverse(c=>{var et,nt,st,at,ct;if(c.userData._variantMaterials)for(const dt of Object.values(c.userData._variantMaterials))dt!=null&&dt.material&&(dt.material=((st=(nt=(et=this._viewer)==null?void 0:et.getManager())==null?void 0:nt.materials)==null?void 0:st.processMaterial(dt.material,{}))||dt.material);const _=(ct=(at=c.userData)==null?void 0:at.__importData)==null?void 0:ct[Bw];if(!_)return;const j=_.names||[];for(const dt of j)this.variants[dt]||(this.variants[dt]=[]),this.variants[dt].push(c);delete c.userData.__importData[Bw]}),(o=(s=this.uiConfig).uiRefresh)==null||o.call(s))},this.uiConfig={type:"folder",label:"KHR Material Variants",children:[()=>({children:[null,...Object.keys(this.variants)].map(e=>e?{label:e}:{label:"none",value:""}),type:"dropdown",label:"Variant",property:[this,"selectedVariant"]})]},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var s,o,c,_;await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._objectAdded);const i=e.getPlugin(Fr);(s=i==null?void 0:i.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(_=(c=(o=i==null?void 0:i.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||_.push(OC)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(i=>new sP(i))}async onRemove(e){var o,c,_,j,et,nt;e.scene.removeEventListener("addSceneObject",this._objectAdded);const i=e.getPlugin(Fr);(o=i.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate);const s=(j=(_=(c=i.exporter)==null?void 0:c.getExporter("gltf","glb"))==null?void 0:_.extensions)==null?void 0:j.indexOf(OC);return s!==void 0&&s!==-1&&((nt=(et=i.exporter.getExporter("gltf","glb"))==null?void 0:et.extensions)==null||nt.splice(s,1)),this.variants={},super.onRemove(e)}_variantChanged(){this.applyVariant(this.selectedVariant||"",!0)}applyVariant(e,i=!1,s,o=!0){if(!i&&!s&&this.selectedVariant===e||!e)return;s||(this.selectedVariant=e);const c=s?Array.isArray(s)?s:[s]:e?this.variants[e]||[]:Object.values(this.variants).flat();for(const _ of c){const j=new Set,et=nt=>{var at,ct;if(!nt.userData._variantMaterials||j.has(nt))return;const st=e?(at=nt.userData._variantMaterials[e])==null?void 0:at.material:nt.userData._originalMaterial;st&&(nt.userData._originalMaterial||(nt.userData._originalMaterial=nt.material),(ct=nt==null?void 0:nt.setMaterial)==null||ct.call(nt,st)),j.add(nt)};o?_.traverse(et):et(_)}}}E0.PluginType="GLTFKHRMaterialVariantsPlugin",function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);c>3&&_&&Object.defineProperty(e,i,_)}([(0,b.onChange)(E0.prototype._variantChanged)],E0.prototype,"selectedVariant",void 0);function r1(h){const e=h==null?void 0:h.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const i=e._ssBevel;return i.hasSSBevel=!0,i.radius===void 0&&(i.radius=0),h.isMaterial&&(h.needsUpdate=!0),!0}let i1=class extends yo{constructor(h,e,i,s){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new g.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new g.Pa4(1,1,1)}},vertexShader:Lm,fragmentShader:`

            ${i}

            ${Nv}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
float getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(o,c,_)=>{var j,et;this.enabled&&((et=(j=c.materialObject.userData)==null?void 0:j._ssBevel)!=null&&et.hasSSBevel)&&(o.fragmentShader=os(o.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(o,c,_)=>{var nt,st;if(!this.enabled||!((st=(nt=c.materialObject.userData)==null?void 0:nt._ssBevel)!=null&&st.hasSSBevel))return;const j=c.materialObject,et=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==et&&(this.materialExtension.extraUniforms.tSSBevelMap.value=et,j.needsUpdate=!0)},getUiConfig:o=>{const c={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var _;return((_=o.materialObject.userData._ssBevel)==null?void 0:_.hasSSBevel)||!1},set value(_){var j,et;_!==((j=o.materialObject.userData._ssBevel)==null?void 0:j.hasSSBevel)&&(_?r1(o.materialObject)||alert("Cannot add screen space bevel."):o.materialObject.userData._ssBevel&&(o.materialObject.userData._ssBevel.hasSSBevel=!1,o.materialObject.needsUpdate=!0),(et=c.uiRefresh)==null||et.call(c,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var _;return!((_=o.materialObject.userData._ssBevel)!=null&&_.hasSSBevel)},property:[o.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return c},parsFragmentSnippet:(o,c)=>{var _,j;return this.enabled&&((j=(_=c==null?void 0:c.materialObject.userData)==null?void 0:_._ssBevel)!=null&&j.hasSSBevel)?b.glsl`
            uniform sampler2D tSSBevelMap;
            ${J1}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:o=>{var c,_;return(this.enabled?"1":"0")+((_=(c=o.materialObject.userData)==null?void 0:c._ssBevel)!=null&&_.hasSSBevel?"1":"0")},isCompatible:o=>o.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=s,this._edgeMaterial=new s0({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new g.FM8(1,1)},cameraPositionWorld:{value:new g.Pa4(1,1,1)}},vertexShader:Lm,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new s0({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new g.FM8(.5,.5)},direction:{value:new g.FM8(.5,.5)}},vertexShader:Lm,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(h,e,i,s,o){var et,nt;if(!this.enabled)return;const c=h.baseRenderer,_={minFilter:g.wem,magFilter:g.wem,isAntialiased:!1,format:g.wk1,depthBuffer:!1,generateMipmaps:!1},j=c.getTempTarget(_);this._renderEdges(c,j),this._blurEdges(c,j),this._viewerApp.scene.renderCamera.updateShaderProperties(this.material),(et=this._viewerApp.getPlugin(zo))==null||et.updateShaderProperties(this.material),(nt=this._viewerApp.getPlugin(k_))==null||nt.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=j.texture,super.render(h,this._target,j,s,o),c.releaseTempTarget(j)}_initsamples(){const h=[];return h.push(new g.FM8(-8,0).multiplyScalar(.125)),h.push(new g.FM8(-6,-4).multiplyScalar(.125)),h.push(new g.FM8(-3,-2).multiplyScalar(.125)),h.push(new g.FM8(-2,-6).multiplyScalar(.125)),h.push(new g.FM8(1,-1).multiplyScalar(.125)),h.push(new g.FM8(2,-5).multiplyScalar(.125)),h.push(new g.FM8(6,-7).multiplyScalar(.125)),h.push(new g.FM8(5,-3).multiplyScalar(.125)),h.push(new g.FM8(4,1).multiplyScalar(.125)),h.push(new g.FM8(7,4).multiplyScalar(.125)),h.push(new g.FM8(3,5).multiplyScalar(.125)),h.push(new g.FM8(0,7).multiplyScalar(.125)),h.push(new g.FM8(-1,3).multiplyScalar(.125)),h.push(new g.FM8(-4,6).multiplyScalar(.125)),h.push(new g.FM8(-7,8).multiplyScalar(.125)),h.push(new g.FM8(-5,2).multiplyScalar(.125)),h}_blurEdges(h,e){var _,j;const i={minFilter:g.wem,magFilter:g.wem,isAntialiased:!1,format:g.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},s=h.getTempTarget(i),o=((_=e.texture.image)==null?void 0:_.width)||1,c=((j=e.texture.image)==null?void 0:j.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new g.FM8(o,c),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new g.FM8(1,0),h.blit(void 0,s,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new g.FM8(o/2,c/2),this._separableBlurMaterial.uniforms.colorTexture.value=s.texture,this._separableBlurMaterial.uniforms.direction.value=new g.FM8(0,1),h.blit(void 0,e,{material:this._separableBlurMaterial}),h.releaseTempTarget(s)}_renderEdges(h,e){var o,c,_,j;const i=((o=e.texture.image)==null?void 0:o.width)||1,s=((c=e.texture.image)==null?void 0:c.height)||1;this._edgeMaterial.uniforms.screenSize.value=new g.FM8(i,s),this._viewerApp.scene.renderCamera.updateShaderProperties(this._edgeMaterial),(_=this._viewerApp.getPlugin(zo))==null||_.updateShaderProperties(this._edgeMaterial),(j=this._viewerApp.getPlugin(k_))==null||j.updateShaderProperties(this._edgeMaterial),h.blit(void 0,e,{material:this._edgeMaterial})}};i1=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_}([ks("SSBevel")],i1);class Gv extends t_{get bevelTarget(){return this._bevelTarget}constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[Fr,zo,k_],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(i=>new oP(i))}passCtor(e){var i;return this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:g.cLu,minFilter:g.TyD,magFilter:g.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1,e.getPluginByType("debug"),new i1(e.renderer,this._bevelTarget,((i=e.getPlugin(zo))==null?void 0:i.getUnpackSnippet())??"",e)}async onAdded(e){var s,o,c,_,j,et,nt,st;await super.onAdded(e);const i=e.getPlugin(Fr);return(s=this.pass)!=null&&s.passObject.materialExtension&&((c=i==null?void 0:i.materials)==null||c.registerMaterialExtension((o=this.pass)==null?void 0:o.passObject.materialExtension)),(_=i==null?void 0:i.importer)==null||_.addEventListener("loaderCreate",this._loaderCreate),(nt=(et=(j=i==null?void 0:i.exporter)==null?void 0:j.getExporter("gltf","glb"))==null?void 0:et.extensions)==null||nt.push(vO),(st=e.getPlugin(zo))==null||st.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,i,s,o;(e=this._viewer)==null||e.setDirty(),(o=(i=this.pass)==null?void 0:(s=i.passObject.materialExtension).setDirty)==null||o.call(s)}_update(e){var s,o;let i=this.enabled;if(i&&!this._lastEnabled){const c=(s=this._viewer)==null?void 0:s.getPluginByType("NormalBufferPlugin");c&&!c.enabled&&(c.enabled=!0),c||((o=this._viewer)==null||o.console.error("SSBevelPlugin needs NormalBufferPlugin"))}return this._lastEnabled=i,i}get uiConfig(){var i,s,o,c;const e=((s=(i=this.pass)==null?void 0:i.passObject)==null?void 0:s.uiConfig)??{};return(c=(o=e.children)==null?void 0:o.map(_=>(0,b.getOrCall)(_)))==null||c.flat(2).forEach(_=>_&&(_.onChange=this.setDirty)),e}updateGBuffer(e,i){var s,o,c;if(e instanceof g.Kj0&&((s=e.material)!=null&&s.userData)){for(let j=3;j<8;j++)i.y=m2(i.y,j);let _=(o=e.material)!=null&&o.userData._ssBevel?(c=e.material)==null?void 0:c.userData._ssBevel.radius:0;_=Math.min(_,31),_<<=3,i.y=i.y|_}}}Gv.PluginType="SSBevelPlugin",Gv.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class oP{constructor(e){this.parser=e,this.name=Gv.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return i.userData||(i.userData={}),r1(i),i.userData._ssBevel=ao(o,i.userData._ssBevel,!1,{}),Promise.resolve()}}const vO=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;i.extensions=i.extensions||{};const s=Ls(e.userData._ssBevel,!1);i.extensions[Gv.SSBEVEL_GLTF_EXTENSION]=s,h.extensionsUsed[Gv.SSBEVEL_GLTF_EXTENSION]=!0}});class aP{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,i,s){this.enabled&&(e.fragmentShader=os(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class BC extends ty{generateExtension(e){return new aP}}BC.PluginType="GammaCorrection";var DM=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Hv=class extends ms{addTriplanarMapping(h){var i;const e=(i=h.materialObject)==null?void 0:i.userData;return!!e&&(e._triplanarMapping||(e._triplanarMapping={}),e._triplanarMapping.enable=!0,e._triplanarMapping.scaleFactor===void 0&&(e._triplanarMapping.scaleFactor=1),e._triplanarMapping.blendFactor===void 0&&(e._triplanarMapping.blendFactor=1),e._triplanarMapping.offsetFactor===void 0&&(e._triplanarMapping.offsetFactor=0),h.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new LC(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Fr],this._uniforms={triplanarScale:{value:1},triplanarBlend:{value:1},triplanarOffset:{value:0}},this.materialExtension={shaderExtender:(h,e,i)=>{var et,nt;if(!this.enabled||!((nt=(et=e.materialObject.userData)==null?void 0:et._triplanarMapping)!=null&&nt.enable))return;const s=b.glsl`
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;h.vertexShader=os(h.vertexShader,"#include <common>",s,{prepend:!0});const o=b.glsl`
                #ifndef USE_TRANSMISSION
                    vWorldPosition = worldPosition.xyz;
                #endif
                vWorldNormal = normalize((modelMatrix * vec4(objectNormal, 0.)).xyz);
            `;h.vertexShader=os(h.vertexShader,"#include <worldpos_vertex>",o,{append:!0});const c=b.glsl`
                ${"struct TriplanarUV{vec2 x;vec2 y;vec2 z;};uniform float triplanarScale;uniform float triplanarBlend;uniform float triplanarOffset;vec3 getTriplanarWeights(in vec3 position,in vec3 normal){vec3 triW=abs(normal);triW=clamp(triW-vec3(triplanarOffset),vec3(0.),vec3(1.));triW=pow(triW,vec3(triplanarBlend));return triW/(triW.x+triW.y+triW.z);}TriplanarUV getTriplanarUV(in vec3 position,in vec3 normal){TriplanarUV triUV;triUV.x=position.zy*triplanarScale;triUV.y=position.xz*triplanarScale;triUV.z=position.xy*triplanarScale;if(normal.x<0.){triUV.x.x=-triUV.x.x;}if(normal.y<0.){triUV.y.x=-triUV.y.x;}if(normal.z>=0.){triUV.z.x=-triUV.z.x;}return triUV;}vec4 textureTriplanar(in sampler2D tex,in vec3 position,in vec3 normal){TriplanarUV triUV=getTriplanarUV(position,normal);vec4 texX=texture2D(tex,triUV.x);vec4 texY=texture2D(tex,triUV.y);vec4 texZ=texture2D(tex,triUV.z);vec3 triW=getTriplanarWeights(position,normal);return texX*triW.x+texY*triW.y+texZ*triW.z;}"}
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;h.fragmentShader=os(h.fragmentShader,"#include <common>",c,{prepend:!0});const _=b.glsl`

            #ifdef USE_BUMPMAP

            uniform sampler2D bumpMap;
            uniform float bumpScale;

            // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
            // https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

            // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

            vec2 dHdxy_fwd() {

                vec3 dSTdx = dFdx( vWorldPosition );
                vec3 dSTdy = dFdy( vWorldPosition );

                vec3 normal_ = normalize(vWorldNormal);
                float Hll = bumpScale * textureTriplanar( bumpMap, vWorldPosition, normal_ ).x;
                float dBx = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdx, normal_ ).x - Hll;
                float dBy = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdy, normal_ ).x - Hll;

                return vec2( dBx, dBy );

            }

            vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

                vec3 vSigmaX = dFdx( surf_pos.xyz );
                vec3 vSigmaY = dFdy( surf_pos.xyz );
                vec3 vN = surf_norm; // normalized

                vec3 R1 = cross( vSigmaY, vN );
                vec3 R2 = cross( vN, vSigmaX );

                float fDet = dot( vSigmaX, R1 ) * faceDirection;

                vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
                return normalize( abs( fDet ) * surf_norm - vGrad );

            }

        #endif
            `;h.fragmentShader=os(h.fragmentShader,"#include <bumpmap_pars_fragment>",_);let j=os(g.WdD.map_fragment,"texture2D( map, vMapUv );","textureTriplanar( map, vWorldPosition, normalize(vWorldNormal) );");h.fragmentShader=os(h.fragmentShader,"#include <map_fragment>",j),j=os(g.WdD.roughnessmap_fragment,"texture2D( roughnessMap, vRoughnessMapUv );","textureTriplanar( roughnessMap, vWorldPosition, normalize(vWorldNormal));"),h.fragmentShader=os(h.fragmentShader,"#include <roughnessmap_fragment>",j),j=os(g.WdD.metalnessmap_fragment,"texture2D( metalnessMap, vMetalnessMapUv );","textureTriplanar( metalnessMap, vWorldPosition, normalize(vWorldNormal));"),h.fragmentShader=os(h.fragmentShader,"#include <metalnessmap_fragment>",j),j=os(g.WdD.normal_fragment_maps,"vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;","vec3 mapN = textureTriplanar( normalMap, vWorldPosition, normalize(vWorldNormal) ).xyz * 2.0 - 1.0;"),h.fragmentShader=os(h.fragmentShader,"#include <normal_fragment_maps>",j),h.defines.USE_UV=""},onObjectRender:(h,e)=>{var o,c,_,j;const i=e.materialObject.userData;if(!((o=i==null?void 0:i._triplanarMapping)!=null&&o.enable))return;const s=h;s.isMesh&&s.geometry&&(this._uniforms.triplanarScale.value=(c=i._triplanarMapping)==null?void 0:c.scaleFactor,this._uniforms.triplanarBlend.value=(_=i._triplanarMapping)==null?void 0:_.blendFactor,this._uniforms.triplanarOffset.value=(j=i._triplanarMapping)==null?void 0:j.offsetFactor)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i;return(this.enabled?"1":"0")+((i=(e=h.materialObject.userData)==null?void 0:e._triplanarMapping)!=null&&i.enable?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>{var h;return[(h=this._viewer)==null?void 0:h.renderer]},getUiConfig:h=>{const e=this._viewer,i=this.addTriplanarMapping,s={type:"folder",label:"Triplanar",children:[{type:"checkbox",label:"Enabled",get value(){var o;return((o=h.materialObject.userData._triplanarMapping)==null?void 0:o.enable)||!1},set value(o){var c,_;o!==((c=h.materialObject.userData._triplanarMapping)==null?void 0:c.enable)&&(o?i(h)||e.alert("Cannot add Triplanar mapping."):h.materialObject.userData._triplanarMapping&&(h.materialObject.userData._triplanarMapping.enable=!1,h.materialObject.needsUpdate=!0),(_=s.uiRefresh)==null||_.call(s,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[.1,10],label:"Scale",hidden:()=>{var o;return!((o=h.materialObject.userData._triplanarMapping)!=null&&o.enable)},property:[h.materialObject.userData._triplanarMapping,"scaleFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[1,10],label:"Blend",hidden:()=>{var o;return!((o=h.materialObject.userData._triplanarMapping)!=null&&o.enable)},property:[h.materialObject.userData._triplanarMapping,"blendFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,.5],stepSize:.01,label:"Offset",hidden:()=>{var o;return!((o=h.materialObject.userData._triplanarMapping)!=null&&o.enable)},property:[h.materialObject.userData._triplanarMapping,"offsetFactor"],onChange:this.setDirty})]};return s}},this.setDirty=()=>{var h,e,i;(e=(h=this.materialExtension).setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,_;await super.onAdded(h);const e=h.getPlugin(Fr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(_=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||_.push(kM)}async onRemove(h){var e,i,s,o;return(i=(e=h.getPlugin(Fr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),(o=(s=h.getPlugin(Fr))==null?void 0:s.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};Hv.PluginType="TriplanarUVMappingPlugin",Hv.TRIPLANAR_GLTF_EXTENSION="WEBGI_materials_triplanar",DM([jr("Enabled",h=>({onChange:h.setDirty})),En()],Hv.prototype,"enabled",void 0),Hv=DM([ks("Triplanar Mapping")],Hv);class LC{constructor(e){this.parser=e,this.name=Hv.TRIPLANAR_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];i.userData||(i.userData={});const c=i.userData;return c._triplanarMapping||(c._triplanarMapping={}),c._triplanarMapping.enable=!0,c._triplanarMapping.scaleFactor===void 0&&(c._triplanarMapping.scaleFactor=1),c._triplanarMapping.blendFactor===void 0&&(c._triplanarMapping.blendFactor=1),c._triplanarMapping.offsetFactor===void 0&&(c._triplanarMapping.offsetFactor=0),i.userData._triplanarMapping=ao(o,i.userData._triplanarMapping,!1,{}),Promise.resolve()}}const kM=h=>({writeMaterial:(e,i)=>{var o;if(!e.isMeshStandardMaterial||!((o=e.userData._triplanarMapping)!=null&&o.enable))return;i.extensions=i.extensions||{};const s=Ls(e.userData._triplanarMapping,!1);i.extensions[Hv.TRIPLANAR_GLTF_EXTENSION]=s,h.extensionsUsed[Hv.TRIPLANAR_GLTF_EXTENSION]=!0}});var lP=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let hv=class extends ms{addClearcoatTint(h){return OM(h.materialObject)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(e=>new cP(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Fr],this._defines={},this._uniforms={ccTintColor:{value:new To},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(h,e)=>{var i;return this.enabled&&((i=e==null?void 0:e.materialObject.userData._clearcoatTint)!=null&&i.enableTint)&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(h,e,i)=>{var c;if(!(this.enabled&&((c=e==null?void 0:e.materialObject.userData._clearcoatTint)!=null&&c.enableTint)&&e.materialObject.clearcoat>0))return;const s="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",o="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";h.fragmentShader.includes(o)&&h.fragmentShader.includes(s)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),h.fragmentShader=h.fragmentShader.replace(o,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),h.fragmentShader=h.fragmentShader.replace(s,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+s),h.defines.USE_UV=""},onObjectRender:(h,e)=>{var o;const i=(o=e.materialObject.userData)==null?void 0:o._clearcoatTint;if(!(i!=null&&i.enableTint))return;this._uniforms.ccTintColor.value.set(i.tintColor),this._uniforms.ccThickness.value=i.thickness,this._uniforms.ccIor.value=i.ior;const s=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==s&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=s,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var e,i;return(this.enabled?"1":"0")+((i=(e=h.materialObject.userData)==null?void 0:e._clearcoatTint)!=null&&i.enableTint?"1":"0")+(h.materialObject.clearcoat>0?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:h=>{const e=this._viewer,i={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=h.materialObject.userData._clearcoatTint)==null?void 0:s.enableTint)||!1},set value(s){var o,c;s!==((o=h.materialObject.userData._clearcoatTint)==null?void 0:o.enableTint)&&(s?OM(h.materialObject)||e.alert("Cannot add clearcoat tint."):h.materialObject.userData._clearcoatTint&&(h.materialObject.userData._clearcoatTint.enableTint=!1,h.materialObject.needsUpdate=!0),(c=i.uiRefresh)==null||c.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var s;return!((s=h.materialObject.userData._clearcoatTint)!=null&&s.enableTint)},property:[h.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var s;return!((s=h.materialObject.userData._clearcoatTint)!=null&&s.enableTint)},property:[h.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var s;return!((s=h.materialObject.userData._clearcoatTint)!=null&&s.enableTint)},property:[h.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var h,e,i;(e=(h=this.materialExtension).setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var i,s,o,c,_;await super.onAdded(h);const e=h.getPlugin(Fr);(i=e==null?void 0:e.materials)==null||i.registerMaterialExtension(this.materialExtension),(s=e==null?void 0:e.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(_=(c=(o=e==null?void 0:e.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||_.push(uP)}async onRemove(h){var e,i,s,o;return(i=(e=h.getPlugin(Fr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this.materialExtension),(o=(s=h.getPlugin(Fr))==null?void 0:s.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};function OM(h){const e=h==null?void 0:h.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const i=e._clearcoatTint;return i.enableTint=!0,i.tintColor===void 0&&(i.tintColor=16777215),i.thickness===void 0&&(i.thickness=.1),i.ior===void 0&&(i.ior=1.5),h.isMaterial&&(h.needsUpdate=!0),!0}hv.PluginType="ClearcoatTintPlugin",hv.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",lP([jr("Enabled",h=>({onChange:h.setDirty})),En()],hv.prototype,"enabled",void 0),hv=lP([ks("ClearcoatTint Materials")],hv);class cP{constructor(e){this.parser=e,this.name=hv.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return i.userData||(i.userData={}),OM(i),ao(o,i.userData._clearcoatTint,!1,{}),Promise.resolve()}}const uP=h=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;i.extensions=i.extensions||{};const s=Ls(e.userData._clearcoatTint,!1);i.extensions[hv.CLEARCOAT_TINT_GLTF_EXTENSION]=s,h.extensionsUsed[hv.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});class Lw{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=i}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,i){const s=this.workersResolve[e];if(s&&s(i),this.queue.length){const{resolve:o,msg:c,transfer:_}=this.queue.shift();this.workersResolve[e]=o,this.workers[e].postMessage(c,_)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,i){return new Promise(s=>{const o=this._getIdleWorker();o!==-1?(this._initWorker(o),this.workerStatus|=1<<o,this.workersResolve[o]=s,this.workers[o].postMessage(e,i)):this.queue.push({resolve:s,msg:e,transfer:i})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class yO{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class s1{constructor(e,i,s,o){this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=o,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let o=0;for(;this._dataView.getUint8(this._offset)!==i&&o<e;)o++,this._offset++;return o<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,o)}}const xm=[171,75,84,88,32,50,48,187,13,10,26,10];function vA(h){return typeof TextDecoder<"u"?new TextDecoder().decode(h):Buffer.from(h).toString("utf8")}let NC,my,gy;const BM={env:{emscripten_notify_memory_growth:function(h){gy=new Uint8Array(my.exports.memory.buffer)}}};class hP{init(){return NC||(NC=typeof fetch<"u"?fetch("data:application/wasm;base64,"+yA).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,BM)).then(this._init):WebAssembly.instantiate(Buffer.from(yA,"base64"),BM).then(this._init),NC)}_init(e){my=e.instance,BM.env.emscripten_notify_memory_growth(0)}decode(e,i=0){if(!my)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,o=my.exports.malloc(s);gy.set(e,o),i=i||Number(my.exports.ZSTD_findDecompressedSize(o,s));const c=my.exports.malloc(i),_=my.exports.ZSTD_decompress(c,i,o,s),j=gy.slice(c,c+_);return my.exports.free(o),my.exports.free(c),j}}const yA="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",UC=new WeakMap;let LM,_y=0;class S0 extends g.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Lw,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new g.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),s=new g.hH6(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const o=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,o]).then(([c,_])=>{const j=S0.BasisWorker,et=["/* constants */","let _EngineFormat = "+JSON.stringify(S0.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(S0.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(S0.BasisFormat),"/* basis_transcoder.js */",c,"/* worker */",j.substring(j.indexOf("{")+1,j.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([et])),this.transcoderBinary=_,this.workerPool.setWorkerCreator(()=>{const nt=new Worker(this.workerSourceURL),st=this.transcoderBinary.slice(0);return nt.postMessage({type:"init",config:this.workerConfig,transcoderBinary:st},[st]),nt})}),_y>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),_y++}return this.transcoderPending}load(e,i,s,o){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const c=new g.hH6(this.manager);c.setResponseType("arraybuffer"),c.setWithCredentials(this.withCredentials),c.load(e,_=>{if(UC.has(_))return UC.get(_).promise.then(i).catch(o);this.createTexture(_).then(j=>i?i(j):null).catch(o)},s,o)}_createTextureFrom(e,i){const{mipmaps:s,width:o,height:c,format:_,type:j,error:et,dfdTransferFn:nt,dfdFlags:st}=e;if(j==="error")return Promise.reject(et);const at=i.layerCount>1?new g.Z_g(s,o,c,i.layerCount,_,g.ywz):new g.EB7(s,o,c,_,g.ywz);return at.minFilter=s.length===1?g.wem:g.D1R,at.magFilter=g.wem,at.generateMipmaps=!1,at.needsUpdate=!0,at.colorSpace=nt===2?g.KI_:g.aCh,at.premultiplyAlpha=!!(1&st),at}async createTexture(e,i={}){const s=function(_){const j=new Uint8Array(_.buffer,_.byteOffset,xm.length);if(j[0]!==xm[0]||j[1]!==xm[1]||j[2]!==xm[2]||j[3]!==xm[3]||j[4]!==xm[4]||j[5]!==xm[5]||j[6]!==xm[6]||j[7]!==xm[7]||j[8]!==xm[8]||j[9]!==xm[9]||j[10]!==xm[10]||j[11]!==xm[11])throw new Error("Missing KTX 2.0 identifier.");const et=new yO,nt=17*Uint32Array.BYTES_PER_ELEMENT,st=new s1(_,xm.length,nt,!0);et.vkFormat=st._nextUint32(),et.typeSize=st._nextUint32(),et.pixelWidth=st._nextUint32(),et.pixelHeight=st._nextUint32(),et.pixelDepth=st._nextUint32(),et.layerCount=st._nextUint32(),et.faceCount=st._nextUint32();const at=st._nextUint32();et.supercompressionScheme=st._nextUint32();const ct=st._nextUint32(),dt=st._nextUint32(),mt=st._nextUint32(),yt=st._nextUint32(),wt=st._nextUint64(),Ct=st._nextUint64(),bt=new s1(_,xm.length+nt,3*at*8,!0);for(let Mr=0;Mr<at;Mr++)et.levels.push({levelData:new Uint8Array(_.buffer,_.byteOffset+bt._nextUint64(),bt._nextUint64()),uncompressedByteLength:bt._nextUint64()});const At=new s1(_,ct,dt,!0),Pt={vendorId:At._skip(4)._nextUint16(),descriptorType:At._nextUint16(),versionNumber:At._nextUint16(),descriptorBlockSize:At._nextUint16(),colorModel:At._nextUint8(),colorPrimaries:At._nextUint8(),transferFunction:At._nextUint8(),flags:At._nextUint8(),texelBlockDimension:[At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8()],bytesPlane:[At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8()],samples:[]},Dt=(Pt.descriptorBlockSize/4-6)/4;for(let Mr=0;Mr<Dt;Mr++){const xr={bitOffset:At._nextUint16(),bitLength:At._nextUint8(),channelType:At._nextUint8(),samplePosition:[At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&xr.channelType?(xr.sampleLower=At._nextInt32(),xr.sampleUpper=At._nextInt32()):(xr.sampleLower=At._nextUint32(),xr.sampleUpper=At._nextUint32()),Pt.samples[Mr]=xr}et.dataFormatDescriptor.length=0,et.dataFormatDescriptor.push(Pt);const Nt=new s1(_,mt,yt,!0);for(;Nt._offset<yt;){const Mr=Nt._nextUint32(),xr=Nt._scan(Mr),qr=vA(xr),Zr=Nt._scan(Mr-xr.byteLength);et.keyValue[qr]=qr.match(/^ktx/i)?vA(Zr):Zr,Nt._offset%4&&Nt._skip(4-Nt._offset%4)}if(Ct<=0)return et;const Vt=new s1(_,wt,Ct,!0),Zt=Vt._nextUint16(),an=Vt._nextUint16(),fn=Vt._nextUint32(),mn=Vt._nextUint32(),Sn=Vt._nextUint32(),An=Vt._nextUint32(),wn=[];for(let Mr=0;Mr<at;Mr++)wn.push({imageFlags:Vt._nextUint32(),rgbSliceByteOffset:Vt._nextUint32(),rgbSliceByteLength:Vt._nextUint32(),alphaSliceByteOffset:Vt._nextUint32(),alphaSliceByteLength:Vt._nextUint32()});const Mn=wt+Vt._offset,Pn=Mn+fn,On=Pn+mn,er=On+Sn,Zn=new Uint8Array(_.buffer,_.byteOffset+Mn,fn),yr=new Uint8Array(_.buffer,_.byteOffset+Pn,mn),lr=new Uint8Array(_.buffer,_.byteOffset+On,Sn),ar=new Uint8Array(_.buffer,_.byteOffset+er,An);return et.globalData={endpointCount:Zt,selectorCount:an,imageDescs:wn,endpointsData:Zn,selectorsData:yr,tablesData:lr,extendedData:ar},et}(new Uint8Array(e));if(s.vkFormat!==0)return async function(_){const{vkFormat:j,pixelWidth:et,pixelHeight:nt,pixelDepth:st}=_;if(dP[j]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const at=_.levels[0];let ct,dt;if(_.supercompressionScheme===0)ct=at.levelData;else{if(_.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");LM||(LM=new Promise(async yt=>{const wt=new hP;await wt.init(),yt(wt)})),ct=(await LM).decode(at.levelData,at.uncompressedByteLength)}dt=FC[j]===g.VzW?new Float32Array(ct.buffer,ct.byteOffset,ct.byteLength/Float32Array.BYTES_PER_ELEMENT):FC[j]===g.cLu?new Uint16Array(ct.buffer,ct.byteOffset,ct.byteLength/Uint16Array.BYTES_PER_ELEMENT):ct;const mt=st===0?new g.IEO(dt,et,nt):new g.JUT(dt,et,nt,st);return mt.type=FC[j],mt.format=dP[j],mt.colorSpace=NM[j]||g.aCh,mt.needsUpdate=!0,Promise.resolve(mt)}(s);const o=i,c=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:o},[e])).then(_=>this._createTextureFrom(_.data,s));return UC.set(e,{promise:c}),c}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),_y--,this}}S0.BasisFormat={ETC1S:0,UASTC_4x4:1},S0.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},S0.EngineFormat={RGBAFormat:g.wk1,RGBA_ASTC_4x4_Format:g.ptH,RGBA_BPTC_Format:g.bsb,RGBA_ETC2_EAC_Format:g.ekQ,RGBA_PVRTC_4BPPV1_Format:g.eaV,RGBA_S3TC_DXT5_Format:g.ILR,RGB_ETC1_Format:g.fto,RGB_ETC2_Format:g.l0P,RGB_PVRTC_4BPPV1_Format:g._AM,RGB_S3TC_DXT1_Format:g.wuA},S0.BasisWorker=`function () {

	let config;
	let transcoderPending;
	let BasisModule;

	const EngineFormat = _EngineFormat; // eslint-disable-line no-undef
	const TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef
	const BasisFormat = _BasisFormat; // eslint-disable-line no-undef

	self.addEventListener( 'message', function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				config = message.config;
				init( message.transcoderBinary );
				break;

			case 'transcode':
				transcoderPending.then( () => {

					try {

						const { width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags } = transcode( message.buffer );

						const buffers = [];

						for ( let i = 0; i < mipmaps.length; ++ i ) {

							buffers.push( mipmaps[ i ].data.buffer );

						}

						self.postMessage( { type: 'transcode', id: message.id, width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					}

				} );
				break;

		}

	} );

	function init( wasmBinary ) {

		transcoderPending = new Promise( ( resolve ) => {

			BasisModule = { wasmBinary, onRuntimeInitialized: resolve };
			BASIS( BasisModule ); // eslint-disable-line no-undef

		} ).then( () => {

			BasisModule.initializeBasis();

			if ( BasisModule.KTX2File === undefined ) {

				console.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );

			}

		} );

	}

	function transcode( buffer ) {

		const ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );

		function cleanup() {

			ktx2File.close();
			ktx2File.delete();

		}

		if ( ! ktx2File.isValid() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid or unsupported .ktx2 file' );

		}

		const basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;
		const width = ktx2File.getWidth();
		const height = ktx2File.getHeight();
		const layers = ktx2File.getLayers() || 1;
		const levels = ktx2File.getLevels();
		const hasAlpha = ktx2File.getHasAlpha();
		const dfdTransferFn = ktx2File.getDFDTransferFunc();
		const dfdFlags = ktx2File.getDFDFlags();

		const { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );

		if ( ! width || ! height || ! levels ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid texture' );

		}

		if ( ! ktx2File.startTranscoding() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader: .startTranscoding failed' );

		}

		const mipmaps = [];

		for ( let mip = 0; mip < levels; mip ++ ) {

			const layerMips = [];

			let mipWidth, mipHeight;

			for ( let layer = 0; layer < layers; layer ++ ) {

				const levelInfo = ktx2File.getImageLevelInfo( mip, layer, 0 );
				mipWidth = levelInfo.origWidth < 4 ? levelInfo.origWidth : levelInfo.width;
				mipHeight = levelInfo.origHeight < 4 ? levelInfo.origHeight : levelInfo.height;
				const dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, layer, 0, transcoderFormat ) );
				const status = ktx2File.transcodeImage(
					dst,
					mip,
					layer,
					0,
					transcoderFormat,
					0,
					- 1,
					- 1,
				);

				if ( ! status ) {

					cleanup();
					throw new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );

				}

				layerMips.push( dst );

			}

			mipmaps.push( { data: concat( layerMips ), width: mipWidth, height: mipHeight } );

		}

		cleanup();

		return { width, height, hasAlpha, mipmaps, format: engineFormat, dfdTransferFn, dfdFlags };

	}

	//

	// Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),
	// device capabilities, and texture dimensions. The list below ranks the formats separately
	// for ETC1S and UASTC.
	//
	// In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at
	// significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently
	// chooses RGBA32 only as a last resort and does not expose that option to the caller.
	const FORMAT_OPTIONS = [
		{
			if: 'astcSupported',
			basisFormat: [ BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],
			engineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],
			priorityETC1S: Infinity,
			priorityUASTC: 1,
			needsPowerOfTwo: false,
		},
		{
			if: 'bptcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],
			engineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],
			priorityETC1S: 3,
			priorityUASTC: 2,
			needsPowerOfTwo: false,
		},
		{
			if: 'dxtSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],
			engineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],
			priorityETC1S: 4,
			priorityUASTC: 5,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc2Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],
			engineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],
			priorityETC1S: 1,
			priorityUASTC: 3,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc1Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1 ],
			engineFormat: [ EngineFormat.RGB_ETC1_Format ],
			priorityETC1S: 2,
			priorityUASTC: 4,
			needsPowerOfTwo: false,
		},
		{
			if: 'pvrtcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],
			engineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],
			priorityETC1S: 5,
			priorityUASTC: 6,
			needsPowerOfTwo: true,
		},
	];

	const ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityETC1S - b.priorityETC1S;

	} );
	const UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityUASTC - b.priorityUASTC;

	} );

	function getTranscoderFormat( basisFormat, width, height, hasAlpha ) {

		let transcoderFormat;
		let engineFormat;

		const options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;

		for ( let i = 0; i < options.length; i ++ ) {

			const opt = options[ i ];

			if ( ! config[ opt.if ] ) continue;
			if ( ! opt.basisFormat.includes( basisFormat ) ) continue;
			if ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;
			if ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;

			transcoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];
			engineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];

			return { transcoderFormat, engineFormat };

		}

		console.warn( 'THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32.' );

		transcoderFormat = TranscoderFormat.RGBA32;
		engineFormat = EngineFormat.RGBAFormat;

		return { transcoderFormat, engineFormat };

	}

	function isPowerOfTwo( value ) {

		if ( value <= 2 ) return true;

		return ( value & ( value - 1 ) ) === 0 && value !== 0;

	}

	/** Concatenates N byte arrays. */
	function concat( arrays ) {

		let totalByteLength = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			totalByteLength += array.byteLength;

		}

		const result = new Uint8Array( totalByteLength );

		let byteOffset = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			result.set( array, byteOffset );

			byteOffset += array.byteLength;

		}

		return result;

	}

}`;const dP={109:g.wk1,97:g.wk1,37:g.wk1,43:g.wk1,103:g.av9,83:g.av9,16:g.av9,22:g.av9,100:g.hEm,76:g.hEm,15:g.hEm,9:g.hEm},FC={109:g.VzW,97:g.cLu,37:g.ywz,43:g.ywz,103:g.VzW,83:g.cLu,16:g.ywz,22:g.ywz,100:g.VzW,76:g.cLu,15:g.ywz,9:g.ywz},NM={43:g.KI_,22:g.KI_,15:g.KI_},UM="KHR_texture_basisu";class AA extends b.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Fr]}async onAdded(e){var i,s,o,c,_,j;this._importer||(this._importer=new eu(class extends S0{constructor(et){super(et),this.setTranscoderPath(AA.TRANSCODER_LIBRARY_PATH).detectSupport(e.renderer.rendererObject)}async createTexture(et,nt){const st=new Uint8Array(et.slice(0)),at=await super.createTexture(et,nt);return at.source._sourceImgBuffer=st,at.userData.mimeType="image/ktx2",at.toJSON=ct=>$a(at,ct,at.name,"image/ktx2"),at.clone=()=>{throw new Error("ktx2 texture cloning not supported")},at}},["ktx2"],!1)),(s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.push(this._importer),(j=(_=(c=(o=e.getManager())==null?void 0:o.exporter)==null?void 0:c.getExporter("gltf","glb"))==null?void 0:_.extensions)==null||j.push(AO)}async onDispose(e){this._importer=void 0}async onRemove(e){var i,s;this._importer&&((s=(i=e.getManager())==null?void 0:i.importer)!=null&&s.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}AA.PluginType="KTX2LoadPlugin",AA.TRANSCODER_LIBRARY_PATH="https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/";const AO=h=>({writeTexture:(e,i)=>{if(e.userData.mimeType!=="image/ktx2")return;if(i.source!==void 0&&i.source!==null)return void console.warn("ktx2 export: source already set");const s=e.source._sourceImgBuffer||e.userData.__sourceBuffer;if(!s)return void console.warn("ktx2 export: no source buffer for ktx2");i.extensions=i.extensions||{};const o={},c=new Blob([s],{type:"image/ktx2"});o.source=h.processImageBlob(c,e),i.extensions[UM]=o,h.extensionsUsed[UM]=!0}});class vy extends b.SimpleEventDispatcher{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postRender)}addTexture(e,i,s,o,c,_="postRender",j=!1){var et;this._generators.has(_)||this._generators.set(_,[]),(et=this._generators.get(_))==null||et.push({key:e,fn:i,rect:s?[...s]:void 0,frag:c||o||j?new g.jyz({vertexShader:tt.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:c??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${j?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${j?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${o??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,i="postRender"){var s;this._generators.set(i,((s=this._generators.get(i))==null?void 0:s.filter(o=>o.key!==e))??[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var o;const i=this._viewer,s=i==null?void 0:i.renderer;s&&i&&((o=this._generators.get(e))==null||o.forEach(({key:c,fn:_,rect:j,frag:et})=>{const nt=_(i);if(nt){if(nt.image&&j){const st=nt.image.width/nt.image.height;j[2]<1&&j[3]<1&&(j[2]=200),j[2]<1&&(j[2]=j[3]*st),j[3]<1&&(j[3]=j[2]/st)}s.blit(nt,void 0,{viewport:j,clear:!1,material:et})}}))}}vy.PluginType="debug";class pP extends g.aNw{constructor(e){super(e)}load(e,i,s,o){const c=this,_=this.path===""?g.Zp0.extractUrlBase(e):this.path,j=new g.hH6(this.manager);j.setPath(this.path),j.setRequestHeader(this.requestHeader),j.setWithCredentials(this.withCredentials),j.load(e,function(et){try{i(c.parse(et,_))}catch(nt){o?o(nt):console.error(nt),c.manager.itemError(e)}},s,o)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,i){const s=e.split(`
`);let o={};const c=/\s+/,_={};for(let et=0;et<s.length;et++){let nt=s[et];if(nt=nt.trim(),nt.length===0||nt.charAt(0)==="#")continue;const st=nt.indexOf(" ");let at=st>=0?nt.substring(0,st):nt;at=at.toLowerCase();let ct=st>=0?nt.substring(st+1):"";if(ct=ct.trim(),at==="newmtl")o={name:ct},_[ct]=o;else if(at==="ka"||at==="kd"||at==="ks"||at==="ke"){const dt=ct.split(c,3);o[at]=[parseFloat(dt[0]),parseFloat(dt[1]),parseFloat(dt[2])]}else o[at]=ct}const j=new Ml(this.resourcePath||i,this.materialOptions);return j.setCrossOrigin(this.crossOrigin),j.setManager(this.manager),j.setMaterials(_),j}}class Ml{constructor(e="",i={}){this.baseUrl=e,this.options=i,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:g.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:g.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const i={};for(const s in e){const o=e[s],c={};i[s]=c;for(const _ in o){let j=!0,et=o[_];const nt=_.toLowerCase();switch(nt){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(et=[et[0]/255,et[1]/255,et[2]/255]),this.options&&this.options.ignoreZeroRGBs&&et[0]===0&&et[1]===0&&et[2]===0&&(j=!1)}j&&(c[nt]=et)}}return i}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const i in this.materialsInfo)this.materialsArray[e]=await this.create(i),this.nameLookup[i]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const i=this,s=this.materialsInfo[e],o={name:e,side:this.side};async function c(et,nt){if(o[et])return;const st=i.getTextureParams(nt,o);return new Promise((at,ct)=>{let dt=!1,mt=()=>!dt&&(dt=!0)&&at();const yt=i.loadTexture((wt=i.baseUrl,typeof(Ct=st.url)!="string"||Ct===""?"":/^https?:\/\//i.test(Ct)?Ct:wt+Ct),void 0,bt=>{o[et]=bt,mt()},void 0,mt);var wt,Ct;setTimeout(mt,50),yt.repeat.copy(st.scale),yt.offset.copy(st.offset),yt.wrapS=i.wrap,yt.wrapT=i.wrap,et!=="map"&&et!=="emissiveMap"||(yt.colorSpace=g.KI_)})}const _=Array.from(Object.keys(s||{}));let j=_.includes("d")||_.includes("D");for(const et of _){const nt=s[et];let st;if(nt!=="")switch(et.toLowerCase()){case"kd":o.color=new g.Ilk().fromArray(nt).convertSRGBToLinear();break;case"ks":o.specular=new g.Ilk().fromArray(nt).convertSRGBToLinear();break;case"ke":o.emissive=new g.Ilk().fromArray(nt).convertSRGBToLinear();break;case"map_kd":await c("map",nt);break;case"map_ks":await c("specularMap",nt);break;case"map_ke":await c("emissiveMap",nt);break;case"norm":await c("normalMap",nt);break;case"map_bump":case"bump":await c("bumpMap",nt);break;case"map_d":await c("alphaMap",nt),o.transparent=!0;break;case"ns":o.shininess=parseFloat(nt);break;case"d":st=parseFloat(nt),st<1&&(o.opacity=st,o.transparent=!0);break;case"tr":if(j)break;st=parseFloat(nt),this.options&&this.options.invertTrProperty&&(st=1-st),st>0&&(o.opacity=1-st,o.transparent=!0)}}return this.materials[e]=new g.xoR(o),this.materials[e]}getTextureParams(e,i){const s={scale:new g.FM8(1,1),offset:new g.FM8(0,0)},o=e.split(/\s+/);let c;return c=o.indexOf("-bm"),c>=0&&(i.bumpScale=parseFloat(o[c+1]),o.splice(c,2)),c=o.indexOf("-s"),c>=0&&(s.scale.set(parseFloat(o[c+1]),parseFloat(o[c+2])),o.splice(c,4)),c=o.indexOf("-o"),c>=0&&(s.offset.set(parseFloat(o[c+1]),parseFloat(o[c+2])),o.splice(c,4)),s.url=o.join(" ").trim(),s}loadTexture(e,i,s,o,c){const _=this.manager!==void 0?this.manager:g.tEQ;let j=_.getHandler(e);j===null&&(j=new g.dpR(_)),j.setCrossOrigin&&j.setCrossOrigin(this.crossOrigin);const et=j.load(e,s,o,c);return i!==void 0&&(et.mapping=i),et}}const bO=/^[og]\s*(.+)?/,fP=/^mtllib /,wO=/^usemtl /,xO=/^usemap /,jC=/\s+/,mP=new g.Pa4,FM=new g.Pa4,gP=new g.Pa4,_P=new g.Pa4,dv=new g.Pa4,IE=new g.Ilk;function jM(){const h={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,i){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=i!==!1);const s=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:i!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(o,c){const _=this._finalize(!1);_&&(_.inherited||_.groupCount<=0)&&this.materials.splice(_.index,1);const j={index:this.materials.length,name:o||"",mtllib:Array.isArray(c)&&c.length>0?c[c.length-1]:"",smooth:_!==void 0?_.smooth:this.smooth,groupStart:_!==void 0?_.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(et){const nt={index:typeof et=="number"?et:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return nt.clone=this.clone.bind(nt),nt}};return this.materials.push(j),j},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(o){const c=this.currentMaterial();if(c&&c.groupEnd===-1&&(c.groupEnd=this.geometry.vertices.length/3,c.groupCount=c.groupEnd-c.groupStart,c.inherited=!1),o&&this.materials.length>1)for(let _=this.materials.length-1;_>=0;_--)this.materials[_].groupCount<=0&&this.materials.splice(_,1);return o&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),c}},s&&s.name&&typeof s.clone=="function"){const o=s.clone(0);o.inherited=!0,this.object.materials.push(o)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseNormalIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseUVIndex:function(e,i){const s=parseInt(e,10);return 2*(s>=0?s-1:s+i/2)},addVertex:function(e,i,s){const o=this.vertices,c=this.object.geometry.vertices;c.push(o[e+0],o[e+1],o[e+2]),c.push(o[i+0],o[i+1],o[i+2]),c.push(o[s+0],o[s+1],o[s+2])},addVertexPoint:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addVertexLine:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addNormal:function(e,i,s){const o=this.normals,c=this.object.geometry.normals;c.push(o[e+0],o[e+1],o[e+2]),c.push(o[i+0],o[i+1],o[i+2]),c.push(o[s+0],o[s+1],o[s+2])},addFaceNormal:function(e,i,s){const o=this.vertices,c=this.object.geometry.normals;mP.fromArray(o,e),FM.fromArray(o,i),gP.fromArray(o,s),dv.subVectors(gP,FM),_P.subVectors(mP,FM),dv.cross(_P),dv.normalize(),c.push(dv.x,dv.y,dv.z),c.push(dv.x,dv.y,dv.z),c.push(dv.x,dv.y,dv.z)},addColor:function(e,i,s){const o=this.colors,c=this.object.geometry.colors;o[e]!==void 0&&c.push(o[e+0],o[e+1],o[e+2]),o[i]!==void 0&&c.push(o[i+0],o[i+1],o[i+2]),o[s]!==void 0&&c.push(o[s+0],o[s+1],o[s+2])},addUV:function(e,i,s){const o=this.uvs,c=this.object.geometry.uvs;c.push(o[e+0],o[e+1]),c.push(o[i+0],o[i+1]),c.push(o[s+0],o[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const i=this.uvs;this.object.geometry.uvs.push(i[e+0],i[e+1])},addFace:function(e,i,s,o,c,_,j,et,nt){const st=this.vertices.length;let at=this.parseVertexIndex(e,st),ct=this.parseVertexIndex(i,st),dt=this.parseVertexIndex(s,st);if(this.addVertex(at,ct,dt),this.addColor(at,ct,dt),j!==void 0&&j!==""){const mt=this.normals.length;at=this.parseNormalIndex(j,mt),ct=this.parseNormalIndex(et,mt),dt=this.parseNormalIndex(nt,mt),this.addNormal(at,ct,dt)}else this.addFaceNormal(at,ct,dt);if(o!==void 0&&o!==""){const mt=this.uvs.length;at=this.parseUVIndex(o,mt),ct=this.parseUVIndex(c,mt),dt=this.parseUVIndex(_,mt),this.addUV(at,ct,dt),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const i=this.vertices.length;for(let s=0,o=e.length;s<o;s++){const c=this.parseVertexIndex(e[s],i);this.addVertexPoint(c),this.addColor(c)}},addLineGeometry:function(e,i){this.object.geometry.type="Line";const s=this.vertices.length,o=this.uvs.length;for(let c=0,_=e.length;c<_;c++)this.addVertexLine(this.parseVertexIndex(e[c],s));for(let c=0,_=i.length;c<_;c++)this.addUVLine(this.parseUVIndex(i[c],o))}};return h.startObject("",!1),h}class vP extends g.aNw{constructor(e){super(e),this.materials=null}load(e,i,s,o){const c=this,_=new g.hH6(this.manager);_.setPath(this.path),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials),_.load(e,async function(j){try{i(await c.parse(j))}catch(et){o?o(et):console.error(et),c.manager.itemError(e)}},s,o)}setMaterials(e){return this.materials=e,this}async parse(e){const i=new jM;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const s=e.split(`
`);let o=[];for(let _=0,j=s.length;_<j;_++){const et=s[_].trimStart();if(et.length===0)continue;const nt=et.charAt(0);if(nt!=="#")if(nt==="v"){const st=et.split(jC);switch(st[0]){case"v":i.vertices.push(parseFloat(st[1]),parseFloat(st[2]),parseFloat(st[3])),st.length>=7?(IE.setRGB(parseFloat(st[4]),parseFloat(st[5]),parseFloat(st[6])).convertSRGBToLinear(),i.colors.push(IE.r,IE.g,IE.b)):i.colors.push(void 0,void 0,void 0);break;case"vn":i.normals.push(parseFloat(st[1]),parseFloat(st[2]),parseFloat(st[3]));break;case"vt":i.uvs.push(parseFloat(st[1]),parseFloat(st[2]))}}else if(nt==="f"){const st=et.slice(1).trim().split(jC),at=[];for(let dt=0,mt=st.length;dt<mt;dt++){const yt=st[dt];if(yt.length>0){const wt=yt.split("/");at.push(wt)}}const ct=at[0];for(let dt=1,mt=at.length-1;dt<mt;dt++){const yt=at[dt],wt=at[dt+1];i.addFace(ct[0],yt[0],wt[0],ct[1],yt[1],wt[1],ct[2],yt[2],wt[2])}}else if(nt==="l"){const st=et.substring(1).trim().split(" ");let at=[];const ct=[];if(et.indexOf("/")===-1)at=st;else for(let dt=0,mt=st.length;dt<mt;dt++){const yt=st[dt].split("/");yt[0]!==""&&at.push(yt[0]),yt[1]!==""&&ct.push(yt[1])}i.addLineGeometry(at,ct)}else if(nt==="p"){const st=et.slice(1).trim().split(" ");i.addPointGeometry(st)}else if((o=bO.exec(et))!==null){const st=(" "+o[0].slice(1).trim()).slice(1);i.startObject(st)}else if(wO.test(et))i.object.startMaterial(et.substring(7).trim(),i.materialLibraries);else if(fP.test(et)){i.materialLibraries.push(et.substring(7).trim());const st=et.substring(7).trim(),at=this.manager.getHandler(st);if(at){const ct=await at.loadAsync(st).catch(dt=>{console.warn(dt)});ct&&this.setMaterials(ct)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(xO.test(et))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(nt==="s"){if(o=et.split(" "),o.length>1){const at=o[1].trim().toLowerCase();i.object.smooth=at!=="0"&&at!=="off"}else i.object.smooth=!0;const st=i.object.currentMaterial();st&&(st.smooth=i.object.smooth)}else{if(et==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+et+'"')}}i.finalize();const c=new g.ZAu;if(c.materialLibraries=[].concat(i.materialLibraries),!(i.objects.length===1&&i.objects[0].geometry.vertices.length===0))for(let _=0,j=i.objects.length;_<j;_++){const et=i.objects[_],nt=et.geometry,st=et.materials,at=nt.type==="Line",ct=nt.type==="Points";let dt=!1;if(nt.vertices.length===0)continue;const mt=new g.u9r;mt.setAttribute("position",new g.a$l(nt.vertices,3)),nt.normals.length>0&&mt.setAttribute("normal",new g.a$l(nt.normals,3)),nt.colors.length>0&&(dt=!0,mt.setAttribute("color",new g.a$l(nt.colors,3))),nt.hasUVIndices===!0&&mt.setAttribute("uv",new g.a$l(nt.uvs,2));const yt=[];for(let Ct=0,bt=st.length;Ct<bt;Ct++){const At=st[Ct],Pt=At.name+"_"+At.smooth+"_"+dt;let Dt=i.materials[Pt];if(this.materials!==null)if(Dt=await this.materials.create(At.name),!at||!Dt||Dt instanceof g.nls){if(ct&&Dt&&!(Dt instanceof g.UY4)){const Nt=new g.UY4({size:10,sizeAttenuation:!1});g.F5T.prototype.copy.call(Nt,Dt),Nt.color.copy(Dt.color),Nt.map=Dt.map,Dt=Nt}}else{const Nt=new g.nls;g.F5T.prototype.copy.call(Nt,Dt),Nt.color.copy(Dt.color),Dt=Nt}Dt===void 0&&(Dt=at?new g.nls:ct?new g.UY4({size:1,sizeAttenuation:!1}):new g.xoR,Dt.name=At.name,Dt.flatShading=!At.smooth,Dt.vertexColors=dt,i.materials[Pt]=Dt),yt.push(Dt)}let wt;if(yt.length>1){for(let Ct=0,bt=st.length;Ct<bt;Ct++){const At=st[Ct];mt.addGroup(At.groupStart,At.groupCount,Ct)}wt=at?new g.ejS(mt,yt):ct?new g.woe(mt,yt):new g.Kj0(mt,yt)}else wt=at?new g.ejS(mt,yt[0]):ct?new g.woe(mt,yt[0]):new g.Kj0(mt,yt[0]);wt.name=et.name,c.add(wt)}else if(i.vertices.length>0){const _=new g.UY4({size:1,sizeAttenuation:!1}),j=new g.u9r;j.setAttribute("position",new g.a$l(i.vertices,3)),i.colors.length>0&&i.colors[0]!==void 0&&(j.setAttribute("color",new g.a$l(i.colors,3)),_.vertexColors=!0);const et=new g.woe(j,_);c.add(et)}return c}}class zM extends b.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Fr],this._importer1=new eu(vP,["obj"],!0),this._importer2=new eu(pP,["mtl"],!1)}async onAdded(e){var i,s,o,c;(s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.push(this._importer1),(c=(o=e.getManager())==null?void 0:o.importer)==null||c.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){var i,s;(s=(i=e.getManager())==null?void 0:i.importer)!=null&&s.Importers&&(e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer1),1),e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer2),1))}}zM.PluginType="ObjMtlLoadPlugin";var VM=function(h){return URL.createObjectURL(new Blob([h],{type:"text/javascript"}))};try{URL.revokeObjectURL(VM(""))}catch{VM=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var Gm=Uint8Array,Em=Uint16Array,bA=Uint32Array,zC=new Gm([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),PE=new Gm([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),GM=new Gm([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yy=function(h,e){for(var i=new Em(31),s=0;s<31;++s)i[s]=e+=1<<h[s-1];var o=new bA(i[30]);for(s=1;s<30;++s)for(var c=i[s];c<i[s+1];++c)o[c]=c-i[s]<<5|s;return[i,o]},RE=yy(zC,2),VC=RE[0],HM=RE[1];VC[28]=258,HM[258]=28;for(var QM=yy(PE,0),EO=QM[0],yP=QM[1],GC=new Em(32768),cu=0;cu<32768;++cu){var Nw=(43690&cu)>>>1|(21845&cu)<<1;Nw=(61680&(Nw=(52428&Nw)>>>2|(13107&Nw)<<2))>>>4|(3855&Nw)<<4,GC[cu]=((65280&Nw)>>>8|(255&Nw)<<8)>>>1}var C0=function(h,e,i){for(var s=h.length,o=0,c=new Em(e);o<s;++o)++c[h[o]-1];var _,j=new Em(e);for(o=0;o<e;++o)j[o]=j[o-1]+c[o-1]<<1;if(i){_=new Em(1<<e);var et=15-e;for(o=0;o<s;++o)if(h[o])for(var nt=o<<4|h[o],st=e-h[o],at=j[h[o]-1]++<<st,ct=at|(1<<st)-1;at<=ct;++at)_[GC[at]>>>et]=nt}else for(_=new Em(s),o=0;o<s;++o)h[o]&&(_[o]=GC[j[h[o]-1]++]>>>15-h[o]);return _},wA=new Gm(288);for(cu=0;cu<144;++cu)wA[cu]=8;for(cu=144;cu<256;++cu)wA[cu]=9;for(cu=256;cu<280;++cu)wA[cu]=7;for(cu=280;cu<288;++cu)wA[cu]=8;var o1=new Gm(32);for(cu=0;cu<32;++cu)o1[cu]=5;var HC=C0(wA,9,0),AP=C0(wA,9,1),SO=C0(o1,5,0),QC=C0(o1,5,1),Su=function(h){for(var e=h[0],i=1;i<h.length;++i)h[i]>e&&(e=h[i]);return e},Qv=function(h,e,i){var s=e/8|0;return(h[s]|h[s+1]<<8)>>(7&e)&i},Ou=function(h,e){var i=e/8|0;return(h[i]|h[i+1]<<8|h[i+2]<<16)>>(7&e)},a1=function(h){return(h/8|0)+(7&h&&1)},bP=function(h,e,i){(e==null||e<0)&&(e=0),(i==null||i>h.length)&&(i=h.length);var s=new(h instanceof Em?Em:h instanceof bA?bA:Gm)(i-e);return s.set(h.subarray(e,i)),s},CO=function(h,e,i){var s=h.length;if(!s||i&&!i.l&&s<5)return e||new Gm(0);var o=!e||i,c=!i||i.i;i||(i={}),e||(e=new Gm(3*s));var _=function(Zr){var ds=e.length;if(Zr>ds){var Hs=new Gm(Math.max(2*ds,Zr));Hs.set(e),e=Hs}},j=i.f||0,et=i.p||0,nt=i.b||0,st=i.l,at=i.d,ct=i.m,dt=i.n,mt=8*s;do{if(!st){i.f=j=Qv(h,et,1);var yt=Qv(h,et+1,3);if(et+=3,!yt){var wt=h[(mn=a1(et)+4)-4]|h[mn-3]<<8,Ct=mn+wt;if(Ct>s){if(c)throw"unexpected EOF";break}o&&_(nt+wt),e.set(h.subarray(mn,Ct),nt),i.b=nt+=wt,i.p=et=8*Ct;continue}if(yt==1)st=AP,at=QC,ct=9,dt=5;else{if(yt!=2)throw"invalid block type";var bt=Qv(h,et,31)+257,At=Qv(h,et+10,15)+4,Pt=bt+Qv(h,et+5,31)+1;et+=14;for(var Dt=new Gm(Pt),Nt=new Gm(19),Vt=0;Vt<At;++Vt)Nt[GM[Vt]]=Qv(h,et+3*Vt,7);et+=3*At;var Zt=Su(Nt),an=(1<<Zt)-1,fn=C0(Nt,Zt,1);for(Vt=0;Vt<Pt;){var mn,Sn=fn[Qv(h,et,an)];if(et+=15&Sn,(mn=Sn>>>4)<16)Dt[Vt++]=mn;else{var An=0,wn=0;for(mn==16?(wn=3+Qv(h,et,3),et+=2,An=Dt[Vt-1]):mn==17?(wn=3+Qv(h,et,7),et+=3):mn==18&&(wn=11+Qv(h,et,127),et+=7);wn--;)Dt[Vt++]=An}}var Mn=Dt.subarray(0,bt),Pn=Dt.subarray(bt);ct=Su(Mn),dt=Su(Pn),st=C0(Mn,ct,1),at=C0(Pn,dt,1)}if(et>mt){if(c)throw"unexpected EOF";break}}o&&_(nt+131072);for(var On=(1<<ct)-1,er=(1<<dt)-1,Zn=et;;Zn=et){var yr=(An=st[Ou(h,et)&On])>>>4;if((et+=15&An)>mt){if(c)throw"unexpected EOF";break}if(!An)throw"invalid length/literal";if(yr<256)e[nt++]=yr;else{if(yr==256){Zn=et,st=null;break}var lr=yr-254;if(yr>264){var ar=zC[Vt=yr-257];lr=Qv(h,et,(1<<ar)-1)+VC[Vt],et+=ar}var Mr=at[Ou(h,et)&er],xr=Mr>>>4;if(!Mr)throw"invalid distance";if(et+=15&Mr,Pn=EO[xr],xr>3&&(ar=PE[xr],Pn+=Ou(h,et)&(1<<ar)-1,et+=ar),et>mt){if(c)throw"unexpected EOF";break}o&&_(nt+131072);for(var qr=nt+lr;nt<qr;nt+=4)e[nt]=e[nt-Pn],e[nt+1]=e[nt+1-Pn],e[nt+2]=e[nt+2-Pn],e[nt+3]=e[nt+3-Pn];nt=qr}}i.l=st,i.p=Zn,i.b=nt,st&&(j=1,i.m=ct,i.d=at,i.n=dt)}while(!j);return nt==e.length?e:bP(e,0,nt)},Ay=function(h,e,i){i<<=7&e;var s=e/8|0;h[s]|=i,h[s+1]|=i>>>8},l1=function(h,e,i){i<<=7&e;var s=e/8|0;h[s]|=i,h[s+1]|=i>>>8,h[s+2]|=i>>>16},c1=function(h,e){for(var i=[],s=0;s<h.length;++s)h[s]&&i.push({s,f:h[s]});var o=i.length,c=i.slice();if(!o)return[WM,0];if(o==1){var _=new Gm(i[0].s+1);return _[i[0].s]=1,[_,1]}i.sort(function(Dt,Nt){return Dt.f-Nt.f}),i.push({s:-1,f:25001});var j=i[0],et=i[1],nt=0,st=1,at=2;for(i[0]={s:-1,f:j.f+et.f,l:j,r:et};st!=o-1;)j=i[i[nt].f<i[at].f?nt++:at++],et=i[nt!=st&&i[nt].f<i[at].f?nt++:at++],i[st++]={s:-1,f:j.f+et.f,l:j,r:et};var ct=c[0].s;for(s=1;s<o;++s)c[s].s>ct&&(ct=c[s].s);var dt=new Em(ct+1),mt=DE(i[st-1],dt,0);if(mt>e){s=0;var yt=0,wt=mt-e,Ct=1<<wt;for(c.sort(function(Dt,Nt){return dt[Nt.s]-dt[Dt.s]||Dt.f-Nt.f});s<o;++s){var bt=c[s].s;if(!(dt[bt]>e))break;yt+=Ct-(1<<mt-dt[bt]),dt[bt]=e}for(yt>>>=wt;yt>0;){var At=c[s].s;dt[At]<e?yt-=1<<e-dt[At]++-1:++s}for(;s>=0&&yt;--s){var Pt=c[s].s;dt[Pt]==e&&(--dt[Pt],++yt)}mt=e}return[new Gm(dt),mt]},DE=function(h,e,i){return h.s==-1?Math.max(DE(h.l,e,i+1),DE(h.r,e,i+1)):e[h.s]=i},wP=function(h){for(var e=h.length;e&&!h[--e];);for(var i=new Em(++e),s=0,o=h[0],c=1,_=function(et){i[s++]=et},j=1;j<=e;++j)if(h[j]==o&&j!=e)++c;else{if(!o&&c>2){for(;c>138;c-=138)_(32754);c>2&&(_(c>10?c-11<<5|28690:c-3<<5|12305),c=0)}else if(c>3){for(_(o),--c;c>6;c-=6)_(8304);c>2&&(_(c-3<<5|8208),c=0)}for(;c--;)_(o);c=1,o=h[j]}return[i.subarray(0,s),e]},kE=function(h,e){for(var i=0,s=0;s<e.length;++s)i+=h[s]*e[s];return i},WC=function(h,e,i){var s=i.length,o=a1(e+2);h[o]=255&s,h[o+1]=s>>>8,h[o+2]=255^h[o],h[o+3]=255^h[o+1];for(var c=0;c<s;++c)h[o+c+4]=i[c];return 8*(o+4+s)},xP=function(h,e,i,s,o,c,_,j,et,nt,st){Ay(e,st++,i),++o[256];for(var at=c1(o,15),ct=at[0],dt=at[1],mt=c1(c,15),yt=mt[0],wt=mt[1],Ct=wP(ct),bt=Ct[0],At=Ct[1],Pt=wP(yt),Dt=Pt[0],Nt=Pt[1],Vt=new Em(19),Zt=0;Zt<bt.length;++Zt)Vt[31&bt[Zt]]++;for(Zt=0;Zt<Dt.length;++Zt)Vt[31&Dt[Zt]]++;for(var an=c1(Vt,7),fn=an[0],mn=an[1],Sn=19;Sn>4&&!fn[GM[Sn-1]];--Sn);var An,wn,Mn,Pn,On=nt+5<<3,er=kE(o,wA)+kE(c,o1)+_,Zn=kE(o,ct)+kE(c,yt)+_+14+3*Sn+kE(Vt,fn)+(2*Vt[16]+3*Vt[17]+7*Vt[18]);if(On<=er&&On<=Zn)return WC(e,st,h.subarray(et,et+nt));if(Ay(e,st,1+(Zn<er)),st+=2,Zn<er){An=C0(ct,dt,0),wn=ct,Mn=C0(yt,wt,0),Pn=yt;var yr=C0(fn,mn,0);for(Ay(e,st,At-257),Ay(e,st+5,Nt-1),Ay(e,st+10,Sn-4),st+=14,Zt=0;Zt<Sn;++Zt)Ay(e,st+3*Zt,fn[GM[Zt]]);st+=3*Sn;for(var lr=[bt,Dt],ar=0;ar<2;++ar){var Mr=lr[ar];for(Zt=0;Zt<Mr.length;++Zt){var xr=31&Mr[Zt];Ay(e,st,yr[xr]),st+=fn[xr],xr>15&&(Ay(e,st,Mr[Zt]>>>5&127),st+=Mr[Zt]>>>12)}}}else An=HC,wn=wA,Mn=SO,Pn=o1;for(Zt=0;Zt<j;++Zt)if(s[Zt]>255){xr=s[Zt]>>>18&31,l1(e,st,An[xr+257]),st+=wn[xr+257],xr>7&&(Ay(e,st,s[Zt]>>>23&31),st+=zC[xr]);var qr=31&s[Zt];l1(e,st,Mn[qr]),st+=Pn[qr],qr>3&&(l1(e,st,s[Zt]>>>5&8191),st+=PE[qr])}else l1(e,st,An[s[Zt]]),st+=wn[s[Zt]];return l1(e,st,An[256]),st+wn[256]},TO=new bA([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),WM=new Gm(0),MO=function(){var h=1,e=0;return{p:function(i){for(var s=h,o=e,c=i.length,_=0;_!=c;){for(var j=Math.min(_+2655,c);_<j;++_)o+=s+=i[_];s=(65535&s)+15*(s>>16),o=(65535&o)+15*(o>>16)}h=s,e=o},d:function(){return(255&(h%=65521))<<24|h>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},IO=function(h,e,i,s,o){return function(c,_,j,et,nt,st){var at=c.length,ct=new Gm(et+at+5*(1+Math.ceil(at/7e3))+nt),dt=ct.subarray(et,ct.length-nt),mt=0;if(!_||at<8)for(var yt=0;yt<=at;yt+=65535){var wt=yt+65535;wt<at?mt=WC(dt,mt,c.subarray(yt,wt)):(dt[yt]=st,mt=WC(dt,mt,c.subarray(yt,at)))}else{for(var Ct=TO[_-1],bt=Ct>>>13,At=8191&Ct,Pt=(1<<j)-1,Dt=new Em(32768),Nt=new Em(Pt+1),Vt=Math.ceil(j/3),Zt=2*Vt,an=function(io){return(c[io]^c[io+1]<<Vt^c[io+2]<<Zt)&Pt},fn=new bA(25e3),mn=new Em(288),Sn=new Em(32),An=0,wn=0,Mn=(yt=0,0),Pn=0,On=0;yt<at;++yt){var er=an(yt),Zn=32767&yt,yr=Nt[er];if(Dt[Zn]=yr,Nt[er]=Zn,Pn<=yt){var lr=at-yt;if((An>7e3||Mn>24576)&&lr>423){mt=xP(c,dt,0,fn,mn,Sn,wn,Mn,On,yt-On,mt),Mn=An=wn=0,On=yt;for(var ar=0;ar<286;++ar)mn[ar]=0;for(ar=0;ar<30;++ar)Sn[ar]=0}var Mr=2,xr=0,qr=At,Zr=Zn-yr&32767;if(lr>2&&er==an(yt-Zr))for(var ds=Math.min(bt,lr)-1,Hs=Math.min(32767,yt),Ps=Math.min(258,lr);Zr<=Hs&&--qr&&Zn!=yr;){if(c[yt+Mr]==c[yt+Mr-Zr]){for(var Os=0;Os<Ps&&c[yt+Os]==c[yt+Os-Zr];++Os);if(Os>Mr){if(Mr=Os,xr=Zr,Os>ds)break;var gr=Math.min(Zr,Os-2),kr=0;for(ar=0;ar<gr;++ar){var $r=yt-Zr+ar+32768&32767,co=$r-Dt[$r]+32768&32767;co>kr&&(kr=co,yr=$r)}}}Zr+=(Zn=yr)-(yr=Dt[Zn])+32768&32767}if(xr){fn[Mn++]=268435456|HM[Mr]<<18|yP[xr];var Do=31&HM[Mr],_o=31&yP[xr];wn+=zC[Do]+PE[_o],++mn[257+Do],++Sn[_o],Pn=yt+Mr,++An}else fn[Mn++]=c[yt],++mn[c[yt]]}}mt=xP(c,dt,st,fn,mn,Sn,wn,Mn,On,yt-On,mt),!st&&7&mt&&(mt=WC(dt,mt+1,WM))}return bP(ct,0,et+a1(mt)+nt)}(h,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(h.length)))):12+e.mem,i,s,!o)},PO=function(h,e,i){for(;i;++e)h[e]=i,i>>>=8},RO=function(h,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;h[0]=120,h[1]=s<<6|(s?32-2*s:1)},DO=function(h){if((15&h[0])!=8||h[0]>>>4>7||(h[0]<<8|h[1])%31)throw"invalid zlib data";if(32&h[1])throw"invalid zlib data: preset dictionaries not supported"};function OE(h,e){return CO((DO(h),h.subarray(2,-4)),e)}var kO=typeof TextDecoder<"u"&&new TextDecoder;try{kO.decode(WM,{stream:!0})}catch{}function EP(h,e,i){const s=i.length-h-1;if(e>=i[s])return s-1;if(e<=i[h])return h;let o=h,c=s,_=Math.floor((o+c)/2);for(;e<i[_]||e>=i[_+1];)e<i[_]?c=_:o=_,_=Math.floor((o+c)/2);return _}function OO(h,e){let i=1;for(let o=2;o<=h;++o)i*=o;let s=1;for(let o=2;o<=e;++o)s*=o;for(let o=2;o<=h-e;++o)s*=o;return i/s}class BO extends g.Hyl{constructor(e,i,s,o,c){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=o||0,this.endKnot=c||this.knots.length-1;for(let _=0;_<s.length;++_){const j=s[_];this.controlPoints[_]=new g.Ltg(j.x,j.y,j.z,j.w)}}getPoint(e,i=new g.Pa4){const s=i,o=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),c=function(_,j,et,nt){const st=EP(_,nt,j),at=function(dt,mt,yt,wt){const Ct=[],bt=[],At=[];Ct[0]=1;for(let Pt=1;Pt<=yt;++Pt){bt[Pt]=mt-wt[dt+1-Pt],At[Pt]=wt[dt+Pt]-mt;let Dt=0;for(let Nt=0;Nt<Pt;++Nt){const Vt=At[Nt+1],Zt=bt[Pt-Nt],an=Ct[Nt]/(Vt+Zt);Ct[Nt]=Dt+Vt*an,Dt=Zt*an}Ct[Pt]=Dt}return Ct}(st,nt,_,j),ct=new g.Ltg(0,0,0,0);for(let dt=0;dt<=_;++dt){const mt=et[st-_+dt],yt=at[dt],wt=mt.w*yt;ct.x+=mt.x*wt,ct.y+=mt.y*wt,ct.z+=mt.z*wt,ct.w+=mt.w*yt}return ct}(this.degree,this.knots,this.controlPoints,o);return c.w!==1&&c.divideScalar(c.w),s.set(c.x,c.y,c.z)}getTangent(e,i=new g.Pa4){const s=i,o=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),c=function(_,j,et,nt,st){const at=function(ct,dt,mt,yt,wt){const Ct=wt<ct?wt:ct,bt=[],At=EP(ct,yt,dt),Pt=function(Nt,Vt,Zt,an,fn){const mn=[];for(let On=0;On<=Zt;++On)mn[On]=0;const Sn=[];for(let On=0;On<=an;++On)Sn[On]=mn.slice(0);const An=[];for(let On=0;On<=Zt;++On)An[On]=mn.slice(0);An[0][0]=1;const wn=mn.slice(0),Mn=mn.slice(0);for(let On=1;On<=Zt;++On){wn[On]=Vt-fn[Nt+1-On],Mn[On]=fn[Nt+On]-Vt;let er=0;for(let Zn=0;Zn<On;++Zn){const yr=Mn[Zn+1],lr=wn[On-Zn];An[On][Zn]=yr+lr;const ar=An[Zn][On-1]/An[On][Zn];An[Zn][On]=er+yr*ar,er=lr*ar}An[On][On]=er}for(let On=0;On<=Zt;++On)Sn[0][On]=An[On][Zt];for(let On=0;On<=Zt;++On){let er=0,Zn=1;const yr=[];for(let lr=0;lr<=Zt;++lr)yr[lr]=mn.slice(0);yr[0][0]=1;for(let lr=1;lr<=an;++lr){let ar=0;const Mr=On-lr,xr=Zt-lr;On>=lr&&(yr[Zn][0]=yr[er][0]/An[xr+1][Mr],ar=yr[Zn][0]*An[Mr][xr]);const qr=On-1<=xr?lr-1:Zt-On;for(let ds=Mr>=-1?1:-Mr;ds<=qr;++ds)yr[Zn][ds]=(yr[er][ds]-yr[er][ds-1])/An[xr+1][Mr+ds],ar+=yr[Zn][ds]*An[Mr+ds][xr];On<=xr&&(yr[Zn][lr]=-yr[er][lr-1]/An[xr+1][On],ar+=yr[Zn][lr]*An[On][xr]),Sn[lr][On]=ar;const Zr=er;er=Zn,Zn=Zr}}let Pn=Zt;for(let On=1;On<=an;++On){for(let er=0;er<=Zt;++er)Sn[On][er]*=Pn;Pn*=Zt-On}return Sn}(At,yt,ct,Ct,dt),Dt=[];for(let Nt=0;Nt<mt.length;++Nt){const Vt=mt[Nt].clone(),Zt=Vt.w;Vt.x*=Zt,Vt.y*=Zt,Vt.z*=Zt,Dt[Nt]=Vt}for(let Nt=0;Nt<=Ct;++Nt){const Vt=Dt[At-ct].clone().multiplyScalar(Pt[Nt][0]);for(let Zt=1;Zt<=ct;++Zt)Vt.add(Dt[At-ct+Zt].clone().multiplyScalar(Pt[Nt][Zt]));bt[Nt]=Vt}for(let Nt=Ct+1;Nt<=wt+1;++Nt)bt[Nt]=new g.Ltg(0,0,0);return bt}(_,j,et,nt,st);return function(ct){const dt=ct.length,mt=[],yt=[];for(let Ct=0;Ct<dt;++Ct){const bt=ct[Ct];mt[Ct]=new g.Pa4(bt.x,bt.y,bt.z),yt[Ct]=bt.w}const wt=[];for(let Ct=0;Ct<dt;++Ct){const bt=mt[Ct].clone();for(let At=1;At<=Ct;++At)bt.sub(wt[Ct-At].clone().multiplyScalar(OO(Ct,At)*yt[At]));wt[Ct]=bt.divideScalar(yt[0])}return wt}(at)}(this.degree,this.knots,this.controlPoints,o,1);return s.copy(c[1]).normalize(),s}}let qo,Wu,Hm;class LO extends g.aNw{constructor(e){super(e)}load(e,i,s,o){const c=this,_=c.path===""?g.Zp0.extractUrlBase(e):c.path,j=new g.hH6(this.manager);j.setPath(c.path),j.setResponseType("arraybuffer"),j.setRequestHeader(c.requestHeader),j.setWithCredentials(c.withCredentials),j.load(e,function(et){try{i(c.parse(et,_))}catch(nt){o?o(nt):console.error(nt),c.manager.itemError(e)}},s,o)}parse(e,i){if(function(c){const _="Kaydara FBX Binary  \0";return c.byteLength>=_.length&&_===zt(c,0,_.length)}(e))qo=new _e().parse(e);else{const c=zt(e);if(!function(_){const j=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let et=0;function nt(st){const at=_[st-1];return _=_.slice(et+st),et++,at}for(let st=0;st<j.length;++st)if(nt(1)===j[st])return!1;return!0}(c))throw new Error("THREE.FBXLoader: Unknown format.");if(lt(c)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+lt(c));qo=new a().parse(c)}const s=new g.dpR(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin),o=new NO(s,this.manager).parse(qo);return qo=null,Wu=null,Hm=null,o}}class NO{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){Wu=this.parseConnections();const e=this.parseImages(),i=this.parseTextures(e),s=this.parseMaterials(i),o=this.parseDeformers(),c=new UO().parse(o);return this.parseScene(o,c,s),Hm}parseConnections(){const e=new Map;return"Connections"in qo&&qo.Connections.connections.forEach(function(i){const s=i[0],o=i[1],c=i[2];e.has(s)||e.set(s,{parents:[],children:[]});const _={ID:o,relationship:c};e.get(s).parents.push(_),e.has(o)||e.set(o,{parents:[],children:[]});const j={ID:s,relationship:c};e.get(o).children.push(j)}),e}parseImages(){const e={},i={};if("Video"in qo.Objects){const s=qo.Objects.Video;for(const o in s){const c=s[o];if(e[parseInt(o)]=c.RelativeFilename||c.Filename,"Content"in c){const _=c.Content instanceof ArrayBuffer&&c.Content.byteLength>0,j=typeof c.Content=="string"&&c.Content!=="";if(_||j){const et=this.parseImage(s[o]);i[c.RelativeFilename||c.Filename]=et}}}}for(const s in e){const o=e[s];i[o]!==void 0?e[s]=i[o]:e[s]=e[s].split("\\").pop()}return e}parseImage(e){const i=e.Content,s=e.RelativeFilename||e.Filename,o=s.slice(s.lastIndexOf(".")+1).toLowerCase();let c;switch(o){case"bmp":c="image/bmp";break;case"jpg":case"jpeg":c="image/jpeg";break;case"png":c="image/png";break;case"tif":c="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",s),c="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+o+'" is not supported.')}if(typeof i=="string")return"data:"+c+";base64,"+i;{const _=new Uint8Array(i);return window.URL.createObjectURL(new Blob([_],{type:c}))}}parseTextures(e){const i=new Map;if("Texture"in qo.Objects){const s=qo.Objects.Texture;for(const o in s){const c=this.parseTexture(s[o],e);i.set(parseInt(o),c)}}return i}parseTexture(e,i){const s=this.loadTexture(e,i);s.ID=e.id,s.name=e.attrName;const o=e.WrapModeU,c=e.WrapModeV,_=o!==void 0?o.value:0,j=c!==void 0?c.value:0;if(s.wrapS=_===0?g.rpg:g.uWy,s.wrapT=j===0?g.rpg:g.uWy,"Scaling"in e){const et=e.Scaling.value;s.repeat.x=et[0],s.repeat.y=et[1]}if("Translation"in e){const et=e.Translation.value;s.offset.x=et[0],s.offset.y=et[1]}return s}loadTexture(e,i){let s;const o=this.textureLoader.path,c=Wu.get(e.id).children;let _;c!==void 0&&c.length>0&&i[c[0].ID]!==void 0&&(s=i[c[0].ID],s.indexOf("blob:")!==0&&s.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const j=e.FileName.slice(-3).toLowerCase();if(j==="tga"){const et=this.manager.getHandler(".tga");et===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),_=new g.xEZ):(et.setPath(this.textureLoader.path),_=et.load(s))}else j==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),_=new g.xEZ):_=this.textureLoader.load(s);return this.textureLoader.setPath(o),_}parseMaterials(e){const i=new Map;if("Material"in qo.Objects){const s=qo.Objects.Material;for(const o in s){const c=this.parseMaterial(s[o],e);c!==null&&i.set(parseInt(o),c)}}return i}parseMaterial(e,i){const s=e.id,o=e.attrName;let c=e.ShadingModel;if(typeof c=="object"&&(c=c.value),!Wu.has(s))return null;const _=this.parseParameters(e,i,s);let j;switch(c.toLowerCase()){case"phong":j=new g.xoR;break;case"lambert":j=new g.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',c),j=new g.xoR}return j.setValues(_),j.name=o,j}parseParameters(e,i,s){const o={};e.BumpFactor&&(o.bumpScale=e.BumpFactor.value),e.Diffuse?o.color=new g.Ilk().fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(o.color=new g.Ilk().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(o.displacementScale=e.DisplacementFactor.value),e.Emissive?o.emissive=new g.Ilk().fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(o.emissive=new g.Ilk().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(o.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(o.opacity=parseFloat(e.Opacity.value)),o.opacity<1&&(o.transparent=!0),e.ReflectionFactor&&(o.reflectivity=e.ReflectionFactor.value),e.Shininess&&(o.shininess=e.Shininess.value),e.Specular?o.specular=new g.Ilk().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(o.specular=new g.Ilk().fromArray(e.SpecularColor.value).convertSRGBToLinear());const c=this;return Wu.get(s).children.forEach(function(_){const j=_.relationship;switch(j){case"Bump":o.bumpMap=c.getTexture(i,_.ID);break;case"Maya|TEX_ao_map":o.aoMap=c.getTexture(i,_.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":o.map=c.getTexture(i,_.ID),o.map!==void 0&&(o.map.colorSpace=g.KI_);break;case"DisplacementColor":o.displacementMap=c.getTexture(i,_.ID);break;case"EmissiveColor":o.emissiveMap=c.getTexture(i,_.ID),o.emissiveMap!==void 0&&(o.emissiveMap.colorSpace=g.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":o.normalMap=c.getTexture(i,_.ID);break;case"ReflectionColor":o.envMap=c.getTexture(i,_.ID),o.envMap!==void 0&&(o.envMap.mapping=g.dSO,o.envMap.colorSpace=g.KI_);break;case"SpecularColor":o.specularMap=c.getTexture(i,_.ID),o.specularMap!==void 0&&(o.specularMap.colorSpace=g.KI_);break;case"TransparentColor":case"TransparencyFactor":o.alphaMap=c.getTexture(i,_.ID),o.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",j)}}),o}getTexture(e,i){return"LayeredTexture"in qo.Objects&&i in qo.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=Wu.get(i).children[0].ID),e.get(i)}parseDeformers(){const e={},i={};if("Deformer"in qo.Objects){const s=qo.Objects.Deformer;for(const o in s){const c=s[o],_=Wu.get(parseInt(o));if(c.attrType==="Skin"){const j=this.parseSkeleton(_,s);j.ID=o,_.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),j.geometryID=_.parents[0].ID,e[o]=j}else if(c.attrType==="BlendShape"){const j={id:o};j.rawTargets=this.parseMorphTargets(_,s),j.id=o,_.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[o]=j}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){const s=[];return e.children.forEach(function(o){const c=i[o.ID];if(c.attrType!=="Cluster")return;const _={ID:o.ID,indices:[],weights:[],transformLink:new g.yGw().fromArray(c.TransformLink.a)};"Indexes"in c&&(_.indices=c.Indexes.a,_.weights=c.Weights.a),s.push(_)}),{rawBones:s,bones:[]}}parseMorphTargets(e,i){const s=[];for(let o=0;o<e.children.length;o++){const c=e.children[o],_=i[c.ID],j={name:_.attrName,initialWeight:_.DeformPercent,id:_.id,fullWeights:_.FullWeights.a};if(_.attrType!=="BlendShapeChannel")return;j.geoID=Wu.get(parseInt(c.ID)).children.filter(function(et){return et.relationship===void 0})[0].ID,s.push(j)}return s}parseScene(e,i,s){Hm=new g.ZAu;const o=this.parseModels(e.skeletons,i,s),c=qo.Objects.Model,_=this;o.forEach(function(et){const nt=c[et.ID];_.setLookAtProperties(et,nt),Wu.get(et.ID).parents.forEach(function(st){const at=o.get(st.ID);at!==void 0&&at.add(et)}),et.parent===null&&Hm.add(et)}),this.bindSkeleton(e.skeletons,i,o),this.createAmbientLight(),Hm.traverse(function(et){if(et.userData.transformData){et.parent&&(et.userData.transformData.parentMatrix=et.parent.matrix,et.userData.transformData.parentMatrixWorld=et.parent.matrixWorld);const nt=Bt(et.userData.transformData);et.applyMatrix4(nt),et.updateWorldMatrix()}});const j=new pt().parse();Hm.children.length===1&&Hm.children[0].isGroup&&(Hm.children[0].animations=j,Hm=Hm.children[0]),Hm.animations=j}parseModels(e,i,s){const o=new Map,c=qo.Objects.Model;for(const _ in c){const j=parseInt(_),et=c[_],nt=Wu.get(j);let st=this.buildSkeleton(nt,e,j,et.attrName);if(!st){switch(et.attrType){case"Camera":st=this.createCamera(nt);break;case"Light":st=this.createLight(nt);break;case"Mesh":st=this.createMesh(nt,i,s);break;case"NurbsCurve":st=this.createCurve(nt,i);break;case"LimbNode":case"Root":st=new g.N$j;break;default:st=new g.ZAu}st.name=et.attrName?g.iUV.sanitizeNodeName(et.attrName):"",st.ID=j}this.getTransformData(st,et),o.set(j,st)}return o}buildSkeleton(e,i,s,o){let c=null;return e.parents.forEach(function(_){for(const j in i){const et=i[j];et.rawBones.forEach(function(nt,st){if(nt.ID===_.ID){const at=c;c=new g.N$j,c.matrixWorld.copy(nt.transformLink),c.name=o?g.iUV.sanitizeNodeName(o):"",c.ID=s,et.bones[st]=c,at!==null&&c.add(at)}})}}),c}createCamera(e){let i,s;if(e.children.forEach(function(o){const c=qo.Objects.NodeAttribute[o.ID];c!==void 0&&(s=c)}),s===void 0)i=new g.Tme;else{let o=0;s.CameraProjectionType!==void 0&&s.CameraProjectionType.value===1&&(o=1);let c=1;s.NearPlane!==void 0&&(c=s.NearPlane.value/1e3);let _=1e3;s.FarPlane!==void 0&&(_=s.FarPlane.value/1e3);let j=window.innerWidth,et=window.innerHeight;s.AspectWidth!==void 0&&s.AspectHeight!==void 0&&(j=s.AspectWidth.value,et=s.AspectHeight.value);const nt=j/et;let st=45;s.FieldOfView!==void 0&&(st=s.FieldOfView.value);const at=s.FocalLength?s.FocalLength.value:null;switch(o){case 0:i=new g.cPb(st,nt,c,_),at!==null&&i.setFocalLength(at);break;case 1:i=new g.iKG(-j/2,j/2,et/2,-et/2,c,_);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+o+"."),i=new g.Tme}}return i}createLight(e){let i,s;if(e.children.forEach(function(o){const c=qo.Objects.NodeAttribute[o.ID];c!==void 0&&(s=c)}),s===void 0)i=new g.Tme;else{let o;o=s.LightType===void 0?0:s.LightType.value;let c=16777215;s.Color!==void 0&&(c=new g.Ilk().fromArray(s.Color.value).convertSRGBToLinear());let _=s.Intensity===void 0?1:s.Intensity.value/100;s.CastLightOnObject!==void 0&&s.CastLightOnObject.value===0&&(_=0);let j=0;s.FarAttenuationEnd!==void 0&&(j=s.EnableFarAttenuation!==void 0&&s.EnableFarAttenuation.value===0?0:s.FarAttenuationEnd.value);const et=1;switch(o){case 0:i=new g.cek(c,_,j,et);break;case 1:i=new g.Ox3(c,_);break;case 2:let nt=Math.PI/3;s.InnerAngle!==void 0&&(nt=g.M8C.degToRad(s.InnerAngle.value));let st=0;s.OuterAngle!==void 0&&(st=g.M8C.degToRad(s.OuterAngle.value),st=Math.max(st,1)),i=new g.PMe(c,_,j,nt,st,et);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),i=new g.cek(c,_)}s.CastShadows!==void 0&&s.CastShadows.value===1&&(i.castShadow=!0)}return i}createMesh(e,i,s){let o,c=null,_=null;const j=[];return e.children.forEach(function(et){i.has(et.ID)&&(c=i.get(et.ID)),s.has(et.ID)&&j.push(s.get(et.ID))}),j.length>1?_=j:j.length>0?_=j[0]:(_=new g.xoR({color:13421772}),j.push(_)),"color"in c.attributes&&j.forEach(function(et){et.vertexColors=!0}),c.FBX_Deformer?(o=new g.TUv(c,_),o.normalizeSkinWeights()):o=new g.Kj0(c,_),o}createCurve(e,i){const s=e.children.reduce(function(c,_){return i.has(_.ID)&&(c=i.get(_.ID)),c},null),o=new g.nls({color:3342591,linewidth:1});return new g.x12(s,o)}getTransformData(e,i){const s={};"InheritType"in i&&(s.inheritType=parseInt(i.InheritType.value)),s.eulerOrder="RotationOrder"in i?Ot(i.RotationOrder.value):"ZYX","Lcl_Translation"in i&&(s.translation=i.Lcl_Translation.value),"PreRotation"in i&&(s.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(s.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(s.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(s.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(s.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(s.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(s.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(s.rotationPivot=i.RotationPivot.value),e.userData.transformData=s}setLookAtProperties(e,i){"LookAtProperty"in i&&Wu.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const o=qo.Objects.Model[s.ID];if("Lcl_Translation"in o){const c=o.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(c),Hm.add(e.target)):e.lookAt(new g.Pa4().fromArray(c))}}})}bindSkeleton(e,i,s){const o=this.parsePoseNodes();for(const c in e){const _=e[c];Wu.get(parseInt(_.ID)).parents.forEach(function(j){if(i.has(j.ID)){const et=j.ID;Wu.get(et).parents.forEach(function(nt){s.has(nt.ID)&&s.get(nt.ID).bind(new g.OdW(_.bones),o[nt.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in qo.Objects){const i=qo.Objects.Pose;for(const s in i)if(i[s].attrType==="BindPose"&&i[s].NbPoseNodes>0){const o=i[s].PoseNode;Array.isArray(o)?o.forEach(function(c){e[c.Node]=new g.yGw().fromArray(c.Matrix.a)}):e[o.Node]=new g.yGw().fromArray(o.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in qo&&"AmbientColor"in qo.GlobalSettings){const e=qo.GlobalSettings.AmbientColor.value,i=e[0],s=e[1],o=e[2];if(i!==0||s!==0||o!==0){const c=new g.Ilk(i,s,o).convertSRGBToLinear();Hm.add(new g.Mig(c,1))}}}}class UO{constructor(){this.negativeMaterialIndices=!1}parse(e){const i=new Map;if("Geometry"in qo.Objects){const s=qo.Objects.Geometry;for(const o in s){const c=Wu.get(parseInt(o)),_=this.parseGeometry(c,s[o],e);i.set(parseInt(o),_)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),i}parseGeometry(e,i,s){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,s);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,s){const o=s.skeletons,c=[],_=e.parents.map(function(at){return qo.Objects.Model[at.ID]});if(_.length===0)return;const j=e.children.reduce(function(at,ct){return o[ct.ID]!==void 0&&(at=o[ct.ID]),at},null);e.children.forEach(function(at){s.morphTargets[at.ID]!==void 0&&c.push(s.morphTargets[at.ID])});const et=_[0],nt={};"RotationOrder"in et&&(nt.eulerOrder=Ot(et.RotationOrder.value)),"InheritType"in et&&(nt.inheritType=parseInt(et.InheritType.value)),"GeometricTranslation"in et&&(nt.translation=et.GeometricTranslation.value),"GeometricRotation"in et&&(nt.rotation=et.GeometricRotation.value),"GeometricScaling"in et&&(nt.scale=et.GeometricScaling.value);const st=Bt(nt);return this.genGeometry(i,j,c,st)}genGeometry(e,i,s,o){const c=new g.u9r;e.attrName&&(c.name=e.attrName);const _=this.parseGeoNode(e,i),j=this.genBuffers(_),et=new g.a$l(j.vertex,3);if(et.applyMatrix4(o),c.setAttribute("position",et),j.colors.length>0&&c.setAttribute("color",new g.a$l(j.colors,3)),i&&(c.setAttribute("skinIndex",new g.qlB(j.weightsIndices,4)),c.setAttribute("skinWeight",new g.a$l(j.vertexWeights,4)),c.FBX_Deformer=i),j.normal.length>0){const nt=new g.Vkp().getNormalMatrix(o),st=new g.a$l(j.normal,3);st.applyNormalMatrix(nt),c.setAttribute("normal",st)}if(j.uvs.forEach(function(nt,st){const at=st===0?"uv":`uv${st}`;c.setAttribute(at,new g.a$l(j.uvs[st],2))}),_.material&&_.material.mappingType!=="AllSame"){let nt=j.materialIndex[0],st=0;if(j.materialIndex.forEach(function(at,ct){at!==nt&&(c.addGroup(st,ct-st,nt),nt=at,st=ct)}),c.groups.length>0){const at=c.groups[c.groups.length-1],ct=at.start+at.count;ct!==j.materialIndex.length&&c.addGroup(ct,j.materialIndex.length-ct,nt)}c.groups.length===0&&c.addGroup(0,j.materialIndex.length,j.materialIndex[0])}return this.addMorphTargets(c,e,s,o),c}parseGeoNode(e,i){const s={};if(s.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],s.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(s.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(s.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(s.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){s.uv=[];let o=0;for(;e.LayerElementUV[o];)e.LayerElementUV[o].UV&&s.uv.push(this.parseUVs(e.LayerElementUV[o])),o++}return s.weightTable={},i!==null&&(s.skeleton=i,i.rawBones.forEach(function(o,c){o.indices.forEach(function(_,j){s.weightTable[_]===void 0&&(s.weightTable[_]=[]),s.weightTable[_].push({id:c,weight:o.weights[j]})})})),s}genBuffers(e){const i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let s=0,o=0,c=!1,_=[],j=[],et=[],nt=[],st=[],at=[];const ct=this;return e.vertexIndices.forEach(function(dt,mt){let yt,wt=!1;dt<0&&(dt^=-1,wt=!0);let Ct=[],bt=[];if(_.push(3*dt,3*dt+1,3*dt+2),e.color){const At=St(mt,s,dt,e.color);et.push(At[0],At[1],At[2])}if(e.skeleton){if(e.weightTable[dt]!==void 0&&e.weightTable[dt].forEach(function(At){bt.push(At.weight),Ct.push(At.id)}),bt.length>4){c||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),c=!0);const At=[0,0,0,0],Pt=[0,0,0,0];bt.forEach(function(Dt,Nt){let Vt=Dt,Zt=Ct[Nt];Pt.forEach(function(an,fn,mn){if(Vt>an){mn[fn]=Vt,Vt=an;const Sn=At[fn];At[fn]=Zt,Zt=Sn}})}),Ct=At,bt=Pt}for(;bt.length<4;)bt.push(0),Ct.push(0);for(let At=0;At<4;++At)st.push(bt[At]),at.push(Ct[At])}if(e.normal){const At=St(mt,s,dt,e.normal);j.push(At[0],At[1],At[2])}e.material&&e.material.mappingType!=="AllSame"&&(yt=St(mt,s,dt,e.material)[0],yt<0&&(ct.negativeMaterialIndices=!0,yt=0)),e.uv&&e.uv.forEach(function(At,Pt){const Dt=St(mt,s,dt,At);nt[Pt]===void 0&&(nt[Pt]=[]),nt[Pt].push(Dt[0]),nt[Pt].push(Dt[1])}),o++,wt&&(o>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),ct.genFace(i,e,_,yt,j,et,nt,st,at,o),s++,o=0,_=[],j=[],et=[],nt=[],st=[],at=[])}),i}genFace(e,i,s,o,c,_,j,et,nt,st){for(let at=2;at<st;at++)e.vertex.push(i.vertexPositions[s[0]]),e.vertex.push(i.vertexPositions[s[1]]),e.vertex.push(i.vertexPositions[s[2]]),e.vertex.push(i.vertexPositions[s[3*(at-1)]]),e.vertex.push(i.vertexPositions[s[3*(at-1)+1]]),e.vertex.push(i.vertexPositions[s[3*(at-1)+2]]),e.vertex.push(i.vertexPositions[s[3*at]]),e.vertex.push(i.vertexPositions[s[3*at+1]]),e.vertex.push(i.vertexPositions[s[3*at+2]]),i.skeleton&&(e.vertexWeights.push(et[0]),e.vertexWeights.push(et[1]),e.vertexWeights.push(et[2]),e.vertexWeights.push(et[3]),e.vertexWeights.push(et[4*(at-1)]),e.vertexWeights.push(et[4*(at-1)+1]),e.vertexWeights.push(et[4*(at-1)+2]),e.vertexWeights.push(et[4*(at-1)+3]),e.vertexWeights.push(et[4*at]),e.vertexWeights.push(et[4*at+1]),e.vertexWeights.push(et[4*at+2]),e.vertexWeights.push(et[4*at+3]),e.weightsIndices.push(nt[0]),e.weightsIndices.push(nt[1]),e.weightsIndices.push(nt[2]),e.weightsIndices.push(nt[3]),e.weightsIndices.push(nt[4*(at-1)]),e.weightsIndices.push(nt[4*(at-1)+1]),e.weightsIndices.push(nt[4*(at-1)+2]),e.weightsIndices.push(nt[4*(at-1)+3]),e.weightsIndices.push(nt[4*at]),e.weightsIndices.push(nt[4*at+1]),e.weightsIndices.push(nt[4*at+2]),e.weightsIndices.push(nt[4*at+3])),i.color&&(e.colors.push(_[0]),e.colors.push(_[1]),e.colors.push(_[2]),e.colors.push(_[3*(at-1)]),e.colors.push(_[3*(at-1)+1]),e.colors.push(_[3*(at-1)+2]),e.colors.push(_[3*at]),e.colors.push(_[3*at+1]),e.colors.push(_[3*at+2])),i.material&&i.material.mappingType!=="AllSame"&&(e.materialIndex.push(o),e.materialIndex.push(o),e.materialIndex.push(o)),i.normal&&(e.normal.push(c[0]),e.normal.push(c[1]),e.normal.push(c[2]),e.normal.push(c[3*(at-1)]),e.normal.push(c[3*(at-1)+1]),e.normal.push(c[3*(at-1)+2]),e.normal.push(c[3*at]),e.normal.push(c[3*at+1]),e.normal.push(c[3*at+2])),i.uv&&i.uv.forEach(function(ct,dt){e.uvs[dt]===void 0&&(e.uvs[dt]=[]),e.uvs[dt].push(j[dt][0]),e.uvs[dt].push(j[dt][1]),e.uvs[dt].push(j[dt][2*(at-1)]),e.uvs[dt].push(j[dt][2*(at-1)+1]),e.uvs[dt].push(j[dt][2*at]),e.uvs[dt].push(j[dt][2*at+1])})}addMorphTargets(e,i,s,o){if(s.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const c=this;s.forEach(function(_){_.rawTargets.forEach(function(j){const et=qo.Objects.Geometry[j.geoID];et!==void 0&&c.genMorphGeometry(e,i,et,o,j.name)})})}genMorphGeometry(e,i,s,o,c){const _=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],j=s.Vertices!==void 0?s.Vertices.a:[],et=s.Indexes!==void 0?s.Indexes.a:[],nt=3*e.attributes.position.count,st=new Float32Array(nt);for(let mt=0;mt<et.length;mt++){const yt=3*et[mt];st[yt]=j[3*mt],st[yt+1]=j[3*mt+1],st[yt+2]=j[3*mt+2]}const at={vertexIndices:_,vertexPositions:st},ct=this.genBuffers(at),dt=new g.a$l(ct.vertex,3);dt.name=c||s.attrName,dt.applyMatrix4(o),e.morphAttributes.position.push(dt)}parseNormals(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,o=e.Normals.a;let c=[];return s==="IndexToDirect"&&("NormalIndex"in e?c=e.NormalIndex.a:"NormalsIndex"in e&&(c=e.NormalsIndex.a)),{dataSize:3,buffer:o,indices:c,mappingType:i,referenceType:s}}parseUVs(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,o=e.UV.a;let c=[];return s==="IndexToDirect"&&(c=e.UVIndex.a),{dataSize:2,buffer:o,indices:c,mappingType:i,referenceType:s}}parseVertexColors(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,o=e.Colors.a;let c=[];s==="IndexToDirect"&&(c=e.ColorIndex.a);for(let _=0,j=new g.Ilk;_<o.length;_+=4)j.fromArray(o,_).convertSRGBToLinear().toArray(o,_);return{dataSize:4,buffer:o,indices:c,mappingType:i,referenceType:s}}parseMaterialIndices(e){const i=e.MappingInformationType,s=e.ReferenceInformationType;if(i==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const o=e.Materials.a,c=[];for(let _=0;_<o.length;++_)c.push(_);return{dataSize:1,buffer:o,indices:c,mappingType:i,referenceType:s}}parseNurbsGeometry(e){const i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new g.u9r;const s=i-1,o=e.KnotVector.a,c=[],_=e.Points.a;for(let st=0,at=_.length;st<at;st+=4)c.push(new g.Ltg().fromArray(_,st));let j,et;if(e.Form==="Closed")c.push(c[0]);else if(e.Form==="Periodic"){j=s,et=o.length-1-j;for(let st=0;st<s;++st)c.push(c[st])}const nt=new BO(s,o,c,j,et).getPoints(12*c.length);return new g.u9r().setFromPoints(nt)}}class pt{parse(){const e=[],i=this.parseClips();if(i!==void 0)for(const s in i){const o=i[s],c=this.addClip(o);e.push(c)}return e}parseClips(){if(qo.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){const e=qo.Objects.AnimationCurveNode,i=new Map;for(const s in e){const o=e[s];if(o.attrName.match(/S|R|T|DeformPercent/)!==null){const c={id:o.id,attr:o.attrName,curves:{}};i.set(c.id,c)}}return i}parseAnimationCurves(e){const i=qo.Objects.AnimationCurve;for(const s in i){const o={id:i[s].id,times:i[s].KeyTime.a.map(ft),values:i[s].KeyValueFloat.a},c=Wu.get(o.id);if(c!==void 0){const _=c.parents[0].ID,j=c.parents[0].relationship;j.match(/X/)?e.get(_).curves.x=o:j.match(/Y/)?e.get(_).curves.y=o:j.match(/Z/)?e.get(_).curves.z=o:j.match(/DeformPercent/)&&e.has(_)&&(e.get(_).curves.morph=o)}}}parseAnimationLayers(e){const i=qo.Objects.AnimationLayer,s=new Map;for(const o in i){const c=[],_=Wu.get(parseInt(o));_!==void 0&&(_.children.forEach(function(j,et){if(e.has(j.ID)){const nt=e.get(j.ID);if(nt.curves.x!==void 0||nt.curves.y!==void 0||nt.curves.z!==void 0){if(c[et]===void 0){const st=Wu.get(j.ID).parents.filter(function(at){return at.relationship!==void 0})[0].ID;if(st!==void 0){const at=qo.Objects.Model[st.toString()];if(at===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",j);const ct={modelName:at.attrName?g.iUV.sanitizeNodeName(at.attrName):"",ID:at.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Hm.traverse(function(dt){dt.ID===at.id&&(ct.transform=dt.matrix,dt.userData.transformData&&(ct.eulerOrder=dt.userData.transformData.eulerOrder))}),ct.transform||(ct.transform=new g.yGw),"PreRotation"in at&&(ct.preRotation=at.PreRotation.value),"PostRotation"in at&&(ct.postRotation=at.PostRotation.value),c[et]=ct}}c[et]&&(c[et][nt.attr]=nt)}else if(nt.curves.morph!==void 0){if(c[et]===void 0){const st=Wu.get(j.ID).parents.filter(function(wt){return wt.relationship!==void 0})[0].ID,at=Wu.get(st).parents[0].ID,ct=Wu.get(at).parents[0].ID,dt=Wu.get(ct).parents[0].ID,mt=qo.Objects.Model[dt],yt={modelName:mt.attrName?g.iUV.sanitizeNodeName(mt.attrName):"",morphName:qo.Objects.Deformer[st].attrName};c[et]=yt}c[et][nt.attr]=nt}}}),s.set(parseInt(o),c))}return s}parseAnimStacks(e){const i=qo.Objects.AnimationStack,s={};for(const o in i){const c=Wu.get(parseInt(o)).children;c.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const _=e.get(c[0].ID);s[o]={name:i[o].attrName,layer:_}}return s}addClip(e){let i=[];const s=this;return e.layer.forEach(function(o){i=i.concat(s.generateTracks(o))}),new g.m7l(e.name,-1,i)}generateTracks(e){const i=[];let s=new g.Pa4,o=new g._fP,c=new g.Pa4;if(e.transform&&e.transform.decompose(s,o,c),s=s.toArray(),o=new g.USm().setFromQuaternion(o,e.eulerOrder).toArray(),c=c.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const _=this.generateVectorTrack(e.modelName,e.T.curves,s,"position");_!==void 0&&i.push(_)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const _=this.generateRotationTrack(e.modelName,e.R.curves,o,e.preRotation,e.postRotation,e.eulerOrder);_!==void 0&&i.push(_)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const _=this.generateVectorTrack(e.modelName,e.S.curves,c,"scale");_!==void 0&&i.push(_)}if(e.DeformPercent!==void 0){const _=this.generateMorphTrack(e);_!==void 0&&i.push(_)}return i}generateVectorTrack(e,i,s,o){const c=this.getTimesForAllAxes(i),_=this.getKeyframeTrackValues(c,i,s);return new g.yC1(e+"."+o,c,_)}generateRotationTrack(e,i,s,o,c,_){i.x!==void 0&&(this.interpolateRotations(i.x),i.x.values=i.x.values.map(g.M8C.degToRad)),i.y!==void 0&&(this.interpolateRotations(i.y),i.y.values=i.y.values.map(g.M8C.degToRad)),i.z!==void 0&&(this.interpolateRotations(i.z),i.z.values=i.z.values.map(g.M8C.degToRad));const j=this.getTimesForAllAxes(i),et=this.getKeyframeTrackValues(j,i,s);o!==void 0&&((o=o.map(g.M8C.degToRad)).push(_),o=new g.USm().fromArray(o),o=new g._fP().setFromEuler(o)),c!==void 0&&((c=c.map(g.M8C.degToRad)).push(_),c=new g.USm().fromArray(c),c=new g._fP().setFromEuler(c).invert());const nt=new g._fP,st=new g.USm,at=[];for(let ct=0;ct<et.length;ct+=3)st.set(et[ct],et[ct+1],et[ct+2],_),nt.setFromEuler(st),o!==void 0&&nt.premultiply(o),c!==void 0&&nt.multiply(c),nt.toArray(at,ct/3*4);return new g.iLg(e+".quaternion",j,at)}generateMorphTrack(e){const i=e.DeformPercent.curves.morph,s=i.values.map(function(c){return c/100}),o=Hm.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new g.dUE(e.modelName+".morphTargetInfluences["+o+"]",i.times,s)}getTimesForAllAxes(e){let i=[];if(e.x!==void 0&&(i=i.concat(e.x.times)),e.y!==void 0&&(i=i.concat(e.y.times)),e.z!==void 0&&(i=i.concat(e.z.times)),i=i.sort(function(s,o){return s-o}),i.length>1){let s=1,o=i[0];for(let c=1;c<i.length;c++){const _=i[c];_!==o&&(i[s]=_,o=_,s++)}i=i.slice(0,s)}return i}getKeyframeTrackValues(e,i,s){const o=s,c=[];let _=-1,j=-1,et=-1;return e.forEach(function(nt){if(i.x&&(_=i.x.times.indexOf(nt)),i.y&&(j=i.y.times.indexOf(nt)),i.z&&(et=i.z.times.indexOf(nt)),_!==-1){const st=i.x.values[_];c.push(st),o[0]=st}else c.push(o[0]);if(j!==-1){const st=i.y.values[j];c.push(st),o[1]=st}else c.push(o[1]);if(et!==-1){const st=i.z.values[et];c.push(st),o[2]=st}else c.push(o[2])}),c}interpolateRotations(e){for(let i=1;i<e.values.length;i++){const s=e.values[i-1],o=e.values[i]-s,c=Math.abs(o);if(c>=180){const _=c/180,j=o/_;let et=s+j;const nt=e.times[i-1],st=(e.times[i]-nt)/_;let at=nt+st;const ct=[],dt=[];for(;at<e.times[i];)ct.push(at),at+=st,dt.push(et),et+=j;e.times=Jt(e.times,i,ct),e.values=Jt(e.values,i,dt)}}}}class a{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new it,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const i=this,s=e.split(/[\r\n]+/);return s.forEach(function(o,c){const _=o.match(/^[\s\t]*;/),j=o.match(/^[\s\t]*$/);if(_||j)return;const et=o.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),nt=o.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),st=o.match("^\\t{"+(i.currentIndent-1)+"}}");et?i.parseNodeBegin(o,et):nt?i.parseNodeProperty(o,nt,s[++c]):st?i.popStack():o.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(o)}),this.allNodes}parseNodeBegin(e,i){const s=i[1].trim().replace(/^"/,"").replace(/"$/,""),o=i[2].split(",").map(function(et){return et.trim().replace(/^"/,"").replace(/"$/,"")}),c={name:s},_=this.parseNodeAttr(o),j=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(s,c):s in j?(s==="PoseNode"?j.PoseNode.push(c):j[s].id!==void 0&&(j[s]={},j[s][j[s].id]=j[s]),_.id!==""&&(j[s][_.id]=c)):typeof _.id=="number"?(j[s]={},j[s][_.id]=c):s!=="Properties70"&&(j[s]=s==="PoseNode"?[c]:c),typeof _.id=="number"&&(c.id=_.id),_.name!==""&&(c.attrName=_.name),_.type!==""&&(c.attrType=_.type),this.pushStack(c)}parseNodeAttr(e){let i=e[0];e[0]!==""&&(i=parseInt(e[0]),isNaN(i)&&(i=e[0]));let s="",o="";return e.length>1&&(s=e[1].replace(/^(\w+)::/,""),o=e[2]),{id:i,name:s,type:o}}parseNodeProperty(e,i,s){let o=i[1].replace(/^"/,"").replace(/"$/,"").trim(),c=i[2].replace(/^"/,"").replace(/"$/,"").trim();o==="Content"&&c===","&&(c=s.replace(/"/g,"").replace(/,$/,"").trim());const _=this.getCurrentNode();if(_.name!=="Properties70"){if(o==="C"){const j=c.split(",").slice(1),et=parseInt(j[0]),nt=parseInt(j[1]);let st=c.split(",").slice(3);st=st.map(function(at){return at.trim().replace(/^"/,"")}),o="connections",c=[et,nt],function(at,ct){for(let dt=0,mt=at.length,yt=ct.length;dt<yt;dt++,mt++)at[mt]=ct[dt]}(c,st),_[o]===void 0&&(_[o]=[])}o==="Node"&&(_.id=c),o in _&&Array.isArray(_[o])?_[o].push(c):o!=="a"?_[o]=c:_.a=c,this.setCurrentProp(_,o),o==="a"&&c.slice(-1)!==","&&(_.a=Lt(c))}else this.parseNodeSpecialProperty(e,o,c)}parseNodePropertyContinued(e){const i=this.getCurrentNode();i.a+=e,e.slice(-1)!==","&&(i.a=Lt(i.a))}parseNodeSpecialProperty(e,i,s){const o=s.split('",').map(function(st){return st.trim().replace(/^\"/,"").replace(/\s/,"_")}),c=o[0],_=o[1],j=o[2],et=o[3];let nt=o[4];switch(_){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":nt=parseFloat(nt);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":nt=Lt(nt)}this.getPrevNode()[c]={type:_,type2:j,flag:et,value:nt},this.setCurrentProp(this.getPrevNode(),c)}}class _e{parse(e){const i=new rt(e);i.skip(23);const s=i.getUint32();if(s<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+s);const o=new it;for(;!this.endOfContent(i);){const c=this.parseNode(i,s);c!==null&&o.add(c.name,c)}return o}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){const s={},o=i>=7500?e.getUint64():e.getUint32(),c=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();const _=e.getUint8(),j=e.getString(_);if(o===0)return null;const et=[];for(let ct=0;ct<c;ct++)et.push(this.parseProperty(e));const nt=et.length>0?et[0]:"",st=et.length>1?et[1]:"",at=et.length>2?et[2]:"";for(s.singleProperty=c===1&&e.getOffset()===o;o>e.getOffset();){const ct=this.parseNode(e,i);ct!==null&&this.parseSubNode(j,s,ct)}return s.propertyList=et,typeof nt=="number"&&(s.id=nt),st!==""&&(s.attrName=st),at!==""&&(s.attrType=at),j!==""&&(s.name=j),s}parseSubNode(e,i,s){if(s.singleProperty===!0){const o=s.propertyList[0];Array.isArray(o)?(i[s.name]=s,s.a=o):i[s.name]=o}else if(e==="Connections"&&s.name==="C"){const o=[];s.propertyList.forEach(function(c,_){_!==0&&o.push(c)}),i.connections===void 0&&(i.connections=[]),i.connections.push(o)}else if(s.name==="Properties70")Object.keys(s).forEach(function(o){i[o]=s[o]});else if(e==="Properties70"&&s.name==="P"){let o=s.propertyList[0],c=s.propertyList[1];const _=s.propertyList[2],j=s.propertyList[3];let et;o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),c.indexOf("Lcl ")===0&&(c=c.replace("Lcl ","Lcl_")),et=c==="Color"||c==="ColorRGB"||c==="Vector"||c==="Vector3D"||c.indexOf("Lcl_")===0?[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:s.propertyList[4],i[o]={type:c,type2:_,flag:j,value:et}}else i[s.name]===void 0?typeof s.id=="number"?(i[s.name]={},i[s.name][s.id]=s):i[s.name]=s:s.name==="PoseNode"?(Array.isArray(i[s.name])||(i[s.name]=[i[s.name]]),i[s.name].push(s)):i[s.name][s.id]===void 0&&(i[s.name][s.id]=s)}parseProperty(e){const i=e.getString(1);let s;switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return s=e.getUint32(),e.getArrayBuffer(s);case"S":return s=e.getUint32(),e.getString(s);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const o=e.getUint32(),c=e.getUint32(),_=e.getUint32();if(c===0)switch(i){case"b":case"c":return e.getBooleanArray(o);case"d":return e.getFloat64Array(o);case"f":return e.getFloat32Array(o);case"i":return e.getInt32Array(o);case"l":return e.getInt64Array(o)}const j=OE(new Uint8Array(e.getArrayBuffer(_))),et=new rt(j.buffer);switch(i){case"b":case"c":return et.getBooleanArray(o);case"d":return et.getFloat64Array(o);case"f":return et.getFloat32Array(o);case"i":return et.getInt32Array(o);case"l":return et.getInt64Array(o)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class rt{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=i===void 0||i,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const i=[];for(let s=0;s<e;s++)i.push(this.getBoolean());return i}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt32());return i}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),2147483648&i?(i=4294967295&~i,e=4294967295&~e,e===4294967295&&(i=i+1&4294967295),e=e+1&4294967295,-(4294967296*i+e)):4294967296*i+e}getInt64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),4294967296*i+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat32());return i}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat64());return i}getArrayBuffer(e){const i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){const i=this.offset;let s=new Uint8Array(this.dv.buffer,i,e);this.skip(e);const o=s.indexOf(0);return o>=0&&(s=new Uint8Array(this.dv.buffer,i,o)),this._textDecoder.decode(s)}}class it{add(e,i){this[e]=i}}function lt(h){const e=h.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function ft(h){return h/46186158e3}const _t=[];function St(h,e,i,s){let o;switch(s.mappingType){case"ByPolygonVertex":o=h;break;case"ByPolygon":o=e;break;case"ByVertice":o=i;break;case"AllSame":o=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}s.referenceType==="IndexToDirect"&&(o=s.indices[o]);const c=o*s.dataSize,_=c+s.dataSize;return function(j,et,nt,st){for(let at=nt,ct=0;at<st;at++,ct++)j[ct]=et[at];return j}(_t,s.buffer,c,_)}const Et=new g.USm,Tt=new g.Pa4;function Bt(h){const e=new g.yGw,i=new g.yGw,s=new g.yGw,o=new g.yGw,c=new g.yGw,_=new g.yGw,j=new g.yGw,et=new g.yGw,nt=new g.yGw,st=new g.yGw,at=new g.yGw,ct=new g.yGw,dt=h.inheritType?h.inheritType:0;if(h.translation&&e.setPosition(Tt.fromArray(h.translation)),h.preRotation){const fn=h.preRotation.map(g.M8C.degToRad);fn.push(h.eulerOrder||g.USm.DEFAULT_ORDER),i.makeRotationFromEuler(Et.fromArray(fn))}if(h.rotation){const fn=h.rotation.map(g.M8C.degToRad);fn.push(h.eulerOrder||g.USm.DEFAULT_ORDER),s.makeRotationFromEuler(Et.fromArray(fn))}if(h.postRotation){const fn=h.postRotation.map(g.M8C.degToRad);fn.push(h.eulerOrder||g.USm.DEFAULT_ORDER),o.makeRotationFromEuler(Et.fromArray(fn)),o.invert()}h.scale&&c.scale(Tt.fromArray(h.scale)),h.scalingOffset&&j.setPosition(Tt.fromArray(h.scalingOffset)),h.scalingPivot&&_.setPosition(Tt.fromArray(h.scalingPivot)),h.rotationOffset&&et.setPosition(Tt.fromArray(h.rotationOffset)),h.rotationPivot&&nt.setPosition(Tt.fromArray(h.rotationPivot)),h.parentMatrixWorld&&(at.copy(h.parentMatrix),st.copy(h.parentMatrixWorld));const mt=i.clone().multiply(s).multiply(o),yt=new g.yGw;yt.extractRotation(st);const wt=new g.yGw;wt.copyPosition(st);const Ct=wt.clone().invert().multiply(st),bt=yt.clone().invert().multiply(Ct),At=c,Pt=new g.yGw;if(dt===0)Pt.copy(yt).multiply(mt).multiply(bt).multiply(At);else if(dt===1)Pt.copy(yt).multiply(bt).multiply(mt).multiply(At);else{const fn=new g.yGw().scale(new g.Pa4().setFromMatrixScale(at)).clone().invert(),mn=bt.clone().multiply(fn);Pt.copy(yt).multiply(mt).multiply(mn).multiply(At)}const Dt=nt.clone().invert(),Nt=_.clone().invert();let Vt=e.clone().multiply(et).multiply(nt).multiply(i).multiply(s).multiply(o).multiply(Dt).multiply(j).multiply(_).multiply(c).multiply(Nt);const Zt=new g.yGw().copyPosition(Vt),an=st.clone().multiply(Zt);return ct.copyPosition(an),Vt=ct.clone().multiply(Pt),Vt.premultiply(st.invert()),Vt}function Ot(h){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(h=h||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[h]}function Lt(h){return h.split(",").map(function(e){return parseFloat(e)})}function zt(h,e,i){return e===void 0&&(e=0),i===void 0&&(i=h.byteLength),new TextDecoder().decode(new Uint8Array(h,e,i))}function Jt(h,e,i){return h.slice(0,e).concat(i).concat(h.slice(e))}class Ht extends b.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Fr],this._importer=new eu(LO,["fbx"],!0)}async onAdded(e){var i,s;(s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){var i,s,o,c;(s=(i=e.getManager())==null?void 0:i.importer)!=null&&s.Importers&&((c=(o=e.getManager())==null?void 0:o.importer)==null||c.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1))}}Ht.PluginType="FBXLoadPlugin";const $t=new g.cPb(45,1,.1,1e3);function rn(h,e,i,s=7,o=new g.Pa4(0,0,1.5)){i=i??h.scene.modelObject;const c=new Wt().expandByObject(i??e,!0,!0),_=c.getCenter(new g.Pa4),j=c.getSize(new g.Pa4);$t.position.copy(_).add(o.clone().multiplyScalar(Math.max(j.x,j.y,j.z))),$t.lookAt(_),e&&e.traverseVisible(st=>{st.layers.enable(s)}),s>0?$t.layers.set(s):$t.layers.enableAll();const et=e==null?void 0:e.visible;e&&(e.visible=!0),h.renderer.rendererObject.setRenderTarget(null),h.renderer.rendererObject.render(i,$t);const nt=h.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=et,e.traverseVisible(st=>{st.layers.disable(s)}),$t.layers.enableAll()),h.setDirty(),nt}class cn{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new g.Kj0(new g.xo$(1)),cube:new g.Kj0(new g.DvJ(1,1,1)),cylinder:new g.Kj0(new g.fHI(.5,.5,1))};const i=new g.xsS;this._channel=7;const s=new g.vmT(16777215,4473924,1);s.position.set(0,10,0),s.layers.set(this._channel),i.add(s),this._lights.push(s),this._scene=i}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,i="sphere"){const s=this.shapes[i]||new g.Kj0(new g.xo$(1));s.material=e.materialObject,s.geometry.attributes.tangent||s.geometry.computeTangents(),this._scene.add(s),this._scene.environment=this.viewer.scene.getEnvironment();const o=s.material.envMapIntensity;typeof o=="number"&&(s.material.envMapIntensity=Math.max(o,2));const c=rn(this.viewer,s,this._scene,this._channel,new g.Pa4(0,0,1.5));return typeof o=="number"&&(s.material.envMapIntensity=o),this._scene.remove(s),s.material=void 0,c}}class Rn extends ms{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig).uiRefresh)==null||i.call(e))},this.dependencies=[Fr],this.variations=[],this._selectedMaterial=()=>{var e,i;return((i=(e=this._picking)==null?void 0:e.getSelectedObject())==null?void 0:i.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(Ny).filter(i=>i.endsWith("Map"))].map(i=>({label:i,value:i}))},...((e=this.getSelectedVariation())==null?void 0:e.materials.map(i=>i.uiConfig?Object.assign(i.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(i.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(i)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()},{type:"button",label:"Apply All",value:()=>{this.variations.forEach(i=>this.applyVariation(i,i.materials[0].uuid))}}]}]}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)==null?void 0:i.getPluginByType("Picking"),this._previewGenerator=new cn(this._viewer),(s=this._picking)==null||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,i){return this.variations=[],super.fromJSON(e,i)}async onRemove(e){var i,s;return(i=this._previewGenerator)==null||i.dispose(),this._previewGenerator=void 0,(s=this._picking)==null||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(i=>i.uuid===e):void 0}getSelectedVariation(){var e,i;return this.findVariation((e=this._selectedMaterial())==null?void 0:e.uuid)||this.findVariation((i=this._selectedMaterial())==null?void 0:i.name)}applyVariation(e,i){var c,_;const s=e.materials.find(j=>j.uuid===i),o=(_=(c=this._viewer)==null?void 0:c.getManager())==null?void 0:_.materials;return!!o&&!!s&&o.applyMaterial(s,e.uuid)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let i=this.findVariation(e.uuid);!i&&e.name.length>0&&(i=this.findVariation(e.name)),i&&this.removeVariation(i)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var s;const i=(s=e==null?void 0:e.clone)==null?void 0:s.call(e);if(e&&i){let o=this.findVariation(e.uuid);!o&&e.name.length>0&&(o=this.findVariation(e.name)),o||this.variations.push(o={uuid:e.name.length>0?e.name:e.uuid,title:e.name.length>0?e.name:"No Name",preview:"generate:sphere",materials:[]}),o.materials.push(i),this.refreshUi()}}}Rn.PluginType="MaterialConfiguratorBasePlugin",function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);c>3&&_&&Object.defineProperty(e,i,_)}([En()],Rn.prototype,"variations",void 0);class Cn{static _initialize(){this._inited=!0,(0,b.createStyles)(b.css`
  .customContextGrid {
    background: #28223C;
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }
  .customContextGridParent{
    position: absolute;
    top: 0;
    left: 0;
    width: 270px;
    height: calc(100% - 100px);
    overflow-y: scroll;
    z-index: 100;
    display: flex;
    flex-direction: column;
    margin-bottom: 50px;
    margin-top: 50px;
  }
  /* Hide scrollbar for Chrome, Safari and Opera */
  .customContextGridParent::-webkit-scrollbar {
    display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .customContextGridParent {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

        `),this._container.style.position="absolute",this._container.style.top="0",this._container.style.left="0",this._container.style.width="270px",this._container.style.height="100%",this._container.style.pointerEvents="none",this._container.style.zIndex="100",this._container.style.overflowY="auto"}static Create(e,i,s,o,c,_,j){var ct;this._inited||this._initialize();const et=(0,b.mobileAndTabletCheck)(),nt=et?.15:.25,st=et?1.5:2.5,at=(0,b.createDiv)({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${i} </div>
            `});at.style.top=c+"px",at.style.left=o+"px",at.style.gap=nt+"rem",at.style.width=(st+nt)*s-nt+"rem",at.dataset.tag=e;for(const dt of _){const mt=(0,b.createDiv)({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${dt.image}" class="customContextGridItemImage">
            `});mt.style.width=st+"rem",mt.style.height=st+"rem",at.appendChild(mt),mt.onclick=()=>{var yt;return(yt=dt.onClick)==null?void 0:yt.call(dt,dt.id)},j(mt,dt)}return(ct=this.Elements)==null||ct.push(at),at}static RemoveAll(e){if(e){const i=this.Elements.filter(s=>s.dataset.tag===e);for(const s of i)s.remove();this.Elements=this.Elements.filter(s=>s.dataset.tag!==e)}else{for(const i of this.Elements)i.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=(0,b.createDiv)({addToBody:!0,classList:["customContextGridParent"]}));for(const s of this.Elements)s.remove();this._container.innerHTML="";let i=20;e.appendChild(this._container);for(const s of this.Elements)s.style.top=i+"px",this._container.appendChild(s),i+=s.clientHeight+20}}function Tn(h){if(h==null)return window;if(h.toString()!=="[object Window]"){var e=h.ownerDocument;return e&&e.defaultView||window}return h}function Gn(h){return h instanceof Tn(h).Element||h instanceof Element}function nr(h){return h instanceof Tn(h).HTMLElement||h instanceof HTMLElement}function Qn(h){return typeof ShadowRoot<"u"&&(h instanceof Tn(h).ShadowRoot||h instanceof ShadowRoot)}Cn.Elements=[],Cn._inited=!1,Cn._container=document.createElement("div");var ur=Math.max,Wn=Math.min,Ar=Math.round;function Cr(){var h=navigator.userAgentData;return h!=null&&h.brands?h.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Wr(){return!/^((?!chrome|android).)*safari/i.test(Cr())}function is(h,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var s=h.getBoundingClientRect(),o=1,c=1;e&&nr(h)&&(o=h.offsetWidth>0&&Ar(s.width)/h.offsetWidth||1,c=h.offsetHeight>0&&Ar(s.height)/h.offsetHeight||1);var _=(Gn(h)?Tn(h):window).visualViewport,j=!Wr()&&i,et=(s.left+(j&&_?_.offsetLeft:0))/o,nt=(s.top+(j&&_?_.offsetTop:0))/c,st=s.width/o,at=s.height/c;return{width:st,height:at,top:nt,right:et+st,bottom:nt+at,left:et,x:et,y:nt}}function Qr(h){var e=Tn(h);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function Pr(h){return h?(h.nodeName||"").toLowerCase():null}function Jr(h){return((Gn(h)?h.ownerDocument:h.document)||window.document).documentElement}function rs(h){return is(Jr(h)).left+Qr(h).scrollLeft}function vr(h){return Tn(h).getComputedStyle(h)}function Br(h){var e=vr(h),i=e.overflow,s=e.overflowX,o=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+o+s)}function es(h,e,i){i===void 0&&(i=!1);var s,o,c=nr(e),_=nr(e)&&function(at){var ct=at.getBoundingClientRect(),dt=Ar(ct.width)/at.offsetWidth||1,mt=Ar(ct.height)/at.offsetHeight||1;return dt!==1||mt!==1}(e),j=Jr(e),et=is(h,_,i),nt={scrollLeft:0,scrollTop:0},st={x:0,y:0};return(c||!c&&!i)&&((Pr(e)!=="body"||Br(j))&&(nt=(s=e)!==Tn(s)&&nr(s)?{scrollLeft:(o=s).scrollLeft,scrollTop:o.scrollTop}:Qr(s)),nr(e)?((st=is(e,!0)).x+=e.clientLeft,st.y+=e.clientTop):j&&(st.x=rs(j))),{x:et.left+nt.scrollLeft-st.x,y:et.top+nt.scrollTop-st.y,width:et.width,height:et.height}}function zr(h){var e=is(h),i=h.offsetWidth,s=h.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-s)<=1&&(s=e.height),{x:h.offsetLeft,y:h.offsetTop,width:i,height:s}}function as(h){return Pr(h)==="html"?h:h.assignedSlot||h.parentNode||(Qn(h)?h.host:null)||Jr(h)}function ro(h){return["html","body","#document"].indexOf(Pr(h))>=0?h.ownerDocument.body:nr(h)&&Br(h)?h:ro(as(h))}function Hn(h,e){var i;e===void 0&&(e=[]);var s=ro(h),o=s===((i=h.ownerDocument)==null?void 0:i.body),c=Tn(s),_=o?[c].concat(c.visualViewport||[],Br(s)?s:[]):s,j=e.concat(_);return o?j:j.concat(Hn(as(_)))}function Dn(h){return["table","td","th"].indexOf(Pr(h))>=0}function pr(h){return nr(h)&&vr(h).position!=="fixed"?h.offsetParent:null}function $n(h){for(var e=Tn(h),i=pr(h);i&&Dn(i)&&vr(i).position==="static";)i=pr(i);return i&&(Pr(i)==="html"||Pr(i)==="body"&&vr(i).position==="static")?e:i||function(s){var o=/firefox/i.test(Cr());if(/Trident/i.test(Cr())&&nr(s)&&vr(s).position==="fixed")return null;var c=as(s);for(Qn(c)&&(c=c.host);nr(c)&&["html","body"].indexOf(Pr(c))<0;){var _=vr(c);if(_.transform!=="none"||_.perspective!=="none"||_.contain==="paint"||["transform","perspective"].indexOf(_.willChange)!==-1||o&&_.willChange==="filter"||o&&_.filter&&_.filter!=="none")return c;c=c.parentNode}return null}(h)||e}var Fn="top",ir="bottom",xn="right",qn="left",Xn="auto",Tr=[Fn,ir,xn,qn],Er="start",Or="end",ss="clippingParents",ys="viewport",Fs="popper",gs="reference",uo=Tr.reduce(function(h,e){return h.concat([e+"-"+Er,e+"-"+Or])},[]),lo=[].concat(Tr,[Xn]).reduce(function(h,e){return h.concat([e,e+"-"+Er,e+"-"+Or])},[]),js="beforeRead",Wl="read",am="afterRead",So="beforeMain",Al="main",Il="afterMain",by="beforeWrite",wr="write",xA="afterWrite",BE=[js,Wl,am,So,Al,Il,by,wr,xA];function Qm(h){var e=new Map,i=new Set,s=[];function o(c){i.add(c.name),[].concat(c.requires||[],c.requiresIfExists||[]).forEach(function(_){if(!i.has(_)){var j=e.get(_);j&&o(j)}}),s.push(c)}return h.forEach(function(c){e.set(c.name,c)}),h.forEach(function(c){i.has(c.name)||o(c)}),s}var LE={placement:"bottom",modifiers:[],strategy:"absolute"};function u1(){for(var h=arguments.length,e=new Array(h),i=0;i<h;i++)e[i]=arguments[i];return!e.some(function(s){return!(s&&typeof s.getBoundingClientRect=="function")})}function NE(h){h===void 0&&(h={});var e=h,i=e.defaultModifiers,s=i===void 0?[]:i,o=e.defaultOptions,c=o===void 0?LE:o;return function(_,j,et){et===void 0&&(et=c);var nt,st,at={placement:"bottom",orderedModifiers:[],options:Object.assign({},LE,c),modifiersData:{},elements:{reference:_,popper:j},attributes:{},styles:{}},ct=[],dt=!1,mt={state:at,setOptions:function(wt){var Ct=typeof wt=="function"?wt(at.options):wt;yt(),at.options=Object.assign({},c,at.options,Ct),at.scrollParents={reference:Gn(_)?Hn(_):_.contextElement?Hn(_.contextElement):[],popper:Hn(j)};var bt,At,Pt=function(Dt){var Nt=Qm(Dt);return BE.reduce(function(Vt,Zt){return Vt.concat(Nt.filter(function(an){return an.phase===Zt}))},[])}((bt=[].concat(s,at.options.modifiers),At=bt.reduce(function(Dt,Nt){var Vt=Dt[Nt.name];return Dt[Nt.name]=Vt?Object.assign({},Vt,Nt,{options:Object.assign({},Vt.options,Nt.options),data:Object.assign({},Vt.data,Nt.data)}):Nt,Dt},{}),Object.keys(At).map(function(Dt){return At[Dt]})));return at.orderedModifiers=Pt.filter(function(Dt){return Dt.enabled}),at.orderedModifiers.forEach(function(Dt){var Nt=Dt.name,Vt=Dt.options,Zt=Vt===void 0?{}:Vt,an=Dt.effect;if(typeof an=="function"){var fn=an({state:at,name:Nt,instance:mt,options:Zt});ct.push(fn||function(){})}}),mt.update()},forceUpdate:function(){if(!dt){var wt=at.elements,Ct=wt.reference,bt=wt.popper;if(u1(Ct,bt)){at.rects={reference:es(Ct,$n(bt),at.options.strategy==="fixed"),popper:zr(bt)},at.reset=!1,at.placement=at.options.placement,at.orderedModifiers.forEach(function(an){return at.modifiersData[an.name]=Object.assign({},an.data)});for(var At=0;At<at.orderedModifiers.length;At++)if(at.reset!==!0){var Pt=at.orderedModifiers[At],Dt=Pt.fn,Nt=Pt.options,Vt=Nt===void 0?{}:Nt,Zt=Pt.name;typeof Dt=="function"&&(at=Dt({state:at,options:Vt,name:Zt,instance:mt})||at)}else at.reset=!1,At=-1}}},update:(nt=function(){return new Promise(function(wt){mt.forceUpdate(),wt(at)})},function(){return st||(st=new Promise(function(wt){Promise.resolve().then(function(){st=void 0,wt(nt())})})),st}),destroy:function(){yt(),dt=!0}};if(!u1(_,j))return mt;function yt(){ct.forEach(function(wt){return wt()}),ct=[]}return mt.setOptions(et).then(function(wt){!dt&&et.onFirstUpdate&&et.onFirstUpdate(wt)}),mt}}var SP=NE(),h1={passive:!0},qC={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(h){var e=h.state,i=h.instance,s=h.options,o=s.scroll,c=o===void 0||o,_=s.resize,j=_===void 0||_,et=Tn(e.elements.popper),nt=[].concat(e.scrollParents.reference,e.scrollParents.popper);return c&&nt.forEach(function(st){st.addEventListener("scroll",i.update,h1)}),j&&et.addEventListener("resize",i.update,h1),function(){c&&nt.forEach(function(st){st.removeEventListener("scroll",i.update,h1)}),j&&et.removeEventListener("resize",i.update,h1)}},data:{}};function Wv(h){return h.split("-")[0]}function pv(h){return h.split("-")[1]}function XC(h){return["top","bottom"].indexOf(h)>=0?"x":"y"}function qM(h){var e,i=h.reference,s=h.element,o=h.placement,c=o?Wv(o):null,_=o?pv(o):null,j=i.x+i.width/2-s.width/2,et=i.y+i.height/2-s.height/2;switch(c){case Fn:e={x:j,y:i.y-s.height};break;case ir:e={x:j,y:i.y+i.height};break;case xn:e={x:i.x+i.width,y:et};break;case qn:e={x:i.x-s.width,y:et};break;default:e={x:i.x,y:i.y}}var nt=c?XC(c):null;if(nt!=null){var st=nt==="y"?"height":"width";switch(_){case Er:e[nt]=e[nt]-(i[st]/2-s[st]/2);break;case Or:e[nt]=e[nt]+(i[st]/2-s[st]/2)}}return e}var d1={name:"popperOffsets",enabled:!0,phase:"read",fn:function(h){var e=h.state,i=h.name;e.modifiersData[i]=qM({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},CP={top:"auto",right:"auto",bottom:"auto",left:"auto"};function UE(h){var e,i=h.popper,s=h.popperRect,o=h.placement,c=h.variation,_=h.offsets,j=h.position,et=h.gpuAcceleration,nt=h.adaptive,st=h.roundOffsets,at=h.isFixed,ct=_.x,dt=ct===void 0?0:ct,mt=_.y,yt=mt===void 0?0:mt,wt=typeof st=="function"?st({x:dt,y:yt}):{x:dt,y:yt};dt=wt.x,yt=wt.y;var Ct=_.hasOwnProperty("x"),bt=_.hasOwnProperty("y"),At=qn,Pt=Fn,Dt=window;if(nt){var Nt=$n(i),Vt="clientHeight",Zt="clientWidth";Nt===Tn(i)&&vr(Nt=Jr(i)).position!=="static"&&j==="absolute"&&(Vt="scrollHeight",Zt="scrollWidth"),(o===Fn||(o===qn||o===xn)&&c===Or)&&(Pt=ir,yt-=(at&&Nt===Dt&&Dt.visualViewport?Dt.visualViewport.height:Nt[Vt])-s.height,yt*=et?1:-1),o!==qn&&(o!==Fn&&o!==ir||c!==Or)||(At=xn,dt-=(at&&Nt===Dt&&Dt.visualViewport?Dt.visualViewport.width:Nt[Zt])-s.width,dt*=et?1:-1)}var an,fn=Object.assign({position:j},nt&&CP),mn=st===!0?function(Sn){var An=Sn.x,wn=Sn.y,Mn=window.devicePixelRatio||1;return{x:Ar(An*Mn)/Mn||0,y:Ar(wn*Mn)/Mn||0}}({x:dt,y:yt}):{x:dt,y:yt};return dt=mn.x,yt=mn.y,et?Object.assign({},fn,((an={})[Pt]=bt?"0":"",an[At]=Ct?"0":"",an.transform=(Dt.devicePixelRatio||1)<=1?"translate("+dt+"px, "+yt+"px)":"translate3d("+dt+"px, "+yt+"px, 0)",an)):Object.assign({},fn,((e={})[Pt]=bt?yt+"px":"",e[At]=Ct?dt+"px":"",e.transform="",e))}var YC={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(h){var e=h.state,i=h.options,s=i.gpuAcceleration,o=s===void 0||s,c=i.adaptive,_=c===void 0||c,j=i.roundOffsets,et=j===void 0||j,nt={placement:Wv(e.placement),variation:pv(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:o,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,UE(Object.assign({},nt,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:_,roundOffsets:et})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,UE(Object.assign({},nt,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:et})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},jn={name:"applyStyles",enabled:!0,phase:"write",fn:function(h){var e=h.state;Object.keys(e.elements).forEach(function(i){var s=e.styles[i]||{},o=e.attributes[i]||{},c=e.elements[i];nr(c)&&Pr(c)&&(Object.assign(c.style,s),Object.keys(o).forEach(function(_){var j=o[_];j===!1?c.removeAttribute(_):c.setAttribute(_,j===!0?"":j)}))})},effect:function(h){var e=h.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(s){var o=e.elements[s],c=e.attributes[s]||{},_=Object.keys(e.styles.hasOwnProperty(s)?e.styles[s]:i[s]).reduce(function(j,et){return j[et]="",j},{});nr(o)&&Pr(o)&&(Object.assign(o.style,_),Object.keys(c).forEach(function(j){o.removeAttribute(j)}))})}},requires:["computeStyles"]},Sr={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(h){var e=h.state,i=h.options,s=h.name,o=i.offset,c=o===void 0?[0,0]:o,_=lo.reduce(function(st,at){return st[at]=function(ct,dt,mt){var yt=Wv(ct),wt=[qn,Fn].indexOf(yt)>=0?-1:1,Ct=typeof mt=="function"?mt(Object.assign({},dt,{placement:ct})):mt,bt=Ct[0],At=Ct[1];return bt=bt||0,At=(At||0)*wt,[qn,xn].indexOf(yt)>=0?{x:At,y:bt}:{x:bt,y:At}}(at,e.rects,c),st},{}),j=_[e.placement],et=j.x,nt=j.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=et,e.modifiersData.popperOffsets.y+=nt),e.modifiersData[s]=_}},Lr={left:"right",right:"left",bottom:"top",top:"bottom"};function Dr(h){return h.replace(/left|right|bottom|top/g,function(e){return Lr[e]})}var Xr={start:"end",end:"start"};function Es(h){return h.replace(/start|end/g,function(e){return Xr[e]})}function ba(h,e){var i=e.getRootNode&&e.getRootNode();if(h.contains(e))return!0;if(i&&Qn(i)){var s=e;do{if(s&&h.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function Zs(h){return Object.assign({},h,{left:h.x,top:h.y,right:h.x+h.width,bottom:h.y+h.height})}function Vo(h,e,i){return e===ys?Zs(function(s,o){var c=Tn(s),_=Jr(s),j=c.visualViewport,et=_.clientWidth,nt=_.clientHeight,st=0,at=0;if(j){et=j.width,nt=j.height;var ct=Wr();(ct||!ct&&o==="fixed")&&(st=j.offsetLeft,at=j.offsetTop)}return{width:et,height:nt,x:st+rs(s),y:at}}(h,i)):Gn(e)?function(s,o){var c=is(s,!1,o==="fixed");return c.top=c.top+s.clientTop,c.left=c.left+s.clientLeft,c.bottom=c.top+s.clientHeight,c.right=c.left+s.clientWidth,c.width=s.clientWidth,c.height=s.clientHeight,c.x=c.left,c.y=c.top,c}(e,i):Zs(function(s){var o,c=Jr(s),_=Qr(s),j=(o=s.ownerDocument)==null?void 0:o.body,et=ur(c.scrollWidth,c.clientWidth,j?j.scrollWidth:0,j?j.clientWidth:0),nt=ur(c.scrollHeight,c.clientHeight,j?j.scrollHeight:0,j?j.clientHeight:0),st=-_.scrollLeft+rs(s),at=-_.scrollTop;return vr(j||c).direction==="rtl"&&(st+=ur(c.clientWidth,j?j.clientWidth:0)-et),{width:et,height:nt,x:st,y:at}}(Jr(h)))}function Vl(h){return Object.assign({},{top:0,right:0,bottom:0,left:0},h)}function $o(h,e){return e.reduce(function(i,s){return i[s]=h,i},{})}function Lo(h,e){e===void 0&&(e={});var i=e,s=i.placement,o=s===void 0?h.placement:s,c=i.strategy,_=c===void 0?h.strategy:c,j=i.boundary,et=j===void 0?ss:j,nt=i.rootBoundary,st=nt===void 0?ys:nt,at=i.elementContext,ct=at===void 0?Fs:at,dt=i.altBoundary,mt=dt!==void 0&&dt,yt=i.padding,wt=yt===void 0?0:yt,Ct=Vl(typeof wt!="number"?wt:$o(wt,Tr)),bt=ct===Fs?gs:Fs,At=h.rects.popper,Pt=h.elements[mt?bt:ct],Dt=function(An,wn,Mn,Pn){var On=wn==="clippingParents"?function(lr){var ar=Hn(as(lr)),Mr=["absolute","fixed"].indexOf(vr(lr).position)>=0&&nr(lr)?$n(lr):lr;return Gn(Mr)?ar.filter(function(xr){return Gn(xr)&&ba(xr,Mr)&&Pr(xr)!=="body"}):[]}(An):[].concat(wn),er=[].concat(On,[Mn]),Zn=er[0],yr=er.reduce(function(lr,ar){var Mr=Vo(An,ar,Pn);return lr.top=ur(Mr.top,lr.top),lr.right=Wn(Mr.right,lr.right),lr.bottom=Wn(Mr.bottom,lr.bottom),lr.left=ur(Mr.left,lr.left),lr},Vo(An,Zn,Pn));return yr.width=yr.right-yr.left,yr.height=yr.bottom-yr.top,yr.x=yr.left,yr.y=yr.top,yr}(Gn(Pt)?Pt:Pt.contextElement||Jr(h.elements.popper),et,st,_),Nt=is(h.elements.reference),Vt=qM({reference:Nt,element:At,strategy:"absolute",placement:o}),Zt=Zs(Object.assign({},At,Vt)),an=ct===Fs?Zt:Nt,fn={top:Dt.top-an.top+Ct.top,bottom:an.bottom-Dt.bottom+Ct.bottom,left:Dt.left-an.left+Ct.left,right:an.right-Dt.right+Ct.right},mn=h.modifiersData.offset;if(ct===Fs&&mn){var Sn=mn[o];Object.keys(fn).forEach(function(An){var wn=[xn,ir].indexOf(An)>=0?1:-1,Mn=[Fn,ir].indexOf(An)>=0?"y":"x";fn[An]+=Sn[Mn]*wn})}return fn}var lm={name:"flip",enabled:!0,phase:"main",fn:function(h){var e=h.state,i=h.options,s=h.name;if(!e.modifiersData[s]._skip){for(var o=i.mainAxis,c=o===void 0||o,_=i.altAxis,j=_===void 0||_,et=i.fallbackPlacements,nt=i.padding,st=i.boundary,at=i.rootBoundary,ct=i.altBoundary,dt=i.flipVariations,mt=dt===void 0||dt,yt=i.allowedAutoPlacements,wt=e.options.placement,Ct=Wv(wt),bt=et||(Ct!==wt&&mt?function(lr){if(Wv(lr)===Xn)return[];var ar=Dr(lr);return[Es(lr),ar,Es(ar)]}(wt):[Dr(wt)]),At=[wt].concat(bt).reduce(function(lr,ar){return lr.concat(Wv(ar)===Xn?function(Mr,xr){xr===void 0&&(xr={});var qr=xr,Zr=qr.placement,ds=qr.boundary,Hs=qr.rootBoundary,Ps=qr.padding,Os=qr.flipVariations,gr=qr.allowedAutoPlacements,kr=gr===void 0?lo:gr,$r=pv(Zr),co=$r?Os?uo:uo.filter(function(io){return pv(io)===$r}):Tr,Do=co.filter(function(io){return kr.indexOf(io)>=0});Do.length===0&&(Do=co);var _o=Do.reduce(function(io,so){return io[so]=Lo(Mr,{placement:so,boundary:ds,rootBoundary:Hs,padding:Ps})[Wv(so)],io},{});return Object.keys(_o).sort(function(io,so){return _o[io]-_o[so]})}(e,{placement:ar,boundary:st,rootBoundary:at,padding:nt,flipVariations:mt,allowedAutoPlacements:yt}):ar)},[]),Pt=e.rects.reference,Dt=e.rects.popper,Nt=new Map,Vt=!0,Zt=At[0],an=0;an<At.length;an++){var fn=At[an],mn=Wv(fn),Sn=pv(fn)===Er,An=[Fn,ir].indexOf(mn)>=0,wn=An?"width":"height",Mn=Lo(e,{placement:fn,boundary:st,rootBoundary:at,altBoundary:ct,padding:nt}),Pn=An?Sn?xn:qn:Sn?ir:Fn;Pt[wn]>Dt[wn]&&(Pn=Dr(Pn));var On=Dr(Pn),er=[];if(c&&er.push(Mn[mn]<=0),j&&er.push(Mn[Pn]<=0,Mn[On]<=0),er.every(function(lr){return lr})){Zt=fn,Vt=!1;break}Nt.set(fn,er)}if(Vt)for(var Zn=function(lr){var ar=At.find(function(Mr){var xr=Nt.get(Mr);if(xr)return xr.slice(0,lr).every(function(qr){return qr})});if(ar)return Zt=ar,"break"},yr=mt?3:1;yr>0&&Zn(yr)!=="break";yr--);e.placement!==Zt&&(e.modifiersData[s]._skip=!0,e.placement=Zt,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Wp(h,e,i){return ur(h,Wn(e,i))}var qu={name:"preventOverflow",enabled:!0,phase:"main",fn:function(h){var e=h.state,i=h.options,s=h.name,o=i.mainAxis,c=o===void 0||o,_=i.altAxis,j=_!==void 0&&_,et=i.boundary,nt=i.rootBoundary,st=i.altBoundary,at=i.padding,ct=i.tether,dt=ct===void 0||ct,mt=i.tetherOffset,yt=mt===void 0?0:mt,wt=Lo(e,{boundary:et,rootBoundary:nt,padding:at,altBoundary:st}),Ct=Wv(e.placement),bt=pv(e.placement),At=!bt,Pt=XC(Ct),Dt=Pt==="x"?"y":"x",Nt=e.modifiersData.popperOffsets,Vt=e.rects.reference,Zt=e.rects.popper,an=typeof yt=="function"?yt(Object.assign({},e.rects,{placement:e.placement})):yt,fn=typeof an=="number"?{mainAxis:an,altAxis:an}:Object.assign({mainAxis:0,altAxis:0},an),mn=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,Sn={x:0,y:0};if(Nt){if(c){var An,wn=Pt==="y"?Fn:qn,Mn=Pt==="y"?ir:xn,Pn=Pt==="y"?"height":"width",On=Nt[Pt],er=On+wt[wn],Zn=On-wt[Mn],yr=dt?-Zt[Pn]/2:0,lr=bt===Er?Vt[Pn]:Zt[Pn],ar=bt===Er?-Zt[Pn]:-Vt[Pn],Mr=e.elements.arrow,xr=dt&&Mr?zr(Mr):{width:0,height:0},qr=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},Zr=qr[wn],ds=qr[Mn],Hs=Wp(0,Vt[Pn],xr[Pn]),Ps=At?Vt[Pn]/2-yr-Hs-Zr-fn.mainAxis:lr-Hs-Zr-fn.mainAxis,Os=At?-Vt[Pn]/2+yr+Hs+ds+fn.mainAxis:ar+Hs+ds+fn.mainAxis,gr=e.elements.arrow&&$n(e.elements.arrow),kr=gr?Pt==="y"?gr.clientTop||0:gr.clientLeft||0:0,$r=(An=mn==null?void 0:mn[Pt])!=null?An:0,co=On+Os-$r,Do=Wp(dt?Wn(er,On+Ps-$r-kr):er,On,dt?ur(Zn,co):Zn);Nt[Pt]=Do,Sn[Pt]=Do-On}if(j){var _o,io=Pt==="x"?Fn:qn,so=Pt==="x"?ir:xn,ws=Nt[Dt],dr=Dt==="y"?"height":"width",Yr=ws+wt[io],Cs=ws-wt[so],Ur=[Fn,qn].indexOf(Ct)!==-1,qs=(_o=mn==null?void 0:mn[Dt])!=null?_o:0,bu=Ur?Yr:ws-Vt[dr]-Zt[dr]-qs+fn.altAxis,Lu=Ur?ws+Vt[dr]+Zt[dr]-qs-fn.altAxis:Cs,yp=dt&&Ur?function(Sm,$m,dm){var ho=Wp(Sm,$m,dm);return ho>dm?dm:ho}(bu,ws,Lu):Wp(dt?bu:Yr,ws,dt?Lu:Cs);Nt[Dt]=yp,Sn[Dt]=yp-ws}e.modifiersData[s]=Sn}},requiresIfExists:["offset"]},Uw={name:"arrow",enabled:!0,phase:"main",fn:function(h){var e,i=h.state,s=h.name,o=h.options,c=i.elements.arrow,_=i.modifiersData.popperOffsets,j=Wv(i.placement),et=XC(j),nt=[qn,xn].indexOf(j)>=0?"height":"width";if(c&&_){var st=function(Zt,an){return Vl(typeof(Zt=typeof Zt=="function"?Zt(Object.assign({},an.rects,{placement:an.placement})):Zt)!="number"?Zt:$o(Zt,Tr))}(o.padding,i),at=zr(c),ct=et==="y"?Fn:qn,dt=et==="y"?ir:xn,mt=i.rects.reference[nt]+i.rects.reference[et]-_[et]-i.rects.popper[nt],yt=_[et]-i.rects.reference[et],wt=$n(c),Ct=wt?et==="y"?wt.clientHeight||0:wt.clientWidth||0:0,bt=mt/2-yt/2,At=st[ct],Pt=Ct-at[nt]-st[dt],Dt=Ct/2-at[nt]/2+bt,Nt=Wp(At,Dt,Pt),Vt=et;i.modifiersData[s]=((e={})[Vt]=Nt,e.centerOffset=Nt-Dt,e)}},effect:function(h){var e=h.state,i=h.options.element,s=i===void 0?"[data-popper-arrow]":i;s!=null&&(typeof s!="string"||(s=e.elements.popper.querySelector(s)))&&ba(e.elements.popper,s)&&(e.elements.arrow=s)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Cu(h,e,i){return i===void 0&&(i={x:0,y:0}),{top:h.top-e.height-i.y,right:h.right-e.width+i.x,bottom:h.bottom-e.height+i.y,left:h.left-e.width-i.x}}function tp(h){return[Fn,xn,ir,qn].some(function(e){return h[e]>=0})}var T0={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(h){var e=h.state,i=h.name,s=e.rects.reference,o=e.rects.popper,c=e.modifiersData.preventOverflow,_=Lo(e,{elementContext:"reference"}),j=Lo(e,{altBoundary:!0}),et=Cu(_,s),nt=Cu(j,o,c),st=tp(et),at=tp(nt);e.modifiersData[i]={referenceClippingOffsets:et,popperEscapeOffsets:nt,isReferenceHidden:st,hasPopperEscaped:at},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":st,"data-popper-escaped":at})}},fp=NE({defaultModifiers:[qC,d1,YC,jn,Sr,lm,qu,Uw,T0]}),fo="tippy-box",np="tippy-content",XM="tippy-backdrop",TP="tippy-arrow",MP="tippy-svg-arrow",M0={passive:!0,capture:!0},IP=function(){return document.body};function YM(h,e,i){if(Array.isArray(h)){var s=h[e];return s??(Array.isArray(i)?i[e]:i)}return h}function $M(h,e){var i={}.toString.call(h);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function PP(h,e){return typeof h=="function"?h.apply(void 0,e):h}function RP(h,e){return e===0?h:function(s){clearTimeout(i),i=setTimeout(function(){h(s)},e)};var i}function Fw(h){return[].concat(h)}function KM(h,e){h.indexOf(e)===-1&&h.push(e)}function $C(h){return[].slice.call(h)}function $l(h){return Object.keys(h).reduce(function(e,i){return h[i]!==void 0&&(e[i]=h[i]),e},{})}function p1(){return document.createElement("div")}function fv(h){return["Element","Fragment"].some(function(e){return $M(h,e)})}function wy(h,e){h.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function JM(h,e){h.forEach(function(i){i&&i.setAttribute("data-state",e)})}function jw(h,e,i){var s=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(o){h[s](o,i)})}function KC(h,e){for(var i=e;i;){var s;if(h.contains(i))return!0;i=i.getRootNode==null||(s=i.getRootNode())==null?void 0:s.host}return!1}var yu={isTouch:!1},EA=0;function ZM(){yu.isTouch||(yu.isTouch=!0,window.performance&&document.addEventListener("mousemove",qv))}function qv(){var h=performance.now();h-EA<20&&(yu.isTouch=!1,document.removeEventListener("mousemove",qv)),EA=h}function Xv(){var h,e=document.activeElement;if((h=e)&&h._tippy&&h._tippy.reference===h){var i=e._tippy;e.blur&&!i.state.isVisible&&e.blur()}}var DP=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),Au=Object.assign({appendTo:IP,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),FE=Object.keys(Au);function kP(h){var e=(h.plugins||[]).reduce(function(i,s){var o,c=s.name,_=s.defaultValue;return c&&(i[c]=h[c]!==void 0?h[c]:(o=Au[c])!=null?o:_),i},{});return Object.assign({},h,e)}function eI(h,e){var i=Object.assign({},e,{content:PP(e.content,[h])},e.ignoreAttributes?{}:function(s,o){return(o?Object.keys(kP(Object.assign({},Au,{plugins:o}))):FE).reduce(function(c,_){var j=(s.getAttribute("data-tippy-"+_)||"").trim();if(!j)return c;if(_==="content")c[_]=j;else try{c[_]=JSON.parse(j)}catch{c[_]=j}return c},{})}(h,e.plugins));return i.aria=Object.assign({},Au.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var f4=function(){return"innerHTML"};function FO(h,e){h[f4()]=e}function e3(h){var e=p1();return h===!0?e.className=TP:(e.className=MP,fv(h)?e.appendChild(h):FO(e,h)),e}function t3(h,e){fv(e.content)?(FO(h,""),h.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?FO(h,e.content):h.textContent=e.content)}function jO(h){var e=h.firstElementChild,i=$C(e.children);return{box:e,content:i.find(function(s){return s.classList.contains(np)}),arrow:i.find(function(s){return s.classList.contains(TP)||s.classList.contains(MP)}),backdrop:i.find(function(s){return s.classList.contains(XM)})}}function n3(h){var e=p1(),i=p1();i.className=fo,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var s=p1();function o(c,_){var j=jO(e),et=j.box,nt=j.content,st=j.arrow;_.theme?et.setAttribute("data-theme",_.theme):et.removeAttribute("data-theme"),typeof _.animation=="string"?et.setAttribute("data-animation",_.animation):et.removeAttribute("data-animation"),_.inertia?et.setAttribute("data-inertia",""):et.removeAttribute("data-inertia"),et.style.maxWidth=typeof _.maxWidth=="number"?_.maxWidth+"px":_.maxWidth,_.role?et.setAttribute("role",_.role):et.removeAttribute("role"),c.content===_.content&&c.allowHTML===_.allowHTML||t3(nt,h.props),_.arrow?st?c.arrow!==_.arrow&&(et.removeChild(st),et.appendChild(e3(_.arrow))):et.appendChild(e3(_.arrow)):st&&et.removeChild(st)}return s.className=np,s.setAttribute("data-state","hidden"),t3(s,h.props),e.appendChild(i),i.appendChild(s),o(h.props,h.props),{popper:e,onUpdate:o}}n3.$$tippy=!0;var m4=1,OP=[],zO=[];function g4(h,e){var i,s,o,c,_,j,et,nt,st=eI(h,Object.assign({},Au,kP($l(e)))),at=!1,ct=!1,dt=!1,mt=!1,yt=[],wt=RP(gr,st.interactiveDebounce),Ct=m4++,bt=(nt=st.plugins).filter(function(dr,Yr){return nt.indexOf(dr)===Yr}),At={id:Ct,reference:h,popper:p1(),popperInstance:null,props:st,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:bt,clearDelayTimeouts:function(){clearTimeout(i),clearTimeout(s),cancelAnimationFrame(o)},setProps:function(dr){if(!At.state.isDestroyed){On("onBeforeUpdate",[At,dr]),Ps();var Yr=At.props,Cs=eI(h,Object.assign({},Yr,$l(dr),{ignoreAttributes:!0}));At.props=Cs,Hs(),Yr.interactiveDebounce!==Cs.interactiveDebounce&&(yr(),wt=RP(gr,Cs.interactiveDebounce)),Yr.triggerTarget&&!Cs.triggerTarget?Fw(Yr.triggerTarget).forEach(function(Ur){Ur.removeAttribute("aria-expanded")}):Cs.triggerTarget&&h.removeAttribute("aria-expanded"),Zn(),Pn(),Nt&&Nt(Yr,Cs),At.popperInstance&&(Do(),io().forEach(function(Ur){requestAnimationFrame(Ur._tippy.popperInstance.forceUpdate)})),On("onAfterUpdate",[At,dr])}},setContent:function(dr){At.setProps({content:dr})},show:function(){var dr=At.state.isVisible,Yr=At.state.isDestroyed,Cs=!At.state.isEnabled,Ur=yu.isTouch&&!At.props.touch,qs=YM(At.props.duration,0,Au.duration);if(!(dr||Yr||Cs||Ur||Sn().hasAttribute("disabled")||(On("onShow",[At],!1),At.props.onShow(At)===!1))){if(At.state.isVisible=!0,mn()&&(Dt.style.visibility="visible"),Pn(),xr(),At.state.isMounted||(Dt.style.transition="none"),mn()){var bu=wn();wy([bu.box,bu.content],0)}var Lu,yp,Sm;j=function(){var $m;if(At.state.isVisible&&!mt){if(mt=!0,Dt.offsetHeight,Dt.style.transition=At.props.moveTransition,mn()&&At.props.animation){var dm=wn(),ho=dm.box,G_=dm.content;wy([ho,G_],qs),JM([ho,G_],"visible")}er(),Zn(),KM(zO,At),($m=At.popperInstance)==null||$m.forceUpdate(),On("onMount",[At]),At.props.animation&&mn()&&function(hx,Ln){Zr(hx,function(){At.state.isShown=!0,On("onShown",[At])})}(qs)}},yp=At.props.appendTo,Sm=Sn(),(Lu=At.props.interactive&&yp===IP||yp==="parent"?Sm.parentNode:PP(yp,[Sm])).contains(Dt)||Lu.appendChild(Dt),At.state.isMounted=!0,Do()}},hide:function(){var dr=!At.state.isVisible,Yr=At.state.isDestroyed,Cs=!At.state.isEnabled,Ur=YM(At.props.duration,1,Au.duration);if(!(dr||Yr||Cs)&&(On("onHide",[At],!1),At.props.onHide(At)!==!1)){if(At.state.isVisible=!1,At.state.isShown=!1,mt=!1,at=!1,mn()&&(Dt.style.visibility="hidden"),yr(),qr(),Pn(!0),mn()){var qs=wn(),bu=qs.box,Lu=qs.content;At.props.animation&&(wy([bu,Lu],Ur),JM([bu,Lu],"hidden"))}er(),Zn(),At.props.animation?mn()&&function(yp,Sm){Zr(yp,function(){!At.state.isVisible&&Dt.parentNode&&Dt.parentNode.contains(Dt)&&Sm()})}(Ur,At.unmount):At.unmount()}},hideWithInteractivity:function(dr){An().addEventListener("mousemove",wt),KM(OP,wt),wt(dr)},enable:function(){At.state.isEnabled=!0},disable:function(){At.hide(),At.state.isEnabled=!1},unmount:function(){At.state.isVisible&&At.hide(),At.state.isMounted&&(_o(),io().forEach(function(dr){dr._tippy.unmount()}),Dt.parentNode&&Dt.parentNode.removeChild(Dt),zO=zO.filter(function(dr){return dr!==At}),At.state.isMounted=!1,On("onHidden",[At]))},destroy:function(){At.state.isDestroyed||(At.clearDelayTimeouts(),At.unmount(),Ps(),delete h._tippy,At.state.isDestroyed=!0,On("onDestroy",[At]))}};if(!st.render)return At;var Pt=st.render(At),Dt=Pt.popper,Nt=Pt.onUpdate;Dt.setAttribute("data-tippy-root",""),Dt.id="tippy-"+At.id,At.popper=Dt,h._tippy=At,Dt._tippy=At;var Vt=bt.map(function(dr){return dr.fn(At)}),Zt=h.hasAttribute("aria-expanded");return Hs(),Zn(),Pn(),On("onCreate",[At]),st.showOnCreate&&so(),Dt.addEventListener("mouseenter",function(){At.props.interactive&&At.state.isVisible&&At.clearDelayTimeouts()}),Dt.addEventListener("mouseleave",function(){At.props.interactive&&At.props.trigger.indexOf("mouseenter")>=0&&An().addEventListener("mousemove",wt)}),At;function an(){var dr=At.props.touch;return Array.isArray(dr)?dr:[dr,0]}function fn(){return an()[0]==="hold"}function mn(){var dr;return!((dr=At.props.render)==null||!dr.$$tippy)}function Sn(){return et||h}function An(){var dr,Yr,Cs=Sn().parentNode;return Cs&&(Yr=Fw(Cs)[0])!=null&&(dr=Yr.ownerDocument)!=null&&dr.body?Yr.ownerDocument:document}function wn(){return jO(Dt)}function Mn(dr){return At.state.isMounted&&!At.state.isVisible||yu.isTouch||c&&c.type==="focus"?0:YM(At.props.delay,dr?0:1,Au.delay)}function Pn(dr){dr===void 0&&(dr=!1),Dt.style.pointerEvents=At.props.interactive&&!dr?"":"none",Dt.style.zIndex=""+At.props.zIndex}function On(dr,Yr,Cs){var Ur;Cs===void 0&&(Cs=!0),Vt.forEach(function(qs){qs[dr]&&qs[dr].apply(qs,Yr)}),Cs&&(Ur=At.props)[dr].apply(Ur,Yr)}function er(){var dr=At.props.aria;if(dr.content){var Yr="aria-"+dr.content,Cs=Dt.id;Fw(At.props.triggerTarget||h).forEach(function(Ur){var qs=Ur.getAttribute(Yr);if(At.state.isVisible)Ur.setAttribute(Yr,qs?qs+" "+Cs:Cs);else{var bu=qs&&qs.replace(Cs,"").trim();bu?Ur.setAttribute(Yr,bu):Ur.removeAttribute(Yr)}})}}function Zn(){!Zt&&At.props.aria.expanded&&Fw(At.props.triggerTarget||h).forEach(function(dr){At.props.interactive?dr.setAttribute("aria-expanded",At.state.isVisible&&dr===Sn()?"true":"false"):dr.removeAttribute("aria-expanded")})}function yr(){An().removeEventListener("mousemove",wt),OP=OP.filter(function(dr){return dr!==wt})}function lr(dr){if(!yu.isTouch||!dt&&dr.type!=="mousedown"){var Yr=dr.composedPath&&dr.composedPath()[0]||dr.target;if(!At.props.interactive||!KC(Dt,Yr)){if(Fw(At.props.triggerTarget||h).some(function(Cs){return KC(Cs,Yr)})){if(yu.isTouch||At.state.isVisible&&At.props.trigger.indexOf("click")>=0)return}else On("onClickOutside",[At,dr]);At.props.hideOnClick===!0&&(At.clearDelayTimeouts(),At.hide(),ct=!0,setTimeout(function(){ct=!1}),At.state.isMounted||qr())}}}function ar(){dt=!0}function Mr(){dt=!1}function xr(){var dr=An();dr.addEventListener("mousedown",lr,!0),dr.addEventListener("touchend",lr,M0),dr.addEventListener("touchstart",Mr,M0),dr.addEventListener("touchmove",ar,M0)}function qr(){var dr=An();dr.removeEventListener("mousedown",lr,!0),dr.removeEventListener("touchend",lr,M0),dr.removeEventListener("touchstart",Mr,M0),dr.removeEventListener("touchmove",ar,M0)}function Zr(dr,Yr){var Cs=wn().box;function Ur(qs){qs.target===Cs&&(jw(Cs,"remove",Ur),Yr())}if(dr===0)return Yr();jw(Cs,"remove",_),jw(Cs,"add",Ur),_=Ur}function ds(dr,Yr,Cs){Cs===void 0&&(Cs=!1),Fw(At.props.triggerTarget||h).forEach(function(Ur){Ur.addEventListener(dr,Yr,Cs),yt.push({node:Ur,eventType:dr,handler:Yr,options:Cs})})}function Hs(){var dr;fn()&&(ds("touchstart",Os,{passive:!0}),ds("touchend",kr,{passive:!0})),(dr=At.props.trigger,dr.split(/\s+/).filter(Boolean)).forEach(function(Yr){if(Yr!=="manual")switch(ds(Yr,Os),Yr){case"mouseenter":ds("mouseleave",kr);break;case"focus":ds(DP?"focusout":"blur",$r);break;case"focusin":ds("focusout",$r)}})}function Ps(){yt.forEach(function(dr){var Yr=dr.node,Cs=dr.eventType,Ur=dr.handler,qs=dr.options;Yr.removeEventListener(Cs,Ur,qs)}),yt=[]}function Os(dr){var Yr,Cs=!1;if(At.state.isEnabled&&!co(dr)&&!ct){var Ur=((Yr=c)==null?void 0:Yr.type)==="focus";c=dr,et=dr.currentTarget,Zn(),!At.state.isVisible&&$M(dr,"MouseEvent")&&OP.forEach(function(qs){return qs(dr)}),dr.type==="click"&&(At.props.trigger.indexOf("mouseenter")<0||at)&&At.props.hideOnClick!==!1&&At.state.isVisible?Cs=!0:so(dr),dr.type==="click"&&(at=!Cs),Cs&&!Ur&&ws(dr)}}function gr(dr){var Yr=dr.target,Cs=Sn().contains(Yr)||Dt.contains(Yr);if(dr.type!=="mousemove"||!Cs){var Ur=io().concat(Dt).map(function(qs){var bu,Lu=(bu=qs._tippy.popperInstance)==null?void 0:bu.state;return Lu?{popperRect:qs.getBoundingClientRect(),popperState:Lu,props:st}:null}).filter(Boolean);(function(qs,bu){var Lu=bu.clientX,yp=bu.clientY;return qs.every(function(Sm){var $m=Sm.popperRect,dm=Sm.popperState,ho=Sm.props.interactiveBorder,G_=dm.placement.split("-")[0],hx=dm.modifiersData.offset;if(!hx)return!0;var Ln=G_==="bottom"?hx.top.y:0,or=G_==="top"?hx.bottom.y:0,mr=G_==="right"?hx.left.x:0,Vr=G_==="left"?hx.right.x:0,Kr=$m.top-yp+Ln>ho,_r=yp-$m.bottom-or>ho,Gr=$m.left-Lu+mr>ho,Is=Lu-$m.right-Vr>ho;return Kr||_r||Gr||Is})})(Ur,dr)&&(yr(),ws(dr))}}function kr(dr){co(dr)||At.props.trigger.indexOf("click")>=0&&at||(At.props.interactive?At.hideWithInteractivity(dr):ws(dr))}function $r(dr){At.props.trigger.indexOf("focusin")<0&&dr.target!==Sn()||At.props.interactive&&dr.relatedTarget&&Dt.contains(dr.relatedTarget)||ws(dr)}function co(dr){return!!yu.isTouch&&fn()!==dr.type.indexOf("touch")>=0}function Do(){_o();var dr=At.props,Yr=dr.popperOptions,Cs=dr.placement,Ur=dr.offset,qs=dr.getReferenceClientRect,bu=dr.moveTransition,Lu=mn()?jO(Dt).arrow:null,yp=qs?{getBoundingClientRect:qs,contextElement:qs.contextElement||Sn()}:h,Sm=[{name:"offset",options:{offset:Ur}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!bu}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function($m){var dm=$m.state;if(mn()){var ho=wn().box;["placement","reference-hidden","escaped"].forEach(function(G_){G_==="placement"?ho.setAttribute("data-placement",dm.placement):dm.attributes.popper["data-popper-"+G_]?ho.setAttribute("data-"+G_,""):ho.removeAttribute("data-"+G_)}),dm.attributes.popper={}}}}];mn()&&Lu&&Sm.push({name:"arrow",options:{element:Lu,padding:3}}),Sm.push.apply(Sm,(Yr==null?void 0:Yr.modifiers)||[]),At.popperInstance=fp(yp,Dt,Object.assign({},Yr,{placement:Cs,onFirstUpdate:j,modifiers:Sm}))}function _o(){At.popperInstance&&(At.popperInstance.destroy(),At.popperInstance=null)}function io(){return $C(Dt.querySelectorAll("[data-tippy-root]"))}function so(dr){At.clearDelayTimeouts(),dr&&On("onTrigger",[At,dr]),xr();var Yr=Mn(!0),Cs=an(),Ur=Cs[0],qs=Cs[1];yu.isTouch&&Ur==="hold"&&qs&&(Yr=qs),Yr?i=setTimeout(function(){At.show()},Yr):At.show()}function ws(dr){if(At.clearDelayTimeouts(),On("onUntrigger",[At,dr]),At.state.isVisible){if(!(At.props.trigger.indexOf("mouseenter")>=0&&At.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(dr.type)>=0&&at)){var Yr=Mn(!1);Yr?s=setTimeout(function(){At.state.isVisible&&At.hide()},Yr):o=requestAnimationFrame(function(){At.hide()})}}else qr()}}function JC(h,e){e===void 0&&(e={});var i=Au.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",ZM,M0),window.addEventListener("blur",Xv);var s,o=Object.assign({},e,{plugins:i}),c=(s=h,fv(s)?[s]:function(_){return $M(_,"NodeList")}(s)?$C(s):Array.isArray(s)?s:$C(document.querySelectorAll(s))).reduce(function(_,j){var et=j&&g4(j,o);return et&&_.push(et),_},[]);return fv(h)?c[0]:c}JC.defaultProps=Au,JC.setDefaultProps=function(h){Object.keys(h).forEach(function(e){Au[e]=h[e]})},JC.currentInput=yu;var _4=Object.assign({},jn,{effect:function(h){var e=h.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow)}}),v4=function(h,e){var i;e===void 0&&(e={});var s,o=h,c=[],_=[],j=e.overrides,et=[],nt=!1;function st(){_=o.map(function(Nt){return Fw(Nt.props.triggerTarget||Nt.reference)}).reduce(function(Nt,Vt){return Nt.concat(Vt)},[])}function at(){c=o.map(function(Nt){return Nt.reference})}function ct(Nt){o.forEach(function(Vt){Nt?Vt.enable():Vt.disable()})}function dt(Nt){return o.map(function(Vt){var Zt=Vt.setProps;return Vt.setProps=function(an){Zt(an),Vt.reference===s&&Nt.setProps(an)},function(){Vt.setProps=Zt}})}function mt(Nt,Vt){var Zt=_.indexOf(Vt);if(Vt!==s){s=Vt;var an=(j||[]).concat("content").reduce(function(fn,mn){return fn[mn]=o[Zt].props[mn],fn},{});Nt.setProps(Object.assign({},an,{getReferenceClientRect:typeof an.getReferenceClientRect=="function"?an.getReferenceClientRect:function(){var fn;return(fn=c[Zt])==null?void 0:fn.getBoundingClientRect()}}))}}ct(!1),at(),st();var yt,wt,Ct,bt={fn:function(){return{onDestroy:function(){ct(!0)},onHidden:function(){s=null},onClickOutside:function(Nt){Nt.props.showOnCreate&&!nt&&(nt=!0,s=null)},onShow:function(Nt){Nt.props.showOnCreate&&!nt&&(nt=!0,mt(Nt,c[0]))},onTrigger:function(Nt,Vt){mt(Nt,Vt.currentTarget)}}}},At=JC(p1(),Object.assign({},(yt=e,wt=["overrides"],Ct=Object.assign({},yt),wt.forEach(function(Nt){delete Ct[Nt]}),Ct),{plugins:[bt].concat(e.plugins||[]),triggerTarget:_,popperOptions:Object.assign({},e.popperOptions,{modifiers:[].concat(((i=e.popperOptions)==null?void 0:i.modifiers)||[],[_4])})})),Pt=At.show;At.show=function(Nt){if(Pt(),!s&&Nt==null)return mt(At,c[0]);if(!s||Nt!=null){if(typeof Nt=="number")return c[Nt]&&mt(At,c[Nt]);if(o.indexOf(Nt)>=0){var Vt=Nt.reference;return mt(At,Vt)}return c.indexOf(Nt)>=0?mt(At,Nt):void 0}},At.showNext=function(){var Nt=c[0];if(!s)return At.show(0);var Vt=c.indexOf(s);At.show(c[Vt+1]||Nt)},At.showPrevious=function(){var Nt=c[c.length-1];if(!s)return At.show(Nt);var Vt=c.indexOf(s),Zt=c[Vt-1]||Nt;At.show(Zt)};var Dt=At.setProps;return At.setProps=function(Nt){j=Nt.overrides||j,Dt(Nt)},At.setInstances=function(Nt){ct(!0),et.forEach(function(Vt){return Vt()}),o=Nt,ct(!1),at(),st(),et=dt(At),At.setProps({triggerTarget:_})},et=dt(At),At};JC.setDefaultProps({render:n3});var f1=JC;class L_{static _initialize(){this._inited=!0,(0,b.createStyles)(b.css`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&e.button===0&&this.Remove()})}static Create(e,i,s){this._inited||this._initialize(),this.Element&&this.Remove();const o=(0,b.createDiv)({id:"customContextMenu",addToBody:!1});o.style.top=s+"px",o.style.left=i+"px";for(const[c,_]of Object.entries(e)){const j=(0,b.createDiv)({classList:["customContextMenuItems"],addToBody:!1,innerHTML:c});o.appendChild(j),j.onclick=_}return this.Element=o,o}static Remove(){var e;(e=this.Element)==null||e.remove(),this.Element=void 0}}L_.Element=void 0,L_._inited=!1;class zw extends Rn{async _refreshUi(){var e;if(!await super._refreshUi())return!1;Cn.RemoveAll(zw.PluginType);for(const i of this.variations)Cn.Create(zw.PluginType,i.title,5,20,0,i.materials.map(s=>{let o;if(i.preview.startsWith("generate:"))o=this._previewGenerator.generate(s,i.preview.split(":")[1]);else{const c=s[i.preview]||"#ff00ff";o=c.image?(0,b.imageBitmapToBase64)(c.image,100):void 0,o||(o=(0,b.makeColorSvgCircle)(c!=null&&c.isColor?c.getHexString():c))}return{id:s.uuid,image:o,onClick:c=>this.applyVariation(i,c),tooltip:s.name||s.uuid}}),(s,o)=>{f1(s,{placement:"bottom",content:o.tooltip}),s.oncontextmenu=c=>{c.preventDefault(),c.stopPropagation();const _=L_.Create({Remove:()=>{i.materials=i.materials.filter(j=>j.uuid!==o.id),this.refreshUi(),L_.Remove()}},c.clientX,c.clientY);document.body.appendChild(_)}});return Cn.RebuildUi((e=this._viewer)==null?void 0:e.container),!0}}zw.PluginType="MaterialConfiguratorPlugin";class VO extends ms{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._isVisibleChanged=!1,this.dependencies=[Fr],this.variations=[],this._selectedSwitchNode=()=>{var o;const e=(o=this._picking)==null?void 0:o.getSelectedObject();if(!e)return;const i=this.variations.map(c=>c.name);let s;return e.traverseAncestors(c=>{s||c.name&&i.includes(c.name)&&(s=c)}),s},this.uiConfig={label:"Switch Node",type:"folder",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"]},()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var i,s;await super.onAdded(e),this._picking=(i=this._viewer)==null?void 0:i.getPluginByType("Picking"),(s=this._picking)==null||s.addEventListener("selectedObjectChanged",()=>{var o,c;(c=(o=this.uiConfig).uiRefresh)==null||c.call(o)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer&&this.enabled){for(const o of this.variations){if(!o.name)continue;const c=this._viewer.scene.getObjectByName(o.name);if(!c||c.children.length<1)return;o.selected||(o.selected=c.children[0].name||c.children[0].uuid);for(const _ of c.children)_.userData.__oldVisible=_.visible,_.visible=(_.name||_.uuid)===o.selected}this._isVisibleChanged=!0}}),e.addEventListener("postRender",()=>{if(this._viewer&&this._isVisibleChanged){for(const o of this.variations){if(!o.name)continue;const c=this._viewer.scene.getObjectByName(o.name);if(!c||c.children.length<1)return;for(const _ of c.children){if(_.userData.__oldVisible===void 0)return;_.visible=_.userData.__oldVisible,delete _.userData.__oldVisible}}this._isVisibleChanged=!1}}),this.addEventListener("deserialize",async()=>{this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,i;return!!this.enabled&&!!this._viewer&&(this._uiNeedRefresh=!1,(i=(e=this.uiConfig).uiRefresh)==null||i.call(e),!0)}}(function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);c>3&&_&&Object.defineProperty(e,i,_)})([En()],VO.prototype,"variations",void 0);class Vw extends VO{_refreshUi(){var e;if(!super._refreshUi())return!1;Cn.RemoveAll(Vw.PluginType);for(const i of this.variations){const s=this._viewer.scene.getObjectByName(i.name);s?(s.children.length<1&&console.warn("SwitchNode does not have enough children",i),Cn.Create(Vw.PluginType,i.title,Math.min(5,s.children.length),20,0,s.children.map(o=>{const c=i.camView,_=new g.Pa4((c.includes("right")?1:0)-(c.includes("left")?1:0),(c.includes("top")?1:0)-(c.includes("bottom")?1:0),(c.includes("front")?1:0)-(c.includes("back")?1:0));i.camDistance||(i.camDistance=1);const j=rn(this._viewer,o,void 0,7,_.multiplyScalar(.5*i.camDistance));return{id:o.uuid,image:j,onClick:()=>{var et;i.selected=o.name||o.uuid,(et=this._viewer)==null||et.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:o.name||o.uuid}}),(o,c)=>f1(o,{placement:"bottom",content:c.tooltip}))):console.warn("no object found for variation, skipping",i)}return Cn.RebuildUi((e=this._viewer)==null?void 0:e.container),!0}}Vw.PluginType="SwitchNodePlugin";class BP extends ms{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||i.call(e,"postFrame",!0))},this.dependencies=[Fr],this._selectedObject=()=>{var e;return((e=this._picking)==null?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())==null?void 0:e.material)||void 0}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)==null?void 0:i.getPluginByType("Picking"),this._previewGenerator=new cn(this._viewer),(s=this._picking)==null||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var i,s;return(i=this._previewGenerator)==null||i.dispose(),this._previewGenerator=void 0,(s=this._picking)==null||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}BP.PluginType="MaterialLibraryBasePlugin",function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);c>3&&_&&Object.defineProperty(e,i,_)}([jr("Enabled")],BP.prototype,"enabled",void 0);class SA extends BP{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:Bp(),children:[...Q_(this),()=>({type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(Fr).materials.getAllMaterials().map(e=>({label:e.name||e.uuid,value:e.uuid}))||[]]],getValue:()=>{var e;return(e=this._selectedMaterial())==null?void 0:e.uuid},setValue:e=>{var s,o,c,_,j;const i=(c=(o=(s=this._viewer)==null?void 0:s.getPlugin(Fr))==null?void 0:o.materials)==null?void 0:c.findMaterial(e);if(i)if(this.replaceMaterial)(j=(_=this._selectedObject())==null?void 0:_.setMaterial)==null||j.call(_,i);else{const et=this._selectedMaterial();if(et){const nt=et.name,st=et.uuid;et.copyProps(i),et.name=nt,et.uuid=st,et.userData.uuid&&(et.userData.uuid=st)}}this._refreshUi()}})]}}async _refreshUi(){var o,c,_;if(!await super._refreshUi())return!1;const e=[bp.TypeSlug,_a.TypeSlug],i=(c=(o=this._viewer)==null?void 0:o.getPlugin(Fr))==null?void 0:c.materials,s=e.map(j=>[j,i==null?void 0:i.getMaterialsOfType(j)]);Cn.RemoveAll(SA.PluginType);for(const[j,et]of s)Cn.Create(SA.PluginType,j,5,20,0,et==null?void 0:et.filter(nt=>!nt.userData.__runtimeMaterial).map(nt=>{let st;const at="generate:sphere";if(at.startsWith("generate:"))st=this._previewGenerator.generate(nt,at.split(":")[1]);else{const ct=nt[at]||"#ff00ff";st=ct.image?(0,b.imageBitmapToBase64)(ct.image,100):void 0,st||(st=(0,b.makeColorSvg)(ct))}return{id:nt.uuid,image:st,onClick:ct=>{const dt=i==null?void 0:i.findMaterial(ct);if(dt){const mt=dt.userData.__appliedMeshes;if(mt!=null&&mt.size){const yt=mt.keys().next().value;yt.dispatchEvent({type:"select",value:yt})}}},tooltip:nt.name||nt.uuid}}),(nt,st)=>f1(nt,{placement:"bottom",content:st.tooltip}));return Cn.RebuildUi((_=this._viewer)==null?void 0:_.container),!0}}SA.PluginType="MaterialLibraryPlugin",function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);c>3&&_&&Object.defineProperty(e,i,_)}([jr("Replace Material")],SA.prototype,"replaceMaterial",void 0);class GO extends g.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,i){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",b.glsl`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);c>3&&_&&Object.defineProperty(e,i,_)})([cr({propKey:"tLastThis"})],GO.prototype,"lastFrameTexture",void 0);var jE=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class mv extends b.SimpleEventDispatcher{get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}constructor(e){super(),this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.smoothShadow=!1,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this._bakeCounter=0,this.maxBakeCount=1/0,this.materialExtension={parsFragmentSnippet:(s,o)=>b.glsl`
            uniform float transitionOpacity;
            `,extraUniforms:{transitionOpacity:{value:1}},shaderExtender:(s,o,c)=>{this.groundMapMode==="aoMap"?s.fragmentShader=os(s.fragmentShader,"#include <aomap_fragment>",os(g.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( mix(1., unpackRGBAToDepth(texture2D( aoMap, vAoMapUv ) ), transitionOpacity) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?s.fragmentShader=os(s.fragmentShader,"#include <map_fragment>",os(g.WdD.map_fragment,"diffuseColor *= texture2D( map, vMapUv );","float groundShadow = mix(1., unpackRGBAToDepth(texture2D( map, vMapUv )), transitionOpacity); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow) * transitionOpacity;")):this.groundMapMode==="alphaMap"&&(s.fragmentShader=os(s.fragmentShader,"#include <alphamap_fragment>",os(g.WdD.alphamap_fragment,"texture2D( alphaMap, vAlphaMapUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vAlphaMapUv ) )",{replaceAll:!0}))),s.fragmentShader=os(s.fragmentShader,"#include <output_fragment>",b.glsl`#include <output_fragment>
                #ifndef OPAQUE
                    #ifdef USE_AOMAP
                        #if NUM_DIR_LIGHT_SHADOWS > 0
                            // TODO find a better solution
                            float alphaMod = length(reflectedLight.directDiffuse)*4./float(NUM_DIR_LIGHT_SHADOWS);
                        #else
                            float alphaMod = 1.;
                        #endif
                        float t1 = 1. - ambientOcclusion;
                        float t2 = max(1. - alphaMod, 0.);
                        float t = t1 + t2;
                        gl_FragColor.a *= max(t, 0.);
                    #endif
                #endif
            `),this.alphaVignette&&c.capabilities.isWebGL2&&(s.defines.USE_UV="",s.fragmentShader=os(s.fragmentShader,"#include <output_fragment>",b.glsl`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV // why are we checking for this? this is always supposed to be true
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vAoMapUv.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(s,o)=>{o.materialObject.userData.gMapMode!==this.groundMapMode&&(o.materialObject.userData.gMapMode=this.groundMapMode,o.materialObject.needsUpdate=!0)},isCompatible:s=>s.isMeshStandardMaterial2},this._viewer=e;const i=new Fx(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new g.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new g.Pa4(10,10,10),normalDirection:new g.Pa4(0,1,0)});i.shadow.camera.updateProjectionMatrix(),i.layers.disableAll(),i.layers.set(this._lightLayer),this._light=i,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new GO({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:g.jFi}),this._shadowBlurMat=new s0({uniforms:{colorTexture:{value:null},step:{value:.1},size:{value:new g.FM8(.5,.5)},direction:{value:new g.FM8(.5,.5)}},vertexShader:Lm,fragmentShader:`#include <packing>
uniform sampler2D colorTexture;uniform vec2 size;uniform vec2 direction;uniform float step;varying vec2 vUv;void main(){float sum=0.;vec2 uvDelta=step*direction/size;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv-1.*uvDelta))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vec2(vUv.x,vUv.y)))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv+1.*uvDelta))*0.3333;gl_FragColor=packDepthToRGBA(sum);}`})}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,i,s;(i=(e=this.materialExtension)==null?void 0:e.setDirty)==null||i.call(e),(s=this._viewer)==null||s.setDirty()}fromJSON(e,i){return ao(e,this,!0,i),this.reset(),this}reset(){this._frameNumber=0}get frameNumber(){return this._frameNumber}autoUpdateShadow(){return!(!this.shadowAutoUpdate||this._bakeCounter>=this.maxBakeCount||!this.updateShadow()||(this._frameNumber===this.maxFrameNumber?this.dispatchEvent({type:"shadowBaked",bakeCount:++this._bakeCounter}):this._frameNumber>0&&this._frameNumber<this.maxFrameNumber&&this.dispatchEvent({type:"shadowBaking",progress:this._frameNumber/this.maxFrameNumber,bakeCount:this._bakeCounter}),0))}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(!e||++this._frameNumber>this.maxFrameNumber)return!1;const i=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:g.ywz,depthBuffer:!1,size:new g.FM8(i,i),sizeMultiplier:void 0,colorSpace:g.aCh,format:g.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const s=this._viewer.renderer.rendererObject,o=s.shadowMap,c=o.type,_=o.needsUpdate,j=o.autoUpdate;o.type=g._MY,o.needsUpdate=!0,o.autoUpdate=!1;const et=this._viewer.scene,nt=new g.S9g;nt.disableAll(),et.modelObject.traverse(mt=>{mt.isLight&&mt!==this._light.lightObject&&(mt.userData.__gp_layers=mt.layers,mt.layers=nt)});const st=et.activeCamera.cameraObject;if(st.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";st.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),ls(s,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(et)),st.layers.disable(this._lightLayer);const at=st.layers.mask;st.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const ct=this._viewer.renderer.getTempTarget({type:g.ywz,depthBuffer:!1,size:new g.FM8(i,i),colorSpace:g.aCh,format:g.wk1}),dt=ct.texture.colorSpace;ct.texture.colorSpace=g.aCh,this._viewer.renderer.blit(this._target.texture,ct,{clear:!0});{const mt=e.material,yt=e.frustumCulled,wt=s.getRenderTarget(),Ct=s.getActiveCubeFace(),bt=s.getActiveMipmapLevel();e.material=this._shadowMat,e.frustumCulled=!1,s.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=ct.texture,this._shadowMat.needsUpdate=!0,ls(s,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(et)),s.setRenderTarget(wt,Ct,bt),e.frustumCulled=yt,e.material=mt,this.smoothShadow&&this._applySmoothFilter(this._target,ct)}return ct.texture.colorSpace=dt,this._viewer.renderer.releaseTempTarget(ct),e.layers.disable(this._lightLayer),st.layers.mask=at,et.modelObject.traverse(mt=>{mt.isLight&&mt!==this._light.lightObject&&(mt.layers=mt.userData.__gp_layers,delete mt.userData.__gp_layers)}),o.type=c,o.needsUpdate=_,o.autoUpdate=j,e.castShadow=!0,(this._frameNumber<3||this._frameNumber>Math.min(100,this.maxFrameNumber)&&this._frameNumber%4==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var i,s,o;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((i=this._target)==null?void 0:i.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((s=this._target)==null?void 0:s.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((o=this._target)==null?void 0:o.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.01,this._attachedMesh.material.needsUpdate=!0))}_applySmoothFilter(e,i){this._shadowBlurMat.uniforms.colorTexture.value=e.texture,this._shadowBlurMat.uniforms.direction.value.set(1,0),this._shadowBlurMat.uniforms.size.value.set(e.width,e.height),this._viewer.renderer.blit(void 0,i,{material:this._shadowBlurMat}),this._shadowBlurMat.uniforms.colorTexture.value=i.texture,this._shadowBlurMat.uniforms.direction.value.set(0,1),this._shadowBlurMat.uniforms.size.value.set(i.width,i.height),this._viewer.renderer.blit(void 0,e,{material:this._shadowBlurMat})}}jE([En("randomizedLight")],mv.prototype,"_light",void 0),jE([(0,b.onChange)(mv.prototype.reset),En()],mv.prototype,"maxFrameNumber",void 0),jE([(0,b.onChange)(mv.prototype.reset),En()],mv.prototype,"smoothShadow",void 0),jE([(0,b.onChange)(mv.prototype._groundMapModeChanged),En()],mv.prototype,"groundMapMode",void 0),jE([En(),(0,b.onChange)(mv.prototype._alphaVignetteChanged)],mv.prototype,"alphaVignette",void 0),jE([En(),(0,b.onChange)(mv.prototype._alphaVignetteChanged)],mv.prototype,"alphaVignetteAxis",void 0),jE([En()],mv.prototype,"maxBakeCount",void 0);var r3=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class zE extends g.Kj0{_updateExtension(){var e,i;this.transparentReflectionBackground=this.reflectorModePhysical,(i=(e=this.materialExtension)==null?void 0:e.setDirty)==null||i.call(e)}constructor(e,i,s=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new g.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},extraDefines:{USE_UV:""},updaters:[],shaderExtender:(wt,Ct,bt)=>{if(this.enabled){wt.vertexShader=os(wt.vertexShader,"void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const At="#glMarker beforeModulation";wt.fragmentShader=os(wt.fragmentShader,At,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+At)}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?v2+`
`+Nv+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:wt=>this.enabled+" "+wt.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(wt,{materialObject:Ct})=>{Ct.userData.__lastTransparent!==Ct.transparent&&(Ct.needsUpdate=!0,Ct.userData.__lastTransparent=Ct.transparent)},isCompatible:wt=>wt.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=i;const o=new g.JOQ,c=new g.Pa4,_=new g.Pa4,j=new g.Pa4,et=new g.yGw,nt=new g.Pa4(0,0,-1),st=new g.Ltg,at=new g.Pa4,ct=new g.Pa4,dt=new g.Ltg,mt=new g.yGw,yt=new g.cPb;g.M8C.isPowerOfTwo(i.texture.image.width)&&g.M8C.isPowerOfTwo(i.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(wt,Ct,bt)=>{if(!this.enabled||!wt.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const At=bt.view?Object.assign({},bt.view):null;if(At&&bt.clearViewOffset&&bt.clearViewOffset(),_.setFromMatrixPosition(this.matrixWorld),j.setFromMatrixPosition(bt.matrixWorld),et.extractRotation(this.matrixWorld),c.set(0,0,1),c.applyMatrix4(et),at.subVectors(_,j),at.dot(c)>0)return;at.reflect(c).negate(),at.add(_),et.extractRotation(bt.matrixWorld),nt.set(0,0,-1),nt.applyMatrix4(et),nt.add(j),ct.subVectors(_,nt),ct.reflect(c).negate(),ct.add(_),yt.position.copy(at),yt.up.set(0,1,0),yt.up.applyMatrix4(et),yt.up.reflect(c),yt.lookAt(ct),yt.far=2,yt.near=0,yt.updateMatrixWorld(),yt.projectionMatrix.copy(bt.projectionMatrix),mt.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),mt.multiply(yt.projectionMatrix),mt.multiply(yt.matrixWorldInverse),mt.multiply(this.matrixWorld),o.setFromNormalAndCoplanarPoint(c,_),o.applyMatrix4(yt.matrixWorldInverse),st.set(o.normal.x,o.normal.y,o.normal.z,o.constant);const Pt=yt.projectionMatrix;dt.x=(Math.sign(st.x)+Pt.elements[8])/Pt.elements[0],dt.y=(Math.sign(st.y)+Pt.elements[9])/Pt.elements[5],dt.z=-1,dt.w=(1+Pt.elements[10])/Pt.elements[14],st.multiplyScalar(2/st.dot(dt)),Pt.elements[2]=st.x,Pt.elements[6]=st.y,Pt.elements[10]=st.z+1-s,Pt.elements[14]=st.w,this.visible=!1;const Dt=wt.getRenderTarget(),Nt=wt.xr.enabled,Vt=wt.shadowMap.autoUpdate;wt.xr.enabled=!1,wt.shadowMap.autoUpdate=!1,wt.setRenderTarget(this._renderTarget),wt.state.buffers.depth.setMask(!0),wt.autoClear===!1&&wt.clear();const Zt=Ct.background;this.transparentReflectionBackground&&(Ct.background=null);const an=!this.transparentReflectionBackground;Zt!=null&&Zt.isTexture&&an&&(Zt.userData||(Zt.userData={}),Zt.userData.flipX=!Zt.userData.flipX),ls(wt,{shadowMapRender:!1,backgroundRender:an,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>wt.render(Ct,yt)),Zt!=null&&Zt.isTexture&&an&&(Zt.userData.flipX=!Zt.userData.flipX||void 0),this.transparentReflectionBackground&&(Ct.background=Zt),wt.xr.enabled=Nt,wt.shadowMap.autoUpdate=Vt,wt.setRenderTarget(Dt),At!=null&&At.enabled&&bt.setViewOffset&&bt.setViewOffset(At.fullWidth,At.fullHeight,At.offsetX,At.offsetY,At.width,At.height);const fn=bt.viewport;fn!==void 0&&wt.state.viewport(fn),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=mt,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new g.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=mt}getRenderTarget(){return this._renderTarget}}r3([(0,b.onChange)(zE.prototype._updateExtension)],zE.prototype,"enabled",void 0),r3([(0,b.onChange)(zE.prototype._updateExtension)],zE.prototype,"reflectorModePhysical",void 0),zE.prototype.isReflector=!0;var VE=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class m_ extends ms{get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[Fr],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this.enableRefreshTransform=!0,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new g._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get autoAdjustTransform(){return this._options.autoAdjustTransform}set autoAdjustTransform(e){this._options.autoAdjustTransform=e,this.refreshTransform()}_createMesh(){return new g.Kj0(this._geometry)}async onAdded(e){var s,o;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(Fr);const i=this._createMesh();i.userData.physicsMass=0,this._iMesh=await((s=this._manager)==null?void 0:s.addImportedSingle(i,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(o=this._iMesh)==null?void 0:o.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var i,s,o;return this._removeMaterial(),this._geometry.dispose(),(i=this._material)==null||i.dispose(),(o=(s=this._iMesh)==null?void 0:s.dispose)==null||o.call(s),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){this._material&&(this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){(e==null?void 0:e.geometryChanged)!==!1&&(e==null?void 0:e.updateGround)!==!1&&this.refreshTransform()}refreshTransform(){this.enableRefreshTransform&&(this._transformNeedRefresh=!0)}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var i;const e=(i=this._viewer)==null?void 0:i.scene.activeCamera.controls;e&&(e.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=e.maxPolarAngle),e.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(e.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var i,s,o;if(!this._mesh||!this._viewer)return;let e=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,e=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const c=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const _=c.getCenter(new g.Pa4).sub(new g.Pa4(0,c.getSize(new g.Pa4).y/2+this.yOffset,0));e=e||_.clone().sub(this._mesh.position).length()>1e-4,e&&this._mesh.position.copy(_)}e=e||Math.abs(this._mesh.scale.x-this.size)>1e-4,e&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new g.USm(-Math.PI/2,0,this._mesh.rotation.z)),this._mesh.matrixWorldNeedsUpdate=!0,(s=(i=this._mesh).setDirty)==null||s.call(i)),this._transformNeedRefresh=!1}else e&&((o=this._viewer)==null||o.scene.setDirty())}_refreshMaterial(){var s,o,c,_;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const e=this._material??((o=(s=this._manager)==null?void 0:s.materials)==null?void 0:o.findOrCreate("standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215}));let i=!1;return e!==this._material&&(this._removeMaterial(),e&&(this._material=e),(c=this._material)!=null&&c.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,(((_=this._mesh)==null?void 0:_.setMaterial)??(et=>{this._mesh&&(this._mesh.material=et.materialObject)}))(this._material)),i=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),i}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,i){return super.fromJSON(e,i)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)==null?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},{label:"Auto adjust transform",type:"checkbox",property:[this,"autoAdjustTransform"]},...this._extraUiConfig()]}}}VE([En("material")],m_.prototype,"_material",void 0),VE([(0,b.onChange)(m_.prototype.refreshTransform),En()],m_.prototype,"visible",void 0),VE([(0,b.onChange2)(m_.prototype._onSceneUpdate),En()],m_.prototype,"size",void 0),VE([(0,b.onChange2)(m_.prototype._onSceneUpdate),En()],m_.prototype,"yOffset",void 0),VE([(0,b.onChange)(m_.prototype._refreshOptions2),En()],m_.prototype,"renderToDepth",void 0),VE([(0,b.onChange)(m_.prototype._refreshOptions2),En()],m_.prototype,"tonemapGround",void 0),VE([(0,b.onChange)(m_.prototype._refreshCameraLimits),En()],m_.prototype,"limitCameraAboveGround",void 0);var LP=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class gv extends m_{get shadowBaker(){return this._shadowBaker}bakeShadows(){var e;(e=this._shadowBaker)==null||e.reset()}constructor(e={},i=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this.autoBakeShadows=!0,this._showDebug=i,i&&this.dependencies.push(vy),this._onSceneUpdate=this._onSceneUpdate.bind(this)}_createMesh(){const e=new zE(this._geometry,this._viewer.renderer.createTarget({type:g.ywz,format:g.wk1,colorSpace:g.aCh,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:g.D1R,magFilter:g.wem})),i=e.onBeforeRender;return e.onBeforeRender=(...s)=>{var _,j,et,nt,st;let o=(j=(_=this._viewer)==null?void 0:_.getPluginByType("SSReflection"))==null?void 0:j.passes.ssr.passObject;o&&!o.enabled&&(o=void 0),o&&(o.enabled=!1);let c=(st=(nt=(et=this._viewer)==null?void 0:et.getPluginByType("SSBevelPlugin"))==null?void 0:nt.pass)==null?void 0:st.passObject;c&&!c.enabled&&(c=void 0),c&&(c.enabled=!1),i(...s),o&&(o.enabled=!0),c&&(c.enabled=!0)},e}async onAdded(e){var i,s;await super.onAdded(e),this._showDebug&&((i=e.getPlugin(vy))==null||i.addTexture("bake_ground_1",()=>{var o,c;return(c=(o=this._shadowBaker)==null?void 0:o.light.shadow.map)==null?void 0:c.texture},[100,100,200,200]),(s=e.getPlugin(vy))==null||s.addTexture("bake_ground_2",()=>{var o,c;return(c=(o=this._shadowBaker)==null?void 0:o.target)==null?void 0:c.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){super._postFrame(),this._viewer&&this.enabled&&this._shadowBaker&&this.bakedShadows&&this._shadowBaker.autoUpdateShadow()}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,i,s,o;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((i=(e=this._material).unregisterMaterialExtensions)==null||i.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const c=this._mesh.materialExtension;c||console.warn("unable to find the extension to unregister"),(o=(s=this._material).unregisterMaterialExtensions)==null||o.call(s,[c]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var i;super._onSceneUpdate(e),e.geometryChanged!==!1&&this.autoBakeShadows&&((i=this._shadowBaker)==null||i.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new mv(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var i,s,o,c;if(!this._viewer)return!1;const e=super._refreshMaterial();if(!this._material)return e;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const _=this._mesh.materialExtension;_.updaters=[this._viewer.scene,this._viewer.renderer],(s=(i=this._material).registerMaterialExtensions)==null||s.call(i,[_]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((c=(o=this._material).registerMaterialExtensions)==null||c.call(o,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),e}_extraUiConfig(){var e,i,s,o,c,_,j,et,nt,st,at,ct,dt,mt,yt,wt,Ct,bt,At,Pt,Dt,Nt,Vt,Zt,an,fn,mn,Sn,An,wn;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var Mn,Pn;return(Pn=(Mn=this._uiConfig)==null?void 0:Mn.uiRefresh)==null?void 0:Pn.call(Mn,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var Mn;return!((Mn=this._shadowBaker)!=null&&Mn.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(Mn=>({label:Mn,value:Mn})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{label:"Smooth Shadow",type:"checkbox",property:[this._shadowBaker,"smoothShadow"],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)==null?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(i=this._shadowBaker)==null?void 0:i.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(o=(s=this._shadowBaker)==null?void 0:s.light)==null?void 0:o.shadowParams,"enabled"],onChange:[(_=(c=this._shadowBaker)==null?void 0:c.light)==null?void 0:_.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(et=(j=this._shadowBaker)==null?void 0:j.light)==null?void 0:et.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(st=(nt=this._shadowBaker)==null?void 0:nt.light)==null?void 0:st.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(ct=(at=this._shadowBaker)==null?void 0:at.light)==null?void 0:ct.randomParams,"distanceScale"],onChange:[(mt=(dt=this._shadowBaker)==null?void 0:dt.light)==null?void 0:mt.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(wt=(yt=this._shadowBaker)==null?void 0:yt.light)==null?void 0:wt.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(bt=(Ct=this._shadowBaker)==null?void 0:Ct.light)==null?void 0:bt.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(Pt=(At=this._shadowBaker)==null?void 0:At.light)==null?void 0:Pt.shadowParams,"radius"],onChange:[(Nt=(Dt=this._shadowBaker)==null?void 0:Dt.light)==null?void 0:Nt.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(Zt=(Vt=this._shadowBaker)==null?void 0:Vt.light)==null?void 0:Zt.shadowParams,"frustumSize"],onChange:[(fn=(an=this._shadowBaker)==null?void 0:an.light)==null?void 0:fn.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(Sn=(mn=this._shadowBaker)==null?void 0:mn.light)==null?void 0:Sn.shadowParams,"bias"],onChange:[(wn=(An=this._shadowBaker)==null?void 0:An.light)==null?void 0:wn.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}gv.PluginType="Ground",LP([(0,b.onChange)(gv.prototype.refreshOptions),En()],gv.prototype,"bakedShadows",void 0),LP([(0,b.onChange)(gv.prototype.refreshOptions),En()],gv.prototype,"groundReflection",void 0),LP([(0,b.onChange)(gv.prototype.refreshOptions),En()],gv.prototype,"physicalReflections",void 0),LP([En("shadowBaker")],gv.prototype,"_shadowBaker",void 0);class y4 extends g.yxD{constructor(e){super(e),this.type=g.cLu}parse(e){const Dt=Math.pow(2.7182818,2.2),Nt={l:0,c:0,lc:0};function Vt(Ln,or,mr,Vr,Kr){for(;mr<Ln;)or=or<<8|so(Vr,Kr),mr+=8;mr-=Ln,Nt.l=or>>mr&(1<<Ln)-1,Nt.c=or,Nt.lc=mr}const Zt=new Array(59);function an(Ln){return 63&Ln}function fn(Ln){return Ln>>6}const mn={c:0,lc:0};function Sn(Ln,or,mr,Vr){Ln=Ln<<8|so(mr,Vr),or+=8,mn.c=Ln,mn.lc=or}const An={c:0,lc:0};function wn(Ln,or,mr,Vr,Kr,_r,Gr,Is,Xs){if(Ln==or){Vr<8&&(Sn(mr,Vr,Kr,_r),mr=mn.c,Vr=mn.lc);let eo=mr>>(Vr-=8);if(eo=new Uint8Array([eo])[0],Is.value+eo>Xs)return!1;const Qs=Gr[Is.value-1];for(;eo-- >0;)Gr[Is.value++]=Qs}else{if(!(Is.value<Xs))return!1;Gr[Is.value++]=Ln}An.c=mr,An.lc=Vr}function Mn(Ln){return 65535&Ln}function Pn(Ln){const or=Mn(Ln);return or>32767?or-65536:or}const On={a:0,b:0};function er(Ln,or){const mr=Pn(Ln),Vr=Pn(or),Kr=mr+(1&Vr)+(Vr>>1),_r=Kr,Gr=Kr-Vr;On.a=_r,On.b=Gr}function Zn(Ln,or){const mr=Mn(Ln),Vr=Mn(or),Kr=mr-(Vr>>1)&65535,_r=Vr+Kr-32768&65535;On.a=_r,On.b=Kr}function yr(Ln,or,mr,Vr,Kr,_r,Gr){const Is=Gr<16384,Xs=mr>Kr?Kr:mr;let eo,Qs,bo=1;for(;bo<=Xs;)bo<<=1;for(bo>>=1,eo=bo,bo>>=1;bo>=1;){Qs=0;const Rs=Qs+_r*(Kr-eo),Ts=_r*bo,vo=_r*eo,cs=Vr*bo,Vs=Vr*eo;let Ws,Co,Nu,du;for(;Qs<=Rs;Qs+=vo){let zs=Qs;const Mo=Qs+Vr*(mr-eo);for(;zs<=Mo;zs+=Vs){const Jo=zs+cs,pm=zs+Ts,Sv=pm+cs;Is?(er(Ln[zs+or],Ln[pm+or]),Ws=On.a,Nu=On.b,er(Ln[Jo+or],Ln[Sv+or]),Co=On.a,du=On.b,er(Ws,Co),Ln[zs+or]=On.a,Ln[Jo+or]=On.b,er(Nu,du),Ln[pm+or]=On.a,Ln[Sv+or]=On.b):(Zn(Ln[zs+or],Ln[pm+or]),Ws=On.a,Nu=On.b,Zn(Ln[Jo+or],Ln[Sv+or]),Co=On.a,du=On.b,Zn(Ws,Co),Ln[zs+or]=On.a,Ln[Jo+or]=On.b,Zn(Nu,du),Ln[pm+or]=On.a,Ln[Sv+or]=On.b)}if(mr&bo){const Jo=zs+Ts;Is?er(Ln[zs+or],Ln[Jo+or]):Zn(Ln[zs+or],Ln[Jo+or]),Ws=On.a,Ln[Jo+or]=On.b,Ln[zs+or]=Ws}}if(Kr&bo){let zs=Qs;const Mo=Qs+Vr*(mr-eo);for(;zs<=Mo;zs+=Vs){const Jo=zs+cs;Is?er(Ln[zs+or],Ln[Jo+or]):Zn(Ln[zs+or],Ln[Jo+or]),Ws=On.a,Ln[Jo+or]=On.b,Ln[zs+or]=Ws}}eo=bo,bo>>=1}return Qs}function lr(Ln,or,mr,Vr,Kr,_r){const Gr=mr.value,Is=io(or,mr),Xs=io(or,mr);mr.value+=4;const eo=io(or,mr);if(mr.value+=4,Is<0||Is>=65537||Xs<0||Xs>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Qs=new Array(65537),bo=new Array(16384);if(function(Rs){for(let Ts=0;Ts<16384;Ts++)Rs[Ts]={},Rs[Ts].len=0,Rs[Ts].lit=0,Rs[Ts].p=null}(bo),function(Rs,Ts,vo,cs,Vs,Ws){const Co=Ts;let Nu=0,du=0;for(;cs<=Vs;cs++){if(Co.value-Ts.value>vo)return!1;Vt(6,Nu,du,Rs,Co);const zs=Nt.l;if(Nu=Nt.c,du=Nt.lc,Ws[cs]=zs,zs==63){if(Co.value-Ts.value>vo)throw new Error("Something wrong with hufUnpackEncTable");Vt(8,Nu,du,Rs,Co);let Mo=Nt.l+6;if(Nu=Nt.c,du=Nt.lc,cs+Mo>Vs+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Mo--;)Ws[cs++]=0;cs--}else if(zs>=59){let Mo=zs-59+2;if(cs+Mo>Vs+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Mo--;)Ws[cs++]=0;cs--}}(function(zs){for(let Jo=0;Jo<=58;++Jo)Zt[Jo]=0;for(let Jo=0;Jo<65537;++Jo)Zt[zs[Jo]]+=1;let Mo=0;for(let Jo=58;Jo>0;--Jo){const pm=Mo+Zt[Jo]>>1;Zt[Jo]=Mo,Mo=pm}for(let Jo=0;Jo<65537;++Jo){const pm=zs[Jo];pm>0&&(zs[Jo]=pm|Zt[pm]++<<6)}})(Ws)}(Ln,mr,Vr-(mr.value-Gr),Is,Xs,Qs),eo>8*(Vr-(mr.value-Gr)))throw new Error("Something wrong with hufUncompress");(function(Rs,Ts,vo,cs){for(;Ts<=vo;Ts++){const Vs=fn(Rs[Ts]),Ws=an(Rs[Ts]);if(Vs>>Ws)throw new Error("Invalid table entry");if(Ws>14){const Co=cs[Vs>>Ws-14];if(Co.len)throw new Error("Invalid table entry");if(Co.lit++,Co.p){const Nu=Co.p;Co.p=new Array(Co.lit);for(let du=0;du<Co.lit-1;++du)Co.p[du]=Nu[du]}else Co.p=new Array(1);Co.p[Co.lit-1]=Ts}else if(Ws){let Co=0;for(let Nu=1<<14-Ws;Nu>0;Nu--){const du=cs[(Vs<<14-Ws)+Co];if(du.len||du.p)throw new Error("Invalid table entry");du.len=Ws,du.lit=Ts,Co++}}}})(Qs,Is,Xs,bo),function(Rs,Ts,vo,cs,Vs,Ws,Co,Nu,du){let zs=0,Mo=0;const Jo=Co,pm=Math.trunc(cs.value+(Vs+7)/8);for(;cs.value<pm;)for(Sn(zs,Mo,vo,cs),zs=mn.c,Mo=mn.lc;Mo>=14;){const Cm=Ts[zs>>Mo-14&16383];if(Cm.len)Mo-=Cm.len,wn(Cm.lit,Ws,zs,Mo,vo,cs,Nu,du,Jo),zs=An.c,Mo=An.lc;else{if(!Cm.p)throw new Error("hufDecode issues");let dx;for(dx=0;dx<Cm.lit;dx++){const PS=an(Rs[Cm.p[dx]]);for(;Mo<PS&&cs.value<pm;)Sn(zs,Mo,vo,cs),zs=mn.c,Mo=mn.lc;if(Mo>=PS&&fn(Rs[Cm.p[dx]])==(zs>>Mo-PS&(1<<PS)-1)){Mo-=PS,wn(Cm.p[dx],Ws,zs,Mo,vo,cs,Nu,du,Jo),zs=An.c,Mo=An.lc;break}}if(dx==Cm.lit)throw new Error("hufDecode issues")}}const Sv=8-Vs&7;for(zs>>=Sv,Mo-=Sv;Mo>0;){const Cm=Ts[zs<<14-Mo&16383];if(!Cm.len)throw new Error("hufDecode issues");Mo-=Cm.len,wn(Cm.lit,Ws,zs,Mo,vo,cs,Nu,du,Jo),zs=An.c,Mo=An.lc}}(Qs,bo,Ln,mr,eo,Xs,_r,Kr,{value:0})}function ar(Ln){for(let or=1;or<Ln.length;or++){const mr=Ln[or-1]+Ln[or]-128;Ln[or]=mr}}function Mr(Ln,or){let mr=0,Vr=Math.floor((Ln.length+1)/2),Kr=0;const _r=Ln.length-1;for(;!(Kr>_r||(or[Kr++]=Ln[mr++],Kr>_r));)or[Kr++]=Ln[Vr++]}function xr(Ln){let or=Ln.byteLength;const mr=new Array;let Vr=0;const Kr=new DataView(Ln);for(;or>0;){const _r=Kr.getInt8(Vr++);if(_r<0){const Gr=-_r;or-=Gr+1;for(let Is=0;Is<Gr;Is++)mr.push(Kr.getUint8(Vr++))}else{const Gr=_r;or-=2;const Is=Kr.getUint8(Vr++);for(let Xs=0;Xs<Gr+1;Xs++)mr.push(Is)}}return mr}function qr(Ln,or,mr){let Vr,Kr=1;for(;Kr<64;)Vr=or[Ln.value],Vr==65280?Kr=64:Vr>>8==255?Kr+=255&Vr:(mr[Kr]=Vr,Kr++),Ln.value++}function Zr(Ln){const or=.5*Math.cos(.7853975),mr=.5*Math.cos(3.14159/16),Vr=.5*Math.cos(3.14159/8),Kr=.5*Math.cos(3*3.14159/16),_r=.5*Math.cos(.981746875),Gr=.5*Math.cos(3*3.14159/8),Is=.5*Math.cos(1.374445625),Xs=new Array(4),eo=new Array(4),Qs=new Array(4),bo=new Array(4);for(let Rs=0;Rs<8;++Rs){const Ts=8*Rs;Xs[0]=Vr*Ln[Ts+2],Xs[1]=Gr*Ln[Ts+2],Xs[2]=Vr*Ln[Ts+6],Xs[3]=Gr*Ln[Ts+6],eo[0]=mr*Ln[Ts+1]+Kr*Ln[Ts+3]+_r*Ln[Ts+5]+Is*Ln[Ts+7],eo[1]=Kr*Ln[Ts+1]-Is*Ln[Ts+3]-mr*Ln[Ts+5]-_r*Ln[Ts+7],eo[2]=_r*Ln[Ts+1]-mr*Ln[Ts+3]+Is*Ln[Ts+5]+Kr*Ln[Ts+7],eo[3]=Is*Ln[Ts+1]-_r*Ln[Ts+3]+Kr*Ln[Ts+5]-mr*Ln[Ts+7],Qs[0]=or*(Ln[Ts+0]+Ln[Ts+4]),Qs[3]=or*(Ln[Ts+0]-Ln[Ts+4]),Qs[1]=Xs[0]+Xs[3],Qs[2]=Xs[1]-Xs[2],bo[0]=Qs[0]+Qs[1],bo[1]=Qs[3]+Qs[2],bo[2]=Qs[3]-Qs[2],bo[3]=Qs[0]-Qs[1],Ln[Ts+0]=bo[0]+eo[0],Ln[Ts+1]=bo[1]+eo[1],Ln[Ts+2]=bo[2]+eo[2],Ln[Ts+3]=bo[3]+eo[3],Ln[Ts+4]=bo[3]-eo[3],Ln[Ts+5]=bo[2]-eo[2],Ln[Ts+6]=bo[1]-eo[1],Ln[Ts+7]=bo[0]-eo[0]}for(let Rs=0;Rs<8;++Rs)Xs[0]=Vr*Ln[16+Rs],Xs[1]=Gr*Ln[16+Rs],Xs[2]=Vr*Ln[48+Rs],Xs[3]=Gr*Ln[48+Rs],eo[0]=mr*Ln[8+Rs]+Kr*Ln[24+Rs]+_r*Ln[40+Rs]+Is*Ln[56+Rs],eo[1]=Kr*Ln[8+Rs]-Is*Ln[24+Rs]-mr*Ln[40+Rs]-_r*Ln[56+Rs],eo[2]=_r*Ln[8+Rs]-mr*Ln[24+Rs]+Is*Ln[40+Rs]+Kr*Ln[56+Rs],eo[3]=Is*Ln[8+Rs]-_r*Ln[24+Rs]+Kr*Ln[40+Rs]-mr*Ln[56+Rs],Qs[0]=or*(Ln[Rs]+Ln[32+Rs]),Qs[3]=or*(Ln[Rs]-Ln[32+Rs]),Qs[1]=Xs[0]+Xs[3],Qs[2]=Xs[1]-Xs[2],bo[0]=Qs[0]+Qs[1],bo[1]=Qs[3]+Qs[2],bo[2]=Qs[3]-Qs[2],bo[3]=Qs[0]-Qs[1],Ln[0+Rs]=bo[0]+eo[0],Ln[8+Rs]=bo[1]+eo[1],Ln[16+Rs]=bo[2]+eo[2],Ln[24+Rs]=bo[3]+eo[3],Ln[32+Rs]=bo[3]-eo[3],Ln[40+Rs]=bo[2]-eo[2],Ln[48+Rs]=bo[1]-eo[1],Ln[56+Rs]=bo[0]-eo[0]}function ds(Ln){for(let or=0;or<64;++or){const mr=Ln[0][or],Vr=Ln[1][or],Kr=Ln[2][or];Ln[0][or]=mr+1.5747*Kr,Ln[1][or]=mr-.1873*Vr-.4682*Kr,Ln[2][or]=mr+1.8556*Vr}}function Hs(Ln,or,mr){for(let Kr=0;Kr<64;++Kr)or[mr+Kr]=g.A5E.toHalfFloat((Vr=Ln[Kr])<=1?Math.sign(Vr)*Math.pow(Math.abs(Vr),2.2):Math.sign(Vr)*Math.pow(Dt,Math.abs(Vr)-1));var Vr}function Ps(Ln){return new DataView(Ln.array.buffer,Ln.offset.value,Ln.size)}function Os(Ln){const or=Ln.viewer.buffer.slice(Ln.offset.value,Ln.offset.value+Ln.size),mr=new Uint8Array(xr(or)),Vr=new Uint8Array(mr.length);return ar(mr),Mr(mr,Vr),new DataView(Vr.buffer)}function gr(Ln){const or=OE(Ln.array.slice(Ln.offset.value,Ln.offset.value+Ln.size)),mr=new Uint8Array(or.length);return ar(or),Mr(or,mr),new DataView(mr.buffer)}function kr(Ln){const or=Ln.viewer,mr={value:Ln.offset.value},Vr=new Uint16Array(Ln.width*Ln.scanlineBlockSize*(Ln.channels*Ln.type)),Kr=new Uint8Array(8192);let _r=0;const Gr=new Array(Ln.channels);for(let vo=0;vo<Ln.channels;vo++)Gr[vo]={},Gr[vo].start=_r,Gr[vo].end=Gr[vo].start,Gr[vo].nx=Ln.width,Gr[vo].ny=Ln.lines,Gr[vo].size=Ln.type,_r+=Gr[vo].nx*Gr[vo].ny*Gr[vo].size;const Is=qs(or,mr),Xs=qs(or,mr);if(Xs>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Is<=Xs)for(let vo=0;vo<Xs-Is+1;vo++)Kr[vo+Is]=ws(or,mr);const eo=new Uint16Array(65536),Qs=function(vo,cs){let Vs=0;for(let Co=0;Co<65536;++Co)(Co==0||vo[Co>>3]&1<<(7&Co))&&(cs[Vs++]=Co);const Ws=Vs-1;for(;Vs<65536;)cs[Vs++]=0;return Ws}(Kr,eo),bo=io(or,mr);lr(Ln.array,or,mr,bo,Vr,_r);for(let vo=0;vo<Ln.channels;++vo){const cs=Gr[vo];for(let Vs=0;Vs<Gr[vo].size;++Vs)yr(Vr,cs.start+Vs,cs.nx,cs.size,cs.ny,cs.nx*cs.size,Qs)}(function(vo,cs,Vs){for(let Ws=0;Ws<Vs;++Ws)cs[Ws]=vo[cs[Ws]]})(eo,Vr,_r);let Rs=0;const Ts=new Uint8Array(Vr.buffer.byteLength);for(let vo=0;vo<Ln.lines;vo++)for(let cs=0;cs<Ln.channels;cs++){const Vs=Gr[cs],Ws=Vs.nx*Vs.size,Co=new Uint8Array(Vr.buffer,Vs.end*2,Ws*2);Ts.set(Co,Rs),Rs+=Ws*2,Vs.end+=Ws}return new DataView(Ts.buffer)}function $r(Ln){const or=OE(Ln.array.slice(Ln.offset.value,Ln.offset.value+Ln.size)),mr=Ln.lines*Ln.channels*Ln.width,Vr=Ln.type==1?new Uint16Array(mr):new Uint32Array(mr);let Kr=0,_r=0;const Gr=new Array(4);for(let Is=0;Is<Ln.lines;Is++)for(let Xs=0;Xs<Ln.channels;Xs++){let eo=0;switch(Ln.type){case 1:Gr[0]=Kr,Gr[1]=Gr[0]+Ln.width,Kr=Gr[1]+Ln.width;for(let Qs=0;Qs<Ln.width;++Qs)eo+=or[Gr[0]++]<<8|or[Gr[1]++],Vr[_r]=eo,_r++;break;case 2:Gr[0]=Kr,Gr[1]=Gr[0]+Ln.width,Gr[2]=Gr[1]+Ln.width,Kr=Gr[2]+Ln.width;for(let Qs=0;Qs<Ln.width;++Qs)eo+=or[Gr[0]++]<<24|or[Gr[1]++]<<16|or[Gr[2]++]<<8,Vr[_r]=eo,_r++}}return new DataView(Vr.buffer)}function co(Ln){const or=Ln.viewer,mr={value:Ln.offset.value},Vr=new Uint8Array(Ln.width*Ln.lines*(Ln.channels*Ln.type*2)),Kr={version:dr(or,mr),unknownUncompressedSize:dr(or,mr),unknownCompressedSize:dr(or,mr),acCompressedSize:dr(or,mr),dcCompressedSize:dr(or,mr),rleCompressedSize:dr(or,mr),rleUncompressedSize:dr(or,mr),rleRawSize:dr(or,mr),totalAcUncompressedCount:dr(or,mr),totalDcUncompressedCount:dr(or,mr),acCompression:dr(or,mr)};if(Kr.version<2)throw new Error("EXRLoader.parse: "+dm.compression+" version "+Kr.version+" is unsupported");const _r=new Array;let Gr=qs(or,mr)-2;for(;Gr>0;){const cs=Do(or.buffer,mr),Vs=ws(or,mr),Ws=Vs>>2&3,Co=new Int8Array([(Vs>>4)-1])[0],Nu=ws(or,mr);_r.push({name:cs,index:Co,type:Nu,compression:Ws}),Gr-=cs.length+3}const Is=dm.channels,Xs=new Array(Ln.channels);for(let cs=0;cs<Ln.channels;++cs){const Vs=Xs[cs]={},Ws=Is[cs];Vs.name=Ws.name,Vs.compression=0,Vs.decoded=!1,Vs.type=Ws.pixelType,Vs.pLinear=Ws.pLinear,Vs.width=Ln.width,Vs.height=Ln.lines}const eo={idx:new Array(3)};for(let cs=0;cs<Ln.channels;++cs){const Vs=Xs[cs];for(let Ws=0;Ws<_r.length;++Ws){const Co=_r[Ws];Vs.name==Co.name&&(Vs.compression=Co.compression,Co.index>=0&&(eo.idx[Co.index]=cs),Vs.offset=cs)}}let Qs,bo,Rs;if(Kr.acCompressedSize>0)switch(Kr.acCompression){case 0:Qs=new Uint16Array(Kr.totalAcUncompressedCount),lr(Ln.array,or,mr,Kr.acCompressedSize,Qs,Kr.totalAcUncompressedCount);break;case 1:const cs=OE(Ln.array.slice(mr.value,mr.value+Kr.totalAcUncompressedCount));Qs=new Uint16Array(cs.buffer),mr.value+=Kr.totalAcUncompressedCount}if(Kr.dcCompressedSize>0){const cs={array:Ln.array,offset:mr,size:Kr.dcCompressedSize};bo=new Uint16Array(gr(cs).buffer),mr.value+=Kr.dcCompressedSize}Kr.rleRawSize>0&&(Rs=xr(OE(Ln.array.slice(mr.value,mr.value+Kr.rleCompressedSize)).buffer),mr.value+=Kr.rleCompressedSize);let Ts=0;const vo=new Array(Xs.length);for(let cs=0;cs<vo.length;++cs)vo[cs]=new Array;for(let cs=0;cs<Ln.lines;++cs)for(let Vs=0;Vs<Xs.length;++Vs)vo[Vs].push(Ts),Ts+=Xs[Vs].width*Ln.type*2;(function(cs,Vs,Ws,Co,Nu,du){let zs=new DataView(du.buffer);const Mo=Ws[cs.idx[0]].width,Jo=Ws[cs.idx[0]].height,pm=Math.floor(Mo/8),Sv=Math.ceil(Mo/8),Cm=Math.ceil(Jo/8),dx=Mo-8*(Sv-1),PS=Jo-8*(Cm-1),w8={value:0},ZL=new Array(3),l2=new Array(3),c2=new Array(3),Oy=new Array(3),HD=new Array(3);for(let Uu=0;Uu<3;++Uu)HD[Uu]=Vs[cs.idx[Uu]],ZL[Uu]=Uu<1?0:ZL[Uu-1]+Sv*Cm,l2[Uu]=new Float32Array(64),c2[Uu]=new Uint16Array(64),Oy[Uu]=new Uint16Array(64*Sv);for(let Uu=0;Uu<Cm;++Uu){let UT=8;Uu==Cm-1&&(UT=PS);let FT=8;for(let iu=0;iu<Sv;++iu){iu==Sv-1&&(FT=dx);for(let Iu=0;Iu<3;++Iu)c2[Iu].fill(0),c2[Iu][0]=Nu[ZL[Iu]++],qr(w8,Co,c2[Iu]),Ss=c2[Iu],(Ms=l2[Iu])[0]=Ur(Ss[0]),Ms[1]=Ur(Ss[1]),Ms[2]=Ur(Ss[5]),Ms[3]=Ur(Ss[6]),Ms[4]=Ur(Ss[14]),Ms[5]=Ur(Ss[15]),Ms[6]=Ur(Ss[27]),Ms[7]=Ur(Ss[28]),Ms[8]=Ur(Ss[2]),Ms[9]=Ur(Ss[4]),Ms[10]=Ur(Ss[7]),Ms[11]=Ur(Ss[13]),Ms[12]=Ur(Ss[16]),Ms[13]=Ur(Ss[26]),Ms[14]=Ur(Ss[29]),Ms[15]=Ur(Ss[42]),Ms[16]=Ur(Ss[3]),Ms[17]=Ur(Ss[8]),Ms[18]=Ur(Ss[12]),Ms[19]=Ur(Ss[17]),Ms[20]=Ur(Ss[25]),Ms[21]=Ur(Ss[30]),Ms[22]=Ur(Ss[41]),Ms[23]=Ur(Ss[43]),Ms[24]=Ur(Ss[9]),Ms[25]=Ur(Ss[11]),Ms[26]=Ur(Ss[18]),Ms[27]=Ur(Ss[24]),Ms[28]=Ur(Ss[31]),Ms[29]=Ur(Ss[40]),Ms[30]=Ur(Ss[44]),Ms[31]=Ur(Ss[53]),Ms[32]=Ur(Ss[10]),Ms[33]=Ur(Ss[19]),Ms[34]=Ur(Ss[23]),Ms[35]=Ur(Ss[32]),Ms[36]=Ur(Ss[39]),Ms[37]=Ur(Ss[45]),Ms[38]=Ur(Ss[52]),Ms[39]=Ur(Ss[54]),Ms[40]=Ur(Ss[20]),Ms[41]=Ur(Ss[22]),Ms[42]=Ur(Ss[33]),Ms[43]=Ur(Ss[38]),Ms[44]=Ur(Ss[46]),Ms[45]=Ur(Ss[51]),Ms[46]=Ur(Ss[55]),Ms[47]=Ur(Ss[60]),Ms[48]=Ur(Ss[21]),Ms[49]=Ur(Ss[34]),Ms[50]=Ur(Ss[37]),Ms[51]=Ur(Ss[47]),Ms[52]=Ur(Ss[50]),Ms[53]=Ur(Ss[56]),Ms[54]=Ur(Ss[59]),Ms[55]=Ur(Ss[61]),Ms[56]=Ur(Ss[35]),Ms[57]=Ur(Ss[36]),Ms[58]=Ur(Ss[48]),Ms[59]=Ur(Ss[49]),Ms[60]=Ur(Ss[57]),Ms[61]=Ur(Ss[58]),Ms[62]=Ur(Ss[62]),Ms[63]=Ur(Ss[63]),Zr(l2[Iu]);ds(l2);for(let Iu=0;Iu<3;++Iu)Hs(l2[Iu],Oy[Iu],64*iu)}let n0=0;for(let iu=0;iu<3;++iu){const Iu=Ws[cs.idx[iu]].type;for(let px=8*Uu;px<8*Uu+UT;++px){n0=HD[iu][px];for(let u2=0;u2<pm;++u2){const qA=64*u2+8*(7&px);zs.setUint16(n0+0*2*Iu,Oy[iu][qA+0],!0),zs.setUint16(n0+1*2*Iu,Oy[iu][qA+1],!0),zs.setUint16(n0+2*2*Iu,Oy[iu][qA+2],!0),zs.setUint16(n0+3*2*Iu,Oy[iu][qA+3],!0),zs.setUint16(n0+4*2*Iu,Oy[iu][qA+4],!0),zs.setUint16(n0+5*2*Iu,Oy[iu][qA+5],!0),zs.setUint16(n0+6*2*Iu,Oy[iu][qA+6],!0),zs.setUint16(n0+7*2*Iu,Oy[iu][qA+7],!0),n0+=8*2*Iu}}if(pm!=Sv)for(let px=8*Uu;px<8*Uu+UT;++px){const u2=HD[iu][px]+8*pm*2*Iu,qA=64*pm+8*(7&px);for(let QD=0;QD<FT;++QD)zs.setUint16(u2+QD*2*Iu,Oy[iu][qA+QD],!0)}}}var Ss,Ms;const p4=new Uint16Array(Mo);zs=new DataView(du.buffer);for(let Uu=0;Uu<3;++Uu){Ws[cs.idx[Uu]].decoded=!0;const UT=Ws[cs.idx[Uu]].type;if(Ws[Uu].type==2)for(let FT=0;FT<Jo;++FT){const n0=HD[Uu][FT];for(let iu=0;iu<Mo;++iu)p4[iu]=zs.getUint16(n0+iu*2*UT,!0);for(let iu=0;iu<Mo;++iu)zs.setFloat32(n0+iu*2*UT,Ur(p4[iu]),!0)}}})(eo,vo,Xs,Qs,bo,Vr);for(let cs=0;cs<Xs.length;++cs){const Vs=Xs[cs];if(!Vs.decoded){if(Vs.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let Ws=0,Co=0;for(let Nu=0;Nu<Ln.lines;++Nu){let du=vo[cs][Ws];for(let zs=0;zs<Vs.width;++zs){for(let Mo=0;Mo<2*Vs.type;++Mo)Vr[du++]=Rs[Co+Mo*Vs.width*Vs.height];Co++}Ws++}}}}return new DataView(Vr.buffer)}function Do(Ln,or){const mr=new Uint8Array(Ln);let Vr=0;for(;mr[or.value+Vr]!=0;)Vr+=1;const Kr=new TextDecoder().decode(mr.slice(or.value,or.value+Vr));return or.value=or.value+Vr+1,Kr}function _o(Ln,or){const mr=Ln.getInt32(or.value,!0);return or.value=or.value+4,mr}function io(Ln,or){const mr=Ln.getUint32(or.value,!0);return or.value=or.value+4,mr}function so(Ln,or){const mr=Ln[or.value];return or.value=or.value+1,mr}function ws(Ln,or){const mr=Ln.getUint8(or.value);return or.value=or.value+1,mr}const dr=function(Ln,or){let mr;return mr="getBigInt64"in DataView.prototype?Number(Ln.getBigInt64(or.value,!0)):Ln.getUint32(or.value+4,!0)+Number(Ln.getUint32(or.value,!0)<<32),or.value+=8,mr};function Yr(Ln,or){const mr=Ln.getFloat32(or.value,!0);return or.value+=4,mr}function Cs(Ln,or){return g.A5E.toHalfFloat(Yr(Ln,or))}function Ur(Ln){const or=(31744&Ln)>>10,mr=1023&Ln;return(Ln>>15?-1:1)*(or?or===31?mr?NaN:1/0:Math.pow(2,or-15)*(1+mr/1024):mr/1024*6103515625e-14)}function qs(Ln,or){const mr=Ln.getUint16(or.value,!0);return or.value+=2,mr}function bu(Ln,or){return Ur(qs(Ln,or))}function Lu(Ln,or,mr,Vr,Kr){return Vr==="string"||Vr==="stringvector"||Vr==="iccProfile"?function(_r,Gr,Is){const Xs=new TextDecoder().decode(new Uint8Array(_r).slice(Gr.value,Gr.value+Is));return Gr.value=Gr.value+Is,Xs}(or,mr,Kr):Vr==="chlist"?function(_r,Gr,Is,Xs){const eo=Is.value,Qs=[];for(;Is.value<eo+Xs-1;){const bo=Do(Gr,Is),Rs=_o(_r,Is),Ts=ws(_r,Is);Is.value+=3;const vo=_o(_r,Is),cs=_o(_r,Is);Qs.push({name:bo,pixelType:Rs,pLinear:Ts,xSampling:vo,ySampling:cs})}return Is.value+=1,Qs}(Ln,or,mr,Kr):Vr==="chromaticities"?function(_r,Gr){return{redX:Yr(_r,Gr),redY:Yr(_r,Gr),greenX:Yr(_r,Gr),greenY:Yr(_r,Gr),blueX:Yr(_r,Gr),blueY:Yr(_r,Gr),whiteX:Yr(_r,Gr),whiteY:Yr(_r,Gr)}}(Ln,mr):Vr==="compression"?function(_r,Gr){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][ws(_r,Gr)]}(Ln,mr):Vr==="box2i"?function(_r,Gr){return{xMin:io(_r,Gr),yMin:io(_r,Gr),xMax:io(_r,Gr),yMax:io(_r,Gr)}}(Ln,mr):Vr==="lineOrder"?function(_r,Gr){return["INCREASING_Y"][ws(_r,Gr)]}(Ln,mr):Vr==="float"?Yr(Ln,mr):Vr==="v2f"?function(_r,Gr){return[Yr(_r,Gr),Yr(_r,Gr)]}(Ln,mr):Vr==="v3f"?function(_r,Gr){return[Yr(_r,Gr),Yr(_r,Gr),Yr(_r,Gr)]}(Ln,mr):Vr==="int"?_o(Ln,mr):Vr==="rational"?function(_r,Gr){return[_o(_r,Gr),io(_r,Gr)]}(Ln,mr):Vr==="timecode"?function(_r,Gr){return[io(_r,Gr),io(_r,Gr)]}(Ln,mr):Vr==="preview"?(mr.value+=Kr,"skipped"):void(mr.value+=Kr)}const yp=new DataView(e),Sm=new Uint8Array(e),$m={value:0},dm=function(Ln,or,mr){const Vr={};if(Ln.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");Vr.version=Ln.getUint8(4);const Kr=Ln.getUint8(5);Vr.spec={singleTile:!!(2&Kr),longName:!!(4&Kr),deepFormat:!!(8&Kr),multiPart:!!(16&Kr)},mr.value=8;let _r=!0;for(;_r;){const Gr=Do(or,mr);if(Gr==0)_r=!1;else{const Is=Do(or,mr),Xs=Lu(Ln,or,mr,Is,io(Ln,mr));Xs===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Is}'.`):Vr[Gr]=Xs}}if(-5&Kr)throw console.error("EXRHeader:",Vr),new Error("THREE.EXRLoader: provided file is currently unsupported.");return Vr}(yp,e,$m),ho=function(Ln,or,mr,Vr,Kr){const _r={size:0,viewer:or,array:mr,offset:Vr,width:Ln.dataWindow.xMax-Ln.dataWindow.xMin+1,height:Ln.dataWindow.yMax-Ln.dataWindow.yMin+1,channels:Ln.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:Ln.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:g.GUF};switch(Ln.compression){case"NO_COMPRESSION":_r.lines=1,_r.uncompress=Ps;break;case"RLE_COMPRESSION":_r.lines=1,_r.uncompress=Os;break;case"ZIPS_COMPRESSION":_r.lines=1,_r.uncompress=gr;break;case"ZIP_COMPRESSION":_r.lines=16,_r.uncompress=gr;break;case"PIZ_COMPRESSION":_r.lines=32,_r.uncompress=kr;break;case"PXR24_COMPRESSION":_r.lines=16,_r.uncompress=$r;break;case"DWAA_COMPRESSION":_r.lines=32,_r.uncompress=co;break;case"DWAB_COMPRESSION":_r.lines=256,_r.uncompress=co;break;default:throw new Error("EXRLoader.parse: "+Ln.compression+" is unsupported")}if(_r.scanlineBlockSize=_r.lines,_r.type==1)switch(Kr){case g.VzW:_r.getter=bu,_r.inputSize=2;break;case g.cLu:_r.getter=qs,_r.inputSize=2}else{if(_r.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+_r.type+" for "+Ln.compression+".");switch(Kr){case g.VzW:_r.getter=Yr,_r.inputSize=4;break;case g.cLu:_r.getter=Cs,_r.inputSize=4}}_r.blockCount=(Ln.dataWindow.yMax+1)/_r.scanlineBlockSize;for(let Is=0;Is<_r.blockCount;Is++)dr(or,Vr);_r.outputChannels=_r.channels==3?4:_r.channels;const Gr=_r.width*_r.height*_r.outputChannels;switch(Kr){case g.VzW:_r.byteArray=new Float32Array(Gr),_r.channels<_r.outputChannels&&_r.byteArray.fill(1,0,Gr);break;case g.cLu:_r.byteArray=new Uint16Array(Gr),_r.channels<_r.outputChannels&&_r.byteArray.fill(15360,0,Gr);break;default:console.error("THREE.EXRLoader: unsupported type: ",Kr)}return _r.bytesPerLine=_r.width*_r.inputSize*_r.channels,_r.outputChannels==4?(_r.format=g.wk1,_r.colorSpace=g.GUF):(_r.format=g.hEm,_r.colorSpace=g.aCh),_r}(dm,yp,Sm,$m,this.type),G_={value:0},hx={R:0,G:1,B:2,A:3,Y:0};for(let Ln=0;Ln<ho.height/ho.scanlineBlockSize;Ln++){const or=io(yp,$m);ho.size=io(yp,$m),ho.lines=or+ho.scanlineBlockSize>ho.height?ho.height-or:ho.scanlineBlockSize;const mr=ho.size<ho.lines*ho.bytesPerLine?ho.uncompress(ho):Ps(ho);$m.value+=ho.size;for(let Vr=0;Vr<ho.scanlineBlockSize;Vr++){const Kr=Vr+Ln*ho.scanlineBlockSize;if(Kr>=ho.height)break;for(let _r=0;_r<ho.channels;_r++){const Gr=hx[dm.channels[_r].name];for(let Is=0;Is<ho.width;Is++){G_.value=(Vr*(ho.channels*ho.width)+_r*ho.width+Is)*ho.inputSize;const Xs=(ho.height-1-Kr)*(ho.width*ho.outputChannels)+Is*ho.outputChannels+Gr;ho.byteArray[Xs]=ho.getter(mr,G_)}}}}return{header:dm,width:ho.width,height:ho.height,data:ho.byteArray,format:ho.format,colorSpace:ho.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,i,s,o){return super.load(e,function(c,_){c.colorSpace=_.colorSpace,c.minFilter=g.wem,c.magFilter=g.wem,c.generateMipmaps=!1,c.flipY=!1,i&&i(c,_)},s,o)}}class HO extends b.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Fr]}async onAdded(e){var i,s;this._importer||(this._importer=new eu(class extends y4{constructor(o){super(o),this.setDataType(ey(e.renderer.rendererObject))}},["exr"],!1)),(s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var i,s;this._importer&&((s=(i=e.getManager())==null?void 0:i.importer)!=null&&s.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}HO.PluginType="EXRLoadPlugin";const QO=new WeakMap;class A4 extends g.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,s,o){const c=new g.hH6(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),this.url=e,c.load(e,_=>{if(QO.has(_))return QO.get(_).promise.then(i).catch(o);this.decodeObjects(_,e).then(j=>{j.userData.warnings=this.warnings,this.warnings=[],i(j)}).catch(j=>o(j))},s,o)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,i){let s,o;const c=e.byteLength,_=this._getWorker(c).then(j=>(s=j,o=this.workerNextTaskID++,new Promise((et,nt)=>{s._callbacks[o]={resolve:et,reject:nt},s.postMessage({type:"decode",id:o,buffer:e},[e])}))).then(j=>this._createGeometry(j.data)).catch(j=>{throw j});return _.catch(()=>!0).then(()=>{s&&o&&this._releaseTask(s,o)}),QO.set(e,{url:i,promise:_}),_}parse(e,i,s){this.decodeObjects(e,"").then(o=>{o.userData.warnings=this.warnings,i(o)}).catch(o=>s(o))}_compareMaterials(e){if(this.materials.includes(e))return e;const i={};i.name=e.name,i.color={},i.color.r=e.color.r,i.color.g=e.color.g,i.color.b=e.color.b,i.type=e.type;const s=JSON.stringify(i);for(let o=0;o<this.materials.length;o++){const c=this.materials[o],_={};if(_.name=c.name,_.color={},_.color.r=c.color.r,_.color.g=c.color.g,_.color.b=c.color.b,_.type=c.type,JSON.stringify(_)===s)return c}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new g.Wid({color:new g.Ilk(1,1,1),metalness:.8,name:"default",side:g.ehD});const i=e.diffuseColor,s=new g.Ilk(i.r/255,i.g/255,i.b/255);i.r===0&&i.g===0&&i.b===0&&(s.r=1,s.g=1,s.b=1);const o=new g.Wid({color:s,name:e.name,side:g.ehD,transparent:e.transparency>0,opacity:1-e.transparency}),c=new g.dpR;for(let _=0;_<e.textures.length;_++){const j=e.textures[_];if(j.image!==null){const et=c.load(j.image);switch(j.type){case"Diffuse":o.map=et;break;case"Bump":o.bumpMap=et;break;case"Transparency":o.alphaMap=et,o.transparent=!0;break;case"Emap":o.envMap=et}et.wrapS=j.wrapU===0?g.rpg:g.uWy,et.wrapT=j.wrapV===0?g.rpg:g.uWy,et.repeat.set(j.repeat[0],j.repeat[1])}}return o}_createGeometry(e){const i=new g.Tme,s=[],o=[],c=[];i.userData.layers=e.layers,i.userData.groups=e.groups,i.userData.settings=e.settings,i.userData.strings=e.strings,i.userData.objectType="File3dm",i.userData.materials=null,i.name=this.url;let _=e.objects;const j=e.materials;for(let et=0;et<_.length;et++){const nt=_[et],st=nt.attributes;switch(nt.objectType){case"InstanceDefinition":o.push(nt);break;case"InstanceReference":c.push(nt);break;default:let at;if(st.materialIndex>=0){const dt=j[st.materialIndex];let mt=this._createMaterial(dt);mt=this._compareMaterials(mt),at=this._createObject(nt,mt)}else{const dt=this._createMaterial();at=this._createObject(nt,dt)}if(at===void 0)continue;const ct=e.layers[st.layerIndex];at.visible=!ct||ct.visible,st.isInstanceDefinitionObject?s.push(at):i.add(at)}}for(let et=0;et<o.length;et++){const nt=o[et];_=[];for(let st=0;st<nt.attributes.objectIds.length;st++){const at=nt.attributes.objectIds[st];for(let ct=0;ct<s.length;ct++)at===s[ct].userData.attributes.id&&_.push(s[ct])}for(let st=0;st<c.length;st++){const at=c[st];if(at.geometry.parentIdefId===nt.attributes.id){const ct=at.geometry.xform.array,dt=new g.yGw;if(dt.set(...ct),_.length===1){const mt=_[0].clone(!0);if(mt.name=at.attributes.name||mt.name,mt.applyMatrix4(dt),at.attributes.materialIndex>=0&&at.attributes.materialIndex!==_[0].userData.attributes.materialIndex){const yt=j[at.attributes.materialIndex],wt=this._createMaterial(yt);mt.material=this._compareMaterials(wt)}if(mt.userData.defAttributes=mt.userData.attributes,mt.userData.defObjectType=mt.userData.objectType,mt.userData.attributes={...mt.userData.attributes,...at.attributes},mt.userData.objectType=at.objectType,at.attributes.layerIndex!==void 0){const yt=e.layers[at.attributes.layerIndex];mt.visible=yt?yt.visible:mt.visible}i.add(mt)}else{console.warn("THREE.Rhino3dmLoader: InstanceReference with multiple/no objects, not all properties will be copied.");const mt=new g.Tme;mt.applyMatrix4(dt);for(let yt=0;yt<_.length;yt++)mt.add(_[yt].clone(!0));i.add(mt)}}}}return i.userData.materials=this.materials,i}_createObject(e,i){const s=new g.s4_,o=e.attributes;let c,_,j,et;switch(e.objectType){case"Point":case"PointSet":c=s.parse(e.geometry),c.attributes.hasOwnProperty("color")?_=new g.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(j=o.drawColor,et=new g.Ilk(j.r/255,j.g/255,j.b/255),_=new g.UY4({color:et,sizeAttenuation:!1,size:2})),_=this._compareMaterials(_);const nt=new g.woe(c,_);return nt.userData.attributes=o,nt.userData.objectType=e.objectType,o.name&&(nt.name=o.name),nt;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;c=s.parse(e.geometry),c.attributes.hasOwnProperty("color")&&(i.vertexColors=!0),i===null&&(i=this._createMaterial(),i=this._compareMaterials(i));const st=new g.Kj0(c,i);return st.castShadow=o.castsShadows,st.receiveShadow=o.receivesShadows,st.userData.attributes=o,st.userData.objectType=e.objectType,o.name&&(st.name=o.name,c.name=o.name),st;case"Curve":c=s.parse(e.geometry),j=o.drawColor,et=new g.Ilk(j.r/255,j.g/255,j.b/255),_=new g.nls({color:et}),_=this._compareMaterials(_);const at=new g.x12(c,_);return at.userData.attributes=o,at.userData.objectType=e.objectType,o.name&&(at.name=o.name),at;case"TextDot":c=e.geometry;const ct=document.createElement("canvas").getContext("2d"),dt=`${c.fontHeight}px ${c.fontFace}`;ct.font=dt;const mt=ct.measureText(c.text).width+10,yt=c.fontHeight+10,wt=window.devicePixelRatio;ct.canvas.width=mt*wt,ct.canvas.height=yt*wt,ct.canvas.style.width=mt+"px",ct.canvas.style.height=yt+"px",ct.setTransform(wt,0,0,wt,0,0),ct.font=dt,ct.textBaseline="middle",ct.textAlign="center",et=o.drawColor,ct.fillStyle=`rgba(${et.r},${et.g},${et.b},${et.a})`,ct.fillRect(0,0,mt,yt),ct.fillStyle="white",ct.fillText(c.text,mt/2,yt/2);const Ct=new g.ROQ(ct.canvas);Ct.minFilter=g.wem,Ct.wrapS=g.uWy,Ct.wrapT=g.uWy,_=new g.xeV({map:Ct,depthTest:!1});const bt=new g.jyi(_);return bt.position.set(c.point[0],c.point[1],c.point[2]),bt.scale.set(mt/10,yt/10,1),bt.userData.attributes=o,bt.userData.objectType=e.objectType,o.name&&(bt.name=o.name),bt;case"Light":let At;switch(c=e.geometry,c.lightStyle.name){case"LightStyle_WorldPoint":At=new g.cek,At.castShadow=o.castsShadows,At.position.set(c.location[0],c.location[1],c.location[2]),At.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":At=new g.PMe,At.castShadow=o.castsShadows,At.position.set(c.location[0],c.location[1],c.location[2]),At.target.position.set(c.direction[0],c.direction[1],c.direction[2]),At.angle=c.spotAngleRadians,At.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":At=new g.T_f;const Pt=Math.abs(c.width[2]),Dt=Math.abs(c.length[0]);At.position.set(c.location[0]-Dt/2,c.location[1],c.location[2]-Pt/2),At.height=Dt,At.width=Pt,At.lookAt(c.direction[0],c.direction[1],c.direction[2]);break;case"LightStyle_WorldDirectional":At=new g.Ox3,At.castShadow=o.castsShadows,At.position.set(c.location[0],c.location[1],c.location[2]),At.target.position.set(c.direction[0],c.direction[1],c.direction[2]),At.shadow.normalBias=.1}return At&&(At.intensity=c.intensity,j=c.diffuse,et=new g.Ilk(j.r/255,j.g/255,j.b/255),At.color=et,At.userData.attributes=o,At.userData.objectType=e.objectType),At}}_initLibrary(){if(!this.libraryPending){const e=new g.hH6(this.manager);e.setPath(this.libraryPath);const i=new Promise((c,_)=>{e.load("rhino3dm.js",c,void 0,_)}),s=new g.hH6(this.manager);s.setPath(this.libraryPath),s.setResponseType("arraybuffer");const o=new Promise((c,_)=>{s.load("rhino3dm.wasm",c,void 0,_)});this.libraryPending=Promise.all([i,o]).then(([c,_])=>{this.libraryConfig.wasmBinary=_;const j=b4,et=["/* rhino3dm.js */",c,"/* worker */",j.substring(j.indexOf("{")+1,j.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([et]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",libraryConfig:this.libraryConfig}),s.onmessage=o=>{const c=o.data;switch(c.type){case"warning":this.warnings.push(c.data),console.warn(c.data);break;case"decode":s._callbacks[c.id].resolve(c);break;case"error":s._callbacks[c.id].reject(c);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+c.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,o){return s._taskLoad>o._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskLoad+=e,i})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}const b4=`
function Rhino3dmWorker() {

	let libraryPending;
	let libraryConfig;
	let rhino;
	let taskID;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':

				// console.log(message)
				libraryConfig = message.libraryConfig;
				const wasmBinary = libraryConfig.wasmBinary;
				let RhinoModule;
				libraryPending = new Promise( function ( resolve ) {

					/* Like Basis Loader */
					RhinoModule = { wasmBinary, onRuntimeInitialized: resolve };

					rhino3dm( RhinoModule ); // eslint-disable-line no-undef

				 } ).then( () => {

					rhino = RhinoModule;

				 } );

				break;

			case 'decode':

				taskID = message.id;
				const buffer = message.buffer;
				libraryPending.then( () => {

					try {

						const data = decodeObjects( rhino, buffer );
						self.postMessage( { type: 'decode', id: message.id, data } );

					} catch ( error ) {

						self.postMessage( { type: 'error', id: message.id, error } );

					}

				} );

				break;

		}

	};

	function decodeObjects( rhino, buffer ) {

		const arr = new Uint8Array( buffer );
		const doc = rhino.File3dm.fromByteArray( arr );

		const objects = [];
		const materials = [];
		const layers = [];
		const views = [];
		const namedViews = [];
		const groups = [];
		const strings = [];

		//Handle objects

		const objs = doc.objects();
		const cnt = objs.count;

		for ( let i = 0; i < cnt; i ++ ) {

			const _object = objs.get( i );

			const object = extractObjectData( _object, doc );

			_object.delete();

			if ( object ) {

				objects.push( object );

			}

		}

		// Handle instance definitions
		// console.log( \`Instance Definitions Count: \${doc.instanceDefinitions().count()}\` );

		for ( let i = 0; i < doc.instanceDefinitions().count(); i ++ ) {

			const idef = doc.instanceDefinitions().get( i );
			const idefAttributes = extractProperties( idef );
			idefAttributes.objectIds = idef.getObjectIds();

			objects.push( { geometry: null, attributes: idefAttributes, objectType: 'InstanceDefinition' } );

		}

		// Handle materials

		const textureTypes = [
			// rhino.TextureType.Bitmap,
			rhino.TextureType.Diffuse,
			rhino.TextureType.Bump,
			rhino.TextureType.Transparency,
			rhino.TextureType.Opacity,
			rhino.TextureType.Emap
		];

		const pbrTextureTypes = [
			rhino.TextureType.PBR_BaseColor,
			rhino.TextureType.PBR_Subsurface,
			rhino.TextureType.PBR_SubsurfaceScattering,
			rhino.TextureType.PBR_SubsurfaceScatteringRadius,
			rhino.TextureType.PBR_Metallic,
			rhino.TextureType.PBR_Specular,
			rhino.TextureType.PBR_SpecularTint,
			rhino.TextureType.PBR_Roughness,
			rhino.TextureType.PBR_Anisotropic,
			rhino.TextureType.PBR_Anisotropic_Rotation,
			rhino.TextureType.PBR_Sheen,
			rhino.TextureType.PBR_SheenTint,
			rhino.TextureType.PBR_Clearcoat,
			rhino.TextureType.PBR_ClearcoatBump,
			rhino.TextureType.PBR_ClearcoatRoughness,
			rhino.TextureType.PBR_OpacityIor,
			rhino.TextureType.PBR_OpacityRoughness,
			rhino.TextureType.PBR_Emission,
			rhino.TextureType.PBR_AmbientOcclusion,
			rhino.TextureType.PBR_Displacement
		];

		for ( let i = 0; i < doc.materials().count(); i ++ ) {

			const _material = doc.materials().get( i );
			const _pbrMaterial = _material.physicallyBased();

			let material = extractProperties( _material );

			const textures = [];

			for ( let j = 0; j < textureTypes.length; j ++ ) {

				const _texture = _material.getTexture( textureTypes[ j ] );
				if ( _texture ) {

					let textureType = textureTypes[ j ].constructor.name;
					textureType = textureType.substring( 12, textureType.length );
					const texture = { type: textureType };

					const image = doc.getEmbeddedFileAsBase64( _texture.fileName );

					texture.wrapU = _texture.wrapU;
					texture.wrapV = _texture.wrapV;
					texture.wrapW = _texture.wrapW;
					const uvw = _texture.uvwTransform.toFloatArray( true );
					texture.repeat = [ uvw[ 0 ], uvw[ 5 ] ];

					if ( image ) {

						texture.image = 'data:image/png;base64,' + image;

					} else {

						self.postMessage( { type: 'warning', id: taskID, data: {
							message: \`THREE.3DMLoader: Image for \${textureType} texture not embedded in file.\`,
							type: 'missing resource'
						}

						} );

						texture.image = null;

					}

					textures.push( texture );

					_texture.delete();

				}

			}

			material.textures = textures;

			if ( _pbrMaterial.supported ) {

				for ( let j = 0; j < pbrTextureTypes.length; j ++ ) {

					const _texture = _material.getTexture( pbrTextureTypes[ j ] );
					if ( _texture ) {

						const image = doc.getEmbeddedFileAsBase64( _texture.fileName );
						let textureType = pbrTextureTypes[ j ].constructor.name;
						textureType = textureType.substring( 12, textureType.length );
						const texture = { type: textureType, image: 'data:image/png;base64,' + image };
						textures.push( texture );

						_texture.delete();

					}

				}

				const pbMaterialProperties = extractProperties( _material.physicallyBased() );

				material = Object.assign( pbMaterialProperties, material );

			}

			materials.push( material );

			_material.delete();
			_pbrMaterial.delete();

		}

		// Handle layers

		for ( let i = 0; i < doc.layers().count(); i ++ ) {

			const _layer = doc.layers().get( i );
			const layer = extractProperties( _layer );

			layers.push( layer );

			_layer.delete();

		}

		// Handle views

		for ( let i = 0; i < doc.views().count(); i ++ ) {

			const _view = doc.views().get( i );
			const view = extractProperties( _view );

			views.push( view );

			_view.delete();

		}

		// Handle named views

		for ( let i = 0; i < doc.namedViews().count(); i ++ ) {

			const _namedView = doc.namedViews().get( i );
			const namedView = extractProperties( _namedView );

			namedViews.push( namedView );

			_namedView.delete();

		}

		// Handle groups

		for ( let i = 0; i < doc.groups().count(); i ++ ) {

			const _group = doc.groups().get( i );
			const group = extractProperties( _group );

			groups.push( group );

			_group.delete();

		}

		// Handle settings

		const settings = extractProperties( doc.settings() );

		//TODO: Handle other document stuff like dimstyles, instance definitions, bitmaps etc.

		// Handle dimstyles
		// console.log( \`Dimstyle Count: \${doc.dimstyles().count()}\` );

		// Handle bitmaps
		// console.log( \`Bitmap Count: \${doc.bitmaps().count()}\` );

		// Handle strings
		// console.log( \`Document Strings Count: \${doc.strings().count()}\` );
		// Note: doc.strings().documentUserTextCount() counts any doc.strings defined in a section
		//console.log( \`Document User Text Count: \${doc.strings().documentUserTextCount()}\` );

		const strings_count = doc.strings().count();

		for ( let i = 0; i < strings_count; i ++ ) {

			strings.push( doc.strings().get( i ) );

		}

		doc.delete();

		return { objects, materials, layers, views, namedViews, groups, strings, settings };

	}

	function extractObjectData( object, doc ) {

		const _geometry = object.geometry();
		const _attributes = object.attributes();
		let objectType = _geometry.objectType;
		let geometry, attributes, position, data, mesh;

		// skip instance definition objects
		//if( _attributes.isInstanceDefinitionObject ) { continue; }

		// TODO: handle other geometry types
		switch ( objectType ) {

			case rhino.ObjectType.Curve:

				const pts = curveToPoints( _geometry, 100 );

				position = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [];

				for ( let j = 0; j < pts.length; j ++ ) {

					position.array.push( pts[ j ][ 0 ] );
					position.array.push( pts[ j ][ 1 ] );
					position.array.push( pts[ j ][ 2 ] );

				}

				attributes.position = position;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.Point:

				const pt = _geometry.location;

				position = {};
				const color = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [ pt[ 0 ], pt[ 1 ], pt[ 2 ] ];

				const _color = _attributes.drawColor( doc );

				color.itemSize = 3;
				color.type = 'Float32Array';
				color.array = [ _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 ];

				attributes.position = position;
				attributes.color = color;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.PointSet:
			case rhino.ObjectType.Mesh:

				geometry = _geometry.toThreejsJSON();

				break;

			case rhino.ObjectType.Brep:

				const faces = _geometry.faces();
				mesh = new rhino.Mesh();

				for ( let faceIndex = 0; faceIndex < faces.count; faceIndex ++ ) {

					const face = faces.get( faceIndex );
					const _mesh = face.getMesh( rhino.MeshType.Any );

					if ( _mesh ) {

						mesh.append( _mesh );
						_mesh.delete();

					}

					face.delete();

				}

				if ( mesh.faces().count > 0 ) {

					mesh.compact();
					geometry = mesh.toThreejsJSON();
					faces.delete();

				}

				mesh.delete();

				break;

			case rhino.ObjectType.Extrusion:

				mesh = _geometry.getMesh( rhino.MeshType.Any );

				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

			case rhino.ObjectType.TextDot:

				geometry = extractProperties( _geometry );

				break;

			case rhino.ObjectType.Light:

				geometry = extractProperties( _geometry );

				if ( geometry.lightStyle.name === 'LightStyle_WorldLinear' ) {

					self.postMessage( { type: 'warning', id: taskID, data: {
						message: \`THREE.3DMLoader: No conversion exists for \${objectType.constructor.name} \${geometry.lightStyle.name}\`,
						type: 'no conversion',
						guid: _attributes.id
					}

					} );

				}

				break;

			case rhino.ObjectType.InstanceReference:

				geometry = extractProperties( _geometry );
				geometry.xform = extractProperties( _geometry.xform );
				geometry.xform.array = _geometry.xform.toFloatArray( true );

				break;

			case rhino.ObjectType.SubD:

				// TODO: precalculate resulting vertices and faces and warn on excessive results
				_geometry.subdivide( 3 );
				mesh = rhino.Mesh.createFromSubDControlNet( _geometry );
				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

				/*
				case rhino.ObjectType.Annotation:
				case rhino.ObjectType.Hatch:
				case rhino.ObjectType.ClipPlane:
				*/

			default:

				self.postMessage( { type: 'warning', id: taskID, data: {
					message: \`THREE.3DMLoader: Conversion not implemented for \${objectType.constructor.name}\`,
					type: 'not implemented',
					guid: _attributes.id
				}

				} );

				break;

		}

		if ( geometry ) {

			attributes = extractProperties( _attributes );
			attributes.geometry = extractProperties( _geometry );

			if ( _attributes.groupCount > 0 ) {

				attributes.groupIds = _attributes.getGroupList();

			}

			if ( _attributes.userStringCount > 0 ) {

				attributes.userStrings = _attributes.getUserStrings();

			}

			if ( _geometry.userStringCount > 0 ) {

				attributes.geometry.userStrings = _geometry.getUserStrings();

			}

			attributes.drawColor = _attributes.drawColor( doc );

			objectType = objectType.constructor.name;
			objectType = objectType.substring( 11, objectType.length );

			return { geometry, attributes, objectType };

		} else {

			self.postMessage( { type: 'warning', id: taskID, data: {
				message: \`THREE.3DMLoader: \${objectType.constructor.name} has no associated mesh geometry.\`,
				type: 'missing mesh',
				guid: _attributes.id
			}

			} );

		}

	}

	function extractProperties( object ) {

		const result = {};

		for ( const property in object ) {

			const value = object[ property ];

			if ( typeof value !== 'function' ) {

				if ( typeof value === 'object' && value !== null && value.hasOwnProperty( 'constructor' ) ) {

					result[ property ] = { name: value.constructor.name, value: value.value };

				} else {

					result[ property ] = value;

				}

			} else {

				// these are functions that could be called to extract more data.
				//console.log( \`\${property}: \${object[ property ].constructor.name}\` );

			}

		}

		return result;

	}

	function curveToPoints( curve, pointLimit ) {

		let pointCount = pointLimit;
		let rc = [];
		const ts = [];

		if ( curve instanceof rhino.LineCurve ) {

			return [ curve.pointAtStart, curve.pointAtEnd ];

		}

		if ( curve instanceof rhino.PolylineCurve ) {

			pointCount = curve.pointCount;
			for ( let i = 0; i < pointCount; i ++ ) {

				rc.push( curve.point( i ) );

			}

			return rc;

		}

		if ( curve instanceof rhino.PolyCurve ) {

			const segmentCount = curve.segmentCount;

			for ( let i = 0; i < segmentCount; i ++ ) {

				const segment = curve.segmentCurve( i );
				const segmentArray = curveToPoints( segment, pointCount );
				rc = rc.concat( segmentArray );
				segment.delete();

			}

			return rc;

		}

		if ( curve instanceof rhino.ArcCurve ) {

			pointCount = Math.floor( curve.angleDegrees / 5 );
			pointCount = pointCount < 2 ? 2 : pointCount;
			// alternative to this hardcoded version: https://stackoverflow.com/a/18499923/2179399

		}

		if ( curve instanceof rhino.NurbsCurve && curve.degree === 1 ) {

			const pLine = curve.tryGetPolyline();

			for ( let i = 0; i < pLine.count; i ++ ) {

				rc.push( pLine.get( i ) );

			}

			pLine.delete();

			return rc;

		}

		const domain = curve.domain;
		const divisions = pointCount - 1.0;

		for ( let j = 0; j < pointCount; j ++ ) {

			const t = domain[ 0 ] + ( j / divisions ) * ( domain[ 1 ] - domain[ 0 ] );

			if ( t === domain[ 0 ] || t === domain[ 1 ] ) {

				ts.push( t );
				continue;

			}

			const tan = curve.tangentAt( t );
			const prevTan = curve.tangentAt( ts.slice( - 1 )[ 0 ] );

			// Duplicated from THREE.Vector3
			// How to pass imports to worker?

			const tS = tan[ 0 ] * tan[ 0 ] + tan[ 1 ] * tan[ 1 ] + tan[ 2 ] * tan[ 2 ];
			const ptS = prevTan[ 0 ] * prevTan[ 0 ] + prevTan[ 1 ] * prevTan[ 1 ] + prevTan[ 2 ] * prevTan[ 2 ];

			const denominator = Math.sqrt( tS * ptS );

			let angle;

			if ( denominator === 0 ) {

				angle = Math.PI / 2;

			} else {

				const theta = ( tan.x * prevTan.x + tan.y * prevTan.y + tan.z * prevTan.z ) / denominator;
				angle = Math.acos( Math.max( - 1, Math.min( 1, theta ) ) );

			}

			if ( angle < 0.1 ) continue;

			ts.push( t );

		}

		rc = ts.map( t => curve.pointAt( t ) );
		return rc;

	}

}
`;var ZC,tI=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class qp extends A4{constructor(e){super(e),this.materials=[],this.setLibraryPath(qp.LIBRARY_PATH)}_createMaterial(e){return qp.ImportMaterials?super._createMaterial(e):this.materials[0]||new g.Wid({color:new g.Ilk(1,1,1),metalness:.8,name:"default",side:g.ehD})}async loadAsync(e,i){const s=await super.loadAsync(e,i);s.rotateX(-Math.PI/2),s.userData.materials&&delete s.userData.materials;const o=s.userData.layers;return s.traverse(c=>{var st,at,ct,dt;const _=(st=c.userData.attributes)==null?void 0:st.castsShadows,j=(at=c.userData.attributes)==null?void 0:at.receivesShadows;c.castShadow=_,c.receiveShadow=j;const et=((ct=c.userData.attributes)==null?void 0:ct.layerIndex)??((dt=c.userData.defAttributes)==null?void 0:dt.layerIndex),nt=o[et];nt&&(c.userData.rhinoLayer=nt),c.userData.rhino3dmRoot=s.uuid,this._hideLineMesh(c),this._useInstancedMesh(c),this._useMaterialSource(c,nt)}),this.materials=[],s}_useMaterialSource(e,i){var o,c,_,j,et;if(!qp.ImportMaterials)return;const s=e;if(((o=s.material)==null?void 0:o.name)==="default"||qp.ForceLayerMaterials){const nt=((c=s.userData.attributes)==null?void 0:c.materialSource)||((_=s.userData.defAttributes)==null?void 0:_.materialSource),st=((j=s.userData.attributes)==null?void 0:j.colorSource)||((et=s.userData.defAttributes)==null?void 0:et.colorSource);if(!qp.ForceLayerMaterials&&!nt&&!st)return;qp.ForceLayerMaterials||(nt==null?void 0:nt.value)===0||(nt==null?void 0:nt.value)===1&&(st==null?void 0:st.value)===0?i&&(s.material=this._compareMaterials(this._createMaterial({diffuseColor:i.color,name:i.name,transparency:0,textures:[]}))):(nt==null?void 0:nt.value)===3||(nt==null?void 0:nt.value)===1&&(st==null?void 0:st.value)===3?s.traverseAncestors(at=>{at!=null&&at.material&&(s.material=at.material)}):nt&&nt.value!==1&&console.warn("Unknown material source",nt,s,s.userData.attributes)}}_useInstancedMesh(e){if(!qp.ReplaceWithInstancedMesh||e.children.length<=0)return;const i=e.children,s=i.map(c=>c.geometry);s.filter((c,_)=>s.indexOf(c)===_).forEach(c=>{var et;const _=i.filter(nt=>nt.geometry===c),j=_.length>0?_.filter(nt=>nt.material===_[0].material):[];if(j.length>1){const nt=new g.SPe(c,j[0].material,j.length);nt.userData={...j[0].userData},nt.userData.instanceUserData=[],nt.userData.attributes=nt.userData.defAttributes||nt.userData.attributes,nt.userData.defAttributes&&delete nt.userData.defAttributes,nt.name=((et=nt.userData.attributes)==null?void 0:et.name)||j[0].name,j.forEach((st,at)=>{nt.setMatrixAt(at,st.matrix),e.remove(st),nt.userData.instanceUserData.push(st.userData)}),e.add(nt)}})}_hideLineMesh(e){if(!qp.HideLineMesh||e.children.length<=0)return;const i=[];e.traverse(s=>{s&&(s.isLine||s.isLineSegments||s.isPoints)&&i.push(s)}),i.forEach(s=>{s.userData.visible_3dm=s.visible,s.visible=!1})}}qp.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/rhino3dm@7.15.0/",qp.ImportMaterials=!0,qp.ForceLayerMaterials=!1,qp.ReplaceWithInstancedMesh=!1,qp.HideLineMesh=!1;let xy=ZC=class extends b.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Fr],this._importer=new eu(qp,["3dm"],!0),this.importMaterials=!0,this.forceLayerMaterials=!1,this.replaceWithInstancedMesh=!1,this.hideLineMesh=!1}_refresh(){qp.ImportMaterials=this.importMaterials,qp.ForceLayerMaterials=this.forceLayerMaterials,qp.ReplaceWithInstancedMesh=this.replaceWithInstancedMesh,qp.HideLineMesh=this.hideLineMesh}async onAdded(h){var e,i;(i=(e=h.getManager())==null?void 0:e.importer)==null||i.Importers.push(this._importer),this._refresh()}async onDispose(h){}async onRemove(h){var e,i;(i=(e=h.getManager())==null?void 0:e.importer)!=null&&i.Importers&&h.getManager().importer.Importers.splice(h.getManager().importer.Importers.indexOf(this._importer),1)}};xy.PluginType="Rhino3dmLoadPlugin",tI([(0,b.onChange)(ZC.prototype._refresh),jr()],xy.prototype,"importMaterials",void 0),tI([(0,b.onChange)(ZC.prototype._refresh),jr()],xy.prototype,"forceLayerMaterials",void 0),tI([(0,b.onChange)(ZC.prototype._refresh),jr()],xy.prototype,"replaceWithInstancedMesh",void 0),tI([(0,b.onChange)(ZC.prototype._refresh),jr()],xy.prototype,"hideLineMesh",void 0),xy=ZC=tI([ks("Rhino 3dm loader")],xy);class w4 extends g.aNw{constructor(e){super(e)}load(e,i,s,o){const c=this,_=new g.hH6(this.manager);_.setPath(this.path),_.setResponseType("arraybuffer"),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials),_.load(e,function(j){try{i(c.parse(j))}catch(et){o?o(et):console.error(et),c.manager.itemError(e)}},s,o)}parse(e){function i(c,_,j){for(let et=0,nt=c.length;et<nt;et++)if(c[et]!==_.getUint8(j+et))return!1;return!0}const s=function(c){if(typeof c=="string"){const _=new Uint8Array(c.length);for(let j=0;j<c.length;j++)_[j]=255&c.charCodeAt(j);return _.buffer||_}return c}(e);return function(c){const _=new DataView(c);if(84+50*_.getUint32(80,!0)===_.byteLength)return!0;const j=[115,111,108,105,100];for(let et=0;et<5;et++)if(i(j,_,et))return!1;return!0}(s)?function(c){const _=new DataView(c),j=_.getUint32(80,!0);let et,nt,st,at,ct,dt,mt,yt,wt=!1;for(let Pt=0;Pt<70;Pt++)_.getUint32(Pt,!1)==1129270351&&_.getUint8(Pt+4)==82&&_.getUint8(Pt+5)==61&&(wt=!0,at=new Float32Array(3*j*3),ct=_.getUint8(Pt+6)/255,dt=_.getUint8(Pt+7)/255,mt=_.getUint8(Pt+8)/255,yt=_.getUint8(Pt+9)/255);const Ct=new g.u9r,bt=new Float32Array(3*j*3),At=new Float32Array(3*j*3);for(let Pt=0;Pt<j;Pt++){const Dt=84+50*Pt,Nt=_.getFloat32(Dt,!0),Vt=_.getFloat32(Dt+4,!0),Zt=_.getFloat32(Dt+8,!0);if(wt){const an=_.getUint16(Dt+48,!0);32768&an?(et=ct,nt=dt,st=mt):(et=(31&an)/31,nt=(an>>5&31)/31,st=(an>>10&31)/31)}for(let an=1;an<=3;an++){const fn=Dt+12*an,mn=3*Pt*3+3*(an-1);bt[mn]=_.getFloat32(fn,!0),bt[mn+1]=_.getFloat32(fn+4,!0),bt[mn+2]=_.getFloat32(fn+8,!0),At[mn]=Nt,At[mn+1]=Vt,At[mn+2]=Zt,wt&&(at[mn]=et,at[mn+1]=nt,at[mn+2]=st)}}return Ct.setAttribute("position",new g.TlE(bt,3)),Ct.setAttribute("normal",new g.TlE(At,3)),wt&&(Ct.setAttribute("color",new g.TlE(at,3)),Ct.hasColors=!0,Ct.alpha=yt),Ct}(s):function(c){const _=new g.u9r,j=/solid([\s\S]*?)endsolid/g,et=/facet([\s\S]*?)endfacet/g;let nt=0;const st=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,at=new RegExp("vertex"+st+st+st,"g"),ct=new RegExp("normal"+st+st+st,"g"),dt=[],mt=[],yt=new g.Pa4;let wt,Ct=0,bt=0,At=0;for(;(wt=j.exec(c))!==null;){bt=At;const Pt=wt[0];for(;(wt=et.exec(Pt))!==null;){let Vt=0,Zt=0;const an=wt[0];for(;(wt=ct.exec(an))!==null;)yt.x=parseFloat(wt[1]),yt.y=parseFloat(wt[2]),yt.z=parseFloat(wt[3]),Zt++;for(;(wt=at.exec(an))!==null;)dt.push(parseFloat(wt[1]),parseFloat(wt[2]),parseFloat(wt[3])),mt.push(yt.x,yt.y,yt.z),Vt++,At++;Zt!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+nt),Vt!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+nt),nt++}const Dt=bt,Nt=At-bt;_.addGroup(Dt,Nt,Ct),Ct++}return _.setAttribute("position",new g.a$l(dt,3)),_.setAttribute("normal",new g.a$l(mt,3)),_}(typeof(o=e)!="string"?new TextDecoder().decode(o):o);var o}}class WO extends b.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Fr]}async onAdded(e){var i,s;this._importer||(this._importer=new eu(w4,["stl"],!0)),(s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var i,s;this._importer&&((s=(i=e.getManager())==null?void 0:i.importer)!=null&&s.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}WO.PluginType="STLLoadPlugin";class qO extends b.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Fr]}async onAdded(e){const i=document.createElement("script");i.type="module",i.innerHTML=`
import { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(i),this._script=i}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}qO.PluginType="GLTFMeshOptPlugin";var x4=__webpackgi_require__(701),m1=__webpackgi_require__.n(x4),E4=__webpackgi_require__(236),g1=__webpackgi_require__.n(E4),S4=__webpackgi_require__(850),_1=__webpackgi_require__.n(S4),C4=__webpackgi_require__(182),v1=__webpackgi_require__.n(C4),T4=__webpackgi_require__(213),y1=__webpackgi_require__.n(T4),NP=__webpackgi_require__(27),nI={};NP.Z&&NP.Z.locals&&(nI.locals=NP.Z.locals);var XO,YO=0,GE={};GE.styleTagTransform=y1(),GE.setAttributes=_1(),GE.insert=function(h,e){(e.target||document.head).appendChild(h)},GE.domAPI=g1(),GE.insertStyleElement=v1(),nI.use=function(h){return GE.options=h||{},YO++||(XO=m1()(NP.Z,GE)),nI},nI.unuse=function(){YO>0&&!--YO&&(XO(),XO=null)};var M4=nI,UP=__webpackgi_require__(356),rI={};UP.Z&&UP.Z.locals&&(rI.locals=UP.Z.locals);var $O,KO=0,HE={};HE.styleTagTransform=y1(),HE.setAttributes=_1(),HE.insert=function(h,e){(e.target||document.head).appendChild(h)},HE.domAPI=g1(),HE.insertStyleElement=v1(),rI.use=function(h){return HE.options=h||{},KO++||($O=m1()(UP.Z,HE)),rI},rI.unuse=function(){KO>0&&!--KO&&($O(),$O=null)};var I4=rI;class eT extends ms{_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}constructor(e){super(),this.enabled=!0,this.dependencies=[Fr],this.processState=new Map,this._mainDiv=(0,b.createDiv)({id:"assetManager"+e,addToBody:!1,innerHTML:""}),this._contentDiv=(0,b.createDiv)({id:"assetManager"+e+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}async onAdded(e){var i,s,o,c,_,j,et,nt,st,at,ct,dt;await super.onAdded(e),e.container.appendChild(this._mainDiv),this._updateMainDiv(this.processState),(s=(i=e.getManager())==null?void 0:i.importer)==null||s.addEventListener("importFile",mt=>{mt.state!=="done"?this.processState.set(mt.path,{state:mt.state,progress:mt.progress?100*mt.progress:void 0}):this.processState.delete(mt.path),this._updateMainDiv(this.processState)}),(c=(o=e.getManager())==null?void 0:o.importer)==null||c.addEventListener("processFileStart",mt=>{this.processState.set(mt.path,{state:"processing",progress:void 0}),this._updateMainDiv(this.processState)}),(j=(_=e.getManager())==null?void 0:_.importer)==null||j.addEventListener("processFileEnd",mt=>{this.processState.delete(mt.path),this._updateMainDiv(this.processState)}),(nt=(et=e.getManager())==null?void 0:et.exporter)==null||nt.addEventListener("exportFile",mt=>{mt.state!=="done"?this.processState.set(mt.obj.name,{state:mt.state,progress:mt.progress?100*mt.progress:void 0}):this.processState.delete(mt.obj.name),this._updateMainDiv(this.processState)}),(st=e.getPluginByType("FileTransferPlugin"))==null||st.addEventListener("transferFile",mt=>{mt.state!=="done"?this.processState.set(mt.path,{state:mt.state,progress:mt.progress?100*mt.progress:void 0}):this.processState.delete(mt.path),this._updateMainDiv(this.processState)}),(at=e.getPluginByType("MaterialConfiguratorPlugin"))==null||at.addEventListener("progress",mt=>{mt.state!=="done"?this.processState.set("MatpreviewGeneration",{state:mt.state,progress:0}):this.processState.delete("MatpreviewGeneration"),this._updateMainDiv(this.processState)}),(ct=e.getPluginByType("SwitchNodePlugin"))==null||ct.addEventListener("progress",mt=>{mt.state!=="done"?this.processState.set("SwitchNodeGeneration",{state:mt.state,progress:0}):this.processState.delete("SwitchNodeGeneration"),this._updateMainDiv(this.processState)}),(dt=e.getPluginByType("ThemePlugin"))==null||dt.addEventListener("progress",mt=>{mt.state!=="done"?this.processState.set("ThemeInit",{state:mt.state,progress:0}):this.processState.delete("ThemeInit"),this._updateMainDiv(this.processState)})}async onRemove(e){var i;return this._mainDiv.remove(),(i=this._contentDiv)==null||i.remove(),this.processState.clear(),super.onRemove(e)}}(function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);c>3&&_&&Object.defineProperty(e,i,_)})([jr("Enabled"),(0,b.onChange)(eT.prototype._onEnabledChange),En()],eT.prototype,"enabled",void 0);var Ey,mp=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Kl=Ey=class extends eT{refresh(){this._updateMainDiv(this._isPreviewing?this._previewState:this.processState,!1)}togglePreview(){this.maximize(),this._isPreviewing=!this._isPreviewing,this.refresh(),this._isPreviewing?this.show():this.hideWithDelay()}constructor(){super("LoadingScreen"),this.styles=M4,this.spinners=[{styles:I4,html:'<span class="loader"></span>'}],this.loader=0,this.loadingTextHeader="Loading Files",this.errorTextHeader="Error Loading Files",this.showFileNames=!0,this.showProcessStates=!0,this.showProgress=!0,this.hideOnOnlyErrors=!0,this.hideOnFilesLoad=!0,this.hideOnSceneObjectLoad=!1,this.minimizeOnSceneObjectLoad=!0,this.showOnFilesLoading=!0,this.showOnSceneEmpty=!0,this.hideDelay=500,this.backgroundOpacity=.5,this.backgroundBlur=24,this.background="#ffffff",this.textColor="#222222",this.logoImage="https://static.webgi.xyz/logo.svg",this._isPreviewing=!1,this._previewState=new Map([["file.glb",{state:"downloading",progress:50}],["environment.hdr",{state:"adding"}]]),this.loadingElement=(0,b.createDiv)({classList:["loadingScreenLoadingElement"],addToBody:!1}),this.filesElement=(0,b.createDiv)({classList:["loadingScreenFilesElement"],addToBody:!1}),this.logoElement=(0,b.createDiv)({classList:["loadingScreenLogoElement"],addToBody:!1}),this._isHidden=!1,this._sceneUpdate=h=>{if(!this._viewer||!h.hierarchyChanged)return;const e=this._viewer.scene.modelRoot.children;e.length===0&&this.showOnSceneEmpty&&this.show(),console.log(e.length),e.length>0?this.hideOnSceneObjectLoad?this.hideWithDelay():this.minimizeOnSceneObjectLoad&&(0,b.timeout)(this.hideDelay+300).then(()=>this.minimize()):this.minimizeOnSceneObjectLoad&&this.maximize()},this._mainDiv.prepend(this.loadingElement),this._mainDiv.prepend(this.logoElement),this._mainDiv.appendChild(this.filesElement)}async hide(){this._isHidden=!0,this._mainDiv.style.opacity="0",await(0,b.timeout)(502),this._isHidden&&(this._mainDiv.style.display="none",this._showMainDiv())}async hideWithDelay(){if(this._isHidden=!0,await(0,b.timeout)(this.hideDelay),this._isHidden)return this.hide()}show(){this._isHidden=!1,this._showMainDiv(),this._mainDiv.style.display="flex"}_showMainDiv(){this._mainDiv.style.opacity="1"}minimize(){this._mainDiv.classList.add("minimizedLoadingScreen")}maximize(){this._mainDiv.classList.remove("minimizedLoadingScreen")}_setHTML(h,e){h.innerHTML!==e&&(h.innerHTML=e)}_updateMainDiv(h,e=!0){if(!this._viewer||!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");if(this.showFileNames){let s="";h.forEach((o,c)=>{s+=(this.showProcessStates?`<span class="loadingScreenProcessState">${o.state}</span>: `:"")+(c||"").split("/").pop()+(this.showProgress&&o.progress?" - "+o.progress.toFixed(0)+"%":"")+"<br>"}),this._setHTML(this.filesElement,s)}else this._setHTML(this.filesElement,"");const i=[...h.values()].filter(s=>s.state==="error");i.length>0&&i.length===h.size&&!this.hideOnOnlyErrors?this._setHTML(this._contentDiv,this.errorTextHeader):this._setHTML(this._contentDiv,this.loadingTextHeader),this._setHTML(this.loadingElement,this.spinners[this.loader].html),this._mainDiv.style.setProperty("--b-opacity",this.backgroundOpacity.toString()),this._mainDiv.style.setProperty("--b-background",this.background),this._mainDiv.style.backdropFilter=`blur(${this.backgroundBlur}px)`,this._mainDiv.style.color=this.textColor,this._setHTML(this.logoElement,this.logoImage?`<img class="loadingScreenLogoImageImg" src="${this.logoImage}"/>`:""),e&&(this.hideOnFilesLoad&&(h.size===0||i.length===h.size&&this.hideOnOnlyErrors)?this.hideDelay?this.hideWithDelay():this.hide():h.size>0&&this.showOnFilesLoading&&this.show())}async onAdded(h){this.styles.use({target:h.container}),this.spinners.forEach(e=>{e.styles.use({target:h.container})}),h.scene.addEventListener("sceneUpdate",this._sceneUpdate),await super.onAdded(h)}async onRemove(h){h.scene.removeEventListener("sceneUpdate",this._sceneUpdate),await super.onRemove(h)}};Kl.PluginType="LoadingScreenPlugin",mp([Pm("Loader",["Spinner 1"].map((h,e)=>({value:e,label:h}))),(0,b.serialize)()],Kl.prototype,"loader",void 0),mp([$s("Loading text header"),(0,b.onChange)(Ey.prototype.refresh),(0,b.serialize)()],Kl.prototype,"loadingTextHeader",void 0),mp([$s("Error text header"),(0,b.serialize)()],Kl.prototype,"errorTextHeader",void 0),mp([jr("Show file names"),(0,b.serialize)(),(0,b.onChange)(Ey.prototype.refresh)],Kl.prototype,"showFileNames",void 0),mp([jr("Show process states"),(0,b.serialize)(),(0,b.onChange)(Ey.prototype.refresh)],Kl.prototype,"showProcessStates",void 0),mp([jr("Show progress"),(0,b.serialize)(),(0,b.onChange)(Ey.prototype.refresh)],Kl.prototype,"showProgress",void 0),mp([jr("Hide on only errors"),(0,b.serialize)()],Kl.prototype,"hideOnOnlyErrors",void 0),mp([jr("Hide on files load"),(0,b.serialize)()],Kl.prototype,"hideOnFilesLoad",void 0),mp([jr("Hide on scene object load"),(0,b.serialize)()],Kl.prototype,"hideOnSceneObjectLoad",void 0),mp([jr("Minimize on scene object load"),(0,b.serialize)()],Kl.prototype,"minimizeOnSceneObjectLoad",void 0),mp([jr("Show when files start loading"),(0,b.serialize)()],Kl.prototype,"showOnFilesLoading",void 0),mp([jr("Show when scene empty"),(0,b.serialize)()],Kl.prototype,"showOnSceneEmpty",void 0),mp([$s("Hide delay (ms)"),(0,b.serialize)()],Kl.prototype,"hideDelay",void 0),mp([ns("Background Opacity",[0,1]),(0,b.onChange)(Ey.prototype.refresh),(0,b.serialize)()],Kl.prototype,"backgroundOpacity",void 0),mp([ns("Background Blur",[0,100]),(0,b.onChange)(Ey.prototype.refresh),(0,b.serialize)()],Kl.prototype,"backgroundBlur",void 0),mp([$s("Background Color"),(0,b.onChange)(Ey.prototype.refresh),(0,b.serialize)()],Kl.prototype,"background",void 0),mp([$s("Text Color"),(0,b.onChange)(Ey.prototype.refresh),(0,b.serialize)()],Kl.prototype,"textColor",void 0),mp([$s("Logo Image"),(0,b.onChange)(Ey.prototype.refresh),(0,b.serialize)()],Kl.prototype,"logoImage",void 0),mp([Oo("Toggle preview")],Kl.prototype,"togglePreview",null),mp([Oo("Minimize")],Kl.prototype,"minimize",null),mp([Oo("Maximize")],Kl.prototype,"maximize",null),Kl=Ey=mp([ks("Loading Screen")],Kl);class i3 extends I_{constructor(e){super(e)}async initialize({caching:e=!0,ground:i=!0,bloom:s=!0,depthTonemap:o=!0,enableDrop:c=!1,importPopup:_=!1,debug:j=!1}={}){return j&&await this.addPlugin(vy),this.getPlugin(Fr)||this.addPluginSync(Fr,void 0,void 0,{storage:e&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await this.addPlugin(Kl,!0),await FP(this,{ground:i,bloom:s,depthTonemap:o,enableDrop:c,importPopup:_}),await this.addPlugin(zw),await this.addPlugin(Vw),await this.addPlugin(SA),this}}async function FP(h,{ground:e=!0,bloom:i=!0,depthTonemap:s=!0,enableDrop:o=!1,importPopup:c=!1}={}){await h.getOrAddPlugin(Fr),c&&await h.getOrAddPlugin(Kl),await h.getOrAddPlugin(zo),await h.getOrAddPlugin(Vm),o&&await h.getOrAddPlugin(g0),await h.addPlugin(new Vp(32)),await h.getOrAddPlugin(Lv),await h.getOrAddPlugin(Dx),await h.addPlugin(new Rx(s||!h.useRgbm)),await h.getOrAddPlugin(Qu),await h.getOrAddPlugin(py),await h.getOrAddPlugin(rE),await h.getOrAddPlugin(BC),await h.getOrAddPlugin(jx),await h.getOrAddPlugin(Z1),await h.getOrAddPlugin(Tl),await h.getOrAddPlugin(iy),await h.getOrAddPlugin(Ql),await h.getOrAddPlugin(Nm),await h.getOrAddPlugin(Hv),await h.getOrAddPlugin(R_),await h.getOrAddPlugin(d_),await h.getOrAddPlugin(f_),await h.getOrAddPlugin(pp),await h.getOrAddPlugin(hv),await h.getOrAddPlugin(E0),await h.getOrAddPlugin(B_,!1),await h.getOrAddPlugin(n1),await h.getOrAddPlugin(zl),await h.getOrAddPlugin(ay,!1),await h.getOrAddPlugin(bm,!1),await h.getOrAddPlugin(nA,!1),await h.getOrAddPlugin(sm,!1),await h.getOrAddPlugin(Tp,!1),await h.getOrAddPlugin(k_,!1),await h.getOrAddPlugin(Gv,!1),await h.getOrAddPlugin(AA),await h.getOrAddPlugin(zM),await h.getOrAddPlugin(Ht),await h.getOrAddPlugin(xy),await h.getOrAddPlugin(WO),await h.getOrAddPlugin(HO),await h.getOrAddPlugin(qO),await h.getOrAddPlugin(fw),await h.getOrAddPlugin(Hu),await h.getOrAddPlugin(zm),i&&await h.getOrAddPlugin(P_),e&&await h.getOrAddPlugin(gv),h.renderer.refreshPipeline()}let P4=0;class s3 extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this._environmentFromSource=null,this.viewerIndex=P4++,this.canvasId="webgi-viewer-"+this.viewerIndex,window.freeViewers||(window.freeViewers=[]),this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block";const e=window.freeViewers.pop(),i=document.createElement("style");i.textContent=b.css`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.shadowRoot.append(i,this.wrapper),this._initialized=!0,this._initialize(e).then(async()=>this.refreshAll())}async refreshAll(){this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(e){e!=null&&e._lastState&&(this._state.src=e._lastState.src||this._state.src,this._state.environment=e._lastState.environment||this._state.environment,delete e._lastState),e!=null&&e.__models&&(this._models={...this._models,...e.__models},delete e.__models),this.canvas=(e==null?void 0:e.canvas)||(0,b.createCanvasElement)(),this.canvas.setAttribute("id",this.canvasId),this.wrapper.append(this.canvas),this.viewer=e??new i3({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true",assetManager:{storage:window.caches?await caches.open("webgi-cache-storage"):void 0}}),this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),e||await this.viewer.initialize({debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this.dispatchEvent(new Event("initialized"))}connectedCallback(){this._initialized&&this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0,this.dispatchEvent(new Event("connected")))}disconnectedCallback(){var e,i;this.viewer&&(this.getAttribute("disposeOnRemove")==="true"||this.getAttribute("disposeonremove")==="true"?((e=this.canvas)==null||e.remove(),this.clearViewer(),this.viewer.dispose(),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.getAttribute("autoManageViewers")==="true"||this.getAttribute("automanageviewers")==="true"?((i=this.canvas)==null||i.remove(),this.viewer._lastState={...this._state},this.viewer._lastState.src="",this.clearViewer(),window.freeViewers.push(this.viewer),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.viewer.enabled=!1,this.dispatchEvent(new Event("disconnected")))}adoptedCallback(){this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment","renderScale"]}attributeChangedCallback(e,i,s){this.refreshAll()}clearViewer(){var e,i;(e=this.viewer)==null||e.scene.disposeSceneModels(),(i=this.viewer)==null||i.scene.setEnvironment(null),Object.values(this._models).forEach(async s=>s.then(o=>o.forEach(c=>c.dispose&&c.dispose()))),this._models={}}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const i=[e],s=[],o=[],c=this.viewer.scene.environment;this.viewer.scene.environment=null,this._environmentFromSource=null;for(const j of i)!this._models[j]&&j&&(this._models[j]=this.viewer.getManager().importer.importPath(j,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!0,pathOverride:this._getAttr("filename","")||void 0}));const _=this.viewer.scene.environment;_?this._environmentFromSource=_:this.viewer.scene.environment=c;for(const[j,et]of Object.entries(this._models))i.includes(j)?s.push(et.then(nt=>[j,nt])):o.push(et);await Promise.all([Promise.all(s).then(async j=>Promise.all(j.map(async et=>(this._models[et[0]]=this.viewer.getManager().importer.processImported(et[1]),this._models[et[0]])))).then(j=>{for(const et of j)for(const nt of et)nt&&nt.assetType==="model"&&this.viewer.scene.addSceneObject(nt)}),Promise.all(o).then(j=>{for(const et of j)for(const nt of et)nt&&nt.assetType==="model"&&nt.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);if(this._environmentFromSource)return void this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute.");const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const i=this.viewer.scene.getEnvironment(),s=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;this._environmentFromSource?this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute."):(s&&s.assetType!=="texture"||await this.viewer.scene.setEnvironment(s),i==null||i.dispose(),this.dispatchEvent(new CustomEvent("environment-loaded",{detail:{src:e}})),this._state.environment=e,this._refreshingEnvironment=!1)}_getAttr(e,i){return this.hasAttribute(e)?this.getAttribute(e):i}addEventListener(e,i,s){super.addEventListener(e,i,s),e==="initialized"&&this._initialized&&this.dispatchEvent(new Event("initialized"))}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",s3);var jP=__webpackgi_require__(798),iI={};jP.Z&&jP.Z.locals&&(iI.locals=jP.Z.locals);var JO,ZO=0,QE={};QE.styleTagTransform=y1(),QE.setAttributes=_1(),QE.insert=function(h,e){(e.target||document.head).appendChild(h)},QE.domAPI=g1(),QE.insertStyleElement=v1(),iI.use=function(h){return QE.options=h||{},ZO++||(JO=m1()(jP.Z,QE)),iI},iI.unuse=function(){ZO>0&&!--ZO&&(JO(),JO=null)};var R4=iI;let zP=class extends eT{constructor(){super("Popup");const h=(0,b.createDiv)({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});h.addEventListener("click",()=>{this._mainDiv.style.display="none"}),this._mainDiv.appendChild(h)}_updateMainDiv(h){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e="";h.forEach((i,s)=>{e+=`<span class="processState">${i.state}</span>: ${(s||"").split("/").pop()} ${i.progress?" - "+i.progress.toFixed(0)+"%":""}<br>`}),this._contentDiv.innerHTML=e,h.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(h){R4.use({target:h.container}),await super.onAdded(h)}};zP.PluginType="AssetManagerBasicPopupPlugin",zP=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_}([ks("Asset manager popup")],zP);var VP=__webpackgi_require__(44),sI={};VP.Z&&VP.Z.locals&&(sI.locals=VP.Z.locals);var eB,tB=0,WE={};WE.styleTagTransform=y1(),WE.setAttributes=_1(),WE.insert=function(h,e){(e.target||document.head).appendChild(h)},WE.domAPI=g1(),WE.insertStyleElement=v1(),sI.use=function(h){return WE.options=h||{},tB++||(eB=m1()(VP.Z,WE)),sI},sI.unuse=function(){tB>0&&!--tB&&(eB(),eB=null)};var D4=sI;let oI=class extends eT{constructor(h=!0){super("LoadingBar"),this.showText=h}_updateMainDiv(h){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e=1,i=1;h.forEach((s,o)=>{e+=s.progress??99,i+=100}),this._contentDiv.innerHTML=this.showText?(100*e/i).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*e/i).toFixed(0)+"%",h.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(h){D4.use({target:h.container}),await super.onAdded(h)}};oI.PluginType="AssetManagerLoadingBarPlugin",oI=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_}([ks("Asset manager loading bar")],oI);class A1{get basePath(){return this._basePath}get assets(){return this._assets}constructor(e){var i;this._basePath=(e==null?void 0:e.basePath)??"",this._assets=((i=e==null?void 0:e.assets)==null?void 0:i.map(s=>this._resolveAsset(s)))??[]}find(e){return this._assets.find(e)??void 0}_resolveAsset(e){return{...e,path:(0,b.pathJoin)([this._basePath,e.path])}}}class k4 extends b.SimpleEventDispatcher{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const i=this._assets.indexOf(e);i>=0&&this._assets.splice(i,1)}async findAssetRegex(e){for(const i of this._assets){const s=i.find(o=>{var c;return o&&(e.test(o.path)||e.test(((c=o.file)==null?void 0:c.name)??""))});if(s)return s}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,i=!1){return this.findAssetRegex(new RegExp(e,i?"i":""))}}const o3=new g.Pa4,a3=new g.Pa4,Wm=new g.Ltg,qm=new g.Ltg,CA=new g.Ltg,nB=new g.Pa4,rB=new g.yGw,Xm=new g.Zzh,l3=new g.Pa4,GP=new g.ZzF,HP=new g.aLr,TA=new g.Ltg;let MA,qE;function c3(h,e,i){return TA.set(0,0,-e,1).applyMatrix4(h.projectionMatrix),TA.multiplyScalar(1/TA.w),TA.x=qE/i.width,TA.y=qE/i.height,TA.applyMatrix4(h.projectionMatrixInverse),TA.multiplyScalar(1/TA.w),Math.abs(Math.max(TA.x,TA.y))}class QP extends g.Kj0{constructor(e=new rA,i=new sv({color:16777215*Math.random()})){super(e,i),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,s=e.attributes.instanceEnd,o=new Float32Array(2*i.count);for(let _=0,j=0,et=i.count;_<et;_++,j+=2)o3.fromBufferAttribute(i,_),a3.fromBufferAttribute(s,_),o[j]=j===0?0:o[j-1],o[j+1]=o[j]+o3.distanceTo(a3);const c=new g.$TI(o,2,1);return e.setAttribute("instanceDistanceStart",new g.kB5(c,1,0)),e.setAttribute("instanceDistanceEnd",new g.kB5(c,1,1)),this}raycast(e,i){const s=this.material.worldUnits,o=e.camera;o!==null||s||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const c=e.params.Line2!==void 0&&e.params.Line2.threshold||0;MA=e.ray;const _=this.matrixWorld,j=this.geometry,et=this.material;let nt,st;qE=et.linewidth+c,j.boundingSphere===null&&j.computeBoundingSphere(),HP.copy(j.boundingSphere).applyMatrix4(_),nt=s?.5*qE:c3(o,Math.max(o.near,HP.distanceToPoint(MA.origin)),et.resolution),HP.radius+=nt,MA.intersectsSphere(HP)!==!1&&(j.boundingBox===null&&j.computeBoundingBox(),GP.copy(j.boundingBox).applyMatrix4(_),st=s?.5*qE:c3(o,Math.max(o.near,GP.distanceToPoint(MA.origin)),et.resolution),GP.expandByScalar(st),MA.intersectsBox(GP)!==!1&&(s?function(at,ct){const dt=at.matrixWorld,mt=at.geometry,yt=mt.attributes.instanceStart,wt=mt.attributes.instanceEnd;for(let Ct=0,bt=Math.min(mt.instanceCount,yt.count);Ct<bt;Ct++){Xm.start.fromBufferAttribute(yt,Ct),Xm.end.fromBufferAttribute(wt,Ct),Xm.applyMatrix4(dt);const At=new g.Pa4,Pt=new g.Pa4;MA.distanceSqToSegment(Xm.start,Xm.end,Pt,At),Pt.distanceTo(At)<.5*qE&&ct.push({point:Pt,pointOnLine:At,distance:MA.origin.distanceTo(Pt),object:at,face:null,faceIndex:Ct,uv:null,uv1:null})}}(this,i):function(at,ct,dt){const mt=ct.projectionMatrix,yt=at.material.resolution,wt=at.matrixWorld,Ct=at.geometry,bt=Ct.attributes.instanceStart,At=Ct.attributes.instanceEnd,Pt=Math.min(Ct.instanceCount,bt.count),Dt=-ct.near;MA.at(1,CA),CA.w=1,CA.applyMatrix4(ct.matrixWorldInverse),CA.applyMatrix4(mt),CA.multiplyScalar(1/CA.w),CA.x*=yt.x/2,CA.y*=yt.y/2,CA.z=0,nB.copy(CA),rB.multiplyMatrices(ct.matrixWorldInverse,wt);for(let Nt=0,Vt=Pt;Nt<Vt;Nt++){if(Wm.fromBufferAttribute(bt,Nt),qm.fromBufferAttribute(At,Nt),Wm.w=1,qm.w=1,Wm.applyMatrix4(rB),qm.applyMatrix4(rB),Wm.z>Dt&&qm.z>Dt)continue;if(Wm.z>Dt){const Sn=Wm.z-qm.z,An=(Wm.z-Dt)/Sn;Wm.lerp(qm,An)}else if(qm.z>Dt){const Sn=qm.z-Wm.z,An=(qm.z-Dt)/Sn;qm.lerp(Wm,An)}Wm.applyMatrix4(mt),qm.applyMatrix4(mt),Wm.multiplyScalar(1/Wm.w),qm.multiplyScalar(1/qm.w),Wm.x*=yt.x/2,Wm.y*=yt.y/2,qm.x*=yt.x/2,qm.y*=yt.y/2,Xm.start.copy(Wm),Xm.start.z=0,Xm.end.copy(qm),Xm.end.z=0;const Zt=Xm.closestPointToPointParameter(nB,!0);Xm.at(Zt,l3);const an=g.M8C.lerp(Wm.z,qm.z,Zt),fn=an>=-1&&an<=1,mn=nB.distanceTo(l3)<.5*qE;if(fn&&mn){Xm.start.fromBufferAttribute(bt,Nt),Xm.end.fromBufferAttribute(At,Nt),Xm.start.applyMatrix4(wt),Xm.end.applyMatrix4(wt);const Sn=new g.Pa4,An=new g.Pa4;MA.distanceSqToSegment(Xm.start,Xm.end,An,Sn),dt.push({point:An,pointOnLine:Sn,distance:MA.origin.distanceTo(An),object:at,face:null,faceIndex:Nt,uv:null,uv1:null})}}}(this,o,i)))}}class aI extends rA{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const i=e.length-3,s=new Float32Array(2*i);for(let o=0;o<i;o+=3)s[2*o]=e[o],s[2*o+1]=e[o+1],s[2*o+2]=e[o+2],s[2*o+3]=e[o+3],s[2*o+4]=e[o+4],s[2*o+5]=e[o+5];return super.setPositions(s),this}setColors(e){const i=e.length-3,s=new Float32Array(2*i);for(let o=0;o<i;o+=3)s[2*o]=e[o],s[2*o+1]=e[o+1],s[2*o+2]=e[o+2],s[2*o+3]=e[o+3],s[2*o+4]=e[o+4],s[2*o+5]=e[o+5];return super.setColors(s),this}fromLine(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}}class iB extends QP{constructor(e=new aI,i=new sv({color:16777215*Math.random()})){super(e,i),this.isLine2=!0,this.type="Line2"}}class O4 extends g.DqL{constructor(e){super(e)}parse(e,i){const s=new B4(e,1);return{mipmaps:s.mipmaps(i),width:s.pixelWidth,height:s.pixelHeight,format:s.glInternalFormat,isCubemap:s.numberOfFaces===6,mipmapCount:s.numberOfMipmapLevels}}}class B4{constructor(e,i){this.arrayBuffer=e;const s=new Uint8Array(this.arrayBuffer,0,12);if(s[0]!==171||s[1]!==75||s[2]!==84||s[3]!==88||s[4]!==32||s[5]!==49||s[6]!==49||s[7]!==187||s[8]!==13||s[9]!==10||s[10]!==26||s[11]!==10)return void console.error("texture missing KTX identifier");const o=Uint32Array.BYTES_PER_ELEMENT,c=new DataView(this.arrayBuffer,12,13*o),_=c.getUint32(0,!0)===67305985;this.glType=c.getUint32(1*o,_),this.glTypeSize=c.getUint32(2*o,_),this.glFormat=c.getUint32(3*o,_),this.glInternalFormat=c.getUint32(4*o,_),this.glBaseInternalFormat=c.getUint32(5*o,_),this.pixelWidth=c.getUint32(6*o,_),this.pixelHeight=c.getUint32(7*o,_),this.pixelDepth=c.getUint32(8*o,_),this.numberOfArrayElements=c.getUint32(9*o,_),this.numberOfFaces=c.getUint32(10*o,_),this.numberOfMipmapLevels=c.getUint32(11*o,_),this.bytesOfKeyValueData=c.getUint32(12*o,_),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===i?this.loadType=0:console.warn("number of faces expected"+i+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const i=[];let s=64+this.bytesOfKeyValueData,o=this.pixelWidth,c=this.pixelHeight;const _=e?this.numberOfMipmapLevels:1;for(let j=0;j<_;j++){const et=new Int32Array(this.arrayBuffer,s,1)[0];s+=4;for(let nt=0;nt<this.numberOfFaces;nt++){const st=new Uint8Array(this.arrayBuffer,s,et);i.push({data:st,width:o,height:c}),s+=et,s+=3-(et+3)%4}o=Math.max(1,.5*o),c=Math.max(1,.5*c)}return i}}class sB extends b.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Fr]}async onAdded(e){var i,s;this._importer||(this._importer=new eu(O4,["ktx"],!1)),(s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var i,s;this._importer&&((s=(i=e.getManager())==null?void 0:i.importer)!=null&&s.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}sB.PluginType="KTXLoadPlugin";class L4 extends g.hH6{constructor(e){super(e),this.responseType="blob"}}class u3 extends g.hH6{constructor(e){super(e),this.responseType="blob"}load(e,i,s,o){return super.load(e,c=>{try{i==null||i((0,b.blobToDataURL)(c))}catch(_){o==null||o(_)}},s,o)}}class h3{async parseAsync(e,i){return new Blob([JSON.stringify(e,null,i.jsonSpaces??2)],{type:"application/json"})}}class d3{async parseAsync(e,i){return new Blob([e],{type:"text/plain"})}}const p3={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class WP{constructor(){this.pluginCallbacks=[],this.register(function(e){return new U4(e)}),this.register(function(e){return new F4(e)}),this.register(function(e){return new V4(e)}),this.register(function(e){return new G4(e)}),this.register(function(e){return new H4(e)}),this.register(function(e){return new Q4(e)}),this.register(function(e){return new j4(e)}),this.register(function(e){return new z4(e)}),this.register(function(e){return new W4(e)}),this.register(function(e){return new q4(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,o,c){const _=c||new v3,j=[];for(let et=0,nt=this.pluginCallbacks.length;et<nt;et++)j.push(this.pluginCallbacks[et](_));_.setPlugins(j),_.write(e,i,o).catch(s)}parseAsync(e,i){const s=this;return new Promise(function(o,c){s.parse(e,o,c,i)})}}const oB=5120,aB=5121,lB=5122,cB=5123,uB="KHR_mesh_quantization",Yv={};Yv[g.TyD]=9728,Yv[g.YLQ]=9984,Yv[g.aH4]=9986,Yv[g.wem]=9729,Yv[g.qyh]=9985,Yv[g.D1R]=9987,Yv[g.uWy]=33071,Yv[g.rpg]=10497,Yv[g.OoA]=33648;const f3={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},N4=new g.Ilk;function lI(h,e){return h.length===e.length&&h.every(function(i,s){return i===e[s]})}function m3(h){return 4*Math.ceil(h/4)}function qP(h,e=0){const i=m3(h.byteLength);if(i!==h.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(h)),e!==0)for(let o=h.byteLength;o<i;o++)s[o]=e;return s.buffer}return h}function g3(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function _3(h,e){if(h.toBlob!==void 0)return new Promise(s=>h.toBlob(s,e));let i;return e==="image/jpeg"?i=.92:e==="image/webp"&&(i=.8),h.convertToBlob({type:e,quality:i})}class v3{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,i,s={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const o=this,c=o.buffers,_=o.json;s=o.options;const j=o.extensionsUsed,et=o.extensionsRequired,nt=new Blob(c,{type:"application/octet-stream"}),st=Object.keys(j),at=Object.keys(et);if(st.length>0&&(_.extensionsUsed=st),at.length>0&&(_.extensionsRequired=at),_.buffers&&_.buffers.length>0&&(_.buffers[0].byteLength=nt.size),s.binary===!0){const ct=new FileReader;ct.readAsArrayBuffer(nt),ct.onloadend=function(){const dt=qP(ct.result),mt=new DataView(new ArrayBuffer(8));mt.setUint32(0,dt.byteLength,!0),mt.setUint32(4,5130562,!0);const yt=qP((wt=JSON.stringify(_),new TextEncoder().encode(wt).buffer),32);var wt;const Ct=new DataView(new ArrayBuffer(8));Ct.setUint32(0,yt.byteLength,!0),Ct.setUint32(4,1313821514,!0);const bt=new ArrayBuffer(12),At=new DataView(bt);At.setUint32(0,1179937895,!0),At.setUint32(4,2,!0);const Pt=12+Ct.byteLength+yt.byteLength+mt.byteLength+dt.byteLength;At.setUint32(8,Pt,!0);const Dt=new Blob([bt,Ct,yt,mt,dt],{type:"application/octet-stream"}),Nt=new FileReader;Nt.readAsArrayBuffer(Dt),Nt.onloadend=function(){i(Nt.result)}}}else if(_.buffers&&_.buffers.length>0){const ct=new FileReader;ct.readAsDataURL(nt),ct.onloadend=function(){const dt=ct.result;_.buffers[0].uri=dt,i(_)}}else i(_)}serializeUserData(e,i){if(Object.keys(e.userData).length===0)return;const s=this.options,o=this.extensionsUsed;try{const c=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&c.gltfExtensions){i.extensions===void 0&&(i.extensions={});for(const _ in c.gltfExtensions)i.extensions[_]=c.gltfExtensions[_],o[_]=!0;delete c.gltfExtensions}Object.keys(c).length>0&&(i.extras=c)}catch(c){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+c.message),console.warn({...e.userData})}}getUID(e,i=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(i)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new g.Pa4;for(let s=0,o=e.count;s<o;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const i=this.cache;if(i.attributesNormalized.has(e))return i.attributesNormalized.get(e);const s=e.clone(),o=new g.Pa4;for(let c=0,_=s.count;c<_;c++)o.fromBufferAttribute(s,c),o.x===0&&o.y===0&&o.z===0?o.setX(1):o.normalize(),s.setXYZ(c,o.x,o.y,o.z);return i.attributesNormalized.set(e,s),s}applyTextureTransform(e,i){let s=!1;const o={};i.offset.x===0&&i.offset.y===0||(o.offset=i.offset.toArray(),s=!0),i.rotation!==0&&(o.rotation=i.rotation,s=!0),i.repeat.x===1&&i.repeat.y===1||(o.scale=i.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=o,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,i){if(e===i)return e;function s(ct){return ct.colorSpace===g.KI_?function(dt){return dt<.04045?.0773993808*dt:Math.pow(.9478672986*dt+.0521327014,2.4)}:function(dt){return dt}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const o=e?e.image:null,c=i?i.image:null,_=Math.max(o?o.width:0,c?c.width:0),j=Math.max(o?o.height:0,c?c.height:0),et=g3();et.width=_,et.height=j;const nt=et.getContext("2d");nt.fillStyle="#00ffff",nt.fillRect(0,0,_,j);const st=nt.getImageData(0,0,_,j);if(o){nt.drawImage(o,0,0,_,j);const ct=s(e),dt=nt.getImageData(0,0,_,j).data;for(let mt=2;mt<dt.length;mt+=4)st.data[mt]=256*ct(dt[mt]/256)}if(c){nt.drawImage(c,0,0,_,j);const ct=s(i),dt=nt.getImageData(0,0,_,j).data;for(let mt=1;mt<dt.length;mt+=4)st.data[mt]=256*ct(dt[mt]/256)}nt.putImageData(st,0,0);const at=(e||i).clone();return at.source=new g.Hw6(et),at.colorSpace=g.aCh,at.channel=(e||i).channel,e&&i&&e.channel!==i.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),at}processBuffer(e){const i=this.json,s=this.buffers;return i.buffers||(i.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,i,s,o,c){const _=this.json;let j;switch(_.bufferViews||(_.bufferViews=[]),i){case oB:case aB:j=1;break;case lB:case cB:j=2;break;default:j=4}const et=m3(o*e.itemSize*j),nt=new DataView(new ArrayBuffer(et));let st=0;for(let ct=s;ct<s+o;ct++)for(let dt=0;dt<e.itemSize;dt++){let mt;e.itemSize>4?mt=e.array[ct*e.itemSize+dt]:(dt===0?mt=e.getX(ct):dt===1?mt=e.getY(ct):dt===2?mt=e.getZ(ct):dt===3&&(mt=e.getW(ct)),e.normalized===!0&&(mt=g.M8C.normalize(mt,e.array))),i===5126?nt.setFloat32(st,mt,!0):i===5124?nt.setInt32(st,mt,!0):i===5125?nt.setUint32(st,mt,!0):i===lB?nt.setInt16(st,mt,!0):i===cB?nt.setUint16(st,mt,!0):i===oB?nt.setInt8(st,mt):i===aB&&nt.setUint8(st,mt),st+=j}const at={buffer:this.processBuffer(nt.buffer),byteOffset:this.byteOffset,byteLength:et};return c!==void 0&&(at.target=c),c===34962&&(at.byteStride=e.itemSize*j),this.byteOffset+=et,_.bufferViews.push(at),{id:_.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const i=this,s=i.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(o){const c=new FileReader;c.readAsArrayBuffer(e),c.onloadend=function(){const _=qP(c.result),j={buffer:i.processBuffer(_),byteOffset:i.byteOffset,byteLength:_.byteLength};i.byteOffset+=_.byteLength,o(s.bufferViews.push(j)-1)}})}processBufferViewImageBuffer(e){const i=this,s=i.json;s.bufferViews||(s.bufferViews=[]),e=qP(e);const o={buffer:i.processBuffer(e),byteOffset:i.byteOffset,byteLength:e.byteLength};return i.byteOffset+=e.byteLength,s.bufferViews.push(o)-1}processAccessor(e,i,s,o){const c=this.json;let _;if(e.array.constructor===Float32Array)_=5126;else if(e.array.constructor===Int32Array)_=5124;else if(e.array.constructor===Uint32Array)_=5125;else if(e.array.constructor===Int16Array)_=lB;else if(e.array.constructor===Uint16Array)_=cB;else if(e.array.constructor===Int8Array)_=oB;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");_=aB}if(s===void 0&&(s=0),o===void 0&&(o=e.count),o===0)return null;const j=function(at,ct,dt){const mt={min:new Array(at.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(at.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let yt=ct;yt<ct+dt;yt++)for(let wt=0;wt<at.itemSize;wt++){let Ct;at.itemSize>4?Ct=at.array[yt*at.itemSize+wt]:(wt===0?Ct=at.getX(yt):wt===1?Ct=at.getY(yt):wt===2?Ct=at.getZ(yt):wt===3&&(Ct=at.getW(yt)),at.normalized===!0&&(Ct=g.M8C.normalize(Ct,at.array))),mt.min[wt]=Math.min(mt.min[wt],Ct),mt.max[wt]=Math.max(mt.max[wt],Ct)}return mt}(e,s,o);let et;i!==void 0&&(et=e===i.index?34963:34962);const nt=this.processBufferView(e,_,s,o,et),st={bufferView:nt.id,byteOffset:nt.byteOffset,componentType:_,count:o,max:j.max,min:j.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return e.normalized===!0&&(st.normalized=!0),c.accessors||(c.accessors=[]),c.accessors.push(st)-1}processImage(e,i,s,o="image/png",c=void 0,_=void 0){if(e!==null){const j=this,et=j.cache,nt=j.json,st=j.options,at=j.pending;et.images.has(e)||et.images.set(e,{});const ct=et.images.get(e),dt=o+":flipY/"+s.toString()+(c||_?";"+c+";"+_:"");if(ct[dt]!==void 0)return ct[dt];nt.images||(nt.images=[]);const mt={mimeType:o},yt=g3();yt.width=Math.min(c||e.width,st.maxTextureSize),yt.height=Math.min(_||e.height,st.maxTextureSize);const wt=yt.getContext("2d");if(s===!0&&(wt.translate(0,yt.height),wt.scale(1,-1)),e.data!==void 0){i!==g.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>st.maxTextureSize||e.height>st.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const bt=new Uint8ClampedArray(e.height*e.width*4);for(let At=0;At<bt.length;At+=4)bt[At+0]=e.data[At+0],bt[At+1]=e.data[At+1],bt[At+2]=e.data[At+2],bt[At+3]=e.data[At+3];wt.putImageData(new ImageData(bt,e.width,e.height),0,0)}else wt.drawImage(e,0,0,yt.width,yt.height);st.binary===!0?at.push(_3(yt,o).then(bt=>j.processBufferViewImage(bt)).then(bt=>{mt.bufferView=bt})):yt.toDataURL!==void 0?mt.uri=yt.toDataURL(o):at.push(_3(yt,o).then(bt=>new FileReader().readAsDataURL(bt)).then(bt=>{mt.uri=bt}));const Ct=nt.images.push(mt)-1;return ct[dt]=Ct,Ct}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const i=this.json;i.samplers||(i.samplers=[]);const s={magFilter:Yv[e.magFilter],minFilter:Yv[e.minFilter],wrapS:Yv[e.wrapS],wrapT:Yv[e.wrapT]};return i.samplers.push(s)-1}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);s.textures||(s.textures=[]);let o=e.userData.mimeType;o==="image/webp"&&(o="image/png"),o==="image/jpg"&&(o="image/jpeg");const c={sampler:this.processSampler(e),source:!o||["image/jpeg","image/png"].includes(o)?this.processImage(e.image,e.format,e.flipY,o):null};e.name&&(c.name=e.name),this._invokeAll(function(j){j.writeTexture&&j.writeTexture(e,c)}),c.source===null&&console.error("GLTFExporter: Unsupported mime type: "+o+". Cannot export texture.",e);const _=s.textures.push(c)-1;return i.textures.set(e,_),_}processMaterial(e){const i=this.cache,s=this.json;if(i.materials.has(e))return i.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const o={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const c=e.color.toArray().concat([e.opacity]);if(lI(c,[1,1,1,1])||(o.pbrMetallicRoughness.baseColorFactor=c),e.isMeshStandardMaterial?(o.pbrMetallicRoughness.metallicFactor=e.metalness,o.pbrMetallicRoughness.roughnessFactor=e.roughness):(o.pbrMetallicRoughness.metallicFactor=.5,o.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const j=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),et={index:this.processTexture(j),channel:j.channel};this.applyTextureTransform(et,j),o.pbrMetallicRoughness.metallicRoughnessTexture=et}if(e.map){const j={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(j,e.map),o.pbrMetallicRoughness.baseColorTexture=j}if(e.emissive){const j=e.emissive;if(Math.max(j.r,j.g,j.b)>0&&(o.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const et={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(et,e.emissiveMap),o.emissiveTexture=et}}if(e.normalMap){const j={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(j.scale=e.normalScale.x),this.applyTextureTransform(j,e.normalMap),o.normalTexture=j}if(e.aoMap){const j={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(j.strength=e.aoMapIntensity),this.applyTextureTransform(j,e.aoMap),o.occlusionTexture=j}e.transparent?o.alphaMode="BLEND":e.alphaTest>0&&(o.alphaMode="MASK",o.alphaCutoff=e.alphaTest),e.side===g.ehD&&(o.doubleSided=!0),e.name!==""&&(o.name=e.name),this.serializeUserData(e,o),this._invokeAll(function(j){j.writeMaterial&&j.writeMaterial(e,o)});const _=s.materials.push(o)-1;return i.materials.set(e,_),_}processMesh(e){const i=this.cache,s=this.json,o=[e.geometry.uuid];if(Array.isArray(e.material))for(let At=0,Pt=e.material.length;At<Pt;At++)o.push(e.material[At].uuid);else o.push(e.material.uuid);const c=o.join(":");if(i.meshes.has(c))return i.meshes.get(c);const _=e.geometry;let j;j=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const et={},nt={},st=[],at=[],ct={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},dt=_.getAttribute("normal");dt===void 0||this.isNormalizedNormalAttribute(dt)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),_.setAttribute("normal",this.createNormalizedNormalAttribute(dt)));let mt=null;for(let At in _.attributes){if(At.slice(0,5)==="morph")continue;const Pt=_.attributes[At];if(At=ct[At]||At.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(At)||(At="_"+At),i.attributes.has(this.getUID(Pt))){nt[At]=i.attributes.get(this.getUID(Pt));continue}mt=null;const Dt=Pt.array;At!=="JOINTS_0"||Dt instanceof Uint16Array||Dt instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),mt=new g.TlE(new Uint16Array(Dt),Pt.itemSize,Pt.normalized));const Nt=this.processAccessor(mt||Pt,_);Nt!==null&&(At.startsWith("_")||this.detectMeshQuantization(At,Pt),nt[At]=Nt,i.attributes.set(this.getUID(Pt),Nt))}if(dt!==void 0&&_.setAttribute("normal",dt),Object.keys(nt).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const At=[],Pt=[],Dt={};if(e.morphTargetDictionary!==void 0)for(const Nt in e.morphTargetDictionary)Dt[e.morphTargetDictionary[Nt]]=Nt;for(let Nt=0;Nt<e.morphTargetInfluences.length;++Nt){const Vt={};let Zt=!1;for(const an in _.morphAttributes){if(an!=="position"&&an!=="normal"){Zt||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),Zt=!0);continue}const fn=_.morphAttributes[an][Nt],mn=an.toUpperCase(),Sn=_.attributes[an];if(i.attributes.has(this.getUID(fn,!0))){Vt[mn]=i.attributes.get(this.getUID(fn,!0));continue}const An=fn.clone();if(!_.morphTargetsRelative)for(let wn=0,Mn=fn.count;wn<Mn;wn++)for(let Pn=0;Pn<fn.itemSize;Pn++)Pn===0&&An.setX(wn,fn.getX(wn)-Sn.getX(wn)),Pn===1&&An.setY(wn,fn.getY(wn)-Sn.getY(wn)),Pn===2&&An.setZ(wn,fn.getZ(wn)-Sn.getZ(wn)),Pn===3&&An.setW(wn,fn.getW(wn)-Sn.getW(wn));Vt[mn]=this.processAccessor(An,_),i.attributes.set(this.getUID(Sn,!0),Vt[mn])}at.push(Vt),At.push(e.morphTargetInfluences[Nt]),e.morphTargetDictionary!==void 0&&Pt.push(Dt[Nt])}et.weights=At,Pt.length>0&&(et.extras={},et.extras.targetNames=Pt)}const yt=Array.isArray(e.material);if(yt&&_.groups.length===0)return null;const wt=yt?e.material:[e.material],Ct=yt?_.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let At=0,Pt=Ct.length;At<Pt;At++){const Dt={mode:j,attributes:nt};if(this.serializeUserData(_,Dt),at.length>0&&(Dt.targets=at),_.index!==null){let Vt=this.getUID(_.index);Ct[At].start===void 0&&Ct[At].count===void 0||(Vt+=":"+Ct[At].start+":"+Ct[At].count),i.attributes.has(Vt)?Dt.indices=i.attributes.get(Vt):(Dt.indices=this.processAccessor(_.index,_,Ct[At].start,Ct[At].count),i.attributes.set(Vt,Dt.indices)),Dt.indices===null&&delete Dt.indices}const Nt=this.processMaterial(wt[Ct[At].materialIndex]);Nt!==null&&(Dt.material=Nt),st.push(Dt)}et.primitives=st,s.meshes||(s.meshes=[]),this._invokeAll(function(At){At.writeMesh&&At.writeMesh(e,et)});const bt=s.meshes.push(et)-1;return i.meshes.set(c,bt),bt}detectMeshQuantization(e,i){if(this.extensionsUsed[uB])return;let s;switch(i.array.constructor){case Int8Array:s="byte";break;case Uint8Array:s="unsigned byte";break;case Int16Array:s="short";break;case Uint16Array:s="unsigned short";break;default:return}i.normalized&&(s+=" normalized");const o=e.split("_",1)[0];p3[o]&&p3[o].includes(s)&&(this.extensionsUsed[uB]=!0,this.extensionsRequired[uB]=!0)}processCamera(e){const i=this.json;i.cameras||(i.cameras=[]);const s=e.isOrthographicCamera,o={type:s?"orthographic":"perspective"};return s?o.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:o.perspective={aspectRatio:e.aspect,yfov:g.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(o.name=e.type),i.cameras.push(o)-1}processAnimation(e,i){const s=this.json,o=this.nodeMap;s.animations||(s.animations=[]);const c=(e=WP.Utils.mergeMorphTargetTracks(e.clone(),i)).tracks,_=[],j=[];for(let et=0;et<c.length;++et){const nt=c[et],st=g.iUV.parseTrackName(nt.name);let at=g.iUV.findNode(i,st.nodeName);const ct=f3[st.propertyName];if(st.objectName==="bones"&&(at=at.isSkinnedMesh===!0?at.skeleton.getBoneByName(st.objectIndex):void 0),!at||!ct)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',nt.name),null;const dt=1;let mt,yt=nt.values.length/nt.times.length;ct===f3.morphTargetInfluences&&(yt/=at.morphTargetInfluences.length),nt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(mt="CUBICSPLINE",yt/=3):mt=nt.getInterpolation()===g.Syv?"STEP":"LINEAR",j.push({input:this.processAccessor(new g.TlE(nt.times,dt)),output:this.processAccessor(new g.TlE(nt.values,yt)),interpolation:mt}),_.push({sampler:j.length-1,target:{node:o.get(at),path:ct}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:j,channels:_}),s.animations.length-1}processSkin(e){const i=this.json,s=this.nodeMap,o=i.nodes[s.get(e)],c=e.skeleton;if(c===void 0)return null;const _=e.skeleton.bones[0];if(_===void 0)return null;const j=[],et=new Float32Array(16*c.bones.length),nt=new g.yGw;for(let st=0;st<c.bones.length;++st)j.push(s.get(c.bones[st])),nt.copy(c.boneInverses[st]),nt.multiply(e.bindMatrix).toArray(et,16*st);return i.skins===void 0&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new g.TlE(et,16)),joints:j,skeleton:s.get(_)}),o.skin=i.skins.length-1}processNode(e){const i=this.json,s=this.options,o=this.nodeMap;i.nodes||(i.nodes=[]);const c={};if(s.trs){const j=e.quaternion.toArray(),et=e.position.toArray(),nt=e.scale.toArray();lI(j,[0,0,0,1])||(c.rotation=j),lI(et,[0,0,0])||(c.translation=et),lI(nt,[1,1,1])||(c.scale=nt)}else e.matrixAutoUpdate&&e.updateMatrix(),lI(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(c.matrix=e.matrix.elements);if(e.name!==""&&(c.name=String(e.name)),this.serializeUserData(e,c),e.isMesh||e.isLine||e.isPoints){const j=this.processMesh(e);j!==null&&(c.mesh=j)}else e.isCamera&&(c.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const j=[];for(let et=0,nt=e.children.length;et<nt;et++){const st=e.children[et];if(st.visible||s.onlyVisible===!1){const at=this.processNode(st);at!==null&&j.push(at)}}j.length>0&&(c.children=j)}this._invokeAll(function(j){j.writeNode&&j.writeNode(e,c)});const _=i.nodes.push(c)-1;return o.set(e,_),_}processScene(e){const i=this.json,s=this.options;i.scenes||(i.scenes=[],i.scene=0);const o={};e.name!==""&&(o.name=e.name),i.scenes.push(o);const c=[];for(let _=0,j=e.children.length;_<j;_++){const et=e.children[_];if(et.visible||s.onlyVisible===!1){const nt=this.processNode(et);nt!==null&&c.push(nt)}}c.length>0&&(o.nodes=c),this.serializeUserData(e,o)}processObjects(e){const i=new g.xsS;i.name="AuxScene";for(let s=0;s<e.length;s++)i.children.push(e[s]);this.processScene(i)}processInput(e){const i=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(o){o.beforeParse&&o.beforeParse(e)});const s=[];for(let o=0;o<e.length;o++)e[o]instanceof g.xsS?this.processScene(e[o]):s.push(e[o]);s.length>0&&this.processObjects(s);for(let o=0;o<this.skins.length;++o)this.processSkin(this.skins[o]);for(let o=0;o<i.animations.length;++o)this.processAnimation(i.animations[o],e[0]);this._invokeAll(function(o){o.afterParse&&o.afterParse(e)})}_invokeAll(e){for(let i=0,s=this.plugins.length;i<s;i++)e(this.plugins[i])}}class U4{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,i){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const s=this.writer,o=s.json,c=s.extensionsUsed,_={};e.name&&(_.name=e.name),_.color=e.color.toArray(),_.intensity=e.intensity,e.isDirectionalLight?_.type="directional":e.isPointLight?(_.type="point",e.distance>0&&(_.range=e.distance)):e.isSpotLight&&(_.type="spot",e.distance>0&&(_.range=e.distance),_.spot={},_.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,_.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),c[this.name]||(o.extensions=o.extensions||{},o.extensions[this.name]={lights:[]},c[this.name]=!0);const j=o.extensions[this.name].lights;j.push(_),i.extensions=i.extensions||{},i.extensions[this.name]={light:j.length-1}}}class F4{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,i){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;i.extensions=i.extensions||{},i.extensions[this.name]={},s[this.name]=!0,i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=.9}}class j4{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.clearcoatFactor=e.clearcoat,e.clearcoatMap){const _={index:s.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};s.applyTextureTransform(_,e.clearcoatMap),c.clearcoatTexture=_}if(c.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const _={index:s.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};s.applyTextureTransform(_,e.clearcoatRoughnessMap),c.clearcoatRoughnessTexture=_}if(e.clearcoatNormalMap){const _={index:s.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};s.applyTextureTransform(_,e.clearcoatNormalMap),c.clearcoatNormalTexture=_}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class z4{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.iridescenceFactor=e.iridescence,e.iridescenceMap){const _={index:s.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};s.applyTextureTransform(_,e.iridescenceMap),c.iridescenceTexture=_}if(c.iridescenceIor=e.iridescenceIOR,c.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],c.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const _={index:s.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};s.applyTextureTransform(_,e.iridescenceThicknessMap),c.iridescenceThicknessTexture=_}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class V4{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.transmissionFactor=e.transmission,e.transmissionMap){const _={index:s.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};s.applyTextureTransform(_,e.transmissionMap),c.transmissionTexture=_}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class G4{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.thicknessFactor=e.thickness,e.thicknessMap){const _={index:s.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};s.applyTextureTransform(_,e.thicknessMap),c.thicknessTexture=_}c.attenuationDistance=e.attenuationDistance,c.attenuationColor=e.attenuationColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class H4{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const s=this.writer.extensionsUsed,o={};o.ior=e.ior,i.extensions=i.extensions||{},i.extensions[this.name]=o,s[this.name]=!0}}class Q4{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(N4)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const s=this.writer,o=s.extensionsUsed,c={};if(e.specularIntensityMap){const _={index:s.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};s.applyTextureTransform(_,e.specularIntensityMap),c.specularTexture=_}if(e.specularColorMap){const _={index:s.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};s.applyTextureTransform(_,e.specularColorMap),c.specularColorTexture=_}c.specularFactor=e.specularIntensity,c.specularColorFactor=e.specularColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class W4{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.sheen<.001)return;const s=this.writer,o=s.extensionsUsed,c={};if(e.sheenRoughnessMap){const _={index:s.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};s.applyTextureTransform(_,e.sheenRoughnessMap),c.sheenRoughnessTexture=_}if(e.sheenColorMap){const _={index:s.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};s.applyTextureTransform(_,e.sheenColorMap),c.sheenColorTexture=_}c.sheenRoughnessFactor=e.sheenRoughness,c.sheenColorFactor=e.sheenColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=c,i.extras=i.extras||{},i.extras.sheenFactor=e.sheen,o[this.name]=!0}}class q4{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const s=this.writer.extensionsUsed,o={};o.emissiveStrength=e.emissiveIntensity,i.extensions=i.extensions||{},i.extensions[this.name]=o,s[this.name]=!0}}WP.Utils={GLTFWriter:v3,insertKeyframe:function(h,e){const s=h.getValueSize(),o=new h.TimeBufferType(h.times.length+1),c=new h.ValueBufferType(h.values.length+s),_=h.createInterpolant(new h.ValueBufferType(s));let j;if(h.times.length===0){o[0]=e;for(let et=0;et<s;et++)c[et]=0;j=0}else if(e<h.times[0]){if(Math.abs(h.times[0]-e)<.001)return 0;o[0]=e,o.set(h.times,1),c.set(_.evaluate(e),0),c.set(h.values,s),j=0}else if(e>h.times[h.times.length-1]){if(Math.abs(h.times[h.times.length-1]-e)<.001)return h.times.length-1;o[o.length-1]=e,o.set(h.times,0),c.set(h.values,0),c.set(_.evaluate(e),h.values.length),j=o.length-1}else for(let et=0;et<h.times.length;et++){if(Math.abs(h.times[et]-e)<.001)return et;if(h.times[et]<e&&h.times[et+1]>e){o.set(h.times.slice(0,et+1),0),o[et+1]=e,o.set(h.times.slice(et+1),et+2),c.set(h.values.slice(0,(et+1)*s),0),c.set(_.evaluate(e),(et+1)*s),c.set(h.values.slice((et+1)*s),(et+2)*s),j=et+1;break}}return h.times=o,h.values=c,j},mergeMorphTargetTracks:function(h,e){const i=[],s={},o=h.tracks;for(let c=0;c<o.length;++c){let _=o[c];const j=g.iUV.parseTrackName(_.name),et=g.iUV.findNode(e,j.nodeName);if(j.propertyName!=="morphTargetInfluences"||j.propertyIndex===void 0){i.push(_);continue}if(_.createInterpolant!==_.InterpolantFactoryMethodDiscrete&&_.createInterpolant!==_.InterpolantFactoryMethodLinear){if(_.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),_=_.clone(),_.setInterpolation(g.NMF)}const nt=et.morphTargetInfluences.length,st=et.morphTargetDictionary[j.propertyIndex];if(st===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+j.propertyIndex);let at;if(s[et.uuid]===void 0){at=_.clone();const dt=new at.ValueBufferType(nt*at.times.length);for(let mt=0;mt<at.times.length;mt++)dt[mt*nt+st]=at.values[mt];at.name=(j.nodeName||"")+".morphTargetInfluences",at.values=dt,s[et.uuid]=at,i.push(at);continue}const ct=_.createInterpolant(new _.ValueBufferType(1));at=s[et.uuid];for(let dt=0;dt<at.times.length;dt++)at.values[dt*nt+st]=ct.evaluate(at.times[dt]);for(let dt=0;dt<_.times.length;dt++){const mt=this.insertKeyframe(at,_.times[dt]);at.values[mt*nt+st]=_.values[dt]}}return h.tracks=i,h}};class y3 extends WP.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new g.Wid}serializeUserData(e,i){const s=e.userData,o={};s.__disposed&&console.error("Serializing a disposed object",e),Object.entries(s).forEach(([_,j])=>{(!j||typeof j=="function"||j.isObject3D||j.isTexture||j.isMaterial||j.assetType!=null||_.startsWith("_")||_!=="uuid"&&(Zl.includes(_)||na.includes(_)||Mm.includes(_)))&&(o[_]=j,delete s[_])});const c=Ls(s,!1);Object.entries(o).forEach(([_,j])=>{s[_]=j,delete o[_]}),e.userData=c,super.serializeUserData(e,i),e.userData=s}processObjects(e){var i;e.length===1&&((i=e[0])!=null&&i.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let i=e;i&&!i.isShaderMaterial||(i=this._defaultMaterial);const s=super.processMaterial(i);if(s===null)return console.error("GLTFWriter2: Unexpected error: Failed to process material",e),null;if(!e||i===e)return s;const o=JSON.stringify(this.json.materials[s]),c=JSON.parse(o);this.serializeUserData(e,c),this._invokeAll(j=>{j.writeMaterial&&j.writeMaterial(e,c)});const _=this.json.materials.push(c)-1;return this.cache.materials.set(e,_),_}processImageBlob(e,i){if(!e)return-1;const s=this.cache,o=this.options,c=this.pending,_=this.json,j=i.image;s.images.has(j)||s.images.set(j,{});const et=s.images.get(j),nt=e.type+":flipY/"+i.flipY.toString();if(et[nt]!==void 0)return et[nt];_.images||(_.images=[]);const st={mimeType:e.type};o.binary===!0?c.push(new Promise(ct=>{this.processBufferViewImage(e).then(dt=>{st.bufferView=dt,ct()})})):c.push((0,b.blobToDataURL)(e).then(ct=>{st.uri=ct}));const at=_.images.push(st)-1;return et[nt]=at,at}processSampler(e){return super.processSampler(e)}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);const o=e.source.data,c=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))&&(e.source.data&&(!this.options.exporterOptions.embedUrlImagePreviews||e.isDataTexture?e.source.data=null:e.source.data._savePreview=!0),delete e.userData.mimeType);const _=super.processTexture(e),j=s.textures[_];if(!j)return console.error("No texture def",_,e),_;const et=s.images?s.images[j.source]:null;if(et&&(et.extras||(et.extras={}),e.source&&(et.extras.uuid=e.source.uuid),et.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))){if(e.source.data?delete e.source.data._savePreview:e.source.data=o,e.userData.mimeType=c,!j)return console.error("textureDef is null",_,e),_;if(j.source>=0){const nt=this.json.images[j.source];nt.uri?console.warn("uri already set",nt.uri):(nt.uri=e.userData.rootPath,nt.mimeType=c,nt.extras||(nt.extras={}),nt.extras.flipY=e.flipY,nt.extras.uri=e.userData.rootPath)}else j.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,c)}return j.source<0&&console.error("textureDef.source cannot be saved",j,e),_}processImage(e,i,s,o="image/png"){return e?super.processImage(e,i,s,o,e._savePreview?32:void 0,e._savePreview?32:void 0):-1}processImageUri(e,i,s,o="image/png"){const c=this.cache,_=this.json;c.images.has(e)||c.images.set(e,{});const j=c.images.get(e),et=o+":flipY/"+s.toString();if(j[et]!==void 0)return j[et];_.images||(_.images=[]);const nt={mimeType:o,uri:i,extras:{flipY:s}},st=_.images.push(nt)-1;return j[et]=st,st}}function X4(h,e){(e=e??document.createElement("script")).type=h.type||"text/javascript",e.text=h.text;for(let i=0;i<h.attributes.length;i++){const s=h.attributes[i];e.setAttribute(s.name,s.value)}return e}function A3(h,e=0){const i=(s=h.byteLength,4*Math.ceil(s/4));var s;if(i!==h.byteLength){const o=new Uint8Array(i);if(o.set(new Uint8Array(h)),e!==0)for(let c=h.byteLength;c<i;c++)o[c]=e;return o.buffer}return h}ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(h,e){const i=new Uint8Array(this);e==null&&(e=i.length);const s=new ArrayBuffer(e-h),o=new Uint8Array(s);for(let c=0;c<o.length;c++)o[c]=i[c+h];return s});class hB extends WP{register(e){return super.register(e)}async parseAsync(e,i){if(!e)throw new Error("No object to export");const s=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((o,c)=>this.parse(e,o,c,i));if(s&&typeof s=="object"&&!s.byteLength)return new Blob([JSON.stringify(s,(o,c)=>o.startsWith("__")?void 0:c,i.jsonSpaces??2)],{type:"model/gltf+json"});if(s){let o=null;return i.encrypt&&(!i.encryptKey&&window.prompt&&(i.encryptKey=window.prompt("GLTFEncryption: Enter encryption key")||""),i.encryptKey?o=function(c,_){const j=A3(c),et=new DataView(new ArrayBuffer(8));et.setUint32(0,j.byteLength,!0),et.setUint32(4,5130562,!0);const nt=A3(new TextEncoder().encode(JSON.stringify({asset:{version:"2.0",generator:"WebGiGLBWrapper",encryption:{type:"aesgcm",version:1}}})).buffer,32),st=new DataView(new ArrayBuffer(8));st.setUint32(0,nt.byteLength,!0),st.setUint32(4,1313821514,!0);const at=new ArrayBuffer(12),ct=new DataView(at);ct.setUint32(0,1179937895,!0),ct.setUint32(4,2,!0);const dt=12+st.byteLength+nt.byteLength+et.byteLength+j.byteLength;ct.setUint32(8,dt,!0);const mt=new Blob([at,st,nt,et,j],{type:"application/octet-stream"});return mt.ext="glb",mt}(await(0,b.aesGcmEncrypt)(new Uint8Array(s),i.encryptKey)):console.warn("GLTF Export: encryption key not provided, skipping encryption")),o||(o=new Blob([s],{type:"model/gltf+binary"})),o}throw new Error("GLTFExporter2.parse() failed")}parse(e,i,s,o={}){const c={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!o.embedUrlImages&&o.externalImagesInExtras||!1,embedUrlImages:o.embedUrlImages??!1,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0,exporterOptions:o};return o.exportExt==="glb"&&(c.binary=!0),o.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(_=>_.traverse(j=>{j.uuid&&(j.userData.gltfUUID=j.uuid)})),(Array.isArray(e)?e:[e]).forEach(_=>_.traverse(j=>{if(j.animations)for(const et of j.animations)et.__gltfExport===!1||c.animations.includes(et)||c.animations.push(...j.animations)})),super.parse(e,_=>{o.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(j=>j.traverse(et=>{delete et.userData.gltfUUID})),i(Object.assign(_,{__isGLTFOutput:!0}))},s,c,new y3)}}function b3(h,e){const i=h.getPlugin(Fr).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&i.resources.textures&&[...Object.entries(i.resources.textures)].forEach(([o,c])=>{e.json.textures.find(j=>{var et,nt,st,at,ct;return((et=j.extras)==null?void 0:et.uuid)===o||((st=(nt=e.json.samplers[j.sampler])==null?void 0:nt.extras)==null?void 0:st.uuid)===o||((ct=(at=e.json.images[j.source])==null?void 0:at.extras)==null?void 0:ct.t_uuid)===o})&&(c.image&&i.resources.images&&i.resources.images[c.image]&&delete i.resources.images[c.image],i.resources.textures[o]={})}),e.json.materials&&i.resources.materials&&[...Object.entries(i.resources.materials)].forEach(([o,c])=>{e.json.materials.find(_=>{var j;return((j=_.extras)==null?void 0:j.uuid)===o})&&(i.resources.materials[o]={})});const s=[];Object.values(i.resources).forEach(o=>{o&&Object.values(o).forEach(c=>{c.url&&(c.url.type==="Uint16Array"&&c.url.data?(c.url.data instanceof Uint16Array||(c.url.data=new Uint16Array(c.url.data)),s.push(c.url)):c.url.type==="Uint8Array"&&c.url.data&&(c.url.data instanceof Uint8Array||(c.url.data=new Uint8Array(c.url.data)),s.push(c.url)))})});for(const o of s){let c="application/octet-stream";if(o.mimeType&&(c=o.mimeType),e.options.exporterOptions.encodeUint16Rgbe&&o.type==="Uint16Array"&&o.width>0&&o.height>0){const nt=Y4(o.data,4),st=new ImageData(nt,o.width,o.height),at=g.PpQ.getDataURL(st,!0).split(",")[1],ct=2;c="image/png",ct===1||(o.data=Uint8Array.from(atob(at),dt=>dt.charCodeAt(0))),o.encoding="rgbe",o.encodingVersion=ct}e.json.images||(e.json.images=[]);const _={mimeType:c},j=e.json.images.push(_)-1,et=o.data;_.bufferView=e.processBufferViewImageBuffer(et),o.data={image:j}}return i}function Y4(h,e=3,i){let s,o,c,_,j;const et=h.byteLength/(2*e)|0;i=i||new Uint8ClampedArray(4*et);for(let nt=0;nt<et;nt++){s=h[nt*e],o=h[nt*e+1],c=h[nt*e+2],_=Math.max(Math.max(s,o),c);const st=Math.ceil(Math.log2(_));j=Math.pow(2,st-8),i[4*nt]=s/j|0,i[4*nt+1]=o/j|0,i[4*nt+2]=c/j|0,i[4*nt+3]=st+128}return i}function dB(h,e,i=hB,s){if(!e)return;const o=h.Exporters.findIndex(_=>_.ext.includes("gltf")||_.ext.includes("glb")),c=[];o>=0?(c.push(...h.Exporters[o].extensions??[]),h.Exporters.splice(o,1)):(c.push(J4),c.push(K4),c.push($4),c.push(_=>new Ju(_)),c.push(_=>new Z4(_)),c.push(_=>new ez(_)),c.push(_=>new tz(_)),c.push(_=>new nz(_))),h.Exporters.push({ctor:()=>{const _=new i;return c.forEach(j=>_.register(j)),_.register(j=>({afterParse:et=>{var st,at;if(et=Array.isArray(et)?et[0]:et,!((st=et==null?void 0:et.userData)!=null&&st.rootSceneModelRoot)||((at=et==null?void 0:et.userData)==null?void 0:at.__exportViewerConfig)===!1)return;const nt=j.json.scenes[j.json.scene||0];nt.extensions||(nt.extensions={}),nt.extensions[Ru]=b3(e,j),j.extensionsUsed[Ru]=!0}})),s==null||s(_),_},ext:["gltf","glb"],extensions:c})}const $4=h=>({writeNode:(e,i)=>{if(!(e!=null&&e.isLight))return;i.extensions||(i.extensions={});const s={};e.shadow&&(s.shadow=e.shadow.toJSON()),Object.keys(s).length>0&&(i.extensions[i_]=s,h.extensionsUsed[i_]=!0)}}),K4=h=>({writeNode:(e,i)=>{if(!(e!=null&&e.isObject3D))return;i.extensions||(i.extensions={});const s={};e.castShadow!==void 0&&(s.castShadow=e.castShadow),e.receiveShadow!==void 0&&(s.receiveShadow=e.receiveShadow),e.visible===!1&&(s.visible=!1),e.frustumCulled===!1&&(s.frustumCulled=!1),e.renderOrder!==0&&(s.renderOrder=e.renderOrder),e.layers.mask!==1&&(s.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),Object.keys(s).length>0&&(i.extensions[xp]=s,h.extensionsUsed[xp]=!0)}}),J4=h=>({writeMaterial(e,i){if(!(e!=null&&e.isMaterial))return;i.extensions||(i.extensions={});const s={};e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.side!==void 0&&e.side!==g.ehD&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(s.depthFunc=e.depthFunc),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.vertexColors!==void 0&&(s.vertexColors=e.vertexColors),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.normalScale!==void 0&&(s.normalScale=[e.normalScale.x,e.normalScale.y]);const o=this.materialExternalResources[e.uuid];o&&Object.entries(o).forEach(([c,_])=>{var j;c.startsWith("_")||(_!=null&&_.userData&&(_.userData.__embedUrlImagePreviews=(j=h.options.exporterOptions)==null?void 0:j.embedUrlImagePreviews),s[c]=Ls(_,!1,this.serializedMeta),_!=null&&_.userData&&delete _.userData.__embedUrlImagePreviews)}),Object.keys(s).length>0&&(i.extensions[ap]=s,h.extensionsUsed[ap]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!h.options.externalImagesInExtras)return;const i=[];(Array.isArray(e)?e:[e]).forEach(s=>{s==null||s.traverse(o=>{var c;o&&((c=o.material)!=null&&c.isMaterial)&&i.push(o.material)})}),i.forEach(s=>{s&&(this.materialExternalResources[s.uuid]||(this.materialExternalResources[s.uuid]={}),this.materialExternalResources[s.uuid].__materialRef=s,Object.entries(s).forEach(([o,c])=>{o.startsWith("_")||c&&c.isTexture&&c.userData.rootPath&&(c.userData.rootPath.startsWith("http")||c.userData.rootPath.startsWith("data:"))&&(s[o]=null,this.materialExternalResources[s.uuid][o]=c)}))})},afterParse(e){const i=Object.values(this.materialExternalResources);if(i.length<1)return;i.forEach(o=>{const c=o.__materialRef;c&&(Object.entries(o).forEach(([_,j])=>{_.startsWith("_")||j&&(c[_]=j)}),delete this.materialExternalResources[c.uuid])});const s=h.json.scenes[h.json.scene||0];s.extensions||(s.extensions={}),s.extensions[ap]={resources:this.serializedMeta},h.extensionsUsed[ap]=!0}});class Z4{constructor(e){this.writer=e,this.name=H0}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.bumpScale=e.bumpScale,e.bumpMap){const _={index:s.processTexture(e.bumpMap)};s.applyTextureTransform(_,e.bumpMap),c.bumpTexture=_}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class ez{constructor(e){this.writer=e,this.name=X_}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.displacementScale=e.displacementScale,c.displacementBias=e.displacementBias,e.displacementMap){const _={index:s.processTexture(e.displacementMap)};s.applyTextureTransform(_,e.displacementMap),c.displacementTexture=_}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class tz{constructor(e){this.writer=e,this.name=Ex}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const s=this.writer,o=s.extensionsUsed,c={};if(c.lightMapIntensity=e.lightMapIntensity,e.lightMap){const _={index:s.processTexture(e.lightMap)};s.applyTextureTransform(_,e.lightMap),c.lightMapTexture=_}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}class nz{constructor(e){this.writer=e,this.name=a0}writeMaterial(e,i){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const s=this.writer,o=s.extensionsUsed,c={};if(e.alphaMap){const _={index:s.processTexture(e.alphaMap)};s.applyTextureTransform(_,e.alphaMap),c.alphaTexture=_}i.extensions=i.extensions||{},i.extensions[this.name]=c,o[this.name]=!0}}const rz=new TextEncoder;class iz{parse(e,i,s){if(!function(et,nt){if(nt.isWebGLRenderTarget&&(!et||!et.isWebGLRenderer))return console.error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer."),!1;if(!nt||!nt.isWebGLRenderTarget&&!nt.isDataTexture)return console.error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget or DataTexture."),!1;const st=nt.isWebGLRenderTarget?nt.texture:nt;return st.type!==g.VzW&&st.type!==g.cLu?(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture type."),!1):st.format===g.wk1||(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture format, expected RGBAFormat."),!1)}(e,i))return;const o=function(et,nt={}){const st=et.isTexture?et:et.texture,at=et.isWebGLRenderTarget?et.width:et.image.width,ct=et.isWebGLRenderTarget?et.height:et.image.height,dt=st.type,mt=st.format,yt=st.colorSpace,wt=nt.compression!==void 0?nt.compression:3,Ct=(nt.type!==void 0?nt.type:g.cLu)===g.VzW?2:1,bt={0:1,2:1,3:16}[wt];return{width:at,height:ct,type:dt,format:mt,colorSpace:yt,compression:wt,blockLines:bt,dataType:Ct,dataSize:2*Ct,numBlocks:Math.ceil(ct/bt),numInputChannels:4,numOutputChannels:4,flipY:et.isDataTexture&&et.flipY}}(i,s),c=function(et,nt,st){if(nt.isDataTexture)return nt.image.data;let at;return at=st.type===g.VzW?new Float32Array(st.width*st.height*st.numInputChannels):new Uint16Array(st.width*st.height*st.numInputChannels),et.readRenderTargetPixels(nt,0,0,st.width,st.height,at),at}(e,i,o),_=function(et,nt){const st=nt.width,at=nt.height,ct={r:0,g:0,b:0,a:0},dt={value:0},mt=nt.numOutputChannels==4?1:0,yt=nt.type==g.VzW?hz:uz,wt=nt.dataType==1?lz:pB,Ct=new Uint8Array(nt.width*nt.height*nt.numOutputChannels*nt.dataSize),bt=new DataView(Ct.buffer);for(let At=0;At<at;++At)for(let Pt=0;Pt<st;++Pt){const Dt=At*st*4+4*Pt,Nt=yt(et,Dt),Vt=yt(et,Dt+1),Zt=yt(et,Dt+2),an=yt(et,Dt+3),fn=(nt.flipY?At:at-At-1)*st*(3+mt)*nt.dataSize;az(ct,Nt,Vt,Zt,an),dt.value=fn+Pt*nt.dataSize,wt(bt,ct.a,dt),dt.value=fn+mt*st*nt.dataSize+Pt*nt.dataSize,wt(bt,ct.b,dt),dt.value=fn+(1+mt)*st*nt.dataSize+Pt*nt.dataSize,wt(bt,ct.g,dt),dt.value=fn+(2+mt)*st*nt.dataSize+Pt*nt.dataSize,wt(bt,ct.r,dt)}return Ct}(c,o),j=function(et,nt){let st,at,ct=0;const dt={data:new Array,totalSize:0},mt=nt.width*nt.numOutputChannels*nt.blockLines*nt.dataSize;switch(nt.compression){case 0:st=sz;break;case 2:case 3:st=oz}nt.compression!==0&&(at=new Uint8Array(mt));for(let yt=0;yt<nt.numBlocks;++yt){const wt=st(et.subarray(mt*yt,mt*(yt+1)),at);ct+=wt.length,dt.data.push({dataChunk:wt,size:wt.length})}return dt.totalSize=ct,dt}(_,o);return function(et,nt){const st=8*nt.numBlocks,at=259+18*nt.numOutputChannels,ct={value:at+st},dt=new Uint8Array(at+st+et.totalSize+8*nt.numBlocks),mt=new DataView(dt.buffer);(function(yt,wt,Ct){const bt={value:0},At=new DataView(yt.buffer);Ol(At,20000630,bt),Ol(At,2,bt),Xp(At,"compression",bt),Xp(At,"compression",bt),Ol(At,1,bt),cI(At,Ct.compression,bt),Xp(At,"screenWindowCenter",bt),Xp(At,"v2f",bt),Ol(At,8,bt),Ol(At,0,bt),Ol(At,0,bt),Xp(At,"screenWindowWidth",bt),Xp(At,"float",bt),Ol(At,4,bt),pB(At,1,bt),Xp(At,"pixelAspectRatio",bt),Xp(At,"float",bt),Ol(At,4,bt),pB(At,1,bt),Xp(At,"lineOrder",bt),Xp(At,"lineOrder",bt),Ol(At,1,bt),cI(At,0,bt),Xp(At,"dataWindow",bt),Xp(At,"box2i",bt),Ol(At,16,bt),Ol(At,0,bt),Ol(At,0,bt),Ol(At,Ct.width-1,bt),Ol(At,Ct.height-1,bt),Xp(At,"displayWindow",bt),Xp(At,"box2i",bt),Ol(At,16,bt),Ol(At,0,bt),Ol(At,0,bt),Ol(At,Ct.width-1,bt),Ol(At,Ct.height-1,bt),Xp(At,"channels",bt),Xp(At,"chlist",bt),Ol(At,18*Ct.numOutputChannels+1,bt),Xp(At,"A",bt),Ol(At,Ct.dataType,bt),bt.value+=4,Ol(At,1,bt),Ol(At,1,bt),Xp(At,"B",bt),Ol(At,Ct.dataType,bt),bt.value+=4,Ol(At,1,bt),Ol(At,1,bt),Xp(At,"G",bt),Ol(At,Ct.dataType,bt),bt.value+=4,Ol(At,1,bt),Ol(At,1,bt),Xp(At,"R",bt),Ol(At,Ct.dataType,bt),bt.value+=4,Ol(At,1,bt),Ol(At,1,bt),cI(At,0,bt),cI(At,0,bt);let Pt=bt.value+8*Ct.numBlocks;for(let Dt=0;Dt<wt.data.length;++Dt)cz(At,Pt,bt),Pt+=wt.data[Dt].size+8})(dt,et,nt);for(let yt=0;yt<et.data.length;++yt){const wt=et.data[yt].dataChunk,Ct=et.data[yt].size;Ol(mt,yt*nt.blockLines,ct),Ol(mt,Ct,ct),dt.set(wt,ct.value),ct.value+=Ct}return dt}(j,o)}}function sz(h){return h}function oz(h,e){let i=0,s=Math.floor((h.length+1)/2),o=0;const c=h.length-1;for(;!(o>c||(e[i++]=h[o++],o>c));)e[s++]=h[o++];let _=e[0];for(let j=1;j<e.length;j++){const et=e[j]-_+384;_=e[j],e[j]=et}return function(j,et){et||(et={});var nt=MO();nt.p(j);var st=IO(j,et,2,4);return RO(st,et),PO(st,st.length-4,nt.d()),st}(e)}function az(h,e,i,s,o){h.r=e,h.g=i,h.b=s,h.a=o}function cI(h,e,i){h.setUint8(i.value,e),i.value+=1}function Ol(h,e,i){h.setUint32(i.value,e,!0),i.value+=4}function lz(h,e,i){h.setUint16(i.value,g.A5E.toHalfFloat(e),!0),i.value+=2}function pB(h,e,i){h.setFloat32(i.value,e,!0),i.value+=4}function cz(h,e,i){h.setBigUint64(i.value,BigInt(e),!0),i.value+=8}function Xp(h,e,i){const s=rz.encode(e+"\0");for(let o=0;o<s.length;++o)cI(h,s[o],i)}function uz(h,e){return function(i){const s=(31744&i)>>10,o=1023&i;return(i>>15?-1:1)*(s?s===31?o?NaN:1/0:Math.pow(2,s-15)*(1+o/1024):o/1024*6103515625e-14)}(h[e])}function hz(h,e){return h[e]}class XP extends iz{async parseAsync(e,i){const s=this.parse(e.renderer.rendererObject,e,i);return new Blob([s],{type:"image/x-exr"})}}class w3 extends b.SimpleEventDispatcher{get processors(){return this._processors}getExporter(...e){return this.Exporters.find(i=>i.ext.some(s=>e.includes(s)))}constructor(e,i={}){super(),this._processors=new x_,this.Exporters=[{ctor:()=>new h3,ext:["json"]},{ctor:()=>new d3,ext:["txt","text"]},{ctor:()=>new XP,ext:["exr"]}],this._cachedParsers=[],dB(this,e)}async exportObject(e,i={}){var c,_;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");(c=e==null?void 0:e.userData)!=null&&c.rootSceneModelRoot&&i.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const s=[];e.assetType==="model"&&e.modelObject.traverse(j=>{j.userData.excludeFromExport&&j.visible&&(j.visible=!1,s.push(j))});const o=await this._exportFile(e,i);return e.assetType==="model"&&s.forEach(j=>j.visible=!0),(_=e==null?void 0:e.userData)!=null&&_.rootSceneModelRoot&&i.viewerConfig===!1&&delete e.userData.__exportViewerConfig,o}async _exportFile(e,i={}){let s;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const o=await this.processBeforeExport(e,i),c=i.exportExt??(o==null?void 0:o.typeExt)??(o==null?void 0:o.ext);if(!o||!c)throw new Error(`Unable to preprocess before export ${c}`);const _=this._getParser(c);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const j=await _.parseAsync(o.obj,{exportExt:o.ext??c,...i});j.ext=o.ext,s=j}catch(o){return console.error("AssetExporter: Unable to Export file",e),console.error(o),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:o})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),s}_createParser(e){const i=this.Exporters.find(o=>o.ext.includes(e));if(!i)throw new Error(`No exporter found for extension ${e}`);const s=i==null?void 0:i.ctor(this);if(!s)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:i.ext,parser:s}),this.dispatchEvent({type:"exporterCreate",exporter:i,parser:s}),s}_getParser(e){var i;return((i=this._cachedParsers.find(s=>s.ext.includes(e)))==null?void 0:i.parser)??this._createParser(e)}async processBeforeExport(e,i={}){if(e.assetType!=null&&e.assetType!=="renderTarget"&&(e=await this._processors.process(e.assetType,e,i)),e.isWebGLRenderTarget)return{obj:e,ext:"exr"};switch(e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};case"renderTarget":return{obj:e,ext:"exr"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)==null||e.dispose()}}var uI;(function(h){h[h.EDGEBREAKER=1]="EDGEBREAKER",h[h.SEQUENTIAL=0]="SEQUENTIAL"})(uI||(uI={}));class b1 extends ms{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,encodeUint16Rgbe:!1,convertMeshToIndexed:!1,embedUrlImagePreviews:!1,embedUrlImages:!1,dracoOptions:{encodeSpeed:5,method:uI.EDGEBREAKER,quantizationVolume:"mesh",quantizationBits:{POSITION:14,NORMAL:10,COLOR:8,TEX_COORD:12,GENERIC:12}},encrypt:!1,encryptKey:""},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new w3(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(i,s)=>{var o;return s.convertMeshToIndexed&&((o=i.modelObject)==null||o.traverse(c=>{var _;c.geometry&&(c.geometry.attributes.index||((_=c.setGeometry)==null||_.call(c,Xo(c.geometry))))})),i}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var i,s;return(s=this.exporter)==null?void 0:s.exportObject((i=this._viewer)==null?void 0:i.scene.modelRoot,e||{...this.exportOptions})}async downloadSceneGlb(){const e=await this.exportScene(this.exportOptions);e&&await this._downloadBlob(e,this.exportOptions.name+"."+e.ext)}async _downloadBlob(e,i){var o,c;const s=(o=this._viewer)==null?void 0:o.getPluginByType("FileTransferPlugin");s?await s.exportFile(e,i):(c=this._viewer)==null||c.console.error("FileTransferPlugin required to export/download file")}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",s=>{var o;typeof((o=s.plugin)==null?void 0:o.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const i=Object.entries(e.plugins).filter(([s,o])=>typeof(o==null?void 0:o.toJSON)=="function"&&(o==null?void 0:o.serializeWithViewer)!==!1).map(([s,o])=>({label:s,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0,onChange:()=>{var s,o;return(o=(s=this._uiConfig)==null?void 0:s.uiRefresh)==null?void 0:o.call(s,"postFrame",!0)}},this.exportOptions.dracoOptions?{type:"folder",hidden:()=>!this.exportOptions.compress,label:"DRACO Options",children:[{type:"slider",label:"Encode Speed",bounds:[1,10],property:[this.exportOptions.dracoOptions,"encodeSpeed"]},{type:"dropdown",label:"Encoder Method",property:[this.exportOptions.dracoOptions,"method"],children:Object.entries(uI).map(([s,o])=>({label:s,value:o}))},{type:"dropdown",label:"Quantization Volume",property:[this.exportOptions.dracoOptions,"quantizationVolume"],children:["mesh","scene","bbox"].map(s=>({label:s}))},{type:"folder",label:"Quantization Bits",children:Object.keys(this.exportOptions.dracoOptions.quantizationBits).map(s=>({type:"slider",label:s,bounds:[1,16],stepSize:1,property:[this.exportOptions.dracoOptions.quantizationBits,s]}))}]}:{},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0,onChange:()=>{var s,o;return(o=(s=this._uiConfig)==null?void 0:s.uiRefresh)==null?void 0:o.call(s,"postFrame",!0)}},{type:"checkbox",label:"Embed Image Previews",property:[this.exportOptions,"embedUrlImagePreviews"]},{type:"checkbox",label:"Encrypt",property:[this.exportOptions,"encrypt"],onChange:()=>{var s,o;return(o=(s=this._uiConfig)==null?void 0:s.uiRefresh)==null?void 0:o.call(s,"postFrame",!0)}},{type:"checkbox",label:"Encrypt Password",hidden:()=>!this.exportOptions.encrypt,property:[this.exportOptions,"encryptKey"]},{type:"checkbox",label:"Compress hdr env maps",hidden:()=>!this.exportOptions.viewerConfig,property:[this.exportOptions,"encodeUint16Rgbe"]},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>this.downloadSceneGlb()}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:i},{type:"button",label:"Select none",value:()=>{i.forEach(s=>{var o;s.value=!1,(o=s.uiRefresh)==null||o.call(s)})}},{type:"button",label:"Select all",value:()=>{i.forEach(s=>{var o;s.value=!0,(o=s.uiRefresh)==null||o.call(s)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(Fr).exportPluginPresets(i.filter(o=>!!o.value).map(o=>(0,b.getOrCall)(o.label)||"")),null,2)],{type:"application/json"});s&&await this._downloadBlob(s,this.exportOptions.name+"."+Fr.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(Fr).exportViewerConfig(!1),null,2)],{type:"application/json"});s&&await this._downloadBlob(s,this.exportOptions.name+"."+Fr.ViewerTypeSlug)}}]}]}}}b1.PluginType="AssetExporterPlugin",function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);c>3&&_&&Object.defineProperty(e,i,_)}([En()],b1.prototype,"exportOptions",void 0);class fB{constructor(){this._listeners={}}addEventListener(e,i){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i),this}removeEventListener(e,i){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const o=s.indexOf(i);o!==-1&&s.splice(o,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const i=this._listeners[e.type];if(i!==void 0){const s=i.slice(0);for(let o=0,c=s.length;o<c;o++)s[o].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class tT extends fB{constructor(e,i,s,o={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=i,this._child=s,this._attributes=o,!i.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class dz extends fB{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(i=>i.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(i=>i.getChild())}disconnectParents(e,i){let s=this.listParentEdges(e);return i&&(s=s.filter(o=>i(o.getParent()))),s.forEach(o=>o.dispose()),this}createEdge(e,i,s,o){return this._registerEdge(new tT(e,i,s,o))}_registerEdge(e){this._edges.add(e);const i=e.getParent();this._parentEdges.has(i)||this._parentEdges.set(i,new Set),this._parentEdges.get(i).add(e);const s=e.getChild();return this._childEdges.has(s)||this._childEdges.set(s,new Set),this._childEdges.get(s).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function hI(){return hI=Object.assign||function(h){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(h[s]=i[s])}return h},hI.apply(this,arguments)}function mB(h){return h instanceof tT}function dI(h){return Array.isArray(h)&&h[0]instanceof tT}function pI(h){return!!(function(e){return!!e&&Object.getPrototypeOf(e)===Object.prototype}(h)&&function(e){for(const i in e)return e[i]}(h)instanceof tT)}const uu=Symbol("attributes"),nT=Symbol("immutableKeys");class gB extends fB{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[uu]=void 0,this[nT]=void 0,this.graph=e,this[nT]=new Set,this[uu]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),i={};for(const s in e){const o=e[s];if(o instanceof gB){const c=this.graph.createEdge(s,this,o);c.addEventListener("dispose",()=>o.dispose()),this[nT].add(s),i[s]=c}else i[s]=o}return i}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,i){for(const s in this[uu]){const o=this[uu][s];if(mB(o)){const c=o;c.getChild()===e&&this.setRef(s,i,c.getAttributes())}else if(dI(o)){const c=o.find(_=>_.getChild()===e);if(c){const _=c.getAttributes();this.removeRef(s,e).addRef(s,i,_)}}else if(pI(o)){const c=o;for(const _ in c){const j=c[_];j.getChild()===e&&this.setRefMap(s,_,i,j.getAttributes())}}}return this}get(e){return this[uu][e]}set(e,i){return this[uu][e]=i,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const i=this[uu][e];return i?i.getChild():null}setRef(e,i,s){if(this[nT].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const o=this[uu][e];if(o&&o.dispose(),!i)return this;const c=this.graph.createEdge(e,this,i,s);return c.addEventListener("dispose",()=>{delete this[uu][e],this.dispatchEvent({type:"change",attribute:e})}),this[uu][e]=c,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[uu][e].map(i=>i.getChild())}addRef(e,i,s){const o=this.graph.createEdge(e,this,i,s),c=this[uu][e];return c.push(o),o.addEventListener("dispose",()=>{const _=c.filter(j=>j!==o);c.length=0;for(const j of _)c.push(j);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,i){return this[uu][e].filter(s=>s.getChild()===i).forEach(s=>s.dispose()),this}listRefMapKeys(e){return Object.keys(this[uu][e])}listRefMapValues(e){return Object.values(this[uu][e]).map(i=>i.getChild())}getRefMap(e,i){const s=this[uu][e];return s[i]?s[i].getChild():null}setRefMap(e,i,s,o){const c=this[uu][e],_=c[i];if(_&&_.dispose(),!s)return this;o=Object.assign(o||{},{key:i});const j=this.graph.createEdge(e,this,s,hI({},o,{key:i}));return j.addEventListener("dispose",()=>{delete c[i],this.dispatchEvent({type:"change",attribute:e,key:i})}),c[i]=j,this.dispatchEvent({type:"change",attribute:e,key:i})}dispatchEvent(e){return super.dispatchEvent(hI({},e,{target:this})),this.graph.dispatchEvent(hI({},e,{target:this,type:`node:${e.type}`})),this}}const x3="@glb.bin";var ts,YP,$v,rp,XE;(function(h){h.ACCESSOR="Accessor",h.ANIMATION="Animation",h.ANIMATION_CHANNEL="AnimationChannel",h.ANIMATION_SAMPLER="AnimationSampler",h.BUFFER="Buffer",h.CAMERA="Camera",h.MATERIAL="Material",h.MESH="Mesh",h.PRIMITIVE="Primitive",h.PRIMITIVE_TARGET="PrimitiveTarget",h.NODE="Node",h.ROOT="Root",h.SCENE="Scene",h.SKIN="Skin",h.TEXTURE="Texture",h.TEXTURE_INFO="TextureInfo"})(ts||(ts={})),function(h){h.INTERLEAVED="interleaved",h.SEPARATE="separate"}(YP||(YP={})),function(h){h.ARRAY_BUFFER="ARRAY_BUFFER",h.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",h.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",h.OTHER="OTHER",h.SPARSE="SPARSE"}($v||($v={})),function(h){h[h.R=4096]="R",h[h.G=256]="G",h[h.B=16]="B",h[h.A=1]="A"}(rp||(rp={})),function(h){h.GLTF="GLTF",h.GLB="GLB"}(XE||(XE={}));const $P={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var KP,_B,vB=typeof Float32Array<"u"?Float32Array:Array;function yB(h){return Math.hypot(h[0],h[1],h[2])}function pz(h,e,i){var s=e[0],o=e[1],c=e[2],_=i[3]*s+i[7]*o+i[11]*c+i[15];return h[0]=(i[0]*s+i[4]*o+i[8]*c+i[12])/(_=_||1),h[1]=(i[1]*s+i[5]*o+i[9]*c+i[13])/_,h[2]=(i[2]*s+i[6]*o+i[10]*c+i[14])/_,h}function fz(h,e){const i={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const s of h.listPrimitives()){const o=s.getAttribute("POSITION");if(!o)continue;let c=[0,0,0],_=[0,0,0];for(let j=0;j<o.getCount();j++)c=o.getElement(j,c),_=pz(_,c,e),AB(_,i)}return i}function AB(h,e){for(let i=0;i<3;i++)e.min[i]=Math.min(h[i],e.min[i]),e.max[i]=Math.max(h[i],e.max[i])}Math.hypot||(Math.hypot=function(){for(var h=0,e=arguments.length;e--;)h+=arguments[e]*arguments[e];return Math.sqrt(h)}),KP=new vB(3),vB!=Float32Array&&(KP[0]=0,KP[1]=0,KP[2]=0);class No{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const i=atob(e.split(",")[1]),s=new Uint8Array(i.length);for(let o=0;o<i.length;o++)s[o]=i.charCodeAt(o);return s}{const i=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(i,s?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let i=0;for(const c of e)i+=c.byteLength;const s=new Uint8Array(i);let o=0;for(const c of e)s.set(c,o),o+=c.byteLength;return s}static pad(e,i=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const o=new Uint8Array(s);if(o.set(e),i!==0)for(let c=e.byteLength;c<s;c++)o[c]=i;return o}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,i){if(e===i)return!0;if(e.byteLength!==i.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==i[s])return!1;return!0}static toView(e,i=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+i,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class _v{static hexToFactor(e,i){e=Math.floor(e);const s=i;return s[0]=(e>>16&255)/255,s[1]=(e>>8&255)/255,s[2]=(255&e)/255,this.convertSRGBToLinear(i,i)}static factorToHex(e){const i=[...e],[s,o,c]=this.convertLinearToSRGB(e,i);return 255*s<<16^255*o<<8^255*c<<0}static convertSRGBToLinear(e,i){const s=e,o=i;for(let c=0;c<3;c++)o[c]=s[c]<.04045?.0773993808*s[c]:Math.pow(.9478672986*s[c]+.0521327014,2.4);return i}static convertLinearToSRGB(e,i){const s=e,o=i;for(let c=0;c<3;c++)o[c]=s[c]<.0031308?12.92*s[c]:1.055*Math.pow(s[c],.41666)-.055;return i}}class JP{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const i=new DataView(e.buffer,e.byteOffset);return No.decodeText(e.slice(12,16))===JP.PNG_FRIED_CHUNK_NAME?[i.getUint32(32,!1),i.getUint32(36,!1)]:[i.getUint32(16,!1),i.getUint32(20,!1)]}getChannels(e){return 4}}JP.PNG_FRIED_CHUNK_NAME="CgBI";class IA{static registerFormat(e,i){this.impls[e]=i}static getMimeType(e){for(const i in this.impls)if(this.impls[i].match(e))return i;return null}static getSize(e,i){return this.impls[i]?this.impls[i].getSize(e):null}static getChannels(e,i){return this.impls[i]?this.impls[i].getChannels(e):null}static getVRAMByteLength(e,i){if(!this.impls[i])return null;if(this.impls[i].getVRAMByteLength)return this.impls[i].getVRAMByteLength(e);let s=0;const o=this.getSize(e,i);if(!o)return null;for(;o[0]>1||o[1]>1;)s+=o[0]*o[1]*4,o[0]=Math.max(Math.floor(o[0]/2),1),o[1]=Math.max(Math.floor(o[1]/2),1);return s+=4,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}function mz(h,e){if(e>h.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(h.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return h}IA.impls={"image/jpeg":new class{match(h){return h.length>=3&&h[0]===255&&h[1]===216&&h[2]===255}getSize(h){let e,i,s=new DataView(h.buffer,h.byteOffset+4);for(;s.byteLength;){if(e=s.getUint16(0,!1),mz(s,e),i=s.getUint8(e+1),i===192||i===193||i===194)return[s.getUint16(e+7,!1),s.getUint16(e+5,!1)];s=new DataView(h.buffer,s.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(h){return 3}},"image/png":new JP};class rT{static basename(e){const i=e.split(/[\\/]/).pop();return i.substring(0,i.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const i=e.match(/data:(image\/\w+)/)[1];return IA.mimeTypeToExtension(i)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function E3(h){return Object.prototype.toString.call(h)==="[object Object]"}function YE(h){if(E3(h)===!1)return!1;const e=h.constructor;if(e===void 0)return!0;const i=e.prototype;return E3(i)!==!1&&Object.prototype.hasOwnProperty.call(i,"isPrototypeOf")!==!1}(function(h){h[h.SILENT=4]="SILENT",h[h.ERROR=3]="ERROR",h[h.WARN=2]="WARN",h[h.INFO=1]="INFO",h[h.DEBUG=0]="DEBUG"})(_B||(_B={}));class Kv{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Kv.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Kv.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Kv.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Kv.Verbosity.ERROR&&console.error(e)}}function gz(h,e,i){var s=e[0],o=e[1],c=e[2],_=e[3],j=e[4],et=e[5],nt=e[6],st=e[7],at=e[8],ct=e[9],dt=e[10],mt=e[11],yt=e[12],wt=e[13],Ct=e[14],bt=e[15],At=i[0],Pt=i[1],Dt=i[2],Nt=i[3];return h[0]=At*s+Pt*j+Dt*at+Nt*yt,h[1]=At*o+Pt*et+Dt*ct+Nt*wt,h[2]=At*c+Pt*nt+Dt*dt+Nt*Ct,h[3]=At*_+Pt*st+Dt*mt+Nt*bt,h[4]=(At=i[4])*s+(Pt=i[5])*j+(Dt=i[6])*at+(Nt=i[7])*yt,h[5]=At*o+Pt*et+Dt*ct+Nt*wt,h[6]=At*c+Pt*nt+Dt*dt+Nt*Ct,h[7]=At*_+Pt*st+Dt*mt+Nt*bt,h[8]=(At=i[8])*s+(Pt=i[9])*j+(Dt=i[10])*at+(Nt=i[11])*yt,h[9]=At*o+Pt*et+Dt*ct+Nt*wt,h[10]=At*c+Pt*nt+Dt*dt+Nt*Ct,h[11]=At*_+Pt*st+Dt*mt+Nt*bt,h[12]=(At=i[12])*s+(Pt=i[13])*j+(Dt=i[14])*at+(Nt=i[15])*yt,h[13]=At*o+Pt*et+Dt*ct+Nt*wt,h[14]=At*c+Pt*nt+Dt*dt+Nt*Ct,h[15]=At*_+Pt*st+Dt*mt+Nt*bt,h}Kv.Verbosity=_B,Kv.DEFAULT_INSTANCE=new Kv(Kv.Verbosity.INFO);class Tu{static identity(e){return e}static eq(e,i,s=1e-5){if(e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(Math.abs(e[o]-i[o])>s)return!1;return!0}static decodeNormalizedInt(e,i){switch(i){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,i){return Tu.decodeNormalizedInt(e,i)}static encodeNormalizedInt(e,i){switch(i){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,i){return Tu.encodeNormalizedInt(e,i)}static decompose(e,i,s,o){let c=yB([e[0],e[1],e[2]]);const _=yB([e[4],e[5],e[6]]),j=yB([e[8],e[9],e[10]]);var et,nt,st,at,ct,dt,mt,yt,wt,Ct,bt,At,Pt,Dt,Nt,Vt,Zt;((nt=(et=e)[0])*(mt=et[5])-(st=et[1])*(dt=et[4]))*((At=et[10])*(Zt=et[15])-(Pt=et[11])*(Vt=et[14]))-(nt*(yt=et[6])-(at=et[2])*dt)*((bt=et[9])*Zt-Pt*(Nt=et[13]))+(nt*(wt=et[7])-(ct=et[3])*dt)*(bt*Vt-At*Nt)+(st*yt-at*mt)*((Ct=et[8])*Zt-Pt*(Dt=et[12]))-(st*wt-ct*mt)*(Ct*Vt-At*Dt)+(at*wt-ct*yt)*(Ct*Nt-bt*Dt)<0&&(c=-c),i[0]=e[12],i[1]=e[13],i[2]=e[14];const an=e.slice(),fn=1/c,mn=1/_,Sn=1/j;an[0]*=fn,an[1]*=fn,an[2]*=fn,an[4]*=mn,an[5]*=mn,an[6]*=mn,an[8]*=Sn,an[9]*=Sn,an[10]*=Sn,function(An,wn){var Mn=new vB(3);(function(Os,gr){var kr=gr[4],$r=gr[5],co=gr[6],Do=gr[8],_o=gr[9],io=gr[10];Os[0]=Math.hypot(gr[0],gr[1],gr[2]),Os[1]=Math.hypot(kr,$r,co),Os[2]=Math.hypot(Do,_o,io)})(Mn,wn);var Pn=1/Mn[0],On=1/Mn[1],er=1/Mn[2],Zn=wn[0]*Pn,yr=wn[1]*On,lr=wn[2]*er,ar=wn[4]*Pn,Mr=wn[5]*On,xr=wn[6]*er,qr=wn[8]*Pn,Zr=wn[9]*On,ds=wn[10]*er,Hs=Zn+Mr+ds,Ps=0;Hs>0?(Ps=2*Math.sqrt(Hs+1),An[3]=.25*Ps,An[0]=(xr-Zr)/Ps,An[1]=(qr-lr)/Ps,An[2]=(yr-ar)/Ps):Zn>Mr&&Zn>ds?(Ps=2*Math.sqrt(1+Zn-Mr-ds),An[3]=(xr-Zr)/Ps,An[0]=.25*Ps,An[1]=(yr+ar)/Ps,An[2]=(qr+lr)/Ps):Mr>ds?(Ps=2*Math.sqrt(1+Mr-Zn-ds),An[3]=(qr-lr)/Ps,An[0]=(yr+ar)/Ps,An[1]=.25*Ps,An[2]=(xr+Zr)/Ps):(Ps=2*Math.sqrt(1+ds-Zn-Mr),An[3]=(yr-ar)/Ps,An[0]=(qr+lr)/Ps,An[1]=(xr+Zr)/Ps,An[2]=.25*Ps)}(s,an),o[0]=c,o[1]=_,o[2]=j}static compose(e,i,s,o){const c=o,_=i[0],j=i[1],et=i[2],nt=i[3],st=_+_,at=j+j,ct=et+et,dt=_*st,mt=_*at,yt=_*ct,wt=j*at,Ct=j*ct,bt=et*ct,At=nt*st,Pt=nt*at,Dt=nt*ct,Nt=s[0],Vt=s[1],Zt=s[2];return c[0]=(1-(wt+bt))*Nt,c[1]=(mt+Dt)*Nt,c[2]=(yt-Pt)*Nt,c[3]=0,c[4]=(mt-Dt)*Vt,c[5]=(1-(dt+bt))*Vt,c[6]=(Ct+At)*Vt,c[7]=0,c[8]=(yt+Pt)*Zt,c[9]=(Ct-At)*Zt,c[10]=(1-(dt+wt))*Zt,c[11]=0,c[12]=e[0],c[13]=e[1],c[14]=e[2],c[15]=1,c}}function _z(h,e){if(!!h!=!!e)return!1;const i=h.getChild(),s=e.getChild();return i===s||i.equals(s)}function vz(h,e){if(!!h!=!!e||h.length!==e.length)return!1;for(let i=0;i<h.length;i++){const s=h[i],o=e[i];if(s.getChild()!==o.getChild()&&!s.getChild().equals(o.getChild()))return!1}return!0}function yz(h,e){if(!!h!=!!e)return!1;const i=Object.keys(h),s=Object.keys(e);if(i.length!==s.length)return!1;for(const o in h){const c=h[o],_=e[o];if(!!c!=!!_)return!1;const j=c.getChild(),et=_.getChild();if(j!==et&&!j.equals(et))return!1}return!0}function S3(h,e){if(h===e)return!0;if(!!h!=!!e||!h||!e||h.length!==e.length)return!1;for(let i=0;i<h.length;i++)if(h[i]!==e[i])return!1;return!0}function C3(h,e){if(h===e)return!0;if(!!h!=!!e)return!1;if(!YE(h)||!YE(e))return h===e;const i=h,s=e;let o,c=0,_=0;for(o in i)c++;for(o in s)_++;if(c!==_)return!1;for(o in i){const j=i[o],et=s[o];if(ZP(j)&&ZP(et)){if(!S3(j,et))return!1}else if(YE(j)&&YE(et)){if(!C3(j,et))return!1}else if(j!==et)return!1}return!0}function ZP(h){return Array.isArray(h)||ArrayBuffer.isView(h)}const T3="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",M3=new Set,Az=function(){let h="";for(let e=0;e<6;e++)h+=T3.charAt(Math.floor(Math.random()*T3.length));return h};class fI{static dirname(e){const i=e.lastIndexOf("/");return i===-1?"./":e.substring(0,i+1)}static basename(e){return rT.basename(new URL(e,"https://null.example").pathname)}static extension(e){return rT.extension(new URL(e,"https://null.example").pathname)}static resolve(e,i){if(!this.isRelativePath(i))return i;const s=e.split("/"),o=i.split("/");s.pop();for(let c=0;c<o.length;c++)o[c]!=="."&&(o[c]===".."?s.pop():s.push(o[c]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}fI.DEFAULT_INIT={},fI.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const Gw=h=>h,bz=new Set;class bB extends gB{constructor(e,i=""){super(e),this[uu].name=i,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,i){return Array.isArray(i)&&(i=i.slice()),super.set(e,i)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,Gw)}copy(e,i=Gw){for(const s in this[uu]){const o=this[uu][s];if(o instanceof tT)this[nT].has(s)||o.dispose();else if(dI(o))for(const c of o)c.dispose();else if(pI(o))for(const c in o)o[c].dispose()}for(const s in e[uu]){const o=this[uu][s],c=e[uu][s];if(c instanceof tT)this[nT].has(s)?o.getChild().copy(i(c.getChild()),i):this.setRef(s,i(c.getChild()),c.getAttributes());else if(dI(c))for(const _ of c)this.addRef(s,i(_.getChild()),_.getAttributes());else if(pI(c))for(const _ in c){const j=c[_];this.setRefMap(s,_,i(j.getChild()),j.getAttributes())}else this[uu][s]=YE(c)?JSON.parse(JSON.stringify(c)):Array.isArray(c)||c instanceof ArrayBuffer||ArrayBuffer.isView(c)?c.slice():c}return this}equals(e,i=bz){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[uu]){if(i.has(s))continue;const o=this[uu][s],c=e[uu][s];if(mB(o)||mB(c)){if(!_z(o,c))return!1}else if(dI(o)||dI(c)){if(!vz(o,c))return!1}else if(pI(o)||pI(c)){if(!yz(o,c))return!1}else if(YE(o)||YE(c)){if(!C3(o,c))return!1}else if(ZP(o)||ZP(c)){if(!S3(o,c))return!1}else if(o!==c)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class N_ extends bB{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,i){return i&&i.t(this),this.setRefMap("extensions",e,i)}listExtensions(){return this.listRefMapValues("extensions")}}class As extends N_{constructor(...e){super(...e),this.i=Tu.identity,this.o=Tu.identity}init(){this.propertyType=ts.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:As.Type.SCALAR,componentType:As.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,i=Gw){return super.copy(e,i),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case As.Type.SCALAR:return 1;case As.Type.VEC2:return 2;case As.Type.VEC3:return 3;case As.Type.VEC4:case As.Type.MAT2:return 4;case As.Type.MAT3:return 9;case As.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case As.ComponentType.BYTE:case As.ComponentType.UNSIGNED_BYTE:return 1;case As.ComponentType.SHORT:case As.ComponentType.UNSIGNED_SHORT:return 2;case As.ComponentType.UNSIGNED_INT:case As.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const i=this.getElementSize();this.getMin(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMin(e){const i=this.get("array"),s=this.getCount(),o=this.getElementSize();for(let c=0;c<o;c++)e[c]=1/0;for(let c=0;c<s*o;c+=o)for(let _=0;_<o;_++){const j=i[c+_];Number.isFinite(j)&&(e[_]=Math.min(e[_],j))}return e}getMaxNormalized(e){const i=this.getElementSize();this.getMax(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMax(e){const i=this.get("array"),s=this.getCount(),o=this.getElementSize();for(let c=0;c<o;c++)e[c]=-1/0;for(let c=0;c<s*o;c+=o)for(let _=0;_<o;_++){const j=i[c+_];Number.isFinite(j)&&(e[_]=Math.max(e[_],j))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return As.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=i=>Tu.decodeNormalizedInt(i,this.get("componentType")),this.i=i=>Tu.encodeNormalizedInt(i,this.get("componentType"))):(this.o=Tu.identity,this.i=Tu.identity),this}getScalar(e){const i=this.getElementSize();return this.o(this.get("array")[e*i])}setScalar(e,i){return this.get("array")[e*this.getElementSize()]=this.i(i),this}getElement(e,i){const s=this.getElementSize(),o=this.get("array");for(let c=0;c<s;c++)i[c]=this.o(o[e*s+c]);return i}setElement(e,i){const s=this.getElementSize(),o=this.get("array");for(let c=0;c<s;c++)o[e*s+c]=this.i(i[c]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(i){switch(i.constructor){case Float32Array:return As.ComponentType.FLOAT;case Uint32Array:return As.ComponentType.UNSIGNED_INT;case Uint16Array:return As.ComponentType.UNSIGNED_SHORT;case Uint8Array:return As.ComponentType.UNSIGNED_BYTE;case Int16Array:return As.ComponentType.SHORT;case Int8Array:return As.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):As.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}As.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},As.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class I3 extends N_{init(){this.propertyType=ts.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class wB extends N_{init(){this.propertyType=ts.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}wB.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class iT extends N_{init(){this.propertyType=ts.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:iT.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:$v.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:$v.OTHER})}}iT.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class P3 extends N_{init(){this.propertyType=ts.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class $E extends N_{init(){this.propertyType=ts.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:$E.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}$E.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class gp extends bB{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}gp.EXTENSION_NAME=void 0;class Mu extends N_{init(){this.propertyType=ts.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Mu.WrapMode.REPEAT,wrapT:Mu.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Mu.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Mu.MagFilter={NEAREST:9728,LINEAR:9729},Mu.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:eR,G:tR,B:nR,A:wz}=rp;class KE extends N_{init(){this.propertyType=ts.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:KE.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Mu(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Mu(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Mu(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Mu(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Mu(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const i=this.get("baseColorFactor").slice();return i[3]=e,this.set("baseColorFactor",i)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return _v.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const i=this.get("baseColorFactor").slice();return this.set("baseColorFactor",_v.hexToFactor(e,i))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:eR|tR|nR|wz})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return _v.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const i=this.get("emissiveFactor").slice();return this.set("emissiveFactor",_v.hexToFactor(e,i))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:eR|tR|nR})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:eR|tR|nR})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:eR})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:tR|nR})}}KE.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class R3 extends N_{init(){this.propertyType=ts.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class D3 extends N_{constructor(...e){super(...e),this.u=null}init(){this.propertyType=ts.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,i=Gw){if(i===Gw)throw new Error("Node cannot be copied.");return super.copy(e,i)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Tu.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const i=this.get("translation").slice(),s=this.get("rotation").slice(),o=this.get("scale").slice();return Tu.decompose(e,i,s,o),this.set("translation",i).set("rotation",s).set("scale",o)}getWorldTranslation(){const e=[0,0,0];return Tu.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Tu.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Tu.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let o=this;o!=null;o=o.u)e.push(o);let i;const s=e.pop().getMatrix();for(;i=e.pop();)gz(s,s,i.getMatrix());return s}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const i=this[uu].children;return i[i.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===ts.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const i of this.listChildren())i.traverse(e);return this}}class JE extends N_{init(){this.propertyType=ts.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:JE.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:$v.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:$v.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}JE.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class xz extends bB{init(){this.propertyType=ts.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:$v.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function vv(){return(vv=Object.assign||function(h){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(h[s]=i[s])}return h}).apply(this,arguments)}class k3 extends N_{init(){this.propertyType=ts.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,i=Gw){if(i===Gw)throw new Error("Scene cannot be copied.");return super.copy(e,i)}addChild(e){return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const i of this.listChildren())i.traverse(e);return this}}class O3 extends N_{init(){this.propertyType=ts.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:$v.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class B3 extends N_{init(){this.propertyType=ts.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||IA.extensionToMimeType(rT.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const i=IA.extensionToMimeType(rT.extension(e));return i&&this.set("mimeType",i),this}getImage(){return this.get("image")}setImage(e){return this.set("image",No.assertView(e))}getSize(){const e=this.get("image");return e?IA.getSize(e,this.getMimeType()):null}}class L3 extends N_{init(){this.propertyType=ts.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v3.2.1",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",i=>{this.l(i.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,i=Gw){if(i===Gw)throw new Error("Root cannot be copied.");this.set("asset",vv({},e.get("asset"))),this.setName(e.getName()),this.setExtras(vv({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?i(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const o=e.getExtension(s);this.setExtension(s,i(o))}return this}l(e){return e instanceof k3?this.addRef("scenes",e):e instanceof D3?this.addRef("nodes",e):e instanceof $E?this.addRef("cameras",e):e instanceof O3?this.addRef("skins",e):e instanceof R3?this.addRef("meshes",e):e instanceof KE?this.addRef("materials",e):e instanceof B3?this.addRef("textures",e):e instanceof I3?this.addRef("animations",e):e instanceof As?this.addRef("accessors",e):e instanceof P3&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class sT{static fromGraph(e){return sT.m.get(e)||null}constructor(){this.v=new dz,this.T=new L3(this.v),this.M=Kv.DEFAULT_INSTANCE,sT.m.set(this.v,this)}getRoot(){return this.T}getGraph(){return this.v}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new sT().setLogger(this.M).merge(this)}merge(e){for(const c of e.getRoot().listExtensionsUsed()){const _=this.createExtension(c.constructor);c.isRequired()&&_.setRequired(!0)}const i=new Set,s=new Map;i.add(e.T),s.set(e.T,this.T);for(const c of e.v.listEdges())for(const _ of[c.getParent(),c.getChild()]){if(i.has(_))continue;let j;j=_.propertyType===ts.TEXTURE_INFO?_:new _.constructor(this.v),s.set(_,j),i.add(_)}const o=c=>{const _=s.get(c);if(!_)throw new Error("Could resolve property.");return _};for(const c of i){const _=s.get(c);if(!_)throw new Error("Could resolve property.");_.propertyType!==ts.TEXTURE_INFO&&_.copy(c,o)}return this}async transform(...e){const i=e.map(s=>s.name);for(const s of e)await s(this,{stack:i});return this}createExtension(e){const i=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(s=>s.extensionName===i)||new e(this)}createScene(e=""){return new k3(this.v,e)}createNode(e=""){return new D3(this.v,e)}createCamera(e=""){return new $E(this.v,e)}createSkin(e=""){return new O3(this.v,e)}createMesh(e=""){return new R3(this.v,e)}createPrimitive(){return new JE(this.v)}createPrimitiveTarget(e=""){return new xz(this.v,e)}createMaterial(e=""){return new KE(this.v,e)}createTexture(e=""){return new B3(this.v,e)}createAnimation(e=""){return new I3(this.v,e)}createAnimationChannel(e=""){return new wB(this.v,e)}createAnimationSampler(e=""){return new iT(this.v,e)}createAccessor(e="",i=null){return i||(i=this.getRoot().listBuffers()[0]),new As(this.v,e).setBuffer(i)}createBuffer(e=""){return new P3(this.v,e)}}sT.m=new WeakMap;class Bu{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=s=>{const o=s,c=o.target;c instanceof gp&&c.extensionName===this.extensionName&&(o.type==="node:create"&&this.I(c),o.type==="node:dispose"&&this.N(c))};const i=e.getGraph();i.addEventListener("node:create",this.S),i.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const i of this.properties)i.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}I(e){return this.properties.add(e),this}N(e){return this.properties.delete(e),this}install(e,i){return this}preread(e,i){return this}prewrite(e,i){return this}}Bu.EXTENSION_NAME=void 0;class Ez{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,i){this.textureInfos.set(e,i),i.texCoord!==void 0&&e.setTexCoord(i.texCoord),i.extras!==void 0&&e.setExtras(i.extras);const s=this.jsonDoc.json.textures[i.index];if(s.sampler===void 0)return;const o=this.jsonDoc.json.samplers[s.sampler];o.magFilter!==void 0&&e.setMagFilter(o.magFilter),o.minFilter!==void 0&&e.setMinFilter(o.minFilter),o.wrapS!==void 0&&e.setWrapS(o.wrapS),o.wrapT!==void 0&&e.setWrapT(o.wrapT)}}const N3={logger:Kv.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function rR(h,e){const i=e.bufferViews[h.bufferView],s=e.jsonDoc.json.bufferViews[h.bufferView],o=$P[h.componentType],c=As.getElementSize(h.type),_=o.BYTES_PER_ELEMENT;if(s.byteStride!==void 0&&s.byteStride!==c*_)return function(et,nt){const st=nt.bufferViews[et.bufferView],at=nt.jsonDoc.json.bufferViews[et.bufferView],ct=$P[et.componentType],dt=As.getElementSize(et.type),mt=ct.BYTES_PER_ELEMENT,yt=et.byteOffset||0,wt=new ct(et.count*dt),Ct=new DataView(st.buffer,st.byteOffset,st.byteLength),bt=at.byteStride;for(let At=0;At<et.count;At++)for(let Pt=0;Pt<dt;Pt++){const Dt=yt+At*bt+Pt*mt;let Nt;switch(et.componentType){case As.ComponentType.FLOAT:Nt=Ct.getFloat32(Dt,!0);break;case As.ComponentType.UNSIGNED_INT:Nt=Ct.getUint32(Dt,!0);break;case As.ComponentType.UNSIGNED_SHORT:Nt=Ct.getUint16(Dt,!0);break;case As.ComponentType.UNSIGNED_BYTE:Nt=Ct.getUint8(Dt);break;case As.ComponentType.SHORT:Nt=Ct.getInt16(Dt,!0);break;case As.ComponentType.BYTE:Nt=Ct.getInt8(Dt);break;default:throw new Error(`Unexpected componentType "${et.componentType}".`)}wt[At*dt+Pt]=Nt}return wt}(h,e);const j=i.byteOffset+(h.byteOffset||0);return new o(i.buffer.slice(j,j+h.count*c*_))}var mI;(function(h){h[h.ARRAY_BUFFER=34962]="ARRAY_BUFFER",h[h.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(mI||(mI={}));class PA{constructor(e,i,s){this.O=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.C=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.O=e,this.jsonDoc=i,this.options=s;const o=e.getRoot(),c=o.listBuffers().length,_=o.listTextures().length;this.bufferURIGenerator=new U3(c>1,()=>s.basename||"buffer"),this.imageURIGenerator=new U3(_>1,j=>function(et,nt){const st=et.getGraph().listParentEdges(nt).find(at=>at.getParent()!==et.getRoot());return st?st.getName().replace(/texture$/i,""):""}(e,j)||s.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,i){const s={magFilter:i.getMagFilter()||void 0,minFilter:i.getMinFilter()||void 0,wrapS:i.getWrapS(),wrapT:i.getWrapT()},o=JSON.stringify(s);this.samplerDefIndexMap.has(o)||(this.samplerDefIndexMap.set(o,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const c={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(o)},_=JSON.stringify(c);this.textureDefIndexMap.has(_)||(this.textureDefIndexMap.set(_,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(c));const j={index:this.textureDefIndexMap.get(_)};return i.getTexCoord()!==0&&(j.texCoord=i.getTexCoord()),Object.keys(i.getExtras()).length>0&&(j.extras=i.getExtras()),this.textureInfoDefMap.set(i,j),j}createPropertyDef(e){const i={};return e.getName()&&(i.name=e.getName()),Object.keys(e.getExtras()).length>0&&(i.extras=e.getExtras()),i}createAccessorDef(e){const i=this.createPropertyDef(e);return i.type=e.getType(),i.componentType=e.getComponentType(),i.count=e.getCount(),this.O.getGraph().listParentEdges(e).some(s=>s.getName()==="attributes"&&s.getAttributes().key==="POSITION"||s.getName()==="input")&&(i.max=e.getMax([]).map(Math.fround),i.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(i.normalized=e.getNormalized()),i}createImageData(e,i,s){if(this.options.format===XE.GLB)this.imageBufferViews.push(i),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:i.byteLength});else{const o=IA.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,o),this.jsonDoc.resources[e.uri]=i}}getAccessorUsage(e){const i=this.C.get(e);if(i)return i;if(e.getSparse())return $v.SPARSE;for(const s of this.O.getGraph().listParentEdges(e)){const{usage:o}=s.getAttributes();if(o)return o;s.getParent().propertyType!==ts.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return $v.OTHER}addAccessorToUsageGroup(e,i){const s=this.C.get(e);if(s&&s!==i)throw new Error(`Accessor with usage "${s}" cannot be reused as "${i}".`);return this.C.set(e,i),this}listAccessorUsageGroups(){const e={};for(const[i,s]of Array.from(this.C.entries()))e[s]=e[s]||[],e[s].push(i);return e}}PA.BufferViewTarget=mI,PA.BufferViewUsage=$v,PA.USAGE_TO_TARGET={[$v.ARRAY_BUFFER]:mI.ARRAY_BUFFER,[$v.ELEMENT_ARRAY_BUFFER]:mI.ELEMENT_ARRAY_BUFFER};class U3{constructor(e,i){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=i}createURI(e,i){if(e.getURI())return e.getURI();if(this.multiple){const s=this.basename(e);return this.counter[s]=this.counter[s]||1,`${s}_${this.counter[s]++}.${i}`}return`${this.basename(e)}.${i}`}}const{BufferViewUsage:iR}=PA,{UNSIGNED_INT:Sz,UNSIGNED_SHORT:Cz,UNSIGNED_BYTE:Tz}=As.ComponentType;var sR;(function(h){h[h.JSON=1313821514]="JSON",h[h.BIN=5130562]="BIN"})(sR||(sR={}));class Mz{constructor(){this.M=Kv.DEFAULT_INSTANCE,this.h=new Set,this.F={},this.U=YP.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const i of e)this.h.add(i),i.register();return this}registerDependencies(e){return Object.assign(this.F,e),this}setVertexLayout(e){return this.U=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const i=await this.readURI(e,"view");this.lastReadBytes=i.byteLength;const s=F3(i)?this.P(i):{json:JSON.parse(No.decodeText(i)),resources:{}};return await this.L(s,this.dirname(e)),this.j(s),s}async readJSON(e){return e=this.D(e),this.j(e),(class{static read(i,s=N3){const o=vv({},N3,s),{json:c}=i,_=new sT().setLogger(o.logger);this.validate(i,o);const j=new Ez(i),et=c.asset,nt=_.getRoot().getAsset();et.copyright&&(nt.copyright=et.copyright),et.extras&&(nt.extras=et.extras),c.extras!==void 0&&_.getRoot().setExtras(vv({},c.extras));const st=c.extensionsUsed||[],at=c.extensionsRequired||[];for(const At of o.extensions)if(st.includes(At.EXTENSION_NAME)){const Pt=_.createExtension(At).setRequired(at.includes(At.EXTENSION_NAME));for(const Dt of Pt.readDependencies)Pt.install(Dt,o.dependencies[Dt])}const ct=c.buffers||[];_.getRoot().listExtensionsUsed().filter(At=>At.prereadTypes.includes(ts.BUFFER)).forEach(At=>At.preread(j,ts.BUFFER)),j.buffers=ct.map(At=>{const Pt=_.createBuffer(At.name);return At.extras&&Pt.setExtras(At.extras),At.uri&&At.uri.indexOf("__")!==0&&Pt.setURI(At.uri),Pt}),j.bufferViewBuffers=(c.bufferViews||[]).map((At,Pt)=>{if(!j.bufferViews[Pt]){const Dt=i.json.buffers[At.buffer];j.bufferViews[Pt]=No.toView(Dt.uri?i.resources[Dt.uri]:i.resources["@glb.bin"],At.byteOffset||0,At.byteLength)}return j.buffers[At.buffer]});const dt=c.accessors||[];j.accessors=dt.map(At=>{const Pt=_.createAccessor(At.name,j.bufferViewBuffers[At.bufferView]).setType(At.type);return At.extras&&Pt.setExtras(At.extras),At.normalized!==void 0&&Pt.setNormalized(At.normalized),At.bufferView===void 0||Pt.setArray(rR(At,j)),Pt});const mt=c.images||[],yt=c.textures||[];_.getRoot().listExtensionsUsed().filter(At=>At.prereadTypes.includes(ts.TEXTURE)).forEach(At=>At.preread(j,ts.TEXTURE)),j.textures=mt.map(At=>{const Pt=_.createTexture(At.name);if(At.extras&&Pt.setExtras(At.extras),At.bufferView!==void 0){const Dt=c.bufferViews[At.bufferView],Nt=i.json.buffers[Dt.buffer],Vt=Dt.byteOffset||0,Zt=(Nt.uri?i.resources[Nt.uri]:i.resources["@glb.bin"]).slice(Vt,Vt+Dt.byteLength);Pt.setImage(Zt)}else At.uri!==void 0&&(Pt.setImage(i.resources[At.uri]),At.uri.indexOf("__")!==0&&Pt.setURI(At.uri));if(At.mimeType!==void 0)Pt.setMimeType(At.mimeType);else if(At.uri){const Dt=rT.extension(At.uri);Pt.setMimeType(IA.extensionToMimeType(Dt))}return Pt}),j.materials=(c.materials||[]).map(At=>{const Pt=_.createMaterial(At.name);At.extras&&Pt.setExtras(At.extras),At.alphaMode!==void 0&&Pt.setAlphaMode(At.alphaMode),At.alphaCutoff!==void 0&&Pt.setAlphaCutoff(At.alphaCutoff),At.doubleSided!==void 0&&Pt.setDoubleSided(At.doubleSided);const Dt=At.pbrMetallicRoughness||{};if(Dt.baseColorFactor!==void 0&&Pt.setBaseColorFactor(Dt.baseColorFactor),At.emissiveFactor!==void 0&&Pt.setEmissiveFactor(At.emissiveFactor),Dt.metallicFactor!==void 0&&Pt.setMetallicFactor(Dt.metallicFactor),Dt.roughnessFactor!==void 0&&Pt.setRoughnessFactor(Dt.roughnessFactor),Dt.baseColorTexture!==void 0){const Nt=Dt.baseColorTexture;Pt.setBaseColorTexture(j.textures[yt[Nt.index].source]),j.setTextureInfo(Pt.getBaseColorTextureInfo(),Nt)}if(At.emissiveTexture!==void 0){const Nt=At.emissiveTexture;Pt.setEmissiveTexture(j.textures[yt[Nt.index].source]),j.setTextureInfo(Pt.getEmissiveTextureInfo(),Nt)}if(At.normalTexture!==void 0){const Nt=At.normalTexture;Pt.setNormalTexture(j.textures[yt[Nt.index].source]),j.setTextureInfo(Pt.getNormalTextureInfo(),Nt),At.normalTexture.scale!==void 0&&Pt.setNormalScale(At.normalTexture.scale)}if(At.occlusionTexture!==void 0){const Nt=At.occlusionTexture;Pt.setOcclusionTexture(j.textures[yt[Nt.index].source]),j.setTextureInfo(Pt.getOcclusionTextureInfo(),Nt),At.occlusionTexture.strength!==void 0&&Pt.setOcclusionStrength(At.occlusionTexture.strength)}if(Dt.metallicRoughnessTexture!==void 0){const Nt=Dt.metallicRoughnessTexture;Pt.setMetallicRoughnessTexture(j.textures[yt[Nt.index].source]),j.setTextureInfo(Pt.getMetallicRoughnessTextureInfo(),Nt)}return Pt});const wt=c.meshes||[];_.getRoot().listExtensionsUsed().filter(At=>At.prereadTypes.includes(ts.PRIMITIVE)).forEach(At=>At.preread(j,ts.PRIMITIVE)),j.meshes=wt.map(At=>{const Pt=_.createMesh(At.name);return At.extras&&Pt.setExtras(At.extras),At.weights!==void 0&&Pt.setWeights(At.weights),(At.primitives||[]).forEach(Dt=>{const Nt=_.createPrimitive();Dt.extras&&Nt.setExtras(Dt.extras),Dt.material!==void 0&&Nt.setMaterial(j.materials[Dt.material]),Dt.mode!==void 0&&Nt.setMode(Dt.mode);for(const[Zt,an]of Object.entries(Dt.attributes||{}))Nt.setAttribute(Zt,j.accessors[an]);Dt.indices!==void 0&&Nt.setIndices(j.accessors[Dt.indices]);const Vt=At.extras&&At.extras.targetNames||[];(Dt.targets||[]).forEach((Zt,an)=>{const fn=Vt[an]||an.toString(),mn=_.createPrimitiveTarget(fn);for(const[Sn,An]of Object.entries(Zt))mn.setAttribute(Sn,j.accessors[An]);Nt.addTarget(mn)}),Pt.addPrimitive(Nt)}),Pt}),j.cameras=(c.cameras||[]).map(At=>{const Pt=_.createCamera(At.name).setType(At.type);if(At.extras&&Pt.setExtras(At.extras),At.type===$E.Type.PERSPECTIVE){const Dt=At.perspective;Pt.setYFov(Dt.yfov),Pt.setZNear(Dt.znear),Dt.zfar!==void 0&&Pt.setZFar(Dt.zfar),Dt.aspectRatio!==void 0&&Pt.setAspectRatio(Dt.aspectRatio)}else{const Dt=At.orthographic;Pt.setZNear(Dt.znear).setZFar(Dt.zfar).setXMag(Dt.xmag).setYMag(Dt.ymag)}return Pt});const Ct=c.nodes||[];_.getRoot().listExtensionsUsed().filter(At=>At.prereadTypes.includes(ts.NODE)).forEach(At=>At.preread(j,ts.NODE)),j.nodes=Ct.map(At=>{const Pt=_.createNode(At.name);if(At.extras&&Pt.setExtras(At.extras),At.translation!==void 0&&Pt.setTranslation(At.translation),At.rotation!==void 0&&Pt.setRotation(At.rotation),At.scale!==void 0&&Pt.setScale(At.scale),At.matrix!==void 0){const Dt=[0,0,0],Nt=[0,0,0,1],Vt=[1,1,1];Tu.decompose(At.matrix,Dt,Nt,Vt),Pt.setTranslation(Dt),Pt.setRotation(Nt),Pt.setScale(Vt)}return At.weights!==void 0&&Pt.setWeights(At.weights),Pt}),j.skins=(c.skins||[]).map(At=>{const Pt=_.createSkin(At.name);At.extras&&Pt.setExtras(At.extras),At.inverseBindMatrices!==void 0&&Pt.setInverseBindMatrices(j.accessors[At.inverseBindMatrices]),At.skeleton!==void 0&&Pt.setSkeleton(j.nodes[At.skeleton]);for(const Dt of At.joints)Pt.addJoint(j.nodes[Dt]);return Pt}),Ct.map((At,Pt)=>{const Dt=j.nodes[Pt];(At.children||[]).forEach(Nt=>Dt.addChild(j.nodes[Nt])),At.mesh!==void 0&&Dt.setMesh(j.meshes[At.mesh]),At.camera!==void 0&&Dt.setCamera(j.cameras[At.camera]),At.skin!==void 0&&Dt.setSkin(j.skins[At.skin])}),j.animations=(c.animations||[]).map(At=>{const Pt=_.createAnimation(At.name);At.extras&&Pt.setExtras(At.extras);const Dt=(At.samplers||[]).map(Nt=>{const Vt=_.createAnimationSampler().setInput(j.accessors[Nt.input]).setOutput(j.accessors[Nt.output]).setInterpolation(Nt.interpolation||iT.Interpolation.LINEAR);return Nt.extras&&Vt.setExtras(Nt.extras),Pt.addSampler(Vt),Vt});return(At.channels||[]).forEach(Nt=>{const Vt=_.createAnimationChannel().setSampler(Dt[Nt.sampler]).setTargetPath(Nt.target.path);Nt.target.node!==void 0&&Vt.setTargetNode(j.nodes[Nt.target.node]),Nt.extras&&Vt.setExtras(Nt.extras),Pt.addChannel(Vt)}),Pt});const bt=c.scenes||[];return _.getRoot().listExtensionsUsed().filter(At=>At.prereadTypes.includes(ts.SCENE)).forEach(At=>At.preread(j,ts.SCENE)),j.scenes=bt.map(At=>{const Pt=_.createScene(At.name);return At.extras&&Pt.setExtras(At.extras),(At.nodes||[]).map(Dt=>j.nodes[Dt]).forEach(Dt=>Pt.addChild(Dt)),Pt}),c.scene!==void 0&&_.getRoot().setDefaultScene(j.scenes[c.scene]),_.getRoot().listExtensionsUsed().forEach(At=>At.read(j)),dt.forEach((At,Pt)=>{const Dt=j.accessors[Pt],Nt=!!At.sparse,Vt=!At.bufferView&&!Dt.getArray();(Nt||Vt)&&Dt.setSparse(!0).setArray(function(Zt,an){const fn=$P[Zt.componentType],mn=As.getElementSize(Zt.type);let Sn;Sn=Zt.bufferView!==void 0?rR(Zt,an):new fn(Zt.count*mn);const An=Zt.sparse;if(!An)return Sn;const wn=An.count,Mn=vv({},Zt,An.indices,{count:wn,type:"SCALAR"}),Pn=vv({},Zt,An.values,{count:wn}),On=rR(Mn,an),er=rR(Pn,an);for(let Zn=0;Zn<Mn.count;Zn++)for(let yr=0;yr<mn;yr++)Sn[On[Zn]*mn+yr]=er[Zn*mn+yr];return Sn}(At,j))}),_}static validate(i,s){const o=i.json;if(o.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${o.asset.version}".`);if(o.extensionsRequired){for(const c of o.extensionsRequired)if(!s.extensions.find(_=>_.EXTENSION_NAME===c))throw new Error(`Missing required extension, "${c}".`)}if(o.extensionsUsed)for(const c of o.extensionsUsed)s.extensions.find(_=>_.EXTENSION_NAME===c)||s.logger.warn(`Missing optional extension, "${c}".`)}}).read(e,{extensions:Array.from(this.h),dependencies:this.F,logger:this.M})}async binaryToJSON(e){const i=this.P(No.assertView(e));this.j(i);const s=i.json;if(s.buffers&&s.buffers.some(o=>function(c,_){return _.uri!==void 0&&!(_.uri in c.resources)}(i,o)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(o=>function(c,_){return _.uri!==void 0&&!(_.uri in c.resources)&&_.bufferView===void 0}(i,o)))throw new Error("Cannot resolve external images with binaryToJSON().");return i}async readBinary(e){return this.readJSON(await this.binaryToJSON(No.assertView(e)))}async writeJSON(e,i={}){if(i.format===XE.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return(class{static write(s,o){const c=s.getRoot(),_={asset:vv({generator:"glTF-Transform v3.2.1"},c.getAsset()),extras:vv({},c.getExtras())},j={json:_,resources:{}},et=new PA(s,j,o),nt=o.logger||Kv.DEFAULT_INSTANCE,st=new Set(o.extensions.map(bt=>bt.EXTENSION_NAME)),at=s.getRoot().listExtensionsUsed().filter(bt=>st.has(bt.extensionName)),ct=s.getRoot().listExtensionsRequired().filter(bt=>st.has(bt.extensionName));at.length<s.getRoot().listExtensionsUsed().length&&nt.warn("Some extensions were not registered for I/O, and will not be written.");for(const bt of at)for(const At of bt.writeDependencies)bt.install(At,o.dependencies[At]);function dt(bt,At,Pt,Dt){const Nt=[];let Vt=0;for(const an of bt){const fn=et.createAccessorDef(an);fn.bufferView=_.bufferViews.length;const mn=an.getArray(),Sn=No.pad(No.toView(mn));fn.byteOffset=Vt,Vt+=Sn.byteLength,Nt.push(Sn),et.accessorIndexMap.set(an,_.accessors.length),_.accessors.push(fn)}const Zt={buffer:At,byteOffset:Pt,byteLength:No.concat(Nt).byteLength};return Dt&&(Zt.target=Dt),_.bufferViews.push(Zt),{buffers:Nt,byteLength:Vt}}function mt(bt,At,Pt){const Dt=bt[0].getCount();let Nt=0;for(const fn of bt){const mn=et.createAccessorDef(fn);mn.bufferView=_.bufferViews.length,mn.byteOffset=Nt;const Sn=fn.getElementSize(),An=fn.getComponentSize();Nt+=No.padNumber(Sn*An),et.accessorIndexMap.set(fn,_.accessors.length),_.accessors.push(mn)}const Vt=Dt*Nt,Zt=new ArrayBuffer(Vt),an=new DataView(Zt);for(let fn=0;fn<Dt;fn++){let mn=0;for(const Sn of bt){const An=Sn.getElementSize(),wn=Sn.getComponentSize(),Mn=Sn.getComponentType(),Pn=Sn.getArray();for(let On=0;On<An;On++){const er=fn*Nt+mn+On*wn,Zn=Pn[fn*An+On];switch(Mn){case As.ComponentType.FLOAT:an.setFloat32(er,Zn,!0);break;case As.ComponentType.BYTE:an.setInt8(er,Zn);break;case As.ComponentType.SHORT:an.setInt16(er,Zn,!0);break;case As.ComponentType.UNSIGNED_BYTE:an.setUint8(er,Zn);break;case As.ComponentType.UNSIGNED_SHORT:an.setUint16(er,Zn,!0);break;case As.ComponentType.UNSIGNED_INT:an.setUint32(er,Zn,!0);break;default:throw new Error("Unexpected component type: "+Mn)}}mn+=No.padNumber(An*wn)}}return _.bufferViews.push({buffer:At,byteOffset:Pt,byteLength:Vt,byteStride:Nt,target:PA.BufferViewTarget.ARRAY_BUFFER}),{byteLength:Vt,buffers:[new Uint8Array(Zt)]}}function yt(bt,At,Pt){const Dt=[];let Nt=0;const Vt=new Map;let Zt=-1/0;for(const Mn of bt){const Pn=et.createAccessorDef(Mn);_.accessors.push(Pn),et.accessorIndexMap.set(Mn,_.accessors.length-1);const On=[],er=[],Zn=[],yr=new Array(Mn.getElementSize()).fill(0);for(let xr=0,qr=Mn.getCount();xr<qr;xr++)if(Mn.getElement(xr,Zn),!Tu.eq(Zn,yr,0)){Zt=Math.max(xr,Zt),On.push(xr);for(let Zr=0;Zr<Zn.length;Zr++)er.push(Zn[Zr])}const lr=On.length,ar={accessorDef:Pn,count:lr};if(Vt.set(Mn,ar),lr===0)continue;if(lr>Mn.getCount()/3){const xr=(100*On.length/Mn.getCount()).toFixed(1);nt.warn(`Sparse accessor with many non-zero elements (${xr}%) may increase file size.`)}const Mr=$P[Mn.getComponentType()];ar.indices=On,ar.values=new Mr(er)}if(!Number.isFinite(Zt))return{buffers:Dt,byteLength:Nt};const an=Zt<255?Uint8Array:Zt<65535?Uint16Array:Uint32Array,fn=Zt<255?Tz:Zt<65535?Cz:Sz,mn={buffer:At,byteOffset:Pt+Nt,byteLength:0};for(const Mn of bt){const Pn=Vt.get(Mn);if(Pn.count===0)continue;Pn.indicesByteOffset=mn.byteLength;const On=No.pad(No.toView(new an(Pn.indices)));Dt.push(On),Nt+=On.byteLength,mn.byteLength+=On.byteLength}_.bufferViews.push(mn);const Sn=_.bufferViews.length-1,An={buffer:At,byteOffset:Pt+Nt,byteLength:0};for(const Mn of bt){const Pn=Vt.get(Mn);if(Pn.count===0)continue;Pn.valuesByteOffset=An.byteLength;const On=No.pad(No.toView(Pn.values));Dt.push(On),Nt+=On.byteLength,An.byteLength+=On.byteLength}_.bufferViews.push(An);const wn=_.bufferViews.length-1;for(const Mn of bt){const Pn=Vt.get(Mn);Pn.count!==0&&(Pn.accessorDef.sparse={count:Pn.count,indices:{bufferView:Sn,byteOffset:Pn.indicesByteOffset,componentType:fn},values:{bufferView:wn,byteOffset:Pn.valuesByteOffset}})}return{buffers:Dt,byteLength:Nt}}const wt=new Map;for(const bt of s.getGraph().listEdges()){if(bt.getParent()===c)continue;const At=bt.getChild();if(At instanceof As){const Pt=wt.get(At)||[];Pt.push(bt),wt.set(At,Pt)}}if(_.accessors=[],_.bufferViews=[],_.samplers=[],_.textures=[],_.images=c.listTextures().map((bt,At)=>{const Pt=et.createPropertyDef(bt);bt.getMimeType()&&(Pt.mimeType=bt.getMimeType());const Dt=bt.getImage();return Dt&&et.createImageData(Pt,Dt,bt),et.imageIndexMap.set(bt,At),Pt}),at.filter(bt=>bt.prewriteTypes.includes(ts.ACCESSOR)).forEach(bt=>bt.prewrite(et,ts.ACCESSOR)),c.listAccessors().forEach(bt=>{const At=et.accessorUsageGroupedByParent,Pt=et.accessorParents;if(et.accessorIndexMap.has(bt))return;const Dt=wt.get(bt)||[],Nt=et.getAccessorUsage(bt);if(et.addAccessorToUsageGroup(bt,Nt),At.has(Nt)){const Vt=Dt[0].getParent(),Zt=Pt.get(Vt)||new Set;Zt.add(bt),Pt.set(Vt,Zt)}}),at.filter(bt=>bt.prewriteTypes.includes(ts.BUFFER)).forEach(bt=>bt.prewrite(et,ts.BUFFER)),(c.listAccessors().length>0||c.listTextures().length>0||et.otherBufferViews.size>0)&&c.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");_.buffers=[],c.listBuffers().forEach((bt,At)=>{const Pt=et.createPropertyDef(bt),Dt=et.accessorUsageGroupedByParent,Nt=et.accessorParents,Vt=bt.listParents().filter(An=>An instanceof As),Zt=new Set(Vt),an=[],fn=_.buffers.length;let mn=0;const Sn=et.listAccessorUsageGroups();for(const An in Sn)if(Dt.has(An))for(const wn of Array.from(Nt.values())){const Mn=Array.from(wn).filter(Pn=>Zt.has(Pn)).filter(Pn=>et.getAccessorUsage(Pn)===An);if(Mn.length)if(An!==iR.ARRAY_BUFFER||o.vertexLayout===YP.INTERLEAVED){const Pn=An===iR.ARRAY_BUFFER?mt(Mn,fn,mn):dt(Mn,fn,mn);mn+=Pn.byteLength,an.push(...Pn.buffers)}else for(const Pn of Mn){const On=mt([Pn],fn,mn);mn+=On.byteLength,an.push(...On.buffers)}}else{const wn=Sn[An].filter(On=>Zt.has(On));if(!wn.length)continue;const Mn=An===iR.ELEMENT_ARRAY_BUFFER?PA.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,Pn=An===iR.SPARSE?yt(wn,fn,mn):dt(wn,fn,mn,Mn);mn+=Pn.byteLength,an.push(...Pn.buffers)}if(et.imageBufferViews.length&&At===0){for(let An=0;An<et.imageBufferViews.length;An++)if(_.bufferViews[_.images[An].bufferView].byteOffset=mn,mn+=et.imageBufferViews[An].byteLength,an.push(et.imageBufferViews[An]),mn%8){const wn=8-mn%8;mn+=wn,an.push(new Uint8Array(wn))}}if(et.otherBufferViews.has(bt))for(const An of et.otherBufferViews.get(bt))_.bufferViews.push({buffer:fn,byteOffset:mn,byteLength:An.byteLength}),et.otherBufferViewsIndexMap.set(An,_.bufferViews.length-1),mn+=An.byteLength,an.push(An);if(mn){let An;o.format===XE.GLB?An="@glb.bin":(An=et.bufferURIGenerator.createURI(bt,"bin"),Pt.uri=An),Pt.byteLength=mn,j.resources[An]=No.concat(an)}_.buffers.push(Pt),et.bufferIndexMap.set(bt,At)}),c.listAccessors().find(bt=>!bt.getBuffer())&&nt.warn("Skipped writing one or more Accessors: no Buffer assigned."),_.materials=c.listMaterials().map((bt,At)=>{const Pt=et.createPropertyDef(bt);if(bt.getAlphaMode()!==KE.AlphaMode.OPAQUE&&(Pt.alphaMode=bt.getAlphaMode()),bt.getAlphaMode()===KE.AlphaMode.MASK&&(Pt.alphaCutoff=bt.getAlphaCutoff()),bt.getDoubleSided()&&(Pt.doubleSided=!0),Pt.pbrMetallicRoughness={},Tu.eq(bt.getBaseColorFactor(),[1,1,1,1])||(Pt.pbrMetallicRoughness.baseColorFactor=bt.getBaseColorFactor()),Tu.eq(bt.getEmissiveFactor(),[0,0,0])||(Pt.emissiveFactor=bt.getEmissiveFactor()),bt.getRoughnessFactor()!==1&&(Pt.pbrMetallicRoughness.roughnessFactor=bt.getRoughnessFactor()),bt.getMetallicFactor()!==1&&(Pt.pbrMetallicRoughness.metallicFactor=bt.getMetallicFactor()),bt.getBaseColorTexture()){const Dt=bt.getBaseColorTexture(),Nt=bt.getBaseColorTextureInfo();Pt.pbrMetallicRoughness.baseColorTexture=et.createTextureInfoDef(Dt,Nt)}if(bt.getEmissiveTexture()){const Dt=bt.getEmissiveTexture(),Nt=bt.getEmissiveTextureInfo();Pt.emissiveTexture=et.createTextureInfoDef(Dt,Nt)}if(bt.getNormalTexture()){const Dt=bt.getNormalTexture(),Nt=bt.getNormalTextureInfo(),Vt=et.createTextureInfoDef(Dt,Nt);bt.getNormalScale()!==1&&(Vt.scale=bt.getNormalScale()),Pt.normalTexture=Vt}if(bt.getOcclusionTexture()){const Dt=bt.getOcclusionTexture(),Nt=bt.getOcclusionTextureInfo(),Vt=et.createTextureInfoDef(Dt,Nt);bt.getOcclusionStrength()!==1&&(Vt.strength=bt.getOcclusionStrength()),Pt.occlusionTexture=Vt}if(bt.getMetallicRoughnessTexture()){const Dt=bt.getMetallicRoughnessTexture(),Nt=bt.getMetallicRoughnessTextureInfo();Pt.pbrMetallicRoughness.metallicRoughnessTexture=et.createTextureInfoDef(Dt,Nt)}return et.materialIndexMap.set(bt,At),Pt}),_.meshes=c.listMeshes().map((bt,At)=>{const Pt=et.createPropertyDef(bt);let Dt=null;return Pt.primitives=bt.listPrimitives().map(Nt=>{const Vt={attributes:{}};Vt.mode=Nt.getMode();const Zt=Nt.getMaterial();Zt&&(Vt.material=et.materialIndexMap.get(Zt)),Object.keys(Nt.getExtras()).length&&(Vt.extras=Nt.getExtras());const an=Nt.getIndices();an&&(Vt.indices=et.accessorIndexMap.get(an));for(const fn of Nt.listSemantics())Vt.attributes[fn]=et.accessorIndexMap.get(Nt.getAttribute(fn));for(const fn of Nt.listTargets()){const mn={};for(const Sn of fn.listSemantics())mn[Sn]=et.accessorIndexMap.get(fn.getAttribute(Sn));Vt.targets=Vt.targets||[],Vt.targets.push(mn)}return Nt.listTargets().length&&!Dt&&(Dt=Nt.listTargets().map(fn=>fn.getName())),Vt}),bt.getWeights().length&&(Pt.weights=bt.getWeights()),Dt&&(Pt.extras=Pt.extras||{},Pt.extras.targetNames=Dt),et.meshIndexMap.set(bt,At),Pt}),_.cameras=c.listCameras().map((bt,At)=>{const Pt=et.createPropertyDef(bt);if(Pt.type=bt.getType(),Pt.type===$E.Type.PERSPECTIVE){Pt.perspective={znear:bt.getZNear(),zfar:bt.getZFar(),yfov:bt.getYFov()};const Dt=bt.getAspectRatio();Dt!==null&&(Pt.perspective.aspectRatio=Dt)}else Pt.orthographic={znear:bt.getZNear(),zfar:bt.getZFar(),xmag:bt.getXMag(),ymag:bt.getYMag()};return et.cameraIndexMap.set(bt,At),Pt}),_.nodes=c.listNodes().map((bt,At)=>{const Pt=et.createPropertyDef(bt);return Tu.eq(bt.getTranslation(),[0,0,0])||(Pt.translation=bt.getTranslation()),Tu.eq(bt.getRotation(),[0,0,0,1])||(Pt.rotation=bt.getRotation()),Tu.eq(bt.getScale(),[1,1,1])||(Pt.scale=bt.getScale()),bt.getWeights().length&&(Pt.weights=bt.getWeights()),et.nodeIndexMap.set(bt,At),Pt}),_.skins=c.listSkins().map((bt,At)=>{const Pt=et.createPropertyDef(bt),Dt=bt.getInverseBindMatrices();Dt&&(Pt.inverseBindMatrices=et.accessorIndexMap.get(Dt));const Nt=bt.getSkeleton();return Nt&&(Pt.skeleton=et.nodeIndexMap.get(Nt)),Pt.joints=bt.listJoints().map(Vt=>et.nodeIndexMap.get(Vt)),et.skinIndexMap.set(bt,At),Pt}),c.listNodes().forEach((bt,At)=>{const Pt=_.nodes[At],Dt=bt.getMesh();Dt&&(Pt.mesh=et.meshIndexMap.get(Dt));const Nt=bt.getCamera();Nt&&(Pt.camera=et.cameraIndexMap.get(Nt));const Vt=bt.getSkin();Vt&&(Pt.skin=et.skinIndexMap.get(Vt)),bt.listChildren().length>0&&(Pt.children=bt.listChildren().map(Zt=>et.nodeIndexMap.get(Zt)))}),_.animations=c.listAnimations().map((bt,At)=>{const Pt=et.createPropertyDef(bt),Dt=new Map;return Pt.samplers=bt.listSamplers().map((Nt,Vt)=>{const Zt=et.createPropertyDef(Nt);return Zt.input=et.accessorIndexMap.get(Nt.getInput()),Zt.output=et.accessorIndexMap.get(Nt.getOutput()),Zt.interpolation=Nt.getInterpolation(),Dt.set(Nt,Vt),Zt}),Pt.channels=bt.listChannels().map(Nt=>{const Vt=et.createPropertyDef(Nt);return Vt.sampler=Dt.get(Nt.getSampler()),Vt.target={node:et.nodeIndexMap.get(Nt.getTargetNode()),path:Nt.getTargetPath()},Vt}),et.animationIndexMap.set(bt,At),Pt}),_.scenes=c.listScenes().map((bt,At)=>{const Pt=et.createPropertyDef(bt);return Pt.nodes=bt.listChildren().map(Dt=>et.nodeIndexMap.get(Dt)),et.sceneIndexMap.set(bt,At),Pt});const Ct=c.getDefaultScene();return Ct&&(_.scene=c.listScenes().indexOf(Ct)),_.extensionsUsed=at.map(bt=>bt.extensionName),_.extensionsRequired=ct.map(bt=>bt.extensionName),at.forEach(bt=>bt.write(et)),function(bt){const At=[];for(const Pt in bt){const Dt=bt[Pt];(Array.isArray(Dt)&&Dt.length===0||Dt===null||Dt===""||Dt&&typeof Dt=="object"&&Object.keys(Dt).length===0)&&At.push(Pt)}for(const Pt of At)delete bt[Pt]}(_),j}}).write(e,{format:i.format||XE.GLTF,basename:i.basename||"",logger:this.M,vertexLayout:this.U,dependencies:vv({},this.F),extensions:Array.from(this.h)})}async writeBinary(e){const{json:i,resources:s}=await this.writeJSON(e,{format:XE.GLB}),o=new Uint32Array([1179937895,2,12]),c=JSON.stringify(i),_=No.pad(No.encodeText(c),32),j=No.toView(new Uint32Array([_.byteLength,1313821514])),et=No.concat([j,_]);o[o.length-1]+=et.byteLength;const nt=Object.values(s)[0];if(!nt||!nt.byteLength)return No.concat([No.toView(o),et]);const st=No.pad(nt,0),at=No.toView(new Uint32Array([st.byteLength,5130562])),ct=No.concat([at,st]);return o[o.length-1]+=ct.byteLength,No.concat([No.toView(o),et,ct])}async L(e,i){var s=this;const o=[...e.json.images||[],...e.json.buffers||[]].map(async function(c){const _=c.uri;if(!_||_.match(/data:/))return Promise.resolve();e.resources[_]=await s.readURI(s.resolve(i,_),"view"),s.lastReadBytes+=e.resources[_].byteLength});await Promise.all(o)}j(e){function i(s){if(s.uri){if(s.uri in e.resources)No.assertView(e.resources[s.uri]);else if(s.uri.match(/data:/)){const o=`__${function(){for(let c=0;c<999;c++){const _=Az();if(!M3.has(_))return M3.add(_),_}return""}()}.${rT.extension(s.uri)}`;e.resources[o]=No.createBufferFromDataURI(s.uri),s.uri=o}}}(e.json.images||[]).forEach(s=>{if(s.bufferView===void 0&&s.uri===void 0)throw new Error("Missing resource URI or buffer view.");i(s)}),(e.json.buffers||[]).forEach(i)}D(e){const{images:i,buffers:s}=e.json;return e={json:vv({},e.json),resources:vv({},e.resources)},i&&(e.json.images=i.map(o=>vv({},o))),s&&(e.json.buffers=s.map(o=>vv({},o))),e}P(e){if(!F3(e))throw new Error("Invalid glTF 2.0 binary.");const i=new Uint32Array(e.buffer,e.byteOffset+12,2);if(i[1]!==sR.JSON)throw new Error("Missing required GLB JSON chunk.");const s=i[0],o=No.decodeText(No.toView(e,20,s)),c=JSON.parse(o),_=20+s;if(e.byteLength<=_)return{json:c,resources:{}};const j=new Uint32Array(e.buffer,e.byteOffset+_,2);if(j[1]!==sR.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:c,resources:{"@glb.bin":No.toView(e,_+8,j[0])}}}}function F3(h){if(h.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(h.buffer,h.byteOffset,3);return e[0]===1179937895&&e[1]===2}class Iz extends Mz{constructor(e=fI.DEFAULT_INIT){super(),this.k=void 0,this.k=e}async readURI(e,i){const s=await fetch(e,this.k);switch(i){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}resolve(e,i){return fI.resolve(e,i)}dirname(e){return fI.dirname(e)}}const Pz=64;class Rz{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class gI{constructor(e,i,s,o){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=o,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let o=0;for(;this._dataView.getUint8(this._offset)!==i&&o<e;)o++,this._offset++;return o<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,o)}}const U_=[171,75,84,88,32,50,48,187,13,10,26,10];function j3(h){return typeof TextDecoder<"u"?new TextDecoder().decode(h):Buffer.from(h).toString("utf8")}function xB(h){const e=new Uint8Array(h.buffer,h.byteOffset,U_.length);if(e[0]!==U_[0]||e[1]!==U_[1]||e[2]!==U_[2]||e[3]!==U_[3]||e[4]!==U_[4]||e[5]!==U_[5]||e[6]!==U_[6]||e[7]!==U_[7]||e[8]!==U_[8]||e[9]!==U_[9]||e[10]!==U_[10]||e[11]!==U_[11])throw new Error("Missing KTX 2.0 identifier.");const i=new Rz,s=17*Uint32Array.BYTES_PER_ELEMENT,o=new gI(h,U_.length,s,!0);i.vkFormat=o._nextUint32(),i.typeSize=o._nextUint32(),i.pixelWidth=o._nextUint32(),i.pixelHeight=o._nextUint32(),i.pixelDepth=o._nextUint32(),i.layerCount=o._nextUint32(),i.faceCount=o._nextUint32();const c=o._nextUint32();i.supercompressionScheme=o._nextUint32();const _=o._nextUint32(),j=o._nextUint32(),et=o._nextUint32(),nt=o._nextUint32(),st=o._nextUint64(),at=o._nextUint64(),ct=3*c*8,dt=new gI(h,U_.length+s,ct,!0);for(let er=0;er<c;er++)i.levels.push({levelData:new Uint8Array(h.buffer,h.byteOffset+dt._nextUint64(),dt._nextUint64()),uncompressedByteLength:dt._nextUint64()});const mt=new gI(h,_,j,!0),yt={vendorId:mt._skip(4)._nextUint16(),descriptorType:mt._nextUint16(),versionNumber:mt._nextUint16(),descriptorBlockSize:mt._nextUint16(),colorModel:mt._nextUint8(),colorPrimaries:mt._nextUint8(),transferFunction:mt._nextUint8(),flags:mt._nextUint8(),texelBlockDimension:[mt._nextUint8(),mt._nextUint8(),mt._nextUint8(),mt._nextUint8()],bytesPlane:[mt._nextUint8(),mt._nextUint8(),mt._nextUint8(),mt._nextUint8(),mt._nextUint8(),mt._nextUint8(),mt._nextUint8(),mt._nextUint8()],samples:[]},wt=(yt.descriptorBlockSize/4-6)/4;for(let er=0;er<wt;er++){const Zn={bitOffset:mt._nextUint16(),bitLength:mt._nextUint8(),channelType:mt._nextUint8(),samplePosition:[mt._nextUint8(),mt._nextUint8(),mt._nextUint8(),mt._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};Zn.channelType&Pz?(Zn.sampleLower=mt._nextInt32(),Zn.sampleUpper=mt._nextInt32()):(Zn.sampleLower=mt._nextUint32(),Zn.sampleUpper=mt._nextUint32()),yt.samples[er]=Zn}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(yt);const Ct=new gI(h,et,nt,!0);for(;Ct._offset<nt;){const er=Ct._nextUint32(),Zn=Ct._scan(er),yr=j3(Zn),lr=Ct._scan(er-Zn.byteLength);i.keyValue[yr]=yr.match(/^ktx/i)?j3(lr):lr,Ct._offset%4&&Ct._skip(4-Ct._offset%4)}if(at<=0)return i;const bt=new gI(h,st,at,!0),At=bt._nextUint16(),Pt=bt._nextUint16(),Dt=bt._nextUint32(),Nt=bt._nextUint32(),Vt=bt._nextUint32(),Zt=bt._nextUint32(),an=[];for(let er=0;er<c;er++)an.push({imageFlags:bt._nextUint32(),rgbSliceByteOffset:bt._nextUint32(),rgbSliceByteLength:bt._nextUint32(),alphaSliceByteOffset:bt._nextUint32(),alphaSliceByteLength:bt._nextUint32()});const fn=st+bt._offset,mn=fn+Dt,Sn=mn+Nt,An=Sn+Vt,wn=new Uint8Array(h.buffer,h.byteOffset+fn,Dt),Mn=new Uint8Array(h.buffer,h.byteOffset+mn,Nt),Pn=new Uint8Array(h.buffer,h.byteOffset+Sn,Vt),On=new Uint8Array(h.buffer,h.byteOffset+An,Zt);return i.globalData={endpointCount:At,selectorCount:Pt,imageDescs:an,endpointsData:wn,selectorsData:Mn,tablesData:Pn,extendedData:On},i}class z3 extends gp{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[ts.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}z3.EXTENSION_NAME="EXT_mesh_gpu_instancing";const ZE="EXT_mesh_gpu_instancing";class V3 extends Bu{constructor(...e){super(...e),this.extensionName=ZE,this.provideTypes=[ts.NODE],this.prewriteTypes=[ts.ACCESSOR]}createInstancedMesh(){return new z3(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((i,s)=>{if(!i.extensions||!i.extensions[ZE])return;const o=i.extensions[ZE],c=this.createInstancedMesh();for(const _ in o.attributes)c.setAttribute(_,e.accessors[o.attributes[_]]);e.nodes[s].setExtension(ZE,c)}),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const i of this.properties)for(const s of i.listAttributes())e.addAccessorToUsageGroup(s,"INSTANCE_ATTRIBUTE");return this}write(e){const i=e.jsonDoc;return this.document.getRoot().listNodes().forEach(s=>{const o=s.getExtension(ZE);if(o){const c=e.nodeIndexMap.get(s),_=i.json.nodes[c],j={attributes:{}};o.listSemantics().forEach(et=>{const nt=o.getAttribute(et);j.attributes[et]=e.accessorIndexMap.get(nt)}),_.extensions=_.extensions||{},_.extensions[ZE]=j}}),this}}function w1(){return(w1=Object.assign||function(h){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(h[s]=i[s])}return h}).apply(this,arguments)}var _I,oT,Mp;V3.EXTENSION_NAME=ZE,function(h){h.QUANTIZE="quantize",h.FILTER="filter"}(_I||(_I={})),function(h){h.ATTRIBUTES="ATTRIBUTES",h.TRIANGLES="TRIANGLES",h.INDICES="INDICES"}(oT||(oT={})),function(h){h.NONE="NONE",h.OCTAHEDRAL="OCTAHEDRAL",h.QUATERNION="QUATERNION",h.EXPONENTIAL="EXPONENTIAL"}(Mp||(Mp={}));const{BYTE:Dz,SHORT:G3,FLOAT:kz}=As.ComponentType,{encodeNormalizedInt:H3,decodeNormalizedInt:EB}=Tu;function Oz(h,e,i,s){const{filter:o,bits:c}=s,_={array:h.getArray(),byteStride:h.getElementSize()*h.getComponentSize(),componentType:h.getComponentType(),normalized:h.getNormalized()};if(i!==oT.ATTRIBUTES)return _;if(o!==Mp.NONE){let j=h.getNormalized()?function(et){const nt=et.getComponentType(),st=et.getArray(),at=new Float32Array(st.length);for(let ct=0;ct<st.length;ct++)at[ct]=EB(st[ct],nt);return at}(h):new Float32Array(_.array);switch(o){case Mp.EXPONENTIAL:_.byteStride=4*h.getElementSize(),_.componentType=kz,_.normalized=!1,_.array=e.encodeFilterExp(j,h.getCount(),_.byteStride,c);break;case Mp.OCTAHEDRAL:_.byteStride=c>8?8:4,_.componentType=c>8?G3:Dz,_.normalized=!0,j=h.getElementSize()===3?function(et){const nt=new Float32Array(4*et.length/3);for(let st=0,at=et.length/3;st<at;st++)nt[4*st]=et[3*st],nt[4*st+1]=et[3*st+1],nt[4*st+2]=et[3*st+2];return nt}(j):j,_.array=e.encodeFilterOct(j,h.getCount(),_.byteStride,c);break;case Mp.QUATERNION:_.byteStride=8,_.componentType=G3,_.normalized=!0,_.array=e.encodeFilterQuat(j,h.getCount(),_.byteStride,c);break;default:throw new Error("Invalid filter.")}_.min=h.getMin([]),_.max=h.getMax([]),h.getNormalized()&&(_.min=_.min.map(et=>EB(et,h.getComponentType())),_.max=_.max.map(et=>EB(et,h.getComponentType()))),_.normalized&&(_.min=_.min.map(et=>H3(et,_.componentType)),_.max=_.max.map(et=>H3(et,_.componentType)))}else _.byteStride%4&&(_.array=function(j,et){const nt=No.padNumber(j.BYTES_PER_ELEMENT*et)/j.BYTES_PER_ELEMENT,st=new j.constructor(j.length/et*nt);for(let at=0;at*et<j.length;at++)for(let ct=0;ct<et;ct++)st[at*nt+ct]=j[at*et+ct];return st}(_.array,h.getElementSize()),_.byteStride=_.array.byteLength/h.getCount());return _}function Bz(h,e){return e===PA.BufferViewUsage.ELEMENT_ARRAY_BUFFER?h.listParents().some(i=>i instanceof JE&&i.getMode()===JE.Mode.TRIANGLES)?oT.TRIANGLES:oT.INDICES:oT.ATTRIBUTES}function Lz(h,e){const i=e.getGraph().listParentEdges(h).filter(s=>!(s.getParent()instanceof L3));for(const s of i){const o=s.getName(),c=s.getAttributes().key||"";if(o==="indices")return{filter:Mp.NONE};if(o==="attributes"){if(c==="POSITION")return{filter:Mp.NONE};if(c==="TEXCOORD_0")return{filter:Mp.NONE};if(c==="NORMAL")return{filter:Mp.OCTAHEDRAL,bits:8};if(c==="TANGENT")return{filter:Mp.OCTAHEDRAL,bits:8};if(c.startsWith("JOINTS_"))return{filter:Mp.NONE};if(c.startsWith("WEIGHTS_"))return{filter:Mp.NONE}}if(o==="output"){const _=Q3(h);return _==="rotation"?{filter:Mp.QUATERNION,bits:16}:_==="translation"||_==="scale"?{filter:Mp.EXPONENTIAL,bits:12}:{filter:Mp.NONE}}if(o==="input")return{filter:Mp.NONE};if(o==="inverseBindMatrices")return{filter:Mp.NONE}}return{filter:Mp.NONE}}function Q3(h){for(const e of h.listParents())if(e instanceof iT){for(const i of e.listParents())if(i instanceof wB)return i.getTargetPath()}return null}const F_="EXT_meshopt_compression",W3={method:_I.QUANTIZE};class SB extends Bu{constructor(...e){super(...e),this.extensionName=F_,this.prereadTypes=[ts.BUFFER,ts.PRIMITIVE],this.prewriteTypes=[ts.BUFFER,ts.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=W3,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,i){return e==="meshopt.decoder"&&(this._decoder=i),e==="meshopt.encoder"&&(this._encoder=i),this}setEncoderOptions(e){return this._encoderOptions=w1({},W3,e),this}preread(e,i){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${F_}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${F_}]: Missing WASM support.`)}return i===ts.BUFFER?this._prereadBuffers(e):i===ts.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach((s,o)=>{if(!s.extensions||!s.extensions[F_])return;const c=s.extensions[F_],_=c.byteOffset||0,j=c.byteLength||0,et=c.count,nt=c.byteStride,st=new Uint8Array(et*nt),at=i.json.buffers[c.buffer],ct=No.toView(at.uri?i.resources[at.uri]:i.resources[x3],_,j);this._decoder.decodeGltfBuffer(st,et,nt,ct,c.mode,c.filter),e.bufferViews[o]=st})}_prereadPrimitives(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach(s=>{var o;s.extensions&&s.extensions[F_]&&(o=i.json.buffers[s.buffer]).extensions&&o.extensions.EXT_meshopt_compression&&o.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[s.buffer],e.buffers[s.extensions[F_].buffer])})}read(e){if(!this.isRequired())return this;for(const[i,s]of this._decoderFallbackBufferMap){for(const o of i.listParents())o instanceof As&&o.swap(i,s);i.dispose()}return this}prewrite(e,i){return i===ts.ACCESSOR?this._prewriteAccessors(e):i===ts.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const i=e.jsonDoc.json,s=this._encoder,o=this._encoderOptions,c=this.document.createBuffer(),_=this.document.getRoot().listBuffers().indexOf(c);this._encoderFallbackBuffer=c,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const j of this.document.getRoot().listAccessors()){if(Q3(j)==="weights"||j.getSparse())continue;const et=e.getAccessorUsage(j),nt=Bz(j,et),st=o.method===_I.FILTER?Lz(j,this.document):{filter:Mp.NONE},at=Oz(j,s,nt,st),{array:ct,byteStride:dt}=at,mt=j.getBuffer();if(!mt)throw new Error(`${F_}: Missing buffer for accessor.`);const yt=this.document.getRoot().listBuffers().indexOf(mt),wt=[et,nt,st.filter,dt,yt].join(":");let Ct=this._encoderBufferViews[wt],bt=this._encoderBufferViewData[wt],At=this._encoderBufferViewAccessors[wt];Ct&&bt||(At=this._encoderBufferViewAccessors[wt]=[],bt=this._encoderBufferViewData[wt]=[],Ct=this._encoderBufferViews[wt]={buffer:_,target:PA.USAGE_TO_TARGET[et],byteOffset:0,byteLength:0,byteStride:et===PA.BufferViewUsage.ARRAY_BUFFER?dt:void 0,extensions:{[F_]:{buffer:yt,byteOffset:0,byteLength:0,mode:nt,filter:st.filter!==Mp.NONE?st.filter:void 0,byteStride:dt,count:0}}});const Pt=e.createAccessorDef(j);Pt.componentType=at.componentType,Pt.normalized=at.normalized,Pt.byteOffset=Ct.byteLength,Pt.min&&at.min&&(Pt.min=at.min),Pt.max&&at.max&&(Pt.max=at.max),e.accessorIndexMap.set(j,i.accessors.length),i.accessors.push(Pt),At.push(Pt),bt.push(new Uint8Array(ct.buffer,ct.byteOffset,ct.byteLength)),Ct.byteLength+=ct.byteLength,Ct.extensions.EXT_meshopt_compression.count+=j.getCount()}}_prewriteBuffers(e){const i=this._encoder;for(const s in this._encoderBufferViews){const o=this._encoderBufferViews[s],c=this._encoderBufferViewData[s],_=this.document.getRoot().listBuffers()[o.extensions[F_].buffer],j=e.otherBufferViews.get(_)||[],{count:et,byteStride:nt,mode:st}=o.extensions[F_],at=No.concat(c),ct=i.encodeGltfBuffer(at,et,nt,st),dt=No.pad(ct);o.extensions[F_].byteLength=ct.byteLength,c.length=0,c.push(dt),j.push(dt),e.otherBufferViews.set(_,j)}}write(e){let i=0;for(const _ in this._encoderBufferViews){const j=this._encoderBufferViews[_],et=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[_][0]),nt=this._encoderBufferViewAccessors[_];for(const ct of nt)ct.bufferView=et;const st=e.jsonDoc.json.bufferViews[et],at=st.byteOffset||0;Object.assign(st,j),st.byteOffset=i,st.extensions[F_].byteOffset=at,i+=No.padNumber(j.byteLength)}const s=this._encoderFallbackBuffer,o=e.bufferIndexMap.get(s),c=e.jsonDoc.json.buffers[o];return c.byteLength=i,c.extensions={[F_]:{fallback:!0}},s.dispose(),this}}SB.EXTENSION_NAME=F_,SB.EncoderMethod=_I;const vI="EXT_texture_avif";class Nz{match(e){return e.length>=12&&No.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const i=new DataView(e.buffer,e.byteOffset,e.byteLength);let s=X3(i,0);if(!s)return null;let o=s.end;for(;s=X3(i,o);)if(s.type==="meta")o=s.start+4;else if(s.type==="iprp"||s.type==="ipco")o=s.start;else{if(s.type==="ispe")return[i.getUint32(s.start+4),i.getUint32(s.start+8)];if(s.type==="mdat")break;o=s.end}return null}getChannels(e){return 4}}class q3 extends Bu{constructor(...e){super(...e),this.extensionName=vI,this.prereadTypes=[ts.TEXTURE]}static register(){IA.registerFormat("image/avif",new Nz)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(i=>{i.extensions&&i.extensions[vI]&&(i.source=i.extensions[vI].source)}),this}read(e){return this}write(e){const i=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/avif"){const o=e.imageIndexMap.get(s);(i.json.textures||[]).forEach(c=>{c.source===o&&(c.extensions=c.extensions||{},c.extensions[vI]={source:c.source},delete c.source)})}}),this}}function X3(h,e){if(h.byteLength<4+e)return null;const i=h.getUint32(e);return h.byteLength<i+e||i<8?null:{type:No.decodeText(new Uint8Array(h.buffer,h.byteOffset+e+4,4)),start:e+8,end:e+i}}q3.EXTENSION_NAME=vI;const yI="EXT_texture_webp";class Uz{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const i=No.decodeText(e.slice(0,4)),s=No.decodeText(e.slice(8,12));if(i!=="RIFF"||s!=="WEBP")return null;const o=new DataView(e.buffer,e.byteOffset);let c=12;for(;c<o.byteLength;){const _=No.decodeText(new Uint8Array([o.getUint8(c),o.getUint8(c+1),o.getUint8(c+2),o.getUint8(c+3)])),j=o.getUint32(c+4,!0);if(_==="VP8 ")return[16383&o.getInt16(c+14,!0),16383&o.getInt16(c+16,!0)];if(_==="VP8L"){const et=o.getUint8(c+9),nt=o.getUint8(c+10),st=o.getUint8(c+11);return[1+((63&nt)<<8|et),1+((15&o.getUint8(c+12))<<10|st<<2|(192&nt)>>6)]}c+=8+j+j%2}return null}getChannels(e){return 4}}class Y3 extends Bu{constructor(...e){super(...e),this.extensionName=yI,this.prereadTypes=[ts.TEXTURE]}static register(){IA.registerFormat("image/webp",new Uz)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(i=>{i.extensions&&i.extensions[yI]&&(i.source=i.extensions[yI].source)}),this}read(e){return this}write(e){const i=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/webp"){const o=e.imageIndexMap.get(s);(i.json.textures||[]).forEach(c=>{c.source===o&&(c.extensions=c.extensions||{},c.extensions[yI]={source:c.source},delete c.source)})}}),this}}Y3.EXTENSION_NAME=yI;const $3="KHR_draco_mesh_compression";let cm,K3,J3,yv;function Fz(h,e){const i=new cm.DecoderBuffer;try{if(i.Init(e,e.length),h.GetEncodedGeometryType(i)!==cm.TRIANGULAR_MESH)throw new Error(`[${$3}] Unknown geometry type.`);const s=new cm.Mesh;if(!h.DecodeBufferToMesh(i,s).ok()||s.ptr===0)throw new Error(`[${$3}] Decoding failure.`);return s}finally{cm.destroy(i)}}function jz(h,e){const i=3*e.num_faces();let s,o;if(e.num_points()<=65534){const c=i*Uint16Array.BYTES_PER_ELEMENT;s=cm._malloc(c),h.GetTrianglesUInt16Array(e,c,s),o=new Uint16Array(cm.HEAPU16.buffer,s,i).slice()}else{const c=i*Uint32Array.BYTES_PER_ELEMENT;s=cm._malloc(c),h.GetTrianglesUInt32Array(e,c,s),o=new Uint32Array(cm.HEAPU32.buffer,s,i).slice()}return cm._free(s),o}function zz(h,e,i,s){const o=J3[s.componentType],c=K3[s.componentType],_=i.num_components(),j=e.num_points()*_,et=j*c.BYTES_PER_ELEMENT,nt=cm._malloc(et);h.GetAttributeDataArrayForAllPoints(e,i,o,et,nt);const st=new c(cm.HEAPF32.buffer,nt,j).slice();return cm._free(nt),st}var AI,I0;(function(h){h[h.EDGEBREAKER=1]="EDGEBREAKER",h[h.SEQUENTIAL=0]="SEQUENTIAL"})(AI||(AI={})),function(h){h.POSITION="POSITION",h.NORMAL="NORMAL",h.COLOR="COLOR",h.TEX_COORD="TEX_COORD",h.GENERIC="GENERIC"}(I0||(I0={}));const Z3={[I0.POSITION]:14,[I0.NORMAL]:10,[I0.COLOR]:8,[I0.TEX_COORD]:12,[I0.GENERIC]:12},eN={decodeSpeed:5,encodeSpeed:5,method:AI.EDGEBREAKER,quantizationBits:Z3,quantizationVolume:"mesh"};function Vz(h,e=eN){const i=w1({},eN,e);i.quantizationBits=w1({},Z3,e.quantizationBits);const s=new yv.Encoder,o=new yv.MeshBuilder,c=new yv.Mesh,_={},j=new yv.DracoInt8Array,et=h.listTargets().length>0;let nt=!1;for(const wt of h.listSemantics()){const Ct=h.getAttribute(wt);if(Ct.getSparse()){nt=!0;continue}const bt=Gz(wt),At=Hz(o,Ct.getComponentType(),c,yv[bt],Ct.getCount(),Ct.getElementSize(),Ct.getArray());if(At===-1)throw new Error(`Error compressing "${wt}" attribute.`);if(_[wt]=At,i.quantizationVolume==="mesh"||wt!=="POSITION")s.SetAttributeQuantization(yv[bt],i.quantizationBits[bt]);else{if(typeof i.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:Pt}=i,Dt=Math.max(Pt.max[0]-Pt.min[0],Pt.max[1]-Pt.min[1],Pt.max[2]-Pt.min[2]);s.SetAttributeExplicitQuantization(yv[bt],i.quantizationBits[bt],Ct.getElementSize(),Pt.min,Dt)}}}const st=h.getIndices();if(!st)throw new oR("Primitive must have indices.");o.AddFacesToMesh(c,st.getCount()/3,st.getArray()),s.SetSpeedOptions(i.encodeSpeed,i.decodeSpeed),s.SetTrackEncodedProperties(!0),s.SetEncodingMethod(i.method===AI.SEQUENTIAL||et||nt?yv.MESH_SEQUENTIAL_ENCODING:yv.MESH_EDGEBREAKER_ENCODING);const at=s.EncodeMeshToDracoBuffer(c,j);if(at<=0)throw new oR("Error applying Draco compression.");const ct=new Uint8Array(at);for(let wt=0;wt<at;++wt)ct[wt]=j.GetValue(wt);const dt=h.getAttribute("POSITION").getCount(),mt=s.GetNumberOfEncodedPoints(),yt=3*s.GetNumberOfEncodedFaces();if((et||nt)&&mt!==dt)throw new oR('Compression reduced vertex count unexpectedly, corrupting mesh data. Applying the "weld" function before compression may resolve the issue. See: https://github.com/google/draco/issues/929');return yv.destroy(j),yv.destroy(c),yv.destroy(o),yv.destroy(s),{numVertices:mt,numIndices:yt,data:ct,attributeIDs:_}}function Gz(h){return h==="POSITION"?I0.POSITION:h==="NORMAL"?I0.NORMAL:h.startsWith("COLOR_")?I0.COLOR:h.startsWith("TEXCOORD_")?I0.TEX_COORD:I0.GENERIC}function Hz(h,e,i,s,o,c,_){switch(e){case As.ComponentType.UNSIGNED_BYTE:return h.AddUInt8Attribute(i,s,o,c,_);case As.ComponentType.BYTE:return h.AddInt8Attribute(i,s,o,c,_);case As.ComponentType.UNSIGNED_SHORT:return h.AddUInt16Attribute(i,s,o,c,_);case As.ComponentType.SHORT:return h.AddInt16Attribute(i,s,o,c,_);case As.ComponentType.UNSIGNED_INT:return h.AddUInt32Attribute(i,s,o,c,_);case As.ComponentType.FLOAT:return h.AddFloatAttribute(i,s,o,c,_);default:throw new Error(`Unexpected component type, "${e}".`)}}class oR extends Error{}const Ip="KHR_draco_mesh_compression";class bI extends Bu{constructor(...e){super(...e),this.extensionName=Ip,this.prereadTypes=[ts.PRIMITIVE],this.prewriteTypes=[ts.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,i){return e==="draco3d.decoder"&&(this._decoderModule=i,cm=this._decoderModule,K3={[As.ComponentType.FLOAT]:Float32Array,[As.ComponentType.UNSIGNED_INT]:Uint32Array,[As.ComponentType.UNSIGNED_SHORT]:Uint16Array,[As.ComponentType.UNSIGNED_BYTE]:Uint8Array,[As.ComponentType.SHORT]:Int16Array,[As.ComponentType.BYTE]:Int8Array},J3={[As.ComponentType.FLOAT]:cm.DT_FLOAT32,[As.ComponentType.UNSIGNED_INT]:cm.DT_UINT32,[As.ComponentType.UNSIGNED_SHORT]:cm.DT_UINT16,[As.ComponentType.UNSIGNED_BYTE]:cm.DT_UINT8,[As.ComponentType.SHORT]:cm.DT_INT16,[As.ComponentType.BYTE]:cm.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=i,yv=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Ip}] Please install extension dependency, "draco3d.decoder".`);const i=this.document.getLogger(),s=e.jsonDoc,o=new Map;try{const c=s.json.meshes||[];for(const _ of c)for(const j of _.primitives){if(!j.extensions||!j.extensions[Ip])continue;const et=j.extensions[Ip];let[nt,st]=o.get(et.bufferView)||[];if(!st||!nt){const at=s.json.bufferViews[et.bufferView],ct=s.json.buffers[at.buffer],dt=No.toView(ct.uri?s.resources[ct.uri]:s.resources[x3],at.byteOffset||0,at.byteLength);nt=new this._decoderModule.Decoder,st=Fz(nt,dt),o.set(et.bufferView,[nt,st]),i.debug(`[${Ip}] Decompressed ${dt.byteLength} bytes.`)}for(const at in j.attributes){const ct=e.jsonDoc.json.accessors[j.attributes[at]],dt=nt.GetAttributeByUniqueId(st,et.attributes[at]),mt=zz(nt,st,dt,ct);e.accessors[j.attributes[at]].setArray(mt)}j.indices!==void 0&&e.accessors[j.indices].setArray(jz(nt,st))}}finally{for(const[c,_]of Array.from(o.values()))this._decoderModule.destroy(c),this._decoderModule.destroy(_)}return this}read(e){return this}prewrite(e,i){if(!this._encoderModule)throw new Error(`[${Ip}] Please install extension dependency, "draco3d.encoder".`);const s=this.document.getLogger();s.debug(`[${Ip}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const o=function(j){const et=j.getLogger(),nt=new Set,st=new Set;for(const wt of j.getRoot().listMeshes())for(const Ct of wt.listPrimitives())Ct.getIndices()?Ct.getMode()!==JE.Mode.TRIANGLES?(st.add(Ct),et.warn(`[${Ip}] Skipping Draco compression on non-TRIANGLES primitive.`)):nt.add(Ct):(st.add(Ct),et.warn(`[${Ip}] Skipping Draco compression on non-indexed primitive.`));const at=j.getRoot().listAccessors(),ct=new Map;for(let wt=0;wt<at.length;wt++)ct.set(at[wt],wt);const dt=new Map,mt=new Set,yt=new Map;for(const wt of Array.from(nt)){let Ct=tN(wt,ct);if(mt.has(Ct))yt.set(wt,Ct);else{if(dt.has(wt.getIndices())){const bt=wt.getIndices(),At=bt.clone();ct.set(At,j.getRoot().listAccessors().length-1),wt.swap(bt,At)}for(const bt of wt.listAttributes())if(dt.has(bt)){const At=bt.clone();ct.set(At,j.getRoot().listAccessors().length-1),wt.swap(bt,At)}Ct=tN(wt,ct),mt.add(Ct),yt.set(wt,Ct),dt.set(wt.getIndices(),Ct);for(const bt of wt.listAttributes())dt.set(bt,Ct)}}for(const wt of Array.from(dt.keys())){const Ct=new Set(wt.listParents().map(bt=>bt.propertyType));if(Ct.size!==2||!Ct.has(ts.PRIMITIVE)||!Ct.has(ts.ROOT))throw new Error(`[${Ip}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const wt of Array.from(nt)){const Ct=yt.get(wt),bt=wt.getIndices();if(dt.get(bt)!==Ct||wt.listAttributes().some(At=>dt.get(At)!==Ct))throw new Error(`[${Ip}] Draco primitives must share all, or no, accessors.`)}for(const wt of Array.from(st)){const Ct=wt.getIndices();if(dt.has(Ct)||wt.listAttributes().some(bt=>dt.has(bt)))throw new Error(`[${Ip}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return yt}(this.document),c=new Map;let _="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?s.warn(`[${Ip}]: quantizationVolume=scene requires exactly 1 scene.`):_=function(j){const et={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},nt=j.propertyType===ts.NODE?[j]:j.listChildren();for(const st of nt)st.traverse(at=>{const ct=at.getMesh();if(!ct)return;const dt=fz(ct,at.getWorldMatrix());AB(dt.min,et),AB(dt.max,et)});return et}(this.document.getRoot().listScenes().pop()));for(const j of Array.from(o.keys())){const et=o.get(j);if(!et)throw new Error("Unexpected primitive.");if(c.has(et)){c.set(et,c.get(et));continue}const nt=j.getIndices(),st=e.jsonDoc.json.accessors;let at;try{at=Vz(j,w1({},this._encoderOptions,{quantizationVolume:_}))}catch(mt){if(mt instanceof oR){s.warn(`[${Ip}]: ${mt.message} Skipping primitive compression.`);continue}throw mt}c.set(et,at);const ct=e.createAccessorDef(nt);ct.count=at.numIndices,e.accessorIndexMap.set(nt,st.length),st.push(ct);for(const mt of j.listSemantics()){const yt=j.getAttribute(mt);if(at.attributeIDs[mt]===void 0)continue;const wt=e.createAccessorDef(yt);wt.count=at.numVertices,e.accessorIndexMap.set(yt,st.length),st.push(wt)}const dt=j.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(dt)||e.otherBufferViews.set(dt,[]),e.otherBufferViews.get(dt).push(at.data)}return s.debug(`[${Ip}] Compressed ${o.size} primitives.`),e.extensionData[Ip]={primitiveHashMap:o,primitiveEncodingMap:c},this}write(e){const i=e.extensionData[Ip];for(const s of this.document.getRoot().listMeshes()){const o=e.jsonDoc.json.meshes[e.meshIndexMap.get(s)];for(let c=0;c<s.listPrimitives().length;c++){const _=s.listPrimitives()[c],j=o.primitives[c],et=i.primitiveHashMap.get(_);if(!et)continue;const nt=i.primitiveEncodingMap.get(et);nt&&(j.extensions=j.extensions||{},j.extensions[Ip]={bufferView:e.otherBufferViewsIndexMap.get(nt.data),attributes:nt.attributeIDs})}}if(!i.primitiveHashMap.size){const s=e.jsonDoc.json;s.extensionsUsed=(s.extensionsUsed||[]).filter(o=>o!==Ip),s.extensionsRequired=(s.extensionsRequired||[]).filter(o=>o!==Ip)}return this}}function tN(h,e){const i=[],s=h.getIndices();i.push(e.get(s));for(const o of h.listAttributes())i.push(e.get(o));return i.sort().join("|")}bI.EXTENSION_NAME=Ip,bI.EncoderMethod=AI;class aT extends gp{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[ts.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:aT.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return _v.factorToHex(this.getColor())}setColorHex(e){const i=this.getColor().slice();return _v.hexToFactor(e,i),this.setColor(i)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}aT.EXTENSION_NAME="KHR_lights_punctual",aT.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const RA="KHR_lights_punctual";class nN extends Bu{constructor(...e){super(...e),this.extensionName=RA}createLight(e=""){return new aT(this.document.getGraph(),e)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions[RA])return this;const s=(i.json.extensions[RA].lights||[]).map(o=>{var c,_;const j=this.createLight().setName(o.name||"").setType(o.type);return o.color!==void 0&&j.setColor(o.color),o.intensity!==void 0&&j.setIntensity(o.intensity),o.range!==void 0&&j.setRange(o.range),((c=o.spot)==null?void 0:c.innerConeAngle)!==void 0&&j.setInnerConeAngle(o.spot.innerConeAngle),((_=o.spot)==null?void 0:_.outerConeAngle)!==void 0&&j.setOuterConeAngle(o.spot.outerConeAngle),j});return i.json.nodes.forEach((o,c)=>{o.extensions&&o.extensions[RA]&&e.nodes[c].setExtension(RA,s[o.extensions[RA].light])}),this}write(e){const i=e.jsonDoc;if(this.properties.size===0)return this;const s=[],o=new Map;for(const c of this.properties){const _=c,j={type:_.getType()};Tu.eq(_.getColor(),[1,1,1])||(j.color=_.getColor()),_.getIntensity()!==1&&(j.intensity=_.getIntensity()),_.getRange()!=null&&(j.range=_.getRange()),_.getName()&&(j.name=_.getName()),_.getType()===aT.Type.SPOT&&(j.spot={innerConeAngle:_.getInnerConeAngle(),outerConeAngle:_.getOuterConeAngle()}),s.push(j),o.set(_,s.length-1)}return this.document.getRoot().listNodes().forEach(c=>{const _=c.getExtension(RA);if(_){const j=e.nodeIndexMap.get(c),et=i.json.nodes[j];et.extensions=et.extensions||{},et.extensions[RA]={light:o.get(_)}}}),i.json.extensions=i.json.extensions||{},i.json.extensions[RA]={lights:s},this}}nN.EXTENSION_NAME=RA;const{R:Qz,G:Wz}=rp;class rN extends gp{init(){this.extensionName="KHR_materials_anisotropy",this.propertyType="Anisotropy",this.parentTypes=[ts.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new Mu(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:Qz|Wz})}}rN.EXTENSION_NAME="KHR_materials_anisotropy";const eS="KHR_materials_anisotropy";class iN extends Bu{constructor(...e){super(...e),this.extensionName=eS}createAnisotropy(){return new rN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[eS]){const _=this.createAnisotropy();e.materials[c].setExtension(eS,_);const j=o.extensions[eS];if(j.anisotropyStrength!==void 0&&_.setAnisotropyStrength(j.anisotropyStrength),j.anisotropyRotation!==void 0&&_.setAnisotropyRotation(j.anisotropyRotation),j.anisotropyTexture!==void 0){const et=j.anisotropyTexture;_.setAnisotropyTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getAnisotropyTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(eS);if(o){const c=e.materialIndexMap.get(s),_=i.json.materials[c];_.extensions=_.extensions||{};const j=_.extensions[eS]={};if(o.getAnisotropyStrength()>0&&(j.anisotropyStrength=o.getAnisotropyStrength()),o.getAnisotropyRotation()!==0&&(j.anisotropyRotation=o.getAnisotropyRotation()),o.getAnisotropyTexture()){const et=o.getAnisotropyTexture(),nt=o.getAnisotropyTextureInfo();j.anisotropyTexture=e.createTextureInfoDef(et,nt)}}}),this}}iN.EXTENSION_NAME=eS;const{R:sN,G:oN,B:qz}=rp;class aN extends gp{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[ts.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Mu(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Mu(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Mu(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:sN})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:oN})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:sN|oN|qz})}}aN.EXTENSION_NAME="KHR_materials_clearcoat";const tS="KHR_materials_clearcoat";class lN extends Bu{constructor(...e){super(...e),this.extensionName=tS}createClearcoat(){return new aN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[tS]){const _=this.createClearcoat();e.materials[c].setExtension(tS,_);const j=o.extensions[tS];if(j.clearcoatFactor!==void 0&&_.setClearcoatFactor(j.clearcoatFactor),j.clearcoatRoughnessFactor!==void 0&&_.setClearcoatRoughnessFactor(j.clearcoatRoughnessFactor),j.clearcoatTexture!==void 0){const et=j.clearcoatTexture;_.setClearcoatTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getClearcoatTextureInfo(),et)}if(j.clearcoatRoughnessTexture!==void 0){const et=j.clearcoatRoughnessTexture;_.setClearcoatRoughnessTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getClearcoatRoughnessTextureInfo(),et)}if(j.clearcoatNormalTexture!==void 0){const et=j.clearcoatNormalTexture;_.setClearcoatNormalTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getClearcoatNormalTextureInfo(),et),et.scale!==void 0&&_.setClearcoatNormalScale(et.scale)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(tS);if(o){const c=e.materialIndexMap.get(s),_=i.json.materials[c];_.extensions=_.extensions||{};const j=_.extensions[tS]={clearcoatFactor:o.getClearcoatFactor(),clearcoatRoughnessFactor:o.getClearcoatRoughnessFactor()};if(o.getClearcoatTexture()){const et=o.getClearcoatTexture(),nt=o.getClearcoatTextureInfo();j.clearcoatTexture=e.createTextureInfoDef(et,nt)}if(o.getClearcoatRoughnessTexture()){const et=o.getClearcoatRoughnessTexture(),nt=o.getClearcoatRoughnessTextureInfo();j.clearcoatRoughnessTexture=e.createTextureInfoDef(et,nt)}if(o.getClearcoatNormalTexture()){const et=o.getClearcoatNormalTexture(),nt=o.getClearcoatNormalTextureInfo();j.clearcoatNormalTexture=e.createTextureInfoDef(et,nt),o.getClearcoatNormalScale()!==1&&(j.clearcoatNormalTexture.scale=o.getClearcoatNormalScale())}}}),this}}lN.EXTENSION_NAME=tS;class cN extends gp{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[ts.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}cN.EXTENSION_NAME="KHR_materials_emissive_strength";const nS="KHR_materials_emissive_strength";class uN extends Bu{constructor(...e){super(...e),this.extensionName=nS}createEmissiveStrength(){return new cN(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[nS]){const o=this.createEmissiveStrength();e.materials[s].setExtension(nS,o);const c=i.extensions[nS];c.emissiveStrength!==void 0&&o.setEmissiveStrength(c.emissiveStrength)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(nS);if(o){const c=e.materialIndexMap.get(s),_=i.json.materials[c];_.extensions=_.extensions||{},_.extensions[nS]={emissiveStrength:o.getEmissiveStrength()}}}),this}}uN.EXTENSION_NAME=nS;class hN extends gp{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[ts.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}hN.EXTENSION_NAME="KHR_materials_ior";const rS="KHR_materials_ior";class dN extends Bu{constructor(...e){super(...e),this.extensionName=rS}createIOR(){return new hN(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[rS]){const o=this.createIOR();e.materials[s].setExtension(rS,o);const c=i.extensions[rS];c.ior!==void 0&&o.setIOR(c.ior)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(rS);if(o){const c=e.materialIndexMap.get(s),_=i.json.materials[c];_.extensions=_.extensions||{},_.extensions[rS]={ior:o.getIOR()}}}),this}}dN.EXTENSION_NAME=rS;const{R:Xz,G:Yz}=rp;class pN extends gp{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[ts.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Mu(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Mu(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Xz})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:Yz})}}pN.EXTENSION_NAME="KHR_materials_iridescence";const iS="KHR_materials_iridescence";class fN extends Bu{constructor(...e){super(...e),this.extensionName=iS}createIridescence(){return new pN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[iS]){const _=this.createIridescence();e.materials[c].setExtension(iS,_);const j=o.extensions[iS];if(j.iridescenceFactor!==void 0&&_.setIridescenceFactor(j.iridescenceFactor),j.iridescenceIor!==void 0&&_.setIridescenceIOR(j.iridescenceIor),j.iridescenceThicknessMinimum!==void 0&&_.setIridescenceThicknessMinimum(j.iridescenceThicknessMinimum),j.iridescenceThicknessMaximum!==void 0&&_.setIridescenceThicknessMaximum(j.iridescenceThicknessMaximum),j.iridescenceTexture!==void 0){const et=j.iridescenceTexture;_.setIridescenceTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getIridescenceTextureInfo(),et)}if(j.iridescenceThicknessTexture!==void 0){const et=j.iridescenceThicknessTexture;_.setIridescenceThicknessTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getIridescenceThicknessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(iS);if(o){const c=e.materialIndexMap.get(s),_=i.json.materials[c];_.extensions=_.extensions||{};const j=_.extensions[iS]={};if(o.getIridescenceFactor()>0&&(j.iridescenceFactor=o.getIridescenceFactor()),o.getIridescenceIOR()!==1.3&&(j.iridescenceIor=o.getIridescenceIOR()),o.getIridescenceThicknessMinimum()!==100&&(j.iridescenceThicknessMinimum=o.getIridescenceThicknessMinimum()),o.getIridescenceThicknessMaximum()!==400&&(j.iridescenceThicknessMaximum=o.getIridescenceThicknessMaximum()),o.getIridescenceTexture()){const et=o.getIridescenceTexture(),nt=o.getIridescenceTextureInfo();j.iridescenceTexture=e.createTextureInfoDef(et,nt)}if(o.getIridescenceThicknessTexture()){const et=o.getIridescenceThicknessTexture(),nt=o.getIridescenceThicknessTextureInfo();j.iridescenceThicknessTexture=e.createTextureInfoDef(et,nt)}}}),this}}fN.EXTENSION_NAME=iS;const{R:mN,G:gN,B:_N,A:vN}=rp;class yN extends gp{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[ts.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Mu(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Mu(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return _v.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const i=this.getDiffuseFactor().slice();return this.setDiffuseFactor(_v.hexToFactor(e,i))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:mN|gN|_N|vN})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:mN|gN|_N|vN})}}yN.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const sS="KHR_materials_pbrSpecularGlossiness";class AN extends Bu{constructor(...e){super(...e),this.extensionName=sS}createPBRSpecularGlossiness(){return new yN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[sS]){const _=this.createPBRSpecularGlossiness();e.materials[c].setExtension(sS,_);const j=o.extensions[sS];if(j.diffuseFactor!==void 0&&_.setDiffuseFactor(j.diffuseFactor),j.specularFactor!==void 0&&_.setSpecularFactor(j.specularFactor),j.glossinessFactor!==void 0&&_.setGlossinessFactor(j.glossinessFactor),j.diffuseTexture!==void 0){const et=j.diffuseTexture;_.setDiffuseTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getDiffuseTextureInfo(),et)}if(j.specularGlossinessTexture!==void 0){const et=j.specularGlossinessTexture;_.setSpecularGlossinessTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getSpecularGlossinessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(sS);if(o){const c=e.materialIndexMap.get(s),_=i.json.materials[c];_.extensions=_.extensions||{};const j=_.extensions[sS]={diffuseFactor:o.getDiffuseFactor(),specularFactor:o.getSpecularFactor(),glossinessFactor:o.getGlossinessFactor()};if(o.getDiffuseTexture()){const et=o.getDiffuseTexture(),nt=o.getDiffuseTextureInfo();j.diffuseTexture=e.createTextureInfoDef(et,nt)}if(o.getSpecularGlossinessTexture()){const et=o.getSpecularGlossinessTexture(),nt=o.getSpecularGlossinessTextureInfo();j.specularGlossinessTexture=e.createTextureInfoDef(et,nt)}}}),this}}AN.EXTENSION_NAME=sS;const{R:$z,G:Kz,B:Jz,A:Zz}=rp;class bN extends gp{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[ts.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Mu(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Mu(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return _v.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const i=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",_v.hexToFactor(e,i))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:$z|Kz|Jz})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Zz})}}bN.EXTENSION_NAME="KHR_materials_sheen";const oS="KHR_materials_sheen";class wN extends Bu{constructor(...e){super(...e),this.extensionName=oS}createSheen(){return new bN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[oS]){const _=this.createSheen();e.materials[c].setExtension(oS,_);const j=o.extensions[oS];if(j.sheenColorFactor!==void 0&&_.setSheenColorFactor(j.sheenColorFactor),j.sheenRoughnessFactor!==void 0&&_.setSheenRoughnessFactor(j.sheenRoughnessFactor),j.sheenColorTexture!==void 0){const et=j.sheenColorTexture;_.setSheenColorTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getSheenColorTextureInfo(),et)}if(j.sheenRoughnessTexture!==void 0){const et=j.sheenRoughnessTexture;_.setSheenRoughnessTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getSheenRoughnessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(oS);if(o){const c=e.materialIndexMap.get(s),_=i.json.materials[c];_.extensions=_.extensions||{};const j=_.extensions[oS]={sheenColorFactor:o.getSheenColorFactor(),sheenRoughnessFactor:o.getSheenRoughnessFactor()};if(o.getSheenColorTexture()){const et=o.getSheenColorTexture(),nt=o.getSheenColorTextureInfo();j.sheenColorTexture=e.createTextureInfoDef(et,nt)}if(o.getSheenRoughnessTexture()){const et=o.getSheenRoughnessTexture(),nt=o.getSheenRoughnessTextureInfo();j.sheenRoughnessTexture=e.createTextureInfoDef(et,nt)}}}),this}}wN.EXTENSION_NAME=oS;const{R:e5,G:t5,B:n5,A:r5}=rp;class xN extends gp{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[ts.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Mu(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Mu(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return _v.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const i=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",_v.hexToFactor(e,i))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:r5})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:e5|t5|n5})}}xN.EXTENSION_NAME="KHR_materials_specular";const aS="KHR_materials_specular";class EN extends Bu{constructor(...e){super(...e),this.extensionName=aS}createSpecular(){return new xN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[aS]){const _=this.createSpecular();e.materials[c].setExtension(aS,_);const j=o.extensions[aS];if(j.specularFactor!==void 0&&_.setSpecularFactor(j.specularFactor),j.specularColorFactor!==void 0&&_.setSpecularColorFactor(j.specularColorFactor),j.specularTexture!==void 0){const et=j.specularTexture;_.setSpecularTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getSpecularTextureInfo(),et)}if(j.specularColorTexture!==void 0){const et=j.specularColorTexture;_.setSpecularColorTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getSpecularColorTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(aS);if(o){const c=e.materialIndexMap.get(s),_=i.json.materials[c];_.extensions=_.extensions||{};const j=_.extensions[aS]={};if(o.getSpecularFactor()!==1&&(j.specularFactor=o.getSpecularFactor()),Tu.eq(o.getSpecularColorFactor(),[1,1,1])||(j.specularColorFactor=o.getSpecularColorFactor()),o.getSpecularTexture()){const et=o.getSpecularTexture(),nt=o.getSpecularTextureInfo();j.specularTexture=e.createTextureInfoDef(et,nt)}if(o.getSpecularColorTexture()){const et=o.getSpecularColorTexture(),nt=o.getSpecularColorTextureInfo();j.specularColorTexture=e.createTextureInfoDef(et,nt)}}}),this}}EN.EXTENSION_NAME=aS;const{R:i5}=rp;class SN extends gp{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[ts.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Mu(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:i5})}}SN.EXTENSION_NAME="KHR_materials_transmission";const lS="KHR_materials_transmission";class CN extends Bu{constructor(...e){super(...e),this.extensionName=lS}createTransmission(){return new SN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[lS]){const _=this.createTransmission();e.materials[c].setExtension(lS,_);const j=o.extensions[lS];if(j.transmissionFactor!==void 0&&_.setTransmissionFactor(j.transmissionFactor),j.transmissionTexture!==void 0){const et=j.transmissionTexture;_.setTransmissionTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getTransmissionTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(lS);if(o){const c=e.materialIndexMap.get(s),_=i.json.materials[c];_.extensions=_.extensions||{};const j=_.extensions[lS]={transmissionFactor:o.getTransmissionFactor()};if(o.getTransmissionTexture()){const et=o.getTransmissionTexture(),nt=o.getTransmissionTextureInfo();j.transmissionTexture=e.createTextureInfoDef(et,nt)}}}),this}}CN.EXTENSION_NAME=lS;class TN extends gp{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[ts.MATERIAL]}}TN.EXTENSION_NAME="KHR_materials_unlit";const lT="KHR_materials_unlit";class MN extends Bu{constructor(...e){super(...e),this.extensionName=lT}createUnlit(){return new TN(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{i.extensions&&i.extensions[lT]&&e.materials[s].setExtension(lT,this.createUnlit())}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{if(s.getExtension(lT)){const o=e.materialIndexMap.get(s),c=i.json.materials[o];c.extensions=c.extensions||{},c.extensions[lT]={}}}),this}}MN.EXTENSION_NAME=lT;class IN extends gp{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}IN.EXTENSION_NAME="KHR_materials_variants";class PN extends gp{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[ts.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}PN.EXTENSION_NAME="KHR_materials_variants";class CB extends gp{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}CB.EXTENSION_NAME="KHR_materials_variants";const DA="KHR_materials_variants";class RN extends Bu{constructor(...e){super(...e),this.extensionName=DA}createMappingList(){return new PN(this.document.getGraph())}createVariant(e=""){return new CB(this.document.getGraph(),e)}createMapping(){return new IN(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof CB)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions[DA])return this;const s=(i.json.extensions[DA].variants||[]).map(o=>this.createVariant().setName(o.name||""));return(i.json.meshes||[]).forEach((o,c)=>{const _=e.meshes[c];(o.primitives||[]).forEach((j,et)=>{if(!j.extensions||!j.extensions[DA])return;const nt=this.createMappingList(),st=j.extensions[DA];for(const at of st.mappings){const ct=this.createMapping();at.material!==void 0&&ct.setMaterial(e.materials[at.material]);for(const dt of at.variants||[])ct.addVariant(s[dt]);nt.addMapping(ct)}_.listPrimitives()[et].setExtension(DA,nt)})}),this}write(e){const i=e.jsonDoc,s=this.listVariants();if(!s.length)return this;const o=[],c=new Map;for(const _ of s)c.set(_,o.length),o.push(e.createPropertyDef(_));for(const _ of this.document.getRoot().listMeshes()){const j=e.meshIndexMap.get(_);_.listPrimitives().forEach((et,nt)=>{const st=et.getExtension(DA);if(!st)return;const at=e.jsonDoc.json.meshes[j].primitives[nt],ct=st.listMappings().map(dt=>{const mt=e.createPropertyDef(dt),yt=dt.getMaterial();return yt&&(mt.material=e.materialIndexMap.get(yt)),mt.variants=dt.listVariants().map(wt=>c.get(wt)),mt});at.extensions=at.extensions||{},at.extensions[DA]={mappings:ct}})}return i.json.extensions=i.json.extensions||{},i.json.extensions[DA]={variants:o},this}}RN.EXTENSION_NAME=DA;const{G:s5}=rp;class DN extends gp{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[ts.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Mu(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:s5})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return _v.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const i=this.getAttenuationColor().slice();return this.set("attenuationColor",_v.hexToFactor(e,i))}}DN.EXTENSION_NAME="KHR_materials_volume";const cS="KHR_materials_volume";class kN extends Bu{constructor(...e){super(...e),this.extensionName=cS}createVolume(){return new DN(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[cS]){const _=this.createVolume();e.materials[c].setExtension(cS,_);const j=o.extensions[cS];if(j.thicknessFactor!==void 0&&_.setThicknessFactor(j.thicknessFactor),j.attenuationDistance!==void 0&&_.setAttenuationDistance(j.attenuationDistance),j.attenuationColor!==void 0&&_.setAttenuationColor(j.attenuationColor),j.thicknessTexture!==void 0){const et=j.thicknessTexture;_.setThicknessTexture(e.textures[s[et.index].source]),e.setTextureInfo(_.getThicknessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(cS);if(o){const c=e.materialIndexMap.get(s),_=i.json.materials[c];_.extensions=_.extensions||{};const j=_.extensions[cS]={};if(o.getThicknessFactor()>0&&(j.thicknessFactor=o.getThicknessFactor()),Number.isFinite(o.getAttenuationDistance())&&(j.attenuationDistance=o.getAttenuationDistance()),Tu.eq(o.getAttenuationColor(),[1,1,1])||(j.attenuationColor=o.getAttenuationColor()),o.getThicknessTexture()){const et=o.getThicknessTexture(),nt=o.getThicknessTextureInfo();j.thicknessTexture=e.createTextureInfoDef(et,nt)}}}),this}}kN.EXTENSION_NAME=cS;const ON="KHR_mesh_quantization";class BN extends Bu{constructor(...e){super(...e),this.extensionName=ON}read(e){return this}write(e){return this}}BN.EXTENSION_NAME=ON;const wI="KHR_texture_basisu";class o5{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const i=xB(e);return[i.pixelWidth,i.pixelHeight]}getChannels(e){const i=xB(e).dataFormatDescriptor[0];if(i.colorModel===163)return i.samples.length===2&&(15&i.samples[1].channelType)==15?4:3;if(i.colorModel===166)return(15&i.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${i.colorModel}".`)}getVRAMByteLength(e){const i=xB(e),s=this.getChannels(e)>3;let o=0;for(let c=0;c<i.levels.length;c++){const _=i.levels[c];o+=_.uncompressedByteLength?_.uncompressedByteLength:Math.max(1,Math.floor(i.pixelWidth/Math.pow(2,c)))/4*(Math.max(1,Math.floor(i.pixelHeight/Math.pow(2,c)))/4)*(s?16:8)}return o}}class LN extends Bu{constructor(...e){super(...e),this.extensionName=wI,this.prereadTypes=[ts.TEXTURE]}static register(){IA.registerFormat("image/ktx2",new o5)}preread(e){return e.jsonDoc.json.textures.forEach(i=>{i.extensions&&i.extensions[wI]&&(i.source=i.extensions[wI].source)}),this}read(e){return this}write(e){const i=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/ktx2"){const o=e.imageIndexMap.get(s);i.json.textures.forEach(c=>{c.source===o&&(c.extensions=c.extensions||{},c.extensions[wI]={source:c.source},delete c.source)})}}),this}}LN.EXTENSION_NAME=wI;class NN extends gp{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[ts.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}NN.EXTENSION_NAME="KHR_texture_transform";const uS="KHR_texture_transform";class UN extends Bu{constructor(...e){super(...e),this.extensionName=uS}createTransform(){return new NN(this.document.getGraph())}read(e){for(const[i,s]of Array.from(e.textureInfos.entries())){if(!s.extensions||!s.extensions[uS])continue;const o=this.createTransform(),c=s.extensions[uS];c.offset!==void 0&&o.setOffset(c.offset),c.rotation!==void 0&&o.setRotation(c.rotation),c.scale!==void 0&&o.setScale(c.scale),c.texCoord!==void 0&&o.setTexCoord(c.texCoord),i.setExtension(uS,o)}return this}write(e){const i=Array.from(e.textureInfoDefMap.entries());for(const[s,o]of i){const c=s.getExtension(uS);if(!c)continue;o.extensions=o.extensions||{};const _={},j=Tu.eq;j(c.getOffset(),[0,0])||(_.offset=c.getOffset()),c.getRotation()!==0&&(_.rotation=c.getRotation()),j(c.getScale(),[1,1])||(_.scale=c.getScale()),c.getTexCoord()!=null&&(_.texCoord=c.getTexCoord()),o.extensions[uS]=_}return this}}UN.EXTENSION_NAME=uS;const a5=[ts.ROOT,ts.SCENE,ts.NODE,ts.MESH,ts.MATERIAL,ts.TEXTURE,ts.ANIMATION];class FN extends gp{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=a5}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",w1({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const i=this.get("properties");return e in i?i[e]:null}setProperty(e,i){this._assertContext(e);const s=w1({},this.get("properties"));return i?s[e]=i:delete s[e],this.set("properties",s)}toJSONLD(){return w1({"@context":TB(this.get("context"))},TB(this.get("properties")))}fromJSONLD(e){const i=(e=TB(e))["@context"];return i&&this.set("context",i),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function TB(h){return JSON.parse(JSON.stringify(h))}FN.EXTENSION_NAME="KHR_xmp_json_ld";const Hw="KHR_xmp_json_ld";class jN extends Bu{constructor(...e){super(...e),this.extensionName=Hw}createPacket(){return new FN(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var i;const s=(i=e.jsonDoc.json.extensions)==null?void 0:i[Hw];if(!s||!s.packets)return this;const o=e.jsonDoc.json,c=this.document.getRoot(),_=s.packets.map(nt=>this.createPacket().fromJSONLD(nt)),j=[[o.asset],o.scenes,o.nodes,o.meshes,o.materials,o.images,o.animations],et=[[c],c.listScenes(),c.listNodes(),c.listMeshes(),c.listMaterials(),c.listTextures(),c.listAnimations()];for(let nt=0;nt<j.length;nt++){const st=j[nt]||[];for(let at=0;at<st.length;at++){const ct=st[at];ct.extensions&&ct.extensions[Hw]&&et[nt][at].setExtension(Hw,_[ct.extensions[Hw].packet])}}return this}write(e){const{json:i}=e.jsonDoc,s=[];for(const o of this.properties){s.push(o.toJSONLD());for(const c of o.listParents()){let _;switch(c.propertyType){case ts.ROOT:_=i.asset;break;case ts.SCENE:_=i.scenes[e.sceneIndexMap.get(c)];break;case ts.NODE:_=i.nodes[e.nodeIndexMap.get(c)];break;case ts.MESH:_=i.meshes[e.meshIndexMap.get(c)];break;case ts.MATERIAL:_=i.materials[e.materialIndexMap.get(c)];break;case ts.TEXTURE:_=i.images[e.imageIndexMap.get(c)];break;case ts.ANIMATION:_=i.animations[e.animationIndexMap.get(c)];break;default:_=null,this.document.getLogger().warn(`[${Hw}]: Unsupported parent property, "${c.propertyType}"`)}_&&(_.extensions=_.extensions||{},_.extensions[Hw]={packet:s.length-1})}}return s.length>0&&(i.extensions=i.extensions||{},i.extensions[Hw]={packets:s}),this}}jN.EXTENSION_NAME=Hw;const l5=[V3,SB,q3,Y3,bI,nN,iN,lN,uN,dN,fN,AN,EN,wN,CN,MN,RN,kN,BN,LN,UN,jN];class zN extends hB{constructor(e){super(),this._loadedLibs=!1,e=e||{method:bI.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new Iz().registerExtensions(l5).registerExtensions([VN,dR,lR,cR,uR,pR,fR,mR,gR,_R,vR,yR,AR,wR,bR,xR,hR]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:i=!1,dracoOptions:s,...o}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,o);await this._loadLibs();const c={...o};i&&(c.externalImagesInExtras=!0);const _=await new Promise((ct,dt)=>this.parse(e,ct,dt,c)),j=await super.parseAsync(_,c);if(!i)return j;if(!_)throw new Error("GLTFDracoExporter: gltf is null");let et=_;const nt=et.byteLength||1/0,st=await(typeof et!="object"||et.byteLength?this._io.readBinary(new Uint8Array(et)):this._io.readJSON({json:et,resources:{}}));if(st.createExtension(bI).setRequired(!0).setEncoderOptions({...this._encoderOptions,...s??{}}),c.exportExt==="glb")et=await this._io.writeBinary(st),isFinite(nt)&&console.log("DRACO Compression ratio: "+(et.byteLength/nt).toFixed(5));else{const ct=await this._io.writeJSON(st);et=ct.json,Object.values(ct.resources).filter(dt=>dt).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),et.resources=ct.resources)}et.__isGLTFOutput=!0;const at=await super.parseAsync(et,c);if(!at)throw new Error("GLTFDracoExporter: blob is null");return at.ext="glb",at.__uncompressed=j,at}}class MB extends ms{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Fr,b1]}async onAdded(e){await super.onAdded(e);const i=e.getManager().importer,s=e.getManager().exporter;if(!i)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(o,c,_){dB(o,c,zN,j=>{const et=Bp()+".drc",nt=j;nt.loader=_.registerFile(et),nt.loader.setDecoderConfig({type:"js"}),nt.loader.preload(!0,!0)})})(s,e,i)}}MB.PluginType="GLTFDracoExportPlugin";class c5 extends gp{constructor(){super(...arguments),this.extensionName=Ru,this.parentTypes=[ts.SCENE],this.propertyType="ViewerJSON"}init(){}}class VN extends Bu{constructor(){super(...arguments),this.extensionName=Ru,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var i;return this._viewerConfig={},(i=e.jsonDoc.json.scenes)==null||i.forEach((s,o)=>{if(s.extensions&&s.extensions[Ru]){const c=new c5(this.document.getGraph());e.scenes[o].setExtension(Ru,c),this._viewerConfig=s.extensions[Ru]}}),this}write(e){return this.document.getRoot().listScenes().forEach(i=>{var s;if(i.getExtension(Ru)){const o=(s=e.jsonDoc.json.scenes)==null?void 0:s[e.jsonDoc.json.scene||0];o&&Object.keys(this._viewerConfig).length>0&&(o.extensions=o.extensions||{},o.extensions[Ru]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}VN.EXTENSION_NAME=Ru;class aR extends gp{addTexture(e,i,s,o=4369){this.setRef(e,s,{channels:o}),this.textures[e]=[i,s]}constructor(e,i,s){super(e,i),this.parentTypes=[ts.MATERIAL,ts.MESH,ts.NODE,ts.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=s}init(){}}class g_ extends Bu{constructor(){super(...arguments),this.textureChannels={}}read(e){const i=e.jsonDoc,s=i.json.materials||[],o=i.json.textures||[];return s.forEach((c,_)=>{var j;if(c.extensions&&c.extensions[this.extensionName]){const et=new aR(this.document.getGraph(),"",this.extensionName);e.materials[_].setExtension(this.extensionName,et);const nt={...c.extensions[this.extensionName]};for(const[st,at]of Object.entries(nt))if(typeof(at==null?void 0:at.index)=="number"){const ct=at,dt=(j=o[ct.index])==null?void 0:j.source;if(typeof dt!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",ct);continue}const mt=e.textures[dt],yt=new Mu(this.document.getGraph()),wt=this.textureChannels[st]??4369;et.addTexture(st,yt,mt,wt),e.setTextureInfo(yt,ct),delete nt[st]}et.setExtras(nt)}}),(i.json.meshes||[]).forEach((c,_)=>{if(c.extensions&&c.extensions[this.extensionName]){const j=new aR(this.document.getGraph(),"",this.extensionName);e.meshes[_].setExtension(this.extensionName,j);const et=c.extensions[this.extensionName];j.setExtras(et)}}),(i.json.nodes||[]).forEach((c,_)=>{if(c.extensions&&c.extensions[this.extensionName]){const j=new aR(this.document.getGraph(),"",this.extensionName);e.nodes[_].setExtension(this.extensionName,j);const et=c.extensions[this.extensionName];j.setExtras(et)}}),(i.json.scenes||[]).forEach((c,_)=>{if(c.extensions&&c.extensions[this.extensionName]){const j=new aR(this.document.getGraph(),"",this.extensionName);e.scenes[_].setExtension(this.extensionName,j);const et=c.extensions[this.extensionName];j.setExtras(et)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const o=s.getExtension(this.extensionName);if(o){const c=e.materialIndexMap.get(s),_=i.json.materials[c];_.extensions=_.extensions||{};const j={...o.getExtras()};for(const[et,nt]of Object.entries(o.textures)){const st=nt[0],at=nt[1];at&&(j[et]=e.createTextureInfoDef(at,st))}_.extensions[this.extensionName]=j}}),this.document.getRoot().listMeshes().forEach(s=>{const o=s.getExtension(this.extensionName);if(o){const c=e.meshIndexMap.get(s),_=i.json.meshes[c];_.extensions=_.extensions||{},_.extensions[this.extensionName]=o.getExtras()}}),this.document.getRoot().listNodes().forEach(s=>{const o=s.getExtension(this.extensionName);if(o){const c=e.nodeIndexMap.get(s),_=i.json.nodes[c];_.extensions=_.extensions||{},_.extensions[this.extensionName]=o.getExtras()}}),this.document.getRoot().listScenes().forEach(s=>{const o=s.getExtension(this.extensionName);if(o){const c=e.jsonDoc.json.scene||0,_=i.json.scenes[c];if(!_)return;_.extensions=_.extensions||{},_.extensions[this.extensionName]=o.getExtras()}}),this}}class lR extends g_{constructor(){super(...arguments),this.extensionName=lR.EXTENSION_NAME,this.textureChannels={bumpTexture:rp.R}}}lR.EXTENSION_NAME=H0;class cR extends g_{constructor(){super(...arguments),this.extensionName=cR.EXTENSION_NAME,this.textureChannels={lightMapTexture:rp.R|rp.G|rp.B}}}cR.EXTENSION_NAME=Ex;class uR extends g_{constructor(){super(...arguments),this.extensionName=uR.EXTENSION_NAME,this.textureChannels={alphaTexture:rp.G}}}uR.EXTENSION_NAME=a0;class hR extends g_{constructor(){super(...arguments),this.extensionName=hR.EXTENSION_NAME,this.textureChannels={displacementTexture:rp.R}}}hR.EXTENSION_NAME=X_;class dR extends g_{constructor(){super(...arguments),this.extensionName=dR.EXTENSION_NAME}}dR.EXTENSION_NAME=Tl.DIAMOND_GLTF_EXTENSION;class pR extends g_{constructor(){super(...arguments),this.extensionName=pR.EXTENSION_NAME}}pR.EXTENSION_NAME=Ql.AnimationMarkersExtension;class fR extends g_{constructor(){super(...arguments),this.extensionName=fR.EXTENSION_NAME,this.textureChannels={anisotropyDirection:rp.R|rp.G|rp.B}}}fR.EXTENSION_NAME=Nm.ANISOTROPY_GLTF_EXTENSION;class mR extends g_{constructor(){super(...arguments),this.extensionName=mR.EXTENSION_NAME,this.textureChannels={customBumpMap:rp.R|rp.G|rp.B}}}mR.EXTENSION_NAME=pp.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class gR extends g_{constructor(){super(...arguments),this.extensionName=gR.EXTENSION_NAME}}gR.EXTENSION_NAME=i_;class _R extends g_{constructor(){super(...arguments),this.extensionName=_R.EXTENSION_NAME}}_R.EXTENSION_NAME=xp;class vR extends g_{constructor(){super(...arguments),this.extensionName=vR.EXTENSION_NAME}}vR.EXTENSION_NAME=ap;class yR extends g_{constructor(){super(...arguments),this.extensionName=yR.EXTENSION_NAME}}yR.EXTENSION_NAME=hv.CLEARCOAT_TINT_GLTF_EXTENSION;class AR extends g_{constructor(){super(...arguments),this.extensionName=AR.EXTENSION_NAME}}AR.EXTENSION_NAME=R_.THIN_FILM_LAYER_GLTF_EXTENSION;class bR extends g_{constructor(){super(...arguments),this.extensionName=bR.EXTENSION_NAME}}bR.EXTENSION_NAME=Hv.TRIPLANAR_GLTF_EXTENSION;class wR extends g_{constructor(){super(...arguments),this.extensionName=wR.EXTENSION_NAME}}wR.EXTENSION_NAME=Gv.SSBEVEL_GLTF_EXTENSION;class xR extends g_{constructor(){super(...arguments),this.extensionName=xR.EXTENSION_NAME}}xR.EXTENSION_NAME=f_.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class GN extends b.SimpleEventDispatcher{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,i)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}GN.PluginType="PMREMGenerator";const HN=new g.Pa4,u5=new g._fP,QN=new g.Pa4;class h5 extends g.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(i){i.element instanceof Element&&i.element.parentNode!==null&&i.element.parentNode.removeChild(i.element)})})}copy(e,i){return super.copy(e,i),this.element=e.element.cloneNode(!0),this}}const kA=new g.yGw,d5=new g.yGw;class p5{constructor(e={}){const i=this;let s,o,c,_;const j={camera:{fov:0,style:""},objects:new WeakMap},et=e.element!==void 0?e.element:document.createElement("div");et.style.overflow="hidden",this.domElement=et;const nt=document.createElement("div");nt.style.transformOrigin="0 0",nt.style.pointerEvents="none",et.appendChild(nt);const st=document.createElement("div");function at(yt){return Math.abs(yt)<1e-10?0:yt}function ct(yt){const wt=yt.elements;return"matrix3d("+at(wt[0])+","+at(-wt[1])+","+at(wt[2])+","+at(wt[3])+","+at(wt[4])+","+at(-wt[5])+","+at(wt[6])+","+at(wt[7])+","+at(wt[8])+","+at(-wt[9])+","+at(wt[10])+","+at(wt[11])+","+at(wt[12])+","+at(-wt[13])+","+at(wt[14])+","+at(wt[15])+")"}function dt(yt){const wt=yt.elements;return"translate(-50%,-50%)matrix3d("+at(wt[0])+","+at(wt[1])+","+at(wt[2])+","+at(wt[3])+","+at(-wt[4])+","+at(-wt[5])+","+at(-wt[6])+","+at(-wt[7])+","+at(wt[8])+","+at(wt[9])+","+at(wt[10])+","+at(wt[11])+","+at(wt[12])+","+at(wt[13])+","+at(wt[14])+","+at(wt[15])+")"}function mt(yt,wt,Ct,bt){if(yt.isCSS3DObject){const At=yt.visible===!0&&yt.layers.test(Ct.layers)===!0;if(yt.element.style.display=At===!0?"":"none",At===!0){let Pt;yt.onBeforeRender(i,wt,Ct),yt.isCSS3DSprite?(kA.copy(Ct.matrixWorldInverse),kA.transpose(),yt.rotation2D!==0&&kA.multiply(d5.makeRotationZ(yt.rotation2D)),yt.matrixWorld.decompose(HN,u5,QN),kA.setPosition(HN),kA.scale(QN),kA.elements[3]=0,kA.elements[7]=0,kA.elements[11]=0,kA.elements[15]=1,Pt=dt(kA)):Pt=dt(yt.matrixWorld);const Dt=yt.element,Nt=j.objects.get(yt);if(Nt===void 0||Nt.style!==Pt){Dt.style.transform=Pt;const Vt={style:Pt};j.objects.set(yt,Vt)}Dt.parentNode!==st&&st.appendChild(Dt),yt.onAfterRender(i,wt,Ct)}}for(let At=0,Pt=yt.children.length;At<Pt;At++)mt(yt.children[At],wt,Ct)}st.style.transformStyle="preserve-3d",nt.appendChild(st),this.getSize=function(){return{width:s,height:o}},this.render=function(yt,wt){const Ct=wt.projectionMatrix.elements[5]*_;let bt,At;j.camera.fov!==Ct&&(nt.style.perspective=wt.isPerspectiveCamera?Ct+"px":"",j.camera.fov=Ct),wt.view&&wt.view.enabled?(nt.style.transform=`translate( ${-wt.view.offsetX*(s/wt.view.width)}px, ${-wt.view.offsetY*(o/wt.view.height)}px )`,nt.style.transform+=`scale( ${wt.view.fullWidth/wt.view.width}, ${wt.view.fullHeight/wt.view.height} )`):nt.style.transform="",yt.matrixWorldAutoUpdate===!0&&yt.updateMatrixWorld(),wt.parent===null&&wt.matrixWorldAutoUpdate===!0&&wt.updateMatrixWorld(),wt.isOrthographicCamera&&(bt=-(wt.right+wt.left)/2,At=(wt.top+wt.bottom)/2);const Pt=wt.view&&wt.view.enabled?wt.view.height/wt.view.fullHeight:1,Dt=wt.isOrthographicCamera?`scale( ${Pt} )scale(`+Ct+")translate("+at(bt)+"px,"+at(At)+"px)"+ct(wt.matrixWorldInverse):`scale( ${Pt} )translateZ(`+Ct+"px)"+ct(wt.matrixWorldInverse),Nt=Dt+"translate("+c+"px,"+_+"px)";j.camera.style!==Nt&&(st.style.transform=Nt,j.camera.style=Nt),mt(yt,yt,wt)},this.setSize=function(yt,wt){s=yt,o=wt,c=s/2,_=o/2,et.style.width=yt+"px",et.style.height=wt+"px",nt.style.width=yt+"px",nt.style.height=wt+"px",st.style.width=yt+"px",st.style.height=wt+"px"}}}var ER,SR=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let OA=ER=class extends ms{constructor(h=!0){super(),this._scene=new g.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var o,c,_,j,et;const e=(c=(o=this._viewer)==null?void 0:o.getPlugin(Bo))==null?void 0:c.getSelectedObject();if(!(e!=null&&e.geometry))return void await((_=this._viewer)==null?void 0:_.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const i=await((j=this._viewer)==null?void 0:j.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!i)return;const s=await((et=this._viewer)==null?void 0:et.prompt("Width: Enter the width for the object.","512",!1))||"512";s&&this.attachIFrame(e,i,parseInt(s))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)==null||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=h,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const h=this._viewer;h&&this._renderer&&(h.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",h.canvas):this._renderer.domElement.appendChild(h.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new p5;const h=this._viewer.renderer.rendererObject.getSize(new g.FM8);this._renderer.setSize(h.width,h.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const i=this._viewer.renderer.rendererObject.getSize(new g.FM8);this._renderer.setSize(i.width,i.height)})}async onAdded(h){await super.onAdded(h);let e=!0,i=!0;h.addEventListener("postFrame",c=>{var _,j;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(i&&this._trackers.forEach(et=>{var at,ct;let nt=!0;const st=et.modelObj.material.side;if(st!==g.ehD){const dt=new g.Pa4(0,0,1).applyQuaternion(et.cssObj.quaternion),mt=(ct=(at=this._viewer)==null?void 0:at.scene.activeCamera)==null?void 0:ct.cameraObject,yt=dt.dot(mt.getWorldDirection(new g.Pa4));nt=st===g._Li?yt>0:yt<0}et.cssObj.element.style.visibility=nt?"visible":"hidden"}),this._trackers.filter(et=>et.dirty).forEach(et=>this._syncProperties(et)),(j=this._renderer)==null||j.render(this._scene,(_=h.scene.activeCamera)==null?void 0:_.cameraObject),e=!1))}),h.addEventListener("update",c=>{this.enabled&&(e=this._trackers.length>0)}),h.scene.addEventListener("sceneUpdate",c=>{this.enabled&&(this._trackers.forEach(_=>_.dirty=!0),e=this._trackers.length>0)}),h.scene.addEventListener("activeCameraUpdate",c=>{this.enabled&&(e=this._trackers.length>0,i=!0)});let s=!1;const o=new g.iMs;h.container.addEventListener("mousemove",c=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const _=this._viewer.canvas.getBoundingClientRect(),j=(c.clientX-_.x)/_.width*2-1,et=-(c.clientY-_.y)/_.height*2+1;o.setFromCamera({x:j,y:et},this._viewer.scene.activeCamera.cameraObject);const nt=this._trackers.map(at=>at.modelObj),st=o.intersectObjects(nt,!1);if(console.log(st),st.length)return this._viewer.canvas.style.pointerEvents="none",s=!0,void console.log(this._viewer.canvas.style.pointerEvents);s&&(this._viewer.canvas.style.pointerEvents="auto",s=!1)})}attachIFrame(h,e,i){const s=TR(h.modelObject),o=WN(e,i,i*s.y/s.x,()=>{var c;return(c=h.setDirty)==null?void 0:c.call(h)});return this.attachCSS3DObject(o,h),o}attachCSS3DObject(h,e){var s,o,c,_,j;if(this._trackers.push({cssObj:h,modelObj:e.modelObject,dirty:!0}),h.element&&(this._resizeObserver.observe(h.element),h.element.__isCSS3DObjectElement=!0,console.log(h.element,h.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const i=(s=this._viewer)==null?void 0:s.createMaterial("basic",{opacity:0,color:new g.Ilk("black"),blending:g.jFi,side:g.Wl3});if(!i)throw"cannot create mat";i.userData.forcedLinearDepth=0,(o=e.setMaterial)==null||o.call(e,i),CR(e.modelObject),IB(e.modelObject),TR(e.modelObject),this._scene.add(h),(_=(c=this.uiConfig)==null?void 0:c.uiRefresh)==null||_.call(c),(j=e.setDirty)==null||j.call(e)}_syncProperties(h){const e=h.modelObj,i=h.cssObj;e.updateMatrixWorld();const s=h.cssObj.element.clientWidth<1.5?0:(h.cssObj.element.clientWidth-1.5)/TR(e).x,o=CR(e);i.quaternion.setFromUnitVectors(new g.Pa4(0,0,1),o),i.position.copy(IB(e)),i.scale.set(1,1,1).multiplyScalar(1/s),i.updateMatrixWorld(),i.applyMatrix4(e.matrixWorld),h.dirty=!1}async onDispose(h){return this._resizeObserver.disconnect(),super.onDispose(h)}};function WN(h,e,i,s){const o=document.createElement("div");o.style.width=e.toString()+"px",o.style.height=i.toString()+"px",o.style.backgroundColor="transparent";const c=document.createElement("iframe",{is:"x-frame-bypass"});c.style.width="100%",c.style.height="100%",c.style.border="0px";const _=()=>{var j;try{c.contentWindow.name}catch(et){(typeof et=="string"?et:((j=et==null?void 0:et.toString)==null?void 0:j.call(et))??"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(et)}s(),c.removeEventListener("load",_)};return c.addEventListener("load",_),c.src=h,o.appendChild(c),new h5(o)}function CR(h){if(h.geometry.userData.geometryNormal)return h.geometry.userData.geometryNormal;const e=h.geometry.attributes.normal,i=new g.Pa4,s=new g.Pa4;for(let o=0,c=e.count;o<c;o++)i.fromBufferAttribute(e,o),s.add(i);return s.normalize(),h.geometry.userData.geometryNormal=s,s}function IB(h){if(h.geometry.userData.geometryCenter)return h.geometry.userData.geometryCenter;const e=h.geometry;if(!e)return new g.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const i=e.boundingBox.getCenter(new g.Pa4);return h.geometry.userData.geometryCenter=i,i}function TR(h,e=new g.Pa4(0,0,1)){if(h.geometry.userData.geometrySize)return h.geometry.userData.geometrySize;const i=h.geometry;if(!i)return new g.Pa4(0,0,0);const s=i.clone();s.applyMatrix4(new g.yGw().makeRotationFromQuaternion(new g._fP().setFromUnitVectors(e,CR(h)).invert())),s.computeBoundingBox();const o=s.boundingBox.getSize(new g.Pa4);return h.geometry.userData.geometrySize=o,s.dispose(),o}OA.PluginType="CSS3DRenderer",SR([jr("Enabled"),(0,b.onChange)(ER.prototype._refreshEnabled),En()],OA.prototype,"enabled",void 0),SR([jr("Over canvas"),(0,b.onChange)(ER.prototype._refreshCanvasInDOM),En()],OA.prototype,"overCanvas",void 0),SR([Oo("Attach iframe")],OA.prototype,"attachIFrameToSelected",void 0),OA=ER=SR([ks("CSS3D Renderer")],OA);class f5 extends b_{constructor(e,i,s,o=new g.Ilk(1,1,1),c=1){super(void 0,void 0,s,o,c),this.target=i,this._getSelectedObject=e}render(e,i,s,o,c){const _=e.getRenderTarget(),j=e.getActiveCubeFace(),et=e.getActiveMipmapLevel(),nt=this._getSelectedObject();if(nt)this._renderSelectedObject(e,nt,i,o,c);else{e.setRenderTarget(this.target);const st=new g.Ilk;e.getClearColor(st),e.setClearColor(new g.Ilk(16777215)),e.clear(!0,!0),e.setClearColor(st)}e.setRenderTarget(_,j,et)}_renderSelectedObject(e,i,s,o,c){if(!this.camera)return;i.traverse(et=>{et.layers.enable(6)});const _=this.camera.layers.mask;this.camera.layers.set(6);const j=e.userData;j||console.error("threejs is not patched?"),j.transmissionRenderTarget=s,ls(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!0,transmissionRender:!0,mainRenderPass:!1},()=>super.render(e,s,this.target,o,c)),j.transmissionRenderTarget=void 0,i.traverse(et=>{et.layers.disable(6)}),this.camera.layers.mask=_}}var Qw,x1=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Sy=Qw=class{constructor(h,e){this.enabled=!0,this.enableHighlight=!1,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new g.Ilk(15305317),this.debugOutline=!1,this.transparency=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new g.FM8(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new g.Ilk(15305317)},enableHighlight:{value:!0},outlineBuffer:{value:null}},this.extraDefines={DEBUG_OUTLINE:"0"},this.parsFragmentSnippet=(i,s)=>this.enabled?b.glsl`
            ${Zp}
            ${`uniform sampler2D outlineBuffer;uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;float isSelected(vec2 uv){return 1.-texture2D(outlineBuffer,uv).b;}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;
#if DEBUG_OUTLINE > 0
color=vec4(0.,0.,0.,1.);
#endif
vec3 finalColor=color.rgb;float c=isSelected(vUv);if(c>0.){vec4 uvOffset=1.5*outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c1=isSelected(vUv+uvOffset.xy);float c2=isSelected(vUv-uvOffset.xy);float c3=isSelected(vUv+uvOffset.yw);float c4=isSelected(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 edgeColor=vec4(outlineColor,1.)*vec4(d);float gbufferDepth=getDepth(vUv);float outlineDepth=unpack16(texture2D(outlineBuffer,vUv).xy);outlineDepth*=outlineDepth;outlineDepth-=0.005;if(gbufferDepth<outlineDepth){highlightColor.rgb=highlightColor.rgb*0.3;edgeColor.rgb=edgeColor.rgb*0.5;}vec4 outColor=edgeColor+highlightColor*(1.-d);finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);}else{finalColor.rgb=color.rgb;}return vec4(finalColor.rgb,color.a);}`}
        `:"",this._combinedPostPlugin=h.getPlugin(Lv),this._pickingPlugin=h.getPluginByType("Picking"),this._setDirty=this._setDirty.bind(this),e&&(this.extraUniforms.outlineBuffer.value=e.texture),this._enable()}shaderExtender(h,e,i){this.enabled&&(h.fragmentShader=os(h.fragmentShader,"#glMarker",` 
            gl_FragColor = outline(gl_FragColor);
            #glMarker
        `))}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&this._combinedPostPlugin.reRender(),this.extraDefines&&(this.extraDefines.DEBUG_OUTLINE=this.debugOutline?"1":"0"),this.extraUniforms&&(this.extraUniforms.outlineIntensity.value=this.outlineIntensity,this.extraUniforms.outlineColor.value.copy(this.outlineColor),this.extraUniforms.outlineThickness.value=this._outlineThickness,this.extraUniforms.enableHighlight.value=this.enableHighlight,this.extraUniforms.highlightTransparency.value=this.transparency)}setDirty(){var h;(h=this.__setDirty)==null||h.call(this),this._setDirty()}_enable(){var h;(h=this._pickingPlugin)==null||h.enableWidget(!this.enabled),this._setDirty()}};Sy.PluginType="Outline",x1([(0,b.onChange)(Qw.prototype._enable),jr("Enable"),En()],Sy.prototype,"enabled",void 0),x1([(0,b.onChange)(Qw.prototype._setDirty),jr("Highlight"),En()],Sy.prototype,"enableHighlight",void 0),x1([(0,b.onChange)(Qw.prototype._setDirty),jr("DynamicSelection"),En()],Sy.prototype,"enableDynamicSelection",void 0),x1([(0,b.onChange)(Qw.prototype._setDirty),ns("Intensity",[0,2],.001,{limitedUi:!0}),En()],Sy.prototype,"outlineIntensity",void 0),x1([(0,b.onChange)(Qw.prototype._setDirty),ns("Transparency",[0,1],.01,{limitedUi:!0}),En()],Sy.prototype,"highlightTransparency",void 0),x1([(0,b.onChange)(Qw.prototype._setDirty),Tv("Color"),En()],Sy.prototype,"outlineColor",void 0),x1([(0,b.onChange)(Qw.prototype._setDirty),jr("Debug")],Sy.prototype,"debugOutline",void 0),Sy=Qw=x1([ks("Outline")],Sy);class xI extends ty{constructor(){super(),this._state="in",this.mouseInOutAnimationEnabled=!0}generateExtension(e){return new Sy(e,this._outlineTarget)}async onAdded(e){this._outlineTarget=e.renderer.createTarget({sizeMultiplier:1}),await super.onAdded(e);const i=e==null?void 0:e.getPluginByType("Picking"),s=new g.jyz({uniforms:{cameraNearFar:{value:new g.FM8(.1,100)}},vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vViewPosition;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:"uniform vec2 cameraNearFar;varying vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);vec2 packedZ=pack16(pow(linearZ,0.5));gl_FragColor=vec4(packedZ.x,packedZ.y,0.,0.);}",side:g.ehD}),o=Rl(e,{passId:"outline",after:["gbuffer"],before:["render"],passObject:new f5(()=>i==null?void 0:i.getSelectedObject(),this._outlineTarget,s),update(){e.scene.renderCamera.updateShaderProperties(this.passObject.overrideMaterial),o.passObject.scene=e.scene.modelObject,o.passObject.camera=e.scene.renderCamera.cameraObject}});e.renderer.registerPass(o),i==null||i.addEventListener("selectedObjectChanged",()=>{!this._animationCallBack&&this._extension&&(i!=null&&i.getSelectedObject()?this._extension.enableDynamicSelection?(this._extension.transparency=1,this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparency=this._extension.highlightTransparency:this._extension.transparency=1)}),document.addEventListener("mousemove",c=>{if(!this._extension||!this.mouseInOutAnimationEnabled)return;const _=i==null?void 0:i.getSelectedObject();_&&this._extension.enableDynamicSelection?c.target!==e.canvas?this._animationCallBack||this._state!=="in"||(this._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),this._state="out"):this._animationCallBack||this._state!=="out"||(this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),this._state="in"):this._extension.transparency=_?this._extension.highlightTransparency:1})}async _startTransparencyAnimation(e,i,s){return CE(this._extension,"transparency",{from:e,to:i,duration:s,onComplete:()=>{this._animationCallBack=null}})}}xI.PluginType="Outline";const MR=.2,m5=Math.PI/24,qN=new g.FM8,IR=(h,e,i)=>{let s=e>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let o=0;o<=12;++o)h.push(e+.17*Math.cos(s),i+.17*Math.sin(s),0,e+MR*Math.cos(s),i+MR*Math.sin(s),0),s+=m5};class XN extends g.Kj0{constructor(e,i,s=!1){super(((et,nt)=>{const st=new g.u9r,at=[],ct=[],dt=et.getSize(new g.Pa4),mt=dt.x/2,yt=(nt?dt.y:dt.z)/2;IR(ct,mt,yt),IR(ct,-mt,yt),IR(ct,-mt,-yt),IR(ct,mt,-yt);const wt=ct.length/3;for(let bt=0;bt<wt-2;bt+=2)at.push(bt,bt+1,bt+3,bt,bt+3,bt+2);const Ct=wt-2;return at.push(Ct,Ct+1,1,Ct,1,0),st.setAttribute("position",new g.a$l(ct,3)),st.setIndex(at),st})(e,s)),this.boundingSize=new g.Pa4,this._raycaster=new g.iMs,this._camera=i,this._placeOnWall=s;const o=this.material;o.side=g.Wl3,o.color=new To(16711935),o.opacity=0,this.userData.bboxVisible=!1;const c=e.getSize(this.boundingSize),_=c.x/2,j=(s?c.y:c.z)/2;this.hitPlane=new g.Kj0(new g._12(2*(_+MR),2*(j+MR))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),s?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,i,s){qN.set(i,-s),this.hitPlane.visible=!0;const o=this._positionAndNormalFromPoint(qN,this.hitPlane);return this.hitPlane.visible=!1,o==null?null:o.position}getExpandedHit(e,i,s){this.hitPlane.scale.set(1e3,1e3,1e3);const o=this.getHit(e,i,s);return this.hitPlane.scale.set(1,1,1),o}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const i=this.material;this.visible=i.opacity>0}dispose(){var s;const{geometry:e,material:i}=this.hitPlane;e.dispose(),i.dispose(),this.geometry.dispose(),this.material.dispose(),(s=this.parent)==null||s.remove(this)}_positionAndNormalFromPoint(e,i){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const s=this._raycaster.intersectObject(i,!0);if(s.length===0)return null;const o=s[0];return o.face==null?null:o.uv==null?{position:o.point,normal:o.face.normal,uv:null}:(o.face.normal.applyNormalMatrix(new g.Vkp().getNormalMatrix(o.object.matrixWorld)),{position:o.point,normal:o.face.normal,uv:o.uv})}}const PB=new g.Pa4;class YN{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new g.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new g.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new g.Pa4,this._hitMatrix=new g.yGw,this.xDamper=new b.Damper,this.yDamper=new b.Damper,this.zDamper=new b.Damper,this.yawDamper=new b.Damper,this.scaleDamper=new b.Damper,this.onSelectStart=e=>{const i=this.transientHitTestSource;if(i==null)return;const s=this.frame.getHitTestResultsForTransientInput(i),o=this.presentedScene,c=this.placementBox;if(s.length===1){this.inputSource=e.inputSource;const{axes:_}=this.inputSource.gamepad||{axes:[0,0]},j=c.getHit(o,_[0],_[1]);c.show=!0,j!=null?(this.isTranslating=!0,this.lastDragPosition.copy(j),this.presentedScene&&(this.presentedScene.visible=!0)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*_[0])}else if(s.length===2){c.show=!0,this.isTwoFingering=!0;const{separation:_}=this.fingerPolar(s);this.firstRatio=_/o.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,i,s){var o;this.transientHitTestSource=await((o=e.requestHitTestSourceForTransientInput)==null?void 0:o.call(e,{profile:"generic-touchscreen"})),this.presentedScene=i,this.placementBox=s,this.session=e,this.placementComplete=!1,this.goalPosition.copy(i.position),this.goalYaw=i.rotation.y,this.goalScale=i.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var o;const i=(o=this.xr)==null?void 0:o.getReferenceSpace(),s=i?e.getPose(i):null;return s?(this._hitMatrix.fromArray(s.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const i=this.presentedScene,s=i.position,o=i.rotation.y,c=this.placementBox,_=Math.max(c.boundingSize.x,c.boundingSize.y,c.boundingSize.z)/2,j=this.goalPosition,et=i.scale.x;if(!j.equals(s)||this.goalScale!==et){let{x:nt,y:st,z:at}=s;nt=this.xDamper.update(nt,j.x,e,_),st=this.yDamper.update(st,j.y,e,_),at=this.zDamper.update(at,j.z,e,_),s.set(nt,st,at);const ct=this.scaleDamper.update(et,this.goalScale,e,1);if(i.scale.set(ct,ct,ct),!this.isTranslating){const dt=j.y-st;this.placementComplete&&!this.placeOnWall?c.offsetHeight=dt/ct:dt===0&&(this.placementComplete=!0,c.show=!1)}}c.updateOpacity(e),i.rotation.y=this.yawDamper.update(o,this.goalYaw,e,Math.PI)}processInput(e){var _;this.frame=e;const i=this.transientHitTestSource;if(!i||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const s=e.getHitTestResultsForTransientInput(i),o=this.presentedScene,c=o.scale.x;if(this.isTwoFingering)if(s.length<2)this.isTwoFingering=!1;else{const{separation:j,deltaYaw:et}=this.fingerPolar(s);if(this.placeOnWall||(this.goalYaw+=et),!o.userData.__scaleDisabled){const nt=j/this.firstRatio;this.goalScale=nt<1.3&&nt>.7692307692307692?1:nt}}else if(s.length!==2)if(this.isRotating&&((_=this.inputSource)!=null&&_.gamepad)){const j=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=j-this.lastAngle,this.lastAngle=j}else this.isTranslating&&(console.log("translating"),s.forEach(j=>{if(j.inputSource!==this.inputSource)return;let et=null;if(j.results.length>0&&(et=this.getHitPoint(j.results[0])),et==null&&(et=this.getTouchLocation()),et!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const nt=et.y-this.lastDragPosition.y;if(nt<0){this.placementBox.offsetHeight=nt/c;const st=PB.copy(this.xr.getCamera().position),at=-nt/(st.y-et.y);st.multiplyScalar(at),et.multiplyScalar(1-at).add(st)}}this.goalPosition.add(et),this.lastDragPosition.copy(et)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:j}=this.fingerPolar(s);this.firstRatio=j/c}}getTouchLocation(){var s;const{axes:e}=this.inputSource.gamepad??{axes:[0,0]},i=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return i!=null&&(PB.copy(i).sub((s=this.xr)==null?void 0:s.getCamera().position),PB.length()>10)?null:i}fingerPolar(e){var et,nt,st,at;const i=((nt=(et=e[0].inputSource)==null?void 0:et.gamepad)==null?void 0:nt.axes)??[0,0],s=((at=(st=e[1].inputSource)==null?void 0:st.gamepad)==null?void 0:at.axes)??[0,0],o=s[0]-i[0],c=s[1]-i[1],_=Math.atan2(c,o);let j=this.lastAngle-_;return j>Math.PI?j-=2*Math.PI:j<-Math.PI&&(j+=2*Math.PI),this.lastAngle=_,{separation:Math.sqrt(o*o+c*c),deltaYaw:j}}}class g5{constructor(e,i,s,o,c){this.xrLight=e,this.renderer=i,this.lightProbe=s,this.xrWebGLBinding=null,this.estimationStartCallback=c,this.frameCallback=this.onXRFrame.bind(this);const _=i.xr.getSession();if(o&&"XRWebGLBinding"in window){const j=new g.oAp(16);e.environment=j.texture;const et=i.getContext();switch(_.preferredReflectionFormat){case"srgba8":et.getExtension("EXT_sRGB");break;case"rgba16f":et.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(_,et),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}_.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const i=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);i&&(e.__webglTexture=i,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,i){if(!this.xrLight)return;i.session.requestAnimationFrame(this.frameCallback);const s=i.getLightEstimate(this.lightProbe);if(s){this.xrLight.lightProbe.sh.fromArray(s.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const o=Math.max(1,Math.max(s.primaryLightIntensity.x,Math.max(s.primaryLightIntensity.y,s.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(s.primaryLightIntensity.x/o,s.primaryLightIntensity.y/o,s.primaryLightIntensity.z/o),this.xrLight.directionalLight.intensity=o,this.xrLight.directionalLight.position.copy(s.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class _5 extends g.ZAu{constructor(e,i=!0){super(),this.lightProbe=new g.lk7,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new g.Ox3,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let s=null,o=!1;e.xr.addEventListener("sessionstart",()=>{const c=e.xr.getSession();"requestLightProbe"in c&&c.requestLightProbe({reflectionFormat:c.preferredReflectionFormat}).then(_=>{s=new g5(this,e,_,i,()=>{o=!0,this.dispatchEvent({type:"estimationstart"})})})}),e.xr.addEventListener("sessionend",()=>{s&&(s.dispose(),s=null),o&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{s&&(s.dispose(),s=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}var cT=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Ww=class extends ms{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new YN,this.dependencies=[zo],this.estimateLighting=!1,this.placeOnWall=!1,this.xrResolutionScale=1,this.toJSON=void 0,this.enterAR=()=>{var h;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already in AR"):((h=this._xrManager)==null||h.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.domOverlay}).then(this._onSessionStarted)):console.error("XR not supported"))},this.exitAR=()=>{this._xrSession&&this._xrSession.end()},this._preRender=()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const h=this._xrManager.getCamera(),e=h.cameras[0]||h,i=this._viewer.scene.activeCamera;i.cameraObject.projectionMatrix.copy(e.projectionMatrix),i.cameraObject.projectionMatrixInverse.copy(i.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var i,s;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const h=this._viewer.renderer,e=(s=(i=this._xrManager)==null?void 0:i.getCamera())==null?void 0:s.cameras[0].viewport;e?h.rendererObject.setViewport(e):console.warn("no viewport for ar camera"),this._viewer.getPlugin(zo).updateShaderProperties(uT.material),uT.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,ls(h.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{uT.render(h.rendererObject,null,h.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0},this._frameCount=0,this._isPresenting=!1,this._preFrame=({xrFrame:h,deltaTime:e})=>{var c,_;if(this.dirty=!!h&&((c=this._xrManager)==null?void 0:c.isPresenting)||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!h)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: AR session init"),this._frameCount++;const i=this._xrManager.getReferenceSpace(),s=h.getViewerPose(i);if(s==null&&this._frameCount,s==null||((_=this._viewer)==null?void 0:_.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const o=this._viewer.scene.activeCamera;this._xrManager.updateCamera(o.cameraObject),o.setDirty(),this.moveToFloor(h),this._touchInputHelper.processInput(h),this._touchInputHelper.moveScene(e),this._updateShadow()},this._preXRState={viewerBg:null,modelScale:new g.Pa4(1,1,1),modelPosition:new g.Pa4,modelRotation:new g._fP,cameraPosition:new g.Pa4(0,0,5),cameraTarget:new g.Pa4,cameraUp:new g.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectioMatrix:new g.yGw,cameraAutoNearFar:void 0,groundOffset:new g.Pa4,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new g.FM8,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.getBackground(!0);const h=this._viewer.scene.modelRoot,e=this._viewer.scene.activeCamera;h.updateMatrix(),h.updateMatrixWorld(!0),this._preXRState.modelScale.copy(h.scale),this._preXRState.modelPosition.copy(h.position),this._preXRState.modelRotation.copy(h.quaternion),this._preXRState.cameraPosition.copy(e.position),this._preXRState.cameraTarget.copy(e.target),this._preXRState.cameraUp.copy(e.cameraObject.up),e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=e.cameraObject.fov,this._preXRState.cameraAspect=e.cameraObject.aspect),this._preXRState.cameraZoom=e.cameraObject.zoom,this._preXRState.cameraNear=e.cameraObject.near,this._preXRState.cameraFar=e.cameraObject.far,this._preXRState.cameraAutoNearFar=e.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectioMatrix.copy(e.cameraObject.projectionMatrix);const i=this._viewer.getPluginByType("Ground");i!=null&&i.mesh&&(this._preXRState.groundOffset.subVectors(h.position,i.mesh.modelObject.position),this._preXRState.groundScale=i.mesh.modelObject.scale.x,this._preXRState.groundRotation=i.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=i.renderToDepth,this._preXRState.groundShadowBaker=i.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const h=20*Math.PI/180,e=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(h),z:-Math.cos(h)});this._viewer.renderer.useTotalFrameCount=!0,this._viewer.resize(),(async()=>{var i,s;if(this._xrSession){this._touchInputHelper.placeOnWall=this.placeOnWall,await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._placementBox);const o=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((s=(i=this._xrSession).requestHitTestSource)==null?void 0:s.call(i,{space:o,offsetRay:e}))}})()},this._xrRenderingEnd=()=>{console.log("webxr: AR session end"),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._removePlacementBox(),this._cancelHitSources(),this._viewer&&(this._viewer.renderer.useTotalFrameCount=!1,this._restorePreXRState())},this._onSessionStarted=async h=>{h.addEventListener("end",this._onSessionEnded),this.estimateLighting&&(this._xrLight=new _5(this._viewer.renderer.rendererObject),this._xrLight.addEventListener("estimationstart",()=>{this._xrSession&&this._xrLight&&(this._viewer.scene.modelRoot.add(this._xrLight),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._viewer.scene.setEnvironment(this._xrLight.environment))})),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(h),this._xrSession=h},this._onSessionEnded=()=>{this._xrSession&&(this._xrSession.removeEventListener("end",this._onSessionEnded),this._xrLight&&(this._xrLight.removeFromParent(),this._xrLight.dispose(),this._xrLight=void 0))}}async onAdded(h){await super.onAdded(h);const e=h.renderer.rendererObject.xr;if(e.enabled=!0,e.cameraAutoUpdate=!1,this._xrManager=e,this._touchInputHelper.xr=e,!this.domOverlay){const i=document.getElementById("tweakpaneUiContainer");this.domOverlay=i?{root:i}:void 0}if(h.addEventListener("preRender",this._preRender),h.addEventListener("postRender",this._postRender),h.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return h.console.error("XR not supported in insecure context, try https://"),this.enabled=!1,void(e.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-ar").then(i=>{if(!i)throw new Error("AR not supported")}).catch(i=>{h.console.error("AR not supported:",i),e.enabled=!1,this.enabled=!1}):(e.enabled=!1,this.enabled=!1)}_updateShadow(){var i,s;if(!this._viewer)return;const h=this._viewer.scene.modelRoot,e=(s=(i=this._viewer.getPluginByType("Ground"))==null?void 0:i.mesh)==null?void 0:s.modelObject;e&&(e.rotation.z=this._viewer.scene.modelRoot.rotation.y,e.position.copy(this._preXRState.groundOffset).multiplyScalar(h.modelObject.scale.x).sub(h.modelObject.position).negate(),e.scale.setScalar(h.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(h){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const e=h.getHitTestResults(this._hitTestSource);if(!e.length)return;const i=e[0];this._touchInputHelper.placeOnWall=this.placeOnWall;const s=this._touchInputHelper.getHitPoint(i);if(!s)return;this._placementBox.show=!0;const o=this._viewer.scene.modelRoot;this._touchInputHelper.goalPosition.copy(s),o.position.copy(s),this._viewer.scene.modelRoot.visible=!0,this._hitTestSource.cancel(),this._hitTestSource=void 0}_removePlacementBox(){this._placementBox&&(this._placementBox.removeFromParent(),this._placementBox=void 0)}_preSetupModel(){var et,nt;const h=this._viewer.scene.modelRoot,e=this._viewer.scene.activeCamera,i=(et=this._xrManager)==null?void 0:et.getCamera(),s=i.cameras[0]||i;this._removePlacementBox();const o=this._viewer.scene.getBounds(!0,!0);o.getSize(new g.Pa4).length()>.01&&(this._placementBox=new XN(o,i,this.placeOnWall),h.add(this._placementBox),this._placementBox.show=!1);const c=i.getWorldDirection(new g.Pa4);h.rotation.y=Math.atan2(-c.x,-c.z)-0,e.cameraObject.zoom=s.zoom,e.cameraObject.near=s.near,e.cameraObject.far=s.far,e.cameraObject.userData.autoNearFar=!1,e.cameraObject.isPerspectiveCamera?(e.cameraObject.fov=s.fov,e.cameraObject.aspect=s.viewport.width/s.viewport.height):console.warn("Perspective camera required."),e.cameraObject.updateProjectionMatrix();const _=h.userData.arScale||1;h.scale.set(_,_,_),h.position.copy(i.position).add(c.multiplyScalar(5)),h.visible=!0;const j=(nt=this._viewer)==null?void 0:nt.getPluginByType("Ground");j!=null&&j.mesh&&(j.shadowBaker.enabled=!1,j.renderToDepth=!1)}_restorePreXRState(){if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const h=this._viewer.scene.modelRoot;h.scale.copy(this._preXRState.modelScale),h.position.copy(this._preXRState.modelPosition),h.quaternion.copy(this._preXRState.modelRotation),h.updateMatrix(),h.updateMatrixWorld(!0),h.visible=!0;const e=this._viewer.scene.activeCamera;e.position.copy(this._preXRState.cameraPosition),e.target.copy(this._preXRState.cameraTarget),e.cameraObject.up.copy(this._preXRState.cameraUp),e.cameraObject.near=this._preXRState.cameraNear,e.cameraObject.far=this._preXRState.cameraFar,e.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(e.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(e.cameraObject.aspect=this._preXRState.cameraAspect)),e.positionUpdated(!1),e.targetUpdated(!0),e.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectioMatrix),e.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectioMatrix).invert(),e.cameraObject.updateMatrixWorld(!0),e.cameraObject.updateProjectionMatrix();const i=this._viewer.getPluginByType("Ground");i!=null&&i.mesh&&(i.mesh.modelObject.position.subVectors(h.position,this._preXRState.groundOffset),i.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),i.mesh.modelObject.rotation.z=this._preXRState.groundRotation,i.renderToDepth=this._preXRState.groundRenderToDepth,i.shadowBaker.enabled=this._preXRState.groundShadowBaker,i.refreshTransform()),this._viewer.scene.setEnvironment(this._preXRState.environment),this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}};Ww.PluginType="WEBXR_ARPlugin",cT([jr("Light Estimate")],Ww.prototype,"estimateLighting",void 0),cT([jr("Place on Wall")],Ww.prototype,"placeOnWall",void 0),cT([ns("Resilution scale",[.1,1],.1)],Ww.prototype,"xrResolutionScale",void 0),cT([Oo("Enter AR")],Ww.prototype,"enterAR",void 0),cT([Oo("Exit AR")],Ww.prototype,"exitAR",void 0),Ww=cT([ks("WebXR AR")],Ww);const uT=new yo({vertexShader:tt.vertexShader,fragmentShader:`
        ${Zp}
        
        uniform float opacity;

		uniform sampler2D tDiffuse;
		uniform sampler2D tTransparentMap;

		varying vec2 vUv;

		void main() {
		
            float depth = getDepth(vUv);
            vec4 texel;
            if(depth>0.9999) {
			    texel = texture2D( tTransparentMap, vUv );
                if(texel.a < 0.01) discard; // background
                // transparent objects with render to depth = false
            }else {
                texel = texture2D( tDiffuse, vUv );
			}
            gl_FragColor = texel;
            
		}
		`,uniforms:{...tt.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});uT.renderToScreen=!1,uT.useExistingRenderTarget=!0,uT.clear=!1;class PR extends b.SimpleEventDispatcher{get state(){return this._state}setState(e,i){this._state=e,this.dispatchEvent({type:e,...i})}_setOptions(e){Object.assign(this.options,e)}setOptions(e){this._setOptions(e)}constructor(e,i){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._frameCount=0,this._ondataavailable=s=>{s.data&&s.data.size>0&&this._currentRecording.push(s.data)},this._canvas=e,i==null||i.mimeType,this.options={mimeType:"auto",frameRate:30,stepMode:!1},this._setOptions(i||this.options)}isRecording(){return this._state==="recording"}requestFrame(){return this._state==="recording"&&(this._frameCount++,!0)}dispose(){(this.isRecording()||this._state==="paused")&&this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()})}}class $N extends PR{constructor(){super(...arguments),this._currentImages=[],this._onstop=e=>{this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]),this.setState("stopped")},this._onerror=e=>{this.setState("error",{error:e}),this._console.error(e)}}start(){if(this.state!=="recording"){if(this.state==="error"&&this._console.warn("Resetting from error state."),this.state==="paused")return this.setState("starting"),void this.setState("recording");this._currentRecording=[],this._currentImages=[],this._frameCount=0,this.setState("starting"),window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async e=>{const i=await(e==null?void 0:e.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=i,this._frameCount=0,this.setState("recording")}).catch(e=>{this._onerror({detail:e})})}else this._console.log("Already recording canvas")}requestFrame(){if(!super.requestFrame())return!1;const e=this.options.mimeType;return this._canvas.toBlob(i=>{this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),i])},e,90),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[]),!0}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}async _writeImages(e){if(!this._imgDirectory)return;const i=[];for(const s of e){const o=await this._imgDirectory.getFileHandle(s[0],{create:!0});i.push((0,b.writeFile)(o,s[1]))}await Promise.all(i)}}class EI extends PR{_setOptions(e){var i;super._setOptions(e),this.options.mimeType&&this.options.mimeType!=="auto"||(this.options.mimeType=EI.GetSupportedMimeTypes([],["h264"],!0)??EI.GetSupportedMimeTypes(void 0,void 0,!0)),this.options.mimeType&&!((i=this.options.mimeType)!=null&&i.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this.options.mimeType="image/png"),this.options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,i){super(e,i),this._resumeSyncTime=0,this._onstop=s=>{var o;if(this._recorder&&this._currentRecording.length>0){const c=new Blob(this._currentRecording,{type:this.options.mimeType});(o=this._recordingCallback)==null||o.call(this,c)}this._recorder=void 0,this.setState("stopped")},this._onstart=s=>{var o;this._frameCount=0,this.options.stepMode&&((o=this._recorder)==null||o.pause()),this.setState("recording")},this._onresume=s=>{if(this.state!=="paused"&&this.state!=="starting"&&this.state!=="stopped"||this.setState("recording"),!this.options.stepMode)return;const o=()=>{var _;this.state==="recording"&&((_=this._recorder)==null||_.pause())},c=Math.min(this._resumeSyncTime-(0,b.now)(),0)+1e3/this.options.frameRate;c>0?(0,b.timeout)(c).then(o):o()},this._onerror=s=>{this.setState("error",{error:s}),this._console.error(s),this._recorder=void 0}}start(){var i,s,o;if(this.state==="recording")return void this._console.log("Already recording canvas");if(this.state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this.state==="paused"?(this.setState("starting"),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this.state);const e={mimeType:this.options.mimeType,videoBitsPerSecond:this.options.videoBitsPerSecond};if(this._currentRecording=[],this._frameCount=0,(i=e.mimeType)==null?void 0:i.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void this.setState("error",{error:new Error("MediaRecorder not supported")});{const c=this._canvas.captureStream(this.options.stepMode?0:this.options.frameRate),_=(s=c.getVideoTracks())==null?void 0:s[0];this._track=_,this._recorder=new window.MediaRecorder(c,e),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.setState("starting"),this._recorder&&((o=this._recorder)==null||o.start())}requestFrame(){return!(!this._recorder||!super.requestFrame()||this._track&&this.options.stepMode&&(this._resumeSyncTime=(0,b.now)(),this._track.requestFrame(),this._recorder.resume(),0))}pause(){this.state!=="paused"&&this.state!=="stopped"&&(this.options.stepMode?console.error("Pause not supported in stepMode"):this._recorder&&(this._recorder.pause(),this.setState("paused")))}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._recorder&&this._recorder.stop()):this._console.error("Recorder in error state, cannot stop, call start again."))}dispose(){this._recorder&&(super.dispose(),this._recorder=void 0)}static GetSupportedMimeTypes(e,i,s=!1){if(!window.MediaRecorder)return s?void 0:[];const o=["webm","ogg","mp4","x-matroska"].filter(j=>!e||e.length<1||e.includes(j)),c=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(j=>!i||i.length<1||i.includes(j)),_=[];return o.forEach(j=>{const et=`video/${j}`;c.forEach(nt=>{[`${et};codecs=${nt}`,`${et};codecs:${nt}`,`${et};codecs=${nt.toUpperCase()}`,`${et};codecs:${nt.toUpperCase()}`,`${et}`].forEach(st=>{MediaRecorder.isTypeSupported(st)&&_.push(st)})})}),s?_.length>0?_[0]:void 0:_}}class hT extends PR{constructor(e,i){super(e,i),this._workerRunning=!1,this.worker=new Worker((0,b.remoteWorkerURL)(hT.LIBRARY_PATH+"ffmpeg-worker-mp4.js",hT.LIBRARY_PATH+"ffmpeg-worker-mp4.wasm")),this.worker.onmessage=s=>{var c;const o=s.data;switch(o.type){case"stdout":case"stderr":if(o.data.indexOf("frame=")===0){const _=parseInt(o.data.split("frame=")[1].split("fps")[0].trim()),j=this._frameCount,et=Math.round(_/j*100);this.dispatchEvent({type:"encode-progress",progress:et,frame:_,totalFrames:j})}console.log(o.data+`
`);break;case"exit":console.log("Process exited with code "+o.data),parseInt(o.data);break;case"done":if(o.data.MEMFS[0].data===void 0)return void console.log("video processing failed");this._workerRunning=!1,(c=this._recordingCallback)==null||c.call(this,new Blob([o.data.MEMFS[0].data],{type:"video/mp4"})),console.timeEnd("ffmpeg-record"),this.setState("stopped")}}}start(){this.state!=="recording"?(this.state==="error"&&console.warn("Resetting from error state."),this.state!=="paused"&&(this._frameCount=0),this.setState("starting"),this.setState("recording")):console.log("Already recording canvas")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onStop()):console.error("Recorder in error state, cannot stop, call start again."))}_onStop(){const e=this._canvas.width%2==0?this._canvas.width:this._canvas.width-1;this._workerRunning=!0,console.time("ffmpeg-record");const i=this.options.frameRate.toString(),s=this.options.frameRate.toString();this.worker.postMessage({type:"run",arguments:["-r",i,"-an","-i","img%03d.jpeg","-c:v","libx264","-crf","17","-filter:v",`scale=${e}:-2`,"-pix_fmt","yuv420p","-b:v","10M","-preset","ultrafast","-r",s,"out.mp4"]})}requestFrame(){return!!super.requestFrame()&&(this.sendBlobToWorker(this._frameCount-1),!0)}sendBlobToWorker(e){this._canvas.toBlob(i=>{this.worker.postMessage({type:"image",file:{name:`img${this.pad(e,3)}.jpeg`,data:i}})},"image/jpeg",90)}pad(e,i){return(e+="").length>=i?e:new Array(i-e.length+1).join("0")+e}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}}hT.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/@repalash/ffmpeg.js@4.2.9005/dist/";var RB=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class Cy extends ms{get recorder(){return this._recorder}constructor(){super(),this.enabled=!0,this.convergeMode=!1,this.mimeType="image/jpeg",this.videoFrameRate=30,this._recorders={},this._renderToScreenDisabled=!1,this._preRender=()=>{var e,i,s;if(this.convergeMode&&((e=this._recorder)!=null&&e.isRecording())){const o=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((s=(i=this._viewer)==null?void 0:i.getPluginByType("Progressive"))==null?void 0:s.isConverged())||!1,o&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,i,s;if((e=this._recorder)!=null&&e.isRecording()&&(!this.convergeMode||(s=(i=this._viewer)==null?void 0:i.getPluginByType("Progressive"))!=null&&s.isConverged(!0))){const o=()=>{var c;return(c=this._recorder)==null?void 0:c.requestFrame()};this.convergeMode?(0,b.timeout)(1).then(o):o()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)},this._refreshUi=()=>{var e;(e=this.uiConfig.children)==null||e.map(i=>(0,b.getOrCall)(i)).flat(2).forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)==null?void 0:s.call(i)})},this.uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"],["MP4 Video (ffmpeg)","video/mp4"]].map(e=>({label:e[0],value:e[1]}))},{type:"input",disabled:!0,label:"State",getValue:()=>{var e;return((e=this.recorder)==null?void 0:e.state)??"not initialized"}},{type:"button",label:()=>{var e;return(e=this.recorder)!=null&&e.isRecording()?"Stop Recording":"Start Recording"},value:()=>{var e;(e=this.recorder)!=null&&e.isRecording()?this.stopRecording().then(async i=>{if(i){const s=i.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(i,s)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var e,i;return!!((e=this.recorder)!=null&&e.isRecording())||!((i=this._viewer)!=null&&i.getPluginByType("CameraViews"))},value:()=>{var e,i;(i=(e=this._viewer)==null?void 0:e.getPluginByType("CameraViews"))==null||i.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var e,i,s,o;return!!((e=this.recorder)!=null&&e.isRecording())||!((i=this._viewer)!=null&&i.getPluginByType("CameraViews"))||!((o=(s=this._viewer)==null?void 0:s.getPluginByType("GLTFAnimation"))!=null&&o.animations.length)},value:()=>{var i,s,o,c;const e=((s=(i=this._viewer)==null?void 0:i.getPluginByType("GLTFAnimation"))==null?void 0:s.animationState)==="playing";(c=(o=this._viewer)==null?void 0:o.getPluginByType("CameraViews"))==null||c.recordAllViews(()=>{var _,j;(j=(_=this._viewer)==null?void 0:_.getPluginByType("GLTFAnimation"))==null||j.playAnimation()}).then(()=>{var _,j;e||((j=(_=this._viewer)==null?void 0:_.getPluginByType("GLTFAnimation"))==null||j.stopAnimation())})}},{type:"button",limitedUi:!0,label:"Record GLTF Anim",hidden:()=>{var e,i,s;return!!((e=this.recorder)!=null&&e.isRecording())||!((s=(i=this._viewer)==null?void 0:i.getPluginByType("GLTFAnimation"))!=null&&s.animations.length)},value:async()=>{var o,c;if((o=this.recorder)!=null&&o.isRecording())return;const e=(c=this._viewer)==null?void 0:c.getPluginByType("GLTFAnimation");if(!e)return;let i=!1;e.loopAnimations&&(i=!0),i&&(e.loopAnimations=!1);const s=await this.record(async()=>e.playAnimation());if(i&&(e.loopAnimations=!0),s){const _=s.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(s,_)}}},{type:"button",limitedUi:!0,label:"Record 360 animation",hidden:()=>{var e;return!!((e=this.recorder)!=null&&e.isRecording())},value:async()=>{var o;if((o=this.recorder)!=null&&o.isRecording()||!this._viewer)return;const e=await this._viewer.prompt("Enter duration in seconds","5",!0);if(e===null)return;const i=parseFloat(e||"5");if(!isFinite(i)||i<=0)return;const s=await this.recordCamera360(i);if(s){const c=s.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(s,c)}}}]},this.refreshRecorderOptions=this.refreshRecorderOptions.bind(this)}isRecording(){var e;return((e=this._recorder)==null?void 0:e.isRecording())??!1}refreshRecorderOptions(){if(!this._viewer)return;let e="image";this.mimeType==="video/mp4"?e="ffmpeg.js":this.mimeType==="auto"?e="canvas-media":this.mimeType.startsWith("image")&&(e="image"),this._recorder=this._getRecorder(e),this._recorder&&this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType,stepMode:this.convergeMode})}async onAdded(e){var i;await super.onAdded(e),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.scene.addEventListener("addSceneObject",this._refreshUi),this._recordIndicator=document.createElement("div"),this._recordIndicator.style.width="20px",this._recordIndicator.style.height="20px",this._recordIndicator.style.backgroundColor="red",this._recordIndicator.style.top="10px",this._recordIndicator.style.left="10px",this._recordIndicator.style.position="absolute",this._recordIndicator.style.borderRadius="100%",this._recordIndicator.style.visibility="hidden",(i=e.canvas.parentElement)==null||i.appendChild(this._recordIndicator),this.refreshRecorderOptions()}_stateChange(e){var i,s;this.dirty=e,(i=this._viewer)==null||i.setDirty(),(s=this.uiConfig.children)==null||s.map(o=>(0,b.getOrCall)(o)).flat(2).forEach(o=>{var c;return(c=o==null?void 0:o.uiRefresh)==null?void 0:c.call(o)})}async onRemove(e){var i;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),e.scene.removeEventListener("addSceneObject",this._refreshUi),(i=this._recorder)==null||i.dispose(),Object.values(this._recorders).forEach(s=>{s==null||s.dispose()}),super.onRemove(e)}async record(e,i){var s;if(this.enabled&&!((s=this._recorder)!=null&&s.isRecording()))return await new Promise((o,c)=>{const _=()=>{this.removeEventListener("start",j),this.removeEventListener("stop",_),this.removeEventListener("error",et)},j=async()=>{_(),i==null||i(),await e(),o()},et=async()=>{_(),c()};this.addEventListener("start",j),this.addEventListener("stop",_),this.addEventListener("error",et),this.startRecording()}),await this.stopRecording()}startRecording(){var e;return!!this.enabled&&((e=this.recorder)==null?void 0:e.isRecording())===!1&&(this.recorder.options.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if((e=this.recorder)!=null&&e.isRecording())return new Promise((i,s)=>{var o;return(o=this.recorder)==null?void 0:o.stop(i)})}async _downloadBlob(e,i){var c,_,j;const s=await((c=this._viewer)==null?void 0:c.prompt("Canvas Recorder: Save file as","recording.mp4",!1)),o=(_=this._viewer)==null?void 0:_.getPluginByType("FileTransferPlugin");o?await o.exportFile(e,s||"recording.mp4"):(j=this._viewer)==null||j.console.error("FileTransferPlugin required to export/download file")}async recordCamera360(e){var st;if((st=this.recorder)!=null&&st.isRecording()||!this._viewer)return;const i=this._viewer.scene.activeCamera;let s=i.interactionsEnabled;for(;!s;)this._viewer.setDirty(),await this._viewer.doOnce("postFrame"),this._viewer.console.warn("interactions are already disabled by something, waiting..."),s=i.interactionsEnabled;s&&(i.interactionsEnabled=!1);const o=i.target.clone(),c=i.position.clone().sub(o),_=await this._viewer.getPluginByType("PopmotionPlugin");if(!_)return void console.error("Popmotion plugin not found");const j=new g.$V().setFromVector3(c);i.position.setFromSpherical(j).add(o),i.positionUpdated(!0);const et=i.autoLookAtTarget;i.autoLookAtTarget=!0;const nt=await this.record(async()=>_.animate({from:j.theta,to:j.theta+2*Math.PI,duration:1e3*e,ease:fA.linear,onUpdate:at=>{j.theta=at,i.position.setFromSpherical(j).add(o),i.positionUpdated(!0)}}).promise);return i.autoLookAtTarget=et,i.position.copy(c).add(o),i.positionUpdated(!0),s&&(i.interactionsEnabled=!0),nt}_getRecorder(e){if(!this._viewer)throw new Error("No viewer");if(this._recorders[e])return this._recorders[e];let i;return i=e==="canvas-media"?new EI(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):e==="ffmpeg.js"?new hT(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):new $N(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),i.addEventListener("starting",()=>this._stateChange(!1)),i.addEventListener("recording",()=>{this._recordIndicator.style.visibility="visible",this._recordIndicator.style.backgroundColor="red",this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),i.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),i.addEventListener("paused",()=>this._stateChange(!1)),i.addEventListener("stopped",()=>{this._recordIndicator.style.visibility="hidden",this.dispatchEvent({type:"stop"}),this._stateChange(!1)}),i.addEventListener("encode-progress",s=>{this.dispatchEvent({...s})}),this._recorders[e]=i,i}}Cy.PluginType="CanvasRecorder",RB([(0,b.onChange)(Cy.prototype.refreshRecorderOptions),En()],Cy.prototype,"convergeMode",void 0),RB([(0,b.onChange)(Cy.prototype.refreshRecorderOptions),En()],Cy.prototype,"mimeType",void 0),RB([(0,b.onChange)(Cy.prototype.refreshRecorderOptions),En()],Cy.prototype,"videoFrameRate",void 0);var RR=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};const DB=new g.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});DB.depthTest=!1;const kB=new g.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});kB.depthTest=!1;class Jv extends m_{constructor(e={},i=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new g.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=i,i&&this.dependencies.push(vy)}async onAdded(e){const i=e.renderer.createTarget({type:g.ywz,format:g.wk1,colorSpace:g.aCh,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:g.wem,magFilter:g.wem});i.texture.name="groundContactDepthTexture";const s=new g.lRF({depthPacking:g.z81});s.onBeforeCompile=function(c){c.uniforms.opacity.value=1,c.fragmentShader=`
						${c.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const o=new Dm(i,s,new g.Ilk(0,0,0),0);this._depthPass=o,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject,null);const e=this._viewer.renderer.getTempTarget({type:g.ywz,format:g.wk1,colorSpace:g.aCh,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:g.wem,magFilter:g.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,i=1){this._viewer&&this._depthPass&&(DB.uniforms.h.value=i*this.blurAmount/256,kB.uniforms.v.value=i*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:DB,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:kB,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new g.Pa4)),this.shadowCamera.setRotationFromEuler(new g.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)==null||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var i;if(!this._viewer)return!1;const e=super._refreshMaterial();return this._material&&(this._material.alphaMap=((i=this._depthPass)==null?void 0:i.target.texture)||null,e&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),e}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}function KN(h,e,i,s){h.traverse(o=>{o&&(o.userData.cloneRotI=e,o.userData.rotationCount=i,o.userData.rotationAxis=s,o.addEventListener("beforeRender",c=>function(_,j){var et;j&&((et=j.map)!=null&&et.isTexture)&&(j.extraUniformsToUpload||(j.extraUniformsToUpload={}),j.extraUniformsToUpload.uvTransform||(j.extraUniformsToUpload.uvTransform={value:new g.Vkp}),j.extraUniformsToUpload.uvTransform.value.setUvTransform(j.map.offset.x*j.map.repeat.x*_.userData.cloneRotI/(_.userData.rotationCount||1),j.map.offset.y*j.map.repeat.y*_.userData.cloneRotI/(_.userData.rotationCount||1),j.map.repeat.x,j.map.repeat.y,j.map.rotation,j.map.center.x,j.map.center.y))}(o,c.material)))})}function JN(h,e,i,s="x"){if(h.userData.rotationCount>1&&!h.userData.rotationRoot)return h;const o=h.parent;if(!o)throw new Error("No parent");if(h.userData.cloneParent){const _=h.userData.cloneParent;if(!(h=o.children.find(j=>_===j.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",_,o),h}let c=o.children.filter(_=>{var j;return((j=_.userData)==null?void 0:j.cloneParent)===h.uuid}).sort((_,j)=>_.userData.cloneRotI-j.userData.cloneRotI);if(h.userData.rotationCount===e&&e===c.length&&i===void 0&&h.userData.rotationAxis===s)return h;if(i==null&&(i=h.userData.rotationSkips??[]),i!==h.userData.rotationSkips&&(h.userData.rotationSkips=[...i]),KN(h,0,e,s),h.userData.rotationRoot=!0,h.visible=!0,e<=c.length){for(let _=e-1;_<c.length;_++)o.remove(c[_]),c[_].traverse(j=>j.userData={__disposed:!0});c=c.slice(0,e)}for(let _=1;_<e;_++){const j=_<=c.length?c[_-1]:h.clone();j.rotation.copy(h.rotation),j.rotation[s]+=_/e*Math.PI*2,KN(j,_,e,s),_>c.length&&o.add(j),j.visible=!i.includes(_)}return h.visible=!i.includes(0),h}Jv.PluginType="ContactShadowGroundPlugin",RR([(0,b.onChange)(Jv.prototype.refreshOptions),En()],Jv.prototype,"contactShadows",void 0),RR([En(),(0,b.onChange)(Jv.prototype._setDirty)],Jv.prototype,"blurAmount",void 0),RR([En(),(0,b.onChange)(Jv.prototype._refreshShadowCameraFrustum)],Jv.prototype,"shadowScale",void 0),RR([En(),(0,b.onChange)(Jv.prototype._refreshShadowCameraFrustum)],Jv.prototype,"shadowHeight",void 0);var dT,SI=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Ty=dT=class extends ms{async onAdded(h){var e;await super.onAdded(h),(e=h.getPluginByType("Picking"))==null||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}_selectedObjectChanged(){var i,s,o,c,_,j,et;if(!this.enabled)return;const h=(s=(i=this._viewer)==null?void 0:i.getPluginByType("Picking"))==null?void 0:s.getSelectedObject();if(!h)return void((c=(o=this.uiConfig).uiRefresh)==null?void 0:c.call(o,"postFrame",!0));const e=h.userData.rotationRoot?h.userData.rotationCount??1:1;this.rotations=e,this.skips=((_=h.userData.rotationSkips)==null?void 0:_.join(","))??"",this.axis=h.userData.rotationAxis||"x",(et=(j=this.uiConfig).uiRefresh)==null||et.call(j,"postFrame",!0)}_paramsChanged(){var e,i,s,o,c,_;if(!this.enabled)return;const h=(i=(e=this._viewer)==null?void 0:e.getPluginByType("Picking"))==null?void 0:i.getSelectedObject();if(h){if(this.rotations>1||h.userData.rotationCount){const j=h.userData.rotationCount,et=JN(h,this.rotations,this.skips.split(",").map(st=>parseInt(st)).filter(st=>isFinite(st)),this.axis),nt=et==null?void 0:et.userData.rotationCount;if(nt&&nt!==j){const st=[];et==null||et.traverseAncestors(at=>{st.push(at)});for(const at of st)if(at.userData.autoScaled){Ks(at),(s=this._viewer)==null||s.resetCamera({rootObject:at,centerOffset:new g.Pa4(4,4,4)});break}}h.parent&&!h.userData.__disposed||((c=(o=this._viewer)==null?void 0:o.getPluginByType("Picking"))==null||c.setSelectedObject(et,!0))}(_=this._viewer)==null||_.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};Ty.PluginType="ObjectRotationPlugin",SI([En(),jr("Enabled"),(0,b.onChange)(dT.prototype._paramsChanged)],Ty.prototype,"enabled",void 0),SI([ns("Rotation Count",[1,100],1,h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&i.getSelectedObject())||!h.rotations}})),(0,b.onChange)(dT.prototype._paramsChanged)],Ty.prototype,"rotations",void 0),SI([Pm("Axis",["x","y","z"].map(h=>({label:h})),h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&i.getSelectedObject())||!h.rotations}})),(0,b.onChange)(dT.prototype._paramsChanged)],Ty.prototype,"axis",void 0),SI([$s("Rotation Skips",h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&i.getSelectedObject())||!h.rotations}})),(0,b.onChange)(dT.prototype._paramsChanged)],Ty.prototype,"skips",void 0),Ty=dT=SI([ks("Object Rotations")],Ty);var hS,pT=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let P0=hS=class extends ms{constructor(h=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,i,s)=>{if(i.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const o of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=os(e.fragmentShader,`#include <${o}>`,g.WdD[o].replace(/\bv\w+Uv\b/g,"parallaxUv.xy",{replaceAll:!0}));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=os(e.fragmentShader,"texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=os(e.fragmentShader,"#include <normal_fragment_maps>",os(os(g.WdD.normal_fragment_maps,"#elif defined( USE_NORMALMAP_TANGENTSPACE )","#elif defined( USE_NORMALMAP_TANGENTSPACE ) && !defined( USE_BUMPMAP )"),"normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vBumpMapUv,0.);float parallaxHeight;vec2 texCoords=vBumpMapUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vBumpMapUv);vec2 duv2=dFdy(vBumpMapUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vBumpMapUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var i;return this.enabled+" "+((i=e.materialObject.bumpMap)==null?void 0:i.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:i},s)=>{if(this.enabled)for(const[o,c]of Object.entries(this._defines)){const _=typeof c=="number"?c:c?1:0;i.defines[o]!==_&&(i.defines[o]=_,i.needsUpdate=!0)}}},this.dependencies=[Fr],this.enabled=h,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var h,e,i;(e=(h=this._bumpMapExtension)==null?void 0:h.setDirty)==null||e.call(h),(i=this._viewer)==null||i.setDirty()}async onAdded(h){var e,i;return(i=(e=h.getPlugin(Fr))==null?void 0:e.materials)==null||i.registerMaterialExtension(this._bumpMapExtension),super.onAdded(h)}async onRemove(h){var e,i;return(i=(e=h.getPlugin(Fr))==null?void 0:e.materials)==null||i.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(h)}};P0.PluginType="ReliefParallaxMapping",pT([(0,b.onChange)(hS.prototype._updateExtension),En(),jr("Enabled")],P0.prototype,"enabled",void 0),pT([(0,b.onChange)(hS.prototype._updateExtension),jr("Debug Normals")],P0.prototype,"debugNormals",void 0),pT([(0,b.onChange)(hS.prototype._updateExtension),jr("Debug Hit Height")],P0.prototype,"debugHitHeight",void 0),pT([Hr("PARALLAX_MAP_STEPS",void 0,!0,hS.prototype._updateExtension),ns("Step count",[1,32],1),En()],P0.prototype,"stepCount",void 0),pT([Hr("PARALLAX_MAP_B_STEPS",void 0,!0,hS.prototype._updateExtension),ns("Binary search steps",[1,8],1),En()],P0.prototype,"binaryStepCount",void 0),P0=hS=pT([ks("Parallax Mapping")],P0);class OB extends g.u9r{constructor(e,i,s=32,o=64,c=!1,_=new g.FM8(1,1),j="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:i,shape:e,shapeSegments:s,tubularSegments:o,closed:c,primary:j,shapeScale:_.clone()};const et=i.computeFrenetFrames(o,c);this.frames=et;const nt=new g.Pa4,st=new g.Pa4,at=new g.Pa4,ct=new g.FM8;let dt=new g.Pa4;const mt=[],yt=[],wt=[],Ct=e.getSpacedPoints(s);for(const Pt of Ct)Pt.multiply(_);(function(){for(let Pt=0;Pt<o;Pt++)At(Pt);At(c===!1?o:0),function(){for(let Pt=0;Pt<=o;Pt++)for(let Dt=0;Dt<=s;Dt++)ct.x=Pt/o,ct.y=Dt/s,yt.push(ct.x,ct.y)}(),function(){const Pt=j==="shape",Dt=Pt?s:o,Nt=Pt?o:s;for(let Vt=1;Vt<=Dt;Vt++)for(let Zt=1;Zt<=Nt;Zt++){const[an,fn]=Pt?[Zt,Vt]:[Vt,Zt],mn=(s+1)*(an-1)+(fn-1),Sn=(s+1)*an+(fn-1),An=(s+1)*an+fn,wn=(s+1)*(an-1)+fn;wt.push(mn,Sn,wn),wt.push(Sn,An,wn)}}()})(),this.setIndex(wt),this.setAttribute("position",new g.a$l(mt,3)),this.setAttribute("uv",new g.a$l(yt,2)),this.computeVertexNormals();const bt=this.attributes.normal;function At(Pt){dt=i.getPointAt(Pt/o,dt);const Dt=et.normals[Pt],Nt=et.binormals[Pt];for(let Vt=0;Vt<=s;Vt++){const Zt=Ct[Vt%s];st.set(0,0,0).addScaledVector(Dt,Zt.x).addScaledVector(Nt,Zt.y),nt.copy(dt).add(st),mt.push(nt.x,nt.y,nt.z)}}(function(){for(let Dt=1;Dt<s;Dt++){const Nt=Dt+o*(s+1);st.fromBufferAttribute(bt,Dt),at.fromBufferAttribute(bt,Nt),st.add(at).normalize(),bt.setXYZ(Dt,st.x,st.y,st.z),bt.setXYZ(Nt,st.x,st.y,st.z)}for(let Dt=1;Dt<o;Dt++){const Nt=Dt*(s+1),Vt=Nt+s;st.fromBufferAttribute(bt,Nt),at.fromBufferAttribute(bt,Vt),st.add(at).normalize(),bt.setXYZ(Nt,st.x,st.y,st.z),bt.setXYZ(Vt,st.x,st.y,st.z)}st.fromBufferAttribute(bt,0),at.fromBufferAttribute(bt,s),st.add(at);const Pt=o*(s+1);at.fromBufferAttribute(bt,Pt),st.add(at),at.fromBufferAttribute(bt,Pt+s),st.add(at),st.normalize(),bt.setXYZ(0,st.x,st.y,st.z),bt.setXYZ(s,st.x,st.y,st.z),bt.setXYZ(Pt,st.x,st.y,st.z),bt.setXYZ(Pt+s,st.x,st.y,st.z),bt.needsUpdate=!0})()}createSplits(e){this.clearGroups();const i=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,s=this.index.count,o=[...e,1].sort((j,et)=>j-et);let c=0,_=0;for(const j of o){const et=Math.round(i*j)*s/i;this.addGroup(c,et-c,_++),c=et}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var BB,E1=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Av=BB=class extends ms{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new g.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var s,o;const h=(o=(s=this._viewer)==null?void 0:s.getPlugin(Bo))==null?void 0:o.getSelectedObject();if(!h)return;let e=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!e)return;e=parseFloat(e);const i=new LB(0,0,e,e,0,2*Math.PI,!0,0);await this.extrudeObject(h,i)}}async onAdded(h){await super.onAdded(h)}static CreateCurve(h,e){if(h==="circle")return new LB(0,0,e.radius??1,e.radius??1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(h,e,i=this.shapeSegments,s=this.tubularSegments,o=this.shapeScale,c=this.materialSplits.split(",").map(j=>parseFloat(j.trim())),_=this.horizontalSplits){var ct,dt,mt,yt,wt,Ct,bt,At;if(h.userData.isExtrudedTube,h.userData._extrudeSource){const Pt=h.userData._extrudeSource;if(h=(ct=h.parent)==null?void 0:ct.children.find(Dt=>Pt===Dt.uuid),!h)return void console.warn("Could not find extrude source with uuid",Pt)}if(h.userData.extrudedObject){const Pt=h.userData.extrudedObject,Dt=(dt=h.parent)==null?void 0:dt.children.find(Nt=>Pt===Nt.uuid);Dt&&(Dt.removeFromParent(),Dt.geometry.dispose(),Dt.geometry=null,Dt.material=null),delete h.userData.extrudedObject}const j=h.geometry;if(!j)return void((mt=this._viewer)==null?void 0:mt.alert("Extrude: No geometry to extrude"));const et=[h.material];let nt;try{const Pt=BB.ConvertGeometryToFlatShape(j);nt=new OB(Pt,e,i,s,!0,o,_?"shape":"path"),nt.computeBoundingBox(),nt.createSplits(c)}catch(Pt){return void((yt=this._viewer)==null?void 0:yt.alert(typeof Pt=="string"?Pt:Pt==null?void 0:Pt.message))}et[0].color.set(16777215);for(let Pt=et.length;Pt<nt.groups.length;Pt++){const Dt=et[0].clone();et.push(Dt),Dt.color.set(16777215*Math.random())}const st=new g.Kj0(nt,et);st.userData._extrudeSource=h.uuid,st.userData.isExtrudedTube=!0,h.visible=!1,h.userData.bboxVisible=!1,st.name=h.name+"_extruded";const at=await((bt=(Ct=(wt=this._viewer)==null?void 0:wt.getManager())==null?void 0:Ct.importer)==null?void 0:bt.processImportedSingle(st,{autoCenter:!1,autoScale:!1}));at&&((At=h.parent)==null||At.add(at.modelObject),h.userData.extrudedObject=at.modelObject.uuid,at.dispatchEvent({type:"select",ui:!0,value:at}))}static ExtrudeShape(h,e,i,s,o,c,_,j){const et=new OB(h,s,e,i,!0,new g.FM8(o,c),j?"shape":"path");et.computeBoundingBox(),et.createSplits(_);const nt=new g.Kj0(et,[]);return nt.userData.isExtrudedTube=!0,nt}static ConvertGeometryToFlatShape(h,e=!0){if(h.userData.__planarShape)return h.userData.__planarShape;let i=h.attributes.position;if(!i)throw"no position attribute";if(i.count>500)throw"too large to extrude";const s=h;i=s.attributes.position,s.boundingBox||s.computeBoundingBox();const o=s.boundingBox.getSize(new g.Pa4),c=o.x<.001?"x":o.y<.001?"y":o.z<.001?"z":null;if(!c)throw"geometry is not axis aligned not planar";let _=[];for(let et=0;et<i.count;et++){const nt=new g.FM8;c==="x"?nt.set(i.getY(et),i.getZ(et)):c==="y"?nt.set(i.getX(et),i.getZ(et)):nt.set(i.getX(et),i.getY(et)),_.push(nt)}if(e){let et=0;for(let nt=0;nt<_.length;nt++)(_[nt].x<_[et].x||_[nt].x===_[et].x&&_[nt].y<_[et].y)&&(et=nt);et!==0&&(_=_.slice(et).concat(_.slice(0,et)))}const j=new g.bnF(_);return h.userData.__planarShape=j,j}};Av.PluginType="ShapeTubeExtrudePlugin",E1([jr("Enabled")],Av.prototype,"enabled",void 0),E1([ns("Shape Segments (X)",[1,100],1,h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPlugin(Bo))!=null&&i.getSelectedObject())}}))],Av.prototype,"shapeSegments",void 0),E1([ns("Tube Segments (Y)",[1,100],1,h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPlugin(Bo))!=null&&i.getSelectedObject())}}))],Av.prototype,"tubularSegments",void 0),E1([Lp("Shape scale",[.01,10],.01,h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPlugin(Bo))!=null&&i.getSelectedObject())}}))],Av.prototype,"shapeScale",void 0),E1([$s("Material Splits",h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPlugin(Bo))!=null&&i.getSelectedObject())}}))],Av.prototype,"materialSplits",void 0),E1([jr("Horizontal Splits",h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPlugin(Bo))!=null&&i.getSelectedObject())}}))],Av.prototype,"horizontalSplits",void 0),E1([Oo("Extrude Circle Tube",h=>({hidden:()=>{var e,i;return!((i=(e=h._viewer)==null?void 0:e.getPlugin(Bo))!=null&&i.getSelectedObject())}}))],Av.prototype,"extrudeCirceTube",void 0),Av=BB=E1([ks("Extrude Tube Shapes")],Av);class LB extends g.Ny0{getPoint(e,i){return super.getPoint(e,i||new g.Pa4)}}class fT extends ms{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var c,_;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((c=this._viewer.getPluginByType("FrameFade"))==null||c.enable(fT.PluginType),this._fadeDisabled=!1));const i=(0,b.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=i-1/60);let s=i-this._lastFrameTime;this._lastFrameTime=i;const o=(_=this._viewer.getPluginByType("Progressive"))==null?void 0:_.postFrameConvergedRecordingDelta();if(o&&o>0&&(s=o),o!==0&&(s*=1e3,!(s<=.001)&&(this._updaters.forEach(j=>{let et=s;j.time+et<0&&(et=-j.time),j.time+=et,Math.abs(et)>.001&&j.u(et)}),!this._fadeDisabled&&this.disableFrameFade))){const j=this._viewer.getPluginByType("FrameFade");j&&(j.disable(fT.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=i=>({start:()=>this._updaters.push({u:i,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(s=>s.u===i),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const i=Bp(),s={id:i,options:e,stop:()=>{var o,c,_;(o=this.animations[i])!=null&&o._stop?(_=(c=this.animations[i])==null?void 0:c._stop)==null||_.call(c):console.warn("Animation not started")}};return this.animations[i]=s,s.promise=new Promise((o,c)=>{const _={driver:this.defaultDriver,...e,onComplete:()=>{var et;try{(et=e.onComplete)==null||et.call(e)}catch(nt){return void c(nt)}o()},onStop:()=>{var et;try{(et=e.onStop)==null||et.call(e)}catch(nt){return void c(nt)}o()}},j=b0(_);this.animations[i]._stop=j.stop,this.animations[i].options=_}).then(()=>(delete this.animations[i],i)),this.animations[i]}async animateAsync(e){return this.animate(e).promise}}fT.PluginType="PopmotionPlugin";var NB,My,Xu=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};const __=h=>({onChange:e=>{e.last&&h.onChange()}});let Yp=NB=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.textAnchor="middle",this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(h){Object.assign(this,h)}reset(){const h=this.onChange;Object.assign(this,new NB),this.onChange=h}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor,textAnchor:this.textAnchor}}};Xu([$s("Text",__)],Yp.prototype,"text",void 0),Xu([ns("Font Size",[2,400],1,__)],Yp.prototype,"fontSize",void 0),Xu([ns("Width",[2,4096],1,__)],Yp.prototype,"width",void 0),Xu([ns("Height",[2,4096],1,__)],Yp.prototype,"height",void 0),Xu([ns("X Offset",[-1024,1024],1,__)],Yp.prototype,"xOffset",void 0),Xu([ns("Y Offset",[-1024,1024],1,__)],Yp.prototype,"yOffset",void 0),Xu([ns("V-Width",[2,4096],1,__)],Yp.prototype,"boxWidth",void 0),Xu([ns("V-Height",[2,4096],1,__)],Yp.prototype,"boxHeight",void 0),Xu([Pm("Text Anchor",["start","middle","end"].map(h=>({label:h})),__)],Yp.prototype,"textAnchor",void 0),Xu([$s("Font",__)],Yp.prototype,"fontFamily",void 0),Xu([$s("Font Url",__)],Yp.prototype,"fontPath",void 0),Xu([jr("Mask Text",__)],Yp.prototype,"maskText",void 0),Xu([jr("Inner Shadow",__)],Yp.prototype,"innerShadow",void 0),Xu([Tv("Text Color",__)],Yp.prototype,"textColor",void 0),Xu([Tv("BG Fill",__)],Yp.prototype,"bgFillColor",void 0),Xu([Tv("SVG BG",__)],Yp.prototype,"svgBackground",void 0),Yp=NB=Xu([ks("Text SVG Options")],Yp);const ZN={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},CI=h=>({hidden:()=>{const e=h.getSelected();return!e||!e.userData[bv.PluginType]}});let bv=My=class extends ms{async onAdded(h){var e;await super.onAdded(h),(e=h.getPluginByType("Picking"))==null||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.getSelected=()=>{var h,e;return(e=(h=this._viewer)==null?void 0:h.getPluginByType("Picking"))==null?void 0:e.getSelectedObject()},this.options=new Yp,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}_selectedObjectChanged(){var i,s,o,c,_,j;if(!this.enabled)return;const h=this.getSelected();if(!h)return void((s=(i=this.uiConfig).uiRefresh)==null?void 0:s.call(i,"postFrame",!0));const e=h.userData[My.PluginType];if(!e)return this.options.reset(),this._lastMeta=void 0,void((c=(o=this.uiConfig).uiRefresh)==null?void 0:c.call(o,"postFrame",!0));this._lastMeta!==e&&(this.options.set(e),this._lastMeta=e),(j=(_=this.uiConfig).uiRefresh)==null||j.call(_,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const h=this.getSelected();h&&h.isMesh&&h.userData[My.PluginType]&&this.updateText(h,this.options.toJSON())}async addTextToSelected(){var e;const h=this.getSelected();h&&h.isMesh?h.material?(h.userData[My.PluginType]||!h.material.map||await((e=this._viewer)==null?void 0:e.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(h):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(h,e){return this.updateText(h,Object.assign(this.options.toJSON(),e))}async updateText(h,e){var c,_;if(!h.isMesh)return;if(!h.material)return void console.error("updateText: no material on mesh");let i=h.userData[My.PluginType];i||(h.userData[My.PluginType]=i={}),Object.assign(i,e);const s=h.material;s.map&&(s.map._isSimpleTextTexture&&s.map.dispose(),s.map=void 0),s.alphaMap&&(s.alphaMap._isSimpleTextTexture&&s.alphaMap.dispose(),s.alphaMap=void 0),s.bumpMap&&(s.bumpMap._isSimpleTextTexture&&s.bumpMap.dispose(),s.bumpMap=void 0);const o=await this.makeTextSvg(i);this.applyToMap&&(s.map=o),this.applyToAlphaMap&&(s.alphaMap=o,s.transparent=!0),this.applyToBumpMap&&(s.bumpMap=o),s.userData.inverseAlphaMap=this.inverseAlphaMap,s.setDirty(),s.needsUpdate=!0,(_=(c=this.uiConfig).uiRefresh)==null||_.call(c,"postFrame",!0)}async makeTextSvg(h){const e=h.fontFamily||"Arial",i=h.fontPath||this.fonts[e]||"";let s=h.style;if(i.length>0){const _=i.split("?")[0].split(".").pop()||"woff";s+=`
`+(i.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${i}) format(${ZN[_]||_});
            }`:"")}let o=function({text:_="Custom Text",svgBackground:j="#ffffff",xOffset:et=0,yOffset:nt=0,width:st=1024,height:at=1024,boxWidth:ct=1024,boxHeight:dt=1024,fontFamily:mt="",fontSize:yt=32,maskText:wt=!0,innerShadow:Ct=!0,bgFillColor:bt="#000000",textColor:At="#ffffff",textAnchor:Pt="middle",style:Dt=""}){return`
<svg style="background-color:${j}" width="${st}" height="${at}" viewBox="0 0 ${ct} ${dt}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${Dt}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: ${Pt}; font-size: ${yt}px; font-family: ${mt||"Arial"}">
        <defs>

`+(wt?`
<mask id="textMask">
<text style="fill:white; font-size: ${yt}px;" x="${et+ct/2}" y="${dt/2+nt+yt/4}" > ${_} </text>
</mask>
`:"")+`

`+(Ct?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(wt?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${ct}" height="${dt}" style="fill:${bt}"/>
        <text style="${Ct?"filter: url(#innerShadow);":""} fill:${At};" x="${et+ct/2}" y="${dt/2+nt+yt/4}"> ${_} </text>

`+(wt?`
        </g>
`:"")+`

    </g>
</svg>
`}({...h,fontFamily:e,style:s});o=await(0,b.embedUrlRefs)(o,async _=>this._getAssetData(_)),o=(0,b.svgUrl)(o);const c=await this._viewer.getManager().importer.importSinglePath(o,{generateMipmaps:!1,minFilter:g.wem});return c._isSimpleTextTexture=!0,c.flipY=!1,c.needsUpdate=!0,c}async _getAssetData(h){var i,s;if(h.startsWith("http://www.w3.org"))return h;const e=(s=(i=this._viewer)==null?void 0:i.getManager())==null?void 0:s.importer;if(!e)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new u3(e.loadingManager),processImported:!1};try{return await e.importPath(h,this._assetLoadOptions)}catch(o){return console.error(o),""}}};bv.PluginType="SimpleTextPlugin",Xu([Jp(void 0,{params:CI})],bv.prototype,"options",void 0),Xu([jr("Apply Map",CI),(0,b.onChange)(My.prototype._paramsChanged)],bv.prototype,"applyToMap",void 0),Xu([jr("Apply Bump Map",CI),(0,b.onChange)(My.prototype._paramsChanged)],bv.prototype,"applyToBumpMap",void 0),Xu([jr("Apply Alpha Map",CI),(0,b.onChange)(My.prototype._paramsChanged)],bv.prototype,"applyToAlphaMap",void 0),Xu([jr("Invert Alpha Map",CI),(0,b.onChange)(My.prototype._paramsChanged)],bv.prototype,"inverseAlphaMap",void 0),Xu([Oo("Add Text",h=>({hidden:()=>!h.getSelected()}))],bv.prototype,"addTextToSelected",null),bv=My=Xu([ks("Simple Text")],bv);class UB{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class v5{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class BA{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new BA;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(i=>i.clone()),e}invert(){for(let i=0;i<this.polygons.length;i++)this.polygons[i].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let i=new Array,s=new Array;for(let o=0;o<e.length;o++)this.plane.splitPolygon(e[o],i,s,i,s);return this.front&&(i=this.front.clipPolygons(i)),s=this.back?this.back.clipPolygons(s):[],i.concat(s)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const i=[],s=[];for(let o=0;o<e.length;o++)this.plane.splitPolygon(e[o],this.polygons,this.polygons,i,s);i.length&&(this.front||(this.front=new BA),this.front.build(i)),s.length&&(this.back||(this.back=new BA),this.back.build(s))}}class wv{constructor(e=0,i=0,s=0){this.x=e,this.y=i,this.z=s}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new wv(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,i){return this.add(new wv().copy(e).sub(this).times(i))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const i=this.clone(),s=i.x,o=i.y,c=i.z,_=e.x,j=e.y,et=e.z;return this.x=o*et-c*j,this.y=c*_-s*et,this.z=s*j-o*_,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new g.Pa4(this.x,this.y,this.z)}}class dS{constructor(e,i){this.normal=e,this.w=i,this.normal=e,this.w=i}clone(){return new dS(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,i,s,o,c){let _=0;const j=[];for(let et=0;et<e.vertices.length;et++){const nt=this.normal.dot(e.vertices[et].pos)-this.w,st=nt<-dS.EPSILON?2:nt>dS.EPSILON?1:0;_|=st,j.push(st)}switch(_){case 0:(this.normal.dot(e.plane.normal)>0?i:s).push(e);break;case 1:o.push(e);break;case 2:c.push(e);break;case 3:{const et=[],nt=[];for(let st=0;st<e.vertices.length;st++){const at=(st+1)%e.vertices.length,ct=j[st],dt=j[at],mt=e.vertices[st],yt=e.vertices[at];if(ct!=2&&et.push(mt),ct!=1&&nt.push(ct!=2?mt.clone():mt),(ct|dt)==3){const wt=(this.w-this.normal.dot(mt.pos))/this.normal.dot(new wv().copy(yt.pos).sub(mt.pos)),Ct=mt.interpolate(yt,wt);et.push(Ct),nt.push(Ct.clone())}}et.length>=3&&o.push(new mT(et,e.shared)),nt.length>=3&&c.push(new mT(nt,e.shared));break}}}static fromPoints(e,i,s){const o=new wv().copy(i).sub(e).cross(new wv().copy(s).sub(e)).normalize();return new dS(o.clone(),o.dot(e))}}dS.EPSILON=1e-5;class mT{constructor(e,i){this.vertices=e,this.shared=i,this.plane=dS.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new mT(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class DR{constructor(e,i,s,o){this.pos=new wv().copy(e),this.normal=new wv().copy(i),this.uv=new wv().copy(s),this.uv.z=0,o&&(this.color=new wv().copy(o))}clone(){return new DR(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,i){return new DR(this.pos.clone().lerp(e.pos,i),this.normal.clone().lerp(e.normal,i),this.uv.clone().lerp(e.uv,i),this.color&&e.color&&this.color.clone().lerp(e.color,i))}}class _p{constructor(){this.polygons=new Array}static fromPolygons(e){const i=new _p;return i.polygons=e,i}static fromGeometry(e,i){let s=[];const o=e.attributes.position,c=e.attributes.normal,_=e.attributes.uv,j=e.attributes.color,et=e.groups;let nt;if(e.index)nt=e.index.array;else{nt=new Array(o.array.length/o.itemSize|0);for(let at=0;at<nt.length;at++)nt[at]=at}const st=nt.length/3|0;s=new Array(st);for(let at=0,ct=0,dt=nt.length;at<dt;at+=3,ct++){const mt=new Array(3);for(let yt=0;yt<3;yt++){const wt=nt[at+yt],Ct=3*wt,bt=2*wt,At=o.array[Ct],Pt=o.array[Ct+1],Dt=o.array[Ct+2],Nt=c.array[Ct],Vt=c.array[Ct+1],Zt=c.array[Ct+2],an=_==null?void 0:_.array[bt],fn=_==null?void 0:_.array[bt+1];mt[yt]=new DR(new wv(At,Pt,Dt),new wv(Nt,Vt,Zt),new wv(an,fn,0),j&&new wv(j.array[bt],j.array[bt+1],j.array[bt+2]))}if(i===void 0&&et&&et.length>0)for(const yt of et)at>=yt.start&&at<yt.start+yt.count&&(s[ct]=new mT(mt,yt.materialIndex));else s[ct]=new mT(mt,i)}return _p.fromPolygons(s.filter(at=>!isNaN(at.plane.normal.x)))}static toGeometry(e,i){let s=0;const o=e.polygons;for(const dt of o)s+=dt.vertices.length-2;const c=new g.u9r,_=new UB(3*s*3),j=new UB(3*s*3),et=new v5(2*s*3);let nt;const st=[],at=[];for(const dt of o){const mt=dt.vertices,yt=mt.length;dt.shared!==void 0&&(st[dt.shared]||(st[dt.shared]=[])),yt&&mt[0].color!==void 0&&(nt||(nt=new UB(3*s*3)));for(let wt=3;wt<=yt;wt++)(dt.shared===void 0?at:st[dt.shared]).push(_.top/3,_.top/3+1,_.top/3+2),_.write(mt[0].pos),_.write(mt[wt-2].pos),_.write(mt[wt-1].pos),j.write(mt[0].normal),j.write(mt[wt-2].normal),j.write(mt[wt-1].normal),et&&(et.write(mt[0].uv),et.write(mt[wt-2].uv),et.write(mt[wt-1].uv)),nt&&(nt.write(mt[0].color),nt.write(mt[wt-2].color),nt.write(mt[wt-1].color))}c.setAttribute("position",new g.TlE(_.array,3)),c.setAttribute("normal",new g.TlE(j.array,3)),et&&c.setAttribute("uv",new g.TlE(et.array,2)),nt&&c.setAttribute("color",new g.TlE(nt.array,3));for(let dt=0;dt<st.length;dt++)st[dt]===void 0&&(st[dt]=[]);if(st.length){let dt=[],mt=0;for(let yt=0;yt<st.length;yt++)c.addGroup(mt,st[yt].length,yt),mt+=st[yt].length,dt=dt.concat(st[yt]);c.addGroup(mt,at.length,st.length),dt=dt.concat(at),c.setIndex(dt)}const ct=new g.yGw().copy(i).invert();return c.applyMatrix4(ct),c.computeBoundingSphere(),c.computeBoundingBox(),c}static fromMesh(e,i){const s=_p.fromGeometry(e.geometry,i),o=new g.Pa4,c=new g.Vkp;c.getNormalMatrix(e.matrix);for(let _=0;_<s.polygons.length;_++){const j=s.polygons[_];for(let et=0;et<j.vertices.length;et++){const nt=j.vertices[et];nt.pos.copy(o.copy(nt.pos.toVector3()).applyMatrix4(e.matrix)),nt.normal.copy(o.copy(nt.normal.toVector3()).applyMatrix3(c))}}return s}static toMesh(e,i,s){const o=_p.toGeometry(e,i),c=new g.Kj0(o,s);return c.matrix.copy(i),c.matrix.decompose(c.position,c.quaternion,c.scale),c.rotation.setFromQuaternion(c.quaternion),c.updateMatrixWorld(),c.castShadow=c.receiveShadow=!0,c}static union(e,i){const s=_p.fromMesh(e),o=_p.fromMesh(i);return _p.toMesh(s.union(o),e.matrix,e.material)}static subtract(e,i){const s=_p.fromMesh(e),o=_p.fromMesh(i);return _p.toMesh(s.subtract(o),e.matrix,e.material)}static intersect(e,i){const s=_p.fromMesh(e),o=_p.fromMesh(i);return _p.toMesh(s.intersect(o),e.matrix,e.material)}clone(){const e=new _p;return e.polygons=this.polygons.map(i=>i.clone()).filter(i=>Number.isFinite(i.plane.w)),e}toPolygons(){return this.polygons}union(e){const i=new BA(this.clone().polygons),s=new BA(e.clone().polygons);return i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),_p.fromPolygons(i.allPolygons())}subtract(e){const i=new BA(this.clone().polygons),s=new BA(e.clone().polygons);return i.invert(),i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),i.invert(),_p.fromPolygons(i.allPolygons())}intersect(e){const i=new BA(this.clone().polygons),s=new BA(e.clone().polygons);return i.invert(),s.clipTo(i),s.invert(),i.clipTo(s),s.clipTo(i),i.build(s.allPolygons()),i.invert(),_p.fromPolygons(i.allPolygons())}inverse(){const e=this.clone();for(const i of e.polygons)i.flip();return e}toMesh(e,i){return _p.toMesh(this,e,i)}toGeometry(e){return _p.toGeometry(this,e)}}var gT=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};const FB=["union","subtract","intersect"];class qw extends ms{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[Bo],this.rootMesh=new g.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var i;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(i=e.getPlugin(Bo))==null||i.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var i,s;const e=(s=(i=this._viewer)==null?void 0:i.getPlugin(Bo))==null?void 0:s.getSelectedObject();e&&e.geometry&&(e.userData._isCSGMesh||(e.userData.csgBrush||(e.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&(0,b.downloadBlob)(e,"csg."+e.ext)}async exportObject(){var o,c;const e=(c=(o=this._viewer)==null?void 0:o.getPluginByType("AssetExporterPlugin"))==null?void 0:c.exporter;if(!e||!this.rootObject)return;const i=this.rootMesh.visible;this.rootMesh.visible=!0;const s=await e.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=i,s}_updateSelectedProperties(){var i,s;const e=(s=(i=this._viewer)==null?void 0:i.getPlugin(Bo))==null?void 0:s.getSelectedObject();e&&e.userData.csgBrush&&(e.userData.csgBrush.enabled=this.csgSelectedEnabled,e.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var i,s,o,c,_,j;const e=(s=(i=this._viewer)==null?void 0:i.getPlugin(Bo))==null?void 0:s.getSelectedObject();e&&(this.csgSelectedEnabled=((o=e.userData.csgBrush)==null?void 0:o.enabled)??!1,this.csgSelectedOperation=((c=e.userData.csgBrush)==null?void 0:c.operation)??"union"),(j=(_=this.uiConfig)==null?void 0:_.uiRefresh)==null||j.call(_,"postFrame",!0)}_preFrame(){var i,s;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const e=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(i=this.rootObject)==null||i.modelObject.updateMatrixWorld(!0),(this.rootMesh.userData.dispose??this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(e)),this.rootMesh&&!this.rootMesh.parent&&((s=this.rootObject)==null||s.modelObject.add(this.rootMesh)),this.showResult?(e.forEach(o=>{o[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(e.forEach(o=>{o[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var i;const e=[];return(i=this._viewer)==null||i.scene.traverse(s=>{var o;s.isMesh&&s.geometry&&((o=s.userData.csgBrush)!=null&&o.enabled)&&e.push([s,s.userData.csgBrush.operation])}),e}_sceneUpdate(e){var i,s;(s=(i=e==null?void 0:e.object)==null?void 0:i.userData)!=null&&s._isCSGMesh||(this._csgNeedsUpdate=!0)}}gT([jr("Show Result",h=>({onChange:()=>{var e;return(e=h._viewer)==null?void 0:e.setDirty()}}))],qw.prototype,"showResult",void 0),gT([Oo("Make CSG Brush",h=>({hidden:()=>{var i,s;const e=(s=(i=h._viewer)==null?void 0:i.getPlugin(Bo))==null?void 0:s.getSelectedObject();return!(e!=null&&e.userData)||!!e.userData.csgBrush||e.userData._isCSGMesh}}))],qw.prototype,"makeSelectedCSGBrush",null),gT([jr("Enabled",h=>({hidden:()=>{var i,s;const e=(s=(i=h._viewer)==null?void 0:i.getPlugin(Bo))==null?void 0:s.getSelectedObject();return!e||!e.userData.csgBrush},onChange:h._updateSelectedProperties}))],qw.prototype,"csgSelectedEnabled",void 0),gT([Pm("Operation",FB.map(h=>({label:h})),h=>({hidden:()=>{var i,s;const e=(s=(i=h._viewer)==null?void 0:i.getPlugin(Bo))==null?void 0:s.getSelectedObject();return!e||!e.userData.csgBrush},onChange:h._updateSelectedProperties}))],qw.prototype,"csgSelectedOperation",void 0),gT([Oo("Refresh CSG")],qw.prototype,"refreshCSG",null),gT([Oo("Export Result",h=>({hidden:()=>{var e;return!((e=h._viewer)!=null&&e.getPluginByType("AssetExporterPlugin"))}}))],qw.prototype,"downloadObject",null);function eU(h,e){let i=new _p;const s=h.map(c=>c[0].material).flatMap(c=>c);h.forEach(([c,_])=>{if(!FB.includes(_))return void console.error(`Unknown operation ${_}`);c.updateMatrix(),c.updateMatrixWorld();const j=c.matrix;c.matrix=c.matrixWorld;let et=0;et=Array.isArray(c.material)?void 0:s.indexOf(c.material),i=i[_](_p.fromMesh(c,et)),c.matrix=j});const o=i.toMesh(e??new g.yGw().identity(),s);return o.userData._isCSGMesh=!0,o.geometry.groups=o.geometry.groups.filter(c=>c.count>0),o}let TI=class extends qw{_buildCSGMesh(h){return eU(h)}};TI.PluginType="CSGPluginBSP",TI=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_}([ks("CSG Plugin (BSP)")],TI);const tU=0,nU=1,rU=3,iU=4;class Xw{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,i){let s=1/0,o=-1/0;for(let c=0,_=e.length;c<_;c++){const j=e[c][i];s=j<s?j:s,o=j>o?j:o}this.min=s,this.max=o}setFromPoints(e,i){let s=1/0,o=-1/0;for(let c=0,_=i.length;c<_;c++){const j=i[c],et=e.dot(j);s=et<s?et:s,o=et>o?et:o}this.min=s,this.max=o}isSeparated(e){return this.min>e.max||e.min>this.max}}Xw.prototype.setFromBox=function(){const h=new g.Pa4;return function(e,i){const s=i.min,o=i.max;let c=1/0,_=-1/0;for(let j=0;j<=1;j++)for(let et=0;et<=1;et++)for(let nt=0;nt<=1;nt++){h.x=s.x*j+o.x*(1-j),h.y=s.y*et+o.y*(1-et),h.z=s.z*nt+o.z*(1-nt);const st=e.dot(h);c=Math.min(st,c),_=Math.max(st,_)}this.min=c,this.max=_}}();const y5=function(){const h=new g.Pa4,e=new g.Pa4,i=new g.Pa4;return function(s,o,c){const _=s.start,j=h,et=o.start,nt=e;i.subVectors(_,et),h.subVectors(s.end,s.start),e.subVectors(o.end,o.start);const st=i.dot(nt),at=nt.dot(j),ct=nt.dot(nt),dt=i.dot(j),mt=j.dot(j)*ct-at*at;let yt,wt;yt=mt!==0?(st*at-dt*ct)/mt:0,wt=(st+yt*at)/ct,c.x=yt,c.y=wt}}(),jB=function(){const h=new g.FM8,e=new g.Pa4,i=new g.Pa4;return function(s,o,c,_){y5(s,o,h);let j=h.x,et=h.y;if(j>=0&&j<=1&&et>=0&&et<=1)return s.at(j,c),void o.at(et,_);if(j>=0&&j<=1)return et<0?o.at(0,_):o.at(1,_),void s.closestPointToPoint(_,!0,c);if(et>=0&&et<=1)return j<0?s.at(0,c):s.at(1,c),void o.closestPointToPoint(c,!0,_);{let nt,st;nt=j<0?s.start:s.end,st=et<0?o.start:o.end;const at=e,ct=i;return s.closestPointToPoint(st,!0,e),o.closestPointToPoint(nt,!0,i),at.distanceToSquared(st)<=ct.distanceToSquared(nt)?(c.copy(at),void _.copy(st)):(c.copy(nt),void _.copy(ct))}}}(),A5=function(){const h=new g.Pa4,e=new g.Pa4,i=new g.JOQ,s=new g.Zzh;return function(o,c){const{radius:_,center:j}=o,{a:et,b:nt,c:st}=c;if(s.start=et,s.end=nt,s.closestPointToPoint(j,!0,h).distanceTo(j)<=_||(s.start=et,s.end=st,s.closestPointToPoint(j,!0,h).distanceTo(j)<=_)||(s.start=nt,s.end=st,s.closestPointToPoint(j,!0,h).distanceTo(j)<=_))return!0;const at=c.getPlane(i);if(Math.abs(at.distanceToPoint(j))<=_){const ct=at.projectPoint(j,e);if(c.containsPoint(ct))return!0}return!1}}(),b5=1e-15;function _T(h){return Math.abs(h)<b5}class LA extends g.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new g.Pa4),this.satBounds=new Array(4).fill().map(()=>new Xw),this.points=[this.a,this.b,this.c],this.sphere=new g.aLr,this.plane=new g.JOQ,this.needsUpdate=!0}intersectsSphere(e){return A5(e,this)}update(){const e=this.a,i=this.b,s=this.c,o=this.points,c=this.satAxes,_=this.satBounds,j=c[0],et=_[0];this.getNormal(j),et.setFromPoints(j,o);const nt=c[1],st=_[1];nt.subVectors(e,i),st.setFromPoints(nt,o);const at=c[2],ct=_[2];at.subVectors(i,s),ct.setFromPoints(at,o);const dt=c[3],mt=_[3];dt.subVectors(s,e),mt.setFromPoints(dt,o),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(j,e),this.needsUpdate=!1}}LA.prototype.closestPointToSegment=function(){const h=new g.Pa4,e=new g.Pa4,i=new g.Zzh;return function(s,o=null,c=null){const{start:_,end:j}=s,et=this.points;let nt,st=1/0;for(let at=0;at<3;at++){const ct=(at+1)%3;i.start.copy(et[at]),i.end.copy(et[ct]),jB(i,s,h,e),nt=h.distanceToSquared(e),nt<st&&(st=nt,o&&o.copy(h),c&&c.copy(e))}return this.closestPointToPoint(_,h),nt=_.distanceToSquared(h),nt<st&&(st=nt,o&&o.copy(h),c&&c.copy(_)),this.closestPointToPoint(j,h),nt=j.distanceToSquared(h),nt<st&&(st=nt,o&&o.copy(h),c&&c.copy(j)),Math.sqrt(st)}}(),LA.prototype.intersectsTriangle=function(){const h=new LA,e=new Array(3),i=new Array(3),s=new Xw,o=new Xw,c=new g.Pa4,_=new g.Pa4,j=new g.Pa4,et=new g.Pa4,nt=new g.Zzh,st=new g.Zzh,at=new g.Zzh;return function(ct,dt=null,mt=!1){this.needsUpdate&&this.update(),ct.isExtendedTriangle?ct.needsUpdate&&ct.update():(h.copy(ct),h.update(),ct=h);const yt=this.plane,wt=ct.plane;if(Math.abs(yt.normal.dot(wt.normal))>1-1e-10){const Ct=this.satBounds,bt=this.satAxes;i[0]=ct.a,i[1]=ct.b,i[2]=ct.c;for(let Dt=0;Dt<4;Dt++){const Nt=Ct[Dt],Vt=bt[Dt];if(s.setFromPoints(Vt,i),Nt.isSeparated(s))return!1}const At=ct.satBounds,Pt=ct.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let Dt=0;Dt<4;Dt++){const Nt=At[Dt],Vt=Pt[Dt];if(s.setFromPoints(Vt,e),Nt.isSeparated(s))return!1}for(let Dt=0;Dt<4;Dt++){const Nt=bt[Dt];for(let Vt=0;Vt<4;Vt++){const Zt=Pt[Vt];if(c.crossVectors(Nt,Zt),s.setFromPoints(c,e),o.setFromPoints(c,i),s.isSeparated(o))return!1}}return dt&&(mt||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),dt.start.set(0,0,0),dt.end.set(0,0,0)),!0}{const Ct=this.points;let bt=!1,At=0;for(let mn=0;mn<3;mn++){const Sn=Ct[mn],An=Ct[(mn+1)%3];nt.start.copy(Sn),nt.end.copy(An),nt.delta(_);const wn=bt?st.start:st.end,Mn=_T(wt.distanceToPoint(Sn));if(_T(wt.normal.dot(_))&&Mn){st.copy(nt),At=2;break}if((wt.intersectLine(nt,wn)||Mn)&&!_T(wn.distanceTo(An))){if(At++,bt)break;bt=!0}}if(At===1&&ct.containsPoint(st.end))return dt&&(dt.start.copy(st.end),dt.end.copy(st.end)),!0;if(At!==2)return!1;const Pt=ct.points;let Dt=!1,Nt=0;for(let mn=0;mn<3;mn++){const Sn=Pt[mn],An=Pt[(mn+1)%3];nt.start.copy(Sn),nt.end.copy(An),nt.delta(j);const wn=Dt?at.start:at.end,Mn=_T(yt.distanceToPoint(Sn));if(_T(yt.normal.dot(j))&&Mn){at.copy(nt),Nt=2;break}if((yt.intersectLine(nt,wn)||Mn)&&!_T(wn.distanceTo(An))){if(Nt++,Dt)break;Dt=!0}}if(Nt===1&&this.containsPoint(at.end))return dt&&(dt.start.copy(at.end),dt.end.copy(at.end)),!0;if(Nt!==2)return!1;if(st.delta(_),at.delta(j),_.dot(j)<0){let mn=at.start;at.start=at.end,at.end=mn}const Vt=st.start.dot(_),Zt=st.end.dot(_),an=at.start.dot(_),fn=at.end.dot(_);return(Vt===fn||an===Zt||Zt<an!=Vt<fn)&&(dt&&(et.subVectors(st.start,at.start),et.dot(_)>0?dt.start.copy(st.start):dt.start.copy(at.start),et.subVectors(st.end,at.end),et.dot(_)<0?dt.end.copy(st.end):dt.end.copy(at.end)),!0)}}}(),LA.prototype.distanceToPoint=function(){const h=new g.Pa4;return function(e){return this.closestPointToPoint(e,h),e.distanceTo(h)}}(),LA.prototype.distanceToTriangle=function(){const h=new g.Pa4,e=new g.Pa4,i=["a","b","c"],s=new g.Zzh,o=new g.Zzh;return function(c,_=null,j=null){const et=_||j?s:null;if(this.intersectsTriangle(c,et))return(_||j)&&(_&&et.getCenter(_),j&&et.getCenter(j)),0;let nt=1/0;for(let st=0;st<3;st++){let at;const ct=i[st],dt=c[ct];this.closestPointToPoint(dt,h),at=dt.distanceToSquared(h),at<nt&&(nt=at,_&&_.copy(h),j&&j.copy(dt));const mt=this[ct];c.closestPointToPoint(mt,h),at=mt.distanceToSquared(h),at<nt&&(nt=at,_&&_.copy(mt),j&&j.copy(h))}for(let st=0;st<3;st++){const at=i[st],ct=i[(st+1)%3];s.set(this[at],this[ct]);for(let dt=0;dt<3;dt++){const mt=i[dt],yt=i[(dt+1)%3];o.set(c[mt],c[yt]),jB(s,o,h,e);const wt=h.distanceToSquared(e);wt<nt&&(nt=wt,_&&_.copy(h),j&&j.copy(e))}}return Math.sqrt(nt)}}();const vT=1e-14,yT=1e-10,Yw=new g.Zzh,Pp=new g.Zzh,$w=new g.Pa4,sU=new g.Pa4,MI=new g.JOQ,w5=new LA;function II(h){return h.a.distanceToSquared(h.b)<vT||h.a.distanceToSquared(h.c)<vT||h.b.distanceToSquared(h.c)<vT}class x5{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new g.CJI),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class E5{constructor(){this.trianglePool=new x5,this.triangles=[],this.normal=new g.Pa4}initialize(e){const{triangles:i,trianglePool:s,normal:o}=this;if(i.length=0,s.clear(),Array.isArray(e))for(let c=0,_=e.length;c<_;c++){const j=e[c];if(c===0)j.getNormal(o);else if(Math.abs(1-j.getNormal($w).dot(o))>vT)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const et=s.getTriangle();et.copy(j),i.push(et)}else{e.getNormal(o);const c=s.getTriangle();c.copy(e),i.push(c)}}splitByTriangle(e){const{normal:i,triangles:s}=this;if(e.getPlane(MI),Math.abs(1-Math.abs(MI.normal.dot(i)))<yT){const o=[e.a,e.b,e.c];for(let c=0;c<3;c++){const _=(c+1)%3,j=o[c],et=o[_];$w.subVectors(et,j).normalize(),sU.crossVectors(i,$w),MI.setFromNormalAndCoplanarPoint(sU,j),this.splitByPlane(MI,e,c)}for(let c=0,_=s.length;c<_;c++)s[c].coplanarCount=0}else this.splitByPlane(MI,e)}splitByPlane(e,i=null,s=-1){const{triangles:o,trianglePool:c}=this;let _=null;i!==null&&(_=w5,_.copy(i),_.needsUpdate=!0);for(let j=0,et=o.length;j<et;j++){const nt=o[j],{a:st,b:at,c:ct}=nt;if(_&&!_.intersectsTriangle(nt,Yw,!0))continue;let dt=0,mt=-1,yt=0,wt=!1;const Ct=[st,at,ct];for(let bt=0;bt<3;bt++){const At=(bt+1)%3;Yw.start.copy(Ct[bt]),Yw.end.copy(Ct[At]);const Pt=e.distanceToPoint(Yw.start),Dt=e.distanceToPoint(Yw.end);if(Math.abs(Pt)<yT&&Math.abs(Dt)<yT){wt=!0;break}if(Math.abs(Pt)<yT)continue;Pt>0&&yt++;let Nt=!!e.intersectLine(Yw,$w);!Nt&&Math.abs(Dt)<yT&&($w.copy(Yw.end),Nt=!0),!Nt||$w.distanceTo(Yw.start)<vT||($w.distanceTo(Yw.end)<vT&&(mt=bt),dt===0?Pp.start.copy($w):Pp.end.copy($w),dt++)}if(!wt)if(dt===2&&Pp.distance()>yT)if(mt!==-1){mt=(mt+1)%3;let bt=0;bt===mt&&(bt=(bt+1)%3);let At=bt+1;At===mt&&(At=(At+1)%3);const Pt=c.getTriangle();Pt.a.copy(Ct[At]),Pt.b.copy(Pp.end),Pt.c.copy(Pp.start),II(Pt)||o.push(Pt),nt.a.copy(Ct[bt]),nt.b.copy(Pp.start),nt.c.copy(Pp.end),II(nt)&&(o.splice(j,1),j--,et--)}else{const bt=Ct.findIndex(Vt=>yt>=2?e.distanceToPoint(Vt)<0:e.distanceToPoint(Vt)>0);if(bt===0){let Vt=Pp.start;Pp.start=Pp.end,Pp.end=Vt}else if(bt===-1)continue;const At=(bt+1)%3,Pt=(bt+2)%3,Dt=c.getTriangle(),Nt=c.getTriangle();Ct[At].distanceToSquared(Pp.start)<Ct[Pt].distanceToSquared(Pp.end)?(Dt.a.copy(Ct[At]),Dt.b.copy(Pp.start),Dt.c.copy(Pp.end),Nt.a.copy(Ct[At]),Nt.b.copy(Ct[Pt]),Nt.c.copy(Pp.start)):(Dt.a.copy(Ct[Pt]),Dt.b.copy(Pp.start),Dt.c.copy(Pp.end),Nt.a.copy(Ct[At]),Nt.b.copy(Ct[Pt]),Nt.c.copy(Pp.end)),nt.a.copy(Ct[bt]),nt.b.copy(Pp.end),nt.c.copy(Pp.start),II(Dt)||o.push(Dt),II(Nt)||o.push(Nt),II(nt)&&(o.splice(j,1),j--,et--)}else dt===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function oU(){return typeof SharedArrayBuffer<"u"}function S5(h){if(h.buffer instanceof SharedArrayBuffer)return h;const e=h.constructor,i=h.buffer,s=new SharedArrayBuffer(i.byteLength),o=new Uint8Array(i);return new Uint8Array(s).set(o,0),new e(s)}class aU{constructor(e,i=500){const s=oU()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new s(i*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:i,array:s,expansionFactor:o}=this;e===null&&(e=~~(s.length*o));const c=new i(e);c.set(s,0),this.array=c}push(...e){let{array:i,length:s}=this;s+e.length>i.length&&(this.expand(),i=this.array);for(let o=0,c=e.length;o<c;o++)i[s+o]=e[o];this.length+=e.length}clear(){this.length=0}}class C5{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:i,groupAttributes:s}=this;let o=0;for(let c=0;c<i;c++)o+=s[c][e].length;return o}getGroupSet(e=0){const{groupAttributes:i}=this;if(i[e])return this.groupCount=Math.max(this.groupCount,e+1),i[e];const s=i[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=i.length;){const o={};i.push(o);for(const c in s)o[c]=new aU(s[c].type)}return i[e]}getGroupArray(e,i=0){const{groupAttributes:s}=this;if(!s[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(i)[e]}initializeArray(e,i){const{groupAttributes:s}=this,o=s[0][e];if(o){if(o.type!==i)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let c=0,_=s.length;c<_;c++)s[c][e]=new aU(i)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(i=>{for(const s in i)i[s].clear()})}delete(e){this.groupAttributes.forEach(i=>{delete i[e]})}reset(){this.groupAttributes=[]}}class T5{constructor(e){this.triangle=new g.CJI().copy(e),this.intersects={}}addTriangle(e,i){this.intersects[e]=new g.CJI().copy(i)}getIntersectArray(){const e=[],{intersects:i}=this;for(const s in i)e.push(i[s]);return e}}class lU{constructor(){this.data={}}addTriangleIntersection(e,i,s,o){const{data:c}=this;c[e]||(c[e]=new T5(i)),c[e].addTriangle(s,o)}getTrianglesAsArray(e=null){const{data:i}=this,s=[];if(e!==null)e in i&&s.push(i[e].triangle);else for(const o in i)s.push(i[o].triangle);return s}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:i}=this;return i[e]?Object.keys(i[e].intersects).map(s=>parseInt(s)):[]}getIntersectionsAsArray(e=null,i=null){const{data:s}=this,o=new Set,c=[],_=j=>{if(s[j])if(i!==null)s[j].intersects[i]&&c.push(s[j].intersects[i]);else{const et=s[j].intersects;for(const nt in et)o.has(nt)||(o.add(nt),c.push(et[nt]))}};if(e!==null)_(e);else for(const j in s)_(j);return c}reset(){this.data={}}}class M5{constructor(){this.enabled=!1,this.triangleIntersectsA=new lU,this.triangleIntersectsB=new lU,this.intersectionEdges=[]}addIntersectingTriangles(e,i,s,o){const{triangleIntersectsA:c,triangleIntersectsB:_}=this;c.addTriangleIntersection(e,i,s,o),_.addTriangleIntersection(s,o,e,i)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}class cU{constructor(){this.intersectionSet={},this.ids=[]}add(e,i){const{intersectionSet:s,ids:o}=this;s[e]||(s[e]=[],o.push(e)),s[e].push(i)}}const S1=new g.zHn,uU=new g.yGw,j_=new g.CJI,Kw=new g.Pa4,hU=new g.Ltg,dU=new g.Ltg,pU=new g.Ltg,zB=new g.Ltg,kR=new g.Ltg,OR=new g.Ltg,VB=new g.Zzh,GB=new g.Pa4,HB=1e-8,I5=1e-15,BR=-1,LR=1,fU=-2,QB=2,NR=0,UR=1,WB=2;let FR=null;function mU(h){FR=h}function gU(h,e){function i(){return Math.random()-.5}h.getNormal(GB),S1.direction.copy(GB),h.getMidpoint(S1.origin);let s=0,o=1/0;for(let c=0;c<3;c++){S1.direction.x+=i()*HB,S1.direction.y+=i()*HB,S1.direction.z+=i()*HB,S1.direction.multiplyScalar(-1);const _=e.raycastFirst(S1,g.ehD);if(_&&S1.direction.dot(_.face.normal)>0&&s++,_!==null&&(o=Math.min(o,_.distance)),o<=I5)return _.face.normal.dot(GB)>0?QB:fU;if(s/3>.5||(c-s+1)/3>.5)break}return s/3>.5?BR:LR}function P5(h,e,i,s,o,c,_=!1){const j=i.attributes,et=i.index,nt=3*h,st=et.getX(nt+0),at=et.getX(nt+1),ct=et.getX(nt+2);for(const dt in c){const mt=j[dt],yt=c[dt];if(!(dt in j))throw new Error(`CSG Operations: Attribute ${dt} not available on geometry.`);const wt=mt.itemSize;dt==="position"?(j_.a.fromBufferAttribute(mt,st).applyMatrix4(s),j_.b.fromBufferAttribute(mt,at).applyMatrix4(s),j_.c.fromBufferAttribute(mt,ct).applyMatrix4(s),qB(j_.a,j_.b,j_.c,e,3,yt,_)):dt==="normal"?(j_.a.fromBufferAttribute(mt,st).applyNormalMatrix(o),j_.b.fromBufferAttribute(mt,at).applyNormalMatrix(o),j_.c.fromBufferAttribute(mt,ct).applyNormalMatrix(o),_&&(j_.a.multiplyScalar(-1),j_.b.multiplyScalar(-1),j_.c.multiplyScalar(-1)),qB(j_.a,j_.b,j_.c,e,3,yt,_,!0)):(hU.fromBufferAttribute(mt,st),dU.fromBufferAttribute(mt,at),pU.fromBufferAttribute(mt,ct),qB(hU,dU,pU,e,wt,yt,_))}}function R5(h,e,i,s,o,c,_,j=!1){XB(h,s,o,c,_,j),XB(j?i:e,s,o,c,_,j),XB(j?e:i,s,o,c,_,j)}function _U(h,e,i=!1){switch(h){case tU:if(e===LR||e===QB&&!i)return UR;break;case nU:if(i){if(e===BR)return NR}else if(e===LR||e===fU)return UR;break;case rU:if(e===BR)return NR;if(e===LR)return UR;break;case iU:if(e===BR||e===QB&&!i)return UR;break;default:throw new Error(`Unrecognized CSG operation enum "${h}".`)}return WB}function qB(h,e,i,s,o,c,_=!1,j=!1){const et=nt=>{c.push(nt.x),o>1&&c.push(nt.y),o>2&&c.push(nt.z),o>3&&c.push(nt.w)};zB.set(0,0,0,0).addScaledVector(h,s.a.x).addScaledVector(e,s.a.y).addScaledVector(i,s.a.z),kR.set(0,0,0,0).addScaledVector(h,s.b.x).addScaledVector(e,s.b.y).addScaledVector(i,s.b.z),OR.set(0,0,0,0).addScaledVector(h,s.c.x).addScaledVector(e,s.c.y).addScaledVector(i,s.c.z),j&&(zB.normalize(),kR.normalize(),OR.normalize()),et(zB),_?(et(OR),et(kR)):(et(kR),et(OR))}function XB(h,e,i,s,o,c=!1){for(const _ in o){const j=e[_],et=o[_];if(!(_ in e))throw new Error(`CSG Operations: Attribute ${_} no available on geometry.`);const nt=j.itemSize;_==="position"?(Kw.fromBufferAttribute(j,h).applyMatrix4(i),et.push(Kw.x,Kw.y,Kw.z)):_==="normal"?(Kw.fromBufferAttribute(j,h).applyNormalMatrix(s),c&&Kw.multiplyScalar(-1),et.push(Kw.x,Kw.y,Kw.z)):(et.push(j.getX(h)),nt>1&&et.push(j.getY(h)),nt>2&&et.push(j.getZ(h)),nt>3&&et.push(j.getW(h)))}}const C1=new g.yGw,jR=new g.Vkp,pS=new g.CJI,zR=new g.CJI,VR=new g.CJI,GR=new g.CJI;function D5(h){for(const e of h)return e}function vU(h,e,i,s,o,c,_,j=0){const et=h.matrixWorld.determinant()<0;C1.copy(e.matrixWorld).invert().multiply(h.matrixWorld),jR.getNormalMatrix(h.matrixWorld).multiplyScalar(et?-1:1);const nt=h.geometry.groupIndices,st=h.geometry.index,at=h.geometry.attributes.position,ct=e.geometry.boundsTree,dt=e.geometry.index,mt=e.geometry.attributes.position,yt=i.ids,wt=i.intersectionSet;for(let Ct=0,bt=yt.length;Ct<bt;Ct++){const At=yt[Ct],Pt=j===-1?0:nt[At]+j,Dt=_.getGroupSet(Pt),Nt=3*At,Vt=st.getX(Nt+0),Zt=st.getX(Nt+1),an=st.getX(Nt+2);pS.a.fromBufferAttribute(at,Vt).applyMatrix4(C1),pS.b.fromBufferAttribute(at,Zt).applyMatrix4(C1),pS.c.fromBufferAttribute(at,an).applyMatrix4(C1),c.initialize(pS);const fn=wt[At];for(let Sn=0,An=fn.length;Sn<An;Sn++){const wn=3*fn[Sn],Mn=dt.getX(wn+0),Pn=dt.getX(wn+1),On=dt.getX(wn+2);zR.a.fromBufferAttribute(mt,Mn),zR.b.fromBufferAttribute(mt,Pn),zR.c.fromBufferAttribute(mt,On),c.splitByTriangle(zR)}const mn=c.triangles;for(let Sn=0,An=mn.length;Sn<An;Sn++){const wn=mn[Sn],Mn=_U(s,gU(wn,ct),o);if(Mn!==WB){pS.getBarycoord(wn.a,GR.a),pS.getBarycoord(wn.b,GR.b),pS.getBarycoord(wn.c,GR.c);const Pn=Mn===NR;P5(At,GR,h.geometry,h.matrixWorld,jR,Dt,et!==Pn)}}}return yt.length}function yU(h,e,i,s,o,c,_=0){const j=h.matrixWorld.determinant()<0;C1.copy(e.matrixWorld).invert().multiply(h.matrixWorld),jR.getNormalMatrix(h.matrixWorld).multiplyScalar(j?-1:1);const et=e.geometry.boundsTree,nt=h.geometry.groupIndices,st=h.geometry.index,at=h.geometry.attributes,ct=at.position,dt=[],mt=h.geometry.halfEdges,yt=new Set;for(let wt=0,Ct=st.count/3;wt<Ct;wt++)wt in i.intersectionSet||yt.add(wt);for(;yt.size>0;){const wt=D5(yt);yt.delete(wt),dt.push(wt);const Ct=3*wt,bt=st.getX(Ct+0),At=st.getX(Ct+1),Pt=st.getX(Ct+2);VR.a.fromBufferAttribute(ct,bt).applyMatrix4(C1),VR.b.fromBufferAttribute(ct,At).applyMatrix4(C1),VR.c.fromBufferAttribute(ct,Pt).applyMatrix4(C1);const Dt=_U(s,gU(VR,et),o);for(;dt.length>0;){const Nt=dt.pop(),Vt=_===-1?0:nt[Nt]+_,Zt=c.getGroupSet(Vt);for(let wn=0;wn<3;wn++){const Mn=mt.getSiblingTriangleIndex(Nt,wn);Mn!==-1&&yt.has(Mn)&&(dt.push(Mn),yt.delete(Mn))}if(Dt===WB)continue;const an=3*Nt,fn=st.getX(an+0),mn=st.getX(an+1),Sn=st.getX(an+2),An=Dt===NR;R5(fn,mn,Sn,at,h.matrixWorld,jR,Zt,An!==j)}}}const AU=0,k5=1,O5=2,YB=1.25,bU=1,$B=65535,B5=Math.pow(2,-24);class HR{constructor(){}}function NA(h,e,i){return i.min.x=e[h],i.min.y=e[h+1],i.min.z=e[h+2],i.max.x=e[h+3],i.max.y=e[h+4],i.max.z=e[h+5],i}function wU(h){let e=-1,i=-1/0;for(let s=0;s<3;s++){const o=h[s+3]-h[s];o>i&&(i=o,e=s)}return e}function xU(h,e){e.set(h)}function EU(h,e,i){let s,o;for(let c=0;c<3;c++){const _=c+3;s=h[c],o=e[c],i[c]=s<o?s:o,s=h[_],o=e[_],i[_]=s>o?s:o}}function QR(h,e,i){for(let s=0;s<3;s++){const o=e[h+2*s],c=e[h+2*s+1],_=o-c,j=o+c;_<i[s]&&(i[s]=_),j>i[s+3]&&(i[s+3]=j)}}function PI(h){const e=h[3]-h[0],i=h[4]-h[1],s=h[5]-h[2];return 2*(e*i+i*s+s*e)}function KB(h,e,i,s,o=null){let c=1/0,_=1/0,j=1/0,et=-1/0,nt=-1/0,st=-1/0,at=1/0,ct=1/0,dt=1/0,mt=-1/0,yt=-1/0,wt=-1/0;const Ct=o!==null;for(let bt=6*e,At=6*(e+i);bt<At;bt+=6){const Pt=h[bt+0],Dt=h[bt+1],Nt=Pt-Dt,Vt=Pt+Dt;Nt<c&&(c=Nt),Vt>et&&(et=Vt),Ct&&Pt<at&&(at=Pt),Ct&&Pt>mt&&(mt=Pt);const Zt=h[bt+2],an=h[bt+3],fn=Zt-an,mn=Zt+an;fn<_&&(_=fn),mn>nt&&(nt=mn),Ct&&Zt<ct&&(ct=Zt),Ct&&Zt>yt&&(yt=Zt);const Sn=h[bt+4],An=h[bt+5],wn=Sn-An,Mn=Sn+An;wn<j&&(j=wn),Mn>st&&(st=Mn),Ct&&Sn<dt&&(dt=Sn),Ct&&Sn>wt&&(wt=Sn)}s[0]=c,s[1]=_,s[2]=j,s[3]=et,s[4]=nt,s[5]=st,Ct&&(o[0]=at,o[1]=ct,o[2]=dt,o[3]=mt,o[4]=yt,o[5]=wt)}const Jw=32,L5=(h,e)=>h.candidate-e.candidate,T1=new Array(Jw).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),WR=new Float32Array(6);class UA{constructor(e,i,s){this.isOrientedBox=!0,this.min=new g.Pa4,this.max=new g.Pa4,this.matrix=new g.yGw,this.invMatrix=new g.yGw,this.points=new Array(8).fill().map(()=>new g.Pa4),this.satAxes=new Array(3).fill().map(()=>new g.Pa4),this.satBounds=new Array(3).fill().map(()=>new Xw),this.alignedSatBounds=new Array(3).fill().map(()=>new Xw),this.needsUpdate=!1,e&&this.min.copy(e),i&&this.max.copy(i),s&&this.matrix.copy(s)}set(e,i,s){this.min.copy(e),this.max.copy(i),this.matrix.copy(s),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}UA.prototype.update=function(){const h=this.matrix,e=this.min,i=this.max,s=this.points;for(let et=0;et<=1;et++)for(let nt=0;nt<=1;nt++)for(let st=0;st<=1;st++){const at=s[1*et|2*nt|4*st];at.x=et?i.x:e.x,at.y=nt?i.y:e.y,at.z=st?i.z:e.z,at.applyMatrix4(h)}const o=this.satBounds,c=this.satAxes,_=s[0];for(let et=0;et<3;et++){const nt=c[et],st=o[et],at=s[1<<et];nt.subVectors(_,at),st.setFromPoints(nt,s)}const j=this.alignedSatBounds;j[0].setFromPointsField(s,"x"),j[1].setFromPointsField(s,"y"),j[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},UA.prototype.intersectsBox=function(){const h=new Xw;return function(e){this.needsUpdate&&this.update();const i=e.min,s=e.max,o=this.satBounds,c=this.satAxes,_=this.alignedSatBounds;if(h.min=i.x,h.max=s.x,_[0].isSeparated(h)||(h.min=i.y,h.max=s.y,_[1].isSeparated(h))||(h.min=i.z,h.max=s.z,_[2].isSeparated(h)))return!1;for(let j=0;j<3;j++){const et=c[j],nt=o[j];if(h.setFromBox(et,e),nt.isSeparated(h))return!1}return!0}}(),UA.prototype.intersectsTriangle=function(){const h=new LA,e=new Array(3),i=new Xw,s=new Xw,o=new g.Pa4;return function(c){this.needsUpdate&&this.update(),c.isExtendedTriangle?c.needsUpdate&&c.update():(h.copy(c),h.update(),c=h);const _=this.satBounds,j=this.satAxes;e[0]=c.a,e[1]=c.b,e[2]=c.c;for(let at=0;at<3;at++){const ct=_[at],dt=j[at];if(i.setFromPoints(dt,e),ct.isSeparated(i))return!1}const et=c.satBounds,nt=c.satAxes,st=this.points;for(let at=0;at<3;at++){const ct=et[at],dt=nt[at];if(i.setFromPoints(dt,st),ct.isSeparated(i))return!1}for(let at=0;at<3;at++){const ct=j[at];for(let dt=0;dt<4;dt++){const mt=nt[dt];if(o.crossVectors(ct,mt),i.setFromPoints(o,e),s.setFromPoints(o,st),i.isSeparated(s))return!1}}return!0}}(),UA.prototype.closestPointToPoint=function(h,e){return this.needsUpdate&&this.update(),e.copy(h).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},UA.prototype.distanceToPoint=function(){const h=new g.Pa4;return function(e){return this.closestPointToPoint(e,h),e.distanceTo(h)}}(),UA.prototype.distanceToBox=function(){const h=["x","y","z"],e=new Array(12).fill().map(()=>new g.Zzh),i=new Array(12).fill().map(()=>new g.Zzh),s=new g.Pa4,o=new g.Pa4;return function(c,_=0,j=null,et=null){if(this.needsUpdate&&this.update(),this.intersectsBox(c))return(j||et)&&(c.getCenter(o),this.closestPointToPoint(o,s),c.closestPointToPoint(s,o),j&&j.copy(s),et&&et.copy(o)),0;const nt=_*_,st=c.min,at=c.max,ct=this.points;let dt=1/0;for(let yt=0;yt<8;yt++){const wt=ct[yt];o.copy(wt).clamp(st,at);const Ct=wt.distanceToSquared(o);if(Ct<dt&&(dt=Ct,j&&j.copy(wt),et&&et.copy(o),Ct<nt))return Math.sqrt(Ct)}let mt=0;for(let yt=0;yt<3;yt++)for(let wt=0;wt<=1;wt++)for(let Ct=0;Ct<=1;Ct++){const bt=(yt+1)%3,At=(yt+2)%3,Pt=1<<yt|wt<<bt|Ct<<At,Dt=ct[wt<<bt|Ct<<At],Nt=ct[Pt];e[mt].set(Dt,Nt);const Vt=h[yt],Zt=h[bt],an=h[At],fn=i[mt],mn=fn.start,Sn=fn.end;mn[Vt]=st[Vt],mn[Zt]=wt?st[Zt]:at[Zt],mn[an]=Ct?st[an]:at[Zt],Sn[Vt]=at[Vt],Sn[Zt]=wt?st[Zt]:at[Zt],Sn[an]=Ct?st[an]:at[Zt],mt++}for(let yt=0;yt<=1;yt++)for(let wt=0;wt<=1;wt++)for(let Ct=0;Ct<=1;Ct++){o.x=yt?at.x:st.x,o.y=wt?at.y:st.y,o.z=Ct?at.z:st.z,this.closestPointToPoint(o,s);const bt=o.distanceToSquared(s);if(bt<dt&&(dt=bt,j&&j.copy(s),et&&et.copy(o),bt<nt))return Math.sqrt(bt)}for(let yt=0;yt<12;yt++){const wt=e[yt];for(let Ct=0;Ct<12;Ct++){const bt=i[Ct];jB(wt,bt,s,o);const At=s.distanceToSquared(o);if(At<dt&&(dt=At,j&&j.copy(s),et&&et.copy(o),At<nt))return Math.sqrt(At)}}return Math.sqrt(dt)}}();const qR=new g.Pa4,XR=new g.Pa4,YR=new g.Pa4,SU=new g.FM8,CU=new g.FM8,TU=new g.FM8,MU=new g.Pa4;function IU(h,e,i,s,o){const c=3*s,_=h.index.getX(c),j=h.index.getX(c+1),et=h.index.getX(c+2),nt=function(st,at,ct,dt,mt,yt,wt){qR.fromBufferAttribute(at,dt),XR.fromBufferAttribute(at,mt),YR.fromBufferAttribute(at,yt);const Ct=function(bt,At,Pt,Dt,Nt,Vt){let Zt;return Zt=Vt===g._Li?bt.intersectTriangle(Dt,Pt,At,!0,Nt):bt.intersectTriangle(At,Pt,Dt,Vt!==g.ehD,Nt),Zt===null?null:{distance:bt.origin.distanceTo(Nt),point:Nt.clone()}}(st,qR,XR,YR,MU,wt);if(Ct){ct&&(SU.fromBufferAttribute(ct,dt),CU.fromBufferAttribute(ct,mt),TU.fromBufferAttribute(ct,yt),Ct.uv=g.CJI.getUV(MU,qR,XR,YR,SU,CU,TU,new g.FM8));const bt={a:dt,b:mt,c:yt,normal:new g.Pa4,materialIndex:0};g.CJI.getNormal(qR,XR,YR,bt.normal),Ct.face=bt,Ct.faceIndex=dt}return Ct}(i,h.attributes.position,h.attributes.uv,_,j,et,e);return nt?(nt.faceIndex=s,o&&o.push(nt),nt):null}function FA(h,e,i,s){const o=h.a,c=h.b,_=h.c;let j=e,et=e+1,nt=e+2;i&&(j=i.getX(e),et=i.getX(e+1),nt=i.getX(e+2)),o.x=s.getX(j),o.y=s.getY(j),o.z=s.getZ(j),c.x=s.getX(et),c.y=s.getY(et),c.z=s.getZ(et),_.x=s.getX(nt),_.y=s.getY(nt),_.z=s.getZ(nt)}function PU(h,e,i,s,o,c,_){const j=i.index,et=i.attributes.position;for(let nt=h,st=e+h;nt<st;nt++)if(FA(_,3*nt,j,et),_.needsUpdate=!0,s(_,nt,o,c))return!0;return!1}class RU{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function M1(h,e){return e[h+15]===65535}function AT(h,e){return e[h+6]}function RI(h,e){return e[h+14]}function DI(h){return h+8}function kI(h,e){return e[h+6]}const bT=new g.ZzF,$R=new g.Pa4,N5=["x","y","z"];function JB(h,e,i,s,o){let c=2*h,_=wT,j=I1,et=P1;if(M1(c,j))(function(nt,st,at,ct,dt,mt){for(let yt=ct,wt=ct+dt;yt<wt;yt++)IU(nt,st,at,yt,mt)})(e,i,s,AT(h,et),RI(c,j),o);else{const nt=DI(h);KR(nt,_,s,$R)&&JB(nt,e,i,s,o);const st=kI(h,et);KR(st,_,s,$R)&&JB(st,e,i,s,o)}}function ZB(h,e,i,s){let o=2*h,c=wT,_=I1,j=P1;if(M1(o,_))return function(et,nt,st,at,ct){let dt=1/0,mt=null;for(let yt=at,wt=at+ct;yt<wt;yt++){const Ct=IU(et,nt,st,yt);Ct&&Ct.distance<dt&&(mt=Ct,dt=Ct.distance)}return mt}(e,i,s,AT(h,j),RI(o,_));{const et=function(yt,wt){return wt[yt+7]}(h,j),nt=N5[et],st=s.direction[nt]>=0;let at,ct;st?(at=DI(h),ct=kI(h,j)):(at=kI(h,j),ct=DI(h));const dt=KR(at,c,s,$R)?ZB(at,e,i,s):null;if(dt){const yt=dt.point[nt];if(st?yt<=c[ct+et]:yt>=c[ct+et+3])return dt}const mt=KR(ct,c,s,$R)?ZB(ct,e,i,s):null;return dt&&mt?dt.distance<=mt.distance?dt:mt:dt||mt||null}}const U5=function(){let h,e;const i=[],s=new RU(()=>new g.ZzF);return function(...c){h=s.getPrimitive(),e=s.getPrimitive(),i.push(h,e);const _=o(...c);s.releasePrimitive(h),s.releasePrimitive(e),i.pop(),i.pop();const j=i.length;return j>0&&(e=i[j-1],h=i[j-2]),_};function o(c,_,j,et,nt=null,st=0,at=0){function ct(bt){let At=2*bt,Pt=I1,Dt=P1;for(;!M1(At,Pt);)At=2*(bt=DI(bt));return AT(bt,Dt)}function dt(bt){let At=2*bt,Pt=I1,Dt=P1;for(;!M1(At,Pt);)At=2*(bt=kI(bt,Dt));return AT(bt,Dt)+RI(At,Pt)}let mt=2*c,yt=wT,wt=I1,Ct=P1;if(M1(mt,wt)){const bt=AT(c,Ct),At=RI(mt,wt);return NA(c,yt,h),et(bt,At,!1,at,st+c,h)}{const bt=DI(c),At=kI(c,Ct);let Pt,Dt,Nt,Vt,Zt=bt,an=At;if(nt&&(Nt=h,Vt=e,NA(Zt,yt,Nt),NA(an,yt,Vt),Pt=nt(Nt),Dt=nt(Vt),Dt<Pt)){Zt=At,an=bt;const wn=Pt;Pt=Dt,Dt=wn,Nt=Vt}Nt||(Nt=h,NA(Zt,yt,Nt));const fn=j(Nt,M1(2*Zt,wt),Pt,at+1,st+Zt);let mn;if(fn===2){const wn=ct(Zt);mn=et(wn,dt(Zt)-wn,!0,at+1,st+Zt,Nt)}else mn=fn&&o(Zt,_,j,et,nt,st,at+1);if(mn)return!0;Vt=e,NA(an,yt,Vt);const Sn=j(Vt,M1(2*an,wt),Dt,at+1,st+an);let An;if(Sn===2){const wn=ct(an);An=et(wn,dt(an)-wn,!0,at+1,st+an,Vt)}else An=Sn&&o(an,_,j,et,nt,st,at+1);return!!An}}}(),F5=function(){const h=new LA,e=new LA,i=new g.yGw,s=new UA,o=new UA;return function c(_,j,et,nt,st=null){let at=2*_,ct=wT,dt=I1,mt=P1;if(st===null&&(et.boundingBox||et.computeBoundingBox(),s.set(et.boundingBox.min,et.boundingBox.max,nt),st=s),!M1(at,dt)){const yt=_+8,wt=mt[_+6];return NA(yt,ct,bT),st.intersectsBox(bT)&&c(yt,j,et,nt,st)?!0:(NA(wt,ct,bT),!(!st.intersectsBox(bT)||!c(wt,j,et,nt,st)))}{const yt=j,wt=yt.index,Ct=yt.attributes.position,bt=et.index,At=et.attributes.position,Pt=AT(_,mt),Dt=RI(at,dt);if(i.copy(nt).invert(),et.boundsTree)return NA(_,ct,o),o.matrix.copy(i),o.needsUpdate=!0,et.boundsTree.shapecast({intersectsBounds:Vt=>o.intersectsBox(Vt),intersectsTriangle:Vt=>{Vt.a.applyMatrix4(nt),Vt.b.applyMatrix4(nt),Vt.c.applyMatrix4(nt),Vt.needsUpdate=!0;for(let Zt=3*Pt,an=3*(Dt+Pt);Zt<an;Zt+=3)if(FA(e,Zt,wt,Ct),e.needsUpdate=!0,Vt.intersectsTriangle(e))return!0;return!1}});for(let Nt=3*Pt,Vt=Dt+3*Pt;Nt<Vt;Nt+=3){FA(h,Nt,wt,Ct),h.a.applyMatrix4(i),h.b.applyMatrix4(i),h.c.applyMatrix4(i),h.needsUpdate=!0;for(let Zt=0,an=bt.count;Zt<an;Zt+=3)if(FA(e,Zt,bt,At),e.needsUpdate=!0,h.intersectsTriangle(e))return!0}}}}();function KR(h,e,i,s){return NA(h,e,bT),i.intersectBox(bT,s)}const eL=[];let JR,wT,I1,P1;function OI(h){JR&&eL.push(JR),JR=h,wT=new Float32Array(h),I1=new Uint16Array(h),P1=new Uint32Array(h)}function ZR(){JR=null,wT=null,I1=null,P1=null,eL.length&&OI(eL.pop())}const tL=Symbol("skip tree generation"),nL=new g.ZzF,rL=new g.ZzF,xT=new g.yGw,fS=new UA,BI=new UA,LI=new g.Pa4,eD=new g.Pa4,j5=new g.Pa4,z5=new g.Pa4,V5=new g.Pa4,DU=new g.ZzF,jA=new RU(()=>new LA);class NI{static serialize(e,i={}){if(i.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),NI.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});i={cloneBuffers:!0,...i};const s=e.geometry,o=e._roots,c=s.getIndex();let _;return _=i.cloneBuffers?{roots:o.map(j=>j.slice()),index:c.array.slice()}:{roots:o,index:c.array},_}static deserialize(e,i,s={}){if(typeof s=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),NI.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});s={setIndex:!0,...s};const{index:o,roots:c}=e,_=new NI(i,{...s,[tL]:!0});if(_._roots=c,s.setIndex){const j=i.getIndex();if(j===null){const et=new g.TlE(e.index,1,!1);i.setIndex(et)}else j.array!==o&&(j.array.set(o),j.needsUpdate=!0)}return _}constructor(e,i={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((i=Object.assign({strategy:AU,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[tL]:!1},i)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,i[tL]||(this._roots=function(s,o){const c=function(dt,mt){function yt(wn){an&&an(wn/fn)}function wt(wn,Mn,Pn,On=null,er=0){if(!mn&&er>=Dt&&(mn=!0,Nt&&(console.warn(`MeshBVH: Max depth of ${Dt} reached when generating BVH. Consider increasing maxDepth.`),console.warn(dt))),Pn<=Vt||er>=Dt)return yt(Mn+Pn),wn.offset=Mn,wn.count=Pn,wn;const Zn=function(lr,ar,Mr,xr,qr,Zr){let ds=-1,Hs=0;if(Zr===AU)ds=wU(ar),ds!==-1&&(Hs=(ar[ds]+ar[ds+3])/2);else if(Zr===k5)ds=wU(lr),ds!==-1&&(Hs=function(Ps,Os,gr,kr){let $r=0;for(let co=Os,Do=Os+gr;co<Do;co++)$r+=Ps[6*co+2*kr];return $r/gr}(Mr,xr,qr,ds));else if(Zr===O5){const Ps=PI(lr);let Os=YB*qr;const gr=6*xr,kr=6*(xr+qr);for(let $r=0;$r<3;$r++){const co=ar[$r],Do=(ar[$r+3]-co)/Jw;if(qr<Jw/4){const _o=[...T1];_o.length=qr;let io=0;for(let ws=gr;ws<kr;ws+=6,io++){const dr=_o[io];dr.candidate=Mr[ws+2*$r],dr.count=0;const{bounds:Yr,leftCacheBounds:Cs,rightCacheBounds:Ur}=dr;for(let qs=0;qs<3;qs++)Ur[qs]=1/0,Ur[qs+3]=-1/0,Cs[qs]=1/0,Cs[qs+3]=-1/0,Yr[qs]=1/0,Yr[qs+3]=-1/0;QR(ws,Mr,Yr)}_o.sort(L5);let so=qr;for(let ws=0;ws<so;ws++){const dr=_o[ws];for(;ws+1<so&&_o[ws+1].candidate===dr.candidate;)_o.splice(ws+1,1),so--}for(let ws=gr;ws<kr;ws+=6){const dr=Mr[ws+2*$r];for(let Yr=0;Yr<so;Yr++){const Cs=_o[Yr];dr>=Cs.candidate?QR(ws,Mr,Cs.rightCacheBounds):(QR(ws,Mr,Cs.leftCacheBounds),Cs.count++)}}for(let ws=0;ws<so;ws++){const dr=_o[ws],Yr=dr.count,Cs=qr-dr.count,Ur=dr.leftCacheBounds,qs=dr.rightCacheBounds;let bu=0;Yr!==0&&(bu=PI(Ur)/Ps);let Lu=0;Cs!==0&&(Lu=PI(qs)/Ps);const yp=bU+YB*(bu*Yr+Lu*Cs);yp<Os&&(ds=$r,Os=yp,Hs=dr.candidate)}}else{for(let so=0;so<Jw;so++){const ws=T1[so];ws.count=0,ws.candidate=co+Do+so*Do;const dr=ws.bounds;for(let Yr=0;Yr<3;Yr++)dr[Yr]=1/0,dr[Yr+3]=-1/0}for(let so=gr;so<kr;so+=6){let ws=~~((Mr[so+2*$r]-co)/Do);ws>=Jw&&(ws=Jw-1);const dr=T1[ws];dr.count++,QR(so,Mr,dr.bounds)}const _o=T1[Jw-1];xU(_o.bounds,_o.rightCacheBounds);for(let so=Jw-2;so>=0;so--){const ws=T1[so],dr=T1[so+1];EU(ws.bounds,dr.rightCacheBounds,ws.rightCacheBounds)}let io=0;for(let so=0;so<Jw-1;so++){const ws=T1[so],dr=ws.count,Yr=ws.bounds,Cs=T1[so+1].rightCacheBounds;dr!==0&&(io===0?xU(Yr,WR):EU(Yr,WR,WR)),io+=dr;let Ur=0,qs=0;io!==0&&(Ur=PI(WR)/Ps);const bu=qr-io;bu!==0&&(qs=PI(Cs)/Ps);const Lu=bU+YB*(Ur*io+qs*bu);Lu<Os&&(ds=$r,Os=Lu,Hs=ws.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${Zr} used.`);return{axis:ds,pos:Hs}}(wn.boundingData,On,At,Mn,Pn,Zt);if(Zn.axis===-1)return yt(Mn+Pn),wn.offset=Mn,wn.count=Pn,wn;const yr=function(lr,ar,Mr,xr,qr){let Zr=Mr,ds=Mr+xr-1;const Hs=qr.pos,Ps=2*qr.axis;for(;;){for(;Zr<=ds&&ar[6*Zr+Ps]<Hs;)Zr++;for(;Zr<=ds&&ar[6*ds+Ps]>=Hs;)ds--;if(!(Zr<ds))return Zr;for(let Os=0;Os<3;Os++){let gr=lr[3*Zr+Os];lr[3*Zr+Os]=lr[3*ds+Os],lr[3*ds+Os]=gr;let kr=ar[6*Zr+2*Os+0];ar[6*Zr+2*Os+0]=ar[6*ds+2*Os+0],ar[6*ds+2*Os+0]=kr;let $r=ar[6*Zr+2*Os+1];ar[6*Zr+2*Os+1]=ar[6*ds+2*Os+1],ar[6*ds+2*Os+1]=$r}Zr++,ds--}}(Pt,At,Mn,Pn,Zn);if(yr===Mn||yr===Mn+Pn)yt(Mn+Pn),wn.offset=Mn,wn.count=Pn;else{wn.splitAxis=Zn.axis;const lr=new HR,ar=Mn,Mr=yr-Mn;wn.left=lr,lr.boundingData=new Float32Array(6),KB(At,ar,Mr,lr.boundingData,bt),wt(lr,ar,Mr,bt,er+1);const xr=new HR,qr=yr,Zr=Pn-Mr;wn.right=xr,xr.boundingData=new Float32Array(6),KB(At,qr,Zr,xr.boundingData,bt),wt(xr,qr,Zr,bt,er+1)}return wn}(function(wn,Mn){if(!wn.index){const Pn=wn.attributes.position.count,On=Mn.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let er;er=Pn>65535?new Uint32Array(new On(4*Pn)):new Uint16Array(new On(2*Pn)),wn.setIndex(new g.TlE(er,1));for(let Zn=0;Zn<Pn;Zn++)er[Zn]=Zn}})(dt,mt);const Ct=new Float32Array(6),bt=new Float32Array(6),At=function(wn,Mn){const Pn=wn.attributes.position,On=wn.index.array,er=On.length/3,Zn=new Float32Array(6*er),yr=Pn.normalized,lr=Pn.array,ar=Pn.offset||0;let Mr=3;Pn.isInterleavedBufferAttribute&&(Mr=Pn.data.stride);const xr=["getX","getY","getZ"];for(let qr=0;qr<er;qr++){const Zr=3*qr,ds=6*qr;let Hs,Ps,Os;yr?(Hs=On[Zr+0],Ps=On[Zr+1],Os=On[Zr+2]):(Hs=On[Zr+0]*Mr+ar,Ps=On[Zr+1]*Mr+ar,Os=On[Zr+2]*Mr+ar);for(let gr=0;gr<3;gr++){let kr,$r,co;yr?(kr=Pn[xr[gr]](Hs),$r=Pn[xr[gr]](Ps),co=Pn[xr[gr]](Os)):(kr=lr[Hs+gr],$r=lr[Ps+gr],co=lr[Os+gr]);let Do=kr;$r<Do&&(Do=$r),co<Do&&(Do=co);let _o=kr;$r>_o&&(_o=$r),co>_o&&(_o=co);const io=(_o-Do)/2,so=2*gr;Zn[ds+so+0]=Do+io,Zn[ds+so+1]=io+(Math.abs(Do)+io)*B5,Do<Mn[gr]&&(Mn[gr]=Do),_o>Mn[gr+3]&&(Mn[gr+3]=_o)}}return Zn}(dt,Ct),Pt=dt.index.array,Dt=mt.maxDepth,Nt=mt.verbose,Vt=mt.maxLeafTris,Zt=mt.strategy,an=mt.onProgress,fn=dt.index.count/3;let mn=!1;const Sn=[],An=function(wn){if(!wn.groups||!wn.groups.length)return[{offset:0,count:wn.index.count/3}];const Mn=[],Pn=new Set;for(const er of wn.groups)Pn.add(er.start),Pn.add(er.start+er.count);const On=Array.from(Pn.values()).sort((er,Zn)=>er-Zn);for(let er=0;er<On.length-1;er++){const Zn=On[er],yr=On[er+1];Mn.push({offset:Zn/3,count:(yr-Zn)/3})}return Mn}(dt);if(An.length===1){const wn=An[0],Mn=new HR;Mn.boundingData=Ct,function(Pn,On,er,Zn){let yr=1/0,lr=1/0,ar=1/0,Mr=-1/0,xr=-1/0,qr=-1/0;for(let Zr=6*On,ds=6*(On+er);Zr<ds;Zr+=6){const Hs=Pn[Zr+0];Hs<yr&&(yr=Hs),Hs>Mr&&(Mr=Hs);const Ps=Pn[Zr+2];Ps<lr&&(lr=Ps),Ps>xr&&(xr=Ps);const Os=Pn[Zr+4];Os<ar&&(ar=Os),Os>qr&&(qr=Os)}Zn[0]=yr,Zn[1]=lr,Zn[2]=ar,Zn[3]=Mr,Zn[4]=xr,Zn[5]=qr}(At,wn.offset,wn.count,bt),wt(Mn,wn.offset,wn.count,bt),Sn.push(Mn)}else for(let wn of An){const Mn=new HR;Mn.boundingData=new Float32Array(6),KB(At,wn.offset,wn.count,Mn.boundingData,bt),wt(Mn,wn.offset,wn.count,bt),Sn.push(Mn)}return Sn}(s,o);let _,j,et;const nt=[],st=o.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let dt=0;dt<c.length;dt++){const mt=c[dt],yt=new st(32*at(mt));_=new Float32Array(yt),j=new Uint32Array(yt),et=new Uint16Array(yt),ct(0,mt),nt.push(yt)}return nt;function at(dt){return dt.count?1:1+at(dt.left)+at(dt.right)}function ct(dt,mt){const yt=dt/4,wt=dt/2,Ct=!!mt.count,bt=mt.boundingData;for(let At=0;At<6;At++)_[yt+At]=bt[At];if(Ct){const At=mt.offset,Pt=mt.count;return j[yt+6]=At,et[wt+14]=Pt,et[wt+15]=$B,dt+32}{const At=mt.left,Pt=mt.right,Dt=mt.splitAxis;let Nt;if(Nt=ct(dt+32,At),Nt/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return j[yt+6]=Nt/4,Nt=ct(Nt,Pt),j[yt+7]=Dt,Nt}}}(e,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new g.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=this.geometry,s=i.index.array,o=i.attributes.position;let c,_,j,et,nt=0;const st=this._roots;for(let ct=0,dt=st.length;ct<dt;ct++)c=st[ct],_=new Uint32Array(c),j=new Uint16Array(c),et=new Float32Array(c),at(0,nt),nt+=c.byteLength;function at(ct,dt,mt=!1){const yt=2*ct;if(j[yt+15]===$B){const wt=_[ct+6];let Ct=1/0,bt=1/0,At=1/0,Pt=-1/0,Dt=-1/0,Nt=-1/0;for(let Vt=3*wt,Zt=3*(wt+j[yt+14]);Vt<Zt;Vt++){const an=s[Vt],fn=o.getX(an),mn=o.getY(an),Sn=o.getZ(an);fn<Ct&&(Ct=fn),fn>Pt&&(Pt=fn),mn<bt&&(bt=mn),mn>Dt&&(Dt=mn),Sn<At&&(At=Sn),Sn>Nt&&(Nt=Sn)}return(et[ct+0]!==Ct||et[ct+1]!==bt||et[ct+2]!==At||et[ct+3]!==Pt||et[ct+4]!==Dt||et[ct+5]!==Nt)&&(et[ct+0]=Ct,et[ct+1]=bt,et[ct+2]=At,et[ct+3]=Pt,et[ct+4]=Dt,et[ct+5]=Nt,!0)}{const wt=ct+8,Ct=_[ct+6],bt=wt+dt,At=Ct+dt;let Pt=mt,Dt=!1,Nt=!1;e?Pt||(Dt=e.has(bt),Nt=e.has(At),Pt=!Dt&&!Nt):(Dt=!0,Nt=!0);const Vt=Pt||Nt;let Zt=!1;(Pt||Dt)&&(Zt=at(wt,dt,Pt));let an=!1;Vt&&(an=at(Ct,dt,Pt));const fn=Zt||an;if(fn)for(let mn=0;mn<3;mn++){const Sn=wt+mn,An=Ct+mn,wn=et[Sn],Mn=et[Sn+3],Pn=et[An],On=et[An+3];et[ct+mn]=wn<Pn?wn:Pn,et[ct+mn+3]=Mn>On?Mn:On}return fn}}}traverse(e,i=0){const s=this._roots[i],o=new Uint32Array(s),c=new Uint16Array(s);(function _(j,et=0){const nt=2*j,st=c[nt+15]===$B;if(st){const at=o[j+6],ct=c[nt+14];e(et,st,new Float32Array(s,4*j,6),at,ct)}else{const at=j+8,ct=o[j+6],dt=o[j+7];e(et,st,new Float32Array(s,4*j,6),dt)||(_(at,et+1),_(ct,et+1))}})(0)}raycast(e,i=g.Wl3){const s=this._roots,o=this.geometry,c=[],_=i.isMaterial,j=Array.isArray(i),et=o.groups,nt=_?i.side:i;for(let st=0,at=s.length;st<at;st++){const ct=j?i[et[st].materialIndex].side:nt,dt=c.length;if(OI(s[st]),JB(0,o,ct,e,c),ZR(),j){const mt=et[st].materialIndex;for(let yt=dt,wt=c.length;yt<wt;yt++)c[yt].face.materialIndex=mt}}return c}raycastFirst(e,i=g.Wl3){const s=this._roots,o=this.geometry,c=i.isMaterial,_=Array.isArray(i);let j=null;const et=o.groups,nt=c?i.side:i;for(let st=0,at=s.length;st<at;st++){const ct=_?i[et[st].materialIndex].side:nt;OI(s[st]);const dt=ZB(0,o,ct,e);ZR(),dt!=null&&(j==null||dt.distance<j.distance)&&(j=dt,_&&(dt.face.materialIndex=et[st].materialIndex))}return j}intersectsGeometry(e,i){const s=this.geometry;let o=!1;for(const c of this._roots)if(OI(c),o=F5(0,s,e,i),ZR(),o)break;return o}shapecast(e,i,s){const o=this.geometry;if(e instanceof Function){if(i){const ct=i;i=(dt,mt,yt,wt)=>{const Ct=3*mt;return ct(dt,Ct,Ct+1,Ct+2,yt,wt)}}e={boundsTraverseOrder:s,intersectsBounds:e,intersectsTriangle:i,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const c=jA.getPrimitive();let{boundsTraverseOrder:_,intersectsBounds:j,intersectsRange:et,intersectsTriangle:nt}=e;if(et&&nt){const ct=et;et=(dt,mt,yt,wt,Ct)=>!!ct(dt,mt,yt,wt,Ct)||PU(dt,mt,o,nt,yt,wt,c)}else et||(et=nt?(ct,dt,mt,yt)=>PU(ct,dt,o,nt,mt,yt,c):(ct,dt,mt)=>mt);let st=!1,at=0;for(const ct of this._roots){if(OI(ct),st=U5(0,o,j,et,_,at),ZR(),st)break;at+=ct.byteLength}return jA.releasePrimitive(c),st}bvhcast(e,i,s){let{intersectsRanges:o,intersectsTriangles:c}=s;const _=this.geometry.index,j=this.geometry.attributes.position,et=e.geometry.index,nt=e.geometry.attributes.position;xT.copy(i).invert();const st=jA.getPrimitive(),at=jA.getPrimitive();if(c){let dt=function(mt,yt,wt,Ct,bt,At,Pt,Dt){for(let Nt=wt,Vt=wt+Ct;Nt<Vt;Nt++){FA(at,3*Nt,et,nt),at.a.applyMatrix4(i),at.b.applyMatrix4(i),at.c.applyMatrix4(i),at.needsUpdate=!0;for(let Zt=mt,an=mt+yt;Zt<an;Zt++)if(FA(st,3*Zt,_,j),st.needsUpdate=!0,c(st,at,Zt,Nt,bt,At,Pt,Dt))return!0}return!1};if(o){const mt=o;o=function(yt,wt,Ct,bt,At,Pt,Dt,Nt){return!!mt(yt,wt,Ct,bt,At,Pt,Dt,Nt)||dt(yt,wt,Ct,bt,At,Pt,Dt,Nt)}}else o=dt}e.getBoundingBox(rL),rL.applyMatrix4(i);const ct=this.shapecast({intersectsBounds:dt=>rL.intersectsBox(dt),intersectsRange:(dt,mt,yt,wt,Ct,bt)=>(nL.copy(bt),nL.applyMatrix4(xT),e.shapecast({intersectsBounds:At=>nL.intersectsBox(At),intersectsRange:(At,Pt,Dt,Nt,Vt)=>o(dt,mt,At,Pt,wt,Ct,Nt,Vt)}))});return jA.releasePrimitive(st),jA.releasePrimitive(at),ct}intersectsBox(e,i){return fS.set(e.min,e.max,i),fS.needsUpdate=!0,this.shapecast({intersectsBounds:s=>fS.intersectsBox(s),intersectsTriangle:s=>fS.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:i=>e.intersectsBox(i),intersectsTriangle:i=>i.intersectsSphere(e)})}closestPointToGeometry(e,i,s={},o={},c=0,_=1/0){e.boundingBox||e.computeBoundingBox(),fS.set(e.boundingBox.min,e.boundingBox.max,i),fS.needsUpdate=!0;const j=this.geometry,et=j.attributes.position,nt=j.index,st=e.attributes.position,at=e.index,ct=jA.getPrimitive(),dt=jA.getPrimitive();let mt=eD,yt=j5,wt=null,Ct=null;o&&(wt=z5,Ct=V5);let bt=1/0,At=null,Pt=null;return xT.copy(i).invert(),BI.matrix.copy(xT),this.shapecast({boundsTraverseOrder:Dt=>fS.distanceToBox(Dt),intersectsBounds:(Dt,Nt,Vt)=>Vt<bt&&Vt<_&&(Nt&&(BI.min.copy(Dt.min),BI.max.copy(Dt.max),BI.needsUpdate=!0),!0),intersectsRange:(Dt,Nt)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:Vt=>BI.distanceToBox(Vt),intersectsBounds:(Vt,Zt,an)=>an<bt&&an<_,intersectsRange:(Vt,Zt)=>{for(let an=3*Vt,fn=3*(Vt+Zt);an<fn;an+=3){FA(dt,an,at,st),dt.a.applyMatrix4(i),dt.b.applyMatrix4(i),dt.c.applyMatrix4(i),dt.needsUpdate=!0;for(let mn=3*Dt,Sn=3*(Dt+Nt);mn<Sn;mn+=3){FA(ct,mn,nt,et),ct.needsUpdate=!0;const An=ct.distanceToTriangle(dt,mt,wt);if(An<bt&&(yt.copy(mt),Ct&&Ct.copy(wt),bt=An,At=mn/3,Pt=an/3),An<c)return!0}}}});for(let Vt=0,Zt=at?at.count:st.count;Vt<Zt;Vt+=3){FA(dt,Vt,at,st),dt.a.applyMatrix4(i),dt.b.applyMatrix4(i),dt.c.applyMatrix4(i),dt.needsUpdate=!0;for(let an=3*Dt,fn=3*(Dt+Nt);an<fn;an+=3){FA(ct,an,nt,et),ct.needsUpdate=!0;const mn=ct.distanceToTriangle(dt,mt,wt);if(mn<bt&&(yt.copy(mt),Ct&&Ct.copy(wt),bt=mn,At=an/3,Pt=Vt/3),mn<c)return!0}}}}),jA.releasePrimitive(ct),jA.releasePrimitive(dt),bt===1/0?null:(s.point?s.point.copy(yt):s.point=yt.clone(),s.distance=bt,s.faceIndex=At,o&&(o.point?o.point.copy(Ct):o.point=Ct.clone(),o.point.applyMatrix4(xT),yt.applyMatrix4(xT),o.distance=yt.sub(o.point).length(),o.faceIndex=Pt),s)}closestPointToPoint(e,i={},s=0,o=1/0){const c=s*s,_=o*o;let j=1/0,et=null;if(this.shapecast({boundsTraverseOrder:st=>(LI.copy(e).clamp(st.min,st.max),LI.distanceToSquared(e)),intersectsBounds:(st,at,ct)=>ct<j&&ct<_,intersectsTriangle:(st,at)=>{st.closestPointToPoint(e,LI);const ct=e.distanceToSquared(LI);return ct<j&&(eD.copy(LI),j=ct,et=at),ct<c}}),j===1/0)return null;const nt=Math.sqrt(j);return i.point?i.point.copy(eD):i.point=eD.clone(),i.distance=nt,i.faceIndex=et,i}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{NA(0,new Float32Array(i),DU),e.union(DU)}),e}}const G5=1e6*(1+1e-7);function iL(h){return~~(h*G5)}function kU(h){return`${iL(h.x)},${iL(h.y)},${iL(h.z)}`}const sL=[new g.Pa4,new g.Pa4,new g.Pa4];class H5{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:~~(s/3)}getSiblingEdgeIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:s%3}updateFrom(e){const i=new Map,{attributes:s}=e,o=e.index,c=s.position;let _=o?o.count/3:c.count/3;const j=_;let et=0;this.useDrawRange&&(et=e.drawRange.start,e.drawRange.count!==1/0&&(_=~~(e.drawRange.count/3)));let nt=this.data;(!nt||nt.length<3*j)&&(nt=new Int32Array(3*j)),nt.fill(-1);let st=0,at=0;for(let ct=0;ct<_;ct++){const dt=3*ct+et;for(let mt=0;mt<3;mt++){let yt=dt+mt;o&&(yt=o.getX(yt)),sL[mt].fromBufferAttribute(c,yt)}for(let mt=0;mt<3;mt++){const yt=(mt+1)%3,wt=sL[mt],Ct=sL[yt],bt=kU(wt),At=kU(Ct),Pt=`${At}_${bt}`;if(i.has(Pt)){const Dt=i.get(Pt);nt[dt+mt]=Dt,nt[Dt]=dt+mt,i.delete(Pt),st--,at++}else{const Dt=`${bt}_${At}`;i.set(Dt,dt+mt),st++}}}this.matchedEdges=at,this.unmatchedEdges=st,this.data=nt}}class tD extends g.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new g.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:i}=this,s=e.elements,o=i.elements;for(let c=0;c<16;c++)if(s[c]!==o[c])return!0;return!1}prepareGeometry(){const e=this.geometry,i=e.attributes;if(oU())for(const s in i){const o=i[s];if(o.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");o.array=S5(o.array)}if(e.boundsTree||(e.boundsTree=new NI(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new H5(e)),!e.groupIndices){const s=e.index.count/3,o=new Uint16Array(s),c=e.groups;for(let _=0,j=c.length;_<j;_++){const{start:et,count:nt}=c[_];for(let st=et/3,at=(et+nt)/3;st<at;st++)o[st]=_}e.groupIndices=o}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function OU(h,e){let i=e;return Array.isArray(e)||(i=[],h.forEach(s=>{i[s.materialIndex]=e})),i}class Q5{constructor(){this.triangleSplitter=new E5,this.attributeData=new C5,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new M5}evaluate(e,i,s,o=new tD){e.prepareGeometry(),i.prepareGeometry();const{triangleSplitter:c,attributeData:_,attributes:j,useGroups:et,debug:nt}=this,st=o.geometry,at=e.geometry.attributes;for(let Ct=0,bt=j.length;Ct<bt;Ct++){const At=j[Ct],Pt=at[At];_.initializeArray(At,Pt.array.constructor)}for(const Ct in _.attributes)j.includes(Ct)||_.delete(Ct);for(const Ct in st.attributes)j.includes(Ct)||(st.deleteAttribute(Ct),st.dispose());_.clear(),nt.enabled&&(nt.reset(),mU(nt)),function(Ct,bt,At,Pt,Dt,Nt){const{useGroups:Vt=!0}=Nt,{aIntersections:Zt,bIntersections:an}=function(mn,Sn){const An=new cU,wn=new cU;return uU.copy(mn.matrixWorld).invert().multiply(Sn.matrixWorld),mn.geometry.boundsTree.bvhcast(Sn.geometry.boundsTree,uU,{intersectsTriangles(Mn,Pn,On,er){if(Mn.intersectsTriangle(Pn,VB,!0)){if(VB.distanceSq()===0&&Mn.plane.normal.dot(Pn.plane.normal)<1-1e-10)return!1;An.add(On,er),wn.add(er,On),FR&&(FR.addEdge(VB),FR.addIntersectingTriangles(On,Mn,er,Pn))}return!1}}),{aIntersections:An,bIntersections:wn}}(Ct,bt);let fn;fn=Vt?0:-1,yU(Ct,bt,Zt,At,!1,Dt,fn),vU(Ct,bt,Zt,At,!1,Pt,Dt,fn),fn=Vt?Ct.geometry.groups.length||1:-1,yU(bt,Ct,an,At,!0,Dt,fn),vU(bt,Ct,an,At,!0,Pt,Dt,fn)}(e,i,s,c,_,{useGroups:et}),nt.enabled&&mU(null);const ct=et&&e.geometry.groups.length!==0?e.geometry.groups.map(Ct=>({...Ct})):[{start:0,count:1/0,materialIndex:0}],dt=et&&i.geometry.groups.length!==0?i.geometry.groups.map(Ct=>({...Ct})):[{start:0,count:1/0,materialIndex:0}],mt=OU(ct,e.material),yt=OU(dt,i.material);dt.forEach(Ct=>{Ct.materialIndex+=mt.length}),function(Ct,bt,At,Pt){let Dt=!1,Nt=-1;const Vt=Pt.groupCount,Zt=Ct.attributes,an=Pt.groupAttributes[0];for(const mn in an){const Sn=Pt.getTotalLength(mn,Vt),An=an[mn].type;let wn=Zt[mn];if(!wn||wn.array.length<Sn){const Pn=bt.attributes[mn];wn=new g.TlE(new An(Sn),Pn.itemSize,Pn.normalized),Ct.setAttribute(mn,wn),Dt=!0}let Mn=0;for(let Pn=0;Pn<Vt;Pn++){const{array:On,type:er,length:Zn}=Pt.groupAttributes[Pn][mn],yr=new er(On.buffer,0,Zn);wn.array.set(yr,Mn),Mn+=yr.length}wn.needsUpdate=!0,Nt=Sn/wn.itemSize}Ct.setDrawRange(0,Nt),Ct.clearGroups();let fn=0;for(let mn=0;mn<Vt;mn++){const Sn=Pt.getGroupArray("position",mn).length/3;if(Sn!==0){const An=At[mn];Ct.addGroup(fn,Sn,An.materialIndex),fn+=Sn}}if(Ct.index){const mn=Ct.index.array;if(mn.length<Nt)Ct.index=null,Dt=!0;else for(let Sn=0,An=mn.length;Sn<An;Sn++)mn[Sn]=Sn}Ct.boundsTree=null,Dt&&Ct.dispose()}(st,e.geometry,[...ct,...dt],_);const wt=st.groups;if(et){const Ct=new Map,bt=[...mt,...yt];let At=0;for(let Pt=0,Dt=bt.length;Pt<Dt;Pt++)wt.find(Nt=>Nt.materialIndex===Pt)?(Ct.set(Pt,At),At++):bt[Pt]=null;for(let Pt=0,Dt=wt.length;Pt<Dt;Pt++){const Nt=wt[Pt];Nt.materialIndex=Ct.get(Nt.materialIndex)}o.material=bt.filter(Pt=>Pt)}return o}evaluateHierarchy(e,i=new tD){e.updateMatrixWorld(!0);const s=(c,_)=>{const j=c.children;for(let et=0,nt=j.length;et<nt;et++){const st=j[et];st.isOperationGroup?s(st,_):_(st)}},o=c=>{const _=c.children;let j=!1;for(let nt=0,st=_.length;nt<st;nt++){const at=_[nt];j=o(at)||j}const et=c.isDirty();if(et&&c.markUpdated(),j&&!c.isOperationGroup){let nt;return s(c,st=>{nt=nt?this.evaluate(nt,st,st.operation):this.evaluate(c,st,st.operation)}),c._cachedGeometry=nt.geometry,c._cachedMaterials=nt.material,!0}return j||et};return o(e),i.geometry=e._cachedGeometry,i.material=e._cachedMaterials,i}reset(){this.triangleSplitter.reset()}}const BU={union:tU,subtract:nU,intersect:iU,difference:rU};function LU(h,e){const i=new Q5;i.useGroups=!0,i.attributes=["position","normal","uv"],h.forEach(c=>{for(const _ of[...i.attributes])c[0].geometry.getAttribute(_)||i.attributes.splice(i.attributes.indexOf(_),1)});let s=new tD(new g._12(.01,.01,2,2));h.forEach(([c,_])=>{if(!Object.keys(BU).includes(_))return void console.error(`Unknown operation ${_}`);c.updateMatrix(),c.updateMatrixWorld();const j=new tD;j.geometry=c.geometry,j.material=c.material,c.matrixWorld.decompose(j.position,j.quaternion,j.scale),j.updateMatrix(),j.updateMatrixWorld(),s=i.evaluate(s,j,BU[_])});const o=s;return o.userData._isCSGMesh=!0,o}let UI=class extends qw{_buildCSGMesh(h){return LU(h)}};UI.PluginType="CSGPluginBVH",UI=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_}([ks("CSG Plugin (BVH)")],UI);class nD extends ms{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var i,s,o,c;(s=(i=e.lastCamera)==null?void 0:i.removeControlsCtor)==null||s.call(i,this.controlsKey),(c=(o=e.camera)==null?void 0:o.setControlsCtor)==null||c.call(o,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}var NU=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};const W5=new g.Pa4(0,0,1),UU=new g.USm,q5=new g._fP,X5=new g._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),ET=new g._fP,Y5={type:"change"};let FI=class extends b.SimpleEventDispatcher{constructor(h){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new g._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new g._fP,this._initQuaternionInvert=new g._fP,this._initQuaternionDest=new g._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=h,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(h=>{h=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(h=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",h)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new g._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const h=this.deviceOrientation;if(h){const e=h.alpha!==null?g.M8C.degToRad(h.alpha):0,i=h.beta!==null?g.M8C.degToRad(h.beta):0,s=h.gamma!==null?g.M8C.degToRad(h.gamma):0,o=this.screenOrientation?g.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,i,s,o),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(Y5))}}dispose(){this.disconnect()}setObjectQuaternion(h,e,i,s){const o=(0,b.now)()/1e3;UU.set(e,h,-i,"YXZ"),ET.setFromEuler(UU),ET.multiply(X5),ET.multiply(q5.setFromAxisAngle(W5,-s)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(ET).invert(),this._initQuaternionDest.__init=!0),ET.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(ET,this.dampingFactor/(Math.min(1,o-this._lastTime)/(1/60))),this._lastTime=o}};NU([En(),ns("Damping",[0,1],.01)],FI.prototype,"dampingFactor",void 0),FI=NU([W_("Device Orientation Controls")],FI);class oL extends nD{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,i)=>new FI(e)}}oL.PluginType="DeviceOrientationControlsPlugin";var v_=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};const FU=new g.Pa4,aL=new g.$V,lL=new g.Pa4,$5={type:"change"};let um=class extends b.SimpleEventDispatcher{constructor(h,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new g.Pa4,this._lastTime=-1,this.object=h,this.domElement=e,this.onPointerMove=this.onPointerMove.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const h=this.object.quaternion;FU.set(0,0,-1).applyQuaternion(h),aL.setFromVector3(FU),this.lat=90-g.M8C.radToDeg(aL.phi),this.lon=g.M8C.radToDeg(aL.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onPointerDown(h){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(h.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onPointerUp(h){if(this.activeLook)switch(h.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onPointerMove(h){this.domElement===document?(this.pointerX=h.pageX-this.viewHalfX,this.pointerY=h.pageY-this.viewHalfY):(this.pointerX=h.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=h.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(h){if(this.enableKeys)switch(h.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(h){if(this.enableKeys)switch(h.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(h,e,i){return h.isVector3?lL.copy(h):e===void 0||i===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):lL.set(h,e,i),this.object.lookAt(lL),this.setOrientation(),this}update(){const h=(0,b.now)(),e=(this._lastTime<0?16:Math.min(h-this._lastTime,1e3))/1e3;if(this._lastTime=h,!this.enabled)return;if(this.heightSpeed){const et=g.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(et*this.heightCoef)}else this.autoSpeedFactor=0;const i=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(i+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(i),this.moveLeft&&this.object.translateX(-i),this.moveRight&&this.object.translateX(i),this.moveUp&&this.object.translateY(i),this.moveDown&&this.object.translateY(-i);let s=e*this.lookSpeed;this.activeLook||(s=0);let o=1;this.constrainVertical&&(o=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.pointerX*s,this.lookVertical&&(this.lat-=this.pointerY*s*o),this.lat=Math.max(-85,Math.min(85,this.lat));let c=g.M8C.degToRad(90-this.lat);const _=g.M8C.degToRad(this.lon);this.constrainVertical&&(c=g.M8C.mapLinear(c,0,Math.PI,this.verticalMin,this.verticalMax));const j=this.object.position;this.targetPosition.setFromSphericalCoords(1,c,_).add(j),this.object.lookAt(this.targetPosition),this.dispatchEvent($5)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(h){this.enableKeys&&h.preventDefault()}};v_([En(),jr()],um.prototype,"enabled",void 0),v_([En(),jr()],um.prototype,"enableKeys",void 0),v_([En(),$s()],um.prototype,"movementSpeed",void 0),v_([En(),$s()],um.prototype,"lookSpeed",void 0),v_([En(),jr()],um.prototype,"lookVertical",void 0),v_([En(),jr()],um.prototype,"autoForward",void 0),v_([En(),jr()],um.prototype,"activeLook",void 0),v_([En(),jr()],um.prototype,"heightSpeed",void 0),v_([En(),$s()],um.prototype,"heightCoef",void 0),v_([En(),$s()],um.prototype,"heightMin",void 0),v_([En(),$s()],um.prototype,"heightMax",void 0),v_([En(),jr()],um.prototype,"constrainVertical",void 0),v_([En(),$s()],um.prototype,"verticalMin",void 0),v_([En(),$s()],um.prototype,"verticalMax",void 0),v_([En(),jr()],um.prototype,"mouseDragOn",void 0),um=v_([ks("First Person Controls")],um);class cL extends nD{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,i)=>new um(e,i)}}cL.PluginType="FirstPersonControlsPlugin";var ST=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};const CT=new g.USm(0,0,0,"YXZ"),TT=new g.Pa4,K5={type:"change"},J5={type:"lock"},Z5={type:"unlock"},jU=Math.PI/2;let Zw=class extends b.SimpleEventDispatcher{constructor(h,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new g.Pa4(0,0,-1),this.domElement=e,this.object=h,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(h){this.isLocked||this.autoLockOnClick&&(h.preventDefault(),this.lock())}onMouseMove(h){this.isLocked&&(this._movementX+=h.movementX||h.mozMovementX||h.webkitMovementX||0,this._movementY+=h.movementY||h.mozMovementY||h.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(J5),this.isLocked=!0):(this.dispatchEvent(Z5),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(h){return h.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(h){TT.setFromMatrixColumn(this.object.matrix,0),TT.crossVectors(this.object.up,TT),this.object.position.addScaledVector(TT,h)}moveRight(h){TT.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(TT,h)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Math.abs(this._movementX)<1e-4&&Math.abs(this._movementY)<1e-4||(CT.setFromQuaternion(this.object.quaternion),CT.y-=.002*this._movementX*this.pointerSpeed,CT.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,CT.x=Math.max(jU-this.maxPolarAngle,Math.min(jU-this.minPolarAngle,CT.x)),this.object.quaternion.setFromEuler(CT),this.dispatchEvent(K5))}};ST([jr(),En()],Zw.prototype,"enabled",void 0),ST([$s(),En()],Zw.prototype,"minPolarAngle",void 0),ST([$s(),En()],Zw.prototype,"maxPolarAngle",void 0),ST([$s(),En()],Zw.prototype,"pointerSpeed",void 0),ST([jr(),En()],Zw.prototype,"autoLockOnClick",void 0),Zw=ST([W_("Pointer Lock Controls")],Zw);class uL extends nD{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,i)=>new Zw(e,i.ownerDocument?i:i.documentElement)}}uL.PluginType="PointerLockControlsPlugin";class zU{constructor(){this._animations=[],this._playingAnimations=new Set,this._clock=new g.SUY}loadModel(e){this._model=e,this.mixer=new g.Xcj(e),e&&(this._animations=[...e.animations])}get getMixer(){return this.mixer}get getAnimationClips(){return this._animations}async playAllAnimations(e){var s;const i=[];(s=this._animations)==null||s.forEach(o=>{i.push(this.playClip(o,e))}),await Promise.all(i)}async reverseAllAnimation(e){var s;const i=[];(s=this._animations)==null||s.forEach(o=>{i.push(this.playClip(o,e,1,!0))}),await Promise.all(i)}async playClip(e,i,s=1,o=!1,c=!1){if(!this.mixer)return;const _=this.mixer.clipAction(e);return this._playingAnimations.has(_)&&this.mixer.dispatchEvent({type:"canceled",action:_}),c&&(this.mixer.setTime(0),this.mixer.stopAllAction()),o?(_.paused=!1,_.timeScale=-s):(_.reset(),_.timeScale=s),_.loop=i?g.YKA:g.jAl,_.clampWhenFinished=!0,new Promise(j=>{const et=async nt=>{nt.action===_&&(this.mixer.removeEventListener("finished",et),this.mixer.removeEventListener("canceled",et),this._playingAnimations.delete(_),j())};this.mixer.addEventListener("finished",et),this.mixer.addEventListener("canceled",et),this._playingAnimations.add(_),_.play()})}playClipByName(e,i,s=1,o=!1){let c;this._animations.forEach(_=>{_.name===e&&(c=_)}),c&&this.playClip(c,i,s,o)}update(){const e=this._clock.getDelta();return this._playingAnimations.size>0&&(this.mixer.update(e),!0)}}class VU extends ms{constructor(){super(),this.helperIdentities=new Map}async onAdded(e){var i;await super.onAdded(e),(i=this._viewer)==null||i.addEventListener("postFrame",()=>{this.helperIdentities.forEach(s=>{var o;s.update()&&((o=this._viewer)==null||o.setDirty())})})}createHelper(e,i){var s;if(this.helperIdentities.has(e))(s=this._viewer)==null||s.console.warn("Helper with this id already exists");else{const o=new zU;o.loadModel(i),this.helperIdentities.set(e,o)}}getAnimationClips(e){if(this.helperIdentities.has(e))return this.helperIdentities.get(e).getAnimationClips}async playClip(e,i,s,o=1,c=!1,_=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClip(i,s,o,c,_)}async playAllAnimations(e,i){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playAllAnimations(i)}async playAllAnimationsInReverse(e,i){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).reverseAllAnimation(i)}async playAnimationByName(e,i,s,o=1,c=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClipByName(i,s,o,c)}}VU.PluginType="AnimationHelperPlugin";class jI extends ms{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.defaultActions={exportFile:async(e,i,s)=>{(0,b.downloadBlob)(e,i)}},this.actions={...this.defaultActions}}async exportFile(e,i){i=i||e.name||"file_export",this.dispatchEvent({type:"transferFile",path:i,state:"exporting"}),await this.actions.exportFile(e,i,({state:s,progress:o})=>{this.dispatchEvent({type:"transferFile",path:i,state:s??"exporting",progress:o})}),this.dispatchEvent({type:"transferFile",path:i,state:"done"})}}jI.PluginType="FileTransferPlugin";var MT=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class zA extends ms{_onEnabledChanged1(){this._onEnabledChanged()}_onEnabledChanged(){this._viewer&&(this._viewer.scene.activeCamera.interactionsEnabled=!this.enabled);const e=this._cameraViews.length;this._oldState=e<2?0:g.M8C.clamp(this._currentState,0,e-1.001),this.enabled&&this._animateCameraToView(),this.dispatchEvent({type:"enableChanged",enabled:this.enabled})}constructor(e=!0){super(),this.enabled=!0,this.animEase="easeInOutSine",this.interpolateMode="spherical",this.enableDamping=!0,this.damping=.04,this.initAnimationTime=1,this.dependencies=[zl],this._currentState=0,this._oldState=0,this._overrideTime=0,this._preFrame1=i=>{this._preFrame(i)},this.enabled=e,this._onEnabledChanged1=this._onEnabledChanged1.bind(this)}get _cameraViews(){var e,i;return((i=(e=this._viewer)==null?void 0:e.getPlugin(zl))==null?void 0:i.camViews)??[]}setState(e){this._currentState=e}async onAdded(e){await super.onAdded(e),this.enabled&&this._onEnabledChanged(),e.addEventListener("preFrame",this._preFrame1)}async onRemove(e){return e.removeEventListener("preFrame",this._preFrame1),this.enabled=!1,super.onRemove(e)}_preFrame(e){var nt;if(!this.enabled)return;const i=this._cameraViews;if(i.length<=1||!this._overrideStartView&&Math.abs(this._currentState-this._oldState)<.001)return;this.enableDamping?this._oldState=g.M8C.lerp(this._oldState,this._currentState,this.damping):this._oldState=this._currentState,this._oldState=g.M8C.clamp(this._oldState,0,i.length-1.001);const s=Math.floor(this._oldState),o=this._overrideStartView||i[s],c=this._overrideEndView||i[s+1];let _,j=this._overrideStartView?this._overrideTime:this._oldState-s;j=fA[this.animEase](j),_=this.interpolateMode==="spherical"?this._lerpViewsSpherical(o,c,j):this._lerpViewsLinear(o,c,j);const et=(nt=this._viewer)==null?void 0:nt.scene.activeCamera;et&&(et.position.copy(_[0]),et.target.copy(_[1]),et.positionTargetUpdated(!0)),this._overrideStartView&&(this._overrideTime+=e.deltaTime/1e3,this._overrideTime>=this.initAnimationTime&&(this._overrideTime=0,this._overrideStartView=void 0,this._overrideEndView=void 0))}_lerpViewsLinear(e,i,s){const o=new g.Pa4,c=new g.Pa4;return c.lerpVectors(e.position,i.position,s),o.lerpVectors(e.target,i.target,s),[c,o]}_lerpViewsSpherical(e,i,s){const o=e.target.clone(),c=new g.Pa4,_=new g.Pa4,j=Fm(e,e.target),et=Fm(i,i.target),nt=new g.$V;return nt.phi=zv(j.phi,et.phi,s),nt.theta=zv(j.theta,et.theta,s),nt.radius=g.M8C.lerp(j.radius,et.radius,s),c.copy(o).lerp(i.target,s),_.setFromSpherical(nt),_.add(c),[_,c]}_animateCameraToView(){const e=this._cameraViews;if(!this._viewer||e.length<2||!this.enabled)return;this._overrideStartView=new Qp(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target);const i=Math.floor(this._oldState),s=this._oldState-i;let o;o=this.interpolateMode==="spherical"?this._lerpViewsSpherical(e[i],e[i+1],s):this._lerpViewsLinear(e[i],e[i+1],s),this._overrideEndView=new Qp(o[0],o[1]),this._overrideTime=0}}zA.PluginType="CameraViewControlPlugin",MT([jr("Enabled"),(0,b.onChange)(zA.prototype._onEnabledChanged1),En()],zA.prototype,"enabled",void 0),MT([En(),Pm("Ease",Object.keys(fA).map(h=>({label:h})))],zA.prototype,"animEase",void 0),MT([En(),Pm("Interpolation",["spherical","linear"].map(h=>({label:h})))],zA.prototype,"interpolateMode",void 0),MT([jr("Enable Damping"),En()],zA.prototype,"enableDamping",void 0),MT([ns("Damping",[.01,1],.001),En()],zA.prototype,"damping",void 0),MT([ns("Init Anim Time",[.01,5],.001),En()],zA.prototype,"initAnimationTime",void 0);class hL extends zA{constructor(e=document.body,i=!0){super(i),this.wrapper=document.createElement("div"),this.toJSON=void 0,this.uiConfig={type:"folder",label:"Scrollable Camera Views",children:[...Q_(this)]},typeof e=="string"?(this.parent=document.getElementById(e),this.parent||(console.error("parent doesn't exist"),this.parent=document.body)):this.parent=e}_preFrame(e){if(!this.enabled||this._cameraViews.length<=1)return;const i=this._findActiveView(),s=this._getScroll(i);this.setState(s+i),super._preFrame(e)}_getScroll(e){if(e>=this._cameraViews.length-1)return 0;const i=this.parent.querySelector(this._cameraViews[e].name)??this.parent.getElementsByTagName("section")[e],s=this.parent.querySelector(this._cameraViews[e+1].name)??this.parent.getElementsByTagName("section")[e+1],o=this.parent.getBoundingClientRect();if(!i||!s)return 0;const c=i.getBoundingClientRect(),_=s.getBoundingClientRect(),j=this.parent===document.body?0:o.top;return g.M8C.clamp((j-c.top)/Math.max(_.top-c.top,1e-4),0,1)}_findActiveView(){var e;for(let i=this._cameraViews.length-1;i>=0;i--){const s=this.parent.querySelector(this._cameraViews[i].name)??this.parent.getElementsByTagName("section")[i],o=this.parent.getBoundingClientRect();if(s){if(s.getBoundingClientRect().top<(this.parent===document.body?0:o.top))return i}else(e=this._cameraViews[i].name)!=null&&e.startsWith("#")&&console.error("section with id "+this._cameraViews[i].name+" doesn't exist!")}return 0}}hL.PluginType="ScrollableCameraViewPlugin";var dL,pL=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let R1=dL=class extends hL{generateCode(){var o;const h=document.createElement("div");h.style.position="absolute",h.style.top="0",h.style.width="100%",h.style.height="100%",h.style.display="flex",h.style.flexDirection="column",h.style.justifyContent="center",h.style.alignItems="center",h.style.zIndex="200";const e=document.createElement("textarea");e.rows=20,e.style.border="3px solid #27223a",e.style.borderRadius="5px",e.style.width="30%",e.style.padding="5px",e.style.zIndex="1000";const i=document.createElement("div");i.textContent="X",i.style.color="red",i.style.width="20px",i.style.height="20px",i.style.padding="2",i.style.textAlign="center",i.style.backgroundColor="white",i.style.borderRadius="100%",i.style.border="2px solid #27223a",i.style.cursor="pointer",i.addEventListener("click",()=>{var c;(c=this._viewer)==null||c.container.removeChild(h)});const s=document.createElement("div");s.textContent="Update",s.style.marginTop="10px",s.style.color="white",s.style.padding="4px 10px 4px 10px",s.style.justifyContent="center",s.style.alignItems="center",s.style.backgroundColor="green",s.style.borderRadius="10px",s.style.border="2px solid #fff",s.style.cursor="pointer",s.addEventListener("click",()=>{var j;const c=this.parent.innerHTML;this.parent.innerHTML=e.value;let _=0;for(;_<this._cameraViews.length;_++){const et=this.parent.querySelector(this._cameraViews[_].name)??this.parent.getElementsByTagName("section")[_];if(!et&&_<2){alert("you need to add 2 sections at least");break}if(!et){const nt=((j=this._cameraViews[_].name)==null||j.startsWith("#"),this._cameraViews[_].name.replace(/^#/,""));e.value+=nt,e.value=this._format(e.value)}}_<2?this.parent.innerHTML=c:async function(et,nt){var at;et.innerHTML=nt;const st=et.getElementsByTagName("script");for(let ct=0;ct<st.length;ct++){const dt=st[ct],mt=X4(dt);let yt=!1;await new Promise(wt=>{mt.onload=wt,mt.onerror=()=>{yt=!0,wt(void 0)}}),yt||((at=dt.parentNode)==null||at.replaceChild(mt,dt))}}(this.parent,e.value)}),h.appendChild(i),h.appendChild(e),h.appendChild(s),e.value=this._format(this.parent.innerHTML),(o=this._viewer)==null||o.container.appendChild(h)}_onEnabledChanged(){super._onEnabledChanged(),this._togglePreview()}_togglePreview(){this.wrapper&&(this.wrapper.style.zIndex=this.canvasUp?"-100":"100",this.wrapper.style.visibility=this.enabled?"visible":"hidden",this._viewer&&(this._viewer.canvas.style.pointerEvents=this.enabled&&this.canvasUp?"none":"auto"))}constructor(h=document.body,e=!1){super(h,e),this.canvasUp=!1,this._togglePreview=this._togglePreview.bind(this),this.generateCode=this.generateCode.bind(this)}async onAdded(h){var e,i,s,o,c,_;this.parent=this.wrapper,await super.onAdded(h),this._addWrapper(),this._togglePreview(),this.deserialize=this.deserialize.bind(this),this.addView=this.addView.bind(this),this.deleteView=this.deleteView.bind(this),(i=(e=this._viewer)==null?void 0:e.getPlugin(zl))==null||i.addEventListener("viewDelete",this.deleteView),(o=(s=this._viewer)==null?void 0:s.getPlugin(zl))==null||o.addEventListener("deserialize",this.deserialize),(_=(c=this._viewer)==null?void 0:c.getPlugin(zl))==null||_.addEventListener("viewAdd",this.addView)}deserialize(h){this._cameraViews.forEach(e=>{this._createSection(e.name)})}_addWrapper(){var h;this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.zIndex="-100",this.wrapper.style.position="absolute",this.wrapper.style.top="0",this.wrapper.id="parentWrapper",this.wrapper.style.borderRadius="10px",this.wrapper.style.overflowY="scroll",this.wrapper.style.overflowX="hidden",(h=this._viewer)==null||h.container.appendChild(this.wrapper)}_createSection(h){const e=document.createElement("section");e.style.width="100%",e.style.height="100%",e.style.opacity="50%",e.style.backgroundColor="black",e.style.zIndex="100",e.style.top="0",e.textContent=h,e.style.color="white",e.style.fontSize="100px",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.id=h,this.parent.appendChild(e)}addView(h){this._cameraViews.forEach((e,i)=>{var s;if(!(this.parent.querySelector(e.name)??this.parent.getElementsByTagName("section")[i])){const o=`<section id="${(s=e.name)!=null&&s.startsWith("#")?e.name.replace(/^#/,""):""}" style="width: 100%; height: 100%; opacity: 0.5; background-color: black; z-index: 100; top: 0px; color: white; font-size: 100px; display: flex; align-items: center; justify-content: center;">
                    ${e.name}
                    </section>`;this.parent.innerHTML+=o}})}deleteView(h){const e=this.parent.querySelector(h.view.name)??this.parent.getElementsByTagName("section").namedItem(h.view.name);e==null||e.remove()}_format(h){let e="",i="";return h.split(/>\s*</).forEach(function(s){s.match(/^\/\w/)&&(i=i.substring(1)),e+=i+"<"+s+`>\r
`,s.match(/^<?\w[^>]*[^/]$/)&&!s.startsWith("input")&&(i+="	")}),e.substring(1,e.length-3)}};pL([Oo("Show/Edit Code")],R1.prototype,"generateCode",null),pL([jr("Canvas on top"),(0,b.onChange)(dL.prototype._togglePreview)],R1.prototype,"canvasUp",void 0),R1=dL=pL([ks("Scrollable Camera View Preview (Dev)")],R1);var fL={d:(h,e)=>{for(var i in e)fL.o(e,i)&&!fL.o(h,i)&&Object.defineProperty(h,i,{enumerable:!0,get:e[i]})},o:(h,e)=>Object.prototype.hasOwnProperty.call(h,e)},GU={};fL.d(GU,{Q:()=>rV});var mL=function(h,e,i,s){return new(i||(i=Promise))(function(o,c){function _(nt){try{et(s.next(nt))}catch(st){c(st)}}function j(nt){try{et(s.throw(nt))}catch(st){c(st)}}function et(nt){var st;nt.done?o(nt.value):(st=nt.value,st instanceof i?st:new i(function(at){at(st)})).then(_,j)}et((s=s.apply(h,e||[])).next())})};const HU=Symbol("Comlink.proxy"),eV=Symbol("Comlink.endpoint"),tV=Symbol("Comlink.releaseProxy"),gL=Symbol("Comlink.thrown"),QU=h=>typeof h=="object"&&h!==null||typeof h=="function",WU=new Map([["proxy",{canHandle:h=>QU(h)&&h[HU],serialize(h){const{port1:e,port2:i}=new MessageChannel;return qU(h,e),[i,[i]]},deserialize:h=>(h.start(),YU(h))}],["throw",{canHandle:h=>QU(h)&&gL in h,serialize({value:h}){let e;return e=h instanceof Error?{isError:!0,value:{message:h.message,name:h.name,stack:h.stack}}:{isError:!1,value:h},[e,[]]},deserialize(h){throw h.isError?Object.assign(new Error(h.value.message),h.value):h.value}}]]);function qU(h,e=self){e.addEventListener("message",function i(s){if(!s||!s.data)return;const{id:o,type:c,path:_}=Object.assign({path:[]},s.data),j=(s.data.argumentList||[]).map(mS);let et;try{const nt=_.slice(0,-1).reduce((at,ct)=>at[ct],h),st=_.reduce((at,ct)=>at[ct],h);switch(c){case"GET":et=st;break;case"SET":nt[_.slice(-1)[0]]=mS(s.data.value),et=!0;break;case"APPLY":et=st.apply(nt,j);break;case"CONSTRUCT":et=iD(new st(...j));break;case"ENDPOINT":{const{port1:at,port2:ct}=new MessageChannel;qU(h,ct),et=function(dt,mt){return KU.set(dt,mt),dt}(at,[at])}break;case"RELEASE":et=void 0;break;default:return}}catch(nt){et={value:nt,[gL]:0}}Promise.resolve(et).catch(nt=>({value:nt,[gL]:0})).then(nt=>{const[st,at]=vL(nt);e.postMessage(Object.assign(Object.assign({},st),{id:o}),at),c==="RELEASE"&&(e.removeEventListener("message",i),XU(e))})}),e.start&&e.start()}function XU(h){(function(e){return e.constructor.name==="MessagePort"})(h)&&h.close()}function YU(h,e){return _L(h,[],e)}function rD(h){if(h)throw new Error("Proxy has been released and is not useable")}function _L(h,e=[],i=function(){}){let s=!1;const o=new Proxy(i,{get(c,_){if(rD(s),_===tV)return()=>IT(h,{type:"RELEASE",path:e.map(j=>j.toString())}).then(()=>{XU(h),s=!0});if(_==="then"){if(e.length===0)return{then:()=>o};const j=IT(h,{type:"GET",path:e.map(et=>et.toString())}).then(mS);return j.then.bind(j)}return _L(h,[...e,_])},set(c,_,j){rD(s);const[et,nt]=vL(j);return IT(h,{type:"SET",path:[...e,_].map(st=>st.toString()),value:et},nt).then(mS)},apply(c,_,j){rD(s);const et=e[e.length-1];if(et===eV)return IT(h,{type:"ENDPOINT"}).then(mS);if(et==="bind")return _L(h,e.slice(0,-1));const[nt,st]=$U(j);return IT(h,{type:"APPLY",path:e.map(at=>at.toString()),argumentList:nt},st).then(mS)},construct(c,_){rD(s);const[j,et]=$U(_);return IT(h,{type:"CONSTRUCT",path:e.map(nt=>nt.toString()),argumentList:j},et).then(mS)}});return o}function $U(h){const e=h.map(vL);return[e.map(s=>s[0]),(i=e.map(s=>s[1]),Array.prototype.concat.apply([],i))];var i}const KU=new WeakMap;function iD(h){return Object.assign(h,{[HU]:!0})}function vL(h){for(const[e,i]of WU)if(i.canHandle(h)){const[s,o]=i.serialize(h);return[{type:"HANDLER",name:e,value:s},o]}return[{type:"RAW",value:h},KU.get(h)||[]]}function mS(h){switch(h.type){case"HANDLER":return WU.get(h.name).deserialize(h.value);case"RAW":return h.value}}function IT(h,e,i){return new Promise(s=>{const o=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");h.addEventListener("message",function c(_){_.data&&_.data.id&&_.data.id===o&&(h.removeEventListener("message",c),s(_.data))}),h.start&&h.start(),h.postMessage(Object.assign({id:o},e),i)})}class nV extends class{}{init(e,i,s,o){if(!this.api){if(!o)throw new Error("workerFilePath is required");(()=>{var c,_,j;c=this,j=function*(){const et=yield fetch(o).then(at=>at.blob()),nt=URL.createObjectURL(et),st=new Worker(nt,{type:"module"});this.api=yield new(YU(st))(iD(()=>{e(),URL.revokeObjectURL(nt)}),iD((at,ct)=>at==="xatlas_web.wasm"?s:at+ct),iD(i))},new((_=void 0)||(_=Promise))(function(et,nt){function st(dt){try{ct(j.next(dt))}catch(mt){nt(mt)}}function at(dt){try{ct(j.throw(dt))}catch(mt){nt(mt)}}function ct(dt){var mt;dt.done?et(dt.value):(mt=dt.value,mt instanceof _?mt:new _(function(yt){yt(mt)})).then(st,at)}ct((j=j.apply(c,[])).next())})})()}}}class rV extends class{constructor(e,i={resolution:2048},s={},o=!1,c=!1,_=!1){this.THREE=e,this.packOptions=i,this.chartOptions=s,this.useNormals=o,this.timeUnwrap=c,this.logProgress=_,this._libraryLoaded=!1,this._isUnwrapping=!1,this.xAtlas=this._createXAtlas()}loadLibrary(e,i,s){return mL(this,void 0,void 0,function*(){if(!this._libraryLoaded){for(yield new Promise((o,c)=>{try{this.xAtlas.init(()=>{o()},e,i,s)}catch(_){c(_)}});!this.xAtlas.api||!(yield this.xAtlas.api.loaded);)yield new Promise(o=>setTimeout(o,100));this._libraryLoaded=!0}})}packAtlas(e,i="uv2",s="uv"){return mL(this,void 0,void 0,function*(){if(!this._libraryLoaded)return console.warn("xatlas-three: library not loaded"),[];if(!e)return[];if(e.length<1)return[];const o=this.chartOptions.useInputMeshUvs;for(;this._isUnwrapping;)console.log("xatlas-three: unwrapping another mesh, waiting 100 ms"),yield new Promise(nt=>setTimeout(nt,100));this._isUnwrapping=!0,yield this.xAtlas.api.setProgressLogging(this.logProgress),yield this.xAtlas.api.createAtlas();let c=[],_="";for(let nt of e){let{uuid:st,index:at,attributes:ct}=nt;const dt=nt.userData.worldScale||1;c.push(st),at&&ct.position&&ct.position.itemSize===3?(_="Mesh"+c.length+" added to atlas: "+st,this.timeUnwrap&&console.time(_),yield this.xAtlas.api.addMesh(at.array,ct.position.array,ct.normal?ct.normal.array:void 0,ct.uv?ct.uv.array:void 0,st,this.useNormals,o,dt),this.timeUnwrap&&console.timeEnd(_)):console.warn("xatlas-three: Geometry not supported: ",nt)}_="Generated atlas with "+c.length+" meshes",this.timeUnwrap&&console.time(_);let j=yield this.xAtlas.api.generateAtlas(this.chartOptions,this.packOptions,!0);this.timeUnwrap&&console.timeEnd(_);let et=[];for(let nt of j){let st=e.find(at=>at.uuid===nt.mesh);st?(nt.vertex.vertices&&st.setAttribute("position",new this.THREE.BufferAttribute(nt.vertex.vertices,3,!1)),nt.vertex.normals&&st.setAttribute("normal",new this.THREE.BufferAttribute(nt.vertex.normals,3,!0)),nt.vertex.coords1&&st.setAttribute(i,new this.THREE.BufferAttribute(nt.vertex.coords1,2,!1)),nt.vertex.coords&&i!==s&&st.setAttribute(s,new this.THREE.BufferAttribute(nt.vertex.coords,2,!1)),nt.index&&st.setIndex(new this.THREE.BufferAttribute(nt.index,1,!1)),et.push(st)):console.error("xatlas-three: Mesh not found: ",nt.mesh)}return yield this.xAtlas.api.destroyAtlas(),this._isUnwrapping=!1,et})}unwrapGeometry(e,i="uv",s="uv2"){return mL(this,void 0,void 0,function*(){return this.packAtlas([e],i,s)})}}{_createXAtlas(){return new nV}}var zI,iV=GU.Q,hu=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let z_=class{constructor(){this.fixWinding=!1,this.maxBoundaryLength=0,this.maxChartArea=0,this.maxCost=2,this.maxIterations=1,this.normalDeviationWeight=2,this.normalSeamWeight=4,this.roundnessWeight=.009999999776482582,this.straightnessWeight=6,this.textureSeamWeight=.5,this.useInputMeshUvs=!1}};hu([En()],z_.prototype,"fixWinding",void 0),hu([En()],z_.prototype,"maxBoundaryLength",void 0),hu([En()],z_.prototype,"maxChartArea",void 0),hu([En()],z_.prototype,"maxCost",void 0),hu([En()],z_.prototype,"maxIterations",void 0),hu([En()],z_.prototype,"normalDeviationWeight",void 0),hu([En()],z_.prototype,"normalSeamWeight",void 0),hu([En()],z_.prototype,"roundnessWeight",void 0),hu([En()],z_.prototype,"straightnessWeight",void 0),hu([En()],z_.prototype,"textureSeamWeight",void 0),hu([En()],z_.prototype,"useInputMeshUvs",void 0),z_=hu([ks("Chart Options"),Yo("UChartOptions")],z_);let xv=class{constructor(){this.bilinear=!0,this.blockAlign=!1,this.bruteForce=!1,this.createImage=!1,this.maxChartSize=0,this.padding=0,this.resolution=0,this.rotateCharts=!0,this.rotateChartsToAxis=!0,this.texelsPerUnit=0}};hu([En()],xv.prototype,"bilinear",void 0),hu([En()],xv.prototype,"blockAlign",void 0),hu([En()],xv.prototype,"bruteForce",void 0),hu([En()],xv.prototype,"createImage",void 0),hu([En()],xv.prototype,"maxChartSize",void 0),hu([En()],xv.prototype,"padding",void 0),hu([En()],xv.prototype,"resolution",void 0),hu([En()],xv.prototype,"rotateCharts",void 0),hu([En()],xv.prototype,"rotateChartsToAxis",void 0),hu([En()],xv.prototype,"texelsPerUnit",void 0),xv=hu([ks("Pack Options"),Yo("UPackOptions")],xv);let R0=zI=class extends ms{constructor(h=!1){super(),this.enabled=!0,this.useNormals=!0,this.chartOptions=new z_,this.packOptions=new xv,this._loaded=!1,this._unwrapProgress=(e,i)=>{console.log("Unwrapping",e,i)},this.unwrapSelected=async()=>{var i,s,o,c,_;const e=(s=(i=this._viewer)==null?void 0:i.getPlugin(Bo))==null?void 0:s.getSelectedObject();if(e)if(e.geometry){if(e.geometry.attributes.uv&&!await((o=this._viewer)==null?void 0:o.confirm("Unwrap: Geometry already has UVs. Overwrite?")))return;await this.unwrapGeometry(e.geometry)}else(c=this._viewer)==null||c.alert("Unwrap: Selected object has no geometry");else(_=this._viewer)==null||_.alert("Unwrap: No object selected")},h&&this.loadLibrary()}async loadLibrary(){if(this._unwrapper)for(;!this._loaded;)await(0,b.timeout)(100);else this._unwrapper=new iV({BufferAttribute:g.TlE},this.packOptions,this.chartOptions,this.useNormals),await this._unwrapper.loadLibrary(this._unwrapProgress,zI.LIBRARY_PATH+"xatlas.wasm",zI.LIBRARY_PATH+"xatlas.js"),console.log("xatlas loaded"),this._loaded=!0}async unwrapGeometry(h,e="uv",i="uv"){var s;await this.loadLibrary(),await((s=this._unwrapper)==null?void 0:s.unwrapGeometry(h,e,i))}async packAtlas(h,e=!0,i="uv2",s="uv"){var c;await this.loadLibrary(),Array.isArray(h)||(h=[h]);const o=[];e?h.forEach(_=>_.traverse(j=>{j.geometry&&o.push(j.geometry)})):h.forEach(_=>{_.geometry&&o.push(_.geometry)}),await((c=this._unwrapper)==null?void 0:c.packAtlas(o,i,s))}_useNormalsChanged(){this._unwrapper&&(this._unwrapper.useNormals=this.useNormals)}};R0.PluginType="XAtlasPlugin",R0.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/xatlasjs@0.1.0/dist/",hu([(0,b.onChange)(zI.prototype._useNormalsChanged),En()],R0.prototype,"useNormals",void 0),hu([En()],R0.prototype,"chartOptions",void 0),hu([En()],R0.prototype,"packOptions",void 0),hu([Oo("Unwrap Selected Geometry")],R0.prototype,"unwrapSelected",void 0),R0=zI=hu([ks("UV Unwrapping (xAtlas)")],R0);class VI extends ms{constructor(){super(...arguments),this.dependencies=[Fr],this.enabled=!0,this.baseUrl="",this.variations={objects:[],materials:[]},this.autoDispose=!0,this._ty=["objects","materials"],this._extForType={objects:["glb","fbx","obj","gltf","stl","3dm","json","vjson"],materials:["pmat","dmat"],images:["png","jpg","jpeg","gif","bmp","webp","svg"]},this.utils={getName:e=>e.name||e.prefix.replace(/^\//,"").replace(/\/$/,"").replaceAll("/","_"),getTitle:e=>e.title||this.utils.getName(e),getIcon:(e,i)=>{let s=e.icon;return(s&&/^(\w+)\(([^)]*)\)/.exec(s)||/^#([A-Fa-f\d]+)$/.exec(s))&&(s=(0,b.makeColorSvg)(s)),s&&s.startsWith("http")&&s.startsWith("data:")||(s=this.utils.pathToIcon(this.baseUrl+i+"/"+e.prefix+(s||""))),s},getItemIcon:(e,i,s)=>{const o=e.iconFiles[i];if(o)return URL.createObjectURL(o);let c=e.icons[i];return(c&&/^(\w+)\(([^)]*)\)/.exec(c)||/^#([A-Fa-f\d]+)$/.exec(c))&&(c=(0,b.makeColorSvg)(c)),c||(c=this.utils.pathToIcon(e.items[i])),!c||c.startsWith("http")||c.startsWith("data:")||(c=this.baseUrl+s+"/"+e.prefix+c),c},getItemTitle:(e,i)=>e.titles[i]||this.utils.pathToTitle(e.items[i]),getItemPath:(e,i,s)=>e.items[i].startsWith("http")?e.items[i]:`${this.baseUrl}${s}/${e.prefix}${e.items[i]}`,pathToTitle:e=>e.split("/").pop().replace(/\.[^.]*$/,""),pathToIcon:e=>e.replace(/\/$/,"").replace(/\.[^/.]+$/,"")+".webp"},this.toJSON=void 0}_getVariationId(e){return this.utils.getName(e)}async applyVariation(e,i,s,o=!1){var at,ct;if(!this._viewer)return;const c=this._getVariationId(e);typeof i=="number"&&(i=e.items[i]);const _=e.items.indexOf(i);if(_===-1)return void this._viewer.console.warn(`Item ${i} not found`);const j=e.itemFiles[_],et=e.selected;if(!o&&et===_)return;e.selected=_;const nt=this._viewer.getManager(),st=this.utils.getItemPath(e,_,s);if(s==="objects"){let dt=this._viewer.scene.findObjectsByName(c).map(bt=>bt.modelObject);dt.length===0&&(dt=[(await this._viewer.createObject3D()).modelObject],dt[0].name=c),this._viewer.renderEnabled=!1;for(const bt of dt)[...bt.children].forEach(At=>At.dispose&&this.autoDispose?At.dispose():At.removeFromParent());const mt=await this._loadObject(st,j);if(!mt.length)return void(st.endsWith("json")||this._viewer.console.warn(`Object ${st} not found`));let yt=!1;for(const bt of dt){[...bt.children].forEach(At=>At.dispose&&this.autoDispose?At.dispose():At.removeFromParent());for(const At of mt)yt?bt.add(At.modelObject.clone()):bt.add(At.modelObject);yt=!0}const wt=[],Ct=this.variations.materials.filter(bt=>bt&&typeof bt.selected=="number");for(const bt of Ct)wt.push(this.applyVariation(bt,bt.selected,"materials",!0));await Promise.all(wt),this._viewer.renderEnabled=!0}if(s==="materials"){const dt=await this._loadMaterial(st,j);if(!dt)return void this._viewer.console.warn(`Material ${st} not found`);dt.userData.__isVariation=!0;const mt=this._viewer.scene.findObjectsByName(c),yt=wt=>{var Ct,bt,At;wt.material&&(Array.isArray(wt.material)?wt.material.length!==0&&((Ct=e.data)==null?void 0:Ct.matType)!==wt.material[0].typeSlug:((bt=e.data)==null?void 0:bt.matType)!==wt.material.typeSlug)||((At=wt==null?void 0:wt.setMaterial)==null||At.call(wt,dt))};for(const wt of mt)(at=e.data)!=null&&at.traverse?wt.traverse(yt):yt(wt);(ct=nt.materials)==null||ct.applyMaterial(dt,c)}}clearVariations(){const e=this.variations.objects;if(this.variations.materials,this.variations={objects:[],materials:[]},this._viewer)for(const i of e){const s=this._getVariationId(i),o=this._viewer.scene.findObjectsByName(s);for(const c of o)[...c.children].forEach(_=>(_.dispose??_.removeFromParent)())}}async _loadMaterial(e,i){var s,o,c;return(c=(o=(s=this._viewer)==null?void 0:s.getManager())==null?void 0:o.importer)==null?void 0:c.importSinglePath(e,{importedFile:i})}async _loadObject(e,i){var s,o,c;return(c=(o=(s=this._viewer)==null?void 0:s.getManager())==null?void 0:o.importer)==null?void 0:c.importPath(e,{importedFile:i,reimportDisposed:!0})}importConfig(e,i){typeof e=="string"&&(e=JSON.parse(e)),e.baseUrl!==void 0&&(this.baseUrl=e.baseUrl),!i&&e.folder&&(i=typeof e.folder=="object"?e.folder:typeof e.folder=="string"?cw(im(e.folder)):cw(e.folder));for(const s of this._ty)if(e[s])for(const o of e[s]){const c={items:o.items,prefix:o.prefix,name:o.name,title:o.title||"",icon:o.icon||"",icons:o.icons??o.items.map(()=>""),titles:o.titles??o.items.map(()=>""),itemFiles:[],iconFiles:[],data:{...o.data}};if(i)for(let _=0;_<o.items.length;_++){const j=o.items[_],et=i[s+"/"+o.prefix+j];c.itemFiles[_]=et?new File([et],j):void 0;const nt=o.icons[_];if(!nt)continue;const st=i[s+"/"+o.prefix+nt];c.iconFiles[_]=st?new File([st],nt):void 0}this.variations[s].push(c)}}async importPath(e){var i,s;if(e.endsWith(".json")){const o=await((s=(i=this._viewer)==null?void 0:i.getManager().importer)==null?void 0:s.importSinglePath(e,{processImported:!1})),c=e.split("?")[0];return this.baseUrl||(this.baseUrl=c.substring(0,c.lastIndexOf("/")+1)),this.importConfig(o)}e.endsWith(".zip")?alert("not implemented"):alert("not supported")}getMaterials(e){var i;return((i=this.variations.materials.find(s=>this.utils.getName(s)===e))==null?void 0:i.items)||[]}getObjects(e){var i;return((i=this.variations.objects.find(s=>this.utils.getName(s)===e))==null?void 0:i.items)||[]}getMaterialVariations(){return this.variations.materials.map(e=>this.utils.getName(e))}getObjectVariations(){return this.variations.objects.map(e=>this.utils.getName(e))}async onRemove(e){return super.onRemove(e)}fromJSON(e){return super.fromJSON(e)?(this.importConfig(e),this):null}async _exportConfiguratorState(){var o;let e={objects:{},materials:{}};const i={objects:[],materials:[],type:VI.PluginType};this.baseUrl&&(i.baseUrl=this.baseUrl);let s=!1;for(const c of this._ty)for(const _ of this.variations[c]){const j={..._};j.data={...j.data},delete j.itemFiles,delete j.iconFiles,i[c].push(j);const et=_.prefix.replace(/^\//,""),nt=et.trimEnd().endsWith("/")?"":et.split("/").pop()||"",st=et.replace(nt,"").trimEnd().replace(/\/$/,""),at={};let ct=!1;for(let yt=0;yt<_.items.length;yt++){const wt=_.items[yt],Ct=_.itemFiles[yt],bt=_.iconFiles[yt],At=_.icons[yt];Ct?(at[nt+wt]=new Uint8Array(await Ct.arrayBuffer()),bt&&!At&&((o=this._viewer)==null||o.console.error("Icon file without icon name")),bt&&At&&(at[nt+At]=new Uint8Array(await bt.arrayBuffer())),ct=!0):bt&&alert("Icon file without model/material file not supported")}if(!ct)continue;s=!0;const dt=st.split("/");let mt=e[c];for(const yt of dt){mt[yt]||(mt[yt]={});const wt=mt[yt];if(typeof wt!="object")throw new Error("Invalid prefix: "+_.prefix);mt=wt}Object.assign(mt,at)}return s||(e=void 0),{folder:e,config:i}}}VI.PluginType="VariationConfiguratorPlugin";class PT extends VI{constructor(){super(),this._uiNeedRefresh=!1,this._refreshUi=this._refreshUi.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("preFrame",this._refreshUi)}async onRemove(e){return e.removeEventListener("preFrame",this._refreshUi),super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){if(!this.enabled||!this._viewer||!this._uiNeedRefresh)return!1;this._uiNeedRefresh=!1,Cn.RemoveAll(PT.PluginType);for(const e of["objects","materials"])for(const i of this.variations[e])Cn.Create(PT.PluginType,this.utils.getTitle(i),5,20,0,i.items.map((s,o)=>({id:s,image:this.utils.getItemIcon(i,o,e),onClick:async c=>this.applyVariation(i,c,e,!1),tooltip:this.utils.getItemTitle(i,o)})),(s,o)=>f1(s,{placement:"bottom",content:o.tooltip}));return Cn.RebuildUi(this._viewer.container),!0}}PT.PluginType="VariationConfiguratorPlugin";class GI extends PT{constructor(){super(...arguments),this._uiExpandedState={},this.uiConfig={type:"folder",label:"Configurator",children:[{type:"input",label:"Base URL",property:[this,"baseUrl"]},...this._ty.map(e=>({type:"folder",expanded:this._uiExpandedState["__/"+e],onExpand:()=>this._uiExpandedState["__/"+e]=!0,onCollapse:()=>this._uiExpandedState["__/"+e]=!1,label:e,children:[()=>this.variations[e].map(i=>({type:"folder",expanded:this._uiExpandedState[i.name],onExpand:()=>this._uiExpandedState[i.name]=!0,onCollapse:()=>this._uiExpandedState[i.name]=!1,label:()=>this.utils.getName(i),children:[{type:"input",placeholder:()=>this.utils.getName(i),property:[i,"name"]},{type:"input",property:[i,"prefix"]},{type:"input",placeholder:()=>this.utils.pathToTitle(this.utils.getName(i)),property:[i,"title"]},{type:"input",placeholder:()=>this.utils.pathToIcon(this.baseUrl+i.prefix),property:[i,"icon"]},{type:"folder",label:"items",children:i.items.map((s,o)=>({type:"folder",label:()=>i.items[o],children:[{type:"input",label:"File/URL",isMonitor:!i.itemFiles[o],getValue:()=>i.items[o],setValue:c=>{i.items[o]=c}},{type:"input",label:"Icon/Image",placeholder:this.utils.pathToIcon(i.items[o]),getValue:()=>i.icons[o],setValue:c=>{i.icons[o]=c}},{type:"input",label:"Title",placeholder:this.utils.pathToTitle(i.items[o]),getValue:()=>i.titles[o],setValue:c=>{i.titles[o]=c}},{type:"button",label:"Apply",value:async()=>this.applyVariation(i,o,e)},i.itemFiles[o]?[{type:"button",label:"Remove",value:()=>{i.items.splice(o,1),i.itemFiles.splice(o,1),this.refreshUi()}},{type:"button",label:"Replace",value:async()=>{const c=await(0,b.uploadFile)(!1,!1);c.length!==0&&(i.itemFiles[o]=c[0],i.items[o]=c[0].name,this.refreshUi())}},{type:"button",label:"Download",value:async()=>{const c=i.itemFiles[o];(0,b.downloadBlob)(c,c.name)}}]:{}]}))},{type:"button",label:"Add item (local)",value:async()=>{var o,c;const s=await(0,b.uploadFile)(!0,!1);if(s.length!==0){for(const _ of s){if(!this._extForType[e].includes(_.name.split(".").pop()??"")){await((o=this._viewer)==null?void 0:o.alert(`Invalid file: ${_.name} is not a valid ${e} file`));continue}if(i.items.includes(_.name)){await((c=this._viewer)==null?void 0:c.alert(`Already exists: Item with name ${_.name} already exists`));continue}const j=i.items.push(_.name)-1;i.icons[j]="",i.titles[j]="",i.itemFiles[j]=_}this.refreshUi()}}},{type:"button",label:"Add item (url)",value:async()=>{var c,_,j,et;const s=await((c=this._viewer)==null?void 0:c.prompt("URL: Enter the url of the object/material"));if(!s)return;if(!s.startsWith("http")&&!this.baseUrl.startsWith("http"))return void await((_=this._viewer)==null?void 0:_.alert(`Invalid url: ${s} should be a valid HTTP(S) url. If you are passing a relative path, set the baseURL first`));if(!this._extForType[e].includes(s.split(".").pop()??""))return void await((j=this._viewer)==null?void 0:j.alert(`Invalid url: ${s} should be of a material ending with mat`));i.items.includes(s)&&await((et=this._viewer)==null?void 0:et.alert(`Already exists: Item with url ${s} already exists`)),i.items.push(s);const o=i.items.length-1;i.icons[o]="",i.titles[o]="",this.refreshUi()}},{type:"button",label:()=>"Remove "+this.utils.getName(i),value:async()=>{var s;await((s=this._viewer)==null?void 0:s.confirm(`Delete Group: Are you sure you want to remove ${this.utils.getName(i)}?`))&&(this.variations[e].splice(this.variations[e].indexOf(i),1),this.refreshUi())}}]})),{type:"button",label:`Add ${e} group (empty)`,value:async()=>{var s;const i=await((s=this._viewer)==null?void 0:s.prompt("Name: Enter the name of the object/material"));i&&(this.variations[e].push({items:[],itemFiles:[],icons:[],iconFiles:[],titles:[],prefix:i+"/",name:i,icon:"",title:""}),this.refreshUi())}},{type:"button",label:`Add ${e} group (local folder)`,value:async()=>{var at,ct,dt;const i=await(0,b.uploadFile)(!1,!0);if(i.length===0)return;const s=[],o=[],c=[],_=[];for(const mt of i){if(mt.name.startsWith("."))continue;const yt=mt.name.split(".").pop()??"";yt?this._extForType[e].includes(yt)?(s.push(mt.webkitRelativePath.replace(/^\//,"")),o.push(mt)):this._extForType.images.includes(yt)?(c.push(mt.webkitRelativePath.replace(/^\//,"")),_.push(mt)):await((at=this._viewer)==null?void 0:at.alert(`Invalid file: ${mt.name} is not a valid ${e} file`)):await((ct=this._viewer)==null?void 0:ct.alert(`Invalid file: ${mt.name} has no extension`))}const j=(0,b.longestCommonPrefix)(s),et=this.utils.getName({prefix:j});let nt=await((dt=this._viewer)==null?void 0:dt.prompt("Name: Enter the name of the object/material",et,!0));if(nt===null)return;nt=nt||et;const st=s.map(mt=>{const yt=mt.replace(j,""),wt=yt.split(".").pop()??"",Ct=yt.replace("."+wt,"")+".",bt=c.findIndex(At=>At.replace(j,"").startsWith(Ct));return bt<0?["",void 0]:[c[bt].replace(j,""),_[bt]||void 0]});this.variations[e].push({items:s.map(mt=>mt.replace(j,"")),icons:st.map(mt=>mt[0]),iconFiles:st.map(mt=>mt[1]),titles:s.map(()=>""),itemFiles:o,prefix:j,name:nt,icon:"",title:""}),this.refreshUi()}}]})),{type:"button",label:"Download JSON/Zip",value:async()=>{var e,i;try{const{folder:s,config:o}=await this._exportConfiguratorState(),c=JSON.stringify(o,null,4);if(s){s["config.json"]=im(c);const _=await HT(s),j=new Blob([_],{type:"application/zip"});(0,b.downloadBlob)(j,"configurator.zip")}else{const _=new Blob([c],{type:"application/json"});(0,b.downloadBlob)(_,"config.json")}}catch(s){return(e=this._viewer)==null||e.console.error(s),void await((i=this._viewer)==null?void 0:i.alert("Error: "+((s==null?void 0:s.message)||s)))}}},{type:"button",label:"Load JSON/Zip",value:async()=>{var s,o,c;const e=await(0,b.uploadFile)(!1,!1,"application/zip,application/json");if(e.length===0)return;const i=e[0];if(i.name.endsWith(".zip")){const _=cw(new Uint8Array(await i.arrayBuffer()));if(!_["config.json"])return void await((s=this._viewer)==null?void 0:s.alert("Invalid zip: config.json not found"));const j=JSON.parse(m0(_["config.json"]));this.importConfig(j,_)}else{if(!i.name.endsWith(".json"))return void await((o=this._viewer)==null?void 0:o.alert("Invalid file: "+i.name));{const _=JSON.parse(await i.text());this.importConfig(_)}}await((c=this._viewer)==null?void 0:c.alert("Imported successfully")),this.refreshUi()}},{type:"button",label:"Import Path",value:async()=>{var i,s;const e=await((i=this._viewer)==null?void 0:i.prompt("URL: Enter the url of the json file."));e&&(await this.importPath(e),await((s=this._viewer)==null?void 0:s.alert("Imported successfully")),this.refreshUi())}},{type:"button",label:"Refresh UI",value:()=>{this.refreshUi()}},{type:"button",label:"Clear All",value:async()=>{var e;await((e=this._viewer)==null?void 0:e.confirm("Clear: Are you sure you want to clear the configuration ?"))&&(this.variations.objects=[],this.variations.materials=[],this.refreshUi())}}]}}_refreshUiConfig(){var e,i;(i=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||i.call(e,"postFrame",!0)}refreshUi(){this._refreshUiConfig(),super.refreshUi()}async _loadObject(e,i){const s=await super._loadObject(e,i);for(const o of s)(o.modelObject||o).userData.excludeFromExport=!0;return s}}GI.PluginType="VariationConfiguratorPlugin";class ex extends ms{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._addSceneObject=e=>{const i=e.object;i!=null&&i.traverse&&i.traverse(s=>{var c,_;s.userData[ex.PluginType]===void 0&&(s.userData[ex.PluginType]={transforms:[]});const o={type:"folder",label:"Transform Animation",children:[{type:"button",label:"Add Current Transform",value:()=>{var j;this.addTransform(s),(j=o==null?void 0:o.uiRefresh)==null||j.call(o)}},()=>s.userData[ex.PluginType].transforms.map((j,et)=>({type:"folder",label:`Transform ${et}`,children:[{type:"vec3",label:"Position",property:[j,"position"]},{type:"vec3",label:"Quaternion",property:[j,"quaternion"]},{type:"vec3",label:"Scale",property:[j,"scale"]},{type:"button",label:"Set",value:()=>{this.setTransform(s,j)}},{type:"button",label:"Animate",value:()=>{this.animateTransform(s,j)}}]}))]};(_=(c=s.uiConfig)==null?void 0:c.children)==null||_.push(o)})}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),super.onRemove(e)}addTransform(e){e.userData[ex.PluginType].transforms.push({position:e.position.clone(),quaternion:e.quaternion.clone(),scale:e.scale.clone()})}setTransform(e,i){var s,o,c,_;e.position.copy(i.position),e.quaternion.copy(i.quaternion),e.scale.copy(i.scale),(o=(s=e.userData).setDirty)==null||o.call(s),(_=(c=e.uiConfig)==null?void 0:c.uiRefresh)==null||_.call(c)}animateTransform(e,i,s=2e3){var yt,wt;const o=(yt=this._viewer)==null?void 0:yt.getPluginByType("PopmotionPlugin");o||((wt=this._viewer)==null||wt.console.error("PopmotionPlugin required for animation"));const c=typeof i=="number"?e.userData[ex.PluginType].transforms[i]:i,_=new g.Pa4,j=new g._fP,et=new g.Pa4,nt=e.position.clone(),st=e.quaternion.clone(),at=e.scale.clone(),ct=c.position,dt=c.quaternion,mt=c.scale;return o==null?void 0:o.animate({from:0,to:1,duration:s,onUpdate:Ct=>{var bt,At;_.lerpVectors(nt,ct,Ct),j.slerpQuaternions(st,dt,Ct),et.lerpVectors(at,mt,Ct),e.position.copy(_),e.quaternion.copy(j),e.scale.copy(et),(bt=this._viewer)==null||bt.setDirty(),(At=this._viewer)==null||At.renderer.resetShadows()},onStop:()=>{var Ct,bt,At,Pt;e.position.copy(c.position),e.quaternion.copy(c.quaternion),e.scale.copy(c.scale),(bt=(Ct=e.userData).setDirty)==null||bt.call(Ct),(Pt=(At=e.uiConfig)==null?void 0:At.uiRefresh)==null||Pt.call(At)}})}}ex.PluginType="TransformAnimationPlugin";var JU=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let gS=class extends ms{constructor(h=!0){super(),this.enabled=!0,this.toJSON=void 0,this.cameras=[],this._preRender=()=>{if(this.enabled&&this._viewer)for(const e of this.cameras){if(!e.enabled)continue;const i=this._viewer,s=e.camera;try{this.dispatchEvent({type:"preRenderCamera",camera:e}),i.scene.renderCamera=s,i.renderer.render(!1);const o=i.renderer.composer.readBuffer;this.dispatchEvent({type:"preBlitCamera",camera:e,readBuffer:o}),i.renderer.blit(o.texture,e.target),this.dispatchEvent({type:"postRenderCamera",camera:e})}catch(o){console.error(o),e.enabled=!1}}},this.enabled=h}async onAdded(h){await super.onAdded(h),h.addEventListener("preRender",this._preRender)}addCamera(h){if(!this._viewer)throw"Plugin not added to viewer";const e={camera:h,target:this._viewer.renderer.composerTarget.clone(!0),enabled:!0};return this.cameras.push(e),e}};gS.PluginType="VirtualCamerasPlugin",JU([jr()],gS.prototype,"enabled",void 0),gS=JU([ks("Virtual Cameras")],gS);class Iy{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const i=this.elements;i[0]=e.x,i[4]=e.y,i[8]=e.z}getTrace(e){e===void 0&&(e=new pn);const i=this.elements;return e.x=i[0],e.y=i[4],e.z=i[8],e}vmult(e,i){i===void 0&&(i=new pn);const s=this.elements,o=e.x,c=e.y,_=e.z;return i.x=s[0]*o+s[1]*c+s[2]*_,i.y=s[3]*o+s[4]*c+s[5]*_,i.z=s[6]*o+s[7]*c+s[8]*_,i}smult(e){for(let i=0;i<this.elements.length;i++)this.elements[i]*=e}mmult(e,i){i===void 0&&(i=new Iy);const s=this.elements,o=e.elements,c=i.elements,_=s[0],j=s[1],et=s[2],nt=s[3],st=s[4],at=s[5],ct=s[6],dt=s[7],mt=s[8],yt=o[0],wt=o[1],Ct=o[2],bt=o[3],At=o[4],Pt=o[5],Dt=o[6],Nt=o[7],Vt=o[8];return c[0]=_*yt+j*bt+et*Dt,c[1]=_*wt+j*At+et*Nt,c[2]=_*Ct+j*Pt+et*Vt,c[3]=nt*yt+st*bt+at*Dt,c[4]=nt*wt+st*At+at*Nt,c[5]=nt*Ct+st*Pt+at*Vt,c[6]=ct*yt+dt*bt+mt*Dt,c[7]=ct*wt+dt*At+mt*Nt,c[8]=ct*Ct+dt*Pt+mt*Vt,i}scale(e,i){i===void 0&&(i=new Iy);const s=this.elements,o=i.elements;for(let c=0;c!==3;c++)o[3*c+0]=e.x*s[3*c+0],o[3*c+1]=e.y*s[3*c+1],o[3*c+2]=e.z*s[3*c+2];return i}solve(e,i){i===void 0&&(i=new pn);const s=[];let o,c;for(o=0;o<12;o++)s.push(0);for(o=0;o<3;o++)for(c=0;c<3;c++)s[o+4*c]=this.elements[o+3*c];s[3]=e.x,s[7]=e.y,s[11]=e.z;let _=3;const j=_;let et,nt;do{if(o=j-_,s[o+4*o]===0){for(c=o+1;c<j;c++)if(s[o+4*c]!==0){et=4;do nt=4-et,s[nt+4*o]+=s[nt+4*c];while(--et);break}}if(s[o+4*o]!==0)for(c=o+1;c<j;c++){const st=s[o+4*c]/s[o+4*o];et=4;do nt=4-et,s[nt+4*c]=nt<=o?0:s[nt+4*c]-s[nt+4*o]*st;while(--et)}}while(--_);if(i.z=s[11]/s[10],i.y=(s[7]-s[6]*i.z)/s[5],i.x=(s[3]-s[2]*i.z-s[1]*i.y)/s[0],isNaN(i.x)||isNaN(i.y)||isNaN(i.z)||i.x===1/0||i.y===1/0||i.z===1/0)throw`Could not solve equation! Got x=[${i.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return i}e(e,i,s){if(s===void 0)return this.elements[i+3*e];this.elements[i+3*e]=s}copy(e){for(let i=0;i<e.elements.length;i++)this.elements[i]=e.elements[i];return this}toString(){let e="";for(let i=0;i<9;i++)e+=this.elements[i]+",";return e}reverse(e){e===void 0&&(e=new Iy);const i=sV;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)i[s+6*o]=this.elements[s+3*o];i[3]=1,i[9]=0,i[15]=0,i[4]=0,i[10]=1,i[16]=0,i[5]=0,i[11]=0,i[17]=1;let c=3;const _=c;let j,et;do{if(s=_-c,i[s+6*s]===0){for(o=s+1;o<_;o++)if(i[s+6*o]!==0){j=6;do et=6-j,i[et+6*s]+=i[et+6*o];while(--j);break}}if(i[s+6*s]!==0)for(o=s+1;o<_;o++){const nt=i[s+6*o]/i[s+6*s];j=6;do et=6-j,i[et+6*o]=et<=s?0:i[et+6*o]-i[et+6*s]*nt;while(--j)}}while(--c);s=2;do{o=s-1;do{const nt=i[s+6*o]/i[s+6*s];j=6;do et=6-j,i[et+6*o]=i[et+6*o]-i[et+6*s]*nt;while(--j)}while(o--)}while(--s);s=2;do{const nt=1/i[s+6*s];j=6;do et=6-j,i[et+6*s]=i[et+6*s]*nt;while(--j)}while(s--);s=2;do{o=2;do{if(et=i[3+o+6*s],isNaN(et)||et===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(s,o,et)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const i=e.x,s=e.y,o=e.z,c=e.w,_=i+i,j=s+s,et=o+o,nt=i*_,st=i*j,at=i*et,ct=s*j,dt=s*et,mt=o*et,yt=c*_,wt=c*j,Ct=c*et,bt=this.elements;return bt[0]=1-(ct+mt),bt[1]=st-Ct,bt[2]=at+wt,bt[3]=st+Ct,bt[4]=1-(nt+mt),bt[5]=dt-yt,bt[6]=at-wt,bt[7]=dt+yt,bt[8]=1-(nt+ct),this}transpose(e){e===void 0&&(e=new Iy);const i=this.elements,s=e.elements;let o;return s[0]=i[0],s[4]=i[4],s[8]=i[8],o=i[1],s[1]=i[3],s[3]=o,o=i[2],s[2]=i[6],s[6]=o,o=i[5],s[5]=i[7],s[7]=o,e}}const sV=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class pn{constructor(e,i,s){e===void 0&&(e=0),i===void 0&&(i=0),s===void 0&&(s=0),this.x=e,this.y=i,this.z=s}cross(e,i){i===void 0&&(i=new pn);const s=e.x,o=e.y,c=e.z,_=this.x,j=this.y,et=this.z;return i.x=j*c-et*o,i.y=et*s-_*c,i.z=_*o-j*s,i}set(e,i,s){return this.x=e,this.y=i,this.z=s,this}setZero(){this.x=this.y=this.z=0}vadd(e,i){if(!i)return new pn(this.x+e.x,this.y+e.y,this.z+e.z);i.x=e.x+this.x,i.y=e.y+this.y,i.z=e.z+this.z}vsub(e,i){if(!i)return new pn(this.x-e.x,this.y-e.y,this.z-e.z);i.x=this.x-e.x,i.y=this.y-e.y,i.z=this.z-e.z}crossmat(){return new Iy([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,i=this.y,s=this.z,o=Math.sqrt(e*e+i*i+s*s);if(o>0){const c=1/o;this.x*=c,this.y*=c,this.z*=c}else this.x=0,this.y=0,this.z=0;return o}unit(e){e===void 0&&(e=new pn);const i=this.x,s=this.y,o=this.z;let c=Math.sqrt(i*i+s*s+o*o);return c>0?(c=1/c,e.x=i*c,e.y=s*c,e.z=o*c):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,i=this.y,s=this.z;return Math.sqrt(e*e+i*i+s*s)}lengthSquared(){return this.dot(this)}distanceTo(e){const i=this.x,s=this.y,o=this.z,c=e.x,_=e.y,j=e.z;return Math.sqrt((c-i)*(c-i)+(_-s)*(_-s)+(j-o)*(j-o))}distanceSquared(e){const i=this.x,s=this.y,o=this.z,c=e.x,_=e.y,j=e.z;return(c-i)*(c-i)+(_-s)*(_-s)+(j-o)*(j-o)}scale(e,i){i===void 0&&(i=new pn);const s=this.x,o=this.y,c=this.z;return i.x=e*s,i.y=e*o,i.z=e*c,i}vmul(e,i){return i===void 0&&(i=new pn),i.x=e.x*this.x,i.y=e.y*this.y,i.z=e.z*this.z,i}addScaledVector(e,i,s){return s===void 0&&(s=new pn),s.x=this.x+e*i.x,s.y=this.y+e*i.y,s.z=this.z+e*i.z,s}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new pn),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,i){const s=this.length();if(s>0){const o=oV,c=1/s;o.set(this.x*c,this.y*c,this.z*c);const _=aV;Math.abs(o.x)<.9?(_.set(1,0,0),o.cross(_,e)):(_.set(0,1,0),o.cross(_,e)),o.cross(e,i)}else e.set(1,0,0),i.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,i,s){const o=this.x,c=this.y,_=this.z;s.x=o+(e.x-o)*i,s.y=c+(e.y-c)*i,s.z=_+(e.z-_)*i}almostEquals(e,i){return i===void 0&&(i=1e-6),!(Math.abs(this.x-e.x)>i||Math.abs(this.y-e.y)>i||Math.abs(this.z-e.z)>i)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,i){return this.negate(ZU),ZU.almostEquals(e,i)}clone(){return new pn(this.x,this.y,this.z)}}pn.ZERO=new pn(0,0,0),pn.UNIT_X=new pn(1,0,0),pn.UNIT_Y=new pn(0,1,0),pn.UNIT_Z=new pn(0,0,1);const oV=new pn,aV=new pn,ZU=new pn;class Yu{constructor(e){e===void 0&&(e={}),this.lowerBound=new pn,this.upperBound=new pn,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,i,s,o){const c=this.lowerBound,_=this.upperBound,j=s;c.copy(e[0]),j&&j.vmult(c,c),_.copy(c);for(let et=1;et<e.length;et++){let nt=e[et];j&&(j.vmult(nt,eF),nt=eF),nt.x>_.x&&(_.x=nt.x),nt.x<c.x&&(c.x=nt.x),nt.y>_.y&&(_.y=nt.y),nt.y<c.y&&(c.y=nt.y),nt.z>_.z&&(_.z=nt.z),nt.z<c.z&&(c.z=nt.z)}return i&&(i.vadd(c,c),i.vadd(_,_)),o&&(c.x-=o,c.y-=o,c.z-=o,_.x+=o,_.y+=o,_.z+=o),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new Yu().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const i=this.lowerBound,s=this.upperBound,o=e.lowerBound,c=e.upperBound,_=o.x<=s.x&&s.x<=c.x||i.x<=c.x&&c.x<=s.x,j=o.y<=s.y&&s.y<=c.y||i.y<=c.y&&c.y<=s.y,et=o.z<=s.z&&s.z<=c.z||i.z<=c.z&&c.z<=s.z;return _&&j&&et}volume(){const e=this.lowerBound,i=this.upperBound;return(i.x-e.x)*(i.y-e.y)*(i.z-e.z)}contains(e){const i=this.lowerBound,s=this.upperBound,o=e.lowerBound,c=e.upperBound;return i.x<=o.x&&s.x>=c.x&&i.y<=o.y&&s.y>=c.y&&i.z<=o.z&&s.z>=c.z}getCorners(e,i,s,o,c,_,j,et){const nt=this.lowerBound,st=this.upperBound;e.copy(nt),i.set(st.x,nt.y,nt.z),s.set(st.x,st.y,nt.z),o.set(nt.x,st.y,st.z),c.set(st.x,nt.y,st.z),_.set(nt.x,st.y,nt.z),j.set(nt.x,nt.y,st.z),et.copy(st)}toLocalFrame(e,i){const s=tF,o=s[0],c=s[1],_=s[2],j=s[3],et=s[4],nt=s[5],st=s[6],at=s[7];this.getCorners(o,c,_,j,et,nt,st,at);for(let ct=0;ct!==8;ct++){const dt=s[ct];e.pointToLocal(dt,dt)}return i.setFromPoints(s)}toWorldFrame(e,i){const s=tF,o=s[0],c=s[1],_=s[2],j=s[3],et=s[4],nt=s[5],st=s[6],at=s[7];this.getCorners(o,c,_,j,et,nt,st,at);for(let ct=0;ct!==8;ct++){const dt=s[ct];e.pointToWorld(dt,dt)}return i.setFromPoints(s)}overlapsRay(e){const{direction:i,from:s}=e,o=1/i.x,c=1/i.y,_=1/i.z,j=(this.lowerBound.x-s.x)*o,et=(this.upperBound.x-s.x)*o,nt=(this.lowerBound.y-s.y)*c,st=(this.upperBound.y-s.y)*c,at=(this.lowerBound.z-s.z)*_,ct=(this.upperBound.z-s.z)*_,dt=Math.max(Math.max(Math.min(j,et),Math.min(nt,st)),Math.min(at,ct)),mt=Math.min(Math.min(Math.max(j,et),Math.max(nt,st)),Math.max(at,ct));return!(mt<0||dt>mt)}}const eF=new pn,tF=[new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn];class nF{constructor(){this.matrix=[]}get(e,i){let{index:s}=e,{index:o}=i;if(o>s){const c=o;o=s,s=c}return this.matrix[(s*(s+1)>>1)+o-1]}set(e,i,s){let{index:o}=e,{index:c}=i;if(c>o){const _=c;c=o,o=_}this.matrix[(o*(o+1)>>1)+c-1]=s?1:0}reset(){for(let e=0,i=this.matrix.length;e!==i;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class rF{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].includes(i)||s[e].push(i),this}hasEventListener(e,i){if(this._listeners===void 0)return!1;const s=this._listeners;return!(s[e]===void 0||!s[e].includes(i))}hasAnyEventListener(e){return this._listeners!==void 0&&this._listeners[e]!==void 0}removeEventListener(e,i){if(this._listeners===void 0)return this;const s=this._listeners;if(s[e]===void 0)return this;const o=s[e].indexOf(i);return o!==-1&&s[e].splice(o,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;const i=this._listeners[e.type];if(i!==void 0){e.target=this;for(let s=0,o=i.length;s<o;s++)i[s].call(this,e)}return this}}class ip{constructor(e,i,s,o){e===void 0&&(e=0),i===void 0&&(i=0),s===void 0&&(s=0),o===void 0&&(o=1),this.x=e,this.y=i,this.z=s,this.w=o}set(e,i,s,o){return this.x=e,this.y=i,this.z=s,this.w=o,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,i){const s=Math.sin(.5*i);return this.x=e.x*s,this.y=e.y*s,this.z=e.z*s,this.w=Math.cos(.5*i),this}toAxisAngle(e){e===void 0&&(e=new pn),this.normalize();const i=2*Math.acos(this.w),s=Math.sqrt(1-this.w*this.w);return s<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/s,e.y=this.y/s,e.z=this.z/s),[e,i]}setFromVectors(e,i){if(e.isAntiparallelTo(i)){const s=lV,o=cV;e.tangents(s,o),this.setFromAxisAngle(s,Math.PI)}else{const s=e.cross(i);this.x=s.x,this.y=s.y,this.z=s.z,this.w=Math.sqrt(e.length()**2*i.length()**2)+e.dot(i),this.normalize()}return this}mult(e,i){i===void 0&&(i=new ip);const s=this.x,o=this.y,c=this.z,_=this.w,j=e.x,et=e.y,nt=e.z,st=e.w;return i.x=s*st+_*j+o*nt-c*et,i.y=o*st+_*et+c*j-s*nt,i.z=c*st+_*nt+s*et-o*j,i.w=_*st-s*j-o*et-c*nt,i}inverse(e){e===void 0&&(e=new ip);const i=this.x,s=this.y,o=this.z,c=this.w;this.conjugate(e);const _=1/(i*i+s*s+o*o+c*c);return e.x*=_,e.y*=_,e.z*=_,e.w*=_,e}conjugate(e){return e===void 0&&(e=new ip),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,i){i===void 0&&(i=new pn);const s=e.x,o=e.y,c=e.z,_=this.x,j=this.y,et=this.z,nt=this.w,st=nt*s+j*c-et*o,at=nt*o+et*s-_*c,ct=nt*c+_*o-j*s,dt=-_*s-j*o-et*c;return i.x=st*nt+dt*-_+at*-et-ct*-j,i.y=at*nt+dt*-j+ct*-_-st*-et,i.z=ct*nt+dt*-et+st*-j-at*-_,i}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,i){let s,o,c;i===void 0&&(i="YZX");const _=this.x,j=this.y,et=this.z,nt=this.w;if(i!=="YZX")throw new Error(`Euler order ${i} not supported yet.`);{const st=_*j+et*nt;if(st>.499&&(s=2*Math.atan2(_,nt),o=Math.PI/2,c=0),st<-.499&&(s=-2*Math.atan2(_,nt),o=-Math.PI/2,c=0),s===void 0){const at=_*_,ct=j*j,dt=et*et;s=Math.atan2(2*j*nt-2*_*et,1-2*ct-2*dt),o=Math.asin(2*st),c=Math.atan2(2*_*nt-2*j*et,1-2*at-2*dt)}}e.y=s,e.z=o,e.x=c}setFromEuler(e,i,s,o){o===void 0&&(o="XYZ");const c=Math.cos(e/2),_=Math.cos(i/2),j=Math.cos(s/2),et=Math.sin(e/2),nt=Math.sin(i/2),st=Math.sin(s/2);return o==="XYZ"?(this.x=et*_*j+c*nt*st,this.y=c*nt*j-et*_*st,this.z=c*_*st+et*nt*j,this.w=c*_*j-et*nt*st):o==="YXZ"?(this.x=et*_*j+c*nt*st,this.y=c*nt*j-et*_*st,this.z=c*_*st-et*nt*j,this.w=c*_*j+et*nt*st):o==="ZXY"?(this.x=et*_*j-c*nt*st,this.y=c*nt*j+et*_*st,this.z=c*_*st+et*nt*j,this.w=c*_*j-et*nt*st):o==="ZYX"?(this.x=et*_*j-c*nt*st,this.y=c*nt*j+et*_*st,this.z=c*_*st-et*nt*j,this.w=c*_*j+et*nt*st):o==="YZX"?(this.x=et*_*j+c*nt*st,this.y=c*nt*j+et*_*st,this.z=c*_*st-et*nt*j,this.w=c*_*j-et*nt*st):o==="XZY"&&(this.x=et*_*j-c*nt*st,this.y=c*nt*j-et*_*st,this.z=c*_*st+et*nt*j,this.w=c*_*j+et*nt*st),this}clone(){return new ip(this.x,this.y,this.z,this.w)}slerp(e,i,s){s===void 0&&(s=new ip);const o=this.x,c=this.y,_=this.z,j=this.w;let et,nt,st,at,ct,dt=e.x,mt=e.y,yt=e.z,wt=e.w;return nt=o*dt+c*mt+_*yt+j*wt,nt<0&&(nt=-nt,dt=-dt,mt=-mt,yt=-yt,wt=-wt),1-nt>1e-6?(et=Math.acos(nt),st=Math.sin(et),at=Math.sin((1-i)*et)/st,ct=Math.sin(i*et)/st):(at=1-i,ct=i),s.x=at*o+ct*dt,s.y=at*c+ct*mt,s.z=at*_+ct*yt,s.w=at*j+ct*wt,s}integrate(e,i,s,o){o===void 0&&(o=new ip);const c=e.x*s.x,_=e.y*s.y,j=e.z*s.z,et=this.x,nt=this.y,st=this.z,at=this.w,ct=.5*i;return o.x+=ct*(c*at+_*st-j*nt),o.y+=ct*(_*at+j*et-c*st),o.z+=ct*(j*at+c*nt-_*et),o.w+=ct*(-c*et-_*nt-j*st),o}}const lV=new pn,cV=new pn;class _s{constructor(e){e===void 0&&(e={}),this.id=_s.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,i){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,i,s,o){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}_s.idCounter=0,_s.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Xl{constructor(e){e===void 0&&(e={}),this.position=new pn,this.quaternion=new ip,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,i){return Xl.pointToLocalFrame(this.position,this.quaternion,e,i)}pointToWorld(e,i){return Xl.pointToWorldFrame(this.position,this.quaternion,e,i)}vectorToWorldFrame(e,i){return i===void 0&&(i=new pn),this.quaternion.vmult(e,i),i}static pointToLocalFrame(e,i,s,o){return o===void 0&&(o=new pn),s.vsub(e,o),i.conjugate(iF),iF.vmult(o,o),o}static pointToWorldFrame(e,i,s,o){return o===void 0&&(o=new pn),i.vmult(s,o),o.vadd(e,o),o}static vectorToWorldFrame(e,i,s){return s===void 0&&(s=new pn),e.vmult(i,s),s}static vectorToLocalFrame(e,i,s,o){return o===void 0&&(o=new pn),i.w*=-1,i.vmult(s,o),i.w*=-1,o}}const iF=new ip;class _S extends _s{constructor(e){e===void 0&&(e={});const{vertices:i=[],faces:s=[],normals:o=[],axes:c,boundingSphereRadius:_}=e;super({type:_s.types.CONVEXPOLYHEDRON}),this.vertices=i,this.faces=s,this.faceNormals=o,this.faceNormals.length===0&&this.computeNormals(),_?this.boundingSphereRadius=_:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=c?c.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,i=this.vertices,s=this.uniqueEdges;s.length=0;const o=new pn;for(let c=0;c!==e.length;c++){const _=e[c],j=_.length;for(let et=0;et!==j;et++){const nt=(et+1)%j;i[_[et]].vsub(i[_[nt]],o),o.normalize();let st=!1;for(let at=0;at!==s.length;at++)if(s[at].almostEquals(o)||s[at].almostEquals(o)){st=!0;break}st||s.push(o.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let o=0;o<this.faces[e].length;o++)if(!this.vertices[this.faces[e][o]])throw new Error(`Vertex ${this.faces[e][o]} not found!`);const i=this.faceNormals[e]||new pn;this.getFaceNormal(e,i),i.negate(i),this.faceNormals[e]=i;const s=this.vertices[this.faces[e][0]];if(i.dot(s)<0){console.error(`.faceNormals[${e}] = Vec3(${i.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let o=0;o<this.faces[e].length;o++)console.warn(`.vertices[${this.faces[e][o]}] = Vec3(${this.vertices[this.faces[e][o]].toString()})`)}}}getFaceNormal(e,i){const s=this.faces[e],o=this.vertices[s[0]],c=this.vertices[s[1]],_=this.vertices[s[2]];_S.computeNormal(o,c,_,i)}static computeNormal(e,i,s,o){const c=new pn,_=new pn;i.vsub(e,_),s.vsub(i,c),c.cross(_,o),o.isZero()||o.normalize()}clipAgainstHull(e,i,s,o,c,_,j,et,nt){const st=new pn;let at=-1,ct=-Number.MAX_VALUE;for(let mt=0;mt<s.faces.length;mt++){st.copy(s.faceNormals[mt]),c.vmult(st,st);const yt=st.dot(_);yt>ct&&(ct=yt,at=mt)}const dt=[];for(let mt=0;mt<s.faces[at].length;mt++){const yt=s.vertices[s.faces[at][mt]],wt=new pn;wt.copy(yt),c.vmult(wt,wt),o.vadd(wt,wt),dt.push(wt)}at>=0&&this.clipFaceAgainstHull(_,e,i,dt,j,et,nt)}findSeparatingAxis(e,i,s,o,c,_,j,et){const nt=new pn,st=new pn,at=new pn,ct=new pn,dt=new pn,mt=new pn;let yt=Number.MAX_VALUE;const wt=this;if(wt.uniqueAxes)for(let Ct=0;Ct!==wt.uniqueAxes.length;Ct++){s.vmult(wt.uniqueAxes[Ct],nt);const bt=wt.testSepAxis(nt,e,i,s,o,c);if(bt===!1)return!1;bt<yt&&(yt=bt,_.copy(nt))}else{const Ct=j?j.length:wt.faces.length;for(let bt=0;bt<Ct;bt++){const At=j?j[bt]:bt;nt.copy(wt.faceNormals[At]),s.vmult(nt,nt);const Pt=wt.testSepAxis(nt,e,i,s,o,c);if(Pt===!1)return!1;Pt<yt&&(yt=Pt,_.copy(nt))}}if(e.uniqueAxes)for(let Ct=0;Ct!==e.uniqueAxes.length;Ct++){c.vmult(e.uniqueAxes[Ct],st);const bt=wt.testSepAxis(st,e,i,s,o,c);if(bt===!1)return!1;bt<yt&&(yt=bt,_.copy(st))}else{const Ct=et?et.length:e.faces.length;for(let bt=0;bt<Ct;bt++){const At=et?et[bt]:bt;st.copy(e.faceNormals[At]),c.vmult(st,st);const Pt=wt.testSepAxis(st,e,i,s,o,c);if(Pt===!1)return!1;Pt<yt&&(yt=Pt,_.copy(st))}}for(let Ct=0;Ct!==wt.uniqueEdges.length;Ct++){s.vmult(wt.uniqueEdges[Ct],ct);for(let bt=0;bt!==e.uniqueEdges.length;bt++)if(c.vmult(e.uniqueEdges[bt],dt),ct.cross(dt,mt),!mt.almostZero()){mt.normalize();const At=wt.testSepAxis(mt,e,i,s,o,c);if(At===!1)return!1;At<yt&&(yt=At,_.copy(mt))}}return o.vsub(i,at),at.dot(_)>0&&_.negate(_),!0}testSepAxis(e,i,s,o,c,_){_S.project(this,e,s,o,yL),_S.project(i,e,c,_,AL);const j=yL[0],et=yL[1],nt=AL[0],st=AL[1];if(j<st||nt<et)return!1;const at=j-st,ct=nt-et;return at<ct?at:ct}calculateLocalInertia(e,i){const s=new pn,o=new pn;this.computeLocalAABB(o,s);const c=s.x-o.x,_=s.y-o.y,j=s.z-o.z;i.x=1/12*e*(2*_*2*_+2*j*2*j),i.y=1/12*e*(2*c*2*c+2*j*2*j),i.z=1/12*e*(2*_*2*_+2*c*2*c)}getPlaneConstantOfFace(e){const i=this.faces[e],s=this.faceNormals[e],o=this.vertices[i[0]];return-s.dot(o)}clipFaceAgainstHull(e,i,s,o,c,_,j){const et=new pn,nt=new pn,st=new pn,at=new pn,ct=new pn,dt=new pn,mt=new pn,yt=new pn,wt=this,Ct=o,bt=[];let At=-1,Pt=Number.MAX_VALUE;for(let an=0;an<wt.faces.length;an++){et.copy(wt.faceNormals[an]),s.vmult(et,et);const fn=et.dot(e);fn<Pt&&(Pt=fn,At=an)}if(At<0)return;const Dt=wt.faces[At];Dt.connectedFaces=[];for(let an=0;an<wt.faces.length;an++)for(let fn=0;fn<wt.faces[an].length;fn++)Dt.indexOf(wt.faces[an][fn])!==-1&&an!==At&&Dt.connectedFaces.indexOf(an)===-1&&Dt.connectedFaces.push(an);const Nt=Dt.length;for(let an=0;an<Nt;an++){const fn=wt.vertices[Dt[an]],mn=wt.vertices[Dt[(an+1)%Nt]];fn.vsub(mn,nt),st.copy(nt),s.vmult(st,st),i.vadd(st,st),at.copy(this.faceNormals[At]),s.vmult(at,at),i.vadd(at,at),st.cross(at,ct),ct.negate(ct),dt.copy(fn),s.vmult(dt,dt),i.vadd(dt,dt);const Sn=Dt.connectedFaces[an];mt.copy(this.faceNormals[Sn]);const An=this.getPlaneConstantOfFace(Sn);yt.copy(mt),s.vmult(yt,yt);const wn=An-yt.dot(i);for(this.clipFaceAgainstPlane(Ct,bt,yt,wn);Ct.length;)Ct.shift();for(;bt.length;)Ct.push(bt.shift())}mt.copy(this.faceNormals[At]);const Vt=this.getPlaneConstantOfFace(At);yt.copy(mt),s.vmult(yt,yt);const Zt=Vt-yt.dot(i);for(let an=0;an<Ct.length;an++){let fn=yt.dot(Ct[an])+Zt;if(fn<=c&&(console.log(`clamped: depth=${fn} to minDist=${c}`),fn=c),fn<=_){const mn=Ct[an];if(fn<=1e-6){const Sn={point:mn,normal:yt,depth:fn};j.push(Sn)}}}}clipFaceAgainstPlane(e,i,s,o){let c,_;const j=e.length;if(j<2)return i;let et=e[e.length-1],nt=e[0];c=s.dot(et)+o;for(let st=0;st<j;st++){if(nt=e[st],_=s.dot(nt)+o,c<0)if(_<0){const at=new pn;at.copy(nt),i.push(at)}else{const at=new pn;et.lerp(nt,c/(c-_),at),i.push(at)}else if(_<0){const at=new pn;et.lerp(nt,c/(c-_),at),i.push(at),i.push(nt)}et=nt,c=_}return i}computeWorldVertices(e,i){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new pn);const s=this.vertices,o=this.worldVertices;for(let c=0;c!==this.vertices.length;c++)i.vmult(s[c],o[c]),e.vadd(o[c],o[c]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,i){const s=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let o=0;o<this.vertices.length;o++){const c=s[o];c.x<e.x?e.x=c.x:c.x>i.x&&(i.x=c.x),c.y<e.y?e.y=c.y:c.y>i.y&&(i.y=c.y),c.z<e.z?e.z=c.z:c.z>i.z&&(i.z=c.z)}}computeWorldFaceNormals(e){const i=this.faceNormals.length;for(;this.worldFaceNormals.length<i;)this.worldFaceNormals.push(new pn);const s=this.faceNormals,o=this.worldFaceNormals;for(let c=0;c!==i;c++)e.vmult(s[c],o[c]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const i=this.vertices;for(let s=0;s!==i.length;s++){const o=i[s].lengthSquared();o>e&&(e=o)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,i,s,o){const c=this.vertices;let _,j,et,nt,st,at,ct=new pn;for(let dt=0;dt<c.length;dt++){ct.copy(c[dt]),i.vmult(ct,ct),e.vadd(ct,ct);const mt=ct;(_===void 0||mt.x<_)&&(_=mt.x),(nt===void 0||mt.x>nt)&&(nt=mt.x),(j===void 0||mt.y<j)&&(j=mt.y),(st===void 0||mt.y>st)&&(st=mt.y),(et===void 0||mt.z<et)&&(et=mt.z),(at===void 0||mt.z>at)&&(at=mt.z)}s.set(_,j,et),o.set(nt,st,at)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){e===void 0&&(e=new pn);const i=this.vertices;for(let s=0;s<i.length;s++)e.vadd(i[s],e);return e.scale(1/i.length,e),e}transformAllPoints(e,i){const s=this.vertices.length,o=this.vertices;if(i){for(let c=0;c<s;c++){const _=o[c];i.vmult(_,_)}for(let c=0;c<this.faceNormals.length;c++){const _=this.faceNormals[c];i.vmult(_,_)}}if(e)for(let c=0;c<s;c++){const _=o[c];_.vadd(e,_)}}pointIsInside(e){const i=this.vertices,s=this.faces,o=this.faceNormals,c=new pn;this.getAveragePointLocal(c);for(let _=0;_<this.faces.length;_++){let j=o[_];const et=i[s[_][0]],nt=new pn;e.vsub(et,nt);const st=j.dot(nt),at=new pn;c.vsub(et,at);const ct=j.dot(at);if(st<0&&ct>0||st>0&&ct<0)return!1}return-1}static project(e,i,s,o,c){const _=e.vertices.length,j=uV;let et=0,nt=0;const st=hV,at=e.vertices;st.setZero(),Xl.vectorToLocalFrame(s,o,i,j),Xl.pointToLocalFrame(s,o,st,st);const ct=st.dot(j);nt=et=at[0].dot(j);for(let dt=1;dt<_;dt++){const mt=at[dt].dot(j);mt>et&&(et=mt),mt<nt&&(nt=mt)}if(nt-=ct,et-=ct,nt>et){const dt=nt;nt=et,et=dt}c[0]=et,c[1]=nt}}const yL=[],AL=[],uV=(new pn,new pn),hV=new pn;class sD extends _s{constructor(e){super({type:_s.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,i=this.halfExtents.y,s=this.halfExtents.z,o=pn,c=[new o(-e,-i,-s),new o(e,-i,-s),new o(e,i,-s),new o(-e,i,-s),new o(-e,-i,s),new o(e,-i,s),new o(e,i,s),new o(-e,i,s)],_=[new o(0,0,1),new o(0,1,0),new o(1,0,0)],j=new _S({vertices:c,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:_});this.convexPolyhedronRepresentation=j,j.material=this.material}calculateLocalInertia(e,i){return i===void 0&&(i=new pn),sD.calculateInertia(this.halfExtents,e,i),i}static calculateInertia(e,i,s){const o=e;s.x=1/12*i*(2*o.y*2*o.y+2*o.z*2*o.z),s.y=1/12*i*(2*o.x*2*o.x+2*o.z*2*o.z),s.z=1/12*i*(2*o.y*2*o.y+2*o.x*2*o.x)}getSideNormals(e,i){const s=e,o=this.halfExtents;if(s[0].set(o.x,0,0),s[1].set(0,o.y,0),s[2].set(0,0,o.z),s[3].set(-o.x,0,0),s[4].set(0,-o.y,0),s[5].set(0,0,-o.z),i!==void 0)for(let c=0;c!==s.length;c++)i.vmult(s[c],s[c]);return s}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,i,s){const o=this.halfExtents,c=[[o.x,o.y,o.z],[-o.x,o.y,o.z],[-o.x,-o.y,o.z],[-o.x,-o.y,-o.z],[o.x,-o.y,-o.z],[o.x,o.y,-o.z],[-o.x,o.y,-o.z],[o.x,-o.y,o.z]];for(let _=0;_<c.length;_++)D1.set(c[_][0],c[_][1],c[_][2]),i.vmult(D1,D1),e.vadd(D1,D1),s(D1.x,D1.y,D1.z)}calculateWorldAABB(e,i,s,o){const c=this.halfExtents;VA[0].set(c.x,c.y,c.z),VA[1].set(-c.x,c.y,c.z),VA[2].set(-c.x,-c.y,c.z),VA[3].set(-c.x,-c.y,-c.z),VA[4].set(c.x,-c.y,-c.z),VA[5].set(c.x,c.y,-c.z),VA[6].set(-c.x,c.y,-c.z),VA[7].set(c.x,-c.y,c.z);const _=VA[0];i.vmult(_,_),e.vadd(_,_),o.copy(_),s.copy(_);for(let j=1;j<8;j++){const et=VA[j];i.vmult(et,et),e.vadd(et,et);const nt=et.x,st=et.y,at=et.z;nt>o.x&&(o.x=nt),st>o.y&&(o.y=st),at>o.z&&(o.z=at),nt<s.x&&(s.x=nt),st<s.y&&(s.y=st),at<s.z&&(s.z=at)}}}const D1=new pn,VA=[new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn];class bs extends rF{constructor(e){e===void 0&&(e={}),super(),this.id=bs.idCounter++,this.index=-1,this.world=null,this.vlambda=new pn,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse!="boolean"||e.collisionResponse,this.position=new pn,this.previousPosition=new pn,this.interpolatedPosition=new pn,this.initPosition=new pn,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new pn,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new pn,this.force=new pn;const i=typeof e.mass=="number"?e.mass:0;this.mass=i,this.invMass=i>0?1/i:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=i<=0?bs.STATIC:bs.DYNAMIC,typeof e.type==typeof bs.STATIC&&(this.type=e.type),this.allowSleep=e.allowSleep===void 0||e.allowSleep,this.sleepState=bs.AWAKE,this.sleepSpeedLimit=e.sleepSpeedLimit!==void 0?e.sleepSpeedLimit:.1,this.sleepTimeLimit=e.sleepTimeLimit!==void 0?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new pn,this.quaternion=new ip,this.initQuaternion=new ip,this.previousQuaternion=new ip,this.interpolatedQuaternion=new ip,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new pn,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new pn,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new pn,this.invInertia=new pn,this.invInertiaWorld=new Iy,this.invMassSolve=0,this.invInertiaSolve=new pn,this.invInertiaWorldSolve=new Iy,this.fixedRotation=e.fixedRotation!==void 0&&e.fixedRotation,this.angularDamping=e.angularDamping!==void 0?e.angularDamping:.01,this.linearFactor=new pn(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new pn(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new Yu,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new pn,this.isTrigger=!!e.isTrigger,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=bs.AWAKE,this.wakeUpAfterNarrowphase=!1,e===bs.SLEEPING&&this.dispatchEvent(bs.wakeupEvent)}sleep(){this.sleepState=bs.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const i=this.sleepState,s=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),o=this.sleepSpeedLimit**2;i===bs.AWAKE&&s<o?(this.sleepState=bs.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(bs.sleepyEvent)):i===bs.SLEEPY&&s>o?this.wakeUp():i===bs.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(bs.sleepEvent))}}updateSolveMassProperties(){this.sleepState===bs.SLEEPING||this.type===bs.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,i){return i===void 0&&(i=new pn),e.vsub(this.position,i),this.quaternion.conjugate().vmult(i,i),i}vectorToLocalFrame(e,i){return i===void 0&&(i=new pn),this.quaternion.conjugate().vmult(e,i),i}pointToWorldFrame(e,i){return i===void 0&&(i=new pn),this.quaternion.vmult(e,i),i.vadd(this.position,i),i}vectorToWorldFrame(e,i){return i===void 0&&(i=new pn),this.quaternion.vmult(e,i),i}addShape(e,i,s){const o=new pn,c=new ip;return i&&o.copy(i),s&&c.copy(s),this.shapes.push(e),this.shapeOffsets.push(o),this.shapeOrientations.push(c),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const i=this.shapes.indexOf(e);return i===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(i,1),this.shapeOffsets.splice(i,1),this.shapeOrientations.splice(i,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,i=this.shapeOffsets,s=e.length;let o=0;for(let c=0;c!==s;c++){const _=e[c];_.updateBoundingSphereRadius();const j=i[c].length(),et=_.boundingSphereRadius;j+et>o&&(o=j+et)}this.boundingRadius=o}updateAABB(){const e=this.shapes,i=this.shapeOffsets,s=this.shapeOrientations,o=e.length,c=dV,_=pV,j=this.quaternion,et=this.aabb,nt=fV;for(let st=0;st!==o;st++){const at=e[st];j.vmult(i[st],c),c.vadd(this.position,c),j.mult(s[st],_),at.calculateWorldAABB(c,_,nt.lowerBound,nt.upperBound),st===0?et.copy(nt):et.extend(nt)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const i=this.invInertia;if(i.x!==i.y||i.y!==i.z||e){const s=mV,o=gV;s.setRotationFromQuaternion(this.quaternion),s.transpose(o),s.scale(i,s),s.mmult(o,this.invInertiaWorld)}}applyForce(e,i){if(i===void 0&&(i=new pn),this.type!==bs.DYNAMIC)return;this.sleepState===bs.SLEEPING&&this.wakeUp();const s=_V;i.cross(e,s),this.force.vadd(e,this.force),this.torque.vadd(s,this.torque)}applyLocalForce(e,i){if(i===void 0&&(i=new pn),this.type!==bs.DYNAMIC)return;const s=vV,o=yV;this.vectorToWorldFrame(e,s),this.vectorToWorldFrame(i,o),this.applyForce(s,o)}applyTorque(e){this.type===bs.DYNAMIC&&(this.sleepState===bs.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,i){if(i===void 0&&(i=new pn),this.type!==bs.DYNAMIC)return;this.sleepState===bs.SLEEPING&&this.wakeUp();const s=i,o=AV;o.copy(e),o.scale(this.invMass,o),this.velocity.vadd(o,this.velocity);const c=bV;s.cross(e,c),this.invInertiaWorld.vmult(c,c),this.angularVelocity.vadd(c,this.angularVelocity)}applyLocalImpulse(e,i){if(i===void 0&&(i=new pn),this.type!==bs.DYNAMIC)return;const s=wV,o=xV;this.vectorToWorldFrame(e,s),this.vectorToWorldFrame(i,o),this.applyImpulse(s,o)}updateMassProperties(){const e=EV;this.invMass=this.mass>0?1/this.mass:0;const i=this.inertia,s=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),sD.calculateInertia(e,this.mass,i),this.invInertia.set(i.x>0&&!s?1/i.x:0,i.y>0&&!s?1/i.y:0,i.z>0&&!s?1/i.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,i){const s=new pn;return e.vsub(this.position,s),this.angularVelocity.cross(s,i),this.velocity.vadd(i,i),i}integrate(e,i,s){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==bs.DYNAMIC&&this.type!==bs.KINEMATIC||this.sleepState===bs.SLEEPING)return;const o=this.velocity,c=this.angularVelocity,_=this.position,j=this.force,et=this.torque,nt=this.quaternion,st=this.invMass,at=this.invInertiaWorld,ct=this.linearFactor,dt=st*e;o.x+=j.x*dt*ct.x,o.y+=j.y*dt*ct.y,o.z+=j.z*dt*ct.z;const mt=at.elements,yt=this.angularFactor,wt=et.x*yt.x,Ct=et.y*yt.y,bt=et.z*yt.z;c.x+=e*(mt[0]*wt+mt[1]*Ct+mt[2]*bt),c.y+=e*(mt[3]*wt+mt[4]*Ct+mt[5]*bt),c.z+=e*(mt[6]*wt+mt[7]*Ct+mt[8]*bt),_.x+=o.x*e,_.y+=o.y*e,_.z+=o.z*e,nt.integrate(this.angularVelocity,e,this.angularFactor,nt),i&&(s?nt.normalizeFast():nt.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}bs.idCounter=0,bs.COLLIDE_EVENT_NAME="collide",bs.DYNAMIC=1,bs.STATIC=2,bs.KINEMATIC=4,bs.AWAKE=0,bs.SLEEPY=1,bs.SLEEPING=2,bs.wakeupEvent={type:"wakeup"},bs.sleepyEvent={type:"sleepy"},bs.sleepEvent={type:"sleep"};const dV=new pn,pV=new ip,fV=new Yu,mV=new Iy,gV=new Iy,_V=(new Iy,new pn),vV=new pn,yV=new pn,AV=new pn,bV=new pn,wV=new pn,xV=new pn,EV=new pn;class SV{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,i,s){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,i){return(e.collisionFilterGroup&i.collisionFilterMask)!=0&&(i.collisionFilterGroup&e.collisionFilterMask)!=0&&((e.type&bs.STATIC)==0&&e.sleepState!==bs.SLEEPING||(i.type&bs.STATIC)==0&&i.sleepState!==bs.SLEEPING)}intersectionTest(e,i,s,o){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,i,s,o):this.doBoundingSphereBroadphase(e,i,s,o)}doBoundingSphereBroadphase(e,i,s,o){const c=CV;i.position.vsub(e.position,c);const _=(e.boundingRadius+i.boundingRadius)**2;c.lengthSquared()<_&&(s.push(e),o.push(i))}doBoundingBoxBroadphase(e,i,s,o){e.aabbNeedsUpdate&&e.updateAABB(),i.aabbNeedsUpdate&&i.updateAABB(),e.aabb.overlaps(i.aabb)&&(s.push(e),o.push(i))}makePairsUnique(e,i){const s=TV,o=MV,c=IV,_=e.length;for(let j=0;j!==_;j++)o[j]=e[j],c[j]=i[j];e.length=0,i.length=0;for(let j=0;j!==_;j++){const et=o[j].id,nt=c[j].id,st=et<nt?`${et},${nt}`:`${nt},${et}`;s[st]=j,s.keys.push(st)}for(let j=0;j!==s.keys.length;j++){const et=s.keys.pop(),nt=s[et];e.push(o[nt]),i.push(c[nt]),delete s[et]}}setWorld(e){}static boundingSphereCheck(e,i){const s=new pn;e.position.vsub(i.position,s);const o=e.shapes[0],c=i.shapes[0];return Math.pow(o.boundingSphereRadius+c.boundingSphereRadius,2)>s.lengthSquared()}aabbQuery(e,i,s){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const CV=new pn;new pn,new ip,new pn;const TV={keys:[]},MV=[],IV=[];new pn,new pn,new pn;class PV extends SV{constructor(){super()}collisionPairs(e,i,s){const o=e.bodies,c=o.length;let _,j;for(let et=0;et!==c;et++)for(let nt=0;nt!==et;nt++)_=o[et],j=o[nt],this.needBroadphaseCollision(_,j)&&this.intersectionTest(_,j,i,s)}aabbQuery(e,i,s){s===void 0&&(s=[]);for(let o=0;o<e.bodies.length;o++){const c=e.bodies[o];c.aabbNeedsUpdate&&c.updateAABB(),c.aabb.overlaps(i)&&s.push(c)}return s}}class oD{constructor(){this.rayFromWorld=new pn,this.rayToWorld=new pn,this.hitNormalWorld=new pn,this.hitPointWorld=new pn,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,i,s,o,c,_,j){this.rayFromWorld.copy(e),this.rayToWorld.copy(i),this.hitNormalWorld.copy(s),this.hitPointWorld.copy(o),this.shape=c,this.body=_,this.distance=j}}let sF,oF,aF,lF,cF,uF,hF;sF=_s.types.SPHERE,oF=_s.types.PLANE,aF=_s.types.BOX,lF=_s.types.CYLINDER,cF=_s.types.CONVEXPOLYHEDRON,uF=_s.types.HEIGHTFIELD,hF=_s.types.TRIMESH;class $p{get[sF](){return this._intersectSphere}get[oF](){return this._intersectPlane}get[aF](){return this._intersectBox}get[lF](){return this._intersectConvex}get[cF](){return this._intersectConvex}get[uF](){return this._intersectHeightfield}get[hF](){return this._intersectTrimesh}constructor(e,i){e===void 0&&(e=new pn),i===void 0&&(i=new pn),this.from=e.clone(),this.to=i.clone(),this.direction=new pn,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=$p.ANY,this.result=new oD,this.hasHit=!1,this.callback=s=>{}}intersectWorld(e,i){return this.mode=i.mode||$p.ANY,this.result=i.result||new oD,this.skipBackfaces=!!i.skipBackfaces,this.collisionFilterMask=i.collisionFilterMask!==void 0?i.collisionFilterMask:-1,this.collisionFilterGroup=i.collisionFilterGroup!==void 0?i.collisionFilterGroup:-1,this.checkCollisionResponse=i.checkCollisionResponse===void 0||i.checkCollisionResponse,i.from&&this.from.copy(i.from),i.to&&this.to.copy(i.to),this.callback=i.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(dF),bL.length=0,e.broadphase.aabbQuery(e,dF,bL),this.intersectBodies(bL),this.hasHit}intersectBody(e,i){i&&(this.result=i,this.updateDirection());const s=this.checkCollisionResponse;if(s&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const o=RV,c=DV;for(let _=0,j=e.shapes.length;_<j;_++){const et=e.shapes[_];if((!s||et.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[_],c),e.quaternion.vmult(e.shapeOffsets[_],o),o.vadd(e.position,o),this.intersectShape(et,c,o,e),this.result.shouldStop))break}}intersectBodies(e,i){i&&(this.result=i,this.updateDirection());for(let s=0,o=e.length;!this.result.shouldStop&&s<o;s++)this.intersectBody(e[s])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,i,s,o){if(function(j,et,nt){nt.vsub(j,vS);const st=vS.dot(et);return et.scale(st,lD),lD.vadd(j,lD),nt.distanceTo(lD)}(this.from,this.direction,s)>e.boundingSphereRadius)return;const _=this[e.type];_&&_.call(this,e,i,s,o,e)}_intersectBox(e,i,s,o,c){return this._intersectConvex(e.convexPolyhedronRepresentation,i,s,o,c)}_intersectPlane(e,i,s,o,c){const _=this.from,j=this.to,et=this.direction,nt=new pn(0,0,1);i.vmult(nt,nt);const st=new pn;_.vsub(s,st);const at=st.dot(nt);if(j.vsub(s,st),at*st.dot(nt)>0||_.distanceTo(j)<at)return;const ct=nt.dot(et);if(Math.abs(ct)<this.precision)return;const dt=new pn,mt=new pn,yt=new pn;_.vsub(s,dt);const wt=-nt.dot(dt)/ct;et.scale(wt,mt),_.vadd(mt,yt),this.reportIntersection(nt,yt,c,o,-1)}getAABB(e){const{lowerBound:i,upperBound:s}=e,o=this.to,c=this.from;i.x=Math.min(o.x,c.x),i.y=Math.min(o.y,c.y),i.z=Math.min(o.z,c.z),s.x=Math.max(o.x,c.x),s.y=Math.max(o.y,c.y),s.z=Math.max(o.z,c.z)}_intersectHeightfield(e,i,s,o,c){e.data,e.elementSize;const _=kV;_.from.copy(this.from),_.to.copy(this.to),Xl.pointToLocalFrame(s,i,_.from,_.from),Xl.pointToLocalFrame(s,i,_.to,_.to),_.updateDirection();const j=OV;let et,nt,st,at;et=nt=0,st=at=e.data.length-1;const ct=new Yu;_.getAABB(ct),e.getIndexOfPosition(ct.lowerBound.x,ct.lowerBound.y,j,!0),et=Math.max(et,j[0]),nt=Math.max(nt,j[1]),e.getIndexOfPosition(ct.upperBound.x,ct.upperBound.y,j,!0),st=Math.min(st,j[0]+1),at=Math.min(at,j[1]+1);for(let dt=et;dt<st;dt++)for(let mt=nt;mt<at;mt++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(dt,mt,ct),ct.overlapsRay(_)){if(e.getConvexTrianglePillar(dt,mt,!1),Xl.pointToWorldFrame(s,i,e.pillarOffset,aD),this._intersectConvex(e.pillarConvex,i,aD,o,c,pF),this.result.shouldStop)return;e.getConvexTrianglePillar(dt,mt,!0),Xl.pointToWorldFrame(s,i,e.pillarOffset,aD),this._intersectConvex(e.pillarConvex,i,aD,o,c,pF)}}}_intersectSphere(e,i,s,o,c){const _=this.from,j=this.to,et=e.radius,nt=(j.x-_.x)**2+(j.y-_.y)**2+(j.z-_.z)**2,st=2*((j.x-_.x)*(_.x-s.x)+(j.y-_.y)*(_.y-s.y)+(j.z-_.z)*(_.z-s.z)),at=st**2-4*nt*((_.x-s.x)**2+(_.y-s.y)**2+(_.z-s.z)**2-et**2),ct=BV,dt=LV;if(!(at<0))if(at===0)_.lerp(j,at,ct),ct.vsub(s,dt),dt.normalize(),this.reportIntersection(dt,ct,c,o,-1);else{const mt=(-st-Math.sqrt(at))/(2*nt),yt=(-st+Math.sqrt(at))/(2*nt);if(mt>=0&&mt<=1&&(_.lerp(j,mt,ct),ct.vsub(s,dt),dt.normalize(),this.reportIntersection(dt,ct,c,o,-1)),this.result.shouldStop)return;yt>=0&&yt<=1&&(_.lerp(j,yt,ct),ct.vsub(s,dt),dt.normalize(),this.reportIntersection(dt,ct,c,o,-1))}}_intersectConvex(e,i,s,o,c,_){const j=NV,et=fF,nt=_&&_.faceList||null,st=e.faces,at=e.vertices,ct=e.faceNormals,dt=this.direction,mt=this.from,yt=this.to,wt=mt.distanceTo(yt),Ct=nt?nt.length:st.length,bt=this.result;for(let At=0;!bt.shouldStop&&At<Ct;At++){const Pt=nt?nt[At]:At,Dt=st[Pt],Nt=ct[Pt],Vt=i,Zt=s;et.copy(at[Dt[0]]),Vt.vmult(et,et),et.vadd(Zt,et),et.vsub(mt,et),Vt.vmult(Nt,j);const an=dt.dot(j);if(Math.abs(an)<this.precision)continue;const fn=j.dot(et)/an;if(!(fn<0)){dt.scale(fn,Ev),Ev.vadd(mt,Ev),Py.copy(at[Dt[0]]),Vt.vmult(Py,Py),Zt.vadd(Py,Py);for(let mn=1;!bt.shouldStop&&mn<Dt.length-1;mn++){GA.copy(at[Dt[mn]]),HA.copy(at[Dt[mn+1]]),Vt.vmult(GA,GA),Vt.vmult(HA,HA),Zt.vadd(GA,GA),Zt.vadd(HA,HA);const Sn=Ev.distanceTo(mt);!$p.pointInTriangle(Ev,Py,GA,HA)&&!$p.pointInTriangle(Ev,GA,Py,HA)||Sn>wt||this.reportIntersection(j,Ev,c,o,Pt)}}}}_intersectTrimesh(e,i,s,o,c,_){const j=UV,et=HV,nt=QV,st=fF,at=FV,ct=jV,dt=zV,mt=GV,yt=VV,wt=e.indices;e.vertices;const Ct=this.from,bt=this.to,At=this.direction;nt.position.copy(s),nt.quaternion.copy(i),Xl.vectorToLocalFrame(s,i,At,at),Xl.pointToLocalFrame(s,i,Ct,ct),Xl.pointToLocalFrame(s,i,bt,dt),dt.x*=e.scale.x,dt.y*=e.scale.y,dt.z*=e.scale.z,ct.x*=e.scale.x,ct.y*=e.scale.y,ct.z*=e.scale.z,dt.vsub(ct,at),at.normalize();const Pt=ct.distanceSquared(dt);e.tree.rayQuery(this,nt,et);for(let Dt=0,Nt=et.length;!this.result.shouldStop&&Dt!==Nt;Dt++){const Vt=et[Dt];e.getNormal(Vt,j),e.getVertex(wt[3*Vt],Py),Py.vsub(ct,st);const Zt=at.dot(j),an=j.dot(st)/Zt;if(an<0)continue;at.scale(an,Ev),Ev.vadd(ct,Ev),e.getVertex(wt[3*Vt+1],GA),e.getVertex(wt[3*Vt+2],HA);const fn=Ev.distanceSquared(ct);!$p.pointInTriangle(Ev,GA,Py,HA)&&!$p.pointInTriangle(Ev,Py,GA,HA)||fn>Pt||(Xl.vectorToWorldFrame(i,j,yt),Xl.pointToWorldFrame(s,i,Ev,mt),this.reportIntersection(yt,mt,c,o,Vt))}et.length=0}reportIntersection(e,i,s,o,c){const _=this.from,j=this.to,et=_.distanceTo(i),nt=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(nt.hitFaceIndex=c!==void 0?c:-1,this.mode){case $p.ALL:this.hasHit=!0,nt.set(_,j,e,i,s,o,et),nt.hasHit=!0,this.callback(nt);break;case $p.CLOSEST:(et<nt.distance||!nt.hasHit)&&(this.hasHit=!0,nt.hasHit=!0,nt.set(_,j,e,i,s,o,et));break;case $p.ANY:this.hasHit=!0,nt.hasHit=!0,nt.set(_,j,e,i,s,o,et),nt.shouldStop=!0}}static pointInTriangle(e,i,s,o){o.vsub(i,vS),s.vsub(i,HI),e.vsub(i,wL);const c=vS.dot(vS),_=vS.dot(HI),j=vS.dot(wL),et=HI.dot(HI),nt=HI.dot(wL);let st,at;return(st=et*j-_*nt)>=0&&(at=c*nt-_*j)>=0&&st+at<c*et-_*_}}$p.CLOSEST=1,$p.ANY=2,$p.ALL=4;const dF=new Yu,bL=[],HI=new pn,wL=new pn,RV=new pn,DV=new ip,Ev=new pn,Py=new pn,GA=new pn,HA=new pn;new pn,new oD;const pF={faceList:[0]},aD=new pn,kV=new $p,OV=[],BV=new pn,LV=new pn,NV=new pn,fF=(new pn,new pn,new pn),UV=new pn,FV=new pn,jV=new pn,zV=new pn,VV=new pn,GV=new pn;new Yu;const HV=[],QV=new Xl,vS=new pn,lD=new pn;class mF{static defaults(e,i){e===void 0&&(e={});for(let s in i)s in e||(e[s]=i[s]);return e}}class cD{constructor(e,i,s){s===void 0&&(s={}),s=mF.defaults(s,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=i,this.id=cD.idCounter++,this.collideConnected=s.collideConnected,s.wakeUpBodies&&(e&&e.wakeUp(),i&&i.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const e=this.equations;for(let i=0;i<e.length;i++)e[i].enabled=!0}disable(){const e=this.equations;for(let i=0;i<e.length;i++)e[i].enabled=!1}}cD.idCounter=0;class gF{constructor(){this.spatial=new pn,this.rotational=new pn}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,i){return e.dot(this.spatial)+i.dot(this.rotational)}}class QI{constructor(e,i,s,o){s===void 0&&(s=-1e6),o===void 0&&(o=1e6),this.id=QI.idCounter++,this.minForce=s,this.maxForce=o,this.bi=e,this.bj=i,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new gF,this.jacobianElementB=new gF,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,i,s){const o=i,c=e,_=s;this.a=4/(_*(1+4*o)),this.b=4*o/(1+4*o),this.eps=4/(_*_*c*(1+4*o))}computeB(e,i,s){const o=this.computeGW();return-this.computeGq()*e-o*i-this.computeGiMf()*s}computeGq(){const e=this.jacobianElementA,i=this.jacobianElementB,s=this.bi,o=this.bj,c=s.position,_=o.position;return e.spatial.dot(c)+i.spatial.dot(_)}computeGW(){const e=this.jacobianElementA,i=this.jacobianElementB,s=this.bi,o=this.bj,c=s.velocity,_=o.velocity,j=s.angularVelocity,et=o.angularVelocity;return e.multiplyVectors(c,j)+i.multiplyVectors(_,et)}computeGWlambda(){const e=this.jacobianElementA,i=this.jacobianElementB,s=this.bi,o=this.bj,c=s.vlambda,_=o.vlambda,j=s.wlambda,et=o.wlambda;return e.multiplyVectors(c,j)+i.multiplyVectors(_,et)}computeGiMf(){const e=this.jacobianElementA,i=this.jacobianElementB,s=this.bi,o=this.bj,c=s.force,_=s.torque,j=o.force,et=o.torque,nt=s.invMassSolve,st=o.invMassSolve;return c.scale(nt,_F),j.scale(st,vF),s.invInertiaWorldSolve.vmult(_,yF),o.invInertiaWorldSolve.vmult(et,AF),e.multiplyVectors(_F,yF)+i.multiplyVectors(vF,AF)}computeGiMGt(){const e=this.jacobianElementA,i=this.jacobianElementB,s=this.bi,o=this.bj,c=s.invMassSolve,_=o.invMassSolve,j=s.invInertiaWorldSolve,et=o.invInertiaWorldSolve;let nt=c+_;return j.vmult(e.rotational,uD),nt+=uD.dot(e.rotational),et.vmult(i.rotational,uD),nt+=uD.dot(i.rotational),nt}addToWlambda(e){const i=this.jacobianElementA,s=this.jacobianElementB,o=this.bi,c=this.bj,_=WV;o.vlambda.addScaledVector(o.invMassSolve*e,i.spatial,o.vlambda),c.vlambda.addScaledVector(c.invMassSolve*e,s.spatial,c.vlambda),o.invInertiaWorldSolve.vmult(i.rotational,_),o.wlambda.addScaledVector(e,_,o.wlambda),c.invInertiaWorldSolve.vmult(s.rotational,_),c.wlambda.addScaledVector(e,_,c.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}QI.idCounter=0;const _F=new pn,vF=new pn,yF=new pn,AF=new pn,uD=new pn,WV=new pn;class hD extends QI{constructor(e,i,s){s===void 0&&(s=1e6),super(e,i,0,s),this.restitution=0,this.ri=new pn,this.rj=new pn,this.ni=new pn}computeB(e){const i=this.a,s=this.b,o=this.bi,c=this.bj,_=this.ri,j=this.rj,et=qV,nt=XV,st=o.velocity,at=o.angularVelocity;o.force,o.torque;const ct=c.velocity,dt=c.angularVelocity;c.force,c.torque;const mt=YV,yt=this.jacobianElementA,wt=this.jacobianElementB,Ct=this.ni;_.cross(Ct,et),j.cross(Ct,nt),Ct.negate(yt.spatial),et.negate(yt.rotational),wt.spatial.copy(Ct),wt.rotational.copy(nt),mt.copy(c.position),mt.vadd(j,mt),mt.vsub(o.position,mt),mt.vsub(_,mt);const bt=Ct.dot(mt),At=this.restitution+1;return-bt*i-(At*ct.dot(Ct)-At*st.dot(Ct)+dt.dot(nt)-at.dot(et))*s-e*this.computeGiMf()}getImpactVelocityAlongNormal(){const e=$V,i=KV,s=JV,o=ZV,c=eG;return this.bi.position.vadd(this.ri,s),this.bj.position.vadd(this.rj,o),this.bi.getVelocityAtWorldPoint(s,e),this.bj.getVelocityAtWorldPoint(o,i),e.vsub(i,c),this.ni.dot(c)}}const qV=new pn,XV=new pn,YV=new pn,$V=new pn,KV=new pn,JV=new pn,ZV=new pn,eG=new pn;class tG extends cD{constructor(e,i,s,o,c){i===void 0&&(i=new pn),o===void 0&&(o=new pn),c===void 0&&(c=1e6),super(e,s),this.pivotA=i.clone(),this.pivotB=o.clone();const _=this.equationX=new hD(e,s),j=this.equationY=new hD(e,s),et=this.equationZ=new hD(e,s);this.equations.push(_,j,et),_.minForce=j.minForce=et.minForce=-c,_.maxForce=j.maxForce=et.maxForce=c,_.ni.set(1,0,0),j.ni.set(0,1,0),et.ni.set(0,0,1)}update(){const e=this.bodyA,i=this.bodyB,s=this.equationX,o=this.equationY,c=this.equationZ;e.quaternion.vmult(this.pivotA,s.ri),i.quaternion.vmult(this.pivotB,s.rj),o.ri.copy(s.ri),o.rj.copy(s.rj),c.ri.copy(s.ri),c.rj.copy(s.rj)}}new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn;class bF extends QI{constructor(e,i,s){super(e,i,-s,s),this.ri=new pn,this.rj=new pn,this.t=new pn}computeB(e){this.a;const i=this.b;this.bi,this.bj;const s=this.ri,o=this.rj,c=nG,_=rG,j=this.t;s.cross(j,c),o.cross(j,_);const et=this.jacobianElementA,nt=this.jacobianElementB;return j.negate(et.spatial),c.negate(et.rotational),nt.spatial.copy(j),nt.rotational.copy(_),-this.computeGW()*i-e*this.computeGiMf()}}const nG=new pn,rG=new pn;class dD{constructor(e,i,s){s=mF.defaults(s,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=dD.idCounter++,this.materials=[e,i],this.friction=s.friction,this.restitution=s.restitution,this.contactEquationStiffness=s.contactEquationStiffness,this.contactEquationRelaxation=s.contactEquationRelaxation,this.frictionEquationStiffness=s.frictionEquationStiffness,this.frictionEquationRelaxation=s.frictionEquationRelaxation}}dD.idCounter=0;class pD{constructor(e){e===void 0&&(e={});let i="";typeof e=="string"&&(i=e,e={}),this.name=i,this.id=pD.idCounter++,this.friction=e.friction!==void 0?e.friction:-1,this.restitution=e.restitution!==void 0?e.restitution:-1}}pD.idCounter=0,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new $p,new pn,new pn,new pn,new pn(1,0,0),new pn(0,1,0),new pn(0,0,1),new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn;class wF extends _s{constructor(e){if(super({type:_s.types.SPHERE}),this.radius=e!==void 0?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,i){i===void 0&&(i=new pn);const s=2*e*this.radius*this.radius/5;return i.x=s,i.y=s,i.z=s,i}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,i,s,o){const c=this.radius,_=["x","y","z"];for(let j=0;j<_.length;j++){const et=_[j];s[et]=e[et]-c,o[et]=e[et]+c}}}new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn;class iG extends _S{constructor(e,i,s,o){if(e===void 0&&(e=1),i===void 0&&(i=1),s===void 0&&(s=1),o===void 0&&(o=8),e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(i<0)throw new Error("The cylinder radiusBottom cannot be negative.");const c=o,_=[],j=[],et=[],nt=[],st=[],at=Math.cos,ct=Math.sin;_.push(new pn(-i*ct(0),.5*-s,i*at(0))),nt.push(0),_.push(new pn(-e*ct(0),.5*s,e*at(0))),st.push(1);for(let mt=0;mt<c;mt++){const yt=2*Math.PI/c*(mt+1),wt=2*Math.PI/c*(mt+.5);mt<c-1?(_.push(new pn(-i*ct(yt),.5*-s,i*at(yt))),nt.push(2*mt+2),_.push(new pn(-e*ct(yt),.5*s,e*at(yt))),st.push(2*mt+3),et.push([2*mt,2*mt+1,2*mt+3,2*mt+2])):et.push([2*mt,2*mt+1,1,0]),(c%2==1||mt<c/2)&&j.push(new pn(-ct(wt),0,at(wt)))}et.push(nt),j.push(new pn(0,1,0));const dt=[];for(let mt=0;mt<st.length;mt++)dt.push(st[st.length-mt-1]);et.push(dt),super({vertices:_,faces:et,axes:j}),this.type=_s.types.CYLINDER,this.radiusTop=e,this.radiusBottom=i,this.height=s,this.numSegments=o}}class sG extends _s{constructor(){super({type:_s.types.PLANE}),this.worldNormal=new pn,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const i=this.worldNormal;i.set(0,0,1),e.vmult(i,i),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,i){return i===void 0&&(i=new pn),i}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,i,s,o){tx.set(0,0,1),i.vmult(tx,tx);const c=Number.MAX_VALUE;s.set(-c,-c,-c),o.set(c,c,c),tx.x===1?o.x=e.x:tx.x===-1&&(s.x=e.x),tx.y===1?o.y=e.y:tx.y===-1&&(s.y=e.y),tx.z===1?o.z=e.z:tx.z===-1&&(s.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const tx=new pn;new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn,new pn;class QA{constructor(e){e===void 0&&(e={}),this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new Yu,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,i,s){s===void 0&&(s=0);const o=this.data;if(!this.aabb.contains(e))return!1;const c=this.children;if(s<(this.maxDepth||this.root.maxDepth)){let _=!1;c.length||(this.subdivide(),_=!0);for(let j=0;j!==8;j++)if(c[j].insert(e,i,s+1))return!0;_&&(c.length=0)}return o.push(i),!0}subdivide(){const e=this.aabb,i=e.lowerBound,s=e.upperBound,o=this.children;o.push(new QA({aabb:new Yu({lowerBound:new pn(0,0,0)})}),new QA({aabb:new Yu({lowerBound:new pn(1,0,0)})}),new QA({aabb:new Yu({lowerBound:new pn(1,1,0)})}),new QA({aabb:new Yu({lowerBound:new pn(1,1,1)})}),new QA({aabb:new Yu({lowerBound:new pn(0,1,1)})}),new QA({aabb:new Yu({lowerBound:new pn(0,0,1)})}),new QA({aabb:new Yu({lowerBound:new pn(1,0,1)})}),new QA({aabb:new Yu({lowerBound:new pn(0,1,0)})})),s.vsub(i,yS),yS.scale(.5,yS);const c=this.root||this;for(let _=0;_!==8;_++){const j=o[_];j.root=c;const et=j.aabb.lowerBound;et.x*=yS.x,et.y*=yS.y,et.z*=yS.z,et.vadd(i,et),et.vadd(yS,j.aabb.upperBound)}}aabbQuery(e,i){this.data,this.children;const s=[this];for(;s.length;){const o=s.pop();o.aabb.overlaps(e)&&Array.prototype.push.apply(i,o.data),Array.prototype.push.apply(s,o.children)}return i}rayQuery(e,i,s){return e.getAABB(fD),fD.toLocalFrame(i,fD),this.aabbQuery(fD,s),s}removeEmptyNodes(){for(let e=this.children.length-1;e>=0;e--)this.children[e].removeEmptyNodes(),this.children[e].children.length||this.children[e].data.length||this.children.splice(e,1)}}class oG extends QA{constructor(e,i){i===void 0&&(i={}),super({root:null,aabb:e}),this.maxDepth=i.maxDepth!==void 0?i.maxDepth:8}}const yS=new pn,fD=new Yu;class mD extends _s{constructor(e,i){super({type:_s.types.TRIMESH}),this.vertices=new Float32Array(e),this.indices=new Int16Array(i),this.normals=new Float32Array(i.length),this.aabb=new Yu,this.edges=null,this.scale=new pn(1,1,1),this.tree=new oG,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const e=this.tree;e.reset(),e.aabb.copy(this.aabb);const i=this.scale;e.aabb.lowerBound.x*=1/i.x,e.aabb.lowerBound.y*=1/i.y,e.aabb.lowerBound.z*=1/i.z,e.aabb.upperBound.x*=1/i.x,e.aabb.upperBound.y*=1/i.y,e.aabb.upperBound.z*=1/i.z;const s=new Yu,o=new pn,c=new pn,_=new pn,j=[o,c,_];for(let et=0;et<this.indices.length/3;et++){const nt=3*et;this._getUnscaledVertex(this.indices[nt],o),this._getUnscaledVertex(this.indices[nt+1],c),this._getUnscaledVertex(this.indices[nt+2],_),s.setFromPoints(j),e.insert(s,et)}e.removeEmptyNodes()}getTrianglesInAABB(e,i){gD.copy(e);const s=this.scale,o=s.x,c=s.y,_=s.z,j=gD.lowerBound,et=gD.upperBound;return j.x/=o,j.y/=c,j.z/=_,et.x/=o,et.y/=c,et.z/=_,this.tree.aabbQuery(gD,i)}setScale(e){const i=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,s=e.x===e.y&&e.y===e.z;i&&s||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const e=aG,i=this.normals;for(let s=0;s<this.indices.length/3;s++){const o=3*s,c=this.indices[o],_=this.indices[o+1],j=this.indices[o+2];this.getVertex(c,SF),this.getVertex(_,CF),this.getVertex(j,TF),mD.computeNormal(CF,SF,TF,e),i[o]=e.x,i[o+1]=e.y,i[o+2]=e.z}}updateEdges(){const e={},i=(o,c)=>{e[o<c?`${o}_${c}`:`${c}_${o}`]=!0};for(let o=0;o<this.indices.length/3;o++){const c=3*o,_=this.indices[c],j=this.indices[c+1],et=this.indices[c+2];i(_,j),i(j,et),i(et,_)}const s=Object.keys(e);this.edges=new Int16Array(2*s.length);for(let o=0;o<s.length;o++){const c=s[o].split("_");this.edges[2*o]=parseInt(c[0],10),this.edges[2*o+1]=parseInt(c[1],10)}}getEdgeVertex(e,i,s){const o=this.edges[2*e+(i?1:0)];this.getVertex(o,s)}getEdgeVector(e,i){const s=lG,o=cG;this.getEdgeVertex(e,0,s),this.getEdgeVertex(e,1,o),o.vsub(s,i)}static computeNormal(e,i,s,o){i.vsub(e,EF),s.vsub(i,xF),xF.cross(EF,o),o.isZero()||o.normalize()}getVertex(e,i){const s=this.scale;return this._getUnscaledVertex(e,i),i.x*=s.x,i.y*=s.y,i.z*=s.z,i}_getUnscaledVertex(e,i){const s=3*e,o=this.vertices;return i.set(o[s],o[s+1],o[s+2])}getWorldVertex(e,i,s,o){return this.getVertex(e,o),Xl.pointToWorldFrame(i,s,o,o),o}getTriangleVertices(e,i,s,o){const c=3*e;this.getVertex(this.indices[c],i),this.getVertex(this.indices[c+1],s),this.getVertex(this.indices[c+2],o)}getNormal(e,i){const s=3*e;return i.set(this.normals[s],this.normals[s+1],this.normals[s+2])}calculateLocalInertia(e,i){this.computeLocalAABB(AS);const s=AS.upperBound.x-AS.lowerBound.x,o=AS.upperBound.y-AS.lowerBound.y,c=AS.upperBound.z-AS.lowerBound.z;return i.set(1/12*e*(2*o*2*o+2*c*2*c),1/12*e*(2*s*2*s+2*c*2*c),1/12*e*(2*o*2*o+2*s*2*s))}computeLocalAABB(e){const i=e.lowerBound,s=e.upperBound,o=this.vertices.length;this.vertices;const c=uG;this.getVertex(0,c),i.copy(c),s.copy(c);for(let _=0;_!==o;_++)this.getVertex(_,c),c.x<i.x?i.x=c.x:c.x>s.x&&(s.x=c.x),c.y<i.y?i.y=c.y:c.y>s.y&&(s.y=c.y),c.z<i.z?i.z=c.z:c.z>s.z&&(s.z=c.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0;const i=this.vertices,s=new pn;for(let o=0,c=i.length/3;o!==c;o++){this.getVertex(o,s);const _=s.lengthSquared();_>e&&(e=_)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,i,s,o){const c=hG,_=dG;c.position=e,c.quaternion=i,this.aabb.toWorldFrame(c,_),s.copy(_.lowerBound),o.copy(_.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(e,i,s,o,c){e===void 0&&(e=1),i===void 0&&(i=.5),s===void 0&&(s=8),o===void 0&&(o=6),c===void 0&&(c=2*Math.PI);const _=[],j=[];for(let et=0;et<=s;et++)for(let nt=0;nt<=o;nt++){const st=nt/o*c,at=et/s*Math.PI*2,ct=(e+i*Math.cos(at))*Math.cos(st),dt=(e+i*Math.cos(at))*Math.sin(st),mt=i*Math.sin(at);_.push(ct,dt,mt)}for(let et=1;et<=s;et++)for(let nt=1;nt<=o;nt++){const st=(o+1)*et+nt-1,at=(o+1)*(et-1)+nt-1,ct=(o+1)*(et-1)+nt,dt=(o+1)*et+nt;j.push(st,at,dt),j.push(at,ct,dt)}return new mD(_,j)}}const aG=new pn,gD=new Yu,lG=new pn,cG=new pn,xF=new pn,EF=new pn,SF=new pn,CF=new pn,TF=new pn,AS=new Yu,uG=new pn,hG=new Xl,dG=new Yu;class pG{constructor(){this.equations=[]}solve(e,i){return 0}addEquation(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}removeEquation(e){const i=this.equations,s=i.indexOf(e);s!==-1&&i.splice(s,1)}removeAllEquations(){this.equations.length=0}}class fG extends pG{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,i){let s=0;const o=this.iterations,c=this.tolerance*this.tolerance,_=this.equations,j=_.length,et=i.bodies,nt=et.length,st=e;let at,ct,dt,mt,yt,wt;if(j!==0)for(let Pt=0;Pt!==nt;Pt++)et[Pt].updateSolveMassProperties();const Ct=gG,bt=_G,At=mG;Ct.length=j,bt.length=j,At.length=j;for(let Pt=0;Pt!==j;Pt++){const Dt=_[Pt];At[Pt]=0,bt[Pt]=Dt.computeB(st),Ct[Pt]=1/Dt.computeC()}if(j!==0){for(let Nt=0;Nt!==nt;Nt++){const Vt=et[Nt],Zt=Vt.vlambda,an=Vt.wlambda;Zt.set(0,0,0),an.set(0,0,0)}for(s=0;s!==o;s++){mt=0;for(let Nt=0;Nt!==j;Nt++){const Vt=_[Nt];at=bt[Nt],ct=Ct[Nt],wt=At[Nt],yt=Vt.computeGWlambda(),dt=ct*(at-yt-Vt.eps*wt),wt+dt<Vt.minForce?dt=Vt.minForce-wt:wt+dt>Vt.maxForce&&(dt=Vt.maxForce-wt),At[Nt]+=dt,mt+=dt>0?dt:-dt,Vt.addToWlambda(dt)}if(mt*mt<c)break}for(let Nt=0;Nt!==nt;Nt++){const Vt=et[Nt],Zt=Vt.velocity,an=Vt.angularVelocity;Vt.vlambda.vmul(Vt.linearFactor,Vt.vlambda),Zt.vadd(Vt.vlambda,Zt),Vt.wlambda.vmul(Vt.angularFactor,Vt.wlambda),an.vadd(Vt.wlambda,an)}let Pt=_.length;const Dt=1/st;for(;Pt--;)_[Pt].multiplier=At[Pt]*Dt}return s}}const mG=[],gG=[],_G=[];bs.STATIC;class vG{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let i=0;i!==e;i++)this.objects.push(i<0||arguments.length<=i?void 0:arguments[i]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const i=this.objects;for(;i.length>e;)i.pop();for(;i.length<e;)i.push(this.constructObject());return this}}class yG extends vG{constructor(){super(...arguments),this.type=pn}constructObject(){return new pn}}const AG=_s.types.SPHERE,bG=_s.types.SPHERE|_s.types.PLANE,wG=_s.types.BOX|_s.types.BOX,xG=_s.types.SPHERE|_s.types.BOX,EG=_s.types.PLANE|_s.types.BOX,SG=_s.types.CONVEXPOLYHEDRON,CG=_s.types.SPHERE|_s.types.CONVEXPOLYHEDRON,TG=_s.types.PLANE|_s.types.CONVEXPOLYHEDRON,MG=_s.types.BOX|_s.types.CONVEXPOLYHEDRON,IG=_s.types.SPHERE|_s.types.HEIGHTFIELD,PG=_s.types.BOX|_s.types.HEIGHTFIELD,RG=_s.types.CONVEXPOLYHEDRON|_s.types.HEIGHTFIELD,DG=_s.types.PARTICLE|_s.types.SPHERE,kG=_s.types.PLANE|_s.types.PARTICLE,OG=_s.types.BOX|_s.types.PARTICLE,BG=_s.types.PARTICLE|_s.types.CONVEXPOLYHEDRON,LG=_s.types.CYLINDER,NG=_s.types.SPHERE|_s.types.CYLINDER,UG=_s.types.PLANE|_s.types.CYLINDER,FG=_s.types.BOX|_s.types.CYLINDER,jG=_s.types.CONVEXPOLYHEDRON|_s.types.CYLINDER,zG=_s.types.HEIGHTFIELD|_s.types.CYLINDER,VG=_s.types.PARTICLE|_s.types.CYLINDER,GG=_s.types.SPHERE|_s.types.TRIMESH,HG=_s.types.PLANE|_s.types.TRIMESH;class QG{get[AG](){return this.sphereSphere}get[bG](){return this.spherePlane}get[wG](){return this.boxBox}get[xG](){return this.sphereBox}get[EG](){return this.planeBox}get[SG](){return this.convexConvex}get[CG](){return this.sphereConvex}get[TG](){return this.planeConvex}get[MG](){return this.boxConvex}get[IG](){return this.sphereHeightfield}get[PG](){return this.boxHeightfield}get[RG](){return this.convexHeightfield}get[DG](){return this.sphereParticle}get[kG](){return this.planeParticle}get[OG](){return this.boxParticle}get[BG](){return this.convexParticle}get[LG](){return this.convexConvex}get[NG](){return this.sphereConvex}get[UG](){return this.planeConvex}get[FG](){return this.boxConvex}get[jG](){return this.convexConvex}get[zG](){return this.heightfieldCylinder}get[VG](){return this.particleCylinder}get[GG](){return this.sphereTrimesh}get[HG](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new yG,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,i,s,o,c,_){let j;this.contactPointPool.length?(j=this.contactPointPool.pop(),j.bi=e,j.bj=i):j=new hD(e,i),j.enabled=e.collisionResponse&&i.collisionResponse&&s.collisionResponse&&o.collisionResponse;const et=this.currentContactMaterial;j.restitution=et.restitution,j.setSpookParams(et.contactEquationStiffness,et.contactEquationRelaxation,this.world.dt);const nt=s.material||e.material,st=o.material||i.material;return nt&&st&&nt.restitution>=0&&st.restitution>=0&&(j.restitution=nt.restitution*st.restitution),j.si=c||s,j.sj=_||o,j}createFrictionEquationsFromContact(e,i){const s=e.bi,o=e.bj,c=e.si,_=e.sj,j=this.world,et=this.currentContactMaterial;let nt=et.friction;const st=c.material||s.material,at=_.material||o.material;if(st&&at&&st.friction>=0&&at.friction>=0&&(nt=st.friction*at.friction),nt>0){const ct=nt*j.gravity.length();let dt=s.invMass+o.invMass;dt>0&&(dt=1/dt);const mt=this.frictionEquationPool,yt=mt.length?mt.pop():new bF(s,o,ct*dt),wt=mt.length?mt.pop():new bF(s,o,ct*dt);return yt.bi=wt.bi=s,yt.bj=wt.bj=o,yt.minForce=wt.minForce=-ct*dt,yt.maxForce=wt.maxForce=ct*dt,yt.ri.copy(e.ri),yt.rj.copy(e.rj),wt.ri.copy(e.ri),wt.rj.copy(e.rj),e.ni.tangents(yt.t,wt.t),yt.setSpookParams(et.frictionEquationStiffness,et.frictionEquationRelaxation,j.dt),wt.setSpookParams(et.frictionEquationStiffness,et.frictionEquationRelaxation,j.dt),yt.enabled=wt.enabled=e.enabled,i.push(yt,wt),!0}return!1}createFrictionFromAverage(e){let i=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(i,this.frictionResult)||e===1)return;const s=this.frictionResult[this.frictionResult.length-2],o=this.frictionResult[this.frictionResult.length-1];bS.setZero(),RT.setZero(),DT.setZero();const c=i.bi;i.bj;for(let j=0;j!==e;j++)i=this.result[this.result.length-1-j],i.bi!==c?(bS.vadd(i.ni,bS),RT.vadd(i.ri,RT),DT.vadd(i.rj,DT)):(bS.vsub(i.ni,bS),RT.vadd(i.rj,RT),DT.vadd(i.ri,DT));const _=1/e;RT.scale(_,s.ri),DT.scale(_,s.rj),o.ri.copy(s.ri),o.rj.copy(s.rj),bS.normalize(),bS.tangents(s.t,o.t)}getContacts(e,i,s,o,c,_,j){this.contactPointPool=c,this.frictionEquationPool=j,this.result=o,this.frictionResult=_;const et=XG,nt=YG,st=WG,at=qG;for(let ct=0,dt=e.length;ct!==dt;ct++){const mt=e[ct],yt=i[ct];let wt=null;mt.material&&yt.material&&(wt=s.getContactMaterial(mt.material,yt.material)||null);const Ct=mt.type&bs.KINEMATIC&&yt.type&bs.STATIC||mt.type&bs.STATIC&&yt.type&bs.KINEMATIC||mt.type&bs.KINEMATIC&&yt.type&bs.KINEMATIC;for(let bt=0;bt<mt.shapes.length;bt++){mt.quaternion.mult(mt.shapeOrientations[bt],et),mt.quaternion.vmult(mt.shapeOffsets[bt],st),st.vadd(mt.position,st);const At=mt.shapes[bt];for(let Pt=0;Pt<yt.shapes.length;Pt++){yt.quaternion.mult(yt.shapeOrientations[Pt],nt),yt.quaternion.vmult(yt.shapeOffsets[Pt],at),at.vadd(yt.position,at);const Dt=yt.shapes[Pt];if(!(At.collisionFilterMask&Dt.collisionFilterGroup&&Dt.collisionFilterMask&At.collisionFilterGroup)||st.distanceTo(at)>At.boundingSphereRadius+Dt.boundingSphereRadius)continue;let Nt=null;At.material&&Dt.material&&(Nt=s.getContactMaterial(At.material,Dt.material)||null),this.currentContactMaterial=Nt||wt||s.defaultContactMaterial;const Vt=this[At.type|Dt.type];if(Vt){let Zt=!1;Zt=At.type<Dt.type?Vt.call(this,At,Dt,st,at,et,nt,mt,yt,At,Dt,Ct):Vt.call(this,Dt,At,at,st,nt,et,yt,mt,At,Dt,Ct),Zt&&Ct&&(s.shapeOverlapKeeper.set(At.id,Dt.id),s.bodyOverlapKeeper.set(mt.id,yt.id))}}}}}sphereSphere(e,i,s,o,c,_,j,et,nt,st,at){if(at)return s.distanceSquared(o)<(e.radius+i.radius)**2;const ct=this.createContactEquation(j,et,e,i,nt,st);o.vsub(s,ct.ni),ct.ni.normalize(),ct.ri.copy(ct.ni),ct.rj.copy(ct.ni),ct.ri.scale(e.radius,ct.ri),ct.rj.scale(-i.radius,ct.rj),ct.ri.vadd(s,ct.ri),ct.ri.vsub(j.position,ct.ri),ct.rj.vadd(o,ct.rj),ct.rj.vsub(et.position,ct.rj),this.result.push(ct),this.createFrictionEquationsFromContact(ct,this.frictionResult)}spherePlane(e,i,s,o,c,_,j,et,nt,st,at){const ct=this.createContactEquation(j,et,e,i,nt,st);if(ct.ni.set(0,0,1),_.vmult(ct.ni,ct.ni),ct.ni.negate(ct.ni),ct.ni.normalize(),ct.ni.scale(e.radius,ct.ri),s.vsub(o,_D),ct.ni.scale(ct.ni.dot(_D),MF),_D.vsub(MF,ct.rj),-_D.dot(ct.ni)<=e.radius){if(at)return!0;const dt=ct.ri,mt=ct.rj;dt.vadd(s,dt),dt.vsub(j.position,dt),mt.vadd(o,mt),mt.vsub(et.position,mt),this.result.push(ct),this.createFrictionEquationsFromContact(ct,this.frictionResult)}}boxBox(e,i,s,o,c,_,j,et,nt,st,at){return e.convexPolyhedronRepresentation.material=e.material,i.convexPolyhedronRepresentation.material=i.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,i.convexPolyhedronRepresentation,s,o,c,_,j,et,e,i,at)}sphereBox(e,i,s,o,c,_,j,et,nt,st,at){const ct=this.v3pool,dt=b6;s.vsub(o,vD),i.getSideNormals(dt,_);const mt=e.radius;let yt=!1;const wt=x6,Ct=E6,bt=S6;let At=null,Pt=0,Dt=0,Nt=0,Vt=null;for(let Pn=0,On=dt.length;Pn!==On&&yt===!1;Pn++){const er=v6;er.copy(dt[Pn]);const Zn=er.length();er.normalize();const yr=vD.dot(er);if(yr<Zn+mt&&yr>0){const lr=y6,ar=A6;lr.copy(dt[(Pn+1)%3]),ar.copy(dt[(Pn+2)%3]);const Mr=lr.length(),xr=ar.length();lr.normalize(),ar.normalize();const qr=vD.dot(lr),Zr=vD.dot(ar);if(qr<Mr&&qr>-Mr&&Zr<xr&&Zr>-xr){const ds=Math.abs(yr-Zn-mt);if((Vt===null||ds<Vt)&&(Vt=ds,Dt=qr,Nt=Zr,At=Zn,wt.copy(er),Ct.copy(lr),bt.copy(ar),Pt++,at))return!0}}}if(Pt){yt=!0;const Pn=this.createContactEquation(j,et,e,i,nt,st);wt.scale(-mt,Pn.ri),Pn.ni.copy(wt),Pn.ni.negate(Pn.ni),wt.scale(At,wt),Ct.scale(Dt,Ct),wt.vadd(Ct,wt),bt.scale(Nt,bt),wt.vadd(bt,Pn.rj),Pn.ri.vadd(s,Pn.ri),Pn.ri.vsub(j.position,Pn.ri),Pn.rj.vadd(o,Pn.rj),Pn.rj.vsub(et.position,Pn.rj),this.result.push(Pn),this.createFrictionEquationsFromContact(Pn,this.frictionResult)}let Zt=ct.get();const an=w6;for(let Pn=0;Pn!==2&&!yt;Pn++)for(let On=0;On!==2&&!yt;On++)for(let er=0;er!==2&&!yt;er++)if(Zt.set(0,0,0),Pn?Zt.vadd(dt[0],Zt):Zt.vsub(dt[0],Zt),On?Zt.vadd(dt[1],Zt):Zt.vsub(dt[1],Zt),er?Zt.vadd(dt[2],Zt):Zt.vsub(dt[2],Zt),o.vadd(Zt,an),an.vsub(s,an),an.lengthSquared()<mt*mt){if(at)return!0;yt=!0;const Zn=this.createContactEquation(j,et,e,i,nt,st);Zn.ri.copy(an),Zn.ri.normalize(),Zn.ni.copy(Zn.ri),Zn.ri.scale(mt,Zn.ri),Zn.rj.copy(Zt),Zn.ri.vadd(s,Zn.ri),Zn.ri.vsub(j.position,Zn.ri),Zn.rj.vadd(o,Zn.rj),Zn.rj.vsub(et.position,Zn.rj),this.result.push(Zn),this.createFrictionEquationsFromContact(Zn,this.frictionResult)}ct.release(Zt),Zt=null;const fn=ct.get(),mn=ct.get(),Sn=ct.get(),An=ct.get(),wn=ct.get(),Mn=dt.length;for(let Pn=0;Pn!==Mn&&!yt;Pn++)for(let On=0;On!==Mn&&!yt;On++)if(Pn%3!=On%3){dt[On].cross(dt[Pn],fn),fn.normalize(),dt[Pn].vadd(dt[On],mn),Sn.copy(s),Sn.vsub(mn,Sn),Sn.vsub(o,Sn);const er=Sn.dot(fn);fn.scale(er,An);let Zn=0;for(;Zn===Pn%3||Zn===On%3;)Zn++;wn.copy(s),wn.vsub(An,wn),wn.vsub(mn,wn),wn.vsub(o,wn);const yr=Math.abs(er),lr=wn.length();if(yr<dt[Zn].length()&&lr<mt){if(at)return!0;yt=!0;const ar=this.createContactEquation(j,et,e,i,nt,st);mn.vadd(An,ar.rj),ar.rj.copy(ar.rj),wn.negate(ar.ni),ar.ni.normalize(),ar.ri.copy(ar.rj),ar.ri.vadd(o,ar.ri),ar.ri.vsub(s,ar.ri),ar.ri.normalize(),ar.ri.scale(mt,ar.ri),ar.ri.vadd(s,ar.ri),ar.ri.vsub(j.position,ar.ri),ar.rj.vadd(o,ar.rj),ar.rj.vsub(et.position,ar.rj),this.result.push(ar),this.createFrictionEquationsFromContact(ar,this.frictionResult)}}ct.release(fn,mn,Sn,An,wn)}planeBox(e,i,s,o,c,_,j,et,nt,st,at){return i.convexPolyhedronRepresentation.material=i.material,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,i.convexPolyhedronRepresentation.id=i.id,this.planeConvex(e,i.convexPolyhedronRepresentation,s,o,c,_,j,et,e,i,at)}convexConvex(e,i,s,o,c,_,j,et,nt,st,at,ct,dt){const mt=j6;if(!(s.distanceTo(o)>e.boundingSphereRadius+i.boundingSphereRadius)&&e.findSeparatingAxis(i,s,c,o,_,mt,ct,dt)){const yt=[],wt=z6;e.clipAgainstHull(s,c,i,o,_,mt,-100,100,yt);let Ct=0;for(let bt=0;bt!==yt.length;bt++){if(at)return!0;const At=this.createContactEquation(j,et,e,i,nt,st),Pt=At.ri,Dt=At.rj;mt.negate(At.ni),yt[bt].normal.negate(wt),wt.scale(yt[bt].depth,wt),yt[bt].point.vadd(wt,Pt),Dt.copy(yt[bt].point),Pt.vsub(s,Pt),Dt.vsub(o,Dt),Pt.vadd(s,Pt),Pt.vsub(j.position,Pt),Dt.vadd(o,Dt),Dt.vsub(et.position,Dt),this.result.push(At),Ct++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(At,this.frictionResult)}this.enableFrictionReduction&&Ct&&this.createFrictionFromAverage(Ct)}}sphereConvex(e,i,s,o,c,_,j,et,nt,st,at){const ct=this.v3pool;s.vsub(o,C6);const dt=i.faceNormals,mt=i.faces,yt=i.vertices,wt=e.radius;let Ct=!1;for(let bt=0;bt!==yt.length;bt++){const At=yt[bt],Pt=P6;_.vmult(At,Pt),o.vadd(Pt,Pt);const Dt=I6;if(Pt.vsub(s,Dt),Dt.lengthSquared()<wt*wt){if(at)return!0;Ct=!0;const Nt=this.createContactEquation(j,et,e,i,nt,st);return Nt.ri.copy(Dt),Nt.ri.normalize(),Nt.ni.copy(Nt.ri),Nt.ri.scale(wt,Nt.ri),Pt.vsub(o,Nt.rj),Nt.ri.vadd(s,Nt.ri),Nt.ri.vsub(j.position,Nt.ri),Nt.rj.vadd(o,Nt.rj),Nt.rj.vsub(et.position,Nt.rj),this.result.push(Nt),void this.createFrictionEquationsFromContact(Nt,this.frictionResult)}}for(let bt=0,At=mt.length;bt!==At&&Ct===!1;bt++){const Pt=dt[bt],Dt=mt[bt],Nt=R6;_.vmult(Pt,Nt);const Vt=D6;_.vmult(yt[Dt[0]],Vt),Vt.vadd(o,Vt);const Zt=k6;Nt.scale(-wt,Zt),s.vadd(Zt,Zt);const an=O6;Zt.vsub(Vt,an);const fn=an.dot(Nt),mn=B6;if(s.vsub(Vt,mn),fn<0&&mn.dot(Nt)>0){const Sn=[];for(let An=0,wn=Dt.length;An!==wn;An++){const Mn=ct.get();_.vmult(yt[Dt[An]],Mn),o.vadd(Mn,Mn),Sn.push(Mn)}if(_6(Sn,Nt,s)){if(at)return!0;Ct=!0;const An=this.createContactEquation(j,et,e,i,nt,st);Nt.scale(-wt,An.ri),Nt.negate(An.ni);const wn=ct.get();Nt.scale(-fn,wn);const Mn=ct.get();Nt.scale(-wt,Mn),s.vsub(o,An.rj),An.rj.vadd(Mn,An.rj),An.rj.vadd(wn,An.rj),An.rj.vadd(o,An.rj),An.rj.vsub(et.position,An.rj),An.ri.vadd(s,An.ri),An.ri.vsub(j.position,An.ri),ct.release(wn),ct.release(Mn),this.result.push(An),this.createFrictionEquationsFromContact(An,this.frictionResult);for(let Pn=0,On=Sn.length;Pn!==On;Pn++)ct.release(Sn[Pn]);return}for(let An=0;An!==Dt.length;An++){const wn=ct.get(),Mn=ct.get();_.vmult(yt[Dt[(An+1)%Dt.length]],wn),_.vmult(yt[Dt[(An+2)%Dt.length]],Mn),o.vadd(wn,wn),o.vadd(Mn,Mn);const Pn=T6;Mn.vsub(wn,Pn);const On=M6;Pn.unit(On);const er=ct.get(),Zn=ct.get();s.vsub(wn,Zn);const yr=Zn.dot(On);On.scale(yr,er),er.vadd(wn,er);const lr=ct.get();if(er.vsub(s,lr),yr>0&&yr*yr<Pn.lengthSquared()&&lr.lengthSquared()<wt*wt){if(at)return!0;const ar=this.createContactEquation(j,et,e,i,nt,st);er.vsub(o,ar.rj),er.vsub(s,ar.ni),ar.ni.normalize(),ar.ni.scale(wt,ar.ri),ar.rj.vadd(o,ar.rj),ar.rj.vsub(et.position,ar.rj),ar.ri.vadd(s,ar.ri),ar.ri.vsub(j.position,ar.ri),this.result.push(ar),this.createFrictionEquationsFromContact(ar,this.frictionResult);for(let Mr=0,xr=Sn.length;Mr!==xr;Mr++)ct.release(Sn[Mr]);return ct.release(wn),ct.release(Mn),ct.release(er),ct.release(lr),void ct.release(Zn)}ct.release(wn),ct.release(Mn),ct.release(er),ct.release(lr),ct.release(Zn)}for(let An=0,wn=Sn.length;An!==wn;An++)ct.release(Sn[An])}}}planeConvex(e,i,s,o,c,_,j,et,nt,st,at){const ct=L6,dt=N6;dt.set(0,0,1),c.vmult(dt,dt);let mt=0;const yt=U6;for(let wt=0;wt!==i.vertices.length;wt++)if(ct.copy(i.vertices[wt]),_.vmult(ct,ct),o.vadd(ct,ct),ct.vsub(s,yt),dt.dot(yt)<=0){if(at)return!0;const Ct=this.createContactEquation(j,et,e,i,nt,st),bt=F6;dt.scale(dt.dot(yt),bt),ct.vsub(bt,bt),bt.vsub(s,Ct.ri),Ct.ni.copy(dt),ct.vsub(o,Ct.rj),Ct.ri.vadd(s,Ct.ri),Ct.ri.vsub(j.position,Ct.ri),Ct.rj.vadd(o,Ct.rj),Ct.rj.vsub(et.position,Ct.rj),this.result.push(Ct),mt++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(Ct,this.frictionResult)}this.enableFrictionReduction&&mt&&this.createFrictionFromAverage(mt)}boxConvex(e,i,s,o,c,_,j,et,nt,st,at){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,i,s,o,c,_,j,et,e,i,at)}sphereHeightfield(e,i,s,o,c,_,j,et,nt,st,at){const ct=i.data,dt=e.radius,mt=i.elementSize,yt=Z6,wt=J6;Xl.pointToLocalFrame(o,_,s,wt);let Ct=Math.floor((wt.x-dt)/mt)-1,bt=Math.ceil((wt.x+dt)/mt)+1,At=Math.floor((wt.y-dt)/mt)-1,Pt=Math.ceil((wt.y+dt)/mt)+1;if(bt<0||Pt<0||Ct>ct.length||At>ct[0].length)return;Ct<0&&(Ct=0),bt<0&&(bt=0),At<0&&(At=0),Pt<0&&(Pt=0),Ct>=ct.length&&(Ct=ct.length-1),bt>=ct.length&&(bt=ct.length-1),Pt>=ct[0].length&&(Pt=ct[0].length-1),At>=ct[0].length&&(At=ct[0].length-1);const Dt=[];i.getRectMinMax(Ct,At,bt,Pt,Dt);const Nt=Dt[0],Vt=Dt[1];if(wt.z-dt>Vt||wt.z+dt<Nt)return;const Zt=this.result;for(let an=Ct;an<bt;an++)for(let fn=At;fn<Pt;fn++){const mn=Zt.length;let Sn=!1;if(i.getConvexTrianglePillar(an,fn,!1),Xl.pointToWorldFrame(o,_,i.pillarOffset,yt),s.distanceTo(yt)<i.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(Sn=this.sphereConvex(e,i.pillarConvex,s,yt,c,_,j,et,e,i,at)),at&&Sn||(i.getConvexTrianglePillar(an,fn,!0),Xl.pointToWorldFrame(o,_,i.pillarOffset,yt),s.distanceTo(yt)<i.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(Sn=this.sphereConvex(e,i.pillarConvex,s,yt,c,_,j,et,e,i,at)),at&&Sn))return!0;if(Zt.length-mn>2)return}}boxHeightfield(e,i,s,o,c,_,j,et,nt,st,at){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,i,s,o,c,_,j,et,e,i,at)}convexHeightfield(e,i,s,o,c,_,j,et,nt,st,at){const ct=i.data,dt=i.elementSize,mt=e.boundingSphereRadius,yt=$6,wt=K6,Ct=Y6;Xl.pointToLocalFrame(o,_,s,Ct);let bt=Math.floor((Ct.x-mt)/dt)-1,At=Math.ceil((Ct.x+mt)/dt)+1,Pt=Math.floor((Ct.y-mt)/dt)-1,Dt=Math.ceil((Ct.y+mt)/dt)+1;if(At<0||Dt<0||bt>ct.length||Pt>ct[0].length)return;bt<0&&(bt=0),At<0&&(At=0),Pt<0&&(Pt=0),Dt<0&&(Dt=0),bt>=ct.length&&(bt=ct.length-1),At>=ct.length&&(At=ct.length-1),Dt>=ct[0].length&&(Dt=ct[0].length-1),Pt>=ct[0].length&&(Pt=ct[0].length-1);const Nt=[];i.getRectMinMax(bt,Pt,At,Dt,Nt);const Vt=Nt[0],Zt=Nt[1];if(!(Ct.z-mt>Zt||Ct.z+mt<Vt))for(let an=bt;an<At;an++)for(let fn=Pt;fn<Dt;fn++){let mn=!1;if(i.getConvexTrianglePillar(an,fn,!1),Xl.pointToWorldFrame(o,_,i.pillarOffset,yt),s.distanceTo(yt)<i.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(mn=this.convexConvex(e,i.pillarConvex,s,yt,c,_,j,et,null,null,at,wt,null)),at&&mn||(i.getConvexTrianglePillar(an,fn,!0),Xl.pointToWorldFrame(o,_,i.pillarOffset,yt),s.distanceTo(yt)<i.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(mn=this.convexConvex(e,i.pillarConvex,s,yt,c,_,j,et,null,null,at,wt,null)),at&&mn))return!0}}sphereParticle(e,i,s,o,c,_,j,et,nt,st,at){const ct=Q6;if(ct.set(0,0,1),o.vsub(s,ct),ct.lengthSquared()<=e.radius*e.radius){if(at)return!0;const dt=this.createContactEquation(et,j,i,e,nt,st);ct.normalize(),dt.rj.copy(ct),dt.rj.scale(e.radius,dt.rj),dt.ni.copy(ct),dt.ni.negate(dt.ni),dt.ri.set(0,0,0),this.result.push(dt),this.createFrictionEquationsFromContact(dt,this.frictionResult)}}planeParticle(e,i,s,o,c,_,j,et,nt,st,at){const ct=V6;ct.set(0,0,1),j.quaternion.vmult(ct,ct);const dt=G6;if(o.vsub(j.position,dt),ct.dot(dt)<=0){if(at)return!0;const mt=this.createContactEquation(et,j,i,e,nt,st);mt.ni.copy(ct),mt.ni.negate(mt.ni),mt.ri.set(0,0,0);const yt=H6;ct.scale(ct.dot(o),yt),o.vsub(yt,yt),mt.rj.copy(yt),this.result.push(mt),this.createFrictionEquationsFromContact(mt,this.frictionResult)}}boxParticle(e,i,s,o,c,_,j,et,nt,st,at){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,i,s,o,c,_,j,et,e,i,at)}convexParticle(e,i,s,o,c,_,j,et,nt,st,at){let ct=-1;const dt=q6,mt=X6;let yt=null;const wt=W6;if(wt.copy(o),wt.vsub(s,wt),c.conjugate(IF),IF.vmult(wt,wt),e.pointIsInside(wt)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(s,c),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(c);for(let Ct=0,bt=e.faces.length;Ct!==bt;Ct++){const At=[e.worldVertices[e.faces[Ct][0]]],Pt=e.worldFaceNormals[Ct];o.vsub(At[0],PF);const Dt=-Pt.dot(PF);if(yt===null||Math.abs(Dt)<Math.abs(yt)){if(at)return!0;yt=Dt,ct=Ct,dt.copy(Pt)}}if(ct!==-1){const Ct=this.createContactEquation(et,j,i,e,nt,st);dt.scale(yt,mt),mt.vadd(o,mt),mt.vsub(s,mt),Ct.rj.copy(mt),dt.negate(Ct.ni),Ct.ri.set(0,0,0);const bt=Ct.ri,At=Ct.rj;bt.vadd(o,bt),bt.vsub(et.position,bt),At.vadd(s,At),At.vsub(j.position,At),this.result.push(Ct),this.createFrictionEquationsFromContact(Ct,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,i,s,o,c,_,j,et,nt,st,at){return this.convexHeightfield(i,e,o,s,_,c,et,j,nt,st,at)}particleCylinder(e,i,s,o,c,_,j,et,nt,st,at){return this.convexParticle(i,e,o,s,_,c,et,j,nt,st,at)}sphereTrimesh(e,i,s,o,c,_,j,et,nt,st,at){const ct=r6,dt=i6,mt=s6,yt=o6,wt=a6,Ct=l6,bt=d6,At=n6,Pt=e6,Dt=p6;Xl.pointToLocalFrame(o,_,s,wt);const Nt=e.radius;bt.lowerBound.set(wt.x-Nt,wt.y-Nt,wt.z-Nt),bt.upperBound.set(wt.x+Nt,wt.y+Nt,wt.z+Nt),i.getTrianglesInAABB(bt,Dt);const Vt=t6,Zt=e.radius*e.radius;for(let An=0;An<Dt.length;An++)for(let wn=0;wn<3;wn++)if(i.getVertex(i.indices[3*Dt[An]+wn],Vt),Vt.vsub(wt,Pt),Pt.lengthSquared()<=Zt){if(At.copy(Vt),Xl.pointToWorldFrame(o,_,At,Vt),Vt.vsub(s,Pt),at)return!0;let Mn=this.createContactEquation(j,et,e,i,nt,st);Mn.ni.copy(Pt),Mn.ni.normalize(),Mn.ri.copy(Mn.ni),Mn.ri.scale(e.radius,Mn.ri),Mn.ri.vadd(s,Mn.ri),Mn.ri.vsub(j.position,Mn.ri),Mn.rj.copy(Vt),Mn.rj.vsub(et.position,Mn.rj),this.result.push(Mn),this.createFrictionEquationsFromContact(Mn,this.frictionResult)}for(let An=0;An<Dt.length;An++)for(let wn=0;wn<3;wn++){i.getVertex(i.indices[3*Dt[An]+wn],ct),i.getVertex(i.indices[3*Dt[An]+(wn+1)%3],dt),dt.vsub(ct,mt),wt.vsub(dt,Ct);const Mn=Ct.dot(mt);wt.vsub(ct,Ct);let Pn=Ct.dot(mt);if(Pn>0&&Mn<0&&(wt.vsub(ct,Ct),yt.copy(mt),yt.normalize(),Pn=Ct.dot(yt),yt.scale(Pn,Ct),Ct.vadd(ct,Ct),Ct.distanceTo(wt)<e.radius)){if(at)return!0;const On=this.createContactEquation(j,et,e,i,nt,st);Ct.vsub(wt,On.ni),On.ni.normalize(),On.ni.scale(e.radius,On.ri),On.ri.vadd(s,On.ri),On.ri.vsub(j.position,On.ri),Xl.pointToWorldFrame(o,_,Ct,Ct),Ct.vsub(et.position,On.rj),Xl.vectorToWorldFrame(_,On.ni,On.ni),Xl.vectorToWorldFrame(_,On.ri,On.ri),this.result.push(On),this.createFrictionEquationsFromContact(On,this.frictionResult)}}const an=c6,fn=u6,mn=h6,Sn=ZG;for(let An=0,wn=Dt.length;An!==wn;An++){i.getTriangleVertices(Dt[An],an,fn,mn),i.getNormal(Dt[An],Sn),wt.vsub(an,Ct);let Mn=Ct.dot(Sn);if(Sn.scale(Mn,Ct),wt.vsub(Ct,Ct),Mn=Ct.distanceTo(wt),$p.pointInTriangle(Ct,an,fn,mn)&&Mn<e.radius){if(at)return!0;let Pn=this.createContactEquation(j,et,e,i,nt,st);Ct.vsub(wt,Pn.ni),Pn.ni.normalize(),Pn.ni.scale(e.radius,Pn.ri),Pn.ri.vadd(s,Pn.ri),Pn.ri.vsub(j.position,Pn.ri),Xl.pointToWorldFrame(o,_,Ct,Ct),Ct.vsub(et.position,Pn.rj),Xl.vectorToWorldFrame(_,Pn.ni,Pn.ni),Xl.vectorToWorldFrame(_,Pn.ri,Pn.ri),this.result.push(Pn),this.createFrictionEquationsFromContact(Pn,this.frictionResult)}}Dt.length=0}planeTrimesh(e,i,s,o,c,_,j,et,nt,st,at){const ct=new pn,dt=$G;dt.set(0,0,1),c.vmult(dt,dt);for(let mt=0;mt<i.vertices.length/3;mt++){i.getVertex(mt,ct);const yt=new pn;yt.copy(ct),Xl.pointToWorldFrame(o,_,yt,ct);const wt=KG;if(ct.vsub(s,wt),dt.dot(wt)<=0){if(at)return!0;const Ct=this.createContactEquation(j,et,e,i,nt,st);Ct.ni.copy(dt);const bt=JG;dt.scale(wt.dot(dt),bt),ct.vsub(bt,bt),Ct.ri.copy(bt),Ct.ri.vsub(j.position,Ct.ri),Ct.rj.copy(ct),Ct.rj.vsub(et.position,Ct.rj),this.result.push(Ct),this.createFrictionEquationsFromContact(Ct,this.frictionResult)}}}}const bS=new pn,RT=new pn,DT=new pn,WG=new pn,qG=new pn,XG=new ip,YG=new ip,$G=new pn,KG=new pn,JG=new pn,ZG=new pn,e6=new pn;new pn;const t6=new pn,n6=new pn,r6=new pn,i6=new pn,s6=new pn,o6=new pn,a6=new pn,l6=new pn,c6=new pn,u6=new pn,h6=new pn,d6=new Yu,p6=[],_D=new pn,MF=new pn,f6=new pn,m6=new pn,g6=new pn;function _6(h,e,i){let s=null;const o=h.length;for(let c=0;c!==o;c++){const _=h[c],j=f6;h[(c+1)%o].vsub(_,j);const et=m6;j.cross(e,et);const nt=g6;i.vsub(_,nt);const st=et.dot(nt);if(!(s===null||st>0&&s===!0||st<=0&&s===!1))return!1;s===null&&(s=st>0)}return!0}const vD=new pn,v6=new pn,y6=new pn,A6=new pn,b6=[new pn,new pn,new pn,new pn,new pn,new pn],w6=new pn,x6=new pn,E6=new pn,S6=new pn,C6=new pn,T6=new pn,M6=new pn,I6=new pn,P6=new pn,R6=new pn,D6=new pn,k6=new pn,O6=new pn,B6=new pn;new pn,new pn;const L6=new pn,N6=new pn,U6=new pn,F6=new pn,j6=new pn,z6=new pn,V6=new pn,G6=new pn,H6=new pn,Q6=new pn,IF=new ip,W6=new pn;new pn;const q6=new pn,PF=new pn,X6=new pn,Y6=new pn,$6=new pn,K6=[0],J6=new pn,Z6=new pn;class RF{constructor(){this.current=[],this.previous=[]}getKey(e,i){if(i<e){const s=i;i=e,e=s}return e<<16|i}set(e,i){const s=this.getKey(e,i),o=this.current;let c=0;for(;s>o[c];)c++;if(s!==o[c]){for(let _=o.length-1;_>=c;_--)o[_+1]=o[_];o[c]=s}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,i){const s=this.current,o=this.previous,c=s.length,_=o.length;let j=0;for(let et=0;et<c;et++){let nt=!1;const st=s[et];for(;st>o[j];)j++;nt=st===o[j],nt||DF(e,st)}j=0;for(let et=0;et<_;et++){let nt=!1;const st=o[et];for(;st>s[j];)j++;nt=s[j]===st,nt||DF(i,st)}}}function DF(h,e){h.push((4294901760&e)>>16,65535&e)}const xL=(h,e)=>h<e?`${h}-${e}`:`${e}-${h}`;class eH{constructor(){this.data={keys:[]}}get(e,i){const s=xL(e,i);return this.data[s]}set(e,i,s){const o=xL(e,i);this.get(e,i)||this.data.keys.push(o),this.data[o]=s}delete(e,i){const s=xL(e,i),o=this.data.keys.indexOf(s);o!==-1&&this.data.keys.splice(o,1),delete this.data[s]}reset(){const e=this.data,i=e.keys;for(;i.length>0;)delete e[i.pop()]}}class tH extends rF{constructor(e){e===void 0&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0&&e.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new pn,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=e.broadphase!==void 0?e.broadphase:new PV,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new fG,this.constraints=[],this.narrowphase=new QG(this),this.collisionMatrix=new nF,this.collisionMatrixPrevious=new nF,this.bodyOverlapKeeper=new RF,this.shapeOverlapKeeper=new RF,this.contactmaterials=[],this.contactMaterialTable=new eH,this.defaultMaterial=new pD("default"),this.defaultContactMaterial=new dD(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,i){return this.contactMaterialTable.get(e.id,i.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const i=this.constraints.indexOf(e);i!==-1&&this.constraints.splice(i,1)}rayTest(e,i,s){s instanceof oD?this.raycastClosest(e,i,{skipBackfaces:!0},s):this.raycastAll(e,i,{skipBackfaces:!0},s)}raycastAll(e,i,s,o){return s===void 0&&(s={}),s.mode=$p.ALL,s.from=e,s.to=i,s.callback=o,EL.intersectWorld(this,s)}raycastAny(e,i,s,o){return s===void 0&&(s={}),s.mode=$p.ANY,s.from=e,s.to=i,s.result=o,EL.intersectWorld(this,s)}raycastClosest(e,i,s,o){return s===void 0&&(s={}),s.mode=$p.CLOSEST,s.from=e,s.to=i,s.result=o,EL.intersectWorld(this,s)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof bs&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const i=this.bodies.length-1,s=this.bodies,o=s.indexOf(e);if(o!==-1){s.splice(o,1);for(let c=0;c!==s.length;c++)s[c].index=c;this.collisionMatrix.setNumObjects(i),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const i=this.bodies;for(let s=0;s<i.length;s++){const o=i[s].shapes;for(let c=0;c<o.length;c++){const _=o[c];if(_.id===e)return _}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const i=this.contactmaterials.indexOf(e);i!==-1&&(this.contactmaterials.splice(i,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,i){e===void 0&&(e=1/60),i===void 0&&(i=10);const s=hm.now()/1e3;if(this.lastCallTime){const o=s-this.lastCallTime;this.step(e,o,i)}else this.step(e,void 0,i);this.lastCallTime=s}step(e,i,s){if(s===void 0&&(s=10),i===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=i;const o=hm.now();let c=0;for(;this.accumulator>=e&&c<s&&(this.internalStep(e),this.accumulator-=e,c++,!(hm.now()-o>1e3*e)););this.accumulator=this.accumulator%e;const _=this.accumulator/e;for(let j=0;j!==this.bodies.length;j++){const et=this.bodies[j];et.previousPosition.lerp(et.position,_,et.interpolatedPosition),et.previousQuaternion.slerp(et.quaternion,_,et.interpolatedQuaternion),et.previousQuaternion.normalize()}this.time+=i}}internalStep(e){this.dt=e;const i=this.contacts,s=oH,o=aH,c=this.bodies.length,_=this.bodies,j=this.solver,et=this.gravity,nt=this.doProfiling,st=this.profile,at=bs.DYNAMIC;let ct=-1/0;const dt=this.constraints,mt=sH;et.length();const yt=et.x,wt=et.y,Ct=et.z;let bt=0;for(nt&&(ct=hm.now()),bt=0;bt!==c;bt++){const Sn=_[bt];if(Sn.type===at){const An=Sn.force,wn=Sn.mass;An.x+=wn*yt,An.y+=wn*wt,An.z+=wn*Ct}}for(let Sn=0,An=this.subsystems.length;Sn!==An;Sn++)this.subsystems[Sn].update();nt&&(ct=hm.now()),s.length=0,o.length=0,this.broadphase.collisionPairs(this,s,o),nt&&(st.broadphase=hm.now()-ct);let At=dt.length;for(bt=0;bt!==At;bt++){const Sn=dt[bt];if(!Sn.collideConnected)for(let An=s.length-1;An>=0;An-=1)(Sn.bodyA===s[An]&&Sn.bodyB===o[An]||Sn.bodyB===s[An]&&Sn.bodyA===o[An])&&(s.splice(An,1),o.splice(An,1))}this.collisionMatrixTick(),nt&&(ct=hm.now());const Pt=iH,Dt=i.length;for(bt=0;bt!==Dt;bt++)Pt.push(i[bt]);i.length=0;const Nt=this.frictionEquations.length;for(bt=0;bt!==Nt;bt++)mt.push(this.frictionEquations[bt]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(s,o,this,i,Pt,this.frictionEquations,mt),nt&&(st.narrowphase=hm.now()-ct),nt&&(ct=hm.now()),bt=0;bt<this.frictionEquations.length;bt++)j.addEquation(this.frictionEquations[bt]);const Vt=i.length;for(let Sn=0;Sn!==Vt;Sn++){const An=i[Sn],wn=An.bi,Mn=An.bj,Pn=An.si,On=An.sj;let er;er=wn.material&&Mn.material&&this.getContactMaterial(wn.material,Mn.material)||this.defaultContactMaterial,er.friction,wn.material&&Mn.material&&(wn.material.friction>=0&&Mn.material.friction>=0&&(wn.material.friction,Mn.material.friction),wn.material.restitution>=0&&Mn.material.restitution>=0&&(An.restitution=wn.material.restitution*Mn.material.restitution)),j.addEquation(An),wn.allowSleep&&wn.type===bs.DYNAMIC&&wn.sleepState===bs.SLEEPING&&Mn.sleepState===bs.AWAKE&&Mn.type!==bs.STATIC&&Mn.velocity.lengthSquared()+Mn.angularVelocity.lengthSquared()>=2*Mn.sleepSpeedLimit**2&&(wn.wakeUpAfterNarrowphase=!0),Mn.allowSleep&&Mn.type===bs.DYNAMIC&&Mn.sleepState===bs.SLEEPING&&wn.sleepState===bs.AWAKE&&wn.type!==bs.STATIC&&wn.velocity.lengthSquared()+wn.angularVelocity.lengthSquared()>=2*wn.sleepSpeedLimit**2&&(Mn.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(wn,Mn,!0),this.collisionMatrixPrevious.get(wn,Mn)||(WI.body=Mn,WI.contact=An,wn.dispatchEvent(WI),WI.body=wn,Mn.dispatchEvent(WI)),this.bodyOverlapKeeper.set(wn.id,Mn.id),this.shapeOverlapKeeper.set(Pn.id,On.id)}for(this.emitContactEvents(),nt&&(st.makeContactConstraints=hm.now()-ct,ct=hm.now()),bt=0;bt!==c;bt++){const Sn=_[bt];Sn.wakeUpAfterNarrowphase&&(Sn.wakeUp(),Sn.wakeUpAfterNarrowphase=!1)}for(At=dt.length,bt=0;bt!==At;bt++){const Sn=dt[bt];Sn.update();for(let An=0,wn=Sn.equations.length;An!==wn;An++){const Mn=Sn.equations[An];j.addEquation(Mn)}}j.solve(e,this),nt&&(st.solve=hm.now()-ct),j.removeAllEquations();const Zt=Math.pow;for(bt=0;bt!==c;bt++){const Sn=_[bt];if(Sn.type&at){const An=Zt(1-Sn.linearDamping,e),wn=Sn.velocity;wn.scale(An,wn);const Mn=Sn.angularVelocity;if(Mn){const Pn=Zt(1-Sn.angularDamping,e);Mn.scale(Pn,Mn)}}}this.dispatchEvent(rH),nt&&(ct=hm.now());const an=this.stepnumber%(this.quatNormalizeSkip+1)==0,fn=this.quatNormalizeFast;for(bt=0;bt!==c;bt++)_[bt].integrate(e,an,fn);this.clearForces(),this.broadphase.dirty=!0,nt&&(st.integrate=hm.now()-ct),this.stepnumber+=1,this.dispatchEvent(nH);let mn=!0;if(this.allowSleep)for(mn=!1,bt=0;bt!==c;bt++){const Sn=_[bt];Sn.sleepTick(this.time),Sn.sleepState!==bs.SLEEPING&&(mn=!0)}this.hasActiveBodies=mn}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),i=this.hasAnyEventListener("endContact");if((e||i)&&this.bodyOverlapKeeper.getDiff(nx,rx),e){for(let c=0,_=nx.length;c<_;c+=2)qI.bodyA=this.getBodyById(nx[c]),qI.bodyB=this.getBodyById(nx[c+1]),this.dispatchEvent(qI);qI.bodyA=qI.bodyB=null}if(i){for(let c=0,_=rx.length;c<_;c+=2)XI.bodyA=this.getBodyById(rx[c]),XI.bodyB=this.getBodyById(rx[c+1]),this.dispatchEvent(XI);XI.bodyA=XI.bodyB=null}nx.length=rx.length=0;const s=this.hasAnyEventListener("beginShapeContact"),o=this.hasAnyEventListener("endShapeContact");if((s||o)&&this.shapeOverlapKeeper.getDiff(nx,rx),s){for(let c=0,_=nx.length;c<_;c+=2){const j=this.getShapeById(nx[c]),et=this.getShapeById(nx[c+1]);ix.shapeA=j,ix.shapeB=et,j&&(ix.bodyA=j.body),et&&(ix.bodyB=et.body),this.dispatchEvent(ix)}ix.bodyA=ix.bodyB=ix.shapeA=ix.shapeB=null}if(o){for(let c=0,_=rx.length;c<_;c+=2){const j=this.getShapeById(rx[c]),et=this.getShapeById(rx[c+1]);sx.shapeA=j,sx.shapeB=et,j&&(sx.bodyA=j.body),et&&(sx.bodyB=et.body),this.dispatchEvent(sx)}sx.bodyA=sx.bodyB=sx.shapeA=sx.shapeB=null}}clearForces(){const e=this.bodies,i=e.length;for(let s=0;s!==i;s++){const o=e[s];o.force,o.torque,o.force.set(0,0,0),o.torque.set(0,0,0)}}}new Yu;const EL=new $p,hm=globalThis.performance||{};if(!hm.now){let h=Date.now();hm.timing&&hm.timing.navigationStart&&(h=hm.timing.navigationStart),hm.now=()=>Date.now()-h}new pn;const nH={type:"postStep"},rH={type:"preStep"},WI={type:bs.COLLIDE_EVENT_NAME,body:null,contact:null},iH=[],sH=[],oH=[],aH=[],nx=[],rx=[],qI={type:"beginContact",bodyA:null,bodyB:null},XI={type:"endContact",bodyA:null,bodyB:null},ix={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},sx={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var lH=function(){var h,e,i,s,o=0,c=new g.Pa4;function _(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new st,this.unassigned=new st,this.vertices=[]}function j(){this.normal=new g.Pa4,this.midpoint=new g.Pa4,this.area=0,this.constant=0,this.outside=null,this.mark=o,this.edge=null}function et(at,ct){this.vertex=at,this.prev=null,this.next=null,this.twin=null,this.face=ct}function nt(at,ct){this.point=at,this.index=ct,this.prev=null,this.next=null,this.face=null}function st(){this.head=null,this.tail=null}return Object.assign(_.prototype,{toJSON:function(){const at=this.faces.map(wt=>wt.toArray()),ct=Array.from(new Set(at.flat())).sort(),dt=[];for(let wt=0;wt<ct.length;wt++)dt.push(this.vertices[ct[wt]].point.x,this.vertices[ct[wt]].point.y,this.vertices[ct[wt]].point.z);const mt=new Map;for(let wt=0;wt<ct.length;wt++)mt.set(ct[wt],wt);const yt=[];for(let wt=0;wt<at.length;wt++)yt.push([mt.get(at[wt][0]),mt.get(at[wt][1]),mt.get(at[wt][2])]);return[dt,yt]},setFromPoints:function(at){Array.isArray(at)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),at.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var ct=0,dt=at.length;ct<dt;ct++)this.vertices.push(new nt(at[ct],ct));return this.compute(),this},setFromObject:function(at){var ct=[];return at.updateMatrixWorld(!0),at.traverse(function(dt){var mt,yt,wt,Ct=dt.geometry;if(Ct!==void 0&&(Ct.isGeometry&&(Ct=Ct.toBufferGeometry?Ct.toBufferGeometry():new BufferGeometry().fromGeometry(Ct)),Ct.isBufferGeometry)){var bt=Ct.attributes.position;if(bt!==void 0)for(mt=0,yt=bt.count;mt<yt;mt++)(wt=new g.Pa4).fromBufferAttribute(bt,mt).applyMatrix4(dt.matrixWorld),ct.push(wt)}}),this.setFromPoints(ct)},containsPoint:function(at){for(var ct=this.faces,dt=0,mt=ct.length;dt<mt;dt++)if(ct[dt].distanceToPoint(at)>this.tolerance)return!1;return!0},intersectRay:function(at,ct){for(var dt=this.faces,mt=-1/0,yt=1/0,wt=0,Ct=dt.length;wt<Ct;wt++){var bt=dt[wt],At=bt.distanceToPoint(at.origin),Pt=bt.normal.dot(at.direction);if(At>0&&Pt>=0)return null;var Dt=Pt!==0?-At/Pt:0;if(!(Dt<=0)&&(Pt>0?yt=Math.min(Dt,yt):mt=Math.max(Dt,mt),mt>yt))return null}return mt!==-1/0?at.at(mt,ct):at.at(yt,ct),ct},intersectsRay:function(at){return this.intersectRay(at,c)!==null},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(at,ct){return at.face=ct,ct.outside===null?this.assigned.append(at):this.assigned.insertBefore(ct.outside,at),ct.outside=at,this},removeVertexFromFace:function(at,ct){return at===ct.outside&&(at.next!==null&&at.next.face===ct?ct.outside=at.next:ct.outside=null),this.assigned.remove(at),this},removeAllVerticesFromFace:function(at){if(at.outside!==null){for(var ct=at.outside,dt=at.outside;dt.next!==null&&dt.next.face===at;)dt=dt.next;return this.assigned.removeSubList(ct,dt),ct.prev=dt.next=null,at.outside=null,ct}},deleteFaceVertices:function(at,ct){var dt=this.removeAllVerticesFromFace(at);if(dt!==void 0)if(ct===void 0)this.unassigned.appendChain(dt);else{var mt=dt;do{var yt=mt.next;ct.distanceToPoint(mt.point)>this.tolerance?this.addVertexToFace(mt,ct):this.unassigned.append(mt),mt=yt}while(mt!==null)}return this},resolveUnassignedPoints:function(at){if(this.unassigned.isEmpty()===!1){var ct=this.unassigned.first();do{for(var dt=ct.next,mt=this.tolerance,yt=null,wt=0;wt<at.length;wt++){var Ct=at[wt];if(Ct.mark===o){var bt=Ct.distanceToPoint(ct.point);if(bt>mt&&(mt=bt,yt=Ct),mt>1e3*this.tolerance)break}}yt!==null&&this.addVertexToFace(ct,yt),ct=dt}while(ct!==null)}return this},computeExtremes:function(){var at,ct,dt,mt=new g.Pa4,yt=new g.Pa4,wt=[],Ct=[];for(at=0;at<3;at++)wt[at]=Ct[at]=this.vertices[0];for(mt.copy(this.vertices[0].point),yt.copy(this.vertices[0].point),at=0,ct=this.vertices.length;at<ct;at++){var bt=this.vertices[at],At=bt.point;for(dt=0;dt<3;dt++)At.getComponent(dt)<mt.getComponent(dt)&&(mt.setComponent(dt,At.getComponent(dt)),wt[dt]=bt);for(dt=0;dt<3;dt++)At.getComponent(dt)>yt.getComponent(dt)&&(yt.setComponent(dt,At.getComponent(dt)),Ct[dt]=bt)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(mt.x),Math.abs(yt.x))+Math.max(Math.abs(mt.y),Math.abs(yt.y))+Math.max(Math.abs(mt.z),Math.abs(yt.z))),{min:wt,max:Ct}},computeInitialHull:function(){h===void 0&&(h=new g.Zzh,e=new g.JOQ,i=new g.Pa4);var at,ct,dt,mt,yt,wt,Ct,bt,At,Pt=this.vertices,Dt=this.computeExtremes(),Nt=Dt.min,Vt=Dt.max,Zt=0,an=0;for(wt=0;wt<3;wt++)(At=Vt[wt].point.getComponent(wt)-Nt[wt].point.getComponent(wt))>Zt&&(Zt=At,an=wt);for(ct=Nt[an],dt=Vt[an],Zt=0,h.set(ct.point,dt.point),wt=0,Ct=this.vertices.length;wt<Ct;wt++)(at=Pt[wt])!==ct&&at!==dt&&(h.closestPointToPoint(at.point,!0,i),(At=i.distanceToSquared(at.point))>Zt&&(Zt=At,mt=at));for(Zt=-1,e.setFromCoplanarPoints(ct.point,dt.point,mt.point),wt=0,Ct=this.vertices.length;wt<Ct;wt++)(at=Pt[wt])!==ct&&at!==dt&&at!==mt&&(At=Math.abs(e.distanceToPoint(at.point)))>Zt&&(Zt=At,yt=at);var fn=[];if(e.distanceToPoint(yt.point)<0)for(fn.push(j.create(ct,dt,mt),j.create(yt,dt,ct),j.create(yt,mt,dt),j.create(yt,ct,mt)),wt=0;wt<3;wt++)bt=(wt+1)%3,fn[wt+1].getEdge(2).setTwin(fn[0].getEdge(bt)),fn[wt+1].getEdge(1).setTwin(fn[bt+1].getEdge(0));else for(fn.push(j.create(ct,mt,dt),j.create(yt,ct,dt),j.create(yt,dt,mt),j.create(yt,mt,ct)),wt=0;wt<3;wt++)bt=(wt+1)%3,fn[wt+1].getEdge(2).setTwin(fn[0].getEdge((3-wt)%3)),fn[wt+1].getEdge(0).setTwin(fn[bt+1].getEdge(1));for(wt=0;wt<4;wt++)this.faces.push(fn[wt]);for(wt=0,Ct=Pt.length;wt<Ct;wt++)if((at=Pt[wt])!==ct&&at!==dt&&at!==mt&&at!==yt){Zt=this.tolerance;var mn=null;for(bt=0;bt<4;bt++)(At=this.faces[bt].distanceToPoint(at.point))>Zt&&(Zt=At,mn=this.faces[bt]);mn!==null&&this.addVertexToFace(at,mn)}return this},reindexFaces:function(){for(var at=[],ct=0;ct<this.faces.length;ct++){var dt=this.faces[ct];dt.mark===o&&at.push(dt)}return this.faces=at,this},nextVertexToAdd:function(){if(this.assigned.isEmpty()===!1){var at,ct=0,dt=this.assigned.first().face,mt=dt.outside;do{var yt=dt.distanceToPoint(mt.point);yt>ct&&(ct=yt,at=mt),mt=mt.next}while(mt!==null&&mt.face===dt);return at}},computeHorizon:function(at,ct,dt,mt){var yt;this.deleteFaceVertices(dt),dt.mark=1,yt=ct===null?ct=dt.getEdge(0):ct.next;do{var wt=yt.twin,Ct=wt.face;Ct.mark===o&&(Ct.distanceToPoint(at)>this.tolerance?this.computeHorizon(at,wt,Ct,mt):mt.push(yt)),yt=yt.next}while(yt!==ct);return this},addAdjoiningFace:function(at,ct){var dt=j.create(at,ct.tail(),ct.head());return this.faces.push(dt),dt.getEdge(-1).setTwin(ct.twin),dt.getEdge(0)},addNewFaces:function(at,ct){this.newFaces=[];for(var dt=null,mt=null,yt=0;yt<ct.length;yt++){var wt=ct[yt],Ct=this.addAdjoiningFace(at,wt);dt===null?dt=Ct:Ct.next.setTwin(mt),this.newFaces.push(Ct.face),mt=Ct}return dt.next.setTwin(mt),this},addVertexToHull:function(at){var ct=[];return this.unassigned.clear(),this.removeVertexFromFace(at,at.face),this.computeHorizon(at.point,null,at.face,ct),this.addNewFaces(at,ct),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var at;for(this.computeInitialHull();(at=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(at);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(j,{create:function(at,ct,dt){var mt=new j,yt=new et(at,mt),wt=new et(ct,mt),Ct=new et(dt,mt);return yt.next=Ct.prev=wt,wt.next=yt.prev=Ct,Ct.next=wt.prev=yt,mt.edge=yt,mt.compute()}}),Object.assign(j.prototype,{toArray:function(){const at=[];let ct=this.edge;do at.push(ct.head().index),ct=ct.next;while(ct!==this.edge);return at},getEdge:function(at){for(var ct=this.edge;at>0;)ct=ct.next,at--;for(;at<0;)ct=ct.prev,at++;return ct},compute:function(){s===void 0&&(s=new g.CJI);var at=this.edge.tail(),ct=this.edge.head(),dt=this.edge.next.head();return s.set(at.point,ct.point,dt.point),s.getNormal(this.normal),s.getMidpoint(this.midpoint),this.area=s.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(at){return this.normal.dot(at)-this.constant}}),Object.assign(et.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var at=this.head(),ct=this.tail();return ct!==null?ct.point.distanceTo(at.point):-1},lengthSquared:function(){var at=this.head(),ct=this.tail();return ct!==null?ct.point.distanceToSquared(at.point):-1},setTwin:function(at){return this.twin=at,at.twin=this,this}}),Object.assign(st.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(at,ct){return ct.prev=at.prev,ct.next=at,ct.prev===null?this.head=ct:ct.prev.next=ct,at.prev=ct,this},insertAfter:function(at,ct){return ct.prev=at,ct.next=at.next,ct.next===null?this.tail=ct:ct.next.prev=ct,at.next=ct,this},append:function(at){return this.head===null?this.head=at:this.tail.next=at,at.prev=this.tail,at.next=null,this.tail=at,this},appendChain:function(at){for(this.head===null?this.head=at:this.tail.next=at,at.prev=this.tail;at.next!==null;)at=at.next;return this.tail=at,this},remove:function(at){return at.prev===null?this.head=at.next:at.prev.next=at.next,at.next===null?this.tail=at.prev:at.next.prev=at.prev,this},removeSubList:function(at,ct){return at.prev===null?this.head=ct.next:at.prev.next=ct.next,ct.next===null?this.tail=at.prev:ct.next.prev=at.prev,this},isEmpty:function(){return this.head===null}}),_}();const cH=new g.Pa4,yD=new g.Pa4,uH=new g._fP;function AD(h){const e=function(o){const c=[];return o.traverse(function(_){_.isMesh&&c.push(_)}),c}(h);if(e.length===0)return null;if(e.length===1)return kF(e[0]);let i;const s=[];for(;i=e.pop();)s.push(hH(kF(i)));return function(o){let c=0;for(let et=0;et<o.length;et++){const nt=o[et].attributes.position;nt&&nt.itemSize===3&&(c+=nt.count)}const _=new Float32Array(3*c);let j=0;for(let et=0;et<o.length;et++){const nt=o[et].attributes.position;if(nt&&nt.itemSize===3)for(let st=0;st<nt.count;st++)_[j++]=nt.getX(st),_[j++]=nt.getY(st),_[j++]=nt.getZ(st)}return new g.u9r().setAttribute("position",new g.TlE(_,3))}(s)}function kF(h){let e=h.geometry;return e=e.toBufferGeometry?e.toBufferGeometry():e.clone(),h.updateMatrixWorld(),h.matrixWorld.decompose(cH,uH,yD),e.scale(yD.x,yD.y,yD.z),e}function OF(h){const e=h.attributes.position,i=new Float32Array(3*e.count);for(let s=0;s<e.count;s++)i[3*s]=e.getX(s),i[3*s+1]=e.getY(s),i[3*s+2]=e.getZ(s);return i}function bD(h,e){switch(e){case"x":return h.x;case"y":return h.y;case"z":return h.z}throw new Error(`Unexpected component ${e}`)}function hH(h,e=1e-4){e=Math.max(e,Number.EPSILON);const i={},s=h.getIndex(),o=h.getAttribute("position"),c=s?s.count:o.count;let _=0;const j=[],et=[],nt=Math.log10(1/e),st=Math.pow(10,nt);for(let dt=0;dt<c;dt++){const mt=s?s.getX(dt):dt;let yt="";yt+=~~(o.getX(mt)*st)+",",yt+=~~(o.getY(mt)*st)+",",yt+=~~(o.getZ(mt)*st)+",",yt in i?j.push(i[yt]):(et.push(o.getX(mt)),et.push(o.getY(mt)),et.push(o.getZ(mt)),i[yt]=_,j.push(_),_++)}const at=new g.TlE(new Float32Array(et),o.itemSize,o.normalized),ct=new g.u9r;return ct.setAttribute("position",at),ct.setIndex(j),ct}const BF=Math.PI/2;var vp;(function(h){h.BOX="Box",h.CYLINDER="Cylinder",h.SPHERE="Sphere",h.HULL="ConvexPolyhedron",h.MESH="Trimesh"})(vp||(vp={}));const dH=function(h,e={}){const i=function(et,nt={}){let st;if(nt.type===vp.BOX)return NF(et);if(nt.type===vp.CYLINDER)return function(at,ct){const dt=["x","y","z"],mt=ct.cylinderAxis||"y",yt=dt.splice(dt.indexOf(mt),1)&&dt,wt=new g.ZzF().setFromObject(at);if(!isFinite(wt.min.lengthSq()))return null;const Ct=wt.max[mt]-wt.min[mt],bt=.5*Math.max(bD(wt.max,yt[0])-bD(wt.min,yt[0]),bD(wt.max,yt[1])-bD(wt.min,yt[1])),At=mt==="y"?BF:0,Pt=mt==="z"?BF:0;return{type:vp.CYLINDER,params:{radiusTop:bt,radiusBottom:bt,height:Ct,segments:12},orientation:new ip().setFromEuler(At,Pt,0,"XYZ").normalize()}}(et,nt);if(nt.type===vp.SPHERE)return function(at,ct){if(ct.sphereRadius)return{type:vp.SPHERE,params:{radius:ct.sphereRadius}};const dt=AD(at);return dt?(dt.computeBoundingSphere(),{type:vp.SPHERE,params:{radius:dt.boundingSphere.radius}}):null}(et,nt);if(nt.type===vp.HULL)return function(at){const ct=AD(at);if(!ct)return null;const dt=1e-4;for(let wt=0;wt<ct.attributes.position.count;wt++)ct.attributes.position.setXYZ(wt,ct.attributes.position.getX(wt)+(Math.random()-.5)*dt,ct.attributes.position.getY(wt)+(Math.random()-.5)*dt,ct.attributes.position.getZ(wt)+(Math.random()-.5)*dt);const[mt,yt]=new lH().setFromObject(new g.Kj0(ct)).toJSON();return{type:vp.HULL,params:{vertices:new Float32Array(mt),faces:yt}}}(et);if(nt.type===vp.MESH)return st=AD(et),st?function(at){const ct=OF(at);if(!ct.length)return null;const dt=new Uint32Array(ct.length);for(let mt=0;mt<ct.length;mt++)dt[mt]=mt;return{type:vp.MESH,params:{vertices:ct,indices:dt}}}(st):null;if(nt.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${nt.type}".`);if(st=AD(et),!st)return null;switch(st.type){case"BoxGeometry":case"BoxBufferGeometry":return LF(st);case"CylinderGeometry":case"CylinderBufferGeometry":return function(at){const ct=at.parameters;return{type:vp.CYLINDER,params:{radiusTop:ct.radiusTop,radiusBottom:ct.radiusBottom,height:ct.height,segments:ct.radialSegments},orientation:new ip().setFromEuler(g.M8C.degToRad(-90),0,0,"XYZ").normalize()}}(st);case"PlaneGeometry":case"PlaneBufferGeometry":return function(at){at.computeBoundingBox();const ct=at.boundingBox;return{type:vp.BOX,params:{x:(ct.max.x-ct.min.x)/2||.1,y:(ct.max.y-ct.min.y)/2||.1,z:(ct.max.z-ct.min.z)/2||.1}}}(st);case"SphereGeometry":case"SphereBufferGeometry":return function(at){return{type:vp.SPHERE,params:{radius:at.parameters.radius}}}(st);case"TubeGeometry":case"BufferGeometry":return NF(et);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',st.type),LF(st)}}(h,e);if(!i)return null;const{type:s,params:o,offset:c,orientation:_}=i;let j;return j=s===vp.BOX?function(et){const{x:nt,y:st,z:at}=et;return new sD(new pn(nt,st,at))}(o):s===vp.CYLINDER?function(et){const{radiusTop:nt,radiusBottom:st,height:at,segments:ct}=et,dt=new iG(nt,st,at,ct);return dt.radiusTop=st,dt.radiusBottom=st,dt.height=at,dt.numSegments=ct,dt}(o):s===vp.SPHERE?function(et){return new wF(et.radius)}(o):s===vp.HULL?function(et){const{faces:nt,vertices:st}=et,at=[];for(let ct=0;ct<st.length;ct+=3)at.push(new pn(st[ct],st[ct+1],st[ct+2]));return new _S({faces:nt,vertices:at})}(o):function(et){const{vertices:nt,indices:st}=et;return new mD(nt,st)}(o),{shape:j,offset:c,orientation:_}};function LF(h){if(!OF(h).length)return null;h.computeBoundingBox();const e=h.boundingBox;return{type:vp.BOX,params:{x:(e.max.x-e.min.x)/2,y:(e.max.y-e.min.y)/2,z:(e.max.z-e.min.z)/2}}}function NF(h){const e=h.clone();e.quaternion.set(0,0,0,1),e.updateMatrixWorld();const i=new g.ZzF().setFromObject(e);if(!isFinite(i.min.lengthSq()))return null;const s=i.translate(e.position.negate()).getCenter(new g.Pa4);return{type:vp.BOX,params:{x:(i.max.x-i.min.x)/2,y:(i.max.y-i.min.y)/2,z:(i.max.z-i.min.z)/2},offset:s.lengthSq()?new pn(s.x,s.y,s.z):void 0}}var wD,xD=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let WA=wD=class extends ms{constructor(h=!1){super(),this._world=new tH,this.enabled=!0,this.nextSteps=0,this.stepPhysics={stepCount:100,delta:.1,step:()=>{this.nextSteps=this.stepPhysics.stepCount}},this.makeRootBodies=()=>{var o;(o=this._viewer)==null||o.scene.modelRoot.children.forEach(c=>{this.makeBody(c)})},this._bodyMeshMap=new Map,this._movementPlane=new g.Kj0(new g._12(100,100),new g.vBJ({color:65280,side:g.ehD})),this.enabled=h,this._world.gravity.set(0,-9.81,0);const e=new sG,i=new bs({mass:0,position:new pn(0,-2,0)});i.addShape(e),i.quaternion.setFromEuler(-Math.PI/2,0,0),this._ground=i,this._world.addBody(i);const s=new wF(.1);this._jointBody=new bs({mass:0}),this._jointBody.addShape(s),this._jointBody.collisionFilterGroup=0,this._jointBody.collisionFilterMask=0,this._world.addBody(this._jointBody)}async onAdded(h){await super.onAdded(h);const e=new g.Pa4,i=new g.Pa4,s=new g.Pa4,o=new g._fP,c=new g._fP,_=new g.yGw,j=new g.yGw;let et=!1,nt=!1;function st(at){const ct=h.canvas.getBoundingClientRect(),dt=new g.FM8;return dt.x=(at.clientX-ct.x)/ct.width*2-1,dt.y=-(at.clientY-ct.y)/ct.height*2+1,dt}h.addEventListener("preFrame",()=>{const at=h.getPlugin(gv),ct=h.getPlugin(iy);if(!this.enabled){if(!(this.nextSteps>0))return at&&et&&(at.enableRefreshTransform=!0,et=!1),ct&&nt&&(ct.enable(wD.PluginType),nt=!1),void(this._dirty=!1);this.enabled=!0}if(at&&at.enableRefreshTransform&&!et&&(at.enableRefreshTransform=!1,et=!0),ct&&!nt&&ct.disable(wD.PluginType),this.nextSteps>0)for(let mt=0;mt<this.stepPhysics.stepCount;mt++)this._world.step(this.stepPhysics.delta);else this._world.fixedStep();this._dirty=!1;let dt=!1;for(const mt of this._world.bodies){if(mt.mass===0)continue;const yt=this._bodyMeshMap.get(mt);if(yt&&(yt.updateMatrixWorld(),yt.getWorldPosition(i),yt.getWorldQuaternion(c),yt.getWorldScale(s),i.manhattanDistanceTo(e.copy(mt.position))>0&&(dt=!0),c.angleTo(o.copy(mt.quaternion))>0&&(dt=!0),dt)){if(_.compose(e,o,s),!yt.parent)throw new Error("no parent");j.copy(yt.parent.matrixWorld).invert(),j.multiply(_),j.decompose(e,o,s),yt.position.copy(e),yt.quaternion.copy(o)}}this._dirty=dt,h.setDirty(),h.renderer.resetShadows(),at==null||at.bakeShadows(),this.nextSteps>0&&(this.enabled=!1,this.nextSteps=0)}),h.scene.addEventListener("update",at=>{this._bodyMeshMap.forEach((ct,dt)=>{dt.velocity.set(0,0,0),dt.angularVelocity.set(0,0,0)})}),h.scene.addEventListener("addSceneObject",at=>{var dt;const ct=(dt=at.object)==null?void 0:dt.modelObject;ct&&ct.traverse(mt=>{const yt=mt.uiConfig;yt&&Array.isArray(yt.children)&&(yt.children.push({type:"folder",label:"Physics",children:[{type:"button",label:"Make Body",value:()=>this.makeBody(mt)},{type:"number",label:"Mass",hidden:()=>!mt._physicsBody,getValue:()=>{var wt;return((wt=mt._physicsBody)==null?void 0:wt.mass)??0},setValue:wt=>{mt._physicsBody&&(mt._physicsBody.mass=wt)}}]}),mt.userData.physicsMass!==void 0&&this.makeBody(mt))})}),h.canvas.addEventListener("pointerdown",at=>{if(!this.enabled||!at.isPrimary)return;h.getPlugin(Bo).enabled=!1;const ct=st(at),dt=new g.iMs;dt.setFromCamera(ct,h.scene.activeCamera.cameraObject);const mt=dt.intersectObjects([...this._bodyMeshMap.values()],!0);if(!mt.length)return;let yt,wt=null,Ct=mt[0];for(const Pt of mt){for(wt=Pt.object,Ct=Pt;!(wt==null||wt.visible&&wt.material);)wt=wt.parent;if(wt)break}if(!wt)return;for(;wt.parent&&!yt;){for(const[Pt,Dt]of this._bodyMeshMap.entries())if(Dt===wt){Pt.mass>0&&(yt=Pt);break}wt=wt.parent}if(!yt)return;h.scene.activeCamera.interactionsEnabled=!1,this._movementPlane.position.copy(Ct.point),this._movementPlane.lookAt(h.scene.activeCamera.cameraObject.getWorldPosition(new g.Pa4));const bt=new pn().copy(Ct.point).vsub(yt.position),At=yt.quaternion.inverse().vmult(bt);this._jointBody.position.copy(Ct.point),this._jointConstraint=new tG(yt,At,this._jointBody,new pn(0,0,0)),this._world.addConstraint(this._jointConstraint)}),h.canvas.addEventListener("pointermove",at=>{if(!this.enabled||!at.isPrimary||!this._jointConstraint)return;const ct=st(at),dt=new g.iMs;dt.setFromCamera(ct,h.scene.activeCamera.cameraObject);const mt=dt.intersectObject(this._movementPlane);if(!mt.length)return;const yt=mt[0];this._jointBody.position.copy(yt.point),this._jointConstraint.update()}),h.canvas.addEventListener("pointerup",at=>{this.enabled&&at.isPrimary&&(h.getPlugin(Bo).enabled=!0,h.scene.activeCamera.interactionsEnabled=!0,this._jointConstraint&&(this._world.removeConstraint(this._jointConstraint),this._jointConstraint=void 0))})}makeBody(h){if(h.isLight||h._physicsBody)return;const e=[];let i=0;if(h.updateMatrixWorld(),h.traverse(et=>{const nt=et;if(!nt.isMesh)return;if(nt._physicsShape)return void e.push(nt._physicsShape);if(i+=nt.userData.physicsMass??1,nt.addEventListener("objectUpdate",()=>{nt.userData.physicsMass===0&&(this._ground.position.y=nt.position.y,this._bodyMeshMap.forEach((at,ct)=>{ct.velocity.set(0,0,0),ct.angularVelocity.set(0,0,0),ct.force.set(0,0,0),ct.torque.set(0,0,0)}))}),nt.userData.physicsMass===0)return;const st=dH(nt,{type:vp.HULL});st?(e.push([st.shape,nt]),nt._physicsShape=st.shape):console.warn("Failed to convert mesh to cannon shape",nt)}),!e.length)return;const s=new bs({mass:i,angularVelocity:new pn(0,0,0),velocity:new pn(0,0,0)}),o=new g.Pa4,c=new g._fP,_=new g.Pa4,j=new g.yGw;for(const[et,nt]of e)nt!==h?(nt.updateMatrixWorld(),j.copy(h.matrixWorld).invert(),j.multiply(nt.matrixWorld),j.decompose(o,c,_),s.addShape(et,new pn(...o.toArray()),new ip(...c.toArray()))):s.addShape(et);s.position.set(...h.getWorldPosition(o).toArray()),s.quaternion.set(...h.getWorldQuaternion(c).toArray()),s.angularVelocity.set(0,0,0),s.velocity.set(0,0,0),h.addEventListener("objectUpdate",()=>{s.position.set(...h.getWorldPosition(o).toArray()),s.quaternion.set(...h.getWorldQuaternion(c).toArray()),s.angularVelocity.set(0,0,0),s.velocity.set(0,0,0)}),this._world.addBody(s),this._bodyMeshMap.set(s,h),h._physicsBody=s,h.setDirty({sceneUpdate:!0,updateGround:!1,frameFade:!1,refreshUi:!0})}};WA.PluginType="CannonPhysics",xD([jr("Enabled",h=>({onChange:()=>{}})),En()],WA.prototype,"enabled",void 0),xD([Jp()],WA.prototype,"stepPhysics",void 0),xD([Oo("Make Root Bodies")],WA.prototype,"makeRootBodies",void 0),WA=wD=xD([ks("Physics (dev)")],WA);var pH=__webpackgi_require__(819),fH=__webpackgi_require__(665);const mH=(h,e,i)=>{var _,j;const s=h.controller_,o=(j=(_=s.parent)==null?void 0:_.children)==null?void 0:j.indexOf(s);return!(((et,nt)=>nt.controller_.rackController.rack===et.controller_.parent)(h,e)&&o===i||(e.add(h,i),0))},UF=(h,e,i,s)=>{var at;let o=e.uiRef;o!=null&&o.controller_.viewProps.get("disposed")&&(o=void 0);const c=o==null?void 0:o.expanded;if(!o){const ct=h.addFolder({title:""});o=ct,o.on("fold",dt=>{var yt,wt,Ct;let mt=ct.expanded;(0,b.safeSetProperty)(e,"expanded",mt,!0),mt=(0,b.getOrCall)(e.expanded)??mt,mt!==ct.expanded&&(ct.expanded=mt),(yt=e.uiRefresh)==null||yt.call(e,"postFrame",!0,10),mt?(wt=e.onExpand)==null||wt.call(e,e):(Ct=e.onCollapse)==null||Ct.call(e,e)})}if(!o)return o;o.expanded=(0,b.getOrCall)(e.expanded)??c??!1;const _=(e.children??[]).map(ct=>ct&&(0,b.getOrCall)(ct)).flat(2).filter(ct=>ct);let j=0;for(const ct of _){if(Array.isArray(ct)||typeof ct!="object"){console.error("child is not an object",ct);continue}let dt=ct.uiRef;dt&&dt.controller_.viewProps.get("disposed")&&(ct.uiRef=void 0,ct.uiRefresh=void 0),dt=ct.uiRef,dt||(i.appendUiObject({uiConfig:ct},o),dt=ct.uiRef),dt&&mH(dt,o,j++)&&i.appendUiObject({uiConfig:ct},o)}let et=o.children;for(;et.length>j;){const ct=et[et.length-1];o.remove(ct),ct.dispose(),et=o.children}o.controller_.props.set("title",(0,b.getOrCall)(e.label)??"");const nt=o.controller_.view.containerElement,st=(0,b.getOrCall)(e.domChildren,[]);if((st==null?void 0:st.length)!==void 0){const ct=[];for(let dt=0;dt<nt.children.length;dt++){const mt=nt.children[dt];(at=mt.dataset)!=null&&at.tpCustomDOM&&ct.push(mt)}for(const dt of ct)nt.removeChild(dt);for(const dt of st)dt.parentElement!==nt&&(nt.appendChild(dt),dt.dataset.tpCustomDOM="true");o.controller_.foldable.cleanUpTransition()}return o},gH=(h,e,i,s)=>{const[o,c]=e.property??[void 0,void 0],_=(0,b.getOrCall)(e.label)??c;let j=e.uiRef;return j!=null&&j.controller_.viewProps.get("disposed")&&(j=void 0),j||(j=h.addButton({title:""}),j.on("click",async()=>{const et=[];e.prompt&&et.push(await i.prompt(...e.prompt));let nt=o&&c?o[c]:void 0,st=o;if(nt||(nt=e.value,st=e),typeof nt=="function"){const at=()=>{i.removeEventListener("postFrame",at),nt.call(st??e,...et)};i.addEventListener("postFrame",at)}else console.warn("Invalid action type for button")})),j&&(j.title=(_??"click me")+""),j},_H=(h,e,i,s)=>{const o=Object.fromEntries(((0,b.getOrCall)(e.children)??[]).map(c=>(0,b.getOrCall)(c)).flat(2).filter(c=>c).map(c=>{const _=(0,b.getOrCall)(c.label);return[_,c.value??_]}));return Ry(h,e,i,{options:o,...s??{}})},vH=(h,e,i,s)=>{const o=(0,b.getOrCall)(e.bounds),c=((o==null?void 0:o.length)??0)>=2?o[1]:1,_=((o==null?void 0:o.length)??0)>=1?o[0]:0,j=e.stepSize||void 0;return Ry(h,e,i,{min:_,max:c,step:j,...s??{}})},ED=(h,e,i,s)=>{const o=(0,b.getOrCall)(e.bounds);if(!o||o.length<1)return Ry(h,e,i,{...s??{}});const c=(o.length??0)>=2?o[1]:1,_=(o.length??0)>=1?o[0]:0,j={min:_,max:c,step:e.stepSize??(c-_)/100},et={x:j,y:j};e.type!=="vec3"&&e.type!=="vec4"||(et.z=j),e.type==="vec4"&&(et.w=j);const nt=e.property;if(e.value===void 0&&nt&&nt[0]&&typeof nt[0]=="object"&&nt[0][nt[1]]&&Array.isArray(nt[0][nt[1]])){const[st,at]=nt,ct=st[at],dt=ct.length,mt=new(dt===2?g.FM8:dt===3?g.Pa4:g.Ltg)().fromArray(ct);e.value=mt,e.property=void 0,e.onChange=[()=>{st[at]=mt.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(yt=>yt),e.label===void 0&&(e.label=at)}return Ry(h,e,i,{...et,...s??{}})},yH=(h,e,i,s)=>{var c;const o=e.property;if(e.value===void 0&&o&&typeof o[0]=="object"&&((c=o[0][o[1]])!=null&&c.isColor)){const[_,j]=o,et=g.KI_;Object.defineProperty(e,"value",{get:()=>{const nt=_[j];return nt?new To(nt).getHex(et):0},set:nt=>{const st=_[j],at=new To().setHex(nt,et);st.isColor?st.copy(at):typeof st=="number"?_[j]=at.getHex():typeof st=="string"&&(_[j]="#"+at.getHexString()),typeof(_==null?void 0:_.setDirty)=="function"&&_.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(nt=>nt),e.label===void 0&&(e.label=j+"")}return(s=s??{}).view="color",(0,b.getOrCall)(e.inlinePicker)&&(s.picker="inline"),Ry(h,e,i,s)},Ry=(h,e,i,s)=>{var j;let o=(0,b.getOrCall)(e.property);if((e.getValue||e.setValue)&&o&&console.error("specify either property or value, or getValue and setValue",e),o)e.value&&console.warn("Both property and value are defined, value will be ignored",e);else if((Object.hasOwn?Object.hasOwn(e,"value"):e.hasOwnProperty("value"))||e.value!==void 0||!e.getValue&&!e.setValue||(Object.defineProperty(e,"value",{get:()=>{var et;return(et=e.getValue)==null?void 0:et.call(e)},set:et=>{var nt;return(nt=e.setValue)==null?void 0:nt.call(e,et)}}),o=[e,"value"]),o||e.value===void 0||(o=[e,"value"]),!o)return void console.error("cannot determine property",e);s=s??{};const c={label:(0,b.getOrCall)(e.label)??o[1],...s};let _=e.uiRef;if(_!=null&&_.controller_.viewProps.get("disposed")&&(_=void 0),!_&&typeof o[0]=="object"&&o[0]){const[et,nt]=o;try{_=e.isMonitor?h.addMonitor(et,nt,c):h.addInput(et,nt,c).on("change",st=>{[e.onChange].flat().forEach(at=>typeof at=="function"&&(at==null?void 0:at(st))),typeof(et==null?void 0:et.setDirty)=="function"&&et.setDirty(st)})}catch(st){if(!st.message.startsWith("No matching controller for"))throw st;_=void 0}}if(_){for(const[et,nt]of Object.entries(c)){const st=_.controller_.props.value(et);st!==void 0&&st.rawValue!==nt&&_.controller_.props.set(et,nt)}e.type==="slider"&&(c.min!==void 0&&_.controller_.valueController.sliderController.props.set("minValue",c.min),c.max!==void 0&&_.controller_.valueController.sliderController.props.set("maxValue",c.max)),(j=_==null?void 0:_.controller_.valueController.view.inputElement)==null||j.setAttribute("placeholder",(0,b.getOrCall)(e.placeholder)??""),_.refresh()}return _};class FF extends b.SimpleEventDispatcher{constructor(e=!1,i=!1,s=!1,o=!0,c=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:UF,folder:UF,input:Ry,number:Ry,slider:vH,dropdown:_H,checkbox:Ry,color:yH,vec:ED,vec2:ED,vec3:ED,vec4:ED,button:gH,monitor:(j,et,nt,st)=>(et.isMonitor=!0,Ry(j,et,nt,st)),dummy:(j,et,nt,st)=>Ry(j,et,nt,st)},this.alert=async j=>alert(j),this.confirm=async j=>confirm(j),this.prompt=async(j,et,nt=!0)=>prompt(j,et),this._expand=e,this._limitedOptions=s;const _=this._createUiContainer();c.appendChild(_),this._pane=new fH.Pane({title:"Configuration",container:_}),this._pane.expanded=this._expand,o&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const i=this._refreshQueue[e],s=[],o=(0,b.now)(),c=o-this._lastModeTime[e];i.forEach(_=>{_[2]>.001?(_[2]-=c,s.push(_)):this._refreshUiObject(_[0],_[1],_[2])}),this._refreshQueue[e]=s,this._lastModeTime[e]=o}addToRefreshQueue(e,i){var j;const s=(j=i[0])==null?void 0:j.uiConfig,o=s==null?void 0:s.uuid,c=this._refreshQueue[e],_=c.find(et=>et[3]===o);_?_[2]=Math.max(_[2],i[2]):c.push([...i,o]),this._refreshQueue[e]=c}dispose(){var e;(e=this._pane)==null||e.dispose(),this._pane=void 0}appendUiObject(e,i){e&&this._appendUiObject(e,i)}_appendUiObject(e,i){var o,c;const{uiConfig:s}=e??{};if(s&&(!this._limitedOptions||s.limitedUi)&&(i=i??this._pane,s.type)){s.uuid||(s.uuid=Bp()),s.uiRef&&s.uiRefType!==s.type&&this.removeUiConfig(s);const _=(c=(o=this._typeGenerators)[s.type])==null?void 0:c.call(o,i,s,this);_&&(_.hidden=(0,b.getOrCall)(s.hidden)??!1,_.disabled=(0,b.getOrCall)(s.disabled)??!1),s.uiRef=_,s.uiRefType=_?s.type:void 0,s.uiRefresh=(j="postFrame",et=!1,nt=0)=>this._uiObjectRefresh(j,(e==null?void 0:e.uiConfig)??s,i,et,nt),_==null||_.controller_.viewProps.handleDispose(()=>{s.uiRef=void 0,s.uiRefType=void 0,s.uiRefresh=void 0})}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var i,s;e&&e.uiRef&&((s=(i=e.uiRef).dispose)==null||s.call(i),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,i,s,o,c){(o?SD(i,s):[{uiConfig:i,parentFolder:s}]).forEach(_=>{const j=[{uiConfig:_.uiConfig},_.parentFolder,c];e==="immediate"?this._refreshUiObject(...j):this.addToRefreshQueue(e,j)})}_refreshUiObject(e,i,s=0){this._appendUiObject(e,i),s>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=(0,b.createDiv)({id:"tweakpaneUiContainer",addToBody:!1});return(0,b.createStyles)(b.css`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function SD(h,e,i){return i=i??[],h&&h.uiRef&&(i.push({uiConfig:h,parentFolder:e}),[...h.children||[]].forEach(s=>{typeof s!="function"&&s&&(Array.isArray(s)?s.forEach(o=>i=SD(o,h.uiRef,i)):i=SD(s,h.uiRef,i))})),i}class jF{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const o=s.indexOf(i);o!==-1&&s.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let o=0,c=s.length;o<c;o++)s[o].call(this,e);e.target=null}}}function zF(h){return document.createElementNS("http://www.w3.org/1999/xhtml",h)}const VF={};function SL(h){h in VF||(VF[h]=!0,console.warn(h))}let kT;class AH{static getDataURL(e,i=!1){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let s;if(e instanceof HTMLCanvasElement)s=e;else{kT===void 0&&(kT=zF("canvas")),kT.width=e.width,kT.height=e.height;const o=kT.getContext("2d");e instanceof ImageData?o.putImageData(e,0,0):o.drawImage(e,0,0,e.width,e.height),s=kT}return!i&&(s.width>2048||s.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),s.toDataURL("image/jpeg",.6)):s.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=zF("canvas");i.width=e.width,i.height=e.height;const s=i.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const o=s.getImageData(0,0,e.width,e.height),c=o.data;for(let _=0;_<c.length;_++)c[_]=255*Uo(c[_]/255);return s.putImageData(o,0,0),i}if(e.data){const i=e.data.slice(0);for(let s=0;s<i.length;s++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[s]=Math.floor(255*Uo(i[s]/255)):i[s]=Uo(i[s]);return{data:i,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class bH{constructor(e=null){this.isSource=!0,this.uuid=sn(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},o=this.data;if(o!==null){let c;if(Array.isArray(o)){c=[];for(let _=0,j=o.length;_<j;_++)o[_].isDataTexture?c.push(CL(o[_].image)):c.push(CL(o[_]))}else c=CL(o);s.url=c}return i||(e.images[this.uuid]=s),s}}function CL(h){if(typeof HTMLImageElement<"u"&&h instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&h instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&h instanceof ImageBitmap)return AH.getDataURL(h);if(h.data){let e=[];try{e=Array.from(h.data)}catch(i){i.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(i),e=h.data}return{data:e,width:h.width,height:h.height,type:h.data.constructor.name}}return h.url!==void 0?h.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let wH=0;class k1 extends jF{constructor(e=k1.DEFAULT_IMAGE,i=k1.DEFAULT_MAPPING,s=1001,o=1001,c=xa,_=1008,j=1023,et=1009,nt=k1.DEFAULT_ANISOTROPY,st=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:wH++}),this.uuid=sn(),this.name="",this.source=new bH(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=s,this.wrapT=o,this.magFilter=c,this.minFilter=_,this.anisotropy=nt,this.format=j,this.internalFormat=null,this.type=et,this.offset=new nn(0,0),this.repeat=new nn(1,1),this.center=new nn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ho,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof st=="string"?this.colorSpace=st:(SL("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=st===Bl?po:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===po?Bl:3e3,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),i||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return SL("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===po?Bl:3e3}set encoding(e){SL("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Bl?po:""}}k1.DEFAULT_IMAGE=null,k1.DEFAULT_MAPPING=300,k1.DEFAULT_ANISOTROPY=1;var CD=__webpackgi_require__(898),YI={};CD.Z&&CD.Z.locals&&(YI.locals=CD.Z.locals);var TL,ML=0,wS={};wS.styleTagTransform=y1(),wS.setAttributes=_1(),wS.insert=function(h,e){(e.target||document.head).appendChild(h)},wS.domAPI=g1(),wS.insertStyleElement=v1(),YI.use=function(h){return wS.options=h||{},ML++||(TL=m1()(CD.Z,wS)),YI},YI.unuse=function(){ML>0&&!--ML&&(TL(),TL=null)};var xH=YI;class TD extends FF{constructor(e=!1,i=!1,s=!1,o=document.body){super(e,i,s,!1),this.dependencies=[Fr],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=c=>{this.dispatchEvent(c),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async c=>this._viewer?this._viewer.alert(c):super.alert(c),this.confirm=async c=>this._viewer?this._viewer.confirm(c):super.confirm(c),this.prompt=async(c,_,j=!0)=>this._viewer?this._viewer.prompt(c,_,j):super.prompt(c,_,j),this._pane.registerPlugin(pH),xH.use({target:o})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(i=>(s,o,c,_)=>{let j=o.property||o.__property;const et="placeholder";if(o.value===void 0&&(o.getValue||o.setValue)&&(Object.defineProperty(o,"_value",{get:()=>{var nt;return(nt=o.getValue)==null?void 0:nt.call(o)},set:nt=>{var st;return(st=o.setValue)==null?void 0:st.call(o,nt)}}),j=[o,"_value"]),(!(Object.hasOwn?Object.hasOwn(o,"value"):o.hasOwnProperty("value"))||o.value===void 0)&&j&&typeof j[0]=="object"){const[nt,st]=j,at=(0,b.makeTextSvg)("Render Target"),ct=(0,b.makeTextSvg)("Data Texture"),dt=(0,b.makeTextSvg)("CUBE Texture"),mt=(0,b.makeTextSvg)("Compressed Texture"),yt={},wt={};Object.defineProperty(o,"value",{get:()=>{let Ct,bt=nt[st];if(bt!=null&&bt.get&&(bt=bt.get()),!bt)return et;if(bt.isCompressedTexture&&!bt.image.tp_src&&(bt.image.tp_src=mt),bt.isTexture?(bt.image&&!bt.image.tp_src&&(bt.image instanceof ImageBitmap||bt.image instanceof HTMLImageElement||bt.image instanceof HTMLVideoElement)?bt.image.tp_src=(0,b.imageBitmapToBase64)(bt.image,160):bt.image&&bt.isRenderTargetTexture&&!bt.image.tp_src?bt.__target&&(bt.image.tp_src=i.renderer.renderTargetToDataUrl(bt.__target)):bt.image&&!bt.image.tp_src&&(bt.image.tp_src=Fo(bt,160,!1).toDataURL("image/png",90)),bt.isRenderTargetTexture&&!bt.image.tp_src&&(bt.image.tp_src=at),bt.isDataTexture&&!bt.image.tp_src&&(bt.image.tp_src=ct),bt.image&&(Ct=bt.image.tp_src_uuid,Ct=Ct?yt[Ct]:void 0,Ct||(Ct=bt.image.tp_src||bt.image.src))):typeof bt=="string"?Ct=bt:bt.domainMin?(Ct=bt.texture,bt.texture.image&&!bt.texture.image.tp_src&&(bt.texture.image.tp_src=dt),bt.texture.image&&(Ct=bt.texture.image.tp_src_uuid,Ct=Ct?yt[Ct]:void 0,Ct||(Ct=bt.texture.image.tp_src||bt.texture.image.src))):bt&&console.error("unknown value",bt),Ct||(Ct=et),bt.image&&!bt.image.tp_src_uuid){const At=Bp();bt.image.tp_src_uuid=At,wt[Ct]=At}return typeof Ct=="string"&&(Ct=yt[Ct]??Ct),Ct},set:Ct=>{var Dt,Nt,Vt,Zt,an,fn,mn,Sn,An;const bt=nt[st],At=wn=>{nt[st]=wn,wn!=null&&wn.isTexture&&(wn.flipY=wn.isDataTexture?wn.flipY:(bt==null?void 0:bt.flipY)??!0)};if(typeof Ct=="string")return void(typeof bt=="string"&&At(Ct));if(!Ct)return void(o.value=et);if(Ct.isPlaceholder)return void(bt&&(At(typeof bt=="string"?"":null),typeof(nt==null?void 0:nt.setDirty)=="function"&&nt.setDirty()));let Pt=Ct.tp_src_uuid;if(Pt||(Pt=Ct.src??Ct.tp_src,Pt=wt[Pt]??Pt,delete wt[Pt],Ct.tp_src_uuid=Pt),Pt&&(yt[Pt]=Ct),typeof bt!="string"){if(!((bt==null?void 0:bt.image)===Ct||((Dt=bt==null?void 0:bt.image)==null?void 0:Dt.src)===Ct.src||((Nt=bt==null?void 0:bt.image)==null?void 0:Nt.tp_src)===Ct.tp_src&&Ct.tp_src!=null||((Vt=bt==null?void 0:bt.image)==null?void 0:Vt.tp_src)===Ct.src&&Ct.src!=null||((Zt=bt==null?void 0:bt.image)==null?void 0:Zt.src)===Ct.tp_src&&Ct.tp_src!=null))if(Ct instanceof File){const wn=i==null?void 0:i.getPlugin(Fr);if(!wn)throw"Viewer or AssetManagerPlugin not found";(an=wn.importer)==null||an.importSingle({file:Ct,path:Ct.src}).then(Mn=>{var Pn,On,er,Zn;if(Mn){Mn.isDataTexture&&(Mn.needsUpdate=!0);const yr=(er=(On=(Pn=Ct.src)==null?void 0:Pn.split("?"))==null?void 0:On[0])==null?void 0:er.split(".").pop();Mn.userData&&(Mn.userData.mimeType||(Mn.userData.mimeType="image/"+(["jpg","jpeg"].includes(yr)?"jpeg":"png"))),At(Mn),[o.onChange].flat().forEach(lr=>typeof lr=="function"&&(lr==null?void 0:lr())),typeof(nt==null?void 0:nt.setDirty)=="function"&&nt.setDirty(),(Zn=o.uiRefresh)==null||Zn.call(o,"postFrame",!1)}})}else{const wn=new k1(Ct);wn.assetType="texture",wn.needsUpdate=!0;const Mn=(Sn=(mn=(fn=Ct.src)==null?void 0:fn.split("?"))==null?void 0:mn[0])==null?void 0:Sn.split(".").pop();wn.userData.mimeType||(wn.userData.mimeType="image/"+(["jpg","jpeg"].includes(Mn)?"jpeg":"png"));const Pn=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(st);wn.colorSpace=Pn?g.GUF:g.KI_,wn.wrapS=g.rpg,wn.wrapT=g.rpg,At(wn),[o.onChange].flat().forEach(On=>typeof On=="function"&&(On==null?void 0:On())),typeof(nt==null?void 0:nt.setDirty)=="function"&&nt.setDirty(),(An=o.uiRefresh)==null||An.call(o,"postFrame",!1)}}else At(Pt)}}),o.__property=o.property,o.property=void 0,o.label===void 0&&(o.label=st)}return(_=_??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],_.imageFit===void 0&&(_.imageFit="contain"),_.clickCallback===void 0&&(_.clickCallback=(nt,st)=>{var wt;const at=nt==null?void 0:nt.target,ct=at==null?void 0:at.getBoundingClientRect();if(!ct)return void st.click();const dt=o.uiRef.controller_.valueController.value.rawValue,mt=dt===et||dt!=null&&dt.isPlaceholder?{}:{"remove image":()=>{var Pt;o.uiRef.controller_.valueController.value.setRawValue("");const[Ct,bt]=o.property||o.__property||[o,"value"],At=typeof Ct[bt]=="string";Ct[bt]=At?"":null,[o.onChange].flat().forEach(Dt=>typeof Dt=="function"&&(Dt==null?void 0:Dt())),typeof(Ct==null?void 0:Ct.setDirty)=="function"&&Ct.setDirty(),(Pt=o.uiRefresh)==null||Pt.call(o,"postFrame",!1),L_.Remove()},"download image":async()=>{L_.Remove();const[Ct,bt]=o.property||o.__property||[o,"value"],At=Ct[bt];if(!At)return;const Pt=(At==null?void 0:At.image)??o.uiRef.controller_.valueController.value.rawValue;let Dt=At.__rootBlob?At.__rootBlob.objectUrl||URL.createObjectURL(At.__rootBlob):At.userData.rootPath||(Pt==null?void 0:Pt.src);Pt&&(Pt instanceof ImageBitmap||Pt instanceof HTMLImageElement||Pt instanceof HTMLVideoElement)&&!Dt&&(Dt=(0,b.imageBitmapToBase64)(Pt));let Nt=At.__rootBlob?At.__rootBlob.name||"image."+(At.__rootBlob.ext||"png"):null;if(!Dt&&At.isRenderTargetTexture){const Zt=At.__target;if(At.type===g.ywz)Dt=i.renderer.renderTargetToDataUrl(Zt,"image/png",90),Nt="renderTarget.png";else{const an=new XP().parse(i.renderer.rendererObject,Zt),fn=new Blob([an],{type:"image/x-exr"});if(!fn)return void console.error("cannot export render target",Pt,Ct[bt],Ct,bt,o);Nt="renderTarget.exr",Dt=URL.createObjectURL(fn)}}if(!Dt&&At.isDataTexture){const Zt=new XP().parse(void 0,At),an=new Blob([Zt],{type:"image/x-exr"});if(!an)return void console.error("cannot export data texture",Pt,Ct[bt],Ct,bt,o);Nt="dataTexture.exr",Dt=URL.createObjectURL(an)}if(!Dt)return void console.error("cannot export image",Pt,Ct[bt],Ct,bt,o);const Vt=document.createElement("a");document.body.appendChild(Vt),Vt.style.display="none",Vt.href=Dt,Vt.download=Nt||(Dt.startsWith("data:")?"image.png":Dt.split("/").pop()??"image.png"),Vt.target="_blank",Vt.click(),document.body.removeChild(Vt)}},yt=L_.Create({...mt,"set/replace image":()=>{st.click(),L_.Remove()},"from url":async()=>{var Dt,Nt;let Ct="";if(Ct=await c.prompt("Load texture: Enter Image/Texture URL",Ct,!0),!Ct||!Ct.startsWith("http")&&!Ct.startsWith("data:image"))return Ct!==null&&await c.alert("Loading Image: Invalid URL"),void L_.Remove();Ct=Ct.trim();const[bt,At]=o.property||o.__property||[o,"value"],Pt=bt[At];if(typeof Pt=="string")bt[At]=Ct,[o.onChange].flat().forEach(Vt=>typeof Vt=="function"&&(Vt==null?void 0:Vt())),typeof(bt==null?void 0:bt.setDirty)=="function"&&bt.setDirty(),(Dt=o.uiRefresh)==null||Dt.call(o,"postFrame",!1);else{const Vt=i==null?void 0:i.getPlugin(Fr);if(!Vt)throw"Viewer or AssetManagerPlugin not found";(Nt=Vt.importer)==null||Nt.importSinglePath(Ct).then(Zt=>{var an;if(Zt){Zt.isDataTexture?Zt.needsUpdate=!0:Zt&&(Pt==null?void 0:Pt.flipY)!==void 0&&(Zt.flipY=Pt.flipY);const fn=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(At);Zt.colorSpace=fn?g.GUF:g.KI_,bt[At]=Zt,[o.onChange].flat().forEach(mn=>typeof mn=="function"&&(mn==null?void 0:mn())),typeof(bt==null?void 0:bt.setDirty)=="function"&&bt.setDirty(),(an=o.uiRefresh)==null||an.call(o,"postFrame",!1)}else console.warn("Failed to load texture",Ct)})}L_.Remove()},cancel:()=>{L_.Remove()}},2,ct.height+8);(wt=at.parentElement)==null||wt.appendChild(yt),ct.y>.7*document.body.clientHeight&&(yt.style.top="auto",yt.style.bottom=ct.height+8+"px")}),_.view="input-image",Ry(s,o,c,_)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var o;const i=(o=this._viewer)==null?void 0:o.getPlugin(e);if(!i)return void console.warn("plugin not found:",e);this._plugins.push(i),i.uiConfig&&(i.uiConfig.limitedUi=!0),i.uiConfig&&i.uiConfig.hidden===void 0&&(i.uiConfig.hidden=!1),this._appendUiObject(i);const s=i.uiConfig;if(s!=null&&s.uiRef&&i.toJSON){const c=typeof i.toJSON=="function"?i.toJSON():null;i.resetDefaults=async()=>{var et,nt;await((et=i.fromJSON)==null?void 0:et.call(i,c)),(nt=s.uiRefresh)==null||nt.call(s,"postFrame",!0)};const _=s.uiRef.controller_.view.element,j=(0,b.createDiv)({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});j.onclick=et=>{const nt={};typeof i.toJSON=="function"&&(nt["download preset"]=async()=>{var ct,dt;const at=(dt=(ct=this._viewer)==null?void 0:ct.getPlugin(Fr))==null?void 0:dt.exportPluginPreset(i);await(0,b.downloadBlob)(new Blob([JSON.stringify(at,null,2)],{type:"application/json"}),"preset."+i.constructor.PluginType+".json"),L_.Remove()}),typeof i.fromJSON=="function"&&(nt["upload preset"]=async()=>{var yt,wt,Ct;L_.Remove();const at=await(0,b.uploadFile)(!1,!1);if(at.length===0)return;const ct=at[0],dt=await ct.text(),mt=JSON.parse(dt);await((wt=(yt=this._viewer)==null?void 0:yt.getPlugin(Fr))==null?void 0:wt.importPluginPreset(mt,i)),(Ct=s.uiRefresh)==null||Ct.call(s,"postFrame",!0)},c&&(nt["reset defaults"]=async()=>{var at;L_.Remove(),await((at=i.resetDefaults)==null?void 0:at.call(i))}));const st=L_.Create(nt,_.clientWidth-120,12);_.append(st),et.preventDefault()},_.appendChild(j)}return s}setupPlugins(...e){e.forEach(i=>this.setupPluginUi(i))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var s;const i=e.uiConfig;i&&((0,b.getOrCall)(i.hidden)!==!0?(s=i.uiRefresh)==null||s.call(i,"postFrame",!0):i.uiRef&&(i.uiRef.hidden=!0))})}}TD.PluginType="TweakpaneUi";class $I extends ms{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._savedBg=!1,this.lastBgVal=null,this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[{label:"Color",type:"color",inlinePicker:!0,property:[this,"sceneBackgroundColor"],limitedUi:!0},()=>({label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0}),{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",getValue:()=>{var e;return((e=this._viewer)==null?void 0:e.scene.backgroundIntensity)??1},setValue:e=>{this._viewer&&(this._viewer.scene.backgroundIntensity=e)},bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{this._viewer&&(this._viewer.scene.background=null,this._viewer.scene.backgroundColor=null)}},()=>({label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0}),{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0},{type:"checkbox",label:"Fixed Env Direction",property:[this,"sceneEnvironmentFixedDirection"]},{type:"checkbox",label:"Artistic Lighting",getValue:()=>{var e;return((e=this._viewer)==null?void 0:e.renderer.useLegacyLights)??!0},setValue:e=>{this._viewer&&(this._viewer.renderer.useLegacyLights=e)}}]}}get sceneBackgroundColor(){var i,s;const e=(s=(i=this._viewer)==null?void 0:i.scene.backgroundColor)==null?void 0:s.getHex(g.KI_);return e!==void 0&&(this._savedBg=!0),e||0}set sceneBackgroundColor(e){this._viewer&&this._savedBg&&(this._viewer.scene.backgroundColor||(this._viewer.scene.backgroundColor=new To),this._viewer.scene.backgroundColor.setHex(e),this._viewer.scene.setDirty())}get sceneBackground(){var i;const e=(i=this._viewer)==null?void 0:i.scene.background;return e&&(e.isTexture||e.assetType==="texture")?e:null}set sceneBackground(e){this._viewer&&(this._viewer.scene.background=e)}get sceneEnvironment(){var e;return((e=this._viewer)==null?void 0:e.scene.environment)||null}set sceneEnvironment(e){this._viewer&&(this._viewer.scene.environment=e)}get sceneEnvironmentRotation(){var e,i;return((i=(e=this._viewer)==null?void 0:e.scene.environment)==null?void 0:i.rotation)??0}set sceneEnvironmentRotation(e){var s,o;const i=(s=this._viewer)==null?void 0:s.scene.environment;i&&(i.rotation=e,(o=this._viewer)==null||o.scene.setDirty())}get sceneEnvironmentIntensity(){var e;return((e=this._viewer)==null?void 0:e.scene.envMapIntensity)??1}set sceneEnvironmentIntensity(e){var i;(i=this._viewer)!=null&&i.scene&&(this._viewer.scene.envMapIntensity=e)}get sceneEnvironmentFixedDirection(){var e;return((e=this._viewer)==null?void 0:e.scene.fixedEnvMapDirection)??!1}set sceneEnvironmentFixedDirection(e){var i;(i=this._viewer)!=null&&i.scene&&(this._viewer.scene.fixedEnvMapDirection=e)}get envmapBg(){var e,i,s;return((e=this._viewer)==null?void 0:e.scene.background)==="environment"||((i=this._viewer)==null?void 0:i.scene.background)===((s=this._viewer)==null?void 0:s.scene.environment)}set envmapBg(e){if(this._viewer)if(e){const i=this._viewer.scene.background;i&&i!==this._viewer.scene.environment&&i!=="environment"&&(this.lastBgVal=i),this._viewer.scene.background="environment"}else this._viewer.scene.background!==this._viewer.scene.environment&&this._viewer.scene.background!=="environment"||(this._viewer.scene.background=this.lastBgVal)}async onAdded(e){await super.onAdded(e),this.lastBgVal=e.scene.background,e.scene.addEventListener("backgroundChanged",()=>{var i,s;(s=(i=this.uiConfig).uiRefresh)==null||s.call(i,"postFrame",!0)}),e.scene.addEventListener("environmentChanged",()=>{var i,s;(s=(i=this.uiConfig).uiRefresh)==null||s.call(i,"postFrame",!0)})}}$I.PluginType="SimpleBackgroundEnvUiPlugin1";class KI extends ms{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{var e,i;(i=(e=this._uiConfig).uiRefresh)==null||i.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)==null||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var e,i;return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...((i=(e=this._viewer)==null?void 0:e.scene.modelRoot.modelObject.children)==null?void 0:i.map(s=>s.assetType==="light"?null:s.uiConfig).filter(s=>s!=null))??[]),this._uiConfig):this._uiConfig}_sceneUpdate(){var e,i;(i=(e=this._uiConfig)==null?void 0:e.uiRefresh)==null||i.call(e,"postFrame",!0)}}KI.PluginType="SimpleUi";var EH=__webpackgi_require__(1),SH=__webpackgi_require__.n(EH)();class JI extends ms{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=(0,b.createDiv)({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(i,s)=>(i.push({text:s.name||"unnamed",id:s.uuid,children:s.children.reduce(this._buildData,[])}),i),this._findVisible=(i,s)=>(s.visible&&(s.children.length<1?i.push(s.uuid):i.push(...s.children.reduce(this._findVisible,[]))),i),this._setVisible=i=>{var s;(s=this._viewer)==null||s.doOnce("postFrame",()=>{var _,j,et;const o=(_=this._viewer)==null?void 0:_.scene.modelRoot;if(!o||i==null)return;const c=new Set;o.traverse(nt=>{nt!==o&&(nt.visible=i.includes(nt.uuid),nt.visible&&nt.traverseAncestors(st=>c.add(st)))}),c.forEach(nt=>nt.visible=!0),(et=(j=this._viewer)==null?void 0:j.scene)==null||et.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})})},this.enabled=e,this.reset=this.reset.bind(this),(0,b.createStyles)(b.css`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){var _;if(e!=null&&e.fromHierarchyPlugin||!(e!=null&&e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const i=(_=this._viewer)==null?void 0:_.scene.modelRoot;if(!i)return;const s=i.children.reduce(this._buildData,[]),o=i.children.reduce(this._findVisible,[]);let c=!1;return new Promise((j,et)=>{this.treeView=new SH(this.hierarchyDiv,{closeDepth:1,data:s,loaded:function(){this.values=o,j()},onChange:()=>{c?(0,b.timeout)(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):c=!0},onItemLabelClick:nt=>{var at;const st=(at=this._viewer)==null?void 0:at.scene.modelRoot.modelObject.getObjectByProperty("uuid",nt);st&&i.visible&&st.dispatchEvent({type:"select",value:st,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}JI.PluginType="HierarchyUiPlugin";class ZI extends ms{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new S_;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}},{type:"button",label:"Add Ambient Light",value:()=>{if(!this._viewer)return;const e=new rw;e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Point Light",value:()=>{if(!this._viewer)return;const e=new Hy;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Spot Light",value:()=>{if(!this._viewer)return;const e=new nw;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,e.lookAt(0,0,0),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[Fr],this._sceneUpdate=e=>{var s,o,c;if(!e.hierarchyChanged)return;const i=[];(s=this._viewer)==null||s.traverseSceneObjects(_=>{if(!_.lightObject)return;const j=_.uiConfig;j&&!i.includes(j)&&i.push(j)}),[...this.uiConfig.children].forEach(_=>{(_==null?void 0:_.type)==="button"||i.includes(_)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(_),1)}),i.forEach(_=>{this.uiConfig.children.includes(_)||this.uiConfig.children.push(_)}),(c=(o=this.uiConfig).uiRefresh)==null||c.call(o,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}ZI.PluginType="SimpleLightsUi";class e2 extends ms{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",value:()=>{var s;if(!this._viewer)return;const e=this._viewer.createCamera(new g.cPb(45,1,.5,20));this._viewer.scene.modelRoot.add(e.cameraObject),e.setCameraOptions({controlsMode:"orbit"}),e.position.set(2,2,2),e.target.set(0,0,0),e.positionUpdated(!0),e.cameraObject.lookAt(0,0,0),e.setDirty();const i=this._viewer.getPluginByType("VirtualCamerasPlugin");if(i){const o=i.addCamera(e),c=(s=this._viewer)==null?void 0:s.getPluginByType("debug");c&&c.addTexture("camera frame",()=>o.target.texture,[40,310,300,200])}}}],limitedUi:!0},this.dependencies=[Fr],this._sceneUpdate=e=>{var s,o,c;if(!e.hierarchyChanged)return;const i=[];(s=this._viewer)==null||s.traverseSceneObjects(_=>{if(!_.cameraObject)return;const j=_.uiConfig;j&&!i.includes(j)&&i.push(j)}),[...this.uiConfig.children].forEach(_=>{(_==null?void 0:_.type)==="button"||i.includes(_)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(_),1)}),i.forEach(_=>{this.uiConfig.children.includes(_)||this.uiConfig.children.push(_)}),(c=(o=this.uiConfig).uiRefresh)==null||c.call(o,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}e2.PluginType="SimpleSceneCamerasUi";var ox,OT=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let Zv=ox=class extends ms{constructor(){super(),this.enabled=!0,this._serializeVersion=1,this.mode="full",this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(h=!0){if(!this._viewer)return;if(this.mode==="full")return this._viewer.setSize({}),this._setScale(this.scale),void this._refresh();const e={width:Math.floor(this.width),height:Math.floor(this.height)},i=this._viewer.container.getBoundingClientRect(),s={width:Math.floor(i.width),height:Math.floor(i.height)};let o=1;if(e.width>s.width){const c=e.width;e.width=s.width;const _=e.width/c;if(e.height=Math.floor(e.height*_),o/=_,o>ox.MaxCanvasScale)return this.width=s.width*ox.MaxCanvasScale,console.log("loop",this.width,s.width,o),void this._sizeChanged()}if(e.height>s.height){const c=e.height;e.height=s.height;const _=e.height/c;if(e.width=Math.floor(e.width*_),o/=_,o>ox.MaxCanvasScale)return this.height=s.height*ox.MaxCanvasScale,console.log("loop",this.width,s.width,this.height,s.height,o),void this._sizeChanged()}(e.width>=s.width||e.width<1)&&delete e.width,(e.height>=s.height||e.height<1)&&delete e.height,this._viewer.setSize(e),this._setScale(o),h&&(this.scale=o),this._refresh()}_setScale(h){this._viewer&&(this._viewer.renderer.displayCanvasScaling=h)}_scaleChanged(){if(!this._viewer)return;const h=this.scale;if(Math.abs(h-this._viewer.renderer.displayCanvasScaling)<.01)return;if(this.mode==="full")return void this._sizeChanged();const e=this.width/this.height,i=this._viewer.container.getBoundingClientRect(),s=Math.floor(i.width*h),o=Math.floor(s/e);this.width=s,this.height=o,this._sizeChanged(!1)}async onAdded(h){await super.onAdded(h);const e=h.canvas.clientWidth,i=h.canvas.clientHeight,s=h.renderer.displayCanvasScaling;this.width=e,this.height=i,this.scale=s,h.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",()=>this._sizeChanged(!0)),this._refresh()}async onRemove(h){return h.renderer.removeEventListener("resize",this._refresh),super.onRemove(h)}_refresh(){var h,e;(e=(h=this.uiConfig)==null?void 0:h.uiRefresh)==null||e.call(h,"postFrame",!0)}fromJSON(h,e){if(!h.mode)if(h.width||h.height){const i=this._viewer.container.getBoundingClientRect();h.width||(h.width=i.width),h.height||(h.height=i.height),h.scale&&(h.width*=h.scale,h.height*=h.scale,delete h.scale),h.width=Math.round(h.width),h.height=Math.round(h.height),h.mode="custom"}else h.mode="full";return super.fromJSON(h,e)}toJSON(h){const e=super.toJSON(h);return e.mode==="full"&&(delete e.width,delete e.height),e.mode==="custom"&&delete e.scale,e}};Zv.PluginType="RendererParamsUiPlugin",Zv.MaxCanvasScale=5,OT([En("version")],Zv.prototype,"_serializeVersion",void 0),OT([En(),Pm("Mode",["full","custom"].map(h=>({label:h}))),(0,b.onChange2)(ox.prototype._sizeChanged)],Zv.prototype,"mode",void 0),OT([En(),ns("Width",void 0,1,h=>({onChange:()=>h._sizeChanged(),hidden:()=>h.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=h._viewer)==null?void 0:e.container.getBoundingClientRect().width)||1024)+2))]}}))],Zv.prototype,"width",void 0),OT([En(),ns("Height",void 0,1,h=>({onChange:()=>h._sizeChanged(),hidden:()=>h.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=h._viewer)==null?void 0:e.container.getBoundingClientRect().height)||1024)+2))]}}))],Zv.prototype,"height",void 0),OT([En(),(0,b.onChange)(ox.prototype._scaleChanged),ns("Scale",[.25,ox.MaxCanvasScale],.001,h=>({disabled:()=>h.mode==="custom"}))],Zv.prototype,"scale",void 0),Zv=ox=OT([ks("Renderer")],Zv);class t2 extends ms{async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}toJSON(e){var s;const i=super.toJSON(e);return i.activeCamera=(s=this._viewer)==null?void 0:s.scene.activeCamera.toJSON(),i}fromJSON(e,i){var s;return e.activeCamera&&((s=this._viewer)==null||s.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,i)}_refresh(){var e,i;this._viewer&&((i=(e=this.uiConfig).uiRefresh)==null||i.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)==null?void 0:e.scene.activeCamera.uiConfig)||{}}}t2.PluginType="CameraUiPlugin";var CH={create:h=>{let e="button"+(h.type?" "+h.type:""),i=go.createDiv(e,h.text);return i.addEventListener("click",h.onClick),i}};let V_={createElement:(h,e,i,s)=>{let o=document.createElement(h);if(e&&(o.className=e),i&&(o.innerHTML=i),s)for(let c in s)o.setAttribute(c,s[c]);return o},createDiv:(h,e,i)=>V_.createElement("div",h,e,i),createDomTree:h=>{if(!h||!h.hasOwnProperty("dom"))return h;let e=h.dom;if(h.children)for(let i in h.children)h.children[i]&&e.appendChild(V_.createDomTree(h.children[i]));return e},removeElement:h=>{h!=null&&h.parentNode.removeChild(h)},appendToBody:h=>{document.body.appendChild(h)},makeIconHTML:h=>{let e="";return h=="ok"&&(e="#tick"),h=="error"&&(e="#cancel"),h=="info"&&(e="#info-button"),h=="caution"&&(e="#danger"),h=="min"&&(e="#line"),h=="close"&&(e="#close"),`<svg class="icon ${h}"><use xlink:href="${e}" /></svg>`},makeNftContent:h=>{let e=null;if(h.type){let i=null;i=typeof h.content=="string"?V_.createDiv("inner-content",h.content):V_.createDomTree({dom:V_.createDiv("inner-content"),children:[h.content]}),e=h.type=="text"?V_.createDomTree({dom:V_.createDiv("content text"),children:[i]}):V_.createDomTree({dom:V_.createDiv("content"),children:[V_.createDiv("state",V_.makeIconHTML(h.type)),i]})}else typeof h.content=="string"&&(e=V_.createDiv("content",h.content));return e},standardizeButtons:(h,e)=>{let i=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||i.push({key:27,text:"Cancel",onClick:h.close.bind(h,"cancel")}),i.push({key:13,text:"OK",type:"main",onClick:h.close.bind(h,"ok")}),i;i=e.buttons,i.constructor!==Array&&(i=[i]);for(let s in i)!i[s].onClick&&(i[s].onClick=h.close.bind(h,i[s].id));return i},makeButtons:h=>{let e=[];if(h)for(let i in h)e.push(CH.create({text:h[i].text?h[i].text:"OK",type:h[i].normal?null:"main",onClick:h[i].onClick}));return V_.createDomTree({dom:V_.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:h=>{let e=i=>{for(let s in h)if(h[s].key===i.keyCode)return void h[s].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:h=>{window.removeEventListener("keydown",h)}};var go=V_,Rp=__webpackgi_require__(476),Ym={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let Dy={};Dy.overlay_in=[new Rp.Frame(Ym["wwise-overlay-in-1"],0),new Rp.Frame(Ym["wwise-overlay-in-2"],400)],Dy.overlay_out=[new Rp.Frame(Ym["wwise-overlay-out-1"],300)],Dy.pop_in=[new Rp.Frame(Ym["wwise-pop-in-1"],0),new Rp.Frame(Ym["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new Rp.Frame(Ym["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new Rp.Frame(Ym["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],Dy.pop_out=[new Rp.Frame(Ym["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],Dy.flip_in=[new Rp.Frame(Ym["wwise-flip-in-1"],0),new Rp.Frame(Ym["wwise-flip-in-2"],500)],Dy.flip_out=[new Rp.Frame(Ym["wwise-flip-out-1"],400)],Dy.min_in=[new Rp.Frame(Ym["wwise-min-in-1"],0),new Rp.Frame(Ym["wwise-min-in-2"],350)],Dy.min_out=[new Rp.Frame(Ym["wwise-min-out-1"],400)];let GF=["top","bottom","left","right"];for(let h in GF){let e=GF[h];Dy[e+"_in"]=[new Rp.Frame(Ym["wwise-"+e+"-in-1"],0),new Rp.Frame(Ym["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],Dy[e+"_out"]=[new Rp.Frame(Ym["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var MD=Dy;let TH={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class IL{static create(e,i){let s=e.getElementsByClassName("title")[0];s&&(s=s.innerHTML);let o=e.getElementsByClassName("content")[0];return o&&(o=o.innerHTML),go.removeElement(e),i.title=s,i.content=o,new IL(i)}constructor(e){this.options=JSON.parse(JSON.stringify(TH));for(let et in e)e[et]!=null&&(this.options[et]=e[et]);let i=this.options.position;if(i.indexOf(" ")==-1&&(i=="left"||i=="right"?i+=" center":i=i=="top"||i=="bottom"?"center "+i:i+" "+i),this.options.position=i,this.options.overlay){let et=document.getElementsByClassName("wwise-overlay");et.length?(this.overlay=et[0],this.hasOverlay=!0):(this.overlay=go.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let s="content";if(this.options.topbar){let et=[];this.options.topbar.showMin&&(et.push(go.createDiv(null,go.makeIconHTML("min"))),et[et.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(et.push(go.createDiv(null,go.makeIconHTML("close"))),et[et.length-1].addEventListener("click",this.close.bind(this,void 0)));let nt=null;nt=typeof this.options.title=="string"?go.createDiv("title",this.options.title):go.createDomTree({dom:go.createDiv("title"),children:[this.options.title]}),this.topbar=go.createDomTree({dom:go.createDiv("topbar"),children:[{dom:go.createDiv("control"),children:et.map(st=>({dom:st}))},{dom:nt},{dom:go.createDiv("clear")}]})}else s+=" no-topbar";typeof this.options.content=="string"?this.content=go.createDomTree({dom:go.createDiv(s,this.options.content)}):this.content=go.createDomTree({dom:go.createDiv(s),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=go.createDomTree({dom:go.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let o=go.createDiv("wwise-wrapper");this.options.zIndex&&(o.style.zIndex=this.options.zIndex),this.wrapper=go.createDomTree({dom:o,children:[this.window]}),this.dom=go.createDomTree({dom:go.createDiv(),children:[this.wrapper]});let c=this.options.position.split(" "),_=-50,j=-50;if(c[0]=="left"?(_=0,this.wrapper.classList.add("left")):c[0]=="right"?(_=-100,this.wrapper.classList.add("right")):c[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=c[0],c[1]=="top"?(j=0,this.wrapper.classList.add("top")):c[1]=="bottom"?(j=-100,this.wrapper.classList.add("bottom")):c[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=i[1],this.window.style.transform=`translate(${_}%, ${j}%)`,this.options.style)for(let et in this.options.style)this.window.style[et]=this.options.style[et];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(s=>{this.promiseResolve=s}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let i=e?"min":this.options.animation;if(i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new Rp.Queue(this.wrapper,MD[i+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&s.push(new Rp.Queue(this.overlay,MD.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let i=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new Rp.Queue(this.wrapper,MD[i+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&s.push(new Rp.Queue(this.overlay,MD.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(go.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),go.appendToBody(this.dom)}removeDoms(){go.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(go.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let i={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},s=window.getComputedStyle(this.wrapper),o=this.options.draggable,c=parseFloat(s.left),_=parseFloat(s.top);if(s.left.indexOf("%")!=-1){c=s.left,c=c.substr(0,c.length-1),c=parseInt(c);let j=window,et=document,nt=et.documentElement,st=et.getElementsByTagName("body")[0];c=c*(j.innerWidth||nt.clientWidth||st.clientWidth)/100}if(s.top.indexOf("%")!=-1){_=s.top,_=_.substr(0,_.length-1),_=parseInt(_);let j=window,et=document,nt=et.documentElement,st=et.getElementsByTagName("body")[0];_=_*(j.innerHeight||nt.clientHeight||st.clientHeight)/100}o!=1&&o!="horizontal"||(this.wrapper.style.left=c+i.x+"px"),o!=1&&o!="vertical"||(this.wrapper.style.top=_+i.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let i=e.relatedTarget;i&&i.nodeName!="HTML"||(this.inDragging=!1)}}var MH=IL,PL=class{constructor(h){let e=this.options=h;!e.type&&(e.type="ok");let i={topbar:!1};i.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),i.overlay=!0,i.keepOverlay=e.keepOverlay,i.clickOverlayToClose=!1,i.animation=e.animation,i.zIndex=e.zIndex,this.wwise=new MH(i)}constructContent(h){let e=go.createDiv("modal"),i=go.createDomTree({dom:go.createDiv("main "+h.type),children:[go.createDiv(null,go.makeIconHTML(h.type)),go.createDiv("title",h.title),go.createDiv("text",h.text)]});this.buttonArr=go.standardizeButtons(this,h);let s=go.makeButtons(this.buttonArr),o=null;h.content&&(o=typeof h.content=="string"?go.createDiv(null,h.content):h.content);let c=null;return s.innerHTML&&(c=go.createDomTree({dom:go.createDiv("operation "+h.type),children:[s]})),o||c||i.classList.add("no-op"),go.createDomTree({dom:e,children:[i,o,c]})}open(){if(this.wwise.opened)return;let h=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=go.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),h}close(h){if(this.wwise.opened)return this.value=h,go.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let IH={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},PH={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var ID=__webpackgi_require__(513),n2={};ID.Z&&ID.Z.locals&&(n2.locals=ID.Z.locals);var RL,DL=0,xS={};xS.styleTagTransform=y1(),xS.setAttributes=_1(),xS.insert=function(h,e){(e.target||document.head).appendChild(h)},xS.domAPI=g1(),xS.insertStyleElement=v1(),n2.use=function(h){return xS.options=h||{},DL++||(RL=m1()(ID.Z,xS)),n2},n2.unuse=function(){DL>0&&!--DL&&(RL(),RL=null)};var RH=n2;class kL extends ms{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},go.appendToBody=i=>{e.container.appendChild(i)},go.makeIconHTML=i=>"",RH.use({target:e.container}),e.alert=async i=>{const s=i==null?void 0:i.split(":")[0],o=new PL({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s+":",""))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return o.open(),o.getPromise()},e.confirm=async i=>{const s=i==null?void 0:i.split(":")[0],o=new PL({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return o.open(),await o.getPromise()==="yes"},e.prompt=async(i,s,o=!0)=>{const c=i==null?void 0:i.split(":")[0],_=new class{constructor(j){this.options=JSON.parse(JSON.stringify(IH));for(let at in j)j[at]!=null&&(this.options[at]=j[at]);let et=this.options,nt=JSON.parse(JSON.stringify(PH));for(let at in nt)et.hasOwnProperty(at)&&(nt[at]=et[at]);let st=[];et.showCancel&&st.push({key:27,text:et.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),st.push({key:13,text:et.okText,onClick:this.handleOk.bind(this)}),nt.buttons=st,this.input=go.createElement("input","input",null,{placeholder:et.placeholder}),this.error=go.createDiv("error"),nt.content=go.createDomTree({dom:go.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new PL(nt)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},j=>{this.error.innerText=j}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let j=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((et,nt)=>{this.promiseResolve=et,this.promiseReject=nt}),j}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:c??"&ndsp;",placeholder:s??"",showCancel:o,animation:"overlay",text:(i==null?void 0:i.replace(c||"","").replace(":",""))||""});return _.open(),await _.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}kL.PluginType="WindowiseDialogPlugin";var PD=__webpackgi_require__(729),r2={};PD.Z&&PD.Z.locals&&(r2.locals=PD.Z.locals);var OL,BL=0,ES={};ES.styleTagTransform=y1(),ES.setAttributes=_1(),ES.insert=function(h,e){(e.target||document.head).appendChild(h)},ES.domAPI=g1(),ES.insertStyleElement=v1(),r2.use=function(h){return ES.options=h||{},BL++||(OL=m1()(PD.Z,ES)),r2},r2.unuse=function(){BL>0&&!--BL&&(OL(),OL=null)};var DH=r2,RD=__webpackgi_require__(109),i2={};RD.Z&&RD.Z.locals&&(i2.locals=RD.Z.locals);var LL,NL=0,SS={};SS.styleTagTransform=y1(),SS.setAttributes=_1(),SS.insert=function(h,e){(e.target||document.head).appendChild(h)},SS.domAPI=g1(),SS.insertStyleElement=v1(),i2.use=function(h){return SS.options=h||{},NL++||(LL=m1()(RD.Z,SS)),i2},i2.unuse=function(){NL>0&&!--NL&&(LL(),LL=null)};var kH=i2;function HF(){DH.use(),kH.use()}async function QF(h,e=void 0,i=[]){var mt,yt;f1.setDefaultProps({theme:"editor",duration:300,arrow:!0,appendTo:()=>h.container});const s=(0,b.createDiv)({classList:["mode-buttons-container","button-bar"],addToBody:!0}),o=(0,b.createDiv)({innerHTML:"",id:"webgi-logo",addToBody:!1});(0,b.getUrlQueryParam)("logo-img")&&(o.style.backgroundImage=`url(${(0,b.getUrlQueryParam)("logo-img")})`),o.onclick=()=>{window.open((0,b.getUrlQueryParam)("logo-link")||"https://webgi.xyz","_blank")};const c=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
</svg>`;h.container.appendChild(o),f1(o,{placement:"right",content:"Powered by WebGi SDK"});const _=(0,b.createDiv)({innerHTML:c,id:"fsToggle",classList:["round-button"],addToBody:!1});_.dataset.tippyContent="Full-Screen",(mt=h.getPlugin(Vm))==null||mt.addEventListener("enter",()=>{_.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path d="M9 19L9 15M9 15L5 15M9 15L4 20M15 15L20 20M15 15V19M15 15H19M15 5V9M15 9L19 9M15 9L20 4M9 5L9 9M9 9L5 9M9 9L4 4" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,_.dataset.tippyContent="Exit Full-Screen"}),(yt=h.getPlugin(Vm))==null||yt.addEventListener("exit",()=>{_.innerHTML=c,_.dataset.tippyContent="Full-Screen"}),_.onclick=()=>{var wt;(wt=h.getPlugin(Vm))==null||wt.toggle(h.container)},h.container.appendChild(_),f1(_,{placement:"left"});const j=(0,b.createDiv)({classList:["button-bar","util-buttons-container"],addToBody:!1});h.container.appendChild(j);const et=[{id:"reset-settings",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Reset All Settings",onclick:async()=>{var Ct;if(!await h.confirm("Reset settings: Are you sure you want to reset all plugin settings?"))return;const wt=ct.map(bt=>h.getPlugin(bt));for(const bt of wt)await((Ct=bt==null?void 0:bt.resetDefaults)==null?void 0:Ct.call(bt))}},{id:"clear-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
 <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
</svg>`,tooltip:"Clear Scene",onclick:async()=>{await h.confirm("Clear scene: Are you sure you want to clear the scene?")&&h.scene.disposeSceneModels()}},{id:"fit-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
    <path fill="currentColor" d="M17 12C17 7.55 11.62 5.31 8.46 8.46C5.31 11.61 7.55 17 12 17C14.76 17 17 14.76 17 12M12 15C9.33 15 8 11.77 9.88 9.88C11.77 8 15 9.33 15 12C15 13.66 13.66 15 12 15M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19" />
</svg>`,tooltip:"Fit Object/Scene",onclick:async()=>{var wt;await h.fitToView((wt=h.getPlugin(Bo))==null?void 0:wt.getSelectedObject())}},{id:"loop-cam-views",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Loop Camera Views",toggle:!0,onclick:async()=>{h.getPlugin(zl)&&(h.getPlugin(zl).viewLooping=!h.getPlugin(zl).viewLooping)}},{id:"play-gltf",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>`,tooltip:"GLTF Animations",toggle:!0,onclick:async()=>{var wt;(wt=h.getPlugin(Ql))==null||wt.playPauseAnimation()}},{id:"auto-rotate-cc",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M10,12L14,16L10,20V16.9C5.44,16.44 2,14.42 2,12C2,9.58 5.44,7.56 10,7.1V9.09C6.55,9.43 4,10.6 4,12C4,13.4 6.55,14.57 10,14.91V12M20,12C20,10.6 17.45,9.43 14,9.09V7.1C18.56,7.56 22,9.58 22,12C22,14.16 19.26,16 15.42,16.7L16.12,16L14.92,14.79C17.89,14.36 20,13.27 20,12M11,2H13V13L11,11V2M11,22V21L13,19V22H11Z" />
</svg>`,tooltip:"Auto rotate",toggle:!0,onclick:async()=>{const wt=h.scene.activeCamera.controls;wt&&wt.autoRotate!==void 0&&(wt.autoRotate=!wt.autoRotate)}},{id:"snapshot",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
</svg>`,tooltip:"Capture Snapshot",onclick:async()=>{const wt=h.getPlugin(lv);wt?await wt.downloadSnapshot():h.console.error("CanvasSnipperPlugin not added")}},{id:"glb-export",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
</svg>`,tooltip:"Export GLB",onclick:async()=>{const wt=h.getPlugin(b1);wt?await(wt==null?void 0:wt.downloadSceneGlb()):h.console.error("AssetExporterPlugin not added")}}];for(const wt of et){const Ct=(0,b.createDiv)({innerHTML:wt.icon,id:wt.id,classList:["button-bar-button","util-button"],addToBody:!1});Ct.dataset.tippyContent=wt.tooltip,Ct.onclick=()=>{wt.toggle&&Ct.classList.toggle("button-bar-selected-box"),wt.onclick()},j.appendChild(Ct)}v4(f1(".util-button"),{moveTransition:"transform 0.2s ease-out",placement:"top"});const nt=h.getPlugin(Bo);for(const[wt,Ct]of Object.entries(e??{})){const bt=i.find(At=>At.title===wt);bt?bt.plugins.push(...Ct):i.push({title:wt,plugins:[...Ct]})}let st=i[2],at=[];const ct=i.reduce((wt,Ct)=>wt.concat(Ct.plugins),[]);function dt(wt){var Ct;st=wt,nt&&(nt.enabled=!0),at=[];for(const bt of ct){const At=h.getPlugin(bt);if(!(At!=null&&At.uiConfig))continue;const Pt=wt.plugins.includes(bt);(0,b.safeSetProperty)(At.uiConfig,"hidden",!Pt,!0),Pt&&at.push(At)}for(const bt of i)(Ct=bt.div)==null||Ct.classList[st!==bt?"remove":"add"]("mode-button-selected","button-bar-selected");h.getPlugin(TD).refreshPluginsEnabled()}for(const wt of i){const Ct=(0,b.createDiv)({innerHTML:wt.title,classList:["mode-button","button-bar-button"]});Ct.onclick=()=>{dt(wt)},wt.div=Ct,s.appendChild(Ct)}dt(i[0]),nt==null||nt.addEventListener("selectedObjectChanged",()=>{nt!=null&&nt.getSelectedObject()&&!["Picking","Modifiers","Configurators"].includes(st.title)&&dt(i.find(wt=>wt.plugins.includes(Bo)))})}class UL extends ms{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>({label:"Shadow type",type:"dropdown",children:[["Basic",g._MY],["PCF",g._iA],["PCFSoft",fr],["VSM",ko]].map(e=>({label:e[0],value:e[1]})),getValue:()=>{var e;return(e=this._viewer)==null?void 0:e.renderer.rendererObject.shadowMap.type},setValue:e=>{var i;(i=this._viewer)==null||i.doOnce("postFrame",()=>{this._viewer&&(this._viewer.renderer.rendererObject.shadowMap.type=e,this._viewer.renderer.resetShadows(),this._viewer.renderer.reset(),this._viewer.scene.setDirty({sceneUpdate:!0,frameFade:!1}),this._viewer.setDirty())})}}),()=>{var e;return{label:((e=this._viewer)!=null&&e.useRgbm?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{var i,s;await((i=this._viewer)==null?void 0:i.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,b.setUrlQueryParam)("rgbm",(s=this._viewer)!=null&&s.useRgbm?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.isAntialiased?"Disable":"Enable")+" MSAA",type:"button",value:async()=>{var i,s;await((i=this._viewer)==null?void 0:i.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,b.setUrlQueryParam)("msaa",(s=this._viewer)!=null&&s.isAntialiased?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.useGBufferDepth?"Disable":"Enable")+" Depth(z) Prepass",type:"button",value:async()=>{var i,s;await((i=this._viewer)==null?void 0:i.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,b.setUrlQueryParam)("depthPrepass",(s=this._viewer)!=null&&s.useGBufferDepth?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.getPluginByType("debug")?"Disable":"Enable")+" Debug",type:"button",value:async()=>{var i,s;await((i=this._viewer)==null?void 0:i.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,b.setUrlQueryParam)("debug",(s=this._viewer)!=null&&s.getPluginByType("debug")?null:"true",!0)}}},{label:"Clear local storage",type:"button",value:async()=>{var e;await((e=this._viewer)==null?void 0:e.confirm("Edit Extras: This will clear all local storage. Are you sure?"))&&localStorage.clear()}},{label:"Clear caches",type:"button",value:async()=>{var i,s;const e=(s=(i=this._viewer)==null?void 0:i.getPlugin(Fr))==null?void 0:s.storage;if(e instanceof Storage)e.clear();else if(e instanceof Cache){const o=await e.keys();await Promise.all(o.map(async c=>e.delete(c)))}localStorage.clear()}},{label:"Auto GPU instance all",type:"button",value:()=>{var i;const e=new Set;(i=this._viewer)==null||i.scene.modelRoot.traverse(s=>s.geometry&&e.add(s.geometry)),e.forEach(s=>op(s))}},{label:"Auto Center All Geometries",type:"button",value:()=>{var i;const e=new Set;(i=this._viewer)==null||i.scene.modelRoot.traverse(s=>s.geometry&&e.add(s.geometry)),e.forEach(s=>{const o=new g.Pa4;s.center(o),s.userData.__appliedMeshes.forEach(c=>{c.position.sub(o),c.setDirty&&c.setDirty()})})}}]}}}UL.PluginType="ExtrasUiPlugin1";class FL extends g.Tme{constructor(e){super(),this.modelObject=this,this.assetType="widget",this.visible=!0,this.uiConfig=Rm("Widget",this),this.object=e,this.object.updateMatrixWorld(),this.object.updateProjectionMatrix&&this.object.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this._objectUpdate=this._objectUpdate.bind(this),this.attach(e),this.traverse(i=>{i.userData.__keepShadowDef=!0,i.castShadow=!1,i.receiveShadow=!1})}dispose(){this.detach()}_objectUpdate(){this.object&&this.update()}attach(e){var i,s;return this.object&&this.detach(),this.object=e,this.object&&(this.update(),this.object.addEventListener("objectUpdate",this._objectUpdate),this.object.addEventListener("dispose",this.dispose),this.uiConfig&&((s=(i=this.object.uiConfig)==null?void 0:i.children)==null||s.push(this.uiConfig)),this.visible=!0),this}detach(){var e,i,s,o;if(this.object){if(this.object.removeEventListener("objectUpdate",this._objectUpdate),this.object.removeEventListener("dispose",this.dispose),this.uiConfig){const c=(i=(e=this.object.uiConfig)==null?void 0:e.children)==null?void 0:i.indexOf(this.uiConfig);c!==void 0&&c>=0&&((o=(s=this.object.uiConfig)==null?void 0:s.children)==null||o.splice(c,1))}this.object=void 0,this.visible=!1}return this}}(function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);c>3&&_&&Object.defineProperty(e,i,_)})([jr()],FL.prototype,"visible",void 0);class jL extends FL{constructor(e){super(e),this.light=e,this.traverse(i=>{i.userData.__keepShadowDef=!0,i.castShadow=!1,i.receiveShadow=!1})}}var zL=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class ax extends jL{constructor(e,i,s){super(e),this.lineWidth=5,this.size=.5,this._v1=new g.Pa4,this._v2=new g.Pa4,this._v3=new g.Pa4,this.color=s,i!==void 0&&(this.size=i);let o=new aI;this.material=new sv({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightPlane=new iB(o,this.material),this.add(this.lightPlane),o=new aI,o.setPositions([0,0,0,0,0,1]),this.targetLine=new iB(o,this.material),this.add(this.targetLine),this.update(),this.traverse(c=>{c.userData.__keepShadowDef=!0,c.castShadow=!1,c.receiveShadow=!1})}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose(),super.dispose()}update(){this.light&&this.lightPlane&&(this._v1.setFromMatrixPosition(this.light.matrixWorld),this._v2.setFromMatrixPosition(this.light.target.matrixWorld),this._v3.subVectors(this._v2,this._v1),this.lightPlane.geometry.setPositions([-this.size,this.size,0,this.size,this.size,0,this.size,-this.size,0,-this.size,-this.size,0,-this.size,this.size,0]),this.lightPlane.lookAt(this._v2),this.lightPlane.material=this.material,this.targetLine.material=this.material,this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth,this.targetLine.lookAt(this._v2),this.targetLine.scale.z=this.light.intensity/3)}static Check(e){return e.isDirectionalLight}static Create(e){return new ax(e)}}zL([(0,b.onChange)(ax.prototype.update)],ax.prototype,"material",void 0),zL([(0,b.onChange)(ax.prototype.update),ns(void 0,[.1,20],.01)],ax.prototype,"lineWidth",void 0),zL([(0,b.onChange)(ax.prototype.update),ns(void 0,[.01,10],.01)],ax.prototype,"size",void 0);var VL=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class lx extends jL{constructor(e,i,s){super(e),this.lineWidth=5,this.size=.5,this.color=s,i!==void 0&&(this.size=i);const o=new ZT(new g.xo$(.5,4,2));this.material=new sv({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightSphere=new JS(o,this.material),this.lightSphere.computeLineDistances(),this.add(this.lightSphere),this.update(),this.traverse(c=>{c.userData.__keepShadowDef=!0,c.castShadow=!1,c.receiveShadow=!1})}dispose(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose(),super.dispose()}update(){this.light&&this.lightSphere&&(this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth,this.lightSphere.scale.setScalar(this.size))}static Check(e){return e.isPointLight}static Create(e){return new lx(e)}}VL([(0,b.onChange)(lx.prototype.update)],lx.prototype,"material",void 0),VL([(0,b.onChange)(lx.prototype.update),ns(void 0,[.1,20],.01)],lx.prototype,"lineWidth",void 0),VL([(0,b.onChange)(lx.prototype.update),ns(void 0,[.01,10],.01)],lx.prototype,"size",void 0);var WF=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};class CS extends jL{constructor(e,i,s){super(e),this.lineWidth=5,this._v1=new g.Pa4,this.color=s;let o=new rA;const c=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let _=0,j=1,et=32;_<et;_++,j++){const nt=_/et*Math.PI*2,st=j/et*Math.PI*2;c.push(Math.cos(nt),Math.sin(nt),1,Math.cos(st),Math.sin(st),1)}o.setPositions(c),this.material=new sv({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.cone=new QP(o,this.material),this.add(this.cone),o=new aI,o.setPositions([0,0,0,0,0,1]),this.update(),this.traverse(_=>{_.userData.__keepShadowDef=!0,_.castShadow=!1,_.receiveShadow=!1})}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose(),super.dispose()}update(){if(!this.light||!this.cone)return;this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,i=e*Math.tan(this.light.angle);this.cone.scale.set(i,i,e),this._v1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(this._v1),this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth}static Check(e){return e.isSpotLight}static Create(e){return new CS(e)}}WF([(0,b.onChange)(CS.prototype.update)],CS.prototype,"material",void 0),WF([(0,b.onChange)(CS.prototype.update),ns(void 0,[.1,20],.01)],CS.prototype,"lineWidth",void 0);class s2{constructor(e=0,i=0,s=0,o=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=s,this._w=o}static slerpFlat(e,i,s,o,c,_,j){let et=s[o+0],nt=s[o+1],st=s[o+2],at=s[o+3];const ct=c[_+0],dt=c[_+1],mt=c[_+2],yt=c[_+3];if(j===0)return e[i+0]=et,e[i+1]=nt,e[i+2]=st,void(e[i+3]=at);if(j===1)return e[i+0]=ct,e[i+1]=dt,e[i+2]=mt,void(e[i+3]=yt);if(at!==yt||et!==ct||nt!==dt||st!==mt){let wt=1-j;const Ct=et*ct+nt*dt+st*mt+at*yt,bt=Ct>=0?1:-1,At=1-Ct*Ct;if(At>Number.EPSILON){const Dt=Math.sqrt(At),Nt=Math.atan2(Dt,Ct*bt);wt=Math.sin(wt*Nt)/Dt,j=Math.sin(j*Nt)/Dt}const Pt=j*bt;if(et=et*wt+ct*Pt,nt=nt*wt+dt*Pt,st=st*wt+mt*Pt,at=at*wt+yt*Pt,wt===1-j){const Dt=1/Math.sqrt(et*et+nt*nt+st*st+at*at);et*=Dt,nt*=Dt,st*=Dt,at*=Dt}}e[i]=et,e[i+1]=nt,e[i+2]=st,e[i+3]=at}static multiplyQuaternionsFlat(e,i,s,o,c,_){const j=s[o],et=s[o+1],nt=s[o+2],st=s[o+3],at=c[_],ct=c[_+1],dt=c[_+2],mt=c[_+3];return e[i]=j*mt+st*at+et*dt-nt*ct,e[i+1]=et*mt+st*ct+nt*at-j*dt,e[i+2]=nt*mt+st*dt+j*ct-et*at,e[i+3]=st*mt-j*at-et*ct-nt*dt,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,s,o){return this._x=e,this._y=i,this._z=s,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i){const s=e._x,o=e._y,c=e._z,_=e._order,j=Math.cos,et=Math.sin,nt=j(s/2),st=j(o/2),at=j(c/2),ct=et(s/2),dt=et(o/2),mt=et(c/2);switch(_){case"XYZ":this._x=ct*st*at+nt*dt*mt,this._y=nt*dt*at-ct*st*mt,this._z=nt*st*mt+ct*dt*at,this._w=nt*st*at-ct*dt*mt;break;case"YXZ":this._x=ct*st*at+nt*dt*mt,this._y=nt*dt*at-ct*st*mt,this._z=nt*st*mt-ct*dt*at,this._w=nt*st*at+ct*dt*mt;break;case"ZXY":this._x=ct*st*at-nt*dt*mt,this._y=nt*dt*at+ct*st*mt,this._z=nt*st*mt+ct*dt*at,this._w=nt*st*at-ct*dt*mt;break;case"ZYX":this._x=ct*st*at-nt*dt*mt,this._y=nt*dt*at+ct*st*mt,this._z=nt*st*mt-ct*dt*at,this._w=nt*st*at+ct*dt*mt;break;case"YZX":this._x=ct*st*at+nt*dt*mt,this._y=nt*dt*at+ct*st*mt,this._z=nt*st*mt-ct*dt*at,this._w=nt*st*at-ct*dt*mt;break;case"XZY":this._x=ct*st*at-nt*dt*mt,this._y=nt*dt*at-ct*st*mt,this._z=nt*st*mt+ct*dt*at,this._w=nt*st*at+ct*dt*mt;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+_)}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const s=i/2,o=Math.sin(s);return this._x=e.x*o,this._y=e.y*o,this._z=e.z*o,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,s=i[0],o=i[4],c=i[8],_=i[1],j=i[5],et=i[9],nt=i[2],st=i[6],at=i[10],ct=s+j+at;if(ct>0){const dt=.5/Math.sqrt(ct+1);this._w=.25/dt,this._x=(st-et)*dt,this._y=(c-nt)*dt,this._z=(_-o)*dt}else if(s>j&&s>at){const dt=2*Math.sqrt(1+s-j-at);this._w=(st-et)/dt,this._x=.25*dt,this._y=(o+_)/dt,this._z=(c+nt)/dt}else if(j>at){const dt=2*Math.sqrt(1+j-s-at);this._w=(c-nt)/dt,this._x=(o+_)/dt,this._y=.25*dt,this._z=(et+st)/dt}else{const dt=2*Math.sqrt(1+at-s-j);this._w=(_-o)/dt,this._x=(c+nt)/dt,this._y=(et+st)/dt,this._z=.25*dt}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let s=e.dot(i)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Gt(this.dot(e),-1,1)))}rotateTowards(e,i){const s=this.angleTo(e);if(s===0)return this;const o=Math.min(1,i/s);return this.slerp(e,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const s=e._x,o=e._y,c=e._z,_=e._w,j=i._x,et=i._y,nt=i._z,st=i._w;return this._x=s*st+_*j+o*nt-c*et,this._y=o*st+_*et+c*j-s*nt,this._z=c*st+_*nt+s*et-o*j,this._w=_*st-s*j-o*et-c*nt,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const s=this._x,o=this._y,c=this._z,_=this._w;let j=_*e._w+s*e._x+o*e._y+c*e._z;if(j<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,j=-j):this.copy(e),j>=1)return this._w=_,this._x=s,this._y=o,this._z=c,this;const et=1-j*j;if(et<=Number.EPSILON){const dt=1-i;return this._w=dt*_+i*this._w,this._x=dt*s+i*this._x,this._y=dt*o+i*this._y,this._z=dt*c+i*this._z,this.normalize(),this._onChangeCallback(),this}const nt=Math.sqrt(et),st=Math.atan2(nt,j),at=Math.sin((1-i)*st)/nt,ct=Math.sin(i*st)/nt;return this._w=_*at+this._w*ct,this._x=s*at+this._x*ct,this._y=o*at+this._y*ct,this._z=c*at+this._z*ct,this._onChangeCallback(),this}slerpQuaternions(e,i,s){return this.copy(e).slerp(i,s)}random(){const e=Math.random(),i=Math.sqrt(1-e),s=Math.sqrt(e),o=2*Math.PI*Math.random(),c=2*Math.PI*Math.random();return this.set(i*Math.cos(o),s*Math.sin(c),s*Math.cos(c),i*Math.sin(o))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Kp{constructor(e=0,i=0,s=0){Kp.prototype.isVector3=!0,this.x=e,this.y=i,this.z=s}set(e,i,s){return s===void 0&&(s=this.z),this.x=e,this.y=i,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(qF.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(qF.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,s=this.y,o=this.z,c=e.elements;return this.x=c[0]*i+c[3]*s+c[6]*o,this.y=c[1]*i+c[4]*s+c[7]*o,this.z=c[2]*i+c[5]*s+c[8]*o,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,s=this.y,o=this.z,c=e.elements,_=1/(c[3]*i+c[7]*s+c[11]*o+c[15]);return this.x=(c[0]*i+c[4]*s+c[8]*o+c[12])*_,this.y=(c[1]*i+c[5]*s+c[9]*o+c[13])*_,this.z=(c[2]*i+c[6]*s+c[10]*o+c[14])*_,this}applyQuaternion(e){const i=this.x,s=this.y,o=this.z,c=e.x,_=e.y,j=e.z,et=e.w,nt=et*i+_*o-j*s,st=et*s+j*i-c*o,at=et*o+c*s-_*i,ct=-c*i-_*s-j*o;return this.x=nt*et+ct*-c+st*-j-at*-_,this.y=st*et+ct*-_+at*-c-nt*-j,this.z=at*et+ct*-j+nt*-_-st*-c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,s=this.y,o=this.z,c=e.elements;return this.x=c[0]*i+c[4]*s+c[8]*o,this.y=c[1]*i+c[5]*s+c[9]*o,this.z=c[2]*i+c[6]*s+c[10]*o,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this.z=e.z+(i.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const s=e.x,o=e.y,c=e.z,_=i.x,j=i.y,et=i.z;return this.x=o*et-c*j,this.y=c*_-s*et,this.z=s*j-o*_,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const s=e.dot(this)/i;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return GL.copy(this).projectOnVector(e),this.sub(GL)}reflect(e){return this.sub(GL.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(Gt(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y,o=this.z-e.z;return i*i+s*s+o*o}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,s){const o=Math.sin(i)*e;return this.x=o*Math.sin(s),this.y=Math.cos(i)*e,this.z=o*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,s){return this.x=e*Math.sin(i),this.y=s,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),o=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=s,this.z=o,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,4*i)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,3*i)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),i=Math.random()*Math.PI*2,s=Math.sqrt(1-e**2);return this.x=s*Math.cos(i),this.y=s*Math.sin(i),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const GL=new Kp,qF=new s2;class D0{constructor(){D0.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,i,s,o,c,_,j,et,nt,st,at,ct,dt,mt,yt,wt){const Ct=this.elements;return Ct[0]=e,Ct[4]=i,Ct[8]=s,Ct[12]=o,Ct[1]=c,Ct[5]=_,Ct[9]=j,Ct[13]=et,Ct[2]=nt,Ct[6]=st,Ct[10]=at,Ct[14]=ct,Ct[3]=dt,Ct[7]=mt,Ct[11]=yt,Ct[15]=wt,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new D0().fromArray(this.elements)}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],this}copyPosition(e){const i=this.elements,s=e.elements;return i[12]=s[12],i[13]=s[13],i[14]=s[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,s){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,i,s){return this.set(e.x,i.x,s.x,0,e.y,i.y,s.y,0,e.z,i.z,s.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,s=e.elements,o=1/BT.setFromMatrixColumn(e,0).length(),c=1/BT.setFromMatrixColumn(e,1).length(),_=1/BT.setFromMatrixColumn(e,2).length();return i[0]=s[0]*o,i[1]=s[1]*o,i[2]=s[2]*o,i[3]=0,i[4]=s[4]*c,i[5]=s[5]*c,i[6]=s[6]*c,i[7]=0,i[8]=s[8]*_,i[9]=s[9]*_,i[10]=s[10]*_,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,s=e.x,o=e.y,c=e.z,_=Math.cos(s),j=Math.sin(s),et=Math.cos(o),nt=Math.sin(o),st=Math.cos(c),at=Math.sin(c);if(e.order==="XYZ"){const ct=_*st,dt=_*at,mt=j*st,yt=j*at;i[0]=et*st,i[4]=-et*at,i[8]=nt,i[1]=dt+mt*nt,i[5]=ct-yt*nt,i[9]=-j*et,i[2]=yt-ct*nt,i[6]=mt+dt*nt,i[10]=_*et}else if(e.order==="YXZ"){const ct=et*st,dt=et*at,mt=nt*st,yt=nt*at;i[0]=ct+yt*j,i[4]=mt*j-dt,i[8]=_*nt,i[1]=_*at,i[5]=_*st,i[9]=-j,i[2]=dt*j-mt,i[6]=yt+ct*j,i[10]=_*et}else if(e.order==="ZXY"){const ct=et*st,dt=et*at,mt=nt*st,yt=nt*at;i[0]=ct-yt*j,i[4]=-_*at,i[8]=mt+dt*j,i[1]=dt+mt*j,i[5]=_*st,i[9]=yt-ct*j,i[2]=-_*nt,i[6]=j,i[10]=_*et}else if(e.order==="ZYX"){const ct=_*st,dt=_*at,mt=j*st,yt=j*at;i[0]=et*st,i[4]=mt*nt-dt,i[8]=ct*nt+yt,i[1]=et*at,i[5]=yt*nt+ct,i[9]=dt*nt-mt,i[2]=-nt,i[6]=j*et,i[10]=_*et}else if(e.order==="YZX"){const ct=_*et,dt=_*nt,mt=j*et,yt=j*nt;i[0]=et*st,i[4]=yt-ct*at,i[8]=mt*at+dt,i[1]=at,i[5]=_*st,i[9]=-j*st,i[2]=-nt*st,i[6]=dt*at+mt,i[10]=ct-yt*at}else if(e.order==="XZY"){const ct=_*et,dt=_*nt,mt=j*et,yt=j*nt;i[0]=et*st,i[4]=-at,i[8]=nt*st,i[1]=ct*at+yt,i[5]=_*st,i[9]=dt*at-mt,i[2]=mt*at-dt,i[6]=j*st,i[10]=yt*at+ct}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(OH,e,BH)}lookAt(e,i,s){const o=this.elements;return e0.subVectors(e,i),e0.lengthSq()===0&&(e0.z=1),e0.normalize(),O1.crossVectors(s,e0),O1.lengthSq()===0&&(Math.abs(s.z)===1?e0.x+=1e-4:e0.z+=1e-4,e0.normalize(),O1.crossVectors(s,e0)),O1.normalize(),DD.crossVectors(e0,O1),o[0]=O1.x,o[4]=DD.x,o[8]=e0.x,o[1]=O1.y,o[5]=DD.y,o[9]=e0.y,o[2]=O1.z,o[6]=DD.z,o[10]=e0.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,o=i.elements,c=this.elements,_=s[0],j=s[4],et=s[8],nt=s[12],st=s[1],at=s[5],ct=s[9],dt=s[13],mt=s[2],yt=s[6],wt=s[10],Ct=s[14],bt=s[3],At=s[7],Pt=s[11],Dt=s[15],Nt=o[0],Vt=o[4],Zt=o[8],an=o[12],fn=o[1],mn=o[5],Sn=o[9],An=o[13],wn=o[2],Mn=o[6],Pn=o[10],On=o[14],er=o[3],Zn=o[7],yr=o[11],lr=o[15];return c[0]=_*Nt+j*fn+et*wn+nt*er,c[4]=_*Vt+j*mn+et*Mn+nt*Zn,c[8]=_*Zt+j*Sn+et*Pn+nt*yr,c[12]=_*an+j*An+et*On+nt*lr,c[1]=st*Nt+at*fn+ct*wn+dt*er,c[5]=st*Vt+at*mn+ct*Mn+dt*Zn,c[9]=st*Zt+at*Sn+ct*Pn+dt*yr,c[13]=st*an+at*An+ct*On+dt*lr,c[2]=mt*Nt+yt*fn+wt*wn+Ct*er,c[6]=mt*Vt+yt*mn+wt*Mn+Ct*Zn,c[10]=mt*Zt+yt*Sn+wt*Pn+Ct*yr,c[14]=mt*an+yt*An+wt*On+Ct*lr,c[3]=bt*Nt+At*fn+Pt*wn+Dt*er,c[7]=bt*Vt+At*mn+Pt*Mn+Dt*Zn,c[11]=bt*Zt+At*Sn+Pt*Pn+Dt*yr,c[15]=bt*an+At*An+Pt*On+Dt*lr,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[4],o=e[8],c=e[12],_=e[1],j=e[5],et=e[9],nt=e[13],st=e[2],at=e[6],ct=e[10],dt=e[14];return e[3]*(+c*et*at-o*nt*at-c*j*ct+s*nt*ct+o*j*dt-s*et*dt)+e[7]*(+i*et*dt-i*nt*ct+c*_*ct-o*_*dt+o*nt*st-c*et*st)+e[11]*(+i*nt*at-i*j*dt-c*_*at+s*_*dt+c*j*st-s*nt*st)+e[15]*(-o*j*st-i*et*at+i*j*ct+o*_*at-s*_*ct+s*et*st)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,s){const o=this.elements;return e.isVector3?(o[12]=e.x,o[13]=e.y,o[14]=e.z):(o[12]=e,o[13]=i,o[14]=s),this}invert(){const e=this.elements,i=e[0],s=e[1],o=e[2],c=e[3],_=e[4],j=e[5],et=e[6],nt=e[7],st=e[8],at=e[9],ct=e[10],dt=e[11],mt=e[12],yt=e[13],wt=e[14],Ct=e[15],bt=at*wt*nt-yt*ct*nt+yt*et*dt-j*wt*dt-at*et*Ct+j*ct*Ct,At=mt*ct*nt-st*wt*nt-mt*et*dt+_*wt*dt+st*et*Ct-_*ct*Ct,Pt=st*yt*nt-mt*at*nt+mt*j*dt-_*yt*dt-st*j*Ct+_*at*Ct,Dt=mt*at*et-st*yt*et-mt*j*ct+_*yt*ct+st*j*wt-_*at*wt,Nt=i*bt+s*At+o*Pt+c*Dt;if(Nt===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Vt=1/Nt;return e[0]=bt*Vt,e[1]=(yt*ct*c-at*wt*c-yt*o*dt+s*wt*dt+at*o*Ct-s*ct*Ct)*Vt,e[2]=(j*wt*c-yt*et*c+yt*o*nt-s*wt*nt-j*o*Ct+s*et*Ct)*Vt,e[3]=(at*et*c-j*ct*c-at*o*nt+s*ct*nt+j*o*dt-s*et*dt)*Vt,e[4]=At*Vt,e[5]=(st*wt*c-mt*ct*c+mt*o*dt-i*wt*dt-st*o*Ct+i*ct*Ct)*Vt,e[6]=(mt*et*c-_*wt*c-mt*o*nt+i*wt*nt+_*o*Ct-i*et*Ct)*Vt,e[7]=(_*ct*c-st*et*c+st*o*nt-i*ct*nt-_*o*dt+i*et*dt)*Vt,e[8]=Pt*Vt,e[9]=(mt*at*c-st*yt*c-mt*s*dt+i*yt*dt+st*s*Ct-i*at*Ct)*Vt,e[10]=(_*yt*c-mt*j*c+mt*s*nt-i*yt*nt-_*s*Ct+i*j*Ct)*Vt,e[11]=(st*j*c-_*at*c-st*s*nt+i*at*nt+_*s*dt-i*j*dt)*Vt,e[12]=Dt*Vt,e[13]=(st*yt*o-mt*at*o+mt*s*ct-i*yt*ct-st*s*wt+i*at*wt)*Vt,e[14]=(mt*j*o-_*yt*o-mt*s*et+i*yt*et+_*s*wt-i*j*wt)*Vt,e[15]=(_*at*o-st*j*o+st*s*et-i*at*et-_*s*ct+i*j*ct)*Vt,this}scale(e){const i=this.elements,s=e.x,o=e.y,c=e.z;return i[0]*=s,i[4]*=o,i[8]*=c,i[1]*=s,i[5]*=o,i[9]*=c,i[2]*=s,i[6]*=o,i[10]*=c,i[3]*=s,i[7]*=o,i[11]*=c,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],o=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,s,o))}makeTranslation(e,i,s){return this.set(1,0,0,e,0,1,0,i,0,0,1,s,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,i,-s,0,0,s,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,0,s,0,0,1,0,0,-s,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,0,s,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const s=Math.cos(i),o=Math.sin(i),c=1-s,_=e.x,j=e.y,et=e.z,nt=c*_,st=c*j;return this.set(nt*_+s,nt*j-o*et,nt*et+o*j,0,nt*j+o*et,st*j+s,st*et-o*_,0,nt*et-o*j,st*et+o*_,c*et*et+s,0,0,0,0,1),this}makeScale(e,i,s){return this.set(e,0,0,0,0,i,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,i,s,o,c,_){return this.set(1,s,c,0,e,1,_,0,i,o,1,0,0,0,0,1),this}compose(e,i,s){const o=this.elements,c=i._x,_=i._y,j=i._z,et=i._w,nt=c+c,st=_+_,at=j+j,ct=c*nt,dt=c*st,mt=c*at,yt=_*st,wt=_*at,Ct=j*at,bt=et*nt,At=et*st,Pt=et*at,Dt=s.x,Nt=s.y,Vt=s.z;return o[0]=(1-(yt+Ct))*Dt,o[1]=(dt+Pt)*Dt,o[2]=(mt-At)*Dt,o[3]=0,o[4]=(dt-Pt)*Nt,o[5]=(1-(ct+Ct))*Nt,o[6]=(wt+bt)*Nt,o[7]=0,o[8]=(mt+At)*Vt,o[9]=(wt-bt)*Vt,o[10]=(1-(ct+yt))*Vt,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this}decompose(e,i,s){const o=this.elements;let c=BT.set(o[0],o[1],o[2]).length();const _=BT.set(o[4],o[5],o[6]).length(),j=BT.set(o[8],o[9],o[10]).length();this.determinant()<0&&(c=-c),e.x=o[12],e.y=o[13],e.z=o[14],ky.copy(this);const et=1/c,nt=1/_,st=1/j;return ky.elements[0]*=et,ky.elements[1]*=et,ky.elements[2]*=et,ky.elements[4]*=nt,ky.elements[5]*=nt,ky.elements[6]*=nt,ky.elements[8]*=st,ky.elements[9]*=st,ky.elements[10]*=st,i.setFromRotationMatrix(ky),s.x=c,s.y=_,s.z=j,this}makePerspective(e,i,s,o,c,_){const j=this.elements,et=2*c/(i-e),nt=2*c/(s-o),st=(i+e)/(i-e),at=(s+o)/(s-o),ct=-(_+c)/(_-c),dt=-2*_*c/(_-c);return j[0]=et,j[4]=0,j[8]=st,j[12]=0,j[1]=0,j[5]=nt,j[9]=at,j[13]=0,j[2]=0,j[6]=0,j[10]=ct,j[14]=dt,j[3]=0,j[7]=0,j[11]=-1,j[15]=0,this}makeOrthographic(e,i,s,o,c,_){const j=this.elements,et=1/(i-e),nt=1/(s-o),st=1/(_-c),at=(i+e)*et,ct=(s+o)*nt,dt=(_+c)*st;return j[0]=2*et,j[4]=0,j[8]=0,j[12]=-at,j[1]=0,j[5]=2*nt,j[9]=0,j[13]=-ct,j[2]=0,j[6]=0,j[10]=-2*st,j[14]=-dt,j[3]=0,j[7]=0,j[11]=0,j[15]=1,this}equals(e){const i=this.elements,s=e.elements;for(let o=0;o<16;o++)if(i[o]!==s[o])return!1;return!0}fromArray(e,i=0){for(let s=0;s<16;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e[i+9]=s[9],e[i+10]=s[10],e[i+11]=s[11],e[i+12]=s[12],e[i+13]=s[13],e[i+14]=s[14],e[i+15]=s[15],e}}const BT=new Kp,ky=new D0,OH=new Kp(0,0,0),BH=new Kp(1,1,1),O1=new Kp,DD=new Kp,e0=new Kp,XF=new D0,YF=new s2;class kD{constructor(e=0,i=0,s=0,o=kD.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=s,this._order=o}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,s,o=this._order){return this._x=e,this._y=i,this._z=s,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,s=!0){const o=e.elements,c=o[0],_=o[4],j=o[8],et=o[1],nt=o[5],st=o[9],at=o[2],ct=o[6],dt=o[10];switch(i){case"XYZ":this._y=Math.asin(Gt(j,-1,1)),Math.abs(j)<.9999999?(this._x=Math.atan2(-st,dt),this._z=Math.atan2(-_,c)):(this._x=Math.atan2(ct,nt),this._z=0);break;case"YXZ":this._x=Math.asin(-Gt(st,-1,1)),Math.abs(st)<.9999999?(this._y=Math.atan2(j,dt),this._z=Math.atan2(et,nt)):(this._y=Math.atan2(-at,c),this._z=0);break;case"ZXY":this._x=Math.asin(Gt(ct,-1,1)),Math.abs(ct)<.9999999?(this._y=Math.atan2(-at,dt),this._z=Math.atan2(-_,nt)):(this._y=0,this._z=Math.atan2(et,c));break;case"ZYX":this._y=Math.asin(-Gt(at,-1,1)),Math.abs(at)<.9999999?(this._x=Math.atan2(ct,dt),this._z=Math.atan2(et,c)):(this._x=0,this._z=Math.atan2(-_,nt));break;case"YZX":this._z=Math.asin(Gt(et,-1,1)),Math.abs(et)<.9999999?(this._x=Math.atan2(-st,nt),this._y=Math.atan2(-at,c)):(this._x=0,this._y=Math.atan2(j,dt));break;case"XZY":this._z=Math.asin(-Gt(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(ct,nt),this._y=Math.atan2(j,c)):(this._x=Math.atan2(-st,dt),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,s){return XF.makeRotationFromQuaternion(e),this.setFromRotationMatrix(XF,i,s)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return YF.setFromEuler(this),this.setFromQuaternion(YF,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}kD.DEFAULT_ORDER="XYZ";class LH{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}}let NH=0;const $F=new Kp,LT=new s2,cx=new D0,OD=new Kp,o2=new Kp,UH=new Kp,FH=new s2,KF=new Kp(1,0,0),JF=new Kp(0,1,0),ZF=new Kp(0,0,1),jH={type:"added"},_j={type:"removed"};class B1 extends jF{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:NH++}),this.uuid=sn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=B1.DEFAULT_UP.clone();const e=new Kp,i=new kD,s=new s2,o=new Kp(1,1,1);i._onChange(function(){s.setFromEuler(i,!1)}),s._onChange(function(){i.setFromQuaternion(s,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new D0},normalMatrix:{value:new Ho}}),this.matrix=new D0,this.matrixWorld=new D0,this.matrixAutoUpdate=B1.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=B1.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new LH,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(e,i,s,o,c,_){this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:o,material:c,group:_})}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return LT.setFromAxisAngle(e,i),this.quaternion.multiply(LT),this}rotateOnWorldAxis(e,i){return LT.setFromAxisAngle(e,i),this.quaternion.premultiply(LT),this}rotateX(e){return this.rotateOnAxis(KF,e)}rotateY(e){return this.rotateOnAxis(JF,e)}rotateZ(e){return this.rotateOnAxis(ZF,e)}translateOnAxis(e,i){return $F.copy(e).applyQuaternion(this.quaternion),this.position.add($F.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(KF,e)}translateY(e){return this.translateOnAxis(JF,e)}translateZ(e){return this.translateOnAxis(ZF,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(cx.copy(this.matrixWorld).invert())}lookAt(e,i,s){e.isVector3?OD.copy(e):OD.set(e,i,s);const o=this.parent;this.updateWorldMatrix(!0,!1),o2.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?cx.lookAt(o2,OD,this.up):cx.lookAt(OD,o2,this.up),this.quaternion.setFromRotationMatrix(cx),o&&(cx.extractRotation(o.matrixWorld),LT.setFromRotationMatrix(cx),this.quaternion.premultiply(LT.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(jH)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(_j)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const i=this.children[e];i.parent=null,i.dispatchEvent(_j)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),cx.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),cx.multiply(e.parent.matrixWorld)),e.applyMatrix4(cx),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let s=0,o=this.children.length;s<o;s++){const c=this.children[s].getObjectByProperty(e,i);if(c!==void 0)return c}}getObjectsByProperty(e,i){let s=[];this[e]===i&&s.push(this);for(let o=0,c=this.children.length;o<c;o++){const _=this.children[o].getObjectsByProperty(e,i);_.length>0&&(s=s.concat(_))}return s}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(o2,e,UH),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(o2,FH,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let s=0,o=i.length;s<o;s++){const c=i[s];c.matrixWorldAutoUpdate!==!0&&e!==!0||c.updateMatrixWorld(e)}}updateWorldMatrix(e,i){const s=this.parent;if(e===!0&&s!==null&&s.matrixWorldAutoUpdate===!0&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const o=this.children;for(let c=0,_=o.length;c<_;c++){const j=o[c];j.matrixWorldAutoUpdate===!0&&j.updateWorldMatrix(!1,!0)}}}toJSON(e){const i=e===void 0||typeof e=="string",s={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const o={};function c(j,et){return j[et.uuid]===void 0&&(j[et.uuid]=et.toJSON(e)),et.uuid}if(o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),o.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(o.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=c(e.geometries,this.geometry);const j=this.geometry.parameters;if(j!==void 0&&j.shapes!==void 0){const et=j.shapes;if(Array.isArray(et))for(let nt=0,st=et.length;nt<st;nt++){const at=et[nt];c(e.shapes,at)}else c(e.shapes,et)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(c(e.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const j=[];for(let et=0,nt=this.material.length;et<nt;et++)j.push(c(e.materials,this.material[et]));o.material=j}else o.material=c(e.materials,this.material);if(this.children.length>0){o.children=[];for(let j=0;j<this.children.length;j++)o.children.push(this.children[j].toJSON(e).object)}if(this.animations.length>0){o.animations=[];for(let j=0;j<this.animations.length;j++){const et=this.animations[j];o.animations.push(c(e.animations,et))}}if(i){const j=_(e.geometries),et=_(e.materials),nt=_(e.textures),st=_(e.images),at=_(e.shapes),ct=_(e.skeletons),dt=_(e.animations),mt=_(e.nodes);j.length>0&&(s.geometries=j),et.length>0&&(s.materials=et),nt.length>0&&(s.textures=nt),st.length>0&&(s.images=st),at.length>0&&(s.shapes=at),ct.length>0&&(s.skeletons=ct),dt.length>0&&(s.animations=dt),mt.length>0&&(s.nodes=mt)}return s.object=o,s;function _(j){const et=[];for(const nt in j){const st=j[nt];delete st.metadata,et.push(st)}return et}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData={};for(const[s,o]of Object.entries(e.userData))this.userData[s]=!o||o&&(o.isTexture||o.isObject3D)?o:JSON.parse(JSON.stringify(o));if(i===!0)for(let s=0;s<e.children.length;s++){const o=e.children[s];this.add(o.clone())}return this}}B1.DEFAULT_UP=new Kp(0,1,0),B1.DEFAULT_MATRIX_AUTO_UPDATE=!0,B1.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class zH extends B1{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new D0,this.projectionMatrix=new D0,this.projectionMatrixInverse=new D0}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(-i[8],-i[9],-i[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class VH extends FL{constructor(e){super(e),this.camera=e,this.traverse(i=>{i.userData.__keepShadowDef=!0,i.castShadow=!1,i.receiveShadow=!1})}}class HL extends VH{constructor(e){super(e),this._vector=new Kp,this._camera=new zH;const i=new rA,s=new sv({color:16777215,linewidth:.005,vertexColors:!0,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),{vertices:o,colors:c,pointMap:_}=function(){const ct=[],dt=[],mt={};function yt(Ct,bt){wt(Ct),wt(bt)}function wt(Ct){ct.push(0,0,0),dt.push(0,0,0),mt[Ct]===void 0&&(mt[Ct]=[]),mt[Ct].push(ct.length/3-1)}return yt("n1","n2"),yt("n2","n4"),yt("n4","n3"),yt("n3","n1"),yt("f1","f2"),yt("f2","f4"),yt("f4","f3"),yt("f3","f1"),yt("n1","f1"),yt("n2","f2"),yt("n3","f3"),yt("n4","f4"),yt("p","n1"),yt("p","n2"),yt("p","n3"),yt("p","n4"),yt("u1","u2"),yt("u2","u3"),yt("u3","u1"),yt("c","t"),yt("p","c"),yt("cn1","cn2"),yt("cn3","cn4"),yt("cf1","cf2"),yt("cf3","cf4"),{vertices:ct,colors:dt,pointMap:mt}}();i.setPositions(o),i.setColors(c),this.line=new QP(i,s),this.line.frustumCulled=!1,this.add(this.line),this.pointMap=_,this.update();const j=new To(16755200),et=new To(16711680),nt=new To(43775),st=new To(16777215),at=new To(3355443);this.setColors(j,et,nt,st,at)}setColors(e,i,s,o,c){const _=this.line.geometry,j=_.getAttribute("instanceColorStart"),et=_.getAttribute("instanceColorEnd");function nt(st,at){j.setXYZ(st/2,at.r,at.g,at.b),et.setXYZ(st/2,at.r,at.g,at.b)}nt(0,e),nt(2,e),nt(4,e),nt(6,e),nt(8,e),nt(10,e),nt(12,e),nt(14,e),nt(16,e),nt(18,e),nt(20,e),nt(22,e),nt(24,i),nt(26,i),nt(28,i),nt(30,i),nt(32,s),nt(34,s),nt(36,s),nt(38,o),nt(40,c),nt(42,c),nt(44,c),nt(46,c),nt(48,c),j.needsUpdate=!0,et.needsUpdate=!0}update(){if(!this.camera)return;const e=this.line.geometry,i=this.pointMap,{_camera:s,_vector:o}=this;s.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Dp("c",i,e,s,0,0,-1,o),Dp("t",i,e,s,0,0,1,o),Dp("n1",i,e,s,-1,-1,-1,o),Dp("n2",i,e,s,1,-1,-1,o),Dp("n3",i,e,s,-1,1,-1,o),Dp("n4",i,e,s,1,1,-1,o),Dp("f1",i,e,s,-1,-1,1,o),Dp("f2",i,e,s,1,-1,1,o),Dp("f3",i,e,s,-1,1,1,o),Dp("f4",i,e,s,1,1,1,o),Dp("u1",i,e,s,.7,1.1,-1,o),Dp("u2",i,e,s,-.7,1.1,-1,o),Dp("u3",i,e,s,0,2,-1,o),Dp("cf1",i,e,s,-1,0,1,o),Dp("cf2",i,e,s,1,0,1,o),Dp("cf3",i,e,s,0,-1,1,o),Dp("cf4",i,e,s,0,1,1,o),Dp("cn1",i,e,s,-1,0,-1,o),Dp("cn2",i,e,s,1,0,-1,o),Dp("cn3",i,e,s,0,-1,-1,o),Dp("cn4",i,e,s,0,1,-1,o),e.getAttribute("instanceStart").needsUpdate=!0,e.getAttribute("instanceEnd").needsUpdate=!0,e.computeBoundingBox(),e.computeBoundingSphere()}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),super.dispose()}static Check(e){return e.isCamera}static Create(e){return new HL(e)}}function Dp(h,e,i,s,o,c,_,j){j.set(o,c,_).unproject(s);const et=e[h];if(et!==void 0){const nt=i.getAttribute("instanceStart"),st=i.getAttribute("instanceEnd");for(let at=0,ct=et.length;at<ct;at++){const dt=Math.floor(et[at]/2);(et[at]%2==0?nt:st).setXYZ(dt,j.x,j.y,j.z)}}}class TS extends ms{constructor(){super(...arguments),this.enabled=!0,this.helpers=[ax,CS,lx,HL],this.visible=!0,this.toJSON=null,this._addSceneObject=e=>{const i=e.object;this._createWidgets(i==null?void 0:i.modelObject)},this.widgets=[],this.uiConfig={type:"folder",label:"Widgets",children:[{type:"checkbox",label:"Visible",property:[this,"visible"]},{type:"button",label:"Refresh",value:()=>this.refresh()}]}}_onVisibleChange(){var e,i;(e=this.widgets)==null||e.forEach(s=>s.visible=this.visible),(i=this._viewer)==null||i.setDirty()}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),this.widgets.forEach(i=>i.dispose&&i.dispose()),this.widgets=[],super.onRemove(e)}refresh(){var e;this._createWidgets((e=this._viewer)==null?void 0:e.scene.modelRoot)}_createWidgets(e){e==null||e.traverse(i=>{const s=this.widgets.find(o=>o.object===i);if(s)return void(s.update&&s.update());this.helpers.filter(o=>o.Check(i)).forEach(o=>{var _;const c=o.Create(i);this.widgets.push(c),(_=this._viewer)==null||_.scene.addWidget(c)})})}}TS.PluginType="WidgetsPlugin",function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);c>3&&_&&Object.defineProperty(e,i,_)}([(0,b.onChange)(TS.prototype._onVisibleChange)],TS.prototype,"visible",void 0);var GH=NE({defaultModifiers:[qC,d1,YC,jn]}),HH=__webpackgi_require__(388),QH=__webpackgi_require__.n(HH);function WH(h){const e=[];h.traverse(o=>{o.geometry&&e.push(o)});const i={},s={};e.forEach(o=>{if(!i[o.geometry.uuid]){const j=o.geometry.toJSON().data,et=j?QH()({a:j.attributes||{},b:j.index||[]}):"";i[o.geometry.uuid]=et}const c=i[o.geometry.uuid],_=s[c]??(s[c]=[]);_.includes(o)||_.push(o)}),Object.values(s).forEach(o=>{if(o.length<2)return;const c=o[0].geometry;o.forEach((_,j)=>{j<1||(_.geometry.dispose(),_.geometry=c)})})}const ux=new g.Pa4,MS=new g.Pa4,BD=new g.Pa4,QL=new g.Pa4,LD=new g.Pa4,NT=new g.Pa4;let WL=1;const qH=new g.Pa4(0,1,0);class XH extends fx{constructor(e,i){super(e,i),this.throttleUpdate=60,this.targetOffset=new g.Pa4(0,0,0);const s=this.update;this.update=()=>this._update(s)}_update(e){this.target.add(this.targetOffset),ux.copy(this.object.position).sub(this.target),WL=ux.length(),NT.copy(this.target);const i=e();return NT.sub(this.target),ux.copy(this.object.position).sub(this.target),WL/=ux.length(),this.target.add(NT),this.object.position.copy(this.target).add(ux),ux.normalize(),MS.crossVectors(qH,ux).normalize(),BD.crossVectors(ux,MS).normalize(),QL.crossVectors(MS,BD).normalize().negate(),MS.length()>.1&&this.object.up.crossVectors(ux.clone().normalize(),MS),this.enablePan&&(LD.set(0,0,0).addScaledVector(MS,NT.x).addScaledVector(BD,NT.y).addScaledVector(QL,NT.z),this.targetOffset.add(LD),this.targetOffset.multiplyScalar(1/WL)),LD.set(0,0,0).addScaledVector(MS,-this.targetOffset.x).addScaledVector(BD,-this.targetOffset.y).addScaledVector(QL,-this.targetOffset.z),this.object.lookAt(LD.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),i}}class ND extends b.SimpleEventDispatcher{_setOptions(e){var i;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=ND.GetSupportedMimeTypes([],["h264"],!0)??ND.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!((i=this._options.mimeType)!=null&&i.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,i){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=o=>{var c;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const _=new Blob(this._currentRecording,{type:this._options.mimeType});(c=this._recordingCallback)==null||c.call(this,_)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=o=>{var c;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((c=this._recorder)==null||c.pause())},this._onresume=o=>{if(!this.stepMode)return;const c=()=>{var j;this._state==="recording"&&((j=this._recorder)==null||j.pause())},_=Math.min(this._resumeSyncTime-(0,b.now)(),0)+1e3/this._options.frameRate;_>0?(0,b.timeout)(_).then(c):c()},this._onpause=o=>{},this._ondataavailable=o=>{o.data&&o.data.size>0&&this._currentRecording.push(o.data)},this._onerror=o=>{this._state="error",this._console.error(o),this.dispatchEvent({type:"error",error:o}),this._recorder=void 0},this._canvas=e;const s=i==null?void 0:i.mimeType;this._options={mimeType:s||"auto",frameRate:30,stepMode:!1},this._setOptions(i||this._options)}isRecording(){return this._state==="recording"}start(){var i,s,o;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const e={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(i=e.mimeType)==null?void 0:i.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const c=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),_=(s=c.getVideoTracks())==null?void 0:s[0];this._track=_,this._recorder=new window.MediaRecorder(c,e),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(o=this._recorder)==null||o.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async c=>{const _=await(c==null?void 0:c.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=_,this._state="recording",this._onstart({})}).catch(c=>{this._onerror({detail:c})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const i=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),i]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=(0,b.now)(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const i=await Promise.all(e.map(async([o,c])=>await(await fetch(c)).blob())),s=[];for(let o=0;o<e.length;o++){const c=await this._imgDirectory.getFileHandle(e[o][0],{create:!0});s.push((0,b.writeFile)(c,i[o]))}await Promise.all(s)}static GetSupportedMimeTypes(e,i,s=!1){if(!window.MediaRecorder)return s?void 0:[];const o=["webm","ogg","mp4","x-matroska"].filter(j=>!e||e.length<1||e.includes(j)),c=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(j=>!i||i.length<1||i.includes(j)),_=[];return o.forEach(j=>{const et=`video/${j}`;c.forEach(nt=>{[`${et};codecs=${nt}`,`${et};codecs:${nt}`,`${et};codecs=${nt.toUpperCase()}`,`${et};codecs:${nt.toUpperCase()}`,`${et}`].forEach(st=>{MediaRecorder.isTypeSupported(st)&&_.push(st)})})}),s?_.length>0?_[0]:void 0:_}}class YH extends ZS{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new g.cJO(1,0))}}function qL(h,e){const i=Array.from((h.access??"").split(".")),s=i.pop();let o=h.targetObject??e;if(!s||s.length===0)return{key:void 0,tar:o};if(o=(0,b.deepAccessObject)(i,o),o&&!(s in o))throw console.error("invalid key",s,o,e,h),"";return{key:s,tar:o}}function XL(h,e,i,s){const{key:o,tar:c}=qL(h,e);return o&&c?MC(c,o,()=>{var _;i&&((_=h.updater)!=null&&_.length)&&h.updater.forEach(j=>i[j]()),s==null||s()}):_=>console.warn("Unable to set ",_,o,c,h,e)}async function UD(h,e,i){const{key:s,tar:o}=qL(e,h),c=e.animSet?[$j(o,e.animSet,i,e.animSetParallel??!1)]:[];if(s&&o){const _=e.updater??[],j=async()=>CE(o,s,{...e,onUpdate:et=>{var nt;(nt=e.onUpdate)==null||nt.call(e,et),_.forEach(st=>{var at;return(at=i[st])==null?void 0:at.call(i)})}});e.delay?c.push((0,b.timeout)(e.delay).then(j)):c.push(j())}else(e.duration||e.delay)&&c.push((0,b.timeout)((e.delay??0)+(e.duration??0)));return c.length===1?c[0]:Promise.all(c)}async function $j(h,e,i,s=!1){if(s)return Promise.all(e.map(async o=>UD(h,o,i)));for(const o of e)await UD(h,o,i)}function e4(h,e,i,s){var _,j;if(!h)return;e||(e=[]);const o=s??{},c=h;for(let et=0,nt=e.length;et<nt;et++){const st=e[et];if(st.uiRef){const ct=(c==null?void 0:c.indexOf(st.uiRef))??-1;ct!==et&&(ct>=0&&(c==null||c.splice(ct,1)),c==null||c.splice(et,0,st.uiRef))}else{st.uiRef={type:"folder",label:st.name??"Animation "+et,children:[]};const ct=[{type:"button",label:"animate",value:()=>{UD(i,st,o).then(()=>{var dt;return console.log(((dt=st.uiRef)==null?void 0:dt.label)+" finished")})}}];st.access!==void 0&&ct.push({type:"input",property:[st,"access"]}),st.from!==void 0&&ct.push({type:st.uiObjectType??"input",property:[st,"from"],onChange:()=>{var dt;XL(st,i)(st.from),(dt=st.updater)==null||dt.forEach(mt=>mt in o&&o[mt]())}}),st.to!==void 0&&ct.push({type:st.uiObjectType??"input",property:[st,"to"],onChange:()=>{var dt;XL(st,i)(st.to),(dt=st.updater)==null||dt.forEach(mt=>mt in o&&o[mt]())}}),st.duration!==void 0&&ct.push({type:"input",property:[st,"duration"]}),st.animSet&&(st.animSetParallel||(st.animSetParallel=!1),ct.push({type:"input",label:"run parallel",property:[st,"animSetParallel"]})),st.animSet&&ct.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),(_=st.uiRef.children)==null||_.push(...ct),c==null||c.splice(et,0,st.uiRef)}const at=(j=st.uiRef.children)==null?void 0:j.map(ct=>(0,b.getOrCall)(ct)).flat(2).find(ct=>ct==null?void 0:ct.animSetContainer);st.animSet&&at&&e4(at.children,st.animSet,st.targetObject??i,s)}}const YL=new TextEncoder,$H={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},KH=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class JH{constructor({accessKeyId:e,secretAccessKey:i,sessionToken:s,service:o,region:c,cache:_,retries:j,initRetryMs:et}){if(e==null)throw new TypeError("accessKeyId is a required option");if(i==null)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=e,this.secretAccessKey=i,this.sessionToken=s,this.service=o,this.region=c,this.cache=_||new Map,this.retries=j??10,this.initRetryMs=et||50}async sign(e,i){if(e instanceof Request){const{method:c,url:_,headers:j,body:et}=e;(i=Object.assign({method:c,url:_,headers:j},i)).body==null&&j.has("Content-Type")&&(i.body=et!=null&&j.has("X-Amz-Content-Sha256")?et:await e.clone().arrayBuffer()),e=_}const s=new ZH(Object.assign({url:e},i,this,i&&i.aws)),o=Object.assign({},i,await s.sign());delete o.aws;try{return new Request(o.url.toString(),o)}catch(c){if(c instanceof TypeError)return new Request(o.url.toString(),Object.assign({duplex:"half"},o));throw c}}async fetch(e,i){for(let s=0;s<=this.retries;s++){const o=fetch(await this.sign(e,i));if(s===this.retries)return o;const c=await o;if(c.status<500&&c.status!==429)return c;await new Promise(_=>setTimeout(_,Math.random()*this.initRetryMs*Math.pow(2,s)))}throw new Error("An unknown error occurred, ensure retries is not negative")}}class ZH{constructor({method:e,url:i,headers:s,body:o,accessKeyId:c,secretAccessKey:_,sessionToken:j,service:et,region:nt,cache:st,datetime:at,signQuery:ct,appendSessionToken:dt,allHeaders:mt,singleEncode:yt}){if(i==null)throw new TypeError("url is a required option");if(c==null)throw new TypeError("accessKeyId is a required option");if(_==null)throw new TypeError("secretAccessKey is a required option");let wt,Ct;this.method=e||(o?"POST":"GET"),this.url=new URL(i),this.headers=new Headers(s||{}),this.body=o,this.accessKeyId=c,this.secretAccessKey=_,this.sessionToken=j,et&&nt||([wt,Ct]=function(Pt,Dt){const{hostname:Nt,pathname:Vt}=Pt;if(Nt.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(Nt.endsWith(".backblazeb2.com")){const mn=Nt.match(/^(?:[^.]+\.)?s3\.([^.]+)\.backblazeb2\.com$/);return mn!=null?["s3",mn[1]]:["",""]}const Zt=Nt.replace("dualstack.","").match(/([^.]+)\.(?:([^.]*)\.)?amazonaws\.com(?:\.cn)?$/);let[an,fn]=(Zt||["",""]).slice(1,3);if(fn==="us-gov")fn="us-gov-west-1";else if(fn==="s3"||fn==="s3-accelerate")fn="us-east-1",an="s3";else if(an==="iot")an=Nt.startsWith("iot.")?"execute-api":Nt.startsWith("data.jobs.iot.")?"iot-jobs-data":Vt==="/mqtt"?"iotdevicegateway":"iotdata";else if(an==="autoscaling"){const mn=(Dt.get("X-Amz-Target")||"").split(".")[0];mn==="AnyScaleFrontendService"?an="application-autoscaling":mn==="AnyScaleScalingPlannerFrontendService"&&(an="autoscaling-plans")}else fn==null&&an.startsWith("s3-")?(fn=an.slice(3).replace(/^fips-|^external-1/,""),an="s3"):an.endsWith("-fips")?an=an.slice(0,-5):fn&&/-\d$/.test(an)&&!/-\d$/.test(fn)&&([an,fn]=[fn,an]);return[$H[an]||an,fn]}(this.url,this.headers)),this.service=et||wt||"",this.region=nt||Ct||"us-east-1",this.cache=st||new Map,this.datetime=at||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=ct,this.appendSessionToken=dt||this.service==="iotdevicegateway",this.headers.delete("Host"),this.service!=="s3"||this.signQuery||this.headers.has("X-Amz-Content-Sha256")||this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const bt=this.signQuery?this.url.searchParams:this.headers;if(bt.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&bt.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(Pt=>mt||!KH.has(Pt)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(Pt=>Pt+":"+(Pt==="host"?this.url.host:(this.headers.get(Pt)||"").replace(/\s+/g," "))).join(`
`),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&(this.service!=="s3"||bt.has("X-Amz-Expires")||bt.set("X-Amz-Expires","86400"),bt.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),bt.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),bt.set("X-Amz-SignedHeaders",this.signedHeaders)),this.service==="s3")try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch{this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");yt||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=n4(this.encodedPath);const At=new Set;this.encodedSearch=[...this.url.searchParams].filter(([Pt])=>{if(!Pt)return!1;if(this.service==="s3"){if(At.has(Pt))return!1;At.add(Pt)}return!0}).map(Pt=>Pt.map(Dt=>n4(encodeURIComponent(Dt)))).sort(([Pt,Dt],[Nt,Vt])=>Pt<Nt?-1:Pt>Nt?1:Dt<Vt?-1:Dt>Vt?1:0).map(Pt=>Pt.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const e=this.datetime.slice(0,8),i=[this.secretAccessKey,e,this.region,this.service].join();let s=this.cache.get(i);if(!s){const o=await a2("AWS4"+this.secretAccessKey,e),c=await a2(o,this.region),_=await a2(c,this.service);s=await a2(_,"aws4_request"),this.cache.set(i,s)}return $L(await a2(s,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,$L(await t4(await this.canonicalString()))].join(`
`)}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+`
`,this.signedHeaders,await this.hexBodyHash()].join(`
`)}async hexBodyHash(){let e=this.headers.get("X-Amz-Content-Sha256")||(this.service==="s3"&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(e==null){if(this.body&&typeof this.body!="string"&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");e=$L(await t4(this.body||""))}return e}}async function a2(h,e){const i=await crypto.subtle.importKey("raw",typeof h=="string"?YL.encode(h):h,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",i,YL.encode(e))}async function t4(h){return crypto.subtle.digest("SHA-256",typeof h=="string"?YL.encode(h):h)}function $L(h){return Array.prototype.map.call(new Uint8Array(h),e=>("0"+e.toString(16)).slice(-2)).join("")}function n4(h){return h.replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())}var IS=function(h,e,i,s){var o,c=arguments.length,_=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(h,e,i,s);else for(var j=h.length-1;j>=0;j--)(o=h[j])&&(_=(c<3?o(_):c>3?o(e,i,_):o(e,i))||_);return c>3&&_&&Object.defineProperty(e,i,_),_};let t0=class extends ms{constructor(){super(),this.enabled=!0,this._connected=!1,this.dependencies=[jI],this.accessKeyId="",this.accessKeySecret="",this.endpointURL="",this.pathPrefix="webgi",this.serializeSettings=!1,this.toggleConnection=()=>{this._connected?this.disconnect():this.connect()},this.serializeWithViewer=!1}connect(){this._connected&&this.disconnect(),this._client=new JH({accessKeyId:this.accessKeyId,secretAccessKey:this.accessKeySecret}),this._connected=!0,this.refreshUi()}refreshUi(){var h,e;(e=(h=this.uiConfig)==null?void 0:h.uiRefresh)==null||e.call(h,"postFrame",!0)}disconnect(){this._client=void 0,this._connected=!1,this.refreshUi()}get connected(){return this._connected}get client(){return this._client}toJSON(h){return this.serializeSettings?super.toJSON(h):{type:this.constructor.PluginType}}async onAdded(h){await super.onAdded(h);const e=h.getPlugin(jI);e.actions.exportFile=async(i,s,o)=>{if(!this._connected)return void await e.defaultActions.exportFile(i,s);const c=(0,b.pathJoin)([this.endpointURL,this.pathPrefix,s]),_=await this._fetch(c,{method:"PUT",body:i},o);if(!_.ok)return h.console.error("Error uploading file",_),void await e.defaultActions.exportFile(i,s);this.dispatchEvent({type:"fileUpload",name:s,blob:i,response:_,path:c}),h.console.log("File uploaded",_)}}async _fetch(h,e,i){if(!this._client)throw new Error("Not connected");for(let s=0;s<=this._client.retries;s++){const o=fetch(await this._client.sign(h,e));if(s===this._client.retries)return o;const c=await o;if(c.status<500&&c.status!==429)return c;await(0,b.timeout)(Math.random()*this._client.initRetryMs*Math.pow(2,s))}throw new Error("An unknown error occurred, ensure retries is not negative")}};t0.PluginType="AWSClientPlugin1",IS([En(),$s("Access Key ID",h=>({disabled:()=>!h.enabled||h._connected}))],t0.prototype,"accessKeyId",void 0),IS([En(),$s("Access Key Secret",h=>({disabled:()=>!h.enabled||h._connected}))],t0.prototype,"accessKeySecret",void 0),IS([En(),$s("Endpoint URL",h=>({disabled:()=>!h.enabled||h._connected}))],t0.prototype,"endpointURL",void 0),IS([En(),$s("Path Prefix",h=>({disabled:()=>!h.enabled}))],t0.prototype,"pathPrefix",void 0),IS([En(),jr("Remember",h=>({disabled:()=>!h.enabled||h._connected}))],t0.prototype,"serializeSettings",void 0),IS([Oo(void 0,h=>({label:()=>h._connected?"Disconnect":"Connect"}))],t0.prototype,"toggleConnection",void 0),t0=IS([ks("S3 Connection")],t0);const e8={Background:new A1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/background",assets:["gradient-radial-dark-blue.svg","gradient-radial-grey.svg","gradient-radial-red.svg","gradient-radial-aqua.svg","gradient-radial-green.svg","gradient-radial-white.svg","gradient-radial-coral.svg","gradient-radial-fuchsia.svg","gradient-radial-blue.svg","gradient-radial-black.svg","gradient-radial-light-blue.svg","gradient-radial-gray.svg","gradient-radial-beige.svg","gradient-radial-antrasit.svg","gradient-linear-light-blue.svg","gradient-linear-gray.svg","gradient-linear-beige.svg","gradient-linear-antrasit.svg","bg-1.jpg","bg-2.png"].map(h=>({path:h}))}).assets,Environment:new A1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-metal-1.hdr","env-metal-2.hdr","env-metal-3.hdr","env-metal-4.hdr","env-metal-5.hdr","env-metal-6.hdr","env-metal-7.hdr","env-metal-8.hdr","env-metal-9.hdr","env-metal-10.hdr","env-metal-11.hdr","env-metal-12.hdr","env-metal-13.hdr","env-metal-14.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr","env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","alps_field_1k.hdr","paul_lobe_haus_1k.hdr","derelict_highway_midday_1k.hdr","neon_photostudio_1k.hdr","studio_small_08_1k.hdr","evening_meadow_1k.hdr","st_peters_square_night_1k.hdr","studio_small_07_1k.hdr","moonless_golf_1k.hdr","satara_night_1k.hdr","venice_sunset_1k.hdr","umhlanga_sunrise_1k.hdr","studio_country_hall_1k.hdr"].map(h=>({path:h}))}).assets,GemEnvironment:new A1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(h=>({path:h}))}).assets,Ground:new A1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/ground",assets:["ground-1.json","ground-2.json","ground-3.json","g-1.json","g-2.json","g-3.json","g-4.json","g-5.json"].map(h=>({path:h}))}).assets,CameraViews:new A1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/views",assets:["views-1.json","views-2.json"].map(h=>({path:h}))}).assets,MaterialConfiguration:new A1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-conf",assets:["gold-ceramic.json","gold.json","metal-diamond.json"].map(h=>({path:h}))}).assets,MaterialLibraries:new A1({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-lib",assets:["metal.zip","gem.zip"].map(h=>({path:h}))}).assets};function r4(h,e){return e?h*(1e3/e):0}function t8(h){var e,i=h.from,s=i===void 0?0:i,o=h.velocity,c=o===void 0?0:o,_=h.min,j=h.max,et=h.power,nt=et===void 0?.8:et,st=h.timeConstant,at=st===void 0?750:st,ct=h.bounceStiffness,dt=ct===void 0?500:ct,mt=h.bounceDamping,yt=mt===void 0?10:mt,wt=h.restDelta,Ct=wt===void 0?1:wt,bt=h.modifyTarget,At=h.driver,Pt=h.onUpdate,Dt=h.onComplete,Nt=h.onStop;function Vt(Pn){return _!==void 0&&Pn<_||j!==void 0&&Pn>j}function Zt(Pn){return _===void 0?j:j===void 0||Math.abs(_-Pn)<Math.abs(j-Pn)?_:j}function an(Pn){e==null||e.stop(),e=b0(xu(xu({},Pn),{driver:At,onUpdate:function(On){var er;Pt==null||Pt(On),(er=Pn.onUpdate)===null||er===void 0||er.call(Pn,On)},onComplete:Dt,onStop:Nt}))}function fn(Pn){an(xu({type:"spring",stiffness:dt,damping:yt,restDelta:Ct},Pn))}if(Vt(s))fn({from:s,velocity:c,to:Zt(s)});else{var mn=nt*c+s;bt!==void 0&&(mn=bt(mn));var Sn,An,wn=Zt(mn),Mn=wn===_?-1:1;an({type:"decay",from:s,velocity:c,timeConstant:at,power:nt,restDelta:Ct,modifyTarget:bt,onUpdate:Vt(mn)?function(Pn){Sn=An,An=Pn,c=r4(Pn-Sn,xM().delta),(Mn===1&&Pn>wn||Mn===-1&&Pn<wn)&&fn({from:Pn,to:wn,velocity:c})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var i4=function(h){return 180*h/Math.PI},n8=function(h,e){return e===void 0&&(e=xE),i4(Math.atan2(e.y-h.y,e.x-h.x))},r8=function(h,e){var i=!0;return e===void 0&&(e=h,i=!1),function(s){return i?s-h+e:(h=s,i=!0,e)}},i8=function(h){return h},KL=function(h){return h===void 0&&(h=i8),function(e,i,s){var o=i-s,c=-(0-e+1)*(0-h(Math.abs(o)));return o<=0?i+c:i-c}},s8=KL(),o8=KL(Math.sqrt),s4=function(h){return h*Math.PI/180},FD=function(h){return h.hasOwnProperty("x")&&h.hasOwnProperty("y")},JL=function(h){return FD(h)&&h.hasOwnProperty("z")},jD=function(h,e){return Math.abs(h-e)};function a8(h,e){if(EC(h)&&EC(e))return jD(h,e);if(FD(h)&&FD(e)){var i=jD(h.x,e.x),s=jD(h.y,e.y),o=JL(h)&&JL(e)?jD(h.z,e.z):0;return Math.sqrt(Math.pow(i,2)+Math.pow(s,2)+Math.pow(o,2))}}var l8=function(h,e,i){return e=s4(e),{x:i*Math.cos(e)+h.x,y:i*Math.sin(e)+h.y}},o4=function(h,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(h*e)/e},a4=function(h,e,i,s){return s===void 0&&(s=0),o4(h+i*(e-h)/Math.max(s,i))},c8=function(h){h===void 0&&(h=50);var e=0,i=0;return function(s){var o=xM().timestamp,c=o!==i?o-i:0,_=c?a4(e,s,c,h):e;return i=o,e=_,_}},u8=function(h){if(typeof h=="number")return function(s){return Math.round(s/h)*h};var e=0,i=h.length;return function(s){var o=Math.abs(h[0]-s);for(e=1;e<i;e++){var c=h[e],_=Math.abs(c-s);if(_===0)return c;if(_>o)return h[e-1];if(e===i-1)return c;o=_}}};function h8(h,e){return h/(1e3/e)}var d8=function(h,e,i){var s=e-h;return((i-h)%s+s)%s+h},l4=function(h,e){return 1-3*e+3*h},c4=function(h,e){return 3*e-6*h},u4=function(h){return 3*h},zD=function(h,e,i){return((l4(e,i)*h+c4(e,i))*h+u4(e))*h},h4=function(h,e,i){return 3*l4(e,i)*h*h+2*c4(e,i)*h+u4(e)},p8=1e-7,f8=10,m8=8,g8=.001,VD=11,GD=1/(VD-1);function _8(h,e,i,s){if(h===e&&i===s)return fC;for(var o=new Float32Array(VD),c=0;c<VD;++c)o[c]=zD(c*GD,h,i);return function(_){return _===0||_===1?_:zD(function(j){for(var et=0,nt=1,st=VD-1;nt!==st&&o[nt]<=j;++nt)et+=GD;--nt;var at=et+(j-o[nt])/(o[nt+1]-o[nt])*GD,ct=h4(at,h,i);return ct>=g8?function(dt,mt,yt,wt){for(var Ct=0;Ct<m8;++Ct){var bt=h4(mt,yt,wt);if(bt===0)return mt;mt-=(zD(mt,yt,wt)-dt)/bt}return mt}(j,at,h,i):ct===0?at:function(dt,mt,yt,wt,Ct){var bt,At,Pt=0;do(bt=zD(At=mt+(yt-mt)/2,wt,Ct)-dt)>0?yt=At:mt=At;while(Math.abs(bt)>p8&&++Pt<f8);return At}(j,et,et+GD,h,i)}(_),e,s)}}var v8=function(h,e){return e===void 0&&(e="end"),function(i){var s=(i=e==="end"?Math.min(i,.999):Math.max(i,.001))*h,o=e==="end"?Math.floor(s):Math.ceil(s);return ly(0,1,o/h)}};class y8 extends I_{get editorInitialized(){return this._editorInitialized}constructor(e){super(e),this._editorInitialized=!1,this.defaultModes=[{title:"Viewer",plugins:[Zv,t2,fw,g0]},{title:"Picking",plugins:[JI,Bo,Tl,SA,R0,TS]},{title:"Scene",plugins:[$I,gv,KI,ZI,e2,ay,bm,Jv]},{title:"Anti-aliasing",plugins:[Vp,n1,B_]},{title:"Post Processing",plugins:[Rx,xI,Qu,Dx,rE,py,jx,Z1,P_,nA,Tp,sm]},{title:"Export",plugins:[b1,lv,Cy,t0]},{title:"Animations",plugins:[Ql,zl,Hu,R1,WA]},{title:"Modifiers",plugins:[Ty,Av,bv,P0,TI,UI,zm]},{title:"Configurators",plugins:[Vw,zw,E0,GI]},{title:"Plugins",plugins:[Nm,Vm,pp,iy,hv,R_,d_,Gv,k_,f_,Kl,OA,xy]},{title:"Extras",plugins:[UL]}],HF()}async setupUi(e,i){await QF(this,e,i??this.defaultModes),this._editorInitialized=!0}}async function d4(h,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:o=!1,importPopup:c=!0,caching:_=!0}){h.enabled=!1,e&&await h.addPlugin(vy),h.getPlugin(Fr)||await h.addPlugin(Fr,void 0,void 0,{storage:_&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await h.addPlugin(b1),await h.addPlugin(MB),await h.addPlugin(jI),c&&await h.addPlugin(Kl),await h.addPlugin(kL),await h.addPlugin(gS,!1),await h.addPlugin(sB),await h.addPlugin(fT),await h.addPlugin(g0),await h.addPlugin(WA),await h.addPlugin(ex),await h.addPlugin(Bo,tM,!1,!0),await FP(h,{ground:i,bloom:s,depthTonemap:o}),await h.addPlugin(xI),await h.addPlugin(P0,!1),await h.addPlugin(oL),await h.addPlugin(cL),await h.addPlugin(uL),await h.addPlugin(OA,!1),await h.addPlugin(Ty),await h.addPlugin(Av),await h.addPlugin(bv),await h.addPlugin(zw),await h.addPlugin(Vw),await h.addPlugin(GI),await h.addPlugin(SA),await h.addPlugin(Cy),await h.addPlugin(lv),await h.addPlugin(JI),await h.addPlugin(KI),await h.addPlugin(ZI),await h.addPlugin(e2),await h.addPlugin(Zv),await h.addPlugin(t2),await h.addPlugin($I),await h.addPlugin(TS),await h.addPlugin(R0),await h.addPlugin(R1,h.container,!1),await h.addPlugin(t0);const j=await h.addPlugin(new TD(!(0,b.mobileAndTabletCheck)()));return h.renderer.refreshPipeline(),h.scene.addEventListener("textureAdded",et=>{et.texture&&h.scene.setEnvironment(et.texture)}),j.setupPluginUi(Vm),j.setupPluginUi(Zv),j.setupPluginUi(t2),j.setupPluginUi(Kl),j.setupPluginUi(g0),j.setupPluginUi($I),j.setupPluginUi(b1),j.setupPluginUi(Ql),j.setupPluginUi(ay),j.setupPluginUi(Vw),j.setupPluginUi(zw),j.setupPluginUi(WA),j.setupPluginUi(JI),j.setupPluginUi(SA),j.setupPluginUi(Tl),j.setupPluginUi(Bo),i&&h.getPlugin(gv)&&j.setupPluginUi(gv),i&&h.getPlugin(Jv)&&j.setupPluginUi(Jv),j.setupPluginUi(jx),j.setupPluginUi(zl),j.setupPluginUi(Cy),j.setupPluginUi(Rx),j.setupPluginUi(xI),j.setupPluginUi(Dx),j.setupPluginUi(rE),j.setupPluginUi(Qu),j.setupPluginUi(py),j.setupPluginUi(nA),j.setupPluginUi(Z1),j.setupPluginUi(k_),j.setupPluginUi(Gv),j.setupPluginUi(KI),j.setupPluginUi(Ty),j.setupPluginUi(Av),j.setupPluginUi(Vp),j.setupPluginUi(ZI),j.setupPluginUi(e2),j.setupPluginUi(R_),j.setupPluginUi(d_),j.setupPluginUi(f_),s&&j.setupPluginUi(P_),j.setupPluginUi(lv),j.setupPluginUi(Nm),j.setupPluginUi(n1),j.setupPluginUi(bm),j.setupPluginUi(Tp),j.setupPluginUi(sm),j.setupPluginUi(bv),j.setupPluginUi(iy),j.setupPluginUi(B_),j.setupPluginUi(fw),j.setupPluginUi(E0),j.setupPluginUi(pp),j.setupPluginUi(P0),j.setupPluginUi(Hu),j.setupPluginUi(OA),j.setupPluginUi(t0),j.setupPluginUi(R1),j.setupPluginUi(R0),j.setupPluginUi(GI),j.setupPluginUi(zm),j.setupPluginUi(TS),j.setupPluginUi(xy),j.setupPluginUi(gS),h.enabled=!0,h}async function A8(h,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:o=!1,importPopup:c=!0,caching:_=!0}){const j=new I_(h);return await d4(j,{debug:e,ground:i,bloom:s,depthTonemap:o,importPopup:c,caching:_}),j}async function b8(h,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:o=!0,importPopup:c=!1,enableDrop:_=!1,caching:j=!0}={}){const et=new I_(h);return e&&await et.addPlugin(vy),et.getPlugin(Fr)||et.addPluginSync(Fr,void 0,void 0,{storage:j&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await et.addPlugin(oI,!0),await FP(et,{ground:i,bloom:s,depthTonemap:o,enableDrop:_,importPopup:c}),et}})();__webpackgi_exports__.MWW;__webpackgi_exports__.LY2;__webpackgi_exports__.GYo;__webpackgi_exports__.GPz;__webpackgi_exports__.HRj;__webpackgi_exports__.li4;__webpackgi_exports__.FO5;__webpackgi_exports__.Nlh;__webpackgi_exports__.Mp4;__webpackgi_exports__.QvI;__webpackgi_exports__.PrA;__webpackgi_exports__.JHp;__webpackgi_exports__.bGH;__webpackgi_exports__.NDo;__webpackgi_exports__.gSk;__webpackgi_exports__.WMw;__webpackgi_exports__.OTo;__webpackgi_exports__.Se2;__webpackgi_exports__.cum;__webpackgi_exports__.Mig;__webpackgi_exports__.B$7;__webpackgi_exports__.i_9;__webpackgi_exports__.bBp;__webpackgi_exports__.m7l;__webpackgi_exports__.sYA;__webpackgi_exports__.Xcj;__webpackgi_exports__.mzJ;__webpackgi_exports__.ZZA;__webpackgi_exports__.$Ph;__webpackgi_exports__.T__;__webpackgi_exports__.HkE;__webpackgi_exports__.tGC;__webpackgi_exports__.g1S;__webpackgi_exports__.I$C;__webpackgi_exports__.QIH;__webpackgi_exports__._JE;__webpackgi_exports__.SwW;__webpackgi_exports__.ksm;__webpackgi_exports__.jl_;__webpackgi_exports__.b7R;__webpackgi_exports__.BDV;__webpackgi_exports__.Ea_;__webpackgi_exports__.qff;__webpackgi_exports__.tmC;__webpackgi_exports__.BON;__webpackgi_exports__.P40;__webpackgi_exports__.wLL;__webpackgi_exports__.iHO;__webpackgi_exports__.BbS;__webpackgi_exports__.kqm;__webpackgi_exports__.Hmr;__webpackgi_exports__.SJI;__webpackgi_exports__.mTL;__webpackgi_exports__.y8_;__webpackgi_exports__._Li;__webpackgi_exports__.w7U;__webpackgi_exports__.g56;__webpackgi_exports__.bj3;__webpackgi_exports__.z81;__webpackgi_exports__._MY;__webpackgi_exports__.yEv;var __webpackgi_exports__BloomPlugin=__webpackgi_exports__.dFZ;__webpackgi_exports__.N$j;__webpackgi_exports__._YM;__webpackgi_exports__.TUj;__webpackgi_exports__.ZzF;__webpackgi_exports__.qzb;__webpackgi_exports__.GQ;__webpackgi_exports__.nvb;__webpackgi_exports__.DvJ;__webpackgi_exports__.fQA;__webpackgi_exports__.cPz;__webpackgi_exports__.TlE;__webpackgi_exports__.u9r;__webpackgi_exports__.s4_;__webpackgi_exports__.T95;__webpackgi_exports__.F5w;__webpackgi_exports__.NlP;__webpackgi_exports__.$8Z;__webpackgi_exports__.YYN;__webpackgi_exports__.CtF;__webpackgi_exports__.V1s;__webpackgi_exports__.jOv;__webpackgi_exports__.Rki;__webpackgi_exports__.pzV;__webpackgi_exports__.itZ;__webpackgi_exports__.MMq;__webpackgi_exports__.qKx;__webpackgi_exports__.Hmi;__webpackgi_exports__.X4S;__webpackgi_exports__.vlJ;__webpackgi_exports__.nPO;__webpackgi_exports__.zcQ;__webpackgi_exports__.GH1;__webpackgi_exports__.ROQ;__webpackgi_exports__.YN5;__webpackgi_exports__.BVQ;__webpackgi_exports__.YT8;__webpackgi_exports__._DE;__webpackgi_exports__.YGz;__webpackgi_exports__.trn;__webpackgi_exports__.zf8;__webpackgi_exports__.uWy;__webpackgi_exports__.wYQ;__webpackgi_exports__.SUY;__webpackgi_exports__.Ilk;__webpackgi_exports__.R2R;__webpackgi_exports__.epp;__webpackgi_exports__.xmJ;__webpackgi_exports__.GD$;__webpackgi_exports__.Z_g;__webpackgi_exports__.EB7;__webpackgi_exports__.DqL;__webpackgi_exports__._3;__webpackgi_exports__.b_z;__webpackgi_exports__.OCn;__webpackgi_exports__.N_j;__webpackgi_exports__.hNv;__webpackgi_exports__._am;__webpackgi_exports__.kB7;__webpackgi_exports__.fY$;__webpackgi_exports__.vxC;__webpackgi_exports__.BtG;__webpackgi_exports__.cBK;__webpackgi_exports__.g8_;__webpackgi_exports__.AXT;__webpackgi_exports__.yj7;__webpackgi_exports__.dYG;__webpackgi_exports__.tm_;__webpackgi_exports__.S2y;__webpackgi_exports__.B02;__webpackgi_exports__.PeU;__webpackgi_exports__.Hyl;__webpackgi_exports__.Wqd;__webpackgi_exports__.c0Q;__webpackgi_exports__.re0;__webpackgi_exports__.Xaj;__webpackgi_exports__.DUb;__webpackgi_exports__.dZ3;__webpackgi_exports__.m_w;__webpackgi_exports__.fHI;__webpackgi_exports__.LBq;__webpackgi_exports__.Qww;__webpackgi_exports__.CGV;__webpackgi_exports__.JUT;__webpackgi_exports__.p3g;__webpackgi_exports__.IEO;__webpackgi_exports__.yxD;__webpackgi_exports__.CUS;__webpackgi_exports__.A5E;__webpackgi_exports__.zqG;__webpackgi_exports__.PfX;__webpackgi_exports__.Q1o;__webpackgi_exports__.jfJ;__webpackgi_exports__.T_J;__webpackgi_exports__.tEQ;__webpackgi_exports__.gb4;__webpackgi_exports__.qkB;__webpackgi_exports__.cvk;__webpackgi_exports__.HWo;__webpackgi_exports__.brP;__webpackgi_exports__.$YQ;__webpackgi_exports__.X8d;__webpackgi_exports__.Zdt;__webpackgi_exports__.yNB;__webpackgi_exports__.h7x;__webpackgi_exports__.Ox3;__webpackgi_exports__.qtn;__webpackgi_exports__.cBI;__webpackgi_exports__.cU9;__webpackgi_exports__.ntt;__webpackgi_exports__.DT1;__webpackgi_exports__.Kgo;__webpackgi_exports__.ehD;__webpackgi_exports__.fhJ;__webpackgi_exports__.y1s;__webpackgi_exports__.fSK;__webpackgi_exports__.Vdb;__webpackgi_exports__.l8J;__webpackgi_exports__.dj0;__webpackgi_exports__.QM0;__webpackgi_exports__.n94;__webpackgi_exports__.OIS;__webpackgi_exports__.q8b;__webpackgi_exports__.TOt;__webpackgi_exports__.xaN;__webpackgi_exports__.Ny0;__webpackgi_exports__.NeD;__webpackgi_exports__.Zof;__webpackgi_exports__.N1Y;__webpackgi_exports__.itK;__webpackgi_exports__.eD;__webpackgi_exports__.jwo;__webpackgi_exports__.dSO;__webpackgi_exports__.Bf4;__webpackgi_exports__.USm;__webpackgi_exports__.pBf;__webpackgi_exports__.eBg;__webpackgi_exports__.$Vf;__webpackgi_exports__.O7d;__webpackgi_exports__.ksq;__webpackgi_exports__.hFL;__webpackgi_exports__.gXf;__webpackgi_exports__.hH6;__webpackgi_exports__.izP;__webpackgi_exports__.kpi;__webpackgi_exports__.DwZ;__webpackgi_exports__.kN3;__webpackgi_exports__.e62;__webpackgi_exports__.a$l;__webpackgi_exports__.OM3;__webpackgi_exports__.VzW;__webpackgi_exports__.ybr;__webpackgi_exports__.yo9;__webpackgi_exports__.Dzq;__webpackgi_exports__.zCA;__webpackgi_exports__.$Bt;__webpackgi_exports__.Wzm;__webpackgi_exports__.Wl3;__webpackgi_exports__.iWj;__webpackgi_exports__.DNz;var __webpackgi_exports__GBufferPlugin=__webpackgi_exports__.m1M;__webpackgi_exports__.ylh;__webpackgi_exports__.v9Y;__webpackgi_exports__.LSk;var __webpackgi_exports__GLTFAnimationPlugin=__webpackgi_exports__.LHE;__webpackgi_exports__.KE0;__webpackgi_exports__.KCF;__webpackgi_exports__.a4n;__webpackgi_exports__.NKC;__webpackgi_exports__.jrv;__webpackgi_exports__.zIH;__webpackgi_exports__.Hfk;__webpackgi_exports__.png;__webpackgi_exports__.tAj;__webpackgi_exports__.Eb_;__webpackgi_exports__.SJj;__webpackgi_exports__.cF0;__webpackgi_exports__.BT2;__webpackgi_exports__._8p;__webpackgi_exports__.V5Z;var __webpackgi_exports__GammaCorrectionPlugin=__webpackgi_exports__.s5b;__webpackgi_exports__.BHZ;__webpackgi_exports__.hkn;__webpackgi_exports__.GFY;__webpackgi_exports__.w$m;__webpackgi_exports__.ksN;__webpackgi_exports__.j4z;__webpackgi_exports__.OAl;__webpackgi_exports__.VLJ;__webpackgi_exports__.C73;__webpackgi_exports__.ZAu;__webpackgi_exports__.ibP;__webpackgi_exports__.lth;__webpackgi_exports__._fI;__webpackgi_exports__.hUN;__webpackgi_exports__.cLu;__webpackgi_exports__.vmT;__webpackgi_exports__.Qpg;__webpackgi_exports__.So8;__webpackgi_exports__.eOv;__webpackgi_exports__.Wjw;__webpackgi_exports__.cJO;__webpackgi_exports__.QRU;__webpackgi_exports__.S3k;__webpackgi_exports__.OPJ;__webpackgi_exports__.PpQ;__webpackgi_exports__.q_9;__webpackgi_exports__.ZRs;__webpackgi_exports__.oqc;__webpackgi_exports__.T_x;__webpackgi_exports__.lb7;__webpackgi_exports__.L5s;__webpackgi_exports__.$TI;__webpackgi_exports__.SPe;__webpackgi_exports__.aVm;__webpackgi_exports__.j87;__webpackgi_exports__.RNb;__webpackgi_exports__.Kz5;__webpackgi_exports__.vpT;__webpackgi_exports__.kB5;__webpackgi_exports__._C8;__webpackgi_exports__.Syv;__webpackgi_exports__.NMF;__webpackgi_exports__.pIN;__webpackgi_exports__.eMJ;__webpackgi_exports__.rN7;__webpackgi_exports__.iUp;__webpackgi_exports__.GFd;__webpackgi_exports__.x5V;__webpackgi_exports__.tUh;__webpackgi_exports__.z8B;__webpackgi_exports__.vcl;__webpackgi_exports__.GZb;__webpackgi_exports__.p7y;__webpackgi_exports__.S9g;__webpackgi_exports__.Zr5;__webpackgi_exports__.vCF;__webpackgi_exports__.yt0;__webpackgi_exports__.uXU;__webpackgi_exports__._kC;__webpackgi_exports__.lk7;__webpackgi_exports__.USc;__webpackgi_exports__.x12;__webpackgi_exports__.w_R;__webpackgi_exports__.Zzh;__webpackgi_exports__.nls;__webpackgi_exports__.g_z;__webpackgi_exports__.U7;__webpackgi_exports__.FT0;__webpackgi_exports__.L1_;__webpackgi_exports__.blk;__webpackgi_exports__.YRm;__webpackgi_exports__.ejS;__webpackgi_exports__.wUb;__webpackgi_exports__.zOz;__webpackgi_exports__.rnI;__webpackgi_exports__.wem;__webpackgi_exports__.lfu;__webpackgi_exports__.FDw;__webpackgi_exports__.lRj;__webpackgi_exports__.D1R;__webpackgi_exports__.qyh;__webpackgi_exports__.GUF;__webpackgi_exports__.EoG;__webpackgi_exports__.aNw;__webpackgi_exports__.Zp0;__webpackgi_exports__.lLk;__webpackgi_exports__.NHT;__webpackgi_exports__.jAl;__webpackgi_exports__.uEv;__webpackgi_exports__.YKA;__webpackgi_exports__.cRx;__webpackgi_exports__.Y8D;__webpackgi_exports__.RsA;__webpackgi_exports__.Y0m;__webpackgi_exports__.F5T;__webpackgi_exports__.EDU;__webpackgi_exports__.z$Q;__webpackgi_exports__.KA8;__webpackgi_exports__.ZqF;__webpackgi_exports__.XUj;__webpackgi_exports__.Me$;__webpackgi_exports__.u7G;__webpackgi_exports__.PEk;__webpackgi_exports__.BG4;__webpackgi_exports__.M8C;__webpackgi_exports__.Vkp;__webpackgi_exports__.yGw;__webpackgi_exports__.Sm8;__webpackgi_exports__.Kj0;__webpackgi_exports__.vBJ;__webpackgi_exports__.QfV;__webpackgi_exports__.lRF;__webpackgi_exports__.Lun;__webpackgi_exports__.YBo;__webpackgi_exports__.kaV;__webpackgi_exports__.RSm;__webpackgi_exports__.xoR;__webpackgi_exports__.EJi;__webpackgi_exports__.Wid;__webpackgi_exports__.iuj;__webpackgi_exports__.IKL;__webpackgi_exports__.r_;__webpackgi_exports__.OoA;__webpackgi_exports__.qhX;__webpackgi_exports__.CRe;__webpackgi_exports__.qPT;__webpackgi_exports__.M5h;__webpackgi_exports__.Ns1;__webpackgi_exports__.TyD;__webpackgi_exports__.vZf;__webpackgi_exports__.HTd;__webpackgi_exports__.aH4;__webpackgi_exports__.YLQ;__webpackgi_exports__.BVF;__webpackgi_exports__.MyG;__webpackgi_exports__.jFi;__webpackgi_exports__.aCh;__webpackgi_exports__.uL9;__webpackgi_exports__.TNj;__webpackgi_exports__.IFH;__webpackgi_exports__.bdR;__webpackgi_exports__.RPs;__webpackgi_exports__.kM_;__webpackgi_exports__.M6v;__webpackgi_exports__.RvT;__webpackgi_exports__.dUE;__webpackgi_exports__.oe_;__webpackgi_exports__.BuN;__webpackgi_exports__.Tme;__webpackgi_exports__.N9P;__webpackgi_exports__.tfP;__webpackgi_exports__.Gql;__webpackgi_exports__.$XY;__webpackgi_exports__.O9d;__webpackgi_exports__.zEO;__webpackgi_exports__.qfx;__webpackgi_exports__.PA7;__webpackgi_exports__.REq;__webpackgi_exports__.pQR;__webpackgi_exports__.ghN;__webpackgi_exports__.Hy8;__webpackgi_exports__.Wpd;__webpackgi_exports__.LgZ;__webpackgi_exports__.iWC;__webpackgi_exports__.mqn;__webpackgi_exports__.SKe;__webpackgi_exports__.iKG;__webpackgi_exports__.rCq;__webpackgi_exports__._iA;__webpackgi_exports__.ntZ;__webpackgi_exports__.anP;__webpackgi_exports__.X2e;__webpackgi_exports__.oxT;__webpackgi_exports__.FCo;__webpackgi_exports__.y$t;__webpackgi_exports__.cPb;__webpackgi_exports__.lmx;__webpackgi_exports__.JOQ;__webpackgi_exports__.BKK;__webpackgi_exports__._12;__webpackgi_exports__.tJx;__webpackgi_exports__.mjX;__webpackgi_exports__.cek;__webpackgi_exports__.qD0;__webpackgi_exports__.xG9;__webpackgi_exports__.eqi;__webpackgi_exports__.wI8;__webpackgi_exports__.Sgv;__webpackgi_exports__.woe;__webpackgi_exports__.UY4;__webpackgi_exports__.aq0;__webpackgi_exports__.ujx;__webpackgi_exports__.Uol;__webpackgi_exports__.JiH;__webpackgi_exports__.VYz;__webpackgi_exports__.B2H;__webpackgi_exports__._Pm;var __webpackgi_exports__ProgressivePlugin=__webpackgi_exports__.EsW;__webpackgi_exports__.iUV;__webpackgi_exports__.tf;__webpackgi_exports__.ZQ6;__webpackgi_exports__.mXe;__webpackgi_exports__._fP;__webpackgi_exports__.iLg;__webpackgi_exports__.zbs;__webpackgi_exports__.ZTh;__webpackgi_exports__.HdW;__webpackgi_exports__.UZH;__webpackgi_exports__.mSO;__webpackgi_exports__.wk1;__webpackgi_exports__.E2K;__webpackgi_exports__.FUD;__webpackgi_exports__.pKu;__webpackgi_exports__.GG6;__webpackgi_exports__.Gih;__webpackgi_exports__.iiP;__webpackgi_exports__.SvJ;__webpackgi_exports__.ptH;__webpackgi_exports__.jZA;__webpackgi_exports__.y2t;__webpackgi_exports__.gi4;__webpackgi_exports__.Djp;__webpackgi_exports__.BG$;__webpackgi_exports__.NYV;__webpackgi_exports__.xJs;__webpackgi_exports__.bsb;__webpackgi_exports__.ekQ;__webpackgi_exports__.CaW;__webpackgi_exports__.eaV;__webpackgi_exports__.BFQ;__webpackgi_exports__.v3W;__webpackgi_exports__.ILR;__webpackgi_exports__.G_r;__webpackgi_exports__.N3F;__webpackgi_exports__.fto;__webpackgi_exports__.l0P;__webpackgi_exports__.vCx;__webpackgi_exports__._AM;__webpackgi_exports__.wuA;__webpackgi_exports__.av9;__webpackgi_exports__.CtA;__webpackgi_exports__.BvQ;__webpackgi_exports__.FZJ;__webpackgi_exports__.FIo;__webpackgi_exports__.zHn;__webpackgi_exports__.iMs;__webpackgi_exports__.T_f;__webpackgi_exports__.hEm;__webpackgi_exports__.D9w;__webpackgi_exports__.sHH;__webpackgi_exports__.CdI;__webpackgi_exports__.rkc;__webpackgi_exports__.rpg;__webpackgi_exports__.ce8;__webpackgi_exports__.rOj;__webpackgi_exports__.P6m;__webpackgi_exports__.JA6;__webpackgi_exports__.V4E;__webpackgi_exports__.o8S;__webpackgi_exports__.flB;__webpackgi_exports__.lGU;__webpackgi_exports__.vuL;__webpackgi_exports__.KI_;var __webpackgi_exports__SSAOPlugin=__webpackgi_exports__.iLN;__webpackgi_exports__.X6w;__webpackgi_exports__.rz_;__webpackgi_exports__.jsw;__webpackgi_exports__.srG;var __webpackgi_exports__SSRPlugin=__webpackgi_exports__.i6Z;__webpackgi_exports__.vfv;__webpackgi_exports__.xsS;__webpackgi_exports__.or;__webpackgi_exports__.EQj;__webpackgi_exports__.Rnn;__webpackgi_exports__.TyN;__webpackgi_exports__.ov0;__webpackgi_exports__.WdD;__webpackgi_exports__.Vj0;__webpackgi_exports__.jyz;__webpackgi_exports__.mTM;__webpackgi_exports__.Mn1;__webpackgi_exports__.Hlq;__webpackgi_exports__.Fi7;__webpackgi_exports__.Tn7;__webpackgi_exports__.bnF;__webpackgi_exports__.HW6;__webpackgi_exports__.oa8;__webpackgi_exports__.T_1;__webpackgi_exports__.zHJ;__webpackgi_exports__.iDF;__webpackgi_exports__.iAb;__webpackgi_exports__.d4E;__webpackgi_exports__.lBg;__webpackgi_exports__.JeJ;__webpackgi_exports__.FKY;__webpackgi_exports__.zlZ;__webpackgi_exports__.vkg;__webpackgi_exports__.brh;__webpackgi_exports__.kZK;__webpackgi_exports__.puG;__webpackgi_exports__.OdW;__webpackgi_exports__._YX;__webpackgi_exports__.TUv;__webpackgi_exports__.Hw6;__webpackgi_exports__.aLr;__webpackgi_exports__.Aip;__webpackgi_exports__.xo$;__webpackgi_exports__.bIn;__webpackgi_exports__.$V;__webpackgi_exports__.lDi;__webpackgi_exports__.gti;__webpackgi_exports__.PMe;__webpackgi_exports__.iwP;__webpackgi_exports__.FvO;__webpackgi_exports__.jyi;__webpackgi_exports__.xeV;__webpackgi_exports__.k74;__webpackgi_exports__.RlZ;__webpackgi_exports__.KhW;__webpackgi_exports__.HgB;__webpackgi_exports__.W2J;__webpackgi_exports__.JWc;__webpackgi_exports__.u37;__webpackgi_exports__.Z6B;__webpackgi_exports__.QZ1;__webpackgi_exports__.Ir4;__webpackgi_exports__.NwF;__webpackgi_exports__.Wbm;__webpackgi_exports__.N4l;__webpackgi_exports__.Jxm;__webpackgi_exports__.ej9;__webpackgi_exports__.QmN;__webpackgi_exports__.Y4W;__webpackgi_exports__.IOt;__webpackgi_exports__.NOD;__webpackgi_exports__.L5g;__webpackgi_exports__.H$k;__webpackgi_exports__.cuP;__webpackgi_exports__.xEZ;__webpackgi_exports__.dpR;__webpackgi_exports__.wOD;__webpackgi_exports__.KNb;var __webpackgi_exports__TonemapPlugin=__webpackgi_exports__.IiN;__webpackgi_exports__.Cne;__webpackgi_exports__.XvJ;__webpackgi_exports__.XZw;__webpackgi_exports__.FE5;__webpackgi_exports__.Mck;__webpackgi_exports__.lVp;__webpackgi_exports__.CJI;__webpackgi_exports__.z$h;__webpackgi_exports__.UlW;__webpackgi_exports__.WwZ;__webpackgi_exports__.zG7;__webpackgi_exports__.Lcc;__webpackgi_exports__.WXh;__webpackgi_exports__.Vjr;__webpackgi_exports__.LuM;__webpackgi_exports__.LP5;__webpackgi_exports__.ub3;__webpackgi_exports__.OV;__webpackgi_exports__.G_n;__webpackgi_exports__.xfE;__webpackgi_exports__.qlB;__webpackgi_exports__.lCJ;__webpackgi_exports__.WTc;__webpackgi_exports__.rAo;__webpackgi_exports__.LZj;__webpackgi_exports__.xWb;__webpackgi_exports__.gH0;__webpackgi_exports__.rBU;__webpackgi_exports__.rDY;__webpackgi_exports__.ywz;__webpackgi_exports__.wJv;__webpackgi_exports__.JQ4;__webpackgi_exports__.k0A;__webpackgi_exports__.irR;__webpackgi_exports__.LsT;__webpackgi_exports__.q5h;__webpackgi_exports__.TKh;__webpackgi_exports__.tyg;__webpackgi_exports__.Ro5;__webpackgi_exports__.dwk;__webpackgi_exports__.t0w;__webpackgi_exports__.M7$;__webpackgi_exports__.ML4;__webpackgi_exports__.FM8;__webpackgi_exports__.Pa4;__webpackgi_exports__.Ltg;__webpackgi_exports__.yC1;__webpackgi_exports__.lHq;__webpackgi_exports__.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA;__webpackgi_exports__.JzW;__webpackgi_exports__.QEt;__webpackgi_exports__.IFZ;__webpackgi_exports__.b5g;__webpackgi_exports__.Ywn;__webpackgi_exports__.GVz;__webpackgi_exports__.oAp;__webpackgi_exports__.kFz;__webpackgi_exports__.dd2;__webpackgi_exports__.CP7;__webpackgi_exports__.fQK;__webpackgi_exports__.Wd$;__webpackgi_exports__.t1_;__webpackgi_exports__.v27;__webpackgi_exports__.Uk6;__webpackgi_exports__.H7Z;__webpackgi_exports__._sL;__webpackgi_exports__.czO;__webpackgi_exports__.Pnf;__webpackgi_exports__.c8b;__webpackgi_exports__._lf;__webpackgi_exports__.ad5;__webpackgi_exports__.sZV;__webpackgi_exports__.TfA;__webpackgi_exports__.sKX;__webpackgi_exports__.UdM;__webpackgi_exports__.P0y;__webpackgi_exports__.L_r;__webpackgi_exports__.zC5;__webpackgi_exports__.Bve;__webpackgi_exports__.b5G;__webpackgi_exports__.UeO;__webpackgi_exports__.qCx;__webpackgi_exports__.$nx;__webpackgi_exports__.Bk6;__webpackgi_exports__.EER;__webpackgi_exports__.y4l;__webpackgi_exports__.P39;__webpackgi_exports__.HI1;__webpackgi_exports__.ZYi;__webpackgi_exports__.wXW;__webpackgi_exports__.r5x;__webpackgi_exports__.MSI;__webpackgi_exports__.EUu;__webpackgi_exports__.jtH;__webpackgi_exports__.T0T;__webpackgi_exports__.gAb;__webpackgi_exports__.je_;__webpackgi_exports__.wBP;__webpackgi_exports__.LU2;__webpackgi_exports__.wQL;__webpackgi_exports__.Zs7;__webpackgi_exports__.sMc;__webpackgi_exports__.x7s;__webpackgi_exports__.Mnd;__webpackgi_exports__.A0_;__webpackgi_exports__.d73;__webpackgi_exports__.HCD;__webpackgi_exports__.YQ8;__webpackgi_exports__.RG9;__webpackgi_exports__.G2P;__webpackgi_exports__.XLf;__webpackgi_exports__.CGN;__webpackgi_exports__.RGi;__webpackgi_exports__.mvg;__webpackgi_exports__.Hiy;__webpackgi_exports__.XMc;__webpackgi_exports__.N7M;__webpackgi_exports__.iv;__webpackgi_exports__.n55;__webpackgi_exports__.IaC;__webpackgi_exports__.h9t;__webpackgi_exports__.yDW;__webpackgi_exports__.gJv;__webpackgi_exports__.l$g;__webpackgi_exports__.vQi;__webpackgi_exports__.$MY;__webpackgi_exports__.wJl;__webpackgi_exports__.Z7Y;__webpackgi_exports__.X7D;__webpackgi_exports__.BnX;__webpackgi_exports__.uZ5;__webpackgi_exports__.zVI;__webpackgi_exports__.Wz1;__webpackgi_exports__.DpF;__webpackgi_exports__.nNb;__webpackgi_exports__.cqZ;__webpackgi_exports__.pKN;__webpackgi_exports__.CN8;__webpackgi_exports__.DdI;__webpackgi_exports__.rrX;__webpackgi_exports__.uqj;__webpackgi_exports__.Z9P;__webpackgi_exports__.KlC;__webpackgi_exports__.KVn;__webpackgi_exports__.oau;__webpackgi_exports__.aw9;__webpackgi_exports__.Aap;__webpackgi_exports__.Dxg;__webpackgi_exports__.MjT;__webpackgi_exports__.F7Q;__webpackgi_exports__.IFq;__webpackgi_exports__.IJl;__webpackgi_exports__.O5A;__webpackgi_exports__.wCn;__webpackgi_exports__.gGT;__webpackgi_exports__.pEc;__webpackgi_exports__.Bi6;__webpackgi_exports__.fi_;__webpackgi_exports__.TT;__webpackgi_exports__.q2Z;__webpackgi_exports__.NyK;__webpackgi_exports__.bgu;__webpackgi_exports__.kcS;__webpackgi_exports__.rRN;__webpackgi_exports__.ivY;__webpackgi_exports__._s1;__webpackgi_exports__._HO;__webpackgi_exports__.tpL;__webpackgi_exports__.DMK;__webpackgi_exports__.LjN;__webpackgi_exports__.iFs;__webpackgi_exports__.qTg;__webpackgi_exports__.J4G;__webpackgi_exports__.Zj8;__webpackgi_exports__.Wtl;__webpackgi_exports__.DmK;__webpackgi_exports__.Htt;__webpackgi_exports__.Nv0;__webpackgi_exports__.tCp;__webpackgi_exports__.Hx7;__webpackgi_exports__.imt;__webpackgi_exports__.US6;__webpackgi_exports__.vZs;__webpackgi_exports__.TE$;__webpackgi_exports__.lmu;__webpackgi_exports__.SvO;__webpackgi_exports__.YQY;__webpackgi_exports__.mZN;__webpackgi_exports__.VvG;__webpackgi_exports__.omp;__webpackgi_exports__.utz;__webpackgi_exports__.TFV;__webpackgi_exports__.hrz;__webpackgi_exports__.H$s;__webpackgi_exports__.JKM;__webpackgi_exports__.jZf;__webpackgi_exports__.RjL;__webpackgi_exports__.RRI;__webpackgi_exports__.RUq;__webpackgi_exports__._t4;__webpackgi_exports__.YHh;__webpackgi_exports__.R8g;__webpackgi_exports__.f1L;__webpackgi_exports__.Bbl;__webpackgi_exports__.V9r;__webpackgi_exports__.a95;__webpackgi_exports__.PZ2;__webpackgi_exports__.w7A;__webpackgi_exports__.N6S;__webpackgi_exports__.Uxp;__webpackgi_exports__.tAz;__webpackgi_exports__.R$F;__webpackgi_exports__.N33;__webpackgi_exports__.JFD;__webpackgi_exports__.gw2;__webpackgi_exports__.rfc;__webpackgi_exports__.wo6;__webpackgi_exports__.V4T;__webpackgi_exports__.H4P;__webpackgi_exports__.NLp;__webpackgi_exports__.swA;__webpackgi_exports__._Z3;__webpackgi_exports__.ivc;__webpackgi_exports__.rZ1;__webpackgi_exports__.CpZ;__webpackgi_exports__.dyc;__webpackgi_exports__.MxZ;__webpackgi_exports__.btp;__webpackgi_exports__.mXy;__webpackgi_exports__.Ej0;__webpackgi_exports__.ep4;__webpackgi_exports__.DQP;__webpackgi_exports__.VNr;__webpackgi_exports__.V7q;__webpackgi_exports__.hiB;__webpackgi_exports__.zEk;__webpackgi_exports__.qfq;__webpackgi_exports__.piB;__webpackgi_exports__.IIc;__webpackgi_exports__.rrF;__webpackgi_exports__.naq;__webpackgi_exports__.zlD;__webpackgi_exports__.sXR;__webpackgi_exports__.p5I;__webpackgi_exports__.wps;__webpackgi_exports__.wuo;__webpackgi_exports__.GpE;__webpackgi_exports__.F4b;__webpackgi_exports__.NN$;__webpackgi_exports__.t$v;__webpackgi_exports__.tdn;__webpackgi_exports__.Y9t;__webpackgi_exports__.GEo;__webpackgi_exports__.GGm;__webpackgi_exports__.DH3;__webpackgi_exports__.uxM;__webpackgi_exports__.zH3;__webpackgi_exports__.MLs;__webpackgi_exports__.xXG;__webpackgi_exports__.YM4;__webpackgi_exports__.B3r;__webpackgi_exports__.iAx;__webpackgi_exports__.lDn;__webpackgi_exports__.P1O;__webpackgi_exports__.iib;__webpackgi_exports__.qf5;__webpackgi_exports__.n4s;__webpackgi_exports__.fr;__webpackgi_exports__.Z9s;__webpackgi_exports__.oaQ;__webpackgi_exports__.CD7;__webpackgi_exports__.Rc0;__webpackgi_exports__.iPG;__webpackgi_exports__.TIc;__webpackgi_exports__.xsC;__webpackgi_exports__.zOc;__webpackgi_exports__.i8W;__webpackgi_exports__.r46;__webpackgi_exports__.z2C;__webpackgi_exports__.N4A;__webpackgi_exports__.hjq;__webpackgi_exports__._X$;__webpackgi_exports__._yn;__webpackgi_exports__.Dyg;__webpackgi_exports__.cUc;__webpackgi_exports__.zGw;__webpackgi_exports__.Ctq;__webpackgi_exports__.$ch;__webpackgi_exports__.k5b;__webpackgi_exports__.kZl;__webpackgi_exports__.OCg;__webpackgi_exports__.Kd3;__webpackgi_exports__.YjH;__webpackgi_exports__.Ui8;__webpackgi_exports__.YD2;__webpackgi_exports__.vi9;__webpackgi_exports__.ij3;__webpackgi_exports__.pJq;__webpackgi_exports__.YPW;__webpackgi_exports__._tY;__webpackgi_exports__.Bg1;__webpackgi_exports__.kon;__webpackgi_exports__.M3g;__webpackgi_exports__.F2z;__webpackgi_exports__.pJF;__webpackgi_exports__.knz;__webpackgi_exports__.Ejo;__webpackgi_exports__.BgY;__webpackgi_exports__.qCG;__webpackgi_exports__.HD9;__webpackgi_exports__.Rgz;__webpackgi_exports__.fEB;__webpackgi_exports__.Udc;__webpackgi_exports__.ZQg;__webpackgi_exports__.ofC;__webpackgi_exports__.yRy;__webpackgi_exports__._NL;__webpackgi_exports__.LCA;__webpackgi_exports__.Sy1;__webpackgi_exports__.Vs_;__webpackgi_exports__.j1w;__webpackgi_exports__.i8J;__webpackgi_exports__.p7C;__webpackgi_exports__.ZAS;__webpackgi_exports__.ipH;__webpackgi_exports__.$TF;__webpackgi_exports__.uZI;__webpackgi_exports__.VWG;__webpackgi_exports__.pQ7;__webpackgi_exports__.STw;__webpackgi_exports__.jc8;__webpackgi_exports__.BL_;__webpackgi_exports__.S6;__webpackgi_exports__.T8U;__webpackgi_exports__.TD6;__webpackgi_exports__.akS;__webpackgi_exports__.QKE;__webpackgi_exports__.dKx;__webpackgi_exports__.OvX;__webpackgi_exports__.doP;__webpackgi_exports__.$jA;__webpackgi_exports__.T99;__webpackgi_exports__.LJS;__webpackgi_exports__.VsW;__webpackgi_exports__.LZE;__webpackgi_exports__.YMc;__webpackgi_exports__.aPg;__webpackgi_exports__.LFn;__webpackgi_exports__.VsX;__webpackgi_exports__.wey;__webpackgi_exports__.MaE;__webpackgi_exports__.s4x;__webpackgi_exports__.FJA;__webpackgi_exports__.vIA;__webpackgi_exports__.Spv;__webpackgi_exports__.w8l;__webpackgi_exports__.riG;__webpackgi_exports__.Kbh;__webpackgi_exports__.BFq;__webpackgi_exports__.t8K;__webpackgi_exports__.Q7n;__webpackgi_exports__.KGF;__webpackgi_exports__.e5;__webpackgi_exports__.Rik;__webpackgi_exports__.GZo;__webpackgi_exports__.Bds;__webpackgi_exports__.HTu;__webpackgi_exports__.cTq;__webpackgi_exports__.X_Y;__webpackgi_exports__.dA8;__webpackgi_exports__.NSm;__webpackgi_exports__.bwS;__webpackgi_exports__.Lks;__webpackgi_exports__.Rvq;__webpackgi_exports__.P4F;__webpackgi_exports__.Pd0;__webpackgi_exports__.Pjo;__webpackgi_exports__.Tum;__webpackgi_exports__.dRH;__webpackgi_exports__.RX0;__webpackgi_exports__.reQ;__webpackgi_exports__.cWm;__webpackgi_exports__.NC9;__webpackgi_exports__.$Re;__webpackgi_exports__.Xo9;__webpackgi_exports__.LNO;__webpackgi_exports__.iZP;function _assertThisInitialized($){if($===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return $}function _inheritsLoose($,b){$.prototype=Object.create(b.prototype),$.prototype.constructor=$,$.__proto__=b}/*!
 * GSAP 3.12.4
 * https://gsap.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var _config={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},_defaults$1={duration:.5,overwrite:!1,delay:0},_suppressOverwrites$1,_reverting$1,_context$2,_bigNum$1=1e8,_tinyNum=1/_bigNum$1,_2PI=Math.PI*2,_HALF_PI=_2PI/4,_gsID=0,_sqrt=Math.sqrt,_cos=Math.cos,_sin=Math.sin,_isString$1=function $(b){return typeof b=="string"},_isFunction$1=function $(b){return typeof b=="function"},_isNumber$1=function $(b){return typeof b=="number"},_isUndefined=function $(b){return typeof b>"u"},_isObject$1=function $(b){return typeof b=="object"},_isNotFalse=function $(b){return b!==!1},_windowExists$2=function $(){return typeof window<"u"},_isFuncOrString=function $(b){return _isFunction$1(b)||_isString$1(b)},_isTypedArray=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},_isArray=Array.isArray,_strictNumExp=/(?:-?\.?\d|\.)+/gi,_numExp=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,_numWithUnitExp=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,_complexStringNumExp=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,_relExp=/[+-]=-?[.\d]+/,_delimitedValueExp=/[^,'"\[\]\s]+/gi,_unitExp=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,_globalTimeline,_win$3,_coreInitted$2,_doc$3,_globals={},_installScope={},_coreReady,_install=function $(b){return(_installScope=_merge(b,_globals))&&gsap$2},_missingPlugin=function $(b,g){return console.warn("Invalid property",b,"set to",g,"Missing plugin? gsap.registerPlugin()")},_warn=function $(b,g){return!g&&console.warn(b)},_addGlobal=function $(b,g){return b&&(_globals[b]=g)&&_installScope&&(_installScope[b]=g)||_globals},_emptyFunc=function $(){return 0},_startAtRevertConfig={suppressEvents:!0,isStart:!0,kill:!1},_revertConfigNoKill={suppressEvents:!0,kill:!1},_revertConfig={suppressEvents:!0},_reservedProps={},_lazyTweens=[],_lazyLookup={},_lastRenderedFrame,_plugins={},_effects={},_nextGCFrame=30,_harnessPlugins=[],_callbackNames="",_harness=function $(b){var g=b[0],tt,ot;if(_isObject$1(g)||_isFunction$1(g)||(b=[b]),!(tt=(g._gsap||{}).harness)){for(ot=_harnessPlugins.length;ot--&&!_harnessPlugins[ot].targetTest(g););tt=_harnessPlugins[ot]}for(ot=b.length;ot--;)b[ot]&&(b[ot]._gsap||(b[ot]._gsap=new GSCache(b[ot],tt)))||b.splice(ot,1);return b},_getCache=function $(b){return b._gsap||_harness(toArray(b))[0]._gsap},_getProperty=function $(b,g,tt){return(tt=b[g])&&_isFunction$1(tt)?b[g]():_isUndefined(tt)&&b.getAttribute&&b.getAttribute(g)||tt},_forEachName=function $(b,g){return(b=b.split(",")).forEach(g)||b},_round$1=function $(b){return Math.round(b*1e5)/1e5||0},_roundPrecise=function $(b){return Math.round(b*1e7)/1e7||0},_parseRelative=function $(b,g){var tt=g.charAt(0),ot=parseFloat(g.substr(2));return b=parseFloat(b),tt==="+"?b+ot:tt==="-"?b-ot:tt==="*"?b*ot:b/ot},_arrayContainsAny=function $(b,g){for(var tt=g.length,ot=0;b.indexOf(g[ot])<0&&++ot<tt;);return ot<tt},_lazyRender=function $(){var b=_lazyTweens.length,g=_lazyTweens.slice(0),tt,ot;for(_lazyLookup={},_lazyTweens.length=0,tt=0;tt<b;tt++)ot=g[tt],ot&&ot._lazy&&(ot.render(ot._lazy[0],ot._lazy[1],!0)._lazy=0)},_lazySafeRender=function $(b,g,tt,ot){_lazyTweens.length&&!_reverting$1&&_lazyRender(),b.render(g,tt,ot||_reverting$1&&g<0&&(b._initted||b._startAt)),_lazyTweens.length&&!_reverting$1&&_lazyRender()},_numericIfPossible=function $(b){var g=parseFloat(b);return(g||g===0)&&(b+"").match(_delimitedValueExp).length<2?g:_isString$1(b)?b.trim():b},_passThrough$1=function $(b){return b},_setDefaults$1=function $(b,g){for(var tt in g)tt in b||(b[tt]=g[tt]);return b},_setKeyframeDefaults=function $(b){return function(g,tt){for(var ot in tt)ot in g||ot==="duration"&&b||ot==="ease"||(g[ot]=tt[ot])}},_merge=function $(b,g){for(var tt in g)b[tt]=g[tt];return b},_mergeDeep=function $(b,g){for(var tt in g)tt!=="__proto__"&&tt!=="constructor"&&tt!=="prototype"&&(b[tt]=_isObject$1(g[tt])?$(b[tt]||(b[tt]={}),g[tt]):g[tt]);return b},_copyExcluding=function $(b,g){var tt={},ot;for(ot in b)ot in g||(tt[ot]=b[ot]);return tt},_inheritDefaults=function $(b){var g=b.parent||_globalTimeline,tt=b.keyframes?_setKeyframeDefaults(_isArray(b.keyframes)):_setDefaults$1;if(_isNotFalse(b.inherit))for(;g;)tt(b,g.vars.defaults),g=g.parent||g._dp;return b},_arraysMatch=function $(b,g){for(var tt=b.length,ot=tt===g.length;ot&&tt--&&b[tt]===g[tt];);return tt<0},_addLinkedListItem=function $(b,g,tt,ot,ut){tt===void 0&&(tt="_first"),ot===void 0&&(ot="_last");var gt=b[ot],xt;if(ut)for(xt=g[ut];gt&&gt[ut]>xt;)gt=gt._prev;return gt?(g._next=gt._next,gt._next=g):(g._next=b[tt],b[tt]=g),g._next?g._next._prev=g:b[ot]=g,g._prev=gt,g.parent=g._dp=b,g},_removeLinkedListItem=function $(b,g,tt,ot){tt===void 0&&(tt="_first"),ot===void 0&&(ot="_last");var ut=g._prev,gt=g._next;ut?ut._next=gt:b[tt]===g&&(b[tt]=gt),gt?gt._prev=ut:b[ot]===g&&(b[ot]=ut),g._next=g._prev=g.parent=null},_removeFromParent=function $(b,g){b.parent&&(!g||b.parent.autoRemoveChildren)&&b.parent.remove&&b.parent.remove(b),b._act=0},_uncache=function $(b,g){if(b&&(!g||g._end>b._dur||g._start<0))for(var tt=b;tt;)tt._dirty=1,tt=tt.parent;return b},_recacheAncestors=function $(b){for(var g=b.parent;g&&g.parent;)g._dirty=1,g.totalDuration(),g=g.parent;return b},_rewindStartAt=function $(b,g,tt,ot){return b._startAt&&(_reverting$1?b._startAt.revert(_revertConfigNoKill):b.vars.immediateRender&&!b.vars.autoRevert||b._startAt.render(g,!0,ot))},_hasNoPausedAncestors=function $(b){return!b||b._ts&&$(b.parent)},_elapsedCycleDuration=function $(b){return b._repeat?_animationCycle(b._tTime,b=b.duration()+b._rDelay)*b:0},_animationCycle=function $(b,g){var tt=Math.floor(b/=g);return b&&tt===b?tt-1:tt},_parentToChildTotalTime=function $(b,g){return(b-g._start)*g._ts+(g._ts>=0?0:g._dirty?g.totalDuration():g._tDur)},_setEnd=function $(b){return b._end=_roundPrecise(b._start+(b._tDur/Math.abs(b._ts||b._rts||_tinyNum)||0))},_alignPlayhead=function $(b,g){var tt=b._dp;return tt&&tt.smoothChildTiming&&b._ts&&(b._start=_roundPrecise(tt._time-(b._ts>0?g/b._ts:((b._dirty?b.totalDuration():b._tDur)-g)/-b._ts)),_setEnd(b),tt._dirty||_uncache(tt,b)),b},_postAddChecks=function $(b,g){var tt;if((g._time||!g._dur&&g._initted||g._start<b._time&&(g._dur||!g.add))&&(tt=_parentToChildTotalTime(b.rawTime(),g),(!g._dur||_clamp$1(0,g.totalDuration(),tt)-g._tTime>_tinyNum)&&g.render(tt,!0)),_uncache(b,g)._dp&&b._initted&&b._time>=b._dur&&b._ts){if(b._dur<b.duration())for(tt=b;tt._dp;)tt.rawTime()>=0&&tt.totalTime(tt._tTime),tt=tt._dp;b._zTime=-_tinyNum}},_addToTimeline=function $(b,g,tt,ot){return g.parent&&_removeFromParent(g),g._start=_roundPrecise((_isNumber$1(tt)?tt:tt||b!==_globalTimeline?_parsePosition$1(b,tt,g):b._time)+g._delay),g._end=_roundPrecise(g._start+(g.totalDuration()/Math.abs(g.timeScale())||0)),_addLinkedListItem(b,g,"_first","_last",b._sort?"_start":0),_isFromOrFromStart(g)||(b._recent=g),ot||_postAddChecks(b,g),b._ts<0&&_alignPlayhead(b,b._tTime),b},_scrollTrigger=function $(b,g){return(_globals.ScrollTrigger||_missingPlugin("scrollTrigger",g))&&_globals.ScrollTrigger.create(g,b)},_attemptInitTween=function $(b,g,tt,ot,ut){if(_initTween(b,g,ut),!b._initted)return 1;if(!tt&&b._pt&&!_reverting$1&&(b._dur&&b.vars.lazy!==!1||!b._dur&&b.vars.lazy)&&_lastRenderedFrame!==_ticker.frame)return _lazyTweens.push(b),b._lazy=[ut,ot],1},_parentPlayheadIsBeforeStart=function $(b){var g=b.parent;return g&&g._ts&&g._initted&&!g._lock&&(g.rawTime()<0||$(g))},_isFromOrFromStart=function $(b){var g=b.data;return g==="isFromStart"||g==="isStart"},_renderZeroDurationTween=function $(b,g,tt,ot){var ut=b.ratio,gt=g<0||!g&&(!b._start&&_parentPlayheadIsBeforeStart(b)&&!(!b._initted&&_isFromOrFromStart(b))||(b._ts<0||b._dp._ts<0)&&!_isFromOrFromStart(b))?0:1,xt=b._rDelay,It=0,kt,Ft,Xt;if(xt&&b._repeat&&(It=_clamp$1(0,b._tDur,g),Ft=_animationCycle(It,xt),b._yoyo&&Ft&1&&(gt=1-gt),Ft!==_animationCycle(b._tTime,xt)&&(ut=1-gt,b.vars.repeatRefresh&&b._initted&&b.invalidate())),gt!==ut||_reverting$1||ot||b._zTime===_tinyNum||!g&&b._zTime){if(!b._initted&&_attemptInitTween(b,g,ot,tt,It))return;for(Xt=b._zTime,b._zTime=g||(tt?_tinyNum:0),tt||(tt=g&&!Xt),b.ratio=gt,b._from&&(gt=1-gt),b._time=0,b._tTime=It,kt=b._pt;kt;)kt.r(gt,kt.d),kt=kt._next;g<0&&_rewindStartAt(b,g,tt,!0),b._onUpdate&&!tt&&_callback$1(b,"onUpdate"),It&&b._repeat&&!tt&&b.parent&&_callback$1(b,"onRepeat"),(g>=b._tDur||g<0)&&b.ratio===gt&&(gt&&_removeFromParent(b,1),!tt&&!_reverting$1&&(_callback$1(b,gt?"onComplete":"onReverseComplete",!0),b._prom&&b._prom()))}else b._zTime||(b._zTime=g)},_findNextPauseTween=function $(b,g,tt){var ot;if(tt>g)for(ot=b._first;ot&&ot._start<=tt;){if(ot.data==="isPause"&&ot._start>g)return ot;ot=ot._next}else for(ot=b._last;ot&&ot._start>=tt;){if(ot.data==="isPause"&&ot._start<g)return ot;ot=ot._prev}},_setDuration=function $(b,g,tt,ot){var ut=b._repeat,gt=_roundPrecise(g)||0,xt=b._tTime/b._tDur;return xt&&!ot&&(b._time*=gt/b._dur),b._dur=gt,b._tDur=ut?ut<0?1e10:_roundPrecise(gt*(ut+1)+b._rDelay*ut):gt,xt>0&&!ot&&_alignPlayhead(b,b._tTime=b._tDur*xt),b.parent&&_setEnd(b),tt||_uncache(b.parent,b),b},_onUpdateTotalDuration=function $(b){return b instanceof Timeline?_uncache(b):_setDuration(b,b._dur)},_zeroPosition={_start:0,endTime:_emptyFunc,totalDuration:_emptyFunc},_parsePosition$1=function $(b,g,tt){var ot=b.labels,ut=b._recent||_zeroPosition,gt=b.duration()>=_bigNum$1?ut.endTime(!1):b._dur,xt,It,kt;return _isString$1(g)&&(isNaN(g)||g in ot)?(It=g.charAt(0),kt=g.substr(-1)==="%",xt=g.indexOf("="),It==="<"||It===">"?(xt>=0&&(g=g.replace(/=/,"")),(It==="<"?ut._start:ut.endTime(ut._repeat>=0))+(parseFloat(g.substr(1))||0)*(kt?(xt<0?ut:tt).totalDuration()/100:1)):xt<0?(g in ot||(ot[g]=gt),ot[g]):(It=parseFloat(g.charAt(xt-1)+g.substr(xt+1)),kt&&tt&&(It=It/100*(_isArray(tt)?tt[0]:tt).totalDuration()),xt>1?$(b,g.substr(0,xt-1),tt)+It:gt+It)):g==null?gt:+g},_createTweenType=function $(b,g,tt){var ot=_isNumber$1(g[1]),ut=(ot?2:1)+(b<2?0:1),gt=g[ut],xt,It;if(ot&&(gt.duration=g[1]),gt.parent=tt,b){for(xt=gt,It=tt;It&&!("immediateRender"in xt);)xt=It.vars.defaults||{},It=_isNotFalse(It.vars.inherit)&&It.parent;gt.immediateRender=_isNotFalse(xt.immediateRender),b<2?gt.runBackwards=1:gt.startAt=g[ut-1]}return new Tween(g[0],gt,g[ut+1])},_conditionalReturn=function $(b,g){return b||b===0?g(b):g},_clamp$1=function $(b,g,tt){return tt<b?b:tt>g?g:tt},getUnit=function $(b,g){return!_isString$1(b)||!(g=_unitExp.exec(b))?"":g[1]},clamp=function $(b,g,tt){return _conditionalReturn(tt,function(ot){return _clamp$1(b,g,ot)})},_slice=[].slice,_isArrayLike=function $(b,g){return b&&_isObject$1(b)&&"length"in b&&(!g&&!b.length||b.length-1 in b&&_isObject$1(b[0]))&&!b.nodeType&&b!==_win$3},_flatten=function $(b,g,tt){return tt===void 0&&(tt=[]),b.forEach(function(ot){var ut;return _isString$1(ot)&&!g||_isArrayLike(ot,1)?(ut=tt).push.apply(ut,toArray(ot)):tt.push(ot)})||tt},toArray=function $(b,g,tt){return _context$2&&!g&&_context$2.selector?_context$2.selector(b):_isString$1(b)&&!tt&&(_coreInitted$2||!_wake())?_slice.call((g||_doc$3).querySelectorAll(b),0):_isArray(b)?_flatten(b,tt):_isArrayLike(b)?_slice.call(b,0):b?[b]:[]},selector=function $(b){return b=toArray(b)[0]||_warn("Invalid scope")||{},function(g){var tt=b.current||b.nativeElement||b;return toArray(g,tt.querySelectorAll?tt:tt===b?_warn("Invalid scope")||_doc$3.createElement("div"):b)}},shuffle=function $(b){return b.sort(function(){return .5-Math.random()})},distribute=function $(b){if(_isFunction$1(b))return b;var g=_isObject$1(b)?b:{each:b},tt=_parseEase(g.ease),ot=g.from||0,ut=parseFloat(g.base)||0,gt={},xt=ot>0&&ot<1,It=isNaN(ot)||xt,kt=g.axis,Ft=ot,Xt=ot;return _isString$1(ot)?Ft=Xt={center:.5,edges:.5,end:1}[ot]||0:!xt&&It&&(Ft=ot[0],Xt=ot[1]),function(qt,jt,sn){var Gt=(sn||g).length,vn=gt[Gt],nn,Wt,on,gn,ln,_n,Ut,Qt,tn;if(!vn){if(tn=g.grid==="auto"?0:(g.grid||[1,_bigNum$1])[1],!tn){for(Ut=-_bigNum$1;Ut<(Ut=sn[tn++].getBoundingClientRect().left)&&tn<Gt;);tn<Gt&&tn--}for(vn=gt[Gt]=[],nn=It?Math.min(tn,Gt)*Ft-.5:ot%tn,Wt=tn===_bigNum$1?0:It?Gt*Xt/tn-.5:ot/tn|0,Ut=0,Qt=_bigNum$1,_n=0;_n<Gt;_n++)on=_n%tn-nn,gn=Wt-(_n/tn|0),vn[_n]=ln=kt?Math.abs(kt==="y"?gn:on):_sqrt(on*on+gn*gn),ln>Ut&&(Ut=ln),ln<Qt&&(Qt=ln);ot==="random"&&shuffle(vn),vn.max=Ut-Qt,vn.min=Qt,vn.v=Gt=(parseFloat(g.amount)||parseFloat(g.each)*(tn>Gt?Gt-1:kt?kt==="y"?Gt/tn:tn:Math.max(tn,Gt/tn))||0)*(ot==="edges"?-1:1),vn.b=Gt<0?ut-Gt:ut,vn.u=getUnit(g.amount||g.each)||0,tt=tt&&Gt<0?_invertEase(tt):tt}return Gt=(vn[qt]-vn.min)/vn.max||0,_roundPrecise(vn.b+(tt?tt(Gt):Gt)*vn.v)+vn.u}},_roundModifier=function $(b){var g=Math.pow(10,((b+"").split(".")[1]||"").length);return function(tt){var ot=_roundPrecise(Math.round(parseFloat(tt)/b)*b*g);return(ot-ot%1)/g+(_isNumber$1(tt)?0:getUnit(tt))}},snap=function $(b,g){var tt=_isArray(b),ot,ut;return!tt&&_isObject$1(b)&&(ot=tt=b.radius||_bigNum$1,b.values?(b=toArray(b.values),(ut=!_isNumber$1(b[0]))&&(ot*=ot)):b=_roundModifier(b.increment)),_conditionalReturn(g,tt?_isFunction$1(b)?function(gt){return ut=b(gt),Math.abs(ut-gt)<=ot?ut:gt}:function(gt){for(var xt=parseFloat(ut?gt.x:gt),It=parseFloat(ut?gt.y:0),kt=_bigNum$1,Ft=0,Xt=b.length,qt,jt;Xt--;)ut?(qt=b[Xt].x-xt,jt=b[Xt].y-It,qt=qt*qt+jt*jt):qt=Math.abs(b[Xt]-xt),qt<kt&&(kt=qt,Ft=Xt);return Ft=!ot||kt<=ot?b[Ft]:gt,ut||Ft===gt||_isNumber$1(gt)?Ft:Ft+getUnit(gt)}:_roundModifier(b))},random=function $(b,g,tt,ot){return _conditionalReturn(_isArray(b)?!g:tt===!0?!!(tt=0):!ot,function(){return _isArray(b)?b[~~(Math.random()*b.length)]:(tt=tt||1e-5)&&(ot=tt<1?Math.pow(10,(tt+"").length-2):1)&&Math.floor(Math.round((b-tt/2+Math.random()*(g-b+tt*.99))/tt)*tt*ot)/ot})},pipe=function $(){for(var b=arguments.length,g=new Array(b),tt=0;tt<b;tt++)g[tt]=arguments[tt];return function(ot){return g.reduce(function(ut,gt){return gt(ut)},ot)}},unitize=function $(b,g){return function(tt){return b(parseFloat(tt))+(g||getUnit(tt))}},normalize=function $(b,g,tt){return mapRange(b,g,0,1,tt)},_wrapArray=function $(b,g,tt){return _conditionalReturn(tt,function(ot){return b[~~g(ot)]})},wrap=function $(b,g,tt){var ot=g-b;return _isArray(b)?_wrapArray(b,$(0,b.length),g):_conditionalReturn(tt,function(ut){return(ot+(ut-b)%ot)%ot+b})},wrapYoyo=function $(b,g,tt){var ot=g-b,ut=ot*2;return _isArray(b)?_wrapArray(b,$(0,b.length-1),g):_conditionalReturn(tt,function(gt){return gt=(ut+(gt-b)%ut)%ut||0,b+(gt>ot?ut-gt:gt)})},_replaceRandom=function $(b){for(var g=0,tt="",ot,ut,gt,xt;~(ot=b.indexOf("random(",g));)gt=b.indexOf(")",ot),xt=b.charAt(ot+7)==="[",ut=b.substr(ot+7,gt-ot-7).match(xt?_delimitedValueExp:_strictNumExp),tt+=b.substr(g,ot-g)+random(xt?ut:+ut[0],xt?0:+ut[1],+ut[2]||1e-5),g=gt+1;return tt+b.substr(g,b.length-g)},mapRange=function $(b,g,tt,ot,ut){var gt=g-b,xt=ot-tt;return _conditionalReturn(ut,function(It){return tt+((It-b)/gt*xt||0)})},interpolate=function $(b,g,tt,ot){var ut=isNaN(b+g)?0:function(jt){return(1-jt)*b+jt*g};if(!ut){var gt=_isString$1(b),xt={},It,kt,Ft,Xt,qt;if(tt===!0&&(ot=1)&&(tt=null),gt)b={p:b},g={p:g};else if(_isArray(b)&&!_isArray(g)){for(Ft=[],Xt=b.length,qt=Xt-2,kt=1;kt<Xt;kt++)Ft.push($(b[kt-1],b[kt]));Xt--,ut=function(sn){sn*=Xt;var Gt=Math.min(qt,~~sn);return Ft[Gt](sn-Gt)},tt=g}else ot||(b=_merge(_isArray(b)?[]:{},b));if(!Ft){for(It in g)_addPropTween.call(xt,b,It,"get",g[It]);ut=function(sn){return _renderPropTweens(sn,xt)||(gt?b.p:b)}}}return _conditionalReturn(tt,ut)},_getLabelInDirection=function $(b,g,tt){var ot=b.labels,ut=_bigNum$1,gt,xt,It;for(gt in ot)xt=ot[gt]-g,xt<0==!!tt&&xt&&ut>(xt=Math.abs(xt))&&(It=gt,ut=xt);return It},_callback$1=function $(b,g,tt){var ot=b.vars,ut=ot[g],gt=_context$2,xt=b._ctx,It,kt,Ft;if(ut)return It=ot[g+"Params"],kt=ot.callbackScope||b,tt&&_lazyTweens.length&&_lazyRender(),xt&&(_context$2=xt),Ft=It?ut.apply(kt,It):ut.call(kt),_context$2=gt,Ft},_interrupt=function $(b){return _removeFromParent(b),b.scrollTrigger&&b.scrollTrigger.kill(!!_reverting$1),b.progress()<1&&_callback$1(b,"onInterrupt"),b},_quickTween,_registerPluginQueue=[],_createPlugin=function $(b){if(_windowExists$2()&&b){b=!b.name&&b.default||b;var g=b.name,tt=_isFunction$1(b),ot=g&&!tt&&b.init?function(){this._props=[]}:b,ut={init:_emptyFunc,render:_renderPropTweens,add:_addPropTween,kill:_killPropTweensOf,modifier:_addPluginModifier,rawVars:0},gt={targetTest:0,get:0,getSetter:_getSetter,aliases:{},register:0};if(_wake(),b!==ot){if(_plugins[g])return;_setDefaults$1(ot,_setDefaults$1(_copyExcluding(b,ut),gt)),_merge(ot.prototype,_merge(ut,_copyExcluding(b,gt))),_plugins[ot.prop=g]=ot,b.targetTest&&(_harnessPlugins.push(ot),_reservedProps[g]=1),g=(g==="css"?"CSS":g.charAt(0).toUpperCase()+g.substr(1))+"Plugin"}_addGlobal(g,ot),b.register&&b.register(gsap$2,ot,PropTween)}else b&&_registerPluginQueue.push(b)},_255=255,_colorLookup={aqua:[0,_255,_255],lime:[0,_255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,_255],navy:[0,0,128],white:[_255,_255,_255],olive:[128,128,0],yellow:[_255,_255,0],orange:[_255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[_255,0,0],pink:[_255,192,203],cyan:[0,_255,_255],transparent:[_255,_255,_255,0]},_hue=function $(b,g,tt){return b+=b<0?1:b>1?-1:0,(b*6<1?g+(tt-g)*b*6:b<.5?tt:b*3<2?g+(tt-g)*(2/3-b)*6:g)*_255+.5|0},splitColor=function $(b,g,tt){var ot=b?_isNumber$1(b)?[b>>16,b>>8&_255,b&_255]:0:_colorLookup.black,ut,gt,xt,It,kt,Ft,Xt,qt,jt,sn;if(!ot){if(b.substr(-1)===","&&(b=b.substr(0,b.length-1)),_colorLookup[b])ot=_colorLookup[b];else if(b.charAt(0)==="#"){if(b.length<6&&(ut=b.charAt(1),gt=b.charAt(2),xt=b.charAt(3),b="#"+ut+ut+gt+gt+xt+xt+(b.length===5?b.charAt(4)+b.charAt(4):"")),b.length===9)return ot=parseInt(b.substr(1,6),16),[ot>>16,ot>>8&_255,ot&_255,parseInt(b.substr(7),16)/255];b=parseInt(b.substr(1),16),ot=[b>>16,b>>8&_255,b&_255]}else if(b.substr(0,3)==="hsl"){if(ot=sn=b.match(_strictNumExp),!g)It=+ot[0]%360/360,kt=+ot[1]/100,Ft=+ot[2]/100,gt=Ft<=.5?Ft*(kt+1):Ft+kt-Ft*kt,ut=Ft*2-gt,ot.length>3&&(ot[3]*=1),ot[0]=_hue(It+1/3,ut,gt),ot[1]=_hue(It,ut,gt),ot[2]=_hue(It-1/3,ut,gt);else if(~b.indexOf("="))return ot=b.match(_numExp),tt&&ot.length<4&&(ot[3]=1),ot}else ot=b.match(_strictNumExp)||_colorLookup.transparent;ot=ot.map(Number)}return g&&!sn&&(ut=ot[0]/_255,gt=ot[1]/_255,xt=ot[2]/_255,Xt=Math.max(ut,gt,xt),qt=Math.min(ut,gt,xt),Ft=(Xt+qt)/2,Xt===qt?It=kt=0:(jt=Xt-qt,kt=Ft>.5?jt/(2-Xt-qt):jt/(Xt+qt),It=Xt===ut?(gt-xt)/jt+(gt<xt?6:0):Xt===gt?(xt-ut)/jt+2:(ut-gt)/jt+4,It*=60),ot[0]=~~(It+.5),ot[1]=~~(kt*100+.5),ot[2]=~~(Ft*100+.5)),tt&&ot.length<4&&(ot[3]=1),ot},_colorOrderData=function $(b){var g=[],tt=[],ot=-1;return b.split(_colorExp).forEach(function(ut){var gt=ut.match(_numWithUnitExp)||[];g.push.apply(g,gt),tt.push(ot+=gt.length+1)}),g.c=tt,g},_formatColors=function $(b,g,tt){var ot="",ut=(b+ot).match(_colorExp),gt=g?"hsla(":"rgba(",xt=0,It,kt,Ft,Xt;if(!ut)return b;if(ut=ut.map(function(qt){return(qt=splitColor(qt,g,1))&&gt+(g?qt[0]+","+qt[1]+"%,"+qt[2]+"%,"+qt[3]:qt.join(","))+")"}),tt&&(Ft=_colorOrderData(b),It=tt.c,It.join(ot)!==Ft.c.join(ot)))for(kt=b.replace(_colorExp,"1").split(_numWithUnitExp),Xt=kt.length-1;xt<Xt;xt++)ot+=kt[xt]+(~It.indexOf(xt)?ut.shift()||gt+"0,0,0,0)":(Ft.length?Ft:ut.length?ut:tt).shift());if(!kt)for(kt=b.split(_colorExp),Xt=kt.length-1;xt<Xt;xt++)ot+=kt[xt]+ut[xt];return ot+kt[Xt]},_colorExp=function(){var $="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",b;for(b in _colorLookup)$+="|"+b+"\\b";return new RegExp($+")","gi")}(),_hslExp=/hsl[a]?\(/,_colorStringFilter=function $(b){var g=b.join(" "),tt;if(_colorExp.lastIndex=0,_colorExp.test(g))return tt=_hslExp.test(g),b[1]=_formatColors(b[1],tt),b[0]=_formatColors(b[0],tt,_colorOrderData(b[1])),!0},_tickerActive,_ticker=function(){var $=Date.now,b=500,g=33,tt=$(),ot=tt,ut=1e3/240,gt=ut,xt=[],It,kt,Ft,Xt,qt,jt,sn=function Gt(vn){var nn=$()-ot,Wt=vn===!0,on,gn,ln,_n;if(nn>b&&(tt+=nn-g),ot+=nn,ln=ot-tt,on=ln-gt,(on>0||Wt)&&(_n=++Xt.frame,qt=ln-Xt.time*1e3,Xt.time=ln=ln/1e3,gt+=on+(on>=ut?4:ut-on),gn=1),Wt||(It=kt(Gt)),gn)for(jt=0;jt<xt.length;jt++)xt[jt](ln,qt,_n,vn)};return Xt={time:0,frame:0,tick:function(){sn(!0)},deltaRatio:function(vn){return qt/(1e3/(vn||60))},wake:function(){_coreReady&&(!_coreInitted$2&&_windowExists$2()&&(_win$3=_coreInitted$2=window,_doc$3=_win$3.document||{},_globals.gsap=gsap$2,(_win$3.gsapVersions||(_win$3.gsapVersions=[])).push(gsap$2.version),_install(_installScope||_win$3.GreenSockGlobals||!_win$3.gsap&&_win$3||{}),Ft=_win$3.requestAnimationFrame,_registerPluginQueue.forEach(_createPlugin)),It&&Xt.sleep(),kt=Ft||function(vn){return setTimeout(vn,gt-Xt.time*1e3+1|0)},_tickerActive=1,sn(2))},sleep:function(){(Ft?_win$3.cancelAnimationFrame:clearTimeout)(It),_tickerActive=0,kt=_emptyFunc},lagSmoothing:function(vn,nn){b=vn||1/0,g=Math.min(nn||33,b)},fps:function(vn){ut=1e3/(vn||240),gt=Xt.time*1e3+ut},add:function(vn,nn,Wt){var on=nn?function(gn,ln,_n,Ut){vn(gn,ln,_n,Ut),Xt.remove(on)}:vn;return Xt.remove(vn),xt[Wt?"unshift":"push"](on),_wake(),on},remove:function(vn,nn){~(nn=xt.indexOf(vn))&&xt.splice(nn,1)&&jt>=nn&&jt--},_listeners:xt},Xt}(),_wake=function $(){return!_tickerActive&&_ticker.wake()},_easeMap={},_customEaseExp=/^[\d.\-M][\d.\-,\s]/,_quotesExp=/["']/g,_parseObjectInString=function $(b){for(var g={},tt=b.substr(1,b.length-3).split(":"),ot=tt[0],ut=1,gt=tt.length,xt,It,kt;ut<gt;ut++)It=tt[ut],xt=ut!==gt-1?It.lastIndexOf(","):It.length,kt=It.substr(0,xt),g[ot]=isNaN(kt)?kt.replace(_quotesExp,"").trim():+kt,ot=It.substr(xt+1).trim();return g},_valueInParentheses=function $(b){var g=b.indexOf("(")+1,tt=b.indexOf(")"),ot=b.indexOf("(",g);return b.substring(g,~ot&&ot<tt?b.indexOf(")",tt+1):tt)},_configEaseFromString=function $(b){var g=(b+"").split("("),tt=_easeMap[g[0]];return tt&&g.length>1&&tt.config?tt.config.apply(null,~b.indexOf("{")?[_parseObjectInString(g[1])]:_valueInParentheses(b).split(",").map(_numericIfPossible)):_easeMap._CE&&_customEaseExp.test(b)?_easeMap._CE("",b):tt},_invertEase=function $(b){return function(g){return 1-b(1-g)}},_propagateYoyoEase=function $(b,g){for(var tt=b._first,ot;tt;)tt instanceof Timeline?$(tt,g):tt.vars.yoyoEase&&(!tt._yoyo||!tt._repeat)&&tt._yoyo!==g&&(tt.timeline?$(tt.timeline,g):(ot=tt._ease,tt._ease=tt._yEase,tt._yEase=ot,tt._yoyo=g)),tt=tt._next},_parseEase=function $(b,g){return b&&(_isFunction$1(b)?b:_easeMap[b]||_configEaseFromString(b))||g},_insertEase=function $(b,g,tt,ot){tt===void 0&&(tt=function(It){return 1-g(1-It)}),ot===void 0&&(ot=function(It){return It<.5?g(It*2)/2:1-g((1-It)*2)/2});var ut={easeIn:g,easeOut:tt,easeInOut:ot},gt;return _forEachName(b,function(xt){_easeMap[xt]=_globals[xt]=ut,_easeMap[gt=xt.toLowerCase()]=tt;for(var It in ut)_easeMap[gt+(It==="easeIn"?".in":It==="easeOut"?".out":".inOut")]=_easeMap[xt+"."+It]=ut[It]}),ut},_easeInOutFromOut=function $(b){return function(g){return g<.5?(1-b(1-g*2))/2:.5+b((g-.5)*2)/2}},_configElastic=function $(b,g,tt){var ot=g>=1?g:1,ut=(tt||(b?.3:.45))/(g<1?g:1),gt=ut/_2PI*(Math.asin(1/ot)||0),xt=function(Ft){return Ft===1?1:ot*Math.pow(2,-10*Ft)*_sin((Ft-gt)*ut)+1},It=b==="out"?xt:b==="in"?function(kt){return 1-xt(1-kt)}:_easeInOutFromOut(xt);return ut=_2PI/ut,It.config=function(kt,Ft){return $(b,kt,Ft)},It},_configBack=function $(b,g){g===void 0&&(g=1.70158);var tt=function(gt){return gt?--gt*gt*((g+1)*gt+g)+1:0},ot=b==="out"?tt:b==="in"?function(ut){return 1-tt(1-ut)}:_easeInOutFromOut(tt);return ot.config=function(ut){return $(b,ut)},ot};_forEachName("Linear,Quad,Cubic,Quart,Quint,Strong",function($,b){var g=b<5?b+1:b;_insertEase($+",Power"+(g-1),b?function(tt){return Math.pow(tt,g)}:function(tt){return tt},function(tt){return 1-Math.pow(1-tt,g)},function(tt){return tt<.5?Math.pow(tt*2,g)/2:1-Math.pow((1-tt)*2,g)/2})});_easeMap.Linear.easeNone=_easeMap.none=_easeMap.Linear.easeIn;_insertEase("Elastic",_configElastic("in"),_configElastic("out"),_configElastic());(function($,b){var g=1/b,tt=2*g,ot=2.5*g,ut=function(xt){return xt<g?$*xt*xt:xt<tt?$*Math.pow(xt-1.5/b,2)+.75:xt<ot?$*(xt-=2.25/b)*xt+.9375:$*Math.pow(xt-2.625/b,2)+.984375};_insertEase("Bounce",function(gt){return 1-ut(1-gt)},ut)})(7.5625,2.75);_insertEase("Expo",function($){return $?Math.pow(2,10*($-1)):0});_insertEase("Circ",function($){return-(_sqrt(1-$*$)-1)});_insertEase("Sine",function($){return $===1?1:-_cos($*_HALF_PI)+1});_insertEase("Back",_configBack("in"),_configBack("out"),_configBack());_easeMap.SteppedEase=_easeMap.steps=_globals.SteppedEase={config:function $(b,g){b===void 0&&(b=1);var tt=1/b,ot=b+(g?0:1),ut=g?1:0,gt=1-_tinyNum;return function(xt){return((ot*_clamp$1(0,gt,xt)|0)+ut)*tt}}};_defaults$1.ease=_easeMap["quad.out"];_forEachName("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function($){return _callbackNames+=$+","+$+"Params,"});var GSCache=function $(b,g){this.id=_gsID++,b._gsap=this,this.target=b,this.harness=g,this.get=g?g.get:_getProperty,this.set=g?g.getSetter:_getSetter},Animation=function(){function $(g){this.vars=g,this._delay=+g.delay||0,(this._repeat=g.repeat===1/0?-2:g.repeat||0)&&(this._rDelay=g.repeatDelay||0,this._yoyo=!!g.yoyo||!!g.yoyoEase),this._ts=1,_setDuration(this,+g.duration,1,1),this.data=g.data,_context$2&&(this._ctx=_context$2,_context$2.data.push(this)),_tickerActive||_ticker.wake()}var b=$.prototype;return b.delay=function(tt){return tt||tt===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+tt-this._delay),this._delay=tt,this):this._delay},b.duration=function(tt){return arguments.length?this.totalDuration(this._repeat>0?tt+(tt+this._rDelay)*this._repeat:tt):this.totalDuration()&&this._dur},b.totalDuration=function(tt){return arguments.length?(this._dirty=0,_setDuration(this,this._repeat<0?tt:(tt-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},b.totalTime=function(tt,ot){if(_wake(),!arguments.length)return this._tTime;var ut=this._dp;if(ut&&ut.smoothChildTiming&&this._ts){for(_alignPlayhead(this,tt),!ut._dp||ut.parent||_postAddChecks(ut,this);ut&&ut.parent;)ut.parent._time!==ut._start+(ut._ts>=0?ut._tTime/ut._ts:(ut.totalDuration()-ut._tTime)/-ut._ts)&&ut.totalTime(ut._tTime,!0),ut=ut.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&tt<this._tDur||this._ts<0&&tt>0||!this._tDur&&!tt)&&_addToTimeline(this._dp,this,this._start-this._delay)}return(this._tTime!==tt||!this._dur&&!ot||this._initted&&Math.abs(this._zTime)===_tinyNum||!tt&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=tt),_lazySafeRender(this,tt,ot)),this},b.time=function(tt,ot){return arguments.length?this.totalTime(Math.min(this.totalDuration(),tt+_elapsedCycleDuration(this))%(this._dur+this._rDelay)||(tt?this._dur:0),ot):this._time},b.totalProgress=function(tt,ot){return arguments.length?this.totalTime(this.totalDuration()*tt,ot):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},b.progress=function(tt,ot){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-tt:tt)+_elapsedCycleDuration(this),ot):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},b.iteration=function(tt,ot){var ut=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(tt-1)*ut,ot):this._repeat?_animationCycle(this._tTime,ut)+1:1},b.timeScale=function(tt,ot){if(!arguments.length)return this._rts===-_tinyNum?0:this._rts;if(this._rts===tt)return this;var ut=this.parent&&this._ts?_parentToChildTotalTime(this.parent._time,this):this._tTime;return this._rts=+tt||0,this._ts=this._ps||tt===-_tinyNum?0:this._rts,this.totalTime(_clamp$1(-Math.abs(this._delay),this._tDur,ut),ot!==!1),_setEnd(this),_recacheAncestors(this)},b.paused=function(tt){return arguments.length?(this._ps!==tt&&(this._ps=tt,tt?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(_wake(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==_tinyNum&&(this._tTime-=_tinyNum)))),this):this._ps},b.startTime=function(tt){if(arguments.length){this._start=tt;var ot=this.parent||this._dp;return ot&&(ot._sort||!this.parent)&&_addToTimeline(ot,this,tt-this._delay),this}return this._start},b.endTime=function(tt){return this._start+(_isNotFalse(tt)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},b.rawTime=function(tt){var ot=this.parent||this._dp;return ot?tt&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?_parentToChildTotalTime(ot.rawTime(tt),this):this._tTime:this._tTime},b.revert=function(tt){tt===void 0&&(tt=_revertConfig);var ot=_reverting$1;return _reverting$1=tt,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(tt),this.totalTime(-.01,tt.suppressEvents)),this.data!=="nested"&&tt.kill!==!1&&this.kill(),_reverting$1=ot,this},b.globalTime=function(tt){for(var ot=this,ut=arguments.length?tt:ot.rawTime();ot;)ut=ot._start+ut/(Math.abs(ot._ts)||1),ot=ot._dp;return!this.parent&&this._sat?this._sat.globalTime(tt):ut},b.repeat=function(tt){return arguments.length?(this._repeat=tt===1/0?-2:tt,_onUpdateTotalDuration(this)):this._repeat===-2?1/0:this._repeat},b.repeatDelay=function(tt){if(arguments.length){var ot=this._time;return this._rDelay=tt,_onUpdateTotalDuration(this),ot?this.time(ot):this}return this._rDelay},b.yoyo=function(tt){return arguments.length?(this._yoyo=tt,this):this._yoyo},b.seek=function(tt,ot){return this.totalTime(_parsePosition$1(this,tt),_isNotFalse(ot))},b.restart=function(tt,ot){return this.play().totalTime(tt?-this._delay:0,_isNotFalse(ot))},b.play=function(tt,ot){return tt!=null&&this.seek(tt,ot),this.reversed(!1).paused(!1)},b.reverse=function(tt,ot){return tt!=null&&this.seek(tt||this.totalDuration(),ot),this.reversed(!0).paused(!1)},b.pause=function(tt,ot){return tt!=null&&this.seek(tt,ot),this.paused(!0)},b.resume=function(){return this.paused(!1)},b.reversed=function(tt){return arguments.length?(!!tt!==this.reversed()&&this.timeScale(-this._rts||(tt?-_tinyNum:0)),this):this._rts<0},b.invalidate=function(){return this._initted=this._act=0,this._zTime=-_tinyNum,this},b.isActive=function(){var tt=this.parent||this._dp,ot=this._start,ut;return!!(!tt||this._ts&&this._initted&&tt.isActive()&&(ut=tt.rawTime(!0))>=ot&&ut<this.endTime(!0)-_tinyNum)},b.eventCallback=function(tt,ot,ut){var gt=this.vars;return arguments.length>1?(ot?(gt[tt]=ot,ut&&(gt[tt+"Params"]=ut),tt==="onUpdate"&&(this._onUpdate=ot)):delete gt[tt],this):gt[tt]},b.then=function(tt){var ot=this;return new Promise(function(ut){var gt=_isFunction$1(tt)?tt:_passThrough$1,xt=function(){var kt=ot.then;ot.then=null,_isFunction$1(gt)&&(gt=gt(ot))&&(gt.then||gt===ot)&&(ot.then=kt),ut(gt),ot.then=kt};ot._initted&&ot.totalProgress()===1&&ot._ts>=0||!ot._tTime&&ot._ts<0?xt():ot._prom=xt})},b.kill=function(){_interrupt(this)},$}();_setDefaults$1(Animation.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-_tinyNum,_prom:0,_ps:!1,_rts:1});var Timeline=function($){_inheritsLoose(b,$);function b(tt,ot){var ut;return tt===void 0&&(tt={}),ut=$.call(this,tt)||this,ut.labels={},ut.smoothChildTiming=!!tt.smoothChildTiming,ut.autoRemoveChildren=!!tt.autoRemoveChildren,ut._sort=_isNotFalse(tt.sortChildren),_globalTimeline&&_addToTimeline(tt.parent||_globalTimeline,_assertThisInitialized(ut),ot),tt.reversed&&ut.reverse(),tt.paused&&ut.paused(!0),tt.scrollTrigger&&_scrollTrigger(_assertThisInitialized(ut),tt.scrollTrigger),ut}var g=b.prototype;return g.to=function(ot,ut,gt){return _createTweenType(0,arguments,this),this},g.from=function(ot,ut,gt){return _createTweenType(1,arguments,this),this},g.fromTo=function(ot,ut,gt,xt){return _createTweenType(2,arguments,this),this},g.set=function(ot,ut,gt){return ut.duration=0,ut.parent=this,_inheritDefaults(ut).repeatDelay||(ut.repeat=0),ut.immediateRender=!!ut.immediateRender,new Tween(ot,ut,_parsePosition$1(this,gt),1),this},g.call=function(ot,ut,gt){return _addToTimeline(this,Tween.delayedCall(0,ot,ut),gt)},g.staggerTo=function(ot,ut,gt,xt,It,kt,Ft){return gt.duration=ut,gt.stagger=gt.stagger||xt,gt.onComplete=kt,gt.onCompleteParams=Ft,gt.parent=this,new Tween(ot,gt,_parsePosition$1(this,It)),this},g.staggerFrom=function(ot,ut,gt,xt,It,kt,Ft){return gt.runBackwards=1,_inheritDefaults(gt).immediateRender=_isNotFalse(gt.immediateRender),this.staggerTo(ot,ut,gt,xt,It,kt,Ft)},g.staggerFromTo=function(ot,ut,gt,xt,It,kt,Ft,Xt){return xt.startAt=gt,_inheritDefaults(xt).immediateRender=_isNotFalse(xt.immediateRender),this.staggerTo(ot,ut,xt,It,kt,Ft,Xt)},g.render=function(ot,ut,gt){var xt=this._time,It=this._dirty?this.totalDuration():this._tDur,kt=this._dur,Ft=ot<=0?0:_roundPrecise(ot),Xt=this._zTime<0!=ot<0&&(this._initted||!kt),qt,jt,sn,Gt,vn,nn,Wt,on,gn,ln,_n,Ut;if(this!==_globalTimeline&&Ft>It&&ot>=0&&(Ft=It),Ft!==this._tTime||gt||Xt){if(xt!==this._time&&kt&&(Ft+=this._time-xt,ot+=this._time-xt),qt=Ft,gn=this._start,on=this._ts,nn=!on,Xt&&(kt||(xt=this._zTime),(ot||!ut)&&(this._zTime=ot)),this._repeat){if(_n=this._yoyo,vn=kt+this._rDelay,this._repeat<-1&&ot<0)return this.totalTime(vn*100+ot,ut,gt);if(qt=_roundPrecise(Ft%vn),Ft===It?(Gt=this._repeat,qt=kt):(Gt=~~(Ft/vn),Gt&&Gt===Ft/vn&&(qt=kt,Gt--),qt>kt&&(qt=kt)),ln=_animationCycle(this._tTime,vn),!xt&&this._tTime&&ln!==Gt&&this._tTime-ln*vn-this._dur<=0&&(ln=Gt),_n&&Gt&1&&(qt=kt-qt,Ut=1),Gt!==ln&&!this._lock){var Qt=_n&&ln&1,tn=Qt===(_n&&Gt&1);if(Gt<ln&&(Qt=!Qt),xt=Qt?0:Ft%kt?kt:Ft,this._lock=1,this.render(xt||(Ut?0:_roundPrecise(Gt*vn)),ut,!kt)._lock=0,this._tTime=Ft,!ut&&this.parent&&_callback$1(this,"onRepeat"),this.vars.repeatRefresh&&!Ut&&(this.invalidate()._lock=1),xt&&xt!==this._time||nn!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(kt=this._dur,It=this._tDur,tn&&(this._lock=2,xt=Qt?kt:-1e-4,this.render(xt,!0),this.vars.repeatRefresh&&!Ut&&this.invalidate()),this._lock=0,!this._ts&&!nn)return this;_propagateYoyoEase(this,Ut)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(Wt=_findNextPauseTween(this,_roundPrecise(xt),_roundPrecise(qt)),Wt&&(Ft-=qt-(qt=Wt._start))),this._tTime=Ft,this._time=qt,this._act=!on,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=ot,xt=0),!xt&&qt&&!ut&&!Gt&&(_callback$1(this,"onStart"),this._tTime!==Ft))return this;if(qt>=xt&&ot>=0)for(jt=this._first;jt;){if(sn=jt._next,(jt._act||qt>=jt._start)&&jt._ts&&Wt!==jt){if(jt.parent!==this)return this.render(ot,ut,gt);if(jt.render(jt._ts>0?(qt-jt._start)*jt._ts:(jt._dirty?jt.totalDuration():jt._tDur)+(qt-jt._start)*jt._ts,ut,gt),qt!==this._time||!this._ts&&!nn){Wt=0,sn&&(Ft+=this._zTime=-_tinyNum);break}}jt=sn}else{jt=this._last;for(var bn=ot<0?ot:qt;jt;){if(sn=jt._prev,(jt._act||bn<=jt._end)&&jt._ts&&Wt!==jt){if(jt.parent!==this)return this.render(ot,ut,gt);if(jt.render(jt._ts>0?(bn-jt._start)*jt._ts:(jt._dirty?jt.totalDuration():jt._tDur)+(bn-jt._start)*jt._ts,ut,gt||_reverting$1&&(jt._initted||jt._startAt)),qt!==this._time||!this._ts&&!nn){Wt=0,sn&&(Ft+=this._zTime=bn?-_tinyNum:_tinyNum);break}}jt=sn}}if(Wt&&!ut&&(this.pause(),Wt.render(qt>=xt?0:-_tinyNum)._zTime=qt>=xt?1:-1,this._ts))return this._start=gn,_setEnd(this),this.render(ot,ut,gt);this._onUpdate&&!ut&&_callback$1(this,"onUpdate",!0),(Ft===It&&this._tTime>=this.totalDuration()||!Ft&&xt)&&(gn===this._start||Math.abs(on)!==Math.abs(this._ts))&&(this._lock||((ot||!kt)&&(Ft===It&&this._ts>0||!Ft&&this._ts<0)&&_removeFromParent(this,1),!ut&&!(ot<0&&!xt)&&(Ft||xt||!It)&&(_callback$1(this,Ft===It&&ot>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(Ft<It&&this.timeScale()>0)&&this._prom())))}return this},g.add=function(ot,ut){var gt=this;if(_isNumber$1(ut)||(ut=_parsePosition$1(this,ut,ot)),!(ot instanceof Animation)){if(_isArray(ot))return ot.forEach(function(xt){return gt.add(xt,ut)}),this;if(_isString$1(ot))return this.addLabel(ot,ut);if(_isFunction$1(ot))ot=Tween.delayedCall(0,ot);else return this}return this!==ot?_addToTimeline(this,ot,ut):this},g.getChildren=function(ot,ut,gt,xt){ot===void 0&&(ot=!0),ut===void 0&&(ut=!0),gt===void 0&&(gt=!0),xt===void 0&&(xt=-_bigNum$1);for(var It=[],kt=this._first;kt;)kt._start>=xt&&(kt instanceof Tween?ut&&It.push(kt):(gt&&It.push(kt),ot&&It.push.apply(It,kt.getChildren(!0,ut,gt)))),kt=kt._next;return It},g.getById=function(ot){for(var ut=this.getChildren(1,1,1),gt=ut.length;gt--;)if(ut[gt].vars.id===ot)return ut[gt]},g.remove=function(ot){return _isString$1(ot)?this.removeLabel(ot):_isFunction$1(ot)?this.killTweensOf(ot):(_removeLinkedListItem(this,ot),ot===this._recent&&(this._recent=this._last),_uncache(this))},g.totalTime=function(ot,ut){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_roundPrecise(_ticker.time-(this._ts>0?ot/this._ts:(this.totalDuration()-ot)/-this._ts))),$.prototype.totalTime.call(this,ot,ut),this._forcing=0,this):this._tTime},g.addLabel=function(ot,ut){return this.labels[ot]=_parsePosition$1(this,ut),this},g.removeLabel=function(ot){return delete this.labels[ot],this},g.addPause=function(ot,ut,gt){var xt=Tween.delayedCall(0,ut||_emptyFunc,gt);return xt.data="isPause",this._hasPause=1,_addToTimeline(this,xt,_parsePosition$1(this,ot))},g.removePause=function(ot){var ut=this._first;for(ot=_parsePosition$1(this,ot);ut;)ut._start===ot&&ut.data==="isPause"&&_removeFromParent(ut),ut=ut._next},g.killTweensOf=function(ot,ut,gt){for(var xt=this.getTweensOf(ot,gt),It=xt.length;It--;)_overwritingTween!==xt[It]&&xt[It].kill(ot,ut);return this},g.getTweensOf=function(ot,ut){for(var gt=[],xt=toArray(ot),It=this._first,kt=_isNumber$1(ut),Ft;It;)It instanceof Tween?_arrayContainsAny(It._targets,xt)&&(kt?(!_overwritingTween||It._initted&&It._ts)&&It.globalTime(0)<=ut&&It.globalTime(It.totalDuration())>ut:!ut||It.isActive())&&gt.push(It):(Ft=It.getTweensOf(xt,ut)).length&&gt.push.apply(gt,Ft),It=It._next;return gt},g.tweenTo=function(ot,ut){ut=ut||{};var gt=this,xt=_parsePosition$1(gt,ot),It=ut,kt=It.startAt,Ft=It.onStart,Xt=It.onStartParams,qt=It.immediateRender,jt,sn=Tween.to(gt,_setDefaults$1({ease:ut.ease||"none",lazy:!1,immediateRender:!1,time:xt,overwrite:"auto",duration:ut.duration||Math.abs((xt-(kt&&"time"in kt?kt.time:gt._time))/gt.timeScale())||_tinyNum,onStart:function(){if(gt.pause(),!jt){var vn=ut.duration||Math.abs((xt-(kt&&"time"in kt?kt.time:gt._time))/gt.timeScale());sn._dur!==vn&&_setDuration(sn,vn,0,1).render(sn._time,!0,!0),jt=1}Ft&&Ft.apply(sn,Xt||[])}},ut));return qt?sn.render(0):sn},g.tweenFromTo=function(ot,ut,gt){return this.tweenTo(ut,_setDefaults$1({startAt:{time:_parsePosition$1(this,ot)}},gt))},g.recent=function(){return this._recent},g.nextLabel=function(ot){return ot===void 0&&(ot=this._time),_getLabelInDirection(this,_parsePosition$1(this,ot))},g.previousLabel=function(ot){return ot===void 0&&(ot=this._time),_getLabelInDirection(this,_parsePosition$1(this,ot),1)},g.currentLabel=function(ot){return arguments.length?this.seek(ot,!0):this.previousLabel(this._time+_tinyNum)},g.shiftChildren=function(ot,ut,gt){gt===void 0&&(gt=0);for(var xt=this._first,It=this.labels,kt;xt;)xt._start>=gt&&(xt._start+=ot,xt._end+=ot),xt=xt._next;if(ut)for(kt in It)It[kt]>=gt&&(It[kt]+=ot);return _uncache(this)},g.invalidate=function(ot){var ut=this._first;for(this._lock=0;ut;)ut.invalidate(ot),ut=ut._next;return $.prototype.invalidate.call(this,ot)},g.clear=function(ot){ot===void 0&&(ot=!0);for(var ut=this._first,gt;ut;)gt=ut._next,this.remove(ut),ut=gt;return this._dp&&(this._time=this._tTime=this._pTime=0),ot&&(this.labels={}),_uncache(this)},g.totalDuration=function(ot){var ut=0,gt=this,xt=gt._last,It=_bigNum$1,kt,Ft,Xt;if(arguments.length)return gt.timeScale((gt._repeat<0?gt.duration():gt.totalDuration())/(gt.reversed()?-ot:ot));if(gt._dirty){for(Xt=gt.parent;xt;)kt=xt._prev,xt._dirty&&xt.totalDuration(),Ft=xt._start,Ft>It&&gt._sort&&xt._ts&&!gt._lock?(gt._lock=1,_addToTimeline(gt,xt,Ft-xt._delay,1)._lock=0):It=Ft,Ft<0&&xt._ts&&(ut-=Ft,(!Xt&&!gt._dp||Xt&&Xt.smoothChildTiming)&&(gt._start+=Ft/gt._ts,gt._time-=Ft,gt._tTime-=Ft),gt.shiftChildren(-Ft,!1,-1/0),It=0),xt._end>ut&&xt._ts&&(ut=xt._end),xt=kt;_setDuration(gt,gt===_globalTimeline&&gt._time>ut?gt._time:ut,1,1),gt._dirty=0}return gt._tDur},b.updateRoot=function(ot){if(_globalTimeline._ts&&(_lazySafeRender(_globalTimeline,_parentToChildTotalTime(ot,_globalTimeline)),_lastRenderedFrame=_ticker.frame),_ticker.frame>=_nextGCFrame){_nextGCFrame+=_config.autoSleep||120;var ut=_globalTimeline._first;if((!ut||!ut._ts)&&_config.autoSleep&&_ticker._listeners.length<2){for(;ut&&!ut._ts;)ut=ut._next;ut||_ticker.sleep()}}},b}(Animation);_setDefaults$1(Timeline.prototype,{_lock:0,_hasPause:0,_forcing:0});var _addComplexStringPropTween=function $(b,g,tt,ot,ut,gt,xt){var It=new PropTween(this._pt,b,g,0,1,_renderComplexString,null,ut),kt=0,Ft=0,Xt,qt,jt,sn,Gt,vn,nn,Wt;for(It.b=tt,It.e=ot,tt+="",ot+="",(nn=~ot.indexOf("random("))&&(ot=_replaceRandom(ot)),gt&&(Wt=[tt,ot],gt(Wt,b,g),tt=Wt[0],ot=Wt[1]),qt=tt.match(_complexStringNumExp)||[];Xt=_complexStringNumExp.exec(ot);)sn=Xt[0],Gt=ot.substring(kt,Xt.index),jt?jt=(jt+1)%5:Gt.substr(-5)==="rgba("&&(jt=1),sn!==qt[Ft++]&&(vn=parseFloat(qt[Ft-1])||0,It._pt={_next:It._pt,p:Gt||Ft===1?Gt:",",s:vn,c:sn.charAt(1)==="="?_parseRelative(vn,sn)-vn:parseFloat(sn)-vn,m:jt&&jt<4?Math.round:0},kt=_complexStringNumExp.lastIndex);return It.c=kt<ot.length?ot.substring(kt,ot.length):"",It.fp=xt,(_relExp.test(ot)||nn)&&(It.e=0),this._pt=It,It},_addPropTween=function $(b,g,tt,ot,ut,gt,xt,It,kt,Ft){_isFunction$1(ot)&&(ot=ot(ut||0,b,gt));var Xt=b[g],qt=tt!=="get"?tt:_isFunction$1(Xt)?kt?b[g.indexOf("set")||!_isFunction$1(b["get"+g.substr(3)])?g:"get"+g.substr(3)](kt):b[g]():Xt,jt=_isFunction$1(Xt)?kt?_setterFuncWithParam:_setterFunc:_setterPlain,sn;if(_isString$1(ot)&&(~ot.indexOf("random(")&&(ot=_replaceRandom(ot)),ot.charAt(1)==="="&&(sn=_parseRelative(qt,ot)+(getUnit(qt)||0),(sn||sn===0)&&(ot=sn))),!Ft||qt!==ot||_forceAllPropTweens)return!isNaN(qt*ot)&&ot!==""?(sn=new PropTween(this._pt,b,g,+qt||0,ot-(qt||0),typeof Xt=="boolean"?_renderBoolean:_renderPlain,0,jt),kt&&(sn.fp=kt),xt&&sn.modifier(xt,this,b),this._pt=sn):(!Xt&&!(g in b)&&_missingPlugin(g,ot),_addComplexStringPropTween.call(this,b,g,qt,ot,jt,It||_config.stringFilter,kt))},_processVars=function $(b,g,tt,ot,ut){if(_isFunction$1(b)&&(b=_parseFuncOrString(b,ut,g,tt,ot)),!_isObject$1(b)||b.style&&b.nodeType||_isArray(b)||_isTypedArray(b))return _isString$1(b)?_parseFuncOrString(b,ut,g,tt,ot):b;var gt={},xt;for(xt in b)gt[xt]=_parseFuncOrString(b[xt],ut,g,tt,ot);return gt},_checkPlugin=function $(b,g,tt,ot,ut,gt){var xt,It,kt,Ft;if(_plugins[b]&&(xt=new _plugins[b]).init(ut,xt.rawVars?g[b]:_processVars(g[b],ot,ut,gt,tt),tt,ot,gt)!==!1&&(tt._pt=It=new PropTween(tt._pt,ut,b,0,1,xt.render,xt,0,xt.priority),tt!==_quickTween))for(kt=tt._ptLookup[tt._targets.indexOf(ut)],Ft=xt._props.length;Ft--;)kt[xt._props[Ft]]=It;return xt},_overwritingTween,_forceAllPropTweens,_initTween=function $(b,g,tt){var ot=b.vars,ut=ot.ease,gt=ot.startAt,xt=ot.immediateRender,It=ot.lazy,kt=ot.onUpdate,Ft=ot.runBackwards,Xt=ot.yoyoEase,qt=ot.keyframes,jt=ot.autoRevert,sn=b._dur,Gt=b._startAt,vn=b._targets,nn=b.parent,Wt=nn&&nn.data==="nested"?nn.vars.targets:vn,on=b._overwrite==="auto"&&!_suppressOverwrites$1,gn=b.timeline,ln,_n,Ut,Qt,tn,bn,Yt,en,un,yn,zn,Yn,tr;if(gn&&(!qt||!ut)&&(ut="none"),b._ease=_parseEase(ut,_defaults$1.ease),b._yEase=Xt?_invertEase(_parseEase(Xt===!0?ut:Xt,_defaults$1.ease)):0,Xt&&b._yoyo&&!b._repeat&&(Xt=b._yEase,b._yEase=b._ease,b._ease=Xt),b._from=!gn&&!!ot.runBackwards,!gn||qt&&!ot.stagger){if(en=vn[0]?_getCache(vn[0]).harness:0,Yn=en&&ot[en.prop],ln=_copyExcluding(ot,_reservedProps),Gt&&(Gt._zTime<0&&Gt.progress(1),g<0&&Ft&&xt&&!jt?Gt.render(-1,!0):Gt.revert(Ft&&sn?_revertConfigNoKill:_startAtRevertConfig),Gt._lazy=0),gt){if(_removeFromParent(b._startAt=Tween.set(vn,_setDefaults$1({data:"isStart",overwrite:!1,parent:nn,immediateRender:!0,lazy:!Gt&&_isNotFalse(It),startAt:null,delay:0,onUpdate:kt&&function(){return _callback$1(b,"onUpdate")},stagger:0},gt))),b._startAt._dp=0,b._startAt._sat=b,g<0&&(_reverting$1||!xt&&!jt)&&b._startAt.revert(_revertConfigNoKill),xt&&sn&&g<=0&&tt<=0){g&&(b._zTime=g);return}}else if(Ft&&sn&&!Gt){if(g&&(xt=!1),Ut=_setDefaults$1({overwrite:!1,data:"isFromStart",lazy:xt&&!Gt&&_isNotFalse(It),immediateRender:xt,stagger:0,parent:nn},ln),Yn&&(Ut[en.prop]=Yn),_removeFromParent(b._startAt=Tween.set(vn,Ut)),b._startAt._dp=0,b._startAt._sat=b,g<0&&(_reverting$1?b._startAt.revert(_revertConfigNoKill):b._startAt.render(-1,!0)),b._zTime=g,!xt)$(b._startAt,_tinyNum,_tinyNum);else if(!g)return}for(b._pt=b._ptCache=0,It=sn&&_isNotFalse(It)||It&&!sn,_n=0;_n<vn.length;_n++){if(tn=vn[_n],Yt=tn._gsap||_harness(vn)[_n]._gsap,b._ptLookup[_n]=yn={},_lazyLookup[Yt.id]&&_lazyTweens.length&&_lazyRender(),zn=Wt===vn?_n:Wt.indexOf(tn),en&&(un=new en).init(tn,Yn||ln,b,zn,Wt)!==!1&&(b._pt=Qt=new PropTween(b._pt,tn,un.name,0,1,un.render,un,0,un.priority),un._props.forEach(function(Un){yn[Un]=Qt}),un.priority&&(bn=1)),!en||Yn)for(Ut in ln)_plugins[Ut]&&(un=_checkPlugin(Ut,ln,b,zn,tn,Wt))?un.priority&&(bn=1):yn[Ut]=Qt=_addPropTween.call(b,tn,Ut,"get",ln[Ut],zn,Wt,0,ot.stringFilter);b._op&&b._op[_n]&&b.kill(tn,b._op[_n]),on&&b._pt&&(_overwritingTween=b,_globalTimeline.killTweensOf(tn,yn,b.globalTime(g)),tr=!b.parent,_overwritingTween=0),b._pt&&It&&(_lazyLookup[Yt.id]=1)}bn&&_sortPropTweensByPriority(b),b._onInit&&b._onInit(b)}b._onUpdate=kt,b._initted=(!b._op||b._pt)&&!tr,qt&&g<=0&&gn.render(_bigNum$1,!0,!0)},_updatePropTweens=function $(b,g,tt,ot,ut,gt,xt,It){var kt=(b._pt&&b._ptCache||(b._ptCache={}))[g],Ft,Xt,qt,jt;if(!kt)for(kt=b._ptCache[g]=[],qt=b._ptLookup,jt=b._targets.length;jt--;){if(Ft=qt[jt][g],Ft&&Ft.d&&Ft.d._pt)for(Ft=Ft.d._pt;Ft&&Ft.p!==g&&Ft.fp!==g;)Ft=Ft._next;if(!Ft)return _forceAllPropTweens=1,b.vars[g]="+=0",_initTween(b,xt),_forceAllPropTweens=0,It?_warn(g+" not eligible for reset"):1;kt.push(Ft)}for(jt=kt.length;jt--;)Xt=kt[jt],Ft=Xt._pt||Xt,Ft.s=(ot||ot===0)&&!ut?ot:Ft.s+(ot||0)+gt*Ft.c,Ft.c=tt-Ft.s,Xt.e&&(Xt.e=_round$1(tt)+getUnit(Xt.e)),Xt.b&&(Xt.b=Ft.s+getUnit(Xt.b))},_addAliasesToVars=function $(b,g){var tt=b[0]?_getCache(b[0]).harness:0,ot=tt&&tt.aliases,ut,gt,xt,It;if(!ot)return g;ut=_merge({},g);for(gt in ot)if(gt in ut)for(It=ot[gt].split(","),xt=It.length;xt--;)ut[It[xt]]=ut[gt];return ut},_parseKeyframe=function $(b,g,tt,ot){var ut=g.ease||ot||"power1.inOut",gt,xt;if(_isArray(g))xt=tt[b]||(tt[b]=[]),g.forEach(function(It,kt){return xt.push({t:kt/(g.length-1)*100,v:It,e:ut})});else for(gt in g)xt=tt[gt]||(tt[gt]=[]),gt==="ease"||xt.push({t:parseFloat(b),v:g[gt],e:ut})},_parseFuncOrString=function $(b,g,tt,ot,ut){return _isFunction$1(b)?b.call(g,tt,ot,ut):_isString$1(b)&&~b.indexOf("random(")?_replaceRandom(b):b},_staggerTweenProps=_callbackNames+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",_staggerPropsToSkip={};_forEachName(_staggerTweenProps+",id,stagger,delay,duration,paused,scrollTrigger",function($){return _staggerPropsToSkip[$]=1});var Tween=function($){_inheritsLoose(b,$);function b(tt,ot,ut,gt){var xt;typeof ot=="number"&&(ut.duration=ot,ot=ut,ut=null),xt=$.call(this,gt?ot:_inheritDefaults(ot))||this;var It=xt.vars,kt=It.duration,Ft=It.delay,Xt=It.immediateRender,qt=It.stagger,jt=It.overwrite,sn=It.keyframes,Gt=It.defaults,vn=It.scrollTrigger,nn=It.yoyoEase,Wt=ot.parent||_globalTimeline,on=(_isArray(tt)||_isTypedArray(tt)?_isNumber$1(tt[0]):"length"in ot)?[tt]:toArray(tt),gn,ln,_n,Ut,Qt,tn,bn,Yt;if(xt._targets=on.length?_harness(on):_warn("GSAP target "+tt+" not found. https://gsap.com",!_config.nullTargetWarn)||[],xt._ptLookup=[],xt._overwrite=jt,sn||qt||_isFuncOrString(kt)||_isFuncOrString(Ft)){if(ot=xt.vars,gn=xt.timeline=new Timeline({data:"nested",defaults:Gt||{},targets:Wt&&Wt.data==="nested"?Wt.vars.targets:on}),gn.kill(),gn.parent=gn._dp=_assertThisInitialized(xt),gn._start=0,qt||_isFuncOrString(kt)||_isFuncOrString(Ft)){if(Ut=on.length,bn=qt&&distribute(qt),_isObject$1(qt))for(Qt in qt)~_staggerTweenProps.indexOf(Qt)&&(Yt||(Yt={}),Yt[Qt]=qt[Qt]);for(ln=0;ln<Ut;ln++)_n=_copyExcluding(ot,_staggerPropsToSkip),_n.stagger=0,nn&&(_n.yoyoEase=nn),Yt&&_merge(_n,Yt),tn=on[ln],_n.duration=+_parseFuncOrString(kt,_assertThisInitialized(xt),ln,tn,on),_n.delay=(+_parseFuncOrString(Ft,_assertThisInitialized(xt),ln,tn,on)||0)-xt._delay,!qt&&Ut===1&&_n.delay&&(xt._delay=Ft=_n.delay,xt._start+=Ft,_n.delay=0),gn.to(tn,_n,bn?bn(ln,tn,on):0),gn._ease=_easeMap.none;gn.duration()?kt=Ft=0:xt.timeline=0}else if(sn){_inheritDefaults(_setDefaults$1(gn.vars.defaults,{ease:"none"})),gn._ease=_parseEase(sn.ease||ot.ease||"none");var en=0,un,yn,zn;if(_isArray(sn))sn.forEach(function(Yn){return gn.to(on,Yn,">")}),gn.duration();else{_n={};for(Qt in sn)Qt==="ease"||Qt==="easeEach"||_parseKeyframe(Qt,sn[Qt],_n,sn.easeEach);for(Qt in _n)for(un=_n[Qt].sort(function(Yn,tr){return Yn.t-tr.t}),en=0,ln=0;ln<un.length;ln++)yn=un[ln],zn={ease:yn.e,duration:(yn.t-(ln?un[ln-1].t:0))/100*kt},zn[Qt]=yn.v,gn.to(on,zn,en),en+=zn.duration;gn.duration()<kt&&gn.to({},{duration:kt-gn.duration()})}}kt||xt.duration(kt=gn.duration())}else xt.timeline=0;return jt===!0&&!_suppressOverwrites$1&&(_overwritingTween=_assertThisInitialized(xt),_globalTimeline.killTweensOf(on),_overwritingTween=0),_addToTimeline(Wt,_assertThisInitialized(xt),ut),ot.reversed&&xt.reverse(),ot.paused&&xt.paused(!0),(Xt||!kt&&!sn&&xt._start===_roundPrecise(Wt._time)&&_isNotFalse(Xt)&&_hasNoPausedAncestors(_assertThisInitialized(xt))&&Wt.data!=="nested")&&(xt._tTime=-_tinyNum,xt.render(Math.max(0,-Ft)||0)),vn&&_scrollTrigger(_assertThisInitialized(xt),vn),xt}var g=b.prototype;return g.render=function(ot,ut,gt){var xt=this._time,It=this._tDur,kt=this._dur,Ft=ot<0,Xt=ot>It-_tinyNum&&!Ft?It:ot<_tinyNum?0:ot,qt,jt,sn,Gt,vn,nn,Wt,on,gn;if(!kt)_renderZeroDurationTween(this,ot,ut,gt);else if(Xt!==this._tTime||!ot||gt||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==Ft){if(qt=Xt,on=this.timeline,this._repeat){if(Gt=kt+this._rDelay,this._repeat<-1&&Ft)return this.totalTime(Gt*100+ot,ut,gt);if(qt=_roundPrecise(Xt%Gt),Xt===It?(sn=this._repeat,qt=kt):(sn=~~(Xt/Gt),sn&&sn===_roundPrecise(Xt/Gt)&&(qt=kt,sn--),qt>kt&&(qt=kt)),nn=this._yoyo&&sn&1,nn&&(gn=this._yEase,qt=kt-qt),vn=_animationCycle(this._tTime,Gt),qt===xt&&!gt&&this._initted&&sn===vn)return this._tTime=Xt,this;sn!==vn&&(on&&this._yEase&&_propagateYoyoEase(on,nn),this.vars.repeatRefresh&&!nn&&!this._lock&&this._time!==kt&&this._initted&&(this._lock=gt=1,this.render(_roundPrecise(Gt*sn),!0).invalidate()._lock=0))}if(!this._initted){if(_attemptInitTween(this,Ft?ot:qt,gt,ut,Xt))return this._tTime=0,this;if(xt!==this._time&&!(gt&&this.vars.repeatRefresh&&sn!==vn))return this;if(kt!==this._dur)return this.render(ot,ut,gt)}if(this._tTime=Xt,this._time=qt,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=Wt=(gn||this._ease)(qt/kt),this._from&&(this.ratio=Wt=1-Wt),qt&&!xt&&!ut&&!sn&&(_callback$1(this,"onStart"),this._tTime!==Xt))return this;for(jt=this._pt;jt;)jt.r(Wt,jt.d),jt=jt._next;on&&on.render(ot<0?ot:!qt&&nn?-_tinyNum:on._dur*on._ease(qt/this._dur),ut,gt)||this._startAt&&(this._zTime=ot),this._onUpdate&&!ut&&(Ft&&_rewindStartAt(this,ot,ut,gt),_callback$1(this,"onUpdate")),this._repeat&&sn!==vn&&this.vars.onRepeat&&!ut&&this.parent&&_callback$1(this,"onRepeat"),(Xt===this._tDur||!Xt)&&this._tTime===Xt&&(Ft&&!this._onUpdate&&_rewindStartAt(this,ot,!0,!0),(ot||!kt)&&(Xt===this._tDur&&this._ts>0||!Xt&&this._ts<0)&&_removeFromParent(this,1),!ut&&!(Ft&&!xt)&&(Xt||xt||nn)&&(_callback$1(this,Xt===It?"onComplete":"onReverseComplete",!0),this._prom&&!(Xt<It&&this.timeScale()>0)&&this._prom()))}return this},g.targets=function(){return this._targets},g.invalidate=function(ot){return(!ot||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(ot),$.prototype.invalidate.call(this,ot)},g.resetTo=function(ot,ut,gt,xt,It){_tickerActive||_ticker.wake(),this._ts||this.play();var kt=Math.min(this._dur,(this._dp._time-this._start)*this._ts),Ft;return this._initted||_initTween(this,kt),Ft=this._ease(kt/this._dur),_updatePropTweens(this,ot,ut,gt,xt,Ft,kt,It)?this.resetTo(ot,ut,gt,xt,1):(_alignPlayhead(this,0),this.parent||_addLinkedListItem(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},g.kill=function(ot,ut){if(ut===void 0&&(ut="all"),!ot&&(!ut||ut==="all"))return this._lazy=this._pt=0,this.parent?_interrupt(this):this;if(this.timeline){var gt=this.timeline.totalDuration();return this.timeline.killTweensOf(ot,ut,_overwritingTween&&_overwritingTween.vars.overwrite!==!0)._first||_interrupt(this),this.parent&&gt!==this.timeline.totalDuration()&&_setDuration(this,this._dur*this.timeline._tDur/gt,0,1),this}var xt=this._targets,It=ot?toArray(ot):xt,kt=this._ptLookup,Ft=this._pt,Xt,qt,jt,sn,Gt,vn,nn;if((!ut||ut==="all")&&_arraysMatch(xt,It))return ut==="all"&&(this._pt=0),_interrupt(this);for(Xt=this._op=this._op||[],ut!=="all"&&(_isString$1(ut)&&(Gt={},_forEachName(ut,function(Wt){return Gt[Wt]=1}),ut=Gt),ut=_addAliasesToVars(xt,ut)),nn=xt.length;nn--;)if(~It.indexOf(xt[nn])){qt=kt[nn],ut==="all"?(Xt[nn]=ut,sn=qt,jt={}):(jt=Xt[nn]=Xt[nn]||{},sn=ut);for(Gt in sn)vn=qt&&qt[Gt],vn&&((!("kill"in vn.d)||vn.d.kill(Gt)===!0)&&_removeLinkedListItem(this,vn,"_pt"),delete qt[Gt]),jt!=="all"&&(jt[Gt]=1)}return this._initted&&!this._pt&&Ft&&_interrupt(this),this},b.to=function(ot,ut){return new b(ot,ut,arguments[2])},b.from=function(ot,ut){return _createTweenType(1,arguments)},b.delayedCall=function(ot,ut,gt,xt){return new b(ut,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:ot,onComplete:ut,onReverseComplete:ut,onCompleteParams:gt,onReverseCompleteParams:gt,callbackScope:xt})},b.fromTo=function(ot,ut,gt){return _createTweenType(2,arguments)},b.set=function(ot,ut){return ut.duration=0,ut.repeatDelay||(ut.repeat=0),new b(ot,ut)},b.killTweensOf=function(ot,ut,gt){return _globalTimeline.killTweensOf(ot,ut,gt)},b}(Animation);_setDefaults$1(Tween.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});_forEachName("staggerTo,staggerFrom,staggerFromTo",function($){Tween[$]=function(){var b=new Timeline,g=_slice.call(arguments,0);return g.splice($==="staggerFromTo"?5:4,0,0),b[$].apply(b,g)}});var _setterPlain=function $(b,g,tt){return b[g]=tt},_setterFunc=function $(b,g,tt){return b[g](tt)},_setterFuncWithParam=function $(b,g,tt,ot){return b[g](ot.fp,tt)},_setterAttribute=function $(b,g,tt){return b.setAttribute(g,tt)},_getSetter=function $(b,g){return _isFunction$1(b[g])?_setterFunc:_isUndefined(b[g])&&b.setAttribute?_setterAttribute:_setterPlain},_renderPlain=function $(b,g){return g.set(g.t,g.p,Math.round((g.s+g.c*b)*1e6)/1e6,g)},_renderBoolean=function $(b,g){return g.set(g.t,g.p,!!(g.s+g.c*b),g)},_renderComplexString=function $(b,g){var tt=g._pt,ot="";if(!b&&g.b)ot=g.b;else if(b===1&&g.e)ot=g.e;else{for(;tt;)ot=tt.p+(tt.m?tt.m(tt.s+tt.c*b):Math.round((tt.s+tt.c*b)*1e4)/1e4)+ot,tt=tt._next;ot+=g.c}g.set(g.t,g.p,ot,g)},_renderPropTweens=function $(b,g){for(var tt=g._pt;tt;)tt.r(b,tt.d),tt=tt._next},_addPluginModifier=function $(b,g,tt,ot){for(var ut=this._pt,gt;ut;)gt=ut._next,ut.p===ot&&ut.modifier(b,g,tt),ut=gt},_killPropTweensOf=function $(b){for(var g=this._pt,tt,ot;g;)ot=g._next,g.p===b&&!g.op||g.op===b?_removeLinkedListItem(this,g,"_pt"):g.dep||(tt=1),g=ot;return!tt},_setterWithModifier=function $(b,g,tt,ot){ot.mSet(b,g,ot.m.call(ot.tween,tt,ot.mt),ot)},_sortPropTweensByPriority=function $(b){for(var g=b._pt,tt,ot,ut,gt;g;){for(tt=g._next,ot=ut;ot&&ot.pr>g.pr;)ot=ot._next;(g._prev=ot?ot._prev:gt)?g._prev._next=g:ut=g,(g._next=ot)?ot._prev=g:gt=g,g=tt}b._pt=ut},PropTween=function(){function $(g,tt,ot,ut,gt,xt,It,kt,Ft){this.t=tt,this.s=ut,this.c=gt,this.p=ot,this.r=xt||_renderPlain,this.d=It||this,this.set=kt||_setterPlain,this.pr=Ft||0,this._next=g,g&&(g._prev=this)}var b=$.prototype;return b.modifier=function(tt,ot,ut){this.mSet=this.mSet||this.set,this.set=_setterWithModifier,this.m=tt,this.mt=ut,this.tween=ot},$}();_forEachName(_callbackNames+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function($){return _reservedProps[$]=1});_globals.TweenMax=_globals.TweenLite=Tween;_globals.TimelineLite=_globals.TimelineMax=Timeline;_globalTimeline=new Timeline({sortChildren:!1,defaults:_defaults$1,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});_config.stringFilter=_colorStringFilter;var _media=[],_listeners$1={},_emptyArray$1=[],_lastMediaTime=0,_contextID=0,_dispatch$1=function $(b){return(_listeners$1[b]||_emptyArray$1).map(function(g){return g()})},_onMediaChange=function $(){var b=Date.now(),g=[];b-_lastMediaTime>2&&(_dispatch$1("matchMediaInit"),_media.forEach(function(tt){var ot=tt.queries,ut=tt.conditions,gt,xt,It,kt;for(xt in ot)gt=_win$3.matchMedia(ot[xt]).matches,gt&&(It=1),gt!==ut[xt]&&(ut[xt]=gt,kt=1);kt&&(tt.revert(),It&&g.push(tt))}),_dispatch$1("matchMediaRevert"),g.forEach(function(tt){return tt.onMatch(tt,function(ot){return tt.add(null,ot)})}),_lastMediaTime=b,_dispatch$1("matchMedia"))},Context=function(){function $(g,tt){this.selector=tt&&selector(tt),this.data=[],this._r=[],this.isReverted=!1,this.id=_contextID++,g&&this.add(g)}var b=$.prototype;return b.add=function(tt,ot,ut){_isFunction$1(tt)&&(ut=ot,ot=tt,tt=_isFunction$1);var gt=this,xt=function(){var kt=_context$2,Ft=gt.selector,Xt;return kt&&kt!==gt&&kt.data.push(gt),ut&&(gt.selector=selector(ut)),_context$2=gt,Xt=ot.apply(gt,arguments),_isFunction$1(Xt)&&gt._r.push(Xt),_context$2=kt,gt.selector=Ft,gt.isReverted=!1,Xt};return gt.last=xt,tt===_isFunction$1?xt(gt,function(It){return gt.add(null,It)}):tt?gt[tt]=xt:xt},b.ignore=function(tt){var ot=_context$2;_context$2=null,tt(this),_context$2=ot},b.getTweens=function(){var tt=[];return this.data.forEach(function(ot){return ot instanceof $?tt.push.apply(tt,ot.getTweens()):ot instanceof Tween&&!(ot.parent&&ot.parent.data==="nested")&&tt.push(ot)}),tt},b.clear=function(){this._r.length=this.data.length=0},b.kill=function(tt,ot){var ut=this;if(tt?function(){for(var xt=ut.getTweens(),It=ut.data.length,kt;It--;)kt=ut.data[It],kt.data==="isFlip"&&(kt.revert(),kt.getChildren(!0,!0,!1).forEach(function(Ft){return xt.splice(xt.indexOf(Ft),1)}));for(xt.map(function(Ft){return{g:Ft._dur||Ft._delay||Ft._sat&&!Ft._sat.vars.immediateRender?Ft.globalTime(0):-1/0,t:Ft}}).sort(function(Ft,Xt){return Xt.g-Ft.g||-1/0}).forEach(function(Ft){return Ft.t.revert(tt)}),It=ut.data.length;It--;)kt=ut.data[It],kt instanceof Timeline?kt.data!=="nested"&&(kt.scrollTrigger&&kt.scrollTrigger.revert(),kt.kill()):!(kt instanceof Tween)&&kt.revert&&kt.revert(tt);ut._r.forEach(function(Ft){return Ft(tt,ut)}),ut.isReverted=!0}():this.data.forEach(function(xt){return xt.kill&&xt.kill()}),this.clear(),ot)for(var gt=_media.length;gt--;)_media[gt].id===this.id&&_media.splice(gt,1)},b.revert=function(tt){this.kill(tt||{})},$}(),MatchMedia=function(){function $(g){this.contexts=[],this.scope=g}var b=$.prototype;return b.add=function(tt,ot,ut){_isObject$1(tt)||(tt={matches:tt});var gt=new Context(0,ut||this.scope),xt=gt.conditions={},It,kt,Ft;_context$2&&!gt.selector&&(gt.selector=_context$2.selector),this.contexts.push(gt),ot=gt.add("onMatch",ot),gt.queries=tt;for(kt in tt)kt==="all"?Ft=1:(It=_win$3.matchMedia(tt[kt]),It&&(_media.indexOf(gt)<0&&_media.push(gt),(xt[kt]=It.matches)&&(Ft=1),It.addListener?It.addListener(_onMediaChange):It.addEventListener("change",_onMediaChange)));return Ft&&ot(gt,function(Xt){return gt.add(null,Xt)}),this},b.revert=function(tt){this.kill(tt||{})},b.kill=function(tt){this.contexts.forEach(function(ot){return ot.kill(tt,!0)})},$}(),_gsap={registerPlugin:function $(){for(var b=arguments.length,g=new Array(b),tt=0;tt<b;tt++)g[tt]=arguments[tt];g.forEach(function(ot){return _createPlugin(ot)})},timeline:function $(b){return new Timeline(b)},getTweensOf:function $(b,g){return _globalTimeline.getTweensOf(b,g)},getProperty:function $(b,g,tt,ot){_isString$1(b)&&(b=toArray(b)[0]);var ut=_getCache(b||{}).get,gt=tt?_passThrough$1:_numericIfPossible;return tt==="native"&&(tt=""),b&&(g?gt((_plugins[g]&&_plugins[g].get||ut)(b,g,tt,ot)):function(xt,It,kt){return gt((_plugins[xt]&&_plugins[xt].get||ut)(b,xt,It,kt))})},quickSetter:function $(b,g,tt){if(b=toArray(b),b.length>1){var ot=b.map(function(Ft){return gsap$2.quickSetter(Ft,g,tt)}),ut=ot.length;return function(Ft){for(var Xt=ut;Xt--;)ot[Xt](Ft)}}b=b[0]||{};var gt=_plugins[g],xt=_getCache(b),It=xt.harness&&(xt.harness.aliases||{})[g]||g,kt=gt?function(Ft){var Xt=new gt;_quickTween._pt=0,Xt.init(b,tt?Ft+tt:Ft,_quickTween,0,[b]),Xt.render(1,Xt),_quickTween._pt&&_renderPropTweens(1,_quickTween)}:xt.set(b,It);return gt?kt:function(Ft){return kt(b,It,tt?Ft+tt:Ft,xt,1)}},quickTo:function $(b,g,tt){var ot,ut=gsap$2.to(b,_merge((ot={},ot[g]="+=0.1",ot.paused=!0,ot),tt||{})),gt=function(It,kt,Ft){return ut.resetTo(g,It,kt,Ft)};return gt.tween=ut,gt},isTweening:function $(b){return _globalTimeline.getTweensOf(b,!0).length>0},defaults:function $(b){return b&&b.ease&&(b.ease=_parseEase(b.ease,_defaults$1.ease)),_mergeDeep(_defaults$1,b||{})},config:function $(b){return _mergeDeep(_config,b||{})},registerEffect:function $(b){var g=b.name,tt=b.effect,ot=b.plugins,ut=b.defaults,gt=b.extendTimeline;(ot||"").split(",").forEach(function(xt){return xt&&!_plugins[xt]&&!_globals[xt]&&_warn(g+" effect requires "+xt+" plugin.")}),_effects[g]=function(xt,It,kt){return tt(toArray(xt),_setDefaults$1(It||{},ut),kt)},gt&&(Timeline.prototype[g]=function(xt,It,kt){return this.add(_effects[g](xt,_isObject$1(It)?It:(kt=It)&&{},this),kt)})},registerEase:function $(b,g){_easeMap[b]=_parseEase(g)},parseEase:function $(b,g){return arguments.length?_parseEase(b,g):_easeMap},getById:function $(b){return _globalTimeline.getById(b)},exportRoot:function $(b,g){b===void 0&&(b={});var tt=new Timeline(b),ot,ut;for(tt.smoothChildTiming=_isNotFalse(b.smoothChildTiming),_globalTimeline.remove(tt),tt._dp=0,tt._time=tt._tTime=_globalTimeline._time,ot=_globalTimeline._first;ot;)ut=ot._next,(g||!(!ot._dur&&ot instanceof Tween&&ot.vars.onComplete===ot._targets[0]))&&_addToTimeline(tt,ot,ot._start-ot._delay),ot=ut;return _addToTimeline(_globalTimeline,tt,0),tt},context:function $(b,g){return b?new Context(b,g):_context$2},matchMedia:function $(b){return new MatchMedia(b)},matchMediaRefresh:function $(){return _media.forEach(function(b){var g=b.conditions,tt,ot;for(ot in g)g[ot]&&(g[ot]=!1,tt=1);tt&&b.revert()})||_onMediaChange()},addEventListener:function $(b,g){var tt=_listeners$1[b]||(_listeners$1[b]=[]);~tt.indexOf(g)||tt.push(g)},removeEventListener:function $(b,g){var tt=_listeners$1[b],ot=tt&&tt.indexOf(g);ot>=0&&tt.splice(ot,1)},utils:{wrap,wrapYoyo,distribute,random,snap,normalize,getUnit,clamp,splitColor,toArray,selector,mapRange,pipe,unitize,interpolate,shuffle},install:_install,effects:_effects,ticker:_ticker,updateRoot:Timeline.updateRoot,plugins:_plugins,globalTimeline:_globalTimeline,core:{PropTween,globals:_addGlobal,Tween,Timeline,Animation,getCache:_getCache,_removeLinkedListItem,reverting:function $(){return _reverting$1},context:function $(b){return b&&_context$2&&(_context$2.data.push(b),b._ctx=_context$2),_context$2},suppressOverwrites:function $(b){return _suppressOverwrites$1=b}}};_forEachName("to,from,fromTo,delayedCall,set,killTweensOf",function($){return _gsap[$]=Tween[$]});_ticker.add(Timeline.updateRoot);_quickTween=_gsap.to({},{duration:0});var _getPluginPropTween=function $(b,g){for(var tt=b._pt;tt&&tt.p!==g&&tt.op!==g&&tt.fp!==g;)tt=tt._next;return tt},_addModifiers=function $(b,g){var tt=b._targets,ot,ut,gt;for(ot in g)for(ut=tt.length;ut--;)gt=b._ptLookup[ut][ot],gt&&(gt=gt.d)&&(gt._pt&&(gt=_getPluginPropTween(gt,ot)),gt&&gt.modifier&&gt.modifier(g[ot],b,tt[ut],ot))},_buildModifierPlugin=function $(b,g){return{name:b,rawVars:1,init:function(ot,ut,gt){gt._onInit=function(xt){var It,kt;if(_isString$1(ut)&&(It={},_forEachName(ut,function(Ft){return It[Ft]=1}),ut=It),g){It={};for(kt in ut)It[kt]=g(ut[kt]);ut=It}_addModifiers(xt,ut)}}}},gsap$2=_gsap.registerPlugin({name:"attr",init:function $(b,g,tt,ot,ut){var gt,xt,It;this.tween=tt;for(gt in g)It=b.getAttribute(gt)||"",xt=this.add(b,"setAttribute",(It||0)+"",g[gt],ot,ut,0,0,gt),xt.op=gt,xt.b=It,this._props.push(gt)},render:function $(b,g){for(var tt=g._pt;tt;)_reverting$1?tt.set(tt.t,tt.p,tt.b,tt):tt.r(b,tt.d),tt=tt._next}},{name:"endArray",init:function $(b,g){for(var tt=g.length;tt--;)this.add(b,tt,b[tt]||0,g[tt],0,0,0,0,0,1)}},_buildModifierPlugin("roundProps",_roundModifier),_buildModifierPlugin("modifiers"),_buildModifierPlugin("snap",snap))||_gsap;Tween.version=Timeline.version=gsap$2.version="3.12.4";_coreReady=1;_windowExists$2()&&_wake();_easeMap.Power0;_easeMap.Power1;_easeMap.Power2;_easeMap.Power3;_easeMap.Power4;_easeMap.Linear;_easeMap.Quad;_easeMap.Cubic;_easeMap.Quart;_easeMap.Quint;_easeMap.Strong;_easeMap.Elastic;_easeMap.Back;_easeMap.SteppedEase;_easeMap.Bounce;_easeMap.Sine;_easeMap.Expo;_easeMap.Circ;/*!
 * CSSPlugin 3.12.4
 * https://gsap.com
 *
 * Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var _win$2,_doc$2,_docElement,_pluginInitted,_tempDiv,_recentSetterPlugin,_reverting,_windowExists$1=function $(){return typeof window<"u"},_transformProps={},_RAD2DEG=180/Math.PI,_DEG2RAD=Math.PI/180,_atan2=Math.atan2,_bigNum=1e8,_capsExp$1=/([A-Z])/g,_horizontalExp=/(left|right|width|margin|padding|x)/i,_complexExp=/[\s,\(]\S/,_propertyAliases={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},_renderCSSProp=function $(b,g){return g.set(g.t,g.p,Math.round((g.s+g.c*b)*1e4)/1e4+g.u,g)},_renderPropWithEnd=function $(b,g){return g.set(g.t,g.p,b===1?g.e:Math.round((g.s+g.c*b)*1e4)/1e4+g.u,g)},_renderCSSPropWithBeginning=function $(b,g){return g.set(g.t,g.p,b?Math.round((g.s+g.c*b)*1e4)/1e4+g.u:g.b,g)},_renderRoundedCSSProp=function $(b,g){var tt=g.s+g.c*b;g.set(g.t,g.p,~~(tt+(tt<0?-.5:.5))+g.u,g)},_renderNonTweeningValue=function $(b,g){return g.set(g.t,g.p,b?g.e:g.b,g)},_renderNonTweeningValueOnlyAtEnd=function $(b,g){return g.set(g.t,g.p,b!==1?g.b:g.e,g)},_setterCSSStyle=function $(b,g,tt){return b.style[g]=tt},_setterCSSProp=function $(b,g,tt){return b.style.setProperty(g,tt)},_setterTransform=function $(b,g,tt){return b._gsap[g]=tt},_setterScale=function $(b,g,tt){return b._gsap.scaleX=b._gsap.scaleY=tt},_setterScaleWithRender=function $(b,g,tt,ot,ut){var gt=b._gsap;gt.scaleX=gt.scaleY=tt,gt.renderTransform(ut,gt)},_setterTransformWithRender=function $(b,g,tt,ot,ut){var gt=b._gsap;gt[g]=tt,gt.renderTransform(ut,gt)},_transformProp$1="transform",_transformOriginProp=_transformProp$1+"Origin",_saveStyle=function $(b,g){var tt=this,ot=this.target,ut=ot.style,gt=ot._gsap;if(b in _transformProps&&ut){if(this.tfm=this.tfm||{},b!=="transform")b=_propertyAliases[b]||b,~b.indexOf(",")?b.split(",").forEach(function(xt){return tt.tfm[xt]=_get(ot,xt)}):this.tfm[b]=gt.x?gt[b]:_get(ot,b),b===_transformOriginProp&&(this.tfm.zOrigin=gt.zOrigin);else return _propertyAliases.transform.split(",").forEach(function(xt){return $.call(tt,xt,g)});if(this.props.indexOf(_transformProp$1)>=0)return;gt.svg&&(this.svgo=ot.getAttribute("data-svg-origin"),this.props.push(_transformOriginProp,g,"")),b=_transformProp$1}(ut||g)&&this.props.push(b,g,ut[b])},_removeIndependentTransforms=function $(b){b.translate&&(b.removeProperty("translate"),b.removeProperty("scale"),b.removeProperty("rotate"))},_revertStyle=function $(){var b=this.props,g=this.target,tt=g.style,ot=g._gsap,ut,gt;for(ut=0;ut<b.length;ut+=3)b[ut+1]?g[b[ut]]=b[ut+2]:b[ut+2]?tt[b[ut]]=b[ut+2]:tt.removeProperty(b[ut].substr(0,2)==="--"?b[ut]:b[ut].replace(_capsExp$1,"-$1").toLowerCase());if(this.tfm){for(gt in this.tfm)ot[gt]=this.tfm[gt];ot.svg&&(ot.renderTransform(),g.setAttribute("data-svg-origin",this.svgo||"")),ut=_reverting(),(!ut||!ut.isStart)&&!tt[_transformProp$1]&&(_removeIndependentTransforms(tt),ot.zOrigin&&tt[_transformOriginProp]&&(tt[_transformOriginProp]+=" "+ot.zOrigin+"px",ot.zOrigin=0,ot.renderTransform()),ot.uncache=1)}},_getStyleSaver=function $(b,g){var tt={target:b,props:[],revert:_revertStyle,save:_saveStyle};return b._gsap||gsap$2.core.getCache(b),g&&g.split(",").forEach(function(ot){return tt.save(ot)}),tt},_supports3D,_createElement=function $(b,g){var tt=_doc$2.createElementNS?_doc$2.createElementNS((g||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),b):_doc$2.createElement(b);return tt&&tt.style?tt:_doc$2.createElement(b)},_getComputedProperty=function $(b,g,tt){var ot=getComputedStyle(b);return ot[g]||ot.getPropertyValue(g.replace(_capsExp$1,"-$1").toLowerCase())||ot.getPropertyValue(g)||!tt&&$(b,_checkPropPrefix(g)||g,1)||""},_prefixes="O,Moz,ms,Ms,Webkit".split(","),_checkPropPrefix=function $(b,g,tt){var ot=g||_tempDiv,ut=ot.style,gt=5;if(b in ut&&!tt)return b;for(b=b.charAt(0).toUpperCase()+b.substr(1);gt--&&!(_prefixes[gt]+b in ut););return gt<0?null:(gt===3?"ms":gt>=0?_prefixes[gt]:"")+b},_initCore$1=function $(){_windowExists$1()&&window.document&&(_win$2=window,_doc$2=_win$2.document,_docElement=_doc$2.documentElement,_tempDiv=_createElement("div")||{style:{}},_createElement("div"),_transformProp$1=_checkPropPrefix(_transformProp$1),_transformOriginProp=_transformProp$1+"Origin",_tempDiv.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",_supports3D=!!_checkPropPrefix("perspective"),_reverting=gsap$2.core.reverting,_pluginInitted=1)},_getBBoxHack=function $(b){var g=_createElement("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),tt=this.parentNode,ot=this.nextSibling,ut=this.style.cssText,gt;if(_docElement.appendChild(g),g.appendChild(this),this.style.display="block",b)try{gt=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=$}catch{}else this._gsapBBox&&(gt=this._gsapBBox());return tt&&(ot?tt.insertBefore(this,ot):tt.appendChild(this)),_docElement.removeChild(g),this.style.cssText=ut,gt},_getAttributeFallbacks=function $(b,g){for(var tt=g.length;tt--;)if(b.hasAttribute(g[tt]))return b.getAttribute(g[tt])},_getBBox=function $(b){var g;try{g=b.getBBox()}catch{g=_getBBoxHack.call(b,!0)}return g&&(g.width||g.height)||b.getBBox===_getBBoxHack||(g=_getBBoxHack.call(b,!0)),g&&!g.width&&!g.x&&!g.y?{x:+_getAttributeFallbacks(b,["x","cx","x1"])||0,y:+_getAttributeFallbacks(b,["y","cy","y1"])||0,width:0,height:0}:g},_isSVG=function $(b){return!!(b.getCTM&&(!b.parentNode||b.ownerSVGElement)&&_getBBox(b))},_removeProperty=function $(b,g){if(g){var tt=b.style,ot;g in _transformProps&&g!==_transformOriginProp&&(g=_transformProp$1),tt.removeProperty?(ot=g.substr(0,2),(ot==="ms"||g.substr(0,6)==="webkit")&&(g="-"+g),tt.removeProperty(ot==="--"?g:g.replace(_capsExp$1,"-$1").toLowerCase())):tt.removeAttribute(g)}},_addNonTweeningPT=function $(b,g,tt,ot,ut,gt){var xt=new PropTween(b._pt,g,tt,0,1,gt?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue);return b._pt=xt,xt.b=ot,xt.e=ut,b._props.push(tt),xt},_nonConvertibleUnits={deg:1,rad:1,turn:1},_nonStandardLayouts={grid:1,flex:1},_convertToUnit=function $(b,g,tt,ot){var ut=parseFloat(tt)||0,gt=(tt+"").trim().substr((ut+"").length)||"px",xt=_tempDiv.style,It=_horizontalExp.test(g),kt=b.tagName.toLowerCase()==="svg",Ft=(kt?"client":"offset")+(It?"Width":"Height"),Xt=100,qt=ot==="px",jt=ot==="%",sn,Gt,vn,nn;if(ot===gt||!ut||_nonConvertibleUnits[ot]||_nonConvertibleUnits[gt])return ut;if(gt!=="px"&&!qt&&(ut=$(b,g,tt,"px")),nn=b.getCTM&&_isSVG(b),(jt||gt==="%")&&(_transformProps[g]||~g.indexOf("adius")))return sn=nn?b.getBBox()[It?"width":"height"]:b[Ft],_round$1(jt?ut/sn*Xt:ut/100*sn);if(xt[It?"width":"height"]=Xt+(qt?gt:ot),Gt=~g.indexOf("adius")||ot==="em"&&b.appendChild&&!kt?b:b.parentNode,nn&&(Gt=(b.ownerSVGElement||{}).parentNode),(!Gt||Gt===_doc$2||!Gt.appendChild)&&(Gt=_doc$2.body),vn=Gt._gsap,vn&&jt&&vn.width&&It&&vn.time===_ticker.time&&!vn.uncache)return _round$1(ut/vn.width*Xt);if(jt&&(g==="height"||g==="width")){var Wt=b.style[g];b.style[g]=Xt+ot,sn=b[Ft],Wt?b.style[g]=Wt:_removeProperty(b,g)}else(jt||gt==="%")&&!_nonStandardLayouts[_getComputedProperty(Gt,"display")]&&(xt.position=_getComputedProperty(b,"position")),Gt===b&&(xt.position="static"),Gt.appendChild(_tempDiv),sn=_tempDiv[Ft],Gt.removeChild(_tempDiv),xt.position="absolute";return It&&jt&&(vn=_getCache(Gt),vn.time=_ticker.time,vn.width=Gt[Ft]),_round$1(qt?sn*ut/Xt:sn&&ut?Xt/sn*ut:0)},_get=function $(b,g,tt,ot){var ut;return _pluginInitted||_initCore$1(),g in _propertyAliases&&g!=="transform"&&(g=_propertyAliases[g],~g.indexOf(",")&&(g=g.split(",")[0])),_transformProps[g]&&g!=="transform"?(ut=_parseTransform(b,ot),ut=g!=="transformOrigin"?ut[g]:ut.svg?ut.origin:_firstTwoOnly(_getComputedProperty(b,_transformOriginProp))+" "+ut.zOrigin+"px"):(ut=b.style[g],(!ut||ut==="auto"||ot||~(ut+"").indexOf("calc("))&&(ut=_specialProps[g]&&_specialProps[g](b,g,tt)||_getComputedProperty(b,g)||_getProperty(b,g)||(g==="opacity"?1:0))),tt&&!~(ut+"").trim().indexOf(" ")?_convertToUnit(b,g,ut,tt)+tt:ut},_tweenComplexCSSString=function $(b,g,tt,ot){if(!tt||tt==="none"){var ut=_checkPropPrefix(g,b,1),gt=ut&&_getComputedProperty(b,ut,1);gt&&gt!==tt?(g=ut,tt=gt):g==="borderColor"&&(tt=_getComputedProperty(b,"borderTopColor"))}var xt=new PropTween(this._pt,b.style,g,0,1,_renderComplexString),It=0,kt=0,Ft,Xt,qt,jt,sn,Gt,vn,nn,Wt,on,gn,ln;if(xt.b=tt,xt.e=ot,tt+="",ot+="",ot==="auto"&&(Gt=b.style[g],b.style[g]=ot,ot=_getComputedProperty(b,g)||ot,Gt?b.style[g]=Gt:_removeProperty(b,g)),Ft=[tt,ot],_colorStringFilter(Ft),tt=Ft[0],ot=Ft[1],qt=tt.match(_numWithUnitExp)||[],ln=ot.match(_numWithUnitExp)||[],ln.length){for(;Xt=_numWithUnitExp.exec(ot);)vn=Xt[0],Wt=ot.substring(It,Xt.index),sn?sn=(sn+1)%5:(Wt.substr(-5)==="rgba("||Wt.substr(-5)==="hsla(")&&(sn=1),vn!==(Gt=qt[kt++]||"")&&(jt=parseFloat(Gt)||0,gn=Gt.substr((jt+"").length),vn.charAt(1)==="="&&(vn=_parseRelative(jt,vn)+gn),nn=parseFloat(vn),on=vn.substr((nn+"").length),It=_numWithUnitExp.lastIndex-on.length,on||(on=on||_config.units[g]||gn,It===ot.length&&(ot+=on,xt.e+=on)),gn!==on&&(jt=_convertToUnit(b,g,Gt,on)||0),xt._pt={_next:xt._pt,p:Wt||kt===1?Wt:",",s:jt,c:nn-jt,m:sn&&sn<4||g==="zIndex"?Math.round:0});xt.c=It<ot.length?ot.substring(It,ot.length):""}else xt.r=g==="display"&&ot==="none"?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue;return _relExp.test(ot)&&(xt.e=0),this._pt=xt,xt},_keywordToPercent={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},_convertKeywordsToPercentages=function $(b){var g=b.split(" "),tt=g[0],ot=g[1]||"50%";return(tt==="top"||tt==="bottom"||ot==="left"||ot==="right")&&(b=tt,tt=ot,ot=b),g[0]=_keywordToPercent[tt]||tt,g[1]=_keywordToPercent[ot]||ot,g.join(" ")},_renderClearProps=function $(b,g){if(g.tween&&g.tween._time===g.tween._dur){var tt=g.t,ot=tt.style,ut=g.u,gt=tt._gsap,xt,It,kt;if(ut==="all"||ut===!0)ot.cssText="",It=1;else for(ut=ut.split(","),kt=ut.length;--kt>-1;)xt=ut[kt],_transformProps[xt]&&(It=1,xt=xt==="transformOrigin"?_transformOriginProp:_transformProp$1),_removeProperty(tt,xt);It&&(_removeProperty(tt,_transformProp$1),gt&&(gt.svg&&tt.removeAttribute("transform"),_parseTransform(tt,1),gt.uncache=1,_removeIndependentTransforms(ot)))}},_specialProps={clearProps:function $(b,g,tt,ot,ut){if(ut.data!=="isFromStart"){var gt=b._pt=new PropTween(b._pt,g,tt,0,0,_renderClearProps);return gt.u=ot,gt.pr=-10,gt.tween=ut,b._props.push(tt),1}}},_identity2DMatrix=[1,0,0,1,0,0],_rotationalProperties={},_isNullTransform=function $(b){return b==="matrix(1, 0, 0, 1, 0, 0)"||b==="none"||!b},_getComputedTransformMatrixAsArray=function $(b){var g=_getComputedProperty(b,_transformProp$1);return _isNullTransform(g)?_identity2DMatrix:g.substr(7).match(_numExp).map(_round$1)},_getMatrix=function $(b,g){var tt=b._gsap||_getCache(b),ot=b.style,ut=_getComputedTransformMatrixAsArray(b),gt,xt,It,kt;return tt.svg&&b.getAttribute("transform")?(It=b.transform.baseVal.consolidate().matrix,ut=[It.a,It.b,It.c,It.d,It.e,It.f],ut.join(",")==="1,0,0,1,0,0"?_identity2DMatrix:ut):(ut===_identity2DMatrix&&!b.offsetParent&&b!==_docElement&&!tt.svg&&(It=ot.display,ot.display="block",gt=b.parentNode,(!gt||!b.offsetParent)&&(kt=1,xt=b.nextElementSibling,_docElement.appendChild(b)),ut=_getComputedTransformMatrixAsArray(b),It?ot.display=It:_removeProperty(b,"display"),kt&&(xt?gt.insertBefore(b,xt):gt?gt.appendChild(b):_docElement.removeChild(b))),g&&ut.length>6?[ut[0],ut[1],ut[4],ut[5],ut[12],ut[13]]:ut)},_applySVGOrigin=function $(b,g,tt,ot,ut,gt){var xt=b._gsap,It=ut||_getMatrix(b,!0),kt=xt.xOrigin||0,Ft=xt.yOrigin||0,Xt=xt.xOffset||0,qt=xt.yOffset||0,jt=It[0],sn=It[1],Gt=It[2],vn=It[3],nn=It[4],Wt=It[5],on=g.split(" "),gn=parseFloat(on[0])||0,ln=parseFloat(on[1])||0,_n,Ut,Qt,tn;tt?It!==_identity2DMatrix&&(Ut=jt*vn-sn*Gt)&&(Qt=gn*(vn/Ut)+ln*(-Gt/Ut)+(Gt*Wt-vn*nn)/Ut,tn=gn*(-sn/Ut)+ln*(jt/Ut)-(jt*Wt-sn*nn)/Ut,gn=Qt,ln=tn):(_n=_getBBox(b),gn=_n.x+(~on[0].indexOf("%")?gn/100*_n.width:gn),ln=_n.y+(~(on[1]||on[0]).indexOf("%")?ln/100*_n.height:ln)),ot||ot!==!1&&xt.smooth?(nn=gn-kt,Wt=ln-Ft,xt.xOffset=Xt+(nn*jt+Wt*Gt)-nn,xt.yOffset=qt+(nn*sn+Wt*vn)-Wt):xt.xOffset=xt.yOffset=0,xt.xOrigin=gn,xt.yOrigin=ln,xt.smooth=!!ot,xt.origin=g,xt.originIsAbsolute=!!tt,b.style[_transformOriginProp]="0px 0px",gt&&(_addNonTweeningPT(gt,xt,"xOrigin",kt,gn),_addNonTweeningPT(gt,xt,"yOrigin",Ft,ln),_addNonTweeningPT(gt,xt,"xOffset",Xt,xt.xOffset),_addNonTweeningPT(gt,xt,"yOffset",qt,xt.yOffset)),b.setAttribute("data-svg-origin",gn+" "+ln)},_parseTransform=function $(b,g){var tt=b._gsap||new GSCache(b);if("x"in tt&&!g&&!tt.uncache)return tt;var ot=b.style,ut=tt.scaleX<0,gt="px",xt="deg",It=getComputedStyle(b),kt=_getComputedProperty(b,_transformOriginProp)||"0",Ft,Xt,qt,jt,sn,Gt,vn,nn,Wt,on,gn,ln,_n,Ut,Qt,tn,bn,Yt,en,un,yn,zn,Yn,tr,Un,Jn,hn,rr,sr,br,Kn,dn;return Ft=Xt=qt=Gt=vn=nn=Wt=on=gn=0,jt=sn=1,tt.svg=!!(b.getCTM&&_isSVG(b)),It.translate&&((It.translate!=="none"||It.scale!=="none"||It.rotate!=="none")&&(ot[_transformProp$1]=(It.translate!=="none"?"translate3d("+(It.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(It.rotate!=="none"?"rotate("+It.rotate+") ":"")+(It.scale!=="none"?"scale("+It.scale.split(" ").join(",")+") ":"")+(It[_transformProp$1]!=="none"?It[_transformProp$1]:"")),ot.scale=ot.rotate=ot.translate="none"),Ut=_getMatrix(b,tt.svg),tt.svg&&(tt.uncache?(Un=b.getBBox(),kt=tt.xOrigin-Un.x+"px "+(tt.yOrigin-Un.y)+"px",tr=""):tr=!g&&b.getAttribute("data-svg-origin"),_applySVGOrigin(b,tr||kt,!!tr||tt.originIsAbsolute,tt.smooth!==!1,Ut)),ln=tt.xOrigin||0,_n=tt.yOrigin||0,Ut!==_identity2DMatrix&&(Yt=Ut[0],en=Ut[1],un=Ut[2],yn=Ut[3],Ft=zn=Ut[4],Xt=Yn=Ut[5],Ut.length===6?(jt=Math.sqrt(Yt*Yt+en*en),sn=Math.sqrt(yn*yn+un*un),Gt=Yt||en?_atan2(en,Yt)*_RAD2DEG:0,Wt=un||yn?_atan2(un,yn)*_RAD2DEG+Gt:0,Wt&&(sn*=Math.abs(Math.cos(Wt*_DEG2RAD))),tt.svg&&(Ft-=ln-(ln*Yt+_n*un),Xt-=_n-(ln*en+_n*yn))):(dn=Ut[6],br=Ut[7],hn=Ut[8],rr=Ut[9],sr=Ut[10],Kn=Ut[11],Ft=Ut[12],Xt=Ut[13],qt=Ut[14],Qt=_atan2(dn,sr),vn=Qt*_RAD2DEG,Qt&&(tn=Math.cos(-Qt),bn=Math.sin(-Qt),tr=zn*tn+hn*bn,Un=Yn*tn+rr*bn,Jn=dn*tn+sr*bn,hn=zn*-bn+hn*tn,rr=Yn*-bn+rr*tn,sr=dn*-bn+sr*tn,Kn=br*-bn+Kn*tn,zn=tr,Yn=Un,dn=Jn),Qt=_atan2(-un,sr),nn=Qt*_RAD2DEG,Qt&&(tn=Math.cos(-Qt),bn=Math.sin(-Qt),tr=Yt*tn-hn*bn,Un=en*tn-rr*bn,Jn=un*tn-sr*bn,Kn=yn*bn+Kn*tn,Yt=tr,en=Un,un=Jn),Qt=_atan2(en,Yt),Gt=Qt*_RAD2DEG,Qt&&(tn=Math.cos(Qt),bn=Math.sin(Qt),tr=Yt*tn+en*bn,Un=zn*tn+Yn*bn,en=en*tn-Yt*bn,Yn=Yn*tn-zn*bn,Yt=tr,zn=Un),vn&&Math.abs(vn)+Math.abs(Gt)>359.9&&(vn=Gt=0,nn=180-nn),jt=_round$1(Math.sqrt(Yt*Yt+en*en+un*un)),sn=_round$1(Math.sqrt(Yn*Yn+dn*dn)),Qt=_atan2(zn,Yn),Wt=Math.abs(Qt)>2e-4?Qt*_RAD2DEG:0,gn=Kn?1/(Kn<0?-Kn:Kn):0),tt.svg&&(tr=b.getAttribute("transform"),tt.forceCSS=b.setAttribute("transform","")||!_isNullTransform(_getComputedProperty(b,_transformProp$1)),tr&&b.setAttribute("transform",tr))),Math.abs(Wt)>90&&Math.abs(Wt)<270&&(ut?(jt*=-1,Wt+=Gt<=0?180:-180,Gt+=Gt<=0?180:-180):(sn*=-1,Wt+=Wt<=0?180:-180)),g=g||tt.uncache,tt.x=Ft-((tt.xPercent=Ft&&(!g&&tt.xPercent||(Math.round(b.offsetWidth/2)===Math.round(-Ft)?-50:0)))?b.offsetWidth*tt.xPercent/100:0)+gt,tt.y=Xt-((tt.yPercent=Xt&&(!g&&tt.yPercent||(Math.round(b.offsetHeight/2)===Math.round(-Xt)?-50:0)))?b.offsetHeight*tt.yPercent/100:0)+gt,tt.z=qt+gt,tt.scaleX=_round$1(jt),tt.scaleY=_round$1(sn),tt.rotation=_round$1(Gt)+xt,tt.rotationX=_round$1(vn)+xt,tt.rotationY=_round$1(nn)+xt,tt.skewX=Wt+xt,tt.skewY=on+xt,tt.transformPerspective=gn+gt,(tt.zOrigin=parseFloat(kt.split(" ")[2])||!g&&tt.zOrigin||0)&&(ot[_transformOriginProp]=_firstTwoOnly(kt)),tt.xOffset=tt.yOffset=0,tt.force3D=_config.force3D,tt.renderTransform=tt.svg?_renderSVGTransforms:_supports3D?_renderCSSTransforms:_renderNon3DTransforms,tt.uncache=0,tt},_firstTwoOnly=function $(b){return(b=b.split(" "))[0]+" "+b[1]},_addPxTranslate=function $(b,g,tt){var ot=getUnit(g);return _round$1(parseFloat(g)+parseFloat(_convertToUnit(b,"x",tt+"px",ot)))+ot},_renderNon3DTransforms=function $(b,g){g.z="0px",g.rotationY=g.rotationX="0deg",g.force3D=0,_renderCSSTransforms(b,g)},_zeroDeg="0deg",_zeroPx="0px",_endParenthesis=") ",_renderCSSTransforms=function $(b,g){var tt=g||this,ot=tt.xPercent,ut=tt.yPercent,gt=tt.x,xt=tt.y,It=tt.z,kt=tt.rotation,Ft=tt.rotationY,Xt=tt.rotationX,qt=tt.skewX,jt=tt.skewY,sn=tt.scaleX,Gt=tt.scaleY,vn=tt.transformPerspective,nn=tt.force3D,Wt=tt.target,on=tt.zOrigin,gn="",ln=nn==="auto"&&b&&b!==1||nn===!0;if(on&&(Xt!==_zeroDeg||Ft!==_zeroDeg)){var _n=parseFloat(Ft)*_DEG2RAD,Ut=Math.sin(_n),Qt=Math.cos(_n),tn;_n=parseFloat(Xt)*_DEG2RAD,tn=Math.cos(_n),gt=_addPxTranslate(Wt,gt,Ut*tn*-on),xt=_addPxTranslate(Wt,xt,-Math.sin(_n)*-on),It=_addPxTranslate(Wt,It,Qt*tn*-on+on)}vn!==_zeroPx&&(gn+="perspective("+vn+_endParenthesis),(ot||ut)&&(gn+="translate("+ot+"%, "+ut+"%) "),(ln||gt!==_zeroPx||xt!==_zeroPx||It!==_zeroPx)&&(gn+=It!==_zeroPx||ln?"translate3d("+gt+", "+xt+", "+It+") ":"translate("+gt+", "+xt+_endParenthesis),kt!==_zeroDeg&&(gn+="rotate("+kt+_endParenthesis),Ft!==_zeroDeg&&(gn+="rotateY("+Ft+_endParenthesis),Xt!==_zeroDeg&&(gn+="rotateX("+Xt+_endParenthesis),(qt!==_zeroDeg||jt!==_zeroDeg)&&(gn+="skew("+qt+", "+jt+_endParenthesis),(sn!==1||Gt!==1)&&(gn+="scale("+sn+", "+Gt+_endParenthesis),Wt.style[_transformProp$1]=gn||"translate(0, 0)"},_renderSVGTransforms=function $(b,g){var tt=g||this,ot=tt.xPercent,ut=tt.yPercent,gt=tt.x,xt=tt.y,It=tt.rotation,kt=tt.skewX,Ft=tt.skewY,Xt=tt.scaleX,qt=tt.scaleY,jt=tt.target,sn=tt.xOrigin,Gt=tt.yOrigin,vn=tt.xOffset,nn=tt.yOffset,Wt=tt.forceCSS,on=parseFloat(gt),gn=parseFloat(xt),ln,_n,Ut,Qt,tn;It=parseFloat(It),kt=parseFloat(kt),Ft=parseFloat(Ft),Ft&&(Ft=parseFloat(Ft),kt+=Ft,It+=Ft),It||kt?(It*=_DEG2RAD,kt*=_DEG2RAD,ln=Math.cos(It)*Xt,_n=Math.sin(It)*Xt,Ut=Math.sin(It-kt)*-qt,Qt=Math.cos(It-kt)*qt,kt&&(Ft*=_DEG2RAD,tn=Math.tan(kt-Ft),tn=Math.sqrt(1+tn*tn),Ut*=tn,Qt*=tn,Ft&&(tn=Math.tan(Ft),tn=Math.sqrt(1+tn*tn),ln*=tn,_n*=tn)),ln=_round$1(ln),_n=_round$1(_n),Ut=_round$1(Ut),Qt=_round$1(Qt)):(ln=Xt,Qt=qt,_n=Ut=0),(on&&!~(gt+"").indexOf("px")||gn&&!~(xt+"").indexOf("px"))&&(on=_convertToUnit(jt,"x",gt,"px"),gn=_convertToUnit(jt,"y",xt,"px")),(sn||Gt||vn||nn)&&(on=_round$1(on+sn-(sn*ln+Gt*Ut)+vn),gn=_round$1(gn+Gt-(sn*_n+Gt*Qt)+nn)),(ot||ut)&&(tn=jt.getBBox(),on=_round$1(on+ot/100*tn.width),gn=_round$1(gn+ut/100*tn.height)),tn="matrix("+ln+","+_n+","+Ut+","+Qt+","+on+","+gn+")",jt.setAttribute("transform",tn),Wt&&(jt.style[_transformProp$1]=tn)},_addRotationalPropTween=function $(b,g,tt,ot,ut){var gt=360,xt=_isString$1(ut),It=parseFloat(ut)*(xt&&~ut.indexOf("rad")?_RAD2DEG:1),kt=It-ot,Ft=ot+kt+"deg",Xt,qt;return xt&&(Xt=ut.split("_")[1],Xt==="short"&&(kt%=gt,kt!==kt%(gt/2)&&(kt+=kt<0?gt:-gt)),Xt==="cw"&&kt<0?kt=(kt+gt*_bigNum)%gt-~~(kt/gt)*gt:Xt==="ccw"&&kt>0&&(kt=(kt-gt*_bigNum)%gt-~~(kt/gt)*gt)),b._pt=qt=new PropTween(b._pt,g,tt,ot,kt,_renderPropWithEnd),qt.e=Ft,qt.u="deg",b._props.push(tt),qt},_assign=function $(b,g){for(var tt in g)b[tt]=g[tt];return b},_addRawTransformPTs=function $(b,g,tt){var ot=_assign({},tt._gsap),ut="perspective,force3D,transformOrigin,svgOrigin",gt=tt.style,xt,It,kt,Ft,Xt,qt,jt,sn;ot.svg?(kt=tt.getAttribute("transform"),tt.setAttribute("transform",""),gt[_transformProp$1]=g,xt=_parseTransform(tt,1),_removeProperty(tt,_transformProp$1),tt.setAttribute("transform",kt)):(kt=getComputedStyle(tt)[_transformProp$1],gt[_transformProp$1]=g,xt=_parseTransform(tt,1),gt[_transformProp$1]=kt);for(It in _transformProps)kt=ot[It],Ft=xt[It],kt!==Ft&&ut.indexOf(It)<0&&(jt=getUnit(kt),sn=getUnit(Ft),Xt=jt!==sn?_convertToUnit(tt,It,kt,sn):parseFloat(kt),qt=parseFloat(Ft),b._pt=new PropTween(b._pt,xt,It,Xt,qt-Xt,_renderCSSProp),b._pt.u=sn||0,b._props.push(It));_assign(xt,ot)};_forEachName("padding,margin,Width,Radius",function($,b){var g="Top",tt="Right",ot="Bottom",ut="Left",gt=(b<3?[g,tt,ot,ut]:[g+ut,g+tt,ot+tt,ot+ut]).map(function(xt){return b<2?$+xt:"border"+xt+$});_specialProps[b>1?"border"+$:$]=function(xt,It,kt,Ft,Xt){var qt,jt;if(arguments.length<4)return qt=gt.map(function(sn){return _get(xt,sn,kt)}),jt=qt.join(" "),jt.split(qt[0]).length===5?qt[0]:jt;qt=(Ft+"").split(" "),jt={},gt.forEach(function(sn,Gt){return jt[sn]=qt[Gt]=qt[Gt]||qt[(Gt-1)/2|0]}),xt.init(It,jt,Xt)}});var CSSPlugin={name:"css",register:_initCore$1,targetTest:function $(b){return b.style&&b.nodeType},init:function $(b,g,tt,ot,ut){var gt=this._props,xt=b.style,It=tt.vars.startAt,kt,Ft,Xt,qt,jt,sn,Gt,vn,nn,Wt,on,gn,ln,_n,Ut,Qt;_pluginInitted||_initCore$1(),this.styles=this.styles||_getStyleSaver(b),Qt=this.styles.props,this.tween=tt;for(Gt in g)if(Gt!=="autoRound"&&(Ft=g[Gt],!(_plugins[Gt]&&_checkPlugin(Gt,g,tt,ot,b,ut)))){if(jt=typeof Ft,sn=_specialProps[Gt],jt==="function"&&(Ft=Ft.call(tt,ot,b,ut),jt=typeof Ft),jt==="string"&&~Ft.indexOf("random(")&&(Ft=_replaceRandom(Ft)),sn)sn(this,b,Gt,Ft,tt)&&(Ut=1);else if(Gt.substr(0,2)==="--")kt=(getComputedStyle(b).getPropertyValue(Gt)+"").trim(),Ft+="",_colorExp.lastIndex=0,_colorExp.test(kt)||(vn=getUnit(kt),nn=getUnit(Ft)),nn?vn!==nn&&(kt=_convertToUnit(b,Gt,kt,nn)+nn):vn&&(Ft+=vn),this.add(xt,"setProperty",kt,Ft,ot,ut,0,0,Gt),gt.push(Gt),Qt.push(Gt,0,xt[Gt]);else if(jt!=="undefined"){if(It&&Gt in It?(kt=typeof It[Gt]=="function"?It[Gt].call(tt,ot,b,ut):It[Gt],_isString$1(kt)&&~kt.indexOf("random(")&&(kt=_replaceRandom(kt)),getUnit(kt+"")||kt==="auto"||(kt+=_config.units[Gt]||getUnit(_get(b,Gt))||""),(kt+"").charAt(1)==="="&&(kt=_get(b,Gt))):kt=_get(b,Gt),qt=parseFloat(kt),Wt=jt==="string"&&Ft.charAt(1)==="="&&Ft.substr(0,2),Wt&&(Ft=Ft.substr(2)),Xt=parseFloat(Ft),Gt in _propertyAliases&&(Gt==="autoAlpha"&&(qt===1&&_get(b,"visibility")==="hidden"&&Xt&&(qt=0),Qt.push("visibility",0,xt.visibility),_addNonTweeningPT(this,xt,"visibility",qt?"inherit":"hidden",Xt?"inherit":"hidden",!Xt)),Gt!=="scale"&&Gt!=="transform"&&(Gt=_propertyAliases[Gt],~Gt.indexOf(",")&&(Gt=Gt.split(",")[0]))),on=Gt in _transformProps,on){if(this.styles.save(Gt),gn||(ln=b._gsap,ln.renderTransform&&!g.parseTransform||_parseTransform(b,g.parseTransform),_n=g.smoothOrigin!==!1&&ln.smooth,gn=this._pt=new PropTween(this._pt,xt,_transformProp$1,0,1,ln.renderTransform,ln,0,-1),gn.dep=1),Gt==="scale")this._pt=new PropTween(this._pt,ln,"scaleY",ln.scaleY,(Wt?_parseRelative(ln.scaleY,Wt+Xt):Xt)-ln.scaleY||0,_renderCSSProp),this._pt.u=0,gt.push("scaleY",Gt),Gt+="X";else if(Gt==="transformOrigin"){Qt.push(_transformOriginProp,0,xt[_transformOriginProp]),Ft=_convertKeywordsToPercentages(Ft),ln.svg?_applySVGOrigin(b,Ft,0,_n,0,this):(nn=parseFloat(Ft.split(" ")[2])||0,nn!==ln.zOrigin&&_addNonTweeningPT(this,ln,"zOrigin",ln.zOrigin,nn),_addNonTweeningPT(this,xt,Gt,_firstTwoOnly(kt),_firstTwoOnly(Ft)));continue}else if(Gt==="svgOrigin"){_applySVGOrigin(b,Ft,1,_n,0,this);continue}else if(Gt in _rotationalProperties){_addRotationalPropTween(this,ln,Gt,qt,Wt?_parseRelative(qt,Wt+Ft):Ft);continue}else if(Gt==="smoothOrigin"){_addNonTweeningPT(this,ln,"smooth",ln.smooth,Ft);continue}else if(Gt==="force3D"){ln[Gt]=Ft;continue}else if(Gt==="transform"){_addRawTransformPTs(this,Ft,b);continue}}else Gt in xt||(Gt=_checkPropPrefix(Gt)||Gt);if(on||(Xt||Xt===0)&&(qt||qt===0)&&!_complexExp.test(Ft)&&Gt in xt)vn=(kt+"").substr((qt+"").length),Xt||(Xt=0),nn=getUnit(Ft)||(Gt in _config.units?_config.units[Gt]:vn),vn!==nn&&(qt=_convertToUnit(b,Gt,kt,nn)),this._pt=new PropTween(this._pt,on?ln:xt,Gt,qt,(Wt?_parseRelative(qt,Wt+Xt):Xt)-qt,!on&&(nn==="px"||Gt==="zIndex")&&g.autoRound!==!1?_renderRoundedCSSProp:_renderCSSProp),this._pt.u=nn||0,vn!==nn&&nn!=="%"&&(this._pt.b=kt,this._pt.r=_renderCSSPropWithBeginning);else if(Gt in xt)_tweenComplexCSSString.call(this,b,Gt,kt,Wt?Wt+Ft:Ft);else if(Gt in b)this.add(b,Gt,kt||b[Gt],Wt?Wt+Ft:Ft,ot,ut);else if(Gt!=="parseTransform"){_missingPlugin(Gt,Ft);continue}on||(Gt in xt?Qt.push(Gt,0,xt[Gt]):Qt.push(Gt,1,kt||b[Gt])),gt.push(Gt)}}Ut&&_sortPropTweensByPriority(this)},render:function $(b,g){if(g.tween._time||!_reverting())for(var tt=g._pt;tt;)tt.r(b,tt.d),tt=tt._next;else g.styles.revert()},get:_get,aliases:_propertyAliases,getSetter:function $(b,g,tt){var ot=_propertyAliases[g];return ot&&ot.indexOf(",")<0&&(g=ot),g in _transformProps&&g!==_transformOriginProp&&(b._gsap.x||_get(b,"x"))?tt&&_recentSetterPlugin===tt?g==="scale"?_setterScale:_setterTransform:(_recentSetterPlugin=tt||{})&&(g==="scale"?_setterScaleWithRender:_setterTransformWithRender):b.style&&!_isUndefined(b.style[g])?_setterCSSStyle:~g.indexOf("-")?_setterCSSProp:_getSetter(b,g)},core:{_removeProperty,_getMatrix}};gsap$2.utils.checkPrefix=_checkPropPrefix;gsap$2.core.getStyleSaver=_getStyleSaver;(function($,b,g,tt){var ot=_forEachName($+","+b+","+g,function(ut){_transformProps[ut]=1});_forEachName(b,function(ut){_config.units[ut]="deg",_rotationalProperties[ut]=1}),_propertyAliases[ot[13]]=$+","+b,_forEachName(tt,function(ut){var gt=ut.split(":");_propertyAliases[gt[1]]=ot[gt[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");_forEachName("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function($){_config.units[$]="px"});gsap$2.registerPlugin(CSSPlugin);var gsapWithCSS=gsap$2.registerPlugin(CSSPlugin)||gsap$2;gsapWithCSS.core.Tween;function _defineProperties($,b){for(var g=0;g<b.length;g++){var tt=b[g];tt.enumerable=tt.enumerable||!1,tt.configurable=!0,"value"in tt&&(tt.writable=!0),Object.defineProperty($,tt.key,tt)}}function _createClass($,b,g){return b&&_defineProperties($.prototype,b),g&&_defineProperties($,g),$}/*!
 * Observer 3.12.4
 * https://gsap.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var gsap$1,_coreInitted$1,_win$1,_doc$1,_docEl$1,_body$1,_isTouch,_pointerType,ScrollTrigger$1,_root$1,_normalizer$1,_eventTypes,_context$1,_getGSAP$1=function $(){return gsap$1||typeof window<"u"&&(gsap$1=window.gsap)&&gsap$1.registerPlugin&&gsap$1},_startup$1=1,_observers=[],_scrollers=[],_proxies=[],_getTime$1=Date.now,_bridge=function $(b,g){return g},_integrate=function $(){var b=ScrollTrigger$1.core,g=b.bridge||{},tt=b._scrollers,ot=b._proxies;tt.push.apply(tt,_scrollers),ot.push.apply(ot,_proxies),_scrollers=tt,_proxies=ot,_bridge=function(gt,xt){return g[gt](xt)}},_getProxyProp=function $(b,g){return~_proxies.indexOf(b)&&_proxies[_proxies.indexOf(b)+1][g]},_isViewport$1=function $(b){return!!~_root$1.indexOf(b)},_addListener$1=function $(b,g,tt,ot,ut){return b.addEventListener(g,tt,{passive:!ot,capture:!!ut})},_removeListener$1=function $(b,g,tt,ot){return b.removeEventListener(g,tt,!!ot)},_scrollLeft="scrollLeft",_scrollTop="scrollTop",_onScroll$1=function $(){return _normalizer$1&&_normalizer$1.isPressed||_scrollers.cache++},_scrollCacheFunc=function $(b,g){var tt=function ot(ut){if(ut||ut===0){_startup$1&&(_win$1.history.scrollRestoration="manual");var gt=_normalizer$1&&_normalizer$1.isPressed;ut=ot.v=Math.round(ut)||(_normalizer$1&&_normalizer$1.iOS?1:0),b(ut),ot.cacheID=_scrollers.cache,gt&&_bridge("ss",ut)}else(g||_scrollers.cache!==ot.cacheID||_bridge("ref"))&&(ot.cacheID=_scrollers.cache,ot.v=b());return ot.v+ot.offset};return tt.offset=0,b&&tt},_horizontal={s:_scrollLeft,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:_scrollCacheFunc(function($){return arguments.length?_win$1.scrollTo($,_vertical.sc()):_win$1.pageXOffset||_doc$1[_scrollLeft]||_docEl$1[_scrollLeft]||_body$1[_scrollLeft]||0})},_vertical={s:_scrollTop,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:_horizontal,sc:_scrollCacheFunc(function($){return arguments.length?_win$1.scrollTo(_horizontal.sc(),$):_win$1.pageYOffset||_doc$1[_scrollTop]||_docEl$1[_scrollTop]||_body$1[_scrollTop]||0})},_getTarget=function $(b,g){return(g&&g._ctx&&g._ctx.selector||gsap$1.utils.toArray)(b)[0]||(typeof b=="string"&&gsap$1.config().nullTargetWarn!==!1?console.warn("Element not found:",b):null)},_getScrollFunc=function $(b,g){var tt=g.s,ot=g.sc;_isViewport$1(b)&&(b=_doc$1.scrollingElement||_docEl$1);var ut=_scrollers.indexOf(b),gt=ot===_vertical.sc?1:2;!~ut&&(ut=_scrollers.push(b)-1),_scrollers[ut+gt]||_addListener$1(b,"scroll",_onScroll$1);var xt=_scrollers[ut+gt],It=xt||(_scrollers[ut+gt]=_scrollCacheFunc(_getProxyProp(b,tt),!0)||(_isViewport$1(b)?ot:_scrollCacheFunc(function(kt){return arguments.length?b[tt]=kt:b[tt]})));return It.target=b,xt||(It.smooth=gsap$1.getProperty(b,"scrollBehavior")==="smooth"),It},_getVelocityProp=function $(b,g,tt){var ot=b,ut=b,gt=_getTime$1(),xt=gt,It=g||50,kt=Math.max(500,It*3),Ft=function(sn,Gt){var vn=_getTime$1();Gt||vn-gt>It?(ut=ot,ot=sn,xt=gt,gt=vn):tt?ot+=sn:ot=ut+(sn-ut)/(vn-xt)*(gt-xt)},Xt=function(){ut=ot=tt?0:ot,xt=gt=0},qt=function(sn){var Gt=xt,vn=ut,nn=_getTime$1();return(sn||sn===0)&&sn!==ot&&Ft(sn),gt===xt||nn-xt>kt?0:(ot+(tt?vn:-vn))/((tt?nn:gt)-Gt)*1e3};return{update:Ft,reset:Xt,getVelocity:qt}},_getEvent=function $(b,g){return g&&!b._gsapAllow&&b.preventDefault(),b.changedTouches?b.changedTouches[0]:b},_getAbsoluteMax=function $(b){var g=Math.max.apply(Math,b),tt=Math.min.apply(Math,b);return Math.abs(g)>=Math.abs(tt)?g:tt},_setScrollTrigger=function $(){ScrollTrigger$1=gsap$1.core.globals().ScrollTrigger,ScrollTrigger$1&&ScrollTrigger$1.core&&_integrate()},_initCore=function $(b){return gsap$1=b||_getGSAP$1(),!_coreInitted$1&&gsap$1&&typeof document<"u"&&document.body&&(_win$1=window,_doc$1=document,_docEl$1=_doc$1.documentElement,_body$1=_doc$1.body,_root$1=[_win$1,_doc$1,_docEl$1,_body$1],gsap$1.utils.clamp,_context$1=gsap$1.core.context||function(){},_pointerType="onpointerenter"in _body$1?"pointer":"mouse",_isTouch=Observer.isTouch=_win$1.matchMedia&&_win$1.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in _win$1||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,_eventTypes=Observer.eventTypes=("ontouchstart"in _docEl$1?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in _docEl$1?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return _startup$1=0},500),_setScrollTrigger(),_coreInitted$1=1),_coreInitted$1};_horizontal.op=_vertical;_scrollers.cache=0;var Observer=function(){function $(g){this.init(g)}var b=$.prototype;return b.init=function(tt){_coreInitted$1||_initCore(gsap$1)||console.warn("Please gsap.registerPlugin(Observer)"),ScrollTrigger$1||_setScrollTrigger();var ot=tt.tolerance,ut=tt.dragMinimum,gt=tt.type,xt=tt.target,It=tt.lineHeight,kt=tt.debounce,Ft=tt.preventDefault,Xt=tt.onStop,qt=tt.onStopDelay,jt=tt.ignore,sn=tt.wheelSpeed,Gt=tt.event,vn=tt.onDragStart,nn=tt.onDragEnd,Wt=tt.onDrag,on=tt.onPress,gn=tt.onRelease,ln=tt.onRight,_n=tt.onLeft,Ut=tt.onUp,Qt=tt.onDown,tn=tt.onChangeX,bn=tt.onChangeY,Yt=tt.onChange,en=tt.onToggleX,un=tt.onToggleY,yn=tt.onHover,zn=tt.onHoverEnd,Yn=tt.onMove,tr=tt.ignoreCheck,Un=tt.isNormalizer,Jn=tt.onGestureStart,hn=tt.onGestureEnd,rr=tt.onWheel,sr=tt.onEnable,br=tt.onDisable,Kn=tt.onClick,dn=tt.scrollSpeed,kn=tt.capture,Vn=tt.allowClicks,Rr=tt.lockAxis,cr=tt.onLockAxis;this.target=xt=_getTarget(xt)||_docEl$1,this.vars=tt,jt&&(jt=gsap$1.utils.toArray(jt)),ot=ot||1e-9,ut=ut||0,sn=sn||1,dn=dn||1,gt=gt||"wheel,touch,pointer",kt=kt!==!1,It||(It=parseFloat(_win$1.getComputedStyle(_body$1).lineHeight)||22);var Hr,xs,Ys,ls,oo,Ks,Xo,fr=this,ko=0,pu=0,Fu=_getScrollFunc(xt,_horizontal),wo=_getScrollFunc(xt,_vertical),Pl=Fu(),xa=wo(),Bl=~gt.indexOf("touch")&&!~gt.indexOf("pointer")&&_eventTypes[0]==="pointerdown",po=_isViewport$1(xt),Go=xt.ownerDocument||_doc$1,su=[0,0,0],Ho=[0,0,0],ou=0,Uo=function(){return ou=_getTime$1()},au=function(Ds,Fo){return(fr.event=Ds)&&jt&&~jt.indexOf(Ds.target)||Fo&&Bl&&Ds.pointerType!=="touch"||tr&&tr(Ds,Fo)},kp=function(){fr._vx.reset(),fr._vy.reset(),xs.pause(),Xt&&Xt(fr)},Ap=function(){var Ds=fr.deltaX=_getAbsoluteMax(su),Fo=fr.deltaY=_getAbsoluteMax(Ho),Ll=Math.abs(Ds)>=ot,fs=Math.abs(Fo)>=ot;Yt&&(Ll||fs)&&Yt(fr,Ds,Fo,su,Ho),Ll&&(ln&&fr.deltaX>0&&ln(fr),_n&&fr.deltaX<0&&_n(fr),tn&&tn(fr),en&&fr.deltaX<0!=ko<0&&en(fr),ko=fr.deltaX,su[0]=su[1]=su[2]=0),fs&&(Qt&&fr.deltaY>0&&Qt(fr),Ut&&fr.deltaY<0&&Ut(fr),bn&&bn(fr),un&&fr.deltaY<0!=pu<0&&un(fr),pu=fr.deltaY,Ho[0]=Ho[1]=Ho[2]=0),(ls||Ys)&&(Yn&&Yn(fr),Ys&&(Wt(fr),Ys=!1),ls=!1),Ks&&!(Ks=!1)&&cr&&cr(fr),oo&&(rr(fr),oo=!1),Hr=0},Cv=function(Ds,Fo,Ll){su[Ll]+=Ds,Ho[Ll]+=Fo,fr._vx.update(Ds),fr._vy.update(Fo),kt?Hr||(Hr=requestAnimationFrame(Ap)):Ap()},xl=function(Ds,Fo){Rr&&!Xo&&(fr.axis=Xo=Math.abs(Ds)>Math.abs(Fo)?"x":"y",Ks=!0),Xo!=="y"&&(su[2]+=Ds,fr._vx.update(Ds,!0)),Xo!=="x"&&(Ho[2]+=Fo,fr._vy.update(Fo,!0)),kt?Hr||(Hr=requestAnimationFrame(Ap)):Ap()},fu=function(Ds){if(!au(Ds,1)){Ds=_getEvent(Ds,Ft);var Fo=Ds.clientX,Ll=Ds.clientY,fs=Fo-fr.x,Ns=Ll-fr.y,En=fr.isDragging;fr.x=Fo,fr.y=Ll,(En||Math.abs(fr.startX-Fo)>=ut||Math.abs(fr.startY-Ll)>=ut)&&(Wt&&(Ys=!0),En||(fr.isDragging=!0),xl(fs,Ns),En||vn&&vn(fr))}},Tm=fr.onPress=function(Bs){au(Bs,1)||Bs&&Bs.button||(fr.axis=Xo=null,xs.pause(),fr.isPressed=!0,Bs=_getEvent(Bs),ko=pu=0,fr.startX=fr.x=Bs.clientX,fr.startY=fr.y=Bs.clientY,fr._vx.reset(),fr._vy.reset(),_addListener$1(Un?xt:Go,_eventTypes[1],fu,Ft,!0),fr.deltaX=fr.deltaY=0,on&&on(fr))},Gl=fr.onRelease=function(Bs){if(!au(Bs,1)){_removeListener$1(Un?xt:Go,_eventTypes[1],fu,!0);var Ds=!isNaN(fr.y-fr.startY),Fo=fr.isDragging,Ll=Fo&&(Math.abs(fr.x-fr.startX)>3||Math.abs(fr.y-fr.startY)>3),fs=_getEvent(Bs);!Ll&&Ds&&(fr._vx.reset(),fr._vy.reset(),Ft&&Vn&&gsap$1.delayedCall(.08,function(){if(_getTime$1()-ou>300&&!Bs.defaultPrevented){if(Bs.target.click)Bs.target.click();else if(Go.createEvent){var Ns=Go.createEvent("MouseEvents");Ns.initMouseEvent("click",!0,!0,_win$1,1,fs.screenX,fs.screenY,fs.clientX,fs.clientY,!1,!1,!1,!1,0,null),Bs.target.dispatchEvent(Ns)}}})),fr.isDragging=fr.isGesturing=fr.isPressed=!1,Xt&&Fo&&!Un&&xs.restart(!0),nn&&Fo&&nn(fr),gn&&gn(fr,Ll)}},Io=function(Ds){return Ds.touches&&Ds.touches.length>1&&(fr.isGesturing=!0)&&Jn(Ds,fr.isDragging)},sp=function(){return(fr.isGesturing=!1)||hn(fr)},To=function(Ds){if(!au(Ds)){var Fo=Fu(),Ll=wo();Cv((Fo-Pl)*dn,(Ll-xa)*dn,1),Pl=Fo,xa=Ll,Xt&&xs.restart(!0)}},Zo=function(Ds){if(!au(Ds)){Ds=_getEvent(Ds,Ft),rr&&(oo=!0);var Fo=(Ds.deltaMode===1?It:Ds.deltaMode===2?_win$1.innerHeight:1)*sn;Cv(Ds.deltaX*Fo,Ds.deltaY*Fo,0),Xt&&!Un&&xs.restart(!0)}},Po=function(Ds){if(!au(Ds)){var Fo=Ds.clientX,Ll=Ds.clientY,fs=Fo-fr.x,Ns=Ll-fr.y;fr.x=Fo,fr.y=Ll,ls=!0,Xt&&xs.restart(!0),(fs||Ns)&&xl(fs,Ns)}},Mm=function(Ds){fr.event=Ds,yn(fr)},Jl=function(Ds){fr.event=Ds,zn(fr)},ju=function(Ds){return au(Ds)||_getEvent(Ds,Ft)&&Kn(fr)};xs=fr._dc=gsap$1.delayedCall(qt||.25,kp).pause(),fr.deltaX=fr.deltaY=0,fr._vx=_getVelocityProp(0,50,!0),fr._vy=_getVelocityProp(0,50,!0),fr.scrollX=Fu,fr.scrollY=wo,fr.isDragging=fr.isGesturing=fr.isPressed=!1,_context$1(this),fr.enable=function(Bs){return fr.isEnabled||(_addListener$1(po?Go:xt,"scroll",_onScroll$1),gt.indexOf("scroll")>=0&&_addListener$1(po?Go:xt,"scroll",To,Ft,kn),gt.indexOf("wheel")>=0&&_addListener$1(xt,"wheel",Zo,Ft,kn),(gt.indexOf("touch")>=0&&_isTouch||gt.indexOf("pointer")>=0)&&(_addListener$1(xt,_eventTypes[0],Tm,Ft,kn),_addListener$1(Go,_eventTypes[2],Gl),_addListener$1(Go,_eventTypes[3],Gl),Vn&&_addListener$1(xt,"click",Uo,!1,!0),Kn&&_addListener$1(xt,"click",ju),Jn&&_addListener$1(Go,"gesturestart",Io),hn&&_addListener$1(Go,"gestureend",sp),yn&&_addListener$1(xt,_pointerType+"enter",Mm),zn&&_addListener$1(xt,_pointerType+"leave",Jl),Yn&&_addListener$1(xt,_pointerType+"move",Po)),fr.isEnabled=!0,Bs&&Bs.type&&Tm(Bs),sr&&sr(fr)),fr},fr.disable=function(){fr.isEnabled&&(_observers.filter(function(Bs){return Bs!==fr&&_isViewport$1(Bs.target)}).length||_removeListener$1(po?Go:xt,"scroll",_onScroll$1),fr.isPressed&&(fr._vx.reset(),fr._vy.reset(),_removeListener$1(Un?xt:Go,_eventTypes[1],fu,!0)),_removeListener$1(po?Go:xt,"scroll",To,kn),_removeListener$1(xt,"wheel",Zo,kn),_removeListener$1(xt,_eventTypes[0],Tm,kn),_removeListener$1(Go,_eventTypes[2],Gl),_removeListener$1(Go,_eventTypes[3],Gl),_removeListener$1(xt,"click",Uo,!0),_removeListener$1(xt,"click",ju),_removeListener$1(Go,"gesturestart",Io),_removeListener$1(Go,"gestureend",sp),_removeListener$1(xt,_pointerType+"enter",Mm),_removeListener$1(xt,_pointerType+"leave",Jl),_removeListener$1(xt,_pointerType+"move",Po),fr.isEnabled=fr.isPressed=fr.isDragging=!1,br&&br(fr))},fr.kill=fr.revert=function(){fr.disable();var Bs=_observers.indexOf(fr);Bs>=0&&_observers.splice(Bs,1),_normalizer$1===fr&&(_normalizer$1=0)},_observers.push(fr),Un&&_isViewport$1(xt)&&(_normalizer$1=fr),fr.enable(Gt)},_createClass($,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),$}();Observer.version="3.12.4";Observer.create=function($){return new Observer($)};Observer.register=_initCore;Observer.getAll=function(){return _observers.slice()};Observer.getById=function($){return _observers.filter(function(b){return b.vars.id===$})[0]};_getGSAP$1()&&gsap$1.registerPlugin(Observer);/*!
 * ScrollTrigger 3.12.4
 * https://gsap.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var gsap,_coreInitted,_win,_doc,_docEl,_body,_root,_resizeDelay,_toArray,_clamp,_time2,_syncInterval,_refreshing,_pointerIsDown,_transformProp,_i,_prevWidth,_prevHeight,_autoRefresh,_sort,_suppressOverwrites,_ignoreResize,_normalizer,_ignoreMobileResize,_baseScreenHeight,_baseScreenWidth,_fixIOSBug,_context,_scrollRestoration,_div100vh,_100vh,_isReverted,_clampingMax,_limitCallbacks,_startup=1,_getTime=Date.now,_time1=_getTime(),_lastScrollTime=0,_enabled=0,_parseClamp=function $(b,g,tt){var ot=_isString(b)&&(b.substr(0,6)==="clamp("||b.indexOf("max")>-1);return tt["_"+g+"Clamp"]=ot,ot?b.substr(6,b.length-7):b},_keepClamp=function $(b,g){return g&&(!_isString(b)||b.substr(0,6)!=="clamp(")?"clamp("+b+")":b},_rafBugFix=function $(){return _enabled&&requestAnimationFrame($)},_pointerDownHandler=function $(){return _pointerIsDown=1},_pointerUpHandler=function $(){return _pointerIsDown=0},_passThrough=function $(b){return b},_round=function $(b){return Math.round(b*1e5)/1e5||0},_windowExists=function $(){return typeof window<"u"},_getGSAP=function $(){return gsap||_windowExists()&&(gsap=window.gsap)&&gsap.registerPlugin&&gsap},_isViewport=function $(b){return!!~_root.indexOf(b)},_getViewportDimension=function $(b){return(b==="Height"?_100vh:_win["inner"+b])||_docEl["client"+b]||_body["client"+b]},_getBoundsFunc=function $(b){return _getProxyProp(b,"getBoundingClientRect")||(_isViewport(b)?function(){return _winOffsets.width=_win.innerWidth,_winOffsets.height=_100vh,_winOffsets}:function(){return _getBounds(b)})},_getSizeFunc=function $(b,g,tt){var ot=tt.d,ut=tt.d2,gt=tt.a;return(gt=_getProxyProp(b,"getBoundingClientRect"))?function(){return gt()[ot]}:function(){return(g?_getViewportDimension(ut):b["client"+ut])||0}},_getOffsetsFunc=function $(b,g){return!g||~_proxies.indexOf(b)?_getBoundsFunc(b):function(){return _winOffsets}},_maxScroll=function $(b,g){var tt=g.s,ot=g.d2,ut=g.d,gt=g.a;return Math.max(0,(tt="scroll"+ot)&&(gt=_getProxyProp(b,tt))?gt()-_getBoundsFunc(b)()[ut]:_isViewport(b)?(_docEl[tt]||_body[tt])-_getViewportDimension(ot):b[tt]-b["offset"+ot])},_iterateAutoRefresh=function $(b,g){for(var tt=0;tt<_autoRefresh.length;tt+=3)(!g||~g.indexOf(_autoRefresh[tt+1]))&&b(_autoRefresh[tt],_autoRefresh[tt+1],_autoRefresh[tt+2])},_isString=function $(b){return typeof b=="string"},_isFunction=function $(b){return typeof b=="function"},_isNumber=function $(b){return typeof b=="number"},_isObject=function $(b){return typeof b=="object"},_endAnimation=function $(b,g,tt){return b&&b.progress(g?0:1)&&tt&&b.pause()},_callback=function $(b,g){if(b.enabled){var tt=b._ctx?b._ctx.add(function(){return g(b)}):g(b);tt&&tt.totalTime&&(b.callbackAnimation=tt)}},_abs=Math.abs,_left="left",_top="top",_right="right",_bottom="bottom",_width="width",_height="height",_Right="Right",_Left="Left",_Top="Top",_Bottom="Bottom",_padding="padding",_margin="margin",_Width="Width",_Height="Height",_px="px",_getComputedStyle=function $(b){return _win.getComputedStyle(b)},_makePositionable=function $(b){var g=_getComputedStyle(b).position;b.style.position=g==="absolute"||g==="fixed"?g:"relative"},_setDefaults=function $(b,g){for(var tt in g)tt in b||(b[tt]=g[tt]);return b},_getBounds=function $(b,g){var tt=g&&_getComputedStyle(b)[_transformProp]!=="matrix(1, 0, 0, 1, 0, 0)"&&gsap.to(b,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),ot=b.getBoundingClientRect();return tt&&tt.progress(0).kill(),ot},_getSize=function $(b,g){var tt=g.d2;return b["offset"+tt]||b["client"+tt]||0},_getLabelRatioArray=function $(b){var g=[],tt=b.labels,ot=b.duration(),ut;for(ut in tt)g.push(tt[ut]/ot);return g},_getClosestLabel=function $(b){return function(g){return gsap.utils.snap(_getLabelRatioArray(b),g)}},_snapDirectional=function $(b){var g=gsap.utils.snap(b),tt=Array.isArray(b)&&b.slice(0).sort(function(ot,ut){return ot-ut});return tt?function(ot,ut,gt){gt===void 0&&(gt=.001);var xt;if(!ut)return g(ot);if(ut>0){for(ot-=gt,xt=0;xt<tt.length;xt++)if(tt[xt]>=ot)return tt[xt];return tt[xt-1]}else for(xt=tt.length,ot+=gt;xt--;)if(tt[xt]<=ot)return tt[xt];return tt[0]}:function(ot,ut,gt){gt===void 0&&(gt=.001);var xt=g(ot);return!ut||Math.abs(xt-ot)<gt||xt-ot<0==ut<0?xt:g(ut<0?ot-b:ot+b)}},_getLabelAtDirection=function $(b){return function(g,tt){return _snapDirectional(_getLabelRatioArray(b))(g,tt.direction)}},_multiListener=function $(b,g,tt,ot){return tt.split(",").forEach(function(ut){return b(g,ut,ot)})},_addListener=function $(b,g,tt,ot,ut){return b.addEventListener(g,tt,{passive:!ot,capture:!!ut})},_removeListener=function $(b,g,tt,ot){return b.removeEventListener(g,tt,!!ot)},_wheelListener=function $(b,g,tt){tt=tt&&tt.wheelHandler,tt&&(b(g,"wheel",tt),b(g,"touchmove",tt))},_markerDefaults={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},_defaults={toggleActions:"play",anticipatePin:0},_keywords={top:0,left:0,center:.5,bottom:1,right:1},_offsetToPx=function $(b,g){if(_isString(b)){var tt=b.indexOf("="),ot=~tt?+(b.charAt(tt-1)+1)*parseFloat(b.substr(tt+1)):0;~tt&&(b.indexOf("%")>tt&&(ot*=g/100),b=b.substr(0,tt-1)),b=ot+(b in _keywords?_keywords[b]*g:~b.indexOf("%")?parseFloat(b)*g/100:parseFloat(b)||0)}return b},_createMarker=function $(b,g,tt,ot,ut,gt,xt,It){var kt=ut.startColor,Ft=ut.endColor,Xt=ut.fontSize,qt=ut.indent,jt=ut.fontWeight,sn=_doc.createElement("div"),Gt=_isViewport(tt)||_getProxyProp(tt,"pinType")==="fixed",vn=b.indexOf("scroller")!==-1,nn=Gt?_body:tt,Wt=b.indexOf("start")!==-1,on=Wt?kt:Ft,gn="border-color:"+on+";font-size:"+Xt+";color:"+on+";font-weight:"+jt+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return gn+="position:"+((vn||It)&&Gt?"fixed;":"absolute;"),(vn||It||!Gt)&&(gn+=(ot===_vertical?_right:_bottom)+":"+(gt+parseFloat(qt))+"px;"),xt&&(gn+="box-sizing:border-box;text-align:left;width:"+xt.offsetWidth+"px;"),sn._isStart=Wt,sn.setAttribute("class","gsap-marker-"+b+(g?" marker-"+g:"")),sn.style.cssText=gn,sn.innerText=g||g===0?b+"-"+g:b,nn.children[0]?nn.insertBefore(sn,nn.children[0]):nn.appendChild(sn),sn._offset=sn["offset"+ot.op.d2],_positionMarker(sn,0,ot,Wt),sn},_positionMarker=function $(b,g,tt,ot){var ut={display:"block"},gt=tt[ot?"os2":"p2"],xt=tt[ot?"p2":"os2"];b._isFlipped=ot,ut[tt.a+"Percent"]=ot?-100:0,ut[tt.a]=ot?"1px":0,ut["border"+gt+_Width]=1,ut["border"+xt+_Width]=0,ut[tt.p]=g+"px",gsap.set(b,ut)},_triggers=[],_ids={},_rafID,_sync=function $(){return _getTime()-_lastScrollTime>34&&(_rafID||(_rafID=requestAnimationFrame(_updateAll)))},_onScroll=function $(){(!_normalizer||!_normalizer.isPressed||_normalizer.startX>_body.clientWidth)&&(_scrollers.cache++,_normalizer?_rafID||(_rafID=requestAnimationFrame(_updateAll)):_updateAll(),_lastScrollTime||_dispatch("scrollStart"),_lastScrollTime=_getTime())},_setBaseDimensions=function $(){_baseScreenWidth=_win.innerWidth,_baseScreenHeight=_win.innerHeight},_onResize=function $(){_scrollers.cache++,!_refreshing&&!_ignoreResize&&!_doc.fullscreenElement&&!_doc.webkitFullscreenElement&&(!_ignoreMobileResize||_baseScreenWidth!==_win.innerWidth||Math.abs(_win.innerHeight-_baseScreenHeight)>_win.innerHeight*.25)&&_resizeDelay.restart(!0)},_listeners={},_emptyArray=[],_softRefresh=function $(){return _removeListener(ScrollTrigger,"scrollEnd",$)||_refreshAll(!0)},_dispatch=function $(b){return _listeners[b]&&_listeners[b].map(function(g){return g()})||_emptyArray},_savedStyles=[],_revertRecorded=function $(b){for(var g=0;g<_savedStyles.length;g+=5)(!b||_savedStyles[g+4]&&_savedStyles[g+4].query===b)&&(_savedStyles[g].style.cssText=_savedStyles[g+1],_savedStyles[g].getBBox&&_savedStyles[g].setAttribute("transform",_savedStyles[g+2]||""),_savedStyles[g+3].uncache=1)},_revertAll=function $(b,g){var tt;for(_i=0;_i<_triggers.length;_i++)tt=_triggers[_i],tt&&(!g||tt._ctx===g)&&(b?tt.kill(1):tt.revert(!0,!0));_isReverted=!0,g&&_revertRecorded(g),g||_dispatch("revert")},_clearScrollMemory=function $(b,g){_scrollers.cache++,(g||!_refreshingAll)&&_scrollers.forEach(function(tt){return _isFunction(tt)&&tt.cacheID++&&(tt.rec=0)}),_isString(b)&&(_win.history.scrollRestoration=_scrollRestoration=b)},_refreshingAll,_refreshID=0,_queueRefreshID,_queueRefreshAll=function $(){if(_queueRefreshID!==_refreshID){var b=_queueRefreshID=_refreshID;requestAnimationFrame(function(){return b===_refreshID&&_refreshAll(!0)})}},_refresh100vh=function $(){_body.appendChild(_div100vh),_100vh=!_normalizer&&_div100vh.offsetHeight||_win.innerHeight,_body.removeChild(_div100vh)},_hideAllMarkers=function $(b){return _toArray(".gsap-marker-start, .gsap-marker-end, .gsap-marker-scroller-start, .gsap-marker-scroller-end").forEach(function(g){return g.style.display=b?"none":"block"})},_refreshAll=function $(b,g){if(_lastScrollTime&&!b&&!_isReverted){_addListener(ScrollTrigger,"scrollEnd",_softRefresh);return}_refresh100vh(),_refreshingAll=ScrollTrigger.isRefreshing=!0,_scrollers.forEach(function(ot){return _isFunction(ot)&&++ot.cacheID&&(ot.rec=ot())});var tt=_dispatch("refreshInit");_sort&&ScrollTrigger.sort(),g||_revertAll(),_scrollers.forEach(function(ot){_isFunction(ot)&&(ot.smooth&&(ot.target.style.scrollBehavior="auto"),ot(0))}),_triggers.slice(0).forEach(function(ot){return ot.refresh()}),_isReverted=!1,_triggers.forEach(function(ot){if(ot._subPinOffset&&ot.pin){var ut=ot.vars.horizontal?"offsetWidth":"offsetHeight",gt=ot.pin[ut];ot.revert(!0,1),ot.adjustPinSpacing(ot.pin[ut]-gt),ot.refresh()}}),_clampingMax=1,_hideAllMarkers(!0),_triggers.forEach(function(ot){var ut=_maxScroll(ot.scroller,ot._dir),gt=ot.vars.end==="max"||ot._endClamp&&ot.end>ut,xt=ot._startClamp&&ot.start>=ut;(gt||xt)&&ot.setPositions(xt?ut-1:ot.start,gt?Math.max(xt?ut:ot.start+1,ut):ot.end,!0)}),_hideAllMarkers(!1),_clampingMax=0,tt.forEach(function(ot){return ot&&ot.render&&ot.render(-1)}),_scrollers.forEach(function(ot){_isFunction(ot)&&(ot.smooth&&requestAnimationFrame(function(){return ot.target.style.scrollBehavior="smooth"}),ot.rec&&ot(ot.rec))}),_clearScrollMemory(_scrollRestoration,1),_resizeDelay.pause(),_refreshID++,_refreshingAll=2,_updateAll(2),_triggers.forEach(function(ot){return _isFunction(ot.vars.onRefresh)&&ot.vars.onRefresh(ot)}),_refreshingAll=ScrollTrigger.isRefreshing=!1,_dispatch("refresh")},_lastScroll=0,_direction=1,_primary,_updateAll=function $(b){if(b===2||!_refreshingAll&&!_isReverted){ScrollTrigger.isUpdating=!0,_primary&&_primary.update(0);var g=_triggers.length,tt=_getTime(),ot=tt-_time1>=50,ut=g&&_triggers[0].scroll();if(_direction=_lastScroll>ut?-1:1,_refreshingAll||(_lastScroll=ut),ot&&(_lastScrollTime&&!_pointerIsDown&&tt-_lastScrollTime>200&&(_lastScrollTime=0,_dispatch("scrollEnd")),_time2=_time1,_time1=tt),_direction<0){for(_i=g;_i-- >0;)_triggers[_i]&&_triggers[_i].update(0,ot);_direction=1}else for(_i=0;_i<g;_i++)_triggers[_i]&&_triggers[_i].update(0,ot);ScrollTrigger.isUpdating=!1}_rafID=0},_propNamesToCopy=[_left,_top,_bottom,_right,_margin+_Bottom,_margin+_Right,_margin+_Top,_margin+_Left,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],_stateProps=_propNamesToCopy.concat([_width,_height,"boxSizing","max"+_Width,"max"+_Height,"position",_margin,_padding,_padding+_Top,_padding+_Right,_padding+_Bottom,_padding+_Left]),_swapPinOut=function $(b,g,tt){_setState(tt);var ot=b._gsap;if(ot.spacerIsNative)_setState(ot.spacerState);else if(b._gsap.swappedIn){var ut=g.parentNode;ut&&(ut.insertBefore(b,g),ut.removeChild(g))}b._gsap.swappedIn=!1},_swapPinIn=function $(b,g,tt,ot){if(!b._gsap.swappedIn){for(var ut=_propNamesToCopy.length,gt=g.style,xt=b.style,It;ut--;)It=_propNamesToCopy[ut],gt[It]=tt[It];gt.position=tt.position==="absolute"?"absolute":"relative",tt.display==="inline"&&(gt.display="inline-block"),xt[_bottom]=xt[_right]="auto",gt.flexBasis=tt.flexBasis||"auto",gt.overflow="visible",gt.boxSizing="border-box",gt[_width]=_getSize(b,_horizontal)+_px,gt[_height]=_getSize(b,_vertical)+_px,gt[_padding]=xt[_margin]=xt[_top]=xt[_left]="0",_setState(ot),xt[_width]=xt["max"+_Width]=tt[_width],xt[_height]=xt["max"+_Height]=tt[_height],xt[_padding]=tt[_padding],b.parentNode!==g&&(b.parentNode.insertBefore(g,b),g.appendChild(b)),b._gsap.swappedIn=!0}},_capsExp=/([A-Z])/g,_setState=function $(b){if(b){var g=b.t.style,tt=b.length,ot=0,ut,gt;for((b.t._gsap||gsap.core.getCache(b.t)).uncache=1;ot<tt;ot+=2)gt=b[ot+1],ut=b[ot],gt?g[ut]=gt:g[ut]&&g.removeProperty(ut.replace(_capsExp,"-$1").toLowerCase())}},_getState=function $(b){for(var g=_stateProps.length,tt=b.style,ot=[],ut=0;ut<g;ut++)ot.push(_stateProps[ut],tt[_stateProps[ut]]);return ot.t=b,ot},_copyState=function $(b,g,tt){for(var ot=[],ut=b.length,gt=tt?8:0,xt;gt<ut;gt+=2)xt=b[gt],ot.push(xt,xt in g?g[xt]:b[gt+1]);return ot.t=b.t,ot},_winOffsets={left:0,top:0},_parsePosition=function $(b,g,tt,ot,ut,gt,xt,It,kt,Ft,Xt,qt,jt,sn){_isFunction(b)&&(b=b(It)),_isString(b)&&b.substr(0,3)==="max"&&(b=qt+(b.charAt(4)==="="?_offsetToPx("0"+b.substr(3),tt):0));var Gt=jt?jt.time():0,vn,nn,Wt;if(jt&&jt.seek(0),isNaN(b)||(b=+b),_isNumber(b))jt&&(b=gsap.utils.mapRange(jt.scrollTrigger.start,jt.scrollTrigger.end,0,qt,b)),xt&&_positionMarker(xt,tt,ot,!0);else{_isFunction(g)&&(g=g(It));var on=(b||"0").split(" "),gn,ln,_n,Ut;Wt=_getTarget(g,It)||_body,gn=_getBounds(Wt)||{},(!gn||!gn.left&&!gn.top)&&_getComputedStyle(Wt).display==="none"&&(Ut=Wt.style.display,Wt.style.display="block",gn=_getBounds(Wt),Ut?Wt.style.display=Ut:Wt.style.removeProperty("display")),ln=_offsetToPx(on[0],gn[ot.d]),_n=_offsetToPx(on[1]||"0",tt),b=gn[ot.p]-kt[ot.p]-Ft+ln+ut-_n,xt&&_positionMarker(xt,_n,ot,tt-_n<20||xt._isStart&&_n>20),tt-=tt-_n}if(sn&&(It[sn]=b||-.001,b<0&&(b=0)),gt){var Qt=b+tt,tn=gt._isStart;vn="scroll"+ot.d2,_positionMarker(gt,Qt,ot,tn&&Qt>20||!tn&&(Xt?Math.max(_body[vn],_docEl[vn]):gt.parentNode[vn])<=Qt+1),Xt&&(kt=_getBounds(xt),Xt&&(gt.style[ot.op.p]=kt[ot.op.p]-ot.op.m-gt._offset+_px))}return jt&&Wt&&(vn=_getBounds(Wt),jt.seek(qt),nn=_getBounds(Wt),jt._caScrollDist=vn[ot.p]-nn[ot.p],b=b/jt._caScrollDist*qt),jt&&jt.seek(Gt),jt?b:Math.round(b)},_prefixExp=/(webkit|moz|length|cssText|inset)/i,_reparent=function $(b,g,tt,ot){if(b.parentNode!==g){var ut=b.style,gt,xt;if(g===_body){b._stOrig=ut.cssText,xt=_getComputedStyle(b);for(gt in xt)!+gt&&!_prefixExp.test(gt)&&xt[gt]&&typeof ut[gt]=="string"&&gt!=="0"&&(ut[gt]=xt[gt]);ut.top=tt,ut.left=ot}else ut.cssText=b._stOrig;gsap.core.getCache(b).uncache=1,g.appendChild(b)}},_interruptionTracker=function $(b,g,tt){var ot=g,ut=ot;return function(gt){var xt=Math.round(b());return xt!==ot&&xt!==ut&&Math.abs(xt-ot)>3&&Math.abs(xt-ut)>3&&(gt=xt,tt&&tt()),ut=ot,ot=gt,gt}},_shiftMarker=function $(b,g,tt){var ot={};ot[g.p]="+="+tt,gsap.set(b,ot)},_getTweenCreator=function $(b,g){var tt=_getScrollFunc(b,g),ot="_scroll"+g.p2,ut=function gt(xt,It,kt,Ft,Xt){var qt=gt.tween,jt=It.onComplete,sn={};kt=kt||tt();var Gt=_interruptionTracker(tt,kt,function(){qt.kill(),gt.tween=0});return Xt=Ft&&Xt||0,Ft=Ft||xt-kt,qt&&qt.kill(),It[ot]=xt,It.modifiers=sn,sn[ot]=function(){return Gt(kt+Ft*qt.ratio+Xt*qt.ratio*qt.ratio)},It.onUpdate=function(){_scrollers.cache++,gt.tween&&_updateAll()},It.onComplete=function(){gt.tween=0,jt&&jt.call(qt)},qt=gt.tween=gsap.to(b,It),qt};return b[ot]=tt,tt.wheelHandler=function(){return ut.tween&&ut.tween.kill()&&(ut.tween=0)},_addListener(b,"wheel",tt.wheelHandler),ScrollTrigger.isTouch&&_addListener(b,"touchmove",tt.wheelHandler),ut},ScrollTrigger=function(){function $(g,tt){_coreInitted||$.register(gsap)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),_context(this),this.init(g,tt)}var b=$.prototype;return b.init=function(tt,ot){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!_enabled){this.update=this.refresh=this.kill=_passThrough;return}tt=_setDefaults(_isString(tt)||_isNumber(tt)||tt.nodeType?{trigger:tt}:tt,_defaults);var ut=tt,gt=ut.onUpdate,xt=ut.toggleClass,It=ut.id,kt=ut.onToggle,Ft=ut.onRefresh,Xt=ut.scrub,qt=ut.trigger,jt=ut.pin,sn=ut.pinSpacing,Gt=ut.invalidateOnRefresh,vn=ut.anticipatePin,nn=ut.onScrubComplete,Wt=ut.onSnapComplete,on=ut.once,gn=ut.snap,ln=ut.pinReparent,_n=ut.pinSpacer,Ut=ut.containerAnimation,Qt=ut.fastScrollEnd,tn=ut.preventOverlaps,bn=tt.horizontal||tt.containerAnimation&&tt.horizontal!==!1?_horizontal:_vertical,Yt=!Xt&&Xt!==0,en=_getTarget(tt.scroller||_win),un=gsap.core.getCache(en),yn=_isViewport(en),zn=("pinType"in tt?tt.pinType:_getProxyProp(en,"pinType")||yn&&"fixed")==="fixed",Yn=[tt.onEnter,tt.onLeave,tt.onEnterBack,tt.onLeaveBack],tr=Yt&&tt.toggleActions.split(" "),Un="markers"in tt?tt.markers:_defaults.markers,Jn=yn?0:parseFloat(_getComputedStyle(en)["border"+bn.p2+_Width])||0,hn=this,rr=tt.onRefreshInit&&function(){return tt.onRefreshInit(hn)},sr=_getSizeFunc(en,yn,bn),br=_getOffsetsFunc(en,yn),Kn=0,dn=0,kn=0,Vn=_getScrollFunc(en,bn),Rr,cr,Hr,xs,Ys,ls,oo,Ks,Xo,fr,ko,pu,Fu,wo,Pl,xa,Bl,po,Go,su,Ho,ou,Uo,au,kp,Ap,Cv,xl,fu,Tm,Gl,Io,sp,To,Zo,Po,Mm,Jl,ju;if(hn._startClamp=hn._endClamp=!1,hn._dir=bn,vn*=45,hn.scroller=en,hn.scroll=Ut?Ut.time.bind(Ut):Vn,xs=Vn(),hn.vars=tt,ot=ot||tt.animation,"refreshPriority"in tt&&(_sort=1,tt.refreshPriority===-9999&&(_primary=hn)),un.tweenScroll=un.tweenScroll||{top:_getTweenCreator(en,_vertical),left:_getTweenCreator(en,_horizontal)},hn.tweenTo=Rr=un.tweenScroll[bn.p],hn.scrubDuration=function(fs){sp=_isNumber(fs)&&fs,sp?Io?Io.duration(fs):Io=gsap.to(ot,{ease:"expo",totalProgress:"+=0",duration:sp,paused:!0,onComplete:function(){return nn&&nn(hn)}}):(Io&&Io.progress(1).kill(),Io=0)},ot&&(ot.vars.lazy=!1,ot._initted&&!hn.isReverted||ot.vars.immediateRender!==!1&&tt.immediateRender!==!1&&ot.duration()&&ot.render(0,!0,!0),hn.animation=ot.pause(),ot.scrollTrigger=hn,hn.scrubDuration(Xt),Tm=0,It||(It=ot.vars.id)),gn&&((!_isObject(gn)||gn.push)&&(gn={snapTo:gn}),"scrollBehavior"in _body.style&&gsap.set(yn?[_body,_docEl]:en,{scrollBehavior:"auto"}),_scrollers.forEach(function(fs){return _isFunction(fs)&&fs.target===(yn?_doc.scrollingElement||_docEl:en)&&(fs.smooth=!1)}),Hr=_isFunction(gn.snapTo)?gn.snapTo:gn.snapTo==="labels"?_getClosestLabel(ot):gn.snapTo==="labelsDirectional"?_getLabelAtDirection(ot):gn.directional!==!1?function(fs,Ns){return _snapDirectional(gn.snapTo)(fs,_getTime()-dn<500?0:Ns.direction)}:gsap.utils.snap(gn.snapTo),To=gn.duration||{min:.1,max:2},To=_isObject(To)?_clamp(To.min,To.max):_clamp(To,To),Zo=gsap.delayedCall(gn.delay||sp/2||.1,function(){var fs=Vn(),Ns=_getTime()-dn<500,En=Rr.tween;if((Ns||Math.abs(hn.getVelocity())<10)&&!En&&!_pointerIsDown&&Kn!==fs){var Js=(fs-ls)/wo,El=ot&&!Yt?ot.totalProgress():Js,to=Ns?0:(El-Gl)/(_getTime()-_time2)*1e3||0,Ls=gsap.utils.clamp(-Js,1-Js,_abs(to/2)*to/.185),ao=Js+(gn.inertia===!1?0:Ls),wu=_clamp(0,1,Hr(ao,hn)),Yo=Math.round(ls+wu*wo),$a=gn,$u=$a.onStart,Ko=$a.onInterrupt,Ku=$a.onComplete;if(fs<=oo&&fs>=ls&&Yo!==fs){if(En&&!En._initted&&En.data<=_abs(Yo-fs))return;gn.inertia===!1&&(Ls=wu-Js),Rr(Yo,{duration:To(_abs(Math.max(_abs(ao-El),_abs(wu-El))*.185/to/.05||0)),ease:gn.ease||"power3",data:_abs(Yo-fs),onInterrupt:function(){return Zo.restart(!0)&&Ko&&Ko(hn)},onComplete:function(){hn.update(),Kn=Vn(),Io&&ot&&ot.progress(wu),Tm=Gl=ot&&!Yt?ot.totalProgress():hn.progress,Wt&&Wt(hn),Ku&&Ku(hn)}},fs,Ls*wo,Yo-fs-Ls*wo),$u&&$u(hn,Rr.tween)}}else hn.isActive&&Kn!==fs&&Zo.restart(!0)}).pause()),It&&(_ids[It]=hn),qt=hn.trigger=_getTarget(qt||jt!==!0&&jt),ju=qt&&qt._gsap&&qt._gsap.stRevert,ju&&(ju=ju(hn)),jt=jt===!0?qt:_getTarget(jt),_isString(xt)&&(xt={targets:qt,className:xt}),jt&&(sn===!1||sn===_margin||(sn=!sn&&jt.parentNode&&jt.parentNode.style&&_getComputedStyle(jt.parentNode).display==="flex"?!1:_padding),hn.pin=jt,cr=gsap.core.getCache(jt),cr.spacer?Pl=cr.pinState:(_n&&(_n=_getTarget(_n),_n&&!_n.nodeType&&(_n=_n.current||_n.nativeElement),cr.spacerIsNative=!!_n,_n&&(cr.spacerState=_getState(_n))),cr.spacer=po=_n||_doc.createElement("div"),po.classList.add("pin-spacer"),It&&po.classList.add("pin-spacer-"+It),cr.pinState=Pl=_getState(jt)),tt.force3D!==!1&&gsap.set(jt,{force3D:!0}),hn.spacer=po=cr.spacer,fu=_getComputedStyle(jt),au=fu[sn+bn.os2],su=gsap.getProperty(jt),Ho=gsap.quickSetter(jt,bn.a,_px),_swapPinIn(jt,po,fu),Bl=_getState(jt)),Un){pu=_isObject(Un)?_setDefaults(Un,_markerDefaults):_markerDefaults,fr=_createMarker("scroller-start",It,en,bn,pu,0),ko=_createMarker("scroller-end",It,en,bn,pu,0,fr),Go=fr["offset"+bn.op.d2];var Bs=_getTarget(_getProxyProp(en,"content")||en);Ks=this.markerStart=_createMarker("start",It,Bs,bn,pu,Go,0,Ut),Xo=this.markerEnd=_createMarker("end",It,Bs,bn,pu,Go,0,Ut),Ut&&(Jl=gsap.quickSetter([Ks,Xo],bn.a,_px)),!zn&&!(_proxies.length&&_getProxyProp(en,"fixedMarkers")===!0)&&(_makePositionable(yn?_body:en),gsap.set([fr,ko],{force3D:!0}),Ap=gsap.quickSetter(fr,bn.a,_px),xl=gsap.quickSetter(ko,bn.a,_px))}if(Ut){var Ds=Ut.vars.onUpdate,Fo=Ut.vars.onUpdateParams;Ut.eventCallback("onUpdate",function(){hn.update(0,0,1),Ds&&Ds.apply(Ut,Fo||[])})}if(hn.previous=function(){return _triggers[_triggers.indexOf(hn)-1]},hn.next=function(){return _triggers[_triggers.indexOf(hn)+1]},hn.revert=function(fs,Ns){if(!Ns)return hn.kill(!0);var En=fs!==!1||!hn.enabled,Js=_refreshing;En!==hn.isReverted&&(En&&(Po=Math.max(Vn(),hn.scroll.rec||0),kn=hn.progress,Mm=ot&&ot.progress()),Ks&&[Ks,Xo,fr,ko].forEach(function(El){return El.style.display=En?"none":"block"}),En&&(_refreshing=hn,hn.update(En)),jt&&(!ln||!hn.isActive)&&(En?_swapPinOut(jt,po,Pl):_swapPinIn(jt,po,_getComputedStyle(jt),kp)),En||hn.update(En),_refreshing=Js,hn.isReverted=En)},hn.refresh=function(fs,Ns,En,Js){if(!((_refreshing||!hn.enabled)&&!Ns)){if(jt&&fs&&_lastScrollTime){_addListener($,"scrollEnd",_softRefresh);return}!_refreshingAll&&rr&&rr(hn),_refreshing=hn,Rr.tween&&!En&&(Rr.tween.kill(),Rr.tween=0),Io&&Io.pause(),Gt&&ot&&ot.revert({kill:!1}).invalidate(),hn.isReverted||hn.revert(!0,!0),hn._subPinOffset=!1;var El=sr(),to=br(),Ls=Ut?Ut.duration():_maxScroll(en,bn),ao=wo<=.01,wu=0,Yo=Js||0,$a=_isObject(En)?En.end:tt.end,$u=tt.endTrigger||qt,Ko=_isObject(En)?En.start:tt.start||(tt.start===0||!qt?0:jt?"0 0":"0 100%"),Ku=hn.pinnedContainer=tt.pinnedContainer&&_getTarget(tt.pinnedContainer,hn),op=qt&&Math.max(0,_triggers.indexOf(hn))||0,Ju=op,mu,Nl,Km,r0,Zl,na,_l,Im,k0,Jm,Op,_c,fm;for(Un&&_isObject(En)&&(_c=gsap.getProperty(fr,bn.p),fm=gsap.getProperty(ko,bn.p));Ju--;)na=_triggers[Ju],na.end||na.refresh(0,1)||(_refreshing=hn),_l=na.pin,_l&&(_l===qt||_l===jt||_l===Ku)&&!na.isReverted&&(Jm||(Jm=[]),Jm.unshift(na),na.revert(!0,!0)),na!==_triggers[Ju]&&(op--,Ju--);for(_isFunction(Ko)&&(Ko=Ko(hn)),Ko=_parseClamp(Ko,"start",hn),ls=_parsePosition(Ko,qt,El,bn,Vn(),Ks,fr,hn,to,Jn,zn,Ls,Ut,hn._startClamp&&"_startClamp")||(jt?-.001:0),_isFunction($a)&&($a=$a(hn)),_isString($a)&&!$a.indexOf("+=")&&(~$a.indexOf(" ")?$a=(_isString(Ko)?Ko.split(" ")[0]:"")+$a:(wu=_offsetToPx($a.substr(2),El),$a=_isString(Ko)?Ko:(Ut?gsap.utils.mapRange(0,Ut.duration(),Ut.scrollTrigger.start,Ut.scrollTrigger.end,ls):ls)+wu,$u=qt)),$a=_parseClamp($a,"end",hn),oo=Math.max(ls,_parsePosition($a||($u?"100% 0":Ls),$u,El,bn,Vn()+wu,Xo,ko,hn,to,Jn,zn,Ls,Ut,hn._endClamp&&"_endClamp"))||-.001,wu=0,Ju=op;Ju--;)na=_triggers[Ju],_l=na.pin,_l&&na.start-na._pinPush<=ls&&!Ut&&na.end>0&&(mu=na.end-(hn._startClamp?Math.max(0,na.start):na.start),(_l===qt&&na.start-na._pinPush<ls||_l===Ku)&&isNaN(Ko)&&(wu+=mu*(1-na.progress)),_l===jt&&(Yo+=mu));if(ls+=wu,oo+=wu,hn._startClamp&&(hn._startClamp+=wu),hn._endClamp&&!_refreshingAll&&(hn._endClamp=oo||-.001,oo=Math.min(oo,_maxScroll(en,bn))),wo=oo-ls||(ls-=.01)&&.001,ao&&(kn=gsap.utils.clamp(0,1,gsap.utils.normalize(ls,oo,Po))),hn._pinPush=Yo,Ks&&wu&&(mu={},mu[bn.a]="+="+wu,Ku&&(mu[bn.p]="-="+Vn()),gsap.set([Ks,Xo],mu)),jt&&!(_clampingMax&&hn.end>=_maxScroll(en,bn)))mu=_getComputedStyle(jt),r0=bn===_vertical,Km=Vn(),ou=parseFloat(su(bn.a))+Yo,!Ls&&oo>1&&(Op=(yn?_doc.scrollingElement||_docEl:en).style,Op={style:Op,value:Op["overflow"+bn.a.toUpperCase()]},yn&&_getComputedStyle(_body)["overflow"+bn.a.toUpperCase()]!=="scroll"&&(Op.style["overflow"+bn.a.toUpperCase()]="scroll")),_swapPinIn(jt,po,mu),Bl=_getState(jt),Nl=_getBounds(jt,!0),Im=zn&&_getScrollFunc(en,r0?_horizontal:_vertical)(),sn&&(kp=[sn+bn.os2,wo+Yo+_px],kp.t=po,Ju=sn===_padding?_getSize(jt,bn)+wo+Yo:0,Ju&&(kp.push(bn.d,Ju+_px),po.style.flexBasis!=="auto"&&(po.style.flexBasis=Ju+_px)),_setState(kp),Ku&&_triggers.forEach(function(H_){H_.pin===Ku&&H_.vars.pinSpacing!==!1&&(H_._subPinOffset=!0)}),zn&&Vn(Po)),zn&&(Zl={top:Nl.top+(r0?Km-ls:Im)+_px,left:Nl.left+(r0?Im:Km-ls)+_px,boxSizing:"border-box",position:"fixed"},Zl[_width]=Zl["max"+_Width]=Math.ceil(Nl.width)+_px,Zl[_height]=Zl["max"+_Height]=Math.ceil(Nl.height)+_px,Zl[_margin]=Zl[_margin+_Top]=Zl[_margin+_Right]=Zl[_margin+_Bottom]=Zl[_margin+_Left]="0",Zl[_padding]=mu[_padding],Zl[_padding+_Top]=mu[_padding+_Top],Zl[_padding+_Right]=mu[_padding+_Right],Zl[_padding+_Bottom]=mu[_padding+_Bottom],Zl[_padding+_Left]=mu[_padding+_Left],xa=_copyState(Pl,Zl,ln),_refreshingAll&&Vn(0)),ot?(k0=ot._initted,_suppressOverwrites(1),ot.render(ot.duration(),!0,!0),Uo=su(bn.a)-ou+wo+Yo,Cv=Math.abs(wo-Uo)>1,zn&&Cv&&xa.splice(xa.length-2,2),ot.render(0,!0,!0),k0||ot.invalidate(!0),ot.parent||ot.totalTime(ot.totalTime()),_suppressOverwrites(0)):Uo=wo,Op&&(Op.value?Op.style["overflow"+bn.a.toUpperCase()]=Op.value:Op.style.removeProperty("overflow-"+bn.a));else if(qt&&Vn()&&!Ut)for(Nl=qt.parentNode;Nl&&Nl!==_body;)Nl._pinOffset&&(ls-=Nl._pinOffset,oo-=Nl._pinOffset),Nl=Nl.parentNode;Jm&&Jm.forEach(function(H_){return H_.revert(!1,!0)}),hn.start=ls,hn.end=oo,xs=Ys=_refreshingAll?Po:Vn(),!Ut&&!_refreshingAll&&(xs<Po&&Vn(Po),hn.scroll.rec=0),hn.revert(!1,!0),dn=_getTime(),Zo&&(Kn=-1,Zo.restart(!0)),_refreshing=0,ot&&Yt&&(ot._initted||Mm)&&ot.progress()!==Mm&&ot.progress(Mm||0,!0).render(ot.time(),!0,!0),(ao||kn!==hn.progress||Ut)&&(ot&&!Yt&&ot.totalProgress(Ut&&ls<-.001&&!kn?gsap.utils.normalize(ls,oo,0):kn,!0),hn.progress=ao||(xs-ls)/wo===kn?0:kn),jt&&sn&&(po._pinOffset=Math.round(hn.progress*Uo)),Io&&Io.invalidate(),isNaN(_c)||(_c-=gsap.getProperty(fr,bn.p),fm-=gsap.getProperty(ko,bn.p),_shiftMarker(fr,bn,_c),_shiftMarker(Ks,bn,_c-(Js||0)),_shiftMarker(ko,bn,fm),_shiftMarker(Xo,bn,fm-(Js||0))),ao&&!_refreshingAll&&hn.update(),Ft&&!_refreshingAll&&!Fu&&(Fu=!0,Ft(hn),Fu=!1)}},hn.getVelocity=function(){return(Vn()-Ys)/(_getTime()-_time2)*1e3||0},hn.endAnimation=function(){_endAnimation(hn.callbackAnimation),ot&&(Io?Io.progress(1):ot.paused()?Yt||_endAnimation(ot,hn.direction<0,1):_endAnimation(ot,ot.reversed()))},hn.labelToScroll=function(fs){return ot&&ot.labels&&(ls||hn.refresh()||ls)+ot.labels[fs]/ot.duration()*wo||0},hn.getTrailing=function(fs){var Ns=_triggers.indexOf(hn),En=hn.direction>0?_triggers.slice(0,Ns).reverse():_triggers.slice(Ns+1);return(_isString(fs)?En.filter(function(Js){return Js.vars.preventOverlaps===fs}):En).filter(function(Js){return hn.direction>0?Js.end<=ls:Js.start>=oo})},hn.update=function(fs,Ns,En){if(!(Ut&&!En&&!fs)){var Js=_refreshingAll===!0?Po:hn.scroll(),El=fs?0:(Js-ls)/wo,to=El<0?0:El>1?1:El||0,Ls=hn.progress,ao,wu,Yo,$a,$u,Ko,Ku,op;if(Ns&&(Ys=xs,xs=Ut?Vn():Js,gn&&(Gl=Tm,Tm=ot&&!Yt?ot.totalProgress():to)),vn&&!to&&jt&&!_refreshing&&!_startup&&_lastScrollTime&&ls<Js+(Js-Ys)/(_getTime()-_time2)*vn&&(to=1e-4),to!==Ls&&hn.enabled){if(ao=hn.isActive=!!to&&to<1,wu=!!Ls&&Ls<1,Ko=ao!==wu,$u=Ko||!!to!=!!Ls,hn.direction=to>Ls?1:-1,hn.progress=to,$u&&!_refreshing&&(Yo=to&&!Ls?0:to===1?1:Ls===1?2:3,Yt&&($a=!Ko&&tr[Yo+1]!=="none"&&tr[Yo+1]||tr[Yo],op=ot&&($a==="complete"||$a==="reset"||$a in ot))),tn&&(Ko||op)&&(op||Xt||!ot)&&(_isFunction(tn)?tn(hn):hn.getTrailing(tn).forEach(function(Km){return Km.endAnimation()})),Yt||(Io&&!_refreshing&&!_startup?(Io._dp._time-Io._start!==Io._time&&Io.render(Io._dp._time-Io._start),Io.resetTo?Io.resetTo("totalProgress",to,ot._tTime/ot._tDur):(Io.vars.totalProgress=to,Io.invalidate().restart())):ot&&ot.totalProgress(to,!!(_refreshing&&(dn||fs)))),jt){if(fs&&sn&&(po.style[sn+bn.os2]=au),!zn)Ho(_round(ou+Uo*to));else if($u){if(Ku=!fs&&to>Ls&&oo+1>Js&&Js+1>=_maxScroll(en,bn),ln)if(!fs&&(ao||Ku)){var Ju=_getBounds(jt,!0),mu=Js-ls;_reparent(jt,_body,Ju.top+(bn===_vertical?mu:0)+_px,Ju.left+(bn===_vertical?0:mu)+_px)}else _reparent(jt,po);_setState(ao||Ku?xa:Bl),Cv&&to<1&&ao||Ho(ou+(to===1&&!Ku?Uo:0))}}gn&&!Rr.tween&&!_refreshing&&!_startup&&Zo.restart(!0),xt&&(Ko||on&&to&&(to<1||!_limitCallbacks))&&_toArray(xt.targets).forEach(function(Km){return Km.classList[ao||on?"add":"remove"](xt.className)}),gt&&!Yt&&!fs&&gt(hn),$u&&!_refreshing?(Yt&&(op&&($a==="complete"?ot.pause().totalProgress(1):$a==="reset"?ot.restart(!0).pause():$a==="restart"?ot.restart(!0):ot[$a]()),gt&&gt(hn)),(Ko||!_limitCallbacks)&&(kt&&Ko&&_callback(hn,kt),Yn[Yo]&&_callback(hn,Yn[Yo]),on&&(to===1?hn.kill(!1,1):Yn[Yo]=0),Ko||(Yo=to===1?1:3,Yn[Yo]&&_callback(hn,Yn[Yo]))),Qt&&!ao&&Math.abs(hn.getVelocity())>(_isNumber(Qt)?Qt:2500)&&(_endAnimation(hn.callbackAnimation),Io?Io.progress(1):_endAnimation(ot,$a==="reverse"?1:!to,1))):Yt&&gt&&!_refreshing&&gt(hn)}if(xl){var Nl=Ut?Js/Ut.duration()*(Ut._caScrollDist||0):Js;Ap(Nl+(fr._isFlipped?1:0)),xl(Nl)}Jl&&Jl(-Js/Ut.duration()*(Ut._caScrollDist||0))}},hn.enable=function(fs,Ns){hn.enabled||(hn.enabled=!0,_addListener(en,"resize",_onResize),yn||_addListener(en,"scroll",_onScroll),rr&&_addListener($,"refreshInit",rr),fs!==!1&&(hn.progress=kn=0,xs=Ys=Kn=Vn()),Ns!==!1&&hn.refresh())},hn.getTween=function(fs){return fs&&Rr?Rr.tween:Io},hn.setPositions=function(fs,Ns,En,Js){if(Ut){var El=Ut.scrollTrigger,to=Ut.duration(),Ls=El.end-El.start;fs=El.start+Ls*fs/to,Ns=El.start+Ls*Ns/to}hn.refresh(!1,!1,{start:_keepClamp(fs,En&&!!hn._startClamp),end:_keepClamp(Ns,En&&!!hn._endClamp)},Js),hn.update()},hn.adjustPinSpacing=function(fs){if(kp&&fs){var Ns=kp.indexOf(bn.d)+1;kp[Ns]=parseFloat(kp[Ns])+fs+_px,kp[1]=parseFloat(kp[1])+fs+_px,_setState(kp)}},hn.disable=function(fs,Ns){if(hn.enabled&&(fs!==!1&&hn.revert(!0,!0),hn.enabled=hn.isActive=!1,Ns||Io&&Io.pause(),Po=0,cr&&(cr.uncache=1),rr&&_removeListener($,"refreshInit",rr),Zo&&(Zo.pause(),Rr.tween&&Rr.tween.kill()&&(Rr.tween=0)),!yn)){for(var En=_triggers.length;En--;)if(_triggers[En].scroller===en&&_triggers[En]!==hn)return;_removeListener(en,"resize",_onResize),yn||_removeListener(en,"scroll",_onScroll)}},hn.kill=function(fs,Ns){hn.disable(fs,Ns),Io&&!Ns&&Io.kill(),It&&delete _ids[It];var En=_triggers.indexOf(hn);En>=0&&_triggers.splice(En,1),En===_i&&_direction>0&&_i--,En=0,_triggers.forEach(function(Js){return Js.scroller===hn.scroller&&(En=1)}),En||_refreshingAll||(hn.scroll.rec=0),ot&&(ot.scrollTrigger=null,fs&&ot.revert({kill:!1}),Ns||ot.kill()),Ks&&[Ks,Xo,fr,ko].forEach(function(Js){return Js.parentNode&&Js.parentNode.removeChild(Js)}),_primary===hn&&(_primary=0),jt&&(cr&&(cr.uncache=1),En=0,_triggers.forEach(function(Js){return Js.pin===jt&&En++}),En||(cr.spacer=0)),tt.onKill&&tt.onKill(hn)},_triggers.push(hn),hn.enable(!1,!1),ju&&ju(hn),ot&&ot.add&&!wo){var Ll=hn.update;hn.update=function(){hn.update=Ll,ls||oo||hn.refresh()},gsap.delayedCall(.01,hn.update),wo=.01,ls=oo=0}else hn.refresh();jt&&_queueRefreshAll()},$.register=function(tt){return _coreInitted||(gsap=tt||_getGSAP(),_windowExists()&&window.document&&$.enable(),_coreInitted=_enabled),_coreInitted},$.defaults=function(tt){if(tt)for(var ot in tt)_defaults[ot]=tt[ot];return _defaults},$.disable=function(tt,ot){_enabled=0,_triggers.forEach(function(gt){return gt[ot?"kill":"disable"](tt)}),_removeListener(_win,"wheel",_onScroll),_removeListener(_doc,"scroll",_onScroll),clearInterval(_syncInterval),_removeListener(_doc,"touchcancel",_passThrough),_removeListener(_body,"touchstart",_passThrough),_multiListener(_removeListener,_doc,"pointerdown,touchstart,mousedown",_pointerDownHandler),_multiListener(_removeListener,_doc,"pointerup,touchend,mouseup",_pointerUpHandler),_resizeDelay.kill(),_iterateAutoRefresh(_removeListener);for(var ut=0;ut<_scrollers.length;ut+=3)_wheelListener(_removeListener,_scrollers[ut],_scrollers[ut+1]),_wheelListener(_removeListener,_scrollers[ut],_scrollers[ut+2])},$.enable=function(){if(_win=window,_doc=document,_docEl=_doc.documentElement,_body=_doc.body,gsap&&(_toArray=gsap.utils.toArray,_clamp=gsap.utils.clamp,_context=gsap.core.context||_passThrough,_suppressOverwrites=gsap.core.suppressOverwrites||_passThrough,_scrollRestoration=_win.history.scrollRestoration||"auto",_lastScroll=_win.pageYOffset,gsap.core.globals("ScrollTrigger",$),_body)){_enabled=1,_div100vh=document.createElement("div"),_div100vh.style.height="100vh",_div100vh.style.position="absolute",_refresh100vh(),_rafBugFix(),Observer.register(gsap),$.isTouch=Observer.isTouch,_fixIOSBug=Observer.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),_addListener(_win,"wheel",_onScroll),_root=[_win,_doc,_docEl,_body],gsap.matchMedia?($.matchMedia=function(It){var kt=gsap.matchMedia(),Ft;for(Ft in It)kt.add(Ft,It[Ft]);return kt},gsap.addEventListener("matchMediaInit",function(){return _revertAll()}),gsap.addEventListener("matchMediaRevert",function(){return _revertRecorded()}),gsap.addEventListener("matchMedia",function(){_refreshAll(0,1),_dispatch("matchMedia")}),gsap.matchMedia("(orientation: portrait)",function(){return _setBaseDimensions(),_setBaseDimensions})):console.warn("Requires GSAP 3.11.0 or later"),_setBaseDimensions(),_addListener(_doc,"scroll",_onScroll);var tt=_body.style,ot=tt.borderTopStyle,ut=gsap.core.Animation.prototype,gt,xt;for(ut.revert||Object.defineProperty(ut,"revert",{value:function(){return this.time(-.01,!0)}}),tt.borderTopStyle="solid",gt=_getBounds(_body),_vertical.m=Math.round(gt.top+_vertical.sc())||0,_horizontal.m=Math.round(gt.left+_horizontal.sc())||0,ot?tt.borderTopStyle=ot:tt.removeProperty("border-top-style"),_syncInterval=setInterval(_sync,250),gsap.delayedCall(.5,function(){return _startup=0}),_addListener(_doc,"touchcancel",_passThrough),_addListener(_body,"touchstart",_passThrough),_multiListener(_addListener,_doc,"pointerdown,touchstart,mousedown",_pointerDownHandler),_multiListener(_addListener,_doc,"pointerup,touchend,mouseup",_pointerUpHandler),_transformProp=gsap.utils.checkPrefix("transform"),_stateProps.push(_transformProp),_coreInitted=_getTime(),_resizeDelay=gsap.delayedCall(.2,_refreshAll).pause(),_autoRefresh=[_doc,"visibilitychange",function(){var It=_win.innerWidth,kt=_win.innerHeight;_doc.hidden?(_prevWidth=It,_prevHeight=kt):(_prevWidth!==It||_prevHeight!==kt)&&_onResize()},_doc,"DOMContentLoaded",_refreshAll,_win,"load",_refreshAll,_win,"resize",_onResize],_iterateAutoRefresh(_addListener),_triggers.forEach(function(It){return It.enable(0,1)}),xt=0;xt<_scrollers.length;xt+=3)_wheelListener(_removeListener,_scrollers[xt],_scrollers[xt+1]),_wheelListener(_removeListener,_scrollers[xt],_scrollers[xt+2])}},$.config=function(tt){"limitCallbacks"in tt&&(_limitCallbacks=!!tt.limitCallbacks);var ot=tt.syncInterval;ot&&clearInterval(_syncInterval)||(_syncInterval=ot)&&setInterval(_sync,ot),"ignoreMobileResize"in tt&&(_ignoreMobileResize=$.isTouch===1&&tt.ignoreMobileResize),"autoRefreshEvents"in tt&&(_iterateAutoRefresh(_removeListener)||_iterateAutoRefresh(_addListener,tt.autoRefreshEvents||"none"),_ignoreResize=(tt.autoRefreshEvents+"").indexOf("resize")===-1)},$.scrollerProxy=function(tt,ot){var ut=_getTarget(tt),gt=_scrollers.indexOf(ut),xt=_isViewport(ut);~gt&&_scrollers.splice(gt,xt?6:2),ot&&(xt?_proxies.unshift(_win,ot,_body,ot,_docEl,ot):_proxies.unshift(ut,ot))},$.clearMatchMedia=function(tt){_triggers.forEach(function(ot){return ot._ctx&&ot._ctx.query===tt&&ot._ctx.kill(!0,!0)})},$.isInViewport=function(tt,ot,ut){var gt=(_isString(tt)?_getTarget(tt):tt).getBoundingClientRect(),xt=gt[ut?_width:_height]*ot||0;return ut?gt.right-xt>0&&gt.left+xt<_win.innerWidth:gt.bottom-xt>0&&gt.top+xt<_win.innerHeight},$.positionInViewport=function(tt,ot,ut){_isString(tt)&&(tt=_getTarget(tt));var gt=tt.getBoundingClientRect(),xt=gt[ut?_width:_height],It=ot==null?xt/2:ot in _keywords?_keywords[ot]*xt:~ot.indexOf("%")?parseFloat(ot)*xt/100:parseFloat(ot)||0;return ut?(gt.left+It)/_win.innerWidth:(gt.top+It)/_win.innerHeight},$.killAll=function(tt){if(_triggers.slice(0).forEach(function(ut){return ut.vars.id!=="ScrollSmoother"&&ut.kill()}),tt!==!0){var ot=_listeners.killAll||[];_listeners={},ot.forEach(function(ut){return ut()})}},$}();ScrollTrigger.version="3.12.4";ScrollTrigger.saveStyles=function($){return $?_toArray($).forEach(function(b){if(b&&b.style){var g=_savedStyles.indexOf(b);g>=0&&_savedStyles.splice(g,5),_savedStyles.push(b,b.style.cssText,b.getBBox&&b.getAttribute("transform"),gsap.core.getCache(b),_context())}}):_savedStyles};ScrollTrigger.revert=function($,b){return _revertAll(!$,b)};ScrollTrigger.create=function($,b){return new ScrollTrigger($,b)};ScrollTrigger.refresh=function($){return $?_onResize():(_coreInitted||ScrollTrigger.register())&&_refreshAll(!0)};ScrollTrigger.update=function($){return++_scrollers.cache&&_updateAll($===!0?2:0)};ScrollTrigger.clearScrollMemory=_clearScrollMemory;ScrollTrigger.maxScroll=function($,b){return _maxScroll($,b?_horizontal:_vertical)};ScrollTrigger.getScrollFunc=function($,b){return _getScrollFunc(_getTarget($),b?_horizontal:_vertical)};ScrollTrigger.getById=function($){return _ids[$]};ScrollTrigger.getAll=function(){return _triggers.filter(function($){return $.vars.id!=="ScrollSmoother"})};ScrollTrigger.isScrolling=function(){return!!_lastScrollTime};ScrollTrigger.snapDirectional=_snapDirectional;ScrollTrigger.addEventListener=function($,b){var g=_listeners[$]||(_listeners[$]=[]);~g.indexOf(b)||g.push(b)};ScrollTrigger.removeEventListener=function($,b){var g=_listeners[$],tt=g&&g.indexOf(b);tt>=0&&g.splice(tt,1)};ScrollTrigger.batch=function($,b){var g=[],tt={},ot=b.interval||.016,ut=b.batchMax||1e9,gt=function(kt,Ft){var Xt=[],qt=[],jt=gsap.delayedCall(ot,function(){Ft(Xt,qt),Xt=[],qt=[]}).pause();return function(sn){Xt.length||jt.restart(!0),Xt.push(sn.trigger),qt.push(sn),ut<=Xt.length&&jt.progress(1)}},xt;for(xt in b)tt[xt]=xt.substr(0,2)==="on"&&_isFunction(b[xt])&&xt!=="onRefreshInit"?gt(xt,b[xt]):b[xt];return _isFunction(ut)&&(ut=ut(),_addListener(ScrollTrigger,"refresh",function(){return ut=b.batchMax()})),_toArray($).forEach(function(It){var kt={};for(xt in tt)kt[xt]=tt[xt];kt.trigger=It,g.push(ScrollTrigger.create(kt))}),g};var _clampScrollAndGetDurationMultiplier=function $(b,g,tt,ot){return g>ot?b(ot):g<0&&b(0),tt>ot?(ot-g)/(tt-g):tt<0?g/(g-tt):1},_allowNativePanning=function $(b,g){g===!0?b.style.removeProperty("touch-action"):b.style.touchAction=g===!0?"auto":g?"pan-"+g+(Observer.isTouch?" pinch-zoom":""):"none",b===_docEl&&$(_body,g)},_overflow={auto:1,scroll:1},_nestedScroll=function $(b){var g=b.event,tt=b.target,ot=b.axis,ut=(g.changedTouches?g.changedTouches[0]:g).target,gt=ut._gsap||gsap.core.getCache(ut),xt=_getTime(),It;if(!gt._isScrollT||xt-gt._isScrollT>2e3){for(;ut&&ut!==_body&&(ut.scrollHeight<=ut.clientHeight&&ut.scrollWidth<=ut.clientWidth||!(_overflow[(It=_getComputedStyle(ut)).overflowY]||_overflow[It.overflowX]));)ut=ut.parentNode;gt._isScroll=ut&&ut!==tt&&!_isViewport(ut)&&(_overflow[(It=_getComputedStyle(ut)).overflowY]||_overflow[It.overflowX]),gt._isScrollT=xt}(gt._isScroll||ot==="x")&&(g.stopPropagation(),g._gsapAllow=!0)},_inputObserver=function $(b,g,tt,ot){return Observer.create({target:b,capture:!0,debounce:!1,lockAxis:!0,type:g,onWheel:ot=ot&&_nestedScroll,onPress:ot,onDrag:ot,onScroll:ot,onEnable:function(){return tt&&_addListener(_doc,Observer.eventTypes[0],_captureInputs,!1,!0)},onDisable:function(){return _removeListener(_doc,Observer.eventTypes[0],_captureInputs,!0)}})},_inputExp=/(input|label|select|textarea)/i,_inputIsFocused,_captureInputs=function $(b){var g=_inputExp.test(b.target.tagName);(g||_inputIsFocused)&&(b._gsapAllow=!0,_inputIsFocused=g)},_getScrollNormalizer=function $(b){_isObject(b)||(b={}),b.preventDefault=b.isNormalizer=b.allowClicks=!0,b.type||(b.type="wheel,touch"),b.debounce=!!b.debounce,b.id=b.id||"normalizer";var g=b,tt=g.normalizeScrollX,ot=g.momentum,ut=g.allowNestedScroll,gt=g.onRelease,xt,It,kt=_getTarget(b.target)||_docEl,Ft=gsap.core.globals().ScrollSmoother,Xt=Ft&&Ft.get(),qt=_fixIOSBug&&(b.content&&_getTarget(b.content)||Xt&&b.content!==!1&&!Xt.smooth()&&Xt.content()),jt=_getScrollFunc(kt,_vertical),sn=_getScrollFunc(kt,_horizontal),Gt=1,vn=(Observer.isTouch&&_win.visualViewport?_win.visualViewport.scale*_win.visualViewport.width:_win.outerWidth)/_win.innerWidth,nn=0,Wt=_isFunction(ot)?function(){return ot(xt)}:function(){return ot||2.8},on,gn,ln=_inputObserver(kt,b.type,!0,ut),_n=function(){return gn=!1},Ut=_passThrough,Qt=_passThrough,tn=function(){It=_maxScroll(kt,_vertical),Qt=_clamp(_fixIOSBug?1:0,It),tt&&(Ut=_clamp(0,_maxScroll(kt,_horizontal))),on=_refreshID},bn=function(){qt._gsap.y=_round(parseFloat(qt._gsap.y)+jt.offset)+"px",qt.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(qt._gsap.y)+", 0, 1)",jt.offset=jt.cacheID=0},Yt=function(){if(gn){requestAnimationFrame(_n);var Un=_round(xt.deltaY/2),Jn=Qt(jt.v-Un);if(qt&&Jn!==jt.v+jt.offset){jt.offset=Jn-jt.v;var hn=_round((parseFloat(qt&&qt._gsap.y)||0)-jt.offset);qt.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+hn+", 0, 1)",qt._gsap.y=hn+"px",jt.cacheID=_scrollers.cache,_updateAll()}return!0}jt.offset&&bn(),gn=!0},en,un,yn,zn,Yn=function(){tn(),en.isActive()&&en.vars.scrollY>It&&(jt()>It?en.progress(1)&&jt(It):en.resetTo("scrollY",It))};return qt&&gsap.set(qt,{y:"+=0"}),b.ignoreCheck=function(tr){return _fixIOSBug&&tr.type==="touchmove"&&Yt()||Gt>1.05&&tr.type!=="touchstart"||xt.isGesturing||tr.touches&&tr.touches.length>1},b.onPress=function(){gn=!1;var tr=Gt;Gt=_round((_win.visualViewport&&_win.visualViewport.scale||1)/vn),en.pause(),tr!==Gt&&_allowNativePanning(kt,Gt>1.01?!0:tt?!1:"x"),un=sn(),yn=jt(),tn(),on=_refreshID},b.onRelease=b.onGestureStart=function(tr,Un){if(jt.offset&&bn(),!Un)zn.restart(!0);else{_scrollers.cache++;var Jn=Wt(),hn,rr;tt&&(hn=sn(),rr=hn+Jn*.05*-tr.velocityX/.227,Jn*=_clampScrollAndGetDurationMultiplier(sn,hn,rr,_maxScroll(kt,_horizontal)),en.vars.scrollX=Ut(rr)),hn=jt(),rr=hn+Jn*.05*-tr.velocityY/.227,Jn*=_clampScrollAndGetDurationMultiplier(jt,hn,rr,_maxScroll(kt,_vertical)),en.vars.scrollY=Qt(rr),en.invalidate().duration(Jn).play(.01),(_fixIOSBug&&en.vars.scrollY>=It||hn>=It-1)&&gsap.to({},{onUpdate:Yn,duration:Jn})}gt&&gt(tr)},b.onWheel=function(){en._ts&&en.pause(),_getTime()-nn>1e3&&(on=0,nn=_getTime())},b.onChange=function(tr,Un,Jn,hn,rr){if(_refreshID!==on&&tn(),Un&&tt&&sn(Ut(hn[2]===Un?un+(tr.startX-tr.x):sn()+Un-hn[1])),Jn){jt.offset&&bn();var sr=rr[2]===Jn,br=sr?yn+tr.startY-tr.y:jt()+Jn-rr[1],Kn=Qt(br);sr&&br!==Kn&&(yn+=Kn-br),jt(Kn)}(Jn||Un)&&_updateAll()},b.onEnable=function(){_allowNativePanning(kt,tt?!1:"x"),ScrollTrigger.addEventListener("refresh",Yn),_addListener(_win,"resize",Yn),jt.smooth&&(jt.target.style.scrollBehavior="auto",jt.smooth=sn.smooth=!1),ln.enable()},b.onDisable=function(){_allowNativePanning(kt,!0),_removeListener(_win,"resize",Yn),ScrollTrigger.removeEventListener("refresh",Yn),ln.kill()},b.lockAxis=b.lockAxis!==!1,xt=new Observer(b),xt.iOS=_fixIOSBug,_fixIOSBug&&!jt()&&jt(1),_fixIOSBug&&gsap.ticker.add(_passThrough),zn=xt._dc,en=gsap.to(xt,{ease:"power4",paused:!0,scrollX:tt?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:_interruptionTracker(jt,jt(),function(){return en.pause()})},onUpdate:_updateAll,onComplete:zn.vars.onComplete}),xt};ScrollTrigger.sort=function($){return _triggers.sort($||function(b,g){return(b.vars.refreshPriority||0)*-1e6+b.start-(g.start+(g.vars.refreshPriority||0)*-1e6)})};ScrollTrigger.observe=function($){return new Observer($)};ScrollTrigger.normalizeScroll=function($){if(typeof $>"u")return _normalizer;if($===!0&&_normalizer)return _normalizer.enable();if($===!1){_normalizer&&_normalizer.kill(),_normalizer=$;return}var b=$ instanceof Observer?$:_getScrollNormalizer($);return _normalizer&&_normalizer.target===b.target&&_normalizer.kill(),_isViewport(b.target)&&(_normalizer=b),b};ScrollTrigger.core={_getVelocityProp,_inputObserver,_scrollers,_proxies,bridge:{ss:function $(){_lastScrollTime||_dispatch("scrollStart"),_lastScrollTime=_getTime()},ref:function $(){return _refreshing}}};_getGSAP()&&gsap.registerPlugin(ScrollTrigger);const scrollAnimation=($,b,g)=>{gsapWithCSS.timeline().to($,{x:-8,y:2,z:7,scrollTrigger:{trigger:".skills",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:g}).to(b,{x:1,y:1,z:2,scrollTrigger:{trigger:".skills",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}}).to(".home",{opacity:0,scrollTrigger:{trigger:".skills",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}}).to(".skills",{opacity:1,scrollTrigger:{trigger:".skills",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}}).to($,{x:-.5,y:1.4,z:-10.5,scrollTrigger:{trigger:".projects",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:g}).to(b,{x:-.1,y:1.8,z:-.2,scrollTrigger:{trigger:".projects",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}})};gsapWithCSS.registerPlugin(ScrollTrigger);function WebGiViewer(){const $=reactExports.useRef(null),b=reactExports.useCallback((tt,ot,ut)=>{tt&&ot&&ut&&scrollAnimation(tt,ot,ut)},[]),g=reactExports.useCallback(async()=>{const tt=new __webpackgi_exports__ViewerApp({canvas:$.current}),ot=tt.scene.activeCamera,ut=ot.position,gt=ot.target;await tt.addPlugin(__webpackgi_exports__GBufferPlugin),await tt.addPlugin(new __webpackgi_exports__ProgressivePlugin(32)),await tt.addPlugin(new __webpackgi_exports__TonemapPlugin(!0)),await tt.addPlugin(__webpackgi_exports__GammaCorrectionPlugin),await tt.addPlugin(__webpackgi_exports__SSRPlugin),await tt.addPlugin(__webpackgi_exports__SSAOPlugin),await tt.addPlugin(__webpackgi_exports__BloomPlugin),await tt.addPlugin(__webpackgi_exports__GLTFAnimationPlugin);const xt=await tt.getPlugin(__webpackgi_exports__GLTFAnimationPlugin);tt.renderer.refreshPipeline(),await tt.load("/assets/robots.glb"),tt.getPlugin(__webpackgi_exports__TonemapPlugin).config.clipBackground=!0,window.scrollTo(0,0);let It=!0;tt.scene.activeCamera.setCameraOptions({controlsEnabled:!1});const kt=()=>{It=!0,tt.setDirty()};tt.addEventListener("preFrame",()=>{It&&(ot.positionUpdated(!0),ot.targetUpdated(!0),It=!1)}),b(ut,gt,kt),xt.playAnimation()},[]);return reactExports.useEffect(()=>{g()},[]),jsxRuntimeExports.jsx("div",{id:"webgi-canvas-container",children:jsxRuntimeExports.jsx("canvas",{id:"webgi-canvas",ref:$})})}const Skills=()=>jsxRuntimeExports.jsx("div",{className:"skills"}),Home=()=>jsxRuntimeExports.jsx("div",{className:"home"}),Projects=()=>jsxRuntimeExports.jsx("div",{className:"projects"});gsapWithCSS.registerPlugin(ScrollTrigger);function App(){return reactExports.useState(0),jsxRuntimeExports.jsxs("div",{className:"App",children:[jsxRuntimeExports.jsx(Nav,{}),jsxRuntimeExports.jsx(Home,{}),jsxRuntimeExports.jsx(Skills,{}),jsxRuntimeExports.jsx(Projects,{}),jsxRuntimeExports.jsx(WebGiViewer,{})]})}client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
